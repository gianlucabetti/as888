000100170210      //-------------------------------------------------------------------
000200170313      //?AUTAD05R - Da WF aggiorno il TAMPPA
000300170210      //-------------------------------------------------------------------
000400170210     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500170210
000600170210      //---------------------------------------------------------------
000700170210      //?Dichiarazione file.
000800170210      //---------------------------------------------------------------
000900170210     fWFAUD01L  uf   e           k disk
001000170210
001100170313     fTNTAM01L  if   e           k disk
001200170210
001300170210      //---------------------------------------------------------------
001400170210      //?Definizione costanti.
001500170210      //---------------------------------------------------------------
001600170210
001700170210      //---------------------------------------------------------------
001800170210      //?Definizione schiere.
001900170210      //---------------------------------------------------------------
002000170210
002100170210      //---------------------------------------------------------------
002200170210      //?Definizione aree dati.
002300170210      //---------------------------------------------------------------
002400170210      // - Dati utente
002500170210     d §AzUte        e ds                  extname(AZUTE00F)
002600170210     d                                     dtaara
002700170210     d §DatiUte      e ds                  extname(dDatiUte)
002800170210     d                                     dtaara
002900170210
003000170210      //---------------------------------------------------------------
003100170210      //?Definizione strutture dati.
003200170210      //---------------------------------------------------------------
003300170210      // - Parametri ricevuti
003400170210     d KPJBA         e ds
003500170210
003600170210      // - Reperimento dati utente
003700170210     d TIBS34DS      e ds
003800170210
003900170210      //---------------------------------------------------------------
004000170210      //?Definizione variabili globali.
004100170210      //---------------------------------------------------------------
004200170210      // - Flags booleani
004300170210     d Fine            s               n   inz(*off)
004400170210     d wEoF            s               n   inz(*off)
004500170210
004600170210      // - Campi di comodo
004700170313     d ksc             s                   like(WFAksc) inz
004800170210     d oggi            s              8s 0 inz
004900170313     d Tipo            s                   like(WFAtipo) inz('T')
005000170210
005100170210      //---------------------------------------------------------------
005200170210      //?Definizione Procedure usate.
005300170210      //---------------------------------------------------------------
005400170210
005500170210      //---------------------------------------------------------------
005600170210      //?Definizione Prototipi.
005700170210      //---------------------------------------------------------------
005800170210      /copy gaitrasrc/srcprotopr,TIBS34R
005900170210
006000170210      //---------------------------------------------------------------
006100170210      //?Definizione key-list.
006200170210      //---------------------------------------------------------------
006300170210
006400170210      //---------------------------------------------------------------
006500170210      //?M A I N - L I N E
006600170210      //---------------------------------------------------------------
006700170210     c     *Entry        plist
006800170210     c                   parm                    kpjba
006900170210
007000170210      /free
007100170210
007200170210       //?Operazioni iniziali
007300170210       exsr RoutInz;
007400170210
007500170210       //?Elaborazione
007600170210       exsr Elabora;
007700170210
007800170210       //?Operazioni finali
007900170210       exsr RoutEnd;
008000170210
008100170210       //--------------------------------------------------------------
008200170210       //?Operazioni iniziali.
008300170210       //--------------------------------------------------------------
008400170210       BEGSR RoutInz;
008500170213
008600170213         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
008700170210
008800170210       //?Imposto oggi
008900170210         Oggi = %dec(%date());
009000170210
009100170210       //?Reperimento dati job
009200170210         exsr DatiJob;
009300170210
009400170210       ENDSR;
009500170210
009600170210       //--------------------------------------------------------------
009700170210       //?Reperimento Dati del job (Utente/Operativi).
009800170210       //--------------------------------------------------------------
009900170210       BEGSR DatiJob;
010000170210
010100170210         in(E) §AzUte;
010200170210         IF  not %error;
010300170210           in(E) §DatiUte;
010400170210         ENDIF;
010500170210         IF  %error or RSut = *blanks;
010600170210           clear TIBS34ds;
010700170210           tibs34r(tibs34ds);
010800170210           in §AzUte;
010900170210           in §DatiUte;
011000170210         ENDIF;
011100170210
011200170210       ENDSR;
011300170210
011400170210       //--------------------------------------------------------------
011500170210       //?Elaborazione.
011600170210       //--------------------------------------------------------------
011700170210       BEGSR Elabora;
011800170313
011900170313         wEoF = *off;
012000170210
012100170313         setll (tipo:ksc) WFAUD01L;
012200170313         reade tipo WFAUD01L;
012300170313         DOW  not wEoF;
012400170313
012500170313         //?Fine File
012600170313           IF  %eof(WFAUD01L);
012700170313             wEoF = *on;
012800170313             leave;
012900170313           ENDIF;
013000170313
013100170313         //?Solo i rcd elaborati
013200170313           IF  WFAela <> ' ';
013300170313           //?Aggancio la tariffa vecchia
013400170313             chain (WFAksc:WFActrv:WFAprgv) TNTAM01L;
013500170313             IF  %found(TNTAM01L);
013600170313               WFAppav = TAMppa;
013700170313               update WFAUD000;
013800170313             ENDIF;
013900170313           ENDIF;
014000170313
014100170313           reade tipo WFAUD01L;
014200170210
014300170210         ENDDO;
014400170210
014500170210       ENDSR;
014600170210
014700170210       //--------------------------------------------------------------
014800170210       //?Operazioni finali.
014900170210       //--------------------------------------------------------------
015000170210       BEGSR RoutEnd;
015100170210
015200170210         *inLR = *on;
015300170210         return;
015400170210
015500170210       ENDSR;
015600170210
015700170210      /end-free
