000100170321      //--------------------------------------------------------------
000200170321      //?AUTAT00R - Controllo tariffe aumentate - Lancio
000300170321      //--------------------------------------------------------------
000400170321     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500170321     h dftactgrp(*no) actgrp(*caller)
000600170321
000700170321      //---------------------------------------------------------------
000800170321      //?Dichiarazione file.
000900170321      //---------------------------------------------------------------
001000170321      // - Video
001100170321     fAUTAT00D  cf   e             workstn
001200170321     f                                     indds(IndDspF)
001300170321     f                                     infds(InfDspF)
001400170321
001500170321      //---------------------------------------------------------------
001600170321      //?Definizione costanti.
001700170321      //---------------------------------------------------------------
001800170321      // - Tasti funzionali a video
001900170321     d c_F01           c                   const(x'31')
002000170321     d c_F02           c                   const(x'32')
002100170321     d c_F03           c                   const(x'33')
002200170321     d c_F04           c                   const(x'34')
002300170321     d c_F05           c                   const(x'35')
002400170321     d c_F06           c                   const(x'36')
002500170321     d c_F07           c                   const(x'37')
002600170321     d c_F08           c                   const(x'38')
002700170321     d c_F09           c                   const(x'39')
002800170321     d c_F10           c                   const(x'3A')
002900170321     d c_F11           c                   const(x'3B')
003000170321     d c_F12           c                   const(x'3C')
003100170321     d c_F13           c                   const(x'B1')
003200170321     d c_F14           c                   const(x'B2')
003300170321     d c_F15           c                   const(x'B3')
003400170321     d c_F16           c                   const(x'B4')
003500170321     d c_F17           c                   const(x'B5')
003600170321     d c_F18           c                   const(x'B6')
003700170321     d c_F19           c                   const(x'B7')
003800170321     d c_F20           c                   const(x'B8')
003900170321     d c_F21           c                   const(x'B9')
004000170321     d c_F22           c                   const(x'BA')
004100170321     d c_F23           c                   const(x'BB')
004200170321     d c_F24           c                   const(x'BC')
004300170321     d c_Enter         c                   const(x'F1')
004400170321     d c_RollDown      c                   const(x'F4')
004500170321     d c_RollUp        c                   const(x'F5')
004600170321
004700170321      //---------------------------------------------------------------
004800170321      //?Definizione schiere.
004900170321      //---------------------------------------------------------------
005000170321      // - Messaggi di errore
005100170321     d Msg             s             78    dim(30) ctdata perrcd(1)
005200170321
005300170321      //---------------------------------------------------------------
005400170321      //?Definizione aree dati.
005500170321      //---------------------------------------------------------------
005600170321      // - Dati utente
005700170321     d §AzUte        e ds                  extname(AZUTE00F)
005800170321     d                                     dtaara
005900170321     d §DatiUte      e ds                  extname(dDatiUte)
006000170321     d                                     dtaara
006100170321
006200170321      //---------------------------------------------------------------
006300170321      //?Definizione strutture dati.
006400170321      //---------------------------------------------------------------
006500170321      // - Status
006600170321     d Psds           sds
006700170321     d   SDSpgm          *proc
006800170321
006900170321      // - InfDS
007000170321     d InfDspF         ds
007100170321     d  dsp_aid              369    369a
007200170321
007300170321      // - Indicatori su DspF
007400170321     d IndDspF         ds
007500170321        // - Indicatori di errore in videata
007600170321     d  ErrMessage                    1n   overlay(IndDspF : 28)
007700170321        // - Indicatori di errore
007800170321     d  PosCurDTAGG                   1n   overlay(IndDspF : 50)
007900170321     d  PosCurDTAUM                   1n   overlay(IndDspF : 51)
008000170321        // - Indicatori di errore generico
008100170321     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008200170321
008300170321      // - Indicatore di errore dal 50 al 99
008400170321     d WindDspF        ds                  inz
008500170321     d  WindDspFa              1     49    inz(*zero)
008600170321     d  WindDspFb             50     99    inz(*zero)
008700170321
008800170321       // - Parametri per pgm. controllo/inversione data?
008900170321     d wlbdat          ds                  inz
009000170321     d  G08dat                 1      8  0
009100170321     d  G08inv                 9     16  0
009200170321     d  G08err                17     17
009300170321     d  G08tgi                18     22  0
009400170321
009500170321      // - Parametri ricevuti
009600170321     d KPJBA         e ds
009700170321
009800170321      // - Reperimento dati utente
009900170321     d TIBS34DS      e ds
010000170321
010100170321      //---------------------------------------------------------------
010200170321      //?Definizione variabili globali.
010300170321      //---------------------------------------------------------------
010400170321      // - Flags booleani
010500170321     d Fine            s               n   inz(*off)
010600170321     d wEnd            s               n   inz(*off)
010700170321     d wInzD02         s               n   inz(*off)
010800170321
010900170321      // - Indici di schiera
011000170321     d xx              s              4s 0 inz
011100170321
011200170321      // - Campi associati al video
011300170321     d Video           s              2a   inz('D2')
011400170321
011500170321      // - Campi di comodo data
011600170321     d Data_EUR        s               d   datfmt(*eur)
011700170321     d Data_ISO        s               d   datfmt(*iso)
011800170321     d Oggi            s              8s 0 inz
011900170321     d wDataAGG        s              8s 0 inz
012000170321     d wDataAUM        s              8s 0 inz
012100170321
012200170321      //---------------------------------------------------------------
012300170321      //?Definizione procedure usate.
012400170321      //---------------------------------------------------------------
012500170321      // - CL Lancio elaborazione
012600170321     d AUTAT01C        pr                  extpgm('AUTAT01C')
012700170321     d  kpjba                              likeds(kpjba)
012800170321
012900170321      // - Sottomissione lavoro batch
013000170321     d bch10           pr                  extpgm('BCH10')
013100170321     d  kpjba                              likeds(KPJBA)
013200170321
013300170321      //---------------------------------------------------------------
013400170321      //?Definizione Prototipi.
013500170321      //---------------------------------------------------------------
013600170321      /copy gaitrasrc/srcprotopr,TIBS34R
013700170321      /copy gaitrasrc/srcprotopr,XSRDA8
013800170321
013900170321      //---------------------------------------------------------------
014000170321      //?Definizione key-list.
014100170321      //---------------------------------------------------------------
014200170321
014300170321      //---------------------------------------------------------------
014400170321      //?M A I N - L I N E
014500170321      //---------------------------------------------------------------
014600170321     c     *Entry        plist
014700170321     c                   parm                    kpjba
014800170321
014900170321      /free
015000170321
015100170321       //?Operazioni iniziali
015200170321       exsr RoutInz;
015300170321
015400170321       //?Gestione video
015500170321       DOW  Fine = *off;
015600170321         SELECT;
015700170321           WHEN  Video = 'D2';
015800170321             exsr GesD02;
015900170321           OTHER;
016000170321             Fine = *on;
016100170321         ENDSL;
016200170321       ENDDO;
016300170321
016400170321       //?Operazioni finali
016500170321       exsr RoutEnd;
016600170321
016700170321       //--------------------------------------------------------------
016800170321       //?Operazioni iniziali.
016900170321       //--------------------------------------------------------------
017000170321       BEGSR RoutInz;
017100170321
017200170321       //?Impostazione campi "fissi"
017300170321         V01pgm = SDSpgm;
017400170321         Video = 'D2';
017500170321         wInzD02 = *on;
017600170321
017700170321       //?Imposto oggi
017800170321         Oggi = %dec(%date());
017900170321
018000170321       //?Reperimento dati job
018100170321         exsr DatiJob;
018200170321
018300170321       ENDSR;
018400170321
018500170321       //--------------------------------------------------------------
018600170321       //?Reperimento Dati del job (Utente/Operativi).
018700170321       //--------------------------------------------------------------
018800170321       BEGSR DatiJob;
018900170321
019000170321         in(E) §AzUte;
019100170321         IF  NOT %error;
019200170321           in(E) §DatiUte;
019300170321         ENDIF;
019400170321         IF  %error or RSut = *blanks;
019500170321           clear TIBS34ds;
019600170321           tibs34r(tibs34ds);
019700170321           in §AzUte;
019800170321           in §DatiUte;
019900170321         ENDIF;
020000170321
020100170321       ENDSR;
020200170321
020300170321       //--------------------------------------------------------------
020400170321       //?Gestione videata D02.
020500170321       //--------------------------------------------------------------
020600170321       BEGSR GesD02;
020700170321
020800170321       //?Inizializzazione videata
020900170321         IF  wInzD02;
021000170321           exsr InzD02;
021100170321           wInzD02 = *off;
021200170321         ENDIF;
021300170321
021400170321       //?Emissione Testata
021500170321         write AUT00T01;
021600170321
021700170321       //?Emissione videata
021800170321         exfmt AUT00D02;
021900170321         reset ErrMessage;
022000170321         reset ErrGenerico;
022100170321         clear V02msg;
022200170321
022300170321         SELECT;
022400170321
022500170321       //?- F03=Fine
022600170321           WHEN  dsp_aid = c_F03;
022700170321             exsr F03D02;
022800170321
022900170321       //?- F06=Elabora
023000170321           WHEN  dsp_aid = c_F06;
023100170321             exsr ContrD02;
023200170321             IF  ErrGenerico;
023300170321               leavesr;
023400170321             ENDIF;
023500170321             exsr F06D02;
023600170321
023700170321       //?Invio
023800170321           OTHER;
023900170321             exsr ContrD02;
024000170321             IF  ErrGenerico;
024100170321               leavesr;
024200170321             ENDIF;
024300170321
024400170321         ENDSL;
024500170321
024600170321       ENDSR;
024700170321
024800170321       //--------------------------------------------------------------
024900170321       //?Inizializzazione Videata D02.
025000170321       //--------------------------------------------------------------
025100170321       BEGSR InzD02;
025200170321
025300170321       //?Pulizia videata
025400170321         clear AUT00D02;
025500170321
025600170321       //?Imposto oggi come data aggiornamento
025700170321         data_ISO = (%date(oggi));
025800170321         data_EUR = data_ISO;
025900170321         V02dtagg = %dec(data_EUR);
026000170321
026100170321       ENDSR;
026200170321
026300170321       //--------------------------------------------------------------
026400170321       //?Gestione tasto funzionale F03 da videata D02
026500170321       //?F03=Fine
026600170321       //--------------------------------------------------------------
026700170321       BEGSR F03D02;
026800170321
026900170321       //?Chiusura del programma
027000170321         Fine = *on;
027100170321
027200170321       ENDSR;
027300170321
027400170321       //--------------------------------------------------------------
027500170321       //?Gestione tasto funzionale F06 da videata D02
027600170321       //?F06=Elabora
027700170321       //--------------------------------------------------------------
027800170321       BEGSR F06D02;
027900170321
028000170321       //?Lancio pgm creazione file di controllo
028100170321         %subst(kpjbu:1:8) = %editc(wDataAGG:'X');
028200170321         %subst(kpjbu:9:8) = %editc(wDataAUM:'X');
028300170321         kcoaz = 'AU01';
028400170321         kbuff = *blanks;
028500170321       //?Richiamo interattivo
028600170321         IF  knmus = *all'1';
028700170321           AUTAT01C(kpjba);
028800170321       //?Richiamo batch
028900170321         ELSE;
029000170321           BCH10(kpjba);
029100170321         ENDIF;
029200170321
029300170321       //?Chiusura del programma
029400170321         Fine = *on;
029500170321
029600170321       ENDSR;
029700170321
029800170321       //--------------------------------------------------------------
029900170321       //?Controlla Videata D02.
030000170321       //--------------------------------------------------------------
030100170321       BEGSR ContrD02;
030200170321
030300170321         WindDspF = IndDspF;
030400170321         reset WindDspFb;
030500170321         IndDspF  = WindDspF;
030600170321
030700170321         clear wDataAGG;
030800170321         clear wDataAUM;
030900170321
031000170321       //?Data Aggiornamento tariffe
031100170321         IF  V02dtagg  = *zeros;
031200170321           ErrMessage  = *on;
031300170321           ErrGenerico = *on;
031400170321           PosCurDTAGG = *on;
031500170321           V02msg = Msg(01);
031600170321           leavesr;
031700170321         ENDIF;
031800170321
031900170321         clear wlbdat;
032000170321         G08dat = V02dtagg;
032100170321         xsrda8(wlbdat);
032200170321         IF  G08err = '1';
032300170321           ErrMessage  = *on;
032400170321           ErrGenerico = *on;
032500170321           PosCurDTAGG = *on;
032600170321           V02msg = Msg(01);
032700170321           leavesr;
032800170321         ENDIF;
032900170321         V02dtagg = G08dat;
033000170321         wDataAGG = G08inv;
033100170321
033200170321       //?Data Inizio Aumento tariffe
033300170321         IF  V02dtaum  = *zeros;
033400170321           ErrMessage  = *on;
033500170321           ErrGenerico = *on;
033600170321           PosCurDTAUM = *on;
033700170321           V02msg = Msg(01);
033800170321           leavesr;
033900170321         ENDIF;
034000170321
034100170321         clear wlbdat;
034200170321         G08dat = V02dtaum;
034300170321         xsrda8(wlbdat);
034400170321         IF  G08err = '1';
034500170321           ErrMessage  = *on;
034600170321           ErrGenerico = *on;
034700170321           PosCurDTAUM = *on;
034800170321           V02msg = Msg(01);
034900170321           leavesr;
035000170321         ENDIF;
035100170321         V02dtaum = G08dat;
035200170321         wDataAUM = G08inv;
035300170321
035400170321       ENDSR;
035500170321
035600170321       //--------------------------------------------------------------
035700170321       //?Operazioni finali.
035800170321       //--------------------------------------------------------------
035900170321       BEGSR RoutEnd;
036000170321
036100170321         *inLR = *on;
036200170321         return;
036300170321
036400170321       ENDSR;
036500170321
036600170321      /end-free
036700170321
036800170321       //--------------------------------------------------------------
036900170321       //?Schiere a tempo di compilazione.
037000170321       //--------------------------------------------------------------
037100170321** -- MSG -------------------------------------------------------------------*
037200170321Data Errata                                                                    1
