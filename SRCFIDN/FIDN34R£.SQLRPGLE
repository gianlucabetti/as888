000100040426      *PARMS CLOSQLCSR(*ENDMOD)  DBGVIEW(*SOURCE)
000200040426
000300040426      *===============================================================*
000400040426      * FIDN34R * Ristampa Avvisi Danno per data                      *
000500040426      *===============================================================*
000600040426
000700040426      *****************************************************************
000800040426      *  FASI C.A. FISSATE A PROGRAMMA                                *
000900040426      *****************************************************************
001000040426      *                                                               *
001100040426      *    545 = Stampa avviso danno                        (WAVVD)   *
001200040426      *                                                               *
001300040426      *****************************************************************
001400040426
001500040426     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001600040426     h alwnull(*inputonly)
001700040426
001800040426      *---------------------------------------------------------------*
001900040426
002000040426     fFNDCT01L  if   e           k disk
002100040426     fFNDCF01L  if   e           k disk
002200040426
002300040426      *---------------------------------------------------------------*
002400040426
002500040426      * Costanti - - - - - - - - - - - - - - - - - - - - - - - - - - -*
002600040426      *
002700040426      *
002800040426      * Schiere  - - - - - - - - - - - - - - - - - - - - - - - - - - -*
002900040426      *
003000040426      *
003100040426      * Ds - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -*
003200040426      *
003300040426     d KPJBA         e ds
003400050324     d FIDN00in      e ds                  extname(FIDN00ds)  inz
003500050324     d                                     prefix(IN_:3)
003600040426      * - Parametri x Controllo profilo utenti
003700040426     d TIBS34DS      e ds                  inz
003800040426      * - Ds di riferimento al file esterno AZUTE00F
003900040426     d AZUTEDS       e ds                  extname(AZUTE00F)
004000040426      * - Ds per dati organigramma
004100040426     d DDatiUte      e ds
004200040426      * - Dati di FNDCF00F estratti via SQL
004300040426     d FNDCFds       e ds                  extname(FNDCF00F)  inz
004400040426      *
004500040426     d FIDN00ds      e ds                  inz
004600040426     d   I00mod      e                     inz('G')
004700040428     d   I00fca      e                     inz(998)
004800050324     d   I00tpb      e                     inz('S')
004900040426     d   I00nce      e                     inz(1)
005000040426      *
005100040426      * Variabili  - - - - - - - - - - - - - - - - - - - - - - - - - -*
005200040426      *
005300040426      * - Flag
005400040426     d $EoF            s              1    inz(*off)
005500040426     d $Err            s              1    inz(*off)
005600040426      * - Variabili riferite al data base
005700040426     d Wavvd           s                   like(DCTfca) inz(545)
005800040428     d SAVdad          s                   like(I00dsb) inz
005900040426
006000040426      *---------------------------------------------------------------*
006100040426      *  RIEPILOGO INDICATORI                                         *
006200040426      *---------------------------------------------------------------*
006300040426      * 10    - Comodo                                                *
006400040426      *---------------------------------------------------------------*
006500040426
006600040426     c     *Entry        plist
006700040426     c                   parm                    KPJBA
006800050324     c                   movel     KPJBU         FIDN00in
006900040426      *
007000040426      * Operazioni Iniziali
007100040426     c                   exsr      OperazIniz
007200040426      *
007300040426     c                   exsr      OpenCursor
007400040426      *
007500040426     c                   dou       $Eof  = *on
007600040426     c                   exsr      ReadCursor
007700040426     c                   enddo
007800040426      *
007900040426      * Fine programma
008000040426     c                   exsr      CloseCursor
008100040426     c                   eval      *inLR = *on
008200040426      *
008300040426      *****************************************************************
008400040426      **?Operazioni iniziali                                        ?**
008500040426      *****************************************************************
008600040426     c     OperazIniz    BEGSR
008700040426      *
008800040426      * Definizione Key-List
008900040426      * - FNDCT01L
009000040426     c     K03DCT01      klist
009100040426     c                   kfld                    DCFaac
009200040426     c                   kfld                    DCFfil
009300040426     c                   kfld                    DCFnca
009400040428      *
009500040428     c                   movel     KPJBU         FIDN00ds
009600040428     c                   eval      SAVdad = I00dsb
009700040426      *
009800040426      * Reperisco dati job
009900040426     c                   exsr      DatiJob
010000040426      *
010100040426     c                   ENDSR
010200040426      *
010300040426      *****************************************************************
010400040426      **?Reperimento dati del job (Utente/Operativi)                ?**
010500040426      *****************************************************************
010600040426     c     DatiJob       BEGSR
010700040426      *
010800040426     c     *dtaara       define    §azute        azuteds
010900040426     c     *dtaara       define    §datiute      ddatiute
011000040426      *
011100040426     c                   in(E)     *dtaara
011200040426     c                   IF        %ERROR or RSUT = *blanks
011300040426     c                   clear                   Tibs34Ds
011400040426     c                   call      'TIBS34R'
011500040426     c                   parm                    Tibs34Ds
011600040426     c                   in        *dtaara
011700040426     c                   ENDIF
011800040426      *
011900040426     c                   ENDSR
012000040426
012100040426      *****************************************************************
012200040426      **?Apertura cursore.                                          ?**
012300040426      *****************************************************************
012400040426     c     OpenCursor    BEGSR
012500040426      *
012600040426     c/EXEC SQL
012700040426     c+ declare A1 cursor for
012800040426     c+ select  *
012900040426     c+ from    FNDCF00F
013000040426     c+ where   DCFATB = ' '
013100040426     c+   and   DCFFCA = :Wavvd
013200040428     c+   and   DCFDFC = :SAVdad
013300040426     c+ for     FETCH  only
013400040426     c/END-EXEC
013500040426      *
013600040426     c/EXEC SQL
013700040426     c+ OPEN A1
013800040426     c/END-EXEC
013900040426      *
014000040426     c                   ENDSR
014100040426
014200040426      *****************************************************************
014300040426      **?Lettura cursore.                                           ?**
014400040426      *****************************************************************
014500040426     c     ReadCursor    BEGSR
014600040426      *
014700040426     c                   clear                   FNDCFds
014800040426      *
014900040426     c/EXEC SQL
015000040426     c+ fetch next from A1 into :FNDCFds
015100040426     c/END-EXEC
015200040426      *
015300040426sel 1c                   select
015400040426w   1c                   when      SQLcod = 100
015500040426     c                   eval      $EoF   = *on
015600040426w   1c                   when      SQLcod < 0
015700040426     c                   eval      $Err   = *on
015800040426     c                   eval      $Eof   = *on
015900040426x   1c                   other
016000040426     c                   exsr      ElabRec
016100040426e   1c                   endsl
016200040426      *
016300040426     c                   ENDSR
016400040426
016500040426      *****************************************************************
016600040426      **?Chiusura cursore.                                          ?**
016700040426      *****************************************************************
016800040426     c     CloseCursor   BEGSR
016900040426      *
017000040426     c/EXEC SQL
017100040426     c+ CLOSE A1
017200040426     c/END-EXEC
017300040426      *
017400040426     c                   ENDSR
017500040426
017600040426      *****************************************************************
017700040426      **?Elaborazione singolo record da FNDCF00F                    ?**
017800040426      *****************************************************************
017900040426     c     ElabRec       BEGSR
018000040426      *
018100040426     c     K03DCT01      chain     FNDCT000
018200040426      *
018300040426if  1c                   if            %found(FNDCT01L)
018400040426     c                             and DCTatb =  *blanks
018500040426     c                             and DCTprn <> *zeros
018600040426      *
018700040428     c                   reset                   FIDN00ds
018800040426     c                   eval      I00fgs = DCTgfc
018900040426     c                   eval      I00aac = DCTaac
019000040426     c                   eval      I00fil = DCTfil
019100040426     c                   eval      I00nca = DCTnca
019200040426     c                   eval      I00aas = DCTaas
019300040426     c                   eval      I00lnp = DCTlnp
019400040426     c                   eval      I00nrs = DCTnrs
019500040426     c                   eval      I00nsp = DCTnsp
019600040426     c                   eval      I00lna = DCTlna
019700040426     c                   eval      I00tad = DCTtad
019800050324     c                   eval      I00tpb = IN_tpb
019900040426     c                   movel(p)  FIDN00DS      KPJBU
020000040426     c                   call      'FIDN35R'
020100040426     c                   parm                    KPJBA
020200040426      *
020300040426e   1c                   endif
020400040426      *
020500040426     c                   ENDSR
