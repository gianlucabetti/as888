000100050408     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000200050408
000300050408      *------------------------------------------------------------------------*
000400050408      *
000500050510      *  Creazione file dei clienti assicurati
000600050408      *
000700050408      *------------------------------------------------------------------------*
000800050408
000900050510     fFidn72d   cf   e             workstn
001000050408
001100050408      *------------------------------------------------------------------------*
001200050408      *  RIEPILOGO INDICATORI
001300050408      *------------------------------------------------------------------------*
001400050408      * 28 - ERRORE GENERICO DSPF
001500050428      * 40 - ERRORE data dal
001600050428      * 41 - ERRORE data al
001700050408      *------------------------------------------------------------------------*
001800050408
001900050408      *------------------------------------------------------------------------*
002000050408      *   V A R I A B I L I
002100050408      *------------------------------------------------------------------------*
002200050510     d woggi           s                   like(v1cdta)
002300050510     d w0140           s             14  0
002400050408
002500050408      *------------------------------------------------------------------------*
002600050408      *   S C H I E R E
002700050408      *------------------------------------------------------------------------*
002800050408     d msg             s             35    dim(4) ctdata perrcd(1)
002900050408
003000050408      *------------------------------------------------------------------------*
003100050408      *   D S   I N T E R N E / E S T E R N E
003200050408      *------------------------------------------------------------------------*
003300050408     d parm01          ds
003400050428     d  wdatda                        8  0
003500050428     d  wdatal                        8  0
003600050510     d  wcbloc                        1
003700050510     d  wcnew                         1
003800050901     d  wctip                         1
003900050921     d  wctbl                         1
004000050408
004100050408     d wlbdat          ds                  inz
004200050408     d  g02dat                 1      8  0
004300050408     d  g02inv                 9     16  0
004400050408     d  g02err                17     17
004500050408     d  g02tgi                18     22  0
004600050408
004700050510     d azuteds       e ds                  extname(AZUTE00F)
004800050510     d ddatiute      e ds
004900050408     d kpjba         e ds
005000050510     d tibs34ds      e ds
005100050921
005200050921     d                sds
005300050921     d  vtcpgm                 1     10
005400050408      *------------------------------------------------------------------------*
005500050408
005600050408      * Pulizia Videata
005700050408     c                   ExSr      Sr_Pulvid
005800050408
005900050408      * Emissione Videata
006000050408     c                   Do        *Hival
006100050510     c                   Exfmt     dn72d01
006200050408
006300050408      * F3=Fine
006400050408     c   kc              Leave
006500050408
006600050408     c                   Setoff                                       28
006700050408
006800050408      * Controlli videata
006900050408     c                   ExSr      Sr_Contr
007000050408     c   28              Iter
007100050408
007200050408      * F6=Conferma
007300050408     c                   If        *inkf = *on
007400050408     c                   ExSr      Sr_Conferma
007500050408     c                   Leave
007600050408     c                   EndIf
007700050408
007800050408     c                   EndDo
007900050408
008000050408     c                   Eval      *InLr = *On
008100050408      *------------------------------------------------------------------------*
008200050408      * PULIZIA VIDEATA
008300050408      *------------------------------------------------------------------------*
008400050408     c     Sr_Pulvid     BegSr
008500050408
008600050510     c                   Clear                   v1cdtd
008700050510     c                   Eval      v1cdta = woggi
008800050510     c                   Eval      v1cblo = 'N'
008900050510     c                   Eval      v1cnew = 'S'
009000050901     c                   Eval      v1ctip = 'T'
009100050921     c                   Eval      v1ctbl = 'N'
009200050408
009300050408     c                   EndSr
009400050408      *------------------------------------------------------------------------*
009500050408      * CONTROLLI VIDEO
009600050408      *------------------------------------------------------------------------*
009700050408     c     Sr_Contr      BegSr
009800050408
009900050408      * Reset indicatori
010000050408     c                   Eval      *In40 = *Off
010100050428     c                   Eval      *In41 = *Off
010200050408
010300050428      * la data "dal" deve essere impostata
010400050510     c                   If        v1cdtd = *zeros
010500050408     c                   Eval      *In28 = *On
010600050408     c                   Eval      *In40 = *On
010700050408     c                   Eval      v1cmsg = msg(1)
010800050408     c                   Leavesr
010900050408     c                   EndIf
011000050408
011100050408      * controllo la data inserita
011200050428     c                   Clear                   wdatda
011300050408     c                   Clear                   wlbdat
011400050510     c                   Z-add     v1cdtd        g02dat
011500050408     c                   Call      'XSRDA8'
011600050408     c                   Parm                    wlbdat
011700050408     c                   If        g02err = '1'
011800050408     c                   Eval      *In40 = *On
011900050408     c                   Eval      *In28 = *On
012000050408     c                   Eval      v1cmsg = msg(2)
012100050408     c                   Leavesr
012200050408     c                   EndIf
012300050510     c                   Z-add     g02dat        v1cdtd
012400050428     c                   Z-add     g02inv        wdatda
012500050428
012600050428      * la data "al" deve essere impostata
012700050510     c                   If        v1cdta = *zeros
012800050428     c                   Eval      *In28 = *On
012900050428     c                   Eval      *In41 = *On
013000050428     c                   Eval      v1cmsg = msg(1)
013100050428     c                   Leavesr
013200050428     c                   EndIf
013300050428
013400050428      * controllo la data inserita
013500050428     c                   Clear                   wdatal
013600050428     c                   Clear                   wlbdat
013700050510     c                   Z-add     v1cdta        g02dat
013800050428     c                   Call      'XSRDA8'
013900050428     c                   Parm                    wlbdat
014000050428     c                   If        g02err = '1'
014100050428     c                   Eval      *In41 = *On
014200050428     c                   Eval      *In28 = *On
014300050428     c                   Eval      v1cmsg = msg(2)
014400050428     c                   Leavesr
014500050428     c                   EndIf
014600050510     c                   Z-add     g02dat        v1cdta
014700050428     c                   Z-add     g02inv        wdatal
014800050428
014900050428      * range
015000050503     c                   If        wdatal < wdatda
015100050428     c                   Eval      *In41 = *On
015200050428     c                   Eval      *In28 = *On
015300050428     c                   Eval      v1cmsg = msg(2)
015400050428     c                   Leavesr
015500050428     c                   EndIf
015600050408
015700050408     c                   EndSr
015800050408      *------------------------------------------------------------------------*
015900050408      * RICHIAMA IL PROGRAMMA DI CREAZIONE FILE
016000050408      *------------------------------------------------------------------------*
016100050408     c     Sr_Conferma   begsr
016200050408
016300050606     c                   Eval      wcbloc = v1cblo
016400050606     c                   Eval      wcnew  = v1cnew
016500050901     c                   Eval      wctip  = v1ctip
016600050921     c                   Eval      wctbl  = v1ctbl
016700050408     c                   Movel     parm01        kpjbu
016800050510     c                   Eval      kcoaz = 'DN71'
016900050510     c**!!!              Call      'FIDN71R'
017000050510     c                   Call      'BCH10'
017100050408     c                   Parm                    kpjba
017200050408
017300050408     c                   EndSr
017400050408      *------------------------------------------------------------------------*
017500050408      * ROUTINE INIZIALE
017600050408      *------------------------------------------------------------------------*
017700050408     c     *Inzsr        BegSr
017800050408
017900050408     c     *Entry        Plist
018000050408     c                   Parm                    kpjba
018100050510
018200050510     c     *dtaara       define    §azute        azuteds
018300050510     c     *dtaara       define    §datiute      ddatiute
018400050510
018500050510     c                   in(E)     *dtaara
018600050510     c                   IF        %ERROR or RSUT = *blanks
018700050510     c                   clear                   Tibs34Ds
018800050510     c                   call      'TIBS34R'
018900050510     c                   parm                    Tibs34Ds
019000050510     c                   in        *dtaara
019100050510     c                   ENDIF
019200050510
019300050510     c                   Time                    w0140
019400050510     c                   Move      w0140         woggi
019500050408
019600050408     c                   EndSr
019700050408      *
019800050408** MSG
019900050408Inserire la data                                                                    1
020000050408Data errata                                                                         2
