000100050408     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000200050408
000300050408      *------------------------------------------------------------------------*
000400050408      *
000500050510      *  Creazione file dei clienti assicurati
000600050408      *
000700050408      *------------------------------------------------------------------------*
000800050408
000900050510     fFidn72d   cf   e             workstn
001000050408
001100050408      *------------------------------------------------------------------------*
001200050408      *  RIEPILOGO INDICATORI
001300050408      *------------------------------------------------------------------------*
001400050408      * 28 - ERRORE GENERICO DSPF
001500050428      * 40 - ERRORE data dal
001600050428      * 41 - ERRORE data al
001700050408      *------------------------------------------------------------------------*
001800050408
001900050408      *------------------------------------------------------------------------*
002000050408      *   V A R I A B I L I
002100050408      *------------------------------------------------------------------------*
002200050510     d woggi           s                   like(v1cdta)
002300050510     d w0140           s             14  0
002400050408
002500050408      *------------------------------------------------------------------------*
002600050408      *   S C H I E R E
002700050408      *------------------------------------------------------------------------*
002800050408     d msg             s             35    dim(4) ctdata perrcd(1)
002900050408
003000050408      *------------------------------------------------------------------------*
003100050408      *   D S   I N T E R N E / E S T E R N E
003200050408      *------------------------------------------------------------------------*
003300050408     d parm01          ds
003400050428     d  wdatda                        8  0
003500050428     d  wdatal                        8  0
003600050510     d  wcbloc                        1
003700050510     d  wcnew                         1
003800050901     d  wctip                         1
003900050408
004000050408     d wlbdat          ds                  inz
004100050408     d  g02dat                 1      8  0
004200050408     d  g02inv                 9     16  0
004300050408     d  g02err                17     17
004400050408     d  g02tgi                18     22  0
004500050408
004600050510     d azuteds       e ds                  extname(AZUTE00F)
004700050510     d ddatiute      e ds
004800050408     d kpjba         e ds
004900050510     d tibs34ds      e ds
005000050408      *------------------------------------------------------------------------*
005100050408
005200050408      * Pulizia Videata
005300050408     c                   ExSr      Sr_Pulvid
005400050408
005500050408      * Emissione Videata
005600050408     c                   Do        *Hival
005700050510     c                   Exfmt     dn72d01
005800050408
005900050408      * F3=Fine
006000050408     c   kc              Leave
006100050408
006200050408     c                   Setoff                                       28
006300050408
006400050408      * Controlli videata
006500050408     c                   ExSr      Sr_Contr
006600050408     c   28              Iter
006700050408
006800050408      * F6=Conferma
006900050408     c                   If        *inkf = *on
007000050408     c                   ExSr      Sr_Conferma
007100050408     c                   Leave
007200050408     c                   EndIf
007300050408
007400050408     c                   EndDo
007500050408
007600050408     c                   Eval      *InLr = *On
007700050408      *------------------------------------------------------------------------*
007800050408      * PULIZIA VIDEATA
007900050408      *------------------------------------------------------------------------*
008000050408     c     Sr_Pulvid     BegSr
008100050408
008200050510     c                   Clear                   v1cdtd
008300050510     c                   Eval      v1cdta = woggi
008400050510     c                   Eval      v1cblo = 'N'
008500050510     c                   Eval      v1cnew = 'S'
008600050901     c                   Eval      v1ctip = 'T'
008700050408
008800050408     c                   EndSr
008900050408      *------------------------------------------------------------------------*
009000050408      * CONTROLLI VIDEO
009100050408      *------------------------------------------------------------------------*
009200050408     c     Sr_Contr      BegSr
009300050408
009400050408      * Reset indicatori
009500050408     c                   Eval      *In40 = *Off
009600050428     c                   Eval      *In41 = *Off
009700050408
009800050428      * la data "dal" deve essere impostata
009900050510     c                   If        v1cdtd = *zeros
010000050408     c                   Eval      *In28 = *On
010100050408     c                   Eval      *In40 = *On
010200050408     c                   Eval      v1cmsg = msg(1)
010300050408     c                   Leavesr
010400050408     c                   EndIf
010500050408
010600050408      * controllo la data inserita
010700050428     c                   Clear                   wdatda
010800050408     c                   Clear                   wlbdat
010900050510     c                   Z-add     v1cdtd        g02dat
011000050408     c                   Call      'XSRDA8'
011100050408     c                   Parm                    wlbdat
011200050408     c                   If        g02err = '1'
011300050408     c                   Eval      *In40 = *On
011400050408     c                   Eval      *In28 = *On
011500050408     c                   Eval      v1cmsg = msg(2)
011600050408     c                   Leavesr
011700050408     c                   EndIf
011800050510     c                   Z-add     g02dat        v1cdtd
011900050428     c                   Z-add     g02inv        wdatda
012000050428
012100050428      * la data "al" deve essere impostata
012200050510     c                   If        v1cdta = *zeros
012300050428     c                   Eval      *In28 = *On
012400050428     c                   Eval      *In41 = *On
012500050428     c                   Eval      v1cmsg = msg(1)
012600050428     c                   Leavesr
012700050428     c                   EndIf
012800050428
012900050428      * controllo la data inserita
013000050428     c                   Clear                   wdatal
013100050428     c                   Clear                   wlbdat
013200050510     c                   Z-add     v1cdta        g02dat
013300050428     c                   Call      'XSRDA8'
013400050428     c                   Parm                    wlbdat
013500050428     c                   If        g02err = '1'
013600050428     c                   Eval      *In41 = *On
013700050428     c                   Eval      *In28 = *On
013800050428     c                   Eval      v1cmsg = msg(2)
013900050428     c                   Leavesr
014000050428     c                   EndIf
014100050510     c                   Z-add     g02dat        v1cdta
014200050428     c                   Z-add     g02inv        wdatal
014300050428
014400050428      * range
014500050503     c                   If        wdatal < wdatda
014600050428     c                   Eval      *In41 = *On
014700050428     c                   Eval      *In28 = *On
014800050428     c                   Eval      v1cmsg = msg(2)
014900050428     c                   Leavesr
015000050428     c                   EndIf
015100050408
015200050408     c                   EndSr
015300050408      *------------------------------------------------------------------------*
015400050408      * RICHIAMA IL PROGRAMMA DI CREAZIONE FILE
015500050408      *------------------------------------------------------------------------*
015600050408     c     Sr_Conferma   begsr
015700050408
015800050606     c                   Eval      wcbloc = v1cblo
015900050606     c                   Eval      wcnew  = v1cnew
016000050901     c                   Eval      wctip  = v1ctip
016100050408     c                   Movel     parm01        kpjbu
016200050510     c                   Eval      kcoaz = 'DN71'
016300050510     c**!!!              Call      'FIDN71R'
016400050510     c                   Call      'BCH10'
016500050408     c                   Parm                    kpjba
016600050408
016700050408     c                   EndSr
016800050408      *------------------------------------------------------------------------*
016900050408      * ROUTINE INIZIALE
017000050408      *------------------------------------------------------------------------*
017100050408     c     *Inzsr        BegSr
017200050408
017300050408     c     *Entry        Plist
017400050408     c                   Parm                    kpjba
017500050510
017600050510     c     *dtaara       define    §azute        azuteds
017700050510     c     *dtaara       define    §datiute      ddatiute
017800050510
017900050510     c                   in(E)     *dtaara
018000050510     c                   IF        %ERROR or RSUT = *blanks
018100050510     c                   clear                   Tibs34Ds
018200050510     c                   call      'TIBS34R'
018300050510     c                   parm                    Tibs34Ds
018400050510     c                   in        *dtaara
018500050510     c                   ENDIF
018600050510
018700050510     c                   Time                    w0140
018800050510     c                   Move      w0140         woggi
018900050408
019000050408     c                   EndSr
019100050408      *
019200050408** MSG
019300050408Inserire la data                                                                    1
019400050408Data errata                                                                         2
