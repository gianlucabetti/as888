000100050408     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000200050408
000300050408      *------------------------------------------------------------------------*
000400050408      *
000500050511      *  Chiusura automatica C.A.
000600050408      *
000700050408      *------------------------------------------------------------------------*
000800050511
000900050511      *------------------------------------------------------------------------*
001000050511      *    09  = Chiusura C.A. per decorrenza termini                  (WCCH)
001100050511      *------------------------------------------------------------------------*
001200050408
001300050511     fFidn84d   cf   e             workstn
001400050408
001500050408      *------------------------------------------------------------------------*
001600050408      *  RIEPILOGO INDICATORI
001700050408      *------------------------------------------------------------------------*
001800050408      * 28 - ERRORE GENERICO DSPF
001900050511      * 40 - ERRORE anno
002000050408      *------------------------------------------------------------------------*
002100050408
002200050408      *------------------------------------------------------------------------*
002300050408      *   V A R I A B I L I
002400050408      *------------------------------------------------------------------------*
002500050511     d wcch            s                   like(v1ccch) inz('09')
002600050408
002700050408      *------------------------------------------------------------------------*
002800050408      *   S C H I E R E
002900050408      *------------------------------------------------------------------------*
003000050408     d msg             s             35    dim(4) ctdata perrcd(1)
003100050408
003200050408      *------------------------------------------------------------------------*
003300050408      *   D S   I N T E R N E / E S T E R N E
003400050408      *------------------------------------------------------------------------*
003500050408     d parm01          ds
003600050511     d  paac                          4  0
003700050511     d  pcch                          2
003800050408
003900050516     d azuteds       e ds                  extname(AZUTE00F)
004000050511     d dcch          e ds
004100050516     d ddatiute      e ds
004200050408     d kpjba         e ds
004300050511     d tibs02ds      e ds
004400050516     d tibs34ds      e ds                  inz
004500050516
004600050516     d                sds
004700050516     d  vtcpgm                 1     10
004800050516
004900050516      *------------------------------------------------------------------------*
005000050516      *   C O S T A N T I
005100050516      *------------------------------------------------------------------------*
005200050516      *  titolo videata (lunghezza massima 35)
005300050516     d vtctit          C                   CONST('     CHIUSURA AUTOMATICA C.A.-
005400050516     d                                           ')
005500050408      *------------------------------------------------------------------------*
005600050408
005700050408      * Pulizia Videata
005800050408     c                   ExSr      Sr_Pulvid
005900050408
006000050408      * Emissione Videata
006100050408     c                   Do        *Hival
006200050516     c                   Exfmt     dn84d01
006300050408
006400050408      * F3=Fine
006500050408     c   kc              Leave
006600050408
006700050408     c                   Setoff                                       28
006800050408
006900050408      * Controlli videata
007000050408     c                   ExSr      Sr_Contr
007100050408     c   28              Iter
007200050408
007300050408      * F6=Conferma
007400050511     c                   If        *Inkf = *on
007500050408     c                   ExSr      Sr_Conferma
007600050408     c                   Leave
007700050408     c                   EndIf
007800050408
007900050408     c                   EndDo
008000050408
008100050408     c                   Eval      *InLr = *On
008200050408      *------------------------------------------------------------------------*
008300050408      * PULIZIA VIDEATA
008400050408      *------------------------------------------------------------------------*
008500050408     c     Sr_Pulvid     BegSr
008600050408
008700050511     c                   Clear                   v1caac
008800050511     c                   Eval      v1ccch = wcch
008900050511      * decodifico causale chiusura
009000050511     c                   Clear                   Tibs02ds
009100050511     c                   Eval      t02mod = 'C'
009200050511     c                   Eval      t02sif = knsif
009300050511     c                   Eval      t02cod = 'CCH'
009400050511     c                   Eval      t02ke1 = v1ccch
009500050511     c                   Call      'TIBS02R'
009600050511     c                   Parm                    kpjba
009700050511     c                   Parm                    Tibs02ds
009800050511    4c                   If        t02err = *Blanks
009900050511     c                   Eval      dcch = t02uni
010000050511     c                   EndIf
010100050511     c                   Eval      v1dcch = §cchdesc
010200050408
010300050408     c                   EndSr
010400050408      *------------------------------------------------------------------------*
010500050408      * CONTROLLI VIDEO
010600050408      *------------------------------------------------------------------------*
010700050408     c     Sr_Contr      BegSr
010800050408
010900050408      * Reset indicatori
011000050408     c                   Eval      *In40 = *Off
011100050408
011200050511      * l'anno deve essere impostato
011300050511     c                   If        v1caac = *Zeros
011400050408     c                   Eval      *In28 = *On
011500050408     c                   Eval      *In40 = *On
011600050408     c                   Eval      v1cmsg = msg(1)
011700050408     c                   Leavesr
011800050408     c                   EndIf
011900050408
012000050511      * non deve essere maggiore dell'anno in corso
012100050511     c                   If        v1caac > *year
012200050408     c                   Eval      *In40 = *On
012300050408     c                   Eval      *In28 = *On
012400050408     c                   Eval      v1cmsg = msg(2)
012500050408     c                   Leavesr
012600050408     c                   EndIf
012700050408
012800050408     c                   EndSr
012900050408      *------------------------------------------------------------------------*
013000050408      * RICHIAMA IL PROGRAMMA DI CREAZIONE FILE
013100050408      *------------------------------------------------------------------------*
013200050408     c     Sr_Conferma   begsr
013300050408
013400050511     c                   Eval      paac = v1caac
013500050511     c                   Eval      pcch = v1ccch
013600050511
013700050408     c                   Movel     parm01        kpjbu
013800050511     c                   Eval      kcoaz = 'DN85'
013900050516     c**!!!              Call      'FIDN85R'
014000050516     c                   Call      'BCH10'
014100050408     c                   Parm                    kpjba
014200050408
014300050408     c                   EndSr
014400050408      *------------------------------------------------------------------------*
014500050408      * ROUTINE INIZIALE
014600050408      *------------------------------------------------------------------------*
014700050408     c     *Inzsr        BegSr
014800050408
014900050408     c     *Entry        Plist
015000050408     c                   Parm                    kpjba
015100050516
015200050516     c     *dtaara       define    §azute        azuteds
015300050516     c     *dtaara       define    §datiute      ddatiute
015400050516
015500050516     c                   in(E)     *dtaara
015600050516     c                   IF        %ERROR or RSUT = *blanks
015700050516     c                   clear                   Tibs34Ds
015800050516     c                   call      'TIBS34R'
015900050516     c                   parm                    Tibs34Ds
016000050516     c                   in        *dtaara
016100050516     c                   ENDIF
016200050408
016300050408     c                   EndSr
016400050408      *
016500050408** MSG
016600050511Immettere l'anno                                                                    1
016700050511Anno errato                                                                         2
