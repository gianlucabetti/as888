000100050408     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000200050408
000300050408      *------------------------------------------------------------------------*
000400050408      *
000500050408      *  Archiviazione C.A. chiuse
000600050408      *
000700050408      *------------------------------------------------------------------------*
000800050408
000900050408     fFidn90d   cf   e             workstn
001000050408
001100050408      *------------------------------------------------------------------------*
001200050408      *  RIEPILOGO INDICATORI
001300050408      *------------------------------------------------------------------------*
001400050408      * 28 - ERRORE GENERICO DSPF
001500050428      * 40 - ERRORE data dal
001600050428      * 41 - ERRORE data al
001700050408      *------------------------------------------------------------------------*
001800050408
001900050408      *------------------------------------------------------------------------*
002000050408      *   V A R I A B I L I
002100050408      *------------------------------------------------------------------------*
002200050408
002300050408      *------------------------------------------------------------------------*
002400050408      *   S C H I E R E
002500050408      *------------------------------------------------------------------------*
002600050408     d msg             s             35    dim(4) ctdata perrcd(1)
002700050408
002800050408      *------------------------------------------------------------------------*
002900050408      *   D S   I N T E R N E / E S T E R N E
003000050408      *------------------------------------------------------------------------*
003100050408     d parm01          ds
003200050428     d  wdatda                        8  0
003300050428     d  wdatal                        8  0
003400050408
003500050408     d wlbdat          ds                  inz
003600050408     d  g02dat                 1      8  0
003700050408     d  g02inv                 9     16  0
003800050408     d  g02err                17     17
003900050408     d  g02tgi                18     22  0
004000050408
004100050516     d azuteds       e ds                  extname(AZUTE00F)
004200050516     d ddatiute      e ds
004300050408     d kpjba         e ds
004400050516     d tibs34ds      e ds                  inz
004500050516
004600050516     d                sds
004700050516     d  vtcpgm                 1     10
004800050516
004900050516      *------------------------------------------------------------------------*
005000050516      *   C O S T A N T I
005100050516      *------------------------------------------------------------------------*
005200050516      *  titolo videata (lunghezza massima 35)
005300050516     d vtctit          C                   CONST('        ARCHIVIAZIONE C.A.   -
005400050516     d                                           ')
005500050408      *------------------------------------------------------------------------*
005600050408
005700050408      * Pulizia Videata
005800050408     c                   ExSr      Sr_Pulvid
005900050408
006000050408      * Emissione Videata
006100050408     c                   Do        *Hival
006200050516     c                   Exfmt     dn90d01
006300050408
006400050408      * F3=Fine
006500050408     c   kc              Leave
006600050408
006700050408     c                   Setoff                                       28
006800050408
006900050408      * Controlli videata
007000050408     c                   ExSr      Sr_Contr
007100050408     c   28              Iter
007200050408
007300050408      * F6=Conferma
007400050408     c                   If        *inkf = *on
007500050408     c                   ExSr      Sr_Conferma
007600050408     c                   Leave
007700050408     c                   EndIf
007800050408
007900050408     c                   EndDo
008000050408
008100050408     c                   Eval      *InLr = *On
008200050408      *------------------------------------------------------------------------*
008300050408      * PULIZIA VIDEATA
008400050408      *------------------------------------------------------------------------*
008500050408     c     Sr_Pulvid     BegSr
008600050408
008700050428     c                   Clear                   v1dtda
008800050428     c                   Clear                   v1dtal
008900050408
009000050408     c                   EndSr
009100050408      *------------------------------------------------------------------------*
009200050408      * CONTROLLI VIDEO
009300050408      *------------------------------------------------------------------------*
009400050408     c     Sr_Contr      BegSr
009500050408
009600050408      * Reset indicatori
009700050408     c                   Eval      *In40 = *Off
009800050428     c                   Eval      *In41 = *Off
009900050408
010000050428      * la data "dal" deve essere impostata
010100050428     c                   If        v1dtda = *zeros
010200050408     c                   Eval      *In28 = *On
010300050408     c                   Eval      *In40 = *On
010400050408     c                   Eval      v1cmsg = msg(1)
010500050408     c                   Leavesr
010600050408     c                   EndIf
010700050408
010800050408      * controllo la data inserita
010900050428     c                   Clear                   wdatda
011000050408     c                   Clear                   wlbdat
011100050428     c                   Z-add     v1dtda        g02dat
011200050408     c                   Call      'XSRDA8'
011300050408     c                   Parm                    wlbdat
011400050408     c                   If        g02err = '1'
011500050408     c                   Eval      *In40 = *On
011600050408     c                   Eval      *In28 = *On
011700050408     c                   Eval      v1cmsg = msg(2)
011800050408     c                   Leavesr
011900050408     c                   EndIf
012000050428     c                   Z-add     g02dat        v1dtda
012100050428     c                   Z-add     g02inv        wdatda
012200050428
012300050428      * la data "al" deve essere impostata
012400050428     c                   If        v1dtal = *zeros
012500050428     c                   Eval      *In28 = *On
012600050428     c                   Eval      *In41 = *On
012700050428     c                   Eval      v1cmsg = msg(1)
012800050428     c                   Leavesr
012900050428     c                   EndIf
013000050428
013100050428      * controllo la data inserita
013200050428     c                   Clear                   wdatal
013300050428     c                   Clear                   wlbdat
013400050428     c                   Z-add     v1dtal        g02dat
013500050428     c                   Call      'XSRDA8'
013600050428     c                   Parm                    wlbdat
013700050428     c                   If        g02err = '1'
013800050428     c                   Eval      *In41 = *On
013900050428     c                   Eval      *In28 = *On
014000050428     c                   Eval      v1cmsg = msg(2)
014100050428     c                   Leavesr
014200050428     c                   EndIf
014300050428     c                   Z-add     g02dat        v1dtal
014400050428     c                   Z-add     g02inv        wdatal
014500050428
014600050428      * range
014700050503     c                   If        wdatal < wdatda
014800050428     c                   Eval      *In41 = *On
014900050428     c                   Eval      *In28 = *On
015000050428     c                   Eval      v1cmsg = msg(2)
015100050428     c                   Leavesr
015200050428     c                   EndIf
015300050408
015400050408     c                   EndSr
015500050408      *------------------------------------------------------------------------*
015600050408      * RICHIAMA IL PROGRAMMA DI CREAZIONE FILE
015700050408      *------------------------------------------------------------------------*
015800050408     c     Sr_Conferma   begsr
015900050408
016000050408     c                   Movel     parm01        kpjbu
016100050408     c                   Eval      kcoaz = 'DN91'
016200050408     c                   Call      'FIDN91R'
016300050408     c**!!!              Call      'BCH10'
016400050408     c                   Parm                    kpjba
016500050408
016600050408     c                   EndSr
016700050408      *------------------------------------------------------------------------*
016800050408      * ROUTINE INIZIALE
016900050408      *------------------------------------------------------------------------*
017000050408     c     *Inzsr        BegSr
017100050408
017200050408     c     *Entry        Plist
017300050408     c                   Parm                    kpjba
017400050516
017500050516     c     *dtaara       define    §azute        azuteds
017600050516     c     *dtaara       define    §datiute      ddatiute
017700050516
017800050516     c                   in(E)     *dtaara
017900050516     c                   IF        %ERROR or RSUT = *blanks
018000050516     c                   clear                   Tibs34Ds
018100050516     c                   call      'TIBS34R'
018200050516     c                   parm                    Tibs34Ds
018300050516     c                   in        *dtaara
018400050516     c                   ENDIF
018500050408
018600050408     c                   EndSr
018700050408      *
018800050408** MSG
018900050408Inserire la data                                                                    1
019000050408Data errata                                                                         2
