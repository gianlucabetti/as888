000100140926       //==============================================================
000200140926       //?TEST - Driver chiusura R.A. disposizioni da internet         ?
000300140926       //==============================================================
000400140926
000500140926       //--------------------------------------------------------------
000600140926       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700140926       //--------------------------------------------------------------
000800140926
000900140926     /*END
001000140926
001100140926       //--------------------------------------------------------------
001200140926       //?Specifiche di controllo.                                     ?
001300140926       //--------------------------------------------------------------
001400140926
001500140926     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001600140926     h dftactgrp(*no) actgrp('QILE')
001700140926
001800140926       //--------------------------------------------------------------
001900140926       //?Dichiarazione file.                                          ?
002000140926       //--------------------------------------------------------------
002100140926
002200140926       // -?Archivio R.A.?
002300140926     fFITGD01L  if   e           k disk
002400140926
002500140926       // -?Video?
002600140926     fFIDNA7TSTDcf   e             workstn
002700140926     f                                     indds(IndDspF)
002800140926     f                                     infds(InfDspF)
002900140926
003000140926       //--------------------------------------------------------------
003100140926       //?Definizione costanti.                                        ?
003200140926       //--------------------------------------------------------------
003300140926
003400140926       // -?Tasti funzionali a video?
003500140926     d c_F01           c                   const(x'31')
003600140926     d c_F02           c                   const(x'32')
003700140926     d c_F03           c                   const(x'33')
003800140926     d c_F04           c                   const(x'34')
003900140926     d c_F05           c                   const(x'35')
004000140926     d c_F06           c                   const(x'36')
004100140926     d c_F07           c                   const(x'37')
004200140926     d c_F08           c                   const(x'38')
004300140926     d c_F09           c                   const(x'39')
004400140926     d c_F10           c                   const(x'3A')
004500140926     d c_F11           c                   const(x'3B')
004600140926     d c_F12           c                   const(x'3C')
004700140926     d c_F13           c                   const(x'B1')
004800140926     d c_F14           c                   const(x'B2')
004900140926     d c_F15           c                   const(x'B3')
005000140926     d c_F16           c                   const(x'B4')
005100140926     d c_F17           c                   const(x'B5')
005200140926     d c_F18           c                   const(x'B6')
005300140926     d c_F19           c                   const(x'B7')
005400140926     d c_F20           c                   const(x'B8')
005500140926     d c_F21           c                   const(x'B9')
005600140926     d c_F22           c                   const(x'BA')
005700140926     d c_F23           c                   const(x'BB')
005800140926     d c_F24           c                   const(x'BC')
005900140926     d c_Enter         c                   const(x'F1')
006000140926     d c_RollDown      c                   const(x'F4')
006100140926     d c_RollUp        c                   const(x'F5')
006200140926
006300140926       //--------------------------------------------------------------
006400140926       //?Definizione schiere.                                         ?
006500140926       //--------------------------------------------------------------
006600140926
006700140926       // -?Messaggi di errore?
006800140926     d sk_Msg          s             78    dim( 2) ctdata perrcd(1)
006900140926
007000140926       //--------------------------------------------------------------
007100140926       //?Definizione aree dati.                                       ?
007200140926       //--------------------------------------------------------------
007300140926
007400140926       // -?Dati utente?
007500140926     d §AzUte        e ds                  extname(AZUTE00F)
007600140926     d                                     dtaara
007700140926     d §DatiUte      e ds                  extname(dDatiUte)
007800140926     d                                     dtaara
007900140926
008000140926       //--------------------------------------------------------------
008100140926       //?Definizione strutture dati.                                  ?
008200140926       //--------------------------------------------------------------
008300140926
008400140926       // -?Status ds?
008500140926     d Status         sds
008600140926     d   SDSpgm          *proc
008700140926     d   SDSprm          *parms
008800140926     d   SDSusr              254    263
008900140926
009000140926       // -?InfDS?
009100140926     d InfDspF         ds
009200140926     d   dsp_aid             369    369a
009300140926
009400140926       // -?Indicatori su DspF?
009500140926     d IndDspF         ds
009600140926         // -?(Dis)Abilitazione tasti funzionali?
009700140926     d   AbilitF04                     n   overlay(IndDspF : 04)
009800140926     d   AbilitF06                     n   overlay(IndDspF : 06)
009900140926     d   AbilitF12                     n   overlay(IndDspF : 12)
010000140926         // -?Indicatori di errore?
010100140926     d   ErrMessage                    n   overlay(IndDspF : 28)
010200140926     d   PosCurANT                     n   overlay(IndDspF : 50)
010300140926     d   ErrGenerico                   n   overlay(IndDspF : 99)
010400140926
010500140926       // -?Parametri ricevuti?
010600140926     d KPJBA         e ds
010700140926
010800140926       //--------------------------------------------------------------
010900140926       //?Definizione variabili globali.                               ?
011000140926       //--------------------------------------------------------------
011100140926
011200140926       // -?Flags booleani?
011300140926     d $Fine           s               n   inz(*off)
011400140926     d $InzD01         s               n   inz(*on)
011500140926
011600140926       //--------------------------------------------------------------
011700140926       //?Definizione procedure usate.                                 ?
011800140926       //--------------------------------------------------------------
011900140926
012000140926       // -?Reperimento dati utente?
012100140926     d TIBS34ds      e ds
012200140926      /copy gaitrasrc/srcProtoPR,TIBS34R
012300140926
012400140926       // -?Interrogazione R.A.?
012500140926     d*// FIDNA2ds      e ds                  inz
012600140926     d*//   iA2mod      e                     inz('I')
012700140926     d*//   iA2tor      e                     inz('S')
012800140926     d fidnA2r         pr                  extpgm('FIDNA2R')
012900140926     d   kpjba                             likeds(KPJBA)
013000140926     d*//fidnA2ds                          likeds(FIDNA2ds)
013100140926
013200140926       // -?Driver chiusura R.A. disposizioni da internet?
013300140926     d FIDNA7ds      e ds                  inz
013400140926     d   iDNA7no1                          overlay( iDNA7not :   1 )
013500140926     d   iDNA7no2                          overlay( iDNA7not :  36 )
013600140926     d   iDNA7no3                          overlay( iDNA7not :  71 )
013700140926     d   iDNA7no4                          overlay( iDNA7not : 106 )
013800141003     d   iDNA7no5                          overlay( iDNA7not : 141 )
013900141003     d   iDNA7no6                          overlay( iDNA7not : 176 )
014000141003     d   iDNA7no7                          overlay( iDNA7not : 211 )
014100141003     d   iDNA7no8                          overlay( iDNA7not : 246 )
014200140926     d fidnA7r         pr                  extpgm('FIDNA7R')
014300140926     d   fidnA7ds                          likeds(FIDNA7ds)
014400140926
014500140926       //--------------------------------------------------------------
014600140926       //?Definizione key-list.                                        ?
014700140926       //--------------------------------------------------------------
014800140926
014900140926       // -?File FITGD01L?
015000140926     d keyFITGD01    e ds                  extname(FITGD01L:*key)
015100140926     d                                     prefix(k_)
015200140926     d                                     inz
015300140926
015400140926       //--------------------------------------------------------------
015500140926       //?Riepilogo indicatori.                                        ?
015600140926       //--------------------------------------------------------------
015700140926
015800140926     c     *Entry        plist
015900140926     c                   parm                    KPJBA
016000140926
016100140926      /free
016200140926
016300140926       // -?Start?
016400140926       *inLR = *on;
016500140926
016600140926       // -?Elab?
016700140926       dow  Not $Fine;
016800140926         exsr  sr_GesD01;
016900140926       enddo;
017000140926
017100140926       // -?End?
017200140926       return;
017300140926
017400140926       //--------------------------------------------------------------
017500140926       //?Operazioni iniziali                                          ?
017600140926       //--------------------------------------------------------------
017700140926       BEGSR  *InzSR;
017800140926
017900140926         // -?Reperimento dati utente?
018000140926         exsr sr_DatiJob;
018100140926
018200140926         // -?Impostazione nome programma in testata a video?
018300140926         VTDpgm = SDSpgm;
018400140926
018500140926       ENDSR;
018600140926
018700140926       //--------------------------------------------------------------
018800140926       //?Reperimento Dati del job (Utente/Operativi).                 ?
018900140926       //--------------------------------------------------------------
019000140926       BEGSR  sr_DatiJob;
019100140926
019200140926         in(E) §AzUte;
019300140926         if NOT %error;
019400140926           in(E) §DatiUte;
019500140926         endif;
019600140926         if %error or RSut = *blanks;
019700140926           clear TIBS34ds;
019800140926           tibs34r(tibs34ds);
019900140926           in §AzUte;
020000140926           in §DatiUte;
020100140926         endif;
020200140926
020300140926       ENDSR;
020400140926
020500140926       //--------------------------------------------------------------
020600140926       //?Gestione videata D01                                         ?
020700140926       //--------------------------------------------------------------
020800140926       BEGSR  sr_GesD01;
020900140926
021000140926         // -?Inizializzazione videata?
021100140926         if  $InzD01 = *on;
021200140926           clear  DNA7D01;
021300140926           $InzD01 = *off;
021400140926         endif;
021500140926
021600140926         AbilitF04 = *on;
021700140926         AbilitF06 = *on;
021800140926         AbilitF12 = *off;
021900140926
022000140926         // -?Emissione videata?
022100140926         if  ErrMessage = *off;
022200140926           write  DNA7T01;
022300140926           write  DNA7Z01;
022400140926         endif;
022500140926
022600140926         exfmt  DNA7D01;
022700140926
022800140926         reset  ErrMessage;
022900140926         reset  ErrGenerico;
023000140926         clear  V1Dmsg;
023100140926
023200140926         SELECT;
023300140926
023400140926           // -?F3=Fine?
023500140926           WHEN  dsp_aid = c_F03;
023600140926             $Fine = *on;
023700140926
023800140926           // -?F4=Interrogazione R.A.?
023900140926           WHEN  dsp_aid = c_F04;
024000140926             exsr  sr_CallFIDNA2R;
024100140926
024200140926           // -?F12=Ritorno?
024300140926           WHEN  dsp_aid = c_F12;
024400140926             $Fine = *on;
024500140926
024600140926           // -?Invio o F6=Conferma?
024700140926           OTHER;
024800140926             exsr  sr_CtrD01;
024900140926             select;
025000140926               // -?rilevato errore?
025100140926               when  ErrGenerico = *on;
025200140926               // -?non premuto F6?
025300140926               when  dsp_aid <> c_F06;
025400140926               // -?selezionata una singola R.A.?
025500140926               other;
025600140926                 exsr  sr_CallFIDNA7R;
025700140926                 //reset  $InzD01;
025800140926             endsl;
025900140926
026000140926         ENDSL;
026100140926
026200140926       ENDSR;
026300140926
026400140926       //--------------------------------------------------------------
026500140926       //?Richiamo pgm. Interrogazione R.A.                            ?
026600140926       //--------------------------------------------------------------
026700140926       BEGSR  sr_CallFIDNA2R;
026800140926
026900140926         //reset  FIDNA2ds;
027000140926         ////IA2ogg = ?????;
027100140926         //fidnA2r ( kpjba : FIDNA2ds );
027200140926
027300140926         fidnA2r ( kpjba );
027400140926
027500140926         //if  oA2f03 <> *blank;
027600140926         //  leavesr;
027700140926         //endif;
027800140926
027900140926       ENDSR;
028000140926
028100140926       //--------------------------------------------------------------
028200140926       //?Richiamo driver Chiusura RA disposizioni da internet         ?
028300140926       //--------------------------------------------------------------
028400140926       BEGSR  sr_CallFIDNA7R;
028500140926
028600140926         fidnA7r ( FIDNA7ds );
028700140926
028800140926         AbilitF04 = *off;
028900140926         AbilitF06 = *off;
029000140926         AbilitF12 = *on;
029100140926
029200140926         write  Protect;
029300140926         write  DNA7Z01;
029400140926         exfmt  DNA7D02;
029500140926
029600140926         // -?F3=Fine?
029700140926         if  dsp_aid = c_F03;
029800140926           $Fine = *on;
029900140926           leavesr;
030000140926         endif;
030100140926
030200140926       ENDSR;
030300140926
030400140926       //--------------------------------------------------------------
030500140926       //?Controllo dati in videata D01                                ?
030600140926       //--------------------------------------------------------------
030700140926       BEGSR  sr_CtrD01;
030800140926
030900140926         %subst( IndDspF : 50 ) = *off;
031000140926
031100140926         SELECT;
031200140926
031300140926           // -?Nessun O.R.M. inserito?
031400140926           WHEN  iDNA7ant = *zero   or
031500140926                 iDNA7nut = *zero   or
031600140926                 iDNA7pdt = *zero;
031700140929             //ErrMessage  = *on;
031800140929             //ErrGenerico = *on;
031900140929             //PosCurANT   = *on;
032000140929             //V1Dmsg = sk_Msg(01);
032100140929             //leavesr;
032200140926
032300140926           // -?Selezionato un singolo O.R.M.?
032400140926           WHEN  iDNA7ant <> *zero   or
032500140926                 iDNA7nut <> *zero   or
032600140926                 iDNA7pdt <> *zero;
032700140929             //k_TGDant = iDNA7ant;
032800140929             //k_TGDnut = iDNA7nut;
032900140929             //k_TGDpdt = iDNA7pdt;
033000140929             //setll  %kds(keyFITGD01)  FITGD000;
033100140929             //if  not %equal(FITGD01L);
033200140929             //  ErrMessage  = *on;
033300140929             //  ErrGenerico = *on;
033400140929             //  PosCurANT   = *on;
033500140929             //  V1Dmsg = sk_Msg(02);
033600140929             //  leavesr;
033700140929             //endif;
033800140926
033900140926         ENDSL;
034000140926
034100140926       ENDSR;
034200140926
034300140926      /end-free
034400140926
034500140926       //--------------------------------------------------------------
034600140926       //?Schiere a tempo di compilazione.                             ?
034700140926       //--------------------------------------------------------------
034800140926
034900140926** -?sk_Msg:?Messaggi di Errore?---------------------------------------------*
035000140926Nessuna R.A. inserita
035100140926R.A. inesistente
