000100131007       //==============================================================
000200131007       //
000300140318       //?FIOR01R - Recupera ora presunta ritiro da PDA
000400131007       //
000500131007       //==============================================================
000600131009
000700131009       //--------------------------------------------------------------
000800131009       //?Specifiche di controllo.                                     ?
000900131009       //--------------------------------------------------------------
001000140318     h DECEDIT('0,') DATEDIT(*YMD.) option(*nodebugio)
001100131009
001200131009       //--------------------------------------------------------------
001300131009       //?Dichiarazione file.                                          ?
001400131009       //--------------------------------------------------------------
001500140318
001600140318       // -?File distinte
001700140318     fFIDST01L  if   e           k disk
001800131010
001900140318       // -?File ritorno dati da PDA
002000140318     fFIPRO11L  if   e           k disk
002100131008
002200131007       //--------------------------------------------------------------
002300131007       //?Definizione costanti.                                        ?
002400131007       //--------------------------------------------------------------
002500131008
002600131007       //--------------------------------------------------------------
002700131007       //?Definizione strutture dati.                                  ?
002800131007       //--------------------------------------------------------------
002900140318       // -?Parametri
003000140318     d FIOR01DS      e ds                  QUALIFIED
003100140318
003200140318       // -?Ds per campo dati FIPRO10F
003300140318     d FIPRORORDS    e ds
003400131009
003500131009       //--------------------------------------------------------------
003600131009       //?Definizione schiere.
003700131009       //--------------------------------------------------------------
003800131007
003900131007       //--------------------------------------------------------------
004000131007       //?Definizione campi.
004100131007       //--------------------------------------------------------------
004200131008
004300131008       //--------------------------------------------------------------
004400131008       //?Definizione procedure.
004500131008       //--------------------------------------------------------------
004600131008
004700131008       //--------------------------------------------------------------
004800131008       //?Definizione prototipi.
004900131008       //--------------------------------------------------------------
005000140318
005100140318       //---------------------------------------------------------------
005200140318       //?Definizione key-list.
005300140318       //---------------------------------------------------------------
005400140318       // -?File FIDST01L
005500140318     d k03fidst      e ds                  extname(FIDST01L:*key)
005600140318     d                                     prefix(k_)
005700140318     d                                     inz
005800140318
005900140318       // -?File FIPRO11L
006000140318     d k08fipro      e ds                  extname(FIPRO11L:*key)
006100140318     d                                     prefix(k_)
006200140318     d                                     inz
006300131007
006400131007       //--------------------------------------------------------------
006500131007       //?MAIN.
006600131007       //--------------------------------------------------------------
006700140318     c     *entry        plist
006800140318     c                   parm                    FIOR01DS
006900131008
007000131007      /free
007100131008
007200131008       //?Operazioni iniziali
007300131008       exsr RoutInz;
007400140318
007500140318       //?Controllo i dati passati
007600140318       exsr Controlla;
007700131008
007800140318       //?Elabora
007900140318       exsr Elabora;
008000131010
008100131010       //?Operazioni finali
008200131010       exsr RoutEnd;
008300131008
008400131008       //--------------------------------------------------------------
008500131008       //?Operazioni iniziali.                                         ?
008600131008       //--------------------------------------------------------------
008700131008       BEGSR  RoutInz;
008800131009
008900140318       //?Pulisco dati di output
009000140318         clear fior01ds.OOR01ora;
009100140318         fior01ds.OOR01err = '0';
009200140318         clear fior01ds.OOR01msg;
009300140318
009400131008         *inLR = *on;
009500131008
009600131008       ENDSR;
009700140318
009800140318       //--------------------------------------------------------------
009900140318       //?Controlla i dati passati.                                    ?
010000140318       //--------------------------------------------------------------
010100140318       BEGSR  Controlla;
010200140318
010300140318         IF  fior01ds.IOR01fgs = 0 or fior01ds.IOR01ndc = 0;
010400140318           fior01ds.OOR01err = '1';
010500140318           fior01ds.OOR01msg = 'Passare la distinta';
010600140318           exsr RoutEnd;
010700140318         ENDIF;
010800140318
010900140318         IF  fior01ds.IOR01poe = 0 or fior01ds.IOR01nor = 0;
011000140318           fior01ds.OOR01err = '1';
011100140318           fior01ds.OOR01msg = 'Passare la chiave ORM';
011200140318           exsr RoutEnd;
011300140318         ENDIF;
011400140318
011500140318       ENDSR;
011600131007
011700131007       //--------------------------------------------------------------
011800140318       //?Elabora.
011900131007       //--------------------------------------------------------------
012000140318       BEGSR  Elabora;
012100140318
012200140318       //?Come prima cosa recupero il codice AUT
012300140318         k_DSTnpg = 4;
012400140318         k_DSTnfv = fior01ds.IOR01ndc;
012500140318         k_DSTfgs = fior01ds.IOR01fgs;
012600140318         chain %kds(k03fidst) FIDST01L;
012700140318         IF  not %found(FIDST01L);
012800140318           fior01ds.OOR01err = '1';
012900140318           fior01ds.OOR01msg = 'Distinta errata';
013000140318           exsr RoutEnd;
013100140318         ENDIF;
013200140318
013300140318       //?Recupero l'ora presunta del ritiro impostata sul PDA
013400140318         clear fiprorords;
013500140318         k_PROfgs = fior01ds.IOR01fgs;
013600140318         k_PROndc = fior01ds.IOR01ndc;
013700140318         k_PROtrd = 'ROR';
013800140318         k_PROcodaut = DSTpdr;
013900140318         k_PROpoe = fior01ds.IOR01poe;
014000140318         k_PROnsr = fior01ds.IOR01nsr;
014100140318         k_PROnor = fior01ds.IOR01nor;
014200140318         k_PROnrv = fior01ds.IOR01nrv;
014300140318         chain %kds(k08fipro) FIPRO11L;
014400140318         IF  %found(FIPRO11L);
014500140318           fiprorords = PROdati;
014600140318         ENDIF;
014700140318         fior01ds.OOR01ora = §PROorasti;
014800131007
014900131007       ENDSR;
015000131010
015100131010       //--------------------------------------------------------------
015200131010       //?Operazioni finali.
015300131010       //--------------------------------------------------------------
015400131010       BEGSR  RoutEnd;
015500131010
015600131010         return;
015700131010
015800131010       ENDSR;
015900131009
016000131007      /end-free
