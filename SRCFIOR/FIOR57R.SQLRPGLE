000100080714     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000200061227
000300080714      //------------------------------------------------------------------------
000400080714      //         QUADRATURA DATI PER PDA AUT
000500080714      //------------------------------------------------------------------------
000600061227
000700080714      //------------------------------------------------------------------------
000800080714      // RIEPILOGO INDICATORI
000900080714      //------------------------------------------------------------------------
001000071205
001100061227
001200080714      //------------------------------------------------------------------------
001300080714      //  V A R I A B I L I
001400080714      //------------------------------------------------------------------------
001500080714     d $eof            s              1n   inz(*off)
001600140121     d wpoe            s                   like(ORGpoe)
001700140121     d wnsr            s                   like(ORGnsr)
001800140121     d wnor            s                   like(ORGnor)
001900140121     d wnrv            s                   like(ORGnrv)
002000061227
002100080714      //------------------------------------------------------------------------
002200080714      //  S C H I E R E
002300080714      //------------------------------------------------------------------------
002400061227
002500080714      //------------------------------------------------------------------------
002600080714      //  D S   I N T E R N E / E S T E R N E
002700080714      //------------------------------------------------------------------------
002800080714     d fipdods       e ds                  extname(fipdo00t)
002900140121     d ficauds       e ds                  extname(ficau00f)
003000070115     d fior56ds      e ds
003100080714     d fior57ds      e ds
003200080714     d fnorgds       e ds                  extname(fnorg00f)
003300061227     d kpjba         e ds
003400140121
003500140121     d nrorm           ds
003600140121     d  caupoe                 1      3  0
003700140121     d  caunsr                 4      5  0
003800140121     d  caunor                 6     12  0
003900140121     d  caunrv                13     14  0
004000080714
004100080714      //------------------------------------------------------------------------
004200080714      //  P R O G R A M M I   R I C H I A M A T I
004300080714      //------------------------------------------------------------------------
004400080714     d fior56r         pr                  extpgm('FIOR56R')
004500080714     d  kpjba                              likeds(kpjba)
004600080714     d  fior56ds                           likeds(fior56ds)
004700061227
004800080714      //------------------------------------------------------------------------
004900080714
005000080714     c     *entry        plist
005100080714     c                   parm                    kpjba
005200080714     c                   parm                    fior57ds
005300080714
005400080714      /free
005500080714
005600080714       exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
005700080714
005800080915       // verifica ritiri presenti su PDO (non annullati) ma non presenti su ORG
005900080714       exsr sr_elabpdo;
006000140121
006100140121       // verifica ritiri presenti sulle telefonate AUT ma non presenti su ORG
006200140121       exsr sr_elabtel;
006300061227
006400080714       *inlr = *on;
006500080714
006600080714       //--------------------------------------------------------------
006700080714       //?Elabora FIPDO
006800080714       //--------------------------------------------------------------
006900080714       begsr sr_elabpdo;
007000080714
007100080714         reset $eof;
007200140121
007300140121         exec sql
007400140121          declare pdo cursor for select fipdo00t.*
007500140121          from fipdo00t
007600140121          where pdondc = :or57ndc and pdofgs =:or57fgs
007700140121          and pdoatb = ''
007800140121          order by pdopoe, pdonsr, pdonor, pdonrv;
007900140121
008000140121         exec sql open pdo;
008100080714
008200140121          dou $eof;
008300140121            exsr readPDO;
008400140121          enddo;
008500080714
008600140121         exec sql close pdo;
008700080714
008800080714       endsr;
008900080714
009000080714       //--------------------------------------------------------------
009100080714       //?Lettura cursore PDO
009200080714       //--------------------------------------------------------------
009300140121       begsr readPDO;
009400080714
009500080714         exec sql fetch next from pdo into :fipdods;
009600080714
009700080714         select;
009800080714          when sqlcode = 100;
009900080714           $eof = *on;
010000080714          when sqlcode < 0;
010100080714           $eof = *on;
010200080714x   1     other;
010300140121            wpoe = PDOpoe;
010400140121            wnsr = PDOnsr;
010500140121            wnor = PDOnor;
010600140121            wnrv = PDOnrv;
010700140121            exsr sr_elaboraorm;
010800080714         endsl;
010900080714
011000080714       endsr;
011100080714
011200080714       //--------------------------------------------------------------
011300080714       //?Elaborazione singolo record
011400080714       //--------------------------------------------------------------
011500140121       begsr sr_elaboraorm;
011600080714
011700080714        exec sql select fnorg00f.* into :fnorgds from fnorg00f
011800140121             where orgfgs = :OR57fgs and orgndc = :OR57ndc and
011900140121             orgpoe = :wpoe and orgnsr = :wnsr and orgnor = :wnor
012000140605             and orgnrv = :wnrv;
012100080714
012200080714        if sqlcod <> 0 ;
012300080714         clear fior56ds;
012400080714         or56tla = 'A';
012500140121         or56fgs = OR57fgs;
012600140121         or56ndcd = OR57ndc;
012700140121         or56ndca = OR57ndc;
012800140121         or56poe = wpoe;
012900140121         or56nsr = wnsr;
013000140121         or56nor = wnor;
013100140121         or56nrv = wnrv;
013200140121         OR56cmd = 'A';
013300080714         fior56r(kpjba:fior56ds);
013400080714        endif;
013500080714
013600080714       endsr;
013700140121
013800140121       //--------------------------------------------------------------
013900140121       //?Elabora Telefonate
014000140121       //--------------------------------------------------------------
014100140121       begsr sr_elabtel;
014200140121
014300140121         reset $eof;
014400140121
014500140121         exec sql
014600140121          declare CAU cursor for select ficau00f.*
014700140121          from ficau00f
014800140121          where CAUnfv = :or57ndc and CAUfgs =:or57fgs
014900140121          and CAUtor = 'R'
015000140121          order by CAUogg;
015100140121
015200140121         exec sql open CAU;
015300140121
015400140121          dou $eof;
015500140121            exsr readCAU;
015600140121          enddo;
015700140121
015800140121         exec sql close CAU;
015900140121
016000140121       endsr;
016100140121
016200140121       //--------------------------------------------------------------
016300140121       //?Lettura cursore CAU
016400140121       //--------------------------------------------------------------
016500140121       begsr readCAU;
016600140121
016700140121         exec sql fetch next from CAU into :ficauds;
016800140121
016900140121         select;
017000140121           when sqlcode = 100;
017100140121             $eof = *on;
017200140121          when sqlcode < 0;
017300140121            $eof = *on;
017400140121x   1     other;
017500140121            nrorm = CAUogg;
017600140121            wpoe = CAUpoe;
017700140121            wnsr = CAUnsr;
017800140121            wnor = CAUnor;
017900140121            wnrv = CAUnrv;
018000140121            exsr sr_elaboraorm;
018100140121         endsl;
018200140121
018300140121       endsr;
018400080714
