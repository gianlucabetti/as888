000100140306       //--------------------------------------------------------------
000200140306       //?Specifiche di controllo.                                     ?
000300140306       //--------------------------------------------------------------
000400140314     h DFTACTGRP(*NO) ACTGRP(*CALLER)
000500140306
000600140306       //--------------------------------------------------------------
000700140306       //?Dichiarazione file.                                          ?
000800140306       //--------------------------------------------------------------
000900140710       // -?Video?
001000160211     fFIORC0TSTDcf   e             workstn
001100160216     f                                     sfile(ORC0S3:S03nrr)
001200140710     f                                     indds(IndDspF)
001300140710     f                                     infds(InfDspF)
001400140306
001500140306       //--------------------------------------------------------------
001600140306       //?Definizione costanti.                                        ?
001700140306       //--------------------------------------------------------------
001800160211      /copy gaitrasrc/srcconst,FIORC00R
001900140710
002000140710       // -?Tasti funzionali a video?
002100140710     d c_F01           c                   const(x'31')
002200140710     d c_F02           c                   const(x'32')
002300140710     d c_F03           c                   const(x'33')
002400140710     d c_F04           c                   const(x'34')
002500140710     d c_F05           c                   const(x'35')
002600140710     d c_F06           c                   const(x'36')
002700140710     d c_F07           c                   const(x'37')
002800140710     d c_F08           c                   const(x'38')
002900140710     d c_F09           c                   const(x'39')
003000140710     d c_F10           c                   const(x'3A')
003100140710     d c_F11           c                   const(x'3B')
003200140710     d c_F12           c                   const(x'3C')
003300140710     d c_F13           c                   const(x'B1')
003400140710     d c_F14           c                   const(x'B2')
003500140710     d c_F15           c                   const(x'B3')
003600140710     d c_F16           c                   const(x'B4')
003700140710     d c_F17           c                   const(x'B5')
003800140710     d c_F18           c                   const(x'B6')
003900140710     d c_F19           c                   const(x'B7')
004000140710     d c_F20           c                   const(x'B8')
004100140710     d c_F21           c                   const(x'B9')
004200140710     d c_F22           c                   const(x'BA')
004300140710     d c_F23           c                   const(x'BB')
004400140710     d c_F24           c                   const(x'BC')
004500140710     d c_Enter         c                   const(x'F1')
004600140710     d c_RollDown      c                   const(x'F4')
004700140710     d c_RollUp        c                   const(x'F5')
004800140306
004900140306       //--------------------------------------------------------------
005000140306       //?Definizione strutture dati.                                  ?
005100140306       //--------------------------------------------------------------
005200140710       // -?InfDS?
005300140710     d InfDspF         ds
005400140710     d  dsp_aid              369    369a
005500140710
005600140710       // -?Indicatori su DspF?
005700140710     d IndDspF         ds
005800160216     d  SflDsp                        1n   overlay(IndDspF : 30)
005900160216     d  SflDspCtl                     1n   overlay(IndDspF : 31)
006000160216     d  SflEnd                        1n   overlay(IndDspF : 32)
006100140710
006200140306       // -?Dati INPUT
006300160211     d FIORC0I0      e ds                  QUALIFIED INZ(*EXTDFT)
006400160216     d  idLingua     e                     INZ(FIORC00_ID_LINGUA_IT)
006500140306
006600140306       // -?Dati OUTPUT
006700160211     d FIORC0O0      e ds                  QUALIFIED INZ(*EXTDFT)
006800160216
006900160216       // -?Messaggi
007000160216     d FIORC0M0      e ds                  QUALIFIED INZ(*EXTDFT)
007100160216     d  skIdMsg                       7a   dim(99) overlay(IdMsg)
007200160216     d  skIdCampo                    10a   dim(99) overlay(IdCampo)
007300160216     d  skErrWarn                     1a   dim(99) overlay(ErrWarn)
007400160216     d  skTextMsg                   255a   dim(99) overlay(TextMsg)
007500140306
007600140306       //--------------------------------------------------------------
007700140306       //?Definizione schiere.
007800140306       //--------------------------------------------------------------
007900140306
008000140306       //--------------------------------------------------------------
008100140306       //?Definizione campi.
008200140306       //--------------------------------------------------------------
008300140710
008400140710       // -?Flags booleani?
008500160216     d EndS03          s               n   inz(*off)
008600151009     d Fine            s               n   inz(*off)
008700151009     d wInzD02         s               n   inz(*on)
008800160216     d wInzS03         s               n   inz(*on)
008900140710
009000140710       // -?Campi associati al video
009100151009     d Video           s              2a   inz
009200160216     d S03nrr          s              4  0 inz
009300140710
009400140710       // -?Comodo x campi dati
009500140710     d wData           s              8  0
009600160216
009700160216       // -?Indici di schiera
009800160216     d xx              s              4  0 inz
009900140306
010000140306       //--------------------------------------------------------------
010100140306       //?Definizione procedure.
010200140306       //--------------------------------------------------------------
010300140306
010400140306       //--------------------------------------------------------------
010500140306       //?Definizione prototipi.
010600140306       //--------------------------------------------------------------
010700160211      /copy gaitrasrc/srcprotopr,FIORC00R
010800140306
010900140306       //--------------------------------------------------------------
011000140306       //?Definizione parametri programma.
011100140306       //--------------------------------------------------------------
011200140314     d prmRqsOpCode...
011300140314     d                 s             10I 0
011400140314     d prmRpyOpCode...
011500140314     d                 s             10I 0
011600140314     d prmRpyIdMsg...
011700140314     d                 s             10I 0
011800140314     d prmRqsFormato...
011900140314     d                 s             10A
012000140314     d prmRqsData...
012100140314     d                 s          32767A   varying
012200160216     d prmRqsSize...
012300140314     d                 s             10I 0
012400140314     d prmRpyFormato...
012500140314     d                 s             10A
012600140314     d prmRpyData...
012700140314     d                 s          32767A   varying
012800160216     d prmRpySize...
012900140314     d                 s             10I 0
013000160216     d prmRpyMsgFormato...
013100160216     d                 s             10A
013200160216     d prmRpyMsgData...
013300160216     d                 s          32767A   varying
013400160216     d prmRpyMsgSize...
013500160216     d                 s             10I 0
013600140306
013700140306       //--------------------------------------------------------------
013800140306       //?MAIN.
013900140306       //--------------------------------------------------------------
014000140306
014100140306      /free
014200140306
014300140306       //?Operazioni iniziali
014400140306       exsr RoutInz;
014500140307
014600151009       //?Gestione Video
014700151009       DOW  Fine = *off;
014800151009         SELECT;
014900151009         WHEN  Video = 'D2';
015000151009           exsr GesD02;
015100160216         WHEN  Video = 'S3';
015200160216           exsr GesS03;
015300151009         OTHER;
015400151009           Fine = *on;
015500151009         ENDSL;
015600151009       ENDDO;
015700060612
015800140306       //?Operazioni finali
015900140306       exsr RoutEnd;
016000140306
016100140306       //--------------------------------------------------------------
016200140306       //?Operazioni iniziali.                                         ?
016300140306       //--------------------------------------------------------------
016400140306       BEGSR  RoutInz;
016500140306
016600160211         prmRqsOpCode = FIORC00_RQSOPCODE_GET;
016700160211         prmRqsFormato = FIORC0I0.formato;
016800160216         prmRqsSize = %size(FIORC0I0);
016900160211         prmRpyFormato = FIORC0O0.formato;
017000160216         prmRpySize = %size(FIORC0O0);
017100160216         prmRpyMsgFormato  = FIORC0M0.formato;
017200160216         prmRpyMsgSize = %size(FIORC0M0);
017300151009
017400151009         Video = 'D2';
017500151009         wInzD02 = *on;
017600140306
017700140306       ENDSR;
017800151009
017900151009       //--------------------------------------------------------------
018000151009       //?Gestione videata D02.
018100151009       //--------------------------------------------------------------
018200151009       BEGSR GesD02;
018300151009
018400151009       //?Inizializzazione videata
018500151009         IF  wInzD02;
018600151009           exsr InzD02;
018700151009           wInzD02 = *off;
018800151009         ENDIF;
018900151009
019000151009       //?Emissione Testata
019100160211         write  ORC0T1;
019200151009
019300151009       //?Emissione videata
019400160211         exfmt  ORC0D2;
019500151009
019600151009         SELECT;
019700151009
019800151009       //?- F03=Fine
019900151009         WHEN  dsp_aid = c_F03;
020000151009           exsr F03D02;
020100160211
020200160211       //?- F06=Conferma
020300160211         WHEN  dsp_aid = c_F06;
020400160211           exsr F06D02;
020500151009
020600151009         ENDSL;
020700151009
020800151009       ENDSR;
020900151009
021000151009       //--------------------------------------------------------------
021100151009       //?Inizializzazione Videata D02.
021200151009       //--------------------------------------------------------------
021300151009       BEGSR InzD02;
021400151009
021500160211         iopcode = FIORC00_RQSOPCODE_GET;
021600160211         iformato = FIORC0I0.formato;
021700160211         iversione = FIORC0I0.versione;
021800160216         ilingua = FIORC0I0.idlingua;
021900140307
022000151009       ENDSR;
022100151009
022200151009       //--------------------------------------------------------------
022300151009       //?Gestione tasto funzionale F03 da videata D02
022400151009       //?F03=Fine
022500151009       //--------------------------------------------------------------
022600151009       BEGSR F03D02;
022700151009
022800151009       //?Chiusura del programma
022900151009         Fine = *on;
023000151009
023100151009       ENDSR;
023200151009
023300151009       //--------------------------------------------------------------
023400151009       //?Gestione tasto funzionale F06 da videata D02
023500151009       //?F06=Conferma
023600151009       //--------------------------------------------------------------
023700151009       BEGSR F06D02;
023800151009
023900151009       //?Imposto i dati
024000160211         IF  npr = *blanks;
024100160211           leavesr;
024200151020         ENDIF;
024300160211
024400160219         FIORC0I0.unificante = unificante;
024500160211         FIORC0I0.npr = npr;
024600151009
024700160211       //?Richiamo FIORC00R
024800160211         FIORC00_GetOrm (prmRqsOpCode:prmRpyOpCode:prmRpyIdMsg:
024900160216                         prmRqsFormato:FIORC0I0:prmRqsSize:
025000160216                         prmRpyFormato:FIORC0O0:prmRpySize:
025100160216                         prmRpyMsgFormato:FIORC0M0:prmRpyMsgSize);
025200160216
025300160216       //?Videata sucessiva
025400160216         Video = 'S3';
025500160216         wInzS03 = *on;
025600160216
025700160216       ENDSR;
025800160216
025900160216       //--------------------------------------------------------------
026000160216       //?Gestione videata S03.
026100160216       //--------------------------------------------------------------
026200160216       BEGSR GesS03;
026300160216
026400160216       //?Inizializzazione videata
026500160216         IF  wInzS03;
026600160216           exsr InzS03;
026700160216           wInzS03 = *off;
026800160216         ENDIF;
026900160216
027000160216       //?Visualizzazione del SFL (se ci sono dati)
027100160216         SflDsp = (S03nrr <= *zeros);
027200160216
027300160216       //?Emissione Testata e Piede con tasti funzionali abilitati
027400160216         write  ORC0T1;
027500160216         write  ORC0P3;
027600160216
027700160216       //?Emissione videata
027800160216         exfmt  ORC0C3;
027900160216
028000160216         SELECT;
028100160216
028200160216       //?- F03=Fine
028300160216         WHEN  dsp_aid = c_F03;
028400160216           exsr F03D02;
028500160216
028600160216       //?- F12=Ritorno
028700160216         WHEN  dsp_aid = c_F12;
028800160216           exsr F12S03;
028900160216
029000160216         ENDSL;
029100160216
029200160216       ENDSR;
029300160216
029400160216       //--------------------------------------------------------------
029500160216       //?Inizializzazione videata S03.
029600160216       //--------------------------------------------------------------
029700160216       BEGSR InzS03;
029800160216
029900160216         EndS03 = *off;
030000160216
030100160216       //?Pulizia subfile
030200160216         exsr PulS03;
030300160216
030400160216       //?Caricamento subfile
030500160216         exsr Ries03;
030600160216
030700160216         SflEnd = *on;
030800160216
030900160216       ENDSR;
031000160216
031100160216       //--------------------------------------------------------------
031200160216       //?Pulizia Subfile S03.
031300160216       //--------------------------------------------------------------
031400160216       BEGSR PulS03;
031500160216
031600160216       //?Pulizia subfile
031700160216         SflDsp    = *on;
031800160216         SflDspCtl = *on;
031900160216         write ORC0C3;
032000160216         SflDspCtl = *off;
032100160216         SflEnd    = *off;
032200160216
032300160216         clear S03nrr;
032400160216
032500160216       ENDSR;
032600160216
032700160216       //--------------------------------------------------------------
032800160216       //?Caricamento Subfile S03.
032900160216       //--------------------------------------------------------------
033000160216       BEGSR RieS03;
033100160216
033200160216         EndS03 = *off;
033300151009
033400160216         oopcode = prmRpyOpCode;
033500160211         oformato = prmRpyFormato;
033600160211         oversione = FIORC0O0.versione;
033700160216         olingua = FIORC0O0.idlingua;
033800160211         poe = FIORC0O0.poe;
033900160211         nsr = FIORC0O0.nsr;
034000160211         nor = FIORC0O0.nor;
034100160211         nrv = FIORC0O0.nrv;
034200160216
034300160216         nrmsg = FIORC0M0.nrmsg;
034400160216         xx = 1;
034500160216       //?Leggo i messaggi
034600160216         IF  nrmsg > 0;
034700160216           FOR xx by 1 to nrmsg;
034800160216             clear ORC0S3;
034900160216             riga = %trim(FIORC0M0.skIdCampo(xx)) +
035000160216                    %trim(FIORC0M0.skTextMsg(xx));
035100160216             S03nrr += 1;
035200160216             write ORC0S3;
035300160216           ENDFOR;
035400160216         ENDIF;
035500151009
035600151009       ENDSR;
035700160216
035800160216       //--------------------------------------------------------------
035900160216       //?Gestione tasto funzionale F12 da videata S03
036000160216       //?F12=Ritorno
036100160216       //--------------------------------------------------------------
036200160216       BEGSR F12S03;
036300160216
036400160216       //?Videata prima
036500160216         Video = 'D2';
036600160216
036700160216       ENDSR;
036800140306
036900140306       //--------------------------------------------------------------
037000140306       //?Operazioni finali.
037100140306       //--------------------------------------------------------------
037200140306       BEGSR  RoutEnd;
037300140311
037400140314         *inLR = *on;
037500140306
037600140306         return;
037700140306
037800140306       ENDSR;
