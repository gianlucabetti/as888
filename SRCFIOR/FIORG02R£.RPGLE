000100160502      //--------------------------------------------------------------
000200160502      //?FIORG02R - SCAMBIO DATI DA BARTOLINI A TELLUS - SCHEDULATO
000300160502      //--------------------------------------------------------------
000400160502     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500160502     h dftactgrp(*no) actgrp('BARTVAS')
000600160502
000700160502      //---------------------------------------------------------------
000800160502      //?Dichiarazione file.
000900160502      //---------------------------------------------------------------
001000160502      // - Organigramma
001100160502     fAZORG01L  if   e           k disk
001200160502
001300160502      //---------------------------------------------------------------
001400160502      //?Definizione costanti.
001500160502      //---------------------------------------------------------------
001600160502
001700160502      //---------------------------------------------------------------
001800160502      //?Definizione schiere.
001900160502      //---------------------------------------------------------------
002000160502
002100160502      //---------------------------------------------------------------
002200160502      //?Definizione aree dati.
002300160502      //---------------------------------------------------------------
002400160502      // - Dati utente
002500160502     d 你zUte        e ds                  extname(AZUTE00F)
002600160502     d                                     dtaara
002700160502     d 伶atiUte      e ds                  extname(dDatiUte)
002800160502     d                                     dtaara
002900160502
003000160502      //---------------------------------------------------------------
003100160502      //?Definizione strutture dati.
003200160502      //---------------------------------------------------------------
003300160502      // - Parametri ricevuti
003400160502     d KPJBA         e ds
003500160506
003600160506      // - ds passaggio dati a FIORG01R
003700160502     d FIORG01DS     e ds
003800160502
003900160502      // - Reperimento dati utente
004000160502     d TIBS34DS      e ds
004100161018
004200161018      // - Reperimento filiali abilitate alla procedura
004300161018     d TRULVPODS     e ds
004400161018     d  skFil868              16    765    dim(250)
004500160506
004600160506      // - Campo ORGde7 - AZORG00F
004700160506     d OG147         e ds
004800160506
004900160506      // - Campo ORGde8 - AZORG00F
005000160506     d OG148         e ds
005100160502
005200160502      //---------------------------------------------------------------
005300160502      //?Definizione variabili globali.
005400160502      //---------------------------------------------------------------
005500160502      // - Flags booleani
005600160502     d EscludiORM      s               n   inz(*off)
005700160502     d Fine            s               n   inz(*off)
005800160502     d wEnd            s               n   inz(*off)
005900160502
006000160502      // - Campi di comodo
006100160502     d Oggi            s              8s 0 inz
006200160502
006300160502      //---------------------------------------------------------------
006400160502      //?Definizione Procedure usate.
006500160502      //---------------------------------------------------------------
006600160506      // - Sottomissione lavoro batch
006700160506     d bch10           pr                  extpgm('BCH10')
006800160506     d  kpjba                              likeds(KPJBA)
006900161018
007000161018       // - Caricamento Filiali abilitate
007100161018     d TRULVPOR        pr                  extpgm('TRULVPOR')
007200161018     d  trulvpods                          likeds(trulvpods)
007300160502
007400160502      //---------------------------------------------------------------
007500160502      //?Definizione Prototipi.
007600160502      //---------------------------------------------------------------
007700160502      /copy gaitrasrc/srcprotopr,TIBS34R
007800160502
007900160502      //---------------------------------------------------------------
008000160502      //?Definizione key-list.
008100160502      //---------------------------------------------------------------
008200160502
008300160502      //---------------------------------------------------------------
008400160502      //?M A I N - L I N E
008500160502      //---------------------------------------------------------------
008600160502
008700160502     c     *Entry        plist
008800160502     c                   parm                    kpjba
008900160502
009000160502      /free
009100160502
009200160502       //?Operazioni iniziali
009300160502       exsr RoutInz;
009400160502
009500160502       //?Elabora le filiali attive in organigramma
009600160502       setll (001) AZORG01L;
009700160502       read AZORG01L;
009800160502       DOW  not %eof(AZORG01L);
009900160502
010000160506         clear OG147;
010100160506         clear OG148;
010200160502         IF  ORGfva = *blanks and
010300160502            (ORGfag = 'F' or  ORGfag = 'A');
010400160506
010500160506           OG147 = ORGde7;
010600160506           OG148 = ORGde8;
010700160506           IF  別Gcgio = 'S' and 別Gtlls <> *blanks;
010800161018
010900170410             IF  %lookup(%editc(ORGfil:'X'):skFil868) > 0 or
011000170410                 %lookup('999':skFil868) > 0;
011100160502
011200161018               exsr Elabora;
011300161018
011400161018             ENDIF;
011500160506
011600160506           ENDIF;
011700160502
011800160502         ENDIF;
011900160502
012000160502         read AZORG01L;
012100160502
012200160506       ENDDO;
012300160502
012400160502       //?Operazioni finali
012500160502       exsr RoutEnd;
012600160502
012700160502       //--------------------------------------------------------------
012800160502       //?Operazioni iniziali.
012900160502       //--------------------------------------------------------------
013000160502       BEGSR RoutInz;
013100160502
013200160502       //?Reperimento dati job
013300160502         exsr DatiJob;
013400160502
013500160502       //?Imposto oggi
013600160502         Oggi = %dec(%date());
013700161018
013800161018       //?Carico la sk delle filiali attive al Prg. 868 - Tellus ORM
013900161018         clear TRULVPODS;
014000161018         IVPOke1 = 'DECOFI868';
014100161018         trulvpor (trulvpods);
014200160502
014300160502       ENDSR;
014400160502
014500160502       //--------------------------------------------------------------
014600160502       //?Reperimento Dati del job (Utente/Operativi).
014700160502       //--------------------------------------------------------------
014800160502       BEGSR DatiJob;
014900160502
015000160502         in(E) 你zUte;
015100160502         IF  NOT %error;
015200160502           in(E) 伶atiUte;
015300160502         ENDIF;
015400160502         IF  %error or RSut = *blanks;
015500160502           clear TIBS34ds;
015600160502           tibs34r(tibs34ds);
015700160502           in 你zUte;
015800160502           in 伶atiUte;
015900160502         ENDIF;
016000160502
016100160502       ENDSR;
016200160502
016300160502       //--------------------------------------------------------------
016400160502       //?Elabora.
016500160502       //--------------------------------------------------------------
016600160502       BEGSR Elabora;
016700160506
016800160506         clear FIORG01DS;
016900160506         IORG01por  = ORGfil;
017000160506         IORG01data = Oggi;
017100160506         IORG01giro = 'S';
017200160506         kpjbu = FIORG01DS;
017300160506         kcoaz = 'ORG1';
017400160506         clear kbuff;
017500160506         BCH10(kpjba);
017600160506
017700160502       ENDSR;
017800160502
017900160502       //--------------------------------------------------------------
018000160502       //?Operazioni finali.
018100160502       //--------------------------------------------------------------
018200160502       BEGSR RoutEnd;
018300160502
018400160502         *inLR = *on;
018500160502         return;
018600160502
018700160502       ENDSR;
018800160502
018900160502      /end-free
