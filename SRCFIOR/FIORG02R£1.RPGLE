000100160502      //--------------------------------------------------------------
000200160502      //?FIORG02R - SCAMBIO DATI DA BARTOLINI A TELLUS - SCHEDULATO
000300160502      //--------------------------------------------------------------
000400160502     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500160502     h dftactgrp(*no) actgrp('BARTVAS')
000600160502
000700160502      //---------------------------------------------------------------
000800160502      //?Dichiarazione file.
000900160502      //---------------------------------------------------------------
001000160502      // - Organigramma
001100160502     fAZORG01L  if   e           k disk
001200160502
001300160502      //---------------------------------------------------------------
001400160502      //?Definizione costanti.
001500160502      //---------------------------------------------------------------
001600160502
001700160502      //---------------------------------------------------------------
001800160502      //?Definizione schiere.
001900160502      //---------------------------------------------------------------
002000160502
002100160502      //---------------------------------------------------------------
002200160502      //?Definizione aree dati.
002300160502      //---------------------------------------------------------------
002400160502      // - Dati utente
002500160502     d 你zUte        e ds                  extname(AZUTE00F)
002600160502     d                                     dtaara
002700160502     d 伶atiUte      e ds                  extname(dDatiUte)
002800160502     d                                     dtaara
002900160502
003000160502      //---------------------------------------------------------------
003100160502      //?Definizione strutture dati.
003200160502      //---------------------------------------------------------------
003300160502      // - Parametri ricevuti
003400160502     d KPJBA         e ds
003500160506
003600160506      // - ds passaggio dati a FIORG01R
003700160502     d FIORG01DS     e ds
003800160502
003900160502      // - Reperimento dati utente
004000160502     d TIBS34DS      e ds
004100160506
004200160506      // - Campo ORGde7 - AZORG00F
004300160506     d OG147         e ds
004400160506
004500160506      // - Campo ORGde8 - AZORG00F
004600160506     d OG148         e ds
004700160502
004800160502      //---------------------------------------------------------------
004900160502      //?Definizione variabili globali.
005000160502      //---------------------------------------------------------------
005100160502      // - Flags booleani
005200160502     d EscludiORM      s               n   inz(*off)
005300160502     d Fine            s               n   inz(*off)
005400160502     d wEnd            s               n   inz(*off)
005500160502
005600160502      // - Campi di comodo
005700160502     d Oggi            s              8s 0 inz
005800160502
005900160502      //---------------------------------------------------------------
006000160502      //?Definizione Procedure usate.
006100160502      //---------------------------------------------------------------
006200160506      // - Sottomissione lavoro batch
006300160506     d bch10           pr                  extpgm('BCH10')
006400160506     d  kpjba                              likeds(KPJBA)
006500160502
006600160502      //---------------------------------------------------------------
006700160502      //?Definizione Prototipi.
006800160502      //---------------------------------------------------------------
006900160502      /copy gaitrasrc/srcprotopr,TIBS34R
007000160502
007100160502      //---------------------------------------------------------------
007200160502      //?Definizione key-list.
007300160502      //---------------------------------------------------------------
007400160502
007500160502      //---------------------------------------------------------------
007600160502      //?M A I N - L I N E
007700160502      //---------------------------------------------------------------
007800160502
007900160502     c     *Entry        plist
008000160502     c                   parm                    kpjba
008100160502
008200160502      /free
008300160502
008400160502       //?Operazioni iniziali
008500160502       exsr RoutInz;
008600160502
008700160502       //?Elabora le filiali attive in organigramma
008800160502       setll (001) AZORG01L;
008900160502       read AZORG01L;
009000160502       DOW  not %eof(AZORG01L);
009100160502
009200160506         clear OG147;
009300160506         clear OG148;
009400160502         IF  ORGfva = *blanks and
009500160502            (ORGfag = 'F' or  ORGfag = 'A');
009600160506
009700160506           OG147 = ORGde7;
009800160506           OG148 = ORGde8;
009900160506           IF  別Gcgio = 'S' and 別Gtlls <> *blanks;
010000160502
010100160506             exsr Elabora;
010200160506
010300160506           ENDIF;
010400160502
010500160502         ENDIF;
010600160502
010700160502         read AZORG01L;
010800160502
010900160506       ENDDO;
011000160502
011100160502       //?Operazioni finali
011200160502       exsr RoutEnd;
011300160502
011400160502       //--------------------------------------------------------------
011500160502       //?Operazioni iniziali.
011600160502       //--------------------------------------------------------------
011700160502       BEGSR RoutInz;
011800160502
011900160502       //?Reperimento dati job
012000160502         exsr DatiJob;
012100160502
012200160502       //?Imposto oggi
012300160502         Oggi = %dec(%date());
012400160502
012500160502       ENDSR;
012600160502
012700160502       //--------------------------------------------------------------
012800160502       //?Reperimento Dati del job (Utente/Operativi).
012900160502       //--------------------------------------------------------------
013000160502       BEGSR DatiJob;
013100160502
013200160502         in(E) 你zUte;
013300160502         IF  NOT %error;
013400160502           in(E) 伶atiUte;
013500160502         ENDIF;
013600160502         IF  %error or RSut = *blanks;
013700160502           clear TIBS34ds;
013800160502           tibs34r(tibs34ds);
013900160502           in 你zUte;
014000160502           in 伶atiUte;
014100160502         ENDIF;
014200160502
014300160502       ENDSR;
014400160502
014500160502       //--------------------------------------------------------------
014600160502       //?Elabora.
014700160502       //--------------------------------------------------------------
014800160502       BEGSR Elabora;
014900160506
015000160506         clear FIORG01DS;
015100160506         IORG01por  = ORGfil;
015200160506         IORG01data = Oggi;
015300160506         IORG01giro = 'S';
015400160506         kpjbu = FIORG01DS;
015500160506         kcoaz = 'ORG1';
015600160506         clear kbuff;
015700160506         BCH10(kpjba);
015800160506
015900160502       ENDSR;
016000160502
016100160502       //--------------------------------------------------------------
016200160502       //?Operazioni finali.
016300160502       //--------------------------------------------------------------
016400160502       BEGSR RoutEnd;
016500160502
016600160502         *inLR = *on;
016700160502         return;
016800160502
016900160502       ENDSR;
017000160502
017100160502      /end-free
