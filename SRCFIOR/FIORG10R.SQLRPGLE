000100160617      //---------------------------------------------------------------
000200160617      //?FIORG10R - SCAMBIO DATI DA BARTOLINI A TELLUS
000300160617      //---------------------------------------------------------------
000400160617     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500160617
000600160617      //---------------------------------------------------------------
000700160617      //?Dichiarazione file.
000800160617      //---------------------------------------------------------------
000900160617      // -?Organigramma?
001000160617     fAZORG01L  if   e           k disk
001100160617
001200160617      // -?File video
001300160617     fFIORG10D  cf   e             workstn
001400160617     f                                     indds(IndDspF)
001500160617     f                                     infds(InfDspF)
001600160617
001700160617      //---------------------------------------------------------------
001800160617      //?Definizione costanti.                                        ?
001900160617      //---------------------------------------------------------------
002000160617      // -?Tasti funzionali a video
002100160617     d c_F01           c                   const(x'31')
002200160617     d c_F02           c                   const(x'32')
002300160617     d c_F03           c                   const(x'33')
002400160617     d c_F04           c                   const(x'34')
002500160617     d c_F05           c                   const(x'35')
002600160617     d c_F06           c                   const(x'36')
002700160617     d c_F07           c                   const(x'37')
002800160617     d c_F08           c                   const(x'38')
002900160617     d c_F09           c                   const(x'39')
003000160617     d c_F10           c                   const(x'3A')
003100160617     d c_F11           c                   const(x'3B')
003200160617     d c_F12           c                   const(x'3C')
003300160617     d c_F13           c                   const(x'B1')
003400160617     d c_F14           c                   const(x'B2')
003500160617     d c_F15           c                   const(x'B3')
003600160617     d c_F16           c                   const(x'B4')
003700160617     d c_F17           c                   const(x'B5')
003800160617     d c_F18           c                   const(x'B6')
003900160617     d c_F19           c                   const(x'B7')
004000160617     d c_F20           c                   const(x'B8')
004100160617     d c_F21           c                   const(x'B9')
004200160617     d c_F22           c                   const(x'BA')
004300160617     d c_F23           c                   const(x'BB')
004400160617     d c_F24           c                   const(x'BC')
004500160617     d c_Enter         c                   const(x'F1')
004600160617     d c_RollDown      c                   const(x'F4')
004700160617     d c_RollUp        c                   const(x'F5')
004800160617
004900160617      //---------------------------------------------------------------
005000160617      //?Definizione schiere.                                         ?
005100160617      //---------------------------------------------------------------
005200160617      // -?Messaggi di errore
005300160617     d Msg             s             78    dim(50) ctdata perrcd(1)
005400160617
005500160617      //---------------------------------------------------------------
005600160617      //?Definizione aree dati.                                       ?
005700160617      //---------------------------------------------------------------
005800160617      // -?Dati utente?
005900160617     d §AzUte        e ds                  extname(AZUTE00F)
006000160617     d                                     dtaara
006100160617     d §DatiUte      e ds                  extname(dDatiUte)
006200160617     d                                     dtaara
006300160617
006400160617      //---------------------------------------------------------------
006500160617      //?Definizione strutture dati.                                  ?
006600160617      //---------------------------------------------------------------
006700160617      // -?Status ds?
006800160617     d Status         sds
006900160617     d  SDSpgm           *proc
007000160617     d  SDSusr               254    263
007100160617
007200160617      // -?InfDS
007300160617     d InfDspF         ds
007400160617     d  dsp_aid              369    369a
007500160617     d  sfl_rrn              376    377i 0
007600160617     d  min_nrr              378    379i 0
007700160617     d  num_rcds             380    381i 0
007800160617
007900160617      // -?Indicatori su DspF
008000160617     d IndDspF         ds
008100160617      //?- Indicatori di errore in videata
008200160617     d  ErrMessage                    1n   overlay(IndDspF : 28)
008300160617      // -?Indicatori di errore
008400160617     d  PosCurFIL                     1n   overlay(IndDspF : 50)
008500160617      // -?Indicatori di errore generico
008600160617     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008700160617
008800160617     d WindDspF        ds                  inz
008900160617     d  WindDspFa              1     49    inz(*zero)
009000160617     d  WindDspFb             50     99    inz(*zero)
009100160617
009200160617      // -?Parametri ricevuti
009300160617     d KPJBA         e ds
009400160617
009500160617      // -?Parametri per Reperimento dati utente?
009600160617     d TIBS34ds      e ds
009700160617
009800160617      //---------------------------------------------------------------
009900160617      //?Definizione variabili globali.                               ?
010000160617      //---------------------------------------------------------------
010100160617      // -?Flags booleani
010200160617     d Fine            s               n   inz(*off)
010300160617
010400160617      //---------------------------------------------------------------
010500160617      //?Definizione prototipi procedure e relativi parametri.        ?
010600160617      //---------------------------------------------------------------
010700160617      // -?Reperimento dati utente?
010800160617      /copy gaitrasrc/srcProtoPR,TIBS34R
010900160617
011000160617      // -?Sottomissione lavoro batch
011100160617     d bch10           pr                  extpgm('BCH10')
011200160617     d  kpjba                              likeds(KPJBA)
011300160617
011400160617      //---------------------------------------------------------------
011500160617      //?Definizione key-list.                                        ?
011600160617      //---------------------------------------------------------------
011700160617
011800160617      //---------------------------------------------------------------
011900160617      //?M A I N - L I N E                                            ?
012000160617      //---------------------------------------------------------------
012100160617     c     *Entry        plist
012200160617     c                   parm                    KPJBA
012300160617
012400160617      /free
012500160617
012600160617      // -?Operazionei Iniziali
012700160617       exsr RoutInz;
012800160617
012900160617      // -?Gestione Video
013000160617       DOW  not Fine;
013100160617         exfmt  ORG1001W;
013200160617         reset ErrMessage;
013300160617         reset ErrGenerico;
013400160617         clear W01msg;
013500160617
013600160617         SELECT;
013700160617       //?- F03=Fine
013800160617         WHEN  dsp_aid = c_F03;
013900160617           Fine = *on;
014000160617       //?- F06=Elabora
014100160617         WHEN  dsp_aid = c_F06;
014200160617           exsr Controlli;
014300160617           IF  not ErrGenerico;
014400160617             exsr Elabora;
014500160617           ENDIF;
014600160617         OTHER;
014700160617       //?Invio
014800160617           exsr Controlli;
014900160617         ENDSL;
015000160617
015100160617       ENDDO;
015200160617
015300160617      // -?Operazioni Finali
015400160617       exsr RoutEnd;
015500160617
015600160617      //---------------------------------------------------------------
015700160617      //?Operazioni iniziali.                                         ?
015800160617      //---------------------------------------------------------------
015900160617       BEGSR  RoutInz;
016000160617
016100160617      // -?Reperimento dati Job
016200160617         exsr  DatiJob;
016300160617
016400160617       ENDSR;
016500160617
016600160617      //---------------------------------------------------------------
016700160617      //?Reperimento Dati del job (Utente/Operativi).                 ?
016800160617      //---------------------------------------------------------------
016900160617       BEGSR  DatiJob;
017000160617
017100160617         in(E) §AzUte;
017200160617         IF  NOT %error;
017300160617           in(E) §DatiUte;
017400160617         ENDIF;
017500160617         IF  %error or RSut = *blanks;
017600160617           clear TIBS34ds;
017700160617           tibs34r ( tibs34ds );
017800160617           in §AzUte;
017900160617           in §DatiUte;
018000160617         ENDIF;
018100160617
018200160617       ENDSR;
018300160617
018400160617      //---------------------------------------------------------------
018500160617      //?Controlli.
018600160617      //---------------------------------------------------------------
018700160617       BEGSR  Controlli;
018800160617
018900160617      // -?Filiale Giro
019000160617         IF  W01fil = 0;
019100160617           ErrMessage  = *on;
019200160617           ErrGenerico = *on;
019300160617           W01msg = Msg(01);
019400160617           leavesr;
019500160617         ENDIF;
019600160617
019700160617         chain (W01fil) AZORG01L;
019800160617         IF  ORGfva <> *blanks or
019900160617            (ORGfag <> 'A' and ORGfag <> 'F');
020000160617           ErrMessage  = *on;
020100160617           ErrGenerico = *on;
020200160617           W01msg = Msg(02);
020300160617           leavesr;
020400160617         ENDIF;
020500160617         W01fild = ORGdes;
020600160617
020700160617       ENDSR;
020800160617
020900160617      //---------------------------------------------------------------
021000160617      //?Elaborazione.
021100160617      //---------------------------------------------------------------
021200160617       BEGSR  Elabora;
021300160617
021400160617         kpjbu = %editc(W01fil:'X');
021500160617         kcoaz = 'ORG5';
021600160617         clear kbuff;
021700160617         BCH10(kpjba);
021800160620
021900160620         Fine = *on;
022000160617
022100160617       ENDSR;
022200160617
022300160617      //---------------------------------------------------------------
022400160617      //?Operazioni finali.                                           ?
022500160617      //---------------------------------------------------------------
022600160617       BEGSR  RoutEnd;
022700160617
022800160617         *inLR = *on;
022900160617         return;
023000160617
023100160617       ENDSR;
023200160617
023300160617      /end-free
023400160617
023500160617** -- MSG -------------------------------------------------------------------*
023600160617Immettere la Filiale Giro.                                                     1
023700160617Filiale Giro Errata.                                                           2
