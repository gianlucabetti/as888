000100160421      //--------------------------------------------------------------
000200160617      //?FIORG12R - CONTROLLO GIRI ANAGRAFICA CLIENTI RITIRO
000300160617      //?           DA TELLUS A BRT
000400160617      //?           AGGIORNA FILE DI WRK - WFACR10F
000500160421      //--------------------------------------------------------------
000600160421     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700160421     h dftactgrp(*no) actgrp('BARTVAS')
000800160421
000900160421      //---------------------------------------------------------------
001000160421      //?Dichiarazione file.
001100160421      //---------------------------------------------------------------
001200160617      // - File WRK
001300160617     fWFACR11L  uf   e           k disk
001400160421
001500160421      //---------------------------------------------------------------
001600160421      //?Definizione costanti.
001700160421      //---------------------------------------------------------------
001800160421
001900160421      //---------------------------------------------------------------
002000160421      //?Definizione schiere.
002100160421      //---------------------------------------------------------------
002200160421
002300160421      //---------------------------------------------------------------
002400160421      //?Definizione aree dati.
002500160421      //---------------------------------------------------------------
002600160421      // - Dati utente
002700160421     d §AzUte        e ds                  extname(AZUTE00F)
002800160421     d                                     dtaara
002900160421     d §DatiUte      e ds                  extname(dDatiUte)
003000160421     d                                     dtaara
003100160421
003200160421      //---------------------------------------------------------------
003300160421      //?Definizione strutture dati.
003400160421      //---------------------------------------------------------------
003500160421      // - Parametri ricevuti
003600160421     d KPJBA         e ds
003700160617
003800160617      // - Controllo/Decodifica/Ricerca Giro
003900160617     d FIDG09DS      e ds                  inz
004000160421
004100160421      // - Reperimento dati utente
004200160421     d TIBS34DS      e ds
004300160427
004400160617      // - Dati Input Tellus
004500160617     d DTLLXI        e ds
004600160617
004700160617      // - Campo GRGflo
004800160617     d dGRGFLO       e ds
004900160421
005000160421      //---------------------------------------------------------------
005100160421      //?Definizione variabili globali.
005200160421      //---------------------------------------------------------------
005300160421      // - Flags booleani
005400160421     d Fine            s               n   inz(*off)
005500160617
005600160617      // - Campi Ricevuti
005700160617     d Ambiente        s              1a
005800160617     d Esito           s              1s 0
005900160421
006000160421      // - Campi di comodo
006100160421     d Oggi            s              8s 0 inz
006200160421
006300160421      //---------------------------------------------------------------
006400160421      //?Definizione Procedure usate.
006500160421      //---------------------------------------------------------------
006600160617      // - Pgm descrizione giro
006700160617     d FIDG09R         pr                  extpgm('FIDG09R')
006800160617     d  kpjba                              likeds(kpjba)
006900160421
007000160421      //---------------------------------------------------------------
007100160421      //?Definizione Prototipi.
007200160421      //---------------------------------------------------------------
007300160421      /copy gaitrasrc/srcprotopr,TIBS34R
007400160421
007500160421      //---------------------------------------------------------------
007600160421      //?Definizione key-list.
007700160421      //---------------------------------------------------------------
007800160421
007900160421      //---------------------------------------------------------------
008000160421      //?M A I N - L I N E
008100160421      //---------------------------------------------------------------
008200160421     c     *Entry        plist
008300160617     c                   parm                    Ambiente
008400160617     c                   parm                    DTLLXI
008500160617     c                   parm                    Esito
008600160421
008700160421      /free
008800160421
008900160421       //?Operazioni iniziali
009000160421       exsr RoutInz;
009100160421
009200160617       //?Elabora
009300160617       exsr Elabora;
009400160421
009500160421       //?Operazioni finali
009600160421       exsr RoutEnd;
009700160421
009800160421       //--------------------------------------------------------------
009900160421       //?Operazioni iniziali.
010000160421       //--------------------------------------------------------------
010100160421       BEGSR RoutInz;
010200160617
010300160617       //?Reperimento dati job
010400160617         exsr DatiJob;
010500160421
010600160421       //?Imposto oggi
010700160421         Oggi = %dec(%date());
010800160421
010900160421       ENDSR;
011000160421
011100160421       //--------------------------------------------------------------
011200160421       //?Reperimento Dati del job (Utente/Operativi).
011300160421       //--------------------------------------------------------------
011400160421       BEGSR DatiJob;
011500160421
011600160421         in(E) §AzUte;
011700160421         IF  NOT %error;
011800160421           in(E) §DatiUte;
011900160421         ENDIF;
012000160421         IF  %error or RSut = *blanks;
012100160421           clear TIBS34ds;
012200160421           tibs34r(tibs34ds);
012300160421           in §AzUte;
012400160421           in §DatiUte;
012500160421         ENDIF;
012600160421
012700160421       ENDSR;
012800160421
012900160421       //--------------------------------------------------------------
013000160421       //?Elabora.
013100160421       //--------------------------------------------------------------
013200160421       BEGSR Elabora;
013300160617
013400160617       //?Aggancio Anagrafica Clienti Ritiro
013500160617         IF  §TLLXIekey = *blanks or §TLLXIekey = *zeros;
013600160617           leavesr;
013700160617         ENDIF;
013800160617
013900160617         WFwrkkey = %dec(%subst(§TLLXIekey:1:7):7:0);
014000160617         chain (WFwrkkey) WFACR11L;
014100160617       //?Non trovo non elaboro
014200160617         IF  not %found(WFACR11L);
014300160617           leavesr;
014400160617         ENDIF;
014500160617
014600160617       //?Imposto i dati che tornano da TELLUS
014700160617         WFTfil = %dec(§TLLXIfil:3:0);
014800160617         WFTcgi = §TLLXIcgi;
014900160617         WFTind = §TLLXIindn;
015000160621         WFTnumc = %subst(§TLLXIindn:71:10);
015100160617         WFTloc = §TLLXIlodn;
015200160617         WFTcap = §TLLXIcadn;
015300160617         WFTprv = §TLLXIprdn;
015400160617         WFTnaz = §TLLXInzdn;
015500160617         WFTlno = §TLLXIlno;
015600160617         WFTerr = §TLLXIerr;
015700160617         WFTsco = §TLLXIsco;
015800160617
015900160617       //?Recupero il tipo giro dall'anagrafica Giri
016000160617         clear FIDG09DS;
016100160620         clear dGRGflo;
016200160617         D09iop0 = '001';
016300160617         D09ifgs = WFTfil;
016400160617         D09idat = oggi;
016500160617         D09icgi = WFTcgi;
016600160617         kpjbu = FIDG09DS;
016700160617         fidg09r (kpjba);
016800160617         fidg09ds = kpjbu;
016900160617         IF  D09oerr = *blanks;
017000160617           dGRGflo = D09oflo;
017100160617         ENDIF;
017200160617         WFTtug = §GRGtug;
017300160617
017400160617       //?Aggiorno file WRK
017500160617         update WFACR100;
017600160427
017700160427       ENDSR;
017800160421
017900160421       //--------------------------------------------------------------
018000160421       //?Operazioni finali.
018100160421       //--------------------------------------------------------------
018200160421       BEGSR RoutEnd;
018300160421
018400160421         *inLR = *on;
018500160421         return;
018600160421
018700160421       ENDSR;
018800160421
018900160421      /end-free
