000100160506      //--------------------------------------------------------------
000200170427      //?FIORG99R - PULIZIA FILE LOG TELLUS ORM
000300160506      //--------------------------------------------------------------
000400160506     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500160506
000600160506      //---------------------------------------------------------------
000700160506      //?Dichiarazione file.
000800160506      //---------------------------------------------------------------
000900160506
001000160506      //---------------------------------------------------------------
001100160506      //?Definizione costanti.
001200160506      //---------------------------------------------------------------
001300160506
001400160506      //---------------------------------------------------------------
001500160506      //?Definizione schiere.
001600160506      //---------------------------------------------------------------
001700160506
001800160506      //---------------------------------------------------------------
001900160506      //?Definizione aree dati.
002000160506      //---------------------------------------------------------------
002100160506
002200160506      //---------------------------------------------------------------
002300160506      //?Definizione strutture dati.
002400160506      //---------------------------------------------------------------
002500160506      // - Parametri ricevuti
002600160506     d KPJBA         e ds
002700160506
002800160506      // - File Tabelle
002900160506     d TABELds       e ds                  extname(TABEL00F)
003000160506
003100160506      // - Tabella 5A
003200160506     d ds5A2         e ds
003300160506
003400160506      //---------------------------------------------------------------
003500160506      //?Definizione variabili globali.
003600160506      //---------------------------------------------------------------
003700160506      // - Campi di Comodo
003800160506     d DataISO         s               d   datfmt(*iso)
003900160506     d wData           s              8  0 inz
004000160506     d wDataPul        s              8  0 inz
004100160506
004200160506      //---------------------------------------------------------------
004300160506      //?Definizione Procedure usate.
004400160506      //---------------------------------------------------------------
004500160506
004600160506      //---------------------------------------------------------------
004700160506      //?Definizione Prototipi.
004800160506      //---------------------------------------------------------------
004900160506
005000160506      //---------------------------------------------------------------
005100160506      //?Definizione key-list.
005200160506      //---------------------------------------------------------------
005300160506
005400160506      //---------------------------------------------------------------
005500160506      //?M A I N - L I N E
005600160506      //---------------------------------------------------------------
005700160506
005800160506     c     *Entry        plist
005900160506     c                   parm                    kpjba
006000160506
006100160506      /free
006200160506
006300160506       //?Operazioni iniziali
006400160506       exsr RoutInz;
006500160506
006600160506       //?Elabora
006700160506       exsr Elabora;
006800160506
006900160506       //?Operazioni finali
007000160506       exsr RoutEnd;
007100160506
007200160506       //--------------------------------------------------------------
007300160506       //?Operazioni iniziali.
007400160506       //--------------------------------------------------------------
007500160506       BEGSR RoutInz;
007600160506
007700160506         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
007800160506
007900160506       //?Cerco la tabella 5a key 2 per recuperare i giorni di pulizia
008000160506         clear ds5A2;
008100160506         exec sql
008200160506         SELECT tabel00f.* into :TABELDS
008300160506         FROM   tabel00f
008400160506         WHERE  TBLkut = 1 and TBLcod = '5A' and
008500160506                substr(TBLkey, 1, 1) = '2'   and
008600160506                TBLflg = '';
008700160506
008800160506         IF  sqlcod = 0;
008900160506           ds5A2 = TBLuni;
009000160506         endif;
009100160506
009200160506       //?Dalla data odierna calcolo la data di pulizia
009300160506         wData = %dec(%date());
009400160506         DataISO = %date(wData:*iso);
009500160506         DataISO = DataISO - %days(§5Atllg);
009600160506         wDataPul = %dec(DataISO);
009700160506
009800160506       ENDSR;
009900160506
010000160506       //--------------------------------------------------------------
010100160506       //?Elabora.
010200160506       //--------------------------------------------------------------
010300160506       BEGSR Elabora;
010400160506
010500160506         exec sql
010600160506         DELETE from FILTO00F
010700160506         WHERE  LTOdat <  :wDataPul;
010800160506
010900160506       ENDSR;
011000160506
011100160506       //--------------------------------------------------------------
011200160506       //?Operazioni finali.
011300160506       //--------------------------------------------------------------
011400160506       BEGSR RoutEnd;
011500160506
011600160506         *inLR = *on;
011700160506         return;
011800160506
011900160506       ENDSR;
012000160506
012100160506      /end-free
