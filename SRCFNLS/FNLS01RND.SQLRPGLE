000100120302     /*PRM dbgview(*source)
000110120302     /*CMD ovrdbf file(TITAS30C) tofile(GAITRAGRPS/TITAS30C) +
000120120302     /*CMD        ovrscope(*calllvl)
000130120302     /*CMD ovrdbf file(TNBLA00F) tofile(GAITRAGRPS/TNBLA00F) +
000140120302     /*CMD        ovrscope(*calllvl)
000150120302     /*END dltovr file(TITAS30C TNBLA00F) lvl(*)
000160120302     /*END
000170120302      *
000180000920     H DECEDIT('0,') DATEDIT(*DMY.)
000190140423     h dftactgrp(*no) actgrp(*caller) bnddir('UBBNDDIR')
000200940819     F* FNLS01R *-----------------------------------------------------*
000210900427     F*       IMMISSIONE BOLLE
000220040329      *
000230040329      * COMPILARE CON
000240040329      *               OVRDBF FILE(TITAS30C) TOFILE(GAITRAGRPS/TITAS30C)
000250050407      *
000260050407      * Annotazioni:
000270050407     c* La gest.del richiamo a fnls01r con §lpfpr='R'(recupero bolle DskCli)
000280050407     c* è rimasta nel pgm ma non viene più utilizzata. Non è stata tolta
000290050407     c* solo per comodità visto che è presente in più punti del pgm
000300000000     F*---------------------------------------------------------------*
000310001002     FFNLS01D   CF   E             WORKSTN
000320940923     F                                     SFILE(LS01S03:NRR)
000330000829     F                                     SFILE(LS01S08:NR8)
000340021203     FFIAPD01L  IF   E           K DISK
000350950920     FAZCLN01L  IF   E           K DISK
000360990630     FCNNUM00F  UF   E           K DISK    USROPN
000370940822     FCNACO00F  IF   E           K DISK
000380900427     FCNIND00F  IF   E           K DISK
000390050209     Ffncls01l  IF   E           K DISK
000400080904     FTNBLA00F  O  A E           K DISK    USROPN extfile(WTNBLA)
000410930120     FFLNUF01L  UF   E           K DISK
000420991117     FFLNUF02L  UF A E           K DISK
000430991117     F                                     RENAME(FLNUF:FLNUF2)
000440940822     FTNTAM01L  IF   E           K DISK
000450990818     FTITPT01L  IF   E           K DISK
000460930629     FAZORG01L  IF   F 5000     2PIDISK    KEYLOC(4)
000470991117     FTABEL00F  IF   E           K DISK
000480941110     FFNBLD01L  UF A E           K DISK
000490020917     FFIVAD02L  UF   E           K DISK    USROPN
000500020917     FFIVAT01L  UF   E           K DISK    USROPN
000510040601     FFIVAX01L  UF   E           K DISK    USROPN
000520110518     FFIVAb01L  UF   E           K DISK    USROPN
000530110518     Fedivab1L  UF   E           K DISK    USROPN
000540940825     F*
000550061212     FFNBLP01L  IF   E           K DISK
000560061212     F                                     INFDS(FNBLP1)
000570061212     F                                     RENAME(FNBLP000:FNBLP001)
000580061212     FFNBLP00F  UF A E             DISK
000590940825     F*
000600140506     FFNarb01l  iF   E           k DISK
000610140506     f*
000620040601     FFIAR801L  UF A E           K DISK
000630130304     FFIAR802L  iF   E           K DISK    rename(fiar8000:fiar802)
000640940825     F* ESTENSIONE DESCRIZIONI
000650060216     FFiar401L  UF A E           K DISK
000660060215     FFiar403L  IF   E           K DISK
000670060215     F                                     RENAME(Fiar4000:Fiar4003)
000680060215     FFiar404l  IF   E           K DISK
000690060215     F                                     RENAME(fiar4000:Fiar4004)
000700021218     fFiar501l  uf a e           k Disk
000710940825     F*
000720991006     F* TASSAZIONE
000730991006     FFIAR701L  UF A E           K DISK
000740991006     FFIAR601L  UF A E           K DISK
000750940825     F*
000760940825     F* C/ASSEGNO
000770051115     FFiar901L  UF A E           K DISK
000780040603     F*
000790940825     F* DETTAGLIO COLLI
000800940825     FFNBLT01L  UF A E           K DISK
000810120814     FFIART01L  UF A E           K DISK
000820120817     FFIART27L  IF   E           K DISK
000830120817     F                                     RENAME(FIART000:FIART027)
000840120828     FFNBLT27L  IF   E           K DISK
000850120828     F                                     RENAME(FNBLT000:FNBLT027)
000860120816     F***FNBLT29L  IF   E           K DISK
000870120816     F***                                  RENAME(FNBLT000:FNBLT029)
000880120828     FFNART27L  IF   E           K DISK    prefix(BLT:3)
000890051102     FFIARS01L  UF A E           K DISK
000900051102     FFIARS02L  IF   E           K DISK
000910051102     F                                     RENAME(FIARS000:FIARS2)
000920940825     F*
000930940825     FFNLBL01L  UF   E           K DISK    USROPN
000940011126     FFIFTT02L  IF   E           K DISK
000950011126     FFIFST02L  IF   E           K DISK
000960011126     F                                     RENAME(FIFTT000:FIFST000)
000970070123     FFNBRV09L  UF   E           K DISK    USROPN
000980071221     FFNBRV07L  iF   E           K DISK    USROPN
000990071221     F                                     RENAME(Fnbrv000:Fnbrv007)
001000080313     F*TNTBE02L  UF A E           K DISK
001010080313     FTNTBE01L  IF   E           K DISK
001020970107     F* FILE DI EDI
001030970107     FEDRDE01L  UF   E           K DISK    USROPN
001040000204     FFISGN01L  UF A E           K DISK
001050001005     FFISGN05L  UF A E           K DISK
001060001005     F                                     RENAME(FISGN000:FISGN005)
001070010212     F*
001080010212     FFNORM01L  IF   E           K DISK
001090100319     FFNORE01L  IF   E           K DISK
001100120611     FFIDST01L  IF   E           K DISK
001110010214     FFNFVV01L  IF   E           K DISK
001120051123     FFNANM02L  UF   E           K DISK
001130051124     FFNANM01L  UF   E           K DISK
001140051124     F                                     RENAME(FNANM000:FNANM01)
001150061107     Fdppdc00f  O    E             DISK
001160040329      * Bolle sede
001170040329     fTitas30c  if   e           k Disk    UsrOpn
001180060209      * STORICIZZAZIONE VARIAZIONI
001190060209     FFIARBT0F  O  A E             DISK    usropn
001200060209     FFIARBU0F  O  A E             DISK    usropn
001210070404     FFIARG01L  UF A E           K DISK
001220070530     F*
001230080221     f**!!!fipdo01t  if   e           k disk
001240070601     ffnorf01l  if   e           k disk
001250070612     FEDTAB01L  IF   E           K DISK
001260070626     ffidpo03l  if   e           k disk
001270100323     fazfgi01l  if   e           k disk
001280970107     F*
001290941221     FFNLV22P   O    F  132        PRINTER
001300960926     D L1              S              3  0 DIM(30)
001310070807     D L6              S              3  0 DIM(30)
001320970925     D*
001330940922     D CPA             S              2    DIM(30)
001340970115     D*
001350970115     D TBO             S              1    DIM(30)
001360970115     D LDC             S              2    DIM(30)
001370941108     D*
001380941107     D TSP             S              1    DIM(10)
001390941107     D UTS             S              1    DIM(10)
001400941115     D STS             S              1    DIM(10)
001410941107     D DTS             S             15    DIM(10)
001420000509     D USO             S              1    DIM(10)
001430090604     D DTS08           S              8    DIM(10)
001440090609     D DTS03           S              3    DIM(10)
001450090827     D TSttc           S              5    DIM(10)
001460960209     D*
001470960209     D TBL             S              2    DIM(20)
001480101022     D S1Y             S              1    DIM(20)
001490940916     D*
001500940923     D K07             S              1    DIM(7)
001510940923     D K09             S              1    DIM(9)
001520940919     D K35             S              1    DIM(35)
001530950920     D K31             S              1    DIM(31)
001540940919     D K78             S              1    DIM(78)
001550970115     D K89             S              1    DIM(89)
001560950104     D SKI             S              1    DIM(15)
001570011211     D SKII            S              1    DIM(14)
001580001214     D KOL             S             10    DIM(20)
001590971211     D*
001600971211     D KSS             S              7    DIM(12)
001610940922     D*
001620900611     D GGG             S              1    DIM(8) CTDATA PERRCD(8)
001630990602     D DES             S             34    DIM(6) CTDATA PERRCD(1)
001640060110     d rigw            s             67    Dim(10) Ctdata Perrcd(1)
001650040329     d cmdt            s             60    dim(01) ctdata perrcd(1)
001660141202     D ERR             S             78    DIM(357) CTDATA PERRCD(1)
001670930611     D*
001680980318     D*  SCHIERE PER COMPORRE SEGNACOLLO EUROEXPRESS
001690980318     D §S9             S              1    DIM(9)
001700980318     D §O9             S              1    DIM(9)
001710980330     D W35             S              1    DIM(35)
001720991201      *  SCHIERA PER COMPORRE BARCODE SU LETTERA VETTURA DPD IMPORT
001730991201      *  SCHIERA PER COMPORRE RMN IN STAMPA SEGNACOLLO DPD IMPORT
001740991201     D W15             S              1    DIM(15)
001750991026      *
001760000830     D* COD. CHI SONO PER CONTROLLI DI RECORD DOPPIO
001770021104     D CHI             S             35    DIM(500)
001780021104     D POS             S              4  0 DIM(500)
001790021104     D ANN             S             15  0 DIM(500)
001800021104     D CH2             S             35    DIM(500)
001810021119     d Prefisso        s              2    Dim(500)
001820930629     D UNIORG        E DS          5000    EXTNAME(AZORG00F)
001830040116      * sk x gestire le varie della seconda bolla
001840041217     d w2sv            s              1    Dim(6)
001850041217     d w2va            s             11  3 DIm(6)
001860061011     d
001870061011     D CAP             S              1    DIM(9)
001880061011     D CAF             S              1    DIM(9)
001890020212     D*
001900130117
001910130117      // - Sk per Tabella OSR
001920130117     d skCLIosr        s              7  0 dim(900)
001930130117     d skLNPNRSosr     s              5    dim(900)
001940130117
001950130117      // - Indici di schiera
001960130117     d osrxx           s              3  0 inz
001970130117
001980130117      // - Campo di comodo per Ordinante ORM lungo 7
001990130117     d wORMcor         s              7s 0 inz
002000130117
002010090827     d Wttc            s              5
002020090827     d WttcCAP         s              5
002030100319     d KoreTrc         s                   like(oretrc) inz('G')
002040100319     d KAr5Trd         s                   like(Ar5Trd)
002050060515     d Bolksc          s                   Like(blpksc)
002060060515     d Bolctr          s                   Like(vidctr)
002070110304     d savnot          s                   Like(tamnot)
002080020212     D wawb            s             11  0
002090020212     D wawbini         s             11  0
002100021119     d Wpre            s              2
002110030204     d wPkg            s              1
002120030204     d wNba            s              1
002130030204     d w0071           s              7  1
002140030204     d w0053           s              5  3
002150050119     d wsolo_prp       s              1
002160030204     d wTbaPkg1        s                   Like(§TbaPkg)
002170030204     d wTbaVol1        s                   Like(§TbaVol)
002180030204     d wTbaPkg2        s                   Like(§TbaPkg)
002190030204     d wTbaVol2        s                   Like(§TbaVol)
002200030204     d SavNba          s                   Like(§Ar5Nba)
002210030204     d SavNb2          s                   Like(§Ar5Nb2)
002220090804     d w_ar5ass        s                   Like(§Ar5ass)
002230091001     d w_ar5tcp        s                   Like(§Ar5tcp)
002240091001     d w_ar5tic        s                   Like(§Ar5tic)
002250091214     d w_ar5cdi        s                   Like(§lpcdi)
002260091001     d sav_tc1         s                   like(vidtc1)
002270091001     d sav_tc2         s                   like(vidtc1)
002280030304     d wrma            s              1    Inz
002290030409     d Dataiso         s               d   datfmt(*iso)
002300030415     d woggi5          s              8  0
002310051214     d*woggi1m         s              8  0
002320051214     d woggidcgm1      s              8  0
002330051214     d woggidcgm2      s              8  0
002340051214     d s_woggidcg      s                   like(woggidcgm1)
002350051214     d s_vpodcg        s                   like(§vpodcgm1)
002360080603     d datam40         s              8  0
002370130305     d datapdf         s              8  0
002380030409     d wwtcr           s              1
002390030409     d wflagore        s              1
002400030409     d wore            s              3  0
002410030409     d §ore            s              2  0
002420030417     d fordcr          s              1    Inz
002430060103     d savddt          s                   like(vidbam)
002440030520     d wnonum          s              1    Inz
002450030704     d wforw03         s              1    Inz
002460030704     d wtotncl         s              6  0
002470030708     d savw03cor       s                   Like(§Ar5bCor)
002480030708     d savw03csf       s                   Like(§Ar5bCsf)
002490030718     d savinkh         s              1
002500030718     d savinki         s              1
002510030728     d wfornba         s              1    Inz
002520030728     d wtotnba         s              3  0
002530031125     d wgva            s              1
002540030805     d wkosr           s              5  0
002550030805     d w012a           s             12
002560040608     d w016ad          s             16
002570031001     d wfortbo         s              1    Inz
002580031201     d wnoccm          s              1    Inz
002590031201     d wforpf          s              1    inz
002600091006     d wope            s                        Like(I28Ope)
002610031219     d wrifp           s                        Like(VatNot)
002611141031     d wPinCode        s             15
002620040114     d va2va2          s                        Like(Vi2Va2)
002630040114     d va2va3          s                        Like(Vi2Va3)
002640040114     d va2va4          s                        Like(Vi2Va4)
002650041217     d va2va5          s                        Like(Vi2Va5)
002660041217     d va2va6          s                        Like(Vi2Va6)
002670040603     d s_vaxprr        s                        Like(vaxprr)
002680050119     d s_vidorm        s                        Like(vidorm)
002690050315     d s_ormpers       s              1
002700040114     d war71           s              1
002710040116     d ContaSv         s              2  0
002720121123     d wesvar1         s              1
002730040216     d wforza1         s              1    inz(*off)
002740040216     d wforza2         s              1    inz(*off)
002750110321     d wforzbrv        s              1    inz(*off)
002760110422     d wforzadrt       s              1    inz(*off)
002761141124     d wforz_lna       s                   like(comlna)
002762141124     d wforz_lnap      s                   like(v0clna)
002763141201     d wForzPCExp      s              1
002770110321     d wcheck          s              1    inz(*off)
002780040226     d p26vol          s              8  3
002790040226     d wrifm           s              1    Inz(*Off)
002800040301     d wkk             s              1    Inz(*Off)
002810040319     d wmodorm         s              1    Inz(*Off)
002820040329     d LnpOgAs         s                   Like(§OgAs)
002830070529     d s_§ogpdaorm     s                   Like(§Ogpdaorm)
002840080111     d*g_ormpor        s                   Like(ormpor)
002850040329     d wlib            s             10
002860040329     d comman          s             80
002870040329     d lenght          s             15  5 inz(80)
002880040302
002890040302     d wtxt            S           2048
002900040302     d TxtInOut        S           2048
002910040302     d ElencoChar      S            256
002920040302     d TipoElenco      S              1
002930100219     d UsaCAss         S              1
002940040302     d CharSost        S              1
002950040302     d UpperCase       S              1
002960040302     d ChkNull         S              1    Inz('1')
002970040302     d CharNull        S              1
002980040302     d Esito           S              1
002990050209     D wclsflo8        S              1
003000081008     D w005a           S              5
003010050331     d wKSCsf1         s              4  0
003020050331     d wKSCsf2         s              4  0
003030051214     d s_d98dce        s                   like(d98dce)
003040061011     d savcapDPD       s                   like(vidcad)
003050061109     d savrsm          s                   like(vidrsm)
003060070827     d W_vidind        s                   like(vidind)
003070061109     d wcdf            s                   like(vidcdf)
003080071022     d wiva            s                   like(vidpim)
003090061221     d salvatgi        s                   like(g02tgi)
003100081014     d §3cabd_s        s                   like(§3cabd)
003110081023     d cbo_blp         s                   like(vidcbo)
003120061011     d Cappariodpd     S              1
003130120611     d w0050           S              5  0
003140080904     d WTNBLA          s             21    inz('GAITRAGRU /TNBLA00F')
003150091221     d wvidgma         s                   like(vidgma)
003160100604     d w7rRC           s                   like(§7rRC)
003161141202     d w7rPC           s                   like(§7rpincode)
003170100319     d Wofit           s             11  0 inz(99999999999)
003180100323     d kksc            s                   like(acoksc)
003190100323     d klnp            s                   like(blplnp)
003200100323     d klna            s                   like(blplnp)
003210110518     d s_wksc          s                   like(wksc) inz(0)
003220111122     d prelnp          s                   like(vidlnp)
003230111123     d pr0lnp          s                   like(v0clnp)
003240130308     d w_allx          s              1
003250130408     d w_allm          s              1
003260130417     d w_alls          s              1
003270130308     d wvatpe          s              1
003280130308     d wvatp           s              1
003290130306     d wvax            s              1
003300130403     d w_prr           s                   like(ar8prr)
003310140307     d w_pdfn          s                   like(§vatppdfn)
003320020212     D*
003330940930     D* PASSO A GESTIONE DETTAGLIO COLLI DA DISK CLIENTI-FNLS78R -
003340900511     D PARAM           DS
003350950321     D  PARCCM               101    107  0
003360941221     D  PARAAS               108    111  0
003370941221     D  PARLNP               112    114  0
003380941221     D  PARNRS               115    116  0
003390941221     D  PARNSP               117    123  0
003400941221     D  PARLNA               124    126  0
003410941221     D  VI3FNS               127    127
003420941221     D  KCI                  128    131  0
003430020917     D  PARFGS               132    134  0
003440021203      * Ds esterna per ricerca codice padroncino
003450021203     D FNLV24DS      E DS
003460991008     D* STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO/PREPAGATI DA KPJBU
003470950118     D PARAM3          DS
003480950118     D  WPGMSS               246    255
003490990602     D  PARTCH               256    256
003500951228     D* PASSO A CREAZIONE NUMERATORI                   - FNLVCNR -
003510951228     D PARAM4          DS
003520951228     D  PA4CNU                 1      3  0
003530990701     D* PASSO A TASSAZIONE BOLLE                       - TNSF20R -
003540990701     D PARAMF          DS
003550990701     D  WFIAS                256    256
003560940822     D V0DMIT          DS
003570940822     D  V0CRSM                 1     35
003580940907     D  V0CINM                36     70
003590940907     D  V0CLOM                71    105
003600940907     D  V0CCAM               106    114
003610940907     D  V0CPRM               115    116
003620940907     D  V0CNZM               117    119
003630940825     D VIDMIT          DS
003640940825     D  VIDRSM                 1     35
003650940907     D  VIDINM                36     70
003660940907     D  VIDLOM                71    105
003670940907     D  VIDCAM               106    114
003680940907     D  VIDPRM               115    116
003690940907     D  VIDNZM               117    119
003700940824     D*
003710940824     D                 DS
003720940927     D  V0CISM                 1      2
003730940927     D  V0CCPM                 3     16
003740940927     D  V0CPIM                 1     16
003750940824     D                 DS
003760940927     D  VIDISM                 1      2
003770940927     D  VIDCPM                 3     16
003780940927     D  VIDPIM                 1     16
003790940824     D                 DS
003800940927     D  VIDISD                 1      2
003810940927     D  VIDCPD                 3     16
003820940927     D  VIDPID                 1     16
003830940824     D                 DS
003840940927     D  WISO                   1      2
003850940927     D  WCPI                   3     16
003860940927     D  WPIVA                  1     16
003870900427     D TCUDS           DS
003880000000     D  F1                     1      1
003890000000     D  F3                     3      3
003900000000     D  F2                     2      2
003910000000     D  F4                     4      4
003920000000     D  F56                    5      6
003930900514     D                 DS
003940900514     D  VIDLNP                 1      3  0
003950900514     D  VIDNRS                 4      5  0
003960900514     D  VIDNSP                 6     12  0
003970900514     D  VIDSPE                 1     12  0
003980040506     d                 DS
003990040506     d  widlnp                 1      3  0
004000040506     d  widnrs                 4      5  0
004010040506     d  widnsp                 6     12  0
004020040506     d  widspe                 1     12  0
004030900514     D                 DS
004040120828     D  BLTLNP                 1      3  0
004050120828     D  BLTNRS                 4      5  0
004060120828     D  BLTNSP                 6     12  0
004070120828     D**ARTLNP                 1      3  0
004080120828     D**ARTNRS                 4      5  0
004090120828     D**ARTNSP                 6     12  0
004100910829     D  BLPSPE                 1     12  0
004110940214     D                 DS
004120940214     D  VARNCL                 1      5  0
004130940214     D  VARCDP                 6     20
004140940214     D  VARCN                  1     20
004150950921     D                 DS
004160950921     D  WAA                    1      4  0
004170950921     D  WMM                    5      6  0
004180950921     D  WGG                    7      8  0
004190950921     D  WDATA                  1      8  0
004200991201      * PER SEGNACOLLO DPD
004210991214     D                 DS
004220991214     D  DPDSTA                 1     26
004230991214     D  DPDCOS                 1     12
004240991214     D  DPDSTP                13     26
004250991214     D  DPDS1                 13     15
004260991214     D  DPDV1                 16     16    INZ
004270991214     D  DPDS2                 17     24
004280991214     D  DPDV2                 25     25    INZ
004290991214     D  DPDS3                 26     26
004300991214     D                 DS
004310991214     D  DPDPAR                 1     12
004320991214     D  DPD1                   1      3
004330991214     D  DPD2                   4     11
004340991214     D  DPD3                  12     12
004350940819     D***
004360940819     D* PARAMETRI PER CONTROLLO DATA E TRASFORM IN GIORNI - XSRDA8 -
004370940819     D***
004380940819     D WLBDAT          DS                  INZ
004390940819     D  G02DAT                 1      8  0
004400940819     D  G02INV                 9     16  0
004410940819     D  G02ERR                17     17
004420940819     D  G02TGI                18     22  0
004430940819     D***
004440940819     D* PARAMETRI PER TRASFORM GIORNI IN DATA             - XSRDGI -
004450940819     D***
004460940819     D WGIDAT          DS                  INZ
004470940819     D  GIODAT                 1      8  0
004480940819     D  GIOINV                 9     16  0
004490940819     D  GIOTGI                17     21  0
004500000000     D KPJBA         E DS
004510991117      * CALCOLO DEL CHCK DIGIT PER BARCODE DPD
004520991117     D                 DS
004530991117     D  DPDLNP                 1      3  0
004540991117     D  DPDGMS                 4      7  0
004550010222     D  DPDNDS                 8     11  0
004560991117     D  §11                    1     11  0
004570991201     D                                     DIM(11)
004580991117     D  DPDCHD                12     12  0
004590991117     D  DPDBRC                 1     12  0
004600000915     D                 DS
004610000915     D  V8HFLS                 1      3  0
004620000915     D  V8HLNA                 4      6  0
004630000915     D  V8HNRS                 7      8  0
004640000915     D  V8HNSC                 9     15  0
004650000915     D  V8HCOL                 1     15  0
004660000915     D                 DS
004670000915     D  KFLSAN                 1      3  0
004680000915     D  KLNAAN                 4      6  0
004690000915     D  KNRSAN                 7      8  0
004700000915     D  KNSCAN                 9     15  0
004710000915     D  KANNUL                 1     15  0
004720010212     D                 DS
004730010213     D  WOPOE                  1      3  0
004740010222     D  WONSR                  4      5  0
004750010222     D  WONOR2                 6     12  0
004760010222     D  WONOR                  4     12  0
004770010213     D  WONRV                 13     14  0
004780010222     D  WIDOR1                 4     14  0
004790010215     D  WIDORM                 1     14  0
004800010215     D                 DS
004810010215     D  VIDPOE                 1      3  0
004820010222     D  VIDNOR                 4     12  0
004830010215     D  VIDNRV                13     14  0
004840010215     D  VIDORM                 1     14  0
004850010219     D                 DS
004860010219     D  V0CPOE                 1      3  0
004870010222     D  V0CNOR                 4     12  0
004880010219     D  V0CNRV                13     14  0
004890041220     D  V0CORM1                4     14  0
004900010219     D  V0CORM                 1     14  0
004910041220     D                 DS
004920041220     D  s_v0cpoe               1      3  0
004930041220     D  s_v0cnor               4     12  0
004940041220     D  s_v0cnrv              13     14  0
004950041220     D  s_v0corm               1     14  0
004960030805     d                 ds
004970030805     d  savOrmPoe              1      3  0
004980030805     d  savOrmNsr              4      5  0
004990030805     d  savOrmNor              6     12  0
005000030805     d  savOrmNrv             13     14  0
005010030805     d  savkeyorm              1     14  0
005020040227
005030040227     d  OrmRfa         ds
005040040227     d  wrmbolla               1      1
005050040227     d  wrmaas                 2      3
005060040227     d  wrmlnp                 4      6
005070040227     d  wrmnrs                 7      8
005080040227     d  wrmnsp                 9     15
005090030805
005100000901     D DSBLD7        E DS
005110000901     D  §C                     1     17  0
005120000901     D                                     DIM(17)
005130001012     D                 DS
005140000911     D  §CB                    1     18  0
005150000901     D                                     DIM(18)
005160000911     D  §CA                    1     18
005170000911     D                                     DIM(18)
005180001012     D                 DS
005190001012     D  §2                     1      2  0
005200000901     D                                     DIM(2)
005210001012     D  §2A                    1      2
005220000901     D                                     DIM(2)
005230991011     D* DS PER YEURCO - EURO CONVERTITORE
005240991011     D DSYEUR        E DS                  EXTNAME(YEURCODS)
005250061109     d
005260061109     d* Controllo codice fiscale
005270061109     d xcfivads      e ds
005280061109     d
005290061110     D* DS PER YCO601R - RICERCA codice fiscale
005300061109     D YCO600DS      E DS
005310940819     D*
005320991007     D DS$2          E DS
005330991007     D OG148         E DS
005340000204     D OG150         E DS
005350000204     D OG143         E DS
005360020213     D A_og143       E DS                  EXTNAME(OG143)
005370020213     D                                     prefix(A_)
005380040525     D A_og150       E DS                  EXTNAME(OG150)
005390040525     D                                     prefix(A_)
005400080623     D edidspu       E DS
005410000623     D DSBL4W        E DS
005420140122     D*DSBL4J        E DS
005430010212     D DSBL4M        E DS
005431141103     D DSBL4Y        E DS
005440110706     D DSBL44        E DS
005450061122     D S_dsbl4m      E DS                  EXTNAME(dsbl4m)
005460061122     D                                     prefix(S_)
005470070620     D  s_§b4orm               1     14  0
005480070627     D  s_§b4fit               4     14  0
005490070620
005500020523     D DSBL4A        E DS
005510010925     D DSBL4Z        E DS
005520061003     D*DSBL4F        E DS
005530060509     D DSBL4I        E DS
005540060509     D DSBL4K        E DS
005550991203     D DSBL4E        E DS
005560971215     D DSBLDE        E DS
005570971215     D DSBLD         E DS
005580000627     D DBLP          E DS
005590991007     D DTAS          E DS
005600040329     d  §tasflo      e                     extfld(tasflo)
005610991007     D DTASV         E DS
005620941108     D  VSV                    1     20
005630941108     D                                     DIM(20)
005640991008     D  VVA                   21    140P 3
005650991007     D                                     DIM(20)
005660991007     D  VES                  141    160
005670941108     D                                     DIM(20)
005680971216     D DS1A          E DS
005690900529     D DS1B          E DS
005700940928     D DS1P          E DS
005710061030     d
005720940928     D DS15          E DS
005730080414     D*ds15x         E DS                  EXTNAME(ds15)
005740080414     d**                                   prefix(X_)
005750061030     d
005760101022     D DS1Y          E DS
005770101022     D DS3A          E DS
005780921217     D DS3C          E DS
005790100517     D** D3cp          E DS
005800940825     D DS3I          E DS
005810991213     D DS3IDP        E DS
005820000509     D DS3IPT        E DS
005830941102     D DS5E          E DS
005840980806     D DS7T          E DS
005850041126     D DS7S          E DS
005860051124     D DS7c          E DS
005870100217     D DS7R          E DS
005880921217     D DSCC          E DS
005890921217     D DSCT          E DS
005900940826     D DSCV          E DS
005910011108     D DSCW          E DS
005920020725     D DYIV          E DS
005930000124     D DSTA01        E DS
005940061002     d* campo §tasflo della DTAS
005950061002     D DTAS01        E DS
005960000124     D DSTB          E DS
005970940914     D DSQT1         E DS
005980921217     D DSTM          E DS
005990060208     D DS7L          E DS
006000991008     D DGED          E DS
006010991008     D DGEI          E DS
006020010924     D DORM01        E DS
006030010409     D DDFT          E DS
006040010409     D  §DFORA       E                     EXTFLD(D§DFTORA)
006050010409     D  §DFORR       E                     EXTFLD(D§DFTORR)
006060010409     D  §DFTOR       E                     EXTFLD(D§DFTTOR)
006070010409     D  §DFTCO       E                     EXTFLD(D§DFTTCO)
006080010409     D  §DFDDT       E                     EXTFLD(D§DFTDDT)
006090010409     D  §DFPAG       E                     EXTFLD(D§DFTPAG)
006100010409     D  §DFPKG       E                     EXTFLD(D§DFTPKG)
006110010409     D  §DFBNC       E                     EXTFLD(D§DFTBNC)
006120010409     D  §DFMAX       E                     EXTFLD(D§DFTMAXKG)
006130000120     D DCHI          E DS
006140010212     D DFAR          E DS
006150010215     D  §FARDS       E                     EXTFLD(D§FARDES)
006160010215     D  §FARFB       E                     EXTFLD(D§FARFFB)
006170010309     D  §FARNF       E                     EXTFLD(D§FARNONF)
006180010319     D  §FARMN       E                     EXTFLD(D§FARMAN)
006190010319     D  §FARST       E                     EXTFLD(D§FARSTP)
006200010319     D  §FARAF       E                     EXTFLD(D§FARAFVV)
006210010319     D  §FARCF       E                     EXTFLD(D§FARCFVV)
006220011025     D  §FAROO       E                     EXTFLD(D§FARNOO)
006230011025     D  §FARUV       E                     EXTFLD(D§FARUVA)
006240011025     D  §FARDV       E                     EXTFLD(D§FARDVA)
006250060103     d ddstflo       e ds
006260021120     D DDFE          E DS
006270021218     d Dar5Ban       e Ds
006280030704     d Dar5Bnb       e Ds
006290130306     d Dar8§pdf      e Ds
006300030204     d dTba          e ds
006310030326     d dDcr          e ds
006320030805     d dAr5Rcc       e Ds
006330030805     d dOsr          e Ds
006340031113     d Dar5Gen       e Ds
006350100319     d DoreGen       e Ds
006360110512     d Dar5Emd       e Ds
006370031125     d dVato         e ds
006380110704     d dVat4         e ds
006390130306     d dVatP         e ds
006400130315     d dVats         e ds
006410040701     d dVpoppt       e ds
006420041217     d dVpo          e ds
006430060207     d dVpodeco      e ds
006440121017     d ddgd          e ds
006450081111      * Ds date statistiche
006460081111     d dSdf          e ds
006470110818     d*** dVUS          e ds
006480110818     d dxco          e ds
006490110818     D  vaa                    1     10    dim(10)
006500060612     d dVate         e ds
006510070529     d dPdo          e ds
006520071220     d dcli          e ds
006530090625     d trulticds     E DS
006540100517     d trulNRSds     E DS
006550061106     D TRULdepds     E DS
006560030610      * DS - PARAMETRI PER STAMPA BOLLE ED ETICHETTE
006570030610     D TRUL90DS      E DS
006580030611     D WTRUL90DS     E DS                  extname(TRUL90DS) prefix(W)
006590060619      * DS PER FIEU12R - CREAZIONE EVENTI FISSI DPD
006600060619     D fieu12ds      E DS
006610941005     D* DS PER TRTB69R - TRTB70R - TRTB72R - TRTB73R - INT E GEST PARTI
006620941005     D DS7PQR        E DS                  EXTNAME(DS7PQRS)
006630940919     D* DS PER TRUL06R - CARICAMENTO £X
006640940919     D DSUL06        E DS                  EXTNAME(TRUL06DS)
006650940919     D  LIN                    1     90  0
006660960926     D                                     DIM(30)
006670011211     D* DS PER TRUL21R - CONTROLLO LIMITI IMPORTO DA C/ASSEGNO
006680011211     D DSUL21        E DS                  EXTNAME(TRUL21DS)
006690011211     D* DS PER TRUL22R - CONTROLLO LIMITI IMPORTO DA ASSICURARE
006700011211     D DSUL22        E DS                  EXTNAME(TRUL22DS)
006710011211     D  I22TLS       E                     EXTFLD(I22TLA)
006720011211     D  I22LNS       E                     EXTFLD(I22LNA)
006730011212     D  I22LPS       E                     EXTFLD(I22LNP)
006740011212     D* DS PER TRUL23R - CONTROLLO LIMITI VALORE MERCE
006750011212     D DSUL23        E DS                  EXTNAME(TRUL23DS)
006760090608     D* DS PER TRUL73R - CONTROLLO LIMITI per tipo servizio
006770090608     D trul73ds      E DS
006780020320     D* DS PER TRUL33R - REPERIMENTO/AGGIORNAMENTO NUMERATORI SU AZNUM
006790020320     D TRUL33DS      E DS
006800991102     D* DS PER TIBS02R - GESTIONE TNTBE00F
006810991102     D DSBS02        E DS                  EXTNAME(TIBS02DS)
006820050502     D* DS PER FNLV20R - DS DEI CAMPI PER CALCOLO VOLUME DA FATTURARE
006830050502     D DSLV20        E DS                  EXTNAME(FNLV20DS)
006840030626     D* DS PER STAMPA BOLLA
006850030626     D fnlsb5DS      E DS
006860130315     d FNLSB6ds1     e ds                  inz
006870130419     d   DB6pdf      e                     inz('X')
006880991014     D* DS PER FNLV04R - CALCOLO TOTALE FATTURA SE IMMESSO NUMERO E DAT
006890991014     D DSLV04        E DS                  EXTNAME(FNLV04DS)
006900970707     D* DS PER FNLV13R - CONTROLLO DI UN CAP
006910970707     D DSLV13        E DS                  EXTNAME(FNLV13DS)
006920970707     D* DS PER FNLV14R - CONTROLLO DI INDIRIZZO COMPLETO  SENZA CAP
006930970707     D DSLV14        E DS                  EXTNAME(FNLV14DS)
006940970702     D* DS PER TISI95R - CONTROLLO DI CAP
006950970702     D DSSI95        E DS                  EXTNAME(TISI95DS)
006960060922     D TISI97DS      E DS
006970060619     D* DS PER TISIE3R - CAPPARIO DPD  - NUOVO
006980060619     D TISIe3ds      E DS
006990061011     D* DS PER TISIE8R - interrogazione CAPPARIO DPD  - NUOVO
007000061011     D TISIe8ds      E DS
007010991008     D* DS PER FNLV16R - CONTROLLO TASSAZIONE
007020991008     D DSLV16        E DS                  EXTNAME(FNLV16DS)
007030040115     D DLV1601       E DS
007040941025     D* DS PER FNLV18R - CALCOLO DI UN VOLUME AUTOMATICO
007050941025     D DSLV18        E DS                  EXTNAME(FNLV18DS)
007060060215     D* DS PER FNLV19R - PER SCRITTURA Fiar400F
007070941028     D DSLV19        E DS                  EXTNAME(FNLV19DS)
007080050920     D* DS PER FNLV59R - CARICAMENTO E CONTROLLO TARIFFE DI 1 CLIENTE
007090050920     D fnlv59ds      E DS
007100970925     D* DS PER FNLV55R - RICERCA TERMINAL DI PARTENZA/ARRIVO
007110970925     D DSLV55        E DS                  EXTNAME(FNLV55DS)
007120970925     D* DS PER TNSD99R - CALCOLO  DELLA CONSEGNA TEORICA BOLLA
007130970925     D DSSD99        E DS                  EXTNAME(TNSD99DS)
007140000907     D* DS PER FNLSZ1R - CONTROLLO COD. "CHI SONO"
007150000907     D DSLSZ1        E DS                  EXTNAME(FNLSZ1DS)
007160020213     D* DS PER TRUL27R - Ricerca tarfiffa di cartello
007170020213     D trul27ds      E DS
007180051206     D* DS PER tntb51R - controllo se dati EDI trasferiti
007190051206     D tntb50ds      E DS
007200061122     D fior51ds      E DS
007210070604     D fior56ds      E DS
007220081014     D trtc86drds    E DS
007230030326     d Trul13ds      e ds
007240030326     D  tI13Tla      e                     EXTFLD(I13Tla)
007250030326     D  tO13Err      e                     EXTFLD(O13Err)
007260030326     D  tO13Msg      e                     EXTFLD(O13Msg)
007270111206     d
007280111206     d Trul13ds1     e ds
007290090325
007300090325     D TIBS69DS      E DS
007310090515     D ds_cnaco      E DS                  extname(CNACO00F) prefix(BS_)
007320090515     D ds_cnind      E DS                  extname(CNIND00F) prefix(BS_)
007330090515     D ds_cnclp      E DS                  extname(CNCLP00F) prefix(BS_)
007340090515     D ds_fncls      E DS                  extname(FNCLS00F) prefix(BS_)
007350090325
007360980108     D CNCR80        E DS
007370900427     D UT§DSE        E DS                  EXTNAME(UT§DSE0F)
007380000000     D  TCU                  398    697
007390000000     D                                     DIM(50)
007400000000     D  KCU                  698    847P 0
007410000000     D                                     DIM(50)
007420000000     D                                     PACKEVEN
007430000000     D  DTU                  848    895P 0
007440000000     D                                     DIM(12)
007450000000     D                                     PACKEVEN
007460991214     D* DS DI BLP
007470000211     D DSBLP0        E DS                  EXTNAME(FNBLP00F)
007480000211     D DSBLD0        E DS                  EXTNAME(FNBLD00F)
007490000211     D DSSGN0        E DS                  EXTNAME(FISGN00F)
007500041019     D SAVBLP        E DS                  EXTNAME(FNBLP00F)
007510041019     D                                     prefix(x_)
007520001130     D* DS RICHIAMO PROGRAMMA CANCELLAZIONE BOLLA SINGOLA
007530001130     D DSLS63        E DS                  EXTNAME(FNLS63DS)
007540010216     D* DS RICHIAMO PROGRAMMA RICERCA O.R.M.
007550010216     D DSOR04        E DS                  EXTNAME(FIOR04DS)
007560110419     D fior58ds      E DS
007570010228     D* DS RICHIAMO PROGRAMMA IMMISSIONE ORM PREPAGATO
007580010228     D DSOR05        E DS                  EXTNAME(FIOR05DS)
007590010228     D  §RMPOO       E                     EXTFLD(§RMPOEO)
007600010228     D  §RMNSO       E                     EXTFLD(§RMNSRO)
007610010228     D  §RMNOO       E                     EXTFLD(§RMNORO)
007620010228     D  §RMNRO       E                     EXTFLD(§RMNRVO)
007630980318     D* DS PER COMPOSIZIONE SEGNACOLLO EUROEXPRESS
007640980318     D                 DS
007650980318     D  WJUT                   1      3    INZ('JUT')
007660980318     D  WIT                    4      5    INZ('IT')
007670051102     D  ARSFLS                 6      8  0
007680051102     D  ARSNRS                 9     10  0
007690051102     D  ARSNSC                11     17  0
007700011120     D  W15C                  18     19
007710011107     D  W55L                  18     21
007720980408     D  WCADN                 22     32
007730980408     D  DSEEX                  1     32
007740010216     D*
007750010216     D* DS PER RICHIAMO FIOR07R PER VISUALIZZAZIONE ORM
007760010216     D FIOR07          DS
007770010216     D  D07POE                 1      3  0
007780010216     D  D07NOR                 4     10  0
007790010216     D  D07NSR                11     12  0
007800010216     D  D07NRV                13     14  0
007810010216     D  D07SCE                15     15
007820010216     D  D07FGS                16     18  0
007830010216     D  D07POR                19     21  0
007840010216     D  D07DTR                22     29  0
007850010216     D  D07MDB                30     39
007860010216     D  D07PRB                40     49
007870010216     D  D07DTS                50     57  0
007880010216     D  D07RMP                58     58
007890010216     D  D07BRC                59     59
007900010216     D  D07REF                60     61
007910010216     D  D07MIO                62     62
007920011108     D DSEDIT        E DS                  EXTNAME(XEDITDS)
007930011108     D  IEDNUM       E                     EXTFLD(IEDNUMERO)
007940011108     D  IEDNRD       E                     EXTFLD(IEDNRDEC)
007950011108     D  IEDEDT       E                     EXTFLD(IEDEDTCOD)
007960011108     D  IEDLEN       E                     EXTFLD(IEDLENFLD)
007970011108     D  OEDNUM       E                     EXTFLD(OEDNUMAN)
007980011108     D  OEDFLG       E                     EXTFLD(OEDFLGERR)
007990011108     D  OEDCOD       E                     EXTFLD(OEDCODERR)
008000020530     D*
008010060213     D DSARBD        E DS
008020060213     D DSARBG        E DS
008030060213     D DARBT         E DS
008040060213     D DSARBK        E DS
008050060213     D fnlr48ds      E DS
008060020530     D tisit0ds      E DS
008070070924     D tisit0x1ds    E DS
008080091006      * ds x richiamo pgm FNLS28R
008090091006     d Fnls28ds      e ds
008100040227      * ds x richiamo pgm FNLS26R
008110040227     d Fnls26ds      e ds
008120060125      * ds x richiamo pgm FNLS25R
008130060125     d Fnls25ds      e ds
008140060207      * ds x richiamo pgm FNLv85R
008150060207     d Fnlv85ds      e ds
008160060616     d trul28ds4     e ds
008170061127     d fidn12ds      e ds                  prefix(dn_)
008180110512     d dsemail       e ds
008190110517     d Fnls80ds      e ds
008200110517     d  dPog                   1     90  0 Dim(30)
008210140507     d fidna6ds      e ds
008220060208     D cndizion      E DS
008230060208     D                                     BASED(nullPtr)
008240060208     D                                     PREFIX(diz)
008250120615     d trulflbds     e ds
008260080109      * - Aggiunta/Sottrazione di n giorni lavorativi ad una data
008270080109     d TRUL52ds      e ds
008280051123     d* Ds per richiamo fnlsa8r
008290051124     D*PARAM2          DS
008300051123     D* PARAM2: PASSAGGIO AD ANNULLAMENTO ANOMALIE E DATE
008310051124     D**wrvnfv                 2      6  0
008320051124     D**BRVNPG                 7      7  0
008330051124     D**BRVLNP                 8     10  0
008340051124     D**BRVLNA                11     13  0
008350051124     D**BRVNRS                14     15  0
008360051124     D**BRVNSC                16     22  0
008370051124     D**BRVCAN                23     23
008380051124     D**BRVVUC                24     30  6
008390051124     D**PARFLG                31     31
008400051124     D**PARFEL                92     94  0
008410051124     D**BRVNPS                95     96  0
008420051124     D**BRVFGS                97     99  0
008430051124     D**BRVFLE               100    102  0
008440051124     D**BRVpes               103    105  0
008450080410     D dcppflo       e ds
008460080410     D dntw          e ds
008470140121     D dspr          e ds
008480140612
008490140612     d TRULVPODS     e ds
008500140612     d   sk_VPODIR            16    765    inz   dim(250)
008510061212     d*
008520061212     D FNBLP1          DS
008530061212     D  BLPNRR               397    400B 0
008540020212     d*
008550020212     d xw              s              2  0
008560020212     d zw              s              2  0
008570020212     d totale          s              3  0
008580020212     d intero          s              2  0
008590020212     d restof          s              2  0
008600021120     d Ksc8888         s              4  0
008610021120     d DueCtr          s              2  0
008620021120     d Wctr            s                   Like(VidCtr)
008630020212     d*
008640020212     d fedexbrc        ds
008650020212     d  fbrc                   1     11  0 dim(11)
008660020212     d  fchd                  12     12  0
008670020212     d*
008680020212     d base            s              1  0 dim(3)
008690020308     d*
008700020308     d sav_dslsz1      s                   like(dslsz1)
008710021118     d SavGdd          s                   Like(O95Gdd)
008720020308     d w8hcol          s                   like(v8hcol)
008730020308     d w8cnot          s                   like(v8cnot)
008740020308     d wnopos          s              1
008750020319     d clintw          s                   like(§ogntw)
008760081215     d ntwpor          s                   like(§ogntw)
008770020530     d wdisag          s                   like(ot0dos)
008780030305     d savdisag        s                   like(ot0dos)
008790070924     d savpart         s                   like(ot0dos)
008800080307     D WY              s              2  0
008810021203
008820021203     D kpdpdr          S                   LIKE(APDpdr)
008830021203     D kpdtip          S                   LIKE(APDtip)
008840060109     d d_o95lna        s                   like(o95lna)
008850060109     d d_o95znc        s                   like(o95znc)
008860060109     d d_o952ln        s                   like(o952ln)
008870060308     d wcvb            s                   like(ilv85cvb)
008880060522     d kfgs            s                   like(dstfgs)
008890060522     d w_pogest        s                   like(dstfgs)
008900060622     d §lpcad_w        s                   like(§lpcad)
008910060707     d savaogntw       s                   like(§ogntw)
008920061121     d poentw          s                   like(§ogntw)
008930061012     d wdpc            s                   like(pdcdpc)
008940060613     d wsolo_num       s              1
008950060614     d comnrd          s             14  0
008960061218     d savnrr          s                   like(blpnrr)
008970070322     d wparcel         s              2
008980070404     d w_cgi           s                   like(§lpcgi)
008990070404     d lna_sav         s                   like(blplna)
009000070427     d savtb1          s                   like(flgtb1)
009010120926     d savrbl          s                   like(§3arbl)
009020120927     d wagc            s                   like(blpaas)
009030070612     d kedcod          s                   like(tabcod)
009040070612     d kedkey          s                   like(tabkey)
009050070626     d kdpodep         s                   like(dpodep)
009060070626     d kdpoord         s                   like(dpoord)
009070070829     d s_drt           s                   like(viddrt)
009080070829     d s_drtblp        s                   like(viddrt)
009090081111     d s_drtblpi       s                   like(blpdrt)
009100071023     d w_callyco       s              1
009110080313     d k_tbecod        S                   LIKE(tbecod)
009120080313     d k_tbeke1        S                   LIKE(tbeke1)
009130100517     d** wparz           s              1
009140100517     d** wparz_d         s                   like(vidncd)
009150100517     d** wparz_a         s                   like(vidnca)
009160080314     d w_bldncd        s                   like(bldncd)
009170080314     d w_bldnca        s                   like(bldnca)
009180100517     d** no_range        s              1
009190080314     d f_range         s              1
009200090429     d wemznc          s              2  0
009210090429     d wmsgzo          s              1
009220090609     d wmsgtsp         s             78
009230090609     d wvid            s              1
009240090609     d wncl            s                   like(v1cncl)
009250090609     d wpes            s                   like(vidpkg)
009260090609     d wvol            s                   like(vidvol)
009270090609     d wncl_pre        s                   like(v1cncl)
009280090609     d wpes_pre        s                   like(vidpkg)
009290090609     d wvol_pre        s                   like(vidvol)
009300060208     d*
009310060208     D nullPtr         S               *
009320060208     D prmAas          S
009330060208     D                                     LIKE(diz$Aas)
009340060208     D prmLnp          S
009350060208     D                                     LIKE(diz$Lnp)
009360060208     D prmNrs          S
009370060208     D                                     LIKE(diz$Nrs)
009380060208     D prmNsp          S
009390060208     D                                     LIKE(diz$Nsp)
009400060208     D prmFiv          S
009410060208     D                                     LIKE(diz$Fiv)
009420060208     D prmDft          S
009430060208     D                                     LIKE(diz$Dft)
009440060208     D prmNft          S
009450060208     D                                     LIKE(diz$Nft)
009460060208     D prmEsito        S             10I 0
009470020212     d*
009480090325     d $Fine           s               n   inz(*off)
009490090326     d wclg            s                   like(§b4clg)
009500090326     d w_§lpksca       s                   like(§lpksca)
009510090326     d w_§lpctra       s                   like(§lpctra)
009520090326     d s_fnlv59ds      s                   like(fnlv59ds)
009530090326
009540090327     d s_wcliksc       s                   like(wcliksc)
009550090326     d s_wclictr       s                   like(wclictr)
009560090327     d s_ormksc        s                   like(ormksc)
009570090327     d s_ormctr        s                   like(ormctr)
009580140211     d ormloc_n        s                   like(ormloc)
009590110516     d s_wemdest       s                   like(wemdest)
009600140423     d s_wsms          s                   like(wsms)
009610130315     d wsms            s                   like(§vatstel)
009620130315     d wsmp            s                   like(§vatssmp)
009630130918     d wmmp            s                   like(§vatsmmp)
009640130918     d wmmp_ar5        s                   like(§ar5mmp)
009650110705     d s_wcupcup       s                   like(wcupcup)
009660110705     d s_wcupcig       s                   like(wcupcig)
009670110705
009680091211     d nochkticC       s               n   inz(*off)
009690110518     d wfvab           s               n   inz(*off)
009700110818     d werrxco         s               n   inz(*off)
009710111026     d RA_ncd          s                   like(vidncd)
009720111026     d RA_nca          s                   like(vidnca)
009730111026     d RA_ncl          s                   like(savncl)
009740111026     d RA_lna          s                   like(savlna)
009750111026     d wRA_lna         s                   like(blplna)
009760111026     d savtsp73        s                   like(i73tsp)
009770120606     d wstringa        s                   like(§VAT4CUP)
009780121123     d wesar4z         s              1
009790121123     d wtrasmz         s              1
009800121123     d wkscz           s                   like(§b4okc)
009810130219     d wnoZ            s              1
009820130924     d aggioAr8        s              1
009830130927     d w_emd           s              1
009840140424     d w_smp           s              1
009850131003     d n_§clipsm       s                   like(blppkb)
009860131003     d n_§clivlm       s                   like(blpvlb)
009870140110     d posl            s              2  0
009880140110     d posr            s              2  0
009890140110     d lung            s              2  0
009891141202     d lenPC           s              2  0
009900140212     d* Lunghezza di CHARNOOK deve essere:  lunghezza di tbeuni + 1
009910140212     d* Il +1 è necessario per assicurarmi che nella stringa sia sempre
009920140212     d* presente un blank
009930141202     d charnook        s            257
009940140212     d charnookf       s                   like(charnook)
009950140403     d comgf2          s                   like(o95gf2)
009951140716     d wznbrv          s                   like(brvznc)
009952140716     d wdfs            s                   like(brvdfs)
009953140716     d whms            s                   like(brvhms)
009954140716     d wokzona         s              1
009955150202     d wLocNorm        s                   like(o95loc)
009956141202     d charPCok        s            256
009960011211     D                SDS
009970011211     D  NOMPGM                 1     10
009980930629     D*
009990930629     D* DEFINIZIONE COSTANTI
010000930629     D*
010010990610     D CPREPA          C                   CONST('FRANCO PREPAGATO')
010020990610     D CNOSEQ          C                   CONST('NON SEQUENZIALI')
010030941011     D CULTSP          C                   CONST('ULTIMA SPEDIZIONE: ')
010040941011     D CVARIA          C                   CONST('S P E D I Z I O N E')
010050941011     D CCONFE          C                   CONST('BOLLA DA CONFERMARE')
010060941231     D CPDC            C                   CONST('su Piano dei Conti')
010070950303     D CPIVA           C                   CONST('Partita IVA:')
010080050427     D CAUT            C                   CONST('(AUT.       ) ENTER x FORZ.')
010090980115     D CMAIUS          C                   CONST('ABCDEFGHIJKLMNOPQRS-
010100980115     D                                     TUVWYXZ')
010110980115     D CMINUS          C                   CONST('abcdefghijklmnopqrs-
010120980115     D                                     tuvwyxz')
010130991214     D CDPD            C                   CONST('PARCEL DPD: ')
010140020726      * - Società chiave per tabella "YIV"
010150020725     D C_Soc           c                   const('201')
010160010209     D*
010170010209     D* CAMPO PER DSPATR "REVERSE IMAGE"        DEI CAMPI A VIDEO
010180010209     D RIMM            C                   CONST(X'21')
010190040610     D* CAMPO PER DSPATR "HI" + "UL"            DEI CAMPI A VIDEO
010200040610     D HIUL            C                   CONST(X'26')
010210040610     D* CAMPO PER DSPATR "RI" + "UL"            DEI CAMPI A VIDEO
010220040610     D RIUL            C                   CONST(X'25')
010230010209     D* CAMPO PER DSPATR "NO DISPLAY"+"PROTECT" DEI CAMPI A VIDEO
010240010209     D NDPR            C                   CONST(X'A7')
010250011122     D* CAMPO PER DSPATR "PROTECT" + "HI"       DEI CAMPI A VIDEO
010260011122     D PROT            C                   CONST(X'A2')
010270040609     D* CAMPO PER DSPATR "PROTECT" + "RI"       DEI CAMPI A VIDEO
010280040609     D PRRI            C                   CONST(X'A1')
010290010219     D* CAMPO PER DSPATR "NO DISPLAY"
010300010219     D NODI            C                   CONST(X'27')
010310070801     D* CAMPO PER DSPATR "Blinking"
010320111206     D*BLNK            C                   CONST(X'28')
010330111206     D BLNK            C                   CONST(X'2E')
010340061110     D* CAMPO PER DSPATR "UL"
010350061110     D ul              C                   CONST(X'24')
010360030304     D* CAMPO PER DSPATR "PROTECT"+ HI + UL     DEI CAMPI A VIDEO
010370030304     D PROT1           C                   CONST(X'A6')
010380030627      * testo x cliente tassazione bolle FW
010390030627     d wnotfw          c                   Const('cliente tassazione')
010400130117
010410130117      // - Tabella OSR
010420130117     d c_tabosr        c                   const('OSR')
010430080307
010440080307     D digits          c                   '0123456789'
010450130117
010460130117      // - Reperimento tabella
010470130117     d tibs02r         pr                  extpgm('TIBS02R')
010480130117     d  kpjba                              likeds(kpjba)    const
010490130117     d  dsbs02                             likeds(dsbs02)
010500140423
010510140423      // ? PROTOTIPI ?
010520140423      /copy gaitrasrc/srcprotopr,ubchkcel
010530140423      /copy gaitrasrc/srcprotopi,ubchkcel
010540130117
010550020917     IFIVAD000
010560020917     I              VADATB                      BLDATB
010570941230     I              VADCCM                      BLDCCM
010580941230     I              VADLNP                      BLDLNP
010590941230     I              VADAAS                      BLDAAS
010600941230     I              VADNRS                      BLDNRS
010610941230     I              VADNSP                      BLDNSP
010620941230     I              VADCDP                      BLDCDP
010630941230     I              VADNCL                      BLDNCL
010640941230     I              VADNCD                      BLDNCD
010650941230     I              VADNCA                      BLDNCA
010660000208     IFISGN000
010670000204     I              SGNFLS                      §LDLNP
010680000204     I              SGNDLP                      §LDDLP
010690000204     I              SGNCDP                      §LDCDP
010700000204     I              SGNNRS                      §LDNRS
010710000208     I              SGNNCD                      §LDNCD
010720000204     I              SGNLNA                      §LDLNA
010730000204     I              SGNDLA                      §LDDLA
010740000204     I              SGNTNA                      §LDTNA
010750000204     I              SGNTSP                      §LDTSP
010760000207     I              SGNZSC                      §LDZSC
010770000204     I              SGNNC1                      §LDNC1
010780000204     I              SGNNC2                      §LDNC2
010790000204     I              SGNRSM                      §LDRSM
010800000204     I              SGNPRM                      §LDPRM
010810000204     I              SGNRSD                      §LDRSD
010820000204     I              SGNCAD                      §LDCAD
010830000204     I              SGNIND                      §LDIND
010840000204     I              SGNLOD                      §LDLOD
010850000204     I              SGNPRD                      §LDPRD
010860000204     I              SGNCPD                      §LDCPD
010870000204     I              SGNNCP                      §LDNCP
010880000204     I              SGNNCU                      §LDNCU
010890050421     I              SGNRST                      §LDRST
010900000204     I              SGNVOL                      §LDVOL
010910000204     I              SGNPKG                      §LDPKG
010920000204     I              SGNFVR                      §LDFVR
010930000204     I              SGNAAS                      §LDAAS
010940000204     I              SGNMGS                      §LDMGS
010950000208     I              SGNTST                      §DETST
010960000208     I              SGNTSE                      §DETSE
010970000208     I              SGNSSE                      §DESSE
010980000208     I              SGNSIP                      §DESIP
010990000208     I              SGNSIA                      §DESIA
011000000208     I              SGNAWB                      §DEAWB
011010000208     I              SGNISA                      §DEISA
011020000208     I              SGNFCA                      §DEFCA
011030000208     I              SGNEUR                      §DEEUR
011040000208     I              SGNXX1                      §DEXX1
011050000208     I              SGNXX2                      §DEXX2
011060001005     IFISGN005
011070001005     I              SGNFLS                      §LDLNP
011080001005     I              SGNDLP                      §LDDLP
011090001005     I              SGNCDP                      §LDCDP
011100001005     I              SGNNRS                      §LDNRS
011110001005     I              SGNNCD                      §LDNCD
011120001005     I              SGNLNA                      §LDLNA
011130001005     I              SGNDLA                      §LDDLA
011140001005     I              SGNTNA                      §LDTNA
011150001005     I              SGNTSP                      §LDTSP
011160001005     I              SGNZSC                      §LDZSC
011170001005     I              SGNNC1                      §LDNC1
011180001005     I              SGNNC2                      §LDNC2
011190001005     I              SGNRSM                      §LDRSM
011200001005     I              SGNPRM                      §LDPRM
011210001005     I              SGNRSD                      §LDRSD
011220001005     I              SGNCAD                      §LDCAD
011230001005     I              SGNIND                      §LDIND
011240001005     I              SGNLOD                      §LDLOD
011250001005     I              SGNPRD                      §LDPRD
011260001005     I              SGNCPD                      §LDCPD
011270001005     I              SGNNCP                      §LDNCP
011280001005     I              SGNNCU                      §LDNCU
011290001005     I              SGNVOL                      §LDVOL
011300001005     I              SGNPKG                      §LDPKG
011310001005     I              SGNFVR                      §LDFVR
011320001005     I              SGNAAS                      §LDAAS
011330001005     I              SGNMGS                      §LDMGS
011340001005     I              SGNTST                      §DETST
011350001005     I              SGNTSE                      §DETSE
011360001005     I              SGNSSE                      §DESSE
011370001005     I              SGNSIP                      §DESIP
011380001005     I              SGNSIA                      §DESIA
011390001005     I              SGNAWB                      §DEAWB
011400001005     I              SGNISA                      §DEISA
011410001005     I              SGNFCA                      §DEFCA
011420001005     I              SGNEUR                      §DEEUR
011430001005     I              SGNXX1                      §DEXX1
011440001005     I              SGNXX2                      §DEXX2
011450930611     IAZORG01L  AA
011460000000     I/SPACE 3
011470900504     C****************************************************************
011480900504     C*  RIEPILOGO INDICATORI
011490011115     C* N.B.: IL 92,93 E 99 SONO RIUTILIZZABILI DOPO AVERLI TOLTI ANCHE
011500011115     C*       DAL FORMATO VIDEO
011510900504     C***************************************************************
011520990628     C* 01    - ON-RICERCA ANAGRAFICA ATTIVATA
011530940825     C* 02    - PROTEGGO MITTENTE IN 2 VIDEATA
011540941103     C* 03    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE ORIGINALE
011550900504     C* 04    - BOLLA ASSEGNATO
011560940920     C* 05    - ESISTE 2 BOLLA E NON E' TASSATO DESTINO
011570010222     C* 06    - POSIZIONAMENTO CURSORE SU NUMERO ORM DAL SECONDO GIRO
011580040915     C*         IN POI SE ATTIVATA PRCEDURA ORM
011590960926     C* 07    - IL PRIMO GIRO SI POSIZIONA SUL COD AUTOTRASPORTATORE
011600940928     C*         DAL 2 IN POI SUL MITTENTE
011610900507     C* 08    - TASSATO DESTINO
011620940922     C* 09    - EMETTO IL TIPO SERVIZIO IN "RI" SE DA TARIFFA
011630941004     C* 10    - EVIDENZIO IL CODICE ISO DELLA P.IVA SE IMPOSTATO DA NAZ
011640941219     C* 11    - CHANGE SU C/ASSEGNO
011650941219     C* 12    - PROVENGO DA MANUTENZIONE
011660940920     C* 13    - PROTEGGO IL CODICE OPERATORE QUANDO NON MODIFICABILE
011670991130     C*          E SE LNP DPD, *IN79=*ON, PROTEGGO RMN
011680940913     C* 14    - SPROTEGGO LA LNP CLIENTE E MI POSIZIONO
011690900824     C* 15    - PROVENGO DA CARICAMENTO BOLLE DA DISK CLIENTI
011700940825     C* 16    - IMMISS.  BOLLE - PERSONALIZ.DATA CONSEGNA RICHIESTA
011710940825     C* 17    - IMMISS.  BOLLE - PERSONALIZ.TIPO CONSEGNA RICHIESTA
011720930329     C* 18    - IMMISS.  BOLLE - PERSONALIZ.ESPRESSO
011730940825     C* 19    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE
011740930329     C* 20    - IMMISS.  BOLLE - PERSONALIZ.LINEA ARRIVO
011750930329     C* 21    - IMMISS.  BOLLE - PERSONALIZ.CODICE BOLLA
011760990630     C* 22    - PROTEZIONE DATI FATTURA E VISUAL.TOT.FATTURA PER PREPAG
011770940920     C* 23    - IMMISS.  BOLLE - PERSONALIZ.ORA  CONSEGNA RICHIESTA
011780930329     C* 24    - IMMISS.  BOLLE - PERSONALIZ.DATA SPEDIZIONE
011790940826     C* 25    - CTM PER CREAZIONE SEGNACOLLI
011800930329     C* 26    - IMMISS.  BOLLE - PERSONALIZ.COD TRATTAM MERCE
011810940825     C* 27    - IMMISS.  BOLLE - PERSONALIZ. DELLA NATURA MERCE
011820930329     C* 28    - IMMISS.  BOLLE - PERSONALIZ.COD TARIFFA MITTENTE
011830930329     C* 29    - IMMISS.  BOLLE - PERSONALIZ.IL CODICE TARIFFA
011840900508     C* 30/32 - DI COMOD RIUTILIZZABILI
011850980219     C* 33    - PROTEGGO LA DIVISA DEL C/A
011860000928     C*         IN MANUTENZIONE MI SERVE PER AGGIORNAMENTO FNBLD
011870000928     C*         IN CONFERMA DISK (DISK C EX DISK B) LO ACCENDO PER
011880000928     C*         DISABILITARE AGGIUNTA COD.CHI SONO
011890990610     C* 34    - ELABORAZIONE PER PREPAGATI
011900940926     C* 35    - SFLDSP
011910940825     C* 36    - BOLLE DISK CLI - ON -POSIZIONAMENTO CURSORE SU VOLUME
011920931123     C*       - BOLLE DISK CLI - OFF-POSIZIONAMENTO CURSORE SU SEGNACOL
011930010222     C* 37    - IMMISS.  BOLLE - PERSONALIZ.NUMERO ORM
011940941020     C* 38    - POSIZIONAMENTO CURSORE STD SE SPENTO.
011950941020     C*         SE ACCESO SIGNIFICA CHE E' STATO ATTIVATO UN ALTRO POSZ
011960960319     C* 39    - PROTEGGO LA P.IVA DEL MITTENTE
011970960319     C* 40/84 - ERRORE
011980940826     C* 44    - BOLLE DISK CLI - SE DA GIACENZE O CAMBIO PORTO
011990930330     C*          E MANUT BOLLE -   NO VARIAZIONE DEL TIPO BOLLA
012000960319     C* 71/73 - ERRORE SU CAP/NAZIONE/RAGIONE SOCIAL MITTENTE ORIGINALE
012010980219     C* 76    - PROTEZIONE DEI CAMPI TIPO INCASSO C/A SE EXPORT
012020000905     C* 77    - ERRORE SU FLAG DDT
012030000830     C* 78    - INDICATORE SFLDSP PER SFL COD."CHI SONO"
012040991130     C* 79    - PROTEZIONE DEL RIF.ALFABETICO PER BOLLE DPD E SE CODICE
012050991130     C*          OPERATORE NON MODIFICABILE, *IN13=*ON, PROTEGGO RMN
012060950303     C* 85    - IMMISS.  BOLLE - PERSONALIZ.SOLO COD CLIENTE
012070961111     C* 86    - ERRORE SULLE NOTE
012080961111     C* 87    - PROTEZIONE DELLA TASSAZIONE SE PGM RICHIAMO DA GIACENZE
012090950410     C* 88    - change su VALORE MERCE DICHIARATO
012100941219     C* 89    - change su importo da assicurare
012110941219     C* 90    - SEGNALA LA PRESENZA DI ERRORI
012120960319     C* 91    - IMMISS.  BOLLE - PERSONALIZ.I GIORNI DI CHIUSURA
012130011115     C* 92    - EVIDENZIO DIVISA IMP ASSIC SE DA MITTENTE(E NON E' IT)
012140011115     C* 93    - EVIDENZIO DIVISA C/A       SE DA DESTINAT(E NON E' IT)
012150930414     C* 94    - BOLLE DISK CLI - ABILITO CM21 X GEST. DETT.STAMPA SEGN
012160940922     C* 95    - ABILITA INSERIM.SERIE PER BOLLETTAZIONE
012170940922     C*         CLIENTI CON SERIE CHE DANNO SOLO ETICH
012180980324     C* 96    - BOLLE DISK CLI - ABILITO F22 X GEST.ESTENS. DETT.COLLI
012190940922     C* 97    - EMETTO I CAMPI RIPRESI DA TARIFFA IN "RI"
012200940922     C* 98    - BOLLE DI RECUPERO
012210011115     C* 99    - EVIDENZIO DIVISA VAL MERCE SE DA MITTENTE(E NON E' IT)
012220900504     C*****************************************************************
012230930611     C     *ENTRY        PLIST
012240930611     C                   PARM                    KPJBA
012250991007     C                   PARM                    DBLP
012260991007     C                   PARM                    DTASV
012270030610     C                   PARM                    trul90ds
012280030610      *
012290030610      * Il numero dei parametri ricevuti è testato, in caso di modifica
012300030610      *  ricercare la stringa "%PARMS"
012310020917      *
012320021002      * Controllo se p.o. gestione numerico
012330021002     C                   IF        %subst(§lpfgs:1:1) < '0' or
012340021002     C                             %subst(§lpfgs:2:1) < '0' or
012350021002     C                             %subst(§lpfgs:3:1) < '0'
012360021002     C                   clear                   §fgs              3 0
012370021002     C                   ELSE
012380021002     C                   movel     §lpfgs        §FGS
012390021002     C                   ENDIF
012400030409      * controllo le ore
012410030409     c                   IF        %subst(§lpore:1:1) < '0' or
012420030409     c                             %subst(§lpore:2:1) < '0'
012430030409     c                   Clear                   §ore
012440030409     c                   Else
012450030409     c                   Move      §lpOre        §ore
012460030409     c                   EndIf
012470001219     C*
012480000000     C*----------------------------------------------------*
012490930628     C* §LPFPR = 'M' VENGO DA MANUTENZIONE   : CHIUDO IN RETRN
012500930628     C* §LPFPR = 'X' VENGO DA DISK CLI       : CHIUDO IN RETRN
012510930628     C* §LPFPR = 'V' VENGO DA DISK CLI       : CHIUDO IN RETRN
012520950419     C* §LPFPR = 'W' VENGO DA DISK CLI       : CHIUDO IN RETRN
012530050407     C* §LPFPR = 'R' VENGO DA REC BOL DSK CLI: CHIUDO IN RETRN --> OBSOLETO
012540010213     C* §LPFPR = 'O' VENGO DA CONFERMA O.R.M.: CHIUDO IN RETRN
012550990602     C* §LPFPR = 'G' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
012560941230     C* §LPFPR = 'P' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
012570941230     C*              NON DEVO STAMPARE LA BOLLA
012580930628     C* §LPFPR = 'I' VENGO DA INVIO DISPOSIZ : CHIUDO CON LR
012590020522     C* §LPFPR = 'T' VENGO DA RITIRI ANNULLATI:CHIUDO CON LR
012600030609      *                  o da ORM commissionati
012610930707     C* §LPFPR = 'C'                           CHIUDO CON LR
012620900511     C*
012630941020     C* CODICI DI RITORNO:
012640941020     C* §LPFPR = '1'                           BOLLA ANNULLATA
012650111007     C* §LPFPR = '2'                           Richiesto annullamento VAB...
012660000517     C* §LPFPR = '3'                           CMD03
012670941020     C* §LPFPR = '4'                           CMD12
012680941020     C* §LPFPR = '5'                           TROVATI ERRORI IN CONFER
012690000627     C*
012700000627     C* §LPFLG = 'C' - EFFETTUARE SOLO CONTROLLI RESTITUENDO DBLP
012710000627     C*                AGGIORNATA
012720930707    1C     §LPFPR        IFEQ      'C'
012730930628     C     §LPFPR        OREQ      'G'
012740930628     C     §LPFPR        OREQ      'I'
012750950102     C     §LPFPR        OREQ      'P'
012760020522     C     §LPFPR        OREQ      'T'
012770930628     C                   SETON                                        LR
012780010103   X1C                   ENDIF
012790010103     C*
012800010103     C     *LIKE         DEFINE    §LPFPR        SAVFPR
012810010103     C                   CLEAR                   SAVFPR
012820010103    1C     §LPFPR        IFEQ      'G'
012830010103     C     §LPFPR        OREQ      'P'
012840020522     C     §LPFPR        OREQ      'T'
012850010103     C                   MOVEL     §LPFPR        SAVFPR
012860010103     C                   ENDIF
012870011029      * PULISCO CAMPO DI ATTRIBUTI VISUALIZZAZIONE X 'FLAG TARIFFA MITTENTE'
012880011029     C                   CLEAR                   ATRFTM
012890030911      * pulisco ds di work del numero ORM
012900030911     c                   Clear                   widorm
012910040506      * pulisco ds di work del numero bolla da dsblp
012920040506     c                   Clear                   widspe
012930091221      * pulisco campo appoggio per particolarità consegna
012940091221     c                   clear                   wvidgma
012950100604     c                   clear                   w7rRC
012951141202     c                   clear                   w7rPC
012960111007     C* Attributo di visualizzazione F16=Annull:
012970111007     c* in conferma     è da visualizzare solo se richiamata con "X" o "V"
012980111007     c* in manutenzione sempre
012990111007     c                   clear                   atrann
013000111007     c                   if        *in15 and §lpfpr<> 'V' and §lpfpr <>'X'
013010111007     c                   movel     nodi          atrann
013020111007     c                   endif
013030900509     C* PULISCO CAMPI FOR02 E FOR03
013040941115    1C     §LPFPR        IFNE      'C'
013050000829     C                   EXSR      INZ08
013060991203     C                   EXSR      INZ07
013070991203     C                   EXSR      INZ06
013080971210     C                   EXSR      INZ03
013090941011     C                   EXSR      INZ02
013100940819     C                   EXSR      INZ01
013110930628     C*  MANUTENZIONE
013120950102     C   12
013130950102     CANN15              DO
013140950102     C                   EXSR      CARBLP
013150950102     C   90              GOTO      FINE
013160950102     C                   ENDDO
013170950126     C*
013180930628     C*  CARICAMENTO BOLLE DA DISK CLI
013190900824     C   12
013200900824     CAN 15              EXSR      CARBLC
013210010301     C*  CARICAMENTO DA CONFERMA ORM PREPAGATI
013220010301     C     §LPFPR        IFEQ      'O'
013230010301     C                   EXSR      CARBLO
013240010301     C                   ENDIF
013250010209     C*
013260010209     C*  HO CARICATO LA VIDEATA: VERIFICO SE ATTIVATA PROC. O.R.M.
013270010209     C*  SE PGM RICHIAMATO DA GIACENZE O CONFERMA BOLLE LA PROCED. ORM
013280010209     C*  NON E' ATTIVATA SE P.O. EMITTENTE = 0
013290010219     C                   Z-ADD     VIDLNP        WLNPO
013300010209     C*  NEGLI ALTRI CASI FACCIO CHAIN SU ORGANIGRAMMA
013310010209     C                   EXSR      ATTORM
013320010219     C* SE SONO IN MANUTENZIONE E ORM FITTIZIO IMPOSTO NUMERO ORM A VI-
013330010219     C* DEO
013340010219     C     WORM          IFEQ      'S'
013350010219     C     *IN12         ANDEQ     *ON
013360010219     C     *IN15         ANDEQ     *OFF
013370010219     C     VIDPOE        ANDEQ     *ZEROS
013380010219     C                   Z-ADD     VIDLNP        VIDPOE
013390010219     C                   MOVE      *ALL'9'       VIDNOR
013400010219     C                   MOVE      *ALL'9'       VIDNRV
013410010219     C                   MOVEL     VIDORM        W01ORM
013420070627     C                   MOVEL     VIDORM        s_dsbl4m
013430010219     C                   ENDIF
013440010502     C* IN IMMISSIONE E NO PREPAGATO E PROCEDURA ORM ATTIVA IL FLAG
013450010502     C* MATTINO/POMERIGGIO LO LASCIO VUOTO
013460010502     C     WORM          IFEQ      'S'
013470010502     C     *IN12         ANDEQ     *OFF
013480010502     C     PARTCH        ANDNE     'P'
013490010502     C     §LPFPR        ANDNE     'O'
013500010502     C                   CLEAR                   VIDFPP
013510010502     C                   ENDIF
013520010209     C*
013530910108     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
013540910108     C*    AI CONTROLLI
013550940214     C   12
013560940214    2CAN 15§LPFPR        IFNE      'V'
013570910108     C                   GOTO      CT1TAG
013580940214    2C                   END
013590900427     C*
013600900427     C     FOR01         TAG
013610121017      * Se la data del giorno è compresa nel range dal/al per blocco immiss.
013620121017      * prepagati (tabella DGD) --> ERRORE
013630041217     c                   If        (Partch = 'P' or §LpFpr = 'O') and
013640121017     c                              dateu>= §dgdbpd and dateu<=§dgdbpa
013650121017     c****                          Dateu = §vpodip
013660041217     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
013670041217     c                             spedizioni in Porto Prepagato'
013680041217     c                   Eval      *In90 = *On
013690041217     c                   EndIf
013700940825     C* V I D E O   1
013710050119     c                   z-add     VIDORM        S_VIDORM
013720940819     C                   EXFMT     LS01D01
013730941003     C*
013740941003     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
013750950126     C                   EXSR      OFFD01
013760900427     C* CMD3 - FINE LAVORO
013770920713     C   KL
013780920713     CAN 12
013790920713     CAN 15              MOVEL     '4'           §LPFPR
013800000518     C   KC
013810000518     CAN 12
013820000518     CAN 15              MOVEL     '3'           §LPFPR
013830010308     C* IDEM SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI (IN QUESTO
013840010308     C* CASO *IN12 = OFF
013850010308     C     §LPFPR        IFEQ      'O'
013860010308     C   KL              MOVEL     '4'           §LPFPR
013870010308     C   KC              MOVEL     '3'           §LPFPR
013880010308     C   KC
013890010308     COR KL              GOTO      FINE
013900010308     C                   ENDIF
013910940825     C   KC
013920940825     COR KL
013930940825     CAN 12              GOTO      FINE
013940121017      * Se la data del giorno è nel range dal/al per blocco immissione
013950121017      * prepagati (tabella DGD) ---> ERRORE
013960050215     c                   If        (Partch = 'P' or §LpFpr = 'O') and
013970121017     c                              dateu>=§dgdbpd and dateu<=§dgdbpa
013980121017     c****                          Dateu = §vpodip
013990050215     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
014000050215     c                             spedizioni in Porto Prepagato'
014010050215     c                   Eval      *In90 = *On
014020050215     c                   goto      for01
014030050215     c                   EndIf
014040940819     C*
014050900427     C* CMD13 - PERSONALIZZAZIONE CAMPI
014060940819     C     *INKM         IFEQ      *ON
014070940819    2C                   EXSR      GESD00
014080010305     C   KC§LPFPR        IFEQ      'O'
014090010305     C                   MOVEL     '3'           §LPFPR
014100010305     C                   ENDIF
014110940819     C   KC              GOTO      FINE
014120040908     c* se personalizzato n. orm prima di riemettere la videata di
014130040908     c* bollettazione devo effettuare i controlli per poporre eventuali
014140040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
014150040908     c* porti allo stesso modo di quando dalla prima videata viene
014160040908     c* immesso il numero orm con la pistola (enter automatico)
014170041221     c***37              exsr      ctrd01
014180041221     c                   if        *in37 = *on
014190050119     c***                if        flgfit <> 'S' and s_v0corm <> V0corm
014200050119     c                   if        flgfit <> 'S'
014210050119     c* passo flag a ctrd01 per dire di riemettere la videata dopo aver
014220050119     c* elaborato eventuali proposte a prescindere dal fatto che vi siano
014230050119     c* dati da proporre o meno (serve per non dare errore sul n.colli blocc
014240050119     c* ando così la tastiera)
014250050119     c                   eval      wsolo_prp = '1'
014260041221     c                   exsr      ctrd01
014270041221     c                   else
014280041221     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
014290041221     c* (per uniformità: fa così anche per orm reale)
014300050117     c* Idem se orm non fittizio ma rimasto invariato
014310041221     c  n38              z-add     13            h1riga
014320041221     c  n38              z-add     20            h1colo
014330041221     c                   endif
014340041221     c                   endif
014350940825     C                   GOTO      FOR01
014360940819     C                   ENDIF
014370930330     C**
014380051207     C* F16 - ANNULLAMENTO
014390111007    2C     *INKQ         IFEQ      *ON
014400111007    3c     atrann        ifeq      *blanks
014410110516     c* window per richiesta conferma
014420110516     c                   exsr      sr_geswdwconf
014430111007    4c                   select
014440111007   whc                   when      wvann='N'
014450110516     c                   goto      for01
014460111007   whc                   when      wvann='S'
014470111007     c* f16 in manutenzione --> cancello bolla da blp e file collegati
014480111007    5c                   if        *in15=*off
014490930915     C                   EXSR      ANNULL
014500111007    6C                   if        wf12 = '1' or *in90 = '1'
014510060307     c                   goto      for01
014520111007    6c                   endif
014530930915     C                   GOTO      FINE
014540111007   x5c                   else
014550111007     c* f16 in conferma --> ritorno al chiamante codice '2' per far cancellare
014560111007     c* vab e suoi collegati
014570111007     c                   eval      §lpfpr='2'
014580111007     C                   GOTO      FINE
014590111007    5c                   endif
014600111007    4c                   endsl
014610111007   x3c                   else
014620111007     c* se premuto f16 ma non è abilitato riemetto la videata
014630111007     c                   goto      for01
014640111007    3c                   endif
014650940214    2C                   END
014660010216     C**
014670051207     C* F8 - INTERROGAZIONE O.R.M.
014680010223     C     *INKH         IFEQ      *ON
014690010219     C     WORM          ANDEQ     'S'
014700010227     C     PARTCH        ANDNE     'P'
014710010220     C     VIDNOR        ANDEQ     *ZEROS
014720111122     c* se lnp import continuo a richiamare FIOR04R
014730111122     c*****              if        %lookup(vidlnp:fio)=0
014740111122     c****                         and %lookup(999:fio)=0
014750111122     c                   if        vidlnp<>prelnp
014760111122     c                   clear                   og143
014770111122     C     vidlnp        CHAIN     AZORG01L      UNIORG
014780111122     c                   if        %found(azorg01l)
014790111122     C                   MOVEL     ORGDE3        OG143
014800111122     c                   endif
014810111122     c                   eval      prelnp=vidlnp
014820111122     c                   endif
014830111122     c                   if        §ogntw='DPD' or §ogntw='EEX' or
014840111122     c                             §ogntw='FED'
014850010216     C                   CLEAR                   DSOR04
014860010216     C                   MOVEL     '1'           I04RIC
014870051207     C                   Z-ADD     VIDLNP        I04POR
014880051207     c
014890051207     c* Richiamo tnsb51r per vedere che p.o. ritiro passare
014900051207     c                   if        *in12 and not *in15 and vidccm>0
014910051212     c                   clear                   tntb50ds
014920051207     C                   move      VIDCCM        b50ke2
014930051207     C*
014940051207    3C     VIDFLC        IFEQ      0
014950051207     C                   MOVEL     VIDLNP        b50ke2
014960051207     C                   ELSE
014970051207     C                   MOVEL     VIDFLC        b50ke2
014980051207    3C                   ENDIF
014990051207     c
015000051207     c                   movel     b50ke2        b50ke1
015010051207     c* controllo linea
015020051207     c                   movel     'C'           b50opz
015030051207     c                   movel     vidlnp        b50poa
015040051207     c                   call      'TNTB51R'
015050051207     c                   parm                    kpjba
015060051207     c                   parm                    tntb50ds
015070051207     c
015080051214     c                   if        b50err=' ' and b50ormreso>*zeros
015090051207     c                   movel     b50ormreso    i04por
015100051207     c                   endif
015110051207     c                   endif
015120051207     c
015130010216     C                   CALL      'FIOR04R'
015140010216     C                   PARM                    KPJBA
015150010216     C                   PARM                    DSOR04
015160010216     C     O04CM3        IFEQ      *BLANKS
015170010216     C                   Z-ADD     O04POE        VIDPOE
015180010222     C                   MOVEL     O04NSR        VIDNOR
015190010222     C                   MOVE      O04NOR        VIDNOR
015200010216     C                   Z-ADD     O04NRV        VIDNRV
015210050117     c                   eval      *inkh = '0'
015220050117     c                   else
015230010216     C                   GOTO      FOR01
015240050117     c                   endif
015250110419     c                   else
015260110419     c                   if        vidpdr<=*zeros
015270110419     c                   eval      *in90='1'
015280110419     c                   eval      *in56='1'
015290110419     c                   eval      vidmsg=err(210)
015300110419     c                   goto      for01
015310110419     c                   else
015320110419     c                   clear                   fior58ds
015330110419     c                   movel     vidlnp        ior58pdr
015340110419     c                   move      vidpdr        IOR58PDR
015350110419     C                   CALL      'FIOR58R'
015360110419     C                   PARM                    KPJBA
015370110419     C                   PARM                    fior58ds
015380110419     C     OOR58F03      IFEQ      *BLANKS
015390110419     C                   Z-ADD     OOR58POE      VIDPOE
015400110419     C                   MOVEL     OOR58NSR      VIDNOR
015410110419     C                   MOVE      OOR58NOR      VIDNOR
015420110419     C                   Z-ADD     OOR58NRV      VIDNRV
015430110419     c                   eval      *inkh = '0'
015440110419     c                   else
015450110419     C                   GOTO      FOR01
015460110419     c                   endif
015470110419     c                   endif
015480110419     c                   endif
015490010216     C                   ENDIF
015500010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
015510010227     C* SE NON SEMPRE VISUALIZZATO. SE NON ATTIVATA PROCEDURA ORM
015520010227     C* O SONO NEL GIRO DEI PREPAGATI MIEI RIEMETTO VIDEATA
015530010227     C   KHWORM          IFNE      'S'
015540010227     C     PARTCH        OREQ      'P'
015550010227     C                   GOTO      FOR01
015560010227     C                   ENDIF
015570930915     C*
015580910219     C* CMD21 - GESTIONE DETTAGLIO SEGNACOLLI (SOLO IN DISK CLI)
015590940214    2C   KV              DO
015600950321     C                   MOVEL     §LPCCM        PARCCM
015610991116     C                   MOVEL     §LPAAC        PARAAS
015620920204     C                   MOVEL     §LPNRS        PARNRS
015630911031     C                   MOVEL     §LPLNP        PARLNP
015640911031     C                   MOVEL     §LPLNA        PARLNA
015650911031     C                   MOVEL     §LPNSP        PARNSP
015660020917      * P.O DI GESTIONE
015670021002     C                   MOVEL     §FGS          PARFGS
015680910219     C                   MOVEL     PARAM         KPJBU
015690941230     C                   CALL      'FNLS78R'
015700910219     C                   PARM                    KPJBA
015710910219     C                   GOTO      FOR01
015720940214    2C                   END
015730990701     C* F22 - GESTIONE ESTENSIONE DETT. SEGNACOLLI (SOLO IN DISK CLI)
015740980325    2C   KW              DO
015750000904     C                   EXSR      GESD08
015760980325     C                   GOTO      FOR01
015770980325    2C                   END
015780110512     c* F17-Indirizzo Email destinatario
015790150213     c***                if        *inkr=*on
015800150213     c***                if        atremd=*blanks
015810150213     c***                exsr      sr_geswdwemd
015820150213     c***                endif
015830150213     C***                GOTO      FOR01
015840150213     c***                endif
015850110705     c* F5-Riepilogo bolle da confermare
015860110519     c                   if        *inke=*on
015870110517     c                   Clear                   Fnls80ds
015880110517     c                   Movea     l1            dpog
015890110517     c                   z-add     99            d80Nsr
015900110517     c                   if        vidccm>0
015910110517     C                   MOVE      VIDCCM        d80ccm
015920110517     C     VIDFLC        IFNE      0
015930110517     C                   movel     VIDFLC        d80ccm
015940110517     C                   ELSE
015950110517     C                   movel     VIDLNP        d80ccm
015960110517     C                   ENDIF
015970110517     c                   endif
015980110517     c                   if        vidlna>*zeros
015990110517     c                   Movel     Vidlna        d80lna
016000110517     c                   else
016010110517     c                   z-add     999           d80lna
016020110517     c                   endif
016030110517     c                   call      'FNLS80R'
016040110517     c                   parm                    kpjba
016050110517     c                   parm                    fnls80ds
016060110517     C                   GOTO      FOR01
016070110517     c                   endif
016080110705     c* F19-codici CUP/CIG per tacciabilità flussi finanziari
016090110705     c                   if        *inkt=*on
016100110705     c                   if        atrcup=*blanks
016110110705     c                   exsr      sr_geswdwcup
016120110705     c                   endif
016130110705     C                   GOTO      FOR01
016140110705     c                   endif
016150940825     C*
016160971211     C* F7  - ABILITO CAMPO PER RICERCA ALFABETICA
016170941021     C   KG              SETON                                        0138
016180900427     C   KG              GOTO      FOR01
016190971211     C* F10 - ABILITO CAMPO PUNTO OPERATIVO CLIENTE
016200941020     C   KJ              SETON                                        1438
016210940921     C   KJ              GOTO      FOR01
016220900427     C* CONTROLLI FORMATO1
016230900824     C     CT1TAG        TAG
016240050119     c* imposto flag per dire se fare solo eventuali proposte da orm
016250050119     c* e poi riemettere sempre la videata o se dopo le proposte even
016260050119     c* tuali continuare coi controlli
016270050119     c* Serve perchè se sono stati personalizzati tutti i campi proponi
016280050119     c* bili il pgm emetterebbe messaggio di errore su n.colli bloccand
016290050119     c* la tastiera senza aver dato il tempo al bollettista di inserire
016300050119     c* i dati mancanti
016310050209     c* lo faccio solo se sono in immissione bolle non lo faccio in
016320050209     c* conferma bolle e in manutenzione
016330050209     c                   eval      wsolo_prp = ' '
016340050209     c                   if        s_vidorm = *zeros and *in12 = *off
016350050119     c                   eval      wsolo_prp = '1'
016360050119     c                   endif
016370010216     C                   EXSR      CTRD01
016380950126     C*
016390950126     C* CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
016400950126     C* DI ERRORE
016410950126     C     WEMFOR        IFEQ      '1'
016420010816     C                   EXSR      ESCIER
016430950126     C     §LPFPR        IFNE      '5'
016440950127     C                   GOTO      FOR01
016450950127     C                   ELSE
016460950127     C                   GOTO      FINE
016470950126     C                   ENDIF
016480950126     C                   ENDIF
016490010215     C* RIEMETTO LA VIDEATA PER VISUALIZZARE CAMPI VIDEO DA ORM
016500010215     C     WEFORM        IFEQ      '1'
016510010215     C                   GOTO      FOR01
016520010215     C                   ENDIF
016530010214     C* ESEGUO CONTROLLI DI INCONGRUENZA CON CAMPI DELL'ORM
016540010214     C     WORM          IFEQ      'S'
016550010214     C                   EXSR      CNFOR1
016560010214     C     WEMFOR        IFEQ      '1'
016570010214     C                   EXSR      ESCIER
016580010214     C     §LPFPR        IFNE      '5'
016590010214     C                   GOTO      FOR01
016600010214     C                   ELSE
016610010214     C                   GOTO      FINE
016620010214     C                   ENDIF
016630010214     C                   ENDIF
016640010214     C                   ENDIF
016650020122     C* SE IMMESSA LA NAZIONE EMETTO WINDOW  PER RICHIESTA CONFERMA
016660020131     c* (Se si tratta di nazione per cui è richiesta forzatura (§15FFN="S"))
016670020122     C* IN MANUTENZIONE LA EMETTO SOLO SE È DIVERSA DA QUELLA CHE C'ERA
016680020122    2C     VIDNZD        IFNE      *BLANKS
016690020131     c     DESFFN        ANDEQ     'S'
016700030707      * e se non è una bolla di recupero
016710030707     c     §3arbl        andne     'R'
016720020123     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
016730020123     c* se devo emettere la window o ritornare al chiamante con errore
016740091111     c                   move      '1'           wvidobb           1
016750020123     c                   exsr      escier
016760091111     c                   move      ' '           wvidobb
016770020123    3c     §lpfpr        ifne      '5'
016780020122     C* Manutenzione
016790020123    4C     *IN12         IFEQ      *ON
016800020122     C     *IN15         ANDEQ     *OFF
016810020122     C     VIDNZD        ANDNE     NZDINI
016820020122     C* Immissione
016830020122     C     *IN12         OREQ      *OFF
016840020122     c* Conferma bolle
016850020122     C     *IN15         OREQ      *ON
016860020122     C                   MOVEL     '15'          COD
016870020122     C                   MOVEL(P)  VIDNZD        KEY
016880020122     C                   EXSR      CTABEL
016890020122     C                   MOVEL     TBLUNI        DS15
016900020123     c                   eval      w01nzd = %trim(vidnzd) + '-' + §15des
016910020123     c     §lpfpr        ifne      'V'
016920020123     c                   write     ls01d01
016930020123     c                   endif
016940020124     c     forw01        tag
016950020122     C                   EXFMT     LS01W01
016960020122     C* Se premuto F12 riemetto prima videata.
016970020123     C* Se pgm richiamato con "W" anzichè riemettere la prima videata ritorn
016980020123     c* l'errore al chiamante
016990020123     C   KL              goto      for01
017000020124     c  NKF              goto      forw01
017010020123    4C                   ENDIF
017020020123   x3c                   else
017030020123     c                   goto      fine
017040020123    3c                   endif
017050020122    2C                   ENDIF
017060900926     C*
017070000831     C* DISK C
017080000830     C* Emetto videata per inserimento del cod. CHI SONO" se DISK C
017090020917     C* in bollettazione o se diska senza fivat
017100050223     c* Escludo:
017110050223     C* 1) Bolle export dpd disk c se chi sono non automatico perchè in
017120050223     c*    questo caso il chi sono non viene immesso da sfl
017130050223     c* 2) Bolle import dpd sempre perchè anche in questo caso il chi sono
017140050223     c*    non viene immesso da sfl
017150000913     C  N12
017160000913     COR 12
017170000913     CAN 15§1BF12        IFEQ      'S'
017180001011     C     WEXDPD        ANDNE     'S'
017190050223     c     *in79         andeq     *off
017200001009     C     §1BF12        OREQ      'S'
017210001011     C     WEXDPD        ANDEQ     'S'
017220001009     C     §1BF13        ANDEQ     'A'
017230030321      * se non ho superato i 500 colli
017240030321If  2c                   If        v1cncl <= 500
017250000911     C     FOR09         TAG
017260010816     C* IMPOSTO CAMPI SUBFILE CONTROL
017270010816     C                   MOVE      WKSC          V8CKSC
017280010816     C                   MOVEL     VIDDMT        V8DKSC
017290000904     C                   EXSR      GESD09
017300000914     C     *INKL         CABEQ     *ON           FOR01
017310000830     C* Controllo i dati immessi
017320000830     C                   EXSR      CTRS08
017330000830     C     *IN90         IFEQ      *ON
017340000830     C                   EXSR      ESCIER
017350000830     C     §LPFPR        IFNE      '5'
017360000904     c* Se errore riemetto videata subfile cod.chi sono per poterla
017370000904     c* manutenzionare
017380000904     C                   EXSR      GESD08
017390000904     C   KL              GOTO      FOR01
017400000830     C                   ELSE
017410000830     C                   GOTO      FINE
017420000830     C                   ENDIF
017430000830     C                   ENDIF
017440030321   x2c                   Else
017450030321     c                   Eval      VidMsg = Err(275)
017460030321     c                   Eval      *In90 = *On
017470030321     c                   Eval      *In62 = *On
017480030321     C                   EXSR      ESCIER
017490030321     C     §LPFPR        IFNE      '5'
017500030321     C                   GOTO      FOR01
017510030321     C                   ELSE
017520030321     C                   GOTO      FINE
017530030321     C                   ENDIF
017540030321    2c                   EndIf
017550000830     C                   ENDIF
017560021120
017570021120      * Solo x FedEx richiamo di nuovo il trul27 xchè in questo momento ho anche
017580021120      * il prefisso del segnacollo che mi serve per ricerare la cartello
017590021120      * FedEx giusta
017600021120     c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED') and
017610021120     c                             (Prefisso(1) = 'FD' or Prefisso(1) = 'FM')
017620021120     c                   Clear                   Trul27Ds
017630021120     c                   Movel     Prefisso(1)   I27Tip
017640021120     c                   Exsr      TarCar
017650021120     c                   If        Not *In12
017660021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
017670021120      * a quanto indicato in tabella "DFE"
017680021120     c                   If        O27Fie = 'N' and VidPkg > §DfePkgD
017690021120     c                   Movel     Err(264)      VidMsg
017700021120     c                   Eval      *In90 = *On
017710021120     c                   Eval      *In63 = *On
017720021120     c                   EndIf
017730021120     c                   EndIf
017740021120      * Errori
017750021120     c                   If        *In90
017760021120      * CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
017770021120      * DI ERRORE
017780021120     C                   EXSR      ESCIER
017790021120     C     §LPFPR        IFNE      '5'
017800021120     C                   GOTO      FOR01
017810021120     C                   ELSE
017820021120     C                   GOTO      FINE
017830021120     C                   ENDIF
017840021120     c                   EndIf
017850021120     c                   EndIf
017860021120
017870011107     C* SE ATTIVATA PRCEDURA ORM E NUMERO ORM NON FITTIZIO DEVO
017880010215     C* PROPORRE I CAMPI DELLA SECONDA VIDEATA PRIMA DI EMETTERLA
017890010215     C* LO FACCIO SOLO SE NON SONO IN CONFERMA BOLLE DA DISCHETTO
017900010215     C     WORM          IFEQ      'S'
017910010215     C     FLGFIT        ANDNE     'S'
017920010215     C     PARTCH        ANDNE     'P'
017930070427     C     *IN12         IFEQ      *OFF
017940070427     C     *IN15         OREQ      *OFF
017950010215     C* in manutenzione propongo solo se variato il numero ORM
017960070427     C     WORMMD        ANDEQ     '1'
017970010215     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
017980010215     c* fine dell'immissione
017990010215     C                   EXSR      PRPOR2
018000010220     C* SE SONO IN MANUTENZIONE SEGNALO CHE POTREBBERO ESSERE VARIATI
018010010220     C* DEI DATI PRENDENDOLI DAL NUOVO N.ORM
018020010220     C   12
018030010220     CANN15WPRIMV        IFEQ      *BLANKS
018040010220     C                   SETON                                        90
018050010220     C                   MOVEL     ERR(226)      VIDMSG
018060010220     C                   MOVEL     '1'           WPRIMV            1
018070010220     C                   ENDIF
018080010215     C                   ENDIF
018090091008     c* se bolla import     porto assegnato abbinata ad orm devo proporre
018100070427     c* il mittente dell'orm nel mittente originale
018110091008     c***                if        *in79 and flgtb1='A'
018120091008     c                   if        flgtb1='A' and (§ogntw='EEX' or
018130091008     c                             §ogntw='FED' or §ogntw='DPD')
018140070427     c                   if        *in12='0' or *in15 or
018150070427     c                             (*in15='0' and (wormmd='1' or
018160070427     c                             (flgtb1='A' and flgtb1<>savtb1)))
018170070427     c                   exsr      prpor2_rmo
018180070427     c                   endif
018190070427     c                   endif
018200010215     C                   ENDIF
018210001020     C*
018220001020     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
018230001020     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
018240060113     C** 12
018250060113    2C**AN 15§LPFPR        IFNE      'V'
018260060113     C***                   GOTO      TAG02
018270060113    2C**                   END
018280040226
018290040227      * Salto il prossimo controllo se bolla con Lnp o Lna DPD
018300040227S   1c                   Select
018310040227     c                   When      *In79
018320040227     c                   When      VidDpd = 'D' or a_§OgNtw = 'DPD'
018330040227     c                   Other
018340040226      * se orm con serie devo recuperare i riferimenti del mittente
018350040226      * immessi nella bolla originale legata al ritiro contestuale
018360040226      * se previsto da tabella 'OSR'
018370040227      * non forzo se bolla con Lna o Lnp DPD
018380040227if  2c                   If        wonsr > *Zeros and flgfit <> 'S' and
018390040227     c                             (d§OsrRmn = 'S' or d§OsrRma = 'S')
018400040226      * richiamo pgm x recupero dei riferimenti
018410040226     c                   Clear                   Fnls26ds
018420040227     c                   Move      wrmaas        I26Aas
018430040227     c                   Move      wrmlnp        I26Lnp
018440040227     c                   Move      wrmnrs        I26Nrs
018450040227     c                   Move      wrmnsp        I26Nsp
018460040226     c                   Call      'FNLS26R'
018470040226     c                   Parm                    Fnls26ds
018480040227if  3c                   If        O26Err = *Zeros
018490040227if  4c                   If        d§OsrRmn = 'S'
018500040227     c                   Eval      VidRmn = O26Rmn
018510040226      * proteggo il campo
018520040226     c                   Movel     Prot1         AtrRmn
018530040226     c                   Eval      wrifm = *On
018540040227    4c                   EndIf
018550040227if  4c                   If        d§OsrRma = 'S'
018560040226     c                   Eval      VidRma = O26Rma
018570040226      * proteggo il campo
018580040226     c                   Movel     Prot1         AtrRma
018590040226     c                   Eval      wrifm = *On
018600040227    4c                   EndIf
018610040227    3c                   EndIf
018620040227    2c                   EndIf
018630040227    1c                   EndSl
018640030409
018650030409      * Prima di procedere con la seconda videata devo emettere una finestra
018660030409      * se spedizione con lna FedEx o se spedizione relative ad ORM
018670030409      * commissionati da FedEx
018680030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
018690091111     c                   move      '1'           wvidobb           1
018700060113     c                   exsr      escier
018710091111     c                   move      ' '           wvidobb
018720060113    3c     §lpfpr        ifne      '5'
018730060113     c     §lpfpr        ifne      'V'
018740060113     c                   write     ls01d01
018750060113     c                   endif
018760091112     c                   eval      $fine='0'
018770091112     c                   Dow       $fine='0'
018780060110     c                   clear                   w02tes1
018790030409     c                   Eval      w02Tes = Rigw(1)
018800030409     c                   Eval      w02Rig1 = Rigw(3)
018810030409     c                   Eval      w02Rig2 = Rigw(4)
018820030409     c                   Eval      w02Rig3 = Rigw(5)
018830030409     c                   Eval      w02Rig4 = Rigw(6)
018840030409     c                   Exfmt     ls01w02
018850030409     c                   If        *InKl = *On
018860091112     c                   eval      $fine='1'
018870110309     c                   eval      *inkl=*off
018880030409     c                   EndIf
018890030409     c                   EndDo
018900060113   x3c                   else
018910060113     c                   goto      fine
018920060113    3c                   endif
018930030409     c                   EndIf
018940060113     c*
018950030409     c                   If        §orMic = 'F'
018960091111     c                   move      '1'           wvidobb           1
018970060113     c                   exsr      escier
018980091111     c                   move      ' '           wvidobb
018990060113    3c     §lpfpr        ifne      '5'
019000060113     c     §lpfpr        ifne      'V'
019010060113     c                   write     ls01d01
019020060113     c                   endif
019030091112     c                   eval      $fine='0'
019040091112     c                   Dow       $fine='0'
019050060110     c                   clear                   w02tes1
019060030409     c                   Eval      w02Tes = Rigw(2)
019070030409     c                   Eval      w02Rig1 = Rigw(7)
019080030409     c                   Eval      w02Rig2 = Rigw(4)
019090030409     c                   Eval      w02Rig3 = Rigw(8)
019100030409     c                   Clear                   w02Rig4
019110030409     c                   Exfmt     ls01w02
019120030409     c                   If        *InKl = *On
019130091112     c                   eval      $fine='1'
019140110309     c                   eval      *inkl=*off
019150030409     c                   EndIf
019160030409     c                   EndDo
019170060113   x3c                   else
019180060113     c                   goto      fine
019190060113    3c                   endif
019200030409     c                   EndIf
019210060113      * Prima di procedere con la seconda videata devo emettere una finestra
019220060113      * se spedizione in porto assegnato con destinatario con obbligo ddt in
019230060113      * fase di consegna (DDT=SI)
019240060113    2c                   If        Vidbam = 'S' and §dstddt = 'S' and
019250060113     c                             §3arbl <> 'R' and §1bf16 <> 'S' and
019260060113     c                             flgtb1 = 'A'
019270060113     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
019280060113     c* se devo emettere la window o ritornare al chiamante con errore
019290091111     c                   move      '1'           wvidobb           1
019300060113     c                   exsr      escier
019310091111     c                   move      ' '           wvidobb
019320060113    3c     §lpfpr        ifne      '5'
019330060113     c     §lpfpr        ifne      'V'
019340060113     c                   write     ls01d01
019350060113     c                   endif
019360091112     c                   eval      $fine='0'
019370091112    4c                   Dow       $fine='0'
019380060113     c                   clear                   w02tes
019390060113     c                   Eval      w02Tes1 = Rigw(9)
019400060113     c                   Eval      w02Rig2 = Rigw(10)
019410060113     c                   clear                   w02Rig1
019420060113     c                   clear                   w02Rig3
019430060113     c                   clear                   w02Rig4
019440060113     c                   Exfmt     ls01w02
019450060113     c                   If        *InKl = *On
019460091112     c                   eval      $fine='1'
019470110309     c                   eval      *inkl=*off
019480060113     c                   EndIf
019490060113    4c                   EndDo
019500060113   x3c                   else
019510060113     c                   goto      fine
019520060113    3c                   endif
019530060113    2c                   EndIf
019540090323     c
019550090323     c* tasto funzionale f15=cli/tar per tassazione porto assegnato
019560090323     c* Se la bolla non è in porto assegnato non è da visualizzare
019570090323     c                   if        flgtb1<>'A'
019580090323     c                   eval      atrf15=nodi
019590090323     c                   else
019600090323     c                   clear                   atrf15
019610090323     c                   endif
019620060113     c*
019630060113     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
019640060113     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
019650060113     C   12
019660060113    2CAN 15§LPFPR        IFNE      'V'
019670060113     C                   GOTO      TAG02
019680060113    2C                   END
019690941020     C*
019700941020     C* SE TUTTO OK EMETTO FORMATO2
019710941020     C     FOR02         TAG
019720940825     C* V I D E O   2
019730940819     C                   EXFMT     LS01D02
019740941003     C*
019750900926     C     TAG02         TAG
019760950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
019770950126     C                   EXSR      OFFD02
019780900926     C*
019790000905     C* CMD12 - RITORNO VIDEATA PRECEDENTE
019800000905     C     *INKL         IFEQ      *ON
019810000914     C* PER DISK C MANUTENZIONE RITORNO ALLA PRIMA VIDIEATA
019820000914     C* (IN QUESTO CASO INFATTI LA VIDEATA DI MANUTENZIONE COD CHI SONO
019830000914     C* DEVE ESSERE RICHIESTA CON F22 IN PRIMA VIDEATA)
019840000905     C     §1BF12        IFEQ      'S'
019850001011     C     WEXDPD        ANDNE     'S'
019860050223     c     *in79         andeq     *off
019870000914     C     *IN12         ANDEQ     *OFF
019880001009     C*
019890001009     C     §1BF12        OREQ      'S'
019900001011     C     WEXDPD        ANDEQ     'S'
019910001009     C     §1BF13        ANDEQ     'A'
019920001009     C     *IN12         ANDEQ     *OFF
019930001009     C*
019940000914     C     §1BF12        OREQ      'S'
019950001011     C     WEXDPD        ANDNE     'S'
019960050223     c     *in79         andeq     *off
019970000914     C     *IN15         ANDEQ     *ON
019980001009     C*
019990001009     C     §1BF12        OREQ      'S'
020000001011     C     WEXDPD        ANDEQ     'S'
020010001009     C     §1BF13        ANDEQ     'A'
020020001009     C     *IN15         ANDEQ     *ON
020030000905     C                   GOTO      FOR09
020040000905     C                   ELSE
020050000905     C                   GOTO      FOR01
020060000905     C                   ENDIF
020070000905     C                   ENDIF
020080010215     C* PRIMA DI FARE I CONTROLLI DELLA VIDEATA, SE ATTIATA PROC.ORM,
020090010215     C* E ORM NON FITTIZIO, PROPONGO EVENTUALI CAMPI SE A VIDEO SONO
020100010215     C* VUOTI
020110010215     C     WORM          IFEQ      'S'
020120010215     C     FLGFIT        ANDNE     'S'
020130010215     C     PARTCH        ANDNE     'P'
020140010215     C     *IN12         IFEQ      *OFF
020150010226     C     *IN15         OREQ      *OFF
020160010215     C                   EXSR      PRPOR2
020170010215     c* Se ho proposto dei campi non continuo i controlli ma devo
020180010215     c* riemettere videata per visualizzare i dati aggiunti
020190010215     C     WEFORM        IFEQ      '1'
020200010215     C                   GOTO      FOR02
020210010215     C                   ENDIF
020220010215     C                   ENDIF
020230091008     c****               if        *in79 and flgtb1='A'
020240091008     c                   if        flgtb1='A'  and (§ogntw='DPD' or
020250091008     c                             §ogntw='FED' or §ogntw='EEX')
020260070427     c                   exsr      prpor2_rmo
020270070427     C     weform        ifeq      '1'
020280070427     C                   goto      for02
020290070427     C                   endif
020300070427     c                   endif
020310010215     C                   ENDIF
020320040226
020330040226      * F11 - Calcolo volume
020340040226     c                   If        *Inkk = *On
020350040226     c                   Clear                   p26vol
020360040226     c                   Call      'TRUL36R'
020370040226     c                   Parm                    p26vol
020380040226     c                   Add       p26vol        VidVol
020390040226      * imposto wemfor per riemettere la videata
020400040301     c                   Eval      wkk = *On
020410040226     c                   EndIf
020420040226
020430900427     C* CONTROLLI
020440940825     C                   EXSR      CTRD02
020450040301
020460040301      * Se ho richiamato il calcolo del volume riemetto la videata
020470040301      * in modo da far vedere il volume calcolato in automatico
020480040301     c                   If        wkk = *On
020490040301     c                   Eval      wemfor = '1'
020500040301     c                   EndIf
020510940826     C* RIEMETTO FORMATO
020520950127     C     WEMFOR        IFEQ      '1'
020530950127     C                   EXSR      ESCIER
020540950127     C     §LPFPR        IFNE      '5'
020550950127     C                   GOTO      FOR02
020560950127     C                   ELSE
020570950127     C                   GOTO      FINE
020580950127     C                   ENDIF
020590950127     C                   ENDIF
020600010215     C* RICHIAMO ROUTINE DI CONTROLLO INCONGRUENZA COD.TARIFFA CON
020610010306     C* O.R.M.
020620010215     C     WORM          IFEQ      'S'
020630010215     C     FLGFIT        ANDNE     'S'
020640010215     C     PARTCH        ANDNE     'P'
020650010215     C     *IN12         IFEQ      *OFF
020660010301     C     *IN15         OREQ      *OFF
020670010215     C                   EXSR      CNFOR2
020680010215     C* RIEMETTO FORMATO
020690010215     C     WEMFOR        IFEQ      '1'
020700010215     C                   EXSR      ESCIER
020710010215     C     §LPFPR        IFNE      '5'
020720010215     C                   GOTO      FOR02
020730010215     C                   ELSE
020740010215     C                   GOTO      FINE
020750010215     C                   ENDIF
020760010215     C                   ENDIF
020770010215     C                   ENDIF
020780010215     C                   ENDIF
020790090323     c***
020800090323     C* F15=Cli/tariffa per tassazione porti assegnati
020810090323     c***
020820090323     c* emetto window solo se tasto di funzione è abilitato
020830090326     c                   if        *inkp='1'
020840090326     c                   if        atrf15=*blanks
020850090323     c                   exsr      geswdw_clitar
020860090326     c                   else
020870090326     c                   movel     err(322)      vidmsg
020880090326     c                   seton                                        90
020890090326     c                   endif
020900090323     c                   goto      for02
020910090326     c                   endif
020920941115     C***
020930941115     C* CMD8 - RISTAMPA BOLLA
020940941115     C***
020950000627     C* NON POSSO FARE RISTAMPA SE SONO SOLO NEI CONTROLLI
020960000627     C     §LPFLG        IFEQ      'C'
020970000627     C     *INKH         ANDEQ     *ON
020980000627     C                   MOVEL     ERR(203)      VIDMSG
020990000627     C                   SETON                                        90
021000000627     C                   GOTO      FOR02
021010000627     C                   ENDIF
021020000627     C**
021030970128     C* POSSO RISTAMPARE SOLTANTO SE ALLEGA BAM E' S
021040970128     C*  O NO MA LA BOLLA E' GIA' STATA STAMPATA
021050000112     C  N22*INKH         IFEQ      *ON
021060970128     C     VIDBAM        IFEQ      'N'
021070970128     C     BLPFST        IFEQ      'N'
021080970128     C     BLPFST        OREQ      'S'
021090970128     C* ERRORE
021100000627     C                   MOVEL     ERR(137)      VIDMSG
021110970128     C                   SETON                                        90
021120970128     C                   GOTO      FOR02
021130970128     C                   ENDIF
021140970128     C                   ENDIF
021150970128     C*
021160970128     C                   MOVEL     '1'           CMD8              1
021170970128     C                   ENDIF
021180091111
021190091111     c*** Gestione window per scelta Beneficiario Contrassegno
021200091124     c*** per spedizione con contrassegno legata ad orm che paga ordinante
021210091124     C*** (spedizione in assegnato con triangolazione)
021220091123     c                   clear                   wwdwcas           1
021230091211     c                   if        nochkticC=*on
021240091111     c                   eval      wvidobb='1'
021250091111     c                   exsr      escier
021260091111     c                   eval      wvidobb=' '
021270091111    2c                   if        §lpfpr<>'5'
021280091111    3c                   if        *in12 and *in15 and §lpfpr<>'V'
021290091111     c                   write     ls01d02
021300091111    3c                   endif
021310091111     c                   exsr      geswdw_cas
021320091123     c                   eval      wwdwcas='S'
021330091111     c   kl              goto      for02
021340091111   x2c                   else
021350091111     c                   goto      fine
021360091111    2c                   endif
021370091119     c                   endif
021380940920     C***
021390990610     C* F9  - ESTENSIONE BOLLA
021400940920     C***       VISUALIZZA LA 2 BOLLA SE ESISTE E LA TASSAZIONE
021410940923     C* SE TASSAZIONE CON TARIFFA MITTENTE CI VADO OBBLIGATORIAMENTE
021420940923     C* SE INSERITO ALMENO UN CAMPO E POI CMD12 CI RITORNO OBBLIGATOR
021430940826    2C     *INKI         IFEQ      *ON
021440940923     C     SAVFTM        ORNE      ' '
021450950125     C     *IN04         ANDEQ     *ON
021460940923     C     VIDFTM        ORNE      ' '
021470950125     C     *IN04         ANDEQ     *ON
021480961111     C* SE FRANCO FRONTIERA DEVO OBBLIGATORIAMENTE INDICARE IL PORTO
021490961111     C     VIDFBR        OREQ      'F'
021500940923     C     WEMD03        ORNE      ' '
021510990610     C* SE PREPAGATO CI VADO OBBLIGATORIAMENTE
021520990610     C     PARTCH        OREQ      'P'
021530010305     C     §LPFPR        OREQ      'O'
021540000112     C     *IN22         OREQ      *ON
021550940826     C                   EXSR      GESD03
021560940826     C   KL              GOTO      FOR02
021570941020     C*
021580950419     C* SE E' ERRORE E PGM DA DISK CLIENTI CHIAMATO CON "W" --> ESCO
021590950127     C     §LPFPR        IFEQ      '5'
021600950127     C                   GOTO      FINE
021610950127     C                   ENDIF
021620940923     C*
021630940923   X2C                   ELSE
021640940923     C*
021650101104     C* SE CONTO SERVIZIO IMMISSIONE PER F6   o F8
021660101104     c                   if        not *inkf and not *inkh
021670101104    3C     WFPR          IFNE      'I'
021680940923     C     §3ARBL        ANDEQ     'C'
021690950407     C*
021700950407     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
021710950410    4C     VIDLNP        IFNE      102
021720950407     C     *IN12         OREQ      *OFF
021730950407     C     *IN15         OREQ      *OFF
021740940923     C                   MOVEL     ERR(40)       VIDMSG
021750940923     C                   SETON                                        90
021760940923     C                   GOTO      FOR02
021770950410    4C                   ENDIF
021780950410    3C                   ENDIF
021790101104     c                   endif
021800960318     C**
021810960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
021820960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
021830960805     C* NON LO FACCIO PER LE SPEDIZIONI DI RECUPERO
021840960805     C  NKF§3ARBL        IFNE      'R'
021850030704     c     wforw03       andeq     *Blanks
021860121003     C                   EXSR      CTRCRG
021870121003     c   41              GoTo      For02
021880960805     C                   ENDIF
021890940923     C*
021900940923    2C                   ENDIF
021910940920     C***
021920900608     C* CMD8 - RISTAMPA BOLLA
021930940920     C***
021940970128     C     *INKH         IFEQ      *ON
021950970128     C     VIDBAM        IFEQ      'N'
021960970128     C     BLPFST        IFEQ      'N'
021970970128     C     BLPFST        OREQ      'N'
021980970128     C* ERRORE
021990970128     C                   MOVEL     ERR(137)      VIDMSG
022000970128     C                   SETON                                        90
022010970128     C                   GOTO      FOR02
022020970128     C                   ENDIF
022030970128     C                   ENDIF
022040970128     C*
022050970128     C                   MOVEL     '1'           CMD8              1
022060970128     C                   ENDIF
022070940920     C***
022080930930     C* SE VARIATA LIN.ARRIVO O DATA SPEDIZIONE DI UNA BOLLA BORDERIZZ.
022090930930     C* EMETTO IL MESSAGGIO E LA SBORDERIZZO (SONO ESCLUSI I RECUPERI)
022100940214     C   12
022110940214    2CANN15§1BFG4        IFEQ      'S'
022120940920     C     BLPDBR        ANDGT     0
022130940920     C*
022140940920    3C     COMLNA        IFNE      BLPLNA
022150940920     C     BLPDSP        ORGT      BLPDBR
022160930331     C* DECODIFICA LNA
022170930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
022180940928     C  N30              MOVEL     ORGDES        V1DLNA
022190930331     C*
022200940920     C                   EXFMT     LS01D05
022210940920     C                   CLEAR                   BLPNFV
022220940920     C                   CLEAR                   BLPDBR
022230940920     C                   CLEAR                   BLPFLP
022240950126     C* MEMORIZZO CHE HO SBORDERIZZATO LA BOLLA PER CANCELLARE ANCHE
022250950126     C* SUL DETTAGLIO COLLI IL NUMERO DI FOGLIO VIAGGIO
022260950126     C                   MOVEL     'S'           WSBORD            1
022270940920    3C                   ENDIF
022280940920    2C                   ENDIF
022290940920     C***
022300000627     C* SE SOLO CONTROLLI AGGIORNO LA DBLP CHE RESTITUISCO AL CHIAMANTE
022310940920     C***
022320000627     C     §LPFLG        IFEQ      'C'
022330000627     C                   EXSR      AGDBLP
022340000627     C                   ELSE
022350000627     C***
022360000627     C* REGISTRO BOLLA E STAMPO
022370000627     C***
022380900504     C                   EXSR      REGIS
022390000627     C                   ENDIF
022400000313     C*
022410000313     C* SE PGM RICHIAMATO PASSO INDIETRO IL FLAG DDT, CHE SERVE
022420000313     C* QUANDO SONO RICHIAMATO DA GIACENZE PER POI DECIDERE SE RISTAMPA
022430000313     C*  RE O MENO LA BOLLA
022440000627     C   12
022450000627     CAN 15§LPFLG        IFNE      'C'
022460000627     C                   MOVEL     VIDBAM        §LPBAM
022470000627     C                   ENDIF
022480950127     C* RIEMETTO FORMATO
022490950127     C     WEMFOR        IFEQ      '1'
022500950127     C                   EXSR      ESCIER
022510950127     C     §LPFPR        IFNE      '5'
022520950127     C                   GOTO      FOR02
022530950127     C                   ELSE
022540950127     C                   GOTO      FINE
022550950127     C                   ENDIF
022560950127     C                   ENDIF
022570900504     C*
022580900508     C* PULISCO CAMPI FOR01 E FOR02
022590940214    2C     *IN12         IFEQ      *OFF
022600010307     C     §LPFPR        ANDNE     'O'
022610940819     C                   EXSR      INZ01
022620940819     C                   EXSR      INZ02
022630941011     C                   EXSR      INZ03
022640971210     C                   EXSR      INZ06
022650991203     C                   EXSR      INZ07
022660000911     C                   EXSR      INZ08
022670040908     c* se personalizzato n. orm prima di riemettere la videata di
022680040908     c* bollettazione devo effettuare i controlli per poporre eventuali
022690040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
022700040908     c* porti allo stesso modo di quando dalla prima videata viene
022710040908     c* immesso il numero orm con la pistola (enter automatico)
022720041217     c* Non lo faccio se ORM fittizio in quanto non c'è nulla da proporre
022730041220     c                   if        *in37 = *on
022740041220     c                   if        flgfit <> 'S'
022750050119     c                   eval      wsolo_prp = '1'
022760041217     c                   exsr      ctrd01
022770041220     c                   else
022780041220     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
022790041220     c* (per uniformità: fa così anche per orm reale)
022800041220     c                   z-add     13            h1riga
022810041220     c                   z-add     20            h1colo
022820041220     c                   endif
022830041217     c                   endif
022840930628     C                   GOTO      FOR01
022850940214    2C                   END
022860930628     C*
022870000000     C     FINE          TAG
022880940214     C*
022890930628     C  N12              SETON                                        LR
022900060308     c* Chiudo con LR pgm gestione motivazione variazione ad ogni bolla per
022910060308     c* pulire la videata
022920060308     c                   clear                   fnlv85ds
022930060308     c                   eval      ilv85tla = 'C'
022940060308     c                   movel     fnlv85ds      kpjbu
022950060308     c                   call      'FNLV85R'
022960060308     c                   parm                    kpjba
022970060222     c*
022980130419     c  nlr              return
022990940214    1C                   ENDIF
023000940214     C* CHIUDO FILES
023010941108     C     *INLR         IFEQ      *ON
023020941108     C*
023030941108     C     WCL98         IFEQ      '1'
023040940214     C                   MOVEL     'C'           D98TLA
023050970925     C                   CALL      'TNSD99R'
023060970925     C                   PARM                    DSSD99
023070940214    1C                   ENDIF
023080970722     C**
023090991102     C                   CLEAR                   DSBS02
023100991102     C                   MOVEL     'C'           T02TLA
023110991102     C                   CALL      'TIBS02R'
023120991102     C                   PARM                    KPJBA
023130991102     C                   PARM                    DSBS02
023140991102     C**
023150970722     C                   MOVEL     'C'           I13TLA
023160970722     C                   CALL      'FNLV13R'
023170970722     C                   PARM                    KPJBA
023180970722     C                   PARM                    DSLV13
023190970722     C                   PARM                    DSSI95
023200061109     C**
023210061109     C                   MOVEL     'C'           ISIE3TLA
023220061109     C                   CALL      'TISIE3R'
023230061109     C                   PARM                    TISIE3DS
023240061109     c
023250061109     C                   MOVEL     'C'           XCFIVADS
023260061109     C                   CALL      'XCFIVAR'
023270061109     C                   PARM                    XCFIVAds
023280991130     C**
023290060619    2C     WEU12         IFEQ      'S'
023300060619     C                   MOVEL     'C'           i12TLA
023310060619     C                   CALL      'FIEU12R'
023320991130     C                   PARM                    KPJBA
023330060619     C                   PARM                    fieu12ds
023340991130    3C                   ENDIF
023350011212     C*
023360011212     C                   CLEAR                   DSUL21
023370011212     C                   MOVEL     'C'           I21TLA
023380011212     C                   CALL      'TRUL21R'
023390011212     C                   PARM                    DSUL21
023400011212     C*
023410011212     C                   CLEAR                   DSUL22
023420011212     C                   MOVEL     'C'           I22TLS
023430011212     C                   CALL      'TRUL22R'
023440011212     C                   PARM                    DSUL22
023450011212     C*
023460011212     C                   CLEAR                   DSUL23
023470011212     C                   MOVEL     'C'           I23TLA
023480011212     C                   CALL      'TRUL23R'
023490011212     C                   PARM                    DSUL23
023500941108     C*
023510941108    2C     *IN12         IFEQ      *OFF
023520941108     C     *IN15         OREQ      *ON
023530941108     C*
023540941108    3C     I100          IFEQ      1
023550941108     C                   MOVEL     '*'           DB0GES
023560941108    3C                   ENDIF
023570941108    2C                   ENDIF
023580941108     C*
023590941108     C                   MOVEL     'C'           DB0TLA
023600030611     C                   CALL      WD90PSL
023610030626     C                   PARM                    fnlsb5DS
023620970925     C*
023630970925     C                   CLEAR                   DSLV55
023640970925     C                   MOVEL     'C'           D55TLA
023650970925     C                   CALL      'FNLV55R'
023660970925     C                   PARM                    DSLV55
023670000918     C*
023680000918     C                   CLEAR                   DSLSZ1
023690000918     C                   MOVEL     'C'           IZ1TLA
023700000918     C                   CALL      'FNLSZ1R'
023710010402     C                   PARM                    KPJBA
023720000918     C                   PARM                    DSLSZ1
023730000918     C                   PARM                    DS1B
023740020213     c*
023750020213     C                   CLEAR                   trul27ds
023760020213     C                   MOVEL     'C'           I27TLA
023770020213     C                   CALL      'TRUL27R'
023780020213     C                   PARM                    TRUL27DS
023790020218     c*
023800020218     c                   movel     'C'           tastla
023810020218     C                   CALL      'TNSF20R'
023820020218     C                   PARM                    KPJBA
023830020218     C                   PARM                    DTAS
023840020218     C                   PARM                    DTASV
023850020320     c*
023860020320     c                   clear                   trul33ds
023870020320     c                   movel     'C'           i33tla
023880020320     c                   movel     trul33ds      kpjbu
023890020320     C                   CALL      'TRUL33R'
023900020320     C                   PARM                    KPJBA
023910020531     c*
023920020531     c                   clear                   tisit0ds
023930071010     c                   clear                   tisit0x1ds
023940020531     c                   movel     'C'           it0tla
023950020531     C                   CALL      'TISIT5R'
023960020531     C                   PARM                    tisit0ds
023970071010     C                   PARM                    tisit0x1ds
023980031217
023990091006     c                   Clear                   Fnls28ds
024000091006     c                   Eval      I28Tla = 'C'
024010091006     c                   Call      'FNLS28R'
024020091006     c                   Parm                    kpjba
024030091006     c                   Parm                    Fnls28ds
024040040227
024050040227     c                   Clear                   Fnls26ds
024060040227     c                   Eval      I26Tla = 'C'
024070040227     c                   Call      'FNLS26R'
024080040227     c                   Parm                    Fnls26ds
024090061107     c*
024100061107     c                   Eval      Ideptla = 'C'
024110061107     c                   call      'TRULDEPR'
024120061107     c                   parm                    truldepds
024130061127     c* Richiamo il *pgm d utilità FIDN12R in modalità "solo chiusura"
024140061127     c                   clear                   fidn12ds
024150061127     c                   eval      dn_i12tla = 'C'
024160061127     c                   call      'FIDN12R'
024170061127     c                   parm                    fidn12ds
024180081111
024190081111     C                   MOVEL     'C'           SA2TLA
024200081111     C                   CALL      'FNLSA2R3'
024210081111     C                   PARM                    SA2TLA
024220081111     C                   PARM                    SA2TRC
024230081111     C                   PARM                    SA2DTS
024240081111     C                   PARM                    WWLNA             3 0
024250090626     c*
024260090626     c                   clear                   trulticds
024270090626     c                   eval      itictla='C'
024280090626     c                   call      'TRULTICR'
024290090626     c                   parm                    TRULTICDS
024300090626     c                   parm                    ds1a
024310120615     c*
024320120615     c                   clear                   trulflbds
024330120615     c                   eval      iflbtla='C'
024340120615     c                   call      'TRULFLBR'
024350120615     c                   parm                    TRULFLBDS
024360061107     c*
024370040329      * Chiudo Titas30c
024380040329     c                   If        %Open(Titas30c)
024390040329     c                   Close     Titas30c
024400040329     c                   EndIf
024410941108     C*
024420941108    1C                   ENDIF
024430991008      *----------------------------------------------------------------
024440991008      *--  OPERAZIONI INIZIALI   -------------------------------------*
024450991008      *----------------------------------------------------------------
024460940819     C     *INZSR        BEGSR
024470011114     C* N.B.: QUANDO NON SI VORRÀ PIÙ STAMPARE BLANK+55L+CAP DESTINO:
024480011114     C*       ASTERISCARE    "MOVE *BLANKS   WNO55L"
024490011114     C*       DISASTERISCARE "MOVE '1'       WNO55L"
024500020725     C***                MOVE      *BLANKS       WNO55L            1
024510011126     C                   MOVE      '1'           WNO55L            1
024520030610      * MEMORIZZO STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO
024530950118     C                   MOVEL     KPJBU         PARAM3
024540030610      *
024550030610      * SE RICEVO TRUL90DS TENGO BUONO I PGM DELLA DS, in caso contrario
024560030610      *  quello della KPJBU + FNLSB0R
024570030610      * ....... modifica da togliere dopo aver eliminato TRUL01R
024580030610     C                   IF        %PARMS < 4
024590030611     C                   movel(P)  Wpgmss        WD90PSS
024600030611     C                   movel(P)  'FNLSB0R'     WD90PSL
024610030611     C                   ELSE
024620030611     C                   movel(P)  D90PSS        WD90PSS
024630030611     C                   movel(P)  D90PSL        WD90PSL
024640030610     c                   ENDIF
024650030610      *
024660011107     C     WNO55L        IFEQ      *BLANKS
024670011107     C                   MOVEL     ' 55L'        W55L
024680011107     C                   ELSE
024690011107     C                   CLEAR                   W55L
024700011107     C                   ENDIF
024710040329
024720040329      * Se sono in ambiente buono - GAITRAGRU
024730040329     c                   If        knsif = 'FILTRA201 '
024740040329     c                   Eval      wlib = 'GAITRAGRU '
024750040329      *  Se sono in ambiente di prova - GAITRAGRPS
024760040329     c                   Else
024770040329     c                   Eval      wlib = 'GAITRAGRPS'
024780040329     c                   EndIf
024790940819     C***
024800940819     C* KLIST
024810940819     C***
024820940819     C* ACCESSO   CNACO
024830940819     C     KACO          KLIST
024840940819     C                   KFLD                    CODUT
024850940819     C                   KFLD                    CCC
024860940909     C                   KFLD                    WKSC
024870990630     C     KNUM          KLIST
024880990630     C                   KFLD                    DATAAS            2 0
024890990630     C                   KFLD                    RGS               1 0
024900990630     C                   KFLD                    FIV               3 0
024910990630     C**
024920990630     C                   Z-ADD     2             RGS
024930990630     C**
024940950920     C* ACCESSO   AZCLN
024950950920     C     KCLN          KLIST
024960950920     C                   KFLD                    SIMFEL
024970950920     C                   KFLD                    W0030
024980950920     C                   KFLD                    WAA               4 0
024990950920     C                   KFLD                    WMM               2 0
025000101022     C     KCLNA         KLIST
025010101022     C                   KFLD                    w0030
025020101022     C                   KFLD                    comlna
025030101022     C                   KFLD                    WAA               4 0
025040101022     C                   KFLD                    WMM               2 0
025050940819     C* ACCESSO   TFTAM SENZA PROGRESSIVO
025060940819     C     KTAM2         KLIST
025070940909     C                   KFLD                    WKSC
025080940819     C                   KFLD                    COMCTR            3 0
025090940819     C                   KFLD                    COMPRG            3 0
025100940819     C* ACCESSO   TFTPT SENZA PROGRESSIVO
025110940819     C     KTPT          KLIST
025120940909     C                   KFLD                    WKSC
025130940819     C                   KFLD                    COMCTR            3 0
025140940819     C                   KFLD                    COMPRG            3 0
025150990818     C                   KFLD                    FTC               2
025160940819     C* ACCESSO   TFTAM TARIFFA DI CARTELLO
025170020208     c*
025180940819     C     KCAR2         KLIST
025190940819     C                   KFLD                    TARKSC
025200940819     C                   KFLD                    TARCTR            3 0
025210940819     C                   KFLD                    TARPRG            3 0
025220940819     C* ACCESSO   TABEL
025230940819     C     KTAB2         KLIST
025240940819     C                   KFLD                    CODUT
025250940819     C                   KFLD                    COD               2
025260940819     C                   KFLD                    KEY               8
025270940819     C* ACCESSO   TABEL
025280940819     C     KTAB3         KLIST
025290940819     C                   KFLD                    CODUT
025300940819     C                   KFLD                    COD               2
025310000120     C     KTBE          KLIST
025320000120     C                   KFLD                    KTCOD
025330000120     C                   KFLD                    KTLIN
025340000120     C                   KFLD                    KTSIF
025350000120     C                   KFLD                    KTKE1
025360000120     C                   KFLD                    KTKE2
025370070612     C* ACCESSO   EDTAB
025380070612     C     KEDTAB        KLIST
025390070612     C                   KFLD                    Kedcod
025400070612     C                   KFLD                    kedkey
025410940819     C* ACCESSO   FILE DISCHETTO CLIENTI
025420940819     C     KBLC          KLIST
025430020917     C                   KFLD                    §FGS
025440020917     C                   KFLD                    §LPCCM
025450970407     C                   KFLD                    §LPAAC
025460940819     C                   KFLD                    §LPLNP
025470940819     C                   KFLD                    §LPNRS
025480940819     C                   KFLD                    §LPNSP
025490970107     C     KBLC4         KLIST
025500970407     C                   KFLD                    §LPAAC
025510970107     C                   KFLD                    §LPLNP
025520970107     C                   KFLD                    §LPNRS
025530970107     C                   KFLD                    §LPNSP
025540940819     C* ACCESSO   FILE BOLLE VISTA LOGICA 1
025550940819     C     KBLP3         KLIST
025560940819     C                   KFLD                    §LPAAS
025570940819     C                   KFLD                    §LPLNP
025580940819     C                   KFLD                    §LPNRS
025590940819     C                   KFLD                    §LPNSP
025600051124     C**   KBLP33        KLIST
025610051124     C**                 KFLD                    §LPAAS
025620051124     C**                 KFLD                    §LPLNP
025630051124     C**                 KFLD                    §LPNRS
025640051124     C**                 KFLD                    §LPNSP
025650051124     C**                 KFLD                    bltnsc
025660940926     C     KBLP4         KLIST
025670940926     C                   KFLD                    §LPAAS
025680940926     C                   KFLD                    §LPLNP
025690940926     C                   KFLD                    §LPNRS
025700940926     C                   KFLD                    §LPNSP
025710940926     C                   KFLD                    WTRC
025720041013     C     KBLP4M        KLIST
025730060215     c                   kfld                    ar4aas
025740060215     c                   kfld                    ar4lnp
025750060215     c                   kfld                    ar4nrs
025760060215     c                   kfld                    ar4nsp
025770001212     C* Usata per controllo segnacolli doppi bolle poste
025780120817     C***  KBLP1         KLIST
025790120817     C***                KFLD                    BLTAAS
025800120817     C***                KFLD                    BLTLNP
025810120817     C***                KFLD                    BLTNRS
025820120817     C***                KFLD                    BLTNSP
025830120814     C     Kfiart        KLIST
025840120814     C                   KFLD                    BLTAAS
025850120814     C                   KFLD                    BLTLNP
025860120814     C                   KFLD                    BLTNRS
025870120814     C                   KFLD                    BLTNSP
025880120814     C                   KFLD                    BLTNSC
025890120817     C***  KBLP4P        KLIST
025900120817     C***                KFLD                    BLTAAS
025910120817     C***                KFLD                    BLTLNP
025920120817     C***                KFLD                    BLTNRS
025930120817     C***                KFLD                    BLTNSP
025940120817     C***                KFLD                    WTRC
025950940819     C* KEY PER SEGNACOLLI DOPPI IN FLBLT
025960940819     C     KBLT          KLIST
025970940916     C                   KFLD                    WFLS
025980940819     C                   KFLD                    COMLNA
025990940819     C                   KFLD                    VIDNRS
026000940819     C                   KFLD                    COMSCD
026010120816     C***  KBLT29        KLIST
026020120816     C***                KFLD                    WFLS
026030120816     C***                KFLD                    VIDNRS
026040120816     C***                KFLD                    COMSCD
026050980320     C     KBLT1         KLIST
026060980320     C                   KFLD                    BLPAAS
026070980320     C                   KFLD                    BLPLNP
026080980320     C                   KFLD                    BLPNRS
026090980320     C                   KFLD                    BLPNSP
026100080103     C     KBRV          KLIST
026110960404     C                   KFLD                    KNPG
026120960404     C                   KFLD                    BLTFLS
026130960404     C                   KFLD                    BLTLNA
026140960404     C                   KFLD                    BLTNRS
026150960404     C                   KFLD                    BLTNSC
026160960404     C                   KFLD                    KFLE
026170120817     C     KBRVA         KLIST
026180120817     C                   KFLD                    KNPG
026190120817     C                   KFLD                    ARTFLS
026200120817     C                   KFLD                    ARTLNA
026210120817     C                   KFLD                    ARTNRS
026220120817     C                   KFLD                    ARTNSC
026230120817     C                   KFLD                    KFLE
026240940819     C* ACCESSO   FILE NUMERATORE
026250940819     C     KNUF          KLIST
026260940819     C                   KFLD                    AAS               2 0
026270940819     C                   KFLD                    CNU               3 0
026280940819     C                   KFLD                    COMLIN            3 0
026290940819     C     KNUF2         KLIST
026300940819     C                   KFLD                    AAS               2 0
026310940819     C                   KFLD                    CNU
026320940819     C                   KFLD                    COMLIN
026330940819     C                   KFLD                    LIV2              3 0
026340991117     C     KNUF3         KLIST
026350991117     C                   KFLD                    CNU
026360991118     C                   KFLD                    DATA6             6 0
026370000509     C     KNUFSP        KLIST
026380000509     C                   KFLD                    AAS               2 0
026390000509     C                   KFLD                    CNU               3 0
026400000509     C                   KFLD                    COMLIN            3 0
026410000509     C                   KFLD                    WNUF2             3 0
026420940819     C* PER CONTROLLO NUM DI SPEDIZIONE
026430940819     C     KNSP          KLIST
026440940916     C                   KFLD                    WAAS
026450940819     C                   KFLD                    VIDLNP
026460940819     C                   KFLD                    VIDNRS
026470940819     C                   KFLD                    RECNSP
026480940819     C     KFTT          KLIST
026490940819     C                   KFLD                    W01PDR
026500940819     C                   KFLD                    W01FVL
026510940819     C                   KFLD                    COMDRT
026520940819     C                   KFLD                    W01TSR
026530980318     C     KVAT          KLIST
026540020917     C                   KFLD                    §FGS
026550020917     C                   KFLD                    §LPCCM
026560980318     C                   KFLD                    §LPAAC
026570980318     C                   KFLD                    §LPLNP
026580980318     C                   KFLD                    §LPNRS
026590980318     C                   KFLD                    §LPNSP
026600980318     C                   KFLD                    WTRC
026610031114
026620031114     c     kVat1         Klist
026630031114     C                   Kfld                    §Fgs
026640031114     C                   Kfld                    §LpCcm
026650031114     C                   Kfld                    §LpAac
026660031114     C                   Kfld                    §LpLnp
026670031114     C                   Kfld                    §LpNrs
026680031114     C                   Kfld                    §LpNsp
026690031114
026700980320     C*
026710051102     C     KARS1         KLIST
026720980320     C                   KFLD                    BLTFLS
026730980320     C                   KFLD                    BLTLNA
026740980320     C                   KFLD                    BLTNRS
026750980320     C                   KFLD                    BLTNSC
026760980320     C                   KFLD                    WTRC
026770120817     C     KARS1A        KLIST
026780120817     C                   KFLD                    ARTFLS
026790120817     C                   KFLD                    ARTLNA
026800120817     C                   KFLD                    ARTNRS
026810120817     C                   KFLD                    ARTNSC
026820120817     C                   KFLD                    WTRC
026830051102     C     KARS1P        KLIST
026840050211     C                   KFLD                    BLpFLS
026850050211     C                   KFLD                    BLpLNA
026860050211     C                   KFLD                    BLpNRS
026870050211     C                   KFLD                    BLpNcd
026880050211     C                   KFLD                    WTRC
026890120817     C***  KARSD         KLIST
026900120817     C***                KFLD                    BLTFLS
026910120817     C***                KFLD                    BLTLNA
026920120817     C***                KFLD                    BLTNRS
026930120817     C***                KFLD                    BLTNSC
026940051102     C     KARS1K        KLIST
026950000915     C                   KFLD                    KFLSAN
026960000915     C                   KFLD                    KLNAAN
026970000915     C                   KFLD                    KNRSAN
026980000915     C                   KFLD                    KNSCAN
026990000915     C                   KFLD                    WTRC
027000051102     C     KARS01        KLIST
027010980320     C                   KFLD                    BLPFLS
027020980320     C                   KFLD                    BLPLNA
027030980320     C                   KFLD                    BLPNRS
027040980320     C                   KFLD                    WO2SCD
027050980320     C                   KFLD                    WTRC
027060051102     C     KARS2         KLIST
027070020308     C                   KFLD                    W8CNOT
027080980325     C                   KFLD                    WTRC
027090060215     C     Kar4F         KLIST
027100991217     C                   KFLD                    WTRC
027110991217     C                   KFLD                    W030A
027120060215     C     Kar4B         KLIST
027130060215     C                   KFLD                    ar4AAS
027140060215     C                   KFLD                    ar4LNP
027150060215     C                   KFLD                    ar4NRS
027160060215     C                   KFLD                    ar4NSP
027170060215     C     Kar403        KLIST
027180060215     C                   KFLD                    kar4trc
027190060215     C                   KFLD                    kar4n14
027200010116     C     KSGN          KLIST
027210010116     C                   KFLD                    COMTFP
027220010116     C                   KFLD                    KWHO
027230010116     C     KSGN8         KLIST
027240010116     C                   KFLD                    COMTFP
027250010116     C                   KFLD                    V8CNOT
027260020308     C     KSGN88        KLIST
027270020308     C                   KFLD                    COMTFP
027280020308     C                   KFLD                    W8CNOT
027290010212     C     KORM          KLIST
027300010212     C                   KFLD                    WOPOE
027310010212     C                   KFLD                    WONSR
027320010222     C                   KFLD                    WONOR2
027330010212     C                   KFLD                    WONRV
027340100319     C     KORME         KLIST
027350100319     C                   KFLD                    WOPOE
027360100319     C                   KFLD                    WONSR
027370100319     C                   KFLD                    WONOR2
027380100319     C                   KFLD                    WONRV
027390100319     C                   KFLD                    koretrc
027400010212     C     KDST          KLIST
027410120611     C                   KFLD                    ormnpg
027420120611     C                   KFLD                    ormndc
027430060522     C                   KFLD                    kfgs
027440010214     C     KFVV          KLIST
027450010214     C                   KFLD                    ORMNPG
027460010215     C                   KFLD                    W0050
027470060522     C                   KFLD                    kfgs
027480021203     C     Kfapd         klist
027490021203     C                   kfld                    kpdtip
027500021203     C                   kfld                    kpdpdr
027510021218     c     KFiar5        Klist
027520021218     c                   Kfld                    BlpAas
027530021218     c                   Kfld                    BlpLnp
027540021218     c                   Kfld                    BlpNrs
027550021218     c                   Kfld                    BlpNsp
027560021218     c                   Kfld                    KAr5Trd
027570040601     c     Kbolm         Klist
027580040601     c                   Kfld                    §lpaasm
027590040601     c                   Kfld                    §lplnpm
027600040601     c                   Kfld                    §lpNrsm
027610040601     c                   Kfld                    §lpNspm
027620130305     c     Kbolm5        Klist
027630130305     c                   Kfld                    §lpaasm
027640130305     c                   Kfld                    §lplnpm
027650130305     c                   Kfld                    §lpNrsm
027660130305     c                   Kfld                    §lpNspm
027670130305     c                   Kfld                    KAr5Trd
027680051123     c     Kanm2         Klist
027690120817     c***                Kfld                    bltfls
027700120817     c***                Kfld                    bltlna
027710120817     c***                Kfld                    bltnrs
027720120817     c***                Kfld                    bltnsc
027730120817     c                   Kfld                    artfls
027740120817     c                   Kfld                    artlna
027750120817     c                   Kfld                    artnrs
027760120817     c                   Kfld                    artnsc
027770051124     c     Kanm1         Klist
027780051125     C                   KFLD                    §LPAAS
027790051125     C                   KFLD                    §LPLNP
027800051125     C                   KFLD                    §LPNRS
027810051125     C                   KFLD                    §LPNSP
027820070601     c*
027830070601     c     kfnorf        klist
027840070601     c                   kfld                    ormpoe
027850070601     c                   kfld                    ormnsr
027860070601     c                   kfld                    ormnor
027870070601     c                   kfld                    ormnrv
027880070601     c                   kfld                    ormdfo
027890070601     c                   kfld                    ormofo
027900070601     c                   kfld                    ormfao
027910080221     c**!!!kfipdo        klist
027920080221     c**!!!              kfld                    orffgs
027930080221     c**!!!              kfld                    orfndc
027940080221     c**!!!              kfld                    orfpoe
027950080221     c**!!!              kfld                    orfnsr
027960080221     c**!!!              kfld                    orfnor
027970080221     c**!!!              kfld                    orfnrv
027980070613     c     kdpo          klist
027990070626     c                   kfld                    kdpodep
028000070626     c                   kfld                    kdpoord
028010071221
028020071221     c     Kbrv7         Klist
028030120817     c***                Kfld                    bltfls
028040120817     c***                Kfld                    comlna
028050120817     c***                Kfld                    bltnrs
028060120817     c***                Kfld                    bltnsc
028070120817     c                   Kfld                    artfls
028080120817     c                   Kfld                    comlna
028090120817     c                   Kfld                    artnrs
028100120817     c                   Kfld                    artnsc
028101140716     c     Kbrv7z        Klist
028106140716     c                   Kfld                    artfls
028107140716     c                   Kfld                    artlna
028108140716     c                   Kfld                    artnrs
028109140716     c                   Kfld                    artnsc
028110080313
028120080313     C     KTbe1         KLIST
028130080313     C                   KFLD                    k_tbecod
028140080313     C                   KFLD                    k_tbeke1
028150100323     C     Kfgi          KLIST
028160100323     C                   KFLD                    kksc
028170100323     C                   KFLD                    klnp
028180130304     C     Kblpar8       KLIST
028190130304     C                   KFLD                    ar8AAS
028200130304     C                   KFLD                    ar8LNP
028210130304     C                   KFLD                    ar8NRS
028220130304     C                   KFLD                    ar8NSP
028230130306     C     Kar8§pdf      KLIST
028240130306     C                   KFLD                    §clipdfp
028250130306     C                   KFLD                    §VATPPDFN
028260940819     C***
028270940819     C* DEFINIZIONE CAMPI
028280940819     C***
028290001031     C     *LIKE         DEFINE    BLPTFA        COMTFA
028300000508     C     *LIKE         DEFINE    DSBLD         WSBLD
028310000211     C     *LIKE         DEFINE    DSBLDE        WSBLDE
028320001002     C     *LIKE         DEFINE    DSBLD         WWBLD
028330001002     C     *LIKE         DEFINE    DSBLDE        WWBLDE
028340000211     C     *LIKE         DEFINE    DSBLD0        SAVBLD
028350000211     C     *LIKE         DEFINE    §LDDLA        WDLA
028360000208     C     *LIKE         DEFINE    SGNWHO        KWHO
028370000204     C     *LIKE         DEFINE    OG143         SAV143
028380000201     C     *LIKE         DEFINE    V7CNPR        WNPR
028390041116     C     *LIKE         DEFINE    V7CNPR        WNPRpre
028400051124     c     *LIKE         DEFINE    O14LAD        DESLAD
028410060920     c     *LIKE         DEFINE    O14red        DESred
028420080414     c**   *LIKE         DEFINE    §15cex        DEScaeex
028430080414     c**   *LIKE         DEFINE    §15cdp        DEScadpd
028440080414     c**   *LIKE         DEFINE    §15cfe        DEScafed
028450060613     C**** *LIKE         DEFINE    VIDNRD        COMNRD
028460000120     C     *LIKE         DEFINE    TBECOD        KTCOD
028470000120     C     *LIKE         DEFINE    TBELIN        KTLIN
028480000120     C     *LIKE         DEFINE    TBESIF        KTSIF
028490000120     C     *LIKE         DEFINE    TBEKE1        KTKE1
028500000120     C     *LIKE         DEFINE    TBEKE2        KTKE2
028510000120     C     *LIKE         DEFINE    BLPDSP        WDSP
028520020102     C     *LIKE         DEFINE    §CVFDC        COMFDC
028530011113     C     *LIKE         DEFINE    §CVDEC        COMDEC
028540991028     C     *LIKE         DEFINE    O17FDC        WFDC1
028550991015     C     *LIKE         DEFINE    O17FDC        WFDC2
028560991014     C     *LIKE         DEFINE    VIDPOR        MEMPOR
028570991012     C     *LIKE         DEFINE    VI2VA1        VA2VA1
028580991011     C     *LIKE         DEFINE    AR6DIV        WDIV1
028590991011     C     *LIKE         DEFINE    AR6DIV        WDIV2
028600990701     C     *LIKE         DEFINE    VIDNFT        SAVNFT
028610990701     C     *LIKE         DEFINE    VIDIMV        SAVIMV
028620060208     C     *LIKE         DEFINE    VIDIMV        SAVIMVO
028630990630     C     *LIKE         DEFINE    O95CZC        WCZC
028640980211     C     *LIKE         DEFINE    O95CZO        WCZO
028650980211     C     *LIKE         DEFINE    VIDLNP        BLCLNP
028660971216     C     *LIKE         DEFINE    BLPNCA        STANCA
028670971215     C     *LIKE         DEFINE    V6CAWB        SAVAWB
028680050228     C     *LIKE         DEFINE    V7CNPR        SAVNPR
028690061003     C***  *LIKE         DEFINE    §b4fnp        SAVfnp
028700060620     C     *LIKE         DEFINE    §b4krt        SAVkrt
028710060619     C***  *LIKE         DEFINE    vidrmn        savrmn
028720941104     C*  MI IMPOSTO IL FLAG I/E DELLE TARIFFE DA CARICARE
028730941104     C     *LIKE         DEFINE    TAMFIE        WFIE
028740941107     C* FLAG SALVATO DA MANUTENZIONE BOLLE
028750941117     C     *LIKE         DEFINE    TAMFIE        SAVFIE
028760020122     C     *LIKE         DEFINE    BLPNZD        NZDINI
028770061124     C     *LIKE         DEFINE    BLPNZD        savnzd
028780941107     C* =S CLIENTE CON TARIFFE VALIDE
028790050921     C     *LIKE         DEFINE    olv59tks      WTKS
028800980701     C* CAMPI DELLA PARAM PER RICERCA ALFABETICA
028810940928     C     *LIKE         DEFINE    ACOKCC        PAXCCC
028820940928     C     *LIKE         DEFINE    ACORAG        PAXDMT
028830940928     C     *LIKE         DEFINE    ACOKCC        CCC
028840940928     C* SALVO IL MITTENTE PER IL QUALE HO CARICATO LE TARIFFE: SE MODIF
028850940928     C*  RICARICO LE TARIFFE
028860940928     C     *LIKE         DEFINE    BLPKSC        SAVCCM
028870940928     C* SE MODIFICATO IL CODICE TARIFFA EMETTO I CAMPI PRESI DA TARIFFA
028880940928     C*  IN "RI"
028890940928     C     *LIKE         DEFINE    VIDCTR        SAVCTR
028900950504     C     *LIKE         DEFINE    VIDCTM        SAVCTM
028910941219     C     *LIKE         DEFINE    VIDVCA        VARVCA
028920941219     C     *LIKE         DEFINE    VIDVAS        VARVAS
028930941219     C     *LIKE         DEFINE    VIDVAD        VARVAD
028940970702     C     *LIKE         DEFINE    VIDLOD        VARLOD
028950970704     C     *LIKE         DEFINE    VIDLOM        VARLOM
028960940928     C*
028970940928     C     *LIKE         DEFINE    §15VLT        MITVLT
028980940922     C     *LIKE         DEFINE    §15VLT        DESVLT
028990940928     C     *LIKE         DEFINE    §15EFT        DESEFT
029000000321     C     *LIKE         DEFINE    §15EFD        DESEFD
029010020130     C     *LIKE         DEFINE    §15EFD        DESEFf
029020020131     C     *LIKE         DEFINE    §15ffn        DESffn
029030971215     C     *LIKE         DEFINE    §15COD        DESCOD
029040940922     C     *LIKE         DEFINE    BLDFST        SAVFST
029050950717     C     *LIKE         DEFINE    BLDNCD        WNCD
029060950321     C     *LIKE         DEFINE    BLPCCM        SAVMIT
029070000426     C     *LIKE         DEFINE    VARNCL        SA2NCL
029080000426     C     *LIKE         DEFINE    VARCDP        SA2CDP
029090940819     C     *LIKE         DEFINE    TBLKUT        §KUT
029100940819     C     *LIKE         DEFINE    TBLCOD        §COD
029110940819     C     *LIKE         DEFINE    TBLKEY        §KEY
029120940819     C     *LIKE         DEFINE    VIDINM        VI2INM
029130940819     C     *LIKE         DEFINE    VIDCAM        VI2CAM
029140940819     C     *LIKE         DEFINE    VIDPIM        VI2PIM
029150120817     C     *LIKE         DEFINE    ARTNSC        WNSC
029160940926     C     *LIKE         DEFINE    BLPAAS        WAAS
029170940926     C     *LIKE         DEFINE    BLPFIN        WFIN
029180940916     C     *LIKE         DEFINE    BLPFLS        WFLS
029190060216     C     *LIKE         DEFINE    ar4TRC        WTRC
029200060215     C     *LIKE         DEFINE    ar4TRC        kar4trc
029210060215     C     *LIKE         DEFINE    ar4n14        kar4n14
029220991006     C     *LIKE         DEFINE    AR6SV1        WSV1
029230991027     C     *LIKE         DEFINE    AR6VA1        WVA1
029240991027     C     *LIKE         DEFINE    AR6SV1        WSV2
029250991027     C     *LIKE         DEFINE    AR6VA1        WVA2
029260991027     C     *LIKE         DEFINE    AR6SV1        WSV3
029270991027     C     *LIKE         DEFINE    AR6VA1        WVA3
029280991027     C     *LIKE         DEFINE    AR6SV1        WSVN
029290991027     C     *LIKE         DEFINE    AR6VA1        WVAN
029300941021     C     *LIKE         DEFINE    §CCCEI        WEV1
029310950123     C     *LIKE         DEFINE    VIDRSD        SAVRSD
029320070404     C     *LIKE         DEFINE    VIDind        SAVind
029330070404     C     *LIKE         DEFINE    VIDprd        SAVprd
029340070404     C     *LIKE         DEFINE    VIDlod        SAVlod
029350010302     C     *LIKE         DEFINE    §LDCDP        SAVCDP
029360940930     C* CONTROLLO SE MODIFICATO CAP MITT E DESTIN PER RICONTROLLARE
029370940930     C     *LIKE         DEFINE    BLPCAD        VARCAD
029380940930     C     *LIKE         DEFINE    BLPCAM        VARCAM
029390940930     C     *LIKE         DEFINE    BLPCAM        VARCMO
029400950102     C     *LIKE         DEFINE    BLPQFT        VARQFT
029410940922     C* SALVO DA TARIFFA PER VEDERE COSA MEMORIZZARE SU COLLO
029420940922     C     *LIKE         DEFINE    BLPTSP        COMTSP
029430940922     C* SALVATO IN MANUTENZIONE PER VEDERE SE RISTAMPARE SEGNACOLLO
029440100209     C     *LIKE         DEFINE    BLPTSP        SA2TSP
029450100209     C     *LIKE         DEFINE    BLPTSP        SAVTSP
029460940819     C     *LIKE         DEFINE    BLPCAD        SAVCAD
029470050421     C     *LIKE         DEFINE    vidbva        SAVbva
029480940922     C     *LIKE         DEFINE    BLPRMA        SAVRMA
029490940819     C     *LIKE         DEFINE    BLPFTM        SAVFTM
029500961111     C     *LIKE         DEFINE    BLPFBR        SAVFBR
029510961122     C     *LIKE         DEFINE    BLPCBO        SAVCBO
029520970404     C     *LIKE         DEFINE    VIDBAM        SAVBAM
029530940922     C* CAMPI USATI NELLE ROUTINE DI CONTROLLO, UNICHE PER
029540960319     C*  VIDEATA PERSONALIZZAZIONE E 1 VIDEATA
029550960319     C     *LIKE         DEFINE    VIDGC1        WGC1
029560960319     C     *LIKE         DEFINE    VIDGC2        WGC2
029570960319     C     *LIKE         DEFINE    VIDTSP        WTSP
029580940928     C     *LIKE         DEFINE    VIDNZM        WNAR
029590941103     C     *LIKE         DEFINE    VIDCMO        WCMO
029600941103     C     *LIKE         DEFINE    VIDRMO        WRMO
029610940824     C     *LIKE         DEFINE    VIDLNA        WLNA
029620940824     C     *LIKE         DEFINE    VIDPDR        WPDR
029630940824     C     *LIKE         DEFINE    VIDCBO        WCBO
029640940824     C     *LIKE         DEFINE    VIDLNP        WLNP
029650940825     C     *LIKE         DEFINE    VIDFTM        WFTM
029660940825     C     *LIKE         DEFINE    VIDCCM        WCCM
029670940928     C     *LIKE         DEFINE    VIDCCM        WCCMS
029680940921     C     *LIKE         DEFINE    VIDFLC        WFLC
029690940922     C     *LIKE         DEFINE    COD           WCOD
029700940922     C     *LIKE         DEFINE    VIDVAS        WVLT
029710940928     C     *LIKE         DEFINE    VIDCTM        WCTM
029720940923     C     *LIKE         DEFINE    VIDIMV        COMIMV
029730940921     C     *LIKE         DEFINE    VIDCCM        SAVFLC
029740940928     C     *LIKE         DEFINE    VIDPDR        SAVPDR
029750990915     C     *LIKE         DEFINE    VIDPDR        SAVPD4
029760940819     C     *LIKE         DEFINE    VIDNCL        SAVNCL
029770940819     C     *LIKE         DEFINE    VIDFFD        VARFFD
029780010214     C     *LIKE         DEFINE    VIDFFD        COMFFD
029790011211     C     *LIKE         DEFINE    VIDIAS        VARIAS
029800011211     C     *LIKE         DEFINE    VIDIAS        WARIAS
029810011212     C     *LIKE         DEFINE    VIDCAS        WARCAS
029820011212     C     *LIKE         DEFINE    VIDVMD        WARVMD
029830940819     C     *LIKE         DEFINE    VIDVOL        VARVOL
029840980402     C     *LIKE         DEFINE    VIDVOL        SAVVOL
029850940819     C     *LIKE         DEFINE    VIDVOL        VA2VOL
029860940819     C     *LIKE         DEFINE    VIDPKG        VARPKG
029870980402     C     *LIKE         DEFINE    VIDPKG        SAVPKG
029880020531     C     *LIKE         DEFINE    VIDtc1        VARtc1
029890020531     C     *LIKE         DEFINE    VIDtc2        VARtc2
029900060110     C     *LIKE         DEFINE    VIDrsd        D_VARrsd
029910060110     C     *LIKE         DEFINE    VIDind        D_VARind
029920060110     C     *LIKE         DEFINE    VIDlod        D_VARlod
029930060110     C     *LIKE         DEFINE    VIDprd        D_VARprd
029940060110     C     *LIKE         DEFINE    VIDnzd        D_VARnzd
029950940819     C     *LIKE         DEFINE    VIDZNC        VARZNC
029960940819     C     *LIKE         DEFINE    VIDZNC        SAVZNC
029970940819     C     *LIKE         DEFINE    VIDPRD        VARPRD
029980940819     C     *LIKE         DEFINE    VIDDSP        SAVDSP
029990940819     C     *LIKE         DEFINE    VIDFAP        COMFAP
030000940919     C     *LIKE         DEFINE    VIDFIN        COMFIN
030010940819     C     *LIKE         DEFINE    VIDDRT        SAVDRT
030020940928     C     *LIKE         DEFINE    VIDDCR        WDCR
030030940913     C     *LIKE         DEFINE    VIDHCR        WHCR
030040940913     C     *LIKE         DEFINE    VIDMCR        WMCR
030050940913     C     *LIKE         DEFINE    VIDTCR        WTCR
030060941011     C     *LIKE         DEFINE    VIDLNA        SAVLNA
030070941011     C     *LIKE         DEFINE    BLPLNP        SAVLNP
030080940824     C     *LIKE         DEFINE    BLPLNA        COMLNA
030090940824     C     *LIKE         DEFINE    BLPLNA        CO2LNA
030100940819     C     *LIKE         DEFINE    BLPCTM        COMCTM
030110940819     C     *LIKE         DEFINE    BLPDRT        COMDRT
030120991006     C     *LIKE         DEFINE    AR6DFT        COMDFT
030130060208     C     *LIKE         DEFINE    AR6DFT        dftar6
030140940819     C     *LIKE         DEFINE    FTTPDR        W01PDR
030150940819     C     *LIKE         DEFINE    FTTTSR        W01TSR
030160940819     C     *LIKE         DEFINE    FTTFVL        W01FVL
030170941005     C* CAMPI DI CONFRONTO PER RICARICARE IL CODICE TARIFFA MITTENTE
030180941005     C     *LIKE         DEFINE    VIDTSP        VARTSP
030190960404     C     *LIKE         DEFINE    BRVFLE        KFLE
030200960404     C     *LIKE         DEFINE    BRVNPG        KNPG
030210960805     C* CAMPI che non devono essere modificati
030220960805     C     *LIKE         DEFINE    VIDNCD        WNSNCD
030230960805     C     *LIKE         DEFINE    VIDNCA        WNSNCA
030240960927     C*
030250980318     C     *LIKE         DEFINE    BLPCAD        WCAD
030260980320     C     *LIKE         DEFINE    BLPCAD        WRKCAD
030270980320     C     *LIKE         DEFINE    BLPNCA        SAVNCA
030280980320     C     *LIKE         DEFINE    BLPNCD        SAVNCD
030290980403     C     *LIKE         DEFINE    BLPNCD        SV1NCD
030300000830     C     *LIKE         DEFINE    V8CNBR        WNBR
030310000908     C     *LIKE         DEFINE    IZ1CH1        CHIDAL
030320000908     C     *LIKE         DEFINE    IZ1CH2        CHIAL
030330000911     C     *LIKE         DEFINE    V8CNBR        NR8
030340000911     C     *LIKE         DEFINE    V8ZMSG        W08MSG
030350000918     C     *LIKE         DEFINE    NR8           SAVNR8
030360001205     C     *LIKE         DEFINE    BLPTC1        SAVTC1
030370001205     C     *LIKE         DEFINE    BLPTC2        SAVTC2
030380140122     C***  *LIKE         DEFINE    BLPTC1        WTCP
030390140122     C***  *LIKE         DEFINE    BLPTC1        WSVTCP
030400010215     C* CAMPI PER O.R.M.
030410010215     C     *LIKE         DEFINE    VIDPDR        PREPDR
030420010215     C     *LIKE         DEFINE    VIDPDR        WDPDR
030430010215     C     *LIKE         DEFINE    VIDDRT        PREDRT
030440010215     C     *LIKE         DEFINE    VIDFPP        PREFPP
030450010215     C     *LIKE         DEFINE    ORMKSC        PRECCM
030460010215     C     *LIKE         DEFINE    VIDCTR        PRECTR
030470010215     C     *LIKE         DEFINE    VIDFFD        PREFFD
030480010305     C     *LIKE         DEFINE    V1CNCL        PRENCL
030490010305     C     *LIKE         DEFINE    VIDPKG        PREPKG
030500010215     C     *LIKE         DEFINE    VIDORM        W01ORM
030510010215     C     *LIKE         DEFINE    V0CLNP        WOLNP
030520010215     C     *LIKE         DEFINE    ORMKSC        WOCCM
030530010219     C     *LIKE         DEFINE    WLNP          WLNPO
030540010220     C     *LIKE         DEFINE    ORMFAO        PREFAO
030550010313     C     *LIKE         DEFINE    BLDNCD        WNCOL
030560010313     C     *LIKE         DEFINE    BLDNCD        WNCOA
030570011108     C*
030580011212     C     *LIKE         DEFINE    §CVDEC        DECCN
030590011212     C     *LIKE         DEFINE    O21FCA        FCASAV
030600011212     C     *LIKE         DEFINE    §GEIMF        IMFGEI
030610011205     C     *LIKE         DEFINE    §ORMFD        SORMFD
030620011212     C     *LIKE         DEFINE    IEDNUM        WNUMED
030630020211     C     *LIKE         DEFINE    tamksc        tarksc
030640020215     C     *LIKE         DEFINE    §ogntw        savntw
030650050114     C     *LIKE         DEFINE    §lpxco        wxco
030660940819     C***
030670940819     C* CAMPI CHE INIZIALIZZO SOLO ALL'ENTRATA DEL PROGRAMMA E BASTA
030680940819     C***
030690940819     C                   CLEAR                   VIDSOP
030700940819     C                   CLEAR                   VIDDRT
030710000104     C                   CLEAR                   WBDSP
030720990603     C* PER TIPO CHIAMATA PREPAGATO, NON IMPOSTO IL PADORNCINO
030730010301     C* NON LO IMPOSTO NEMMENO PER CHIAMATA DA CONFERMA ORM PREPAGATI
030740010301     C* DI ALTRO P.O.
030750990603     C     PARTCH        IFNE      'P'
030760010301     C     §LPFPR        ANDNE     'O'
030770941021     C                   MOVEL     '?   '        VIDPDR
030780990628     C                   MOVEL     'P'           VIDFPP
030790990603     C                   ENDIF
030800940819     C                   CLEAR                   VIDNRT
030810940819     C                   CLEAR                   VIDLNP
030820961016     C                   CLEAR                   PAXFLR
030830010212     C                   CLEAR                   VIDPOE
030840010212     C                   CLEAR                   VIDNOR
030850010212     C                   CLEAR                   VIDNRV
030860010212     C                   CLEAR                   W01ORM
030870941107     C**
030880930628     C                   Z-ADD     1             CODUT
030890930628     C                   CALL      'X§PARUT'
030900930628     C                   PARM                    UT§DSE
030910940819     C                   MOVEL     RAGUT         VIDDSA
030920930628     C                   MOVEL     REC80         CNCR80
030930930628     C*--- RICERCA CAPOCONTI
030940930628     C                   DO        50            X                 2 0
030950930628     C                   MOVE      TCU(X)        TCUDS
030960930628     C     F56           CABNE     'CG'          END1
030970930628     C     F4            COMP      '1'                                    21
030980930628     C     F4            COMP      '2'                                    22
030990930628     C     F4            COMP      '3'                                    23
031000930628     C     F4            COMP      '6'                                    27
031010930628     C** 1 CLIENTI   21
031020930628     C** 2 FORNITORI 22
031030930628     C** 3 AGENTI    23
031040930628     C     F3            COMP      '0'                                242425
031050930628     C     F3            COMP      'I'                                    26
031060930628     C** 0 ITALIA   25
031070930628     C** 1 ESTERO   24
031080930628     ** I CAPO CONTO IVA
031090930628     C   21
031100930628     CAN 24              Z-ADD     KCU(X)        KCE               4 0
031110930628     C   21
031120930628     CAN 25              Z-ADD     KCU(X)        KCI               4 0
031130930628     C   22
031140930628     CAN 24              Z-ADD     KCU(X)        KFE               4 0
031150930628     C   22
031160930628     CAN 25              Z-ADD     KCU(X)        KFI               4 0
031170930628     C   23
031180930628     CAN 24              Z-ADD     KCU(X)        KAE               4 0
031190930628     C   23
031200930628     CAN 25              Z-ADD     KCU(X)        KAI               4 0
031210930628     C   26              Z-ADD     KCU(X)        KIVA              4 0
031220930628     C   27              Z-ADD     KCU(X)        KBNA              4 0
031230930628     C     END1          TAG
031240930628     C                   END
031250940614     C                   SETOFF                                       212223
031260940614     C                   SETOFF                                       242526
031270940614     C                   SETOFF                                       27
031280991214     C                   CLEAR                   DSBLP0
031290950920     C***
031300950920     C* CARICO DATI VARIABILI PARTENZE
031310950920     C***
031320950920     C                   MOVEL     '3I'          COD
031330950920     C                   MOVEL     '1       '    KEY
031340950920     C                   EXSR      CTABEL
031350950920     C  N30              MOVEL     TBLUNI        DS3I
031360950920     C   30              CLEAR                   DS3I
031370991213     C***
031380991213     C* CARICO TABELLA DPD
031390991213     C***
031400991213     C                   MOVEL     '3I'          COD
031410991213     C                   MOVEL(P)  'DPD'         KEY
031420991213     C*
031430991213     C                   EXSR      CTABEL
031440991213     C  N30              MOVEL     TBLUNI        DS3IDP
031450991213     C   30              CLEAR                   DS3IDP
031460000509     C***
031470000509     C* CARICO TABELLA POSTE
031480000509     C***
031490000509     C                   MOVEL     '3I'          COD
031500000509     C                   MOVEL(P)  'POSTE'       KEY
031510000509     C*
031520000509     C                   EXSR      CTABEL
031530000509     C  N30              MOVEL     TBLUNI        DS3IPT
031540000509     C   30              CLEAR                   DS3IPT
031550971211     C***
031560971211     C* CARICO CODICI CLIENTI SDI PER I QUALI INSERISCO OBBLIGATORIAM
031570971211     C*  NUMERO AWB CON CONTROLLO CHECK DIGIT
031580971211     C***
031590971211     C                   MOVEL     '3I'          COD
031600971211     C                   MOVEL     'E       '    KEY
031610971211     C                   EXSR      CTABEL
031620971211     C  N30              MOVEA     TBLUNI        KSS
031630971212     C* 2 CIFRE INIZIALI FISSE PER NUMERO AWB
031640971212     C  N30              MOVE      TBLUNI        §3IFAW            2 0
031650971211     C   30              CLEAR                   KSS
031660971212     C   30              CLEAR                   §3IFAW
031670950920     C**
031680930401     C* CODICE PER ASSICURAZIONE PER CONTO
031690950920     C**
031700990818     C                   MOVEL     'C '          FTC
031710041217     c**
031720041217      * Aggancio tabella "VPO" per reperimento giorni per calcolo
031730041217      * max data consegna richiesta
031740041217     C                   CLEAR                   dsbs02
031750041217     c                   clear                   dvpo
031760041217     C                   MOVEL     'C'           T02MOD
031770041217     C                   MOVEL     KNSIF         T02SIF
031780041217     C                   MOVEL     'VPO'         T02COD
031790041217     c                   movel(P)  'VPO'         t02ke1
031800041217     C                   CALL      'TIBS02R'
031810041217     C                   PARM                    KPJBA
031820041217     C                   PARM                    dsbs02
031830041217    2C                   IF        T02ERR = *BLANKS
031840041217     C                   MOVEL     T02uni        dvpo
031850041217    2C                   ENDIF
031860121017      * Aggancio tabella "VPODECO"
031870060207     C                   CLEAR                   dsbs02
031880060207     c                   clear                   dvpodeco
031890060207     C                   MOVEL     'C'           T02MOD
031900060207     C                   MOVEL     KNSIF         T02SIF
031910060207     C                   MOVEL     'VPO'         T02COD
031920060207     c                   movel(P)  'DECO'        t02ke1
031930060207     C                   CALL      'TIBS02R'
031940060207     C                   PARM                    KPJBA
031950060207     C                   PARM                    dsbs02
031960060207    2C                   IF        T02ERR = *BLANKS
031970060207     C                   MOVEL     T02uni        dvpodeco
031980060207    2C                   ENDIF
031990121017      * Aggancio tabella "DGD"
032000121017     C                   CLEAR                   dsbs02
032010121017     c                   clear                   dvpodeco
032020121017     C                   MOVEL     'C'           T02MOD
032030121017     C                   MOVEL     KNSIF         T02SIF
032040121017     C                   MOVEL     'DGD'         T02COD
032050121017     c                   movel(P)  '1'           t02ke1
032060121017     C                   CALL      'TIBS02R'
032070121017     C                   PARM                    KPJBA
032080121017     C                   PARM                    dsbs02
032090121017    2C                   IF        T02ERR = *BLANKS
032100121017     C                   MOVEL     T02uni        ddgd
032110121017    2C                   ENDIF
032120140212      * Aggancio tabella "CSP"--> Caratteri Speciali per eliminazione
032130140212      *                           caratteri di punteggiatura da loc.dest.
032140140212     C                   CLEAR                   dsbs02
032150140212     C                   CLEAR                   charnook
032160140212     C                   MOVEL     'C'           T02MOD
032170140212     C                   MOVEL     KNSIF         T02SIF
032180140212     C                   MOVEL     'CSP'         T02COD
032190140212     c                   movel(P)  'LOC'         t02ke1
032200140212     C                   CALL      'TIBS02R'
032210140212     C                   PARM                    KPJBA
032220140212     C                   PARM                    dsbs02
032230140212    2C                   IF        T02ERR = *BLANKS
032240140212     C                   MOVEL     T02uni        charnook
032250140212    2C                   ENDIF
032260140212     c* imposto stringa contenente caratteri speciali per il controllo
032270140212     c* della parte finale (uguale alla charnook maa senza l'eventuale '.')
032280140212     c                   eval      charnookf=%xlate('.':' ':charnook)
032281141202      * Aggancio tabella "CSP"--> Caratteri ammessi per PIN CODE
032283141202     C                   CLEAR                   dsbs02
032284141202     C                   CLEAR                   charPCok
032285141202     C                   MOVEL     'C'           T02MOD
032286141202     C                   MOVEL     KNSIF         T02SIF
032287141202     C                   MOVEL     'CSP'         T02COD
032288141202     c                   movel(P)  'PINCODE'     t02ke1
032289141202     C                   CALL      'TIBS02R'
032290141202     C                   PARM                    KPJBA
032291141202     C                   PARM                    dsbs02
032292141202    2C                   IF        T02ERR = *BLANKS
032293141202     C                   MOVEL     T02uni        charPCok
032294141202    2C                   ENDIF
032295140612
032300140612     c* ricerca P.O. abilitati da tabella VPO per step di test
032310140612     c                   clear                   trulvpods
032320140612     c                   eval      ivpoke1 = 'DECOFIDIR'
032330140612     c                   call      'TRULVPOR'
032340140612     c                   parm                    trulvpods
032350140212     c
032360111130     c
032370101022     C***
032380101022     C* CARICO TABELLA SIMBOLI CALENDARIO FESTIVI
032390101022     C***
032400101022     C                   MOVEL     '1Y'          COD
032410101022     C                   Z-ADD     1             C
032420101022     C     KTAB3         SETLL     TABEL
032430101022     C                   EXSR      RTABEL
032440101022     C*
032450101022     C     *IN30         DOWEQ     '0'
032460101022     C     TBLFLG        IFEQ      ' '
032470101022     C                   MOVEL     TBLUNI        DS1Y
032480101022     C     §1Yfec        IFEQ      'S'
032490101022     C                   MOVEL     TBLKEY        s1Y(C)
032500101022     C                   ADD       1             C
032510101022     C                   ENDIF
032520101022     C                   ENDIF
032530101022     C*
032540101022     C                   EXSR      RTABEL
032550101022     C                   ENDDO
032560930401     C*
032570950920     C* DATA BOLLETTAZIONE:  TRA UDATE E DATA GIORNO + §3IGGS
032580950920     C*  SOLO PER LE SPEDIZ.DI RECUPERO E' TRA DATA G. - 3  E  + §3IGGS
032590940920     C                   TIME                    W0140            14 0
032600940920     C* UDATE IN GGMMAAAA
032610940920     C                   MOVE      W0140         WDTGIO            8 0
032620990630     C                   MOVE      WDTGIO        DATAAS
032630940819     C*
032640940920     C* UDATE IN AAAAMMGG
032650940920     C                   Z-ADD     WDTGIO        G02DAT
032660910208     C                   MOVEL     *BLANK        G02ERR
032670940819     C                   CALL      'XSRDA8'
032680910208     C                   PARM                    WLBDAT
032690940819     C                   MOVEL     G02INV        DATEU             8 0
032700030409
032710030415      * Calcolo oggi + 5 gg.
032720051215     c****               Move      Dateu         Dataiso
032730051215     c****               Adddur    §vpodcg:*d    Dataiso
032740051215     c****               Move      Dataiso       woggi5
032750051215     c*
032760051215     c                   Move      Dateu         Dataiso
032770051215     c                   Adddur    §vpodcgm1:*d  Dataiso
032780051215     c                   Move      Dataiso       woggidcgm1
032790051215     c*
032800051215     c                   Move      Dateu         Dataiso
032810051215     c                   Adddur    §vpodcgm2:*d  Dataiso
032820051215     c                   Move      Dataiso       woggidcgm2
032830030416
032840051214      **Calcolo oggi + 1 mm.
032850051214     c**                 Move      Dateu         Dataiso
032860051214     c**                 Adddur    1:*m          Dataiso
032870051214     c**                 Move      Dataiso       woggi1m
032880030409
032890950921     C* SE NON FOSSE PERMESSO BOLLETTARE IN SOSPENSIONE
032900950921     C*  SI PUO' BOLLETTARE SOLO FINO A OGGI
032910950921     C                   Z-ADD     G02INV        DATAPA            8 0
032920950921     C                   MOVEL     G02DAT        DATAPG            8
032930950919     C* SOTTRAGGO  3
032940950919     C     G02TGI        SUB       3             GIOTGI
032950950919     C*
032960950919     C                   CALL      'XSRGI8'
032970950919     C                   PARM                    WGIDAT
032980950919     C*
032990950919     C                   Z-ADD     GIOINV        DATAM             8 0
033000080109     C* SOTTRAGGO  giorni per ottenere data minima per data ritiro
033010080109     c                   clear                   TRUL52ds
033020080109     c                   eval      d52gio=§3iggb
033030080109     c                   eval      d52sgn='-'
033040080109     c                   z-add     dateu         D52din
033050080109     c                   call      'TRUL52R'
033060080109     c                   parm                    TRUL52ds
033070080109     C*
033080080109     C                   Z-ADD     d52dfi        DATAmin           8 0
033090080603     c* sottraggo 40 gg. per otternere data minima per data ritiro per
033100080603     c* prepagati
033110080603     c                   move      dateu         dataiso
033120080603     c                   subdur    40:*d         dataiso
033130080603     c                   move      dataiso       datam40
033140080603     c
033150061220     c                   z-add     g02tgi        salvatgi
033160991214     C*
033170991214     C* SOTTRAGGO  I GIORNI PER LA DATA CONTROLLO OPPIO PARCEL DPD
033180991214     C     G02TGI        SUB       §3IGGU        GIOTGI
033190991214     C*
033200991214     C                   CALL      'XSRGI8'
033210991214     C                   PARM                    WGIDAT
033220991214     C*
033230991214     C                   Z-ADD     GIOINV        DPDDSP            8 0
033240130305     c* sottraggo i giorni per controllo pdf cliente doppio
033250130305     c                   move      dateu         dataiso
033260130305     c                   subdur    §vpogpdf:*d   dataiso
033270130305     c                   move      dataiso       datapdf
033280950919     C*
033290950919     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
033300990602     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
033310990602     C* PER I PREPAGATI
033320950920     C                   Z-ADD     1             X
033330950920    1C     X             DOWLE     §3IGGS
033340990602     C     PARTCH        ANDNE     'P'
033350010301     C     §LPFPR        ANDNE     'O'
033360990602    1C     X             ORLE      §3IGGP
033370990602     C     PARTCH        ANDEQ     'P'
033380010301    1C     X             ORLE      §3IGGP
033390010301     C     §LPFPR        ANDEQ     'O'
033400950920     C*
033410950921     C                   MOVEL     'F'           WFEST             1
033420950920     C*
033430950920    2C     WFEST         DOWNE     ' '
033440950919     C     G02TGI        ADD       1             GIOTGI
033450950919     C                   ADD       1             G02TGI
033460940819     C                   CALL      'XSRGI8'
033470910208     C                   PARM                    WGIDAT
033480910221     C*
033490950920     C                   Z-ADD     GIOINV        DATAPA            8 0
033500950920     C                   MOVEL     GIODAT        DATAPG            8
033510950920     C*
033520950920     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
033530950921     C                   Z-ADD     GIOINV        WDATA
033540950920     C                   CLEAR                   W0030
033550120302     C* CHAIN SUL CALENDARIO BRT
033560950920     C     KCLN          CHAIN     AZCLN01L                           30
033570950920     C   30              CLEAR                   CLNPOM
033580950921     C                   MOVEA     CLNPOM        K31
033590950920     C                   MOVEL     K31(WGG)      WFEST
033600101022     c* Se non è festivo pulisco il campo WFEST
033610101022     c     wfest         lookup    S1Y                                    30
033620101022     c                   if        not *in30
033630101022     c                   clear                   wfest
033640101022     c                   endif
033650101022     c
033660950920    2C                   ENDDO
033670950920     C*
033680950920     C                   ADD       1             X
033690990602    1C                   ENDDO
033700061220     c
033710061220     c* trovo primo giorno lavorativo minore di oggi per bollettare in
033720061220     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
033730061220     C                   TIME                    orapgm            6 0
033740061221    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
033750061220     C                   MOVEL     'F'           WFEST             1
033760061220     c                   z-add     salvatgi      giotgi
033770061220     C*
033780061220    1C     WFEST         DOWNE     ' '
033790061221     C     salvatgi      sub       1             GIOTGI
033800061221     C                   sub       1             salvatgi
033810061220     C                   CALL      'XSRGI8'
033820061220     C                   PARM                    WGIDAT
033830061220     C*
033840061220     C                   Z-ADD     GIOINV        DATAmeno1         8 0
033850061221     C                   MOVEL     GIODAT        DATgmeno1         8 0
033860061220     C*
033870061220     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
033880061220     C                   Z-ADD     GIOINV        WDATA
033890061220     C                   CLEAR                   W0030
033900120302     C* CHAIN SUL CALENDARIO BRT
033910061220     C     KCLN          CHAIN     AZCLN01L                           30
033920061220     C   30              CLEAR                   CLNPOM
033930061220     C                   MOVEA     CLNPOM        K31
033940061220     C                   MOVEL     K31(WGG)      WFEST
033950101022     c* Se non è festivo pulisco il campo WFEST
033960101022     c     wfest         lookup    S1Y                                    30
033970101022     c                   if        not *in30
033980101022     c                   clear                   wfest
033990101022    2C                   ENDif
034000101022     c
034010061220    1C                   ENDDO
034020061220   x0c                   else
034030061220     C*
034040061221     C                   Z-ADD     dateu         DATAmeno1
034050061221     C                   MOVEL     wdtgio        DATgmeno1
034060061220    0c                   endif
034070941109     C***
034080941109     C* CARICO CAMPI FISSI PER TASSAZIONE/BOLLETTAZIONE
034090941109     C***
034100941109     C                   MOVEL     'QT'          COD
034110941109     C                   MOVEL     '1       '    KEY
034120941109     C                   EXSR      CTABEL
034130941109     C  N30              MOVEL     TBLUNI        DSQT1
034140941109     C   30              CLEAR                   DSQT1
034150930601     C*
034160920427     C* NUMERO PER FORZARE GLI ERRORI: 1 PER IMM E MANUT.BOLLE
034170920427     C*                                2 PER DISK CLI
034180920427     C                   Z-ADD     1             NUMFOR            1 0
034190940923     C***
034200940923     C* DTU,10 LA PORTO A 8 PER I CONTROLLO
034210940923     C***
034220940923     C                   CLEAR                   WLBDAT
034230940923     C                   Z-ADD     DTU(10)       G02INV
034240940923     C                   MOVEL     '3'           G02ERR
034250940923     C                   CALL      'XSRDA8'
034260940923     C                   PARM                    WLBDAT
034270940923     C                   MOVEL     G02INV        WDTU10            8 0
034280990830     C* ADDIZIONO  3
034290990830     C     G02TGI        ADD       1             GIOTGI
034300990830     C*
034310990830     C                   CALL      'XSRGI8'
034320990830     C                   PARM                    WGIDAT
034330990830     C*
034340990830     C                   Z-ADD     GIODAT        WDTUPI            8 0
034350000113     C                   MOVE      GIODAT        WAAUPI            4 0
034360990830     C*
034370941107     C***
034380960926     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
034390941107     C***
034400941107     C                   CLEAR                   DSUL06
034410941107     C                   MOVE      '£1'          D06COD
034420941107     C                   MOVEL     SIMFEL        D06KEY
034430961003     C                   MOVEL     'L'           D06TLA
034440941107     C                   MOVEL     DSUL06        KPJBU
034450941107     C*
034460941107     C                   CALL      'TRUL06R'
034470941107     C                   PARM                    KPJBA
034480941107     C                   MOVEL     KPJBU         DSUL06
034490941107     C                   MOVEA     LIN           L1
034500070807     C***
034510070807     C* CARICO £6
034520070807     C***
034530070807     C                   CLEAR                   DSUL06
034540070807     C                   MOVE      '£6'          D06COD
034550070807     C                   movel     SImpou        D06KEY
034560070807     C                   MOVEL     'L'           D06TLA
034570070807     C                   MOVEL     DSUL06        KPJBU
034580070807     C*
034590070807     C                   CALL      'TRUL06R'
034600070807     C                   PARM                    KPJBA
034610070807     C                   MOVEL     KPJBU         DSUL06
034620070807     C                   MOVEA     LIN           L6
034630941107     C***
034640941107     C* CARICO TABELLA 5E : TIPI SERVIZIO
034650941107     C***
034660941107     C                   MOVEL     '5E'          COD
034670941107     C                   Z-ADD     1             C
034680941107     C     KTAB3         SETLL     TABEL
034690941107     C                   EXSR      RTABEL
034700941107     C*
034710941107     C     *IN30         DOWEQ     '0'
034720941107     C     TBLFLG        IFEQ      ' '
034730941107     C                   MOVEL     TBLKEY        TSP(C)
034740941108     C                   MOVEL     TBLUNI        DS5E
034750941107     C                   MOVEL     §5EDES        DTS(C)
034760941107     C                   MOVEL     §5EFUB        UTS(C)
034770941115     C                   MOVEL     §5EFST        STS(C)
034780000509     C                   MOVEL     §5EUSO        USO(C)
034790090604     c                   eval      dts08(c) = §5ed08
034800090609     c                   eval      dts03(c) = §5ed03
034810090827     c                   eval      tsTTC(c) = §5ettc
034820941107     C                   ADD       1             C
034830941107     C                   ENDIF
034840941107     C*
034850941107     C                   EXSR      RTABEL
034860941107     C                   ENDDO
034870960209     C***
034880960209     C* CARICO TABELLA TIPI BOLLA CHE PREVEDONO L'ASSICURAZIONE
034890960209     C***
034900960209     C                   MOVEL     'TB'          COD
034910960209     C                   Z-ADD     1             C
034920960209     C     KTAB3         SETLL     TABEL
034930960209     C                   EXSR      RTABEL
034940960209     C*
034950960209     C     *IN30         DOWEQ     '0'
034960960209     C     TBLFLG        IFEQ      ' '
034970960209     C                   MOVEL     TBLUNI        DSTB
034980960209     C     §TBFAS        IFEQ      '1'
034990960209     C                   MOVEL     TBLKEY        TBL(C)
035000960209     C                   ADD       1             C
035010960209     C                   ENDIF
035020960209     C                   ENDIF
035030960209     C*
035040960209     C                   EXSR      RTABEL
035050960209     C                   ENDDO
035060970115     C***
035070970115     C* CARICO TABELLA 3F : DICITURE NON AMMESSE NELLA NATURA MERCE
035080970115     C***
035090970115     C                   MOVEL     '3F'          COD
035100970115     C                   Z-ADD     1             C
035110970115     C     KTAB3         SETLL     TABEL
035120970115     C                   EXSR      RTABEL
035130970115     C*
035140970115     C     *IN30         DOWEQ     *OFF
035150970115     C     TBLFLG        IFEQ      ' '
035160970115     C                   MOVEL     TBLKEY        W003A
035170970115     C                   MOVEL     W003A         TBO(C)
035180970115     C                   MOVE      W003A         LDC(C)
035190970115     C                   ADD       1             C
035200970115     C                   ENDIF
035210970115     C*
035220970115     C                   EXSR      RTABEL
035230970115     C                   ENDDO
035240991007     c***
035250991007     c* CARICO TABELLA CODICI VARIE
035260991007     c***
035270991007     C                   MOVEL     '$2'          COD
035280991007     C                   MOVEL     *BLANKS       KEY
035290991007     C                   MOVEL     '1'           KEY
035300991007     C     KTAB2         CHAIN     TABEL                              30
035310991007     C     *IN30         IFEQ      *OFF
035320991007     C                   MOVEL     TBLUNI        DS$2
035330991007     C                   ELSE
035340991007     C                   CLEAR                   DS$2
035350991007     C                   ENDIF
035360991008      *
035370991102      * AGGANCIO TABELLA GED PER DIVISA DELLA MONETA DI CONTO
035380991102     C                   CLEAR                   DSBS02
035390000124     C                   MOVEL     'C'           T02MOD
035400991102     C                   MOVEL     KNSIF         T02SIF
035410991102     C                   MOVEL     'GED'         T02COD
035420991102     C                   MOVEL     '1'           T02KE1
035430991102      *
035440991102     C                   CALL      'TIBS02R'
035450991102     C                   PARM                    KPJBA
035460991102     C                   PARM                    DSBS02
035470991102      *
035480991102     C     T02ERR        IFEQ      *BLANKS
035490991102     C                   MOVEL     T02UNI        DGED
035500991008     C                   ELSE
035510991008     C                   CLEAR                   DGED
035520991008     C                   ENDIF
035530011108     c*
035540011108      * Tabella CV della moneta di conto
035550011212     C                   CLEAR                   DSCV
035560011212     C                   CLEAR                   DECCN
035570020102     C                   CLEAR                   COMFDC
035580011212     C                   MOVEL     'CV'          COD
035590011212     C                   MOVEL(P)  §GEDCN        KEY
035600011212     C                   EXSR      CTABEL
035610011212     C     *IN30         IFEQ      *OFF
035620011212     C                   MOVEL     TBLUNI        DSCV
035630011212     C                   MOVEL     §CVDEC        DECCN
035640020102     C                   MOVEL     §CVFDC        COMFDC
035650011212     C                   ENDIF
035660011108     C*
035670011212      * AGGANCIO TABELLA GEI PER LIMITE FATTURABILE
035680011212     C                   CLEAR                   DSBS02
035690011212     C                   MOVEL     'C'           T02MOD
035700011212     C                   MOVEL     KNSIF         T02SIF
035710011212     C                   MOVEL     'GEI'         T02COD
035720011212     C                   MOVEL     §GEDCN        T02KE1
035730011108      *
035740011212     C                   CALL      'TIBS02R'
035750011212     C                   PARM                    KPJBA
035760011212     C                   PARM                    DSBS02
035770011108      *
035780011212     C     T02ERR        IFEQ      *BLANKS
035790011212     C                   MOVEL     T02UNI        DGEI
035800011212     C                   ELSE
035810011212     C                   CLEAR                   DGEI
035820011212     C                   ENDIF
035830011212     C                   Z-ADD     §GEIMF        IMFGEI
035840000124      *
035850000124      * AGGANCIO TABELLA "CHI" PER TEL E FAX PER EXPORT DPD
035860040525     C***                CLEAR                   DSBS02
035870040525     C***                MOVEL     'C'           T02MOD
035880040525     C***                MOVEL     KNSIF         T02SIF
035890040525     C***                MOVEL     'CHI'         T02COD
035900040525     C***                MOVEL     'TELFAX'      T02KE1
035910000124      *
035920040525     C***                CALL      'TIBS02R'
035930040525     C***                PARM                    KPJBA
035940040525     C***                PARM                    DSBS02
035950000124      *
035960040525     C***  T02ERR        IFEQ      *BLANKS
035970040525     C***                MOVEL     T02UNI        TELFAX
035980040525     C***                ELSE
035990040525     C***                MOVEL     *ALL'?'       TELFAX
036000040525     C***                ENDIF
036010021120
036020021120      * Aggancio tabella default tariffe fedex
036030021120     c                   Clear                   Dsbs02
036040021120     c                   Movel     'C'           T02Mod
036050021120     c                   Movel     KNSIF         T02Sif
036060021120     c                   Movel     'DFE'         T02Cod
036070021120     c                   Movel     'FED'         T02Ke1
036080021120     c                   Call      'TIBS02R'
036090021120     c                   Parm                    Kpjba
036100021120     c                   Parm                    Dsbs02
036110021120     c                   If        T02Err = *Blanks
036120021120     c                   Movel     T02Uni        DDfe
036130021120     c                   Else
036140021120     c                   Clear                   DDfe
036150021120     c                   EndIf
036160040701      * Aggancio tabella "VPO" per reperimento data ultima fase poste
036170040701     C                   CLEAR                   dsbs02
036180040701     c                   clear                   dvpoppt
036190040701     C                   MOVEL     'C'           T02MOD
036200040701     C                   MOVEL     KNSIF         T02SIF
036210040701     C                   MOVEL     'VPO'         T02COD
036220040701     c                   movel(P)  'PPT'         t02ke1
036230040701     C                   CALL      'TIBS02R'
036240040701     C                   PARM                    KPJBA
036250040701     C                   PARM                    dsbs02
036260040701    2C                   IF        T02ERR = *BLANKS
036270040701     C                   MOVEL     T02uni        dvpoppt
036280040701    2C                   ENDIF
036290081111      * Recupero le date delle statistiche
036300081111     c                   Clear                   dsbs02
036310081111     c                   Clear                   dSdf
036320081111     c                   Eval      T02Mod = 'C'
036330081111     c                   Eval      T02Sif = Knsif
036340081111     c                   Eval      T02Cod = 'SDF'
036350081111     c                   Movel(p)  Simfel        T02Ke1
036360081111     c                   Call      'TIBS02R'
036370081111     c                   Parm                    Kpjba
036380081111     c                   Parm                    dsbs02
036390081111     c                   If        T02Err = *Blanks
036400081111     c                   Movel     T02Uni        dSdf
036410081111     c                   EndIf
036420021120
036430000202     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
036440000202     C                   Z-ADD     SIMFEL        W0030
036450000202     C     W0030         CHAIN     AZORG01L      UNIORG               30
036460000202     C                   MOVEL     ORGFEL        WASFEL            3 0
036470000204     C                   MOVEL     ORGDF0        OG150
036480000204     C                   MOVEL     §OGDKC        WASDKC            1
036490001017     C                   MOVEL     §OGPES        WVDLMN            6
036500040329     c                   Eval      Og143 = Orgde3
036510040329     c                   Eval      LnpOgAs = §OgAs
036520991008     C*
036530930628     C***
036540930628     C* VEDO SE SONO SIMFEL O REMOTO
036550930628     C***
036560930628     C                   MOVEL     SIMFEL        CDU               3 0
036570930628     C*
036580020513     c     simtpp        ifeq      '2'
036590020513     c     simtpp        oreq      *blanks
036600020513     c                   movel     simpou        cdu
036610930628     C                   END
036620941115     C**
036630941115     C* VEDO IL RICHIAMO
036640941115     C**
036650941115    1C     §LPFPR        IFNE      'C'
036660941115     C     §LPFPR        ANDNE     'G'
036670941115     C     §LPFPR        ANDNE     'I'
036680941115     C*
036690990602     C                   SELECT
036700990602     C* RECUPERO BOLLE
036710990602    2C     PARTCH        WHENEQ    'R'
036720941115     C                   MOVE      DES(4)        VIDTES
036730941115     C                   SETON                                        98
036740990602     C* PROCEDURA PREPAGATI
036750990602    2C     PARTCH        WHENEQ    'P'
036760010301     C     §LPFPR        OREQ      'O'
036770990602     C                   MOVE      DES(6)        VIDTES
036780990602   X2C                   OTHER
036790941115     C                   MOVE      DES(1)        VIDTES
036800990602    2C                   ENDSL
036810941115    1C                   ENDIF
036820941115     C*
036830941115     C* SE IMMISSIONE VISUALIZZO: ULTIMA SPEDIZIONE
036840941115     C                   MOVEL     CULTSP        PREDSS
036850941115     C*
036860941115    1C     §LPFPR        IFNE      'C'
036870941115     C* ESEGUO SOLO UNA VOLTA
036880941115    2C     RIC           IFEQ      ' '
036890941115    3C     §LPFPR        IFNE      ' '
036900010301     C     §LPFPR        ANDNE     'O'
036910941115     C*
036920941115     C* PROVENGO DA MANUTENZIONE
036930941115    4C     §LPFPR        IFEQ      'M'
036940941115     C                   SETON                                        12
036950941115     C                   MOVE      DES(2)        VIDTES
036960941115     C                   MOVEL     CVARIA        PREDSS
036970941115     C                   OPEN      FNLBL01L
036980070123     C                   OPEN      FNBRV09L
036990071221     C                   OPEN      FNBRV07L
037000080904     C                   OPEN(e)   TNBLA00F
037010080904     c
037020080904     c                   if        not %open(tnbla00f)
037030080904     c                   eval      %subst(WTNBLA:7:4)='GRPS'
037040080904     C                   OPEN      TNBLA00F
037050080904     c                   endif
037060941115     C*
037070941115   X4C                   ELSE
037080941115     C* PROVENGO DA CARICAMENTO BOLLE DA DISK
037090941115     C                   SETON                                        1215
037100941115     C                   MOVEL     CCONFE        PREDSS
037110020917     C                   OPEN      FIVAD02L
037120020917     C                   OPEN      FIVAT01L
037130040601     C                   OPEN      FIVAX01L
037131140716     C                   OPEN      FNBRV07L
037140941115     C     *IN98         IFEQ      *OFF
037150941115     C                   MOVE      DES(3)        VIDTES
037160941115     C                   ELSE
037170941115     C                   MOVE      DES(5)        VIDTES
037180941115     C                   ENDIF
037190941115     C*
037200941115    4C                   END
037210941115    3C                   END
037220941115    2C                   END
037230941115    1C                   END
037240110518     c*
037250110518     c                   if        not *in12
037260110518     c                   open      fivab01l
037270110518     c                   open      edivab1l
037280110518     c                   endif
037290940819     C*
037300940915     C* QUESTI 2 CAMPI UNA VOLTA IMPOSTATI NON LI TOCCO PIU':
037310070828     c* Non più: la data ritiro a nuova bolla la reimposterò sempre a udate
037320940915     C*
037330960926     C* LINEA DI PARTENZA --> IMPOSTO
037340940915     C  N12              MOVEL     CDU           VIDLNP
037350940915     C* DATA RITIRO       --> IMPOSTO DATA DEL GIORNO
037360990628     C  N12PARTCH        IFNE      'P'
037370010301     C     §LPFPR        ANDNE     'O'
037380070828     C                   MOVEL     WDTGIO        VIDDRT
037390990630     C                   ELSE
037400990630     C                   OPEN      CNNUM00F
037410990628     C                   ENDIF
037420940915     C*
037430930628     C* CAMPI CHE INIZIALIZZO SOLO IN IMMISSIONE BOLLE
037440930628     C*   E PER DISK CLIENTI
037450930628     C   12
037460930628     CAN 15
037470930628     CORN12              DO
037480930628     C                   MOVEL     *ZEROS        RECNSP
037490930628     C                   MOVEL     *ZEROS        VIDDBR
037500930628     C                   MOVEL     *ZEROS        VIDNFV
037510930628     C                   MOVEL     *ZEROS        VIDNSP
037520930628     C                   MOVE      *BLANKS       BLPATB
037530940915     C                   MOVEL     CDU           BLPFLB
037540111128     C****               MOVEL     SIMFEL        BLPFLE
037550940915     C                   MOVEL     *ZEROS        BLPDPC
037560940915     C                   MOVEL     *ZEROS        BLPDUC
037570940819     C                   MOVEL     *ZEROS        BLPFLP
037580930628     C                   MOVEL     *ZEROS        BLPDAM
037590930628     C                   MOVEL     *ZEROS        BLPDCM
037600930628     C                   MOVEL     *ZEROS        BLPHMC
037610930628     C                   MOVEL     *ZEROS        BLPDUT
037620930628     C                   MOVEL     *ZEROS        BLPDET
037630930628     C                   MOVEL     *ZEROS        BLPDSE
037640940915     C                   MOVEL     *ZEROS        BLPVLC
037650930628     C                   MOVEL     *ZEROS        BLPNCR
037660940915     C                   MOVEL     *ZEROS        BLPDT1
037670940915     C                   MOVEL     *ZEROS        BLPDT2
037680940915     C                   MOVEL     *ZEROS        BLPDT3
037690940915     C                   MOVEL     *BLANKS       BLPFT1
037700940915     C                   MOVEL     *BLANKS       BLPFT2
037710940915     C                   MOVEL     *BLANKS       BLPFT3
037720940915     C                   Z-ADD     DATEU         BLPDIM
037730940915     C                   CLEAR                   BLPFDN
037740940915     C                   CLEAR                   BLPNCP
037750940915     C                   CLEAR                   BLPPKC
037760940915     C                   CLEAR                   BLPDTI
037770940915     C                   CLEAR                   BLPHTI
037780940915     C                   CLEAR                   BLPDCE
037790940915     C                   CLEAR                   BLPNPI
037800940915     C                   CLEAR                   BLPNCI
037810940915     C                   CLEAR                   BLPNCR
037820940915     C                   CLEAR                   BLPNDC
037830940915     C                   CLEAR                   BLPDDC
037840940915     C                   CLEAR                   BLPDCP
037850940915     C                   CLEAR                   BLPCCA
037860940915     C                   CLEAR                   BLPTMC
037870040901     c                   clear                   blpscl
037880040329      * per immissione bolle o per conferma bolle da clienti
037890040329      * Se il p.o. è già su AS unico apro TITAS
037900040329     c                   If        LnpOgAs = 946
037910040329     c                             and Not %Open(Titas30c)
037920040329     c                   Clear                   comman
037930040329     c                   Movel(p)  cmdt(1)       comman
037940040329     c                   Eval      %Subst(comman:30:10) = wlib
037950040329     c                   Eval      comman =
037960040329     c                             %trim(comman) + '/TITAS30C)'
037970040329     c                   Call      'QCMDEXC'                            99
037980040329     c                   Parm                    comman
037990040329     c                   Parm                    lenght
038000040329     c  n99              Open      Titas30c
038010040329     c                   EndIf
038020940928     C                   ENDDO
038030930611     C*
038040930611     C* STAMPA DEI 3 ASTERISCHI ALLA FINE SE><0
038050930611     C                   Z-ADD     0             I100              1 0
038060930628     C*
038070930628     C                   MOVEL     'C'           RIC               1
038080940920     C* SIGLA OPERATORE:
038090940920     C* IN IMMISSIONE SEMPRE SPROTETTA
038100940920     C     *IN12         IFEQ      *OFF
038110940920     C                   SETOFF                                       13
038120940920     C                   ENDIF
038130940920     C*
038140940920     C* IN DISK CLIENTI SEMPRE PROTETTA
038150940920     C     *IN12         IFEQ      *ON
038160940920     C     *IN15         ANDEQ     *ON
038170940920     C                   SETON                                        13
038180940920     C                   ENDIF
038190940920     C* IN MANUTENZIONE SOLO SE E' UNA SIGNA NON UTILIZABILE:
038200940920     C* LO CONTROLLO BOLLA PER BOLLA QUINDI IN CARBLP LO FACCIO
038210941117     C                   CLEAR                   SAVFIE
038220971215     C* IMPOSTO LA DS ESTERA PER I CAMPI FISSI
038230971215     C                   CLEAR                   DSBLD
038240971215     C                   CLEAR                   DSBLDE
038250000120     C*
038260000120     C                   MOVEL     'CHI'         KTCOD
038270000202     C                   MOVEL     WASFEL        KTKE1
038280000120     C                   CLEAR                   KTLIN
038290000120     C                   CLEAR                   KTSIF
038300000120     C                   CLEAR                   KTKE2
038310010319     C* VEDO SE IN L1 PRESENTE P.O. DPD
038320010319     C                   CLEAR                   WSIDPD
038330010319     C                   Z-ADD     1             II
038340010319     C     II            DOWLE     30
038350010319     C     WSIDPD        ANDEQ     *BLANKS
038360010319     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
038370010319     C  N30              MOVEL     ORGDE3        OG143
038380010319     C   30              CLEAR                   OG143
038390020319     C     §OGntw        IFEQ      'DPD'
038400010319     C                   MOVEL     'S'           WSIDPD            1
038410010319     C                   ENDIF
038420010319     C                   ADD       1             II
038430010319     C                   ENDDO
038440051124     c* imposto campi fissi da passare a fnlsa8r
038450051124     c**                 z-add     simfel        parfel
038460051124     c**                 movel     '1'           parflg
038470130117
038480130117      * Carico la tabella OSR
038490130117     c                   exsr      carosr
038500130117
038510920220     C                   ENDSR
038520130117
038530130117      /free
038540130117       // ----------------------------------------------------------------------
038550130117       //?Carico tabella OSR.
038560130117       // ----------------------------------------------------------------------
038570130117       begsr carosr;
038580130117
038590130117         clear osrxx;
038600130117
038610130117       //?carico tutta la tabella OSR delle LNP/NRS ORM
038620130117         setll    c_tabosr tntbe01l;
038630130117         reade(n) c_tabosr tntbe01l;
038640130117
038650130117         dow not %eof(tntbe01l);
038660130122           IF  TBEatb = *blanks;
038670130117           dosr = tbeuni;
038680130117       //?carico in sk tutti i clienti che trovo
038690130117       //?skCLIosr = cliente
038700130117       //?skLNPNRSosr = LNP + serie (TBEke1)
038710130117           IF d§osrcli <> 0;
038720130117             osrxx = %lookup(d§OSRcli:skCLIosr);
038730130117             IF  osrxx = 0;
038740130117               osrxx = %lookup(*zeros:skCLIosr);
038750130117               IF  osrxx > 0;
038760130117                 skCLIosr(osrxx) = d§OSRcli;
038770130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038780130117               ENDIF;
038790130117             ENDIF;
038800130117           ENDIF;
038810130117
038820130117           IF d§osrcl2 <> 0;
038830130117             osrxx = %lookup(d§OSRcl2:skCLIosr);
038840130117             IF  osrxx = 0;
038850130118               osrxx = %lookup(*zeros:skCLIosr);
038860130117               IF  osrxx > 0;
038870130117                 skCLIosr(osrxx) = d§OSRcl2;
038880130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038890130117               ENDIF;
038900130117             ENDIF;
038910130117           ENDIF;
038920130117
038930130117           IF d§osrcl3 <> 0;
038940130117             osrxx = %lookup(d§OSRcl3:skCLIosr);
038950130117             IF  osrxx = 0;
038960130117               osrxx = %lookup(*zeros:skCLIosr);
038970130117               IF  osrxx > 0;
038980130117                 skCLIosr(osrxx) = d§OSRcl3;
038990130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039000130117               ENDIF;
039010130117             ENDIF;
039020130117           ENDIF;
039030130117
039040130117           IF d§osrcl4 <> 0;
039050130117             osrxx = %lookup(d§OSRcl4:skCLIosr);
039060130117             IF  osrxx = 0;
039070130117               osrxx = %lookup(*zeros:skCLIosr);
039080130117               IF  osrxx > 0;
039090130117                 skCLIosr(osrxx) = d§OSRcl4;
039100130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039110130117               ENDIF;
039120130117             ENDIF;
039130130117           ENDIF;
039140130117
039150130117           IF d§osrcl5 <> 0;
039160130117             osrxx = %lookup(d§OSRcl5:skCLIosr);
039170130117             IF  osrxx = 0;
039180130117               osrxx = %lookup(*zeros:skCLIosr);
039190130117               IF  osrxx > 0;
039200130117                 skCLIosr(osrxx) = d§OSRcl5;
039210130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039220130117               ENDIF;
039230130117             ENDIF;
039240130117           ENDIF;
039250130117
039260130117           IF d§osrcl6 <> 0;
039270130117             osrxx = %lookup(d§OSRcl6:skCLIosr);
039280130117             IF  osrxx = 0;
039290130117               osrxx = %lookup(*zeros:skCLIosr);
039300130117               IF  osrxx > 0;
039310130117                 skCLIosr(osrxx) = d§OSRcl6;
039320130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039330130117               ENDIF;
039340130117             ENDIF;
039350130117           ENDIF;
039360130117
039370130117           IF d§osrcl7 <> 0;
039380130117             osrxx = %lookup(d§OSRcl7:skCLIosr);
039390130117             IF  osrxx = 0;
039400130117               osrxx = %lookup(*zeros:skCLIosr);
039410130117               IF  osrxx > 0;
039420130117                 skCLIosr(osrxx) = d§OSRcl7;
039430130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039440130117               ENDIF;
039450130117             ENDIF;
039460130117           ENDIF;
039470130117
039480130117           IF d§osrcl8 <> 0;
039490130117             osrxx = %lookup(d§OSRcl8:skCLIosr);
039500130117             IF  osrxx = 0;
039510130117               osrxx = %lookup(*zeros:skCLIosr);
039520130117               IF  osrxx > 0;
039530130117                 skCLIosr(osrxx) = d§OSRcl8;
039540130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039550130117               ENDIF;
039560130117             ENDIF;
039570130117           ENDIF;
039580130117
039590130117           IF d§osrcl9 <> 0;
039600130117             osrxx = %lookup(d§OSRcl9:skCLIosr);
039610130117             IF  osrxx = 0;
039620130117               osrxx = %lookup(*zeros:skCLIosr);
039630130117               IF  osrxx > 0;
039640130117                 skCLIosr(osrxx) = d§OSRcl9;
039650130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039660130117               ENDIF;
039670130117             ENDIF;
039680130117           ENDIF;
039690130117
039700130117           IF d§osrcl10 <> 0;
039710130117             osrxx = %lookup(d§OSRcl10:skCLIosr);
039720130117             IF  osrxx = 0;
039730130117               osrxx = %lookup(*zeros:skCLIosr);
039740130117               IF  osrxx > 0;
039750130117                 skCLIosr(osrxx) = d§OSRcl10;
039760130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039770130117               ENDIF;
039780130117             ENDIF;
039790130117           ENDIF;
039800130117
039810130117           IF d§osrcl11 <> 0;
039820130117             osrxx = %lookup(d§OSRcl11:skCLIosr);
039830130117             IF  osrxx = 0;
039840130117               osrxx = %lookup(*zeros:skCLIosr);
039850130117               IF  osrxx > 0;
039860130117                 skCLIosr(osrxx) = d§OSRcl11;
039870130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039880130117               ENDIF;
039890130117             ENDIF;
039900130117           ENDIF;
039910130117
039920130117           IF d§osrcl12 <> 0;
039930130117             osrxx = %lookup(d§OSRcl12:skCLIosr);
039940130117             IF  osrxx = 0;
039950130117               osrxx = %lookup(*zeros:skCLIosr);
039960130117               IF  osrxx > 0;
039970130117                 skCLIosr(osrxx) = d§OSRcl12;
039980130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039990130117               ENDIF;
040000130117             ENDIF;
040010130117           ENDIF;
040020130117
040030130117           IF d§osrcl13 <> 0;
040040130117             osrxx = %lookup(d§OSRcl13:skCLIosr);
040050130117             IF  osrxx = 0;
040060130117               osrxx = %lookup(*zeros:skCLIosr);
040070130117               IF  osrxx > 0;
040080130117                 skCLIosr(osrxx) = d§OSRcl13;
040090130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
040100130117               ENDIF;
040110130117             ENDIF;
040120130117           ENDIF;
040130130117
040140130117           IF d§osrcl14 <> 0;
040150130117             osrxx = %lookup(d§OSRcl14:skCLIosr);
040160130117             IF  osrxx = 0;
040170130117               osrxx = %lookup(*zeros:skCLIosr);
040180130117               IF  osrxx > 0;
040190130117                 skCLIosr(osrxx) = d§OSRcl14;
040200130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
040210130117               ENDIF;
040220130117             ENDIF;
040230130117           ENDIF;
040240130117
040250130117           IF d§osrcl15 <> 0;
040260130117             osrxx = %lookup(d§OSRcl15:skCLIosr);
040270130117             IF  osrxx = 0;
040280130117               osrxx = %lookup(*zeros:skCLIosr);
040290130117               IF  osrxx > 0;
040300130117                 skCLIosr(osrxx) = d§OSRcl15;
040310130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
040320130117               ENDIF;
040330130117             ENDIF;
040340130117           ENDIF;
040350130117
040360130117           IF d§osrcl16 <> 0;
040370130117             osrxx = %lookup(d§OSRcl16:skCLIosr);
040380130117             IF  osrxx = 0;
040390130117               osrxx = %lookup(*zeros:skCLIosr);
040400130117               IF  osrxx > 0;
040410130117                 skCLIosr(osrxx) = d§OSRcl16;
040420130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
040430130117               ENDIF;
040440130117             ENDIF;
040450130117           ENDIF;
040460130122
040470130122           ENDIF;
040480130117
040490130117           reade(n) c_tabosr tntbe01l;
040500130117         enddo;
040510130117
040520130117       endsr;
040530130117      /end-free
040540900427     C*
040550900427     C*--- PULIZIA CAMPI FORMATO1 ------------------------------------*
040560940819     C     INZ01         BEGSR
040570950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
040580950126     C                   EXSR      OFFD01
040590900427     C*
040600991014     C                   CLEAR                   DSLV04
040610940222     C                   MOVE      ' '           UNO               1
040620940930     C                   MOVE      0             DUE               1 0
040630940930     C                   MOVE      0             TRE               1 0
040640920427     C                   MOVE      0             QUA               1 0
040650100209     C                   MOVE      0             QUAH              1 0
040660940930     C                   MOVE      0             CIN               1 0
040670940930     C                   MOVE      0             SEI               1 0
040680941020     C                   MOVE      0             SET               1 0
040690940930     C                   MOVE      0             OTT               1 0
040700910801     C                   MOVEL     ' '           NOV               1
040710940930     C                   MOVEL     0             DIE               1 0
040720950102     C                   MOVEL     0             UND               1 0
040730950410     C                   MOVEL     0             DOD               1 0
040740950410     C                   MOVEL     0             QUI               1 0
040750961111     C                   MOVEL     0             SED               1 0
040760040213     C**!!!              MOVEL     0             DIC               1 0
040770040213     C**!!!              MOVEL     0             VEN               1 0
040780990610     C                   MOVEL     0             SES               1 0
040790970702     C                   MOVEL     0             AAA               1 0
040800970702     C                   MOVEL     0             AAB               1 0
040810990915     C                   MOVEL     0             AAC               1 0
040820991213     C                   MOVEL     0             AAD               1 0
040830970704     C                   MOVEL     0             MMA               1 0
040840970704     C                   MOVEL     0             MMB               1 0
040850000622     C                   MOVEL     0             MMD               1 0
040860970704     C                   MOVEL     0             COMA              1 0
040870970704     C                   MOVEL     0             COMB              1 0
040880990915     C                   MOVEL     ' '           WFPR              1
040890000509     C                   MOVEL     ' '           WPT1              1
040900001025     C                   MOVEL     ' '           VIDMAG
040910010504     C                   MOVE      ' '           WFORZO
040920990915     C                   CLEAR                   SAVPD4
040930030417     c                   Clear                   fordcr
040940030704     c                   Clear                   wforw03
040950030728     c                   Clear                   wfornba
040960031001     c                   Clear                   wfortbo
040970031201     c                   Clear                   wnoccm
040980060515     c                   clear                   bolksc
040990060515     c                   clear                   bolctr
041000040216     c                   Eval      wforza1 = *Off
041010040216     c                   Eval      wforza2 = *Off
041020110321     c                   Eval      wforzbrv = *Off
041030110422     c                   Eval      wforzadrt = *Off
041031141124     c                   clear                   wforz_lna
041032141124     c                   clear                   wforz_lnap
041040041116     c                   clear                   wnprpre
041050060104     C                   MOVEL     *ZEROS        VARZNC
041060941107     C* PULISCO LA DS DI STAMPA
041070991007     C  N12              CLEAR                   DTAS
041080991007     C  N12              CLEAR                   DTASV
041090030626     C                   CLEAR                   fnlsb5DS
041100941115     C                   CLEAR                   WESVAR
041110950209     C                   CLEAR                   DS1A
041120950120     C                   CLEAR                   WIN11
041130950120     C                   CLEAR                   WIN88
041140940926     C*
041150940926     C* CAMPI CHE MI INDICATO SE E' PRESENTE UNA ESTENSIONE BOLLA
041160991006     C                   CLEAR                   WAR62
041170991006     C                   CLEAR                   WAR61
041180050331     C                   CLEAR                   WKSCsf1
041190050331     C                   CLEAR                   WKSCsf2
041200991006     C                   CLEAR                   WAR7
041210040114     c                   Clear                   war71
041220051115     C                   CLEAR                   War9
041230000623     C                   CLEAR                   WES3Q
041240000623     C                   CLEAR                   WBL4W
041250040116     c                   Clear                   wesvar1
041260940926     C*
041270950126     C                   CLEAR                   WSBORD
041280940930     C                   CLEAR                   VARCAD
041290940930     C                   CLEAR                   VARCAM
041300940926     C                   CLEAR                   SAVFTM
041310940921     C                   CLEAR                   SAVFLC
041320940922     C                   CLEAR                   SAVCTR
041330961111     C                   CLEAR                   SAVFBR
041340961122     C                   CLEAR                   SAVCBO
041350000211     C                   CLEAR                   WESSGN
041360100209     C                   CLEAR                   Sa2TSP
041370941005     C* CANCELLO I CAMPI DI CONFRONTO PER RICARICARE COD TARIFFA
041380941005     C                   CLEAR                   VARTSP
041390941107     C                   CLEAR                   WFIE
041400990610     C                   CLEAR                   WCOCCM
041410050926     c* pulizia campo per errore forzabile su volume in base alla tarif
041420050926     c* fa
041430050926     c                   clear                   fvol
041440941231     C**
041450941231     C* IL CAMPO SAVCCM MI SERVE PER IL CONFRONTO DEL CODICE CLI
041460941231     C*  PER CARICARE LE TARIFFE RELATIVE
041470941231     C                   Z-ADD     1             SAVCCM
041480940922     C* SPENGO INDICATORI DI ABILITAZIONE RICERCA MITTENTE E FIL CLIENT
041490941020     C                   SETOFF                                       0138
041500940922     C* INDICATORI DI "RI" PER CAMPI PRESI DA TARIFFA
041510941107     C                   SETOFF                                       97
041520040610     c     atrbva        ifne      prri
041530040610     c                   movel     hiul          atrbva
041540040610     c                   endif
041550990630     C* INDICATORI DI PTOTEZIONE DATI FATTURA E VISUL.TOT IMPONIBILE
041560990630     C                   SETOFF                                       22
041570000915     C* INDICATORE ABILITAZIONE TASTO F22-MANTUENZIONE COD.CHI SONO
041580000915     C                   SETOFF                                       96
041590051123     c* Protezione codice bolla
041600051123     C                   CLEAR                   ATRcbo
041610070801     c* imposto no display l'attributo della costante video:"Da ORM" che
041620070801     c* deve essere visualizzata quando la data ritiro viene modificata
041630070801     c* proponendola da ORM
041640070801     c                   movel     nodi          atrdaorm
041650070918     c                   clear                   s_drt
041660070831     c* data ritiro
041670070831     c                   exsr      inzdrt
041680111124     c*
041690111124     c                   clear                   vidno1
041700111124     c                   clear                   vidno2
041710111128     c                   clear                   viddno
041720940922     C*
041730940819     C* 24 ON - DATA SPEDIZIONE PERSONALIZZATA
041740940819     C     *IN24         IFEQ      *OFF
041750940819     C                   Z-ADD     WDTGIO        VIDDSP
041760940819     C                   ENDIF
041770010222     C* 37 ON - NUMERO O.R.M. PERSONALIZZATO
041780010222     C     *IN37         IFEQ      *OFF
041790040909     c                   clear                   vidpoe
041800010222     C                   CLEAR                   VIDNOR
041810010222     C                   CLEAR                   VIDNRV
041820011126     C                   CLEAR                   ATRDES
041830011205     C                   CLEAR                   SORMFD
041840010222     C                   ENDIF
041850940819     C* 21 ON - CODICE BOLLA   PERSONALIZZATO
041860940819     C     *IN21         IFEQ      *OFF
041870940819     C                   MOVEL     *BLANKS       VIDCBO
041880940819     C                   ENDIF
041890940819     C* 20 ON - LINEA DI ARRIVO PERSONALIZZATO
041900940819     C     *IN20         IFEQ      *OFF
041910950208     C                   Z-ADD     0             CO2LNA
041920950208     C                   Z-ADD     0             COMLNA
041930020213     C                   CLEAR                   A_OG143
041940040525     C                   CLEAR                   A_OG150
041950940819     C                   MOVEL     *BLANKS       VIDLNA
041960940920     C                   MOVEL     *BLANKS       V1DLNA
041970940819     C                   ENDIF
041980940819     C* 18 ON - TIPO SERVIZIO PERSONALIZZATO
041990940819     C     *IN18         IFEQ      *OFF
042000940819     C                   MOVEL     *BLANKS       VIDTSP
042010941005     C                   MOVEL     *BLANKS       V1DTSP
042020950303     C                   CLEAR                   V2DTSP
042030940819     C                   ENDIF
042040940819     C* 26 ON - CODICE TRATTAMENTO MERCE PERSONALIZZATO
042050940819     C     *IN26         IFEQ      *OFF
042060940819     C                   MOVEL     *BLANKS       VIDCTM
042070940920     C                   MOVEL     *BLANKS       V1DCTM
042080940819     C                   ENDIF
042090940920     C* 28 ON - TASSAZ TARIFFA MITTENTE PERSONALIZZATO
042100940819     C     *IN28         IFEQ      *OFF
042110940819     C                   MOVEL     *BLANKS       VIDFTM
042120940819     C                   ENDIF
042130940921     C* 19 ON - MITTENTE PERSONALIZZATO
042140950303     C* 85 ON - COD.MITTENTE PERSONALIZZATO
042150940921     C     *IN19         IFEQ      *OFF
042160950303     C*
042170950303     C     *IN85         IFEQ      *OFF
042180950123     C                   CLEAR                   WCCMS
042190941005     C                   CLEAR                   VIDFLC
042200941005     C                   CLEAR                   VIDCCM
042210950303     C                   CLEAR                   VIDDMT
042220950303     C                   ENDIF
042230950303     C                   CLEAR                   V2DTEL
042240940921     C                   CLEAR                   VIDRSM
042250940921     C                   CLEAR                   VIDINM
042260940921     C                   CLEAR                   VIDCAM
042270940921     C                   CLEAR                   VIDPRM
042280950303     C                   CLEAR                   VIDLOM
042290940921     C                   CLEAR                   VIDPIM
042300061109     C                   CLEAR                   VIDcdf
042310061109     c                   movel     hiul          atrcdf
042320080804     c                   clear                   forzcdf           1
042330120504     c                   clear                   forzcdf1          1
042340061109     c                   clear                   savrsm
042350940921     C                   CLEAR                   VIDNZM
042360940921     C                   CLEAR                   VIDFAP
042370941020     C                   SETOFF                                       14
042380940921     C                   ENDIF
042390940825     C* DESTINATARIO
042400940819     C                   MOVEL     *BLANKS       VIDRSD
042410940819     C                   MOVEL     *BLANKS       VIDIND
042420940819     C                   MOVEL     *BLANKS       VIDLOD
042430940819     C                   MOVEL     *BLANKS       VIDPRD
042440940819     C                   MOVEL     *BLANKS       VARPRD
042450940819     C                   MOVEL     *BLANKS       VIDNZD
042460940819     C                   CLEAR                   VIDCAD
042470940928     C                   CLEAR                   VIDPID
042480940819     C                   MOVEL     *BLANKS       VIDFIN
042490030305     c                   Clear                   savdisag
042500070924     c                   Clear                   savpart
042510050214     c                   Clear                   wdesie
042520940819     C*
042530940915     C* ULTIMA SPEDIZIONE        SE IMMISSIONE BOLLA (12 OFF)
042540940819     C     *IN12         IFEQ      *OFF
042550010301     C     §LPFPR        ANDNE     'O'
042560900427     C                   Z-ADD     BLPNRS        PRENRS
042570900427     C                   Z-ADD     BLPNSP        PRENSP
042580941011     C                   MOVEL     BLPLNA        PRELNA
042590900427     C                   Z-ADD     BLPRMN        PRERMN
042600910128     C                   Z-ADD     BLPZNC        PREZNC
042610940819     C                   ENDIF
042620940819     C*
042630900427     C                   Z-ADD     0             VIDPKG
042640980402     C                   Z-ADD     0             SAVPKG
042650940819     C                   Z-ADD     0             V1CNCL
042660090609     c                   clear                   wncl_pre
042670090609     c                   clear                   wpes_pre
042680111026     c                   clear                   savtsp73
042690971222     C* PULISCO I CAMPI DELL'EXPORT SDI
042700971222     C                   CLEAR                   DSBL4E
042710900502     C* PULISCO ALCUNI CAMPI DEL FOR02
042720900517     C                   Z-ADD     0             VIDZNC
042730930628     C     *IN12         IFEQ      *ON
042740930628     C                   CLEAR                   VIDTCR
042750930628     C                   CLEAR                   VIDDCR
042760930628     C                   CLEAR                   VIDHCR
042770030409     c                   Clear                   VidOre
042780930628     C                   CLEAR                   VIDMCR
042790930628     C                   CLEAR                   VIDCTR
042800930628     C                   CLEAR                   DEFCTR
042810930628     C                   CLEAR                   VIDNAS
042820040610     c                   clear                   vidbva
042830960319     C                   CLEAR                   VIDGC1
042840960319     C                   CLEAR                   VIDGC2
042850930628     C                   ELSE
042860940920     C  N17              MOVEL     ' '           VIDTCR
042870930628     C  N16              MOVEL     *ZEROS        VIDDCR
042880940920     C  N23              MOVEL     *ZEROS        VIDHCR
042890940920     C  N23              MOVEL     *ZEROS        VIDMCR
042900030409     c                   If        wflagore = *Blanks
042910030409     c                   Clear                   VidOre
042920030409     c                   EndIf
042930930628     C  N29              CLEAR                   VIDCTR
042940930628     C  N29              CLEAR                   DEFCTR
042950940825     C  N27              CLEAR                   VIDNAS
042960040610     c     atrbva        ifne      prri
042970040610     c                   clear                   vidbva
042980040610     c                   endif
042990960319     C  N91              CLEAR                   VIDGC1
043000960319     C  N91              CLEAR                   VIDGC2
043010960319     C                   ENDIF
043020990630     C* MEMORIZZO E PROTEGGO LA DATA PER I PREPAGATI
043030990630     C     PARTCH        IFEQ      'P'
043040010301     C     §LPFPR        OREQ      'O'
043050990630     C                   Z-ADD     WDTGIO        VIDDSP
043060990701     C                   SETON                                        2426
043070990630     C                   SETON                                        3422
043080990630     C* IMPOSTO FISSO IL CTM
043090990630     C                   MOVEL     §3ICTP        VIDCTM
043100990630     C* IMPOSTO IL COD MITTENTE --> 8888
043110990720     C* SOLO SE NON PERSONALIZZATO
043120010307     C     PARTCH        IFEQ      'P'
043130990720     C  N19
043140990720     CANN85              Z-ADD     8888          VIDCCM
043150010307     C                   ENDIF
043160990630     C                   ENDIF
043170050126     c* autotrasportatore
043180050426     c***  atrpdr        ifne      prri
043190050426     c***                clear                   vidpdr
043200050426     c***                clear                   v1dpdr
043210050426     c**n34              movel     '?'           vidpdr
043220050426     c***                endif
043230050126     c* flag mattino pomeriggio
043240050426     c***  atrfpp        ifne      prri
043250050426     c***                clear                   vidfpp
043260050426     c***                endif
043270031113     c                   Clear                   VidRef
043280031113     c                   Clear                   VidTel
043290031219     c                   Clear                   wrifp
043291141031     c                   Clear                   wPinCode
043300000120     C*
043310000120     C                   CLEAR                   VIDDPD
043320000120     C                   CLEAR                   VIDNRD
043330000120     C                   CLEAR                   COMNRD
043340050315     C                   MOVE      *BLANKS       VIDFFD
043350010223     C                   CLEAR                   WOVUO
043360070427     C                   CLEAR                   WOVUO1
043370010226     C                   CLEAR                   CHGORM
043380090327     C                   CLEAR                   CHGORM1
043390091120     C                   CLEAR                   CHGORM2
043400090327     C                   CLEAR                   w_fcli
043410110512     c* imposto no display l'attributo della costante video:"F17=ind.mail dest
043420110512     c* che deve essere visualizzata solo quando ricevo il dato da VAT
043430150213     c                   movel     nodi          atremd
043440150213     c***                movel     ndpr          atrwemd
043450150213     c***                movel     ndpr          atrwtel
043460110512     c                   clear                   wemdest
043470130315     c                   clear                   wsms
043480130315     c                   clear                   wsmp
043490130918     c                   clear                   wmmp
043500130923     c                   clear                   wmmp_ar5
043510110705     c* visualizzazione f19=CUP/CIG solo da data attivazione
043520110705     C                   IF        DATEU < §VPOTFF
043530110705     c                   movel     nodi          atrCUP
043540110705     C                   ELSE
043550110705     c                   clear                   atrCUP
043560110705     C                   ENDIF
043570110706     c                   clear                   wcupcup
043580110706     c                   clear                   wcupcig
043581141201     c                   clear                   wpincode
043590130311
043600130311     c                   clear                   wvatpe
043610900427     C                   ENDSR
043620070831     C*
043630070831     C* inizializzazione campo data ritiro --------------------------*
043640070831     C     inzdrt        BEGSR
043650070831     c* data ritiro=udate se data ritiro non personalizzata
043660070831     C  N12PARTCH        IFNE      'P'
043670070831     C     §LPFPR        ANDNE     'O'
043680071107     c***  dateu         andge     §vpodrt
043690070831     c                   if        atrdrt<>prri or viddrt=0
043700070831     C                   MOVEL     WDTGIO        VIDDRT
043710070831     c                   endif
043720070831     c                   endif
043730070831     c                   endsr
043740940819     C*
043750940819     C* GESTIONE VIDEATA DI PERSONALIZZAZIONE -----------------------*
043760050118     C     GESD00        BEGSR
043770940824     C                   MOVEL     'P'           WPERSO            1
043780940819     C*
043790941230     C                   CLEAR                   V0CRSM
043800941230     C                   CLEAR                   V0CINM
043810941230     C                   CLEAR                   V0CCAM
043820941230     C                   CLEAR                   V0CLOM
043830941230     C                   CLEAR                   V0CPRM
043840941230     C                   CLEAR                   V0CNZM
043850941230     C                   CLEAR                   V0CPIM
043860061109     C                   CLEAR                   V0Ccdf
043870061109     c                   movel     hiul          atrcdf
043880941230     C                   CLEAR                   V0CFAP
043890941230     C                   CLEAR                   V0CLNA
043900941230     C                   CLEAR                   V0CCBO
043910941230     C                   CLEAR                   V0CTSP
043920941230     C                   CLEAR                   V0CCTM
043930941230     C                   CLEAR                   V0CCCM
043940941230     C                   CLEAR                   V0CFLC
043950941230     C                   CLEAR                   V0CCTR
043960941230     C                   CLEAR                   V0CNAS
043970040610     C                   CLEAR                   V0Cbva
043980941230     C                   CLEAR                   V0CTCR
043990941230     C                   CLEAR                   V0CDCR
044000941230     C                   CLEAR                   V0CHCR
044010941230     C                   CLEAR                   V0CMCR
044020941230     C                   CLEAR                   V0CRMO
044030941230     C                   CLEAR                   V0CNMO
044040941230     C                   CLEAR                   V0CCMO
044050960319     C                   CLEAR                   V0CGC1
044060960319     C                   CLEAR                   V0CGC2
044070010209     C                   CLEAR                   V0CNOR
044080010209     C                   CLEAR                   V0CNRV
044090030409     c                   Clear                   V0cOre
044100050426     c***                clear                   v0cpdr
044110050426     c***                clear                   v0cfpp
044120940819     C* MUOVO TUTTI I CAMPI DAL VIDEO 1 PER LA PERSONALIZZAIZONE
044130941230     C* SOLO SE LI AVEVO PERSONALI<ZZATI E QUELLI CHE RIMANGONO
044140941230     C*  SEMPRE IMPOSTATI
044150941230     C                   MOVEL     VIDSOP        V0CSOP
044160010502     C* NON IMPOSTO, NELLA VIDEATA DI PERSONALIZZAZIONE LA RICERCA ALFA
044170010502     C* BETICA SU PADRONCINO SE ATTIVATA PROCEDURA ORM
044180050426     c***  atrpdr        ifeq      prri
044190050426     C     WORM          IFNE      'S'
044200050426     C     VIDPDR        ORNE      '?   '
044210940819     C                   MOVEL     VIDPDR        V0CPDR
044220050426     c***                clear                   vidpdr
044230010502     C                   ENDIF
044240050426     c***  atrfpp        ifeq      prri
044250050126     C                   MOVEL     VIDFPP        V0CFPP
044260050426     c***                clear                   vidfpp
044270050426     c***                endif
044280940819     C                   MOVEL     VIDNRT        V0CNRT
044290940819     C                   MOVEL     VIDLNP        V0CLNP
044300010222     C                   Z-ADD     VIDPOE        V0CPOE
044310010222     C   37              Z-ADD     VIDNOR        V0CNOR
044320041108     C   37              Z-ADD     VIDNRV        V0CNRV
044330070828     c***37              movel     atrdaorm      at0daorm
044340070828     c                   movel     nodi          at0daorm
044350071107     c***                if        dateu>=§vpodrt
044360070828     c                   clear                   viddrt
044370071107     c***                endif
044380041220     c                   z-add     vidpoe        s_v0cpoe
044390041220     c                   z-add     vidnor        s_v0cnor
044400041220     c                   z-add     vidnrv        s_v0cnrv
044410050315     C   37              MOVE      'P'           s_ormpers
044420050315     C  N37              MOVE      ' '           s_ormpers
044430010222     C   37              CLEAR                   VIDPOE
044440010222     C   37              CLEAR                   VIDNOR
044450010222     C   37              CLEAR                   VIDNRV
044460941230     C   20              MOVEL     VIDLNA        V0CLNA
044470941231     C   20              CLEAR                   VIDLNA
044480941230     C   21              MOVEL     VIDCBO        V0CCBO
044490941231     C   21              CLEAR                   VIDCBO
044500941230     C   18              MOVEL     VIDTSP        V0CTSP
044510941231     C   18              CLEAR                   VIDTSP
044520941230     C   26              MOVEL     VIDCTM        V0CCTM
044530941231     C   26              CLEAR                   VIDCTM
044540950125     C     *IN19         IFEQ      *ON
044550950303     C     *IN85         OREQ      *ON
044560950125     C                   MOVEL     VIDCCM        V0CCCM
044570950125     C                   CLEAR                   VIDCCM
044580050120     c***                clear                   viddmt
044590950125     C                   MOVEL     VIDFLC        V0CFLC
044600950125     C                   CLEAR                   VIDFLC
044610950303     C                   ENDIF
044620941221     C* SE NON E' UN CODIFICATO, IMPOSTO IL MITTENTE COSI' COME E'
044630950303     C     *IN19         IFEQ      *ON
044640020507     C     V0CCCM        ifeQ      8888
044650950125     C     V0CCCM        OREQ      9999
044660940819     C                   MOVEL     VIDRSM        V0CRSM
044670940819     C                   MOVEL     VIDINM        V0CINM
044680940819     C                   MOVEL     VIDLOM        V0CLOM
044690940819     C                   MOVEL     VIDCAM        V0CCAM
044700940819     C                   MOVEL     VIDPRM        V0CPRM
044710940819     C                   MOVEL     VIDNZM        V0CNZM
044720940819     C                   MOVEL     VIDFAP        V0CFAP
044730940819     C                   MOVEL     VIDPIM        V0CPIM
044740061109     C                   MOVEL     VIDcdf        V0Ccdf
044750950125     C                   ENDIF
044760941231     C                   CLEAR                   VIDRSM
044770941231     C                   CLEAR                   VIDINM
044780941231     C                   CLEAR                   VIDLOM
044790941231     C                   CLEAR                   VIDCAM
044800941231     C                   CLEAR                   VIDPRM
044810941231     C                   CLEAR                   VIDNZM
044820941231     C                   CLEAR                   VIDFAP
044830941231     C                   CLEAR                   VIDPIM
044840061109     C                   CLEAR                   VIDcdf
044850941230     C                   ENDIF
044860941230     C   28              MOVEL     VIDFTM        V0CFTM
044870941231     C   28              CLEAR                   VIDFTM
044880941230     C   27              MOVEL     VIDNAS        V0CNAS
044890941231     C   27              CLEAR                   VIDNAS
044900040610     c     atrbva        ifeq      prri
044910040610     C                   MOVEL     VIDbva        V0Cbva
044920040610     C                   CLEAR                   VIDbva
044930040610     c                   endif
044940941230     C   17              MOVEL     VIDTCR        V0CTCR
044950941231     C   17              CLEAR                   VIDTCR
044960941230     C   16              MOVEL     VIDDCR        V0CDCR
044970941231     C   16              CLEAR                   VIDDCR
044980941230     C   23              MOVEL     VIDHCR        V0CHCR
044990941230     C   23              MOVEL     VIDMCR        V0CMCR
045000941231     C   23              CLEAR                   VIDHCR
045010941231     C   23              CLEAR                   VIDMCR
045020030409     c                   If        wflagore = '1'
045030030409     c                   Eval      V0cOre = VidOre
045040030409     c                   Clear                   VidOre
045050030409     c                   EndIf
045060941230     C   03              MOVEL     VIDRMO        V0CRMO
045070941230     C   03              MOVEL     VIDNMO        V0CNMO
045080941231     C   03              CLEAR                   VIDRMO
045090941231     C   03              CLEAR                   VIDNMO
045100941230     C   03              MOVEL     VIDCMO        V0CCMO
045110941231     C   03              CLEAR                   VIDCMO
045120950206     C   29              MOVEL     VIDCTR        V0CCTR
045130950206     C   29              CLEAR                   VIDCTR
045140960319     C     *IN91         IFEQ      *ON
045150960319     C                   MOVEL     VIDGC1        V0CGC1
045160960319     C                   CLEAR                   VIDGC1
045170960319     C                   MOVEL     VIDGC2        V0CGC2
045180960319     C                   CLEAR                   VIDGC2
045190960319     C                   ENDIF
045200050119     C                   MOVEL     *BLANKS       VIDDMT
045210940819     C*
045220990720     C* SPENGO GLI INDICATORI DI PROTEZIONE DELLA VIDEATA DELLE PERSON
045230990719     C*  CHE SERVONO PER LA PROCEDURA PREPAGATI
045240990719     C     PARTCH        IFNE      'P'
045250010307     C     §LPFPR        ANDNE     'O'
045260990720     C                   SETOFF                                       2426
045270990719     C                   ENDIF
045280990720     C                   SETOFF                                       19
045290041214     C* ABILITA LA RICERCA ALFABETICA
045300041214     C                   SETON                                        01
045310041214     C                   SETOFF                                       1438
045320990719     C**
045330940819     C     FORD00        TAG
045340041109     c****               z-add     v0cnrv        v0cnrvv
045350071107     c****               if        dateu>=§vpodrt
045360070828     c                   clear                   atrdrt
045370071107     c****               endif
045380940819     C                   EXFMT     LS01D00
045390041109     c****               z-add     v0cnrvv       v0cnrv
045400940819     C* CMD3 - FINE LAVORO
045410940819     C   KC              GOTO      ENDG00
045420010219     C* CMD14 - INTERROGAZIONE O.R.M.
045430010223     C     *INKH         IFEQ      *ON
045440010226     C     WORM          ANDEQ     'S'
045450010227     C     PARTCH        ANDNE     'P'
045460010220     C     V0CNOR        ANDEQ     *ZEROS
045470111123     c* se lnp import continuo a richiamare FIOR04R
045480111123     c****               if        %lookup(v0clnp:fio)=0
045490111123     c*****                        and %lookup(999:fio)=0
045500111123     c                   if        v0clnp>pr0lnp
045510111123     c                   clear                   og143
045520111123     C     v0clnp        CHAIN     AZORG01L      UNIORG
045530111123     c                   if        %found(azorg01l)
045540111123     C                   MOVEL     ORGDE3        OG143
045550111123     c                   endif
045560111123     c                   eval      pr0lnp=v0clnp
045570111123     c                   endif
045580111123     c                   if        §ogntw='DPD' or §ogntw='EEX' or
045590111123     c                             §ogntw='FED'
045600010219     C                   CLEAR                   DSOR04
045610010219     C                   MOVEL     '1'           I04RIC
045620010219     C                   Z-ADD     V0CLNP        I04POR
045630051207     c
045640010219     C                   CALL      'FIOR04R'
045650010219     C                   PARM                    KPJBA
045660010219     C                   PARM                    DSOR04
045670010219     C     O04CM3        IFEQ      *BLANKS
045680010219     C                   Z-ADD     O04POE        V0CPOE
045690010222     C                   MOVEL     O04NSR        V0CNOR
045700010222     C                   MOVE      O04NOR        V0CNOR
045710010219     C                   Z-ADD     O04NRV        V0CNRV
045720050117     c                   eval      *inkh = '0'
045730050117     c                   else
045740010226     C                   GOTO      FORD00
045750050117     c                   endif
045760110419     c                   else
045770110419     c                   if        v0cpdr<=*zeros
045780110419     c                   eval      *in90='1'
045790110419     c                   eval      *in56='1'
045800110419     c                   eval      vidmsg=err(210)
045810110419     c                   goto      ford00
045820110419     c                   else
045830110419     c                   clear                   fior58ds
045840110419     c                   movel     v0clnp        ior58pdr
045850110419     c                   move      v0cpdr        IOR58PDR
045860110419     C                   CALL      'FIOR58R'
045870110419     C                   PARM                    KPJBA
045880110419     C                   PARM                    fior58ds
045890110419     C     OOR58F03      IFEQ      *BLANKS
045900110419     C                   Z-ADD     OOR58POE      V0cPOE
045910110419     C                   MOVEL     OOR58NSR      V0cNOR
045920110419     C                   MOVE      OOR58NOR      V0cNOR
045930110419     C                   Z-ADD     OOR58NRV      V0cNRV
045940110419     c                   eval      *inkh = '0'
045950110419     c                   else
045960110419     C                   GOTO      FORd00
045970110419     c                   endif
045980110419     c                   endif
045990110419     c                   endif
046000010226     C                   ENDIF
046010010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
046020010227     C* SE NON SEMPRE VISUALIZZATO. PER CMD8 E PROCEDURA NON ATTIVATA
046030010227     C* O SONO NEL GIRO DEI MIEI PREPAGATI RIEMETTO SEMPRE LA VIDEATA
046040010227     C   KHWORM          IFNE      'S'
046050010227     C     PARTCH        OREQ      'P'
046060010227     C                   GOTO      FORD00
046070010227     C                   ENDIF
046080940819     C*
046090940819     C* CONTROLLO CAMPI PERSONALIZZATI
046100940819     C                   EXSR      CTRD00
046110940929     C     WEMFOR        IFEQ      '1'
046120040908     c* Se no Errori ma non premuto F6 riemetto la videata
046130040908     c     *inkf         oreq      *off
046140940929     C                   GOTO      FORD00
046150940929     C                   ENDIF
046160041220     c* SOLO SE CAMBIATO ORM:
046170041220     c* pulisco la prima videata per essere sicura che
046180041220     c* non rimangano impostati campi del precedente orm ma non giusti per i
046190041220     c* l nuovo ORM
046200050315     c                   if        s_v0corm <> v0corm and (v0corm1 > 0 or
046210050315     c                             s_ormpers='P')
046220041220     c                   exsr      inz01
046230041220     c                   endif
046240070831     c
046250070831     c* Se non è cambiato l'ORM ma la data ritiro è = 0 forzo comunque
046260070831     c* data ritiro=udate
046270070831     c                   if        viddrt=0
046280070831     c                   exsr      inzdrt
046290070831     c                   endif
046300070831     c
046310940819     C*
046320940819     C* MUOVO TUTTI I CAMPI CHE HO PERSONALIZZATO
046330041129     c*
046340940819     C                   MOVEL     V0CSOP        VIDSOP
046350050426     c***  atrpdr        ifeq      prri
046360940819     C                   MOVEL     V0CPDR        VIDPDR
046370050426     c***                endif
046380070806     c                   movel     at0daorm      atrdaorm
046390011122     C* SE SONO IN IMMISSIONE PREPAGATI NON DEVO METTERE "?" IN QUANTO
046400011122     C* IN QUESTO CASO IL CODICE AUTOTRASPORTATORE NON E' DA IMMETTERE
046410011122     C  N34V0CPDR        IFEQ      *BLANKS
046420010502     C     WORM          ANDEQ     'S'
046430010502     C                   MOVEL     '?   '        VIDPDR
046440050128     c                   clear                   v1dpdr
046450010502     C                   ENDIF
046460960926     C* SE HO GIA' INSERITO IL AUTOTRASPORTATORE MI POSIZIONO SOTTO
046470950206     C     V0CPDR        IFGT      *ZEROS
046480010222     C     WORM          IFEQ      'S'
046490010222     C     PARTCH        ANDNE     'P'
046500010307     C     §LPFPR        ANDNE     'O'
046510010222     C                   SETON                                        06
046520010222     C                   ELSE
046530950206     C                   SETON                                        07
046540010222     C                   ENDIF
046550950206     C                   ENDIF
046560940819     C                   MOVEL     V0CNRT        VIDNRT
046570050426     c***  atrfpp        ifeq      prri
046580940819     C                   MOVEL     V0CFPP        VIDFPP
046590050426     c***                endif
046600940819     C                   MOVEL     V0CLNP        VIDLNP
046610010222     C                   Z-ADD     V0CPOE        VIDPOE
046620010222     C   37              Z-ADD     V0CNOR        VIDNOR
046630010222     C   37              Z-ADD     V0CNRV        VIDNRV
046640941230     C   20              MOVEL     V0CLNA        VIDLNA
046650941230     C   21              MOVEL     V0CCBO        VIDCBO
046660941230     C   18              MOVEL     V0CTSP        VIDTSP
046670941230     C   26              MOVEL     V0CCTM        VIDCTM
046680941230     C*
046690941230     C     *IN19         IFEQ      *ON
046700950303     C     *IN85         OREQ      *ON
046710941230     C                   MOVEL     V0CCCM        VIDCCM
046720941230     C                   MOVEL     V0CFLC        VIDFLC
046730941011     C     V0CFLC        IFNE      0
046740941020     C                   SETON                                        14
046750941011     C                   ENDIF
046760950303     C                   ENDIF
046770940825     C*
046780940825     C* IMPOSTO I CAMPI DEL MITTENTE SE PERSONALIZZATO
046790061109    1C     *IN19         IFEQ      *ON
046800061109    2C     V0CINM        IFEQ      *BLANKS
046810940825     C                   MOVEL     ACORAG        VIDRSM
046820940825     C                   MOVEL     ACORAG        VIDDMT
046830940825     C                   MOVEL     INDVIA        VIDINM
046840941005     C                   MOVEL     INDCAE        VIDCAM
046850940825     C                   MOVEL     INDCIT        VIDLOM
046860940825     C                   MOVEL     INDPRV        VIDPRM
046870940825     C                   MOVEL     INDSTA        VIDNZM
046880940825     C                   MOVEL     INDIVA        WISO
046890950125     C     WISO          IFGE      '00'
046900940825     C                   MOVEL     INDIVA        VIDCPM
046910120504     C                   clear                   VIDism
046920940825     C                   ELSE
046930940825     C                   MOVEL     INDIVA        VIDPIM
046940940825     C                   ENDIF
046950120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
046960120508     c* in contabilità crea problemi
046970120508     c                   if        *in22 and wiso='$$'
046980120508     c                   clear                   vidpim
046990120508     c                   endif
047000061110     c   22              movel     indcdf        vidcdf
047010941230     C*
047020061109   x2C                   ELSE
047030941230     C*
047040941230     C                   MOVEL     V0CRSM        VIDRSM
047050941230     C                   MOVEL     V0CINM        VIDINM
047060941230     C                   MOVEL     V0CLOM        VIDLOM
047070941230     C                   MOVEL     V0CCAM        VIDCAM
047080941230     C                   MOVEL     V0CPRM        VIDPRM
047090941230     C                   MOVEL     V0CNZM        VIDNZM
047100941230     C                   MOVEL     V0CFAP        VIDFAP
047110941230     C                   MOVEL     V0CPIM        VIDPIM
047120061109     C                   CLEAR                   VIDcdf
047130071023     c                   eval      w_callyco=' '
047140071023     c* Codice fiscale: se non c'e' effettuo la ricerca
047150061110    3c   22              if        v0ccdf<>*BLANKS
047160061109     C                   MOVEL     V0Ccdf        VIDcdf
047170061109   x3C                   ELSE
047180061109    4c                   if        vidnzm=*blanks
047190061110     c* richiamo pgm di richiesta
047200071023     c****               EXSR      CAlLyco
047210071023     c                   eval      w_callyco='1'
047220061109     c
047230061109    4C                   endif
047240061109    3C                   endif
047250071023     c* Partita Iva: se non c'e' effettuo la ricerca
047260071023    3c   22              if        vidpim=*BLANKS and vidnzm=*blanks
047270071023     c* memorizzo di richiamare pgm di richiesta
047280071023     c                   eval      w_callyco='1'
047290071023    3C                   endif
047300071023
047310120503     c                   if        w_callyco='1'
047320120503     c                   exsr      CALLyco
047330120503     c                   endif
047340061109     c
047350061109    2C                   ENDIF
047360061109     c* proteggo il campo del codice fiscale
047370061109     c                   movel     riul          atrcdf
047380061109    1C                   ENDIF
047390941230     C* IMPOSTO SOLO QUELLI PESONALIZZATI, GLI ALTRI LI LASCIO
047400941230     C*  COME SONO
047410950206     C   29              MOVEL     V0CCTR        VIDCTR
047420950206     C   28              MOVEL     V0CFTM        VIDFTM
047430941230     C   27              MOVEL     V0CNAS        VIDNAS
047440040610     c     atrbva        ifeq      prri
047450040610     c                   movel     v0cbva        vidbva
047460040610     c                   endif
047470941230     C   17              MOVEL     V0CTCR        VIDTCR
047480941230     C   16              MOVEL     V0CDCR        VIDDCR
047490941230     C   23              MOVEL     V0CHCR        VIDHCR
047500941230     C   23              MOVEL     V0CMCR        VIDMCR
047510030409     c                   If        wflagore = '1'
047520030409     c                   Eval      VidOre = V0cOre
047530030409     c                   EndIf
047540941230     C   03              MOVEL     V0CRMO        VIDRMO
047550941230     C   03              MOVEL     V0CNMO        VIDNMO
047560941230     C   03              MOVEL     V0CCMO        VIDCMO
047570960319     C   91              MOVEL     V0CGC1        VIDGC1
047580960319     C   91              MOVEL     V0CGC2        VIDGC2
047590940824     C* FINE PERSONALIZZAZIONE
047600940921     C                   SETOFF                                       01
047610940824     C                   MOVEL     ' '           WPERSO            1
047620940819    2C     ENDG00        ENDSR
047630061110     c*
047640061110     c* RICHIAMO PGM DI RICERCA COD FISCALE X 8888 O 9999-----------------*
047650061110     c     CALLYCO       BEGSR
047660061110     c                   eval      i600ela='R'
047670071023     c                   if        vidcdf=*blanks
047680061110     c                   eval      i600aCF='SI'
047690071023     c                   endif
047700071023     c                   if        vidpim=*blanks
047710071023     c                   eval      i600api='SI'
047720071023     c                   endif
047730061110     c     *iso          movel     20000101      i600dti
047740061110     c     *iso          movel     29991231      i600dtf
047750061110     c                   eval      i600rsc=vidrsm
047760061110     c                   eval      i600ind=vidinm
047770061110     c                   eval      i600cap=vidcam
047780061110     c                   eval      i600loc=vidlom
047790061110     c                   eval      i600prv=vidprm
047800061110     c                   movel     yco600ds      kpjbu
047810061110     c                   call      'YCO601R'
047820061110     c                   parm                    kpjba
047830061110     c
047840061110     c                   movel     kpjbu         yco600ds
047850061110    5c                   if        o600err=*blanks
047860071023     c                   if        vidcdf=*blanks
047870061110     c                   movel     o600cdfi      vidcdf
047880071023     c                   endif
047890071023     c                   if        vidpim=*blanks
047900071023     c                   movel     o600piva      wpiva
047910071023     c                   exsr      sr_wpiva
047920120508     c* Se partita iva $$ la puilisco: crea problemi in contabilità
047930120508     c                   if        vidism='$$'
047940120508     c                   clear                   vidpim
047950120508     c                   endif
047960071023     c                   endif
047970061110    5c                   endif
047980061110     c                   ENDSR
047990900427     C*
048000900427     C*--- CONTROLLO CAMPI PERSONALIZZAZIONE -------------------------*
048010940819     C     CTRD00        BEGSR
048020941115     C                   CLEAR                   VIDMSG
048030941103     C                   CLEAR                   WCMO
048040941103     C                   CLEAR                   WNAR
048050940824     C                   CLEAR                   WCBO
048060940824     C                   CLEAR                   WLNP
048070940824     C                   CLEAR                   WPDR
048080940824     C                   CLEAR                   WLNA
048090940824     C                   CLEAR                   WCTM
048100940824     C                   CLEAR                   WCCM
048110940825     C                   CLEAR                   WFTM
048120940824     C                   CLEAR                   WTSP
048130960319     C                   CLEAR                   WGC1
048140960319     C                   CLEAR                   WGC2
048150940929     C                   SETOFF                                       90
048160941003     C* SPENGO GLI INDICATORI DI PERSONALIZZAZIONE
048170941004     C                   SETOFF                                       161710
048180941103     C                   SETOFF                                       181903
048190990720     C                   SETOFF                                       202123
048200941003     C                   SETOFF                                       272829
048210990720     C                   SETOFF                                       859119
048220010222     C                   SETOFF                                       37
048230030409     c                   Clear                   wflagore
048240040610     c                   movel     hiul          atrbva
048250050426     c****               clear                   atrpdr
048260050426     c****               clear                   atrfpp
048270070829     c                   clear                   atrdrt
048280990602     C* GLI INDICATORI DELLA DATA E CTM LI SPENGO SOLO SE
048290990602     C*  NON PROVENGO DA PREPAGATI
048300990602     C     PARTCH        IFNE      'P'
048310010307     C     §LPFPR        ANDNE     'O'
048320990720     C                   SETOFF                                       2426
048330990602     C                   ENDIF
048340940929     C* SPENGO GLI INDICATORI DI POSIZONAMENTO CURSORE
048350940929     C                   SETOFF                                       404142
048360940929     C                   SETOFF                                       435645
048370940929     C                   SETOFF                                       464748
048380940929     C                   SETOFF                                       495051
048390940929     C                   SETOFF                                       525354
048400940929     C                   SETOFF                                       556870
048410940929     C                   SETOFF                                       585960
048420960319     C                   SETOFF                                       616274
048430040611     c                   clear                   h0riga
048440040611     c                   clear                   h0colo
048450030411     c                   Clear                   At0Tcr
048460030415     c                   Clear                   At0Ore
048470940929     C                   CLEAR                   WEMFOR
048480950504     C                   CLEAR                   DS3A
048490950209     C***
048500950209     C*** RICERCA ALFABETICA
048510950209     C                   MOVEL     V0CLNP        WLNP
048520950209     C                   Z-ADD     V0CCCM        WCCM
048530950209    2C     V0CFLC        IFNE      0
048540950209     C                   Z-ADD     V0CFLC        WFLC
048550950209     C                   ELSE
048560950209     C                   Z-ADD     V0CLNP        WFLC
048570950209    2C                   ENDIF
048580950209     C                   MOVEL(P)  V0CRSM        PAXDMT
048590050119     C                   CLEAR                   VIDDMT
048600950209     C* ESEGUO RICERCA ALFABETICA
048610950209     C                   EXSR      RICALF
048620950209     C                   MOVE      WCCM          V0CCCM
048630950209     C     *IN14         IFEQ      *ON
048640950209     C                   MOVEL     WFLC          V0CFLC
048650950209     C                   ENDIF
048660940822     C***
048670910208     C*** DATA SPEDIZIONE ***
048680930708     C                   EXSR      CTRDSP
048690001031     C   90              GOTO      ENDC00
048700940920     C***
048710940920     C*** SIGLA OPERATORE ***
048720940920     C* CONTROLLO SOLO SE NON E' PROTETTO
048730940928    1C     *IN13         IFEQ      *OFF
048740940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
048750940920     C                   MOVEL     '3M'          COD
048760940920     C                   MOVEL(P)  V0CSOP        KEY
048770940920     C                   EXSR      CTABEL
048780940928    2C     *IN30         IFEQ      *OFF
048790950713     C     V0CSOP        OREQ      ' '
048800940920     C                   MOVEL     ERR(29)       VIDMSG
048810940920     C                   SETON                                        4290
048820940920     C                   GOTO      ENDC00
048830940928    2C                   ENDIF
048840940928    1C                   ENDIF
048850940822     C***
048860940824     C*** DATA RITIRO MERCE ***
048870070806     C***                EXSR      CTRDRT
048880070806     C***90              GOTO      ENDC00
048890940822     C***
048900940819     C*** LINEA PARTENZA ***
048910940928     C                   MOVEL     V0CLNP        WLNP
048920940824     C                   EXSR      CTRLNP
048930940824     C   90              GOTO      ENDC00
048940010213     C***
048950010213     C*** NUMERO O.R.M.
048960010213     C*
048970010213     C* Controllo solo se attivata procedura O.R.M.
048980010213     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
048990010213     c* fine dell'immissione
049000010213     C     WORM          IFEQ      'S'
049010010213     C     PARTCH        ANDNE     'P'
049020010213     C                   Z-ADD     V0CPOE        WOPOE
049030010213     C                   Z-ADD     V0CNOR        WONOR
049040010213     C                   Z-ADD     V0CNRV        WONRV
049050010213     C                   Z-ADD     V0CLNP        WOLNP
049060010222     C     WIDOR1        IFGT      *ZEROS
049070010213     C                   EXSR      CTRORM
049080010213     C   90              GOTO      ENDC00
049090010216     C     WEMFOR        IFEQ      '1'
049100010216     C                   GOTO      ENDC00
049110010216     C                   ENDIF
049120010222     C                   ENDIF
049130010213     C                   ENDIF
049140010227     C* SE PREMUTO F8 E SONO NEL GIRO DEI PREPAGATI DEVO RIEMETTERE LA
049150010227     C* VIDEATA
049160010227     C   KH              GOTO      ENDC00
049170070806     c***
049180070806     C*** DATA RITIRO MERCE ***
049190070806     c* se orm non fittizio forzo data ritiro prendendola da ORM
049200070806     c                   if        flgfit <> 'S' and widor1>*zeros
049210071107     c*****                        and dateu>=§vpodrt
049220070828     c                   clear                   weform
049230070806     c                   exsr      fordrt
049240070831     c                   if        weform='1'
049250070831     c                   eval      wemfor='1'
049260070828     c                   goto      endc00
049270070828     c                   endif
049280070806     c                   endif
049290070828     c* se orm fittizio non controllo la data ritiro se non immessa
049300070905     c***                if        flgfit='S' and widor1>*zeros and viddrt=0
049310070905     c***                          and dateu>=§vpodrt
049320070905     c***                else
049330070806     C                   EXSR      CTRDRT
049340070806     C   90              GOTO      ENDC00
049350070905     c***                endif
049360070831     c* se immesso orm  proteggo la data ritiro
049370070831     c                   if        widor1>*zeros and viddrt>0
049380071107     c****                         and dateu>=§vpodrt
049390070828     c                   eval      atrdrt=prri
049400070828     c                   endif
049410940822     c***
049420960926     C*** CODICE AUTOTRASPORTATORE ***
049430940928    1C     V0CPDR        IFNE      *BLANKS
049440940824     C     V0CPDR        ANDNE     *ZEROS
049450940824     C*
049460940928     C                   MOVE      V0CPDR        WPDR
049470940824     C                   EXSR      CTRPDR
049480940915     C                   MOVE      WPDR          V0CPDR
049490940928    2C     WEMFOR        IFEQ      '1'
049500940824     C                   GOTO      ENDC00
049510940928    2C                   ENDIF
049520050126     c*
049530050426     c***                movel     prri          atrpdr
049540940824     C*
049550940928    1C                   ENDIF
049560050126     c*** FLAG MATTINO/POMERIGGIO  ***
049570050426     c***  v0cfpp        ifne      *blanks
049580050426     c***                movel     prri          atrfpp
049590050426     c***                endif
049600940822     C***
049610940822     C*** CODICE BOLLA ***
049620940928    1C     V0CCBO        IFNE      *BLANKS
049630940824     C*
049640940824     C                   MOVEL     V0CCBO        WCBO
049650940824     C                   EXSR      CTRCBO
049660940824     C                   MOVEL     WCBO          V0CCBO
049670940928    2C     WEMFOR        IFEQ      '1'
049680940824     C                   GOTO      ENDC00
049690940928    2C                   ENDIF
049700940824     C*
049710940928    1C                   ENDIF
049720940822     C***
049730940822     C*** LINEA ARRIVO ***
049740940824     C                   MOVEL     V0CLNA        WLNA
049750110217     C                   EXSR      CTRLNA_vid
049760940824     C                   MOVEL     WLNA          V0CLNA
049770940928    1C     WEMFOR        IFEQ      '1'
049780940824     C                   GOTO      ENDC00
049790940928    1C                   ENDIF
049800940824     C***
049810940822     C*** TIPO SERVIZIO ***
049820940824     C                   MOVEL     V0CTSP        WTSP
049830940824     C                   EXSR      CTRTSP
049840940824     C                   MOVEL     WTSP          V0CTSP
049850940928    1C     WEMFOR        IFEQ      '1'
049860940824     C                   GOTO      ENDC00
049870940928    1C                   ENDIF
049880940824     C***
049890940822     C*** CODICE TRATTAMENTO MERCE ***
049900940928     C* CONTROLLO SOLO SE IMMESSO
049910950504    1C     V0CCTM        IFNE      *BLANKS
049920940824     C                   MOVEL     V0CCTM        WCTM
049930940824     C                   EXSR      CTRCTM
049940940824     C                   MOVEL     WCTM          V0CCTM
049950950504    2C     WEMFOR        IFEQ      '1'
049960940824     C                   GOTO      ENDC00
049970950504    2C                   ENDIF
049980040611     c                   ENDIF
049990040611     c*** TIPO MERCE V-VALORE
050000040611     c     v0cbva        ifne      *blanks
050010040611     c     v0cctm        ifne      *blanks
050020040611     c     §1bfg8        andeq     'N'
050030040611     c                   Eval      *In90 = *On
050040040611     c                   Eval      VidMsg = Err(281)
050050040611     c                   z-add     21            H0riga
050060040611     c                   z-add     73            H0colo
050070040611     c                   GoTo      EndC00
050080040611     c                   endif
050090040611     c                   movel     prri          atrbva
050100040611     c                   endif
050110040611     C* PERSONALIZZAZIONE CTM
050120040611    1C     V0CCTM        IFNE      *BLANKS
050130950504     C                   SETON                                        26
050140950504     C                   MOVEL     TBLUNI        V1DCTM
050150940928    1C                   ENDIF
050160940822     C*
050170940822     C*** CODICE CLIENTE ***
050180940928    1C     V0CCCM        IFNE      0
050190940824     C     V0CRSM        ORNE      *BLANKS
050200940824     C*
050210940825     C                   MOVEL     V0CFTM        WFTM
050220940915     C                   Z-ADD     V0CCCM        WCCM
050230940928    2C     V0CFLC        IFNE      0
050240940915     C                   Z-ADD     V0CFLC        WFLC
050250940921     C                   ELSE
050260940921     C                   Z-ADD     V0CLNP        WFLC
050270940928    2C                   ENDIF
050280940920     C                   MOVEL(P)  V0CRSM        PAXDMT
050290050120     C                   CLEAR                   VIDDMT
050300950127     C*
050310940824     C                   EXSR      CTRCCM
050320950127     C*
050330940915     C                   MOVE      WCCM          V0CCCM
050340941011     C     *IN14         IFEQ      *ON
050350941011     C                   MOVEL     WFLC          V0CFLC
050360941011     C                   ENDIF
050370941011     C*
050380940928    2C     WEMFOR        IFEQ      '1'
050390940824     C                   GOTO      ENDC00
050400940928    2C                   ENDIF
050410950303     C*
050420950303   X1C                   ELSE
050430940825     C*
050440940825     C* SE CLIENTE A 0 NON IMMETTERE NEMMENO IL MITTENTE PER ESTESO
050450940928    2C     V0DMIT        IFNE      *BLANKS
050460940825     C                   MOVEL     ERR(25)       VIDMSG
050470940920     C                   SETON                                        5090
050480940825     C                   GOTO      ENDC00
050490940928    2C                   ENDIF
050500940928    1C                   ENDIF
050510940825     C***
050520940822     C*** CODICE TARIFFA MITTENTE ***
050530940825     C     V0CFTM        IFEQ      'S'
050540940822     C* SE IMMESSO DEVE ESISTERE IL CODICE MITTENTE
050550940822     C     V0CCCM        IFEQ      *ZEROS
050560940822     C                   MOVEL     ERR(24)       VIDMSG
050570940920     C                   SETON                                        5090
050580940822     C                   GOTO      ENDC00
050590940822     C                   END
050600940822     C* PERSONALIZZAZIONE
050610940822     C                   SETON                                        28
050620940822     C                   END
050630940825     C***
050640940825     C*** MITTENTE ****
050650940822     C* SOLO SE 8888 O 9999 O NON IMMESSO CLIENTE POSSO INDICARE IL MIT
050660950303    0C     V0DMIT        IFNE      *BLANKS
050670950303     C*
050680940909    1C     WCCM          IFEQ      8888
050690940909     C     WCCM          OREQ      9999
050700950303     C*
050710970703     C                   MOVEL     V0CRSM        I14RSC
050720970703     C                   CLEAR                   I14RS2
050730970703     C                   MOVEL     V0CINM        I14IND
050740970703     C                   MOVEL     V0CLOM        E14LOC
050750970703     C                   MOVEL     V0CPIM        E14PIP
050760970703     C                   MOVEL     V0CPRM        E14PRV
050770970703     C                   MOVEL     V0CNZM        E14NAR
050780970703     C                   MOVEL     V0CCAM        E14CAP
050790970704     C                   MOVEL     'M'           WCLI
050800061109     C                   MOVEL     v0ccdf        Wcdf
050810071022     C                   MOVEL     v0cpim        Wiva
050820970704     C                   EXSR      CTRIND
050830941020     C*
050840941020     C* CAMPI CHE POSSO AVER IMPOSTATO
050850970703     C                   MOVEL     E14LOC        V0CLOM
050860970703     C                   MOVEL     E14PIP        V0CPIM
050870970703     C                   MOVEL     E14PRV        V0CPRM
050880970703     C                   MOVEL     E14NAR        V0CNZM
050890970703     C                   MOVEL     E14CAP        V0CCAM
050900970704     C*
050910061109     c* Se errore sulla partita iva , visualizzo messaggio
050920061109     c                   if        xcfivaflg < *zeros
050930120503     c*****              if        wiva=*blanks and dateu>=§vpopiv
050940120504     c                   if        wcdf=*blanks or %subst(wcdf:12:1)=' '
050950071023     c                   z-add     16            H0riga
050960071022     c                   else
050970071023     c                   z-add     17            H0riga
050980071022     c                   endif
050990061109     c                   z-add     64            H0colo
051000061109     c                   endif
051010061109     c
051020970704     C     WEMFOR        IFEQ      '1'
051030970704     C     *IN90         OREQ      *ON
051040970704     C                   GOTO      ENDC00
051050970704     C                   ENDIF
051060040917     c* Segnalazione se inserito mittente estero
051070040917     c     wmitie        ifeq      'E'
051080040917     c     wcontmit      andeq     *blanks
051090040917     c                   movel     '1'           wcontmit
051100040917     c                   seton                                        90
051110040917     c                   z-add     16            h0riga
051120040917     c                   z-add     49            h0colo
051130040917     c                   movel     ERR(283)      vidmsg
051140040917     c                   goto      endc00
051150040917     c                   endif
051160941020     C**
051170950303     C                   SETON                                        1902
051180941110     C                   MOVEL     V0CRSM        VIDDMT
051190940930     C*
051200940930     C                   ELSE
051210940930     C*
051220940930     C* SE NON IMNMESSO CLIENTE O E' UN CODIFICATO PULISCO IL CAMPO
051230940930     C*  DEL CONTROLLO CAP VARIATO
051240940930     C                   CLEAR                   VARCAM
051250940930     C                   CLEAR                   OTT
051260940930    1C                   ENDIF
051270950303    0C                   ENDIF
051280930329     C*
051290930329     C**** CODICE TARIFFA ****
051300941107    1C     V0CCTR        IFNE      *BLANKS
051310050920     C                   CLEAR                   fnlv59ds
051320050920     C                   MOVEL     'S'           ilv59cfo
051330050920     C                   MOVEL     V0CCTR        ilv59ctr
051340050920     C                   CALL      'FNLV59R'
051350050920     C                   PARM                    fnlv59ds
051360941107     C* ERRORE
051370050920    2C     olv59msg      IFNE      *BLANKS
051380050920     C                   MOVEL     olv59msg      VIDMSG
051390941107     C                   SETON                                        9058
051400941107     C                   MOVEL     '1'           WEMFOR
051410941107     C                   GOTO      ENDC00
051420941107    2C                   ENDIF
051430940819     C*
051440050921     C                   MOVEL     olv59dfs      DEFCTR
051450930329     C                   SETON                                        29
051460941107    1C                   ENDIF
051470941103     C*
051480941103     C*** MITTENTE ORIGINALE ***
051490941110     C     V0CRMO        IFNE      *BLANKS
051500941110     C     V0CCMO        ORNE      *BLANKS
051510941103     C                   MOVEL     V0CRMO        WRMO
051520941103     C                   MOVEL     V0CCMO        WCMO
051530941103     C                   MOVEL     V0CNMO        WNAR
051540941103     C                   EXSR      CTRMO
051550941103     C                   MOVEL     WNAR          V0CNMO
051560941103     C     WEMFOR        IFEQ      '1'
051570941103     C                   GOTO      ENDC00
051580941103     C                   ENDIF
051590941110     C                   ENDIF
051600030415      * I dati relativi alla consegna richiesta
051610030411      * possono essere immessi solo se è stato inserito il codice cliente
051620030411      * mittente (no 8888/9999)
051630030411     c                   If        (V0cCcm = *Zeros or
051640030411     c                              V0cCcm = 8888   or  V0cCcm = 9999)   and
051650030411     c                             (V0cTcr <> *Blanks or V0cDcr > *Zeros or
051660030411     c                              V0cHcr >  *Zeros  or V0cMcr > *Zeros or
051670030411     c                              V0cOre >  *Zeros)
051680030411     c                   Eval      *In50 = *On
051690030411     c                   Eval      *In90 = *On
051700030411     c                   Eval      VidMsg = Err(18)
051710030416     c                   GoTo      EndC00
051720030411     c                   EndIf
051730960319     C***
051740930329     C*** CONSEGNA RICHIESTA ***
051750940913     C                   MOVEL     V0CDCR        WDCR
051760940913     C                   MOVEL     V0CHCR        WHCR
051770940913     C                   MOVEL     V0CMCR        WMCR
051780940913     C                   MOVEL     V0CTCR        WTCR
051790940913     C                   EXSR      CTRCR
051800940916     C                   MOVEL     WDCR          V0CDCR
051810940913     C   90              GOTO      ENDC00
051820030410      * o data consegna richiesta o n. ore
051830030409     c                   If        V0cOre > *Zeros
051840030411     c                   If        V0cTcr <> *Blanks
051850030411     c                   Movel     Rimm          At0Tcr
051860030411     c                   Eval      *In90 = *On
051870030411     c                   Eval      VidMsg = Err(276)
051880030411     c                   z-add     21            H0riga
051890030411     c                   z-add     14            H0colo
051900030411     c                   GoTo      EndC00
051910030411     c                   EndIf
051920030409     c                   If        V0cDcr > *Zeros
051930030409     c                   Eval      *In59 = *On
051940030409     c                   Eval      *In90 = *On
051950030409     c                   Eval      VidMsg = Err(276)
051960030409     c                   GoTo      EndC00
051970030409     c                   EndIf
051980030411     c                   If        V0cHcr > *Zeros or V0cMcr > *Zeros
051990030411     c                   Eval      *In60 = *On
052000030411     c                   Eval      *In90 = *On
052010030411     c                   Eval      VidMsg = Err(276)
052020030411     c                   GoTo      EndC00
052030030411     c                   EndIf
052040030415      * Si possono immettere solo 24 48 72 ore
052050030415     c                   If        V0cOre <> 24 and V0cOre <> 48 and
052060030415     c                             V0cOre <> 72
052070030415     c                   Movel     Rimm          At0Ore
052080030415     c                   Eval      *In90 = *On
052090030415     c                   Eval      VidMsg = Err(278)
052100030415     c                   z-add     23            H0riga
052110030415     c                   z-add     31            H0colo
052120030415     c                   GoTo      EndC00
052130030415     c                   EndIf
052140030409     c                   Eval      wflagore = '1'
052150030411     c                   Eval      *In17 = *On
052160030411     c                   Eval      *In16 = *On
052170030411     c                   Eval      *In23 = *On
052180030409     c                   EndIf
052190960319     C***
052200960319     C*** GIORNI DI CHIUSURA ***
052210960319     C                   MOVEL     V0CGC1        WGC1
052220960319     C                   MOVEL     V0CGC2        WGC2
052230960319     C                   EXSR      CTRGCH
052240960319     C   90              GOTO      ENDC00
052250930413     C*** NATURA MERCE ***
052260950112     C     V0CNAS        IFNE      *BLANKS
052270940825     C                   SETON                                        27
052280930329     C                   END
052290940824     C*
052300940824     C     ENDC00        TAG
052310940824     C   90              MOVEL     '1'           WEMFOR
052320940824     C                   ENDSR
052330940922     C*
052340940922     C* CALL AL PGM DI RICERCA TABELLE X§TABER -----------------------*
052350940922     C     CX§TAB        BEGSR
052360990915     C                   CLEAR                   §KEY
052370940922     C                   CALL      'X§TABER'
052380940922     C                   PARM                    CODUT
052390940922     C                   PARM                    COD
052400940922     C                   PARM                    §KEY
052410940922     C                   PARM                    §DES             25
052420940922     C                   MOVEL     '1'           WEMFOR
052430940922     C                   ENDSR
052440940916     C*
052450940916     C* CONTROLLO DATA SPEDIZIONE ------------------------------------*
052460940916     C     CTRDSP        BEGSR
052470940916     C*
052480940916     C                   Z-ADD     VIDDSP        G02DAT
052490940916     C                   MOVEL     *BLANK        G02ERR
052500940916     C                   CALL      'XSRDA8'
052510940916     C                   PARM                    WLBDAT
052520940916     C* ERRATA
052530940916    1C     G02ERR        IFEQ      '1'
052540940920     C                   SETON                                        41  90
052550950920     C* PREPARO L'ERRORE
052560950920     C                   MOVEA     ERR(2)        K78
052570950920     C     2             SUBST     DATAPG:1      W002A
052580950920     C                   MOVEA     W002A         K78(69)
052590950920     C                   MOVEL     '/'           K78(71)
052600950920     C     2             SUBST     DATAPG:3      W002A
052610950920     C                   MOVEA     W002A         K78(72)
052620950920     C                   MOVEL     '/'           K78(74)
052630950920     C     2             SUBST     DATAPG:7      W002A
052640950920     C                   MOVEA     W002A         K78(75)
052650950920     C                   MOVEA     K78           VIDMSG
052660940916    1C                   ENDIF
052670940916     C*
052680940916     C* REIMPOSTO LA DATA SPEDIZIONEGGMMAA PRENDENDO L'ANNO A 4 SE NON
052690940916     C*  IMMESSO DA VIDEO
052700940916    1C     *IN90         IFEQ      *OFF
052710940928     C                   Z-ADD     G02DAT        VIDDSP
052720940916     C*
052730940916     C* IM MANUT O DISK NON SI PUO' CAMBIARE L'ANNO DI SPEDIZIONE
052740940916     C                   MOVE      VIDDSP        WAAS
052750940916    2C   12WAAS          IFNE      §LPAAS
052760940920     C                   SETON                                        4190
052770940916     C                   MOVEL     ERR(3)        VIDMSG
052780940916    2C                   ENDIF
052790940916    1C                   ENDIF
052800001121      *
052810001124      * SE SONO IN MANUTENZIONE DI UN PREPAGATO NON POSSO METTERE IN
052820001124      * SOSPENSIONE LA BOLLA SE CAMBIO MESE
052830001121    1C   22*IN90         IFEQ      *OFF
052840001124     C     PARTCH        ANDNE     'P'
052850010307     C     §LPFPR        ANDNE     'O'
052860001121     C                   MOVEL     BLPAAS        W0080             8 0
052870001121     C                   MOVE      BLPMGS        W0080
052880001121     C                   MOVEL     W0080         W0060             6 0
052890001121     C                   MOVEL     G02INV        W0060S            6 0
052900001121     C     W0060         IFLT      W0060S
052910001121     C                   SETON                                        4190
052920001121     C                   MOVEL     ERR(193)      VIDMSG
052930001121     C                   ENDIF
052940121017     c* Errore se data compresa nel range dal/al per blocco immissione
052950121017     c* prepagati (tabella "DGD")
052960121017     c***                if        *in90 = '0' and g02inv = §vpodip
052970121017     c                   if        *in90 = '0' and
052980121017     c                             g02inv>=§dgdbpd and g02inv<=§dgdbpa
052990050215     c                   Eval      VidMsg = 'Data non ammessa per spedizioni +
053000050215     c                             in Porto Prepagato'
053010050215     c                   seton                                        4190
053020050215     c                   endif
053030001121     C                   ENDIF
053040940916     C*
053050940916    1C     *IN90         IFEQ      *OFF
053060940916     C                   Z-ADD     G02INV        BLPDSP            8 0
053070950920     C* DATE SPEDIZIONE NO > DATA MAX DI SOSPENSIONE
053080950920    2C     BLPDSP        IFGT      DATAPA
053090940920     C                   SETON                                        4190
053100950920     C                   MOVEA     ERR(2)        K78
053110950920     C     2             SUBST     DATAPG:1      W002A
053120950920     C                   MOVEA     W002A         K78(69)
053130950920     C                   MOVEL     '/'           K78(71)
053140950920     C     2             SUBST     DATAPG:3      W002A
053150950920     C                   MOVEA     W002A         K78(72)
053160950920     C                   MOVEL     '/'           K78(74)
053170950921     C     2             SUBST     DATAPG:7      W002A
053180950920     C                   MOVEA     W002A         K78(75)
053190950920     C                   MOVEA     K78           VIDMSG
053200940916    2C                   ENDIF
053210940916    1C                   ENDIF
053220940916     C* PERSONALIZZAZIONE
053230940916    1C  N90WPERSO        IFEQ      'P'
053240940928     C     BLPDSP        ANDNE     DATEU
053250940916     C                   SETON                                        24
053260940916    1C                   ENDIF
053270940916     C*
053280940916     C                   ENDSR
053290940916     C*
053300970704     C* CONTROLLO INDIRIZZO COMPLETO MITT/DESTIN ---------------------*
053310970704     C     CTRIND        BEGSR
053320970710     C* LE DS SONO DA CLEARARE PRIMA ALTRIMENTI DANNO PROBLEMI IN CTRER
053330970710     C                   CLEAR                   DSLV13
053340970710     C                   CLEAR                   DSSI95
053350060922     C                   CLEAR                   tisi97ds
053360061109     c                   clear                   xcfivads
053370970710     C*
053380970704     C                   CLEAR                   I14ISO
053390970714     C                   MOVEL     BLPDSP        I14DRI
053400020205     c                   movel     'S'           i14cnz
053410100115     c                   movel     'S'           i14forzait
053420080414     c***                clear                   ds15x
053430970704     C                   CALL      'FNLV14R'
053440970707     C                   PARM                    KPJBA
053450970707     C                   PARM                    DSLV14
053460080414     C***                PARM                    ds15x
053470970707     C*
053480970707     C                   MOVEL     O14ERR        WERR              1
053490970707     C                   MOVEL     O14MSG        VIDMSG
053500970707     C                   EXSR      CTRERR
053510970707     C**
053520970707     C     WEMFOR        IFEQ      '1'
053530970707     C                   GOTO      ENDIND
053540970707     C                   ENDIF
053550061109     c
053560061109     c* Se immesso controllo il codice fiscale
053570061109     c                   if        wcdf<>*blanks
053580061109     c                   clear                   xcfivamod
053590061109     c                   eval      xcfivapar = wcdf
053600061109     c                   eval      xcfivanar = e14nar
053610061109     c                   eval      xcfivaprv = e14prv
053620061109     c                   call      'XCFIVAR'
053630061109     c                   parm                    xcfivads
053640080904     c                   parm                    forzaIta          1
053650080904     c                   parm                    wiva
053660061109     c*
053670061109     c                   if        xcfivaflg < *zeros
053680080904     c                   movel     xcfivamsg     vidmsg
053690061109     c                   seton                                        2890
053700061109     C                   GOTO      ENDIND
053710061109     c                   endif
053720061109     c                   endif
053730061109     c
053740061109     c* MITTENTE: COD FISCALE OBBLIGATORIO FORZABILE, SE prepagato 8888
053750071022     c*  22              if        Wcli='M' and wccm=8888  and
053760071022     c*                            wcdf=*blanks  and e14nar=*blanks
053770120503     c*  22              if        Wcli='M' and wccm=8888
053780120503     c*                            and e14nar=*blanks and (wcdf=*blanks
053790120503     c*                            or (wiva=*blanks and dateu>=§vpopiv))
053800120508     c* MITTENTE: PREPAGATO
053810120508    1c   22              if        Wcli='M' and e14nar=*blanks
053820120508     c* P.iva $$ sempre errore
053830120508    2c                   if        %scan('$$':wiva) >0
053840120508     c                   movel     err(345)      vidmsg
053850120508     c                   seton                                        702890
053860120508     C                   GOTO      ENDIND
053870120508    2c                   endif
053880120508     c* Prepagato 8888
053890120508   1ac                   if        wccm=8888
053900120503     c* errore forzabile: Codice fiscale o Partita iva
053910120504    2c                   if        wcdf=*blanks   and wiva=*blanks
053920120503     c* errore forzabile: se inserito codice fiscale lungo 11 inserire anche la
053930120503     c*                   P.IVA
053940120503     c                             or (wcdf<>*blanks and %subst(wcdf:12:1)=' '
053950120503     c                                 and wiva=*blanks)
053960061109     c* Se cambiato mittente ricontrollo
053970120504    3c                   if        i14rsc<>savrsm
053980120503     c                   clear                   forzcdf           1
053990120504     c                   clear                   forzcdf1          1
054000120503     c                   movel     i14rsc        savrsm
054010120504    3c                   endif
054020061109     c*
054030130131     c* 31/01/2013: Errori non più forzabili ma sempre bloccanti
054040120504    3c                   select
054050130131     c****               when      forzcdf=' ' and wcdf=*blanks
054060130131     c                   when      wcdf=*blanks
054070120503     c                   movel     err(343)      vidmsg
054080120504     c                   movel     '1'           forzcdf
054090120504     c                   z-add     -1            xcfivaflg
054100120504     c                   seton                                        2890
054110120504     C                   GOTO      ENDIND
054120130131     c****               when      forzcdf1=' ' and wcdf<>*blanks
054130130131     c                   when      wcdf<>*blanks
054140120503     c                   movel     err(344)      vidmsg
054150120504     c                   movel     '1'           forzcdf1
054160120503     c                   z-add     -1            xcfivaflg
054170120503     c                   seton                                        2890
054180120503     C                   GOTO      ENDIND
054190120504    3c                   endsl
054200120504    2c                   endif
054210120508   1ac                   endif
054220120504    1c                   endif
054230061109     c
054240020207     c* DESTINATARIO
054250020207     c     WCLI          ifeq      'D'
054260020207     C* SE IMMESSA LINEA DI ARRIVO PER DPD DEVE ESSERE UNA LINEA
054270020207     C* DPD    -   STESSA COSA PER FED-EX
054280020207     C     VIDDPD        IFEQ      'D'
054290051028     C**   O14IE         ANDEQ     'E'
054300020207     C     COMLNA        andgt     0
054310020207     C     COMLNA        ANDNE     O14LAD
054320020319     C     A_§OGNTW      ANDNE     'DPD'
054330020207     C     VIDDPD        oreq      'F'
054340051028     C**   O14IE         ANDEQ     'E'
054350020207     C     COMLNA        andgt     0
054360020207     C     COMLNA        ANDNE     O14LAF
054370020213     C     A_§OGNTW      ANDNE     'FED'
054380020207     C*
054390020207     C                   MOVEa     ERR(183)      k78
054400020207     C                   SETON                                        4790
054410020207     c     viddpd        ifeq      'D'
054420020207     c                   eval      w005a = 'DPD  '
054430020207     c                   else
054440020207     c                   eval      w005a = 'FedEx'
054450020207     c                   endif
054460020214     c                   movea     w005a         k78(66)
054470020207     C                   MOVEA     K78           VIDMSG
054480020211     C                   GOTO      ENDind
054490020207     c*
054500020207     C                   ENDIF
054510020207     c*
054520020207     c                   select
054530020207     C* SE LNA DPD =000 NON C'E' IL SERVIZIO
054540020207     c     viddpd        wheneq    'D'
054550020207     C     o14lad        andle     *ZEROS
054560020213     c     comlna        andeq     *zeros
054570020319     c     A_§ogNTW      oreq      'DPD'
054580020207     c     o14lad        andle     *zeros
054590060921     c* se però c'e' reso non do errore
054600060921     c                   if        o14red=' ' or
054610060921     c                             (o14red='S' and vidfbr<>'S')
054620020207     C                   MOVEL     ERR(192)      VIDMSG
054630020207     C                   SETON                                        90
054640020207     c     viddpd        ifeq      'D'
054650020207     c                   z-add     21            h1riga
054660020207     c                   z-add     10            h1colo
054670020207     c                   else
054680020207     C                   SETON                                        47
054690020207     c                   endif
054700020207     C                   GOTO      ENDind
054710060921     c                   endif
054720060921     c
054730020207     C* SE LNA FEDEX=000 NON C'E' IL SERVIZIO
054740020207     c     viddpd        wheneq    'F'
054750020207     C     o14laf        andle     *ZEROS
054760020213     c     comlna        andeq     *zeros
054770020213     c     A_§ogntw      oreq      'FED'
054780020207     C     o14laf        andle     *ZEROS
054790020207     C                   MOVEL     ERR(244)      VIDMSG
054800020207     C                   SETON                                          90
054810020207     c     viddpd        ifeq      'F'
054820020207     c                   z-add     21            h1riga
054830020207     c                   z-add     10            h1colo
054840020207     c                   else
054850020207     c                   seton                                        47
054860020207     c                   endif
054870020207     C                   GOTO      ENDind
054880020207     c* se flag EuroExpress = blank non c'è il servizio
054890020207     c     viddpd        wheneq    ' '
054900020207     c     o14ie         andeq     'E'
054910020207     c     o14eex        andeq     *blanks
054920020213     c     comlna        andeq     *zeros
054930020213     c     A_§ogntw      oreq      'EEX'
054940020207     c     o14eex        andeq     *blanks
054950020214     C                   MOVEL     ERR(247)      VIDMSG
054960020207     C                   SETON                                          90
054970020213     c     A_§ogntw      ifeq      'EEX'
054980020212     c     *in12         oreq      *on
054990020212     c     *in15         andeq     *off
055000020207     c                   seton                                        47
055010020207     c                   else
055020020207     c                   z-add     21            h1riga
055030020207     c                   z-add     10            h1colo
055040020207     c                   endif
055050020207     C                   GOTO      ENDind
055060020207     c                   endsl
055070020207     c                   endif
055080970707     C*************
055090020214     C* CONTROLLO CAP -
055100970707     C                   MOVEL     '7'           I95TCN
055110970707     C                   MOVEL     E14CAP        I95CAP
055120970707     C                   MOVEL     E14LOC        I95LOC
055130970707     C                   MOVEL     E14PRV        I95PRV
055140970707     C                   MOVEL     E14NAR        I95NAR
055150970714     C                   MOVEL     BLPDSP        I95DAT
055160971201     C     §3AFCA        IFNE      0
055170971201     C                   MOVEL     'S'           I95FCA
055180971201     C                   ENDIF
055190971201     C                   MOVEL     FLGTB1        I95TPO
055200970707     C                   MOVEL     'S'           I13AF0
055210061122     c* per disk "B" non deve controllare la congruenza della località
055220061122     c* con il cap anche quando quest'ultimo ha eccezioni
055230061122     c                   if        wcli='D' and §1bfg6='C'
055240061122     c                             and §1bfg2='S'
055250061122     C                   clear                   I13AF1
055260061122     c                   else
055270970707     C                   MOVEL     'S'           I13AF1
055280061122     c                   endif
055290061122     c
055300970707     C                   MOVEL     'S'           I13SZ2
055310140122     C* CAP CON VIARIO: NON CONTROLLO PER DISK B
055320000704     C     §1BFG6        IFNE      'C'
055330140122     C**** §1BFG2        ORNE      'S'
055340150121     C                   MOVEL     'Y'           I13CNV
055341150123     c                   movel     vidind        i95ind
055350000704     C                   ENDIF
055360970707     C                   MOVEL     'S'           I13SZV
055370140121     c                   if        wcli='D'
055380140121     c                   clear                   dspr
055390140121     C                   MOVEL     'PR'          COD
055400140121     C                   MOVEL(P)  i95prv        KEY
055410140121     c     ktab2         chain     tabel00f
055420140121     c                   if        %found(tabel00f)
055430140121     c                   eval      dspr=tbluni
055440140121     c                   endif
055450140121     c                   if        §prpla='S'
055460140121     c                   clear                   i13szv
055470140121     c                   endif
055480140121     c                   endif
055490991213     C* PER LNP DPD, CONTROLLO CONGRUENZA LOCALITA' CAP E PROVINCIA
055500000314     C*  E NON SOLO CAP E PROVINCIA
055510020319     C     §OGNTW        IFEQ      'DPD'
055520000622     C* CONTROLLO PER TUTTI TRANNE CHE PER DSK "B"
055530000622     C     §1BFG6        ORNE      'C'
055540000622     C     §1BFG2        ORNE      'S'
055550000314      * TESTIAMO CONTROLLO SU SPEDIZIONI DI VERONA 15/03/00
055560000322      * TESTIAMO CONTROLLO SU SPEDIZIONI DI TREVISO 22/03/00
0555709912139/12 C                   MOVEL     'S'           I13LA3
0555809912139/12 C                   MOVEL     'S'           I13SZ3
055590991213     C                   ENDIF
055600970707     C**
055610970708     C**  M I T T E N T E
055620970707    1C     WCLI          IFEQ      'M'
055630970707     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO : ERRORE FORZABILE
055640970707    2C     E14CAP        IFNE      VARCAM
055650970707     C                   CLEAR                   OTT
055660970707     C                   CLEAR                   MMA
055670970707     C                   CLEAR                   MMB
055680000622     C                   CLEAR                   MMD
055690970707     C                   MOVEL     E14CAP        VARCAM
055700970707    2C                   ENDIF
055710970707     C** MODIFICA LOCALITA'
055720970707    2C     E14LOC        IFNE      VARLOM
055730970707     C                   MOVEL     E14LOC        VARLOM
055740970707     C                   CLEAR                   MMA
055750970707     C                   CLEAR                   MMB
055760000622     C                   CLEAR                   MMD
055770970707    2C                   ENDIF
055780970708     C**
055790970707     C                   MOVEL     OTT           E13FZV
055800970707     C                   MOVEL     MMA           E13FZ1
055810970707     C                   MOVEL     MMB           E13FZ2
055820000622     C                   MOVEL     MMD           E13FZ3
055830020218     c* se network fedex passo flag apposito per dire di prendere i dati
055840020218     c* dalla tabella della nazione
055850020218     c     §ogntw        ifeq      'FED'
055860020218     c                   movel     'S'           i95fi1
055870020218     c                   endif
055880970708     C**
055890970708     C                   ELSE
055900970708     C**
055910970708     C**  D E S T I N A T A R I O
055920970708     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO
055930970708    2C     E14CAP        IFNE      VARCAD
055940970708     C                   CLEAR                   DIE
055950970708     C                   CLEAR                   SET
055960970708     C                   CLEAR                   AAA
055970970708     C                   CLEAR                   AAB
055980991213     C                   CLEAR                   AAD
055990970708     C*
056000970708     C* SE CAMBIATO MA IN MANUTENZIONE RIMESSO QUELLO DELLA BOLLA  -->
056010970708     C*  COME SE NON FOSSE CAMBIATO NULLA
056020970708    3C     *IN12         IFEQ      *ON
056030970708     C     *IN15         ANDEQ     *OFF
056040970708     C     E14CAP        ANDEQ     BLPCAD
056050970708     C                   CLEAR                   NOV
056060970708     C                   ELSE
056070970708     C                   CLEAR                   QUA
056080100209     C                   CLEAR                   QUAH
056090970708     C                   MOVEL     '1'           NOV
056100970708    3C                   ENDIF
056110970708     C* MEMORIZZO NUOVO CAP
056120970708     C                   MOVEL     E14CAP        VARCAD
056130970708    2C                   ENDIF
056140970708     C* MODIFICA LA LOCALITA'
056150970708    2C     E14LOC        IFNE      VARLOD
056160970708     C                   MOVEL     E14LOC        VARLOD
056170970708     C                   CLEAR                   AAA
056180970708     C                   CLEAR                   AAB
056190991213     C                   CLEAR                   AAD
056200970708    2C                   ENDIF
056210970708     C**
056220970708     C                   MOVEL     SET           E13FZV
056230970708     C                   MOVEL     AAA           E13FZ1
056240970708     C                   MOVEL     AAB           E13FZ2
056250991213     C                   MOVEL     AAD           E13FZ3
056260020212     c* se network fedex passo flag apposito per dire di prendere i dati
056270020212     c* dalla tabella della nazione
056280020213     c     A_§ogntw      ifeq      'FED'
056290020212     c     viddpd        oreq      'F'
056300020218     c     o14ie         andeq     'E'
056310020212     c                   movel     'S'           i95fi1
056320060922     c                   movel     'FED'         i97ntw
056330020212     c                   endif
056340060922     c*
056350060922     c     A_§ogntw      ifeq      'DPD'
056360060922     c     viddpd        oreq      'D'
056370060922     c     o14ie         andeq     'E'
056380060922     c                   movel     'DPD'         i97ntw
056390060922     c                   endif
056400060922     c* se non ancora impostato ed è estero, è euroexpress
056410060922     c                   if        (i97ntw=*blanks and o14ie='E') or
056420060922     c                             (i97ntw=*blanks and A_§ogntw='EEX')
056430060922     c                   movel     'EEX'         i97ntw
056440060922     c                   endif
056450970707    1C                   ENDIF
056460970722     C**
056470970722     C* SE RICHIAMO DALLA CONFERMA BOLLE SENZA FERMARSI SULLA BOLLA
056480970722     C*  IN CASO DI ERRORE NON DO L'INTERROGAZIONE LOCALITA' IN CASO
056490970722     C*  DI RESTITUZIONE AFFIDABILITA'=1
056500970722     C   12
056510970722     CAN 15§LPFPR        IFNE      'V'
056520970722     C     §LPFPR        ANDNE     'X'
056530970722     C                   MOVEL     1             E13FZ1
056540970722     C                   ENDIF
056550970707     C**
056560970707     C** CALL
056570120105     c                   if        §3arbl<>'R'
056580970707     C                   CALL      'FNLV13R'
056590970707     C                   PARM                    KPJBA
056600970707     C                   PARM                    DSLV13
056610970707     C                   PARM                    DSSI95
056620060922     C                   PARM      ' '           flgbac            1
056630060922     C                   PARM                    tisi97ds
056640120105     c                   else
056650120105     C                   CALL      'FNLV13R'
056660120105     C                   PARM                    KPJBA
056670120105     C                   PARM                    DSLV13
056680120105     C                   PARM                    DSSI95
056690120105     C                   PARM      ' '           flgbac            1
056700120105     c                   endif
056710970707     C*
056720970707     C                   MOVEL     O13ERR        WERR              1
056730970707     C                   MOVEL     O13MSG        VIDMSG
056740970707     C                   EXSR      CTRERR
056750970708     C**
056760970707     C* REIMPOSTO LE FORZATURE
056770970708     C     WCLI          IFEQ      'M'
056780970707     C                   MOVEL     E13FZV        OTT
056790970707     C                   MOVEL     E13FZ1        MMA
056800970707     C                   MOVEL     E13FZ2        MMB
056810000622     C                   MOVEL     E13FZ3        MMD
056820970708     C                   ELSE
056830970708     C                   MOVEL     E13FZV        SET
056840970708     C                   MOVEL     E13FZ1        AAA
056850970708     C                   MOVEL     E13FZ2        AAB
056860991213     C                   MOVEL     E13FZ3        AAD
056870970707     C                   ENDIF
056880970708     C**
056890970708     C     WEMFOR        IFEQ      '1'
056900970708     C                   GOTO      ENDIND
056910970708     C                   ENDIF
056920080410     c* PORTI ASSEGNATI
056930080410     c* Se porto assegnato effettuabile solo a fronte di orm commissionato
056940080410     c* da p.o. del network verifico che il p.o. emittente sia quello del
056950080410     c* network
056960080410     c                   clear                   wnocont
056970080411    1c                   if        o97uti='N' and wcli='D'
056980080410     c* Se provengo da manutenzione di bolla di reso lo memorizzo
056990080410     c* per non effettuare il controllo seguente
057000080411    2c     *in12         ifeq      *on
057010080410     c     *in15         andeq     *off
057020080410     c     vidfbr        andeq     'S'
057030080410     c                   move      'N'           wnocont           1
057040080411    2c                   endif
057050080410     c                   movel     o97flo        dcppflo
057060080410     c* ricavo p.o. emittente
057070080411    2c                   if            §cpppas='O' and wnocont=*blanks
057080080410     c                             and i95tpo='A'
057090080410     c* non richiamato da giacenze o ritiri annullati
057100080410     c                             and savfpr<>'P' and savfpr<>'G'
057110080410     c                             and savfpr<>'T'
057120080410     c* orm fittizio oppure orm non commissionato da po del network
057130080411    3c                   if        flgfit='S' or i97ntw<>poentw
057140080411    4c                   if        wperso='P'
057150080410     C                   Z-ADD     05            H0RIGA
057160080410     C                   Z-ADD     20            H0COLO
057170080410     c                   else
057180080410     C                   Z-ADD     06            H1RIGA
057190080410     C                   Z-ADD     20            H1COLO
057200080411    4c                   endif
057210080410     c                   seton                                        90
057220080410     c* preparo il testo del messaggio
057230080410     c                   movel     err(229)      vidmsg
057240080411     C                   CLEAR                   dsbs02
057250080411     c                   clear                   dntw
057260080411     C                   MOVEL     'C'           T02MOD
057270080411     C                   MOVEL     KNSIF         T02SIF
057280080411     C                   MOVEL     'NTW'         T02COD
057290080411     c                   movel(P)  i97ntw        t02ke1
057300080411     C                   CALL      'TIBS02R'
057310080411     C                   PARM                    KPJBA
057320080411     C                   PARM                    dsbs02
057330080411    4C                   IF        T02ERR = *BLANKS
057340080411     C                   MOVEL     T02uni        dntw
057350080411    4C                   ENDIF
057360080411     c                   eval      %subst(vidmsg:14:5)=%subst(§ntwdes:1:5)
057370080411     c                   eval      %subst(vidmsg:71:5)=%subst(§ntwdes:1:5)
057380080410     C                   GOTO      ENDIND
057390080411    3c                   endif
057400080411    2c                   endif
057410080411    1c                   endif
057420090827     c*
057430090921     c* Per destinatario vedo se il tipo servizio prevede un codice tempo
057440090827     c*  consegna obbligato, anche parziale
057450100322     c* Se esiste FNORE --> dico che si può utilizzare
057460100322     c                   if        Wcli='D' and WesORE='N'
057470100322     c                   movel     'S'           wesore
057480100322     c                   endif
057490100322     c
057500100125    1c                   if        vidtsp<>' ' and wcli='D'
057510100322
057520090827     C                   Z-ADD     1             C
057530090827     C     vidtsp        LOOKUP    TSP(C)                                 30
057540090827    2C                   IF        *in30  and TSttc(c)<>*blanks
057550090827     c* controllo posizione per posizione escudendo le "x"
057560090827     c                   eval      Wttc=TSttc(c)
057570090827     c                   eval      WttcCAP=%editc(o95ttc:'X')
057580090827     c                   z-add     1             c
057590090921    3c                   do        5             c
057600090827     c                   if        %subst(wttc:c:1)<>'x'
057610090827     c                             and
057620090827     c                             %subst(wttc:c:1)<>%subst(wttcCAP:c:1)
057630090827     C                   MOVEL     ERR(307)      VIDMSG
057640090827     c                   seton                                        9048
057650090827     C                   MOVEL     '1'           WEMFOR
057660100319     c* Se vengo da ORM --> memorizzo di non considerare FNORE
057670100319     c*  perchè incongruente col CAP
057680100319     c                   if        wesORE='S'
057690100319     c                   movel     'N'           wesore
057700100319     c                   endif
057710100319
057720100319     C                   GOTO      ENDIND
057730090827     c                   endif
057740090921    3c                   enddo
057750090827     c
057760090921    2c                   endif
057770090921     c
057780090921     c* Se fermo deposito non accetto tipo servizio H
057790090921    2c                   if        vidtsp='H'  and vidffd='S'
057800090921     C                   MOVEL     ERR(101)      VIDMSG
057810090921     c                   seton                                        9048
057820090921     C                   MOVEL     '1'           WEMFOR
057830090921     C                   GOTO      ENDIND
057840090921    2c                   endif
057850090921    1c                   endif
057860080410     c
057870000622     C**
057880000622     C* SE SI TATTA DI CAP OBSOLETO, ERRORE NO FORZABILE
057890061010     C***  §1BFG6        IFNE      'C'
057900061010     C***  §1BFG2        ORNE      'S'
057910061010     C***  O95CF1        IFEQ      'O '
057920061010     C***  WCLI          IFEQ      'M'
057930061010     C***                SETON                                        5390
057940061010     C***                ELSE
057950061010     C***                SETON                                        6590
057960061010     C***                ENDIF
057970061010     C***                MOVEL     ERR(201)      VIDMSG
057980061010     C***                MOVEL     '1'           WEMFOR
057990061010     C***                GOTO      ENDIND
058000061010     C***                ENDIF
058010061010     C***                ENDIF
058020970704     C**
058030970704     C* M I T T E N T E
058040970704    1C     WCLI          IFEQ      'M'
058050970704     C                   MOVEL     O14IE         WMITIE            1
058060970704     C                   MOVEL     O14VLT        MITVLT
058070970704     C                   MOVEL     O95ISO        COMFAP
058080970708     C                   MOVEL     O95CTS        MITCTS            2
058090140403     C                   MOVEL     O95gf2        comgf2
058100970704     C**
058110970704   X1C                   ELSE
058120970704     C*
058130970704     C                   MOVEL     O14IE         WDESIE            1
058140970704     C                   MOVEL     O14VLT        DESVLT
058150970704     C                   MOVEL     O14EFT        DESEFT
058160000321     C                   MOVEL     O14EFD        DESEFD
058170971215     C                   MOVEL     O14COD        DESCOD
058180000120     C                   MOVEL     O14LAD        DESLAD
058190060920     C                   MOVEL     O14red        DESred
058200020130     C                   MOVEL     O14eff        DESeff
058210020131     C                   MOVEL     O14ffn        DESffn
058220080414     c***                movel     x_§15cex      descaeex
058230080414     c***                movel     x_§15cdp      descadpd
058240080414     c***                movel     x_§15cfe      descafed
058250970704     C                   MOVEL     O95ISO        COMFIN
058260970704     C                   MOVEL     O95GDD        DESGDD            1
058270021118      * Se spedizione export il DDT va sempre impostato a 'N'
058280021118     c                   If        O14ie = 'E'
058290021118     c                   Eval      DesGdd = 'N'
058300021118     c                   EndIf
058310021118      * Mi salvo flag ddt
058320021118     c                   Eval      SavGdd = O95Gdd
058330970704     C   12
058340970704     CAN 15
058350970704     CORN12              MOVEL     O95CTS        SAVCTS            2
058360970704     C*
058370970704     C* MANUTENZIONE RICALCOLO COD TASSAZIONE SOLO SE CAMBIATA PROV
058380990629     C*  NAZIONE E CAP
058390970704     C   12
058400970704     CANN15BLPPRD        IFNE      E14PRV
058410990629     C     BLPNZD        ORNE      E14NAR
058420990629     C     BLPCAD        ORNE      E14CAP
058430030320     c     blpnzd        orne      *Blanks
058440030320     c     e14nar        orne      *Blanks
058450970704     C                   MOVEL     O95CTS        SAVCTS
058460970704     C                   ENDIF
058470970704     C**
058480970704    1C                   ENDIF
058490970704     C*
058500970704     C     ENDIND        ENDSR
058510970707     C*
058520970707     C* CONTROLLO SE C'E' ERRORE-------------------------------------*
058530970707     C     CTRERR        BEGSR
058540970708     C* IMPOSTO CAMPI PASSATI
058550970708     C     O13RON        IFEQ      'S'
058560970708     C                   MOVEL     O95NAR        E14NAR
058570970708     C                   ENDIF
058580970708     C     O13ROC        IFEQ      'S'
058590970708     C                   MOVEL     O95CAP        E14CAP
058600970708     C                   ENDIF
058610970708     C     O13ROP        IFEQ      'S'
058620970708     C                   MOVEL     O95PRV        E14PRV
058630970708     C                   ENDIF
058640970708     C     O13ROL        IFEQ      'S'
058650970708     C                   MOVEL     O95LOC        E14LOC
058660970708     C                   ENDIF
058670970708     C**
058680970707     C* ERRORE O RICERCA CAMPO
058690970707    1C     WERR          IFNE      ' '
058700970707     C*
058710970707    2C     VIDMSG        IFNE      *BLANKS
058720970707     C                   SETON                                        90
058730970707    2C                   ENDIF
058740970707     C* POSIZIONAMENTO CURSORE
058750970707    2C                   SELECT
058760970707    2C     WERR          WHENEQ    '1'
058770970707     C     WERR          OREQ      '2'
058780970707    3C     WCLI          IFEQ      'M'
058790970707     C                   SETON                                        52
058800970707     C                   ELSE
058810970707     C                   SETON                                        64
058820970707    3C                   ENDIF
058830970707    2C     WERR          WHENEQ    '3'
058840970707    3C     WCLI          IFEQ      'M'
058850970707     C                   SETON                                        54
058860970707     C                   ELSE
058870970707     C                   SETON                                        66
058880970707    3C                   ENDIF
058890970707    2C     WERR          WHENEQ    '4'
058900970707    3C     WCLI          IFEQ      'M'
058910970707     C                   SETON                                        55
058920970707     C                   ELSE
058930970707     C                   SETON                                        71
058940970707    3C                   ENDIF
058950970707    2C     WERR          WHENEQ    '5'
058960970707    3C     WCLI          IFEQ      'M'
058970970707     C                   SETON                                        53
058980970707     C                   ELSE
058990970707     C                   SETON                                        65
059000970707    3C                   ENDIF
059010970707    2C     WERR          WHENEQ    '6'
059020970707     C                   SETON                                        68
059030970707    2C     WERR          WHENEQ    '7'
059040970707     C                   SETON                                        70
059050970707    2C     WERR          WHENEQ    '8'
059060970707     C                   SETON                                        10
059070020204     c     werr          wheneq    '0'
059080020204    3C     WCLI          IFEQ      'M'
059090020204     C                   SETON                                        55
059100020204     C                   ELSE
059110020204     C                   SETON                                        71
059120020204    3C                   ENDIF
059130970707    2C                   ENDSL
059140970707     C*
059150970707     C                   MOVEL     '1'           WEMFOR
059160970707    1C                   ENDIF
059170970707    1C                   ENDSR
059180970704     C*
059190940916     C* CONTROLLO DATA RITIRO MERCE ----------------------------------*
059200940916     C     CTRDRT        BEGSR
059210940916     C*
059220940916     C* CONTROLLO SOLO QUANDO VIENE MODIFICATA
059230990610   0AC     PARTCH        IFEQ      'P'
059240990610     C     VIDDRT        ANDGT     0
059250010307     C     §LPFPR        OREQ      'O'
059260010307     C     VIDDRT        ANDGT     0
059270990610     C     PARTCH        ORNE      'P'
059280010307     C     §LPFPR        ANDNE     'O'
059290940916    0C     VIDDRT        IFNE      SAVDRT
059300950215     C     VIDDRT        OREQ      0
059310070808     C* Se O.R.M. fittizio imposto a no display la scritta "DA O.R.M."
059320070808     c                   if        flgfit='S'
059330070808     c                   if        wperso='P'
059340070808     c                   movel     nodi          at0daorm
059350070808     c                   else
059360070808     c                   movel     nodi          atrdaorm
059370070808     c                   endif
059380070808     c                   endif
059390070808     c*
059400070831     c
059410940920     C                   Z-ADD     VIDDRT        G02DAT
059420940916     C                   CLEAR                   G02ERR
059430940916     C                   CALL      'XSRDA8'
059440940916     C                   PARM                    WLBDAT
059450940916     C*
059460070831     c* se in personalizzazione e non immessa data ritiro non è obbligatoria
059470070905     c* se l'orm è fittizio
059480070905     c* non è obbligatoria anche se non immessa la data e non immesso l'ORM
059490071107     c****               if        wperso='P' and dateu>=§vpodrt and
059500071107     c                   if        wperso='P' and
059510070905     c                             viddrt=0 and
059520070905     c                             ((flgfit='S' and widor1>*zeros) or
059530070905     c                             widor1=*zeros)
059540070831     c                   else
059550940916     C* SE ERRATA O MAGGIORE DI WDTGIO ERRORE
059560080109     C* NO < DI xx GIORNI DA OGGI (come da tabella "3I")
059570070904    1C*    G02ERR        IFEQ      '1'
059580070904     C*    G02INV        ORGT      DATEU
059590070904     C*    PARTCH        ANDNE     'P'
059600070904     C*    §LPFPR        ANDNE     'O'
059610070904     C*    G02INV        ORLT      DATAM
059620070904     c                   if        g02err='1' or (g02inv>dateu and
059630070904     c                             partch<>'P' and §lpfpr<>'O')
059640110420     c                             or (g02inv<datamin and not *in22)
059650110420     c                             or (g02inv<datam40 and     *in22)
059660071107     c***                          or (g02inv<datam and (dateu<§vpodrt or
059670080109     c***                          or (g02inv<datamin and (
059680080109     c***                          flgfit='S' or s_drt<>viddrt))
059690940916     C                   MOVEL     ERR(6)        VIDMSG
059700940920     C                   SETON                                        4390
059710080109     c* se errore data ritiro in quanto viene forzata data orm aggiungo
059720080109     c* nel messaggio di verificare l'orm
059730080128     c                   if        g02inv<datamin and flgfit<>'S' and not *in22
059740080109     c                   eval      vidmsg=%trim(vidmsg)
059750080109     c                             + ': verificare l''O.R.M.'
059760080109     c                   endif
059770940916    1C                   ENDIF
059780110422     c* Se prepagato e immessa data più vecchia di datamin
059790110422     c* errore forzabile
059800110422     c                   if        g02inv<datamin and *in22 and wforzadrt=*off
059810110422     C                   MOVEL     ERR(339)      VIDMSG
059820110422     c                   eval      %subst(vidmsg:49:2)=%char(§3iggb)
059830110422     C                   SETON                                        4390
059840110422     c                   eval      wforzadrt=*on
059850110422     c                   endif
059860070831     c                   endif
059870940916     C* OK
059880940916     C  N90              MOVE      G02INV        COMDRT
059890940916     C  N90              MOVE      G02DAT        VIDDRT
059900940916     C*
059910950215     C  N90              MOVEL     VIDDRT        SAVDRT
059920070829     C  N90              MOVEL     VIDDRT        S_DRT
059930940916    0C                   ENDIF
059940990610   0AC                   ENDIF
059950990610     C*
059960990610     C     VIDDRT        IFEQ      0
059970990610     C                   CLEAR                   COMDRT
059980990610     C                   CLEAR                   SAVDRT
059990990610     C                   ENDIF
060000990628     C* PRESTAZIONE MATTINO POMERIGGIO
060010040909     C  N90PARTCH        IFNE      'P'
060020010307     C     §LPFPR        ANDNE     'O'
060030990628     C     VIDFPP        ANDEQ     ' '
060040010503     C     WPERSO        ANDNE     'P'
060050990628     C                   MOVEL     ERR(163)      VIDMSG
060060990628     C                   SETON                                        4090
060070990628    1C                   ENDIF
060080940916     C                   ENDSR
060090940824     C*
060100940824     C* CONTROLLO NAZIONE E P.IVA ------------------------------------*
060110940907     C     CTRNAR        BEGSR
060120940824     C*
060130020211     C                   MOVEL     '15'          COD
060140020211     C                   MOVEL     '15'          CODTAB
060150940824     C* RICERCA
060160940824     C     '?'           SCAN      WNAR                                   30
060170941003    1C     *IN30         IFEQ      *ON
060180020213     c                   call      'TRUL19R'
060190020130     c                   parm                    codtab            2
060200020305     c                   parm      '1'           ordina            1
060210020130     c                   parm                    keytab            8
060220020130     c                   parm                    cmd               1
060230020130     C                   MOVEL     keytab        WNAR
060240940824     C                   GOTO      ENDCNA
060250941003    1C                   ENDIF
060260940824     C* CONTROLLO
060270940920     C                   MOVEL(P)  WNAR          KEY
060280940824     C*
060290940824     C                   EXSR      CTABEL
060300940824     C*
060310941003    1C     *IN30         IFEQ      *ON
060320940824     C                   MOVEL     ERR(28)       VIDMSG
060330940920     C                   SETON                                        6890
060340940824     C                   GOTO      ENDCNA
060350941003    1C                   ENDIF
060360941003     C*
060370941003     C                   MOVEL     TBLUNI        DS15
060380940907     C*
060390940825     C     ENDCNA        TAG
060400940825     C   90              MOVEL     '1'           WEMFOR
060410940825     C                   ENDSR
060420940824     C*
060430940824     C* CONTROLLO LINEA DI PARTENZA ---------------------------------*
060440940824     C     CTRLNP        BEGSR
060450940824     C*
060460940824    1C     SAVLNP        IFNE      WLNP
060470981007     C     BLPDSP        ORNE      SAVDSP
060480000518     C* RICNTROLLO SE BOLLA IMPORT DPD MA INDICATORE RELATIVO SPENTO
060490020319     C     §OGNTW        OREQ      'DPD'
060500000518     C     *IN79         ANDEQ     *OFF
060510940824     C* CONTROLLO CHE SIA GESTIBILE
060520070807     c                   if        simtpp='2' or simtpp=*blanks
060530070807     C     WLNP          LOOKUP    L6                                     30
060540070807     c                   else
060550940824     C     WLNP          LOOKUP    L1                                     30
060560070807     c                   endif
060570940928    2C     *IN30         IFEQ      *OFF
060580940824     C                   MOVEL     ERR(8)        VIDMSG
060590940920     C                   SETON                                        9045
060600940824     C                   GOTO      ENDCLP
060610940928    2C                   ENDIF
060620941230     C*
060630940824     C                   Z-ADD     WLNP          W0030             3 0
060640940824     C     W0030         CHAIN     AZORG01L      UNIORG               30
060650940928    2C     *IN30         IFEQ      *ON
060660940921     C     *IN30         OREQ      *OFF
060670940921     C     ORGFVA        ANDNE     *BLANKS
060680940824     C                   MOVEL     ERR(8)        VIDMSG
060690940920     C                   SETON                                        9045
060700940824     C                   GOTO      ENDCLP
060710940928    2C                   ENDIF
060720971211     C**
060730971211     C* MEMORIZZO IL CAPO SDI E SE E' ESTERO
060740000121     C*
060750991130      * DATI DPD: SE LNP DPD PROTEGGO SEMPRE RMA E SE LA SIGLA OPERATORE
060760991130      *           È UNA DI QUELLE PROTETTE, *IN13 = *ON, ANCHE RMN
060770991117     C                   MOVEL     ORGDE3        OG143
060780020319     C     §OGNTW        COMP      'DPD'                                  79
060790940824     C*
060800940824     C* PRENDO TERMINAL PARTENZA LINEA DI PARTENZA
060810970925     C                   CLEAR                   DSLV55
060820970925     C                   MOVEL     'P'           D55TPT
060830970925     C                   MOVEL     W0030         D55LIN
060840970925     C                   MOVEL     BLPDSP        D55DRF
060850970925     C                   CALL      'FNLV55R'
060860970925     C                   PARM                    DSLV55
060870970925     C     D55ERR        IFEQ      ' '
060880970925     C                   MOVEL     D55TFP        COMTFP            3 0
060890970925     C                   ELSE
060900001024     C                   MOVEL     ERR(211)      VIDMSG
060910001024     C                   SETON                                        9045
060920001024     C                   GOTO      ENDCLP
060930970925     C                   ENDIF
060940940824     C*
060950940824     C* PRENDO COD TRATTAMENTO MERCE DI DFT DELLA LINEA DI PARTENZA
060960940824     C                   MOVEL     '3G'          COD
060970940920     C                   MOVEL(P)  WLNP          KEY
060980940824     C*
060990940824     C                   EXSR      CTABEL
061000940824     C  N30              MOVEL     TBLUNI        COMCTM
061010940824     C   30              MOVEL     '  '          COMCTM
061020940824     C*
061030990610     C* CAMBIATA LNP: CONTROLLO IL CLIENTE ANCHE SE PERSONALIZZATO
061040990610     C                   MOVEL     'S'           WCOCCM            1
061050010219     C* RICHIAMO ROUTINE CHE DETERMINA SE LINEA CON PROC. ORM ATTIVATA
061060010219     C     SAVLNP        IFNE      WLNP
061070010219     C                   Z-ADD     WLNP          WLNPO
061080010219     C                   EXSR      ATTORM
061090011122     C* Se cambiata lnp devo ricordarmi di eseguire il controllo O.R.M.
061100011122     C* anche se è stato personalizzato
061110011122     C     WORM          IFEQ      'S'
061120011122     C                   MOVEL     '1'           WCKORM            1
061130011122     C                   ENDIF
061140010219     C                   ENDIF
061150010219     C                   MOVEL     WLNP          SAVLNP
061160010219     C                   MOVEL     BLPDSP        SAVDSP
061170990610     C                   ENDIF
061180940824     C     ENDCLP        ENDSR
061190940824     C*
061200010212     C* CONTROLLO NUMERO O.R.M. -------------------------------------*
061210010212     C     CTRORM        BEGSR
061220010305     C     §LPFPR        IFEQ      'O'
061230010305     C                   CLEAR                   FLGFIT
061240010305     C                   ENDIF
061250011122     C* SOLO SE NON È STATO PERSONALIZZATO
061260011122     C* DEVO PERO' RICONTROLARE SEMPRE IN CASO DI VARIAZIONE DELLA LINE
061270011122     C* DI PARTENZA
061280010222    0C     *IN37         IFEQ      *OFF
061290010305     C     §LPFPR        ANDNE     'O'
061300011122     C     WCKORM        OREQ      '1'
061310010212     C                   CLEAR                   FLGFIT
061320060522     C                   CLEAR                   w_pogest
061330061124     c                   clear                   wforpf
061340010212     C* ERRORE SE NUMERO ORM = 0
061350010223    1C     WIDOR1        IFEQ      *ZEROS
061360010212     C                   MOVEL     ERR(216)      VIDMSG
061370010212     C                   SETON                                        90
061380010215    2C     WPERSO        IFEQ      'P'
061390040901     C                   Z-ADD     05            H0RIGA
061400040909     C                   Z-ADD     20            H0COLO
061410010213     C                   ELSE
061420040901     C                   Z-ADD     06            H1RIGA
061430040909     C                   Z-ADD     20            H1COLO
061440010215    2C                   ENDIF
061450010212     C                   GOTO      ENDORM
061460010212    1C                   ENDIF
061470010212     C*
061480070620     c* in manutenzione di un prepagato non si può variare il n.orm
061490070620     c                   if        *in12='1' and *in15='0' and *in22
061500070620     c                             and widorm<>s_§b4orm
061510070620     C                   SETON                                        90
061520070620     C                   MOVEL     ERR(312)      VIDMSG
061530070620     C                   SETON                                        90
061540070620    3C     WPERSO        IFEQ      'P'
061550070620     C                   Z-ADD     05            H0RIGA
061560070620     C                   Z-ADD     20            H0COLO
061570070620     C                   ELSE
061580070620     C                   Z-ADD     06            H1RIGA
061590070620     C                   Z-ADD     20            H1COLO
061600070620    3C                   ENDIF
061610070620     C                   GOTO      ENDORM
061620070620     c                   endif
061630040322      * ORM reale
061640040322if  1c                   If        widor1 <> wofit
061650010924     C                   CLEAR                   DORM01
061660010212     C     KORM          CHAIN     FNORM01L                           30
061670010924     C  N30              MOVEL     ORMFLO        DORM01
061680040322     c* se non trovato errore
061690040322    2C     *IN30         IFEQ      *ON
061700010212     C                   MOVEL     ERR(217)      VIDMSG
061710010212     C                   SETON                                        90
061720010215    3C     WPERSO        IFEQ      'P'
061730040901     C                   Z-ADD     05            H0RIGA
061740040909     C                   Z-ADD     20            H0COLO
061750010213     C                   ELSE
061760040901     C                   Z-ADD     06            H1RIGA
061770040909     C                   Z-ADD     20            H1COLO
061780010215    3C                   ENDIF
061790010212     C                   GOTO      ENDORM
061800040322    2C                   ENDIF
061810100319     c
061820100319     c* Verifico se esiste FNORE
061830100319     c*  sempre se cambiato ORM oppure se non c'è la N di IGNORARE
061840100319    2C     WIDORM        IFNE      W01ORM
061850100319     c     wesore        orne      'N'
061860100319     c                   clear                   wesore
061870100319     c                   clear                   DoreGEN
061880100319     C     KORME         CHAIN     FNORE01L                           30
061890100319     c                   if        %found(fnore01l)
061900100319     C                   MOVEL     OReDati       DOReGEN
061910100319     C                   Z-ADD     1             C
061920100319     C     §oretsp       LOOKUP    TSP(C)                                 30
061930100319    4c                   if        *in30 and uts(c)='S'
061940100319     c                   eval      WEsORE='S'
061950100319     c                   endif
061960100319     c                   endif
061970100319     c                   endif
061980040322      * ORM fittizzio
061990040322   x1c                   Else
062000100322     c                   clear                   wesore
062010100322     c                   clear                   DoreGEN
062020040322      * memorizzo
062030010212     C                   MOVEL     'S'           FLGFIT            1
062040011121     C                   CLEAR                   ATRDES
062050100319     C* devo anche pulire i campi del destinatario solo se il
062060011205     C* precedente orm prevedeva la forzatura del destinatario
062070011205     C     SORMFD        IFEQ      'S'
062080011205     C                   CLEAR                   VIDRSD
062090011205     C                   CLEAR                   VIDIND
062100011205     C                   CLEAR                   VIDCAD
062110011205     C                   CLEAR                   VIDLOD
062120011205     C                   CLEAR                   VIDPRD
062130011205     C                   CLEAR                   VIDNZD
062140011205     C                   CLEAR                   SORMFD
062150011205     C                   ENDIF
062160010212    1C                   ENDIF
062170051207     c
062180051207     c                   clear                   vidmsg
062190010212     C* eseguo i seguenti controlli solo se orm non fittizio
062200010215    1C     FLGFIT        IFEQ      *BLANKS
062210010409     C* ERRORE SE O.R.M. ANNULLATO
062220010409    2C     ORMATB        IFNE      *BLANKS
062230010409     C                   MOVEL     ERR(228)      VIDMSG
062240010409   X2C                   ELSE
062250010212     C* ERRORE SE P.O. RITIRO DIVERSO DA LINEA DI PARTENZA BOLLA
062260010409    3C     ORMPOR        IFNE      WOLNP
062270060522     c* verifico se p.o. ritiro gestito dalla lnp bolla
062280060522     c* perchè in tal caso non devo dare errore se p.o. ritiro <> da
062290060522     c* lnp bolla
062300060522     c                   clear                   dslv55
062310060522     c                   eval      d55tpt = '6'
062320060522     c                   z-add     ormpor        d55lin
062330060522     c                   z-add     blpdsp        d55drf
062340060522     c                   call      'FNLV55R'
062350060522     c                   parm                    dslv55
062360060522     c                   if        d55err <> *blanks or d55tfa <> wolnp
062370051207     c* Verifico se si tratta di dati edi trasferiti: in questo caso
062380051206     c*  non do errore
062390051206     c                   clear                   tntb50ds
062400051206     C                   move      VIDCCM        b50ke2
062410051206     C*
062420051206    3C     VIDFLC        IFEQ      0
062430051206     C                   MOVEL     VIDLNP        b50ke2
062440051206     C                   ELSE
062450051206     C                   MOVEL     VIDFLC        b50ke2
062460051206    3C                   ENDIF
062470051206     c
062480051206     c                   movel     b50ke2        b50ke1
062490051207     c* controllo linea e p.o. orm
062500051207     c                   movel     'O'           b50opz
062510051207     c                   movel     ormpor        b50ormreso
062520051206     c                   movel     wolnp         b50poa
062530051206     c                   call      'TNTB51R'
062540051206     c                   parm                    kpjba
062550051206     c                   parm                    tntb50ds
062560051206     c
062570051206     c                   if        b50err<>' '
062580081215     c* po ritiro orm diverso da lnp vanno bene per dpd purchè entrambi
062590081215     c* i network siano dpd
062600081215     c                   clear                   ntwpor
062610081215     c                   if        §ogntw='DPD'
062620081215     C     ORMPOr        CHAIN     AZORG01L      UNIORG
062630081215     C                   MOVEL     OG143         SAV143
062640081215     C                   MOVEL     ORGDE3        OG143
062650081215     c                   movel     §ogntw        ntwpor
062660081215     C                   MOVEL     SAV143        OG143
062670081215     c                   endif
062680081215     c                   if        §ogntw<>'DPD' or ntwpor<>'DPD'
062690010212     C                   MOVEL     ERR(218)      VIDMSG
062700081215     c                   endif
062710010409    3C                   ENDIF
062720060522     c                   else
062730060522     c*se p.o. ritiro gestito da lnp bolla memorizzo
062740060522     c                   z-add     d55tfa        w_pogest
062750060522    3C                   ENDIF
062760051206    3C                   ENDIF
062770070529     c* verifico se p.o. ritiro abilitato allo scarico dei PDA
062780070606     c* cerco la capofila del p.o. ritiro
062790070606     c                   clear                   dslv55
062800070606     c                   z-add     ormpor        d55lin
062810070606     c                   movel     '6'           d55tpt
062820070606     c                   z-add     ormddc        d55drf
062830070606     c                   call      'FNLV55R'
062840070606     c                   parm                    dslv55
062850070606     c     d55tfa        chain     azorg01l      uniorg
062860070529     c                   if        %found(azorg01l)
062870070529     C                   MOVEL     ORGDE8        OG148
062880070529     c                   else
062890070529     c                   clear                   og148
062900070529     c                   endif
062910070529     c                   movel     §ogpdaorm     s_§ogpdaorm
062920070606     c* memorizzo il p.o. gestore del p.o. ritiro per eventuali ricerche su
062930070606     c* tab "PDO"
062940080111     c****               z-add     d55tfa        g_ormpor
062950010409    2C                   ENDIF
062960051206     c
062970051207    2C**   ORMATB        IFNE      *BLANKS
062980051207     C**   ORMPOR        ORNE      WOLNP
062990051207     c* Visto che in un caso p.o. ritiro <> da linea bolla va bene, tes
063000051207     c*  to il campo messaggio
063010051207     c                   if        vidmsg<>*blanks
063020010212     C                   SETON                                        90
063030010215    3C     WPERSO        IFEQ      'P'
063040040901     C                   Z-ADD     05            H0RIGA
063050040909     C                   Z-ADD     20            H0COLO
063060010213     C                   ELSE
063070040901     C                   Z-ADD     06            H1RIGA
063080040909     C                   Z-ADD     20            H1COLO
063090010215    3C                   ENDIF
063100010212     C                   GOTO      ENDORM
063110010215    2C                   ENDIF
063120010216     C* CMD14 - VISUALIZZA ORM
063130010223     C     *INKH         IFEQ      *ON
063140010216     C                   CLEAR                   FIOR07
063150010216     C                   Z-ADD     WOPOE         D07POE
063160010222     C                   Z-ADD     WONSR         D07NSR
063170010222     C                   Z-ADD     WONOR2        D07NOR
063180010216     C                   Z-ADD     WONRV         D07NRV
063190020513     c     simtpp        ifeq      '2'
063200020513     c     simtpp        oreq      *blanks
063210020513     c                   move      simpou        d07fgs
063220010216     C                   ELSE
063230010216     C                   Z-ADD     SIMFEL        D07FGS
063240010216     C                   ENDIF
063250010216     C                   MOVEL     FIOR07        KPJBU
063260010216     C                   CALL      'FIOR07R'
063270010216     C                   PARM                    KPJBA
063280010227     C                   MOVEL     '1'           WEMFOR
063290010216     C                   GOTO      ENDORM
063300010216     C                   ENDIF
063310010214     C* SE NON SONO NEL GIRO DEI PREPAGATI ORMTOR DEVE ESSERE DIVERSO
063320010214     C* DA "P"
063330010215    2C     *IN22         IFEQ      *OFF
063340010214     C     ORMTOR        ANDEQ     'P'
063350010214     C                   MOVEL     ERR(222)      VIDMSG
063360010214     C                   SETON                                        90
063370010215    3C     WPERSO        IFEQ      'P'
063380040901     C                   Z-ADD     05            H0RIGA
063390040909     C                   Z-ADD     20            H0COLO
063400010214     C                   ELSE
063410040901     C                   Z-ADD     06            H1RIGA
063420040909     C                   Z-ADD     20            H1COLO
063430010215    3C                   ENDIF
063440010503     C                   GOTO      ENDORM
063450010215    2C                   ENDIF
063460010214     C* VICEVERSA DEVE ESSERE = "P"
063470010215    2C     *IN22         IFEQ      *ON
063480010214     C     ORMTOR        ANDNE     'P'
063490010214     C                   MOVEL     ERR(223)      VIDMSG
063500010214     C                   SETON                                        90
063510010215    3C     WPERSO        IFEQ      'P'
063520040901     C                   Z-ADD     05            H0RIGA
063530040909     C                   Z-ADD     20            H0COLO
063540010214     C                   ELSE
063550040901     C                   Z-ADD     06            H1RIGA
063560040909     C                   Z-ADD     20            H1COLO
063570010215    3C                   ENDIF
063580010503     C                   GOTO      ENDORM
063590010215    2C                   ENDIF
063600100319     c
063610100319     c* Se presente LINEA DI ARRIVO personalizzata e  <> dall'ORM
063620100319     c*  oppure disk B --> erore bloccante
063630100319    2c                   if         not *in12 or not *in15
063640100319    3c                   if         ormpoc>0
063650100319     c
063660100319    4c                   if        (vidlna>*zeros  and *in20 )
063670100319     c                             or (*in12 and not *in15 and §1bfg6='C')
063680100319     c                   movel     vidlna        w0030
063690100319    5c                   if        w0030<>ormpoc
063700100319     C                   MOVEL     ERR(73)       VIDMSG
063710100319     C                   SETON                                        90
063720100319    6C     WPERSO        IFEQ      'P'
063730100319     C                   Z-ADD     05            H0RIGA
063740100319     C                   Z-ADD     20            H0COLO
063750100319     C                   ELSE
063760100319     C                   Z-ADD     06            H1RIGA
063770100319     C                   Z-ADD     20            H1COLO
063780100319    6C                   ENDIF
063790100319     C                   GOTO      ENDORM
063800100319    5C                   ENDIF
063810100319    4C                   ENDIF
063820100319    3C                   ENDIF
063830100319     c
063840100319     c* Se presente FNORE e TSP personalizzato <> dall'ORM
063850100319     c*  errore bloccante
063860100319    3c                   if        wesORE='S'
063870100319    4c                   if        (vidtsp<>' '    and *in18) or
063880100319     c                             (*in12 and not *in15 and §1bfg6='C')
063890100319
063900100319    5c                   if        vidtsp<>§oretsp
063910100319     C                   MOVEL     ERR(71)       VIDMSG
063920100319     C                   SETON                                        90
063930100319    6C     WPERSO        IFEQ      'P'
063940100319     C                   Z-ADD     05            H0RIGA
063950100319     C                   Z-ADD     20            H0COLO
063960100319     C                   ELSE
063970100319     C                   Z-ADD     06            H1RIGA
063980100319     C                   Z-ADD     20            H1COLO
063990100319    6C                   ENDIF
064000100319     C                   GOTO      ENDORM
064010100319    5C                   ENDIF
064020100319    4C                   ENDIF
064030100319    3C                   ENDIF
064040100319    2C                   ENDIF
064050100319     c
064060030805      * controllo la serie dell'ORM, se inserita deve esistere la key
064070030805      * poe + nrs in tab. 'OSR'
064080130116      * dal 16/01/2013 non è più così
064090130116      * la tabella OSR la leggo per cliente ORDINANTE dell'ORM
064100130116      * controllare solo la serie dell'ORM immessa è inutile
064110130116      * l'importante è che esista l'ORM
064120130117If  2c                   If        wonsr > *Zeros
064130130117      /free
064140130117       //?Non faccio controlli se OK orm RC, l'orm è stato controllato
064150130117       //?prima e se è un ORM con serie i controlli sono già stati fatti
064160130117       //?all'immissione dell'ORM
064170130117       //?qua devo solo recuperare i dati dalla tabella OSR
064180130117       //?la tabella la devo agganciare per cliente ordinante dell'ORM
064190130117       //?(solo i primi 7 caratteri del campo ORMCOR)
064200130117         clear dOSR;
064210130117         wORMcor = %dec(%subst(%editc(ORMcor:'X'):1:7):7:0);
064220130117         osrxx = %lookup(wORMcor:skCLIosr);
064230130117         IF  osrxx > 0;
064240130117         //?aggancio tabella OSR per recupero dati x ORM da tabella
064250130117           clear dsbs02;
064260130117           T02mod = 'C';
064270130117           T02cod = 'OSR';
064280130117           T02ke1 = skLNPNRSosr(osrxx);
064290130117           tibs02r(kpjba:dsbs02);
064300130117           IF  T02err = *blank;
064310130117             dOSR = T02uni;
064320130117           ENDIF;
064330130117         ENDIF;
064340130117      /end-free
064350130117
064360130116     c**!!!              Clear                   dOsr
064370130116     c**!!!              Clear                   dsbs02
064380130116     c**!!!              Clear                   wkosr
064390130116     c**!!!              Eval      T02Mod = 'C'
064400130116     c**!!!              Eval      T02Sif = Knsif
064410130116     c**!!!              Eval      T02Cod = 'OSR'
064420130116     c**!!!              Movel     wopoe         wkosr
064430130116     c**!!!              Move      wonsr         wkosr
064440130116     c**!!!              Movel(p)  wkosr         T02Ke1
064450130116     c**!!!              Call      'TIBS02R'
064460130116     c**!!!              Parm                    Kpjba
064470130116     c**!!!              Parm                    Dsbs02
064480130116If  3c**!!!              If        T02Err <> *Blanks
064490130116If  4C**!!!              If        wperso = 'P'
064500130116     c**!!!              Z-Add     05            H0riga
064510130116     c**!!!              Z-Add     20            H0colo
064520130116   x4c**!!!              Else
064530130116     c**!!!              Z-Add     06            H1riga
064540130116     c**!!!              Z-Add     20            H1colo
064550130116    4c**!!!              EndIf
064560130116     c**!!!              Eval      VidMsg = Err(48)
064570130116     c**!!!              Move      wonsr         w002a
064580130116     c**!!!              Eval      %subst(VidMsg:11:2) = w002a
064590130116     c**!!!              Eval      *In90 = *On
064600130116     c**!!!              GoTo      EndOrm
064610130116    3c**!!!              EndIf
064620130116     c**!!!              Movel     T02Uni        dOsr
064630030805      * se non inserito dall'utente imposto il codice bolla
064640030805If  3C                   If        wperso = 'P'
064650030805If  4c                   If        V0cCbo = *Blanks
064660030805     c                   Eval      V0cCbo = d§OsrCbo
064670030805    4c                   EndIf
064680030805   x3c                   Else
064690030805If  4c                   If        VidCbo = *Blanks
064700030805     c                   Eval      VidCbo = d§OsrCbo
064710030805    4c                   EndIf
064720030805    3c                   EndIf
064730030805    2c                   EndIf
064740010404     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
064750010404     C* ANDRO' A PROPORRE NELLE NOTE
064760050211     C***  ORMPOE        IFNE      ORMPOR
064770050211     C***  'TEL.:'       CAT       ORMTER        W021A            21
064780050211     C***  W021A         CAT(P)    ORMRER:1      WTELRF           70
064790050211     C***                MOVE      WTELRF        WTELR2           35
064800050211     C***                ENDIF
064810010212     C* L'ORM DEVE ESSERE IN UNA FASE BOLLETTABILE
064820010212     c* Errore forzabile
064830010220    2C     ORMFAO        IFNE      PREFAO
064840010220     C                   MOVE      ORMFAO        PREFAO
064850010220     C                   CLEAR                   DSBS02
064860010220     C                   MOVEL     'C'           T02MOD
064870010220     C                   MOVEL     KNSIF         T02SIF
064880010220     C                   MOVEL     'FAR'         T02COD
064890010220     C                   MOVEL     ORMFAO        T02KE1
064900010220      *
064910010220     C                   CALL      'TIBS02R'
064920010220     C                   PARM                    KPJBA
064930010220     C                   PARM                    DSBS02
064940010220    3C     T02ERR        IFEQ      *BLANKS
064950010220     C                   MOVEL     T02UNI        DFAR
064960010220     C                   ELSE
064970010220     C                   CLEAR                   DFAR
064980010220    3C                   ENDIF
064990010220    2C                   ENDIF
065000010620     C* Se fase 999: errore bloccante
065010010620     C     §FARFB        IFEQ      'N'
065020050504     c     §lpfpr        andne     'O'
065030010620     C                   MOVEL     ERR(219)      VIDMSG
065040010620     C                   MOVE      *BLANKS       BLANK            45
065050010620     C                   MOVE      BLANK         VIDMSG
065060010620     C                   SETON                                        90
065070010620    4C     WPERSO        IFEQ      'P'
065080040901     C                   Z-ADD     05            H0RIGA
065090040909     C                   Z-ADD     20            H0COLO
065100010620     C                   ELSE
065110040901     C                   Z-ADD     06            H1RIGA
065120040909     C                   Z-ADD     20            H1COLO
065130010620    4C                   ENDIF
065140010620     C                   GOTO      ENDORM
065150010620     C                   ENDIF
065160010220     C*
065170010215    2C     WIDORM        IFNE      W01ORM
065180010223     C                   CLEAR                   WOVUO
065190070427     C                   CLEAR                   WOVUO1
065200070918     C                   CLEAR                   savdrt
065210010226     C                   MOVEL     'S'           CHGORM            1
065220090327     C                   MOVEL     'S'           CHGORM1           1
065230091120     C                   MOVEL     'S'           CHGORM2           1
065240090327     c                   clear                   w_fcli            1
065250031001     c                   Clear                   wfortbo
065260010215     C* Se sono in manutenzione memorizzo che è cambiato il numero
065270010215     C* O.R.M. (Mi serve nelle routine che propongono i campi da orm
065280010215     C* che se in manutenzione devo proporre solo se modificato n. orm)
065290010215    3C     *IN12         IFEQ      *ON
065300010215     C     *IN15         ANDEQ     *OFF
065310010215     C                   MOVEL     '1'           WORMMD            1
065320010215    3C                   ENDIF
065330010214     C* Quando cambia il numero O.R.M. devo pulire i campi per la forza
065340010214     C* tura usati nella routine di controllo congruenza con campi dell
065350010214     c* O.R.M.
065360090326     C                   CLEAR                   PREDRT
065370010214     C                   CLEAR                   PREPDR
065380010214     C                   CLEAR                   PREFPP
065390010214     C                   CLEAR                   PRECCM
065400010214     C                   CLEAR                   PREFFD
065410010214     C                   CLEAR                   PRECTR
065420010504     C* Pulisco anche campo per forzatura su n. O.R.M.
065430010504     C                   CLEAR                   WFORZO
065440070905     c                   clear                   s_drt
065450070905     c                   if        wperso='P'
065460070905     c                   movel     nodi          at0daorm
065470070905     c                   else
065480070905     c                   movel     nodi          atrdaorm
065490070905     c                   endif
065500011122     C* A cambio numero O.R.M. devo anche reimpostare la lna + FLAG DPD
065510111124     c* e clearo i campi note da orm
065520011122    3C     *IN12         IFEQ      *OFF
065530011122     C     *IN15         OREQ      *OFF
065540111124     c                   clear                   vidno1
065550111124     c                   clear                   vidno2
065560111128     c                   clear                   viddno
065570011122     C                   CLEAR                   VIDDPD
065580070214     c* in manutenzione e lna dpd o fedex non la clearo altrimenti non
065590070214     c* è possibile reinstradarla a dpd/fedex
065600070214    4C     ORMPOC        IFEQ      *ZEROS
065610070214     c                   if        *in12='0' or (savntw<>'DPD' and savntw<>
065620070214     c                             'FED')
065630011122     C                   CLEAR                   VIDLNA
065640070214     c                   endif
065650011122     C* SE LNA PERSONALIZZATA DEVO IMPOSTARE QUESTA
065660011122    5C     *IN20         IFEQ      *ON
065670011122     C                   MOVE      V0CLNA        VIDLNA
065680011122    5C                   ENDIF
065690011122    4C                   ENDIF
065700011122     C* Sempre a cmabio di O.R.M. devo anche pulire i campi del desti-
065710011205     C* natario solo se il precedente orm prevedeva la forzatura del
065720011205     C* destinatario
065730011205     C     SORMFD        IFEQ      'S'
065740011122     C                   CLEAR                   VIDRSD
065750011122     C                   CLEAR                   VIDIND
065760011122     C                   CLEAR                   VIDCAD
065770011122     C                   CLEAR                   VIDLOD
065780011122     C                   CLEAR                   VIDPRD
065790011122     C                   CLEAR                   VIDNZD
065800011205     C                   CLEAR                   SORMFD
065810011205     C                   ENDIF
065820011122    3C                   ENDIF
065830010214     C*
065840011122     C                   MOVE      WIDORM        W01ORM
065850010215    3C     §FARFB        IFNE      'S'
065860050504     c     §lpfpr        andne     'O'
065870010212     C                   MOVEL     ERR(219)      VIDMSG
065880010212     C                   SETON                                        90
065890010215    4C     WPERSO        IFEQ      'P'
065900040901     C                   Z-ADD     05            H0RIGA
065910040909     C                   Z-ADD     20            H0COLO
065920010213     C                   ELSE
065930040901     C                   Z-ADD     06            H1RIGA
065940040909     C                   Z-ADD     20            H1COLO
065950010215    4C                   ENDIF
065960010212     C                   GOTO      ENDORM
065970010215    3C                   ENDIF
065980010212     C*
065990010215    2C                   ENDIF
066000010504     C* IN IMMISSIONE NON E' POSSIILE UTILIZZARE UN O.R.M. LE CUI BOLLE
066010010504     C* VENGONO TRASMESSE CON DISK
066020010504     C* ERRORE FORZABILE CON F20
066030010504    2C     *IN12         IFEQ      *OFF
066040010504     C* MEMORIZZO SE PREMUTO COMANDO PER FORZATURA
066050010504     C     *INKU         IFEQ      *ON
066060010504     C                   MOVEL     '1'           WFORZO            1
066070010504     C                   ENDIF
066080010924    3C     §ORMCB        IFEQ      'S'
066090010504     C     WFORZO        ANDEQ     *BLANKS
066100010504     C                   SETON                                        90
066110010504     C                   MOVEL     ERR(230)      VIDMSG
066120010504    4C     WPERSO        IFEQ      'P'
066130040901     C                   Z-ADD     05            H0RIGA
066140040909     C                   Z-ADD     20            H0COLO
066150010504     C                   ELSE
066160040901     C                   Z-ADD     06            H1RIGA
066170040909     C                   Z-ADD     20            H1COLO
066180010504    4C                   ENDIF
066190010504     C                   GOTO      ENDORM
066200010504    3C                   ENDIF
066210010504    2C                   ENDIF
066220011122     C* Proteggo i campi a video relativi il destinatario se devo forza
066230011122     C* re il destinatario da orm
066240011122     C     §ORMFD        IFEQ      'S'
066250011122     C                   MOVEL     PROT          ATRDES
066260011122     C                   ELSE
066270011122     C                   CLEAR                   ATRDES
066280011122     C                   ENDIF
066290090429
066300090429     c                   clear                   poentw
066310090429     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
066320090429     C                   MOVEL     OG143         SAV143
066330090429     C  N30              MOVEL     ORGDE3        OG143
066340090429     C   30              CLEAR                   OG143
066350090429     c                   eval      poentw=§ogntw
066360090429     C                   MOVEL     SAV143        OG143
066370090429
066380010227     C* SE ORM FITTIZIO E PREMUTO F8 DEVO RIEMETTERE LA VIDEATA
066390010227   X1C                   ELSE
066400040319      * imposto flag se sono in manutenzione ed ho modificato il n. ORM
066410040319if  2c                   If        *In12 and Not *In15 and
066420040319     c                             widorm <> w01orm
066430040319     C                   Eval      wmodorm = *On
066440040319e   2c                   EndIf
066450070829     c* a cambio numero orm devo mettere in ND la scritta
066460070829     c* eventuale "DA O.R.M."
066470070829     c                   if        widorm <> w01orm
066480090327     C                   MOVE      WIDORM        W01ORM
066490090327     C                   MOVEL     'S'           CHGORM1           1
066500091120     C                   MOVEL     'S'           CHGORM2           1
066510090327     c                   clear                   w_fcli
066520070918     c                   clear                   savdrt
066530070829     c                   if        wperso='P'
066540070829     c                   eval      at0daorm=nodi
066550070829     c                   else
066560070829     c                   eval      atrdaorm=nodi
066570070829     c                   endif
066580111124     c                   clear                   vidno1
066590111124     c                   clear                   vidno2
066600111128     c                   clear                   viddno
066610070829     c* solo in immissione: reimposto la data ritiro a udate se l'utente non
066620070829     c* l'ha variata
066630070829     c                   if        *in12='0' and viddrt<>wdtgio and viddrt>0
066640071107     c****                         and viddrt=s_drt  and dateu>=§vpodrt
066650071107     c                             and viddrt=s_drt
066660070831     c                   if        wperso='P'
066670070831     c                   clear                   viddrt
066680070831     c                   eval      s_drt=viddrt
066690070831     c                   else
066700070829     c                   eval      viddrt=wdtgio
066710070829     c                   eval      s_drt=wdtgio
066720070831     c                   endif
066730070829     c                   movel     '1'           wemfor
066740070829     c                   goto      endorm
066750070829     c                   endif
066760070904     c* Per ora non faccio il seguente controllo: se passo da un reale a un
066770070904     c* fittizio l'utente deve stare attento alla data ritiro.
066780070829     c* in manutenzione: se orm sulla bolla 999999 e data ritiro video<>da
066790070829     c* data ritiro bolla rimetto data ritiro bolla
066800070904     c*                  if        *in12 and *in15='0' and viddrt<>s_drtblp
066810070904     c*                  eval      viddrt=s_drtblp
066820070904     c*                  movel     '1'           wemfor
066830070904     c*                  goto      endorm
066840070904     c*                  endif
066850070829     c                   endif
066860040319
066870010227     C   KH              MOVEL     '1'           WEMFOR
066880010227     C   KH              GOTO      ENDORM
066890010215    1C                   ENDIF
066900010222     C* PERSONALIZZAZIONE
066910010222     C     WPERSO        IFEQ      'P'
066920010222     C                   SETON                                        37
066930010222     C                   ENDIF
066940011122     C  N90              CLEAR                   WCKORM
066950011205     C* Mi salvo il contenuto §ormfd per sapere se a cambio di O.R.M.
066960011205     C* devo pulire i dati del destinatario
066970090429     c                   clear                   sormfd
066980090429     c                   if        flgfit<>'S'
066990011205     C                   MOVE      §ORMFD        SORMFD
067000090429     c                   endif
067010010222   X0C                   ELSE
067020010226     C* SE PERSONALIZZATO GESTISCO EVENTUALE CMD08
067030010227     C* CMD8 - VISUALIZZA ORM
067040010223     C     *INKH         IFEQ      *ON
067050010227     C     FLGFIT        IFNE      'S'
067060010222     C                   CLEAR                   FIOR07
067070010222     C                   Z-ADD     WOPOE         D07POE
067080010222     C                   Z-ADD     WONSR         D07NSR
067090010222     C                   Z-ADD     WONOR2        D07NOR
067100010222     C                   Z-ADD     WONRV         D07NRV
067110070627     c     simtpp        ifeq      '2'
067120020513     c     simtpp        oreq      *blanks
067130020513     c                   move      simpou        d07fgs
067140010222     C                   ELSE
067150010222     C                   Z-ADD     SIMFEL        D07FGS
067160010222     C                   ENDIF
067170010222     C                   MOVEL     FIOR07        KPJBU
067180010222     C                   CALL      'FIOR07R'
067190010222     C                   PARM                    KPJBA
067200010226     C                   ENDIF
067210010227     C                   MOVEL     '1'           WEMFOR
067220010222     C                   GOTO      ENDORM
067230010222     C                   ENDIF
067240010222    0C                   ENDIF
067250090327     c* Se era stato impostato cliente/tariffa per tassazione porti assegnati
067260090327     c* verifico se emettere messaggio per avvisare che cambiando l'orm
067270090327     c* i dati verranno automaticamente modificati
067280091120    1c                   if        chgorm1='S' and *in04
067290090327    2c***                if        flgfit<>'S' and ormksc>0
067300090327    2c****                         and wcliksc>0 and atrwksc=*blanks
067310090327    3c***                if        w_fcli=' '
067320090327     c***                movel     '1'           w_fcli
067330090327     C***                MOVEL     ERR(321)      VIDMSG
067340090327     C***                SETON                                        90
067350090327     C***                GOTO      ENDORM
067360090327    3c***                endif
067370090327    2c****               endif
067380090327    2c                   if        (flgfit<>'S' and ormksc>0)
067390090327     c                             or atrwksc<>*blanks
067400090327     c                   exsr      sr_inzwdwcli
067410090327    2c                   endif
067420090327     c                   clear                   chgorm1
067430090327    1c                   endif
067440091120     c* a cambio di orm inzializzo window per scelta beneficiario c/a
067450091120    1c                   if        chgorm2='S'
067460091120     c                   exsr      inzwdwcas
067470091123     c                   clear                   chgorm2
067480091120     c                   endif
067490010212     C     ENDORM        ENDSR
067500010215     C*
067510010214     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA I° VIDEATA) -----------*
067520010215     C     PRPOR1        BEGSR
067530010212     C                   CLEAR                   WEFORM
067540070806     C*
067550070905     C* DATA RITIRO (SOLO SE ORM E' IN UNA FASE valida ai fini della da
067560070905     c* ta ritiro)
067570070905    2C     §LPFPR        ifne      'O'
067580070905     c                   exsr      fordrt
067590070905    2C                   ENDIF
067600111124     c* NOTE in visualizzazione
067610111124     c                   if        (ormno1<> *blanks or ormno2<>*blanks)
067620111124     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
067630120127     c                   movel     ormno1        vidno1
067640120127     c                   movel     ormno2        vidno2
067650120127     c                   movel     'NoteOrm'     viddno
067660120127     C                   MOVEL     '1'           WEFORM
067670111124     c                   endif
067680070806     c*
067690010215    1C     *IN12         IFEQ      *OFF
067700010220     C* In manutenzione propongo solo se variato il numero ORM
067710010215     C     *IN15         OREQ      *OFF
067720010220     C     WORMMD        ANDEQ     '1'
067730010215     C     *IN15         OREQ      *ON
067740010212     C*
067750040901     c*
067760050426     c*****              exsr      PRPOR1bis
067770010215     C*
067780010212     C* ATTENZIONE! SE SONO IN CONFERMA BOLLE DA DISCHETTO I SEGUENTI
067790010212     C* DATI NON LI DEVO PRENDERE DALL'ORM:
067800011121     C* (FANNO ECCEZIONE LE PROPOSTE DEL DESTINATARIO SE §ORMFD='S')
067810010212     C*
067820010212     C* CLIENTE MITTENTE
067830010215    2C     *IN12         IFEQ      *OFF
067840010212     C     *IN15         OREQ      *OFF
067850010215    3C     VIDCCM        IFEQ      *ZEROS
067860031201     c                   Eval      wnoccm = '1'
067870010215    4C     ORMKSC        IFGT      *ZEROS
067880010213     C                   MOVEL     '1'           WEFORM
067890030905      * Propongo il ksc dell'orm se l'ORM preve la bolla in porto franco
067900091020    5c     §OrPfb        Ifne      'A'
067910010212     C                   MOVE      ORMKSC        VIDCCM
067920010212     C                   MOVEL     ORMKSC        W0030             3 0
067930130212     C                   Z-ADD     W0030         VIDFLC
067940010215    6C     W0030         IFNE      VIDLNP
067950130212     C****               Z-ADD     W0030         VIDFLC
067960010302     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
067970010302     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
067980041129     C                   SETON                                        14
067990010215    6C                   ENDIF
068000010215   X5C                   ELSE
068010030905      * Propongo 9999 se l'orm prevede la bolla in porto assegnato
068020010212     C                   Z-ADD     9999          VIDCCM
068030010215    5C                   ENDIF
068040010214     C                   MOVE      VIDCCM        PRECCM
068050010214     C                   MOVEL     VIDFLC        PRECCM
068060010215    5C     VIDFLC        IFEQ      0
068070010214     C                   MOVEL     VIDLNP        PRECCM
068080010215    5C                   ENDIF
068090010215   X4C                   ELSE
068100030905      * se Ksc vuoto e l'orm prevede la bolla in porto franco propongo la
068110010214     C* RAGIONE SOCIALE NEL CAMPO DELLA RICERCA ALFABETICA
068120030905    5c     §OrPfb        Ifne      'A'
068130010215    6C     VIDDMT        IFEQ      *BLANKS
068140010215     C                   MOVEL     ORMRSR        VIDDMT
068150041129     C                   MOVEL     '1'           WEFORM
068160041129     C     VIDDMT        IFNE      *BLANKS
068170041129     C***                SETON                                        0138
068180041129     C                   SETON                                        01
068190041129     C                   ENDIF
068200010215    6C                   ENDIF
068210010328   X5C                   ELSE
068220030905      * se ksc vuoto e l'orm prevede la bolla in porto assegnato
068230030905      * PROPONGO 9999 IN CCM
068240010328     C                   Z-ADD     9999          VIDCCM
068250010328     C                   MOVEL     '1'           WEFORM
068260010215    5C                   ENDIF
068270010215    4C                   ENDIF
068280010215    3C                   ENDIF
068290011121    2C                   ENDIF
068300010212     C* DESTINATARIO (RAG SOC,INDIR....)
068310011121    2C     *IN12         IFEQ      *OFF
068320011121     C     *IN15         OREQ      *OFF
068330011121     C     *IN15         OREQ      *ON
068340011121     C     §ORMFD        ANDEQ     'S'
068350011121     C*
068360010215    3C     ORMTOR        IFEQ      'S'
068370010301     C     §LPFPR        OREQ      'O'
068380010215    4C     VIDRSD        IFEQ      *BLANKS
068390011122     C     ORMRSC        ANDNE     *BLANKS
068400011121     C     §ORMFD        OREQ      'S'
068410011122     C     ORMRSC        ANDNE     VIDRSD
068420010214     C                   MOVEL     '1'           WEFORM
068430010212     C                   MOVEL     ORMRSC        VIDRSD
068440010215    4C                   ENDIF
068450010215    4C     VIDIND        IFEQ      *BLANKS
068460011122     C     ORMINC        ANDNE     *BLANKS
068470011121     C     §ORMFD        OREQ      'S'
068480011122     C     ORMINC        ANDNE     VIDIND
068490010213     C                   MOVEL     '1'           WEFORM
068500010212     C                   MOVEL     ORMINC        VIDIND
068510010215    4C                   ENDIF
068520010215    4C     VIDCAD        IFEQ      *BLANKS
068530011122     C     ORMCAC        ANDNE     *BLANKS
068540011121     C     §ORMFD        OREQ      'S'
068550011122     C     ORMCAC        ANDNE     VIDCAD
068560010213     C                   MOVEL     '1'           WEFORM
068570010212     C                   MOVEL     ORMCAC        VIDCAD
068580010215    4C                   ENDIF
068590140211     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
068600140211     c* seguenti la località destinatario da ORM
068610140211     c                   clear                   ormloc_n
068620140211     c                   if        ormloc<>*blanks
068630140211     c                   eval      wtxt=ormloc
068640140211     c                   exsr      chkstringa
068650140211     c                   movel     wtxt          ormloc_n
068660140211     c                   endif
068670010215    4C     VIDLOD        IFEQ      *BLANKS
068680140211     C     ORMLOC_n      ANDNE     *BLANKS
068690011121     C     §ORMFD        OREQ      'S'
068700140211     C     ORMLOC_n      ANDNE     VIDLOD
068710010213     C                   MOVEL     '1'           WEFORM
068720140211     C                   MOVEL     ORMLOC_n      VIDLOD
068730010215    4C                   ENDIF
068740010216    4C     VIDPRD        IFEQ      *BLANKS
068750010216     C     ORMPRC        ANDNE     *BLANKS
068760010216     C     VIDCAD        ANDEQ     ORMCAC
068770010216     C     VIDCAD        ANDNE     *BLANKS
068780011121     C     §ORMFD        OREQ      'S'
068790011122     C     ORMPRC        ANDNE     VIDPRD
068800010216     C                   MOVEL     '1'           WEFORM
068810010216     C                   MOVEL     ORMPRC        VIDPRD
068820010216    4C                   ENDIF
068830010216    4C     VIDNZD        IFEQ      *BLANKS
068840010216     C     ORMNAC        ANDNE     *BLANKS
068850010216     C     VIDCAD        ANDEQ     ORMCAC
068860010216     C     VIDCAD        ANDNE     *BLANKS
068870011121     C     §ORMFD        OREQ      'S'
068880011122     C     ORMNAC        ANDNE     VIDNZD
068890010216     C                   MOVEL     '1'           WEFORM
068900010216     C                   MOVEL     ORMNAC        VIDNZD
068910010216    4C                   ENDIF
068920010215    3C                   ENDIF
068930011121    2C                   ENDIF
068940011121     C*
068950011121    2C     *IN12         IFEQ      *OFF
068960011121     C     *IN15         OREQ      *OFF
068970010212     C* LINEA DI ARRIVO
068980010214     C* La linea di arrivo se presente sull'orm deve sempre essere
068990010214     C* uguale a video quindi, se diversa, la forzo
069000010228     C* Il messaggio di errore lo emetto solo se lna a video > 0 e <> DA ORM
069010010215    3C     ORMPOC        IFGT      *ZEROS
069020010215    4C     VIDLNA        IFGT      *ZEROS
069030010215     C                   MOVE      VIDLNA        W0030
069040010215    5C     W0030         IFNE      ORMPOC
069050010213     C                   MOVEL     RIMM          ATRLNA
069060010213     C                   MOVEL     ERR(220)      VIDMSG
069070010216     C                   MOVEL     '1'           WEFORM
069080010216     C                   MOVE      ORMPOC        VIDLNA
069090010216     C                   SETON                                        9047
069100010215    5C                   ENDIF
069110010216   X4C                   ELSE
069120010216     C                   MOVEL     '1'           WEFORM
069130010216     C                   MOVE      ORMPOC        VIDLNA
069140010216    4C                   ENDIF
069150020204     C* SE LNA DPD DEVO IMPOSTARE 'D' NEL network
069160020207     C* SE LNA FEDEX DEVO IMPOSTARE 'F' NEL network
069170010214     C* SE SONO IM MANUTENZIONE NON LO DEVO FARE PERCHE' IN QUESTO
069180010214     C* CASO NON C'E' IL CAMPO VIDDPD
069190010215    4C     *IN12         IFEQ      *OFF
069200010215     C     ORMPOC        CHAIN     AZORG01L      UNIORG               30
069210010214     C                   MOVEL     OG143         SAV143
069220010214     C                   MOVEL     ORGDE3        OG143
069230020319    5C     §OGNTW        IFEQ      'DPD'
069240020204     C                   MOVEL     'D'           VIDDPD
069250020204     c                   else
069260020204     c     §ogntw        ifeq      'FED'
069270020204     c                   movel     'F'           viddpd
069280020204     c                   endif
069290010215    5C                   ENDIF
069300010214     C                   MOVEL     SAV143        OG143
069310010215    4C                   ENDIF
069320010215    3C                   ENDIF
069330010314     C* FERMO DEPOSITO  - RIEMETTO LA VIDEATA SOLO SE SU ORM E' = 'S'
069340010215    3C     VIDFFD        IFEQ      *BLANKS
069350010215    4C     ORMFFD        IFEQ      'S'
069360010213     C                   MOVE      'S'           VIDFFD
069370010314     C                   MOVEL     '1'           WEFORM
069380010213     C                   ELSE
069390010213     C                   MOVE      'N'           VIDFFD
069400010215    4C                   ENDIF
069410010214     C                   MOVE      VIDFFD        PREFFD
069420010215    3C                   ENDIF
069430100319     c*
069440100319     c* TIPO SERVIZIO da FNORE
069450100319     c*  come per la linea di arrivo, se diversa la cambio emettendo MSG
069460100319   3ac                   if        Wesore<>'N'
069470100319     c                   clear                   WesORE
069480100319     c                   clear                   DoreGEN
069490100319     c     korme         chain     fnore01l
069500100319    3c                   if        %found(fnore01l)
069510100319     c                   movel     oredati       doreGEN
069520100319     c                   eval      wesore='S'
069530100319     C                   Z-ADD     1             C
069540100319     C     §oretsp       LOOKUP    TSP(C)                                 30
069550100319    4c                   if        *in30 and uts(c)='S'
069560100319    5c                   if        vidtsp<>*blanks and
069570100319     c                             vidtsp<>§oretsp
069580100319     C                   MOVEL     RIMM          ATRtsp
069590100319     c* Se già impostato per la linea di arrivo --> uni msg
069600100319    6c                   if        vidmsg=err(220)
069610100319     C                   MOVEL     ERR(74)       VIDMSG
069620100319     c                   else
069630100319     C                   MOVEL     ERR(75)       VIDMSG
069640100319    6c                   endif
069650100319     c
069660100319     C                   MOVEL     '1'           WEFORM
069670100319     C                   SETON                                        9048
069680100319    5C                   ENDIF
069690100319     c
069700100319     c* Riemetto video anche se TSP vuoto
069710100319     c                   if        vidtsp=' '
069720100319     C                   MOVEL     '1'           WEFORM
069730100319     c                   endif
069740100319     C                   MOVE      §oretsp       VIDtsp
069750100319    4c                   endif
069760100319    3c                   endif
069770100319   3ac                   endif
069780100319     c
069790010215    2C                   ENDIF
069800010301     C* SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI DEVO PROPORRE
069810010301     C* ANCHE COLLI E PESO
069820010301     C     §LPFPR        IFEQ      'O'
069830010301     C     V1CNCL        IFEQ      *ZEROS
069840010301     C                   Z-ADD     ORMNCL        V1CNCL
069850010301     C                   MOVEL     '1'           WEFORM
069860010305     C                   Z-ADD     ORMNCL        PRENCL
069870010301     C                   ENDIF
069880010301     C     VIDPKG        IFEQ      *ZEROS
069890010301     C                   Z-ADD     ORMPKG        VIDPKG
069900010305     C                   Z-ADD     ORMPKG        PREPKG
069910010301     C                   MOVEL     '1'           WEFORM
069920010301     C                   ENDIF
069930010301     C                   ENDIF
069940061124     c*
069950061124     c                   if        wforpf='1'
069960061124     c                   eval      §orpfb='A'
069970061124     c                   clear                   wforpf
069980061124     c                   endif
069990031201
070000031201      * se non sono in conferma bolle da clienti
070010060428if  1c                   If        (Not *In12 or Not *In15) and
070020031201      * e l'ORM prevede:
070030031201      *               --> la bolla in porto Assegnato
070040031201      *               --> paga ordinante orm
070050031201      *               --> destinatario orm estero
070060031201      *               --> ordinante orm italia
070070060428      * n.b.:per sapere se destinatario estero nei casi in cui sull'orm
070080060428      *      non è indicato ma è indicato a video devo testare il contenuto
070090060428      *      di vidnzd (wdesie infatti è disponibile solo dopo che il pgm
070100060428      *      ha fatto i controlli del destinatario che vengono fatti dopo
070110060428      *      questo controllo). Anche se non è corretto testare vidnzd
070120060428      *      per sapere se nazione estera (è il flag §15ita che me lo dice)
070130060428      *      era l'unico modo per gestire la videata in maniera chiara
070140060428      *      per il bollettista effettuando la forzatura nel momento
070150060428      *      giusto anzichè dare altre segnalazioni di errore che con-
070160060428      *      fonderebbero sicuramente.
070170031201     c                             (§OrPfb = 'A' and OrmPag = 'O' and
070180060914     c                             (OrmNac<>*Blanks or vidnzd<>*blanks))
070190060914     c*
070200060914    2c                   if        ormnao <> *blanks
070210060914     c                   movel     ormcor        po_cor            3 0
070220060914     c                   clear                   w_ordntw          1
070230060914     c     po_cor        chain     azorg01l      uniorg
070240060914    3c                   if        %found(azorg01l)
070250060914     C                   MOVEL     OG143         SAV143
070260060914     c                   movel     orgde3        og143
070270060914    4c                   if        §ogntw = 'EEX' or §ogntw='DPD'
070280060914     c                             or  §ogntw='FED'
070290060914     c                   movel     'E'           w_ordntw
070300060914    4c                   endif
070310060914     C                   MOVEL     SAV143        OG143
070320060914    3c                   endif
070330060914    2c                   endif
070340060914    2c                   if        ormnao = *blanks or w_ordntw<>'E'
070350050622      **non era impostato vidccm
070360050622     c***                          wnoccm = '1'
070370060427     c                   exsr      sr_FOrmEst
070380060914    2c                   endif
070390031201    1c                   EndIf
070400031201
070410010301     C*
070420010213     C   90              MOVEL     '1'           WEMFOR
070430010215    2C  N90WEFORM        IFEQ      '1'
070440010213     C* SE SONO IN CONFERMA RICHIAMATA CON X O W NON DEVO RIEMETTERE
070450010213     C* LA VIDEATA PER VISUALIZZARE CAMPI DA ORM QUINDI PULISCO FLAG
070460010215    3C     §LPFPR        IFEQ      'V'
070470010213     C     *IN12         OREQ      *OFF
070480010213     C     *IN15         OREQ      *OFF
070490010213     C                   ELSE
070500010213     C                   CLEAR                   WEFORM
070510010215    3C                   ENDIF
070520010215    2C                   ENDIF
070530010215    1C                   ENDIF
070540040901     C                   ENDSR
070550070806     c***
070560070806     c* Forzatura data ritiro da orm ---------------------------------*
070570070806     c***
070580070806     c     fordrt        begsr
070590070905     c*
070600070806     C                   CLEAR                   WLBDAT
070610070806     C                   MOVEL     '3'           G02ERR
070620070806     c* se fase utilizzabile propongo la data della fase
070630070806    3C     d§fardar      ifeq      'S'
070640071112     c                   if        ormfao=400
070650071112     c                   z-add     ormddc        g02inv
070660071112     c                   else
070670070806     C                   Z-ADD     ORMDFO        G02INV
070680071112     c                   endif
070690070806   x3c                   else
070700070806     c* se l'orm non è in una fase utilizzabile per la data ritiro prendo
070710070806     c* la data ritiro presente sull'orm
070720070806     C                   Z-ADD     ORMDAR        G02INV
070730070806    3c                   endif
070740070806     c* se la data ritiro da proporre è maggiore della data odierna non
070750070905     c* propongo nulla. Non propongo la data anche se bolla import
070760070905    3c                   if        g02inv<=dateu and
070770081008     c                              §ogntw<>'EEX' and §ogntw<>'FED'
070780081008     c                              and §ogntw<>'DPD'
070790071107    4c***                if        viddrt= *zeros  or
070800071107     c****                          dateu>=§vpodrt
070810081008     c*                            (§ogntw<>'EEX' and §ogntw<>'FED'
070820081008     c*                             and §ogntw<>'DPD' and
070830070905     c*                             dateu>=§vpodrt)
070840070806     C                   CALL      'XSRDA8'
070850070806     C                   PARM                    WLBDAT
070860070905    5c                   if        g02dat<>viddrt
070870070806     c* se modificata data avviso con dicitura "DA ORM" blinking
070880070806    6c                   if        viddrt>0
070890070806     c                   if        wperso='P'
070900070806     c                   movel     blnk          at0daorm
070910070806     c                   else
070920070806     c                   movel     blnk          atrdaorm
070930070806     c                   endif
070940070806    6c                   endif
070950070905     C                   MOVEL     '1'           WEFORM            1
070960070806     C                   Z-ADD     G02DAT        VIDDRT
070970070806     C                   Z-ADD     VIDDRT        PREDRT
070980070806    5c                   endif
070990070918     C                   Z-ADD     G02DAT        s_drt
071000071107    4C****               ENDIF
071010070905   x3c                   else
071020070905     c* se non propongo la data perchè > data giorno o bolla import
071030070905     c* propongo udate
071040070918     c                   if        *in12='0'
071050070918     c                   if        viddrt=*zeros or
071060071107     c                             s_drt=0
071070071107     c****                         (dateu>=§vpodrt and s_drt=0)
071080070918     c****               if        s_drt=0 or (Dateu<§vpodrt and viddrt=0)
071090070918     c                   if        viddrt<>wdtgio
071100070918     C                   MOVEL     '1'           WEFORM            1
071110070918     c                   endif
071120070905     c                   z-add     wdtgio        viddrt
071130070905     c                   z-add     wdtgio        s_drt
071140070905     C                   Z-ADD     VIDDRT        PREDRT
071150070905     c                   endif
071160070918     c                   endif
071170070806    3C                   ENDIF
071180070806    cc                   endsr
071190040901     C*
071200040901     C* Proposta dati da orm - bis - Campi della prima videata ------*
071210060522     c* ATTENZIONE! Questa routine è al momento inutilizzata. Se diveni
071220060522     c* sse necessario riattivarla occorre rivederla in quanto non
071230060522     c* è sufficiete cercare la distinta con ormpor in quanto ormpor
071240060522     c* potrebbe essere un p.o. gestito ed in questo caso bisogna
071250060522     c* cercare la distinta della lnp bolla
071260120611     C**** PRPOR1bis     BEGSR
071270040901     C*
071280040901     C* PADRONCINO - LO DETERMINO DALLA DISTINTA
071290040901     C* IDEM FLAG MATTINO/POMERIGGIO
071300040901     C* Propongo il flag mattino/pomeriggio solo se non immesso e se il
071310040901     c* padroncino a video è uguale a quello della distinta
071320040901     C* Non propongo mai se richiamata da conferma prepagati
071330120611     C**** §LPFPR        IFNE      'O'
071340120611    2C**** ORMNDC        IFGT      *ZEROS
071350120611     C**** VIDPDR        ANDEQ     *ZEROS
071360120611     C**** *IN22         ANDEQ     *OFF
071370120611    2C**** ORMNDC        ORGT      *ZEROS
071380120611     C**** VIDPDR        ANDEQ     *BLANKS
071390120611     C**** *IN22         ANDEQ     *OFF
071400120611     C**** ORMNDC        ORGT      *ZEROS
071410120611     C**** VIDPDR        ANDEQ     '?   '
071420120611     C**** *IN22         ANDEQ     *OFF
071430120611     C**** ORMNDC        ORGT      *ZEROS
071440120611     C**** VIDFPP        ANDEQ     *BLANKS
071450120611     C**** *IN22         ANDEQ     *OFF
071460120611     c****
071470120611     C****               MOVE      ORMNDC        W0050             5 0
071480120611     C**** KDST          CHAIN     FIDST01L                           30
071490120611    3C**** *IN30         IFEQ      *OFF
071500120611    4C**** VIDPDR        IFEQ      *ZEROS
071510120611    4C**** VIDPDR        OREQ      *BLANKS
071520120611    4C**** VIDPDR        OREQ      '?   '
071530120611     C****               MOVE      DSTPDR        VIDPDR
071540120611     c****               clear                   v1dpdr
071550120611     C****               MOVE      DSTPDR        PREPDR
071560120611     C****               MOVEL     '1'           WEFORM
071570120611    4C****               ENDIF
071580120611     C****               MOVE      DSTPDR        WDPDR
071590120611    4C**** VIDPDR        IFEQ      WDPDR
071600120611     C**** VIDFPP        ANDEQ     *BLANKS
071610120611     C****               MOVE      ORMNDC        W0050
071620120611     C**** KFVV          CHAIN     FNFVV01L                           30
071630120611     C****               MOVE      FVVFPP        VIDFPP
071640120611     C****               MOVEL     FVVFPP        PREFPP
071650120611     C****               MOVEL     '1'           WEFORM
071660120611    4C****               ENDIF
071670120611    3C****               ENDIF
071680120611    2C****               ENDIF
071690120611     C****               ENDIF
071700120611     c****               ENDSR
071710010214     C*
071720010214     C* CONTROLLI DI CONGRUENZA CAMPI I°VIDEATA CON CAMPI DELL'ORM --*
071730010214     C     CNFOR1        BEGSR
071740050427     c                   clear                   wcaut            27
071750010214     C*
071760010214     C* I seguenti errori sono tutti forzabili e vengono effettuati
071770010214     C* solo se numero ORM non fittizio e se non sono in immissione
071780010214     C* dei miei prepagati perchè in questo caso l'ORM viene crato
071790010214     C* dopo l'immissione del prepagato
071800010214     C*
071810010215    1C     FLGFIT        IFNE      'S'
071820010214     C     PARTCH        ANDNE     'P'
071830010214     C*
071840010214     C*** DATA RITIRO ***
071850010214     C*
071860071107     c****               if        dateu<§vpodrt
071870071107    2C**** VIDDRT        IFGT      *ZEROS
071880071107     C**** §LPFPR        ANDNE     'O'
071890071107     C**** d§fardar      ANDEQ     'S'
071900071107     C**** VIDDRT        ANDNE     PREDRT
071910071107     C**** ORMDFO        ANDNE     COMDRT
071920071107     C****               MOVEL     RIMM          ATRDRT
071930071107     C****               Z-ADD     VIDDRT        PREDRT
071940071107     C****               SETON                                        90
071950071107    2C****               ENDIF
071960071107     c****               endif
071970040902     c                   exsr      CNFOR1bis
071980010214     C* I SEGUENTI CONTROLLI VENGONO FATTI SOLO SE NON SONO IN CONFERMA
071990010214     C* BOLLE DA DISCHETTO
072000010215    2C     *IN12         IFEQ      *OFF
072010010214     C     *IN15         OREQ      *OFF
072020010214     C*
072030010214     C** CODICE CLIENTE MITTENTE
072040010214     C*
072050010215    3C     VIDCCM        IFGT      *ZEROS
072060010214     C     ORMKSC        ANDGT     *ZEROS
072070010214     C                   MOVE      VIDCCM        WOCCM
072080010214     C                   MOVEL     VIDFLC        WOCCM
072090010215    4C     WOCCM         IFNE      PRECCM
072100010214     C                   Z-ADD     WOCCM         PRECCM
072110010215    5C     VIDFLC        IFEQ      *ZEROS
072120010214     C                   MOVEL     VIDLNP        WOCCM
072130010215    5C                   ENDIF
072140010215    5C     WOCCM         IFNE      ORMKSC
072150030905    6c                   If        §OrPfb <> 'A'
072160010214     C                   MOVEL     RIMM          ATRCCM
072170010214     C                   SETON                                        90
072180010215   X6C                   ELSE
072190030905    7c                   If        Vidccm <> 9999
072200010214     C                   MOVEL     RIMM          ATRCCM
072210010214     C                   SETON                                        90
072220010215    7C                   ENDIF
072230010215    6C                   ENDIF
072240010215    5C                   ENDIF
072250010215    4C                   ENDIF
072260010215    3C                   ENDIF
072270010214     C*
072280010214     C** FERMO DEPOSITO
072290010214     C*
072300010215     C     ORMFFD        IFEQ      ' '
072310010215     C                   MOVE      'N'           W001A             1
072320010215     C                   ELSE
072330010215     C                   MOVE      ORMFFD        W001A
072340010215     C                   ENDIF
072350010215    3C     VIDFFD        IFNE      W001A
072360010214     C     VIDFFD        ANDNE     PREFFD
072370010220     C                   MOVE      VIDFFD        PREFFD
072380010214     C                   MOVEL     RIMM          ATRFFD
072390010214     C                   SETON                                        90
072400010215    3C                   ENDIF
072410010305     C*
072420010305     C** COLLI E PESO ** SE SONO IN CONFERMA PREPAGATI DI ALTRI P.O.
072430010305     C*
072440010305    3C     §LPFPR        IFEQ      'O'
072450010305    4C     V1CNCL        IFNE      ORMNCL
072460010305     C     V1CNCL        ANDNE     PRENCL
072470010305     C                   Z-ADD     V1CNCL        PRENCL
072480010305     C                   MOVEL     RIMM          ATRNCL
072490010305     C                   SETON                                        90
072500010305    4C                   ENDIF
072510010305    4C     VIDPKG        IFNE      ORMPKG
072520010305     C     VIDPKG        ANDNE     PREPKG
072530010305     C                   Z-ADD     VIDPKG        PREPKG
072540010305     C                   MOVEL     RIMM          ATRPKG
072550010305     C                   SETON                                        90
072560010305    4C                   ENDIF
072570010305    3C                   ENDIF
072580010215    2C                   ENDIF
072590010214     C*
072600010214     C   90              MOVEL     ERR(221)      VIDMSG
072610010214     C   90              MOVEL     '1'           WEMFOR
072620050427     c   90              if        wcaut <> *blanks
072630050427     c                   move      wcaut         vidmsg
072640050427     c                   endif
072650010215    1C                   ENDIF
072660010214     C                   ENDSR
072670040902     C*
072680040902     C* CONTROLLI DI CONGRUENZA CAMPI PDR e FPP CON CAMPI DELL'ORM --*
072690040902     C     CNFOR1bis     BEGSR
072700040902     C*
072710040902     C**
072720040902     C* CODICE PADRONCINO + FLAG MATTINO/POMERIGGIO
072730040902     C**
072740040902    2C     ORMNDC        IFGT      *ZEROS
072750040902     C     VIDPDR        ANDGT     *ZEROS
072760040902     C     VIDPDR        ANDNE     PREPDR
072770070606     c                   exsr      sr_dst
072780040902     C                   MOVE      DSTPDR        WDPDR
072790040902    3C     WDPDR         IFNE      VIDPDR
072800050426     c**   atrpdr        ifne      prri
072810040902     C                   MOVEL     RIMM          ATRPDR
072820050426     c**                 endif
072830040902     C                   MOVE      VIDPDR        PREPDR
072840040902     C                   SETON                                        90
072850050427     c                   move      dstpdr        wadpdr            7
072860050427     c                   eval      wcaut = caut
072870050427     c                   eval      %subst(wcaut: 6: 7) = wadpdr
072880040902    3C                   ENDIF
072890040902    2C                   ENDIF
072900040902     C* Il flag mattino/pomeriggio lo controllo solo se il PDR è =
072910040902    2C     ORMNDC        IFGT      *ZEROS
072920040902     C     VIDPDR        ANDEQ     WDPDR
072930040902     C     VIDFPP        ANDNE     *BLANKS
072940040902     C     VIDFPP        ANDNE     PREFPP
072950040902     C                   MOVE      ORMNDC        W0050
072960060522     c                   if        w_pogest = *zeros
072970060522     c                   z-add     ormpor        kfgs
072980060522     c                   else
072990060522     c                   z-add     w_pogest      kfgs
073000060522     c                   endif
073010040902     C     KFVV          CHAIN     FNFVV01L                           30
073020040902    3C     FVVFPP        IFNE      VIDFPP
073030050426     c***  atrfpp        ifne      prri
073040040902     C                   MOVEL     RIMM          ATRFPP
073050050426     c***                endif
073060040902     C                   MOVE      VIDFPP        PREFPP
073070040902     C                   SETON                                        90
073080040902    3C                   ENDIF
073090040902    2C                   ENDIF
073100040902     c                   ENDSR
073110120611     c
073120120611     C* Ricerca codice autotrasportatore che ha eseguito l'orm ----------------
073130070606     C     sr_dst        BEGSR
073140120611     c
073150120611     C                   MOVE      ORMNDC        W0050
073160070606     c                   if        w_pogest = *zeros
073170070606     C                   z-add     ORMpor        kfgs
073180070606     c                   else
073190070606     c                   z-add     w_pogest      kfgs
073200070606     c                   endif
073210120611     C     KDST          CHAIN     FIDST01L                           30
073220070606     C   30              CLEAR                   DSTPDR
073230070606     c                   endsr
073240010215     C*
073250010215     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA II° VIDEATA) ----------*
073260010215     C     PRPOR2        BEGSR
073270010215     C                   CLEAR                   WEFORM
073280010215     C*
073290010215     C** MITTENTE (RAG.SOC.,INDIRIZZO...)
073300030912      * da mittente ORM se l'ORM prevede la bolla in porto assegnato
073310030912      * o se conferma ORM prepagati
073320010215     C*
073330030912    1c                   If        Not *In02 and
073340030923     c                             (VidCcm = 9999 or
073350030923     c                             (§LpFpr = 'O' and VidCcm = 8888))
073360010215    3C     WOVUO         IFEQ      *BLANKS
073370010215     C     VIDRSM        OREQ      *BLANKS
073380010215     C                   MOVEL     ORMRSR        VIDRSM
073390010215     C                   MOVEL     '1'           WEFORM
073400010215    3C                   ENDIF
073410010215    3C     WOVUO         IFEQ      *BLANKS
073420010215     C     VIDINM        OREQ      *BLANKS
073430010215     C                   MOVEL     ORMINR        VIDINM
073440010215     C                   MOVEL     '1'           WEFORM
073450010215    3C                   ENDIF
073460010215    3C     WOVUO         IFEQ      *BLANKS
073470010215     C     VIDCAM        OREQ      *BLANKS
073480010215     C                   MOVEL     ORMCAR        VIDCAM
073490010215     C                   MOVEL     '1'           WEFORM
073500010215    3C                   ENDIF
073510010215    3C     WOVUO         IFEQ      *BLANKS
073520010215     C     VIDLOM        OREQ      *BLANKS
073530010215     C                   MOVEL     ORMLOR        VIDLOM
073540010215     C                   MOVEL     '1'           WEFORM
073550010215    3C                   ENDIF
073560010215    3C     WOVUO         IFEQ      *BLANKS
073570010329     C     VIDPRM        OREQ      *BLANKS
073580010329     C     ORMPRR        ANDNE     *BLANKS
073590010329     C     VIDCAM        ANDEQ     ORMCAR
073600010329     C     ORMCAR        ANDNE     *BLANKS
073610010215     C                   MOVEL     ORMPRR        VIDPRM
073620010215     C                   MOVEL     '1'           WEFORM
073630010215    3C                   ENDIF
073640010216    3C     WOVUO         IFEQ      *BLANKS
073650010329     C     VIDNZM        OREQ      *BLANKS
073660010329     C     ORMNAR        ANDNE     *BLANKS
073670010329     C     VIDCAM        ANDEQ     ORMCAR
073680010329     C     ORMCAR        ANDNE     *BLANKS
073690010216     C                   MOVEL     ORMNAR        VIDNZM
073700010216     C                   MOVEL     '1'           WEFORM
073710010216    3C                   ENDIF
073720061113     c*
073730061113     c                   if        *in22 and ormtco='I' and ormcor=0
073740061113     c                   move      ormino        vidcdf
073750061113     c                   endif
073760031201    1C                   ENDIF
073770031201      * se ho forzato il porto franco
073780031201if  1c                   If        wforpf = '1'
073790031201if  2c                   If        Not *In02
073800031201      * imposto l'ordinante dell'orm nel mittente bolla
073810031201    3C     WOVUO         IFEQ      *BLANKS
073820031201     C     VIDRSM        OREQ      *BLANKS
073830031201     C                   MOVEL     ORMRSO        VIDRSM
073840031201     C                   MOVEL     '1'           WEFORM
073850031201    3C                   ENDIF
073860031201    3C     WOVUO         IFEQ      *BLANKS
073870031201     C     VIDINM        OREQ      *BLANKS
073880031201     C                   MOVEL     ORMINO        VIDINM
073890031201     C                   MOVEL     '1'           WEFORM
073900031201    3C                   ENDIF
073910031201    3C     WOVUO         IFEQ      *BLANKS
073920031201     C     VIDCAM        OREQ      *BLANKS
073930031201     C                   MOVEL     ORMCAO        VIDCAM
073940031201     C                   MOVEL     '1'           WEFORM
073950031201    3C                   ENDIF
073960031201    3C     WOVUO         IFEQ      *BLANKS
073970031201     C     VIDLOM        OREQ      *BLANKS
073980031201     C                   MOVEL     ORMLOO        VIDLOM
073990031201     C                   MOVEL     '1'           WEFORM
074000031201    3C                   ENDIF
074010031201    3C     WOVUO         IFEQ      *BLANKS
074020031201     C     VIDPRM        OREQ      *BLANKS
074030031201     C     ORMPRO        ANDNE     *BLANKS
074040031201     C     VIDCAM        ANDEQ     ORMCAO
074050031201     C     ORMCAO        ANDNE     *BLANKS
074060031201     C                   MOVEL     ORMPRO        VIDPRM
074070031201     C                   MOVEL     '1'           WEFORM
074080031201    3C                   ENDIF
074090031201    3C     WOVUO         IFEQ      *BLANKS
074100031201     C     VIDNZM        OREQ      *BLANKS
074110031201     C     ORMNAO        ANDNE     *BLANKS
074120031201     C     VIDCAM        ANDEQ     ORMCAO
074130031201     C     ORMCAO        ANDNE     *BLANKS
074140031201     C                   MOVEL     ORMNAO        VIDNZM
074150031201     C                   MOVEL     '1'           WEFORM
074160031201    3C                   ENDIF
074170031201    2c                   EndIf
074180031201      * imposto il mittente dell'orm nel mittente originale bolla
074190031201    2c                   If        wovuo = *Blanks or vidrmo = *Blanks
074200031201     c                   Movel     OrmRsr        vidrmo
074210031201     c                   Eval      wemfor = '1'
074220031201    2c                   EndIf
074230031201    2c                   If        wovuo = *Blanks or vidcmo = *Blanks
074240031201     c                   Movel     OrmCar        vidcmo
074250031201     c                   Eval      wemfor = '1'
074260031201    2c                   EndIf
074270031201    2c                   If        wovuo = *Blanks or  vidnmo = *Blanks
074280031201     c                   Movel     OrmNar        vidnmo
074290031201     c                   Eval      wemfor = '1'
074300031201    2c                   EndIf
074310031201    1c                   EndIf
074320010306     C*
074330010306     C* VOLUME - SOLO SE RICHIAMATA DA CONFERMA PREPAGATI DI ALTRO P.O.
074340010306     C*
074350010306    1C     §LPFPR        IFEQ      'O'
074360010306     C     ORMVLM        ANDGT     *ZEROS
074370010306     C* Metto il test su campo wovuo anche per volume per uniformità
074380010306     C* anche se in questo caso forse non serve perchè il volume
074390010306     c* non viene mai impostato diverso da 0 in ctrd01
074400010306     C     WOVUO         IFEQ      *BLANKS
074410010306     C     VIDVOL        OREQ      *ZEROS
074420010306     C                   Z-ADD     ORMVLM        VIDVOL
074430010306     C                   MOVEL     '1'           WEFORM
074440010306     C                   ENDIF
074450010306    1C                   ENDIF
074460010215     C*
074470010215     C* CODICE TARIFFA
074480010215     C*
074490031201     c                   If        Not *In29 and §OrPfb <> 'A'
074500010215     C                   MOVE      VIDCCM        W0070             7 0
074510010215    2C     VIDFLC        IFEQ      *ZEROS
074520010215     C                   MOVEL     VIDLNP        W0070
074530010215     C                   ELSE
074540010215     C                   MOVEL     VIDFLC        W0070
074550010215    2C                   ENDIF
074560010226     C* Propongo il codice tariffa da orm solo se:
074570010226     C* Stesso codice cliente mittente
074580010215    2C     W0070         IFEQ      ORMKSC
074590010226     C* immesso codice tariffa su orm
074600010215     C     ORMCTR        ANDNE     *BLANKS
074610010226     C* codice tariffa a video = blanks
074620010226     C     VIDCTR        ANDEQ     *BLANKS
074630010215     C                   MOVE      ORMCTR        VIDCTR
074640010215     C                   MOVE      ORMCTR        PRECTR
074650010215     C                   MOVEL     '1'           WEFORM
074660010215    2C                   ENDIF
074670010215    1C                   ENDIF
074680010215     C*
074690010215     C* NATURA MERCE
074700010215     C*
074710011221    1C  N27              DO
074720011221     C                   MOVEL     ORMNAM        W015A
074730011221    2C     W015A         IFNE      *BLANKS
074740010226     C     VIDNAS        ANDEQ     *BLANKS
074750010215     C                   MOVEL     ORMNAM        VIDNAS
074760010215     C                   MOVEL     '1'           WEFORM
074770011221    2C                   ENDIF
074780011221    1C                   ENDDO
074790010215     C*
074800010404     C* NOTE: SE PESO > 50 Q.LI
074810010404     C*       SE O.R.M. COMMISSIONATI DA ALTRO P.O. NELLE NOTE METTO
074820010404     C*       SEMPRE E SOLO IL REFERENTE E NUMERO DI TELEFONO
074830010307    1C                   SELECT
074840010307     C     §LPFPR        WHENEQ    'O'
074850050211     C***  ORMPOE        ORNE      ORMPOR
074860010307     C     VIDNT1        IFEQ      *BLANKS
074870010307     C                   MOVEL     WTELRF        VIDNT1
074880010307     C                   MOVEL     '1'           WEFORM
074890010307     C                   ENDIF
074900010307     C     WTELR2        IFNE      *BLANKS
074910010307     C     VIDNT2        IFEQ      *BLANKS
074920010307     C     WOVUO         OREQ      *BLANKS
074930010307     C                   MOVE      WTELR2        VIDNT2
074940010307     C                   MOVEL     '1'           WEFORM
074950010307     C                   ENDIF
074960010307     C                   ENDIF
074970010409     C     VIDPKG        WHENGE    §DFMAX
074980010215    2C     ORMNO1        IFNE      *BLANKS
074990010226     C     VIDNT1        ANDEQ     *BLANKS
075000010215     C                   MOVEL     ORMNO1        VIDNT1
075010010215     C                   MOVEL     '1'           WEFORM
075020010215    2C                   ENDIF
075030010215    2C     ORMNO2        IFNE      *BLANKS
075040010226     C     VIDNT2        IFEQ      *BLANKS
075050010226     C     WOVUO         OREQ      *BLANKS
075060010215     C                   MOVEL     ORMNO2        VIDNT2
075070010215     C                   MOVEL     '1'           WEFORM
075080010226     C                   ENDIF
075090010215    2C                   ENDIF
075100010307    1C                   ENDSL
075110010223     C                   MOVE      '1'           WOVUO             1
075120010215     C                   ENDSR
075130010215     C*
075140010215     C* CONTROLLI DI CONGRUENZA COD.TARIFFA CON CAMPO DELL'ORM ------*
075150010215     C     CNFOR2        BEGSR
075160010215     C*
075170010215     C*** CODICE TAR. ***
075180010215     C*
075190010223     C                   MOVE      VIDCCM        W0070
075200010223     C     VIDFLC        IFEQ      *ZEROS
075210010223     C                   MOVEL     VIDLNP        W0070
075220010223     C                   ELSE
075230010223     C                   MOVEL     VIDFLC        W0070
075240010223     C                   ENDIF
075250030905     C* ORM NON PAGATO DA DESTINATARIO
075260030905      * L'orm prevede la bolla in porto franco
075270030905     c     §OrPfb        Ifne      'A'
075280010223     C* PRESENTE CODICE CLIENTE SU ORM
075290010223     C     ORMKSC        ANDGT     *ZEROS
075300010223     C     ORMKSC        ANDEQ     W0070
075310010215     C     VIDCTR        IFNE      *BLANKS
075320010215     C     VIDCTR        ANDNE     PRECTR
075330010215     C     ORMCTR        ANDNE     VIDCTR
075340010215     C     ORMCTR        ANDNE     *BLANKS
075350010215     C                   MOVEL     RIMM          ATRCTR
075360010215     C                   MOVEL     VIDCTR        PRECTR
075370010215     C                   SETON                                        90
075380010215     C                   ENDIF
075390010223     C                   ENDIF
075400010215     C*
075410010215     C   90              MOVEL     ERR(224)      VIDMSG
075420010215     C   90              MOVEL     '1'           WEMFOR
075430010215     C                   ENDSR
075440070427     C*
075450070427     C* PROPOSTA mittente originale da orm per import dpd in porto assegnato
075460070427     C     PRPOR2_rmo    BEGSR
075470091008     c****               if        dateu>=§vpormo and §vpormo>0
075480070427     C                   CLEAR                   WEFORM
075490070427    2c                   If        wovuo1= *Blanks or vidrmo = *Blanks
075500070427     c                   Movel     OrmRsr        vidrmo
075510070430     c                   Eval      weform = '1'
075520070427    2c                   endif
075530070427    2c                   If        wovuo1= *Blanks or vidcmo = *Blanks
075540070427     c                   Movel     OrmCar        vidcmo
075550070430     c                   Eval      weform = '1'
075560070427    2c                   endif
075570070427    2c                   If        wovuo1= *Blanks or vidnmo = *Blanks
075580070427     c                   Movel     OrmNar        vidnmo
075590070430     c                   Eval      weform = '1'
075600070427    2c                   endif
075610070427     c                   movel     '1'           wovuo1            1
075620091008     c****               endif
075630070427     c                   endsr
075640091008     c*
075650960926     C* CONTROLLO CODICE AUTOTRASPORTATORE --------------------------*
075660940824     C     CTRPDR        BEGSR
075670940824     C*
075680940930     C                   CLEAR                   V1DPDR
075690990614     C                   CLEAR                   APDRSC
075700990614     C                   CLEAR                   APDFCM
075710990614     C                   CLEAR                   APDATB
075720940929     C*
075730940824     C     '?'           SCAN      WPDR                                   30
075740940824     C*
075750990915    1C     *IN30         IFEQ      *ON
075760021203      *
075770021203      * imposto i campi della ds esterna fnlv24ds
075780021203     C                   clear                   fnlv24ds
075790021203     C                   eval      d24fil   = wlnp
075800021203     C                   eval      d24tip   = 'A'
075810021203     C                   eval      d24flg   = 'R'
075820021203     C                   movel     fnlv24ds      kpjbu
075830940824     C                   CALL      'FNLV24R'
075840940824     C                   PARM                    KPJBA
075850021203      *
075860021203      * valorizzo i campi a video
075870021203     C                   movel     kpjbu         fnlv24ds
075880021203     C                   if        d24pdr   <> *zeros
075890021203     C                   move      d24pdr        wpdr
075900021203     C                   movel     d24rsc        v1dpdr
075910021203     C                   endif
075920021203     C                   MOVEL     '1'           WEMFOR
075930941011     C                   SETON                                        56
075940940824     C                   GOTO      ENDCPD
075950990915    1C                   END
075960940928     C* ESEGUO TESTN
075970990915    1C     PARTCH        IFNE      'P'
075980010307     C     §LPFPR        ANDNE     'O'
075990990610     C* PER PREPAGATI SOLO SE IL CAMPO E' PIENO
076000990610     C     PARTCH        OREQ      'P'
076010990610     C     WPDR          ANDNE     *BLANKS
076020990610     C     WPDR          ANDNE     *ZEROS
076030010307     C     §LPFPR        OREQ      'O'
076040010307     C     WPDR          ANDNE     *BLANKS
076050010307     C     WPDR          ANDNE     *ZEROS
076060990610     C*
076070940928     C                   TESTN                   WPDR                 30
076080940928     C                   MOVE      WPDR          W001A
076090990915    2C     *IN30         IFEQ      *OFF
076100940928     C     W001A         ORLT      '0'
076110940928     C                   MOVEL     ERR(21)       VIDMSG
076120940928     C                   SETON                                        5690
076130940928     C                   GOTO      ENDCPD
076140990915    2C                   ENDIF
076150940824     C*
076160940928     C                   MOVEL     WLNP          W0070             7 0
076170940928     C                   MOVE      WPDR          W0070
076180021204     C                   move      w0070         kpdpdr
076190021203     C                   move      'A'           kpdtip
076200021203     C     kfapd         chain     fiapd01l                           30
076210990915    2C     *IN30         IFEQ      *ON
076220940824     C     *IN30         OREQ      *OFF
076230940824     C     APDATB        ANDNE     *BLANKS
076240940824     C                   MOVEL     ERR(21)       VIDMSG
076250940920     C                   SETON                                        5690
076260940824     C                   GOTO      ENDCPD
076270990915    2C                   ENDIF
076280940824     C*
076290940824     C* NON POSSO INSERIRE UNA DATA RITIRO SE ESISTE LA CONFERMA DEI
076300960926     C*  CONTEGGI AUTOTRASPORTATORI PER QUEL GIORNO
076310950116     C                   MOVE      W0070         W01PDR
076320940824     C                   MOVEL     ' '           W01TSR
076330940824     C                   MOVEL     'C'           W01FVL
076340011126     C     KFTT          SETLL     FIFTT000                               90
076350011126     C  N90KFTT          SETLL     FIFST000                               90
076360940824     C*
076370990915    2C     *IN90         IFEQ      *ON
076380940824     C                   MOVEL     ERR(7)        VIDMSG
076390940920     C                   SETON                                        56
076400940824     C                   GOTO      ENDCPD
076410990915    2C                   ENDIF
076420990915     C*
076430990915     C* SE SI TRATTA DELLA CONFERMA DI UN PREPAGATO, DO MSG SE FLAG
076440990915     C*  MERCE A MAGAZZINO DIVERSO DAL COD AUTOTRASPORTATORE
076450990915     C     VIDPDR        IFNE      SAVPD4
076460990915     C                   CLEAR                   AAC
076470990915     C                   MOVEL     VIDPDR        SAVPD4
076480990915     C                   ENDIF
076490991001     C*
076500991001     C* CONTROLLO PER IL MOMENTO SOSPESO: QUANDO ATTIVEREMO PER I
076510991001     C*  PREPAGATI LA VARIA "U" SI DEVE RIMETTERE
076520001024     C* RIATTIVATO IL 24/10/00
076530990915     C*
076540001024     C     *IN22         IFEQ      *ON
076550990915     C     *IN12         ANDEQ     *ON
076560990915     C     *IN15         ANDEQ     *OFF
076570990915     C     AAC           ANDEQ     0
076580990915     C     BLPPDR        ANDEQ     0
076590990915     C     VIDMAG        IFNE      APDFCM
076600990915     C                   MOVEL     1             AAC
076610990915     C                   MOVEL     ERR(168)      VIDMSG
076620990915     C                   SETON                                        5690
076630990915     C                   GOTO      ENDCPD
076640990915     C                   ENDIF
076650990915     C                   ENDIF
076660940824     C*
076670940824     C                   MOVEL     APDRSC        V1DPDR
076680041013     c* se orm reale controllo che non esistano altre bolle associate
076690041013     c* allo stesso orm ma abbinate ad altro autotrasportatore.
076700041013     c* Se presenti --> errore bloccante
076710041013     C     WORM          IFEQ      'S'
076720041013     C     FLGFIT        ANDNE     'S'
076730041013     c                   exsr      SR_CtrOrmPdr
076740041013     C   90              GOTO      ENDCPD
076750041013     c                   endif
076760990915    1C                   ENDIF
076770940824     C*
076780940824     C     ENDCPD        TAG
076790940824     C   90              MOVEL     '1'           WEMFOR
076800940824     C                   ENDSR
076810041013     C**************************************************************************
076820041013     C*   Controllo esistenza altre bolle associate all'orm immesso
076830041013     C**************************************************************************
076840041013     C     SR_CtrOrmPdr  BEGSR
076850041013     C                   MOVEL     DSBLP0        SAVBLP
076860041019     c     *in12         ifeq      *on
076870041019     c     *in15         andeq     *off
076880041019     c                   movel     *blanks       savbol           16
076890041019     c                   eval      savbol = %EDITW(BLPAAS:'    ')     +
076900041019     C                                      %editw(BLPLNP:'   ')      +
076910041019     C                                      %editw(BLPNRS:'  ')       +
076920041019     C                                      %editw(BLPNSP:'       ')
076930041019     c                   endif
076940041019     c
076950060215     c                   movel     'M'           kar4trc
076960060215     c                   movel     widorm        kar4n14
076970060215     c     kar403        setll     fiar404l
076980041013     c                   do        *hival
076990060215     c     kar403        reade     fiar404l
077000041013     c* fine file
077010060215     c                   if        %eof(fiar404l)
077020041013     c                   leave
077030041013     c                   endif
077040061212     c     kblp4m        chain     fnblp01l
077050041019     c
077060041019     c     *in12         ifeq      *on
077070041019     c     *in15         andeq     *off
077080041019     c                   movel     *blanks       blpbol           16
077090041019     C                   eval      blpbol = %editw(BLPAAS:'    ')   +
077100041019     C                                      %editw(BLPLNP:'   ')    +
077110041019     C                                      %editw(BLPNRS:'  ')     +
077120041019     C                                      %editw(BLPNSP:'       ')
077130041019     c                   endif
077140041013     c* trovata bolla con aut diverso errore --> esco dal ciclo
077150041013     c                   if        %found(fnblp01l) and
077160041019     c                             blppdr <> w01pdr and
077170041019     c                             blppdr > 0
077180041019     c* se sono in manutenzione e ho letto la bolla che sto manutenzion
077190041019     c* ando ignoro
077200041019     c     *in12         ifeq      *on
077210041019     c     *in15         andeq     *off
077220041019     c     blpbol        andne     savbol
077230041019     c     *in12         oreq      *off
077240041019     c     *in15         oreq      *on
077250041019     c
077260041013     C                   MOVEL     ERR(286)      VIDMSG
077270041013     C                   SETON                                        5690
077280041013     C                   leave
077290041019     c                   endif
077300041013     c                   endif
077310041013     c
077320041013     c                   enddo
077330041013     c
077340041013     C                   MOVEL     SAVBLP        DSBLP0
077350041013     c                   endsr
077360940824     C*
077370940824     C* CONTROLLO CODICE BOLLA ---------------------------------------*
077380940824     C     CTRCBO        BEGSR
077390940824     C* NO PERSONALIZZAZIONE
077400940824    0C     *IN21         IFEQ      *OFF
077410941103     C                   SETOFF                                       040508
077420940824     C* RICERCA
077430940922     C                   MOVEL     '3A'          COD
077440940824     C     '?'           SCAN      WCBO                                   30
077450940824    1C     *IN30         IFEQ      *ON
077460940922     C                   EXSR      CX§TAB
077470940824     C                   MOVEL     §KEY          WCBO
077480941011     C                   SETON                                        46
077490940824     C                   GOTO      ENDCCB
077500940824    1C                   ENDIF
077510940824     C*
077520940920     C                   MOVEL(P)  WCBO          KEY
077530940824     C*
077540940824     C                   EXSR      CTABEL
077550940824    1C     *IN30         IFEQ      *ON
077560940824     C                   MOVEL     ERR(10)       VIDMSG
077570940920     C                   SETON                                        4690
077580940824     C                   GOTO      ENDCCB
077590940824    1C                   ENDIF
077600940824     C*
077610940824     C                   MOVEL     TBLUNI        DS3A
077620940824     C                   MOVEL     §3ATB1        FLGTB1            1
077630940824     C                   MOVEL     §3ADES        V2DCBO
077640940824     C* VEDO SE CAUSALE UTILIZZABILE
077650940824     C  N12
077660940824     CORN44
077670940824    1CAN 12§3AUCB        IFEQ      'N'
077680940824     C                   MOVEL     ERR(10)       VIDMSG
077690940920     C                   SETON                                        4690
077700940824     C                   GOTO      ENDCCB
077710940824    1C                   END
077720000509     C*
077730000509     C* PER BOLLE POSTE AMMESSO SOLO FRANCO
077740020319     C     §ogntw        IFEQ      'PPT'
077750000906     C     FLGTB1        IFNE      'F'
077760000906     C     §3ATB2        ORNE      '  '
077770000509     C                   MOVEL     ERR(199)      VIDMSG
077780000509     C                   SETON                                        4690
077790000509     C                   GOTO      ENDCCB
077800000509     C                   ENDIF
077810000911     C                   ENDIF
077820940824     C*
077830991026     C     FLGTB1        COMP      'A'                                    04
077840941103     C*
077850940929     C* 08 ON - TASSATO DESTINO
077860940826     C     §3AFTD        IFEQ      1
077870940826     C                   SETON                                        08
077880940920     C                   ENDIF
077890940920     C* 05 ON - 2 BOLLA E NON E' TASSATO DESTINO
077900940920     C  N08§3ATB2        IFNE      *BLANKS
077910940920     C                   SETON                                        05
077920940920     C                   ENDIF
077930991026      *
077940991026      * SE SONO NELLA PROCEDURA PREPAGATI DEVO SELEZIONARE UN PORTO FRANCO
077950991026     C     *IN04         IFEQ      *ON
077960991026     C     PARTCH        ANDEQ     'P'
077970010307     C     *IN04         OREQ      *ON
077980010307     C     §LPFPR        ANDEQ     'O'
077990991026     C                   MOVEL     ERR(173)      VIDMSG
078000991026     C                   SETON                                        4690
078010991026     C                   GOTO      ENDCCB
078020991026     C                   ENDIF
078030020611     c* X prepagati non posso bollettare come C/servizio
078040020611     c     *in22         ifeq      *on
078050020611     c     §3arbl        andeq     'C'
078060020611     c                   movel     err(256)      vidmsg
078070020611     C                   SETON                                        4690
078080020611     C                   GOTO      ENDCCB
078090020611     c                   endif
078100030805      * se ORM con serie il codice bolla non può essere diverso da quello
078110030805      * indicato in tabella 'OSR'
078120030805If  1c                   If        wonsr > *Zeros and flgfit <> 'S' and
078130030808     c                             wCbo <> d§OsrCbo and d§OsrCbo <> *Blanks
078140030805     c                   Eval      VidMsg = Err(148)
078150030805     c                   Eval      %subst(VidMsg:25:2) = d§OsrCbo
078160030805     c                   Eval      *In46 = *On
078170030805     c                   Eval      *In90 = *On
078180030805     c                   GoTo      EndCcb
078190030805    1c                   EndIf
078200040122
078210040122      * Il codice bolla '2R' è ammesso solo se ho inserito un ORM con la serie
078220040203     c                   If        wcbo = '2R' and
078230040203     c                             (flgfit = 'S' or wonsr = *Zeros)
078240040122     c                   Eval      VidMsg = Err(10)
078250040122     c                   Eval      *In46 = *On
078260040122     c                   Eval      *In90 = *On
078270040122     c                   GoTo      EndCcb
078280040122     c                   EndIf
078290991026     C*
078300940824    0C                   ENDIF
078310940824     C*
078320940824     C* SE BOLLA DI RECUPERO NO DATA SPEDIZIONE < DATA GIORNO -3
078330940824     C* ALTRIMENTI NO < DATA GIORNO
078340940824    0C     §3ARBL        IFEQ      'R'
078350940824     C*
078360000113    1C     *IN12         IFEQ      *OFF
078370000113     C     *IN15         OREQ      *ON
078380000113     C     BLPDSP        ORNE      WBDSP
078390000113    2C     BLPDSP        IFLT      DATAM
078400940824     C                   MOVEL     ERR(4)        VIDMSG
078410940929     C                   SETON                                        4190
078420000113    2C                   ENDIF
078430000113    1C                   ENDIF
078440940824     C*
078450940824   X0C                   ELSE
078460940824     C*
078470000104     C* IMMISSIONE O CONFERMA
078480000104    1C     *IN12         IFEQ      *OFF
078490000104     C     *IN15         OREQ      *ON
078500000104     C     BLPDSP        ORNE      WBDSP
078510061221     c
078520000104     C* MANUTENZIONE : SOLO SE LA DATA SPEDIZIONE E' STATA CAMBIATA
078530061221    2C***  BLPDSP        IFLT      DATEU
078540061221    2C     BLPDSP        IFLT      datameno1
078550940824     C                   MOVEL     ERR(5)        VIDMSG
078560061221     c                   eval      %subst(vidmsg:65:10) =
078570061221     c                             %editw(datgmeno1: '  /  /    ')
078580940929     C                   SETON                                        4190
078590000104    2C                   ENDIF
078600000104    1C                   ENDIF
078610940824    0C                   ENDIF
078620000104     C   90              GOTO      ENDCCB
078630960319     C* IN MANUTENZIONE NON POSSO MODIFICARE IL TIPO BOLLA SE BOLLA
078640960319     C*  FIGLIA
078650960319     C   12
078660960319     CANN15BLPCBO        IFNE      WCBO
078670960319     C     KBLP3         SETLL     FNLBL01L                               90
078680960319     C     *IN90         IFEQ      *ON
078690960319     C                   MOVEL     ERR(124)      VIDMSG
078700960319     C                   SETON                                        46
078710960319     C                   GOTO      ENDCCB
078720120926     c*
078730120926     c                   else
078740120926     c                   if        savrbl='R' and savtb1='F' and
078750120926     c                             §3arbl<>'R'
078760120926     C                   MOVEL     ERR(347)      VIDMSG
078770120926     C                   SETON                                        4690
078780120926     C                   GOTO      ENDCCB
078790120926     c                   endif
078800960319     C                   ENDIF
078810960319     C                   ENDIF
078820961122     C*
078830990518     C* SE MODIFICATO TIPO BOLLA, PULISCO CAMPO DIC/VEN
078840961122     C     WCBO          IFNE      SAVCBO
078850040213     C**!!!              CLEAR                   DIC
078860040213     C**!!!              CLEAR                   VEN
078870961122     C                   MOVEL     WCBO          SAVCBO
078880961122     C                   ENDIF
078890070427     c* In manutenzione
078900070427     c* se modificato porto da franco ad assegnato pulisco campo per
078910070427     c* controlli proposte mittente originale
078920070427     c                   if        *in12='1' and *in15='0' and
078930070427     C                             flgtb1<>savtb1 and flgtb1='A'
078940070427     c                   clear                   wovuo1
078950070427     c                   endif
078960940824     C* personalizzazione
078970940824     C     WPERSO        IFEQ      'P'
078980940824     C                   SETON                                        21
078990940824     C                   ENDIF
079000940824     C*
079010940928     C     ENDCCB        TAG
079020940824     C   90              MOVEL     '1'           WEMFOR
079030940824     C                   ENDSR
079040050214     C* CONTROLLO codice bolla --------------------------------------*
079050050214     C     CTRCBO_orm    BEGSR
079060060918    1C     *IN12         IFEQ      *OFF
079070091019    1C     *IN15         oreq      *On
079080091019     c     flgfit        andne     'S'
079090091019     c     §orpfb        andeq     'A'
079100060918     C* In manutenzione controllo solo se variato il numero ORM
079110060918     C     *IN15         OREQ      *OFF
079120060918     C     WORMMD        ANDEQ     '1'
079130081023     c* se bolla export dpd controllo anche se variato il codice bolla
079140081023     c     *in15         oreq      *off
079150081023     c     A_§ogntw      andeq     'DPD'
079160081023     c     vidcbo        andne     cbo_blp
079170050214      * Controllo il tipo bolla con quanto memorizzato sull'ORM
079180050214     c                   If        §OrPfb <> *Blanks and Flgtb1 <> §OrPfb
079190050214     c                             and flgfit <> 'S'
079200050214     c                   If        §OrPfb = 'F'
079210061124     c                             and wfortbo = *Blanks
079220061124     c                   Eval      VidMsg = Err(30)
079230050214     c                   Eval      %subst(VidMsg:34:9) = 'Franco   '
079240050214     c                   Eval      %subst(VidMsg:45:15) = 'ENTER X FORZARE'
079250061124     c                   Eval      *In46 = *On
079260061124     c                   Eval      *In90 = *On
079270050214     c                   Eval      WforTbo = '1'
079280050214     c                   EndIf
079290050214     c                   If        §OrPfb = 'A'
079300061124     c                   Eval      VidMsg = Err(30)
079310050214     c                   Eval      %subst(VidMsg:34:9) = 'Assegnato'
079320061124     c                   Eval      *In46 = *On
079330061124     c                   Eval      *In90 = *On
079340050214     c                   EndIf
079350050214     c                   EndIf
079360060918     c                   endif
079370050214     c                   endsr
079380081107     C* CONTROLLO codice bolla con cod. trattamento merce -----------*
079390081107     C     CTRCBO_ctm    BEGSR
079400081107     c* se cd. trattamento merce di recupero non posso usarlo con cod.
079410081107     c* bolla non di recupero a meno che non sia un codice bolla abili-
079420081107     c* tato
079430081107     c                   if        §1bfg8='N' and §3arbl<>'R'
079440081107     c                              and §3aurc=' '
079450081107     C                   MOVEL     ERR(318)      VIDMSG
079460081107     C                   SETON                                        4690
079470081107     c                   endif
079480081107     c                   endsr
079490940824     C*
079500940824     C* CONTROLLO LINEA DI ARRIVO -----------------------------------*
079510110217     C     CTRLNA_vid    BEGSR
079520110217     c
079530940824     C* NON E' STATA PERSONALIZZATA
079540940824    0C     *IN20         IFEQ      *OFF
079550940824     C*
079560940928     C                   CLEAR                   V1DLNA
079570940824     C* SOLO SE INSERITA, ALTRIMENTI LA CALCOLO IN AUTOMATICO
079580940824    1C     WLNA          IFNE      *BLANKS
079590940824     C     WLNA          ANDNE     *ZEROS
079600940824     C*
079610940824     C     '?'           SCAN      WLNA                                   30
079620940824     C*
079630940824    2C     *IN30         IFEQ      *ON
079640940824     C                   MOVE      *BLANKS       §COD1
079650940824     C                   MOVE      *BLANKS       WLNA
079660941230     C                   CALL      'TNSD19R'
079670940824     C                   PARM                    §COD1             3
079680940824     C                   PARM                    §TIP              1
079690940928     C                   PARM                    §DES
079700940824     C                   MOVEL     §COD1         WLNA
079710940928     C                   MOVEL     §DES          V1DLNA
079720940824     C                   MOVEL     '1'           WEMFOR
079730941011     C                   SETON                                        47
079740940824     C                   GOTO      ENDCLA
079750940824    2C                   ENDIF
079760110217     c
079770110217     c                   exsr      Ctrlna_Base
079780110217     c
079790110217     c* Se errore accendo indicatore di posizionamento cursore
079800110217     c                   if        *in90
079810110217     c                   seton                                        47
079820110217     C                   GOTO      ENDCLA
079830110217     c                   endif
079840940824     C*
079850991202     C* SE CAMBIATA
079860940824    2C     CO2LNA        IFNE      COMLNA
079870940824     C                   MOVEL     0             QUA
079880100209     C                   MOVEL     0             QUAH
079890040213     C**!!!              MOVEL     0             DIC
079900040213     C**!!!              MOVEL     0             VEN
079910940920     C                   MOVEL     COMLNA        CO2LNA
079920940824    2C                   END
079930940824     C* DESCRIZIONE
079940940824     C                   MOVEL     ORGDES        V1DLNA
079950940824     C* PERSONALIZZAZIONE
079960940824    2C     WPERSO        IFEQ      'P'
079970940824     C                   SETON                                        20
079980940824    2C                   ENDIF
079990940824     C*
080000940824   X1C                   ELSE
080010940824     C* LINEA NON IMMESSA
080020940824     C                   MOVEL     *BLANKS       V1DLNA
080030940824     C                   Z-ADD     0             COMLNA
080040020213     C                   CLEAR                   A_OG143
080050040525     C                   CLEAR                   A_OG150
080060940824     C* RICONTROLLO SEMPRE IL CAP
080070940824     C                   MOVEL     0             QUA
080080100209     C                   MOVEL     0             QUAH
080090940824    1C                   END
080100010220     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
080110010220     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
080120010220     C     WPERSO        IFEQ      'P'
080130010220     C     WORM          ANDEQ     'S'
080140010220     C     PARTCH        ANDNE     'P'
080150010220     C     FLGFIT        ANDNE     'S'
080160010220     C     WLNA          ANDGT     *ZEROS
080170010220     C                   MOVE      WLNA          W0030             3 0
080180010220     C     W0030         IFNE      ORMPOC
080190010220     C     ORMPOC        ANDGT     *ZEROS
080200010220     C                   SETON                                        9047
080210010220     C                   MOVEL     ERR(225)      VIDMSG
080220010220     C                   GOTO      ENDCLA
080230010220     C                   ENDIF
080240010220     C                   ENDIF
080250940928    0C                   END
080260940824     C*
080270940824     C     ENDCLA        TAG
080280940824     C   90              MOVEL     '1'           WEMFOR
080290940824     C                   ENDSR
080300110217     C*
080310110217     C* CONTROLLI di base 1° e 2° videata della linea di arrivo ------*
080320110217     c     CTRLNA_Base   BEGSR
080330110217     c
080340110217     C                   TESTN                   WLNA                 30
080350110217     C                   MOVE      WLNA          W001A             1
080360110217    2C     *IN30         IFEQ      *OFF
080370110217     C     W001A         ORLT      '0'
080380110217     C                   MOVEL     ERR(12)       VIDMSG
080390110217     C                   SETON                                        90
080400110217     C                   leavesr
080410110217    2C                   ENDIF
080420110217     c
080430110217     c* Se in immissione prepagati e lna Portogallo o Spagna errore
080440110217     c                   if        (partch='P' or §lpfpr='O') and
080450120608     c                             (wlna='340' or wlna='345' or wlna='341')
080460120608     c                             and (wccm=8888 or wccm=0)
080470110217     C                   SETON                                        90
080480110217     C                   MOVEA     ERR(311)      K78
080490110217     C                   MOVE      wlna          W003A             3
080500110217     C                   MOVEA     W003A         K78(17)
080510110217     C                   MOVEA     K78           VIDMSG
080520110217     C                   leavesr
080530110217     c                   endif
080540110217     C*
080550110217    2C     WLNA          IFGT      *ZEROS
080560110217     C                   MOVEL     WLNA          COMLNA
080570110217     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
080580110217     C                   ELSE
080590110217     C                   SETON                                        30
080600110217    2C                   END
080610110217     C*
080620110217     C* CONTROLLO SE ANNULLATO
080630110217     C* CONSIDERO SOLO I TIPI "F" E "A"
080640110217    2C  N30ORGFVA        IFNE      *BLANKS
080650110217    2C     ORGFAG        ORNE      'F'
080660110217     C     ORGFAG        ANDNE     'A'
080670110217     C                   SETON                                        30
080680110217    2C                   END
080690110217     C* CONTROLLO CHE NON SIA UNA LINEA BLOCCATA
080700110217     C                   MOVEL     ORGDE8        OG148
080710110217     C     §OGLBL        IFEQ      'N'
080720110217     C                   SETON                                        30
080730110217    2C                   END
080740110217     C*
080750110217    2C     *IN30         IFEQ      *ON
080760110217     C                   MOVEL     ERR(12)       VIDMSG
080770110217     C                   SETON                                        90
080780110217     C                   leavesr
080790110217    2C                   ENDIF
080800110217     c
080810110217     C* TERMINAL DI ARRIVO
080820110217     C                   CLEAR                   DSLV55
080830110217     C                   MOVEL     'A'           D55TPT
080840110217     C** PER POSTE DEVO PASARE LA LINEA E NON IL TERMINAL
080850110217     C                   MOVEL     VIDLNP        D55LNP
080860110217     C**
080870110217     C                   MOVEL     COMLNA        D55LIN
080880110217     C                   MOVEL     BLPDSP        D55DRF
080890110217     C                   CALL      'FNLV55R'
080900110217     C                   PARM                    DSLV55
080910110217     C     D55ERR        IFEQ      ' '
080920110217     C                   MOVEL     D55TFA        COMTFA
080930110217     C                   ELSE
080940110217     C                   SETON                                        90
080950110217     C                   MOVEL     ERR(212)      VIDMSG
080960110217     C                   leavesr
080970110217     C                   ENDIF
080980110217     C*
080990110217     C                   MOVEL     ORGDE3        A_OG143
081000110217     C                   MOVEL     ORGDF0        A_OG150
081010110217     c                   ENDSR
081020940824     C*
081030940824     C* CONTROLLO TIPO SERVIZIO --------------------------------------*
081040940824     C     CTRTSP        BEGSR
081050940824     C* SOLO SE NON PERSONALIZZATO
081060941107    0C     *IN18         IFEQ      *OFF
081070941107     C                   SETOFF                                       09
081080940824     C                   CLEAR                   V1DTSP
081090940824     C*
081100080327     c                   clear                   NOutiTSP          1
081110940824    1C     WTSP          IFNE      *BLANKS
081120940922     C                   MOVEL     '5E'          COD
081130940922     C* RICERCA
081140940824    2C     WTSP          IFEQ      '?'
081150940922     C                   EXSR      CX§TAB
081160940824     C                   MOVEL     §KEY          WTSP
081170090604     C**!!!              MOVEL     §DES          V1DTSP
081180090604     C                   Z-ADD     1             C
081190090604     C     WTSP          LOOKUP    TSP(C)                                 30
081200090604    2C                   IF        *in30
081210090604     C                   MOVEL     DTS08(C)      V1DTSP
081220090604     c                   else
081230090604     c                   clear                   v1dtsp
081240090604     c                   endif
081250941011     C                   SETON                                        48
081260940824     C                   GOTO      ENDCSP
081270940824    2C                   END
081280940922     C* CONTROLLO
081290941107     C                   Z-ADD     1             C
081300941107     C     WTSP          LOOKUP    TSP(C)                                 30
081310940922     C* ERRORE
081320941107    2C     *IN30         IFEQ      *OFF
081330940824     C                   MOVEL     ERR(15)       VIDMSG
081340940929     C                   SETON                                        4890
081350940824     C                   MOVEL     '1'           WEMFOR
081360940824     C                   GOTO      ENDCSP
081370940824    2C                   ENDIF
081380940824     C*
081390090604     C**!!!              MOVEL     DTS(C)        V1DTSP
081400090604     C**!!!              MOVEL     DTS(C)        V2DTSP
081410090604     C                   MOVEL     DTS08(C)      V1DTSP
081420090604     C                   MOVEL     DTS08(C)      V2DTSP
081430941102     C*
081440941102     C* DEVE ESSERE UTILIZZABILE IN BOLLETTAZIONE
081450080327     c                   clear                   NOutiTSP          1
081460941107    2C     UTS(C)        IFNE      'S'
081470080327     C* IN IMMISSIONE  SEMPRE ERRORE
081480941108   3 C     *IN12         IFEQ      *OFF
081490080327     c* per  disk clienti se non utilizzabile do errore solo se
081500080327     c*    diverso da tariffa e  quindi posticipo il controllo
081510080326     C**** *IN12         OREQ      *OFF
081520080327     C**** *IN15         ANDEQ     *ON
081530941107     C* IN MANUTENZ SOLO SE E' CAMBIATO
081540941107     C     *IN12         OREQ      *ON
081550941107     C     *IN15         ANDEQ     *OFF
081560941107     C     WTSP          ANDNE     BLPTSP
081570941107     C*
081580941102     C                   MOVEL     ERR(15)       VIDMSG
081590941102     C                   SETON                                        4890
081600941102     C                   MOVEL     '1'           WEMFOR
081610941102     C                   GOTO      ENDCSP
081620941108    3C                   ENDIF
081630080327     c
081640080327     c                   if        *in12 and *in15
081650080327     c                   eval      NOutiTSP='N'
081660080327     c                   endif
081670080327     c
081680941108    2C                   ENDIF
081690080327     c
081700120302     C* VEDO SE VALIDO PER POSTE, BRT/SDI
081710000509     C     USO(C)        IFEQ      'P'
081720020319     C     §ogntw        ANDNE     'PPT'
081730000509     C                   MOVEL     ERR(194)      VIDMSG
081740000509     C                   SETON                                        4890
081750000509     C                   MOVEL     '1'           WEMFOR
081760000509     C                   GOTO      ENDCSP
081770000509    3C                   ENDIF
081780000509     C     USO(C)        IFEQ      'E'
081790020319     C     §ogntw        ANDEQ     'PPT'
081800000509     C                   MOVEL     ERR(194)      VIDMSG
081810000509     C                   SETON                                        4890
081820000509     C                   MOVEL     '1'           WEMFOR
081830000509     C                   GOTO      ENDCSP
081840000509    3C                   ENDIF
081850100209     c
081860100209     c* Se modifico pulisco i flag di controllo linea di arrivo
081870100209     c                   if        wtsp<>sa2tsp
081880100209     c                   clear                   qua
081890100209     c                   clear                   quaH
081900100209     c                   eval      sa2tsp=wtsp
081910100209     c                   endif
081920100319     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
081930100319     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
081940100319     C     WPERSO        IFEQ      'P'
081950100319     C     WORM          ANDEQ     'S'
081960100319     C     PARTCH        ANDNE     'P'
081970100319     C     FLGFIT        ANDNE     'S'
081980100319     C     WesORE        ANDeq     'S'
081990100319     C     Wtsp          ANDne     ' '
082000100319     C     wtsp          andne     §oretsp
082010100319     C                   SETON                                        9048
082020100319     C                   MOVEL     ERR(76)       VIDMSG
082030100319     C                   GOTO      ENDCSP
082040100319     C                   ENDIF
082050000509     C*
082060940824     C* PERSONALIZZAZIONE
082070940824    2C     WPERSO        IFEQ      'P'
082080940922     C                   SETON                                        18
082090940824    2C                   ENDIF
082100940824     C*
082110941107   X1C                   ELSE
082120941107     C                   SETON                                        09
082130940824    1C                   ENDIF
082140941107    0C                   ENDIF
082150940824     C*
082160940824     C     ENDCSP        ENDSR
082170940824     C*
082180940824     C* CONTROLLO CODICE TRATTAMENTO MERCE --------------------------*
082190940824     C     CTRCTM        BEGSR
082200950504     C* NON E' CAMBIATO IL CTM
082210950504     C     WCTM          IFNE      SAVCTM
082220940824     C                   CLEAR                   V1DCTM
082230940824     C* RICERCA
082240940922     C                   MOVE      '1B'          COD
082250940824     C     '?'           SCAN      WCTM                                   30
082260940922     C* RICERCA
082270940824    1C     *IN30         IFEQ      *ON
082280940922     C                   EXSR      CX§TAB
082290940824     C                   MOVEL     §KEY          WCTM
082300941011     C                   SETON                                        49
082310940824     C                   GOTO      ENDCTM
082320940824    1C                   END
082330940922     C* COTROLLO
082340940920     C                   MOVEL(P)  WCTM          KEY
082350940824     C                   EXSR      CTABEL
082360940922     C* ERRORE
082370940824    1C     *IN30         IFEQ      *ON
082380940824     C                   MOVEL     ERR(16)       VIDMSG
082390940920     C                   SETON                                        4990
082400940824     C                   GOTO      ENDCTM
082410940824    1C                   ENDIF
082420940824     C*
082430940824     C                   MOVEL     TBLUNI        DS1B
082440940824     C*
082450940824     C* FLAG2 >< "S" (NUM SPEDIZIONE DAL CLIENTE) IN IMMISSIONE
082460940824    1C  N12§1BFG2        IFEQ      'S'
082470100208     C                   MOVEL     ERR(16)       VIDMSG
082480940920     C                   SETON                                        4990
082490940824     C                   GOTO      ENDCTM
082500940824    1C                   END
082510940824     C*
082520940824     C* IN RECUPERO SOLO CTM DA MAGAZZINO
082530990602    1C  N12PARTCH        IFEQ      'R'
082540940824     C     §1BFG6        ANDNE     'M'
082550940824     C                   MOVEL     ERR(16)       VIDMSG
082560940920     C                   SETON                                        4990
082570940824     C                   GOTO      ENDCTM
082580940824    1C                   END
082590940824     C* IM IMMISSIONE NON POSSO USARE CTM CON FLG7=S
082600940824    1C  N12§1BFG7        IFEQ      'S'
082610940824     C                   MOVEL     ERR(16)       VIDMSG
082620940920     C                   SETON                                        4990
082630940824     C                   GOTO      ENDCTM
082640940824    1C                   END
082650000911     C*
082660000919     C* POSSO USARE CTM DISK C SOLO SE TERMINAL ABILITATO
082670001106     C* NON FACCIO QUESTO CONTROLLO SE FLAG 12 = 'E'. IN QUESTO CASO
082680001106     C* INFATTI DEVE ESSERE POSSIBILE BOLLETTARE SEMPRE E SE TERMINAL
082690001106     C* NON AIBLITATO NON LO CONSIDERERO' UN DISK C
082700000904     C     §1BF12        IFNE      'N'
082710001106     C     §1BF12        ANDNE     'E'
082720000904     C     WASDKC        ANDNE     'S'
082730000904     C                   MOVEL     ERR(206)      VIDMSG
082740000904     C                   SETON                                        4990
082750000904     C                   GOTO      ENDCTM
082760000904     C                   ENDIF
082770000911     C*
082780000919     C                   MOVEL     '3C'          COD
082790000919     C                   MOVEL(P)  WKSC          KEY
082800000919     C                   CLEAR                   DS3C
082810000919     C                   EXSR      CTABEL
082820000919     C  N30              MOVEL     TBLUNI        DS3C
082830000911     C*
082840940824     C* CONTROLLO SE PREVEDE L'ASSEGNAZIONE DEI SEGNACOLLI IN AUTOMATIC
082850980424     C                   SETOFF                                       25
082860940824    1C     §1BFG6        IFEQ      'D'
082870940824     C     §1BFG6        OREQ      'I'
082880940824     C     §1BFG6        OREQ      'N'
082890940824     C                   SETON                                        25
082900940824    1C                   END
082910950504     C* SALVO IL CTM
082920950504     C                   MOVEL     WCTM          SAVCTM
082930940824     C*
082940940824     C     ENDCTM        TAG
082950940824     C   90              MOVEL     '1'           WEMFOR
082960950504     C   90              CLEAR                   SAVCTM
082970940824    0C                   ENDIF
082980940824     C                   ENDSR
082990940824     C*
083000940824     C* CONTROLLO CODICE CLIENTE -------------------------------------*
083010940824     C     CTRCCM        BEGSR
083020000201     C*
083030940825    0C     *IN19         IFEQ      *OFF
083040990610     C     WCOCCM        OREQ      'S'
083050950303     C                   SETOFF                                       02
083060020319     c                   clear                   clintw
083070940922     C                   CLEAR                   MITVLT
083080940920     C* 19 ON - MITTENTE PERSONALIZZATO
083090950209     C     WFLC          IFEQ      WLNP
083100950209     C                   SETOFF                                       14
083110020319     C                   MOVEL     §ogntw        CLIntw
083120950209     C                   ELSE
083130950209     C                   SETON                                        14
083140000201     C**
083150020306     c     wccm          ifeq      8888
083160020507     c     wccm          oreq      9999
083170020306     C                   SETON                                        9050
083180020306     C                   MOVEL     ERR(81)       VIDMSG
083190020306     C                   GOTO      ENDCCM
083200020306     c                   endif
083210051207     C* Imposto campo del codice
083220051207     C                   MOVEL     WFLC          WKSC
083230051207     C                   MOVE      WCCM          WKSC
083240051207     C*
083250000201     C* CONTROLLO SE CLIENTE DPD
083260000201     C     WFLC          CHAIN     AZORG01L      UNIORG               30
083270000201     C                   MOVEL     OG143         SAV143
083280000201     C                   MOVEL     ORGDE3        OG143
083290020319     C     §OGNTW        IFEQ      'DPD'
083300010103     C     SAVFPR        IFNE      'P'
083310010103     C     SAVFPR        ANDNE     'G'
083320010319     C     WSIDPD        ANDEQ     'S'
083330051207     c* Possibile linea diversa solo se prevista da tabella 3TR
083340051207     c                   clear                   tntb50ds
083350051207     C                   movel     wksc          b50ke2
083360051207     C*
083370051207     c                   movel     b50ke2        b50ke1
083380051207     c                   movel     'C'           b50opz
083390051207     c                   movel     wlnp          b50poa
083400051207     c                   call      'TNTB51R'
083410051207     c                   parm                    kpjba
083420051207     c                   parm                    tntb50ds
083430051207     c
083440051207     c                   if        b50err<>' '
083450001212     C                   SETON                                        9045
083460001212     C                   MOVEL     ERR(215)      VIDMSG
083470001212     C                   GOTO      ENDCCM
083480010103     C                   ENDIF
083490051207     c
083500051207     C                   ENDIF
083510000201     C                   ENDIF
083520020319     C                   MOVEL     §OGntw        CLINTW
083530040930     c* errore se network cliente è logistica o sede
083540040930     c     clintw        ifeq      'LOG'
083550040930     c     clintw        oreq      'XXX'
083560040930     C                   SETON                                        9051
083570040930     C                   MOVEL     ERR(284)      VIDMSG
083580040930     C                   GOTO      ENDCCM
083590040930     c                   endif
083600000201     C                   MOVEL     SAV143        OG143
083610950209     C                   ENDIF
083620051207     C* Imposto campo del codice
083630051207     C                   MOVEL     WFLC          WKSC
083640051207     C                   MOVE      WCCM          WKSC
083650940928     C                   Z-ADD     KCI           CCC
083660940824     C     KACO          CHAIN     CNACO000                           30
083670940824     C* ANNULLATO
083680940921    2C  N30ACOFLG        IFEQ      '*'
083690940824     C                   SETON                                        30
083700940921    2C                   END
083710940824     C*
083720940921    2C     *IN30         IFEQ      *ON
083730940824     C                   MOVEL     ERR(22)       VIDMSG
083740940922     C                   SETON                                        9050
083750940824     C                   GOTO      ENDCCM
083760940921    2C                   ENDIF
083770940824     C* FLAG=8 NON SPEDISCE - NO BOLLE
083780130312    2C***  ACOABL        IFEQ      '8'
083790130312    2C***  ACOABL        OREQ      '*'
083800130312    2C     ACOABL        IFne      *blanks
083810940824     C                   MOVEL     ERR(23)       VIDMSG
083820940922     C                   SETON                                        9050
083830940824     C                   GOTO      ENDCCM
083840940921    2C                   END
083850941011     C*
083860941011     C                   MOVEL     ACORAG        VIDDMT
083870940824     C*
083880940921    2C     WCCM          IFNE      8888
083890940909     C     WCCM          ANDNE     9999
083900940824     C     KACO          CHAIN     CNIND000                           30
083910940921    3C     *IN30         IFEQ      *ON
083920940824     C                   MOVEL     ERR(22)       VIDMSG
083930940922     C                   SETON                                        9050
083940940921    3C                   ENDIF
083950000509     C* PER BOLLA LNP POSTE, AMMESSI SOLO CLIENTI POSTE E VICEVERSA
083960020319     c     §ogntw        ifeq      'PPT'
083970020319     c     clintw        oreq      'PPT'
083980020319     C     §ogntw        IFNE      clintw
083990000509     C                   MOVEL     ERR(200)      VIDMSG
084000000509     C                   SETON                                        9050
084010020319     c                   endif
084020000509    3C                   ENDIF
084030000509     C*
084040970703     C* CONTROLLO LA NAZIONE
084050970703     C* VISTO CHE E' UN CODIFICATO PRENDO LA DIVISA CHE MI PUO' SERVIRE
084060970703     C*  PER L'IMPORTO DA ASSICURARE O VALORE MERCE DICHIARATO
084070970703     C                   MOVEL     '15'          COD
084080970703     C                   MOVEL(P)  INDSTA        KEY
084090970703     C                   EXSR      CTABEL
084100970703     C* NAZIONE ERRATA
084110970703    3C     *IN30         IFEQ      *ON
084120970703     C                   MOVEL     ERR(28)       VIDMSG
084130970703     C                   SETON                                        9050
084140970703   X3C                   ELSE
084150970703     C                   MOVEL     TBLUNI        DS15
084160970703     C                   MOVEL     §15VLT        MITVLT
084170970703    4C     §15ITA        IFNE      'I'
084180970703     C                   MOVEL     'E'           WMITIE            1
084190970703     C                   ELSE
084200970703     C                   MOVEL     'I'           WMITIE
084210970703    4C                   ENDIF
084220970703    3C                   ENDIF
084230970704     C*
084240970704     C* controllo se esiste in anagrafica la provincia
084250970704     C* SOLO SE NAZIONE ITALIA CIOE' ='   '
084260970704     C     INDSTA        IFEQ      *BLANKS
084270970704    3C     INDPRV        ANDEQ     *BLANKS
084280970704     C                   MOVEL     ERR(128)      VIDMSG
084290970704     C                   SETON                                        9050
084300970704     C                   GOTO      ENDCCM
084310100120    3C                   ENDIF
084320970703     C*
084330970703     C* CAP OBBLIGATORIO : CONTROLLO
084340970703     C                   CLEAR                   DSSI95
084350970708     C                   CLEAR                   DSLV13
084360970703     C                   MOVEL     '3'           I95TCN
084370970703     C                   MOVEL     INDCAE        I95CAP
084380970703     C                   MOVEL     INDSTA        I95NAR
084390970703     C                   MOVEL     INDPRV        I95PRV
084400970703     C                   MOVEL     INDCIT        I95LOC
084410970714     C                   MOVEL     BLPDSP        I95DAT
084420971201     C     §3AFCA        IFNE      0
084430971201     C                   MOVEL     'S'           I95FCA
084440971201     C                   ENDIF
084450971201     C                   MOVEL     FLGTB1        I95TPO
084460970708     C* ERRORE AFFIDABILITA = 0
084470970708     C                   MOVEL     'S'           I13AF0
084480970708     C* CONTROLLO CONGRUENZA CAP PROVINCIA
084490970708     C                   MOVEL     'S'           I13CNG
084500970708     C* CONTROLLO NON FORZABILE CITTA' CON VIARIO
084510100120     C*******            MOVEL     'S'           I13CNV
084520020212     c*
084530020212     c* mittente fedex passo flag apposito per dire di prendere i dati i
084540020212     c* dalla tabella della nazione
084550020212     c     §ogntw        ifeq      'FED'
084560020212     c                   movel     'S'           i95fi1
084570020212     c                   endif
084580970703     C                   CALL      'FNLV13R'
084590970708     C                   PARM                    KPJBA
084600970708     C                   PARM                    DSLV13
084610970708     C                   PARM                    DSSI95
084620941230     C* ERRORE
084630970708     C     O13ERR        IFNE      *BLANKS
084640970708     C                   MOVEL     O13MSG        W077A            77
084650970703     C* IMPOSTO IL MESSAGGIO METTENDO VICIVO LA SCRITTA:
084660970703     C*   "SUL PIANO DEI CONTI"
084670970703     C                   CLEAR                   K78
084680970703     C                   MOVEA     W077A         K78
084690970703     C     ' '           CHECKR    W077A         WP                2 0
084700970703     C                   ADD       2             WP
084710970703     C     WP            IFLT      61
084720970703     C                   MOVEA     CPDC          K78(WP)
084730970703     C                   MOVEA     K78           VIDMSG
084740970703     C                   ELSE
084750970703     C                   MOVEL     O95MSG        VIDMSG
084760970703     C                   MOVE      CPDC          VIDMSG
084770970703     C                   ENDIF
084780940922     C                   SETON                                        9050
084790941231     C                   GOTO      ENDCCM
084800941231    3C                   ENDIF
084810941230     C* SALVO IL FLAG ANTEPORTO
084820970703     C                   MOVEL     O95ISO        COMFAP
084830970708     C                   MOVEL     O95ISO        VIDFAP
084840970708     C                   MOVEL     O95CTS        MITCTS
084850140403     C                   MOVEL     O95gf2        comgf2
084860940922     C*
084870940921    2C                   ENDIF
084880940824     C*
084890940824     C   90              GOTO      ENDCCM
084900940824     C*
084910940921     C* PER MANUTENZIONE O DISK CLI OBBLIGATORIO IL COD.CLI ORIGINALE
084920960805     C* OPPURE UN CODICE CLIENTE CON LA STESSA SERIE
084930980410    1C   12§1BFG6        IFEQ      'C'
084940940824     C     §1BFG7        OREQ      'S'
084950940909    2C     WKSC          IFNE      SAVMIT
084960100517     c
084970960805     C*
084980100517     C**                 MOVEL     '3C'          COD
084990100517     C**                 MOVEL(P)  WKSC          KEY
085000960805     C*
085010100517     C**                 EXSR      CTABEL
085020100517     C**N30              MOVEL     TBLUNI        DS3C
085030960805     C*
085040100517    3C**   *IN30         IFEQ      *ON
085050100517     C**   §3CNRS        ORNE      VIDNRS
085060980805     C* E' VALIDA LA 3C SOLO SE HA L'ASTERISCO
085070100517     C**   §3COKD        ORNE      '*'
085080100517     C**                 MOVEL     ERR(67)       VIDMSG
085090100517     C**                 SETON                                        5090
085100100517    3C**                 ENDIF
085110100517     c
085120100517     c                   clear                   trulnrsds
085130100517     c                   movel     wksc          inrsCCM
085140100517     c                   movel     vidnrs        inrsNRS
085150100517     c                   movel     wfls          inrsFLS
085160100517     c
085170100517     c                   call      'TRULNRSR'
085180100517     c                   parm                    trulnrsds
085190100517     c                   if        onrserr<>' '
085200100517     C                   MOVEL     ERR(67)       VIDMSG
085210100517     C                   SETON                                        5090
085220100517    3C                   endif
085230100517     c
085240960805    2C                   END
085250940825    1C                   END
085260940825     C*
085270940825     C   90              GOTO      ENDCCM
085280940825    0C                   ENDIF
085290940824     C*
085300940824     C* CONTROLLI CODICE BOLLA CON CODICE CLIENTE
085310940825    0C     WCBO          IFNE      *BLANKS
085320941103    1C  N04WCCM          IFEQ      9999
085330940824     C                   MOVEL     ERR(11)       VIDMSG
085340940922     C                   SETON                                        5090
085350940825    1C                   END
085360940824     C* SE ASSEGNATO
085370940909    1C   04WCCM          IFEQ      8888
085380940824     C                   MOVEL     ERR(11)       VIDMSG
085390940922     C                   SETON                                        5090
085400940825    1C                   ENDIF
085410940824     C*
085420940824     C   90              GOTO      ENDCCM
085430940825    0C                   ENDIF
085440950125     C*
085450950125     C* SE E' FRANCO NON  SI PUO' TASSARE CON TARIFFA MITTENTE
085460990720    0C  N04WCBO          IFNE      *BLANKS
085470990720     C     WFTM          ANDEQ     'S'
085480950717     C                   MOVEL     ERR(119)      VIDMSG
085490950125     C                   SETON                                        5090
085500950125     C                   GOTO      ENDCCM
085510990720    0C                   ENDIF
085520940825     C*
085530020507     C* SE 8888 O 9999
085540940909    0C     WCCM          IFEQ      8888
085550940909     C     WCCM          OREQ      9999
085560940825     C*
085570950125     C* NON E' POSSIBILE IMMETTERE TASSAZIONE CON TAR MIT
085580940825    1C     WFTM          IFEQ      'S'
085590950717     C                   MOVEL     ERR(119)      VIDMSG
085600940922     C                   SETON                                        5090
085610940825     C                   GOTO      ENDCCM
085620940825    1C                   ENDIF
085630940921     C*
085640940921     C* SE PRIMA ERA CODIFICAT E ADESSO NO PULISCO I CAMPI DEL MITTENTE
085650990720    1C     WCCM          IFNE      WCCMS
085660950125     C                   CLEAR                   V2DTEL
085670940921     C*
085680940921     C* NON PULISCO SE CAMBIATO CODICE DA 8888 A 9999 O VICEVERSA
085690020507     C     WCCMS         ifNE      9999
085700940921     C     WCCMS         ANDNE     8888
085710010213     C*
085720940921     C                   CLEAR                   VIDRSM
085730940921     C                   CLEAR                   VIDLOM
085740940921     C                   CLEAR                   VIDINM
085750940921     C                   CLEAR                   VIDCAM
085760940921     C                   CLEAR                   VIDPRM
085770940921     C                   CLEAR                   VIDNZM
085780940921     C                   CLEAR                   VIDPIM
085790940921     C                   CLEAR                   VIDFAP
085800061110     C                   CLEAR                   VIDcdf
085810020507     c
085820990720    2C                   ENDIF
085830940921     C                   MOVEL     WCCM          WCCMS
085840990720    1C                   ENDIF
085850020507     c* se richiesta bolla firmata i dati del mittente sono quelli del
085860020507     c* p.o. mittente
085870020513     c     vidcbo        ifeq      'FO'
085880020507     c     wflc          chain     azorg01l      uniorg               30
085890020507     c                   movel     orgdes        vidrsm
085900020507     c                   movel     orgind        vidinm
085910020507     c                   movel     orgcpf        vidcam
085920020507     c                   movel     orgloc        vidlom
085930020507     c                   movel     orgpro        vidprm
085940020507     c                   endif
085950000113     C* SE E' IN PERSONALIZZAZIONE, RIPROTEGGO, E PROTETTO
085960000113     C   19              SETON                                        02
085970940825     C*
085980940825   X0C                   ELSE
085990110519     c* in immissione controllo se per il cliente mittente sono
086000110519     c* presenti bolle da confermare
086010110519     c* Se ce ne sono: messaggio forzabile
086020110519    3c                   if        not *in12
086030110519     c                   exsr      sr_chkvab
086040110519     c                   if        wemfor='1'
086050110519     c                   goto      endccm
086060110519     c                   endif
086070110519    3c                   endif
086080960926     C* SE TUTTO OK E NON E' 8888 O 9999 E CLIENTE DI ALTRO P.O.
086090940921     C* PROTEGGO IL MITTENTE E MEMORIZZO I CAMPI
086100940909     C*
086110940825     C                   SETON                                        02
086120990720    1C     WPERSO        IFEQ      'P'
086130950303     C                   SETON                                        19
086140990720    1C                   END
086150940909     C                   MOVEL     ACORAG        VIDRSM
086160940909     C                   MOVEL     INDCIT        VIDLOM
086170940909     C                   MOVEL     INDVIA        VIDINM
086180941005     C                   MOVEL     INDCAE        VIDCAM
086190940909     C                   MOVEL     INDPRV        VIDPRM
086200940909     C                   MOVEL     INDSTA        VIDNZM
086210940909     C                   MOVEL     INDIVA        WISO
086220990720    1C     WISO          IFGE      '00'
086230940909     C                   MOVEL     INDIVA        VIDCPM
086240120504     C                   clear                   VIDism
086250940909     C                   ELSE
086260940909     C                   MOVEL     INDIVA        VIDPIM
086270990720    1C                   END
086280120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
086290120508     c* in contabilità crea problemi
086300120508     c                   if        *in22 and wiso='$$'
086310120508     c                   clear                   vidpim
086320120508     c                   endif
086330061110     c   22              movel     indcdf        vidcdf
086340950123     C*
086350950123     C                   MOVE      INDTEL        V2DTEL
086360950123     C                   MOVEL     'Tel.'        V2DTEL
086370940825    0C                   ENDIF
086380940824     C* OK
086390940825    0C     WPERSO        IFEQ      'P'
086400950303     C                   SETON                                        85
086410940825    0C                   END
086420990720     C                   CLEAR                   WCOCCM
086430110921     c* accedo a tabella "CLI" del cliente mittente
086440080104     c                   clear                   dcli
086450110921     c****               if        *in12 and not *in15 and
086460110921     c*****                        vidnrs>0
086470071218     c                   exsr      sr_dcli
086480110922     c****               endif
086490061110     c
086500061110     c* se no prepagato solo sottolineato il campo del codice fiscale
086510061110     c  n22              movel     ul            atrcdf
086520940824     C*
086530940824     C     ENDCCM        TAG
086540940824     C   90              MOVEL     '1'           WEMFOR
086550940824     C                   ENDSR
086560941103     C*
086570941103     C* CONTROLLO IL MITTENTE ORIGINALE ------------------------------*
086580941103     C     CTRMO         BEGSR
086590941103     C*
086600941103    0C     *IN03         IFEQ      *OFF
086610941103     C*
086620941103     C* SE IMMESSO CAP O NAZIONE IMMETTERE TUTTI E 3
086630941103    1C     WCMO          IFNE      *BLANKS
086640950206     C     WRMO          ANDEQ     *BLANKS
086650941103     C                   MOVEL     ERR(100)      VIDMSG
086660941103     C                   SETON                                        7190
086670941103     C                   GOTO      ENDCMO
086680941103    1C                   ENDIF
086690941103     C*
086700941103    1C     WNAR          IFNE      *BLANKS
086710941103    2C     WCMO          IFEQ      *BLANKS
086720941103     C     WRMO          OREQ      *BLANKS
086730941103     C                   MOVEL     ERR(100)      VIDMSG
086740941103     C                   SETON                                        7190
086750941103     C                   GOTO      ENDCMO
086760941103    2C                   ENDIF
086770941103    1C                   ENDIF
086780941103     C*
086790941103     C* CONTROLLO NAZIONE MITTENTE ORIGINALE
086800941103    1C     WNAR          IFNE      *BLANKS
086810941103     C                   EXSR      CTRNAR
086820941103    2C     WEMFOR        IFEQ      '1'
086830941103     C                   SETOFF                                       68
086840941103     C                   SETON                                        73
086850941103     C                   GOTO      ENDCMO
086860941103    2C                   END
086870950215    1C                   END
086880941103     C*
086890941103     C* CONTROLLO ESISTENZA CAP MITTENTE ORIGINALE
086900950215    1C     WCMO          IFNE      *BLANKS
086910970708     C**
086920970708     C* CAP CON VIARIO --> ERRORE FORZABILE
086930970708    2C     WCMO          IFNE      VARCMO
086940970708     C                   CLEAR                   DUE
086950970708     C                   MOVEL     WCMO          VARCMO
086960970708    2C                   ENDIF
086970970708     C**
086980970704     C                   CLEAR                   DSSI95
086990970708     C                   CLEAR                   DSLV13
087000970704     C                   MOVEL     WNAR          I95NAR
087010970704     C                   MOVEL     WCMO          I95CAP
087020970704     C                   MOVEL     '3'           I95TCN
087030970708     C* NON POSSO DARE ERRORE PER AFFIDABILITA=0 PERCHE' NON HO LA
087040970708     C*  PROVINCIA
087050970708     C                   MOVEL     'S'           I13CNV
087060970708     C                   MOVEL     'S'           I13SZV
087070970708     C                   MOVEL     DUE           E13FZV
087080970704     C                   CALL      'FNLV13R'
087090970708     C                   PARM                    KPJBA
087100970708     C                   PARM                    DSLV13
087110970708     C                   PARM                    DSSI95
087120970708     C* FLAG FORZATURA
087130970708     C                   MOVEL     E13FZV        DUE
087140941103     C*
087150941103     C* SE CAP NON TROVATO  ERRORE
087160970708    2C     O13ERR        IFNE      *BLANKS
087170970708     C                   MOVEL     O13MSG        VIDMSG
087180941103     C                   SETON                                        7290
087190941103     C                   GOTO      ENDCMO
087200970704    2C                   ENDIF
087210941103     C*
087220941103    1C                   ENDIF
087230941103     C*
087240941103     C     WPERSO        IFEQ      'P'
087250941103     C                   SETON                                        03
087260941103     C                   ENDIF
087270941103     C*
087280941103     C     ENDCMO        TAG
087290941103     C   90              MOVEL     '1'           WEMFOR
087300941103    0C                   ENDIF
087310941103     C*
087320941103     C                   ENDSR
087330940913     C*
087340940913     C* CONTROLLO CONSEGNA RICHIESTA ---------------------------------*
087350940913     C     CTRCR         BEGSR
087360940913     C*
087370940913    1C     *IN16         IFEQ      *OFF
087380971007    2C     WDCR          IFEQ      0
087390940913     C                   Z-ADD     0             COMDCR
087400940913     C* DATA
087410971007   X2C                   ELSE
087420940913     C                   Z-ADD     WDCR          G02DAT
087430940913     C                   MOVEL     *BLANKS       G02ERR
087440940913     C                   CALL      'XSRDA8'
087450941115     C                   PARM                    WLBDAT
087460941115     C* ERRORE
087470940913    3C     G02ERR        IFEQ      '1'
087480940913     C                   MOVEL     ERR(19)       VIDMSG
087490941102     C                   SETON                                        5990
087500940913     C                   GOTO      ENDCR
087510940913    3C                   END
087520940913     C*  SE CAMBIATA LA DATA CONSEGNA RICHIESTA PULISCO LA FORZATURA
087530940913    3C     G02INV        IFNE      COMDCR
087540940913     C                   MOVEL     ' '           UNO
087550030417     c                   Clear                   fordcr
087560940913    3C                   ENDIF
087570940916     C*
087580940913     C                   MOVE      G02INV        COMDCR            8 0
087590940916     C                   MOVE      G02DAT        WDCR
087600940913     C*
087610940913     C* SE < ALLA DATA SPEDIZIONE: ERRORE
087620940913    3C     COMDCR        IFLT      BLPDSP
087630940916     C                   MOVEL     ERR(19)       VIDMSG
087640941102     C                   SETON                                        5990
087650940913     C                   GOTO      ENDCR
087660940913    3C                   ENDIF
087670101022     c* Verifico che non cada in giorno festivo per "IL"
087680101022     c* In personalizzazione lo posso fare solo col calendario partenza
087690101022     c                   if        WPERSO='P' and   wtcr=' '
087700101022     c                   movel     comdcr        wdata
087710101022     C                   CLEAR                   W0030
087720101022     C     KCLN          CHAIN     AZCLN01L                           30
087730101022     C   30              CLEAR                   CLNPOM
087740101022     C                   MOVEA     CLNPOM        K31
087750101022     C                   MOVEL     K31(WGG)      WFEST
087760101022     c     wfest         lookup    S1Y                                    30
087770101022     c
087780101022    4c                   if        *in30 and wfest<>' '
087781141124     c                   select
087782141124     c                   when      v0clna=*blanks or
087783141124     c                             (a_§ogntw<>'DPD' and a_§ogntw<>'EEX'
087784141124     c                              and a_§ogntw<>'FED')
087790101022     C                   MOVEL     ERR(197)      VIDMSG
087800101022     C                   SETON                                        5990
087810101022     C                   GOTO      ENDCR
087811141124     c                   when      v0clna<>wforz_lnap
087812141124     c                   eval      wforz_lnap=v0clna
087813141124     C                   MOVEL     ERR(197)      VIDMSG
087814141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
087815141124     C                   SETON                                        5990
087816141124     C                   GOTO      ENDCR
087817141124     c                   endsl
087820101022    4c                   endif
087830101022    3c                   endif
087840940913     C*
087850940913     C* 16 ON - PERSONALIZZAZIONE
087860940913    3C     WPERSO        IFEQ      'P'
087870940913     C                   SETON                                        16
087880940913    3C                   ENDIF
087890940913    2C                   ENDIF
087900940913    1C                   ENDIF
087910030409
087920051214      **Se sono in personalizzazione controllo che la data consegna
087930051214      **richiesta non sia superiore a oggi + i giorni previsti in §vpodcg
087940051214     c***                If        Wperso = 'P' and ComDcr > woggi5
087950051214     c***                Eval      *In59 = *On
087960051214     c***                Eval      *In90 = *On
087970051214     c***                Eval      VidMsg = Err(277)
087980051214     c***                Eval      VidMsg = %trim(vidmsg) + ' ' +
087990051214     c***                          %trim(%editc(§vpodcg:'Z'))  +
088000051214     c***                          ' giorni dalla data odierna'
088010051214     c***                GoTo      EndCr
088020051214     c***                EndIf
088030051214     c* controllo che la data consegna richiesta non sia superiore a oggi +
088040051214     c* i giorni previsti in tabella VPO
088050051214     c                   if        wtcr = 'P'
088060051214     c                   z-add     woggidcgm1    s_woggidcg
088070051214     c                   z-add     §vpodcgm1     s_vpodcg
088080051214     c                   else
088090051214     c                   z-add     woggidcgm2    s_woggidcg
088100051214     c                   z-add     §vpodcgm2     s_vpodcg
088110051214     c                   endif
088120051214     c*
088130051214     c                   if        comdcr > s_woggidcg
088140051214     c                   Eval      *In59 = *On
088150051214     c                   Eval      *In90 = *On
088160051214     c                   Eval      VidMsg = Err(277)
088170051214     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
088180051214     c                             %trim(%editc(s_vpodcg:'Z'))  +
088190051215     c                             ' giorni dalla data odierna.'
088200051214     c                   GoTo      EndCr
088210051214     c                   endif
088220030416
088230030416      * Controllo che la data consegna richiesta non sia superiore a oggi + 1 mm
088240051214     c*                  If        ComDcr > woggi1m
088250051214     c*                            and fordcr = *Blanks
088260051214     c*                  Eval      *In59 = *On
088270051214     c*                  Eval      *In90 = *On
088280051214     c*                  Eval      VidMsg = Err(1)
088290051214     c*                  Eval      fordcr = '1'
088300051214     c*                  GoTo      EndCr
088310051214     c*                  EndIf
088320030409
088330940913     C* ORA
088340940920    1C     *IN23         IFEQ      *OFF
088350940913     C*
088360150202    2C***  WHCR          IFLT      0
088370150202     C***  WHCR          ORGT      24
088371150203     c                   if        whcr>0  or wmcr>0
088373150202    2C     WHCR          IFLT      08
088375150202     C     WHCR          ORGT      20
088380940913     C                   MOVEL     ERR(20)       VIDMSG
088390960319     C                   SETON                                        6090
088400940913     C                   GOTO      ENDCR
088410940913    2C                   ENDIF
088411150202    2C                   ENDIF
088420940913     C*
088430940913    2C     WMCR          IFLT      0
088440940913     C     WMCR          ORGT      59
088450940913     C                   MOVEL     ERR(20)       VIDMSG
088460960319     C                   SETON                                        6090
088470940913     C                   GOTO      ENDCR
088480940913    2C                   ENDIF
088481150203     c*
088482150203     c                   if        whcr=20 and wmcr>0
088483150203     C                   MOVEL     ERR(20)       VIDMSG
088484150203     C                   SETON                                        6090
088485150203     C                   GOTO      ENDCR
088486150203     c                   endif
088487150203
088490940916     C* PERSONALIZZAZIONE
088500940913    2C     WPERSO        IFEQ      'P'
088510941102    3C     WHCR          IFNE      0
088520941102     C     WMCR          ORNE      0
088530940920     C                   SETON                                        23
088540940913    3C                   ENDIF
088550940913    2C                   ENDIF
088560940913     C*
088570941102     C* SE IMMESSO TIPO DEVO IMMETTERE ANCHE ORA O DATA
088580941005    2C     WTCR          IFNE      ' '
088590941102     C*
088600941102    3C     WDCR          IFEQ      0
088610941102     C     WHCR          ANDEQ     0
088620941102     C     WMCR          ANDEQ     0
088630941102     C                   MOVEL     ERR(43)       VIDMSG
088640941102     C                   SETON                                        5990
088650941102     C                   GOTO      ENDCR
088660941102    3C                   ENDIF
088670941102     C*
088680941102    3C     WPERSO        IFEQ      'P'
088690940913     C                   SETON                                        17
088700941102    3C                   ENDIF
088710941005    2C                   ENDIF
088720941005    1C                   ENDIF
088730940913     C*
088740940916     C     ENDCR         ENDSR
088750900427     C*
088760900427     C* CONTROLLO DATI FORMATO1 --------------------------------------
088770020531     C     CTRD01        BEGSR
088780961111     C                   SETOFF                                       953976
088790000915     C                   SETOFF                                       33
088800941003     C                   CLEAR                   WEMFOR
088810010412     C                   CLEAR                   WEFORM
088820941115     C                   CLEAR                   VIDMSG
088830070323     c                   if        *in12='0' or *in15='1'
088840070322     c                   clear                   wparcel
088850070323     c                   endif
088860950127     C***
088870950127     C*** ESEGUO RICERCA ALFABETICA
088880950127     C                   MOVEL     VIDCCM        WCCM
088890950209     C                   MOVEL     VIDLNP        WLNP
088900950127     C     VIDFLC        IFNE      0
088910950127     C                   Z-ADD     VIDFLC        WFLC
088920950127     C                   ELSE
088930950127     C                   Z-ADD     VIDLNP        WFLC
088940950127     C                   ENDIF
088950950127     C                   MOVEL(P)  VIDDMT        PAXDMT
088960950127     C                   EXSR      RICALF
088970950127     C                   MOVEL     WCCM          VIDCCM
088980050215     C                   MOVEL(p)  PAXDMT        VIDDMT
088990950127     C     *IN14         IFEQ      *ON
089000950127     C                   MOVEL     WFLC          VIDFLC
089010950127     C                   ENDIF
089020010216     C     WEMFOR        IFEQ      '1'
089030010216     C                   GOTO      ENDC01
089040010216     C                   ENDIF
089050970925     C***
089060970925     C*** DATA SPEDIZIONE ***
089070970925     C                   EXSR      CTRDSP
089080970925     C   90              GOTO      ENDC01
089090950208     C***
089100950208     C*** LINEA PARTENZA ***
089110950208     C                   MOVEL     VIDLNP        WLNP
089120950208     C                   EXSR      CTRLNP
089130950208     C   90              GOTO      ENDC01
089140991206      *
089150991206      * PER LNP DPD OBBLIGATORIO 1 COLLO
089160020319     C     §OGNTW        IFEQ      'DPD'
089170000509     C     V1CNCL        ANDNE     1
089180991206     C                   SETON                                        6290
089190991206     C                   MOVEL     ERR(178)      VIDMSG
089200991206     C                   GOTO      ENDC01
089210000509     C                   ENDIF
089220010212     C***
089230010212     C*** NUMERO O.R.M.
089240010212     C*
089250010212     C* Controllo solo se attivata procedura O.R.M.
089260010212     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
089270010212     c* fine dell'immissione
089280010212     C     WORM          IFEQ      'S'
089290010212     C     PARTCH        ANDNE     'P'
089300010213     C                   Z-ADD     VIDPOE        WOPOE
089310010213     C                   Z-ADD     VIDNOR        WONOR
089320010213     C                   Z-ADD     VIDNRV        WONRV
089330010213     C                   Z-ADD     VIDLNP        WOLNP
089340010212     C                   EXSR      CTRORM
089350010212     C   90              GOTO      ENDC01
089360010216     C     WEMFOR        IFEQ      '1'
089370010216     C                   GOTO      ENDC01
089380010216     C                   ENDIF
089390010212     C* Propongo campi da O.R.M. se non immessi da utente
089400010212     C* ** Solo se orm non è fittizio **
089410010212     C     FLGFIT        IFEQ      *BLANKS
089420010215     C                   EXSR      PRPOR1
089430010213     C   90              GOTO      ENDC01
089440010212     c* Se ho proposto dei campi non continuo i controlli ma devo
089450010212     c* riemettere videata per visualizzare i dati aggiunti
089460050119     c* idem se richiesto espressamente di non continuare i controlli
089470010212     C     WEFORM        IFEQ      '1'
089480050119     c     wsolo_prp     oreq      '1'
089490040915     c* posizionamento cursore su cod mittente dopo proposte campi da orm
089500040915     c* se però cod.mittente personalizzato mi posiziono su n.ro colli
089510041108     c**** *in19         ifeq      *off
089520041108     c**** *in85         andeq     *off
089530041108     c**** *in38         andeq     *off
089540041108     c****               z-add     12            h1riga
089550041108     c****               z-add     24            h1colo
089560041108     c****               else
089570041129     c     *in38         ifeq      *off
089580041108     c**** *in19         ifeq      *on
089590041108     c**** *in85         oreq      *on
089600040915     c                   z-add     13            h1riga
089610040915     c                   z-add     20            h1colo
089620040915     c                   endif
089630041108     c*****              endif
089640041108     c*****              endif
089650050321     c                   eval      weform = '1'
089660010212     C                   GOTO      ENDC01
089670010212     C                   ENDIF
089680010212     C                   ENDIF
089690010212     C                   ENDIF
089700010227     C* SE PREMUTO F8 MA PROC.ORM NON ATTIVATA RIEMETTO LA VIDEATA
089710010227     C   KH              MOVEL     '1'           WEMFOR
089720010227     C   KH              GOTO      ENDC01
089730940920     C***
089740940920     C*** SIGLA OPERATORE ***
089750940920     C* CONTROLLO SOLO SE NON E' PROTETTO
089760941011     C     *IN13         IFEQ      *OFF
089770940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
089780940920     C                   MOVEL     '3M'          COD
089790940920     C                   MOVEL(P)  VIDSOP        KEY
089800940920     C                   EXSR      CTABEL
089810940920     C     *IN30         IFEQ      *OFF
089820950713     C     VIDSOP        OREQ      ' '
089830940920     C                   MOVEL     ERR(29)       VIDMSG
089840940923     C                   SETON                                        4290
089850940920     C                   GOTO      ENDC01
089860940920     C                   ENDIF
089870940920     C                   ENDIF
089880940823     C***
089890990628     C*** DATA RITIRO MERCE E PRESTAZIONE M/P ***
089900020131     C                   EXSR      CTRDRT
089910940920     C   90              GOTO      ENDC01
089920940823     C***
089930960926     C*** CODICE AUTOTRASPORTATORE ***
089940940824     C                   MOVEL     VIDPDR        WPDR
089950940824     C                   EXSR      CTRPDR
089960940824     C                   MOVEL     WPDR          VIDPDR
089970940824     C     WEMFOR        IFEQ      '1'
089980940920     C                   GOTO      ENDC01
089990940824     C                   ENDIF
090000940823     C***
090010921006     C*** NUMERO SPEDIZIONE ***
090020990602     C  N12PARTCH        IFEQ      'R'
090030921006     C     RECNSP        ANDEQ     0
090040940823     C                   MOVEL     ERR(33)       VIDMSG
090050940923     C                   SETON                                        6190
090060940920     C                   GOTO      ENDC01
090070921006     C                   END
090080950127     C***
090090950127     C*** NUMERO COLLI ***
090100950127     C     V1CNCL        IFEQ      0
090110950127     C                   MOVEL     ERR(34)       VIDMSG
090120950127     C                   SETON                                        6290
090130950127     C                   GOTO      ENDC01
090140950127     C                   END
090150950127     C***
090160950127     C*** PESO   ***
090170950127     C* LO CONTROLLO SOLO IN SECONDA VIDEATA SE CARICAMENTO DISK  CLI
090180950127     C* >< DA 0
090190980402     C*
090200980402     C* OBBLIGATORIO
090210950127     C  N12VIDPKG        IFEQ      0
090220950127     C                   MOVEL     ERR(46)       VIDMSG
090230950127     C                   SETON                                        6390
090240950127     C                   GOTO      ENDC01
090250950127     C                   ENDIF
090260980402     C*
090270980402     C* NON MAGGIORE DEL LIMITE POSTO (forzabile)
090280090609     C* N12VIDPKG        IFGT      §QTPKB
090290090609     C*    VIDPKG        ANDNE     SAVPKG
090300090609     C*                  MOVE      VIDPKG        SAVPKG
090310090609     C*                  CLEAR                   WPT1
090320980623     C* PREPARO MSG
090330090609     C*                  MOVEA     ERR(52)       K78
090340090609     C*                  MOVEL     §QTPKB        W006A             6
090350090609     C*                  MOVEA     W006A         SKI(10)
090360090609     C*                  Z-ADD     10            I                 3 0
090370090609     C*                  EXSR      ABBL
090380090609     C*                  MOVEA     SKI(10)       K78(34)
090390090609     C*                  MOVE      §QTPKB        W001A
090400090609     C*                  MOVEL     W001A         K78(41)
090410090609     C*                  MOVEA     K78           VIDMSG
090420090609     C*                  SETON                                        6390
090430090609     C*                  GOTO      ENDC01
090440090609     C*                  ENDIF
090450940823     C***
090460940823     C*** CODICE BOLLA ***
090470940824     C                   MOVEL     VIDCBO        WCBO
090480940824     C                   EXSR      CTRCBO
090490940824     C                   MOVEL     WCBO          VIDCBO
090500940824     C     WEMFOR        IFEQ      '1'
090510940920     C                   GOTO      ENDC01
090520940824     C                   ENDIF
090530940929     C***
090540940929     C*** CODICE MITTENTE ***
090550940929     C                   MOVEL     VIDFTM        WFTM
090560940929     C                   MOVEL     VIDCCM        WCCM
090570940929     C     VIDFLC        IFNE      0
090580940929     C                   Z-ADD     VIDFLC        WFLC
090590940929     C                   ELSE
090600940929     C                   Z-ADD     VIDLNP        WFLC
090610941108     C                   ENDIF
090620940929     C                   EXSR      CTRCCM
090630941011     C                   MOVEL     WCCM          VIDCCM
090640941011     C     *IN14         IFEQ      *ON
090650941011     C                   MOVEL     WFLC          VIDFLC
090660941011     C                   ENDIF
090670941011     C*
090680940929     C     WEMFOR        IFEQ      '1'
090690940929     C                   GOTO      ENDC01
090700940929     C                   ENDIF
090710940823     C***
090720940823     C*** TIPO SERVIZIO ***
090730940824     C                   MOVEL     VIDTSP        WTSP
090740940929     C                   EXSR      CTRTSP
090750940929     C                   MOVEL     WTSP          VIDTSP
090760940824     C     WEMFOR        IFEQ      '1'
090770940920     C                   GOTO      ENDC01
090780940824     C                   ENDIF
090790940823     C***
090800940823     C*** CODICE TRATTAMENTO MERCE ***
090810940824     C*
090820940824     C* SE CODICE BOLLA PREVEDE IL CODICE TRATTAMENTO MERCE QUESTO
090830940824     C* PREVALE SUL CODICE DELL'ANAGRAFICA E SU QUELLO DIGITATO
090840940824     C     §3ACTM        IFNE      *BLANKS
090850940929     C                   MOVEL     §3ACTM        WCTM
090860940824     C                   ELSE
090870940824     C* SE NON IMMESSO PRENDO VALORE DI DEFAULT
090880940824     C     VIDCTM        IFEQ      *BLANKS
090890940929     C                   MOVEL     COMCTM        WCTM
090900940929     C                   ELSE
090910940929     C                   MOVEL     VIDCTM        WCTM
090920940824     C                   ENDIF
090930940824     C                   ENDIF
090940940824     C*
090950940824     C* CONTROLLO
090960950504     C                   CLEAR                   W003A
090970940929     C                   MOVEL     WCTM          W003A
090980940824     C                   EXSR      CTRCTM
090990940929     C* SCRIVO IL CTM SOLO SE AVEVO DIGITATO UN '?'
091000941005     C* SE IMPOSTO QUELLO DI DFT NON LO FACCIO VEDERE A VIDEO
091010940929     C     '?'           SCAN      W003A                                  30
091020940929     C     *IN30         IFEQ      *ON
091030940824     C                   MOVEL     WCTM          VIDCTM
091040940929     C                   ENDIF
091050940824     C     WEMFOR        IFEQ      '1'
091060940920     C                   GOTO      ENDC01
091070940824     C                   ENDIF
091080121106
091090121106     c* Non posso utilizzare un CTM che mantiene in numero di spedizione
091100121106     c*  se = 0
091110121106     C   12
091120121106    1Can 15§1BFG3        IFEQ      'S'
091130121106     c     vidnsp        andeq     0
091140121106     C                   MOVEL     ERR(72)       VIDMSG
091150121106     c                   eval      %subst(vidmsg:20:2)=vidctm
091160121106     C                   SETON                                        4990
091170121106     C                   GOTO      ENDC01
091180121106    1C                   END
091190940824     C*
091200910828     C* SE FLAG6=M O C  OBBLIGATORIA LA LINEA DI ARRIVO
091210910828     C     §1BFG6        IFEQ      'M'
091220910828     C     §1BFG6        OREQ      'C'
091230921019     C     §1BFG8        ANDNE     'N'
091240940823     C*
091250910828     C     VIDLNA        IFEQ      *BLANKS
091260910828     C     VIDLNA        OREQ      *ZEROS
091270940823     C                   MOVEL     ERR(14)       VIDMSG
091280940923     C                   SETON                                        4790
091290940920     C                   GOTO      ENDC01
091300910828     C                   END
091310910828     C                   END
091320081107     c* controllo la congruenza fra codice bolla e il codice trattamento merce
091330081107     c                   exsr      ctrcbo_ctm
091340081107     C     *in90         IFEQ      '1'
091350081107     C                   GOTO      ENDC01
091360081107     C                   ENDIF
091370910828     C*
091380910828     C* PER DISK CLI CONTROLLO ESISTENZA DETTAGLIO SEGNACOLLI X FLG7=S
091390950718     C   15
091400950718     CAN 12§1BFG7        IFEQ      'S'
091410020917     C     KBLC          SETLL     FIVAD000                               30
091420940823     C     *IN30         IFEQ      *OFF
091430940823     C                   MOVEL     ERR(37)       VIDMSG
091440940923     C                   SETON                                        6290
091450940920     C                   GOTO      ENDC01
091460970107     C                   ENDIF
091470950717     C* SE SEGNACOLLI DA CLIENTE, CONTROLLO CHE NON CI SIANO SEGNACOLLI
091480950717     C*  RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
091490950719     C     §1BFG6        IFEQ      'C'
091500980325     C                   EXSR      VADDOP
091510950717     C   90              GOTO      ENDC01
091520940823     C                   ENDIF
091530950719     C                   ENDIF
091540040601     C* PER DISK CLI CONTROLLO ESISTENZA estensione stmpa ddt x FLG16=S
091550040601     C   15
091560040603    1CAN 12§1BF16        IFEQ      'S'
091570130301     c                   clear                   wvax
091580130301     c                   clear                   wvatp
091590130301     C     KBLC          SETLL     FIVAX000
091600130301    2c                   if        %equal(fivax01l)
091610130301     c                   eval      wvax='S'
091620130301    2c                   endif
091630130301     C                   MOVEL     'P'           WTRC
091640130301     C     Kvat          SETLL     FIVAt000
091650130301    2C                   if        %equal(fivat01l)
091660130313     c* cliente abilitato al pdf: memkorizzo presenza pdf
091670130313     c                   eval      wvatp='S'
091680130313     c* cliente non abilitato alla gestione del PDF:
091690130313     c* memorizzo per l'invio mail di alert
091700130313     c                   if        §clipdfp=*blanks
091710130313     c                   eval      wvatpe='S'
091720130313     c                   endif
091730130301    2c                   endif
091740130301    2c                   if        wvax=*blanks and wvatp=*blanks
091750040601     C                   MOVEL     ERR(279)      VIDMSG
091760040601     C                   SETON                                        6290
091770040601     C                   GOTO      ENDC01
091780130313     c                   else
091790130313     c* cliente non abilitato al PDF
091800130313     c                   if        wvatp='S' and §clipdfp=*blanks
091810130313     C                   MOVEL     ERR(349)      VIDMSG
091820130313     C                   SETON                                        4990
091830130313     C                   GOTO      ENDC01
091840130313     c                   endif
091850040603    2C                   ENDIF
091860130301   2ac                   if        wvax='S'
091870040603     c                   clear                   s_vaxprr
091880040603    2c                   do        *hival
091890061010     c     kblc          reade(N)  fivax000
091900040603    3c                   if        %eof(fivax01l)
091910040603     c                   leave
091920040603    3c                   endif
091930040603    3c                   if        vaxprr = s_vaxprr
091940040603     C                   MOVEL     ERR(280)      VIDMSG
091950040603     c                   seton                                        6290
091960040603     C                   GOTO      ENDC01
091970040603   x3c                   else
091980040603     c                   eval      s_vaxprr=vaxprr
091990040603    3c                   endif
092000040603    2c                   enddo
092010041210     c* controllo esistenza logo su tabella ar8
092020041210     C                   CLEAR                   DSBS02
092030041210     C                   MOVEL     'C'           T02MOD
092040041210     C                   MOVEL     KNSIF         T02SIF
092050041210     C                   MOVEL     'AR8'         T02COD
092060041210     C                   MOVEL(P)  vaxtmd        T02KE1
092070041210      *
092080041210     C                   CALL      'TIBS02R'
092090041210     C                   PARM                    KPJBA
092100041210     C                   PARM                    DSBS02
092110041210      *
092120041210     C     T02ERR        IFne      *BLANKS
092130041210     C                   MOVEL     ERR(290)      VIDMSG
092140041210     c                   eval      vidmsg = %trim(vidmsg) + ' "' + vaxtmd + '" '
092150041210     c                             + 'per stampa Lettera di vettura.AVVISARE IL'
092160041210     c                             + ' CED'
092170041210     c                   seton                                        90
092180041210     C                   GOTO      ENDC01
092190041210     c                   endif
092200130301   2ac                   endif
092210130305     c* controlli pdf: verifico che non sia doppio negli ultimi 30gg
092220130304     c                   if        wvatp='S'
092230130304     c                   exsr      pdfdop
092240130304     c                   if        *in90
092250130304     C                   goto      ENDC01
092260130304     c                   endif
092270130301     c                   endif
092280040603    1C                   ENDIF
092290050221     c
092300970904     C**
092310970904     C* IN MANUTENZIONE NON SI PUO' VARIARE COLLI PER DISK CLIENTI B
092320050429     C   12
092330050429     CANN15V1CNCL        IFNE      SAVNCL
092340050429     C     §1BFG6        andeq     'C'
092350050429     C     §1BFG2        ANDEQ     'S'
092360050429     C                   MOVEL     ERR(69)       VIDMSG
092370050429     C                   SETON                                        6290
092380050429     C                   GOTO      ENDC01
092390050429     C                   ENDIF
092400940823     C***
092410940823     C*** LINEA ARRIVO ***
092420910805     C* IN MANUTENZIONE NON POSSO VARIARE LA LINEA PER DISK CLIENTI B
092430100210     c*  ES 10/02/10 parlando con Luciano ci sembrava non corretto far
092440100210     c*     modificare la data anche in conferma. Per evitare errori
092450100210     c*     anche dovuti al fatto che per servizio  H non ci può essere incongru
092460100210     c*     enza, metto il messaggio anche per la conferma
092470100210     c
092480100210     C*  12
092490100210     C*NN15§1BFG6        IFEQ      'C'
092500100210
092510100210     C   12§1BFG6        IFEQ      'C'
092520940928     C     SAVLNA        ANDNE     VIDLNA
092530071220     c     §clidkb       andne     'S'
092540100210     c     savlna        andgt     *zeros
092550940823     C                   MOVEL     ERR(13)       VIDMSG
092560940923     C                   SETON                                        4790
092570940920     C                   GOTO      ENDC01
092580910805     C                   END
092590020320     c* Non posso variare la linea di arrivo anche in base a §1bf14
092600020320     c   12
092610020320     cANN15§1bf14        ifeq      'S'
092620020320     C     SAVLNA        ANDNE     VIDLNA
092630020320     C                   MOVEL     ERR(249)      VIDMSG
092640020320     C                   SETON                                        4790
092650020320     C                   GOTO      ENDC01
092660020320     C                   END
092670970414     C* SE BOLLA DIROTTATA POSSO VARIARLA SOLO SE NON HO TRASMESSO
092680970414     C*  il LEGAME BOLLA
092690970414     C   12
092700970414     CANN15SAVLNA        IFNE      VIDLNA
092710970414     C     KBLP3         CHAIN(N)  FNLBL000                           32
092720970724     C  N32LBLFT1        IFNE      ' '
092730970414     C     LBLFT2        ORNE      ' '
092740970414     C                   MOVEL     ERR(141)      VIDMSG
092750970414     C                   SETON                                        4790
092760970414     C                   GOTO      ENDC01
092770970414     C                   END
092780970724     C* SE C'E' LEGAME BOLLA NON POSSO METTERE  L.ARRIVO=L.PARTENZA
092790970724     C  N32              MOVEL     VIDLNP        W003A
092800970724     C  N32W003A         IFEQ      VIDLNA
092810970724     C                   MOVEL     ERR(83)       VIDMSG
092820970724     C                   SETON                                        4790
092830970724     C                   GOTO      ENDC01
092840970724     C                   END
092850970414     C                   END
092860940824     C*
092870940824     C                   MOVEL     VIDLNA        WLNA
092880110217     C                   EXSR      CTRLNA_vid
092890940824     C                   MOVEL     WLNA          VIDLNA
092900940824     C     WEMFOR        IFEQ      '1'
092910940920     C                   GOTO      ENDC01
092920940824     C                   ENDIF
092930060707     c*
092940060707     c* Non posso variare la lna passando da lna non dpd a lna dpd
092950060707     c   12
092960060707     cann15savlna        ifne      vidlna
092970060707     c     savaogntw     andne     A_§ogntw
092980060707     c     A_§ogntw      andeq     'DPD'
092990060707     C                   MOVEL     ERR(305)      VIDMSG
093000060707     C                   SETON                                        4790
093010060707     C                   GOTO      ENDC01
093020060707     c                   endif
093030071220     c* Disk "B" - non posso variare la linea se:
093040071220     c                   if        *in12 and not *in15  and
093050071220     c                             §1bfg6='C' and savlna<>vidlna
093060071220     c                   exsr      sr_chkabilna
093070071221     c                   if        *in90
093080071221     c                   goto      endc01
093090071221     c                   endif
093100061124     c*
093110071220     c                   endif
093120061124     C* PER DISK A CON VAT OPPURE PER DISK C EX DISK B  CONTROLLO
093130061124     C* ESISTENZA CODICI CHI SONO
093140061124     C* IDEM SE SONO IN MANTUENZIONE
093150061124     C     A_§OGNTW      IFEQ      'DPD'
093160061124     C     VIDDPD        OREQ      'D'
093170061124     C                   MOVEL     'S'           WEXDPD            1
093180061124     C                   ELSE
093190061124     C                   CLEAR                   WEXDPD
093200061124     C                   ENDIF
093210061124     C*
093220061124     C     §1BF12        IFEQ      'E'
093230061124     c     wexdpd        andne     'S'
093240061124     c     *in79         andeq     *off
093250061124     c*
093260061124     c     §1bf12        oreq      'E'
093270061124     c     wexdpd        andeq     'S'
093280061124     c     §1bf13        andeq     'A'
093290061124     C*
093300061124     C     §1BF12        OREQ      'B'
093310061124     C*
093320061124     C     *IN12         OREQ      *ON
093330061124     C     *IN15         ANDEQ     *OFF
093340061124     C     §1BF12        ANDNE     'N'
093350061124     C     WEXDPD        ANDNE     'S'
093360061124     c     *in79         andeq     *off
093370061124     C*
093380061124     C     *IN12         OREQ      *ON
093390061124     C     *IN15         ANDEQ     *OFF
093400061124     C     §1BF12        ANDNE     'N'
093410061124     C     WEXDPD        ANDEQ     'S'
093420061124     C     §1BF13        ANDEQ     'A'
093421140715      *
093422140715     C     *IN12         OREQ      *ON
093423140715     C     *IN15         ANDEQ     *OFF
093424140715     C     §1BF12        ANDeq     'B'
093425140715     C     WEXDPD        ANDEQ     'S'
093430070323     c*  Per bolla export dpd con parcel  lungo 12 bypasso questo con-
093440070323     c*  trollo che non funzionerebbe
093450061124      * se non ho superato i 500 colli
093460061124If  2c                   If        v1cncl <= 500
093470061124     C* CONTROLLO CHE NON CI SIANO SEGNACOLLI
093480061124     C*                         RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
093490061124     C* CONTEGGIO ANCHE N° RECORD "CHI SONO" PERCHE' DEVE ESSERE = AL
093500061124     C* NUMERO DEI COLLI
093510061124     C* PASSO A ROUTINE UN FLAG PER SEGNALARE CHE E' RICHIAM.DA CTRD01
093520061124     C                   MOVEL     'C'           WC01FG            1
093530061124     C                   EXSR      CTRS08
093540061124     C   90              MOVEL     W08MSG        VIDMSG
093550061124     C   90              SETON                                        62
093560061124     C   90              GOTO      ENDC01
093570061124   x2c                   Else
093580061124     c                   Eval      VidMsg = Err(275)
093590061124     c                   Eval      *In90 = *On
093600061124     c                   Eval      *In62 = *On
093610061124     c                   GoTo      EndC01
093620061124    2c                   EndIf
093630061124     C                   ENDIF
093640061124     c* se sono in conferma bolle da disk di bolla dpd errore se
093650061124     c* il cliente mi ha passato più di un VAT
093660061124     c                   if        *in12 and *in15 and §1bf12 = 'E'
093670061124     c                             and werrvat = '1'  and
093680061124     c                             ((§1bf13 = *blanks and wexdpd = 'S')
093690061124     c                              or (*in79 = *on))
093700061124     c                   Eval      VidMsg = Err(291)
093710061124     c                   Eval      *In90 = *On
093720061124     c                   Eval      *In62 = *On
093730061124     c                   GoTo      EndC01
093740061124     c                   endif
093750960320     C*
093760960320     C* PER LNA 102 OBBLIGATORIO IL C/S
093770960320     C     COMLNA        IFEQ      102
093780960320     C     §3ARBL        ANDNE     'C'
093790960320     C                   SETON                                        4690
093800960320     C                   MOVEL     ERR(126)      VIDMSG
093810960320     C                   GOTO      ENDC01
093820960320    3C                   ENDIF
093830000609     C**
093840060109     C* PER BOLLA EXPORT DPD, NON POSSO ACCETTARE SOLUZIONI "B" se ctm
093850060109     c* che non prevede l'assegnazione automatica del "chi sono DPD"
093860000609     C   15
093870000609     CAN 12§1BFG6        IFEQ      'C'
093880000609     C     §1BFG2        ANDEQ     'S'
093890060109     c     §1bf13        andne     'A'
093900020319     C     A_§OGNTW      IFEQ      'DPD'
093910020204     C     VIDDPD        OREQ      'D'
093920060109     C                   MOVEL     ERR(296)      VIDMSG
093930000609     C                   SETON                                        6290
093940000609     C                   GOTO      ENDC01
093950000609     C                   ENDIF
093960000609     C                   ENDIF
093970061121     c*
093980080411     c* 11/04/2008: Asterisco i seguenti controlli perchè li ho spostat
093990080411     c* dentro la CTRIND
094000061121     C* VERIFICO SE P.O. EMITTENTE DPD o fed-ex
094010080411     c***                clear                   poentw
094020080411    2C***  FLGFIT        IFNE      'S'
094030080411     C***  ORMPOE        CHAIN     AZORG01L      UNIORG               30
094040080411     C***                MOVEL     OG143         SAV143
094050080411     C**N30              MOVEL     ORGDE3        OG143
094060080411     C** 30              CLEAR                   OG143
094070080411     c**                 eval      poentw=§ogntw
094080080411     C**                 MOVEL     SAV143        OG143
094090080411    2C***                ENDIF
094100010503     C* SE BOLLA EXPORT DPD IN PORTO ASSEGNATO DEVE ESSERE ASSOCIATA AD
094110010503     C* UN ORM REALE COMMISSIONATO DA UN P.O. DPD
094120020207     c* IDEM PER BOLLA FEDEX
094130010508     C* NON FACCIO QUESTO CONTROLLO SE PGM RICHIAMATO DA PGM GIACENZE
094140020527     c* o da ritiri annullati (savfpr="T")
094150080411    0c***  *in04         ifeq      *on
094160080411     c***                clear                   pofed             1
094170080411     c***                clear                   podpd             1
094180080411     C***                MOVEA     ERR(229)      K78
094190080411    1C***  A_§OGNTW      IFEQ      'DPD'
094200080411     C***  VIDDPD        OREQ      'D'
094210080411     c***                movel     '1'           podpd
094220080411     C***                MOVE      'DPD  '       W005A             5
094230080411     C***                MOVEA     W005A         K78(14)
094240080411     C***                MOVEA     W005A         K78(71)
094250080411     c***                endif
094260080411     c***  A_§ogntw      ifeq      'FED'
094270080411     c***  viddpd        oreq      'F'
094280080411     c***                movel     '1'           pofed
094290080411     C***                MOVE      'FedEx'       W005A             5
094300080411     C***                MOVEA     W005A         K78(14)
094310080411     C***                MOVEA     W005A         K78(71)
094320080411     c***                endif
094330040907     c*
094340080411     c***                clear                   wnocont
094350040907     c* Se provengo da manutenzione di bolla di reso lo memorizzo
094360040907     c* per non effettuare il controllo seguente
094370080411     c***  *in12         ifeq      *on
094380080411     c***  *in15         andeq     *off
094390080411     c***  vidfbr        andeq     'S'
094400080411     c***                move      'N'           wnocont           1
094410080411     c***                endif
094420020131     c
094430080411    1C**   podpd         IFEQ      '1'
094440080411     c**   pofed         oreq      '1'
094450080411   1AC**   SAVFPR        IFNE      'P'
094460080411     C*    SAVFPR        ANDNE     'G'
094470080411     C*    SAVFPR        ANDNE     'T'
094480080411     c*    wnocont       andeq     *blanks
094490080411    2C*    FLGFIT        IFEQ      'S'
094500080411     C*    poentw        ORNE      'DPD'
094510080411     c*    podpd         andeq     '1'
094520080411     C*    poentw        ORNE      'FED'
094530080411     c*    pofed         andeq     '1'
094540080411     C*                  MOVEA     K78           VIDMSG
094550080411     C*                  SETON                                        90
094560080411    3C*    WPERSO        IFEQ      'P'
094570080411     C*                  Z-ADD     05            H0RIGA
094580080411     C*                  Z-ADD     20            H0COLO
094590080411     C*                  ELSE
094600080411     C*                  Z-ADD     06            H1RIGA
094610080411     C*                  Z-ADD     20            H1COLO
094620080411    3C*                  ENDIF
094630080411     C*                  GOTO      ENDC01
094640080411    2C*                  ENDIF
094650080411   1AC*                  ENDIF
094660080411    1C*                  ENDIF
094670080411    0c*                  endif
094680940823     C***
094690940823     C*** DESTINATARIO  ***
094700001121      ***
094710001121      * ALLINEO A SX LA LOCALITA'
094720001121     C     VIDLOD        IFNE      *BLANKS
094730001121     C                   MOVEL     VIDLOD        W001A
094740001121     C     W001A         IFEQ      *BLANKS
094750001121     C                   MOVEA     VIDLOD        K35
094760001121     C     ' '           CHECK     VIDLOD        XX
094770001121     C                   CLEAR                   VIDLOD
094780001121     C                   MOVEA     K35(XX)       VIDLOD
094790001121     C                   ENDIF
094800001121     C                   ENDIF
094810130923     c* controllo dei caratteri
094820130923     c                   eval      wtxt=vidrsd
094830131003     c                   eval      uppercase = '1'
094831141202     c                   clear                   ElencoChar
094840130923     c                   exsr      sr_chk
094850130923     c                   movel     wtxt          vidrsd
094860130923     c                   eval      wtxt=vidind
094870131003     c                   eval      uppercase = '1'
094871141202     c                   clear                   ElencoChar
094880130923     c                   exsr      sr_chk
094890130923     c                   movel     wtxt          vidind
094900130923     c                   eval      wtxt=vidlod
094910131003     c                   eval      uppercase = '1'
094911141202     c                   clear                   ElencoChar
094920130923     c                   exsr      sr_chk
094930140207     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
094940140207     c* seguenti la località
094950140207     c                   exsr      chkstringa
094960140110     c                   movel     wtxt          vidlod
094970140113     c* segnalo errore se località contenente caratteri di punteggiatura
094980140113     c* a destra e/o a sinistra
094990140207     c***                if        vidlod<>*blanks
095000140207     c***                exsr      chkstringa
095010140207     c***                if        posl=0 or wtxt<>%subst(wtxt:posl:lung)
095020140207     C***                MOVEL     ERR(350)      VIDMSG
095030140207     C***                SETON                                        6690
095040140207     C***                GOTO      ENDC01
095050140207     c***                endif
095060140207     c***                endif
095070001121      *
095080970701     C                   MOVEL     VIDRSD        I14RSC
095090970701     C                   MOVE      VIDRSD        I14RS2
095100970701     C                   MOVEL     VIDIND        I14IND
095110970701     C                   MOVEL     VIDLOD        E14LOC
095120970701     C                   MOVEL     VIDPID        E14PIP
095130970701     C                   MOVEL     VIDPRD        E14PRV
095140970701     C                   MOVEL     VIDNZD        E14NAR
095150970701     C                   MOVEL     VIDCAD        E14CAP
095160970704     C                   MOVEL     'D'           WCLI              1
095170061121     c                   clear                   wcdf
095180970704     C                   EXSR      CTRIND
095190970702     C*
095200970702     C* IMPOSTO I CAMPI DI UNA EVENTUALE RICERCA
095210970704     C                   MOVEL     E14LOC        VIDLOD
095220970704     C                   MOVEL     E14CAP        VIDCAD
095230970704     C                   MOVEL     E14NAR        VIDNZD
095240970704     C                   MOVEL     E14PRV        VIDPRD
095250970702     C                   MOVEL     E14PIP        VIDPID
095260970704     C* ERRORE
095270970704     C     WEMFOR        IFEQ      '1'
095280970704     C     *IN90         OREQ      *ON
095290970704     C                   GOTO      ENDC01
095300970704     C                   ENDIF
095310070808     c* Per TELLUS --> Indirizzo: deve essere di almeno 6 caratteri
095320090202     c* Ignoro l'errore se destinatario estero protetto
095330070808     c                   eval      w_vidind=%trim(vidind)
095340070827     c     ' '           checkr    w_vidind      num               2 0
095350090202     c                   if        num<6 and (wdesie<>'E' or atrdes<>prot)
095360070808     C                   SETON                                        90
095370070808     C                   Z-ADD     18            H1RIGA
095380070808     C                   Z-ADD     02            H1COLO
095390070808     C                   MOVEL     ERR(313)      VIDMSG
095400070808     C                   GOTO      ENDC01
095410070808     c                   endif
095420061121     c* Se destinatario estero e orm avente p.o. emittente DPD errore se
095430061121     c* il network non è dpd
095440061121     c                   if        wdesie='E' and flgfit<>'S'
095450061121     c                             and poentw='DPD' and viddpd<>'D'
095460061121     c                             and A_§ogntw<>'DPD'
095470061121     c                   seton                                        90
095480061121     c                   Eval      VidMsg = Err(309)
095490061121     c                   z-add     21            H1riga
095500061121     c                   z-add     10            H1colo
095510061121     c                   GoTo      EndC01
095520061121     c                   endif
095530110512     c* Se presente indirizzo email del destinatario lo controllo
095540110512     c                   if        wemdest<>*blanks
095550110613     c                   if        wdesie='E'
095560150212     c***                Eval      *In90 = *On
095570150212     c***                Eval      vidmsg=err(342)
095580150212     c***                Eval      vidmsg=%trimr(vidmsg) +
095590150212     c***                          ':F17 x eliminare Ind.Email'
095600150212     c***                goto      endc01
095601150212     c                   clear                   wemdest
095610110613     c                   else
095620110512     c                   exsr      sr_chkemd
095630110512      * Errore
095640110512if  3c                   If        §emlerro <> '0'
095650150212     c***                Eval      *In90 = *On
095660150212     c***                Eval      vidmsg = err(340)
095670150212     c***                eval      vidmsg=%trimr(vidmsg)+': F17 per correggere'
095680150212     c***                goto      endc01
095681150212     c                   clear                   wemdest
095690110512   x3c                   else
095700110512     c                   Eval      wemdest = §emlindo
095710110512    3c                   EndIf
095720110613     c                   endif
095730110512     c                   endif
095740140416     c* Se presente numero di sms lo controllo
095750140416     c                   if        wsms<>*blanks
095760140423     c                   if        wdesie='E'
095770150212     c***                Eval      *In90 = *On
095780150212     c***                Eval      vidmsg=err(351)
095790150212     c***                Eval      vidmsg=%trimr(vidmsg) +
095800150212     c***                          ':F17 x eliminare Cell.'
095810150212     c***                goto      endc01
095811150212     c                   clear                   wsms
095820150216     c***                else
095830140416      /free
095840150216      // pInCell = %trim(wsms);
095850150216      // POutErr = *blanks;
095860150216      // if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
095870140416
095880140416           // Numero di cellulare KO
095890150212        //*in90=*on;
095900150212        //vidmsg=err(351);
095910150212        //vidmsg=%trimr(vidmsg)+':F17 per correggere';
095911150216      //     clear wsms;
095920150216      // endif;
095930140416      /end-free
095940150216     c**                 if        *in90
095950150216     c**                 goto      endc01
095960150216     c***                endif
095970140423     c                   endif
095980140416     c                   endif
095981141202     c* Se presente PIN CODE lo controllo - SE sono in Conferma Bolle
095984141202
095998141202     c                   if        *in12 and *in15  and
095999141202     c                             wpincode<>*blanks
096000141202     c* se bolla export non lo controllo perchè per l'export non lo
096001141202     c* memorizziamo
096002141202     c                   if        (comlna>0 and
096003141202     c                              a_§ogntw<>'FED' and
096004141202     c                              a_§ogntw<>'EEX' and
096005141202     c                              a_§ogntw<>'DPD' ) or
096006141202     c                             (comlna = 0 and wdesie<>'E')
096007141202     c* errore se Pin Code ricevuto > di 15 caratteri
096008141202     c                   if        lenPC>15
096009141202     c                   Eval      *In90 = *On
096010141202     c                   Eval      vidmsg=err(355)
096011141202     c                   goto      endc01
096012141202     c                   endif
096013141202     c* verifico la presenza di caratteri non validi
096014141209     c* se presenti dati in tabella CSP record "PINCODE" altrimenti
096015141203     c* i caratteri sono tutti validi
096016141203     c                   if        charpcok<>*blanks
096017141202     c                   eval      wtxt=wpincode
096018141202     c                   clear                   uppercase
096019141202     c                   eval      ElencoChar=charPCok
096020141202     c                   exsr      sr_chk
096021141202     c                   if        esito<>'0'
096022141202     c                   Eval      *In90 = *On
096023141202     c                   Eval      vidmsg=err(356)
096024141202     c                   goto      endc01
096025141202     c                   endif
096026141209     c                   endif
096027141209     c* verifico che non siano presenti dei blank dentro al pin code
096028141209     c                   if        %scan(' ':%subst(wpincode:1:lenpc))>0
096029141209     c                   Eval      *In90 = *On
096030141209     c                   Eval      vidmsg=err(356)
096031141209     c                   goto      endc01
096032141209     c                   endif
096033141202     c                   endif
096034141202     c                   endif
096035050214     c*
096036050214     c* SE DESTINATARIO ESTERO vedo se devo forzare il porto franco
096037050214     C* (si tratta delle stesse operazioni effettuate anche routine prp
096038050214     c* or1 che devono essere effettuate anche in questo momento
096039050214     c* se l'orm è multiplo per cui deve prima essere controllato il
096040060427     c* destinatario per sapere se è estero- Idem se orm singolo ma non è
096050060427     c* specificato il destinatario ORM)
096060060428if  1c****               If        (Not *In12 or Not *In15) and
096070060428     c****                         (ormtor = 'M' or ormrsc=*blanks  )  and
096080050214      * e l'ORM prevede:
096090060428      *****           --> la bolla in porto Assegnato
096100060428      *****           --> paga ordinante orm
096110060428      *****           --> destinatario estero
096120060428      *****           --> ordinante orm italia
096130060428     c*****                        (§OrPfb = 'A' and OrmPag = 'O' and
096140060428     c****                          wdesie = 'E' and OrmNao = *Blanks)
096150060428     c****               exsr      sr_FOrmEst
096160060428    1c****               EndIf
096170061124     c                   if        vidnzd<>savnzd
096180061124     c                   clear                   wfortbo
096190061124     c                   move      vidnzd        savnzd
096200061124     c                   endif
096210140423
096220050214     c                   exsr      CTRCBO_orm
096230050214     C     *in90         IFEQ      '1'
096240050214     c                   eval      wemfor = '1'
096250050214     C                   GOTO      ENDC01
096260050214     C                   ENDIF
096270061011     c
096280061011     c* Per bolla dpd con CAP errato richiamo in automatico int cappar
096290061011     c*  DPD
096300061011    1c                   if        CapparioDPD='S' or *inkb
096310061011     c* Se non è + dpd tolgo il flag
096320061011    2C     A_§OGNTW      IFEQ      'DPD'
096330061011     C     VIDDPD        OREQ      'D'
096340061011     C     WDESIE        ANDEQ     'E'
096341150220    2C     A_§OGNTW      oreQ      'EEX'
096342150220     C     VIDDPD        OREQ      ' '
096343150220     C     WDESIE        ANDEQ     'E'
096350061011     c* Se modificato il CAP vado avanti senza l'interrogazione
096360061011    3c                   if        vidcad=savcapdpd   or *inkb
096370061011     c* Per l'interrogazione passo solo il cap fittizio
096380061011     C                   MOVEL     '15'          COD
096390061011     C                   MOVEL(P)  VIDNZD        KEY
096400061011     C                   EXSR      CTABEL
096410061011     C                   MOVEL     TBLUNI        DS15
096420061011     c                   movea     vidcad        cap
096430061011     C                   CLEAR                   CAF
096440061011     C                   MOVEA     CAP(§15pcf)   CAF(§15pcf)
096450061011     c     §15ecf        add       §15pcf        finefit           2 0
096460061011     c                   movea     *blanks       caf(finefit)
096470061011     c
096480061011     C                   CLEAR                   tisie8ds
096490061011     c                   z-add     blpdsp        isie8dri
096500061011     c                   movel     'D01'         isie8op0
096510061011     C                   MOVEL     vidnzd        isie8nar
096520061011     C                   MOVEa     caf           isie8cap
096530061011     C                   CALL      'TISIE8R'
096540061011     C                   PARM                    kpjba
096550061011     C                   PARM                    tisie8ds
096560061011     c*
096570061011     c* Se errore lo emetto
096580061011     c                   if        osie8err<>' '
096590061011     C                   MOVEL     osie8msg      VIDMSG
096600061011     C                   SETON                                        6590
096610061011     C                   GOTO      ENDC01
096620061011     c                   endif
096630061011     c
096640061011    4c                   if        osie8capb<>*blanks
096650061011     c                   movel     osie8capb     vidcad
096660061011     c                   clear                   cappariodpd
096670061011     c
096680061011     c* In manutenzione se cambiato CAP riemetto videata
096690061011     c* In immissione/conferma no tanto devo confermare la videata
096700061011     c*    x nazione estera
096710061011     c                   if        *in12 and not *in15
096720061011     c                   eval      wemfor='1'
096730061011    4c                   endif
096740061011     c
096750061011     c                   else
096760061011     c* se non selezionato riemetto videata
096770061011     c                   eval      wemfor='1'
096780061011    4c                   endif
096790061011    3c                   endif
096800061011     c
096810061011   x2c                   else
096820061011     c                   clear                   cappariodpd
096830061011    2c                   endif
096840061011    1c                   endif
096850020530     c*
096860941020     C**
096870950303     C* SE DESTINATARIO ESTERO --> P.IVA OBBLIGATORIA
096880950525     C* SOLO SE PAESE EFTA
096890050427     c* e non è bolla di recupero
096900000905     C     WDESIE        IFEQ      'E'
096910950616     C     VIDPID        ANDEQ     *BLANKS
096920050427     c     §3arbl        andne     'R'
096930000321     C*
096940020319    2C     A_§OGNTW      IFEQ      'DPD'
096950000321     C     DESEFD        ANDNE     *BLANKS
096960000321     C*
096970020204     C     VIDDPD        OREQ      'D'
096980000321     C     DESEFD        ANDNE     *BLANKS
096990020131     c*
097000020213    2C     A_§OGntw      oreq      'FED'
097010020131     C     DESEFf        ANDNE     *BLANKS
097020020131     C*
097030020131     C     VIDDPD        OREQ      'F'
097040020131     C     DESEFf        ANDNE     *BLANKS
097050000321     C*
097060020319     C     A_§OGNTW      ORNE      'DPD'
097070020213     c     A_§ogntw      andne     'FED'
097080000321     C     VIDDPD        ANDEQ     ' '
097090000321     C     O14EFT        ANDNE     *BLANKS
097100950303     C                   MOVEL     '1'           WEMFOR
097110950303     C                   SETON                                        387090
097120950303     C                   MOVEL     ERR(88)       VIDMSG
097130950303     C                   GOTO      ENDC01
097140000321    2C                   ENDIF
097150000321    1C                   ENDIF
097160970528     C* NON POSSO USARE L'ESPRESSO PER BOLLE IMPORT/EXPORT
097170970528     C     VIDTSP        IFEQ      'E'
097180970528     C     WDESIE        IFEQ      'E'
097190100118     c**   §ogntw        oreq      'EEX'
097200100118     c**   §ogntw        oreq      'FED'
097210100118     c**   §ogntw        oreq      'DPD'
097220970528     C                   MOVEL     '1'           WEMFOR
097230970528     C                   SETON                                        487090
097240970528     C                   MOVEL     ERR(142)      VIDMSG
097250100118     c                   eval      %subst(vidmsg:47:10) = v1dtsp
097260090604     c                   eval      vidmsg = %trim(vidmsg) + '!!'
097270970528     C                   GOTO      ENDC01
097280970528    1C                   ENDIF
097290970528    1C                   ENDIF
097300020415     c* NON POSSO USARE CLIENTE 9999 PER PORTI ASSEGNATI EUROEXPRESS
097310020416     c* Lo posso usare solo se bolla associata a orm reale commissionato da
097320020416     c* un p.o. EEX
097330020416     C     SAVFPR        IFNE      'P'
097340020416     C     SAVFPR        ANDNE     'G'
097350020527     C     SAVFPR        ANDNE     'T'
097360020416     c     vidccm        andeq     9999
097370020415     c     wdesie        ifeq      'E'
097380020415     c     viddpd        andeq     *blanks
097390020415     c     comlna        andeq     *zeros
097400020415     c     A_§ogntw      oreq      'EEX'
097410020416     c                   clear                   wokccm            1
097420020416     C* Verifico se P.O. emittente "EEX"
097430020416    2C     FLGFIT        IFNE      'S'
097440020416     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
097450020416     C                   MOVEL     OG143         SAV143
097460020416     C  N30              MOVEL     ORGDE3        OG143
097470020416     C   30              CLEAR                   OG143
097480020416     c     §ogntw        ifeq      'EEX'
097490020416     c                   movel     'S'           wokccm
097500020416     c                   endif
097510020416     C                   MOVEL     sav143        og143
097520020416    2C                   ENDIF
097530020416     c     flgfit        ifeq      'S'
097540020416     c     wokccm        oreq      *blanks
097550020415     C                   MOVEL     ERR(253)      VIDMSG
097560020415     C                   SETON                                        9050
097570020415     c   90              goto      endc01
097580020416     c                   endif
097590020415     c                   endif
097600020415     c                   endif
097610970528     C* NON POSSO USARE TIPO BOLLA 5
097620970528     C     WDESIE        IFEQ      'E'
097630970528     C     VIDCBO        ANDEQ     '5 '
097640970528     C                   MOVEL     '1'           WEMFOR
097650970528     C                   SETON                                        467090
097660970528     C                   MOVEL     ERR(143)      VIDMSG
097670970528     C                   GOTO      ENDC01
097680970528    1C                   ENDIF
097690030707
097700030707      * Se non sto facendo una bolla di recupero
097710030707If  1c                   If        §3aRbl <> 'R'
097720991206      **
097730991206      * SE CAP ESTERO--> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ITALIA
097740020319      ***                TRANNE SE LINEA DPD
097750950525     C     WDESIE        IFEQ      'E'
097760950525     C     COMLNA        ANDGT     0
097770020319     c     A_§ogntw      ifeq      'COR'
097780020319     c     A_§ogntw      oreq      'MES'
097790020319     c     A_§ogntw      oreq      'PPT'
097800950525     C                   MOVEL     ERR(117)      VIDMSG
097810950525     C                   SETON                                        4790
097820950525     C                   GOTO      ENDC01
097830020319     c                   endif
097840950525     C                   ENDIF
097850950525     C*
097860991206      * SE CAP ITALIA -> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ESTERO
097870020319     C***NEMMENO DPD
097880950525     C     WDESIE        IFEQ      'I'
097890971211     C     COMLNA        ANDGT     0
097900020319     c     A_§ogntw      ifeq      'EEX'
097910020319     c     A_§ogntw      oreq      'FED'
097920020319     c     A_§ogntw      oreq      'DPD'
097930950525     C                   MOVEL     ERR(118)      VIDMSG
097940950525     C                   SETON                                        4790
097950950525     C                   GOTO      ENDC01
097960950525     C                   ENDIF
097970000121     C                   ENDIF
097980030707    1c                   EndIf
097990000121      *
098000000121      * PER LNA DPD OBBLIGATORIO 1 COLLO
098010020319     C     A_§OGNTW      IFEQ      'DPD'
098020020204     C     VIDDPD        OREQ      'D'
098030000121     C     WDESIE        ANDEQ     'E'
098040000121     C     V1CNCL        IFNE      1
098050000121     C                   SETON                                        6290
098060000121     C                   MOVEL     ERR(179)      VIDMSG
098070000121     C                   GOTO      ENDC01
098080000121     C                   ENDIF
098090000121     C                   ENDIF
098100090429      * OBBLIGATORIETA' DI un collo anche per orm commissionato da dpd
098110090429     c                   if        poentw='DPD' and v1cncl<>1
098120090429     C                   SETON                                        6290
098130090429     C                   MOVEL     ERR(323)      VIDMSG
098140090429     C                   GOTO      ENDC01
098150090429     c                   endif
098160000121      * PER LNA O LNP DPD Massimo peso inseribile da tabella
098170020319     C  N12A_§OGNTW      IFEQ      'DPD'
098180020319     C     §OGNTW        OREQ      'DPD'
098190020204     C     VIDDPD        OREQ      'D'
098200000121     C     WDESIE        ANDEQ     'E'
098210000121     C     VIDPKG        IFGT      §3IPKD
098220000121     C                   SETON                                        6390
098230000121     C                   MOVEA     ERR(180)      K78
098240000121     C                   MOVEL     §3IPKD        W006A             6
098250000121     C                   MOVEA     W006A         SKI(10)
098260000121     C                   Z-ADD     10            I                 3 0
098270000121     C                   EXSR      ABBL
098280000121     C                   MOVEA     SKI(10)       K78(53)
098290000121     C                   MOVE      §3IPKD        W001A
098300000121     C                   MOVEL     W001A         K78(60)
098310000121     C                   MOVEA     K78           VIDMSG
098320000121     C                   GOTO      ENDC01
098330000121     C                   ENDIF
098340000121     C                   ENDIF
098350020201     c* per servizio dpd non accettato tipo bolla con C/A  - IDEM per FED-EX
098360080414     c*    viddpd        ifeq      'D'
098370080414     c*    A_§ogntw      oreq      'DPD'
098380080414     c*                  eval      w006a = 'DPD   '
098390080414     c*                  else
098400080414     c*    viddpd        ifeq      'F'
098410080414     c*    A_§ogntw      oreq      'FED'
098420080414     c*                  eval      w006a = 'FedEx '
098430080414     c*                  else
098440080414     c*                  if        wdesie='E'
098450080414     c*                  eval      w006a = 'EUROEX'
098460080414     c*                  endif
098470080414     c*                  endif
098480080414     c*                  endif
098490061030     c
098500061030     c* Controllo se ammesso C/A per estero in base ai vari network
098510080414     c****               setoff                                       90
098520080414     c*****              select
098530080414     C***  VIDDPD        wheneq    'D'
098540080414     C**** WDESIE        ANDEQ     'E'
098550061030     c*
098560080414     C***  A_§OGNTW      OREQ      'DPD'
098570080414     c***                if        descadpd=' '  and §3afca<>0
098580080414     c****               seton                                        90
098590080414     c****               endif
098600061030     c
098610080414     C***  VIDDPD        wheneq    'F'
098620080414     C***  WDESIE        ANDEQ     'E'
098630061030     c
098640080414     C***  A_§OGntw      OREQ      'FED'
098650080414     c****               if        descafed=' '  and §3afca<>0
098660080414     c***                seton                                        90
098670080414     c****               endif
098680080414     c***                other
098690080414     c****               if        wdesie='E' and
098700080414     c****                         descaeex=' '  and §3afca<>0
098710080414     c****               seton                                        90
098720080414     c****               endif
098730080414     c***                endsl
098740061030     c
098750080414     C***                IF        *in90
098760080414     c***                movea     err(187)      k78
098770080414     c***                movea     w006a         k78(13)
098780080414     C***                MOVEa     k78           VIDMSG
098790080414     C***                SETON                                        4690
098800080414     C***                GOTO      ENDC01
098810080414     C***                ENDIF
098820061030     c*
098830030221     c* Per bolle export fedex non è ammesso l'inserimento di C/Servizio
098840030221     c     viddpd        ifeq      'F'
098850030221     c     A_§ogntw      oreq      'FED'
098860030221     c     §3arbl        ifeq      'C'
098870020228     C                   MOVEL     ERR(245)      VIDMSG
098880020228     C                   SETON                                        4690
098890020228     C                   GOTO      ENDC01
098900030221     c                   endif
098910020228     c                   endif
098920060613     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
098930060613     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
098940060613     C     *IN79         IFEQ      *ON
098950060613     C     VIDDPD        ANDne     'D'
098960060613     C     A_§OGNTW      ANDNE     'DPD'
098970060613     C     WDESIE        ANDEQ     'E'
098980060613     C                   SETOFF                                       79
098990060613     C                   ENDIF
099000000120     c* Numero dpd
099010000120     c*  INSERIBILE SOLTANTO SE RICHIESTO IL SERVIZIO O LNA ESTERA DPD
099020060612     c*  o se import dpd
099030000120     C  N12
099040060612    1COR 15VIDNRD        IFne      *blanks
099050060613   1ac     *in79         ifeq      *off
099060000120    2C     COMLNA        IFEQ      0
099070000120     C     VIDDPD        ANDEQ     ' '
099080020201    2C     COMLNA        oreq      0
099090020201     C     VIDDPD        andeq     'F'
099100000121    2C     COMLNA        ORGT      0
099110020319     C     A_§OGNTW      ANDNE     'DPD'
099120060921     c
099130000120     C     DESLAD        OREQ      0
099140060921     c     desred        andeq     ' '
099150060921     c
099160060921     C     DESLAD        OREQ      0
099170060921     c     desred        andeq     'S'
099180060921     c     vidfbr        andne     'S'
099190000120     C                   MOVEL     ERR(184)      VIDMSG
099200000120     C                   SETON                                        4790
099210000120     C                   GOTO      ENDC01
099220000120    2C                   ENDIF
099230060612     c
099240000120     C* NON INSERIBILE SE NON ACCETTATTO DAL CTM
099250000120    2C     §1BF13        IFEQ      'A'
099260000120     C                   MOVEL     ERR(185)      VIDMSG
099270000120     C                   SETON                                        5790
099280000120     C                   GOTO      ENDC01
099290000120    2C                   ENDIF
099300060612   1aC                   ENDIF
099310000120     C* SE INSERITO, e no bolla reupero,  CONTROLLO IL CHK DIGITS
099320000308    2C     §3ARBL        IFNE      'R'
099330060612     C                   movel     VIDNRD        WNPR
099340000124     C                   EXSR      DPDVAL
099350000124     C   90              SETON                                        57
099360000124     C   90              GOTO      ENDC01
099370060613     c* per import effettuo subito il controllo per parcel doppio
099380060613     c                   if        *in79='1' and §1bfg8='S'
099390060613     c                   exsr      dpddop_imp
099400060613     C   90              SETON                                        57
099410060613     C   90              GOTO      ENDC01
099420060613     c                   endif
099430070326     c* per export imposto campo wparcel
099440070326     c                   if        *in79='0' and %subst(wnpr:14:1)=*blanks
099450070326     c                             and vidfbr<>'S'
099460070326     c                   eval      wparcel='12'
099470080612     c* in questo caso devo anche controllare che il chi sono inserito non
099480080612     c* sia doppio su fisgn
099490080612     c                   clear                   w8hcol
099500080612     c                   movel     wnpr          w8cnot
099510080612     c                   clear                   w08msg
099520080612     c                   eval      wnopos='1'
099530080612     c                   exsr      ctrchidop
099540080612     C                   MOVEL     w08msg        VIDMSG
099550080612     C   90              SETON                                        57
099560080612     C   90              GOTO      ENDC01
099570070326     c                   endif
099580060613     c
099590000120    2C                   ENDIF
099600000120     C*
099610000120   X1C                   ELSE
099620000120     C*
099630060613     c     *in79         ifeq      *on
099640060612     C     §3ARBL        ANDNE     'R'
099650060612     C                   MOVEL     ERR(186)      VIDMSG
099660060612     C                   SETON                                        5790
099670060612     C                   GOTO      ENDC01
099680060612     c                   endif
099690060612    2C     §1BF13        ifne      'A'
099700000308     C     §3ARBL        ANDNE     'R'
099710000121     C     WDESIE        ANDEQ     'E'
099720020204    3C     VIDDPD        IFEQ      'D'
099730020319     C     A_§OGNTW      OREQ      'DPD'
099740000120     C                   MOVEL     ERR(186)      VIDMSG
099750000120     C                   SETON                                        5790
099760000120     C                   GOTO      ENDC01
099770000120    3C                   ENDIF
099780000120    2C                   ENDIF
099790000120    1C                   ENDIF
099800960213     C***
099810960213     C*** FERMO DEPOSITO ERRATO
099820960213     C     VIDFFD        IFNE      'S'
099830010214     C     VIDFFD        ANDNE     'N'
099840010220     C     VIDFFD        ANDNE     ' '
099850960213     C                   MOVEL     ERR(123)      VIDMSG
099860960213     C                   SETON                                        5290
099870960213     C                   GOTO      ENDC01
099880960213     C                   ENDIF
099890940916     C***
099900940916     C*** FLAG INOLTRO: SE IMPOSTATO FORZARE CON CMD6
099910940909     C  NKF
099920940909     CANN15
099930940909     CAN 12
099940940909     CORNKF
099950940909     CANN12VIDFIN        IFNE      ' '
099960940907     C                   MOVEL     ERR(44)       VIDMSG
099970940923     C                   SETON                                        6990
099980940920     C                   GOTO      ENDC01
099990940909     C                   ENDIF
100000110818     c***
100010110901     c*** valore per accorpamento spedizioni in consegna:
100020110818     c*** errore bloccante se il cliente ha passato un valore non previsto
100030110818     c*   in tabella "xco"
100040110901     c***                if        *in12 and *in15 and werrxco=*on
100050110901     C***                SETON                                        90
100060110901     c***                eval      vidmsg=err(343)
100070110901     C***                GOTO      ENDC01
100080110901     c***                endif
100090110818     c*
100100031121      * Obbligatori se spedizione per supermercato
100110040213if  1c**!!!              If        wdisag = 'S'
100120040213if  2c**!!!              If        VidRef = *Blanks
100130040213     c**!!!              Eval      VidMsg = Err(267)
100140040213     c**!!!              z-add     20            H1riga
100150040213     c**!!!              z-add     21            H1colo
100160040213     c**!!!              Eval      *In90 = *On
100170040213     c**!!!              Eval      wemfor = '1'
100180040213     c**!!!              GoTo      EndC01
100190040213    2c**!!!              EndIf
100200040213if  2c**!!!              If        VidTel = *Blanks
100210040213     c**!!!              Eval      VidMsg = Err(267)
100220040213     c**!!!              z-add     20            H1riga
100230040213     c**!!!              z-add     64            H1colo
100240040213     c**!!!              Eval      *In90 = *On
100250040213     c**!!!              Eval      wemfor = '1'
100260040213     c**!!!              GoTo      EndC01
100270040213    2c**!!!              EndIf
100280040213    1c**!!!              EndIf
100290941003     C*
100300941003     C* IMPOSTO LA LOCALITA' DEL DESTINATARIO IN 2 VIDEATA
100310941003     C                   MOVEL     VIDLOD        V2CLOD
100320950123     C                   MOVEL     VIDRSD        V2CRSD
100330910125     C****
100340020917     C* CONTO QUANTI COLLI E QUANTI RECORD HO IN Fivad:
100350040618    1C***12§1BFG7        IFEQ      'S'
100360040618     c* in conferma
100370040618    1c                   if        (*in12 = *on and *in15 = *on
100380040618     c                             and §1bfg7 = 'S' and §1bf12 <> 'B')
100390040618     c* in manutenzione
100400040618     c                             or (*in12 = *on and *in15 = *off
100410040618     c                             and §1bfg7 = 'S')
100420940909     C  N15KBLP3         SETLL     FNBLD000
100430020917     C   15KBLC          SETLL     FIVAD000
100440940908     C* CONT  = NUMERO RECORD
100450910125     C                   Z-ADD     0             CONT
100460940908     C* CONT2 = NUMERO COLLI
100470910128     C                   Z-ADD     0             CONT2
100480940908     C*
100490940909     C  N15KBLP3         READE(N)  FNBLD000                               31
100500020917     C   15KBLC          READE(N)  FIVAD000                               31
100510950220     C*
100520950220    2C     *IN31         DOWEQ     *OFF
100530950220     C                   ADD       1             CONT              3 0
100540950220     C                   ADD       BLDNCL        CONT2             6 0
100550950220     C*
100560950220     C* SE E' DA DISK CLIENTI VEDO SE IL COLLO E' > 0
100570950220     C     *IN15         IFEQ      *ON
100580980410     C     §1BFG6        ANDEQ     'C'
100590950220     C     BLDNCD        ANDEQ     0
100600950220     C                   MOVEL     ERR(85)       VIDMSG
100610950220     C                   SETON                                        629031
100620950220    3C                   ENDIF
100630010313     C* SE E' DA DISK CLIENTI CONTROLLO CHE IL NUMERO COLLI SIA
100640010313     C* CORRETTO RISPETTO AL RANGE DAL/AL PASSATO
100650010313    3C     *IN15         IFEQ      *ON
100660010313     C     §1BFG6        ANDEQ     'C'
100670010313     C* CONTO IL NUMERO COLLI NEL RANGE DAL/AL
100680010313    4C     BLDNCA        IFEQ      *ZEROS
100690010313     C     BLDNCA        OREQ      BLDNCD
100700010313     C                   Z-ADD     1             WNCOL
100710010313   X4C                   ELSE
100720010313     C                   Z-ADD     BLDNCD        WNCOA
100730010313     C                   CLEAR                   WNCOL
100740010313    5C     WNCOA         DOWLE     BLDNCA
100750010313     C                   ADD       1             WNCOL
100760010313     C                   ADD       1             WNCOA
100770010313    5C                   ENDDO
100780010313    4C                   ENDIF
100790010313    4C     WNCOL         IFNE      BLDNCL
100800010313     C                   MOVEL     ERR(227)      VIDMSG
100810010313     C                   SETON                                        629031
100820010313    4C                   ENDIF
100830010313    3C                   ENDIF
100840950220     C*
100850950220     C  N15
100860950220     CANN31KBLP3         READE(N)  FNBLD000                               31
100870950220     C   15
100880020917     CANN31KBLC          READE(N)  FIVAD000                               31
100890940909    2C                   ENDDO
100900950220     C*
100910950220     C   90              GOTO      ENDC01
100920940908     C*
100930910225     C* SE NUMERO SEGNACOLLI DEL DETTAGLIO BOLLE NON E' UGUALE
100940910225     C*   AL NUMERO INDICATO SULLA BOLLA
100950050113     C     CONT2         ifne      V1CNCL
100960940908     C*
100970910225     C* IN DISK CLIENTI SEMPRE ERRORE
100980940909    3C     *IN15         IFEQ      *ON
100990940908     C* IN MANUTENZIONE BOLLE SOLO SE + DI UN RECORD
101000940908     C     *IN15         OREQ      *OFF
101010940908     C     CONT          ANDGT     1
101020940908     C                   MOVEL     ERR(87)       VIDMSG
101030940923     C                   SETON                                        6290
101040940920     C                   GOTO      ENDC01
101050940909    3C                   ENDIF
101060910225     C*
101070940909    2C                   ENDIF
101080910128     C*
101090940909    1C                   END
101100000413     C**
101110000413     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
101120000413     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
101130060613     c*  13/06/06 - Sposto questi controlli prima dei controlli su vidnrd
101140060613     C**   *IN79         IFEQ      *ON
101150060613     C**   VIDDPD        ANDne     'D'
101160060613     C***  A_§OGNTW      ANDNE     'DPD'
101170060613     C***  WDESIE        ANDEQ     'E'
101180060613     C***                SETOFF                                       79
101190060613     C***                ENDIF
101200940909     C*
101210050920     c* richiamo trul27r per sapere che cosa devo passare in FIE a fnlv59r
101220020213     C* ricerco in questo modo anche la tariffa di cartello
101230021120     c                   Clear                   Trul27Ds
101240021120     c                   Exsr      TarCar
101250021120     c                   If        *In90
101260021120     c                   GoTo      EndC01
101270021120     c                   EndIf
101280080327     c
101290080327     c* Se tipo servizio tariffa <> da fnvab in conferma bolle, errore
101300080327     c*   se non utilizzabile in bollettazione
101310080327     c                   if        *in12 and *in15 and NOutiTSP='N'
101320080327     c                             and tamtsp<>vidtsp
101330080327     C                   MOVEL     ERR(130)      VIDMSG
101340080327     C                   SETON                                        4890
101350080327     C                   GOTO      ENDC01
101360080327     c                   endif
101370090609     c* controllo i limiti di colli e peso
101380090609     c
101390090609     c                   z-add     v1cncl        wncl
101400090609     c  n12              z-add     vidpkg        wpes
101410090609     c   12              clear                   wpes
101420090609     c                   clear                   wvol
101430090609     c                   eval      wvid='1'
101440090609     c                   exsr      sr_limtsp
101450090609     c                   if        *in90
101460090609     C                   MOVEL     wmsgtsp       VIDMSG
101470090609     C                   GOTO      ENDC01
101480090609     c                   endif
101490041011     c*
101500041011     c* Verifico se destinatario disagiato
101510041011     c* Per bolle poste non faccio niente
101520091210     c                   clear                   wdisag
101530091210     c  n12              clear                   w_ar5tcp
101540091210     c                   clear                   ddstflo
101550041012    1c     §ogntw        ifne      'PPT'
101560091210     c
101570091210     c                   clear                   tisit0ds
101580091210     c                   clear                   tisit0x1ds
101590091210     c                   movel     'E'           it0tla
101600091210     c                   movel     vidnzd        it0naz
101610091210     c                   movel     vidprd        it0prv
101620091210     c                   movel     vidcad        it0cap
101630091210     c                   movel     vidlod        it0loc
101640091210     c                   movel     vidind        it0ind
101650091210     c                   movel     vidrsd        it0rag
101660091210     c                   call      'TISIT5R'
101670091210     c                   parm                    tisit0ds
101680091210     c                   parm                    tisit0x1ds
101690041012    2c     ot0err        ifeq      *blanks
101700060113     c                   movel     ot0flo        ddstflo
101710060102   2ac                   if        ot0dos = 'A' or ot0dos = 'D' or
101720060102     c                             ot0dos = 'S'
101730041011     c                   movel     ot0dos        wdisag
101740041012    3c     wdisag        ifeq      'D'
101750041011     c                   movel     'X'           wdisag
101760041012    3c                   endif
101770060102   2ac                   endif
101780041011     c                   Eval      savdisag = wdisag
101790070924     c                   Eval      savpart = 'S'
101800041012   x2c                   else
101810041011     c                   clear                   wdisag
101820041012    2c                   endif
101830041012     c                   exsr      sr_imptc12
101840070924     c* propongo eventuali gg. di chiusura se previsti nei dest.particolari
101850070924     c                   exsr      sr_impgc12
101860041012    1c                   endif
101870040608     c*
101880040608      * --> Referente e Telefono del destinatario
101890040608      *     (messaggio forzabile)
101891150213      * Solo in immissione
101892150213    0c                   If        not *in12
101900040608      * Da indicare se
101910091209      * - Spedizione FedEx
101920040608      * - Spedizione a Privati
101930040608      * - Spedizione con Appuntamento
101940040608      * - Spedizione Export in c/assegno o in porto assegnato
101950040608      * -> Referente solo sped. Export
101960040608if  1c                   If        VidRef = *Blanks and wforza1 = *Off and
101970040608     c                             ((comlna > *Zeros and
101980040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
101990040608     c                             (comlna = *Zeros and wdesie = 'E'))
102000040608if  2c                   If        §3aFca > *Zeros
102010040608     c                   Eval      VidMsg = Err(36)
102020040608     c                   Eval      *In90 = *On
102030040608    2c                   EndIf
102040040608if  2c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
102050040608     c                   Eval      VidMsg = Err(54)
102060040608     c                   Eval      *In90 = *On
102070040608    2c                   EndIf
102080040608if  2c                   If        *In90
102090040608     c                   z-add     20            H1riga
102100040608     c                   z-add     21            H1colo
102110040608     c                   Eval      wforza1 = *On
102120040608     c                   GoTo      EndC01
102130040608    2c                   EndIf
102140040608    1c                   EndIf
102150040608      * -> Telefono
102160040608if  1c                   If        VidTel = *Blanks and wforza1 = *Off
102170040608s   2c                   Select
102180040608     c                   When      a_§OgNtw = 'FED' or viddpd = 'F'
102190040608     c                   Eval      VidMsg = Err(56)
102200040608     c                   Eval      *In90 = *On
102210040608     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
102220040608     c                   Eval      VidMsg = Err(267)
102230040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
102240040608     c                   Eval      *In90 = *On
102250040608     c                   When      %subst(VidGva:1:1) = 'P'
102260040608     c                   Eval      VidMsg = Err(58)
102270040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
102280040608     c                   Eval      *In90 = *On
102290040608     c                   When      (comlna > *Zeros and
102300040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
102310040608     c                             (comlna = *Zeros and wdesie = 'E')
102320040608if  3c                   If        §3aFca > *Zeros
102330040608     c                   Eval      VidMsg = Err(36)
102340040608     c                   Eval      *In90 = *On
102350040608    3c                   EndIf
102360040608if  3c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
102370040608     c                   Eval      VidMsg = Err(54)
102380040608     c                   Eval      *In90 = *On
102390040608    3c                   EndIf
102400040608    2c                   EndSl
102410040608if  2c                   If        *In90
102420040608     c                   z-add     20            H1riga
102430040608     c                   z-add     64            H1colo
102440040608     c                   Eval      wforza1 = *On
102450040608     c                   GoTo      EndC01
102460040608    2c                   EndIf
102470040608    1c                   EndIf
102471150213    0c                   EndIf
102480910220     C*
102490910220     C* VEDO SE SPROTEGGERE LA SERIE
102500950103     C*
102510950103     C     *IN12         IFEQ      *OFF
102520950103     C                   CLEAR                   VIDNRS
102530950103     C                   ENDIF
102540930624     C* PER DISK CLIENTI
102550940930    1C     *IN12         IFEQ      *ON
102560930624     C     *IN15         ANDEQ     *ON
102570930624     C* PER SPEDIZIONI DI RECUPERO
102580930624     C     *IN12         OREQ      *OFF
102590930624     C     *IN98         ANDEQ     *ON
102600930624     C* PER SPEDIZIONI DI CLIENTI CHE SI ASSEGNANO SOLO I NUMERI SEGNAC
102610930624     C     *IN12         OREQ      *OFF
102620980410     C     §1BFG6        ANDEQ     'C'
102630930624     C     §1BFG2        ANDEQ     'N'
102640930803     C* PER CLIENTI CON SERIE
102650930803     C     *IN12         OREQ      *ON
102660930803     C     *IN15         ANDEQ     *OFF
102670930803     C     VIDNRS        ANDGT     0
102680000225     C* PER CLIENTI DISK "C"
102690000225     C     *IN12         OREQ      *ON
102700000225     C     *IN15         ANDEQ     *OFF
102710000225     C     VIDSOP        ANDEQ     ':'
102720930624     C*
102730000911     C                   CLEAR                   DS3C
102740910311     C                   MOVEL     'N'           §3CFG1
102750921012     C                   MOVEL     ' '           §3CFSP
102760910220     C                   MOVEL     '3C'          COD
102770940921     C                   MOVEL(P)  WKSC          KEY
102780910220     C*
102790930708     C                   EXSR      CTABEL
102800910301     C  N30              MOVEL     TBLUNI        DS3C
102810100517     C* SE IL TERMINAL NON HA ANCHILOSATO, NON LO HA NEMMENO IL CLIENT
102820000204     C     WASDKC        IFNE      'S'
102830000204     C                   CLEAR                   §3CDKC
102840000204     C                   ENDIF
102850921006     C*
102860980805   1AC     *IN30         IFEQ      *OFF
102870980805     C     §3COKD        ANDEQ     '*'
102880980805    2C     *IN12         IFEQ      *OFF
102890921006     C     *IN98         ANDEQ     '1'
102900921006     C                   SETON                                        95
102910921006     C                   MOVEL     §3CNRS        VIDNRS
102920921006     C*
102930940930   X2C                   ELSE
102940921006     C*
102950940930    3C     §3CFG1        IFEQ      'S'
102960910220     C                   SETON                                        95
102970910426     C* SE FLAG6 DEL CLIENTE PROPONGO GIA' LA SERIE
102980940930    4C     §1BFG6        IFEQ      'C'
102990921006     C     VIDNRS        ANDEQ     0
103000910426     C                   MOVEL     §3CNRS        VIDNRS
103010940930    4C                   END
103020910426     C*
103030940930    3C                   END
103040940930    2C                   END
103050980805   1AC                   END
103060980805    1C                   END
103070940930     C*
103080080313      * verifico se cliente ha serie parziale
103090100517     c******             exsr      sr_parz
103100940930     C* PER DISK CLI TENGO QUELLO PASSATO SOLO SE :
103110940930     C*  ABILITATO DA DS DEL CLIENTE
103120940930     C*  ABILITATO IL COD TASSAZIONE ALLA FORZATURA
103130120712     c* ES 12/07/12 --> tolto non più usata da tempo questa forzatura
103140120712     C** 12
103150120712     C*N 15§3CFCT        IFEQ      'S'
103160120712     C**                 MOVEL     'CT'          COD
103170120712     C**                 MOVEL(P)  §LPCTS        KEY
103180940930     C*
103190120712     C**                 EXSR      CTABEL
103200120712     C**N30              MOVEL     TBLUNI        DSCT
103210120712     C**N30§CTFDK        IFEQ      'S'
103220120712     C**                 MOVEL     §LPCTS        SAVCTS
103230120712     C**                 ENDIF
103240120712     C**                 ENDIF
103250910805     C*
103260910805     C* PER DISK CLI SE FLAG 6 NON E' "C" AZZERO LA SERIE
103270910805     C   12
103280910805     CAN 15§1BFG6        IFNE      'C'
103290921019     C     §1BFG8        ANDNE     'N'
103300910805     C                   Z-ADD     0             VIDNRS
103310910805     C                   END
103320940930     C*
103330910410     C* PULIZIA CAMPI NUMERO SEGNACOLLI SE IMMISSIONE E STAMPA SEGNAC
103340910410     C* NELL'ORGANIZZAZIONE
103350910410     C  N12
103360910410     CAN 25              Z-ADD     0             VIDNCD
103370910410     C  N12
103380910410     CAN 25              Z-ADD     0             VIDNCA
103390910606     C* PER DISK CLI AZZERO SOLO SE NON SI ASSEGNA I NUMERI SEGNACOLLI
103400980410     C   12
103410980410     CAN 25
103420980410     CAN 15§1BFG6        IFNE      'C'
103430910606     C                   Z-ADD     0             VIDNCD
103440910606     C                   Z-ADD     0             VIDNCA
103450910607     C                   END
103460910808     C  N12
103470910808     COR 12
103480910808     CAN 15              MOVEL     *BLANKS       VIDFNS
103490910805     C* CONTROLLO SE NON SEQUENZIALI
103500960805     C   12
103510960805    1CAN 15§1BFG7        IFEQ      'S'
103520980410     C     §1BFG6        ANDEQ     'C'
103530920917     C*
103540020917     C     KBLC          SETLL     FIVAD000
103550020917     C     KBLC          READE(N)  FIVAD000                               30
103560960805    3C  N30BLDNCA        IFNE      0
103570941230     C                   Z-ADD     BLDNCA        COMSCD
103580920917     C                   ELSE
103590941230     C                   Z-ADD     BLDNCD        COMSCD
103600960805    3C                   ENDIF
103610941230     C                   Z-ADD     BLDNCD        VIDNCD
103620941230     C                   SUB       BLDNCL        COMSCD
103630910805     C*
103640960805    3C     *IN30         DOWEQ     *OFF
103650941230     C                   ADD       BLDNCL        COMSCD
103660960805    4C     BLDNCA        IFNE      0
103670960805    5C     COMSCD        IFNE      BLDNCA
103680920917     C                   SETON                                        30
103690960805    5C                   ENDIF
103700920917     C*
103710960805   X4C                   ELSE
103720920917     C*
103730960805    5C     COMSCD        IFNE      BLDNCD
103740910805     C                   SETON                                        30
103750960805    5C                   ENDIF
103760960805    4C                   ENDIF
103770920917     C*
103780920917     C   30              MOVEL     'S'           VIDFNS
103790020917     C  N30KBLC          READE(N)  FIVAD000                               30
103800960805    3C                   ENDDO
103810920917     C* NON SEQ.: AZZERO
103820960805    3C     VIDFNS        IFEQ      'S'
103830910805     C                   Z-ADD     0             VIDNCD
103840910805     C                   Z-ADD     0             VIDNCA
103850920917     C*
103860960805   X3C                   ELSE
103870920917     C* SEQ : IMPOSTO SEGNACOLLO AL
103880960805    4C     V1CNCL        IFGT      1
103890960805    5C     BLDNCA        IFNE      0
103900941230     C                   Z-ADD     BLDNCA        VIDNCA
103910960805   X5C                   ELSE
103920941230     C                   Z-ADD     BLDNCD        VIDNCA
103930960805    5C                   ENDIF
103940960805    4C                   ENDIF
103950960805    3C                   ENDIF
103960960805     C* MI SALVO I SEGNACOLLI DAL / AL CHE NON POSSONO ESSERE MODIFICAT
103970960805     C                   Z-ADD     VIDNCD        WNSNCD
103980960805     C                   Z-ADD     VIDNCA        WNSNCA
103990910805     C*
104000960805    1C                   ENDIF
104010961111     C***
104020961111     C*** SE BOLLA EXPORT CON C/A PROTEGGO TIPO INCASSO E DIVISA
104030961111     C***
104040121022     C     COMLNA        IFEQ      0
104050121022     C     WDESIE        ANDEQ     'E'
104060121022     C     COMLNA        ORGT      0
104070121022     c     A_§ogntw      andeq     'EEX'
104080121022     C     COMLNA        ORGT      0
104090121022     c     A_§ogntw      andeq     'FED'
104100121022     C     COMLNA        ORGT      0
104110121022     c     A_§ogntw      andeq     'DPD'
104120020319     c
104130121022     C     §3AFCA        IFGT      0
104140121022     C***                SETON                                        76
104150121022     C***                MOVEL     'BM'          VIDTIC
104160011108     C**         VIDVCA    IFEQ *BLANKS
104170011108     C* Con l'euro la divisa non sarà mai più a blank, quindi propongo
104180011108     C* la divisa della nazione del destinatario solo se importo C/A=0
104190050504     c* 04/05/05: Se divisa della nazione diversa da "EUR" o "USD"
104200050504     c* non propongo niente. Questo per evitare errori da parte del
104210050504     c* bollettista di indicazione della divisa sbagliata in particolar
104220050504     c* per le spedizioni dirette a paesi europei che hanno conservato
104230050504     c* la loro divisa (Svizzera, Danimarca...)
104240121022     C     VIDCAS        IFEQ      *ZEROS
104250121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
104260121022     C                   MOVEL     DESVLT        VIDVCA
104270121022     C                   MOVEL     DESVLT        VARVCA
104280121022     c                   else
104290121022     C                   clear                   VIDVCA
104300121022     C                   clear                   VARVCA
104310121022     c                   endif
104320121022     C                   ENDIF
104330980219     C**
104340121022     C                   ELSE
104350121022     C                   CLEAR                   VIDTIC
104360121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
104370121022     C                   MOVEL     DESVLT        VIDVCA
104380121022     C                   MOVEL     DESVLT        VARVCA
104390121022     c                   else
104400121022     C                   clear                   VIDVCA
104410121022     C                   clear                   VARVCA
104420121022     c                   endif
104430121022     C                   ENDIF
104440011108     C                   ELSE
104450011108     C* SE DESTINATARIO NON È EXPORT E IMPORTO CONTRASSEGNO = 0
104460011108     C* PROPONGO GEDCN
104470011108     C     VIDCAS        IFEQ      *ZEROS
104480011108     C                   MOVEL     §GEDCN        VIDVCA
104490011108     C                   MOVEL     §GEDCN        VARVCA
104500011108     C                   ENDIF
104510961111     C                   ENDIF
104520091210     c***
104530091210     C*** Richiamo routine per impostare eventuali forzature flag DDT
104540091210     c***
104550091210     c                   exsr      SR_FRZBAM
104560070326     c***
104570070326     C* IMPOSTO LNA DPD SE NON 'C'E'
104580070326    1C     VIDDPD        IFEQ      'D'
104590070326     C     WDESIE        ANDEQ     'E'
104600070326     C     A_§OGNTW      OREQ      'DPD'
104610070326    2C     VIDLNA        IFLE      *ZEROS
104620070326     C     DESLAD        ANDGT     0
104630070326     C                   Z-ADD     DESLAD        COMLNA
104640070326    2C                   ENDIF
104650070326    1C                   ENDIF
104660070326     C* SE NUMERO AUTOMATICO, LO PRELEVO
104670070326     c* 22/03/07: Prelevo quello automatico anche nel caso di inserimen
104680070326     c* to numero parcel lungo 12 in quanto dal 01/04/07 non saranno
104690070326     c* più gestiti da DPD
104700070326     C  N12
104710070326    1COR 15VIDDPD        IFEQ      'D'
104720070326     C     WDESIE        ANDEQ     'E'
104730070326     C     A_§OGNTW      OREQ      'DPD'
104740070326    2c                   if        Comnrd=0 and (§1bf13='A' or
104750070326     c                             wparcel='12')
104760070515    3c****               if        dateu >= §vpodpd
104770070326     c                   clear                   trul33ds
104780070326     c                   z-add     25            i33cnu
104790070326     c                   z-add     1             i33num
104800070326     c                   movel     trul33ds      kpjbu
104810070326     c                   call      'TRUL33R'
104820070326     c                   PARM                    kpjba
104830070326     c                   movel     kpjbu         trul33ds
104840070326    4c     o33err        ifgt      *zeros
104850070326     c                   seton                                        90
104860070326    5c                   select
104870070326     c     o33err        wheneq    1
104880070326     c                   movel     err(300)      vidmsg
104890070326     c     o33err        wheneq    2
104900070326     c                   movel     err(301)      vidmsg
104910070326     c     o33err        wheneq    3
104920070326     c                   movel     err(302)      vidmsg
104930070326    5c                   endsl
104940070326     c                   goto      endc01
104950070326    4c                   endif
104960070326     c                   z-add     o33nri        comnrd
104970070515   x3c****               else
104980070515     C**** KTBE          CHAIN     TNTBE02L                           30
104990070326     C* E NON C'E' LO CREO
105000070515     C***30              CLEAR                   TNTBE000
105010070515     C***30              CLEAR                   DCHI
105020070515     C**N30              MOVEL     TBEUNI        DCHI
105030070515     C***                ADD       1             §CHINM
105040070515     C***                MOVEL     DCHI          TBEUNI
105050070515    3C***  *IN30         IFEQ      *OFF
105060070515     C***                UPDATE    TNTBE000
105070070515     C***                ELSE
105080070515     C***                MOVEL     KTCOD         TBECOD
105090070515     C***                MOVEL     KTLIN         TBELIN
105100070515     C***                MOVEL     KTSIF         TBESIF
105110070515     C***                MOVEL     KTKE1         TBEKE1
105120070515     C***                MOVEL     KTKE2         TBEKE2
105130070515     C***                MOVEL     'DP'          TBEKE2
105140070515     C***                WRITE     TNTBE000
105150070515    3C***                ENDIF
105160070515     C***                CLEAR                   DPDBRC
105170070515     C***                MOVEL     §CHINM        DPDBRC
105180070515     C***                CLEAR                   DPDCHD
105190070515     C***                EXSR      M1031
105200070515     C***                z-add     DPDBRC        COMNRD
105210070515    3c***                endif
105220070326    2c                   endif
105230070326    1c                   endif
105240070326     c* Impostazione numero parcel dpd: se attribuzione automatica o
105250070326     c* numero parcel lungo 12 coincide con numero preso da numeratore
105260070326     c* altrimenti è quello immesso a video
105270070326    1c                   if        (*in12='0' or *in15=*on) and
105280070326     c                             ((viddpd='D' and wdesie='E') or
105290070326     c                             A_§ogntw='DPD')
105300070326     c                             and (§1bf13='A' or wparcel='12')
105310070515    2c***                if        dateu >= §vpodpd
105320070326     c                   move      comnrd        v7cnpr
105330070515   x2c***                else
105340070326     c** parcel lungo 12
105350070515     c***                z-add     comnrd        w0120            12 0
105360070515     C***                movel     w0120         V7CNPR
105370070515    2c***                endif
105380070326     c* se sono in bollettazione (no conferma bolle) non propongo più
105390070326     c* numero parcel dpd nel RMN
105400070326    2C   15VIDRMN        IFEQ      0
105410070326     C                   z-add     COMNRD        VIDRMN
105420070326    2C                   ENDIF
105430070326   x1c                   else
105440070326    2c                   if        (*in12='0' or *in15=*on) and
105450070326     c                             vidnrd<>*blanks
105460070326     c* se numero dpd numerico lo propongo nel rif.mittente come segue:
105470070326     c* - Se spedizione export --> solo in conferma bolle da cliente
105480070326     c* - Se spedizione import --> sempre
105490070326     c* se numero dpd alfanumerico e spedizione import imposto 1 in rmn
105500070326     c* Numero parcel dpd numerico
105510070326    3c                   if        wsolo_num=*blanks
105520070326     c* export
105530070326    4c                   if        (*in15=*on and *in79=*off
105540070326     c                             and vidrmn=0)
105550070326     c* import
105560070326     c                             or (*in79='1')
105570070326     c                   clear                   vidrmn
105580070326    5c                   if        %subst(vidnrd:14:1) <> *blanks
105590070326     C                   move      VIDNRD        VIDRMN
105600070326     c                   else
105610070326     c                   eval      w012a=%subst(vidnrd:1:12)
105620070326     c                   move      w012A         vidrmn
105630070326    5c                   endif
105640070326    4C                   ENDIF
105650070326   x3c                   else
105660070326     c* Numero parcel dpd alfanumerico
105670070326    4c                   if        *in79='1'
105680070326     c                   z-add     1             vidrmn
105690070326    4c                   endif
105700070326    3c                   endif
105710070326     C                   movel     VIDNRD        V7CNPR
105720070326    2c                   endif
105730070326    1c                   endif
105740000623     C***
105750000623     C* CONTROLLO SE ESISTE LA DS3Q PER IL CIENE MITTENTE
105760970326     C***
105770000623     C                   CLEAR                   WES3Q
105780000623     C                   MOVEL     '3Q'          COD
105790000623     C                   MOVEL(P)  WKSC          KEY
105800000623     C*
105810000623     C                   EXSR      CTABEL
105820000623     C  N30              MOVEL     'S'           WES3Q             1
105830000623     C   30              MOVEL     ' '           WES3Q             1
105840011112     C***
105850011112     C* DIVISA IMPORTO DA ASSICURARE: PROPONGO DIVISA NAZIONE MITTENTE
105860011112     C*        SE ESTERO ALTIMENTI PROPONGO §GEDCN
105870011112     C***
105880011112     C     VIDIAS        IFEQ      *ZEROS
105890011112     C     MITVLT        IFNE      *BLANKS
105900011112     C     WMITIE        ANDEQ     'E'
105910011112     C                   MOVEL     MITVLT        VIDVAS
105920011112     C                   MOVEL     MITVLT        VARVAS
105930011112     C                   ELSE
105940011112     C                   MOVEL     §GEDCN        VIDVAS
105950011112     C                   MOVEL     §GEDCN        VARVAS
105960011112     C                   ENDIF
105970011112     C                   ENDIF
105980011113     C***
105990011113     C* DIVISA VALORE MERCE DICHIAR.: PROPONGO DIVISA NAZIONE MITTENTE
106000011113     C*        SE ESTERO, ALTIMENTI PROPONGO §GEDCN
106010011113     C***
106020011113     C     VIDVMD        IFEQ      *ZEROS
106030011115     C     MITVLT        IFNE      *BLANKS
106040011113     C     WMITIE        ANDEQ     'E'
106050011113     C                   MOVEL     MITVLT        VIDVAD
106060011113     C                   MOVEL     MITVLT        VARVAD
106070011113     C                   ELSE
106080011113     C                   MOVEL     §GEDCN        VIDVAD
106090011113     C                   MOVEL     §GEDCN        VARVAD
106100011113     C                   ENDIF
106110011115     C                   ENDIF
106120000120     C***
106130940920     C     ENDC01        TAG
106140940909     C   90              MOVEL     '1'           WEMFOR
106150940909     C                   ENDSR
106160940224     C*
106170940921     C* RICERCA E CARICAMENTO A VIDEO TARIFFE ------------------------*
106180940224     C     RICTAR        BEGSR
106190940921     C                   SETOFF                                       30
106200941221     C                   CLEAR                   WTACAR
106210941221     C                   CLEAR                   WTKS
106220991026     C                   CLEAR                   COMDIV
106230940921     C*
106240940921     C* PER DISK CLI PRENDO SEMPRE LA TARIFFA DEL CLIENTE
106250940921    1C     *IN12         IFEQ      *ON
106260940921     C     *IN15         ANDEQ     *ON
106270940921     C                   MOVEL     §LPCTR        VIDCTR
106280050921     C                   MOVEL     §LPCTR        ilv59ctr
106290050921     C                   MOVEL     'S'           ilv59ric
106300940921     C*
106310940921   X1C                   ELSE
106320010223     C*
106330130404     c* 1) caso IMISSIONE
106340130404     c* 2) caso manutenzione con ricaricamento tariffe
106350010223    2C  N29WORM          IFEQ      'S'
106360010223     C     FLGFIT        ANDNE     'S'
106370010223     C     PARTCH        ANDNE     'P'
106380050921     C     ilv59ric      ANDEQ     'S'
106390010223    3C     *IN12         IFEQ      *OFF
106400010223     C     *IN15         OREQ      *OFF
106410010223     C     WORMMD        ANDEQ     '1'
106420030905    4c                   If        §OrPfb <> 'A'
106430010223     C                   MOVE      VIDCCM        W0070             7 0
106440010223    5C     VIDFLC        IFEQ      *ZEROS
106450010223     C                   MOVEL     VIDLNP        W0070
106460010223     C                   ELSE
106470010223     C                   MOVEL     VIDFLC        W0070
106480010223    5C                   ENDIF
106490010223    5C     W0070         IFEQ      ORMKSC
106500010223     C     ORMCTR        ANDNE     *BLANKS
106510010223     C                   MOVE      ORMCTR        VIDCTR
106520010223     C                   MOVE      ORMCTR        PRECTR
106530050921     C                   MOVE      ORMCTR        ilv59ctr
106540010223    5C                   ENDIF
106550010223    4C                   ENDIF
106560010223    3C                   ENDIF
106570010223    2C                   ENDIF
106580130404     c*
106590130404     c* 3) caso manutenzione solo con  cambio ORM
106600130404    2C  N29WORM          IFEQ      'S'
106610130404     C     FLGFIT        ANDNE     'S'
106620130404     C     PARTCH        ANDNE     'P'
106630130404     C     ilv59ric      ANDEQ     ' '
106640130404     C     *IN12         andeq     *On
106650130404     C     *IN15         andeq     *OFF
106660130404     C     WORMMD        ANDEQ     '1'
106670130404     C     ORMCTR        ANDNE     *BLANKS
106680130404    4c                   If        §OrPfb <> 'A'
106690130404     C                   MOVE      VIDCCM        W0070             7 0
106700130404    5C     VIDFLC        IFEQ      *ZEROS
106710130404     C                   MOVEL     VIDLNP        W0070
106720130404     C                   ELSE
106730130404     C                   MOVEL     VIDFLC        W0070
106740130404    5C                   ENDIF
106750130404    5C     W0070         IFEQ      ORMKSC
106760130404     c                   if        ormctr<>vidctr
106770130404     c                   eval      CambiaCTR='S'
106780130404     c                   endif
106790130404     C                   MOVE      ORMCTR        VIDCTR
106800130404     C                   MOVE      ORMCTR        PRECTR
106810130404     C                   MOVE      ORMCTR        ilv59ctr
106820130404    5C                   ENDIF
106830130404    4C                   ENDIF
106840130404    2C                   ENDIF
106850940921     C*
106860940224     C* PER : IMMISSIONE (SE NON PERSONALIZZATO IL COD TARIFFA)
106870940921     C*       E MANUTENZIONE BOLLE
106880941107    2C     *IN29         IFEQ      *ON
106890941231     C* SE NON LO DEVO RICARICARE, IMPOSTO IL CODICE TARIFFA
106900050921     C     ilv59ric      ORNE      'S'
106910050921     C                   MOVEL     VIDCTR        ilv59ctr
106920941107    2C                   ENDIF
106930941107    1C                   ENDIF
106940950525     C* SE VIDCTR = '   ' E' COME SE LO DOVESSI RICARICARE
106950950525     C     VIDCTR        IFEQ      *BLANKS
106960050921     C                   MOVEL     'S'           ilv59ric
106970950525     C                   ENDIF
106980941107     C*
106990941107     C* SE ESISTONO TARIFFE PER IL CLIENTE CERCO
107000050921     C                   MOVEL     'P'           ilv59tbo
107010040512      * se bolla monovaria pulisco il tipo bolla
107020040512     C                   IF        §3ASVA <> *BLANK
107030050921     C                   CLEAR                   ilv59tbo
107040050921     c                   movel     'P'           ilv59prp
107050040512     C                   ENDIF
107060040512
107070050921     C                   MOVEL     WKSC          ilv59ksc
107080050921     C                   MOVEL     KCI           ilv59kci
107090050921     C                   MOVEL     BLPDSP        ilv59dsp
107100050921     C                   MOVEL     VIDTSP        ilv59tsp
107110050921     C                   MOVEL     WFIE          ilv59fie
107120050921     C                   CALL      'FNLV59R'
107130050921     C                   PARM                    fnlv59ds
107140900528     C*
107150050922     c* se avevo richiamato con CON e RIC vuoti il cod.tariffa non
107160050922     c* viene impostato. Quindi in questo caso non imposto vidctr
107170050922     c* Avrei potuto condizionare il richiamo di fnlv59r da con e/o ric
107180050922     c* pieni ma in questo caso mi si poneva il problema dell'impostazi
107190050922     c* one di wtacar, wtks e comdiv in caso di manutenzione.
107200050922     c                   if        ilv59ric <> ' ' or ilv59con <> ' '
107210080403     c*
107220080326     c                   if        olv59ctr<>vidctr
107230080326     c                   eval      CambiaCTR='S'
107240080326     c                   endif
107250080326     c
107260050921     C                   MOVEL     olv59ctr      VIDCTR
107270050921     C                   MOVEL     olv59dfs      DEFCTR
107280050922     c                   endif
107290941221     C*
107300941221     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDO SEMPRE DATI DAL
107310941221     C* LA TARIFFA DI CARTELLO
107320050921     C     olv59tks      IFEQ      ' '
107330941221     C                   MOVEL     'S'           WTACAR            1
107340950410     C                   CLEAR                   UND
107350950410     C* SOLO SE LA DEVO RICARICARE LA AZZERO
107360050921     C  N29ilv59ric      IFEQ      'S'
107370941221     C                   MOVEL     *ZEROS        VIDCTR
107380021120      * Per bolla FedEx imposto il codice tariffa della cartello FedEx
107390021120     c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
107400021120     c                   Movel     O27Ctr        VidCtr
107410021120     c                   EndIf
107420950410     C                   ENDIF
107430941221     C                   ENDIF
107440950410     C*
107450050921     C                   MOVEL     olv59tks      WTKS
107460941231     C* SE HO RICERCATO LA TARIFFA RICARICO IL PRG ALTRIMENTI
107470941231     C*  LO PULISCO
107480050921     C     ilv59ric      IFEQ      'S'
107490050921     C     olv59err      ANDEQ     ' '
107500050921     C     olv59tks      ANDEQ     'S'
107510050921     C                   MOVEL     olv59prg      COMPRG
107520941231     C                   ENDIF
107530950103     C*
107540050921     C     olv59err      IFNE      ' '
107550050921     C     olv59tks      ORNE      'S'
107560941231     C                   Z-ADD     0             COMPRG
107570941231     C                   ENDIF
107580940921     C*
107590940921     C* SE LA TARIFFA E' FRA QUELLE TROVATE, CARICO GLI ALTRI DATI DEL
107600941110     C* ALTRIMENTI LI PRENDO SEMPRE DALLA TARIFFA DI CARTELLO
107610050921     C     ilv59ric      IFEQ      'S'
107620940922     C                   EXSR      CTNTAM
107630010223     C*
107640950103     C                   ENDIF
107650941107     C*
107660941107     C* IMPOSTO I CAMPI DEI CODICI TARIFFA A VIDEO
107670050921     C                   MOVEL     olv59ct2      VIDCT2
107680050921     C                   MOVEL     olv59ct3      VIDCT3
107690050921     C                   MOVEL     olv59ct4      VIDCT4
107700050921     C                   MOVEL     olv59ct5      VIDCT5
107710050921     C                   MOVEL     olv59es2      VIDES2
107720050921     C                   MOVEL     olv59es3      VIDES3
107730050921     C                   MOVEL     olv59es4      VIDES4
107740050921     C                   MOVEL     olv59es5      VIDES5
107750940921     C*
107760940922     C* OGNI VOLTA CHE MODIFICATO IL COD MITTENTE, PER CUI RICARICO
107770940922     C*  LE TARIFFE, IMPOSTO "SAVCTR" CON QUELLO PROPOSTO
107780940922     C*  IN QUANTO I CAMPI LI HO PROPOSTI A VIDEO
107790940922     C                   MOVEL     VIDCTR        SAVCTR
107800930803     C                   SETOFF                                       30
107810900504     C                   ENDSR
107820940922     C*
107830940922     C* CHAIN SU TNTAM00F PER PRENDERE I CAMPI DA PROPORRE -----------*
107840940922     C     CTNTAM        BEGSR
107850941221     C                   SETOFF                                       30
107860010226     C                   CLEAR                   WNNTAR
107870010226     C                   CLEAR                   WN1TAR
107880050926     C                   CLEAR                   fvol              1
107890941231     C*
107900941231    1C     WTACAR        IFEQ      ' '
107910941231     C* ERRORE: NON TROVATA PROGRESSIVO COL CODICE TARIFFA
107920941231     C* IMPOSTATO
107930050921    2C     olv59err      IFNE      ' '
107940941221     C                   SETON                                        30
107950941221     C                   ELSE
107960941231     C                   MOVEL     VIDCTR        COMCTR
107970941231     C**
107980940922     C     KTAM2         CHAIN     TNTAM000                           30
107990110304     c
108000941231    2C                   ENDIF
108010941221     C*
108020941231   X1C                   ELSE
108030941221     C* TARIFFA DI CARTELLO
108040941107     C     KCAR2         CHAIN     TNTAM000                           30
108050941231    1C                   ENDIF
108060941221     C  N30              MOVEL     TAMDCV        DEVCTR
108070040610     C  N30              MOVEL     TAMflo        dsta01
108080961203     C* PRENDO TASSAZIONE TARIFFA MITT SOLO SE NON PROVENGO DA
108090961203     C*  GIACENZE PERCHE' IN DIROTTAMENTO NON HO PIU' LE TARIFFE
108100961203     C*  ORIGINALI
108110961203     C  N30
108120961203     CANN87              MOVEL     TAMFTM        SAVFTM
108130941221     C   30              CLEAR                   DEVCTR
108140941221     C   30              CLEAR                   SAVFTM
108150940922     C*
108160940922     C* PER DISK CLIENTI
108170940922     C* I CAMPI LI PRENDO SOLO SE SONO VUOTI
108180940922     C* PER IL RESTO       SEMPRE
108190941231    1C     *IN12         IFEQ      *ON
108200940922     C     *IN15         ANDEQ     *ON
108210970328     C*
108220970328     C  N30§LPBAM        IFEQ      ' '
108230970328     C                   MOVEL     TAMBAM        VIDBAM
108240970328     C                   ENDIF
108250940922     C*
108260941231    2C     §LPNAS        IFEQ      *BLANKS
108270941221     C  N30              MOVEL     TAMNAS        VIDNAS
108280030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
108290030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
108300030409     c                             and Not *In30
108310030409     c                   Clear                   VidNas
108320030409     c                   EndIf
108330941221     C   30              CLEAR                   VIDNAS
108340941231    2C                   ENDIF
108350040610     c* Tipo merce: V-Valore
108360040610     C  N30§lpbva        IFEQ      ' '
108370040610     c     §1bfg8        andne     'N'
108380040610     C                   MOVEL     §tabva        VIDbva
108390040610     C                   ENDIF
108400040610     c*
108410941231    2C     §LPNOT        IFEQ      *BLANKS
108420941221     C  N30              MOVEL     TAMNOT        VIDNT1
108430941221     C   30              CLEAR                   VIDNT1
108440941231   X2C                   ELSE
108450941231    3C     §LPNT2        IFEQ      *BLANKS
108460941221     C  N30              MOVEL     TAMNOT        VIDNT2
108470941221     C   30              CLEAR                   VIDNT2
108480941231    3C                   ENDIF
108490941231    2C                   ENDIF
108500940922     C*§
108510940922     C* GESTIONE PARTIC.C/A SOLO SE BOLLA CON C/A
108520941231    2C     §3AFCA        IFNE      0
108530940922     C     §LPGCA        ANDEQ     *BLANKS
108540940922     C     §3AFCA        ANDNE     0
108550941221     C  N30              MOVEL     TAMGCA        VIDGCA
108560941221     C   30              CLEAR                   VIDGCA
108570941231    2C                   ENDIF
108580941231    2C     §LPGGA        IFEQ      *BLANKS
108590941221     C  N30              MOVEL     TAMGGA        VIDGGA
108600941221     C   30              CLEAR                   VIDGGA
108610941231    2C                   ENDIF
108620941231    2C     §LPGMA        IFEQ      *BLANKS
108630100215     C  N30              MOVEL     TAMGMA        VIDGMA
108640941221     C   30              CLEAR                   VIDGMA
108650941231    2C                   ENDIF
108660941231    2C     §LPGVA        IFEQ      *BLANKS
108670941221     C  N30              MOVEL     TAMGVA        VIDGVA
108680941221     C   30              CLEAR                   VIDGVA
108690941231    2C                   ENDIF
108700940922     C*
108710941231   X1C                   ELSE
108720010226     C*
108730010226     C* NATURA MERCE
108740010226     C* SE NON E' STATA PERSONALIZZATA ED E' ATTIVATA PROCEDURA ORM
108750010226     C* DEVO PROPORRE LA NATURA MERCE DELL'ORM SE PRESENTE E NON
108760010226     C* QUELLA DA TARIFFA.
108770010226     C* IDEM PER LE NOTE
108780011221     C                   MOVEL     ORMNAM        W015A
108790010226    3C     WORM          IFEQ      'S'
108800010226     C     FLGFIT        ANDNE     'S'
108810010226     C     PARTCH        ANDNE     'P'
108820050921     C     ilv59ric      ANDEQ     'S'
108830010226     C     *IN27         IFEQ      *OFF
108840011221     C     W015A         ANDNE     *BLANKS
108850010226     C                   MOVEL     ORMNAM        VIDNAS
108860010226     C                   MOVEL     '1'           WNNTAR            1
108870010226     C                   ENDIF
108880010404     C* NOTE SE PESO > 50 Q.LI  O SE O.R.M COMMISSIONATO
108890010307    4C                   SELECT
108900010307     C     §LPFPR        WHENEQ    'O'
108910050211     C***  ORMPOE        ORNE      ORMPOR
108920080326     c                   if        vidnt1=*blanks
108930010307     C                   MOVEL     WTELRF        VIDNT1
108940080326     c                   else
108950080326     c                   if        vidnt2=*blanks
108960080326     C                   MOVEL     WTELRF        VIDNT2
108970080326     c                   endif
108980080326     c                   endif
108990080326     c
109000010307     C                   MOVEL     '1'           WN1TAR
109010010409     C     VIDPKG        WHENGE    §DFMAX
109020010226    5C     ORMNO1        IFNE      *BLANKS
109030080326     c                   if        vidnt1=*blanks
109040010226     C                   MOVEL     ORMNO1        VIDNT1
109050080326     c                   else
109060080326     c                   if        vidnt2=*blanks
109070080326     C                   MOVEL     ORMNO1        VIDNT2
109080080326     c                   endif
109090080326     c                   endif
109100010226     C                   MOVEL     '1'           WN1TAR            1
109110010226    5C                   ENDIF
109120010307    4C                   ENDSL
109130010226    3C                   ENDIF
109140941231     C*
109150941231    3C     *IN30         IFEQ      *OFF
109160080326   3ac                   if        CambiaCTR='S'
109170080326     c
109180080326    4C     WNNTAR        IFEQ      *BLANKS
109190080326     c* solo se ho modificato la tariffa
109200941231     C  N27              MOVEL     TAMNAS        VIDNAS
109210030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
109220080326    5c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
109230030409     c                             and Not *In27
109240030409     c                   Clear                   VidNas
109250080326    5c                   EndIf
109260080326    4C                   ENDIF
109270080326    4C     WN1TAR        IFEQ      *BLANKS
109280080326     c* In manutenzione solo se sono vuote
109290080326    5c     vidnt1        ifeq      *blanks
109300110304     c     vidnt1        oreq      savnot
109310940922     C                   MOVEL     TAMNOT        VIDNT1
109320110304     c                   movel     tamnot        savnot
109330080326     c                   else
109340080326    6c     vidnt2        ifeq      *blanks
109350110304     c     vidnt2        oreq      savnot
109360080326     C                   MOVEL     TAMNOT        VIDNT2
109370110304     c                   movel     tamnot        savnot
109380080326    6c                   endif
109390080326    5c                   endif
109400080326     c
109410080326    4C                   ENDIF
109420080326     c
109430080326    4c     atrbva        ifne      prri
109440040610     c     §1bfg8        andne     'N'
109450040610     c                   movel     §tabva        vidbva
109460080326    4c                   endif
109470941231    4C     §3AFCA        IFNE      0
109480940922     C                   MOVEL     TAMGCA        VIDGCA
109490941231    4C                   ENDIF
109500940922     C                   MOVEL     TAMGGA        VIDGGA
109510940922     C                   MOVEL     TAMGMA        VIDGMA
109520940922     C                   MOVEL     TAMGVA        VIDGVA
109530970128     C                   MOVEL     TAMBAM        VIDBAM
109540080326   3ac                   endif
109550080326     c
109560941231   X3C                   ELSE
109570941221     C*
109580941221     C* PULISCO I CAMPI CHE PRENDO DA TARIFFA
109590010226     C     WNNTAR        IFEQ      *BLANKS
109600941221     C  N27              CLEAR                   VIDNAS
109610010226     C                   ENDIF
109620080326   3ac                   if        CambiaCTR='S'
109630080326     C**   WN1TAR        IFEQ      *BLANKS
109640080326     C**                 CLEAR                   VIDNT1
109650080326     C**                 ENDIF
109660040610     c                   clear                   vidbva
109670941221     C                   CLEAR                   VIDGCA
109680941221     C                   CLEAR                   VIDGGA
109690941221     C                   CLEAR                   VIDGMA
109700941221     C                   CLEAR                   VIDGVA
109710970128     C                   MOVEL     'N'           VIDBAM
109720080326   3aC                   ENDIF
109730080326    3C                   ENDIF
109740010226     C*
109750941231    1C                   ENDIF
109760940922     C*
109770950125     C* IN MANUTENZIONE SE CAMBIANO CLIENTE, CAMBIO SEMPRE
109780950125     C*     IL TIPO SERVIZIO a meno che non sia stato inserito
109790950125     C*
109800950125     C* IN IMMISSIONE TIPO SERVIZIO LO PRENDO SOLO SE NON IMMESSO
109810950103    1C     VIDTSP        IFEQ      ' '
109820950125     C*
109830950125     C     *IN12         OREQ      *ON
109840950125     C     *IN15         ANDEQ     *OFF
109850950125     C     VIDTSP        ANDEQ     BLPTSP
109860950125     C     TAMTSP        ANDNE     BLPTSP
109870050921     C     ilv59ric      ANDEQ     'S'
109880950410     C     DOD           ANDEQ     0
109890100330     c     wesore        andne     'S'
109900100330     c
109910100330     c     wesore        andne     'S'
109920100330     c
109930941110     C* DECODIFICO
109940941110     C                   Z-ADD     1             C                 3 0
109950941110     C     TAMTSP        LOOKUP    TSP(C)                                 30
109960090604     C**!30              MOVEL     DTS(C)        V2DTSP
109970090604     C   30              MOVEL     DTS08(C)      V2DTSP
109980941110     C  N30              CLEAR                   V2DTSP
109990941110     C* SALVO
110000941110     C                   MOVEL     TAMTSP        COMTSP
110010941107     c*
110020950410     C* EMETTO IL MESSAGGIO SOLO SE CIO' CHE C'E' IN BOLLA E' DIVERSO
110030950103    2C     *IN12         IFEQ      *ON
110040941110     C     *IN15         ANDEQ     *OFF
110050941107     C                   MOVEA     ERR(17)       K78
110060941107     C*
110070950125     C                   MOVEA     BLPTSP        K78(31)
110080950125     C                   MOVEL     WDETSP        W008A             8
110090950125     C                   MOVEA     W008A         K78(33)
110100941107     C*
110110950125     C                   MOVEA     TAMTSP        K78(53)
110120090604     C**!!!              MOVEL     DTS(C)        W008A             8
110130090604     C                   MOVEL     DTS08(C)      W008A             8
110140950125     C                   MOVEA     W008A         K78(55)
110150941107     C                   MOVEA     K78           VIDMSG
110160950125     C                   CLEAR                   VIDTSP
110170950125     C                   CLEAR                   V1DTSP
110180950125     C                   CLEAR                   VARTSP
110190950410     C                   MOVEL     1             DOD
110200950410     C                   SETON                                        9048
110210950103    2C                   ENDIF
110220950103    1C                   ENDIF
110230941107     C*
110240940922     C                   ENDSR
110250021120      *---------------------------------------------------------------*
110260021120      * Ricerco e carico tariffe
110270021120      *---------------------------------------------------------------*
110280021120     c     TarCar        BegSr
110290021120
110300021120     c                   exsr      riccar
110310021120     c   90              goto      endTar
110320021120     c                   movel     o27fie        wfie
110330021120
110340021120     c* protezione p.iva del mittente
110350021120     c     *in04         ifeq      *on
110360021120     c                   select
110370021120     c     o27ntw        wheneq    'DPD'
110380021120     c     desefd        andeq     *blanks
110390021120     c     wdesie        andeq     'E'
110400021120     c                   seton                                        39
110410021120     c     o27ntw        wheneq    'FED'
110420021120     c     deseff        andeq     *blanks
110430021120     c     wdesie        andeq     'E'
110440021120     c                   seton                                        39
110450021120     c     o27ntw        wheneq    'EEX'
110460021120     c     deseft        andeq     *blanks
110470021120     c     wdesie        andeq     'E'
110480021120     c                   seton                                        39
110490021120     c     o27ntw        wheneq    'PPT'
110500021120     c     o27ntw        oreq      'COR'
110510021120     C                   SETON                                        39
110520021120     c                   endsl
110530021120     c                   endif
110540021120     C***
110550021120     C*** CARICAMENTO DEI CODICI TARIFFA ***
110560050921     C                   CLEAR                   fnlv59ds
110570080403     c                   clear                   CambiaCTR         1
110580080403     c*
110590080403     c                   if        *in29 and vidctr<>savctr
110600080403     C                   MOVEL     'S'           ilv59ric
110610080403     c                   MOVEL     'S'           CambiaCTR
110620080403     c                   endif
110630021120     C*
110640021120     C* SE MODIFICATO IL FLAG ITALIA ESTERO --> SEMPRE
110650021120     C     WFIE          IFNE      SAVFIE
110660050921     C                   MOVEL     'S'           ilv59ric
110670021120     C                   MOVEL     WFIE          SAVFIE
110680021120     C                   ENDIF
110690021120     C* IL TIPO SERVIZIO
110700021120     C     VIDTSP        IFNE      VARTSP
110710050921     C                   MOVEL     'S'           ilv59ric
110720021120     C                   MOVEL     VIDTSP        VARTSP
110730021120     C                   ENDIF
110740021120     C*
110750021120     C*  IL CODICE MITTENTE PER MANUTENZIONE
110760021120    1C     *IN12         IFEQ      *OFF
110770021120     C     *IN15         OREQ      *OFF
110780021120     C*
110790021120     C* DA ASSEGNATO CODIFICATO AD ASSEGNATO NON CODIFICATO --> PULISCO
110800021120     C*  I CAMPI PRESI DA TARIFFA
110810021120    2C     VIDCCM        IFEQ      9999
110820021120     C     SAVCCM        IFNE      0
110830021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
110840021120     C                   MOVEL     *ZEROS        SAVCCM
110850021120     C                   CLEAR                   TRE
110860021120     C                   CLEAR                   DOD
110870021120     C*
110880021120     C* VADO IN CARICAMENTO TARIFFA SOLO PER PULIRE LE SKIERE
110890050921     C                   MOVEL     'S'           ilv59ric
110900080403     C                   MOVEL     'S'           CambiaCTR
110910080403     c
110920021120     C                   ENDIF
110930021120     C*
110940021120   X2C                   ELSE
110950021120     C* ASSEGNATO CON MITTENTE CODIFICATO
110960021120     C*
110970021120     C* MITTENTE MODIFICATO
110980021120    3C     WKSC          IFNE      SAVCCM
110990050921     C                   MOVEL     'S'           ilv59ric
111000080403     C                   MOVEL     'S'           CambiaCTR
111010021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
111020021120     C                   MOVEL     WKSC          SAVCCM
111030021120     C                   CLEAR                   TRE
111040021120     C                   CLEAR                   DOD
111050021120    3C                   ENDIF
111060021120    2C                   ENDIF
111070021120     C* VARIATO NUMERO ORM
111080021120     C     CHGORM        IFEQ      'S'
111090021120     C                   CLEAR                   CHGORM
111100130404     C******             MOVEL     'S'           ilv59ric
111110021120     C                   ENDIF
111120021120     C*
111130021120    1C                   ENDIF
111140021120     C*
111150021120     C* CARICO TARIFFE DEL CLIENTE
111160021120     C*
111170021120     C* IMPOSTO CODICE TARIFFA A VIDEO
111180021120     C* IN MANUTENZIONE LE TARIFFE VENGONO RICARICATE SOLO SE MODIFICAT
111190021120     C                   EXSR      RICTAR
111200021120     C* SE IL CLIENTE NON HA TARIFFA--> ERRORE FORZABILE
111210021120     C* SE IL CLIENTE NON HA TARIFFA DPD --> ERRORE NON FORZABILE
111220021120     C     WTKS          IFEQ      ' '
111230021120     C     VIDCCM        ANDNE     8888
111240021120     C     VIDCCM        ANDNE     9999
111250021120     C     WFIE          IFNE      'D'
111260021120     c     wfie          andne     'F'
111270021120     c     wfie          andne     'N'
111280021120     c     wfie          andne     'M'
111290021120     C     TRE           IFEQ      0
111300021120     C                   MOVEL     ERR(84)       VIDMSG
111310021120     C                   SETON                                        9050
111320021120     C                   MOVEL     1             TRE
111330021120     C                   GOTO      ENDTar
111340021120     C                   ENDIF
111350021120     C                   ELSE
111360021120     c     wfie          ifeq      'D'
111370021120     C                   MOVEL     ERR(188)      VIDMSG
111380021120     c                   else
111390021120     C                   MOVEL     ERR(246)      VIDMSG
111400021120     c                   endif
111410021120     C                   SETON                                        9050
111420021120     C                   GOTO      ENDTar
111430021120     C                   ENDIF
111440021120     C                   ENDIF
111450021120
111460021120     c     EndTar        EndSr
111470020207     C*
111480020207     C* RICERCA TARIFFA DI CARTELLO ----------------------------------*
111490020207     C     RICCAR        BEGSR
111500020213     c*
111510021120     c                   Z-Add     VidPkg        I27Pkg
111520020213     c                   movel     vidtsp        i27tsp
111530020213     c                   z-add     vidlnp        i27lnp
111540020213     c     comlna        ifgt      *zeros
111550020213     c                   z-add     comlna        i27lna
111560020213     c                   else
111570020213     c                   select
111580020213     c     viddpd        wheneq    'D'
111590020213     c     wdesie        andeq     'E'
111600020213     c                   movel     'D'           i27tln
111610020213     c     viddpd        wheneq    'F'
111620020213     c     wdesie        andeq     'E'
111630020213     c                   movel     'F'           i27tln
111640020213     c     viddpd        wheneq    ' '
111650020213     c     wdesie        andeq     'E'
111660020213     c                   movel     'E'           i27tln
111670020213     c                   other
111680020213     c                   movel     'I'           i27tln
111690020213     c                   endsl
111700020213     c                   endif
111710020213     c     vidflc        ifgt      *zeros
111720020213     c                   movel     vidflc        i27cli
111730020213     c                   else
111740020213     c                   movel     vidlnp        i27cli
111750020213     c                   endif
111760020213     c                   move      vidccm        i27cli
111770020319     c                   z-add     blpdsp        i27dta
111780020213     c*
111790020213     c                   call      'TRUL27R'
111800020213     c                   parm                    trul27ds
111810020213     c                   z-add     o27ksc        tarksc
111820020213     c                   z-add     o27ctr        tarctr
111830020319     c* errore bloccante se non trovato il progressivo
111840020320     c     o27prg        ifge      *zeros
111850020213     c                   move      o27prg        tarprg
111860020213     c                   else
111870020319     C                   SETON                                        90
111880020319     C                   MOVEL     ERR(248)      VIDMSG
111890020213     c                   endif
111900020213     c*
111910020207     c                   ENDSR
111920091210     C*--- IMPOSTAZIONE FORZATURE FLAG DDT ------------------------
111930091210     C     SR_FRZBAM     BEGSR
111940091210     C***
111950091210     C* SE BOLLA CON OBBLIGO DDT  RIMANE IMPOSTATO "S"
111960091210     C***
111970091210     C                   SELECT
111980101104     c* Se spedizione diretta a FEDEX sempre DDT SI
111990101104     c                   when      VidDpd = 'F' or a_§OgNtw = 'FED'
112000101104     C                   MOVEL     'S'           VIDBAM
112010091210     C* SE PAESE CON ATTRAVERSAMENTO DOGANA --> OBBLIGATORIA SI DDT
112020091210     C     DESEFT        WHENNE    ' '
112030091210     C     A_§OGNTW      ANDNE     'DPD'
112040091210     C     VIDDPD        ANDEQ     ' '
112050091210     c     A_§ogntw      andne     'FED'
112060091210     C                   MOVEL     'S'           VIDBAM
112070091210     c* Se richiesta bolla firmata --> Forzo si ddt
112080091210     c     vidcbo        wheneq    'FO'
112090091210     C                   MOVEL     'S'           VIDBAM
112100091210     C* SE BOLLA DI RECUPERO --> FORZI NO DDT
112110091210     C     §3ARBL        WHENEQ    'R'
112120091210     c**** vidcbo        andne     'FO'
112130091210     C                   MOVEL     'N'           VIDBAM
112140091210     C* SE OBBLIGO DDT DA CAPPARIO FORZO SI DDT
112150091210     C     DESGDD        WHENEQ    'S'
112160091210     c     savfpr        andne     'G'
112170091210     c     savfpr        andne     'P'
112180091210     C                   MOVEL     'S'           VIDBAM
112190091210     c* se bolla con estensione ddt cliente (FIVAX) forzo NO DDT
112200091210     c     §1bf16        wheneq    'S'
112210091210     c                   movel     'N'           VIDBAM
112220091210     c     §dstddt       wheneq    'S'
112230091210     c     flgtb1        andeq     'A'
112240091210     c     vidcbo        andne     'FW'
112250091210     c     vidfbr        andne     'S'
112260091210     c     savfpr        andne     'G'
112270091210     c     savfpr        andne     'P'
112280091210     c                   movel     'S'           vidbam
112290091210     C                   ENDSL
112300091210     c                   eval      savddt = vidbam
112310091210     c                   endsr
112320041012     C*
112330041012     C*--- IMPOSTAZIONE CONSEGNE PARTICOLARI Per destinatario disagiat*
112340041012     C     SR_IMPtc12    BEGSR
112350041012     C*
112360041012     c* Referente e numero di telefono: se campi a video con '#'
112370041012     c* sono quelli automatici (dal tisit5) e quindi li pulisco
112380041012    2c                   if        %subst(Vidref:1:1) = '#'
112390041012     c                   clear                   vidref
112400041012    2c                   endif
112410041012    2c                   if        %subst(Vidtel:1:1) = '#'
112420041012     c                   clear                   vidtel
112430041012    2c                   endif
112440041012     c*
112450060324    2c                   if        (wdisag = 'X') OR
112460060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
112470060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
112480060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
112490041012     c                   select
112500041012     c     vidtc1        wheneq    *blanks
112510041012     c                   movel     wdisag        vidtc1
112520041012     c     vidtc2        wheneq    *blanks
112530041012     c                   movel     wdisag        vidtc2
112540041012     c                   endsl
112550041012    3c     vidtc1        ifeq      vidtc2
112560041012     c                   clear                   vidtc2
112570041012    3c                   endif
112580041012    3c                   if        vidref = *blanks
112590041012     c                   movel     ot0ref        vidref
112600041012    3c                   endif
112610041012    3c                   if        vidtel = *blanks
112620041012     c                   movel     ot0tel        vidtel
112630041012    3c                   endif
112640041012   x2c                   else
112650041012     c* se destinatario non disagiato e sono in immissione pulisco tc1 e tc2
112660041012     c* entro qui anche se destinatario supermercato/appuntamento ma previst
112670041012     c* ta consegna ad uffici
112680041012    3c                   if        *in12 = '0'
112690041012      * e se era stato precedentemente impostato da programma
112700041012     c                             and savdisag <> *Blanks
112710041012     c                   Eval      savdisag = wdisag
112720041012    4c     vidtc1        ifeq      'X'
112730091001     c     vidtc1        oreq      'S'
112740041012     c     vidtc1        oreq      'A'
112750041012     c                   clear                   vidtc1
112760041012     c                   Clear                   v2dtc1
112770041012    4c                   endif
112780041012    4c     vidtc2        ifeq      'X'
112790041012     c     vidtc2        oreq      'S'
112800041012     c     vidtc2        oreq      'A'
112810041012     c                   clear                   vidtc2
112820041012     c                   Clear                   v2dtc2
112830041012    4c                   endif
112840041012    3c                   endif
112850041012     c
112860041012    2c                   endif
112870091001     c* Memorizzo forzatura consegna particolare da destinatari particolari
112880091001     c                   if        wdisag<>*blanks and
112890091001     c                             (wdisag=vidtc1 or wdisag=vidtc2)
112900091001     c                   if        *in12=*off or
112910091001     c                             (wdisag<>sav_tc1 and wdisag<>sav_tc2)
112920091001     c                   eval      w_ar5tcp=wdisag
112930091001     c                   endif
112940091001     c                   endif
112950041012     c                   endsr
112960070924     C*--- IMPOSTAZIONE giorni di chiusura per destinatario particolar*
112970070924     C     SR_IMPgc12    BEGSR
112980070924     c*
112990070924    2c                   if        ot0err=*blanks
113000070924     c* propongo solo se a video non è stato specificato nulla.
113010070924     c* In manutenzione solo se cambiato il destinatario
113020070924     c                   if        vidgc1=*blanks and vidgc2=*blanks
113030070924     c                             and (*in12='0' or *in15='1' or
113040070924     c                             vidrsd<>savrsd or vidind<>savind or
113050070924     c                             vidprd<>savprd or vidcad<>savcad or
113060070924     c                             vidlod<>savlod or vidnzd<>savnzd)
113070070924     c                   eval      vidgc1=OT0X1GC1
113080070924     c                   eval      vidgc2=OT0X1GC2
113090070924     c                   endif
113100070924   x2c                   else
113110070924     c* se destinatario non presente e sono in immissione pulisco gc1 e gc2
113120070924    3c                   if        *in12 = '0'
113130070924      * e se era stato precedentemente impostato da programma
113140070924     c                             and savpart <> *Blanks
113150070924     c                   Eval      savpart = *blanks
113160070924     c                   clear                   vidgc1
113170070924     c                   Clear                   vidgc2
113180070924    3c                   endif
113190070924     c
113200070924    2c                   endif
113210070924     c                   endsr
113220900502     C*
113230900502     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
113240940819     C     INZ02         BEGSR
113250950126     C*
113260950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
113270971210     C                   EXSR      OFFD02
113280900502     C*
113290940923     C* SPENGO INDICATORI CHE EVIDENZIANO LE VALUTE
113300940923     C                   SETOFF                                       929399
113310940825     C                   MOVEL     *ZEROS        VIDRMN
113320060619     C***                MOVEL     *ZEROS        savRMN
113330940825     C                   MOVEL     *BLANKS       VIDRMA
113340941103     C* 03 ON - PERSONALIZZAIZONE MITTENTE ORIGINALE
113350941103     C     *IN03         IFEQ      *OFF
113360900502     C                   MOVEL     *BLANKS       VIDRMO
113370940930     C                   MOVEL     *BLANKS       VIDCMO
113380940930     C                   MOVEL     *BLANKS       VIDNMO
113390941103     C                   ENDIF
113400050315     C****               MOVE      *BLANKS       VIDFFD
113410940825     C                   MOVEL     *BLANKS       VIDFBR
113420900503     C                   MOVEL     *BLANKS       DEVCTR
113430940825     C                   MOVEL     *BLANKS       VIDTC1
113440940825     C                   MOVEL     *BLANKS       V2DTC1
113450940825     C                   MOVEL     *BLANKS       VIDTC2
113460940825     C                   MOVEL     *BLANKS       V2DTC2
113470900502     C                   MOVEL     *ZEROS        VIDNCL
113480930414     C                   MOVEL     *ZEROS        VARNCL
113490940825     C                   MOVEL     *ZEROS        V2CPKG
113500980402     C                   MOVEL     *ZEROS        SAVPKG
113510900502     C                   MOVEL     *ZEROS        VIDNRS
113520900502     C                   MOVEL     *ZEROS        VIDNCD
113530900502     C                   MOVEL     *ZEROS        VIDNCA
113540940825     C                   MOVEL     *BLANKS       VIDFVR
113550900502     C                   MOVEL     *ZEROS        VIDVOL
113560980402     C                   MOVEL     *ZEROS        SAVVOL
113570090609     c                   clear                   wvol_pre
113580940825     C                   MOVEL     *ZEROS        VIDCAS
113590011107     C                   MOVEL     §GEDCN        VIDVCA
113600011107     C                   MOVEL     §GEDCN        VARVCA
113610940825     C                   MOVEL     *BLANKS       VIDTIC
113620940825     C                   MOVEL     *ZEROS        VIDVMD
113630011113     C                   MOVEL     §GEDCN        VIDVAD
113640940825     C                   MOVEL     *ZEROS        VIDIAS
113650011211     C                   MOVEL     *ZEROS        VARIAS
113660011211     C                   MOVEL     *ZEROS        WARIAS
113670011212     C                   MOVEL     *ZEROS        WARCAS
113680011212     C                   MOVEL     *ZEROS        WARVMD
113690011112     C                   MOVEL     §GEDCN        VIDVAS
113700011112     C                   MOVEL     §GEDCN        VARVAS
113710940825     C                   MOVEL     *ZEROS        VIDQFT
113720950102     C                   MOVEL     *ZEROS        VARQFT
113730910912     C                   MOVEL     *ZEROS        BLPSPE
113740940825     C                   MOVEL     *BLANKS       VIDGGA
113750940825     C                   MOVEL     *BLANKS       VIDGCA
113760940825     C                   MOVEL     *BLANKS       VIDGMA
113770940825     C                   MOVEL     *BLANKS       VIDGVA
113780940922     C                   MOVEL     *BLANKS       VIDGGR
113790940922     C                   MOVEL     *BLANKS       VIDGCR
113800940922     C                   MOVEL     *BLANKS       VIDGMR
113810940922     C                   MOVEL     *BLANKS       VIDGVR
113820940825     C                   MOVEL     *BLANKS       VIDNT1
113830940825     C                   MOVEL     *BLANKS       VIDNT2
113840110304     c                   clear                   savnot
113850010220     C                   MOVEL     *BLANKS       VARFFD
113860930401     C                   MOVEL     *ZEROS        VA2VOL
113870930401     C                   MOVEL     *ZEROS        VARPKG
113880020531     C                   MOVEL     *ZEROS        VARtc1
113890020531     C                   MOVEL     *ZEROS        VARtc2
113900060110     C                   MOVEL     *ZEROS        D_VARrsd
113910060110     C                   MOVEL     *ZEROS        D_VARind
113920060110     C                   MOVEL     *ZEROS        D_VARlod
113930060110     C                   MOVEL     *ZEROS        D_VARprd
113940060110     C                   MOVEL     *ZEROS        D_VARnzd
113950060104     c* visto che in un caso questo campo lo andrò ad impostare anche
113960060104     c* nella routine ctrd01 sposto la pulizia nella inz01
113970060104     C****               MOVEL     *ZEROS        VARZNC
113980970128     C                   MOVEL     'N'           VIDBAM
113990021217     c                   Clear                   VidTba
114000021217     c                   Clear                   VidNba
114010030808     c                   Clear                   SavNba
114020021217     c                   Clear                   VidTb2
114030021217     c                   Clear                   VidNb2
114040030808     c                   Clear                   SavNb2
114050001214     C                   CLEAR                   KOL
114060001214     C                   Z-ADD     0             XY                2 0
114070040917     c* pulisco campo per forzatura mittente
114080040917     c                   clear                   wcontmit          1
114090030731
114100030731      * pulisco i campi di attributi visualizzazione e flag di work per
114110030731      * rif.mittente alfabetico, bancali, part.consegna varie
114120040226      * rif.mittente numerico
114130030731     c                   Clear                   AtrRma
114140030731     c                   Clear                   wrma
114150030731     c                   Clear                   AtrTba
114160030731     c                   Clear                   AtrNba
114170030731     c                   Clear                   AtrTb2
114180030731     c                   Clear                   AtrNb2
114190030731     c                   Clear                   AtrGva
114200040226     c                   Clear                   AtrRmn
114210040226     c                   Eval      wrifm = *Off
114220030708      * pulisco i campi della window x i colli originali + sfusi
114230030708     c                   Clear                   w03rig1
114240030708     c                   Clear                   w03rig2
114250030708     c                   Clear                   w03cor
114260030708     c                   Clear                   w03csf
114270030708     c                   Clear                   At3c01
114280030708     c                   Clear                   At3cor
114290030708     c                   Clear                   At3c02
114300030708     c                   Clear                   At3csf
114310030708     c                   Clear                   At3f12
114320030708     c                   Clear                   H3riga
114330030708     c                   Clear                   H3colo
114340030708     c                   Clear                   wtotncl
114350030708     c                   Clear                   savw03cor
114360030708     c                   Clear                   savw03csf
114370030805
114380030805     c                   Clear                   savkeyorm
114390080314     c* pulisco campo per forzatura serie parziale
114400080314     c                   clear                   f_range
114410090323     c* Campo per visualizzazione taso funzionale f15=cli/tar per tassaz.
114420090323     c* porti assegnati
114430090323     c                   clear                   atrf15
114440090327     c                   exsr      sr_inzwdwcli
114450091119     c*
114460091119     c                   exsr      inzwdwcas
114470940825     C                   ENDSR
114480940825     C*
114490940825     C*--- PULIZIA CAMPI FORMATO3 ------------------------------------*
114500940825     C     INZ03         BEGSR
114510950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
114520971210     C                   EXSR      OFFD03
114530950126     C*
114540940923     C* CAMPO CHE INDICA SE DEVO OBBLIGATORIAMENTE EMETTERE IL FORMATO3
114550940923     C                   CLEAR                   WEMD03
114560940923     C* TASSAZIONE
114570971211     C                   CLEAR                   V3CLNA
114580971211     C                   CLEAR                   V3DLNA
114590991008     C                   CLEAR                   VIDDIV
114600991011     C                   CLEAR                   WDIV1
114610940826     C                   MOVEL     *ZEROS        VIDPOR
114620991012     C                   MOVEL     *ZEROS        MEMPOR
114630940825     C                   MOVEL     *ZEROS        VIDIMV
114640940825     C                   MOVEL     *ZEROS        VIDFIV
114650991029     C                   MOVEL     *ZEROS        VA2VA1
114660040130     C                   MOVEL     *ZEROS        VA2VA2
114670040130     C                   MOVEL     *ZEROS        VA2VA3
114680040130     C                   MOVEL     *ZEROS        VA2VA4
114690041217     C                   MOVEL     *ZEROS        VA2VA5
114700041217     C                   MOVEL     *ZEROS        VA2VA6
114710940825     C                   MOVEL     *ZEROS        VIDNFT
114720940825     C                   MOVEL     *ZEROS        VIDDFT
114730940923     C                   MOVEL     ' '           VIDCEI
114740940826     C                   MOVEL     *BLANKS       V3DCEI
114750940929     C                   MOVEL     *BLANKS       V2DCEI
114760940923     C* PULIZIA SFL
114770940923     C                   SETON                                        35
114780941011     C                   WRITE     LS01C03
114790940923     C                   SETOFF                                       35
114800940923     C*
114810940923     C                   CLEAR                   V3CSV1
114820940923     C                   CLEAR                   V3CVA1
114830940923     C                   CLEAR                   V3CEV1
114840991008     C                   CLEAR                   V3HVA1
114850940923     C*
114860941021     C                   DO        20            NRR               5 0
114870940923     C                   WRITE     LS01S03
114880940923     C                   ENDDO
114890940923     C* ESTENSIONE BOLLA
114900940923     C                   MOVEL     ' '           VI2SV1
114910940923     C                   MOVEL     *ZEROS        VI2VA1
114920040114     c                   Clear                   Vi2Sv2
114930040114     c                   Clear                   Vi2Va2
114940040114     c                   Clear                   Vi2Sv3
114950040114     c                   Clear                   Vi2Va3
114960040114     c                   Clear                   Vi2Sv4
114970040114     c                   Clear                   Vi2Va4
114980041217     c                   Clear                   Vi2Sv5
114990041217     c                   Clear                   Vi2Va5
115000041217     c                   Clear                   Vi2Sv6
115010041217     c                   Clear                   Vi2Va6
115020930628     C                   MOVEL     ' '           VI2CEI
115030940923     C                   MOVEL     *BLANKS       V2DCEI
115040040121     c                   Clear                   Vi2Es1
115050040121     c                   Clear                   Vi2Es2
115060040121     c                   Clear                   Vi2Es3
115070040121     c                   Clear                   Vi2Es4
115080041217     c                   Clear                   Vi2Es5
115090041217     c                   Clear                   Vi2Es6
115100040126     c                   Clear                   Vi2Imv
115110991011     C                   CLEAR                   WDIV2
115120991011     C                   CLEAR                   VI2DIV
115130990701     C                   CLEAR                   VIDIFT
115140990701     C                   CLEAR                   SAVIMV
115150060208     C                   CLEAR                   SAVIMVO
115160991008      *
115170900502     C                   ENDSR
115180971210     C**
115190971210     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
115200971210     C     INZ06         BEGSR
115210081008     C**                 CLEAR                   V6CINS
115220081008     C**                 CLEAR                   V6CSTA
115230971210     C                   CLEAR                   V6CAWB
115240971211     C                   CLEAR                   SAVAWB
115250081008     C**                 CLEAR                   V6CLNA
115260081008     C**                 CLEAR                   V6DLNA
115270971210     C                   ENDSR
115280900502     C*
115290991203     C**
115300991203     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
115310991203     C     INZ07         BEGSR
115320991203     C                   CLEAR                   V7CNPR
115330991203     C                   CLEAR                   SAVNPR
115340991203     C                   CLEAR                   V7CLNA
115350991203     C                   CLEAR                   V7DLNA
115360061003     C***                CLEAR                   savfnp
115370060620     C                   CLEAR                   savkrt
115380991203     C                   ENDSR
115390000829     C*
115400000829     C*--- PULIZIA CAMPI FORMATO8 ------------------------------------*
115410000829     C     INZ08         BEGSR
115420000829     C*
115430000829     C                   CLEAR                   V8CKSC
115440000829     C                   CLEAR                   V8DKSC
115450000829     C* PULIZIA SFL
115460000829     C                   SETON                                        35
115470000829     C                   WRITE     LS01C08
115480000928     C                   SETOFF                                       357833
115490000829     C                   MOVE      *ZEROS        V8CNBR
115500000829     C                   MOVE      *ZEROS        NR8
115510000918     C                   MOVE      *ZEROS        SAVNR8
115520000829     C*
115530000829     C                   CLEAR                   V8CSCE
115540000829     C                   CLEAR                   V8CNOT
115550000908     C                   CLEAR                   V8HDKC
115560000908     C                   CLEAR                   V8HESG
115570000915     C                   CLEAR                   V8HST2
115580000915     C                   CLEAR                   V8HFLS
115590000915     C                   CLEAR                   V8HLNA
115600000915     C                   CLEAR                   V8HNRS
115610000915     C                   CLEAR                   V8HNSC
115620000921     C                   CLEAR                   V8HPRE
115630000830     C*
115640000830     C* PULISCO ANCHE CAMPO FORMATO 9
115650000830     C                   CLEAR                   V9CNOT
115660000921     C                   CLEAR                   CH2
115670000921     C                   CLEAR                   I2
115680000829      *
115690000829     C                   ENDSR
115700960404     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
115710940825     C     CTRD02        BEGSR
115720940929     C                   CLEAR                   WEMFOR
115730941115     C                   CLEAR                   VIDMSG
115740930414     C                   Z-ADD     0             COMCTR
115750940216     C                   CLEAR                   CMD8
115760000321     C                   CLEAR                   WEFT
115770000321     C* SE DPD PAESE EFTA DA DPD
115780020319     C     A_§OGNTW      IFEQ      'DPD'
115790020204     C     VIDDPD        OREQ      'D'
115800000321     C                   MOVEL     DESEFD        WEFT
115810000321     C                   ELSE
115820020213     c     A_§ogntw      ifeq      'FED'
115830020201     c     viddpd        oreq      'F'
115840020130     c                   movel     deseff        weft
115850020130     c                   else
115860000321     C                   MOVEL     DESEFT        WEFT              1
115870000321     C                   ENDIF
115880020130     C                   ENDIF
115890000321     C**
115900980219     C* SE VARIATO IMPORTO C/A LO SALVO
115910980219     C     *IN11         IFEQ      *ON
115920980219     C                   MOVEL     '1'           WIN11             1
115930980219     C                   ENDIF
115940980219     C* SE VARIATO IMPORTO ME LO SALVO
115950980219     C     *IN88         IFEQ      *ON
115960980219     C                   MOVEL     '1'           WIN88             1
115970980219     C                   ENDIF
115980940825     C***
115990940825     C*** MITTENTE ***
116000940825    1C     *IN02         IFEQ      *OFF
116010970703     C                   MOVEL     VIDRSM        I14RSC
116020970703     C                   CLEAR                   I14RS2
116030970703     C                   MOVEL     VIDINM        I14IND
116040970703     C                   MOVEL     VIDLOM        E14LOC
116050970703     C                   MOVEL     VIDPIM        E14PIP
116060970703     C                   MOVEL     VIDPRM        E14PRV
116070970703     C                   MOVEL     VIDNZM        E14NAR
116080970703     C                   MOVEL     VIDCAM        E14CAP
116090970704     C                   MOVEL     'M'           WCLI
116100061110     c   22              movel     vidcdf        wcdf
116110071023     c   22              movel     vidpim        wiva
116120970704     C                   EXSR      CTRIND
116130941020     C*
116140941020     C* CAMPI CHE POSSO AVER IMPOSTATO
116150970703     C                   MOVEL     E14LOC        VIDLOM
116160970703     C                   MOVEL     E14PIP        VIDPIM
116170970703     C                   MOVEL     E14PRV        VIDPRM
116180970703     C                   MOVEL     E14NAR        VIDNZM
116190970703     C                   MOVEL     E14CAP        VIDCAM
116200061109     C*
116210061109     c* Se errore sulla partita iva , visualizzo messaggio
116220061109     c                   if        xcfivaflg < *zeros
116230120504     c                   if        wcdf=*blanks OR %subst(wcdf:12:1)=' '
116240071023     c                   z-add     07            h2riga
116250071022     c                   else
116260071023     c                   z-add     08            H2riga
116270071022     c                   endif
116280061109     c                   z-add     64            H2colo
116290061109     c                   endif
116300970704     C*
116310970704     C     WEMFOR        IFEQ      '1'
116320970704     C     *IN90         OREQ      *ON
116330970704     C                   GOTO      ENDC02
116340970704     C                   ENDIF
116350040917     c* Segnalazione se inserito mittente estero
116360040917     c     wmitie        ifeq      'E'
116370040917     c     wcontmit      andeq     *blanks
116380040917     c                   movel     '1'           wcontmit
116390040917     c                   seton                                        90
116400040917     c                   z-add     7             h2riga
116410040917     c                   z-add     49            h2colo
116420040917     c                   movel     ERR(283)      vidmsg
116430040917     c                   goto      endc02
116440040917     c                   endif
116450061110     C
116460061110     C** SE PREPAGATO 8888, CERCO IL CODICE FISCALE SE NON INSERITO
116470120503     C   22              IF        VIDCCM=8888 AND VIDNZM=*BLANKS AND
116480120504     C                             (VIDCDF=*BLANKS or vidpim=*blanks)
116490120503     C                   EXSR      CALLYCO
116500120503     C                   ENDIF
116510970704     C**
116520950303     C* SE BOLLA DIRETTA ALL'ESTERO --> P.IVA OBBLIGATORIA
116530120515     c* oppure obbligatorio il codice fiscale lungo 16
116540970704    2C     WDESIE        IFEQ      'E'
116550000321     C     WEFT          ANDNE     *BLANKS
116560050427     c     §3arbl        andne     'R'
116570120515     C***  VIDPIM        ANDEQ     *BLANKS
116580120515     c                   if        vidpim=*blanks and
116590120515     c                             (vidcdf=*blank or %subst(vidcdf:12:1)=' ')
116600950303     C                   MOVEL     '1'           WEMFOR
116610950303     C                   SETON                                        7090
116620120515     C                   MOVEL     ERR(346)      VIDMSG
116630950303     C                   GOTO      ENDC02
116640120515     c                   endif
116650000120    2C                   ENDIF
116660970704    1C                   ENDIF
116670930331     C***
116680930331     C*** NUMERO COLLI     ***
116690940928    1C     VIDNCL        IFNE      V1CNCL
116700940825     C                   MOVEL     ERR(45)       VIDMSG
116710940922     C                   SETON                                        4190
116720940920     C                   GOTO      ENDC02
116730940928    1C                   ENDIF
116740930331     C***
116750930331     C*** PESO ***
116760940928    1C   12V2CPKG        IFEQ      0
116770941110     C                   MOVEL     ERR(46)       VIDMSG
116780940922     C                   SETON                                        4290
116790940920     C                   GOTO      ENDC02
116800940928    1C                   END
116810030204      * Manutenzione di bolla con bancali
116820030204      * Se viene modificato il peso o il volume
116830030204      * emetto un msg info
116840030204     c                   If        *In12 and Not *In15                      and
116850030204     c                             (VidNba > *Zeros or VidNb2 > *Zeros)     and
116860030204     c                             (V2cPkg <> SavPkg or Vidvol <> SavVol)   and
116870110921     c                             wPkg = *Blanks                           and
116880110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
116890030204     c                   Eval      wPkg = '1'
116900030204     c                   Eval      VidMsg = Err(272)
116910030204     c                   If        V2cPkg <> SavPkg
116920030204     c                   Eval      *In42 = *On
116930030204     c                   EndIf
116940030204     c                   If        Vidvol <> SavVol
116950030204     c                   Eval      *In47 = *On
116960030204     c                   EndIf
116970030204     c                   Eval      *In90 = *On
116980030204     c                   GoTo      EndC02
116990030204     c                   EndIf
117000980402     C*
117010090609    1C** 12V2CPKG        IFGT      §QTPKB
117020090609     C**   V2CPKG        ANDNE     SAVPKG
117030090609     C**                 MOVE      V2CPKG        SAVPKG
117040090609     C***                CLEAR                   WPT1
117050980623     C* PREPARO MSG
117060090609     C***                MOVEA     ERR(52)       K78
117070090609     C***                MOVEL     §QTPKB        W006A             6
117080090609     C***                MOVEA     W006A         SKI(10)
117090090609     C***                Z-ADD     10            I                 3 0
117100090609     C***                EXSR      ABBL
117110090609     C***                MOVEA     SKI(10)       K78(34)
117120090609     C***                MOVE      §QTPKB        W001A
117130090609     C***                MOVEL     W001A         K78(41)
117140090609     C***                MOVEA     K78           VIDMSG
117150090609     C***                SETON                                        4290
117160090609     C***                GOTO      ENDC02
117170090609    1C**                 END
117180000509     C*
117190000509     C     V2CPKG        IFNE      SAVPKG
117200000509     C                   CLEAR                   WPT1
117210000509     C                   MOVE      V2CPKG        SAVPKG
117220000509     C                   ENDIF
117230000509     C*
117240930331     C* NON CONTROLLO SE SONO IN MANUTENZIONE PERCHE' NON ESISTE DISCOR
117250940928    1C  N12VIDPKG        IFNE      V2CPKG
117260940825     C                   MOVEL     ERR(38)       VIDMSG
117270940922     C                   SETON                                        4290
117280940920     C                   GOTO      ENDC02
117290940928    1C                   END
117300000509      * PER LNP POSTE Massimo peso inseribile da tabella
117310000509      *  solo per soluzioni B
117320101022     C**   §ogntw        IFEQ      'PPT'
117330101022     C**   §1BFG6        ANDEQ     'C'
117340101022     C**   WPT1          ANDEQ     ' '
117350101022     C**   V2CPKG        IFGT      §3IPKP
117360101022     C**                 SETON                                        4290
117370101022     C**                 MOVEA     ERR(196)      K78
117380101022     C**                 MOVEL     §3IPKP        W006A             6
117390101022     C**                 MOVEA     W006A         SKI(10)
117400101022     C**                 Z-ADD     10            I                 3 0
117410101022     C**                 EXSR      ABBL
117420101022     C**                 MOVEA     SKI(10)       K78(37)
117430101022     C**                 MOVE      §3IPKP        W001A
117440101022     C**                 MOVEL     W001A         K78(44)
117450101022     C**                 MOVEA     K78           VIDMSG
117460101022     C**                 MOVEL     '1'           WPT1
117470101022     C**                 GOTO      ENDC02
117480101022     C**                 ENDIF
117490101022     C**                 ENDIF
117500021120
117510021120     c                   If        *In12
117520021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
117530021120      * a quanto indicato in tabella "DFE"
117540021121     c                   If        O27Fie = 'N' and V2cPkg > §DfePkgD
117550021120     c                   Movel     Err(264)      VidMsg
117560021120     c                   Eval      *In90 = *On
117570021120     c                   Eval      *In42 = *On
117580021120     c                   GoTo      EndC02
117590021120     c                   EndIf
117600021120     c                   EndIf
117610930331     C***
117620941107     C*** CODICE TARIFFA ***
117630050921     C                   CLEAR                   fnlv59ds
117640050921     C                   MOVEL     'S'           ilv59con
117650050921     C                   MOVEL     'P'           ilv59tbo
117660040512      * se bolla monovaria pulisco il tipo bolla
117670040512     C                   IF        §3ASVA <> *BLANK
117680050921     C                   CLEAR                   ilv59tbo
117690050921     C                   movel     'P'           ilv59prp
117700040512     C                   ENDIF
117710040512
117720050921     C                   MOVEL     WKSC          ilv59ksc
117730050921     C                   MOVEL     KCI           ilv59kci
117740050921     C                   MOVEL     WFIE          ilv59fie
117750050921     C                   MOVEL     VIDCTR        ilv59ctr
117760050921     C                   MOVEL     BLPDSP        ilv59dsp
117770050921     C                   MOVEL     VIDTSP        ilv59tsp
117780060515     c* Se non  cambiato il cod tariffa nè il cod cliente e
117790060515     c*  sono in manutenzione, non controllo in assenza di tariffe
117800060515     c*  se tariffa bloccata o usata per altri network
117810060515     c                   if        wksc=bolksc and vidctr=bolctr
117820060515     C                             AND *IN12 AND NOT *IN15
117830060515     C                   EVAL      ILV59TA2='B'
117840060515     C                   ENDIF
117850941107     C*
117860050921     C                   CALL      'FNLV59R'
117870050921     C                   PARM                    fnlv59ds
117880050921     C                   MOVEL     olv59dfs      DEFCTR
117890941107     C*
117900941107     C* ATTIVATA LA RICERCA
117910050921     C     olv59err      IFEQ      'R'
117920050921     C                   MOVEL     olv59ctr      VIDCTR
117930941231     C                   SETON                                        83
117940941107     C                   MOVEL     '1'           WEMFOR
117950941107     C                   GOTO      ENDC02
117960941107     C                   ENDIF
117970941107     C* ERRORE
117980050921     C     olv59msg      IFNE      *BLANKS
117990050921     C                   MOVEL     olv59msg      VIDMSG
118000941231     C                   SETON                                        9083
118010941107     C                   GOTO      ENDC02
118020941107     C                   ENDIF
118030021120
118040021120      * Per bolla FedEx
118050021120If  1c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
118060021120     c                   Movel     O27Ctr        Wctr
118070021120      * --> Se non ho trovato tariffe
118080021121      *     Naturalmente questo può capitare solo per i clienti non codificati
118090021121      *     il pezzo che riguarda i clienti codificati lo lascio ma lo asterisco
118100021120If  2c                   If        Wtks <> 'S'
118110021121      * ---> se ho richiamato il trul27r con i27tip = "FM" o "FD"
118120021121If  3c                   If        I27Tip = 'FM' or I27Tip = 'FD'
118130021121      * ---> oppure ho O27Fie = 'M'
118140021122     c                             or WFie = 'M'
118150021120      * la tariffa in bolla deve essere quella della cartello
118160021120If  4c                   If        VidCtr <> WCtr
118170021120     c                   Eval      *In83 = *On
118180021120     c                   Eval      *In90 = *On
118190021120     c                   Movel     Err(262)      VidMsg
118200021120     c                   Goto      EndC02
118210021120    4c                   EndIf
118220021120    3c                   EndIf
118230021121      * ---> se ho richiamato il trul27r con i27tip <> "FM" e "FD"
118240021121If  3c                   If        I27Tip <> 'FM' and I27Tip <> 'FD'
118250021121      * ---> e O27Fie non è = 'M'
118260021122     c                             and WFie <> 'M'
118270021121     c                   Move      Wksc          Ksc8888
118280021120      * ----> cliente non codificato
118290021120If  4c                   If        Ksc8888 = 8888
118300021120      * richiamo il trul27r xchè la tariffa in bolla deve essere una delle
118310021120      * 2 cartello FedEx
118320021120     c                   clear                   trul27ds
118330021120     c                   Z-Add     VidPkg        I27Pkg
118340021120     c                   Movel     Vidctr        I27Ctb
118350021120     c                   ExSr      RicCar
118360021120     c   90              GoTo      EndC02
118370021121     c                   Movel     O27Ctr        Wctr
118380021120If  5c                   If        VidCtr <> WCtr
118390021120     c                   Eval      *In83 = *On
118400021120     c                   Eval      *In90 = *On
118410021120     c                   Movel     Err(262)      VidMsg
118420021120     c                   Goto      EndC02
118430021120    5c                   EndIf
118440021120    4c                   EndIf
118450021120    3c                   EndIf
118460021120    2c                   EndIf
118470021120    1c                   EndIf
118480940922     C*
118490950103     C* MEMORIZZO SEMPRE IL CODICE TARIFFE E PROGRESSIVO
118500941107     C     WTKS          IFEQ      'S'
118510050921     C                   MOVEL     olv59prg      COMPRG
118520050921     C                   MOVEL     olv59ctr      COMCTR
118530050921     C                   MOVEL     olv59div      COMDIV            3
118540991028     C*
118550991028     C                   MOVEL     'CV'          COD
118560991028     C                   MOVEL(P)  COMDIV        KEY
118570991028     C                   EXSR      CTABEL
118580991028     C                   MOVEL     TBLUNI        DSCV
118590011113     C                   MOVEL     §CVDEC        COMDEC
118600950103     C*
118610950102     C* PER MANUTENZIONE CHAIN SULLA TARIFFA
118620950102     C   12
118630950102     CANN15KTAM2         CHAIN     TNTAM000                           30
118640950102     C   12
118650950102     CANN15*IN30         IFEQ      *ON
118660950102     C                   CLEAR                   WTKS
118670050914     c                   else
118680050914     C                   MOVEL     TAMflo        dsta01
118690950102     C                   ENDIF
118700950102     C*
118710950103     C* SE HO CAMBIATO IL CODICE TARIFFA, DEVO RIPROPORRE I CAMPI MODIF
118720940928    2C     VIDCTR        IFNE      SAVCTR
118730940922     C                   SETON                                        97
118740040610     c     atrbva        ifne      prri
118750040610     c                   movel     riul          atrbva
118760040610     c                   endif
118770950102     C* E' COME SE AVESSI MODIFICATO IL MITTENTE: RICARICO I DATI
118780080326     c                   eval      CambiaCTR='S'
118790050921     C                   MOVEL     'S'           ilv59ric
118800940922     C                   EXSR      CTNTAM
118810091210     c* verifico se impostare eventuali forzature flag DDT
118820091210     c                   EXSR      SR_FRZBAM
118830950102     C*
118840940922     C                   MOVEL     VIDCTR        SAVCTR
118850941231     C                   MOVEL     '1'           WEMFOR
118860950102     C                   CLEAR                   UND
118870041012     c* se destinatario supermercato/appuntamento ed in base a vidgva
118880041012     c* devo eventualmente aggiungere o togliere telefono,referente,tc1
118890041012     c* e tc2
118900041012     c     §ogntw        ifne      'PPT'
118910041012     c                   exsr      SR_IMPtc12
118920041012     c                   endif
118930940922     C                   GOTO      ENDC02
118940940928    2C                   ENDIF
118950930331     C*
118960940922    1C                   ENDIF
118970930331     C***
118980930331     C*** VOLUME ***
118990940928    1C     VIDVOL        IFGT      §QTVLB
119000980402    1C     VIDVOL        ANDNE     SAVVOL
119010980402     C                   MOVE      VIDVOL        SAVVOL
119020980623     C* PREPARO MSG
119030090609     C***                MOVEA     ERR(26)       K78
119040090609     C***                MOVEL     §QTVLB        W002A             2
119050090609     C***                MOVEA     W002A         SKI(14)
119060090609     C***                Z-ADD     2             I                 3 0
119070090609     C***                EXSR      ABBL
119080090609     C***                MOVEA     SKI(14)       K78(36)
119090090609     C***                MOVE      §QTVLB        W003A
119100090609     C***                MOVEA     W003A         K78(39)
119110090609     C***                MOVEA     K78           VIDMSG
119120090609     C***                SETON                                        4790
119130090609     C***                GOTO      ENDC02
119140940928    1C                   ENDIF
119150090609     c*
119160930331     C* CALCOLO VOLUME
119170050415     c* prima però se bancali 'O' devo controllare i bancali per avere
119180050415     c* il n.colli originali per calcolare correttamente il volume auto
119190050415     c* matico
119200050415     c                   if        %subst(vidgva:1:1)='O'
119210050415     c                   exsr      sr_CntPVBan
119220050415     c     wemfor        ifeq      '1'
119230050415     c                   goto      endc02
119240050415     c                   endif
119250050415     c                   endif
119260050913     c* Se previsto da tariffa richiedo obbligatorio l'inserimento del volum
119270050926     c                   select
119280050926     c* §taovb='M' --> obbligatorio l'inserimento del volume --> no calcolo
119290050926     c*                automatico
119300050926     c                   when      vidvol=0 and §taovb = 'M'
119310050913     C                   MOVEL     ERR(293)      VIDMSG
119320050913     C                   SETON                                        4790
119330050913     c                   goto      endc02
119340050926     c* §taovb='O' --> se volume non immesso errore forzabile --> calcolo
119350050926     c*                opzionale del volume automatico
119360050926     c                   when      vidvol=0 and §taovb = 'O' and fvol = ' '
119370050926     C                   MOVEL     ERR(293)      VIDMSG
119380050926     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
119390050926     C                   SETON                                        4790
119400050926     c                   eval      fvol = '1'
119410050926     c                   goto      endc02
119420050926     c                   endsl
119430050913     c*
119440930331     C                   EXSR      CALVOL
119450100607     c* controllo i limiti di colli peso e volume
119460100607     c
119470100607     c                   z-add     vidncl        wncl
119480100607     c                   z-add     v2cpkg        wpes
119490100607     c                   z-add     vidvol        wvol
119500100607     c                   if        vidvol=0
119510100607     c                   z-add     varvol        wvol
119520100607     c                   endif
119530100607     c                   eval      wvid='2'
119540100607     c                   exsr      sr_limtsp
119550100607     c                   if        *in90
119560100607     C                   MOVEL     wmsgtsp       VIDMSG
119570100607     C                   GOTO      ENDC02
119580100607     c                   endif
119590020531     C***
119600020531     C*** CONSEGNE PARTICOLARI ***
119610020531     c* N.B.: Ho spostato il controllo delle consegne particolari prima del
119620020531     c*       del richiamo all'fnlv13r perchè con la gestione dei supermerca
119630020531     c*       ti le devo passare a lv13 affinchè il tisi95r mi ritorni la
119640020531     c*       giusta lna e zona. Prima il controllo veniva fatto dopo il
119650020531     c*       controllo dei giorni di chiusura
119660020531     C                   MOVEL     *BLANKS       DB0DC1
119670020531     C                   MOVEL     *BLANKS       V2DTC1
119680020531    1C     VIDTC1        IFNE      ' '
119690020531     C                   MOVEL     '1P'          COD
119700020531     C* RICERCA
119710020531    2C     VIDTC1        IFEQ      '?'
119720020531     C                   EXSR      CX§TAB
119730020531     C                   MOVEL     §KEY          VIDTC1
119740020531     C                   MOVEL     §DES          V2DTC1
119750020531     C                   GOTO      ENDC02
119760020531    2C                   END
119770020531     C* CONTROLLO
119780020531     C                   MOVEL(P)  VIDTC1        KEY
119790020531     C                   EXSR      CTABEL
119800020531     C  N30              MOVEL     TBLUNI        DS1P
119810020531     C* ERRORE: INESISTENTE
119820020531    2C     *IN30         IFEQ      *ON
119830020531     C*         NON UTILIZZABILE IN PARTENZA
119840020531     C     §1PUPR        ORNE      'S'
119850020531     C     §ogntw        ANDNE     'PPT'
119860020531     C                   MOVEL     ERR(102)      VIDMSG
119870020531     C                   SETON                                        6390
119880020531     C                   GOTO      ENDC02
119890020531    2C                   ENDIF
119900020531     C*
119910020531     C                   MOVEL     §1PDES        DB0DC1
119920020531     C                   MOVEL     §1PDES        V2DTC1
119930120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
119940020531    2C     §ogntw        IFEQ      'PPT'
119950020531    3C     §1PFPC        IFNE      'E'
119960020531     C     §1PFPC        ANDNE     'P'
119970020531     C                   MOVEL     ERR(198)      VIDMSG
119980020531     C                   SETON                                        6390
119990020531     C                   GOTO      ENDC02
120000020531    3C                   ENDIF
120010020531    2C                   ENDIF
120020020531    1C                   ENDIF
120030020531     C***
120040020531     C                   MOVEL     *BLANKS       DB0DC2
120050020531     C                   MOVEL     *BLANKS       V2DTC2
120060020531    1C     VIDTC2        IFNE      ' '
120070020531     C                   MOVEL     '1P'          COD
120080020531     C* RICERCA
120090020531    2C     VIDTC2        IFEQ      '?'
120100020531     C                   EXSR      CX§TAB
120110020531     C                   MOVEL     §KEY          VIDTC2
120120020531     C                   MOVEL     §DES          V2DTC2
120130020531     C                   GOTO      ENDC02
120140020531    2C                   END
120150020531     C* CONTROLLO
120160020531     C                   MOVEL(P)  VIDTC2        KEY
120170020531     C                   EXSR      CTABEL
120180020531     C  N30              MOVEL     TBLUNI        DS1P
120190020531     C* ERRORE: INESISTENTE
120200020531    2C     *IN30         IFEQ      *ON
120210020531     C*         NON UTILIZZABILE IN PARTENZA
120220020531     C     §1PUPR        ORNE      'S'
120230020531     C     §ogntw        ANDNE     'PPT'
120240020531     C                   MOVEL     ERR(102)      VIDMSG
120250020531     C                   SETON                                        6490
120260020531     C                   GOTO      ENDC02
120270020531    2C                   ENDIF
120280120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
120290020531    2C     §ogntw        IFEQ      'PPT'
120300020531    3C     §1PFPC        IFNE      'E'
120310020531     C     §1PFPC        ANDNE     'P'
120320020531     C                   MOVEL     ERR(198)      VIDMSG
120330020531     C                   SETON                                        6490
120340020531     C                   GOTO      ENDC02
120350020531    3C                   ENDIF
120360020531    2C                   ENDIF
120370020531     C* NON POSSONO ESSERE UGUALI
120380020531     C     VIDTC1        IFEQ      VIDTC2
120390020531     C                   MOVEL     ERR(121)      VIDMSG
120400020531     C                   SETON                                        6490
120410020531     C                   GOTO      ENDC02
120420020531    2C                   ENDIF
120430020731     C* Non è possibile indicare contemporaneamente consegne particolari
120440051121     C*  'S' ed 'X' / 'S' ed 'A' / "S" e "P" / "X" e "P"
120450020731    2C                   IF           (VIDTC1 = 'X'  and  VIDTC2 = 'S')
120460020731     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'X')
120470050915     C                             or (VIDTC1 = 'A'  and  VIDTC2 = 'S')
120480050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'A')
120490050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'P')
120500050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'S')
120510051121     C*                            or (VIDTC1 = 'X'  and  VIDTC2 = 'A')
120520051121     C*                            or (VIDTC1 = 'A'  and  VIDTC2 = 'X')
120530050915     C                             or (VIDTC1 = 'X'  and  VIDTC2 = 'P')
120540050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'X')
120550020731     C                   movel     ERR(257)      VIDmsg
120560050915     c                   eval      %subst(vidmsg:67:1) = vidtc1
120570050915     c                   eval      %subst(vidmsg:73:1) = vidtc2
120580020731     C                   seton                                        6490
120590020731     C                   goto      ENDC02
120600020731    2C                   ENDIF
120610020531     C*
120620020531     C                   MOVEL     §1PDES        DB0DC2
120630020531     C                   MOVEL     §1PDES        V2DTC2
120640020531    1C                   ENDIF
120650020531     c* Se destinatario disagiato o supermercato errore se non indicato
120660020531     c* in nessuno dei due campi di consegna particolare
120670040608     c* idem se destinatario con appuntamento
120680041012     c*
120690041012     c* Se particolarità varia="U" --> consegna ad uffici devo invece
120700041012     c* dare errore se immesso supermercato o appuntamento
120710041012     c                   if        %subst(vidgva:1:1)='U'
120720041013     c                             and (vidtc1='S' or vidtc1='A' or vidtc2='S'
120730041013     c                             or vidtc2='A')
120740041012     C                   MOVEl     ERR(285)      vidmsg
120750041012     C                   SETON                                        636490
120760041012     C                   GOTO      ENDC02
120770041012     c                   endif
120780060324     c* Se immesso appuntamento e richiesta data consegna tassativa
120790060324     c* ---> errore
120800060324     c                   if        vidtcr = *blanks and viddcr > *zeros  and
120810060324     c                             (vidtc1='A' or vidtc2='A')
120820060324     C                   MOVEl     ERR(298)      vidmsg
120830060324     C                   SETON                                        636490
120840060324     C                   GOTO      ENDC02
120850060324     c                   endif
120860041012     c*
120870041012     C***  wdisag        ifne      *blanks
120880060324     c                   if        (wdisag = 'X') OR
120890060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
120900060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
120910060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
120920041012     c     wdisag        ifne      vidtc1
120930020531     c     wdisag        andne     vidtc2
120940020531     C                   MOVEa     ERR(255)      k78
120950020531     c                   select
120960020531     c     wdisag        wheneq    'X'
120970040608     c                   eval      w016ad = 'Disagiato     '
120980020531     c     wdisag        wheneq    'S'
120990040608     c                   eval      w016ad = '"Supermercato"  '
121000040608     c     wdisag        wheneq    'A'
121010040608     c                   eval      w016ad = 'con Appuntamento'
121020020531     c                   endsl
121030040608     C                   MOVEa     w016ad        k78(14)
121040020531     C                   MOVEA     K78           VIDMSG
121050020531     C                   SETON                                        636490
121060020531     C                   GOTO      ENDC02
121070041012     c                   endif
121080020531     c                   endif
121090090921     c
121100090921     c* Per tipo servizio "H" non accetto S o A
121110090921     c                   if        vidtc1='A' or vidtc1='S' or
121120090921     c                             vidtc2='A' or vidtc2='S'
121130090921     c                   if        vidtsp='H'
121140090921     C                   MOVEl     err(231)      VIDMSG
121150090921     C                   SETON                                        6390
121160090921     C                   GOTO      ENDC02
121170090921     c                   endif
121180090921     c                   endif
121190940922     C***
121200070223     C*** CONTROLLO CAP
121210911008      *
121220020531     C* SE CAMBIATO F.D. O PESO O VOLUME  o consegne particolari RICONTROLLO
121230940916    2C     VARFFD        IFNE      VIDFFD
121240940825     C     VARPKG        ORNE      V2CPKG
121250930409     C     VA2VOL        ORNE      VARVOL
121260020531     C     VArtc1        ORNE      vidtc1
121270020531     C     VArtc2        ORNE      Vidtc2
121280060110     c     D_varrsd      andeq     vidrsd
121290060110     c     D_varind      andeq     vidind
121300060110     c     D_varlod      andeq     vidlod
121310060110     c     D_varprd      andeq     vidprd
121320060110     c     D_varnzd      andeq     vidnzd
121330010214     C                   MOVE      VIDFFD        COMFFD
121340010214     C     COMFFD        IFEQ      'N'
121350010214     C                   MOVE      *BLANKS       COMFFD
121360010214     C                   ENDIF
121370930414     C                   MOVEL     0             DIE
121380940916     C*
121390930402     C* IN MANUTENZIONE SE SONO TORNATI COME IN BOLLA NON FACCIO NIENTE
121400940916    3C     *IN12         IFEQ      '1'
121410930402     C     *IN15         ANDEQ     '0'
121420940916     C*
121430940916     C* IN MANUTENZ.SE NOV =" " SIGNIFICA CHE IL CAP E' DI NUOVO UGUALE
121440940916     C*  A QUELLO DELLA BOLLA
121450940916     C     NOV           ANDEQ     ' '
121460010214     C     COMFFD        ANDEQ     BLPFFD
121470940928     C     V2CPKG        ANDEQ     BLPPKB
121480940928     C     VARVOL        ANDEQ     BLPVLB
121490020531     C     vidtc1        ANDEQ     BLPtc1
121500020531     C     vidtc2        ANDEQ     BLPtc2
121510060110     c     vidrsd        andeq     blprsd
121520060110     c     vidind        andeq     blpind
121530060110     c     vidlod        andeq     blplod
121540060110     c     vidprd        andeq     blpprd
121550060110     c     vidnzd        andeq     blpnzd
121560930402     C                   MOVEL     BLPZNC        VARZNC
121570940916   X3C                   ELSE
121580920427     C                   MOVEL     0             QUA
121590100209     C                   MOVEL     0             QUAH
121600930406     C                   MOVEL     '1'           NOV
121610940916    3C                   END
121620940916    2C                   END
121630930402     C*
121640910129     C* CONTROLLO IN PAESARIO LA LNA
121650940916    2C     QUA           IFNE      NUMFOR
121660910801     C*
121670930401     C                   MOVEL     VIDFFD        VARFFD
121680940825     C                   MOVEL     V2CPKG        VARPKG
121690930401     C                   MOVEL     VARVOL        VA2VOL
121700020531     C                   MOVEL     Vidtc1        VArtc1
121710020531     C                   MOVEL     Vidtc2        VArtc2
121720060110     C                   MOVEL     Vidrsd        D_VArrsd
121730060110     C                   MOVEL     Vidind        D_VArind
121740060110     C                   MOVEL     Vidlod        D_VArlod
121750060110     C                   MOVEL     Vidprd        D_VArprd
121760060110     C                   MOVEL     Vidnzd        D_VArnzd
121770940919     C*
121780970704     C                   CLEAR                   DSSI95
121790970708     C                   CLEAR                   DSLV13
121800970707     C                   CLEAR                   W2LN
121810970704     C                   MOVEL     VIDNZD        I95NAR
121820970704     C                   MOVEL     VIDCAD        I95CAP
121830970704     C                   MOVEL     VIDLOD        I95LOC
121840970704     C                   MOVEL     VIDPRD        I95PRV
121850970704     C                   MOVEL     VIDFFD        I95FFD
121860010214     C     VIDFFD        IFEQ      'N'
121870010214     C                   MOVE      *BLANKS       I95FFD
121880010214     C                   ENDIF
121890131003     c* Se per il cliente è presente personalizzazione instradamento merce
121900131003     c* imposto peso e volume medio al posto del peso e volume della sped.
121910970704     C                   Z-ADD     V2CPKG        I95LKG
121920131003     c                   if        n_§clipsm>0
121930131003     C                   Z-ADD     n_§clipsm     I95LKG
121940131003     c                   endif
121950980219     C* PASSO IL VOLUME AL CALCOLO DELLA LNA SOLO SE NON E' CLIENTE B
121960980219     C*  O E' CLIENTE B CON VOLUME REALE
121970980219     C     VIDNRS        IFEQ      0
121980980219     C     VIDFVR        OREQ      'R'
121990970704     C                   Z-ADD     VARVOL        I95LMC
122000131003     c                   if        n_§clivlm>0
122010131003     C                   Z-ADD     n_§clivlm     I95Lmc
122020131003     c                   endif
122030980219     C                   ENDIF
122040000623     C** SE BOLLA POSTA DEVO PASSARE LNP AL POSTO DI TFP
122050020319     C     §ogntw        IFEQ      'PPT'
122060000623     C                   Z-ADD     VIDLNP        I95TFP
122070000623     C                   ELSE
122080000623     C                   Z-ADD     COMTFP        I95TFP
122090000623     C                   ENDIF
122100000623     C*
122110970704     C     VIDTSP        IFNE      *BLANKS
122120970704    1C                   MOVEL     VIDTSP        I95TSP
122130970704     C                   ELSE
122140970704     C* LO PRENDO DA TARIFFA
122150970704     C                   MOVEL     COMTSP        I95TSP
122160970704     C                   ENDIF
122170131003     c                   if        §clitspf<>*blanks
122180131003     c                   movel     §clitspf      i95tsp
122190131003     c                   endif
122200971201     C     §3AFCA        IFNE      0
122210971201     C                   MOVEL     'S'           I95FCA
122220971201     C                   ENDIF
122230971201     C                   MOVEL     FLGTB1        I95TPO
122240970704     C                   MOVEL     '7'           I95TCN
122250970714     C                   MOVEL     BLPDSP        I95DAT
122260980602     C                   MOVEL     'S'           I95FRE
122270020212     c* se network fedex passo flag apposito per dire di prendere i dati
122280020212     c* dalla tabella della nazione
122290020213     c     A_§ogntw      ifeq      'FED'
122300020212     c     viddpd        oreq      'F'
122310020212     c     wdesie        andeq     'E'
122320020212     c                   movel     'S'           i95fi1
122330020212     c                   endif
122340020531     c*
122350020531     c                   movel     vidtc1        i95fi2
122360020531     c                   move      vidtc2        i95fi2
122370131003     c                   if        (vidtc1='S' or vidtc2='S')
122380131003     c                             and §clisup='N'
122390131003     c                   if        vidtc1='S'
122400131003     c                   movel     ' '           i95fi2
122410131003     c                   else
122420131003     c                   move      ' '           i95fi2
122430131003     c                   endif
122440131003     c                   endif
122450970704     C*
122460970704     C                   CALL      'FNLV13R'
122470970708     C                   PARM                    KPJBA
122480970708     C                   PARM                    DSLV13
122490970708     C                   PARM                    DSSI95
122500060105     c*
122501150128     c                   move      o95loc        wLocNorm
122510060105     c                   move      o95lna        d_o95lna
122520060105     c                   move      o95znc        d_o95znc
122530060105     c                   move      o952ln        d_o952ln
122540111201     c* EVENTUALE FORZATURA LINEA DI ARRIVO: non valida per i disk B e
122550111201     c* le bolle di reso
122560111201     c                   if        §1bfg6<>'C' and
122570111201     c                             (vidfbr <> 'S' or *in44 = *off)
122580111201     c* .... Forzatura da archivio destinatari particolari
122590111201     c                   if        §dstlna > *zeros
122600060105     c                   movel     §dstlna       d_o95lna
122610060105     c                   clear                   d_o95znc
122620060105     c                   clear                   d_o952ln
122630060105     c                   if        §dstznc >= *zeros
122640060105     c                   movel     §dstznc       d_o95znc
122650060105     c                   endif
122660060105     c                   endif
122670120615     c* .... Forzatura da tabella "FLB/FLA"
122680120615     c* Forzatura linea di arrivo per codice cliente mittente o per linea di p.
122690120615     c                   clear                   trulflbds
122700120615     c                   movel     d_o95lna      iflblna
122710120615     c                   move      vidlnp        Iflblnp
122720120615    2c                   if        vidccm<>9999 and vidccm<>8888
122730120614     c                   move      vidccm        iflbccm
122740120615    3C     VIDFLC        IFEQ      0
122750120614     C                   MOVEL     VIDLNP        iflbccm
122760120614     C                   ELSE
122770120614     C                   MOVEL     VIDFLC        iflbccm
122780120614    3C                   ENDIF
122790120615    2c                   endif
122800120614     c                   call      'TRULFLBR'
122810120614     c                   parm                    trulflbds
122820120615    2c                   if        Oflblfz>*zeros
122830120615     c                   move      OflbLFZ       d_o95lna
122840120615    2c                   endif
122850111201     c                   endif
122860930409     C*
122870110217     C* L I N E A    D I    A R R I V O    N O N    I M M E S S A
122880110217     c*     I T A L I A    O    E U R O E X P R E S S
122890110217     C
122900940916     C*  LA PRENDO DA CAPPARIO
122910000121    3C     VIDLNA        IFLE      *ZEROS
122920000121     C     VIDDPD        ANDEQ     ' '
122930000121    3C     VIDLNA        ORLE      *ZEROS
122940000121     C     WDESIE        ANDEQ     'I'
122950970711     C                   CLEAR                   WMSGLN
122960970711     C                   CLEAR                   WMSGZO
122970970711     C**
122980060105     C                   MOVEL     d_o95lna      COMLNA
122990060105     C                   MOVEL     d_o952ln      W2LN
123000110217     c
123010111123     c* Controlli di base della linea di arrivo
123020110217     c                   movel     comlna        wlna
123030110217     c                   exsr      CTRLNA_Base
123040110217     c
123050110217     c                   if        *in90
123060110217     C                   GOTO      ENDC02
123070110217     c                   seton                                        40
123080110217     c                   endif
123090940916     C* Z O N A:
123100940916     C* 1) IMMISSIONE E DISK CLIENTI--> PRENDO SEMPRE
123110910801     C  N12
123120970704     COR 12
123130060105     C****AN 15              MOVEL     O95ZNC        VARZNC
123140060105     CAN 15              MOVEL     d_o95znc      VARZNC
123150940916     C* 2) MANUTENZIONE --> SE CAMBIATO CAP O FD O ZONA=0 RIPRENDO
123160940916     C   12
123170940916    4CANN15NOV           IFEQ      '1'
123180930402     C     VIDZNC        OREQ      0
123190060105     C                   MOVEL     d_o95znc      VARZNC
123200940916    4C                   END
123201150220     c* se sped EEX richiamo cappario dpd per controllare se CAP giusto
123202150220     c                   if        wdesie<>'I'
123203150220     c                   clear                   tisie3ds
123204150220     c                   eval      isie3tla='E'
123205150220     c                   z-add     blpdsp        isie3dri
123206150220     C                   z-add     BLPDSP        Isie3dsp
123207150220     c                   time                    isie3hsp
123208150220     C                   MOVEL     VIDNZD        isie3nzd
123209150220     C                   MOVEL     VIDCAD        Isie3cad
123210150220     c                   movel     vidlod        isie3cty
123211150220     c                   z-add     vidlnp        isie3lnp
123212150220     C     VIDFBR        IFEQ      'S'
123213150220     c                   z-add     300           isie3srv
123214150220     c                   else
123215150220     c                   if        v2cpkg>§3ilmp
123216150220     c                   z-add     101           isie3srv
123217150220     c                   else
123218150220     c                   z-add     136           isie3srv
123219150220     c                   endif
123220150220     c                   endif
123221150220     c                   movel     'N'           isie3exc
123222150220     C                   CALL      'TISIE3R'
123223150220     C                   PARM                    tisie3ds
123224150220     c*SE ERRORE DA CAPPARIO DPD, verificare
123225150220     C     Osie3err      IFNE      ' '
123226150220     C                   MOVEL     ERR(189)      VIDMSG
123227150220     C                   EVAL      CAPPARIODPD='S'
123228150220     c                   movel     vidcad        savcapdpd
123229150220     C                   SETON                                        4090
123230150220     C                   ENDIF
123231150220     c                   endif
123232910129     C*
123233940916   X3C                   ELSE
123234970711     C                   CLEAR                   WMSGLN
123240970711     C                   CLEAR                   WMSGZO
123250930401     C*
123260940916     C* L I N E A   D I   A R R I V O           I M M E S S A
123270110217     C*   N O N   C O N G R U E N T E  CON QUELLA DEL CAPPARIO ITALIA O EUROEXPR
123280110217     C*  OPPURE LINEA DI ARRIVO   D P D
123290110217     C*  OPPURE LINEA DI ARRIVO   F E D E X
123300110217     C
123310060105    4C     d_o95lna      IFNE      COMLNA
123320020204    5C     VIDDPD        OREQ      'D'
123330000222     C     WDESIE        ANDEQ     'E'
123340020319     C     A_§OGNTW      OREQ      'DPD'
123350020201    5C     VIDDPD        OREQ      'F'
123360020201     C     WDESIE        ANDEQ     'E'
123370020213     C     A_§OGntw      OREQ      'FED'
123380030516      * se linea di partenza 102 da conferma bolla clienti non devo
123390030516      * dare incongruenza
123400030516  5aac                   If        (vidlnp <> 102 and *in12 and *in15)
123410030516     c                             or not *in12 or not *in15
123420000222     C**
123430000120     C* SE FORZATA LNA DPD, NON DEVO DARE INCONGRUENZA
123440020204    5C     VIDDPD        IFEQ      'D'
123450000121     C     WDESIE        ANDEQ     'E'
123460020319     C     A_§OGNTW      OREQ      'DPD'
123470020201     C     VIDDPD        oreq      'F'
123480020201     C     WDESIE        ANDEQ     'E'
123490020213     C     A_§OGntw      OREQ      'FED'
123500000218     C**
123510020204    6C     VIDDPD        IFEQ      'D'
123520020201     C     WDESIE        ANDEQ     'E'
123530020319     C     A_§OGNTW      OREQ      'DPD'
123540000229     C* PER DPD IMPOSTO ZONA 00 PER RESI ZONA 80
123550000218     C     VIDFBR        IFEQ      'S'
123560000229     C                   MOVEL     80            VARZNC
123570000218     C                   ELSE
123580000218     C                   MOVEL     00            VARZNC
123590000218     C                   ENDIF
123600060615     c                   clear                   tisie3ds
123610060615     c                   eval      isie3tla='E'
123620060615     c                   z-add     blpdsp        isie3dri
123630060615     C                   z-add     BLPDSP        Isie3dsp
123640060615     c                   time                    isie3hsp
123650060615     C                   MOVEL     VIDNZD        isie3nzd
123660060615     C                   MOVEL     VIDCAD        Isie3cad
123670060615     c                   movel     vidlod        isie3cty
123680060615     c                   z-add     vidlnp        isie3lnp
123690060615     C     VIDFBR        IFEQ      'S'
123700060615     c                   z-add     300           isie3srv
123710060615     c                   else
123720060615     c                   if        v2cpkg>§3ilmp
123730060615     c                   z-add     101           isie3srv
123740060615     c                   else
123750060615     c                   z-add     136           isie3srv
123760060615     c                   endif
123770060615     c                   endif
123780060615     c                   movel     'N'           isie3exc
123790060615     C                   CALL      'TISIE3R'
123800060615     C                   PARM                    tisie3ds
123810060703     c*SE ERRORE DA CAPPARIO DPD, verificare
123820060615     C     Osie3err      IFNE      ' '
123830060615     C                   MOVEL     ERR(189)      VIDMSG
123840061011     C                   EVAL      CAPPARIODPD='S'
123850061011     c                   movel     vidcad        savcapdpd
123860060615     C                   SETON                                        4090
123870060615     C                   ENDIF
123880070515     c*****              endif
123890020201   x6c                   else
123900060105     c                   movel     D_o95lna      comlna
123910060105     c                   movel     d_o95znc      varznc
123920020201    6c                   endif
123930110217     c
123940110217     c* Controlli di base della linea di arrivo
123950110217     c                   movel     comlna        wlna
123960110217     c                   exsr      CTRLNA_Base
123970110217     c
123980110217     c                   if        *in90
123990110217     C                   GOTO      ENDC02
124000110217     c                   seton                                        40
124010110217     c                   endif
124020110217     c
124030000120  X 5C                   ELSE
124040970711     C**
124050940916     C* NON E' FERMO DEPOSITO
124060010214    6C     VIDFFD        IFEQ      'N'
124070010220     C     VIDFFD        OREQ      ' '
124080000704     C* NON CONTROLLO PER BOLLE POSTE DISK B
124090020319   6Ac     §ogntw        IFNE      'PPT'
124100000704     C     §1BFG6        ORNE      'C'
124110000704     C     §1BFG2        ORNE      'S'
124120940916     C* NON SEGNALO ERRORE SE BOLLA DA DISP MITTENTE
124130000120    7C     WFPR          IFNE      'I'
124140970711     C     WMSGLN        ANDEQ     ' '
124150030627      * non segnalo errore se bolle di recupero
124160100209      * non segnalo errore se prima lo avevo dato per tipo servizio H
124170100209If  8c                   If        §3arbl <> 'R'  and (vidtsp='H' or
124180100209     c                             quah=0)
124190100208     c
124200100208     c* Messaggio diverso per tipo servizio "H"
124210100210     c                   if        vidtsp='H'  and  §1bfg6='C'
124220100210     C                   MOVEL     ERR(80)       VIDMSG
124230100210     C                   sub       1             QUA
124240100210     C                   add       1             QUAH
124250100210     c                   else
124260100208     C                   MOVEL     ERR(90)       VIDMSG
124270100210    8c                   EndIf
124280100208
124290940916     C                   SETON                                        4090
124300030627    8c                   EndIf
124310000120    7C                   END
124320920427     C                   ADD       1             QUA
124330000704   6AC                   END
124340930409     C*
124350000120    6C                   END
124360910801     C* AZZERO LA ZONA
124370910801     C  N12
124380930401     COR 12
124390930401     CAN 15              Z-ADD     0             VARZNC
124400060829     c                   if        wfpr = 'G'
124410060829     c                   z-add     vidznc        varznc
124420060829     c                   endif
124430940916     C* IN MANUTENZIONE: se HO variato i dati --> AZZERO LA ZONA
124440000120     C   12
124450000120    6CANN15NOV           IFEQ      '1'
124460930401     C                   Z-ADD     0             VARZNC
124470940916     C*
124480000120   x6C                   ELSE
124490940916     C* SE CAMBIATA SOLO LA LINEA             --> AZZERO LA ZONA
124500000120    7C     SAVLNA        IFNE      VIDLNA
124510930401     C                   Z-ADD     0             VARZNC
124520910801     C                   MOVEL     '1'           NOV
124530940916     C*
124540000120   X7C                   ELSE
124550940916     C* SE NON HO CAMBIATO NULLA             -->LASCIO QUELLA CHE C'ERA
124560930402     C                   Z-ADD     BLPZNC        VARZNC
124570930402     C                   MOVEL     ' '           NOV
124580000120    7C                   ENDIF
124590910801     C*
124600000120    6C                   ENDIF
124610980806     C**
124620980806     C* SE LNA ESTERA ANCHE SE FORZO LA LINEA INCONGRUENTE COL CAP
124630980806     C*  PRENDO LA ZONA
124640020319     c     A_§ogntw      ifeq      'EEX'
124650980806     C  N12
124660980806     COR 12
124670060105     CAN 15              Z-ADD     d_o95znc      VARZNC
124680980806     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
124690000120     C   12
124700000120    7CANN15NOV           IFEQ      '1'
124710980806     C     VIDZNC        OREQ      0
124720060105     C                   Z-ADD     d_o95znc      VARZNC
124730000120    7C                   END
124740000120    6C                   ENDIF
124750000120    5C                   ENDIF
124760970711     C* PER ERRORE ESCO
124770970711     C   90              GOTO      ENDC02
124780030516
124790030516  5aac                   endif
124800921029     C*
124810940928   X4C                   ELSE
124820940916     C*
124830110217     C* L I N E A   D I   A R R I V O           I M M E S S A
124840110217     c*     I T A L I A    O    E U R O E X P R E S S
124850940916     C*  LINEA     CONGRUENTE CON QUELLA DEL CAPPARIO --> PRENDO ZONA
124860960208     C* LINEA ORIGINALE SE SECONDA LINEA DISTRIBUZIONE
124870060105     C                   MOVEL     d_o952ln      W2LN              1
124880060829     C  N12
124890060829     COR 12
124900060829     CAN 15              Z-ADD     d_o95znc      VARZNC
124910060829     c                   if        *in12='1' and *in15='1' and
124920060829     c                                 wfpr='G' and vidznc>0
124930060829     C                   Z-ADD     vidznc        VARZNC
124940060829     c                   endif
124950930402     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
124960940916     C   12
124970940916    5CANN15NOV           IFEQ      '1'
124980930402     C     VIDZNC        OREQ      0
124990060105     C                   Z-ADD     d_o95znc      VARZNC
125000940916    5C                   END
125010970711     C* DISK CLI
125020970711     C                   MOVEL     'N'           WMSGLN            1
125030970714     C                   MOVEL     O95ZNC        WEMZNC
125040910801     C*
125050940916    4C                   ENDIF
125060940916    3C                   ENDIF
125070970618    2C                   ENDIF
125080940916     C*
125090020917     C* PER DISK CLI CON SERIE PRENDO ZONA DA FIVAB
125100950410     C* --> SEGNALO PERO' SE E' DISCORDANTE CON QUELLA CALCOLATA
125110950421     C*     SEMPRE SE NON SI TRATTA DI UNA ZONA PRESA DALL'OLTRE O FD
125120970618     C   12
125130970618    2CAN 15VIDNRS        IFNE      0
125140950410     C*
125150970711    3C     §LPZNC        IFNE      WEMZNC
125160020319     C     §ogntw        ANDNE     'PPT'
125170950410     C     QUI           ANDEQ     0
125180970711     C     WMSGLN        ANDEQ     'N'
125190970711     C     WMSGZO        ANDEQ     ' '
125200030515      * non controllo per linea di partenza 102
125210030515     c     §lplnp        Andne     102
125220950410     C                   MOVEA     ERR(115)      K78
125230970711     C                   MOVEL     WEMZNC        W002A             2
125240950410     C                   MOVEA     W002A         K78(49)
125250950410     C                   MOVEL     §LPZNC        W002A             2
125260950410     C                   MOVEA     W002A         K78(13)
125270950410     C                   MOVEA     K78           VIDMSG
125280950410     C                   SETON                                        5790
125290950410     C                   MOVEL     1             QUI
125300950410     C                   GOTO      ENDC02
125310970618    3C                   ENDIF
125320950410     C*
125330930401     C                   Z-ADD     §LPZNC        VARZNC
125340970618    2C                   ENDIF
125350980410     C*
125360980410     C   12
125370980410    2CANN15§1BFG6        IFEQ      'C'
125380980410     C     §1BFG2        ANDEQ     'S'
125390980410     C     NOV           ANDEQ     '1'
125400980410     C*
125410980410    3C     BLPZNC        IFNE      WEMZNC
125420020319     C     §ogntw        ANDNE     'PPT'
125430980410     C     QUI           ANDEQ     0
125440980410     C     WMSGLN        ANDEQ     'N'
125450980410     C     WMSGZO        ANDEQ     ' '
125460980410     C                   MOVEA     ERR(115)      K78
125470980410     C                   MOVEL     WEMZNC        W002A             2
125480980410     C                   MOVEA     W002A         K78(49)
125490980410     C                   MOVEL     BLPZNC        W002A             2
125500980410     C                   MOVEA     W002A         K78(13)
125510980410     C                   MOVEA     K78           VIDMSG
125520980410     C                   SETON                                        5790
125530980410     C                   MOVEL     1             QUI
125540980410     C                   GOTO      ENDC02
125550980410    3C                   ENDIF
125560980410     C*
125570980410     C                   Z-ADD     BLPZNC        VARZNC
125580980410    2C                   ENDIF
125590930402     C***
125600930402     C*** CONTROLLO ZONA IN MANUTENZIONE ***
125610930409     C* SE MODIFICATA E SE NON RICALCOLATA DEVE ESISTERE NELLA TAB. 03
125620940916     C   12
125630940916    2CANN15NOV           IFNE      '1'
125640930409     C     BLPZNC        ANDNE     VIDZNC
125650930409     C     VIDZNC        ANDGT     0
125660930402     C                   MOVEL     VIDZNC        VARZNC
125670930406     C*
125680930409     C                   MOVEL     '03'          COD
125690930409     C                   MOVEL     COMLNA        ALF5              5
125700930409     C                   MOVE      VIDZNC        ALF5
125710940919     C                   MOVEL(P)  ALF5          KEY
125720930409     C*
125730930708     C                   EXSR      CTABEL
125740940928    3C     *IN30         IFEQ      *ON
125750940916     C                   MOVEL     ERR(61)       VIDMSG
125760940922     C                   SETON                                        5790
125770940920     C                   GOTO      ENDC02
125780940916    3C                   ENDIF
125790940916    2C                   ENDIF
125800930406     C*
125810960320     C***
125820960320     C*** PER LNA 102 OBBLIGATORIO IL C/S
125830000706    1C     COMLNA        IFEQ      102
125840960320     C     §3ARBL        ANDNE     'C'
125850960320     C                   SETON                                        4090
125860960320     C                   MOVEL     ERR(125)      VIDMSG
125870960320     C                   GOTO      ENDC02
125880000706    1C                   ENDIF
125890991206      **
125900110217      ** Aggancio AZORG di LNA per prednere dati
125910110217      ** Es: lo tolgo perchè lo fa già sopra avenfo unificato i controllo
125920110217      **     con la CTRLNA_Base non serrve più
125930110217      **
125940110217    1C**   VIDLNA        IFLE      *ZEROS
125950110217     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
125960110217     C**                 MOVEL     ORGDE3        A_OG143
125970110217     C**                 MOVEL     ORGDF0        A_OG150
125980110217    1C**                 ENDIF
125990991206      *
126000991206      * PER LNA DPD OBBLIGATORIO 1 COLLO
126010020319     C     A_§OGNTW      IFEQ      'DPD'
126020000120     C     VIDNCL        IFNE      1
126030991206     C                   SETON                                        4190
126040991206     C                   MOVEL     ERR(179)      VIDMSG
126050991206     C                   GOTO      ENDC02
126060991206     C                   ENDIF
126070000124     c* controllo numero parcel dpd doppio
126080000308     C*  NON LO CONTROLLO SE DA CTM NON HA SEGNACOLLI (PER BOLLA
126090000308     C*  RECUPERO O PER BOLLA LEGATA I CUI SEGNACOLLI SONO SULLA MAMMA)
126100000203     C     §1BFG8        IFEQ      'S'
126110060615     C                   move      V7CNPR        WNPR
126120000124     C                   EXSR      DPDDOP
126130000124     C     *IN90         IFEQ      *ON
126140000124     C                   SETON                                        41
126150000124     C                   MOVEL     ERR(190)      VIDMSG
126160000124     C                   GOTO      ENDC02
126170000124     C                   ENDIF
126180000203     C                   ENDIF
126190000120     C                   ENDIF
126200991213      * PER LNA O LNP DPD Massimo peso inseribile da tabella
126210020319     C     A_§OGNTW      IFEQ      'DPD'
126220020319     C     §OGNTW        OREQ      'DPD'
126230991214     C     V2CPKG        IFGT      §3IPKD
126240991213     C                   SETON                                        4290
126250991213     C                   MOVEA     ERR(180)      K78
126260991213     C                   MOVEL     §3IPKD        W006A             6
126270991213     C                   MOVEA     W006A         SKI(10)
126280991213     C                   Z-ADD     10            I                 3 0
126290991213     C                   EXSR      ABBL
126300991213     C                   MOVEA     SKI(10)       K78(53)
126310991213     C                   MOVE      §3IPKD        W001A
126320991213     C                   MOVEL     W001A         K78(60)
126330991213     C                   MOVEA     K78           VIDMSG
126340991213     C                   GOTO      ENDC02
126350991213     C                   ENDIF
126360991213     C                   ENDIF
126370991206      **
126380991203     C                   SETOFF                                       30
126390991203      *
126400991203     C                   SELECT
126410991203      *
126420060629      * IMPORT/EXPORT DPD  (import solo se in manutenzione e solo per
126430060629      * la visualizzazione)
126440991203      *  Premuto F18
126450020319     C     A_§OGNTW      WHENEQ    'DPD'
126460991203     C     *INKS         ANDEQ     *ON
126470060616     c     *in79         oreq      *on
126480060616     C     *INKS         ANDEQ     *ON
126490060616     c     *in12         andeq     *on
126500060616     c     *in15         andeq     *off
126510991203     C                   EXSR      GESD07
126520991203     C                   SETON                                        41
126530991203     C                   MOVEL     '1'           WEMFOR
126540991203     C                   GOTO      ENDC02
126550991203      *
126560991203      * EXPORT DPD
126570000307      *  Non premuto F18 e PARCEL non inserito. ESCLUDO I RECUPERI
126580020319     C     A_§OGNTW      WHENEQ    'DPD'
126590991203     C     *INKS         ANDEQ     *OFF
126600991203     C     V7CNPR        ANDEQ     *ZEROS
126610000308     C     §3ARBL        ANDNE     'R'
126620991203     C                   SETON                                        4190
126630991203     C                   MOVEL     ERR(175)      VIDMSG
126640991203     C                   GOTO      ENDC02
126650991203      *
126660991203      * SPEDIZIONE non ESTERO SDI E MITTENTE CON OBBLIGO AWB e non DPD
126670991203      * Premuto F18
126680991203     C     *INKS         WHENEQ    *ON
126690991203     C                   MOVEL     ERR(89)       VIDMSG
126700991203     C                   SETON                                        4190
126710991203     C                   GOTO      ENDC02
126720991203      *
126730991203     C                   ENDSL
126740940825     C***
126750910829     C*** RIFERIMENTO MITTENTE NUMERICO ***
126760940916    1C     VIDRMN        IFEQ      0
126770940825     C                   MOVEL     ERR(47)       VIDMSG
126780940922     C                   SETON                                        4390
126790940920     C                   GOTO      ENDC02
126800991130    1C                   ENDIF
126810970328     C***
126820970328     C*** FLAG D D T     ******
126830970408     C* PAESE CON ATTRAVERSAMENTO DOGANA: OBBLIGATORIO SI DDT
126840970408    1C     VIDBAM        IFEQ      'N'
126850000321     C     WEFT          ANDNE     ' '
126860970408     C                   MOVEL     ERR(140)      VIDMSG
126870970408     C                   SETON                                        7790
126880970408     C                   GOTO      ENDC02
126890970408     C                   ENDIF
126900101105     C* per Fedex : obbligatorio SI DDT
126910120523     c                   if        vidbam='N' and  §3arbl <>'R' and
126920101108     c                             (VidDpd = 'F' or a_§OgNtw = 'FED' )
126930101105     C                   MOVEL     ERR(335)      VIDMSG
126940101105     C                   SETON                                        7790
126950101105     C                   GOTO      ENDC02
126960101105     C                   ENDIF
126970970408     C* SE BOLLA DI RECUPERO, OBBLIGATORIO NO BAM
126980970408    1C     VIDBAM        IFEQ      'S'
126990970408     C     §3ARBL        ANDEQ     'R'
127000000321     C     WEFT          ANDEQ     ' '
127010020513     c     vidcbo        andne     'FO'
127020970408     C                   MOVEL     ERR(138)      VIDMSG
127030970408     C                   SETON                                        7790
127040970408     C                   GOTO      ENDC02
127050970408     C                   ENDIF
127060020507     C* SE BOLLA DI RECUPERO per bolle firmate, obbligatorio SI DDT
127070020507    1C     VIDBAM        IFEQ      'N'
127080020513     c     vidcbo        andeq     'FO'
127090020507     C                   MOVEL     ERR(254)      VIDMSG
127100020507     C                   SETON                                        7790
127110020507     C                   GOTO      ENDC02
127120020507     C                   ENDIF
127130970703     C* bolle CON OBBLIGO DDT DA CAPPARIO: SE NON E' RECUPERO ERRORE
127140970703     C*  SE IMMESSO NODDT
127150970408    1C     VIDBAM        IFEQ      'N'
127160970703     C     DESGDD        ANDEQ     'S'
127170970408     C     §3ARBL        ANDNE     'R'
127180081127     c     savfpr        andne     'G'
127190081127     c     savfpr        andne     'P'
127200970328     C                   MOVEL     ERR(139)      VIDMSG
127210970328     C                   SETON                                        7790
127220970328     C                   GOTO      ENDC02
127230970408    1C                   ENDIF
127240041109     c* bolla con vax (con estensione ddt del cliente) errore se SI DDT
127250050211     c* solo se nazione e/o cap non prevedono l'obbligo del ddt si
127260050211     c                   if        §1bf16 = 'S' and vidbam = 'S' and
127270050211     c                             weft = *blanks and desgdd <> 'S'
127280041109     C                   MOVEL     ERR(287)      VIDMSG
127290041109     C                   SETON                                        7790
127300041109     C                   GOTO      ENDC02
127310041109     c                   endif
127320950303     C***
127330950303     C*** RIFERIMENTO MITTENTE ALFABETICO ***
127340950303     C* SE DESTINATARIO ESTERO -->  OBBLIGATORIO
127350950303     C     WDESIE        IFEQ      'E'
127360000321     C     WEFT          ANDNE     *BLANKS
127370950303     C     VIDRMA        ANDEQ     *BLANKS
127380950303     C                   MOVEL     '1'           WEMFOR
127390950303     C                   SETON                                          5890
127400950303     C                   MOVEL     ERR(110)      VIDMSG
127410950303     C                   GOTO      ENDC02
127420950303    1C                   ENDIF
127430021209      * Obbligatorio se è una bolla con consegna supermercato
127440030303      * ma non se è DPD
127450021209     c                   If        (VidTc1 = 'S' or VidTc2 = 'S')
127460021209     c                              and VidRma = *Blanks
127470030304     c                              and Not *In79 and wrma = *Blanks
127480021209     c                   Eval      Wemfor = '1'
127490021209     c                   Movel     Err(266)      VidMsg
127500021209     c                   Eval      *In58 = *On
127510021209     c                   Eval      *In90 = *On
127520021209     c                   GoTo      EndC02
127530021209     c                   EndIf
127540961111     C***
127550961111     C*** FLAG BOLLA RIENTRO
127560961111     C***
127570060920     c* se linea di arrivo dpd valida solo per resi ci deve essere
127580060920     c*  il flag
127590060921     c     viddpd        ifeq      'D'
127600060921     c     comlna        andeq     *zeros
127610060921     c     A_§ogNTW      oreq      'DPD'
127620060921     c* se però c'e' reso non do errore
127630060921     c                   if        o14lad<=*zeros and desred='S' and vidfbr<>'S'
127640060920     C                   SETON                                            90
127650060920     c                   z-add     20            h2riga
127660060920     c                   z-add     67            h2colo
127670060920     C                   MOVEL     ERR(157)      VIDMSG
127680060920     C                   GOTO      ENDC02
127690060920     c                   endif
127700060921     c                   endif
127710060920     c
127720961111     C     VIDFBR        IFNE      SAVFBR
127730961111     C                   MOVEL     VIDFBR        SAVFBR
127740961111     C                   CLEAR                   SED
127750961111     C                   ENDIF
127760090901     c*
127770090921     c* controllo se tipo servizio H accettabile x  linea di arrivo della bolla
127780090901     c*   tenendo conto dei tempi di trazione
127790090901     c                   if        vidtsp='H'
127800090901     c
127810100219     c                   clear                   UsaCass
127820090901     c                   exsr      ClsE98
127830090901     c
127840090922     c                   if        d98tcc<>10
127850100119     C                   SETON                                            90
127860090901     C                   MOVEL     ERR(57)       VIDMSG
127870100319     c* Se vengo da ORRM --> cancello il tipo servizio
127880100319     c                   if        wesORE='S'
127890100319     c                   movel     'N'           wesore
127900100319     c                   endif
127910090901     C                   GOTO      ENDC02
127920090901     c                   endif
127930100322     c* Se eiste FNORE --> dico che si può utilizzare
127940100322     c                   else
127950100322     c                   if        WesORE='N'
127960100322     c                   movel     'S'           wesore
127970100322     c                   endif
127980090901     c                   endif
127990060920     c*
128000900604     C*
128010900621     C*** CONTROLLO SEGNACOLLI DAL - AL ***
128020910118     C* SE FLAG STAMPA BOLLA E' "D" O "I" E PER BOLLE DI RECUPERO
128030910118     C*  OBBLIGATORIA LA NON IMMISSIONE
128040910117     C*
128050910118     C                   SETOFF                                       30
128060940825     C                   CLEAR                   WNOSEG
128070921019     C* NO SEGNACOLLO
128080930402     C* SE VENGO DA DISK CLIENTI SOLO SE E' BOLLA SENZA MAMMA
128090930402     C*  NEGLI ALTRI CASI SEMPRE
128100940825    1C     §1BFG8        IFEQ      'N'
128110930402     C*
128120940825    2C     *IN12         IFEQ      '1'
128130930402     C     *IN15         ANDEQ     '1'
128140940825     C*
128150940825    3C     §3ABCM        IFEQ      ' '
128160940825     C                   MOVEL     '1'           WNOSEG            1
128170940825    3C                   END
128180940825     C*
128190940825   X2C                   ELSE
128200940825     C                   MOVEL     '1'           WNOSEG            1
128210940825    2C                   END
128220940825    1C                   END
128230910805     C* NON SEQUENZIALI
128240940825    1C   12VIDFNS        IFEQ      'S'
128250940825     C                   MOVEL     '1'           WNOSEG            1
128260940825    1C                   END
128270910118     C*
128280940825    1C     WNOSEG        IFEQ      '1'
128290940825    2C     VIDNCD        IFGT      0
128300940825     C                   MOVEL     ERR(51)       VIDMSG
128310940922     C                   SETON                                        4590
128320940920     C                   GOTO      ENDC02
128330940825    2C                   END
128340910118     C*
128350940825    2C     VIDNCA        IFGT      0
128360940825     C                   MOVEL     ERR(51)       VIDMSG
128370940922     C                   SETON                                        4690
128380940920     C                   GOTO      ENDC02
128390940825    2C                   END
128400940825    1C                   END
128410960805     C* SE C'E' IL DETTAGLIO COLLI NON LI POSSO MODIFICARE
128420960805    1C     §1BFG7        IFEQ      'S'
128430980410     C     §1BFG6        ANDEQ     'C'
128440960805    2C     VIDNCD        IFNE      WNSNCD
128450960805     C     VIDNCA        ORNE      WNSNCA
128460960805     C                   MOVEL     ERR(127)      VIDMSG
128470960805     C                   SETON                                        4590
128480960805     C                   GOTO      ENDC02
128490960805    2C                   ENDIF
128500960805     C*
128510960805    1C                   ENDIF
128520910118     C*
128530940216     C*CAMBIO PORTO DIROTTAMENTO --> NON DO QUESTO ERRORE
128540940825     C* (44 ON )                     PERCHE' SEGNACOLLI SULLA MAMMA
128550940825     C  N44
128560940825    1CANN25WNOSEG        IFEQ      ' '
128570940825     C*
128580940825    2C     VIDNCD        IFEQ      0
128590940825     C                   MOVEL     ERR(51)       VIDMSG
128600940922     C                   SETON                                        4590
128610940920     C                   GOTO      ENDC02
128620940825    2C                   END
128630940916     C***
128640910117     C*
128650940825    3C     VIDNCA        IFNE      0
128660020315     C     VIDNCA        SUB       VIDNCD        COMNCL            8 0
128670900502     C                   ADD       1             COMNCL
128680900508     C                   ELSE
128690900508     C                   Z-ADD     1             COMNCL
128700940825    3C                   END
128710940825     C*
128720940825     C* CONTROLLO DIFFERENZA SEGNACOLLO DAL-AL CON NUMERO COLLI
128730940825    3C     COMNCL        IFNE      VIDNCL
128740940825     C                   MOVEL     ERR(45)       VIDMSG
128750940922     C                   SETON                                        4190
128760940920     C                   GOTO      ENDC02
128770940825    3C                   END
128780910117     C*
128790940825    1C                   END
128800910208     C*
128810940825     C* SE DEVO ATTRIBUIRE I SEGNACOLLI CONTROLLO CHE CI SIA LA NUMERAZ
128820991209     C                   CLEAR                   AAS
128830910208     C                   Z-ADD     9             CNU
128840930120     C                   MOVE      VIDLNP        COMLIN
128850930120     C                   MOVE      COMLNA        LIV2
128860930629     C     KNUF2         CHAIN(N)  FLNUF                              30
128870910508     C*
128880940916    1C     *IN30         IFEQ      *ON
128890940916    2C     *IN25         IFEQ      *ON
128900940825     C                   MOVEL     ERR(41)       VIDMSG
128910940922     C                   SETON                                        4590
128920940920     C                   GOTO      ENDC02
128930940916    2C                   ENDIF
128940940825     C                   Z-ADD     0             NUFRIN
128950940825     C                   Z-ADD     0             NUFRFI
128960940916    1C                   ENDIF
128970910208     C*
128980910208     C                   SETOFF                                       30
128990941021     C*
129000960926     C* LINEA SEGNACOLLO:
129010950525     C* PER DISK CLIENTI KA LNP E SEMPRE QUELLA DEL DISK
129020950525     C* SOLO PERO' SE IL CTM E' DI UNA SOLUZIONE "B"
129030950525     C   12
129040950525     CAN 15§1BFG6        IFEQ      'C'
129050950525     C                   MOVEL     §LPLNP        WFLS
129060950525     C                   ELSE
129070950525     C                   MOVEL     VIDLNP        WFLS
129080950525     C                   ENDIF
129090941021     C* PER IMMISSIONE E' LA LINEA DI PARTENZA
129100941021     C  N12              MOVEL     VIDLNP        WFLS
129110941021     C* PER MANUTENZIONE E' QUELLA GIA' MEMORIZZATA
129120941021     C   12
129130941021     CANN15              MOVEL     BLPFLS        WFLS
129140940825     C*
129150921006     C* SE SEGNACOLLI COMPRESI NEL RANGE DI QUELLI ASSEGNATI IN
129160921006     C*  AUTOMATICO  ERRORE
129170920203     C* NON CONTROLLO SE TIPO BOLLA CON MAMMA (§3ABCM=S)
129180950713    1C     §3ABCM        IFNE      'S'
129190950713    2C     VIDNCD        IFNE      0
129200921006     C*
129210921006     C* NON CONTROLLO IL RANGE SE SONO IN RECUPERO
129220950713     C   12
129230950713    3CAN 15§LPFPR        IFEQ      'R'
129240921006     C                   SETON                                        30
129250950713    3C                   END
129260921006     C*
129270990602    3C  N12PARTCH        IFEQ      'R'
129280921006     C                   SETON                                        30
129290950713    3C                   END
129300921006     C*
129310950713     C  N30
129320950713    3CANN25VIDNRS        IFEQ      0
129330910208     C*
129340950713    4C     VIDNCD        IFLT      NUFRIN
129350950713    5C     VIDNCA        IFGT      NUFRIN
129360940825     C                   MOVEL     ERR(51)       VIDMSG
129370940922     C                   SETON                                        4690
129380940920     C                   GOTO      ENDC02
129390950713    5C                   END
129400950713   X4C                   ELSE
129410950713    5C     VIDNCD        IFLE      NUFRFI
129420940825     C                   MOVEL     ERR(51)       VIDMSG
129430940922     C                   SETON                                        4590
129440940920     C                   GOTO      ENDC02
129450950713    5C                   END
129460950713    4C                   END
129470910208     C*
129480950713    3C                   END
129490950713    2C                   END
129500910208     C*
129510910208     C* S E G N A C O L L I   D O P P I
129520910117     C*
129530910208     C* IN MANUTENZIONE/DISK CLIENTI CONTROLLO SE NON CAMBIATA LNA
129540921006     C                   SETOFF                                       30
129550971211     C                   MOVEL     COMLNA        W003A
129560971211     C   12
129570971211    2CAN 25SAVLNA        IFNE      W003A
129580910208     C                   SETON                                        30
129590950713    2C                   ENDIF
129600950713     C*
129610910208     C*  E SE NON AUMENTATI SEGNACOLLI
129620940916     C   12
129630050113    2Can 25SAVNCL        iflt      V1CNCL
129640910208     C                   SETON                                        30
129650950713    3C                   ENDIF
129660950713     C*
129670950713     C* NON CONTROLLO SE DEVO ASSEGNARE IL PGM I SEGNACOLLI
129680950713    2C     §1BFG6        IFEQ      'D'
129690950713     C     §1BFG6        OREQ      'I'
129700950713     C     §1BFG6        OREQ      'N'
129710950713     C                   SETON                                        30
129720950713    2C                   ENDIF
129730000627     C* NON CONTROLLO IN CASO DI CHIAMATA PER CONTROLLO DI BOLLA
129740000627     C*  AUTOGENERATA  POSTE
129750000627     C     §LPFLG        IFEQ      'C'
129760000627     C     VIDSOP        ANDEQ     '&'
129770020319     c     §ogntw        andeq     'PPT'
129780000627     C                   SETON                                        30
129790000627    2C                   ENDIF
129800940916     C*
129810910826     C*
129820920123     C* PER DISK CLI  SE NON SONO SEQUENZIALI
129821141119     c*
129822141119     c* W_bldncd e W_bldnca servono per il controllo range segnacolli
129823141119     c* per serie parziale se segnacolli non sequenziali
129824141119     c* Li imposto solo in conferma bolle.
129825141119     c* In Immissione bolle e manutenzione LI LASCIO SEMPRE VUOTI in quanto
129826141119     c* non sono da controllare (TRULNRSR se vuoti non li controlla)
129827141119     c* - In immissione non è possibile bollettare con segnacolli non
129828141119     c*   sequenziali
129829141119     c* - In manutenzione non è possibile variare i dati sensibili per
129830141119     c*   il controllo range segnacolli (ccm, serie, fls, numeri segnacolli)
129831141118     c                   if        *in12 and *in15
129832080313     c                   z-add     *hival        w_bldncd
129833141118     c                   else
129834141118     c                   clear                   w_bldncd
129835141118     c                   endif
129840080313     c                   clear                   w_bldnca
129850940916     C   12
129860940916     CAN 15
129870940916    2CANN30VIDFNS        IFEQ      'S'
129880920123     C*
129890020917     C     KBLC          SETLL     FIVAD000
129900020917     C     KBLC          READE(N)  FIVAD000                               31
129910910826     C*
129920940916    3C     *IN31         DOWEQ     *OFF
129930941230     C                   Z-ADD     BLDNCD        COMSCD
129940080313     c* mi memorizzo in campi di comodo il numero più basso e quello più
129950080313     c* alto di segnacollo che mi servirà per il controllo range se
129960080313     c* cliente con serie parziale
129970080313    4c                   if        bldncd<w_bldncd
129980080313     C                   Z-ADD     BLDNCD        W_bldncd
129990080313    4c                   endif
130000080313    4c                   if        bldnca>0
130010080313    5c                   if        bldnca>W_bldnca
130020080313     C                   Z-ADD     BLDNCA        W_bldnca
130030080313    5c                   endif
130040080313   x4c                   else
130050080313    5c                   if        bldncd>w_bldnca
130060080313     C                   Z-ADD     BLDNCD        W_bldnca
130070080313    5c                   endif
130080080313    4c                   endif
130090120828     C     KBLT          CHAIN     FNBLT27L                           32
130100051102    4c                   if        *in32
130110120828     C     KBLT          CHAIN(N)  Fiars01L                           32
130120120828    5c                   if        not *in32
130130120828     c     kblt          chain     fnart27l                           32
130140051102     c* Se non trovato ART record presente x errore: lo cancello
130150120828     c   32kblt          delete    fiars01l
130160120828    5c                   endif
130170051102    4c                   endif
130180960319     C  N32              SETON                                        3190
130190020917     C   32KBLC          READE(N)  FIVAD000                               31
130200940916    3C                   ENDDO
130210940916     C*
130220940916    3C     *IN90         IFEQ      *ON
130230940916     C                   EXSR      PRPMSG
130240940920     C                   GOTO      ENDC02
130250940916    3C                   ENDIF
130260940916     C                   SETON                                        30
130270940916    2C                   ENDIF
130280910826     C*
130290920124     C* PER GLI ALTRI CASI
130300940916    2C  N30VIDFNS        IFEQ      ' '
130310910118     C                   Z-ADD     VIDNCD        CO2SCD            8 0
130320910118     C                   Z-ADD     VIDNCD        COMSCD            7 0
130330940916    3C     VIDNCA        IFEQ      0
130340900503     C                   Z-ADD     VIDNCD        COMSCA
130350900502     C                   ELSE
130360910118     C                   Z-ADD     VIDNCA        COMSCA            8 0
130370940916    3C                   END
130380900502     C*
130390940916    3C     CO2SCD        DOWLE     COMSCA
130400990318     C     CO2SCD        ANDGT     0
130410920124     C*
130420920124     C* PER IMMISSIONE  / DISK CLIENTI SEQUENZIALI
130430920124     C   12
130440920124     CAN 15
130450940916    4CORN12              DO
130460120828     C     KBLT          CHAIN     FNBLT27L                           32
130470051102     c
130480051102    5C   32§ogntw        IFne      'PPT'
130490120828     C     KBLT          CHAIN(N)  Fiars01L                           32
130500120828    6c                   if        not *in32
130510120828     c     kblt          chain     fnart27l                           32
130520051102     c* Se non trovato ART record presente x errore: lo cancello
130530120828     c   32kblt          delete    fiars01l
130540120828    6c                   endif
130550051102    5c                   endif
130560051102     c
130570051102     C  N32              SETON                                        90
130580940916     C*
130590001212     C* PREPARA MESSAGGIO DI ERRORE
130600100517     c
130610100517     C   90              EXSR      PRPMSG
130620100517    4C                   END
130630920124     C*
130640920124     C* PER MANUTENZIONE CONTROLLO ANCHE DI NON ESSERE ME STESSA
130650940916     C   12
130660940916    4CANN15              DO
130670120828     C     KBLT          SETLL     FNBLT27L
130680120828     C     KBLT          READE     FNBLT27L                               32
130690920124     C*
130700940916    5C     *IN32         DOWEQ     *OFF
130710940916    6C     VIDSPE        IFNE      BLPSPE
130720940916     C                   SETON                                        9032
130730920124     C                   ELSE
130740120828     C     KBLT          READE     FNBLT27L                               32
130750940916    6C                   ENDIF
130760940916    5C                   ENDDO
130770940916    4C                   ENDDO
130780940916     C* SEGNACOLLO DOPPIO --> PREPARA MESSAGGIO DI ERRORE
130790940916    4C     *IN90         IFEQ      *ON
130800940916     C                   EXSR      PRPMSG
130810940920     C                   GOTO      ENDC02
130820940916    4C                   ENDIF
130830920124     C*
130840910826     C* CONTROLLO ALTRO NUMERO
130850910826     C                   ADD       1             CO2SCD
130860910826     C                   ADD       1             COMSCD
130870940916    3C                   END
130880940916    2C                   END
130890920124     C*
130900940916    1C                   END
130910910220     C*
130920910220     C*** NUMERO SERIE ***
130930940826     C*
130940100517    2C     VIDNRS        IFNE      0
130950100517     c
130960940922     C*
130970940922     C* SE SERIE <> DA 0 E FLAG6 DEL CTM NON E' "C" ERRORE
130980940916    3C     §1BFG6        IFNE      'C'
130990940916     C                   MOVEL     ERR(49)       VIDMSG
131000940922     C                   SETON                                        5690
131010940920     C                   GOTO      ENDC02
131020940916    3C                   END
131030100517     c
131040100517     c                   clear                   trulnrsds
131050100517     c                   movel     wksc          inrsCCM
131060100517     c                   movel     vidnrs        inrsNRS
131070100517     c                   movel     wfls          inrsFLS
131080100517    3c                   if        vidfns='S'
131090100517     c                   movel     w_bldncd      inrsNCD
131100100517     c                   movel     w_bldnca      inrsNCA
131110100517     c                   else
131120100517     c                   movel     vidncd        inrsNCD
131130100517     c                   movel     vidnca        inrsNCA
131140100517    3c                   endif
131150100517     c
131160100517     c                   call      'TRULNRSR'
131170100517     c                   parm                    trulnrsds
131180100517     c
131190110902    3c****               select
131200110902    3c****               when      onrserr<>' ' and
131210110902     c****                         onrserr<>'N'
131220110902    3c                   if        onrserr<>' '
131230100517     C                   MOVEL     onrsmsg       VIDMSG
131240100517     C                   SETON                                        9056
131250100517     C                   GOTO      ENDC02
131260110902     c                   endif
131270100517     c
131280110902    3c*********          when      onrserr= 'N' and f_range=' '
131290080313      *
131300110902     c
131310110902     c******             eval      f_range='1'
131320110902     c*******            seton                                        90
131330110902     c******             exsr      escier
131340110902    4C**** §lpfpr        IFNE      '5'
131350080314     C* gestione window con errore forzabile
131360110902     c*****              setoff                                       90
131370100517     c* riempi i campi col messaggio
131380110902     c*****              eval      w3cpfl1=%subst(onrsmsg:1:24)
131390110902     c*****              eval      w3cpfl2=%subst(onrsmsg:25:38)
131400110902     c*****              eval      w3cpfl3=%subst(onrsmsg:63:16)
131410100517     c
131420110902    5c****               if        §lpfpr<>'V'
131430110902     c****               write     ls01d02
131440110902    5c****               endif
131450110902    5c****               dou       *inkf
131460110902     c****               exfmt     ls01w3cp
131470110902    5c****               enddo
131480110902     c****               eval      wemfor='1'
131490110902     c****               goto      endc02
131500110902   x4C***+               ELSE
131510110902     c***                seton                                        90
131520110902     C****               GOTO      ENDC02
131530110902    4C****               ENDIF
131540110902    3c******             ENDSL
131550910308     C*
131560940916   X2C                   ELSE
131570910308     C* SERIE =0 FLAG6 DEL CTM = "C" ERRORE
131580940916    3C     §1BFG6        IFEQ      'C'
131590940916     C                   MOVEL     ERR(49)       VIDMSG
131600940922     C                   SETON                                        5690
131610940920     C                   GOTO      ENDC02
131620940916    3C                   END
131630940916    2C                   END
131640921006     C*
131650940916     C* SE RECUPERO CONTROLLO NUM SPEDIZIONE DOPPIO
131660990602    1C  N12PARTCH        IFEQ      'R'
131670940915     C     KNSP          SETLL     FNBLP01L                               30
131680940928    2C     *IN30         IFEQ      *ON
131690940916     C                   MOVEL     ERR(50)       VIDMSG
131700940922     C                   SETON                                        5690
131710940920     C                   GOTO      ENDC02
131720940928    2C                   END
131730940928    1C                   END
131740940916     C***
131750900502     C*** NATURA MERCE ***
131760940928    1C  N27VIDNAS        IFEQ      *BLANKS
131770940928     C                   MOVEL     ERR(53)       VIDMSG
131780940922     C                   SETON                                        4890
131790940920     C                   GOTO      ENDC02
131800940928    1C                   END
131810970115     C*
131820970115     C* CONTROLLO QUALI DICITURE NON SONO AMMESSE E PER QULI BOLLE
131830970115     C                   Z-ADD     1             C
131840970115    1C     LDC(C)        DOWNE     *BLANKS
131850970115     C*
131860970115     C                   CLEAR                   WRICER
131870970115    2C     WDESIE        IFEQ      'E'
131880970115    3C     TBO(C)        IFEQ      ' '
131890970115     C     TBO(C)        OREQ      'E'
131900970115     C                   MOVEL     'S'           WRICER            1
131910970115    3C                   ENDIF
131920970115    2C                   ENDIF
131930970115    2C     WDESIE        IFEQ      'I'
131940970115    3C     TBO(C)        IFEQ      ' '
131950970115     C     TBO(C)        OREQ      'I'
131960970115     C                   MOVEL     'S'           WRICER            1
131970970115    3C                   ENDIF
131980970115    2C                   ENDIF
131990970115     C*
132000970115    2C     WRICER        IFEQ      'S'
132010970115     C                   MOVEL     TBO(C)        W003A
132020970115     C                   MOVE      LDC(C)        W003A
132030970115     C                   MOVEL     '3F'          COD
132040970115     C                   MOVEL(P)  W003A         KEY
132050970115     C     KTAB2         CHAIN     TABEL                              30
132060970115    3C     *IN30         IFEQ      *OFF
132070970115     C                   MOVEA     TBLUNI        K89
132080970115    3C                   ENDIF
132090970115     C                   MOVEL     LDC(C)        Z                 2 0
132100970115     C                   Z-ADD     1             Y                 3 0
132110970115     C*
132120970115    3C     Y             DOWLT     86
132130970115     C                   CLEAR                   W015A
132140970115     C                   MOVEA     K89(Y)        W015A            15
132150970115    4C     W015A         IFNE      *BLANKS
132160970115     C     W015A:Z       SCAN      VIDNAS                                 31
132170970115     C* ERRORE
132180970115    5C     *IN31         IFEQ      *ON
132190970115     C*
132200970115     C     WDESIE        IFEQ      'E'
132210970115     C                   MOVEA     ERR(135)      K78
132220970115     C                   ELSE
132230970115     C                   MOVEA     ERR(136)      K78
132240970115     C                   ENDIF
132250970115     C                   Z-ADD     11            YY                3 0
132260970115     C                   DO        Z
132270970115     C                   MOVEL     K89(Y)        K78(YY)
132280970115     C                   ADD       1             YY
132290970115     C                   ADD       1             Y
132300970115     C                   ENDDO
132310970115     C                   MOVEL     '"'           K78(YY)
132320970115     C                   MOVEA     K78           VIDMSG
132330970115     C*
132340970115     C                   SETON                                        4890
132350970115     C                   Z-ADD     89            Y
132360970115     C                   Z-ADD     29            C
132370970115    5C                   ENDIF
132380970115    4C                   ENDIF
132390970115     C*
132400970115     C                   ADD       Z             Y
132410970115    3C                   ENDDO
132420970115    2C                   ENDIF
132430970115     C*
132440970115     C                   ADD       1             C
132450970115    1C                   ENDDO
132460940930     C***
132470940930     C*** MITTENTE ORIGINALE ***
132480941103     C                   MOVEL     VIDRMO        WRMO
132490941103     C                   MOVEL     VIDCMO        WCMO
132500941108     C                   MOVEL     VIDNMO        WNAR
132510941103     C                   EXSR      CTRMO
132520941103     C                   MOVEL     WNAR          VIDNMO
132530941103     C     WEMFOR        IFEQ      '1'
132540941103     C                   GOTO      ENDC02
132550941103     C                   ENDIF
132560091008     c*** . . .obbligatorio per porti assegnati import
132570091008     c                   if        §3atb1='A2' and (§ogntw='FED' or
132580091008     c                             §ogntw='DPD' or §ogntw='EEX')
132590091008     c                             and (vidrmo=*blanks or vidcmo=*blanks)
132600091016     c                             and *in44=*off and vidfbr<>'S'
132610091008     C                   MOVEL     ERR(328)      VIDMSG
132620091008     C                   SETON                                        90
132630091008     c                   select
132640091008     c                   when      vidrmo=*blanks
132650091008     c                   seton                                        71
132660091008     c                   when      vidcmo=*blanks
132670091008     c                   seton                                        72
132680091008     c                   endsl
132690091008     C                   GOTO      ENDC02
132700091008     c                   endif
132710091008     c
132720940922     C***
132730940922     C*** CONTRASSEGNO ***
132740961204     c***
132750961204     C* PER BOLLE DI RESO NON SI PUO' INSERIRE
132760961204     C     VIDFBR        IFEQ      'S'
132770961204     C     §3AFCA        ANDGT     0
132780961204     C                   MOVEL     ERR(134)      VIDMSG
132790961204     C                   SETON                                        5090
132800961204     C                   GOTO      ENDC02
132810961204    1C                   ENDIF
132820940922     C* IN MANUTENZIONE: SE BOLLA CHE PREVEDE C/A MA E' CON MAMMA E
132830940922     C*  SI TRATTA DI UN TIPO BOLLA NON MANUTENZ, NON POSSO INSERIRE:
132840940922     C*  NE' TIPO INCASSO NE' C/ASSEGNO, MENTRE POSSO INSERIRE LE VARIE
132850940922     C*
132860940922    1C     *IN12         IFEQ      *ON
132870940922     C     *IN15         ANDEQ     *OFF
132880940922     C     *IN44         ANDEQ     *ON
132890940922     C     §3ABCM        ANDNE     ' '
132900940922     C     §3AFCA        ANDNE     0
132910940922     C*
132920940922    2C     VIDTIC        IFNE      *BLANKS
132930940922     C                   MOVEL     ERR(99)       VIDMSG
132940940922     C                   SETON                                        4990
132950940922    2C                   END
132960940922    2C  N90VIDCAS        IFNE      0
132970940922     C                   MOVEL     ERR(98)       VIDMSG
132980940922     C                   SETON                                        5090
132990940922    2C                   END
133000940922     C*
133010940922   X1C                   ELSE
133020940922     C*
133030940922     C* IN TUTTI GLI ALTRI CASI SI SEGUONO LE REGOLE CORRETTE
133040940922     C* NON C'E' FLAG C/ASSEGNO SU TIPO BOLLA
133050940922    2C     §3AFCA        IFEQ      0
133060940922     C*
133070940922    3C     VIDTIC        IFNE      *BLANKS
133080940922     C                   MOVEL     ERR(99)       VIDMSG
133090940922     C                   SETON                                        4990
133100940922    3C                   ENDIF
133110940922    3C  N90VIDCAS        IFNE      0
133120940922     C                   MOVEL     ERR(98)       VIDMSG
133130940922     C                   SETON                                        5090
133140940922    3C                   ENDIF
133150940922     C*
133160940922   X2C                   ELSE
133170940922     C*
133180940922     C*     C'E' FLAG C/ASSEGNO SU TIPO BOLLA
133190940922    3C     VIDCAS        IFEQ      0
133200940922     C                   MOVEL     ERR(98)       VIDMSG
133210940922     C                   SETON                                        5090
133220940922    3C                   ENDIF
133230011108     C  N90VIDVCA        IFEQ      *BLANKS
133240011108     C                   MOVEL     ERR(169)      VIDMSG
133250011108     C                   SETON                                        5190
133260011108     C                   ENDIF
133270940922    2C                   ENDIF
133280940922     C*
133290940922    1C                   ENDIF
133300940922     C* ERRORE
133310940922     C   90              GOTO      ENDC02
133320090622     c*
133330090622     c* Controllo tipo incasso C/A e relativa divisa
133340090622     c* richiamo pgm TRULTICR
133350090625    1c                   if        vidtic<>*blanks or vidcas>0
133360091211     c                   exsr      sr_trultic
133370091211     c                   exsr      sr_impochktic
133380090622     c
133390090625    2c                   if        oticric='T'
133400090624     c                   movel     otictic       vidtic
133410090624     c                   eval      wemfor='1'
133420090624     C                   GOTO      ENDC02
133430090625    2c                   endif
133440090625    2c                   if        oticric='D'
133450090624     c                   movel     oticdiv       vidvca
133460090624     C                   eval      wemfor='1'
133470090624     C                   GOTO      ENDC02
133480090625    2c                   endif
133490090622     c* Errore tipo incasso
133500091211     c* Se errore di tipo "C" lo segnalo solo se non c'è orm con
133510091211     c* triangolazione oppure se è stato già scelto il beneficiario
133520091211     c* del contrassegno
133530091211    2c                   if        oticerr='T' or (oticerr='C' and
133540091211     c                             (nochkticC=*off or (wcassel1='X'or
133550091211     c                             wcassel2='X')))
133560090624     C                   MOVEL     oticmsg       VIDMSG
133570090624     C                   SETON                                        4990
133580090624     C                   GOTO      ENDC02
133590091211    2C                   ENDIF
133600090622     c* Errore divisa
133610090625    2c                   if        oticerr='D'
133620090624     C                   MOVEL     oticmsg       VIDMSG
133630090624     C                   SETON                                        5190
133640090624     C                   GOTO      ENDC02
133650090624    2C                   ENDIF
133660090624     c* Ulteriori controlli non presenti in TRULTICR
133670090625
133680060707     c* se tipo incasso richiede il mittente originale controllo che
133690060707     c* sia stato immesso
133700090625    2c                   if        §1amro='S' and vidrmo=*blanks
133710060707     C                   MOVEL     ERR(304)      VIDMSG
133720060707     C                   SETON                                        7190
133730060707     C                   GOTO      ENDC02
133740090625    2c                   endif
133750090625      * Devo lo stesso agganciare tabella "TM" perchè serve poi nella
133760090625      * routine di registrazione
133770090625     C                   MOVEL     'TM'          COD
133780090625     C                   MOVEL(P)  WKSC          KEY
133790090625     C*
133800090625     C                   EXSR      CTABEL
133810090625     c  n30              movel     tbluni        dstm
133820090625     c   30              clear                   dstm
133830090625     c*
133840090625    1c                   endif
133850011108     C*
133860011108     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE IL C/A
133870011108     C* INDICATORE DI CHANGE 11 ON
133880011108    1C     VARVCA        IFNE      VIDVCA
133890011108    2C     WIN11         IFEQ      *BLANKS
133900011108     C     VIDCAS        ANDNE     0
133910011108     C                   MOVEL     ERR(105)      VIDMSG
133920011108     C                   SETON                                        5090
133930011108     C                   GOTO      ENDC02
133940011108    2C                   ENDIF
133950011108     C*
133960011108    1C                   ENDIF
133970011108     C*
133980011212      * pulisco il flag x la forzatura importo C/Assegno
133990011212     C     VIDCAS        IFNE      WARCAS
134000011212     C                   CLEAR                   FORCAS
134010011212     C                   Z-ADD     VIDCAS        WARCAS
134020011212     C                   ENDIF
134030011212     C                   CLEAR                   FCASAV
134040011211     C* Richiamo TRUL21R per controllo limiti importo C/Assegno
134050090921    1C     VIDCAS        IFGT      *ZEROS
134060011211     C                   CLEAR                   DSUL21
134070011211     C                   MOVEL     VIDCBO        I21CBO
134080090921    2C     VIDTSP        IFNE      *BLANKS
134090011211     C                   MOVEL     VIDTSP        I21TSP
134100011211     C                   ELSE
134110011211     C                   MOVEL     COMTSP        I21TSP
134120090921    2C                   ENDIF
134130011211     C                   Z-ADD     VIDLNP        I21LNP
134140011211     C                   MOVEL     VIDNZM        I21NZM
134150011211     C                   Z-ADD     COMLNA        I21LNA
134160011211     C                   MOVEL     VIDNZD        I21NZD
134170130826    2C**   *IN04         IFEQ      *ON
134180130826     C**                 Z-ADD     9999          I21KSC
134190130826     C**                 MOVEL     VIDLNP        I21KSC
134200130826   x2C**                 ELSE
134210130826     c* in I21ksc passo il mittente
134220011211     C                   Z-ADD     VIDCCM        I21KSC
134230090921    3C     VIDFLC        IFEQ      0
134240011211     C                   MOVEL     VIDLNP        I21KSC
134250090921   x3C                   ELSE
134260011211     C                   MOVEL     VIDFLC        I21KSC
134270090921    3C                   ENDIF
134280130826     c                   if        vidccm=9999
134290130826     c                   move      8888          i21ksc
134300130826     c                   endif
134310130826    2C**                 ENDIF
134320011211     C                   MOVEL     VIDCTR        I21CTR
134330011211     C                   MOVEL     VIDTIC        I21TIC
134340011211     C                   Z-ADD     VIDCAS        I21IMP
134350011211     C                   MOVEL     VIDVCA        I21DIV
134360011211     C                   MOVEL     KNMUS         I21UTE
134370011211     C                   MOVEL     NOMPGM        I21PGM
134380011211     C                   CALL      'TRUL21R'
134390011211     C                   PARM                    DSUL21
134400011212     C* Salvo il flag del limite di abilitazione C/A che mi servirà per
134410011212     C* il richiamo del pgm di stampa L.V.
134420011212     C                   MOVE      O21FCA        FCASAV
134430011211     C* IMPORTO MAGGIORE DEL LIMITE MAX
134440090921    2C     O21FX2        IFNE      *BLANKS
134450011211     C                   MOVEA     ERR(131)      K78
134460011212     C                   MOVE      O21LX2        WNUMED
134470011212     C* richiamo routine per editare il limite
134480011212     C                   EXSR      CALLXE
134490011211      * metto il numero editato nel campo del messaggio
134500011211     C                   MOVEA     W014A         SKII(1)
134510011211     C                   MOVEA     SKII(1)       K78(47)
134520011211     C*
134530011211     C                   MOVEA     K78           VIDMSG
134540011211     C                   SETON                                        5090
134550011211     C                   GOTO      ENDC02
134560090921    2C                   ENDIF
134570090921     c
134580011211     C* IMPORTO INFERIORE AL LIMITE MINIMO
134590090921    2C     O21FMN        IFNE      *BLANKS
134600011212     C                   MOVEA     ERR(236)      K78
134610011212     C                   MOVE      O21LMN        WNUMED
134620011212     C* richiamo routine per editare il limite
134630011212     C                   EXSR      CALLXE
134640011212      * metto il numero editato nel campo del messaggio
134650011212     C                   MOVEA     W014A         SKII(1)
134660011212     C                   MOVEA     SKII(1)       K78(31)
134670011212     C*
134680011212     C                   MOVEA     K78           VIDMSG
134690011212     C                   SETON                                        5090
134700011212     C                   GOTO      ENDC02
134710090921    2C                   ENDIF
134720090921     c
134730011211     C* IMPORTO MAGGIORE DEL LIMITE FORZABILE
134740090921    2C     O21FX1        IFNE      *BLANKS
134750011212     C     FORCAS        ANDEQ     *BLANKS
134760011212     C                   MOVEL     '1'           FORCAS            1
134770011212     C                   MOVEA     ERR(237)      K78
134780011212     C                   MOVE      O21LX1        WNUMED
134790011212     C* richiamo routine per editare il limite
134800011212     C                   EXSR      CALLXE
134810011212      * metto il numero editato nel campo del messaggio
134820011212     C                   MOVEA     W014A         SKII(1)
134830011212     C                   MOVEA     SKII(1)       K78(24)
134840011212     C                   MOVEA     K78           VIDMSG
134850011212     C                   SETON                                        5090
134860011212     C                   GOTO      ENDC02
134870090921    2C                   ENDIF
134880090921     c
134890090921     c* Tipo servizio H non ammesso er C/ASS da abilitare
134900090921     c                   if        fcasav<>*blanks  and  vidtsp='H'
134910090921     c                   SETON                                        5090
134920090921     C                   MOVEL     ERR(149)      VIDMSG
134930090921     C                   GOTO      ENDC02
134940090921     c                   endif
134950090921     c
134960090921    1C                   ENDIF
134970090625     C*
134980011108     C                   MOVEL     VIDVCA        VARVCA
134990011108     C                   CLEAR                   WIN11
135000940916     C***
135010961111     C*** N O T E    ***
135020990610     C* SONO OBBLIGATORIE SE BOLLA PREPAGATO PER TELEFONO E REFERENTE
135030990610     C*  RITIRO
135040990610    3C     PARTCH        IFEQ      'P'
135050990610     C     SES           ANDEQ     0
135060010306    3C     §LPFPR        OREQ      'O'
135070010306     C     SES           ANDEQ     0
135080990610     C                   MOVEL     ERR(159)      VIDMSG
135090990610     C                   MOVEL     1             SES
135100990610     C                   SETON                                        8690
135110990610     C                   GOTO      ENDC02
135120990610    3C                   END
135130990610     C*
135140990610    3C     VIDNT1        IFEQ      *BLANKS
135150990610     C     VIDNT2        ANDEQ     *BLANKS
135160990610     C     PARTCH        ANDEQ     'P'
135170010306    3C     VIDNT1        OREQ      *BLANKS
135180010306     C     VIDNT2        ANDEQ     *BLANKS
135190010306     C     §LPFPR        ANDEQ     'O'
135200990610     C                   MOVEL     ERR(159)      VIDMSG
135210990610     C                   SETON                                        8690
135220990610     C                   GOTO      ENDC02
135230990610    3C                   END
135240961111     C***
135250961111     C*** IMPORTO DA ASSICURARE ***
135260961111     C***
135270950120     C* SE VARIATO ME LO SALVO
135280950120     C     *IN89         IFEQ      *ON
135290950120     C                   MOVEL     '1'           WIN89             1
135300950120     C                   ENDIF
135310950104     C*
135320011112     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
135330011112     C     VIDIAS        IFGT      *ZEROS
135340011112     C     VIDVAS        ANDEQ     *BLANKS
135350011112     C                   MOVEL     ERR(169)      VIDMSG
135360011114     C                   SETON                                        8190
135370011112     C                   GOTO      ENDC02
135380011112     C                   ENDIF
135390011112     C*
135400950104     C                   MOVEL     VIDVAS        WVLT
135410950104     C                   Z-ADD     VIDIAS        W0133            13 3
135420950104     C* CONTROLLO LA DIVISA
135430950104     C                   EXSR      CTRVLT
135440950104     C                   MOVEL     WVLT          VIDVAS
135450950104     C* ERRORE
135460950104     C   90              SETON                                        81
135470950104     C*
135480950104     C     WEMFOR        IFEQ      '1'
135490950104     C                   GOTO      ENDC02
135500950104     C                   ENDIF
135510011113     C*
135520011113     C* CONTROLLO SCADENZA DIVISA
135530011113     C     BLPDSP        IFGT      §CVDLI
135540011113     C     VIDIAS        ANDNE     0
135550011113     C                   MOVEL     ERR(232)      VIDMSG
135560011114     C                   SETON                                        8190
135570011113     C                   GOTO      ENDC02
135580011113     C                   ENDIF
135590950104     C*
135600950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
135610950104     C* INDICATORE DI CHANGE 89 ON
135620950104     C     VIDVAS        IFNE      VARVAS
135630950120     C     WIN89         ANDEQ     *BLANKS
135640011112     C     VIDIAS        ANDNE     0
135650950104     C                   MOVEL     ERR(105)      VIDMSG
135660950104     C                   SETON                                        8090
135670950104     C                   GOTO      ENDC02
135680950104    2C                   ENDIF
135690950104     C*
135700950104     C                   MOVEL     VIDVAS        VARVAS
135710950120     C                   CLEAR                   WIN89
135720940922     C*
135730940922     C* LO PRENDO SOLO PER LE SPEDIZIONI IN FRANCO PERCHE' IN ASSEGNATO
135740940922     C*  LA MERCE E' FRANCO STABILIMENTO, PER CUI DIVENTA DEL DESTINAT
135750941103    1C     *IN04         IFEQ      *OFF
135760940922     C* SOLO SE IL MITTENTE HA TARIFFE
135770941108     C     WTKS          ANDEQ     'S'
135780950104     C*
135790950104     C* SE <> 0 CONTROLLO CHE NON SUPERI IL VALORE IN TARIFFA
135800011211    2C     VIDIAS        IFNE      VARIAS
135810950104     C     VIDNCL        ORNE      VARNCL
135820950104     C                   Z-ADD     0             DIE
135830991028    2C                   END
135840940922     C*
135850940922    2C     VIDIAS        IFGT      0
135860940922     C     DIE           ANDNE     NUMFOR
135870950215     C     TAMFIS        ORNE      '0'
135880011211     C                   Z-ADD     VIDIAS        VARIAS
135890940922     C                   MOVEL     VIDNCL        VARNCL
135900960209     C* NON CONTROLLA DA TARIFFA SE OBBLIG.SE TIPO BOLLA NON PREVISTO
135910960209     C     §3ATB1        LOOKUP    TBL                                    30
135920960209     C*
135930960209   2AC     *IN30         IFEQ      *ON
135940940922     C*
135950940922     C* SOLO SE E' ASSICURAZIONE ANCHE PER LE PARTENZE ( <> A )
135960990818     C     KTPT          CHAIN     TITPT000                           30
135970950220    3C     *IN30         IFEQ      *ON
135980950220     C     TPTATB        ORNE      ' '
135990950220     C     TPTAPL        ORNE      'A'
136000950215     C*
136010950215     C* TAMFIS=1 OBBLIGATORIO     FORZABILE --> CON ENTER PRENDO MAX
136020950215     C*                                         IMPORTO DA TARIFFA
136030950215    4C     TAMFIS        IFEQ      '1'
136040950215     C     CIN           ANDNE     NUMFOR
136050011211     C     VIDIAS        ANDEQ     0
136060950215     C                   MOVEL     ERR(93)       VIDMSG
136070950215     C                   SETON                                        8090
136080950215     C                   ADD       1             CIN
136090950215     C                   GOTO      ENDC02
136100950215    4C                   ENDIF
136110950215     C*
136120950215     C* TAMFIS=3 OBBLIGATORIO NON FORZABILE --> ERRORE SEMPRE
136130950215    4C     TAMFIS        IFEQ      '3'
136140011211     C     VIDIAS        ANDEQ     0
136150950215     C                   MOVEL     ERR(94)       VIDMSG
136160950215     C                   SETON                                        8090
136170950215     C                   GOTO      ENDC02
136180950215    4C                   ENDIF
136190950215     C*
136200950215     C* TAMFIS=2 NON INSERIBILE             --> ERRORE SEMPRE
136210950215    4C     TAMFIS        IFEQ      '2'
136220011211     C     VIDIAS        ANDNE     0
136230950215     C                   MOVEL     ERR(95)       VIDMSG
136240950217     C                   SETON                                        8090
136250950215     C                   GOTO      ENDC02
136260950215    4C                   ENDIF
136270950220    3C                   ENDIF
136280950215     C* SE C'E VALORE MERCE:
136290950220    3C  N30TPTATB        IFEQ      ' '
136300950220     C     TPTAPL        ANDNE     'A'
136310950220     C     TPTVLM        ANDGT     0
136320940922     C* VALORE A COLLO
136330950220    4C     TPTFVM        IFEQ      '1'
136340991028     C     VIDNCL        MULT      TPTVLM        W0133A           13 3
136350950220   X4C                   ELSE
136360950220    5C     TPTFVM        IFEQ      '2'
136370991028     C                   Z-ADD     TPTVLM        W0133A
136380950220   X5C                   ELSE
136390940922     C     V2CPKG        ADD       0,9           W0060             6 0
136400991028     C     W0060         MULT      TPTVLM        W0133A
136410950220    5C                   END
136420950220    4C                   END
136430991028     C**
136440991028     C* TRASFORMO L'IMPORTO DA ASSICURARE NELLA DIVISA DELLA TARIFFA
136450011113     C                   Z-ADD     VIDIAS        IASTAR
136460991028    5C     COMDIV        IFNE      VIDVAS
136470991028     C                   CLEAR                   DSYEUR
136480991028     C                   MOVEL     VIDVAS        YECDVI
136490991028     C                   MOVEL     COMDIV        YECDVO
136500991028     C                   Z-ADD     VIDIAS        YECIMI
136510011113     C                   MOVE      COMDEC        YECDCO
136520991028     C*
136530991028     C                   CALL      'YEURCO'
136540991028     C                   PARM                    DSYEUR
136550991028     C*
136560991028    6C     YECESI        IFEQ      ' '
136570011113     C                   Z-ADD     YECIMO        IASTAR           17 3
136580991028    6C                   ENDIF
136590991028    5C                   ENDIF
136600940922     C*
136610011113    4C     IASTAR        IFGT      W0133A
136620950217     C     DIE           ANDNE     NUMFOR
136630940922     C                   ADD       1             DIE
136640940922     C                   MOVEL     ERR(97)       VIDMSG
136650941231     C                   SETON                                        8090
136660940922     C                   GOTO      ENDC02
136670950220    4C                   ENDIF
136680940922     C*
136690950215    3C                   ENDIF
136700960209   2AC                   ENDIF
136710960209    2C                   ENDIF
136720940922    1C                   ENDIF
136730940916     C*
136740011211      * pulisco il flag x la forzatura importo da assicurare forzabile
136750011211     C     VIDIAS        IFNE      WARIAS
136760011211     C                   CLEAR                   FORIAS
136770011211     C                   Z-ADD     VIDIAS        WARIAS
136780011211     C                   ENDIF
136790011211     C*
136800011211     C* CONTROLLO LIMITI IMPORTO DA ASSICURARE
136810011211     C     VIDIAS        IFGT      0
136820011211     C                   CLEAR                   DSUL22
136830011211     C                   MOVEL     VIDCBO        I22CBO
136840011211     C     VIDTSP        IFNE      *BLANKS
136850011211     C                   MOVEL     VIDTSP        I22TSP
136860011211     C                   ELSE
136870011211     C                   MOVEL     COMTSP        I22TSP
136880011211     C                   ENDIF
136890011212     C                   Z-ADD     VIDLNP        I22LPS
136900011211     C                   MOVEL     VIDNZM        I22NZM
136910011211     C                   Z-ADD     COMLNA        I22LNS
136920011211     C                   MOVEL     VIDNZD        I22NZD
136930011211     C     *IN04         IFEQ      *ON
136940011211     C                   Z-ADD     9999          I22KSC
136950011211     C                   MOVEL     VIDLNP        I22KSC
136960011211     C                   ELSE
136970011211     C                   Z-ADD     VIDCCM        I22KSC
136980011211     C     VIDFLC        IFEQ      0
136990011211     C                   MOVEL     VIDLNP        I22KSC
137000011211     C                   ELSE
137010011211     C                   MOVEL     VIDFLC        I22KSC
137020011211     C                   ENDIF
137030011211     C                   ENDIF
137040011211     C                   MOVEL     VIDCTR        I22CTR
137050011211     C                   Z-ADD     VIDIAS        I22IMP
137060011211     C                   MOVEL     VIDVAS        I22DIV
137070011211     C                   MOVEL     KNMUS         I22UTE
137080011211     C                   MOVEL     NOMPGM        I22PGM
137090011211     C                   CALL      'TRUL22R'
137100011211     C                   PARM                    DSUL22
137110011211     C* IMPORTO DA ASSICUARE NON AMMESSO
137120011211     C     O22FMN        IFNE      *BLANKS
137130011211     C     O22FX1        ANDNE     *BLANKS
137140011211     C     O22FX2        ANDNE     *BLANKS
137150011211     C                   MOVEL     ERR(234)      VIDMSG
137160011211     C                   SETON                                        8090
137170011211     C                   GOTO      ENDC02
137180011211     C                   ENDIF
137190011211     C* IMPORTO DA ASSICURARE > DEL LIMITE IMPOSTO
137200011211     C     O22FX2        IFNE      *BLANKS
137210011211     C                   MOVEA     ERR(96)       K78
137220011212     C                   MOVE      O22LX2        WNUMED
137230011212     C* richiamo routine per editare il limite
137240011212     C                   EXSR      CALLXE
137250011211      * metto il numero editato nel campo del messaggio
137260011211     C                   MOVEA     W014A         SKII(1)
137270011211     C                   MOVEA     SKII(1)       K78(38)
137280011211     C                   MOVEA     K78           VIDMSG
137290011211     C                   SETON                                        8090
137300011211     C                   GOTO      ENDC02
137310011211     C                   ENDIF
137320011211     C* IMPORTO DA ASSICURARE INFERIORE DEL LIMITE DI LEGGE
137330011211     C     O22FMN        IFNE      *BLANKS
137340011211     C                   MOVEA     ERR(165)      VIDMSG
137350011211     C                   SETON                                        8090
137360011211     C                   GOTO      ENDC02
137370011211     C                   ENDIF
137380011211     C* IMPORTO DA ASSICURARE > DEL LIMITE FORZABILE
137390011211     C     O22FX1        IFNE      *BLANKS
137400011211     C     FORIAS        ANDEQ     *BLANKS
137410011211     C                   MOVEL     '1'           FORIAS            1
137420011211     C                   MOVEA     ERR(235)      K78
137430011212     C                   MOVE      O22LX1        WNUMED
137440011212     C* richiamo routine per editare il limite
137450011212     C                   EXSR      CALLXE
137460011211      * metto il numero editato nel campo del messaggio
137470011211     C                   MOVEA     W014A         SKII(1)
137480011211     C                   MOVEA     SKII(1)       K78(28)
137490011211     C                   MOVEA     K78           VIDMSG
137500011211     C                   SETON                                        8090
137510011211     C                   GOTO      ENDC02
137520011211     C                   ENDIF
137530011211     C                   ENDIF
137540950102     C***
137550950102     C*** QUANTITA' DA FATTURARE  ***
137560950102     C                   MOVEL     VIDCTR        W001A
137570950102     C*
137580950103     C* SE MODIFICATA, PULISCO IL FLAG DI CONTROLLO
137590950102     C     VIDQFT        IFNE      VARQFT
137600950102     C                   CLEAR                   UND
137610950102     C                   MOVEL     VIDQFT        VARQFT
137620950102     C                   ENDIF
137630950102     C*
137640950103     C* CONTROLLO LA Q.TA DA FATTURARE CON TARIFFE SOLO SE C'E'
137650950103     C*  TARIFFA E SE E' FRANCO, PER ASSEGNATO E' DEL DESTINATARIO
137660950102    1C     WTKS          IFEQ      'S'
137670950102     C     W001A         ANDEQ     '4'
137680950103     C     *IN04         ANDEQ     *OFF
137690950102     C*
137700950102    2C     VIDQFT        IFEQ      0
137710950102     C*
137720950102     C* TAMFVD = '1' ASSUMO VALORE DA ASSICURARE SE NON IMMESSO
137730950103    3C     TAMFVD        IFEQ      '1'
137740950103     C     UND           ANDEQ     0
137750950102     C                   MOVEL     ERR(106)      VIDMSG
137760950102     C                   SETON                                        8490
137770950102     C                   MOVEL     1             UND
137780950102     C                   GOTO      ENDC02
137790950103    3C                   ENDIF
137800961007     C* TAMFVD = '2' O '4'  INSERIRE IN BOLLETTAZIONE
137810950103    3C     TAMFVD        IFEQ      '2'
137820961007     C     TAMFVD        OREQ      '4'
137830950102     C                   MOVEL     ERR(107)      VIDMSG
137840950102     C                   SETON                                        8490
137850950102     C                   GOTO      ENDC02
137860950103    3C                   ENDIF
137870950102     C*
137880950102   X2C                   ELSE
137890950102     C* TAMFVD = '3' ASSUME SEMPRE IMPORTO DA ASSICURARE: DA NON INSER
137900950102    3C     TAMFVD        IFEQ      '3'
137910950102     C                   MOVEL     ERR(108)      VIDMSG
137920950102     C                   SETON                                        8490
137930950102     C                   GOTO      ENDC02
137940950102    3C                   ENDIF
137950950102    2C                   ENDIF
137960950102    1C                   ENDIF
137970950102     c* TARIFFA A QUANTITA'
137980950102     C     W001A         IFEQ      '5'
137990950102     C     VIDQFT        ANDEQ     0
138000950102     C                   MOVEL     ERR(109)      VIDMSG
138010950102     C                   SETON                                        8490
138020950102     C                   GOTO      ENDC02
138030950102    3C                   ENDIF
138040940922     C***
138050940922     C*** VALORE MERCE DICHIARATO ***
138060940922     C*
138070011113     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
138080011113     C     VIDVMD        IFGT      *ZEROS
138090011113     C     VIDVAD        ANDEQ     *BLANKS
138100011113     C                   MOVEL     ERR(169)      VIDMSG
138110011113     C                   SETON                                        6990
138120011113     C                   GOTO      ENDC02
138130011113     C                   ENDIF
138140021118
138150021118      * Se Spedizione Export EuroExpress con ddt "S"
138160021118      *  ---> Obbligatorio il valore merce
138170021118     c                   If        SavGdd = 'S' and VidVmd = *Zeros
138180021118     c                             and a_§OgNtw = 'EEX'
138190021118     c                   Movel     Err(259)      VidMsg
138200021118     c                   Eval      *In82 = *On
138210021118     c                   Eval      *In90 = *On
138220021118     c                   Goto      Endc02
138230021118     c                   EndIf
138240011113     C*
138250940922     C                   MOVEL     VIDVAD        WVLT
138260940922     C                   Z-ADD     VIDVMD        W0133            13 3
138270940922     C* CONTROLLO LA DIVISA
138280940922     C                   EXSR      CTRVLT
138290940922     C                   MOVEL     WVLT          VIDVAD
138300940922     C* ERRORE
138310950410     C   90              SETON                                        69
138320940922     C*
138330940928    1C     WEMFOR        IFEQ      '1'
138340940922     C                   GOTO      ENDC02
138350940928    1C                   ENDIF
138360011113     C*
138370011113     C* CONTROLLO SCADENZA DIVISA
138380011113     C     BLPDSP        IFGT      §CVDLI
138390011113     C     VIDVMD        ANDNE     0
138400011113     C                   MOVEL     ERR(232)      VIDMSG
138410011113     C                   SETON                                        6990
138420011113     C                   GOTO      ENDC02
138430011113     C                   ENDIF
138440941219     C*
138450950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
138460941219     C* INDICATORE DI CHANGE 88 ON
138470941219    2C     VARVAD        IFNE      VIDVAD
138480950120     C     WIN88         ANDEQ     *BLANKS
138490011113     C     VIDVMD        ANDNE     0
138500941220     C                   MOVEL     ERR(105)      VIDMSG
138510941231     C                   SETON                                        8290
138520941219     C                   GOTO      ENDC02
138530941219     C                   ENDIF
138540941219     C*
138550941219     C                   MOVEL     VIDVAD        VARVAD
138560950120     C                   CLEAR                   WIN88
138570011212      * pulisco il flag x la forzatura valore merce
138580011212     C     VIDVMD        IFNE      WARVMD
138590011212     C                   CLEAR                   FORVMD
138600050714     c                   Clear                   forzavmd          1
138610011212     C                   Z-ADD     VIDVMD        WARVMD
138620011212     C                   ENDIF
138630011212     C* CONTROLLO LIMITI
138640011212     C                   CLEAR                   DSUL23
138650011212     C                   MOVEL     VIDCBO        I23CBO
138660011212     C     VIDTSP        IFNE      *BLANKS
138670011212     C                   MOVEL     VIDTSP        I23TSP
138680011212     C                   ELSE
138690011212     C                   MOVEL     COMTSP        I23TSP
138700011212     C                   ENDIF
138710011212     C                   Z-ADD     VIDLNP        I23LNP
138720011212     C                   MOVEL     VIDNZM        I23NZM
138730011212     C                   Z-ADD     COMLNA        I23LNA
138740011212     C                   MOVEL     VIDNZD        I23NZD
138750011212     C     *IN04         IFEQ      *ON
138760011212     C                   Z-ADD     9999          I23KSC
138770011212     C                   MOVEL     VIDLNP        I23KSC
138780011212     C                   ELSE
138790011212     C                   Z-ADD     VIDCCM        I23KSC
138800011212     C     VIDFLC        IFEQ      0
138810011212     C                   MOVEL     VIDLNP        I23KSC
138820011212     C                   ELSE
138830011212     C                   MOVEL     VIDFLC        I23KSC
138840011212     C                   ENDIF
138850011212     C                   ENDIF
138860011212     C                   MOVEL     VIDCTR        I23CTR
138870011212     C                   Z-ADD     VIDVMD        I23IMP
138880011212     C                   MOVEL     VIDVAD        I23DIV
138890011212     C                   MOVEL     KNMUS         I23UTE
138900011212     C                   MOVEL     NOMPGM        I23PGM
138910011212     C                   CALL      'TRUL23R'
138920011212     C                   PARM                    DSUL23
138930011212     C* IMPORTO INFERIORE AL LIMITE MINIMO
138940011212    1C     O23FMN        IFNE      *BLANKS
138950011212     C* Il messaggio è diverso a seconda che l'importo passato sia 0
138960011212     C* O > 0
138970011212    2C     VIDVMD        IFEQ      *ZEROS
138980011212     C                   MOVEL     ERR(238)      VIDMSG
138990011212   x2C                   ELSE
139000011212     C                   MOVEA     ERR(239)      K78
139010011212     C                   MOVE      O23LMN        WNUMED
139020011212     C* richiamo routine per editare il limite
139030011212     C                   EXSR      CALLXE
139040011212      * metto il numero editato nel campo del messaggio
139050011212     C                   MOVEA     W014A         SKII(1)
139060011212     C                   MOVEA     SKII(1)       K78(37)
139070011212     C                   MOVEA     K78           VIDMSG
139080011212    2C                   ENDIF
139090011212     C                   SETON                                        8290
139100011212     C                   GOTO      ENDC02
139110011212    1C                   ENDIF
139120011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO BLOCCANTE
139130011212     C     O23FX2        IFNE      *BLANKS
139140011212     C                   MOVEA     ERR(240)      K78
139150011212     C                   MOVE      O23LX2        WNUMED
139160011212     C* richiamo routine per editare il limite
139170011212     C                   EXSR      CALLXE
139180011212      * metto il numero editato nel campo del messaggio
139190011212     C                   MOVEA     W014A         SKII(1)
139200011212     C                   MOVEA     SKII(1)       K78(53)
139210011212     C                   MOVEA     K78           VIDMSG
139220011212     C                   SETON                                        8290
139230011212     C                   GOTO      ENDC02
139240011212     C                   ENDIF
139250011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO FORZABILE
139260011212     C     O23FX1        IFNE      *BLANKS
139270011212     C     FORVMD        ANDEQ     *BLANKS
139280011212     C                   MOVE      '1'           FORVMD            1
139290011212     C                   MOVEA     ERR(241)      K78
139300011212     C                   MOVE      O23LX1        WNUMED
139310011212     C* richiamo routine per editare il limite
139320011212     C                   EXSR      CALLXE
139330011212      * metto il numero editato nel campo del messaggio
139340011212     C                   MOVEA     W014A         SKII(1)
139350011212     C                   MOVEA     SKII(1)       K78(30)
139360011212     C                   MOVEA     K78           VIDMSG
139370011212     C                   SETON                                        8290
139380011212     C                   GOTO      ENDC02
139390011212     C                   ENDIF
139400950410     C* SE IMP ASSICURARE E VAL MERCE HANNO STESSO IMPORTO--> DEVONO
139410950410     C*  AVERE  ANCHE STESSA DIVISA E VICEVERSA
139420050714      * msg forzabile
139430950410    1C     VIDVMD        IFGT      0
139440950410     C*
139450950410     C     VIDIAS        IFEQ      VIDVMD
139460950410     C     VIDVAD        ANDNE     VIDVAS
139470050714     c     forzavmd      andeq     *Blanks
139480050714     c                   Eval      vidmsg = ERR(122)
139490950410     C                   SETON                                        6990
139500050714     c                   Eval      forzavmd = '1'
139510950410     C                   GOTO      ENDC02
139520950410    2C                   ENDIF
139530950410     C     VIDVAD        IFEQ      VIDVAS
139540950410     C     VIDIAS        ANDGT     0
139550950410     C     VIDIAS        ANDNE     VIDVMD
139560050714     c     forzavmd      andeq     *Blanks
139570050714     c                   Eval      vidmsg = ERR(122)
139580950410     C                   SETON                                        8290
139590050714     c                   Eval      forzavmd = '1'
139600950410     C                   GOTO      ENDC02
139610950410    2C                   ENDIF
139620950410     C*
139630950410    1C                   ENDIF
139640940913     C***
139650930329     C*** CONSEGNA RICHISTA ***
139660090901     c*  non accetto la consegna richiesta se tipo servizio H
139670150202     c                   if        (viddcr>0 or vidhcr>0) and vidtsp='H'
139680090901     C                   MOVEL     ERR(60)       VIDMSG
139690090901     C                   SETON                                        5990
139700090901     c                   goto      endc02
139710090901     c                   endif
139720090901     c
139730941115     C                   Z-ADD     VIDDCR        WDCR
139740941115     C                   Z-ADD     VIDHCR        WHCR
139750941115     C                   Z-ADD     VIDMCR        WMCR
139760940913     C                   MOVEL     VIDTCR        WTCR
139770940913     C                   EXSR      CTRCR
139780940916     C                   MOVEL     WDCR          VIDDCR
139790940920     C   90              GOTO      ENDC02
139800101022     c
139810101022     c* Controllo se cade in giorno festivo col calendario arrivi
139820101022    1c                   if        vidtcr=' '  and viddcr>0
139830101022     c                   movel     comdcr        wdata
139840101022     c                   clear                   w0030
139850101022     C     KCLNa         CHAIN     AZCLN01L                           30
139860101022     C   30              CLEAR                   CLNPOM
139870101022     C                   MOVEA     CLNPOM        K31
139880101022     C                   MOVEL     K31(WGG)      WFEST
139890101022     c     wfest         lookup    S1Y                                    30
139900101022     c
139910101022     c                   if        *in30 and wfest<>' '
139911141124     c                   select
139912141124     c                   when      a_§ogntw<>'FED' and a_§ogntw<>'DPD'
139913141124     c                             and a_§ogntw<>'EEX'
139920101022     C                   MOVEL     ERR(197)      VIDMSG
139930101022     C                   SETON                                        5990
139940101022     C                   GOTO      ENDC02
139941141124     c                   when      comlna<>wforz_lna
139942141124     c                   eval      wforz_lna=comlna
139943141124     C                   MOVEL     ERR(197)      VIDMSG
139944141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
139945141124     C                   SETON                                        5990
139946141124     C                   GOTO      ENDC02
139947141124     c                   endsl
139950101022    2C                   ENDIF
139960101022    1C                   ENDIF
139970940916     C***
139980960319     C*** GIORNI DI CHIUSURA ***
139990960319     C                   MOVEL     VIDGC1        WGC1
140000960319     C                   MOVEL     VIDGC2        WGC2
140010960319     C                   EXSR      CTRGCH
140020960319     C   90              GOTO      ENDC02
140030940214     C*
140040100219     c
140050940919     C***
140060940919     C*** PARTICOLARITA' C/A ***
140070940919    1C     VIDGCA        IFNE      *BLANKS
140080941005     C     VIDGCR        ORNE      *BLANKS
140090031029      * salto questo controllo
140100031029      * xchè per ora la particolarità c/a non deve essere gestita
140110031029     c                   GoTo      DopoMsg
140120940922     C*
140130940922     C* non posso indicarla se tipo bolla non prevede C/Assegno
140140940928    2C     §3AFCA        IFEQ      0
140150941005     C     VIDGCA        ANDNE     *BLANKS
140160940922     C                   SETON                                        6590
140170940922     C                   MOVEL     ERR(103)      VIDMSG
140180940922     C                   GOTO      ENDC02
140190940922    2C                   ENDIF
140200031029     c     DopoMsg       Tag
140210940922     C*
140220941005     C* RICHIAMO IL PRG DI RICERCA
140230941005    2C     VIDGCR        IFEQ      '?'
140240031029      * non devo fare nessuna ricerca xchè per ora la particolarità c/a non
140250031029      * deve essere gestita
140260031029     c                   GoTo      DopoRicGca
140270941005     C                   CLEAR                   DS7PQR
140280941005     C                   MOVEL     'S'           DS7RIC
140290941005     C                   MOVEL     'V'           DS7GES
140300941005     C                   MOVEL     WKSC          DS7KSC
140310941005     C                   MOVEL     VIDGCA        DS7COD
140320941005     C                   MOVEL     DS7PQR        KPJBU
140330941005     C                   CALL      'TRTB72R'
140340941005     C                   PARM                    KPJBA
140350941005     C                   MOVEL     KPJBU         DS7PQR
140360111110     C***                CLEAR                   VIDGCR
140370941005     C*
140380941005     C     VIDGCA        IFEQ      *BLANKS
140390941005     C                   MOVEL     DS7COD        VIDGCA
140400941005    2C                   ENDIF
140410941005     C*
140420111110     c     DopoRicGca    Tag
140430111110     C                   CLEAR                   VIDGCR
140440960109     C                   SETON                                        65
140450941005     C                   MOVEL     '1'           WEMFOR
140460111110     c***  DopoRicGca    Tag
140470941005     C                   GOTO      ENDC02
140480941005    2C                   ENDIF
140490941005     C* CONTROLLO
140500031029      * non devo fare nessun controllo xchè per ora la particolarità c/a non
140510031029      * deve essere gestita
140520031029      * ma se immessa emetto un errore
140530031029     c                   Eval      VidMsg = Err(31)
140540031029     c                   Eval      *In65 = *On
140550031029     c                   Eval      *In90 = *On
140560031029     c                   Goto      EndC02
140570031029
140580941005     C                   CLEAR                   DS7PQR
140590941005     C                   MOVEL     'S'           DS7RIC
140600941005     C                   MOVEL     'C'           DS7GES
140610941005     C                   MOVEL     WKSC          DS7KSC
140620941005     C                   MOVEL     VIDGCA        DS7COD
140630941005     C                   MOVEL     DS7PQR        KPJBU
140640941005     C                   CALL      'TRTB72R'
140650941005     C                   PARM                    KPJBA
140660941005     C                   MOVEL     KPJBU         DS7PQR
140670941005     C* ERRORE
140680941005    2C     DS7ERR        IFEQ      '1'
140690941005     C                   MOVEL     DS7MSG        VIDMSG
140700941005     C                   SETON                                        6590
140710940920     C                   GOTO      ENDC02
140720940919    2C                   ENDIF
140730940922     C*
140740940922    1C                   ENDIF
140750940919     C***
140760940919     C*** PARTICOLARITA' GIACENZA ***
140770940919    1C     VIDGGA        IFNE      *BLANKS
140780941005     C     VIDGGR        ORNE      *BLANKS
140790941005     C*
140800941005     C* RICHIAMO IL PRG DI RICERCA
140810951120    2C     VIDGGR        IFEQ      '?'
140820941005     C                   CLEAR                   DS7PQR
140830941005     C                   MOVEL     'S'           DS7RIC
140840941005     C                   MOVEL     'V'           DS7GES
140850941005     C                   MOVEL     VIDGGA        DS7COD
140860941005     C                   MOVEL     DS7PQR        KPJBU
140870941005     C                   CALL      'TRTB69R'
140880941005     C                   PARM                    KPJBA
140890941005     C                   MOVEL     KPJBU         DS7PQR
140900960109     C                   CLEAR                   VIDGGR
140910941005     C*
140920941005     C     VIDGGA        IFEQ      *BLANKS
140930941005     C                   MOVEL     DS7COD        VIDGGA
140940941005    2C                   ENDIF
140950941005     C*
140960960109     C                   SETON                                        66
140970941005     C                   MOVEL     '1'           WEMFOR
140980941005     C                   GOTO      ENDC02
140990941005    2C                   ENDIF
141000941005     C* CONTROLLO
141010941005     C                   CLEAR                   DS7PQR
141020941005     C                   MOVEL     'S'           DS7RIC
141030941005     C                   MOVEL     'C'           DS7GES
141040941005     C                   MOVEL     WKSC          DS7KSC
141050941005     C                   MOVEL     VIDGGA        DS7COD
141060941005     C                   MOVEL     DS7PQR        KPJBU
141070941005     C                   CALL      'TRTB69R'
141080941005     C                   PARM                    KPJBA
141090941005     C                   MOVEL     KPJBU         DS7PQR
141100941005     C* ERRORE
141110941005    2C     DS7ERR        IFEQ      '1'
141120941005     C                   MOVEL     DS7MSG        VIDMSG
141130941005     C                   SETON                                        6690
141140940920     C                   GOTO      ENDC02
141150940919    2C                   ENDIF
141160940919    1C                   ENDIF
141170940919     C***
141180940919     C*** PARTICOLARITA' CONSEGNA ***
141190100218     c                   clear                   ds7r
141200940922    1C     VIDGMA        IFNE      *BLANKS
141210951120     C     VIDGMR        ORNE      *BLANKS
141220941005     C* RICHIAMO IL PRG DI RICERCA
141230941005    2C     VIDGMR        IFEQ      '?'
141240941005     C                   CLEAR                   DS7PQR
141250941005     C                   MOVEL     'S'           DS7RIC
141260941005     C                   MOVEL     'V'           DS7GES
141270941005     C                   MOVEL     VIDGMA        DS7COD
141280941005     C                   MOVEL     DS7PQR        KPJBU
141290941005     C                   CALL      'TRTB70R'
141300941005     C                   PARM                    KPJBA
141310941005     C                   MOVEL     KPJBU         DS7PQR
141320960109     C                   CLEAR                   VIDGMR
141330941005     C*
141340941005     C     VIDGMA        IFEQ      *BLANKS
141350941005     C                   MOVEL     DS7COD        VIDGMA
141360941005    2C                   ENDIF
141370941005     C*
141380960109     C                   SETON                                        67
141390941005     C                   MOVEL     '1'           WEMFOR
141400941005     C                   GOTO      ENDC02
141410941005    2C                   ENDIF
141420941005     C* CONTROLLO
141430941005     C                   CLEAR                   DS7PQR
141440941005     C                   MOVEL     'S'           DS7RIC
141450941005     C                   MOVEL     'C'           DS7GES
141460941005     C                   MOVEL     WKSC          DS7KSC
141470941005     C                   MOVEL     VIDGMA        DS7COD
141480941005     C                   MOVEL     DS7PQR        KPJBU
141490941005     C                   CALL      'TRTB70R'
141500941005     C                   PARM                    KPJBA
141510941005     C                   MOVEL     KPJBU         DS7PQR
141520941005     C* ERRORE
141530941005    2C     DS7ERR        IFEQ      '1'
141540100215     C                   MOVEL     DS7MSG        VIDMSG
141550941005     C                   SETON                                        6790
141560940920     C                   GOTO      ENDC02
141570940919    2C                   ENDIF
141580100215     c*
141590100215     c* Da tabella 7R verifico se prevede il calcolo della consegna
141600100215     c*  richeista (Tab DCR) e segnalo eventuali incongruenze
141610100215     C                   MOVEL     '7R'          COD
141620100215     C                   MOVEL(P)  VIDGMA        KEY
141630100215     C                   EXSR      CTABEL
141640100215     C                   MOVEL     TBLUNI        DS7R
141650100215     c
141660100215     c                   if        §7ratt ='S' and
141670100215     c                             (vidtsp='H' or vidtsp='E')
141680100215     C                   MOVEL     err(332)      VIDMSG
141690100215     C                   SETON                                        6790
141700100215     C                   GOTO      ENDC02
141710100215    2C                   ENDIF
141720100218     c
141730100224    1c                   if        §7ratt ='S' and
141740100217     c                             (vidore>0 or viddcr>0 )
141750100218     c* In manutenzione non do errore se la particolarità c'era
141760100218     c*  anche prima
141770100224     c* Se richiamato da pgm di cambio porto dirottamento non do errore
141780100224     c                   if        not *in44 and (not *in12 or *in15 or
141790100224     c                              blpgma<>vidgma)
141800100215     C                   MOVEL     err(333)      VIDMSG
141810100215     C                   SETON                                        6790
141820100215     C                   GOTO      ENDC02
141830100215    2C                   ENDIF
141840100224    1C                   ENDIF
141850100218     c
141860100224     c                   if        §7ratt ='S' and (§3arbl='R' or
141870100224     c                             §3arbl='C' and §3aucb=' ')
141880100217     C                   MOVEL     err(334)      VIDMSG
141890100217     C                   SETON                                        6790
141900141201c    C                   GOTO      ENDC02
141910100217    2C                   ENDIF
141920100215     c
141930030805      * Se la bolla prevede la particolarità consegne 'RC' devo controllare
141940030805      * che esista l'ORM da utilizzare per il ritiro contestuale alla consegna
141950030912      * solo se non sono chiamata da giacenze
141960100604If  2c**                 If        VidGma = 'RC' and
141970100604If  2c                   If        §7rRC = 'S'   and
141980030912If  2c                             savfpr <> 'G' and savfpr <> 'P'
141990031217     c                   Eval      wope = 'C'
142000030805     c                   ExSr      Sr_RicOrm
142010030805If  3c                   If        *In90 = *On
142020030805     c                   GoTo      EndC02
142030030805    3c                   EndIf
142040030805    2c                   EndIf
142050940919    1C                   ENDIF
142060100219     c
142061141201     c* Controlli Congruenza fra PinCode e Codice Particolarità
142062141201     c* se bolla export errore forzabile se presente particolartià che
142063141201     c* prevede PIN Code
142064141201     c                   if        A_§ogntw='FED' or
142065141201     c                             a_§ogntw='EEX' or
142066141201     c                             a_§ogntw='DPD'
142067141201     c                   if        §7rpincode='S' and WforzPCExp=' '
142068141201     c                   eval      WforzPCExp='1'
142069141201     c                   seton                                        6790
142070141201     C                   MOVEL     err(352)      VIDMSG
142071141201     c                   GoTo      EndC02
142072141201     c                   endif
142073141201     c                   else
142074141201     c* Controlli per bolla NON Export
142075141202     c* non eseguo questi controlli se provengo da pgm giacenze
142076141202     c                   if        not *in44
142077141201     c                   select
142078141201     c                   when      wpincode<>*blanks and  (
142079141201     c                             (vidgma=*blanks) or
142080141201     c                             (vidgma<>*blanks and §7rpincode<>'S'))
142081141201     c                   seton                                        6790
142082141201     C                   MOVEL     err(353)      VIDMSG
142083141201     c                   GoTo      EndC02
142084141201     c                   when      wpincode=*blanks and vidgma<>*blanks
142085141201     c                             and §7rpincode='S'
142086141201     c                   seton                                        6790
142087141201     C                   MOVEL     err(354)      VIDMSG
142088141201     c                   GoTo      EndC02
142089141201     c                   endsl
142090141202     c* se provengo da pgm giacenze controllo che non si modifichi la particola-
142091141202     c* rità giacenza rispetto a quella passata da "pin code" a "no pin code"
142092141202     c* o viceversa
142093141202     c                   else
142094141202     c                   if        vidgma<>§lpgma and
142095141202     c                             w7rPC<>§7rpincode
142096141202     c                   seton                                        6790
142097141202     C                   MOVEL     err(357)      VIDMSG
142098141202     c                   GoTo      EndC02
142099141202     c                   endif
142100141202     c                   endif
142101141201     c                   endif
142102141201     c*
142103100219     C* DATA CONSEGNA NON PUO' ESSERE < DATA CONSEGNA TEORICA
142104100219     C* SE TIPO CONSEGNA E' ' ' O 'P' (IL O PRIMA DEL)
142105100219     C* (QUESTO CONTROLLO LO METTO DOPO I GIORNI CHIUSURA e dopo la partic.
142106100219     C*  consegna perchè mi SERVONO E CORRETTI)
142110100219     c* data consegna non puo' essere > data consegna teorica più i gio
142120100219     c* rni di tolleranza oltre delivery come da tabella vpo
142130100219    1C     VIDDCR        IFGT      0
142140100219     C* CALL AL TNSD99
142150100219     c                   clear                   UsaCass
142160100219     C                   EXSR      CLSE98
142170100219     c                   z-add     d98dce        s_d98dce
142180100219   1aC     VIDTCR        ifne      'D'
142190100219     C*
142200100219    2C     COMDCR        IFLT      D98DCE
142210100219     c* se tipo servizio "Distribuzione" richiamo nuovamente TNSD99R passand
142220100219     c* ogli tipo servizio corriere. Infatti se la data consegna richiesta
142230100219     c* è inferiore anche della data teorica per il servizio corriere l'erro
142240100219     c* re è bloccante altrimenti è forzabile
142250100219    3c                   if        d98tsp = 'D'
142260100219     c                   eval      d98tsp = 'C'
142270100219     C                   CALL      'TNSD99R'
142280100219     C                   PARM                    DSSD99
142290100219    4c     comdcr        ifge      d98dce
142300100219    5c     uno           ifne      '1'
142310100219     C                   MOVEL     ERR(62)       VIDMSG
142320100219     C                   seTON                                        5990
142330100219     C                   MOVEL     '1'           UNO
142340100219     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
142350100219     C                   GOTO      ENDC02
142360100219    5c                   endif
142370100219   x4c                   else
142380100219     C                   MOVEL     ERR(62)       VIDMSG
142390100219     C                   SETON                                        5990
142400100219     c                   goto      endc02
142410100219    4c                   endif
142420100219   x3c                   else
142430100219     C                   MOVEL     ERR(62)       VIDMSG
142440100219     C                   SETON                                        5990
142450100219     C                   GOTO      ENDC02
142460100219    3c                   endif
142470100219    2C                   ENDIF
142480100219   1aC                   ENDIF
142490100219     c** Aggiungo alla data consegna teorica i giorni previsti in tabella
142500100219      *  escludendo i festivi
142510100219      *  questo messaggio non lo do per particolarità di ATTESA
142520100219    2c                   if        vidgma= *blanks  or  §7rATT=' '
142530100219     c                   Clear                   Trul13ds
142540100219     c                   Eval      tI13Tla = 'L'
142550100219     c                   Eval      I13Mod = 'A'
142560100219     c                   Eval      I13Fil = comlna
142570100219     c                   Eval      I13Din = S_d98dce
142580100219     c                   Eval      I13gio = §vpodcrod
142590100219     c                   Call      'TRUL13R'
142600100219     c                   Parm                    Trul13ds
142610100219    3c                   If        tO13Err = *Blanks  and
142620100219     c                             comdcr > o13dfi and fordcr = *blanks
142630100219     c                   eval      vidmsg = err(294)
142640100219     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
142650100219     c                             %trim(%editc(§vpodcrod:'Z'))  +
142660100219     c                             ' giorni la data consegna teorica.' +
142670100219     c                             'ENTER x FORZ.'
142680100219     C                   SETON                                        5990
142690100219     c                   movel     '1'           fordcr
142700100219     C                   GOTO      ENDC02
142710100219    3c                   endif
142720100219    2C                   ENDIF
142730100219    1C                   ENDIF
142740100219     c
142750050415     c* Se particolarita varia = 'O' il controllo seguente l'ho già
142760050415     c* fatto prima del calcolo del volume automatico
142770050415     c                   if        %subst(vidgva:1:1)<>'O'
142780050415     c                   exsr      sr_CntPVBan
142790050415     c     wemfor        ifeq      '1'
142800050415     c                   goto      endc02
142810050415     c                   endif
142820050415     c                   endif
142830040216
142840040216      * --> Telefono del destinatario
142850040216      *     (da immettere in prima videata)
142860040216      * x Spedizione con Appuntamento
142870040216      * x Spedizione con consegna a PRIVATI
142880040216if  1c                   If        VidTel = *Blanks and wforza1 = *Off and
142890150213     c                             wforza2 = *Off and not *in12
142900040216s   2c                   Select
142910040216     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
142920040216     c                   Eval      VidMsg = Err(267)
142930040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
142940040216     c                   Eval      *In90 = *On
142950040216     c                   When      %subst(VidGva:1:1) = 'P'
142960040216     c                   Eval      VidMsg = Err(58)
142970040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
142980040216     c                   Eval      *In90 = *On
142990040216    2c                   EndSl
143000040216if  2c                   If        *In90
143010040216     c                   Eval      wforza2 = *On
143020040216     c                   GoTo      EndC02
143030040216    2c                   EndIf
143040040216    1c                   EndIf
143050040610     C***
143060040610     C*** Tipo MERCE V-Valore ***
143070040610    1C     VIDbva        ifne      *BLANKS
143080040610     c     §1bfg8        andne     'S'
143090040610     C                   MOVEL     ERR(281)      VIDMSG
143100040610     C                   SETON                                        90
143110040610     c                   z-add     20            H2riga
143120040610     c                   z-add     80            H2colo
143130040610     C                   GOTO      ENDC02
143140040610    1C                   END
143150940919     C***
143160050309     c*
143170050309     c* Essendosi verificato un caso di bolla immessa senza il cod boll
143180050309     c* per sicurezza aggiungo il seguente controllo
143190050309     c     vidcbo        ifeq      *blanks
143200050309     C                   MOVEL     ERR(292)      VIDMSG
143210050309     C                   SETON                                        90
143220050309     C                   GOTO      ENDC02
143230050309     c                   endif
143240940919     C*** FINE SUBROUTINE
143250940920     C     ENDC02        TAG
143260940826     C   90              MOVEL     '1'           WEMFOR
143270941021     C*
143280940826     C                   ENDSR
143290091211     C* Richiamo trulticr per controllo tipo incasso c/a e divisa  ---*
143300091211     c     sr_trultic    begsr
143310091211     c                   clear                   trulticds
143320091211     c                   clear                   ds1a
143330091211     c                   eval      iticTBO='P'
143340091211     c                   eval      iticlnp=vidlnp
143350091211     c                   eval      iticlna=comlna
143360091211     c                   eval      iticlnantw=A_§ogntw
143370091211     c                   eval      iticnzd=vidnzd
143380091211     c                   eval      iticprd=vidprd
143390091211     c                   eval      iticcad=vidcad
143400091211     c                   eval      iticlod=vidlod
143410091211     c                   eval      iticind=vidind
143420091211     c                   eval      iticrsd=vidrsd
143430091211     c                   eval      iticdsp=blpdsp
143440091211     c* se orm con triangolazione e beneficiario ordinante-->passo ordinante
143450091211     c* altrimenti sempre il mittente
143460091211     c                   if        nochkticC=*on and wcassel2='X'
143470091211     C                   eval      iticccm=ormksc
143480091211     c                   else
143490091211     C                   eval      iticccm=wksc
143500091211     c                   endif
143510091211
143520091211     c                   eval      itictic=vidtic
143530091211     c                   eval      iticdiv=vidvca
143540091211     c                   eval      iticcas=vidcas
143550091211     c                   eval      iticpgm='FNLS01R'
143560091211     c* 44 on = richiamato da pgm giacenze --> devo passare
143570091211     c*         l'info a trultic per far si che venga bypassato il
143580091211     c*         controllo su tabella "TM"
143590091211    2c                   if        *in44
143600091211     c                   eval      %subst(iticpgm:10:1)='1'
143610091211    2c                   endif
143620091211     c                   call      'TRULTICR'
143630091211     c                   parm                    TRULTICDS
143640091211     c                   parm                    ds1a
143650091211     c*
143660091211     c                   endsr
143670091211     c*
143680091211     C* Impostazinoe flag per controllo tic --------------------------*
143690091211     C     sr_impochktic BEGSR
143700091211     C*
143710091214     c                   eval      nochkticC=*off
143720091211     c                   if        dateu>=§vpocas
143730091211     c                   if        §3afca<>0 and flgfit<>'S' and ormpag='O'
143740091211     c                             and §1amro<>'S'
143750091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
143760091211     c                                 %editc(ormksc:'X')
143770091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
143780091211     c                                 %subst(%editc(ormcor:'X'):1:7)
143790091211     c                   eval      nochkticC=*on
143800091211     c                   endif
143810091211     c                   endif
143820091211     c                   endsr
143830940922     C*
143840940922     C* CONTROLLO DIVISA ---------------------------------------------*
143850940922     C     CTRVLT        BEGSR
143860940922     C*
143870940922     C                   MOVEL     'CV'          COD
143880940922     C* RICERCA
143890940922     C     '?'           SCAN      WVLT                                   30
143900940922     C     *IN30         IFEQ      *ON
143910940922     C                   EXSR      CX§TAB
143920940922     C                   MOVEL     §KEY          WVLT
143930940922     C                   GOTO      ENDVLT
143940940922     C                   ENDIF
143950940922     C*
143960940922     C* CONTROLLO DIVISA
143970940922     C                   MOVEL(P)  WVLT          KEY
143980940922     C                   EXSR      CTABEL
143990940922     C* ERRORE
144000940922    1C     *IN30         IFEQ      *ON
144010941110     C                   MOVEL     ERR(79)       VIDMSG
144020940922     C                   SETON                                        90
144030940922     C                   GOTO      ENDVLT
144040940922    1C                   ENDIF
144050940922     C                   MOVEL     TBLUNI        DSCV
144060940922     C*
144070940922     C* VEDO SE AMMESSI IMPORTI DECIMALI NELL'IMPORTO
144080940922    1C     §CVFDC        IFNE      'S'
144090940922     C                   MOVE      W0133         W0033             3 3
144100940922    2C     W0033         IFNE      0
144110941110     C                   MOVEL     ERR(78)       VIDMSG
144120940922    2C                   ENDIF
144130991025      *
144140991025   X1C                   ELSE
144150991025      * VERIFICO SE I DECIMALI INSERITI SONO QUELLLI AMMESSI
144160991025     C                   SELECT
144170991025     C     §CVDEC        WHENEQ    3
144180991025     C     §CVDEC        WHENEQ    2
144190991025     C                   MOVE      W0133         W0010             1 0
144200991025     C     W0010         IFNE      *ZEROS
144210991025     C                   MOVEL     ERR(171)      VIDMSG
144220991025     C                   ENDIF
144230991025     C     §CVDEC        WHENEQ    1
144240991025     C                   MOVE      W0133         W0020             2 0
144250991025     C     W0020         IFNE      *ZEROS
144260991025     C                   MOVEL     ERR(171)      VIDMSG
144270991025     C                   ENDIF
144280991025     C     §CVDEC        WHENEQ    0
144290991025     C                   ENDSL
144300991025      *
144310991025    1C                   ENDIF
144320991025      *
144330991025     C     VIDMSG        IFNE      *BLANKS
144340991025     C                   SETON                                        90
144350991025     C                   GOTO      ENDVLT
144360991025     C                   ENDIF
144370940922     C*
144380940922     C     ENDVLT        TAG
144390940922     C   90              MOVEL     '1'           WEMFOR
144400940922     C                   ENDSR
144410940916     C*
144420940916     C* PREPARA IL MESSAGGIO DI SEGNACOLLO DOPPIO -------------------*
144430940916     C     PRPMSG        BEGSR
144440940916     C* MUOVO LA SKIERA DELL ERRORE
144450940916     C                   MOVEA     ERR(92)       K78
144460940916     C*
144470940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL SEGNACOLLO
144480940916     C                   MOVEL     COMSCD        W007A             7
144490950718     C                   MOVEA     W007A         SKI(9)
144500950718     C                   Z-ADD     9             I                 3 0
144510950718     C                   EXSR      ABBL
144520940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
144530950718     C                   MOVEA     SKI(9)        K78(19)
144540940916     C* IMPOSTO L'ANNO
144550120828     C                   MOVE      BLTAAS        W004A             4
144560120828     C***                MOVE      ARTAAS        W004A             4
144570940916     C                   MOVEA     W004A         K78(52)
144580940916     C* LINEA DI PARTENZA
144590120828     C                   MOVEL     BLTLNP        W003A             3
144600120828     C***                MOVEL     ARTLNP        W003A             3
144610940916     C                   MOVEA     W003A         K78(57)
144620940916     C* SERIE
144630120828     C     BLTNRS        IFEQ      00
144640120828     C***  ARTNRS        IFEQ      00
144650940916     C                   MOVEA     '  '          K78(61)
144660940916     C                   ELSE
144670120828     C                   MOVEL     BLTNRS        W002A             2
144680120828     C***                MOVEL     ARTNRS        W002A             2
144690940916     C                   MOVEA     W002A         K78(61)
144700940916     C                   ENDIF
144710940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL NUM.SPEDIZIONE
144720120828     C                   MOVEL     BLTNSP        W007A
144730120828     C***                MOVEL     ARTNSP        W007A
144740950718     C                   MOVEA     W007A         SKI(9)
144750950718     C                   Z-ADD     9             I
144760950718     C                   EXSR      ABBL
144770940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
144780950718     C                   MOVEA     SKI(9)        K78(64)
144790940916     C* LINEA DI ARRIVO
144800120828     C                   MOVEL     BLTLNA        W003A             3
144810120828     C***                MOVEL     ARTLNA        W003A             3
144820940916     C                   MOVEA     W003A         K78(76)
144830940916     C*
144840940916     C* MUOVO LA SKIERA NEL MESSAGGIO
144850940916     C                   MOVEA     K78           VIDMSG
144860940922     C                   SETON                                        45
144870940916     C                   ENDSR
144880960318     C*
144890960318     C* CONTROLLO SE SPEDIZIONE CON COLLI > DEL PREVISTO-------------*
144900960318     C     CTRCRG        BEGSR
144910960318    1C     VIDNCL        IFGT      §3INCL
144920030704      * Se devo bancalare i colli emetto la finestra
144930030704     c                   Clear                   w03rig1
144940030704     c                   Clear                   w03rig2
144950030704     c                   Eval      w03rig1 =
144960030704     c                                      'Attenzione numero colli +
144970030704     c                                       superiore a'
144980030704     c                   Eval      w03rig1 =
144990030704     c                                      %trim(w03rig1) + ' ' +
145000030704     c                                      %trim(%editc(§3iNcl:'4'))
145010030704     c                   Eval      w03rig2 =
145020030704     c                                      'Bancalare i colli prima di +
145030030704     c                                       bollettare'
145040030704     c                   Eval      At3c01 = nodi
145050030704     c                   Eval      At3cor = ndpr
145060030704     c                   Eval      At3c02 = nodi
145070030704     c                   Eval      At3csf = ndpr
145080030704     c                   Eval      At3f12 = nodi
145090030704     c                   Do        *Hival
145100030704     c                   Exfmt     Ls01w03
145110030704     c                   Eval      *In41 = *On
145120030704     c                   Eval      wforw03 = '1'
145130030704     c   kf              Leave
145140030704     c                   EndDo
145150030704
145160960318    1C                   ENDIF
145170960318     C                   ENDSR
145180030704      *---------------------------------------------------------------*
145190030704      * Emetto window x colli originali + controlli
145200030704      *---------------------------------------------------------------*
145210030704     c     Sr_Over25     BegSr
145220030704
145230030704     c                   Clear                   w03rig1
145240030704     c                   Clear                   w03rig2
145250030704     c                   Eval      w03rig1 =
145260030704     c                             'Spedizione con colli bancalati'
145270030704     c                   If        *In12 and Not *In15
145280030704     c                   Eval      w03rig2 =
145290030704     c                             'Immettere i seguenti dati:'
145300030704     c                   EndIf
145310030704     c                   Clear                   At3c01
145320030704     c                   Clear                   At3cor
145330030704     c                   Clear                   At3c02
145340030704     c                   Clear                   At3csf
145350030704     c                   Clear                   At3f12
145360030708     c                   Clear                   H3riga
145370030708     c                   Clear                   H3colo
145380030718      * Salvo i comandi F8 e F9
145390030718     c                   Eval      savinkh = *Inkh
145400030718     c                   Eval      savinki = *Inki
145410030708      * Controllo il totale dei colli
145420030708     c                   If        wtotncl > *Zeros
145430030708      * deve essere uguale ai bancali + sfusi
145440030708     c                   If        wtotncl <> vidncl
145450030707     c                   Eval      At3csf = rimm
145460030707     c                   z-add     04            H3riga
145470030707     c                   z-add     37            H3colo
145480030707     c                   Eval      w03msg =
145490030708     c                             'sfusi+bancali diversi da colli bolla'
145500030707     c                   Eval      *In90 = *On
145510030708     c                   EndIf
145520040128      *  NON deve essere superiore ai colli originali
145530040128     c                   If        wtotncl > w03cor and Not *In90
145540030708     c                   Eval      At3cor = rimm
145550030708     c                   z-add     04            H3riga
145560030708     c                   z-add     18            H3colo
145570030708     c                   Eval      w03msg =
145580030708     c                             'Colli originali minori di sfusi+bancali'
145590030708     c                   Eval      *In90 = *On
145600030708     c                   EndIf
145610030707     c                   EndIf
145620030704
145630030704     c                   Do        *Hival
145640030704     c                   Exfmt     Ls01w03
145650030704
145660030707     c                   Eval      *In90 = *Off
145670030704     c                   Clear                   w03msg
145680030704     c                   Clear                   At3c01
145690030704     c                   Clear                   At3cor
145700030704     c                   Clear                   At3c02
145710030704     c                   Clear                   At3csf
145720030704     c                   Clear                   At3f12
145730030704     c                   Clear                   H3riga
145740030704     c                   Clear                   H3colo
145750030704
145760030708      * F12 Ritorno
145770030708     c                   If        *Inkl
145780030708     c                   Eval      w03cor = savw03cor
145790030708     c                   Eval      w03csf = savw03csf
145800030708     c                   If        w03csf = *Zeros
145810030708     c                   Clear                   wtotncl
145820030708     c                   Else
145830030708     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
145840030708     c                   EndIf
145850030718     c                   Movel     '1'           WEMFOR
145860030708     c                   Leave
145870030708     c                   EndIf
145880030708      * colli originali obbligatori
145890030704     c                   If        w03Cor = *zeros
145900030704     c                   Eval      At3cor = rimm
145910030704     c                   z-add     04            H3riga
145920030707     c                   z-add     18            H3colo
145930030704     c                   Eval      w03msg = 'Immettere i colli originali'
145940030704     c                   Eval      *In90 = *On
145950030704     c                   Iter
145960030704     c                   EndIf
145970030707
145980030707     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
145990040129      * il totale dei colli NON deve essere superiore ai colli originali
146000040129     c                   If        wtotncl > w03cor
146010030708     c                   Eval      At3cor = rimm
146020030708     c                   z-add     04            H3riga
146030030708     c                   z-add     18            H3colo
146040030708     c                   Eval      w03msg =
146050030708     c                             'Colli originali minori di sfusi+bancali'
146060030708     c                   Eval      *In90 = *On
146070030708     c                   Iter
146080030708     c                   EndIf
146090030708      * il totale dei colli deve essere uguali ai bancali + sfusi
146100030707     c                   If        wtotncl <> vidncl
146110030707     c                   Eval      At3csf = rimm
146120030707     c                   z-add     04            H3riga
146130030707     c                   z-add     37            H3colo
146140030707     c                   Eval      w03msg =
146150030708     c                             'sfusi+bancali diversi da colli bolla'
146160030707     c                   Eval      *In90 = *On
146170030707     c                   Iter
146180030707     c                   EndIf
146190030704
146200030704     c   kf              Leave
146210030704
146220030704     c                   EndDo
146230030718      * Ripristino i comandi F8 e F9
146240030718     c                   Eval      *Inkh = savinkh
146250030718     c                   Eval      *InKi = savinki
146260030704
146270030704     c                   EndSr
146280030805      *---------------------------------------------------------------*
146290030805      * Ricerco l'orm x fare il ritiro contestuale alla consegna
146300030805      *---------------------------------------------------------------*
146310030805     c     Sr_RicOrm     BegSr
146320030805
146330091006      * Preparo la ds x il richiamo a FNLS28R
146340091006      * Solo se richiamato FNLS28R x i controlli
146350031217if  1c                   If        wope = 'C'
146360091006     c                   Clear                   Fnls28ds
146370091006     c                   Eval      I28Ope = wope
146380091006     c                   Eval      I28ccm = wksc
146390080407     c                   if        *in12
146400091006     c                   Move      §lpaac        I28Aas
146410080407     c                   endif
146420120326      * passo sempre la lnp del video in quanto ad oggi dei traduttori
146430120326      * personalizzati per ORM RC non ce ne sono.
146440120326      * Attenzione che se dovessero esserci di nuovo dei traduttori
146450120326      * personalizzati il pgm prevede di controllare l'esistenza dell'ORM RC
146460120326      * e per collegare ORM con Bolla si fa tramite RFA dell'ORM = al n. bolla
146470120326      * memorizzato sul VAB di conseguenza la LNP del video non va più bene.
146480120326     c                   move      vidlnp        I28lnp
146490091006     c                   if        widspe <> 0
146500120326     c**!!!              Move      Widlnp        I28lnp
146510091006     c                   Move      Widnrs        I28nrs
146520091006     c                   Move      Widnsp        I28nsp
146530091006     c                   else
146540091006     c  n12              eval      i28aas = waas
146550120326     c**!!!              move      vidlnp        i28lnp
146560091006     c                   endif
146570091006     c                   Eval      I28Lna = comlna
146580091006     c                   Move      varznc        I28Znc
146590091006     c                   eval      i28rsd = vidrsd
146600091006     c                   eval      i28ind = vidind
146610091006     c                   eval      i28cad = vidcad
146620091006     c                   eval      i28lod = vidlod
146630091006     c                   eval      i28prd = vidprd
146640091006     c                   eval      i28nzd = vidnzd
146650091006     c                   eval      i28ncl = v1cncl
146660091006     c                   eval      i28pkb = vidpkg
146670091006      * Solo se richiamato FNLS28R x i aggiornare passo solo I28Ope
146680031217      * gli altri dati sono già impostati
146690031217   x1c                   Else
146700091006     c                   Eval      I28Ope = wope
146710040227      * se sono in conferma bolle da dischetto e il cliente non mantiene il
146720040227      * numero di spedizione devo aggiornare anche il riferimento sull'ORM
146730091006      * o immissione bolla
146740091006if  2c                   If        (*In12 and *In15 and BlpNsp <> WidNsp)
146750091006     c                              or not *in12
146760091006     c                   Eval      I28nAas = BlpAas
146770091006     c                   Eval      I28Lnp = BlpLnp
146780091006     c                   Eval      I28Nrs = BlpNrs
146790091006     c                   Eval      I28Nsp = BlpNsp
146800040227    2c                   EndIf
146810031217    1c                   EndIf
146820091006     c                   Call      'FNLS28R'
146830091006     c                   parm                    kpjba
146840091006     c                   Parm                    Fnls28ds
146850091006      * Solo se ho richiamato FNLS28R x i controlli verifico gli errori
146860031217if  1c                   If        wope = 'C'
146870031217      * Orm Non trovato
146880091006if  2c                   If        O28Err = 01
146890031217     c                   Eval      VidMsg = Err(150)
146900031217     c                   Eval      *In67 = *On
146910031217     c                   Eval      *In90 = *On
146920031217    2c                   EndIf
146930031217      * Altri errori sull'ORM
146940091006if  2c                   If        O28Err > *Zeros and O28Err <> 01
146950091006     c                   Eval      VidMsg = O28Msg
146960031217     c                   Eval      *In67 = *On
146970031217     c                   Eval      *In90 = *On
146980031217    2c                   EndIf
146990091124    1c                   EndIf
147000031217      * Ok ORM - imposto campi x memorizzarli in FIAR5 rcd 'RCC'
147010091006     c                   Eval      savOrmPoe = O28Poe
147020091006     c                   Eval      savOrmNsr = O28Nsr
147030091006     c                   Eval      savOrmNor = O28Nor
147040091006     c                   Eval      savOrmNrv = O28Nrv
147050030805
147060030805     c                   EndSr
147070960319     C*
147080960319     C* CONTROLLO GIORNI DI CHIUSURA --------------------------------*
147090960319     C     CTRGCH        BEGSR
147100960319     C*** 1° GIORNO CHIUSURA ***
147110960319    1C     WGC1          IFNE      *BLANKS
147120960319     C                   MOVEL     WGC1          ACOM              1
147130960319     C                   MOVE      WGC1          BCOM              1
147140960319     C                   Z-ADD     1             B                 3 0
147150960319     C     ACOM          LOOKUP    GGG(B)                                 30
147160960319     C* ERRORE
147170960319    2C     *IN30         IFEQ      *OFF
147180960319     C                   MOVEL     ERR(63)       VIDMSG
147190960319     C                   SETON                                        7490
147200960319     C                   GOTO      ENDGCH
147210960319    2C                   ENDIF
147220960319     C*
147230960319    2C     BCOM          IFNE      ' '
147240960319     C     BCOM          ANDNE     'P'
147250960319     C     BCOM          ANDNE     'M'
147260960319     C                   MOVEL     ERR(63)       VIDMSG
147270960319     C                   SETON                                        7490
147280960319     C                   GOTO      ENDGCH
147290960319    2C                   END
147300960319     C*
147310960319    1C                   END
147320960319     C***
147330960319     C*** 2° GIORNO CHIUSURA ***
147340960319    1C     WGC2          IFNE      *BLANKS
147350960319     C                   MOVEL     WGC2          ACOM              1
147360960319     C                   MOVE      WGC2          BCOM              1
147370960319     C                   Z-ADD     1             B
147380960319     C     ACOM          LOOKUP    GGG(B)                                 30
147390960319     C* ERRORE
147400960319    2C     *IN30         IFEQ      *OFF
147410960319     C                   MOVEL     ERR(63)       VIDMSG
147420960319     C                   SETON                                        6290
147430960319     C                   GOTO      ENDGCH
147440960319    2C                   ENDIF
147450960319     C*
147460960319    2C     BCOM          IFNE      ' '
147470960319     C     BCOM          ANDNE     'P'
147480960319     C     BCOM          ANDNE     'M'
147490960319     C                   MOVEL     ERR(63)       VIDMSG
147500960319     C                   SETON                                        6290
147510960319     C                   GOTO      ENDGCH
147520960319    2C                   END
147530960319     C*
147540960319     C* I GIORNI DI CHIUSURA NON POSSO ESSERE UGUALI
147550960319    2C     WGC1          IFEQ      WGC2
147560960319     C                   MOVEL     ERR(63)       VIDMSG
147570960319     C                   SETON                                        6290
147580960319     C                   GOTO      ENDGCH
147590960319    2C                   END
147600960319    1C                   END
147610960319     C* NON POSSONO ESSERE ' P' ' M'
147620960319    1C     WGC1          IFEQ      ' M'
147630960319     C     WGC1          OREQ      ' P'
147640960319    2C     WGC2          IFEQ      ' M'
147650960319     C     WGC2          OREQ      ' P'
147660960319     C                   MOVEL     ERR(63)       VIDMSG
147670960319     C                   SETON                                        6290
147680960319     C                   GOTO      ENDGCH
147690960319    2C                   END
147700960319    1C                   END
147710960319     C* personalizzazione
147720960319    2C     WPERSO        IFEQ      'P'
147730960319     C     WGC1          IFNE      '  '
147740960319     C     WGC2          ORNE      '  '
147750960319     C                   SETON                                        91
147760960319    2C                   ENDIF
147770960319    2C                   ENDIF
147780960319     C*
147790960319     C     ENDGCH        ENDSR
147800050415     C* CONTROLLO PARTICOLARITA' VARIE E BANCALI --------------------*
147810050415     c     sr_CntPVBan   begsr
147820050415     C***
147830050415     C*** PARTICOLARITA' VARIE    ***
147840050415     C*   PER ORA NON ESISTONO E SALTO COMPLETAMENTE IL CONTROLLO
147850050415     C*   SI PUO' SOLO IMMETTERE 'P ' CHE INDICA CONSEGNA A PRIVATI
147860050415      *   si può inserire anche 'B' bancali o 'O' bancali x over 25
147870050415    1C     VIDGVA        IFNE      *BLANKS
147880050415     C     VIDGVR        ORNE      *BLANKS
147890050415     C* RICHIAMO IL PRG DI RICERCA
147900050415    2C     VIDGVR        IFEQ      '?'
147910050415     C                   CLEAR                   DS7PQR
147920050415     C                   MOVEL     'S'           DS7RIC
147930050415     C                   MOVEL     'V'           DS7GES
147940050415     C                   MOVEL     WKSC          DS7KSC
147950050415     C                   MOVEL     VIDGVA        DS7COD
147960050415     C                   MOVEL     DS7PQR        KPJBU
147970050415     C                   CALL      'TRTB73R'
147980050415     C                   PARM                    KPJBA
147990050415     C                   MOVEL     KPJBU         DS7PQR
148000050415     C                   CLEAR                   VIDGVR
148010050415     C*
148020050415     C     VIDGVA        IFEQ      *BLANKS
148030050415     C                   MOVEL     DS7COD        VIDGVA
148040050415    2C                   ENDIF
148050050415     C*
148060050415     C                   MOVEL     '1'           WEMFOR
148070050415     C                   GOTO      ENDpvban
148080050415    2C                   ENDIF
148090050415     C* CONTROLLO
148100050415     C                   CLEAR                   DS7PQR
148110050415     C                   MOVEL     'S'           DS7RIC
148120050415     C                   MOVEL     'C'           DS7GES
148130050415     C                   MOVEL     WKSC          DS7KSC
148140050415     C                   MOVEL     VIDGVA        DS7COD
148150050415     C                   MOVEL     DS7PQR        KPJBU
148160050415     C                   CALL      'TRTB73R'
148170050415     C                   PARM                    KPJBA
148180050415     C                   MOVEL     KPJBU         DS7PQR
148190050415     C* ERRORE
148200050415    2C     DS7ERR        IFEQ      '1'
148210050415     C                   MOVEL     DS7MSG        VIDMSG
148220050415     C                   SETON                                        7590
148230050415     C                   GOTO      ENDpvban
148240050415    2C                   ENDIF
148250050415     c* controllo ambito di utilizzo particolarità varia
148260050415     C                   MOVEL     '7S'          COD
148270050415     C                   MOVEL(P)  vidgva        KEY
148280050415     c                   clear                   ds7s
148290050415     C                   EXSR      CTABEL
148300050415     C                   MOVEL     TBLUNI        DS7S
148310050415     c     §7suti        ifeq      'B'
148320050415     c     §ogntw        andeq     'PPT'
148330050415     c     §7suti        oreq      'P'
148340050415     c     §ogntw        andne     'PPT'
148350050415     C                   MOVEL     err(288)      VIDMSG
148360050415     C                   SETON                                        7590
148370050415     C                   GOTO      ENDpvban
148380050415     c                   endif
148390050415    1C                   ENDIF
148400050415      * B A N C A L I
148410050415      * tipo bancali
148420050415If  1c                   If        VidTba <> *Blanks and VidTba <> '00'
148430050415      * ricerca
148440050415     c     '?'           Scan      VidTba                                 30
148450050415If  2c                   If        *In30
148460050415     c                   Clear                   Dsbs02
148470050415     c                   Eval      T02Mod = 'R'
148480050415     c                   Eval      T02Sif = Knsif
148490050415     c                   Eval      T02Cod = 'TBA'
148500050415     c                   Call      'TIBS02R'
148510050415     c                   Parm                    Kpjba
148520050415     c                   Parm                    Dsbs02
148530050415     c                   Movel     T02Ke1        VidTba
148540050415     c                   Eval      Wemfor = '1'
148550050415     c                   z-add     23            H2riga
148560050415     c                   z-add     16            H2colo
148570050415     c                   GoTo      ENDpvban
148580050415    2c                   EndIf
148590050415      * controllo
148600050415     c                   Clear                   Dsbs02
148610050415     c                   Clear                   dTba
148620050415     c                   Eval      T02Mod = 'C'
148630050415     c                   Eval      T02Sif = Knsif
148640050415     c                   Eval      T02Cod = 'TBA'
148650050415     c                   Movel(p)  VidTba        T02Ke1
148660050415     c                   Call      'TIBS02R'
148670050415     c                   Parm                    Kpjba
148680050415     c                   Parm                    Dsbs02
148690050415If  2c                   If        T02Err <> *Blanks
148700050415     c                   Movel     Rimm          AtrTba
148710050415     c                   Eval      VidMsg = Err(269)
148720050415     c                   Eval      *In90 = *On
148730050415     c                   z-add     23            H2riga
148740050415     c                   z-add     16            H2colo
148750050415     c                   GoTo      ENDpvban
148760050415    2c                   EndIf
148770050415     c                   Movel     T02Uni        dTba
148780050415     c                   Z-Add     §TbaPkg       wTbaPkg1
148790050415     c                   Z-Add     §TbaVol       wTbaVol1
148800050415   x1c                   Else
148810050415If  2c                   If        VidNba > *Zeros
148820050415     c                   Movel     Rimm          AtrTba
148830050415     c                   Eval      VidMsg = Err(269)
148840050415     c                   Eval      *In90 = *On
148850050415     c                   z-add     23            H2riga
148860050415     c                   z-add     16            H2colo
148870050415     c                   GoTo      ENDpvban
148880050415    2c                   EndIf
148890050415    1c                   EndIf
148900050415      * numero bancali
148910050415If  1c                   If        VidNba = *Zeros and VidTba > *Zeros
148920050415     c                   Movel     Rimm          AtrNba
148930050415     c                   Eval      VidMsg = Err(268)
148940050415     c                   Eval      *In90 = *On
148950050415     c                   z-add     23            H2riga
148960050415     c                   z-add     22            H2colo
148970050415     c                   GoTo      ENDpvban
148980050415    1c                   EndIf
148990050415      * tipo bancali 2
149000050415If  1c                   If        VidTb2 <> *Blanks and VidTb2 <> '00'
149010050415      * ricerca
149020050415     c     '?'           Scan      VidTb2                                 30
149030050415If  2c                   If        *In30
149040050415     c                   Clear                   Dsbs02
149050050415     c                   Eval      T02Mod = 'R'
149060050415     c                   Eval      T02Sif = Knsif
149070050415     c                   Eval      T02Cod = 'TBA'
149080050415     c                   Call      'TIBS02R'
149090050415     c                   Parm                    Kpjba
149100050415     c                   Parm                    Dsbs02
149110050415     c                   Movel     T02Ke1        VidTb2
149120050415     c                   Eval      Wemfor = '1'
149130050415     c                   z-add     23            H2riga
149140050415     c                   z-add     32            H2colo
149150050415     c                   GoTo      ENDpvban
149160050415    2c                   EndIf
149170050415      * controllo
149180050415     c                   Clear                   Dsbs02
149190050415     c                   Clear                   dTba
149200050415     c                   Eval      T02Mod = 'C'
149210050415     c                   Eval      T02Sif = Knsif
149220050415     c                   Eval      T02Cod = 'TBA'
149230050415     c                   Movel(p)  VidTb2        T02Ke1
149240050415     c                   Call      'TIBS02R'
149250050415     c                   Parm                    Kpjba
149260050415     c                   Parm                    Dsbs02
149270050415If  2c                   If        T02Err <> *Blanks
149280050415     c                   Movel     Rimm          AtrTb2
149290050415     c                   Eval      VidMsg = Err(269)
149300050415     c                   Eval      *In90 = *On
149310050415     c                   z-add     23            H2riga
149320050415     c                   z-add     32            H2colo
149330050415     c                   GoTo      ENDpvban
149340050415    2c                   EndIf
149350050415     c                   Movel     T02Uni        dTba
149360050415     c                   Z-Add     §TbaPkg       wTbaPkg2
149370050415     c                   Z-Add     §TbaVol       wTbaVol2
149380050415   x1c                   Else
149390050415If  2c                   If        VidNb2 > *Zeros
149400050415     c                   Movel     Rimm          AtrTb2
149410050415     c                   Eval      VidMsg = Err(269)
149420050415     c                   Eval      *In90 = *On
149430050415     c                   z-add     23            H2riga
149440050415     c                   z-add     32            H2colo
149450050415     c                   GoTo      ENDpvban
149460050415    2c                   EndIf
149470050415    1c                   EndIf
149480050415      * numero bancali 2
149490050415If  1c                   If        VidNb2 = *Zeros and VidTb2 > *Zeros
149500050415     c                   Movel     Rimm          AtrNb2
149510050415     c                   Eval      VidMsg = Err(268)
149520050415     c                   Eval      *In90 = *On
149530050415     c                   z-add     23            H2riga
149540050415     c                   z-add     38            H2colo
149550050415     c                   GoTo      ENDpvban
149560050415    1c                   EndIf
149570050415      * non si possono immettere 2 tipi bancali uguali
149580050415If  1c                   If        VidTba > *Zeros and VidTb2 > *Zeros
149590050415     c                             and VidTba = VidTb2
149600050415     c                   Movel     Rimm          AtrTb2
149610050415     c                   Eval      VidMsg = Err(270)
149620050415     c                   Eval      *In90 = *On
149630050415     c                   z-add     23            H2riga
149640050415     c                   z-add     32            H2colo
149650050415     c                   GoTo      ENDpvban
149660050415    1c                   EndIf
149670050415      * se inseriti i bancali la particolarità Varie "B" è obbligatoria
149680050415      * oppure la particolarità Varie "O"
149690050415If  1c                   If        (VidTba > *Zeros or VidTb2 > *Zeros) and
149700050415     c                              %Subst(VidGva:1:1) <> 'B' and
149710050415     c                              %Subst(VidGva:1:1) <> 'O'
149720050415     c                   Select
149730050415     c                   When      wgva = 'O'
149740050415     c                   Eval      VidMsg = Err(32)
149750050415     c                   When      wgva = 'B'
149760050415     c                   Eval      VidMsg = Err(35)
149770050415     c                   Other
149780050415     c                   Eval      VidMsg = Err(274)
149790050415     c                   EndSl
149800050415     c                   Eval      *In90 = *On
149810050415     c                   Eval      *In75 = *On
149820050415     c                   GoTo      ENDpvban
149830050415    1c                   EndIf
149840050415      * se inserita la particolarità Varie "B" sono obbligatori
149850050415      * oppure la particolarità Varie "O"
149860050415If  1c                   If        (%subst(VidGva:1:1) ='B' or
149870050415     c                              %subst(VidGva:1:1) ='O')  and
149880050415     c                             (VidTba = *Blanks or VidTba = '00') and
149890050415     c                             (VidTb2 = *Blanks or Vidtb2 = '00')
149900050415     c                   Movel     Rimm          AtrTba
149910050415     c                   Eval      VidMsg = Err(271)
149920050415     c                   Eval      *In90 = *On
149930050415     c                   z-add     23            H2riga
149940050415     c                   z-add     16            H2colo
149950050415     c                   GoTo      ENDpvban
149960050415    1c                   EndIf
149970050415      * msg info x n. colli inferiore al tot. bancali
149980050415     c                   Eval      wtotnba = VidNba + VidNb2
149990050415     c                   If        VidNcl < wtotnba and wtotnba > *Zeros
150000050415     c                             and wfornba = *Blanks
150010050415     c                   Eval      VidMsg = Err(27)
150020050415     c                   Eval      *In41 = *On
150030050415     c                   Eval      *In90 = *On
150040050415     c                   Eval      wfornba = '1'
150050050415     c                   GoTo      ENDpvban
150060050415     c                   EndIf
150070050415      * Manutenzione di bolla con bancali
150080050415      * Se viene modificato il numero di bancali
150090050415      * emetto un msg info
150100050415     c                   If        *In12 and Not *In15                      and
150110050415     c                             (VidNba <> SavNba or VidNb2 <> SavNb2)   and
150120110921     c                             wNba = *Blanks                           and
150130110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
150140050415     c                   Eval      wNba = '1'
150150050415     c                   Eval      VidMsg = Err(273)
150160050415     c                   If        VidNba <> SavNba
150170050415     c                   Movel     Rimm          AtrNba
150180050415     c                   z-add     23            H2riga
150190050415     c                   z-add     22            H2colo
150200050415     c                   EndIf
150210050415     c                   If        VidNb2 <> SavNb2
150220050415     c                   Movel     Rimm          AtrNb2
150230050415     c                   z-add     23            H2riga
150240050415     c                   z-add     38            H2colo
150250050415     c                   EndIf
150260050415     c                   Eval      *In90 = *On
150270050415     c                   GoTo      ENDpvban
150280050415     c                   EndIf
150290050415      * per Particolarità varie 'O'
150300050415      * questi controlli non li faccio se richiamato da giacenze
150310050415     c                   If        %subst(VidGva:1:1) = 'O'
150320050415      * se colli originali già immessi devo controllare il n. dei colli sfusi
150330050415      * con i bancali
150340050415     c                   If        w03Cor > *zeros
150350050415     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
150360050415     c                   EndIf
150370050415      * devo controllare se inseriti i colli originali
150380050415      * se non sono stati inseriti emetto la window per inserirli
150390050415     c                   If        w03cor = *Zeros     or
150400050415      * oppure se sono in manutenzione bolla e sono stati variati
150410050415      * o i bancali o il n. dei colli
150420050415      * emetto la window
150430050415     c                             (*In12 and Not *In15)                   or
150440050415     c                             (wtotncl > *Zeros  and
150450050415     c                             (wtotncl <> vidncl or
150460050415     c                             (wtotncl >= w03cor and w03cor > *Zeros)))
150470050415     c                   ExSr      Sr_Over25
150480050415     c                   EndIf
150490050415     c                   EndIf
150500050415     c     endpvban      tag
150510050415     C   90              MOVEL     '1'           WEMFOR
150520050415     c                   endsr
150530940826     C*
150540940826     C* GESTIONE 3 VIDEATA ------------------------------------------*
150550940826     C     GESD03        BEGSR
150560991008      *
150570940928     C                   CLEAR                   WEMD03
150580971211     C                   MOVEL     COMLNA        V3CLNA
150590940826     C* DECODIFICA LNA
150600940826     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
150610971211     C  N30              MOVEL     ORGDES        V3DLNA
150620940923     C*
150630940923     C* SE TASSAZIONE CON TARIFFA MITTENTE, TASSO LA BOLLA
150640950125     C* SOLO PER GLI ASSEGNATI
150650950125     C   04SAVFTM        IFNE      ' '
150660940923     C     VIDFTM        ORNE      ' '
150670940923     C     VIDIMV        IFEQ      0
150680980506     C                   MOVEL     '1'           WBOL
150690011025      *
150700011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
150710011025      * varia 'N'
150720011025     C     FLGVRN        IFEQ      '1'
150730011115      * leggo il sbfl delle varie
150740011115     C                   DO        20            NRR
150750011115     C     NRR           CHAIN     LS01S03                            30
150760011115     C     V3CSV1        IFEQ      'N'
150770011115     C     V3CVA1        ANDEQ     88888888
150780011115     C                   EXSR      TASSAN
150790011115     C  N30              UPDATE    LS01S03
150800011115     C                   ENDIF
150810011115     C                   ENDDO
150820011025     C                   ENDIF
150830011025      *
150840940923     C                   EXSR      TASSAZ
150850941219     C* SE TASSAZIONE RIUSCITA, MSG CHE E' TASSATA CON TARIFFA MITTEN
150860950504     C* IN CONFERMA BOLLE DA  CLIENTI NON LO DO'
150870941219     C     *IN90         IFEQ      *OFF
150880950504     C     *IN12         IFEQ      *OFF
150890950504     C     *IN15         OREQ      *OFF
150900950504     C     §LPFPR        OREQ      'V'
150910941110     C                   MOVEL     ERR(59)       VIDMSG
150920940923     C                   SETON                                        90
150930940923     C                   ENDIF
150940950504     C                   ENDIF
150950941219     C*
150960941219     C                   ENDIF
150970940923     C                   ENDIF
150980950504     C*
150990950504     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
151000950504     C*    AI CONTROLLI --> SE NON C'E' STATO UN ERRORE IN TASSAZIONE
151010950504     C  N90
151020950504     CAN 12
151030950504    2CAN 15§LPFPR        IFNE      'V'
151040950504     C                   GOTO      CT3TAG
151050950504    2C                   END
151060961111     C* EMETTO MSG CHE DEVO TASSARE IL PORTO SE FRANCO FRONTIERA
151070961111     C     VIDFBR        IFEQ      'F'
151080961111     C     SED           ANDEQ     0
151090961111     C                   MOVEL     ERR(129)      VIDMSG
151100961111     C                   SETON                                        9052
151110961111     C                   MOVEL     1             SED
151120961111     C                   ENDIF
151130940923     C*
151140940826     C     FOR03         TAG
151150941011     C                   Z-ADD     1             NRR
151160940826     C*
151170940923     C                   WRITE     LS01D04
151180940923     C                   EXFMT     LS01C03
151190950504     C*
151200950504     C     CT3TAG        TAG
151210941115     C*
151220941021     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
151230950126     C                   EXSR      OFFD03
151240940826     C*
151250990701     C* F22 - CALCOLO PROVVIGIONI DEL MITTENTE
151260940928    3C     *INKW         IFEQ      *ON
151270940919     C* SOLO SE SI TRATTA DI UN CODIFICATO
151280940919    4C     VIDCCM        IFNE      9999
151290940919    4C     VIDCCM        ANDNE     8888
151300940919     C* SOLO SE IL CLIENTE HA UNA TARIFFA ALMENO VALIDA
151310980608     C*  ALTRIMENTI USA LA TARIFFA DI CARTELLO IL PGM TNSF20R
151320980506     C                   MOVEL     '2'           WBOL              1
151330980506     C                   EXSR      TASSAZ
151340980506     C** IMPOSTO LA VARIA SE TROVATA IN VI2VA1
151350940826   X4C                   ELSE
151360940919     C* ERRORE PER 8888 O 9999
151370941110     C                   MOVEL     ERR(82)       VIDMSG
151380980608     C                   SETON                                        4090
151390940919    4C                   ENDIF
151400940919     C*
151410940826     C                   GOTO      FOR03
151420940919    3C                   ENDIF
151430941115     C*
151440940826     C* CONTROLLI
151450940826     C                   EXSR      CTRD03
151460940826     C* RIEMETTO FORMATO
151470950127     C     WEMFOR        IFEQ      '1'
151480950127     C                   EXSR      ESCIER
151490950127     C     §LPFPR        IFNE      '5'
151500000113     C  NKL              GOTO      FOR03
151510950127     C                   ELSE
151520950127     C                   GOTO      ENDD03
151530950127     C                   ENDIF
151540950127     C                   ENDIF
151550941115     C*
151560990701     C* F12 - RITORNO VIDEATA 2
151570941115     C     *INKL         IFEQ      *ON
151580990701     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA F9 QUESTA VIDEATA
151590941115     C     VIDPOR        IFNE      0
151600941115     C     WESVAR        ORNE      ' '
151610941115     C     VIDCEI        ORNE      ' '
151620040116     c     wesvar1       orne      *Blanks
151630941115     C     VI2CEI        ORNE      ' '
151640000113     C     WEMFOR        OREQ      '1'
151650941115     C                   MOVEL     'S'           WEMD03            1
151660000113     C                   CLEAR                   WEMFOR
151670000113     C                   CLEAR                   VIDMSG
151680000113     C                   SETOFF                                       90
151690941115     C                   ENDIF
151700941115     C                   GOTO      ENDD03
151710941115     C                   ENDIF
151720940826     C*
151730990630     C* F14 - TASSAZIONE BOLLA
151740990630     C     *INKN         IFEQ      *ON
151750990630     C                   MOVEL     '1'           WBOL
151760011025      *
151770011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
151780011025      * varia 'N'
151790011025     C     FLGVRN        IFEQ      '1'
151800011115      * leggo il sbfl delle varie
151810011115     C                   DO        20            NRR
151820011115     C     NRR           CHAIN     LS01S03                            30
151830011115     C     V3CSV1        IFEQ      'N'
151840011115     C     V3CVA1        ANDEQ     88888888
151850011025     C                   EXSR      TASSAN
151860011115     C  N30              UPDATE    LS01S03
151870011115     C                   ENDIF
151880011115     C                   ENDDO
151890011025     C                   ENDIF
151900011025      *
151910990630     C                   EXSR      TASSAZ
151920990701     C*
151930990630     C* PER PREPAGATI CALCOLO IL TOTALE FATTURA
151940990701     C     *IN22         IFEQ      *ON
151950990716     C     VIDIMV        IFGT      0
151960060208     c* se sono in manutenzione ed è variato il totale imponibile
151970060208     c* errore se prepagato già incassato
151980070514     c***                if        *in12 = *on and *in15 = *off  and
151990070514     c***                          dateu >= §vpogpp
152000070514     c                   if        *in12 = *on and *in15 = *off
152010060208     c                   exsr      sr_callycow
152020060208     c                   if        prmesito <> 0
152030060208     C                   MOVEL     ERR(297)      VIDMSG
152040060208     C                   SETON                                        90
152050060208     C                   GOTO      FOR03
152060060208     c                   endif
152070060208     c                   endif
152080120105     c                   if        viddft>0
152090120105     C                   Z-ADD     viddft        G02DAT
152100120105     C                   MOVEL     *BLANK        G02ERR
152110120105     C                   CALL      'XSRDA8'
152120120105     C                   PARM                    WLBDAT
152130120105     C                   MOVEL     G02INV        comdft
152140120105     c                   else
152150990701     C                   Z-ADD     DATEU         COMDFT
152160120105     c                   endif
152170991014     C                   EXSR      TOTFAT
152180990701     C                   Z-ADD     D04IFT        VIDIFT
152190990701     C                   Z-ADD     D04IMV        VIDIMV
152200990701     C                   Z-ADD     D04POR        VIDPOR
152210990701     C                   Z-ADD     D04IMV        SAVIMV
152220991014     C                   Z-ADD     D04POR        MEMPOR
152230990701     C                   ENDIF
152240990716     C                   ENDIF
152250990630     C*
152260990630     C                   GOTO      FOR03
152270990630     C                   ENDIF
152280060207     c*
152290060207     c* MANUTENZIONE: GESTIONE MOTIVAZIONE PER PREPAGATI
152300060207     c* Se sono in manutenzione di un prepagato ed è stato variato il
152310060207     c* totale imponibile richiedo motivazione
152320060308     c*
152330060308     c                   movel     'TR'          wcvb
152340060308     c                   exsr      cls_lv85
152350060308     c*
152360060208     c                   clear                   ilv85cvb
152370060207     c                   if        *in12 = *on and *in15= *off and
152380070514     c****                         dateu >= §vpogpp  and
152390060208     c                             *in22 = *on and vidimv <> savimvo
152400060227     c                   movel     '7L'          cod
152410060227     C                   MOVEL(P)  'TR'          KEY
152420060227     C                   EXSR      CTABEL
152430060227     C                   MOVEL     TBLUNI        DS7L
152440060227     c                   if        §7lmtv = 'S'
152450060227     c                   clear                   fnlv85ds
152460060208     c                   eval      ilv85cvb = 'TR'
152470060209     c                   eval      ilv85tel = 'V'
152480060207     c                   movel     fnlv85ds      kpjbu
152490060207     c                   call      'FNLV85R'
152500060207     c                   parm                    kpjba
152510060210     c                   movel     kpjbu         fnlv85ds
152520060207     c* F12=Ritorno --> riemetto formato 03
152530060209     c                   if        olv85f12 = '1'
152540060207     c                   goto      for03
152550060207     c                   endif
152560060227     c                   endif
152570060207     c                   endif
152580940826     C*
152590940919     C* SE CONTO SERVIZIO IMMISSIONE PER CMD6
152600101104     c                   if        not *inkf and not *inkh
152610101104     C     WFPR          IFNE      'I'
152620940919     C     §3ARBL        ANDEQ     'C'
152630950410     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
152640950410    4C     VIDLNP        IFNE      102
152650950410     C     *IN12         OREQ      *OFF
152660950410     C     *IN15         OREQ      *OFF
152670940928     C                   MOVEL     ERR(40)       VIDMSG
152680940923     C                   SETON                                        90
152690940919     C                   GOTO      FOR03
152700900504     C                   END
152710950410     C                   END
152720101104     c                   endif
152730960318     C**
152740960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
152750960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
152760960805     C* NON LO FACCIO SE BOLLA DI RECUPERO
152770960805     C  NKF§3ARBL        IFNE      'R'
152780130927     c     wforw03       andeq     *Blanks
152790960805     C                   EXSR      CTRCRG
152800030704     c   41              GoTo      For03
152810960805     C                   ENDIF
152820940919     C*
152830940923     C     ENDD03        ENDSR
152840900507     C*
152850900507     C*--- CONTROLLO FORMATO 3 ---------------------------------------*
152860940826     C     CTRD03        BEGSR
152870991008      *
152880941004     C                   SETOFF                                       90
152890941115     C                   CLEAR                   VIDMSG
152900940826     C                   CLEAR                   WEMFOR
152910030623     C                   CLEAR                   WVAR3A            1
152920991028     C**
152930991028     C* CONTROLLO DIVISA SE MODIFICATA
152940991028    1C     VI2DIV        IFNE      *BLANKS
152950991028     C     VI2DIV        ANDNE     WDIV2
152960991028     C     WDIV2         ANDNE     *BLANKS
152970991028     C                   CLEAR                   DSLV16
152980991028     C                   CLEAR                   DTASV
152990991028     C                   MOVEL     'D'           D17FIM
153000991028     C                   MOVE      VI2DIV        D17DIV
153010991028     C                   Z-ADD     BLPDSP        D17DSP
153020991028     C                   CALL      'FNLV16R'
153030991028     C                   PARM                    DSLV16
153040991028     C                   PARM                    DTASV
153050991028     C                   MOVEL     D17DIV        VI2DIV
153060991028     C* ERRORE
153070991028    2C     O17ERR        IFNE      *BLANKS
153080991028     C                   SETON                                        43
153090991028    3C     O17MSG        IFNE      *BLANKS
153100991028     C                   MOVEL     O17MSG        VIDMSG
153110991028     C                   SETON                                        90
153120991028    3C                   ENDIF
153130991028     C                   GOTO      ENDC03
153140991028    2C                   ENDIF
153150991028     C**
153160991028      * SE VARIATA DIVISA DEVO CONVERTIRE GLI IMPORTI NON MODIFICATI
153170991028    2C     VI2VA1        IFEQ      VA2VA1
153180991028     C     VI2VA1        ANDGT     *ZEROS
153190991028     C                   CLEAR                   DSYEUR
153200991028     C                   MOVEL     WDIV2         YECDVI
153210991028     C                   Z-ADD     VI2VA1        YECIMI
153220991028     C                   MOVEL     VI2DIV        YECDVO
153230991028    3C     O17FDC        IFEQ      'S'
153240991028     C                   MOVEL     '3'           YECDCO
153250991028    3C                   ENDIF
153260991028     C**
153270991028     C                   CALL      'YEURCO'
153280991028     C                   PARM                    DSYEUR
153290991028     C**
153300991028    3C     YECESI        IFEQ      ' '
153310991028     C                   Z-ADD     YECIMO        VI2VA1
153320991028     C                   MOVEL     '1'           WEMFOR
153330991028    3C                   ENDIF
153340991028    2C                   ENDIF
153350040114      * Varia 2
153360040114    2c                   If        Vi2Va2 = Va2Va2 and Vi2Va2 > 0
153370040114     c                   Clear                   dsyeur
153380040114     c                   Movel     wdiv2         YecDvi
153390040114     c                   Z-add     Vi2va2        YecImi
153400040114     c                   Movel     Vi2Div        YecDvo
153410040114    3c                   If        O17fDc = 'S'
153420040114     c                   Movel     '3'           YecDco
153430040114    3c                   EndIf
153440040114     c                   Call      'YEURCO'
153450040114     c                   Parm                    dsyeur
153460040114    3c                   If        YecEsi = *Blanks
153470040114     c                   Z-add     YecImo        Vi2Va2
153480040114     c                   Eval      wemfor = '1'
153490040114    3c                   EndIf
153500040114    2c                   EndIf
153510040114      * Varia 3
153520040114    2c                   If        Vi2Va3 = Va2Va3 and Vi2Va3 > 0
153530040114     c                   Clear                   dsyeur
153540040114     c                   Movel     wdiv2         YecDvi
153550040114     c                   Z-add     Vi2va3        YecImi
153560040114     c                   Movel     Vi2Div        YecDvo
153570040114    3c                   If        O17fDc = 'S'
153580040114     c                   Movel     '3'           YecDco
153590040114    3c                   EndIf
153600040114     c                   Call      'YEURCO'
153610040114     c                   Parm                    dsyeur
153620040114    3c                   If        YecEsi = *Blanks
153630040114     c                   Z-add     YecImo        Vi2Va3
153640040114     c                   Eval      wemfor = '1'
153650040114    3c                   EndIf
153660040114    2c                   EndIf
153670040114      * Varia 4
153680040114    2c                   If        Vi2Va4 = Va2Va4 and Vi2Va4 > 0
153690040114     c                   Clear                   dsyeur
153700040114     c                   Movel     wdiv2         YecDvi
153710040114     c                   Z-add     Vi2va4        YecImi
153720040114     c                   Movel     Vi2Div        YecDvo
153730040114    3c                   If        O17fDc = 'S'
153740040114     c                   Movel     '3'           YecDco
153750040114    3c                   EndIf
153760040114     c                   Call      'YEURCO'
153770040114     c                   Parm                    dsyeur
153780040114    3c                   If        YecEsi = *Blanks
153790040114     c                   Z-add     YecImo        Vi2Va4
153800040114     c                   Eval      wemfor = '1'
153810040114    3c                   EndIf
153820040114    2c                   EndIf
153830041217      * Varia 5
153840041217    2c                   If        Vi2Va5 = Va2Va5 and Vi2Va5 > 0
153850041217     c                   Clear                   dsyeur
153860041217     c                   Movel     wdiv2         YecDvi
153870041217     c                   Z-add     Vi2va5        YecImi
153880041217     c                   Movel     Vi2Div        YecDvo
153890041217    3c                   If        O17fDc = 'S'
153900041217     c                   Movel     '3'           YecDco
153910041217    3c                   EndIf
153920041217     c                   Call      'YEURCO'
153930041217     c                   Parm                    dsyeur
153940041217    3c                   If        YecEsi = *Blanks
153950041217     c                   Z-add     YecImo        Vi2Va5
153960041217     c                   Eval      wemfor = '1'
153970041217    3c                   EndIf
153980041217    2c                   EndIf
153990041217      * Varia 6
154000041217    2c                   If        Vi2Va6 = Va2Va6 and Vi2Va6 > 0
154010041217     c                   Clear                   dsyeur
154020041217     c                   Movel     wdiv2         YecDvi
154030041217     c                   Z-add     Vi2va6        YecImi
154040041217     c                   Movel     Vi2Div        YecDvo
154050041217    3c                   If        O17fDc = 'S'
154060041217     c                   Movel     '3'           YecDco
154070041217    3c                   EndIf
154080041217     c                   Call      'YEURCO'
154090041217     c                   Parm                    dsyeur
154100041217    3c                   If        YecEsi = *Blanks
154110041217     c                   Z-add     YecImo        Vi2Va6
154120041217     c                   Eval      wemfor = '1'
154130041217    3c                   EndIf
154140041217    2c                   EndIf
154150040114
154160991028    1C                   ENDIF
154170991028      *
154180991028     C                   Z-ADD     VI2VA1        VA2VA1
154190040114     c                   Z-add     Vi2Va2        Va2Va2
154200040114     c                   Z-add     Vi2Va3        Va2Va3
154210040114     c                   Z-add     Vi2Va4        Va2Va4
154220041217     c                   Z-add     Vi2Va5        Va2Va5
154230041217     c                   Z-add     Vi2Va6        Va2Va6
154240040121     C                   Z-ADD     VI2VA1        VVA(1)
154250040121     c                   Z-add     Vi2Va2        Vva(2)
154260040121     c                   Z-add     Vi2Va3        Vva(3)
154270040121     c                   Z-add     Vi2Va4        Vva(4)
154280041217     c                   Z-add     Vi2Va5        Vva(5)
154290041217     c                   Z-add     Vi2Va6        Vva(6)
154300991028     C                   MOVEL     VI2DIV        WDIV2
154310991028     C* RIEMETTO VIDEATA
154320991028     C     WEMFOR        IFEQ      '1'
154330991028     C                   GOTO      ENDC03
154340991028    2C                   ENDIF
154350940826     C*
154360100119      * Gli altri controlli sono demandati al FNLV16
154370100119     C                   CLEAR                   Dlv1601
154380100119     C                   CLEAR                   DSLV16
154390100119     C                   CLEAR                   DTASV
154400100119
154410940920     C* 2 BOLLA --> CONTROLLO I CAMPI
154420991011    1C     VI2SV1        IFNE      *BLANKS
154430991011     C     VI2VA1        ORNE      *ZEROS
154440040114     c     Vi2Sv2        orne      *Blanks
154450040114     c     Vi2Va2        orne      *Zeros
154460040114     c     Vi2Sv3        orne      *Blanks
154470040114     c     Vi2Va3        orne      *Zeros
154480040114     c     Vi2Sv4        orne      *Blanks
154490040114     c     Vi2Va4        orne      *Zeros
154500041217     c     Vi2Sv5        orne      *Blanks
154510041217     c     Vi2Va5        orne      *Zeros
154520041217     c     Vi2Sv6        orne      *Blanks
154530041217     c     Vi2Va6        orne      *Zeros
154540991011     C     VI2DIV        ORNE      *BLANKS
154550100119     C                   MOVEL     'E'           D17FIM
154560100119   x1c                   else
154570100119     c* controllo solo il codice esenzione IVA
154580100119    2C     VI2CEI        ifne      *BLANKS
154590100119     C                   MOVEL     'I'           D17FIM
154600100119    2c                   endif
154610100119    1c                   endif
154620991026      *
154630100119    1c                   if        d17fim<>' '
154640991011     C                   MOVEL     'P'           D17TBO
154650991011     C                   MOVEL     WKSC          D17KSC
154660991028     C                   Z-ADD     BLPDSP        D17DSP
154670991011     C                   MOVEL     VIDLNP        D17LNP
154680991011     C                   MOVEL     VIDLNA        D17LNA
154690991011     C                   MOVEL     §3ATB2        D17TBL
154700991011     C                   MOVEL     §3ARBL        D17RBL
154710020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
154720040115     c                   Movel     §3asva        §d17Sva
154730040115      * passo che devo controllare la seconda bolla
154740040115     c                   Eval      §d17Tb2 = 'S'
154750100119     c                   Eval      §d17ctriso='S'
154760100119     c                   Eval      §d17iso=vidisd
154770100119
154780100119     c                   if        vidpid<>*blanks and vidisd=*blanks
154790100119     c                   eval      §d17iso='IT'
154800100119     c                   endif
154810100119
154820040115     c                   Movel     Dlv1601       D17Flo
154830991011     C                   MOVEL     VI2DIV        D17DIV
154840991011     C                   MOVEL     WDIV2         D17DVP
154850991011     C     §3AFCA        IFEQ      2
154860991011     C                   MOVEL     'S'           D17FCA
154870991011     C                   ENDIF
154880991011     C                   MOVEL     VI2CEI        D17CEI
154890991012     C                   MOVEL     VI2SV1        VSV(1)
154900991012     C                   MOVEL     VI2VA1        VVA(1)
154910040121     c                   Movel     Vi2Es1        ves(1)
154920040115     C                   MOVEL     VI2SV2        VSV(2)
154930040115     C                   Z-add     VI2VA2        VVA(2)
154940040121     c                   Movel     Vi2Es2        ves(2)
154950040115     C                   MOVEL     VI2SV3        VSV(3)
154960040115     C                   Z-add     VI2VA3        VVA(3)
154970040121     c                   Movel     Vi2Es3        ves(3)
154980040115     C                   MOVEL     VI2SV4        VSV(4)
154990040115     C                   Z-add     VI2VA4        VVA(4)
155000040121     c                   Movel     Vi2Es4        ves(4)
155010041217     C                   MOVEL     VI2SV5        VSV(5)
155020041217     C                   Z-add     VI2VA5        VVA(5)
155030041217     c                   Movel     Vi2Es5        ves(5)
155040041217     C                   MOVEL     VI2SV6        VSV(6)
155050041217     C                   Z-add     VI2VA6        VVA(6)
155060041217     c                   Movel     Vi2Es6        ves(6)
155070100119     c* In questo caso passo il codice iso della partita iva del destinatario
155080100119     c
155090991011      *
155100991011     C                   CALL      'FNLV16R'
155110991011     C                   PARM                    DSLV16
155120991012     C                   PARM                    DTASV
155130991011      *
155140991011     C                   MOVEL     D17CEI        VI2CEI
155150991011     C                   MOVEL     D17DIV        VI2DIV
155160991015     C                   MOVEL     O17FDC        WFDC2
155170991011     C                   MOVEL     O17DEI        V2DCEI
155180040115      * Ricarico le varie
155190040115     c                   Movel     Vsv(1)        Vi2Sv1
155200040115     c                   Z-add     Vva(1)        Vi2Va1
155210040121     c                   Movel     Ves(1)        Vi2Es1
155220040115     c                   Movel     Vsv(2)        Vi2Sv2
155230040115     c                   Z-add     Vva(2)        Vi2Va2
155240040121     c                   Movel     Ves(2)        Vi2Es2
155250040115     c                   Movel     Vsv(3)        Vi2Sv3
155260040115     c                   Z-add     Vva(3)        Vi2Va3
155270040121     c                   Movel     Ves(3)        Vi2Es3
155280040115     c                   Movel     Vsv(4)        Vi2Sv4
155290040115     c                   Z-add     Vva(4)        Vi2Va4
155300040121     c                   Movel     Ves(4)        Vi2Es4
155310041217     c                   Movel     Vsv(5)        Vi2Sv5
155320041217     c                   Z-add     Vva(5)        Vi2Va5
155330041217     c                   Movel     Ves(5)        Vi2Es5
155340041217     c                   Movel     Vsv(6)        Vi2Sv6
155350041217     c                   Z-add     Vva(6)        Vi2Va6
155360041217     c                   Movel     Ves(6)        Vi2Es6
155370991011      *
155380991011     C     O17ERR        IFNE      *BLANKS
155390991011      *
155400991011      *  Se errore riemetto videata con messaggio
155410991011     C     O17MSG        IFNE      *BLANKS
155420991011     C                   MOVEL     O17MSG        VIDMSG
155430991011     C                   SETON                                        90
155440991011      *  Se interrogazione riemetto videata
155450991011     C                   ELSE
155460991011     C                   MOVEL     '1'           WEMFOR            1
155470991011     C                   ENDIF
155480991011      *
155490991011     C                   SELECT
155500991011     C     O17ERR        WHENEQ    '1'
155510991011     C                   SETON                                        42
155520991011     C     O17ERR        WHENEQ    '6'
155530040116     c                   If        O17Erv = 1
155540991011     C                   SETON                                        40
155550040115     c                   EndIf
155560040116     c                   If        O17Erv = 2
155570040115     c                   z-add     09            H3riga
155580041217     c                   z-add     49            H3colo
155590040115     c                   EndIf
155600040116     c                   If        O17Erv = 3
155610041217     c                   z-add     09            H3riga
155620041217     c                   z-add     65            H3colo
155630040115     c                   EndIf
155640040116     c                   If        O17Erv = 4
155650040115     c                   z-add     10            H3riga
155660041217     c                   z-add     33            H3colo
155670040115     c                   EndIf
155680041217     c                   If        O17Erv = 5
155690041217     c                   z-add     10            H3riga
155700041217     c                   z-add     49            H3colo
155710041217     c                   EndIf
155720041217     c                   If        O17Erv = 6
155730041217     c                   z-add     10            H3riga
155740041217     c                   z-add     65            H3colo
155750041217     c                   EndIf
155760991011     C     O17ERR        WHENEQ    '7'
155770991011     C                   SETON                                        43
155780991011     C                   ENDSL
155790991011      *
155800991011     C   90              GOTO      ENDC03
155810991011     C                   ENDIF
155820991011      *
155830991011    1C                   ENDIF
155840040130      * salvo le varie in una sk per poterle poi riorganizzare al momento
155850040130      * della scrittura dei file FIAR6 e FIAR7
155860040130     c                   Eval      W2sv(1) = vi2sv1
155870040130     c                   Eval      W2va(1) = vi2va1
155880040130     c                   Eval      W2sv(2) = vi2sv2
155890040130     c                   Eval      W2va(2) = vi2va2
155900040130     c                   Eval      W2sv(3) = vi2sv3
155910040130     c                   Eval      W2va(3) = vi2va3
155920040130     c                   Eval      W2sv(4) = vi2sv4
155930040130     c                   Eval      W2va(4) = vi2va4
155940041217     c                   Eval      W2sv(5) = vi2sv5
155950041217     c                   Eval      W2va(5) = vi2va5
155960041217     c                   Eval      W2sv(6) = vi2sv6
155970041217     c                   Eval      W2va(6) = vi2va6
155980040130      * Controllo se caricata almeno una varia
155990041217do  1c                   Do        6             c
156000040130     c                   If        w2sv(c) <> *Blanks
156010040130     c                   Eval      wesvar1 = 'S'
156020040130     c                   EndIf
156030040130    1c                   EndDo
156040011212     C* CONTROLLO CHE LA L'IMPORTO NON SUPERI IL LIMITE FATTURABILE
156050040130     c                   xfoot     w2va          wsomts
156060040116if  1c                   If        wsomts > *Zeros
156070011212     C     VI2DIV        IFNE      §GEDCN
156080011212     C                   CLEAR                   DSYEUR
156090011212     C                   MOVEL     VI2DIV        YECDVI
156100011212     C                   MOVEL     §GEDCN        YECDVO
156110040114     c                   Z-add     wsomts        YecImi
156120011212     C                   MOVE      DECCN         YECDCO
156130011212     C                   CALL      'YEURCO'
156140011212     C                   PARM                    DSYEUR
156150011212     C     YECESI        IFEQ      ' '
156160011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
156170011212     C                   ENDIF
156180011212     C                   ENDIF
156190011212     C     WSOMTS        IFGT      IMFGEI
156200040115     c                   Movea     err(242)      k78
156210011212     C                   MOVE      IMFGEI        WNUMED
156220011212     C* richiamo routine per editare il limite
156230011212     C                   EXSR      CALLXE
156240011212      * metto il numero editato nel campo del messaggio
156250011212     C                   MOVEA     W014A         SKII(1)
156260040115     c                   Movea     skii(1)       k78(54)
156270040115     c                   Movea     §gedcn        k78(69)
156280011212     C*
156290011212     C                   MOVEA     K78           VIDMSG
156300011212     C                   SETON                                        4190
156310011212     C                   GOTO      ENDC03
156320011212     C                   ENDIF
156330040116    1C                   ENDIF
156340040126
156350040126     c                   Z-add     wsomts        Vi2Imv
156360991011      *
156370991012      * SE TASSAZIONE CON TARIFFA MITTENTE PROVO A RITASSARE
156380991012      * NON TASSO SE P.A. EXPORT
156390950127    1C   04SAVFTM        IFEQ      'S'
156400950127     C     VIDFTM        OREQ      'S'
156410950127    2C     VIDIMV        IFEQ      0
156420980506     C                   MOVEL     '1'           WBOL
156430950127     C                   EXSR      TASSAZ
156440950127    2C                   END
156450950127    1C                   END
156460991012      *
156470991012      * SE VARIATA LA DIVISA: LA CONTROLLO, CONVERTO IMPORTI MODIFICATI
156480991012      *                       E RIEMETTO LA VIDEATA
156490991012     C     VIDDIV        IFNE      WDIV1
156500991015     C     VIDDIV        ANDNE     *BLANKS
156510991026     C     WDIV1         ANDNE     *BLANKS
156520991012     C                   EXSR      VARDIV
156530991028     C     WEMFOR        IFEQ      '1'
156540991012     C                   GOTO      ENDC03
156550991028     C                   ENDIF
156560991012     C                   ENDIF
156570991012      *
156580100119     C                   CLEAR                   Dlv1601
156590100119     C                   CLEAR                   DSLV16
156600991007     C                   CLEAR                   DTASV
156610941219     C                   MOVEL     'P'           D17TBO
156620991012      * PER PREPAGATI IMPOSTO IL FLAG APPOSITO
156630991012     C   22              MOVEL     'S'           D17PRP
156640991012     C  N04              MOVEL     WKSC          D17KSC
156650941219     C*
156660941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
156670991012    1C     SAVFTM        IFEQ      'S'
156680991012     C     *IN04         ANDEQ     *ON
156690941219     C     VIDFTM        OREQ      'S'
156700991012     C     *IN04         ANDEQ     *ON
156710941221     C                   MOVE      WKSC          D17KSC
156720941219     C                   MOVEL     'S'           D17FTM
156730991012      *
156740991012      * SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
156750941219   X2C                   ELSE
156760941221     C                   MOVEL     COMLNA        D17KSC
156770941221     C                   MOVE      9999          D17KSC
156780991012    1C                   ENDIF
156790991012      *
156800991012     C                   MOVEL     'C'           D17FIM
156810941219     C                   MOVEL     VIDLNP        D17LNP
156820941219     C                   MOVEL     VIDLNA        D17LNA
156830941219     C                   MOVEL     §3ATB1        D17TBL
156840941219     C                   MOVEL     §3ARBL        D17RBL
156850020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
156860020503     C                   MOVEL     §3ASVA        D17FLO
156870950103     C     §3AFCA        IFEQ      1
156880941219     C                   MOVEL     'S'           D17FCA
156890941219     C                   ENDIF
156900941219     C                   MOVEL     VIDIAS        D17IAS
156910941219     C                   MOVEL     VIDQFT        D17QFT
156920941219     C                   MOVEL     VIDPOR        D17POR
156930991014     C     COMDFT        IFGT      *ZEROS
156940991014     C                   Z-ADD     COMDFT        D17DSP
156950991012     C                   ELSE
156960991028     C                   Z-ADD     BLPDSP        D17DSP
156970991012     C                   ENDIF
156980941219     C                   MOVEL     VIDIMV        D17IMV
156990941219     C                   MOVEL     VIDCEI        D17CEI
157000941219     C                   MOVEL     VIDFIV        D17FIV
157010941219     C                   MOVEL     VIDNFT        D17NFT
157020941219     C                   MOVEL     VIDDFT        D17DFG
157030941219     C                   MOVEL     'S'           D17FFI
157040991012     C                   MOVEL     VIDDIV        D17DIV
157050991012     C                   MOVEL     WDIV1         D17DVP
157060100119     c
157070100119     c* Controllo codice esenzione iva con partita iva del "chi paga"
157080100120     c*  sempre se ASSEGNATO
157090100119
157100100119     c                   if        *in04
157110100120     c                   Eval      §d17ctriso='S'
157120100119     c                   Eval      §d17iso=vidisd
157130100119     c                   if        vidpid<>*blanks and vidisd=*blanks
157140100119     c                   eval      §d17iso='IT'
157150100119     c                   endif
157160100119
157170100119     c                   else
157180100120     c*  solo per prepagati se FRANCO
157190100120     c                   if        *in22
157200100120     c                   Eval      §d17ctriso='S'
157210100119     c                   Eval      §d17iso=vidism
157220100119     c                   if        vidpim<>*blanks and vidism=*blanks
157230100119     c                   eval      §d17iso='IT'
157240100119     c                   endif
157250100120     c                   endif
157260100120     c
157270100119     c                   endif
157280100119
157290100119     c                   Movel     Dlv1601       D17Flo
157300991012      *
157310991012      * CARICO SCHIERA VARIE
157320941219     C                   CLEAR                   C
157330941219     C                   DO        20            NRR
157340941219     C     NRR           CHAIN     LS01S03                            30
157350941219     C     *IN30         IFEQ      *OFF
157360970604     C**
157370941219     C                   ADD       1             C
157380941219     C                   MOVEL     V3CSV1        VSV(C)
157390991007     C                   Z-ADD     V3CVA1        VVA(C)
157400030623     C* MEMORIZZO SE C'E' LA VARIA DELLA BOLLA NEL CASO DI BOLLE CON SINGOLA VAR
157410030623     C                   IF        §3ASVA <> *BLANKS AND V3CSV1 = §3ASVA
157420030623     C                   MOVEL     'S'           WVAR3A            1
157430030623     C                   ENDIF
157440941219     C                   ENDIF
157450941219     C                   ENDDO
157460970604     C* ERRORE
157470970604     C   90              GOTO      ENDC03
157480990701     C**
157490941219     C** CALL
157500991008     C                   CALL      'FNLV16R'
157510991008     C                   PARM                    DSLV16
157520991007     C                   PARM                    DTASV
157530991012      *
157540991012     C                   MOVEL     D17DIV        VIDDIV
157550991015     C                   MOVEL     O17FDC        WFDC1
157560941219     C                   MOVEL     D17CEI        VIDCEI
157570991011     C                   MOVEL     O17DEI        DESCEI            8
157580991011     C                   MOVEL     O17DEI        V3DCEI
157590941219     C                   Z-ADD     D17DFG        VIDDFT
157600991011     C                   Z-ADD     O17DFA        COMDFT
157610991012      *
157620991012      * RICARICO LE VARIE
157630941219     C                   DO        20            NRR
157640941219     C     NRR           CHAIN     LS01S03                            30
157650941219     C                   MOVEL     VSV(NRR)      V3CSV1
157660941219     C                   MOVEL     VES(NRR)      V3CEV1
157670941223     C*
157680941223     C     VSV(NRR)      IFNE      *BLANKS
157690941223     C                   MOVEL     'S'           WESVAR            1
157700941223     C                   ENDIF
157710941219     C* SE C'E' ERRORE SU VARIA, ACCENDO INDICATORE DI POSIZIONAMENTO
157720991011     C     O17ERV        IFEQ      NRR
157730941219     C                   SETON                                        5090
157740991019     C                   MOVEL     O17MSG        VIDMSG
157750941219     C                   ELSE
157760941219     C                   SETOFF                                       50
157770941219     C                   ENDIF
157780991012      *
157790941219     C  N30              UPDATE    LS01S03
157800941219     C   30              WRITE     LS01S03
157810941219     C                   ENDDO
157820991012      *
157830991015     C   90              GOTO      ENDC03
157840991015      *
157850991012      * GESTIONE ERRORI
157860991011    1C     O17ERR        IFNE      *BLANKS
157870941219     C                   MOVEL     '1'           WEMFOR
157880941021     C*
157890991011    2C     O17MSG        IFNE      *BLANKS
157900991011     C                   MOVEL     O17MSG        VIDMSG
157910941219     C                   SETON                                        90
157920941021    2C                   ENDIF
157930941021     C**
157940941021     C* ESENZIONE IVA
157950991011    2C     O17ERR        IFEQ      '1'
157960950103     C                   SETON                                        46
157970940920     C                   GOTO      ENDC03
157980941021    2C                   ENDIF
157990941021     C**
158000941021     C* NUMERO FATTURA
158010991011     C     O17ERR        IFEQ      '2'
158020941219     C                   SETON                                        48
158030941021     C                   GOTO      ENDC03
158040941021    2C                   ENDIF
158050941021     C**
158060960926     C* REGISTRO IVA FATTURA
158070991011    2C     O17ERR        IFEQ      '3'
158080941219     C                   SETON                                        47
158090941021     C                   GOTO      ENDC03
158100941021    2C                   ENDIF
158110941021     C**
158120941021     C* DATA FATTURA
158130991011     C     O17ERR        IFEQ      '4'
158140941219     C                   SETON                                        49
158150941021     C                   GOTO      ENDC03
158160941021    2C                   ENDIF
158170941021     C**
158180941021     C* IMPONIBILE
158190991011     C     O17ERR        IFEQ      '5'
158200941219     C                   SETON                                        45
158210941021     C                   GOTO      ENDC03
158220941021    2C                   ENDIF
158230991012     C**
158240991012     C* DIVISA
158250991012     C     O17ERR        IFEQ      '7'
158260991012     C                   SETON                                        53
158270991012     C                   GOTO      ENDC03
158280991012    2C                   ENDIF
158290991012     C**
158300991012     C* PORTO
158310991012     C     O17ERR        IFEQ      '8'
158320991012     C                   SETON                                        52
158330991012     C                   GOTO      ENDC03
158340991012    2C                   ENDIF
158350941021     C*
158360941021    1C                   ENDIF
158370991104      *
158380991104      * MEMORIZZO GLI IMPORTI DI TASSAZIONE IN CAMPI DI COMODO PER CONFRONTI
158390011212     C* MENTRE MEMORIZZO FACCIO ANCHE LA SOMMA DEGLI IMPORTI PER POI
158400011212     C* CONTROLLARLA COL LIMITE FATTURABILE
158410991104     C                   Z-ADD     VIDPOR        MEMPOR
158420011212     C                   Z-ADD     VIDPOR        WSOMTS           17 3
158430991104     C                   MOVEL     VIDDIV        WDIV1
158440991104     C                   DO        20            NRR
158450991104     C     NRR           CHAIN     LS01S03                            30
158460991104     C                   Z-ADD     V3CVA1        V3HVA1
158470011219     C* Se è bolla di rientro non tassata fino all'imponibile con varia
158480011219     c* "N" 88888888 non la considero per il confronto con §geimf
158490011219     C     VIDFBR        IFEQ      'S'
158500011219     C     V3CSV1        ANDEQ     'N'
158510011219     C     V3CVA1        ANDEQ     88888888
158520011219     C     VIDIMV        ANDEQ     *ZEROS
158530030624     C* oppure varia & 8888888
158540030624     C     V3CSV1        OREQ      '&'
158550030624     C     V3CVA1        ANDEQ     88888888
158560030624     C     VIDIMV        ANDEQ     *ZEROS
158570011219     C                   ELSE
158580011212     C                   ADD       V3CVA1        WSOMTS
158590011219     C                   ENDIF
158600991104     C  N30              UPDATE    LS01S03
158610991104     C                   ENDDO
158620011212     C***
158630011212     C     VIDIMV        IFGT      *ZEROS
158640011212     C                   Z-ADD     VIDIMV        WSOMTS
158650011212     C                   ENDIF
158660011212     C* CONTROLLO CHE LA SOMMA DEGLI IMPORTI O IL TOTALE IMPONIBILE,
158670011212     C* SE PRESENTE, NON SUPERI IL LIMITE FATTURABILE
158680011212     C     WSOMTS        IFGT      *ZEROS
158690011212     C     VIDDIV        IFNE      §GEDCN
158700011212     C                   CLEAR                   DSYEUR
158710011212     C                   MOVEL     VIDDIV        YECDVI
158720011212     C                   MOVEL     §GEDCN        YECDVO
158730011212     C                   Z-ADD     WSOMTS        YECIMI
158740011212     C                   MOVE      DECCN         YECDCO
158750011212     C                   CALL      'YEURCO'
158760011212     C                   PARM                    DSYEUR
158770011212     C     YECESI        IFEQ      ' '
158780011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
158790011212     C                   ENDIF
158800011212     C                   ENDIF
158810011212     C     WSOMTS        IFGT      IMFGEI
158820011212     C                   MOVEA     ERR(242)      K78
158830011212     C                   MOVE      IMFGEI        WNUMED
158840011212     C* richiamo routine per editare il limite
158850011212     C                   EXSR      CALLXE
158860011212      * metto il numero editato nel campo del messaggio
158870011212     C                   MOVEA     W014A         SKII(1)
158880011212     C                   MOVEA     SKII(1)       K78(54)
158890011212     C                   MOVEA     §GEDCN        K78(69)
158900011212     C*
158910011212     C                   MOVEA     K78           VIDMSG
158920011212     C                   SETON                                        5290
158930011212     C                   GOTO      ENDC03
158940011212     C                   ENDIF
158950011212     C                   ENDIF
158960991012      *
158970991012     C* PER COD 8888 O 9999 CON VARIA "R" OBBLIGATORIO IMPORTO DA ASSICURARE
158980991012     C*  "S" IN O17FAS INDICA QUESTO TIPO DI ERRORE
158990991011    3C     O17FAS        IFEQ      'S'
159000940923     C* SE = 0 E FORZO CON ENTER PRENDO VALORE DA TARIFFA
159010941021    4C     SEI           IFNE      NUMFOR
159020941021     C                   MOVEL     ERR(9)        VIDMSG
159030940923     C                   SETON                                        5090
159040940923     C                   ADD       1             SEI
159050940923     C                   GOTO      ENDC03
159060940923    4C                   ENDIF
159070940923    3C                   ENDIF
159080940826     C*
159090950421     C* DATA FATTURA DEVE APPARTENERE ALLO STESSO MESE DELLA DATA SPEDI
159100990701    3C     VIDDFT        IFGT      0
159110990830     C     *IN22         ANDEQ     *OFF
159120950421     C                   MOVEL     VIDDFT        W0040             4 0
159130950421     C                   MOVE      W0040         W0020F            2 0
159140950421     C                   MOVEL     VIDDSP        W0040
159150950421     C                   MOVE      W0040         W0020S            2 0
159160990701    4C     W0020S        IFNE      W0020F
159170950421     C                   SETON                                        4990
159180950421     C                   MOVEL     ERR(116)      VIDMSG
159190950421     C                   GOTO      ENDC03
159200990701    4C                   ENDIF
159210990701    3C                   ENDIF
159220961111     C**
159230990830     C* SE LA DATA FATTURA <=10 DATA DI PARUT, IMPOSTO LA PRIMA DATA
159240000113     C*  DEL GIORNO, SE NON CAMBIA L'ANNO, ALTRIMENTI ERRORE
159250991011    2C   22O17DFA        IFLE      WDTU10
159260991011     C     O17DFA        ANDGT     0
159270000113     C                   MOVEL     O17DFA        W0040
159280000113     C     W0040         IFEQ      WAAUPI
159290990830     C* IMPOSTO WDTU10 + 1 E AVVISO
159300990830     C                   Z-ADD     WDTUPI        VIDDFT
159310990830     C                   SETON                                        4990
159320990830     C                   MOVEL     ERR(167)      VIDMSG
159330990830     C                   GOTO      ENDC03
159340000113     C                   ELSE
159350000113     C**
159360000113     C                   SETON                                        4990
159370000113     C                   MOVEL     ERR(182)      VIDMSG
159380000113     C                   GOTO      ENDC03
159390991012    2C                   ENDIF
159400000113    2C                   ENDIF
159410001121     C* SE DATA FATTURA < DATA SPEDIZIONE E CAMBIO MESE, NON POSSO
159420001121     C*  METTERE IN SOSPENSIONE LA BOLLA
159430000508    2C   22O17DFA        IFGT      WDTU10
159440000508     C     O17DFA        ANDGT     0
159450001121     C                   MOVEL     O17DFA        W0060F            6 0
159460001121     C                   MOVEL     BLPDSP        W0060S            6 0
159470000508     C     W0060F        IFLT      W0060S
159480000508     C     BLPDSP        ANDGT     DATEU
159490000508     C                   SETON                                        4990
159500000508     C                   MOVEL     ERR(193)      VIDMSG
159510000508     C                   GOTO      ENDC03
159520000508     C                   ENDIF
159530000508     C                   ENDIF
159540000113     C*
159550990610     C* SE FRANCO FRONTIERA SPECIFICARE IL PORTO
159560961111     C  NKLVIDPOR        IFEQ      0
159570961111     C     VIDFBR        ANDEQ     'F'
159580961111     C                   SETON                                        5290
159590961111     C                   MOVEL     ERR(129)      VIDMSG
159600961111     C                   GOTO      ENDC03
159610961111     C                   ENDIF
159620990610     C*
159630990610     C* SE PREPAGATO INSERIRE TASSAZIONE O F14 PER TASSARE
159640990701     C  NKL
159650990701    1CANNKN*IN22         IFEQ      *ON
159660990701    2C     VIDIMV        IFEQ      0
159670990614     C                   SETON                                        5290
159680990610     C                   MOVEL     ERR(160)      VIDMSG
159690990610     C                   GOTO      ENDC03
159700990701   X2C                   ELSE
159710990701    3C     VIDIMV        IFNE      SAVIMV
159720990716     C     VIDIMV        ANDGT     0
159730060207     c* se sono in manutenzione errore se già incassato
159740060208     c                   if        *in12 = *on and *in15 = *off and
159750070514     c****                         dateu >= §vpogpp and vidimv <> savimvo
159760070514     c                             vidimv <> savimvo
159770060208     c                   exsr      sr_callycow
159780060208     c                   if        prmesito <> 0
159790060208     C                   SETON                                        90
159800060208     C                   MOVEL     ERR(297)      VIDMSG
159810060208     C                   GOTO      ENDC03
159820060208     c                   endif
159830060207     c                   endif
159840120105     c                   if        viddft>0
159850120105     C                   Z-ADD     viddft        G02DAT
159860120105     C                   MOVEL     *BLANK        G02ERR
159870120105     C                   CALL      'XSRDA8'
159880120105     C                   PARM                    WLBDAT
159890120105     C                   MOVEL     G02INV        comdft
159900120105     c                   else
159910990630     C                   Z-ADD     DATEU         COMDFT
159920120105     c                   endif
159930990630     C                   EXSR      TOTFAT
159940990630     C                   Z-ADD     D04IFT        VIDIFT
159950990701     C                   Z-ADD     D04IMV        VIDIMV
159960990701     C                   Z-ADD     D04POR        VIDPOR
159970991014     C                   Z-ADD     D04POR        MEMPOR
159980990701     C                   MOVEL     '1'           WEMFOR
159990990701     C                   Z-ADD     VIDIMV        SAVIMV
160000990701    3C                   ENDIF
160010990701    2C                   ENDIF
160020990630     C* LIBRO IVA
160030990701    2C     *IN34         IFEQ      *ON
160040020725     C                   clear                   DSBS02
160050020725     C                   clear                   DYIV
160060020725     C                   movel     'C'           T02mod
160070020725     C                   movel     KNSIF         T02sif
160080020725     C                   movel     'YIV'         T02cod
160090020725     C                   movel     C_Soc         T02ke1
160100020725     C                   movel     VIDLNP        T02ke2
160110020725     C                   call      'TIBS02R'
160120020725     C                   parm                    KPJBA
160130020725     C                   parm                    DSBS02
160140020725     C                   IF        T02err = *blanks
160150020725     C                   movel     T02uni        DYIV
160160020725     C                   movel     §IVLVF        FIV
160170020725     C                   else
160180020725     C                   clear                   DYIV
160190020725     C                   movel     VIDLNP        FIV
160200020725     C                   endif
160210990630     C* NUMERO FATTURA
160220990630     C     KNUM          CHAIN(N)  CNNUM000                           30
160230990630     C* ERRORE : MANCA IL NUMERATORE DELLE FATTURE
160240990701    3C     *IN30         IFEQ      *ON
160250990630     C                   MOVEL     ERR(164)      VIDMSG
160260990630     C                   SETON                                        5290
160270990630     C                   GOTO      ENDC03
160280990701    3C                   ENDIF
160290990701    2C                   ENDIF
160300990701    1C                   ENDIF
160310011025      * Se è bolla di reso con varia 'N' 88888888 deve esserci la varia 'N'
160320011025     C                   SETOFF                                       50
160330011025    1C     FLGVRN        IFEQ      '1'
160340011025    2C                   DO        20            NRR
160350011025     C     NRR           CHAIN     LS01S03                            30
160360011025    3C     *IN32         IFEQ      *OFF
160370011025     C                   SETON                                        50
160380011025    4C     V3CSV1        IFEQ      'N'
160390011025     C                   SETOFF                                       50
160400011025     C                   LEAVE
160410011025    4C                   ENDIF
160420011025    3C                   ENDIF
160430011025    2C                   ENDDO
160440011025    2C     *IN50         IFEQ      '1'
160450011025     C     1             CHAIN     LS01S03                            30
160460011025     C  N30              UPDATE    LS01S03
160470011114     C                   MOVEL     ERR(233)      VIDMSG
160480011025     C                   SETON                                        90
160490011025     C                   GOTO      ENDC03
160500011025    2C                   ENDIF
160510011025    1C                   ENDIF
160520991012      *
160530940923     C     ENDC03        TAG
160540940928     C   90              MOVEL     '1'           WEMFOR            1
160550991012      *
160560940923     C                   ENDSR
160570060208     C* Richiamo pgm che verifca se prepagato incassato -------------*
160580060208     C     sr_callycow   BEGSR
160590060208     c                   z-add     §lpaas        prmaas
160600060208     c                   z-add     §lplnp        prmlnp
160610060208     c                   z-add     §lpnrs        prmnrs
160620060208     c                   z-add     §lpnsp        prmnsp
160630060208     c                   z-add     vidfiv        prmfiv
160640060208     c                   z-add     vidnft        prmnft
160650060208     c                   z-add     dftar6        prmdft
160660060209     c                   clear                   prmesito
160670060607     c                   call      'YCOW0121R1'
160680060208     C                   PARM                    prmaas
160690060208     C                   PARM                    prmLnp
160700060208     C                   PARM                    prmNrs
160710060208     C                   PARM                    prmNsp
160720060208     C                   PARM                    prmFiv
160730060208     C                   PARM                    prmDft
160740060208     C                   PARM                    prmNft
160750060208     C                   PARM                    prmEsito
160760060208     C                   ENDSR
160770971211     C*
160780971211     C* GESTIONE 6 VIDEATA ------------------------------------------*
160790081008     C**   GESD06        BEGSR
160800081008     C**                 MOVEL     COMLNA        V6CLNA
160810971211     C* DECODIFICA LNA
160820081008     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
160830081008     C**N30              MOVEL     ORGDES        V6DLNA
160840971211     C*
160850081008     C**   FOR06         TAG
160860971211     C*
160870081008     C**                 EXFMT     LS01D06
160880081008     C**                 SETOFF                                       4090
160890971211     C* CONTROLLO SE INSERITO NUMERO AWB: NON POSSO CANCELLARLO SE
160900971211     C*  C'ERA
160910081008     C** 12
160920081008    1C**ANN15V6CAWB        IFEQ      0
160930081008     C**   SAVAWB        ANDGT     0
160940081008     C**                 SETON                                        4090
160950081008     C**                 MOVEL     ERR(145)      VIDMSG
160960081008     C**                 GOTO      FOR06
160970081008    1C**                 ENDIF
160980971211     C*
160990081008     c**   A_§ogntw      ifeq      'EUP'
161000081008     C**                 MOVEL     WKSC          W007A
161010081008     C**   W007A         LOOKUP    KSS                                    30
161020081008    2C**   *IN30         IFEQ      *ON
161030971211     C**
161040971211     C* CONTROLLO CHECK DIGIT
161050081008    3C**   V6CAWB        IFGT      0
161060081008     C**                 MOVEL     V6CAWB        W0090             9 0
161070081008     C**   W0090         DIV       7             RISUL            10 0
161080081008     C**                 MVR                     RESTO             1 0
161090971211     C**
161100081008     C**                 MOVE      V6CAWB        W0010             1 0
161110081008    4C**   RESTO         IFNE      W0010
161120081008     C**                 SETON                                        4090
161130081008     C**                 MOVEA     ERR(147)      K78
161140081008     C**                 MOVEL     RESTO         K78(66)
161150081008     C**                 MOVEA     K78           VIDMSG
161160081008     C**                 GOTO      FOR06
161170081008    4C**                 ENDIF
161180081008    3C**                 ENDIF
161190081008    2C**                 ENDIF
161200081008    1C**                 ENDIF
161210971211     C**
161220081008     C**                 ENDSR
161230991203     C*
161240991203     C* GESTIONE 7 VIDEATA ------------------------------------------*
161250991203     C     GESD07        BEGSR
161260991203     C                   MOVEL     COMLNA        V7CLNA
161270991203     C* DECODIFICA LNA
161280991203     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
161290991203     C  N30              MOVEL     ORGDES        V7DLNA
161300991203     C*
161310991203     C     FOR07         TAG
161320991203     C*
161330991203     C                   EXFMT     LS01D07
161340991203     C                   SETOFF                                       4090
161350991203     C* CONTROLLO SE INSERITO NUMERO PARCEL: NON POSSO CANCELLARLO SE
161360991203     C*  C'ERA
161370991203     C   12
161380060616     CANN15V7CNPR        IFEQ      *blanks
161390060616     C     SAVNPR        ANDne     *blanks
161400991203     C                   SETON                                        4090
161410991203     C                   MOVEL     ERR(176)      VIDMSG
161420991203     C                   GOTO      FOR07
161430991203     C                   ENDIF
161440991203      **
161450991203      * CONTROLLO VALIDITA'
161460060616    1C     V7CNPR        IFne      *blanks
161470000308     C     §3ARBL        ANDNE     'R'
161480000124     C                   MOVEL     V7CNPR        WNPR
161490000124     C                   EXSR      DPDVAL
161500000124     C   90              SETON                                        40
161510000124     C   90              GOTO      FOR07
161520070323     c* Sped. export DPD:
161530070323     c* dal I° aprile non più ammessi parcel dpd lunghi 12
161540070326     C                   if        A_§OGNTW='DPD' and dateu >=20070401
161550070326     c                             and %subst(wnpr:14:1)=*blanks
161560070326     c                             and vidfbr<>'S'
161570070323     c                   seton                                        9040
161580070323     C                   MOVEL     ERR(299)      VIDMSG
161590070323     C                   GOTO      FOR07
161600070323     c                   endif
161610000124     C*
161620991227    1C                   ENDIF
161630070323     c
161640000124     C**
161650000124     C* CONTROLLO NUMERO PARCEL DPD DOPPIO
161660000308     C* IGNORO PER BOLLA SENZA SEGNACOLLI
161670000308     C     §1BFG8        IFEQ      'S'
161680060616     C                   movel     V7CNPR        WNPR
161690060616     c                   if        *in79=*on
161700060616     c                   exsr      dpddop_imp
161710060616     c                   else
161720000124     C                   EXSR      DPDDOP
161730060616     c                   endif
161740000124     C* ERRORE
161750000124     C   90              SETON                                        40
161760000124     C   90              GOTO      FOR07
161770060612     C                   ENDIF
161780991217     C**
161790060623     c* se import dpd metto il nuovo numero nel rmn se possibile
161800060623     c                   if        *in79='1' and *in13='0' and
161810060623     c                             wsolo_num=*blanks
161820060623     c                   clear                   vidrmn
161830060623     c                   if        %subst(v7cnpr:14:1) <> *blanks
161840060623     C                   move      VIDNRD        VIDRMN
161850060623     c                   else
161860060623     c                   eval      w012a=%subst(v7cnpr:1:12)
161870060623     c                   move      w012A         vidrmn
161880060623     c                   endif
161890060623     c
161900060623     c                   endif
161910000124     C                   ENDSR
161920000124     C**
161930000124     C* CONTROLLO VALIDITA' PARCEL DPD--------------------------------*
161940000124     C     DPDVAL        BEGSR
161950060613     c                   clear                   wsolo_num         1
161960060612     c                   select
161970060612     c* controllo parcel lungo 14 --> non devono esserci dei blanks
161980060613     c* e ammesso solo a partire da data in tabella "VPO" (per export)
161990060612     c                   when      %subst(wnpr:14:1) <> *blanks
162000070515     c***                if        *in79='0' and §vpodpd > dateu
162010070515     c***                          and vidfbr =' '
162020070515     C***                SETON                                        90
162030070515     C***                MOVEL     ERR(299)      VIDMSG
162040070515     c***                else
162050060612     c                   if        %scan(' ':wnpr) > 0
162060060612     C                   SETON                                        90
162070060612     C                   MOVEL     ERR(299)      VIDMSG
162080060613     c                   endif
162090070515     c****               endif
162100060613     c                   if        *in90='0'
162110060613     c* controllo se parcel lungo 14 contiene solo numeri
162120060619     c                   z-add     1             hh                2 0
162130061031     c                   z-add     0             hy                2 0
162140060613     c     hh            dowle     14
162150061031     c***  wsolo_num     andeq     *blanks
162160060619     c                   if        %subst(wnpr:hh:1) < '0'
162170060613     c                   eval      wsolo_num='N'
162180061031     c                   eval      hy=hh
162190060613     c                   endif
162200060613     c                   add       1             hh
162210060613     c                   enddo
162220061031     c* le lettere possono esserci solo nei primi 4 bytes dal quinto in poi
162230061031     c* devono essere solo numeri
162240061031     c                   if        wsolo_num='N' and hy >4
162250061031     C                   SETON                                        90
162260061031     C                   MOVEL     ERR(299)      VIDMSG
162270061031     c                   endif
162280061031     c
162290060613     c                   endif
162300060612     c* errore se parcel lungo 13
162310060612     c                   when      %subst(wnpr:13:1) <> *blanks
162320060612     C                   SETON                                        90
162330060612     C                   MOVEL     ERR(299)      VIDMSG
162340060612     c                   other
162350060612     c* controllo parcel lungo 12. Deve contenere solo numeri
162360060612     c                   z-add     1             hh
162370060612     c     hh            dowle     12
162380060612     c     *in90         andeq     '0'
162390060619     c                   if        %subst(wnpr:hh:1) < '0'
162400060612     C                   SETON                                        90
162410060612     C                   MOVEL     ERR(299)      VIDMSG
162420060612     c                   endif
162430060612     c                   add       1             hh
162440060612     c                   enddo
162450060612     c                   if        *in90 = '0'
162460060620     C                   movel     WNPR          DPDBRC
162470060619     C                   Z-ADD     DPDCHD        WDPDBR            1 0
162480061012     C                   CLEAR                   DPDCHD
162490000124     C                   EXSR      M1031
162500000124    3C     DPDCHD        IFNE      WDPDBR
162510000124     C                   SETON                                        90
162520060612     C                   MOVEL     ERR(299)      VIDMSG
162530060612    3C                   ENDIF
162540060612     C                   ENDIF
162550060612     c                   endsl
162560061012     c* Siccome i primi byte del numero parcel dpd corrispondono al
162570061012     c* depot dpd viene segnalato errore bloccante se il numero non
162580061012     c* è presente nell'archivio dei depot
162590061106     c                   if        *in90='0' and
162600061106     c                             ((*in79 and *in12='0') or *in79='0')
162610061012     c                   if        %subst(wnpr:14:1) <> *blanks
162620061012     c                   movel     wnpr          wdpc
162630061012     c                   else
162640061012     c                   eval      wdpc='0'+%subst(wnpr:1:3)
162650061012     c                   endif
162660061107     c                   clear                   truldepds
162670061107     c                   movel     wdpc          idepdpc
162680061107     c                   call      'TRULDEPR'
162690061107     c                   parm                    truldepds
162700061107     c                   if        odeperr='1'
162710061012     C                   SETON                                        90
162720061012     C                   MOVEL     ERR(306)      VIDMSG
162730061012     c                   endif
162740061012     c                   endif
162750060612      *se spedizione export devo anche controllare che numero parcel
162760060621      * inizi per '084' altrimenti errore forzabile
162770060626     c                   if        *in79='0' and *in90='0'
162780060621     c                   if        %subst(wnpr:14:1) <> *blanks
162790060621     c                   movel     wnpr          w0003a            3
162800060621     c     w0003a        ifne      '084'
162810060612     c     wnpr          andne     wnprpre
162820060612     C                   SETON                                        90
162830060621     C                   MOVEL     ERR(303)      VIDMSG
162840060612     c                   endif
162850060621     c                   else
162860060621     c                   movel     wnpr          w0020n            2 0
162870060621     c     w0020n        ifne      84
162880060621     c     wnpr          andne     wnprpre
162890060621     C                   SETON                                        90
162900060621     C                   MOVEL     ERR(289)      VIDMSG
162910060621     c                   endif
162920060621     c                   endif
162930060612     c                   move      wnpr          wnprpre
162940060612     c                   endif
162950000124     C                   ENDSR
162960000124      *
162970000124     C* CONTROLLO SE NUMERO PARCEL EXPORT DPD E' DOPPIO--------------*
162980000124     C     DPDDOP        BEGSR
162990070305     c* non eseguo controllo se pgm richiamato da giacenze
163000070305     c                   if        savfpr<>'G' and savfpr<>'P'
163010000124     C* NON DEVE ESSERE GIA' ESISTENTE
163020000124     C                   MOVEL(P)  WNPR          W030A            30
163030060601     c* tologo il check digit per ricercare il parcel number su fiar4
163040060615    1c                   if        %subst(wnpr:14:1) = *blanks
163050060601     c                   eval      %subst(w030a:12:1)= ' '
163060060616    1c                   endif
163070060601     C                   MOVEL     'I'           WTRC
163080060215     C     Kar4F         SETLL     Fiar403l
163090060215     C     WTRC          READE     fiar403l                               30
163100000124    1C     *IN30         DOWEQ     *OFF
163110000124    2C     *IN12         IFEQ      *OFF
163120000124     C     *IN15         OREQ      *ON
163130060215     C     ar4NRS        ORNE      §LPNRS
163140060215     C     ar4AAS        ORNE      §LPAAS
163150060215     C     ar4NSP        ORNE      §LPNSP
163160000124     C*
163170060615     C                   MOVEL     ar4N30        W014a
163180060615     c                   movel     wnpr          wnpr14           14
163190060707    1c                   if        %subst(wnpr:14:1) = *blanks
163200060707     c                   eval      %subst(wnpr14:12:1)= ' '
163210060707    1c                   endif
163220060615    3C     W014a         IFEQ      WNPR14
163230070305     C**   Kar4B         CHAIN(N)  FNBLT01L                           30
163240070305     C**SOLO SE LNA E LNP UGUALE DO ERRORE
163250070305    4C**N30BLTLNA        IFEQ      COMLNA
163260070305     C**   BLTLNP        ANDEQ     VIDLNP
163270000124     C                   MOVEL     ERR(181)      VIDMSG
163280000124     C                   SETON                                        90
163290000124     C                   GOTO      ENDDOP
163300070305    4C**                 ENDIF
163310000124    3C                   ENDIF
163320000124     C**
163330000203     C                   SETOFF                                       30
163340060615    3C     W014a         IFGT      WNPR14
163350000124     C                   SETON                                        30
163360000124    3C                   ENDIF
163370000124    2C                   ENDIF
163380000124     C*
163390060215     C  N30WTRC          READE     Fiar403l                               30
163400000124    1C                   ENDDO
163410070305     c                   endif
163420000124     C     ENDDOP        ENDSR
163430060613     C* CONTROLLO SE NUMERO PARCEL import DPD E' DOPPIO--------------*
163440060613     C     DPDDOP_imp    BEGSR
163450060613     C* NON DEVE ESSERE GIA' ESISTENTE
163460060613     C                   MOVEL(P)  vidnrd        W030A            30
163470060614     c* se immesso numero parcel lungo 12
163480060613     c* tolgo il check digit per ricercare il parcel number su fiar4
163490060614    1c                   if        %subst(vidnrd:14:1) = *blanks
163500060613     c                   eval      %subst(w030a:12:1)= ' '
163510060614    1c                   endif
163520060613     C                   MOVEL     'I'           WTRC
163530060613     C     Kar4F         SETLL     Fiar403l
163540060613     C     WTRC          READE     fiar403l                               30
163550060614    1C     *IN30         DOWEQ     *OFF
163560060613    2C     *IN12         IFEQ      *OFF
163570060613     C     *IN15         OREQ      *ON
163580060613     C     ar4NRS        ORNE      §LPNRS
163590060613     C     ar4AAS        ORNE      §LPAAS
163600060613     C     ar4NSP        ORNE      §LPNSP
163610060613     C*
163620060613     C                   MOVEL     ar4N30        W014a            14
163630060623     c                   movel     w030a         wnpr14           14
163640060613    3C     W014a         ifeq      WNPR14
163650060628     c     ar4lnp        andeq     vidlnp
163660060614     c
163670060613     c                   movel     dsblp0        savblp
163680061212     c     kblp4m        chain     fnblp01l
163690060614    4c                   if        %found(fnblp01l)
163700060614     C                   Z-ADD     BLPMGS        WDSP
163710060614     C                   MOVEL     BLPAAS        WDSP
163720060614    5C     WDSP          IFGE      DPDDSP
163730061012     c     blpcca        andne     '7'
163740060614     C                   MOVEL     ERR(181)      VIDMSG
163750060614     C                   SETON                                        3090
163760060614    5C                   ENDIF
163770060614    4c                   endif
163780060614     C                   MOVEL     SAVBLP        DSBLP0
163790060613    3C                   ENDIF
163800060613    3C     W014a         IFGT      WNPR14
163810060613     C                   SETON                                        30
163820060613    3C                   ENDIF
163830060613    2C                   ENDIF
163840060613     C*
163850060613     C  N30WTRC          READE     Fiar403l                               30
163860060614    1c                   ENDDO
163870060614     c*
163880060614     c
163890060613     C     ENDDOP_imp    ENDSR
163900991012      *
163910991012      *--- CONVERTO IMPORTI VIDEATA FATTURAZIONE NON MODIFICATI ------*
163920991104     C     VARDIV        BEGSR
163930991012      *
163940991012      * CONTROLLO DIVISA
163950991012     C                   CLEAR                   DSLV16
163960991012     C                   CLEAR                   DTASV
163970991012     C                   MOVEL     'D'           D17FIM
163980991014     C     COMDFT        IFGT      *ZEROS
163990991014     C                   Z-ADD     COMDFT        D17DSP
164000991012     C                   ELSE
164010991028     C                   Z-ADD     BLPDSP        D17DSP
164020991012     C                   ENDIF
164030991012     C                   MOVEL     VIDDIV        D17DIV
164040991012      *
164050991012     C                   CALL      'FNLV16R'
164060991012     C                   PARM                    DSLV16
164070991012     C                   PARM                    DTASV
164080991104      *
164090991104     C                   MOVEL     D17DIV        VIDDIV
164100991012      *
164110991012     C     O17ERR        IFEQ      '7'
164120991012     C                   SETON                                        53
164130991028     C                   MOVEL     '1'           WEMFOR
164140991012     C     O17MSG        IFNE      *BLANKS
164150991015     C                   MOVEL     O17MSG        VIDMSG
164160991012     C                   SETON                                        90
164170991012    2C                   ENDIF
164180991012     C                   GOTO      ENDDIV
164190991012    2C                   ENDIF
164200991012      *
164210991012     C                   CLEAR                   WCONVE
164220991012     C                   CLEAR                   DTASV
164230991012      *
164240991012      * PORTO
164250991012     C     VIDPOR        IFGT      *ZEROS
164260991012    3C     VIDPOR        ANDEQ     MEMPOR
164270991012     C                   CLEAR                   DSYEUR
164280991012     C                   MOVEL     WDIV1         YECDVI
164290991012     C                   Z-ADD     VIDPOR        YECIMI
164300991012     C                   MOVEL     VIDDIV        YECDVO
164310991012     C     O17FDC        IFEQ      'S'
164320991012     C                   MOVEL     '3'           YECDCO
164330991012     C                   ENDIF
164340991012     C                   CALL      'YEURCO'
164350991012     C                   PARM                    DSYEUR
164360991028    4C     YECESI        IFEQ      ' '
164370991012     C                   Z-ADD     YECIMO        VIDPOR
164380991015     C                   MOVEL     'S'           WCONVE            1
164390991028    4C                   ENDIF
164400991028    3C                   ENDIF
164410991012      *
164420991012      * VARIE
164430991012     C                   DO        20            NRR
164440991012     C     NRR           CHAIN     LS01S03                            30
164450991012     C     V3CVA1        IFGT      *ZEROS
164460991012    3C     V3CVA1        ANDEQ     V3HVA1
164470991012     C                   CLEAR                   DSYEUR
164480991012     C                   MOVEL     WDIV1         YECDVI
164490991012     C                   Z-ADD     V3CVA1        YECIMI
164500991012     C                   MOVEL     VIDDIV        YECDVO
164510991012     C     O17FDC        IFEQ      'S'
164520991012     C                   MOVEL     '3'           YECDCO
164530991012     C                   ENDIF
164540991012     C                   CALL      'YEURCO'
164550991012     C                   PARM                    DSYEUR
164560991028    4C     YECESI        IFEQ      ' '
164570991012     C                   Z-ADD     YECIMO        V3CVA1
164580991012     C                   Z-ADD     YECIMO        V3HVA1
164590991019     C                   UPDATE    LS01S03
164600991012     C                   MOVEL     'S'           WCONVE
164610991028    4C                   ENDIF
164620991028    3C                   ENDIF
164630991012     C                   Z-ADD     NRR           C
164640991012      * CARICO SCHIERA VARIE X RICALCOLO TOT FATTURA
164650991012     C     VIDIMV        IFGT      *ZEROS
164660991012     C                   MOVEL     V3CSV1        VSV(C)
164670991012     C                   Z-ADD     V3CVA1        VVA(C)
164680991015     C                   MOVEL     V3CEV1        VES(C)
164690991012     C                   ENDIF
164700991012     C                   ENDDO
164710991012      *
164720991012      * SE CONVERTITI IMPORTI ED è IMPOSTATO IL TOTALE FATTURA LO RICALCOLO
164730991012     C     WCONVE        IFEQ      'S'
164740991028     C                   MOVEL     '1'           WEMFOR
164750991028     C     VIDIMV        IFGT      *ZEROS
164760991012     C                   CLEAR                   DSLV16
164770991012     C                   MOVEL     'T'           D17FIM
164780991012     C                   Z-ADD     VIDPOR        D17POR
164790991012     C                   CALL      'FNLV16R'
164800991012     C                   PARM                    DSLV16
164810991012     C                   PARM                    DTASV
164820991012     C                   ENDIF
164830991028     C                   ENDIF
164840991012      *
164850991012     C     O17ERR        IFEQ      *BLANKS
164860991012     C                   Z-ADD     O17IMV        VIDIMV
164870991012     C                   ELSE
164880991012     C                   CLEAR                   VIDIMV
164890991012     C                   ENDIF
164900991012      *
164910991012     C                   MOVEL     VIDDIV        WDIV1
164920991012     C                   Z-ADD     VIDPOR        MEMPOR
164930991012      *
164940991012     C     ENDDIV        ENDSR
164950991012      *
164960930331     C*--- CALCOLO IL VOLUME -----------------------------------------*
164970930331     C     CALVOL        BEGSR
164980930331     C                   MLLZO     1             VIDNCL
164990930331     C                   MLLZO     1             VIDVOL
165000940825     C                   MLLZO     1             V2CPKG
165010930331     C*
165020930401     C                   Z-ADD     0             VARVOL
165030941230     C* SE DA DISK CLIENTI E' PASSATO IL VOLUME E NON E' STATO VARIATO
165040941230     C* PRENDO IL FLG VOLUME PASSATO SE C'E'
165050941230     C   12
165060941230    1CAN 15VIDVOL        IFNE      0
165070941230     C                   MOVEL     VIDVOL        VARVOL
165080941230     C*
165090941230     C     VIDVOL        IFEQ      §LPVLB
165100941230     C                   MOVEL     §LPFVB        VIDFVR
165110941230     C                   ELSE
165120941230     C                   MOVEL     'R'           VIDFVR
165130941230    1C                   END
165140941230    1C                   END
165150930331     C*
165160941230    1C  N12VIDVOL        IFNE      0
165170930331     C                   MOVEL     'R'           VIDFVR
165180930401     C                   MOVEL     VIDVOL        VARVOL
165190941108    1C                   END
165200930331     C*
165210941108     C   12
165220941108    1CANN15VIDVOL        IFNE      BLPVLB
165230941108    2C     VIDVOL        IFNE      0
165240930401     C                   MOVEL     VIDVOL        VARVOL
165250930331     C                   MOVEL     'R'           VIDFVR
165260941108    2C                   END
165270930331     C*
165280941108   X1C                   ELSE
165290930331     C*
165300941107     C* IN MANUTENZIONE SE NON E' GIA' VOLUME REALE, RICALCOLO
165310941108    2C     §7TRVL        IFEQ      'R'
165320941107     C                   MOVEL     VIDVOL        VARVOL
165330941108    2C                   END
165340941108    1C                   END
165350930331     C*
165360930331     C*  CALCOLO VOLUME AUTOMATICO SE A ZEROS
165370940923    1C     VARVOL        IFEQ      0
165380941025     C                   CLEAR                   DSLV18
165390941025     C                   MOVEL     §3ATB1        D18TBL
165400941025     C                   MOVEL     'P'           D18TBO
165410941025     C                   MOVEL     BLPDSP        D18AAS
165420941025     C                   MOVE      BLPDSP        D18MGS
165430941108     C                   MOVEL     V2CPKG        D18PKF
165440941025     C                   MOVEL     VIDNCL        D18NCL
165450050415     c* se previsti bancali passo il numero colli originali
165460050415     c                   if        %subst(vidgva:1:1)='O'
165470050415     c                   z-add     w03cor        d18ncl
165480050415     c                   endif
165490940923     C* SE NON C'E' TARIFFA CLIENTE USO TARIFFA CARTELLO
165500941108    2C     WTKS          IFEQ      ' '
165510941025     C                   MOVEL     TARKSC        D18KSC
165520941025     C                   MOVEL     TARPRG        D18PRG
165530941025     C                   MOVEL     TARCTR        D18CTR
165540941025     C                   ELSE
165550941025     C                   MOVEL     WKSC          D18KSC
165560941025     C                   MOVEL     COMPRG        D18PRG
165570941025     C                   MOVEL     COMCTR        D18CTR
165580940923    2C                   ENDIF
165590020311     c     vidtsp        ifne      *blanks
165600020311     c                   movel     vidtsp        d18tsp
165610020311     c                   else
165620020311     c                   movel     comtsp        d18tsp
165630020311     c                   endif
165640020311     c     comlna        ifgt      *zeros
165650020311     c                   z-add     comlna        d18lna
165660020311     c                   else
165670020311     c                   movel     i27tln        d18tln
165680020311     c                   endif
165690020311     c                   z-add     vidlnp        d18lnp
165700020311     c
165710941025     C*
165720941025     C                   CALL      'FNLV18R'
165730941025     C                   PARM                    DSLV18
165740941025     C*
165750941108     C                   MOVEL     D18FVF        VIDFVR
165760941108     C                   MOVEL     D18VLF        VARVOL
165770930331     C                   END
165780941025     C*
165790941025     C* SE  VOLUME=0 IMPOSTO 0,001
165800930401     C     VARVOL        IFEQ      0
165810941024     C                   Z-ADD     0,001         VARVOL
165820930331     C                   END
165830930331     C                   ENDSR
165840940628     C*
165850940628     C* CALCOLO IL FLAG INOLTRO --------------------------------------*
165860940628     C     INOLTR        BEGSR
165870940628     C                   MOVEL     VIDFIN        WFIN
165880940628     C*
165890940628     C*   SE FERMO DEPOSITO E' SEMPRE ' '
165900940628    1C     VIDFFD        IFEQ      'S'
165910941110     C                   MOVEL     'C'           WFIN
165920940628     C*
165930940628   X1C                   ELSE
165940940628     C*
165950940628     C* CALCOLO  SE NON C'E' FORZATURA
165960940926    2C     WFIN          IFEQ      ' '
165970940919     C                   MOVEL     COMFIN        WFIN
165980940926    2C                   ENDIF
165990940926    1C                   ENDIF
166000940628     C                   ENDSR
166010000627     C*
166020000627     C* ASSEGNO NUMERO DI SEGNACOLLI ALLA BOLLA ----------------------*
166030000627     C     ASSSGN        BEGSR
166040000627     C* IN MANUTENZIONE  SE NUMERO COLLI < DIMINUISCO IL DAL
166050000627     C*  SE > RIASSEGNO I NUMERI
166060000627     C   12
166070000627     CANN15
166080000627    2CAN 25              DO
166090050428    3C     VIDNCL        IFLT      SAVNCL
166100000627     C     SAVNCL        SUB       VIDNCL        DIF               5 0
166110000627     C                   SUB       DIF           VIDNCA
166120000627     C* SE COLLO 1 AZZERO SEGNACOLLO AL
166130000627    4C     VIDNCA        IFEQ      VIDNCD
166140000627     C                   Z-ADD     0             VIDNCA
166150000627    4C                   END
166160000627    3C                   END
166170000627     C*
166180000627    3C     VIDNCL        IFGT      SAVNCL
166190000627    3C     SAVLNA        ORNE      VIDLNA
166200111026     c* Routine di memorizzazione vecchi segnacolli per scrittura R.A. prima
166210111026     c* di pulire VIDNCD e VIDNCA
166220111026     c                   exsr      sr_memRA
166230000627     C                   CLEAR                   VIDNCD
166240000627     C                   CLEAR                   VIDNCA
166250000627    3C                   END
166260000627    2C                   END
166270000627     C*
166280000627     C* SE SEGNACOLLI IMMESSI LI MEMORIZZO
166290000627     C*  SE DEVO STAMPARE SEGNACOLLO LI CALCOLO
166300000627    2C     VIDNCD        IFGT      0
166310000627     C                   MOVEL     VIDNCD        BLPNCD
166320000627     C                   MOVEL     VIDNCA        BLPNCA
166330000627   X2C                   ELSE
166340000627     C                   Z-ADD     0             BLPNCD
166350000627     C                   Z-ADD     0             BLPNCA
166360000627     C* PER CREAZIONE SEGNACOLLO
166370000627    3C     §1BFG8        IFEQ      'S'
166380000627    4C   25              DO
166390000627     C                   CLEAR                   AAS
166400000627     C                   Z-ADD     9             CNU
166410000627     C                   Z-ADD     VIDLNP        COMLIN
166420000627     C                   Z-ADD     COMLNA        LIV2
166430000627     C     KNUF2         CHAIN     FLNUF                              3031
166440000627     C*
166450000627     C   30              Z-ADD     0             BLPNCD
166460000627     C   30              Z-ADD     0             BLPNCA
166470000627     C*
166480000627     C     *IN31         IFEQ      *ON
166490000627     C                   SETON                                        90
166500000627     C                   MOVEL     ERR(42)       VIDMSG
166510000627     C                   MOVEL     '1'           WEMFOR
166520000627     C                   GOTO      ENDASS
166530000627     C                   ENDIF
166540000627     C*
166550000627    5C     *IN30         DOWEQ     *OFF
166560000627     C     NUFNUM        ADD       VIDNCL        BLPNCA
166570000627     C* SE SUPERO IL RANGE FINALE RICOMINCIO DA QUELLO INIZIALE
166580000627    6C     BLPNCA        IFGT      NUFRFI
166590000627     C                   Z-ADD     NUFRIN        NUFNUM
166600000627    6C                   END
166610000627     C*
166620000627     C     NUFNUM        ADD       1             COMSCD
166630000627     C     VIDNCL        ADD       NUFNUM        BLPNCA
166640000627     C*
166650000627     C* CONTROLLO SE ESISTONO GIA' SEGNACOLLI IN QUEL RANGE
166660000627     C*
166670000627    6C     COMSCD        DOWLE     BLPNCA
166680000627     C     COMSCD        ANDGT     0
166690120816     C***  KBLT          CHAIN     FNBLT27L                           30
166700120816     C***                if        not %found(fnblt27l)
166710120816     C     KBLT          CHAIN     FIART27L                           30
166720120816     C                   if        not %found(fIART27l)
166730080925     C     KBLT          CHAIN(N)  fiars01l                           30
166740120817     C**                 if        not %found(fiars01l)
166750120817     C**   KBLT          CHAIN     fnart27l                           30
166760120817     c**                 endif
166770080925     c                   endif
166780000627     C  N30              Z-ADD     COMSCD        NUFNUM
166790000627     C  N30              Z-ADD     BLPNCA        COMSCD
166800000627     C                   ADD       1             COMSCD
166810000627    6C                   END
166820000627     C*
166830000627     C   30NUFNUM        ADD       1             BLPNCD
166840000627     C   30              Z-ADD     BLPNCA        NUFNUM
166850000627     C   30              UPDATE    FLNUF
166860000627    5C                   END
166870000627     C*
166880000627     C* SE AL = DAL AZZERO IL CAMPO
166890000627    5C     BLPNCA        IFEQ      BLPNCD
166900000627     C                   Z-ADD     0             BLPNCA
166910000627    5C                   END
166920000627    4C                   END
166930000627     C*
166940000627   X3C                   ELSE
166950000627     C*
166960000627     C* PER BOLLE SENZA SEGNACOLLI
166970000627     C                   CLEAR                   BLPNCD
166980000627     C                   CLEAR                   BLPNCA
166990000627     C                   CLEAR                   BLPFLS
167000000627     C*
167010000627    3C                   END
167020000627    2C                   END
167030000627     C*
167040000627     C     ENDASS        ENDSR
167050000627     C*
167060000627     C* VEDO COME AGGIORNARE IL CAMPO AGGFST -------------------------*
167070000627     C     AGGFST        BEGSR
167080000627     C* ALLEGA BAM
167090000627     C** PER DISK CLIENTI VEDO SE DEVO STAMPARE LA BOLLA
167100000627     C                   EXSR      CTRSTA
167110000627     C**
167120000627     C*  S I    D D T
167130000627     C**
167140000627    1C     VIDBAM        IFEQ      'S'
167150000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
167160000627    2C     §1BFG3        IFEQ      'S'
167170000627     C                   MOVEL     'C'           BLPFST
167180000627     C                   ELSE
167190000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
167200000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
167210000627     C                   MOVEL     'S'           BLPFST
167220000627    2C                   ENDIF
167230000627     C*
167240000627   X1C                   ELSE
167250000627     C**
167260000627     C*  N O    D D T
167270000627     C**
167280000627     C                   SELECT
167290000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
167300000627    2C     §1BFG3        WHENEQ    'S'
167310000627     C                   MOVEL     'K'           BLPFST
167320000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
167330000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
167340000627    2C     §3ATB1        WHENEQ    'A3'
167350000627     C     WSTA          OREQ      ' '
167360000627     C     WSTA          OREQ      'S'
167370000627     C* SE BOLLA F3 FACCIO FINA CHE SIA STAMPATO MA IN REALTA' NON
167380000627     C*  LA STAMPO NEMMENO IN DIFFERITA PERCHE' NON SERVE
167390000627    2C     §3ATB1        OREQ      'F3'
167400000627     C                   MOVEL     'Y'           BLPFST
167410000627     C*
167420000627     C* SE E' BOLLA DPD IMPOSTO FLAG DI GIA' STAMPATO
167430140612     C***  A_§OGNTW      WHENEQ    'DPD'
167440000627     C* EXPORT NON DPD, GIA' STAMPATO
167450140612     c***  A_§ogntw      oreq      'EEX'
167460140612     c***  A_§ogntw      oreq      'EUP'
167470140612     c***  A_§ogntw      oreq      'FED'
167480000627     C* POSTE , GIA' STAMPATO
167490140612     c***  §ogntw        oreq      'PPT'
167500140612     c***  blpdsp        andlt     §vpoptl
167510140612     c                   when      A_§OGNTW='DPD'
167520140613     c                             or (A_§ogntw='EEX'
167530140612     c                             and (%lookup('999':sk_VPODIR)=0 and
167540140613     c                                 %lookup(%editc(blplnp:'X'):sk_VPODIR)=0))
167550000627     C                   MOVEL     'Y'           BLPFST
167560000627   X2C                   OTHER
167570000627     C*
167580000627     C* SE SONO IN VARIAZIONE BOLLA E NON HO MODIFICATO IL FLAG DDT
167590000627     C*  LASCIO QUELLO CHE C'ERA
167600000627     C                   MOVEL     'N'           BLPFST
167610000627    3C     *IN12         IFEQ      *ON
167620000627     C     *IN15         ANDEQ     *OFF
167630000627     C*
167640000627    4C     SAVBAM        IFEQ      'Y'
167650000627     C                   MOVEL     'Y'           BLPFST
167660000627    4C                   ENDIF
167670000627     C* SE ERA DPD E NON LO E' PIU', DEVO METTERE "N" PER FAR
167680000627     C*  STAMPARE LA BOLLA
167690020319    4C     SAVNTW        IFEQ      'DPD'
167700020319     C     A_§OGNTW      ANDNE     'DPD'
167710000627     C                   MOVEL     'N'           BLPFST
167720000627    4C                   ENDIF
167730000627     C* IN MANUTENZIONE DI UN PREPAGATO, IMPOSTO SEMPRE PER DDT NO,
167740000627     C*  DA STAMPARE
167750000627    4C     *IN22         IFEQ      *ON
167760000627     C                   MOVEL     'N'           BLPFST
167770000627    4C                   ENDIF
167780000627    3C                   ENDIF
167790000627     C**
167800000627    2C                   ENDSL
167810000627    1C                   ENDIF
167820000627     C                   ENDSR
167830900504     C*
167840900504     C*--- REGISTRAZIONE BOLLA ---------------------------------------*
167850090623     c     REGIS         begsr
167860940928     C* DPO LA PRIMA BOLLA MI POSIZIONO SEMPRE SUL MITTENTE
167870010222     C* SE ATTIVATA PROCEDURA ORM E SONO IN IMMISSIONE O MANUTENZIONE
167880010306     C* E NON SONO NEL GIRO DEI PREPAGATI MI POSIZIONO SEMPRE SUL N.ORM
167890010222     C     WORM          IFEQ      'S'
167900010222     C     PARTCH        ANDNE     'P'
167910010307     C     §LPFPR        ANDNE     'O'
167920010222     C     *IN12         ANDEQ     *OFF
167930010222     C     WORM          OREQ      'S'
167940010222     C     PARTCH        ANDNE     'P'
167950010307     C     §LPFPR        ANDNE     'O'
167960010222     C     *IN15         ANDEQ     *OFF
167970010222     C                   SETON                                        06
167980010222     C                   ELSE
167990940928     C                   SETON                                        07
168000010222     C                   ENDIF
168010010222     C*
168020950123     C                   CLEAR                   WRD2
168030900507     C* AZZERO CAMPI COMODO
168040940214     C                   CLEAR                   SAVFST
168050991014     C                   CLEAR                   DSLV04
168060991027     C                   CLEAR                   WSV1
168070991027     C                   CLEAR                   WVA1
168080991027     C                   CLEAR                   WSV2
168090991027     C                   CLEAR                   WVA2
168100991027     C                   CLEAR                   WSV3
168110991027     C                   CLEAR                   WVA3
168120001019     C                   CLEAR                   WSTSGN
168130070604     c                   clear                   wmsg_pda          1
168140070606     c                   clear                   w02pdr_p
168150111026     c                   clear                   RA_ncd
168160111026     c                   clear                   RA_nca
168170111026     c                   clear                   RA_ncl
168180111026     c                   clear                   RA_lna
168190941108     C*
168200930331     C*  VALORE POSITIVO DEI CAMPI NUMERI A VIDEO
168210920505     C                   MLLZO     1             VIDPOR
168220940926     C                   MLLZO     1             VIDNFT
168230940926     C                   MLLZO     1             VIDFIV
168240940926     C                   MLLZO     1             VIDRMN
168250940926     C                   MLLZO     1             VIDCAS
168260940825     C                   MLLZO     1             VIDIAS
168270940926     C                   MLLZO     1             VIDQFT
168280920505     C                   MLLZO     1             VIDNCD
168290920505     C                   MLLZO     1             VIDNCA
168300920505     C                   MLLZO     1             VIDHCR
168310940926     C                   MLLZO     1             VI2VA1
168320040116     c                   Mllzo     1             Vi2Va2
168330040116     c                   Mllzo     1             Vi2Va3
168340040116     c                   Mllzo     1             Vi2Va4
168350041217     c                   Mllzo     1             Vi2Va5
168360041217     c                   Mllzo     1             Vi2Va6
168370021218     c                   Mllzo     1             VidNba
168380021218     c                   Mllzo     1             VidNb2
168390060209     c* Le seguenti specifiche le ho spostate più sotto per permettere
168400060209     c* la storicizzazione delle variazioni dei prepagati, non potendo
168410060209     c* storicizzare ora dal momento che ci possono essere dei casi
168420060209     c* di uscita dalla routine senza registrare la bolla (v. goto
168430060209     c* endreg)
168440991006      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
168450991006      * IN FIAR700F
168460060209     C**   WAR7          IFEQ      'E'
168470060209     c**   war61         oreq      'E'
168480060209     c**   wkscsf1       andne     0000
168490060209     c**   wkscsf1       andne     9999
168500060209     C**                 MOVEL     '1'           WTRC
168510060209     C**   KBLP4         SETLL     FIAR7000
168520060209     C**   KBLP4         READE     FIAR7000                               30
168530991006      *
168540060209    2C**   *IN30         DOWEQ     *OFF
168550060209     C**                 DELETE    FIAR7000
168560060209     C**   KBLP4         READE     FIAR7000                               30
168570060209    2C**                 ENDDO
168580991006      *
168590060209     C**                 ENDIF
168600040116      * anche per la seconda bolla
168610060209if  1c****               If        War71 = 'E' or (war62 = 'E' and
168620060209     c****                         wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
168630060209     c****               Eval      Wtrc = '2'
168640060209     c**** Kblp4         Setll     Fiar7000
168650060209do  2c****               Do        *Hival
168660060209     c**** Kblp4         Reade     Fiar7000
168670060209     c****               If        %Eof(Fiar701l)
168680060209     c****               Leave
168690060209     c****               EndIf
168700060209     c****               Delete    Fiar7000
168710060209    2c****               EndDo
168720060209    1c****               EndIf
168730941115     C* PULISCO I FORMATI
168740060209     C***                CLEAR                   FIAR6000
168750060209     C***                CLEAR                   FIAR7000
168760051115     C                   CLEAR                   Fiar9000
168770900507     C*
168780900504     C                   Z-ADD     VIDLNP        BLPLNP
168790900504     C                   MOVEL     BLPDSP        BLPAAS
168800900504     C                   MOVE      VIDNRS        BLPNRS
168810940926     C                   MOVE      BLPDSP        BLPMGS
168820940926     C                   MOVEL     VIDCBO        BLPCBO
168830920410     C*
168840920410     C* DISK CLI: SE NON SI ASSEGNA NUMERAZ. SEGNAC. AZZERO SERIE
168850930628     C   12
168860930628    1CAN 15§1BFG2        IFEQ      'N'
168870980410     C     §1BFG6        ANDNE     'C'
168880910606     C                   Z-ADD     0             BLPNRS
168890950525     C* SE IL CTM ERA "%" --> IMPOSTO "§"
168900000214    2C     VIDSOP        IFEQ      '%'
168910950525     C                   MOVEL     '§'           VIDSOP
168920000214     C* SE E' DISK "C"    --> IMPOSTO ":"
168930050223     C     *IN79         IFEQ      *ON
168940050223    3C     WASDKC        ANDEQ     'S'
168950050223     C     §3CDKC        ANDEQ     'S'
168960000905     C     §1BF12        ORNE      'N'
168970001106     C     §1BF12        ANDNE     'E'
168980001106     C     §1BF12        OREQ      'E'
168990001106     C     WASDKC        ANDEQ     'S'
169000000214     C                   MOVEL     ':'           VIDSOP
169010000214    3C                   ENDIF
169020000214    2C                   ENDIF
169030950525    1C                   ENDIF
169040001013     C* SE VENGO DA CONFERMA DA DISCHETTO E NON È DISK B METTO SOP=: SE
169050001013     C* E' DISK C
169060001013     C   12
169070001013     CAN 15§1BFG1        IFNE      'S'
169080001013     C     WASDKC        ANDEQ     'S'
169090001013     C     §1BF12        ANDNE     'N'
169100001013     C                   MOVEL     ':'           VIDSOP
169110001013     C                   ENDIF
169120930624     C***
169130930624     C***   N U M E R O   S P E D I Z I O N E
169140920415     C                   SETOFF                                       30
169150921012     C* IN IMMISSIONE : SE NON E' BOLLA DI RECUPERO
169160990602    1C  N12PARTCH        IFEQ      'R'
169170921006     C                   Z-ADD     RECNSP        BLPNSP
169180930628   X1C                   ELSE
169190921006     C                   SETON                                        30
169200930628    1C                   END
169210921012     C*
169220921005     C* IN DISK CLI :  SE NON SI STAMPA LA BOLLA
169230921012     C*                O NON E' BOLLA DI RECUPERO
169240921012     C*                O NON MANTIENE NUM SPEDIZIONE
169250930628     C   12
169260930628    1CAN 15§1BFG3        IFNE      'S'
169270921005     C*
169280930628    2C     §3CFSP        IFEQ      'S'
169290921012     C     §1BFG2        ANDEQ     'S'
169300921012     C     §LPFPR        OREQ      'R'
169310971104     C**
169320971104    3C     VIDNSP        IFGT      0
169330921005     C                   Z-ADD     VIDNSP        BLPNSP
169340971104   X3C                   ELSE
169350971104     C** SE MANCA LO RIASSEGNO
169360971104     C** SE L'HO AZZERATO IN CARICAMENTO LO RIPRENDO DA DS
169370971104    4C     §LPNSP        IFGT      0
169380971104     C                   Z-ADD     §LPNSP        BLPNSP
169390971104     C                   ELSE
169400971104     C                   SETON                                        30
169410971104    4C                   ENDIF
169420971104    3C                   ENDIF
169430971104     C***
169440971104    3C     VIDNRS        IFEQ      0
169450971104     C                   Z-ADD     §LPNRS        BLPNRS
169460971104    3C                   ENDIF
169470971104     C**
169480930628   X2C                   ELSE
169490920415     C                   SETON                                        30
169500930628    2C                   END
169510921005     C*
169520930628   X1C                   ELSE
169530921005     C*
169540920421     C                   Z-ADD     VIDNSP        BLPNSP
169550930628    1C                   END
169560920415     C*
169570930628    1C     *IN30         IFEQ      *ON
169580951228     C                   MOVE      VIDDSP        AAS
169590910117     C                   Z-ADD     3             CNU
169600910117     C                   Z-ADD     VIDLNP        COMLIN
169610000509     C                   CLEAR                   WNUF2
169620000509     C* SE LNP POSTE METTO ANCHE LA SERIE ON CHIAVE
169630020319     C     §ogntw        IFEQ      'PPT'
169640000509     C                   Z-ADD     VIDNRS        WNUF2
169650000509     C                   ENDIF
169660921006     C* CHAIN FINO A QUANDO NON TROVO UN NUMERO LIBERO
169670930628    2C     *IN30         DOWEQ     '1'
169680000509     C     KNUFSP        CHAIN     FLNUF                              3031
169690951228     C* SE NON TROVATO IL NUMERATORE PROVO A CREARLO
169700000627     C*  NON LO FACCIO PER POSTE
169710020319     C     §ogntw        IFNE      'PPT'
169720000627     C     *IN30         ANDEQ     *ON
169730951228     C                   Z-ADD     CNU           PA4CNU
169740951228     C                   CALL      'FNLVCNR'
169750951228     C                   PARM                    PA4CNU
169760000509     C     KNUFSP        CHAIN     FLNUF                              3031
169770951228     C                   ENDIF
169780951228     C*
169790951228     C* SE ANCORA NON TROVATO ERRORE
169800940923     C   30              SETON                                        90
169810940923     C   30              MOVEL     ERR(39)       VIDMSG
169820020320     C* RECORD ALLOCATO
169830940923     C   31              SETON                                        90
169840940923     C   31              MOVEL     ERR(42)       VIDMSG
169850951228     C* PER ERRORE ESCO
169860950508     C   90              MOVEL     '1'           WEMFOR
169870921006     C   90              GOTO      ENDREG
169880921006     C*
169890900824     C                   ADD       1             NUFNUM
169900900824     C                   UPDATE    FLNUF
169910921006     C                   Z-ADD     NUFNUM        RECNSP
169920921006     C*
169930921006     C* 30 ON - SPED ESISTENTE FACCIO NUOVA CHAIN
169940940915     C     KNSP          SETLL     FNBLP01L                               30
169950040329      * devo controllare anche su titas che non ci sia già
169960040329      * una spedizione con lo stesso numero
169970040329     c                   If        Not *In30 and %Open(Titas30c)
169980040329     c     kNsp          Chain(n)  Titas30c
169990040329     c                   If        %Found(Titas30c)
170000040329     c                   Eval      *In30 = *On
170010040329     c                   EndIf
170020040329     c                   EndIf
170030040329
170040921006     C  N30              MOVEL     NUFNUM        BLPNSP
170050930628    2C                   ENDDO
170060040727   x1c                   Else
170070040727      * se bolla già presente su TITAS emetto errore bloccante
170080040727     c                   If        %Open(Titas30c)
170090040727     c                   Eval      recnsp = BlpNsp
170100040727     c     kNsp          Chain(n)  Titas30c
170110040727     c                   If        %Found(Titas30c)
170120040727     c                   Eval      VidMsg = Err(55)
170130040727     c                   Eval      *In90 = *On
170140040727     c                   Eval      wemfor = '1'
170150040727     c                   Goto      EndReg
170160040727     c                   EndIf
170170040727     c                   EndIf
170180930628    1C                   ENDIF
170190920410     C*
170200900827     C   12
170210900827     CANN15              MOVEL     VIDNSP        BLPNSP
170220940926     C*
170230940926     C* MEMORIZZO I CAMPI IMPOSTATI A VIDEO: SE BOLLA CON MAMMA
170240940926     C*  NON LI MEMORIZZO MA STAMPO SOLTANTO
170250051115     C                   MOVEL     VIDCAS        ar9CAS
170260011108     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO CONTRASSEGNO > 0
170270011108     C     VIDCAS        IFGT      *ZEROS
170280051115     C                   MOVEL     VIDVCA        ar9VCA
170290011113     C                   ELSE
170300051115     C                   CLEAR                   ar9VCA
170310011108     C                   ENDIF
170320050518     c* Se = *blanks, e forzabile da tabella TM --> forzo
170330051115     C                   MOVEL     VIDTIC        ar9TIC
170340091001     c                   clear                   w_ar5tic
170350111213     c                   if        vidcas>0
170360121022     c* per spedizioni export non valgono le seguenti forzature ma
170370121022     c* pilotano i tipi incasso abilitati come da tabella "1AX"
170380121022     c                             and a_§ogntw<>'DPD'
170390121022     c                             and a_§ogntw<>'EEX'
170400121022     c                             and a_§ogntw<>'FED'
170410071011     c                   select
170420071011     c                   when      vidtic=*blanks and §TMFTI<>*BLANKS
170430051115     C                   MOVEL     §TMfti        ar9tic
170440080625     C                   MOVEL     §TMfti        vidtic
170450090706     c* frozatura per destinatario particolare
170460111213     c                   when      vidtic=*blanks and
170470091002     c                             ot0err=*blanks and OT0X1TICF<>*blanks
170480090706     C                   MOVEL     OT0X1TICF     ar9tic
170490090706     C                   MOVEL     OT0X1TICF     vidtic
170500091001     c                   movel     ot0x1ticf     w_ar5tic
170510111213     c                   when      vidtic=*blanks
170520071008     c* Se = *blanks, e forzabile da tabella FSC --> forzo
170530090619     c* Se cliente abilitato da tabella CIC non devo forzare
170540090619     C                   CLEAR                   dsbs02
170550090619     C                   MOVEL     'C'           T02MOD
170560090619     C                   MOVEL     KNSIF         T02SIF
170570090619     C                   MOVEL     'CIC'         T02COD
170580090619     c                   if        vidflc=0
170590090622     c                   eval      t02ke1=%editc(vidlnp:'X')+%editc(vidccm:'X')
170600090619     c                   else
170610090619     c                   eval      t02ke1=%editc(vidflc:'X')+%editc(vidccm:'X')
170620090619     c                   endif
170630090619     C                   CALL      'TIBS02R'
170640090619     C                   PARM                    KPJBA
170650090619     C                   PARM                    dsbs02
170660090619      * Cliente non presente in tabella "CIC"
170670090619     c                   if        t02err<>*blanks
170680071008     C                   CLEAR                   dsbs02
170690071008     C                   MOVEL     'C'           T02MOD
170700071008     C                   MOVEL     KNSIF         T02SIF
170710071008     C                   MOVEL     'FSC'         T02COD
170720071008     c                   movel(P)  comlna        t02ke1
170730071008     C                   CALL      'TIBS02R'
170740071008     C                   PARM                    KPJBA
170750071008     C                   PARM                    dsbs02
170760071008    2C                   IF        T02ERR = *BLANKS and t02atb=*blanks
170770071008     C                   movel     'SC'          ar9tic
170780080625     C                   movel     'SC'          vidtic
170790071008    2C                   ENDIF
170800090619     c                   endif
170810071011     c                   endsl
170820111213     c                   endif
170830050518     c
170840941005     C***
170850941005     C***   N U M E R O   S E G N A C O L L I
170860941005     C                   MOVEL     WFLS          BLPFLS
170870971211     C                   MOVEL     COMLNA        VIDLNA
170880940926     C*
170890940926     C* MEMORIZZO SEGNACOLLI SE BOLLA SENZA MAMMA
170900940926    1C     §3ABCM        IFEQ      ' '
170910000627     C* ASSEGNO NUMERO DI SEGNACOLLI
170920000627     C                   EXSR      ASSSGN
170930000627     C     WEMFOR        IFEQ      '1'
170940000627     C                   GOTO      ENDREG
170950000627     C                   ENDIF
170960940926     C*
170970940926   X1C                   ELSE
170980940926     C* BOLLA CON MAMMA
170990950215     C                   CLEAR                   BLPFLS
171000940926     C                   CLEAR                   BLPNCD
171010940926     C                   CLEAR                   BLPNCA
171020051115     C                   CLEAR                   ar9TIC
171030051115     C                   CLEAR                   ar9CAS
171040051115     C                   CLEAR                   ar9VCA
171050940926    1C                   ENDIF
171060020320     c* Se bolla Export FedEx prelevo numeri AWB
171070020320     c     A_§ogntw      ifeq      'FED'
171080020320     c                   clear                   wawbini
171090020320     c* devo assegnare numeri awb fedex in immissione o conferma bolle
171100020320     c* SEMPRE oppure in manutenzione se è aumentato il numero dei colli
171110020320     c* oppure se è cambiata la linea di arrivo e la precedente era una
171120020320     c* linea non fedex
171130020320     c     *in12         ifeq      *off
171140020320     c     *in15         oreq      *on
171150020320     c     *in15         oreq      *off
171160020320     C     vidncl        andgt     savncl
171170020320     c     *in15         oreq      *off
171180020320     C     savntw        andne     'FED'
171190020320     c                   clear                   trul33ds
171200020320     c                   z-add     21            i33cnu
171210020320     c                   z-add     vidncl        i33num
171220020320     c                   movel     trul33ds      kpjbu
171230020320     c                   call      'TRUL33R'
171240020320     c                   PARM                    kpjba
171250020320     c                   movel     kpjbu         trul33ds
171260020320     c* se errore vado a fine routine
171270020320     c     o33err        ifgt      *zeros
171280020320     c                   seton                                        90
171290020320     c                   movel     '1'           wemfor
171300020320     c                   select
171310020320     c     o33err        wheneq    1
171320020320     c                   movel     err(250)      vidmsg
171330020320     c     o33err        wheneq    2
171340020320     c                   movel     err(251)      vidmsg
171350020320     c     o33err        wheneq    3
171360020320     c                   movel     err(252)      vidmsg
171370020320     c                   endsl
171380020320     c                   goto      endreg
171390020320     c                   endif
171400020320     c                   z-add     o33nri        wawbini
171410020320     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
171420051102     c* del ARS trk "F"
171430020320     c                   z-add     wawbini       wawb
171440020320     c                   endif
171450020320     c                   endif
171460010228     C* SE SONO IN IMMISSIONE DEI MIEI PREPAGATI RICHIAMO PGM DI IMM.
171470010227     C* ORM
171480010227     C     PARTCH        IFEQ      'P'
171490010227     C     VIDMAG        ANDNE     'S'
171500010307     C     WORM          ANDEQ     'S'
171510010713     C     §3ARBL        ANDNE     'R'
171520010227     C                   EXSR      RIEO05
171530010228     C                   CLEAR                   KPJBU
171540010227     C                   CALL      'FIOR05R'
171550010227     C                   PARM                    KPJBA
171560010228     C                   PARM                    DSOR05
171570010227     C* SE PREMUTO F3 VADO A FINE ROUTINE E RIEMETTO LA VIDEATA
171580010227     C     §RMERR        IFEQ      '3'
171590010227     C                   MOVEL     '1'           WEMFOR
171600010227     C                   GOTO      ENDREG
171610010227     C                   ENDIF
171620010227     C                   ENDIF
171630001024     C*
171640060215     C* SE ANNO SPEDIZIONE E ANNO DI VAD SONO <> SISTEMO Fiar4 E
171650970107     C*  EDRDE01L
171660060215     c* 15/02/2006: Non si deve più aggiornare ar4 perchè è stato
171670060215     c* sostituito dal vat. Bisogna però continuare ad aggiornare EDRDE
171680060215     c* per bolle import
171690060215     C*****              CLEAR                   WESRDE
171700970107     C   12
171710970107    1CAN 15§1BFG3        IFEQ      'S'
171720970107     C*
171730970107     C     §3CFSP        OREQ      'S'
171740970107     C     §1BFG2        ANDEQ     'S'
171750970107     C*
171760060216     C* SE NON C'E' IL VAD RICONTROLLO KAAS CON Fiar4
171770060216     c* non serve più: ora l'informazione viene passata col vat
171780970107     C*
171790970407    2C     §LPAAC        IFNE      §LPAAS
171800060215     C**   KBLC4         CHAIN     Fiar401L                           31
171810060215    3C**   *IN31         DOWEQ     *OFF
171820060215     C**                 Z-ADD     §LPAAS        ar4AAS
171830060215     C**                 UPDATE    Fiar4000
171840060215     C**                 MOVEL     'S'           WESRDE            1
171850060215     C***  KBLC4         READE     Fiar401L                               31
171860060215    3C**                 ENDDO
171870970107     C*
171880060215    3C**** WESRDE        IFEQ      'S'
171890060215    3c                   if        §ogntw = 'EEX' or §ogntw = 'FED' or
171900081008     c                             §ogntw = 'DPD'
171910970107     C**
171920970107    4C     WOPRDE        IFEQ      ' '
171930970107     C                   OPEN      EDRDE01L
171940970107     C                   MOVEL     'S'           WOPRDE            1
171950970107    4C                   ENDIF
171960970107     C**
171970970107     C     KBLC4         CHAIN     EDRDE01L                           31
171980970107    4C     *IN31         DOWEQ     *OFF
171990970107     C                   Z-ADD     §LPAAS        RDEAAS
172000970107     C                   UPDATE    EDRDE000
172010970107     C     KBLC4         READE     EDRDE01L                               31
172020970107    4C                   ENDDO
172030970107    3C                   ENDIF
172040970107    2C                   ENDIF
172050970107     C*
172060970107    1C                   ENDIF
172070060209     c*
172080060209     c* STORICIZZAZIONI PER PREPAGATI
172090060209     c* Se cvb <> *blanks significa che è stata richiesta una variazione
172100060209     c* da gestire
172110060209     c                   if        ilv85cvb <> *blanks
172120060209     c* -- Storicizzazione variazione --
172130060209     c                   if        §7lfsa = 'S'
172140060209     c* se variazione da storicizzare e si tratta di variazione di
172150060209     c* tassazione memorizzo fiar6 e fiar7 prima di cancellare
172160060209     c* La write verrà eseguita prima della write di fnblp
172170060209     c                   if        ilv85cvb = 'TR'
172180060209     c                   clear                   fiarbt00
172190060209     c                   movel     knmus         arbpru
172200060209     c                   z-add     dateu         arbdtv
172210060209     c                   time                    arborv
172220060209     c                   movel     ilv85cvb      arbcvb
172230060209     c                   movel     '1'           arbtrc
172240060209     c                   exsr      stoarb
172250060209     c                   endif
172260060209     c                   endif
172270060209     c* -- Storicizzazione motivo variazione --
172280060209     c                   if        §7lmtv = 'S'
172290070604     c*                  movel     'L'           ilv85tla
172300070604     c                   movel     ' '           ilv85tla
172310060209     c                   movel     'R'           ilv85tel
172320060209     c                   z-add     arbdtv        ilv85dac
172330060209     c                   z-add     arborv        ilv85orc
172340060209     c                   z-add     blpaas        ilv85aas
172350060209     c                   z-add     blplnp        ilv85lnp
172360060209     c                   z-add     blpnrs        ilv85nrs
172370060209     c                   z-add     blpnsp        ilv85nsp
172380060307     c                   movel     olv85mtv      ilv85mtv
172390060307     c                   movel     olv85nt1      ilv85nt1
172400060307     c                   movel     olv85nt2      ilv85nt2
172410060209     c                   movel     fnlv85ds      kpjbu
172420060209     c                   call      'FNLV85R'
172430060209     c                   parm                    kpjba
172440060210     c                   movel     kpjbu         fnlv85ds
172450060209     c                   endif
172460060209     c                   endif
172470060209      *
172480060209      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
172490060209      * IN FIAR700F
172500060209     C     WAR7          IFEQ      'E'
172510060209     c     war61         oreq      'E'
172520060209     c     wkscsf1       andne     0000
172530060209     c     wkscsf1       andne     9999
172540060209     C                   MOVEL     '1'           WTRC
172550060209     C     KBLP4         SETLL     FIAR7000
172560060209     C     KBLP4         READE     FIAR7000                               30
172570060209      *
172580060209    2C     *IN30         DOWEQ     *OFF
172590060209     C                   DELETE    FIAR7000
172600060209     C     KBLP4         READE     FIAR7000                               30
172610060209    2C                   ENDDO
172620060209      *
172630060209     C                   ENDIF
172640060209      * anche per la seconda bolla
172650060209if  1c                   If        War71 = 'E' or (war62 = 'E' and
172660060209     c                             wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
172670060209     c                   Eval      Wtrc = '2'
172680060209     c     Kblp4         Setll     Fiar7000
172690060209do  2c                   Do        *Hival
172700060209     c     Kblp4         Reade     Fiar7000
172710060209     c                   If        %Eof(Fiar701l)
172720060209     c                   Leave
172730060209     c                   EndIf
172740060209     c                   Delete    Fiar7000
172750060209    2c                   EndDo
172760060209    1c                   EndIf
172770060209     C* PULISCO I FORMATI
172780060209     C                   CLEAR                   FIAR6000
172790060209     C                   CLEAR                   FIAR7000
172800940926     C***
172810941108     C*
172820940926     C***  T O T A L E   F A T T U R A
172830940926    1C     VIDNFT        IFGT      0
172840990630     C     *IN34         OREQ      *ON
172850941108     C*
172860120109     c* Qui non viene impostato comdft prima di richiamare totfat
172870120109     c* In caso di immissione di un prepagato il comdft in questo
172880120109     c* momento è = 0 (viene azzerato all'uscita dal FNLV16R) e
172890120109     c* viene quindi passata data fattura=0 al pgm fnlv04r.
172900120109     c* Nei periodi a cavallo di cambio aliquota IVA non è comunque
172910120109     c* un problema visto che il pgm FNLV04R se riceve data fattura=0,
172920120109     c* sceglie l'aliquota iva per il calcolo in base alla data del giorno
172930990630     C                   EXSR      TOTFAT
172940941108     C*
172950941108     C* SE E' UN ASSEGNATO MEMORIZZO TUTTI I CAMPI DELLA TASSAZIONE
172960990629     C*  OPPURE SE E' UN PREPAGATO
172970941108     C     *IN04         IFEQ      *ON
172980990629     C     *IN34         OREQ      *ON
172990941108     C                   ADD       D04BOL        DB0ESE
173000941108     C                   Z-ADD     D04IFT        DB0IFT
173010990701     C                   Z-ADD     D04IVA        DB0IVA
173020990701     C                   Z-ADD     D04IMV        VIDIMV
173030991130     C                   Z-ADD     VIDIMV        DB0IMV
173040990630     C                   Z-ADD     D04POR        VIDPOR
173050991014     C                   Z-ADD     D04POR        MEMPOR
173060941108    2C                   ENDIF
173070990630     C**
173080990630     C* REPERISCO: PO IVA, NUMERO E DATA FATTURA
173090990630    2C     *IN34         IFEQ      *ON
173100990630     C     KNUM          CHAIN     CNNUM000                           30
173110990630    3C     *IN30         IFEQ      *OFF
173120990630     C                   ADD       1             NUMNUM
173130990630     C                   Z-ADD     NUMNUM        VIDNFT
173140990630     C                   MOVE      DATEU         NUMDTP
173150990630     C                   UPDATE    CNNUM000
173160990630   X3C                   ELSE
173170990630     C                   Z-ADD     0             VIDNFT
173180990630    3C                   ENDIF
173190990630     C                   Z-ADD     FIV           VIDFIV
173200990630     C                   Z-ADD     DATEU         COMDFT
173210990630    2C                   ENDIF
173220941108    1C                   ENDIF
173230940926     C*
173240940926     C* SE ESISTE ALMENO UNA VARIA LEGGO IL SFL E GIA' CHE CI SONO
173250940926     C*  IMPOSTO GIA' I CAMPI DELLA TASSAZIONE
173260940926     C                   Z-ADD     1             NRR
173270941108     C                   Z-ADD     1             C
173280991014    1C     WESVAR        IFNE      ' '
173290940926     C*
173300941108    2C                   DO        20            NRR
173310940926     C     NRR           CHAIN     LS01S03                            30
173320991014      *
173330941108    3C     *IN30         IFEQ      *OFF
173340941108     C     V3CSV1        ANDNE     ' '
173350991014      * ESENTE: SOMMO AL TOTALE FATTURA SE E' DA IMPOSTARE
173360940926    4C     V3CEV1        IFNE      ' '
173370940926     C     VIDNFT        ANDGT     0
173380941108     C                   ADD       V3CVA1        DB0ESE
173390991130     C                   SUB       V3CVA1        DB0IMV
173400940926    4C                   ENDIF
173410991014      * SCRIVO VARIE
173420991014     C                   EXSR      WRTVAR
173430940926    3C                   ENDIF
173440940926    2C                   ENDDO
173450991014      *
173460940926    1C                   ENDIF
173470991014      *
173480991014      * SE IMPOSTATA L'IVA SCRIVO VARIA
173490991014     C     D04IVA        IFGT      *ZEROS
173500991014     C                   MOVEL     §$2IVA        V3CSV1
173510991014     C                   Z-ADD     D04IVA        V3CVA1
173520991014     C                   EXSR      WRTVAR
173530991014     C                   ENDIF
173540991014      * SE IMPOSTATO IL BOLLO SCRIVO VARIA, IN DB0ESE è GIA' STATA SOMMATA
173550991014     C     D04BOL        IFGT      *ZEROS
173560991014     C                   MOVEL     §$2BOL        V3CSV1
173570991014     C                   Z-ADD     D04BOL        V3CVA1
173580991014     C                   EXSR      WRTVAR
173590991014     C                   ENDIF
173600991027      *
173610991027      * SE PIENA UNA VARIA O ANTICIPATA O NUMERO FATTURA O PORTO
173620991027      *  O INOLTRO O DIRITTO FISSO O ESENZ.IVA  --> SCRIVO FIAR600F
173630991006      *
173640991006      * Se agganciata precedentemente riaggancio file tassazione per 1a bolla
173650991006     C     WAR61         IFEQ      'E'
173660991006     C                   MOVEL     '1'           WTRC
173670050331     c* se presente cod.Segue fattura significa che era stata tassata
173680050331     c* in arrivo --> DELETO la tassazione dell'arrivo
173690050331     c                   if        wKSCsf1 <> 0000 and wKSCsf1 <> 9999
173700050331     c     kblp4         delete    fiar6000
173710050331     c                   clear                   war61
173720050331     c                   else
173730991006     C     KBLP4         CHAIN     FIAR6000                           30
173740050331     c                   endif
173750991006     C                   ENDIF
173760991006      *
173770941108    1C     VIDDFT        IFGT      0
173780051116     C     wsv1          ORNE      ' '
173790051116     C     wsv2          ORNE      ' '
173800051116     C     wsv3          ORNE      ' '
173810051116     C     VIDCEI        ORNE      ' '
173820940926     C     VIDPOR        ORNE      0
173830991202     C*          VIDANT    ORNE 0
173840991006     C                   MOVEL     '1'           AR6TRC
173850991006     C                   Z-ADD     BLPAAS        AR6AAS
173860991006     C                   Z-ADD     BLPLNP        AR6LNP
173870991006     C                   Z-ADD     BLPNRS        AR6NRS
173880991006     C                   Z-ADD     BLPNSP        AR6NSP
173890991006     C                   Z-ADD     VIDPOR        AR6POR
173900991006     C                   Z-ADD     VIDIMV        AR6IMV
173910991006     C                   MOVEL     VIDCEI        AR6CEI
173920991027      *
173930991027     C                   MOVEL     WSV1          AR6SV1
173940991027     C                   Z-ADD     WVA1          AR6VA1
173950991027     C                   MOVEL     WSV2          AR6SV2
173960991027     C                   Z-ADD     WVA2          AR6VA2
173970991027     C                   MOVEL     WSV3          AR6SV3
173980991027     C                   Z-ADD     WVA3          AR6VA3
173990991027      *
174000120104      * L'aliquota iva la memorizzo solo se presente numero fattura
174010991006      * SE ESENZIONE NON MEMORIZZO L'ALIQUOTA
174020120104     c                   if        vidnft>0
174030941108    2C     VIDCEI        IFEQ      *BLANKS
174040120109     c                   if        comdft>§qtdsa
174050991006     C                   Z-ADD     §QTALI        AR6ALI
174060120104     c                   else
174070120104     C                   Z-ADD     §QTALO        AR6ALI
174080120104     c                   endif
174090941108   X2C                   ELSE
174100991006     C                   MOVEL     *ZEROS        AR6ALI
174110941108    2C                   ENDIF
174120120104     c                   endif
174130991006     C                   Z-ADD     D04IFT        AR6IFT
174140991006     C                   Z-ADD     VIDFIV        AR6FIV
174150991006     C                   Z-ADD     VIDNFT        AR6NFT
174160991006     C                   Z-ADD     COMDFT        AR6DFT
174170991015     C                   MOVEL     VIDDIV        AR6DIV
174180991015      * IMPOSTO FLAG DI TOTALE IMPONIBILE INSERITO IN PARTENZA
174190991015     C     AR6IMV        IFGT      *ZEROS
174200991015     C                   MOVEL     'P'           AR6FIM
174210991015     C                   ELSE
174220991015     C                   CLEAR                   AR6FIM
174230991015     C                   ENDIF
174240991015      * PER ASSEGNATI IMPOSTO CODICE DI FATTURAZIONE
174250991015     C                   CLEAR                   AR6CTR
174260991015     C     *IN04         IFEQ      *ON
174270991022     C                   MOVE      9999          AR6KSC
174280991022     C                   MOVEL     AR6LNP        AR6KSC
174290991015     C                   ELSE
174300991015     C                   CLEAR                   AR6KSC
174310991015     C                   ENDIF
174320991006      *
174330991015      *
174340991006     C     WAR61         IFEQ      'E'
174350991006     C                   UPDATE    FIAR6000
174360940926     C                   ELSE
174370991006     C                   WRITE     FIAR6000
174380940926     C                   ENDIF
174390941108     C*
174400941108     C* DATI PER STAMPA
174410990629     C* PER ASEGNATO O FRANCO PREPAGATO
174420941108     C     *IN04         IFEQ      *ON
174430990629     C     *IN34         OREQ      *ON
174440941108     C                   MOVEL     VIDCEI        DB0CEI
174450991014     C                   MOVEL     V3DCEI        DB0DCE
174460991014     C                   MOVEL     VIDDIV        DB0DIV
174470991014     C                   MOVEL     WFDC1         DB0FDC
174480941108     C                   Z-ADD     VIDIMV        DB0IMV
174490941108     C                   ENDIF
174500021209      * Per prepagato stampo sempre i dati della fattura
174510021209     c                   If        *In34
174520941108     C                   Z-ADD     VIDNFT        DB0NFT
174530941108     C                   Z-ADD     COMDFT        DB0DFT
174540941108     C                   ENDIF
174550940926     C*
174560940926   X1C                   ELSE
174570991006     C* SE NON DEVO SCRIVERE IL RECORD FIAR6 E C'ERA --> DELETO
174580991006    2C     WAR61         IFEQ      'E'
174590991006     C                   DELETE    FIAR6000
174600940926    2C                   ENDIF
174610940926    1C                   ENDIF
174620930624     C***
174630940919     C***  F L A G   I N O L T R O
174640940628     C                   EXSR      INOLTR
174650940628     C                   MOVEL     WFIN          BLPFIN
174660930624     C***
174670930624     C***  L I N E A   D I   A R R I V O
174680940628     C                   MOVEL     COMLNA        BLPLNA
174690930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
174700941107     C* CAMPI PER LA STAMPA BOLLA
174710941107     C                   MOVEL     ORGFAG        DB0FAG
174720941107     C                   MOVEL     ORGDES        DB0DLA
174730941107     C                   MOVEL     ORGIND        DB0INL
174740941107     C                   MOVEL     ORGLOC        DB0LOL
174750941107     C                   MOVEL     ORGPRO        DB0PRL
174760941107     C                   MOVEL     ORGTEL        DB0TEL
174770941107     C                   MOVEL     ORGFAX        DB0FAX
174780100319     c* Mancava l'impostazione del CAP db0CAL ma lo lascio vuoto perchè
174790100319     c*  così capiamo che si tratta di LVD stampata in partenza che
174800100319     c*  non dovrebbe mai essere usata per la consegna
174810941107     C*
174820910426     C* DESCRIZIONE LINEA ARRIVO PER SEGNACOLLO
174830930628    1C     ORGDE5        IFNE      *BLANKS
174840000208     C                   MOVEL     ORGDE5        WDLA
174850910426     C                   ELSE
174860000208     C                   MOVEL     ORGDES        WDLA
174870930628    1C                   END
174880001024     C                   MOVE      COMTFA        BLPTFA
174890971202     C* BLPFEA: TERMINAL DI PARTENZA DELLA LINEA DI ARRIVO
174900971202     C                   CLEAR                   DSLV55
174910971202     C                   MOVEL     'P'           D55TPT
174920971202     C                   MOVEL     COMLNA        D55LIN
174930971202     C                   MOVEL     BLPDSP        D55DRF
174940971202     C                   CALL      'FNLV55R'
174950971202     C                   PARM                    DSLV55
174960971202     C     D55ERR        IFEQ      ' '
174970971202     C                   MOVEL     D55TFP        BLPFEA
174980971202     C                   ELSE
174990971202     C                   MOVEL     COMLNA        BLPFEA
175000971202     C                   ENDIF
175010910201     C*
175020971202     C* TERMINAL DI PARTENZA
175030960130     C                   MOVEL     COMTFP        BLPTFP
175040111128     C                   MOVEL     comtfp        BLPFLE
175050940919     C***
175060940919     C***  M I T T E N T E
175070940919     C* SE ASSEGNATO SCRIVO 9999 NEL CODICE SPEDIZIONE
175080940919     C*  E IL MITTENTE, SE CODIFICATO, IN BLPCCM
175090940919     C                   CLEAR                   BLPCCM
175100940919    1C     *IN04         IFEQ      *ON
175110940919     C                   Z-ADD     9999          BLPKSC
175120940919     C                   MOVEL     BLPLNP        BLPKSC
175130940919     C*
175140940919    2C     VIDCCM        IFNE      9999
175150940919     C                   Z-ADD     VIDCCM        BLPCCM
175160940919     C*
175170940927    3C     VIDFLC        IFEQ      0
175180940919     C                   MOVEL     VIDLNP        BLPCCM
175190940919     C                   ELSE
175200940919     C                   MOVEL     VIDFLC        BLPCCM
175210940927    3C                   ENDIF
175220940927    2C                   ENDIF
175230940919    1C                   ENDIF
175240940919     C*
175250940919     C* SE FRANCO CODICE SEMPRE IL BLPKSC
175260941103     C     *IN04         IFEQ      *OFF
175270940919     C                   Z-ADD     VIDCCM        BLPKSC
175280940919     C     VIDFLC        IFEQ      0
175290940919     C                   MOVEL     VIDLNP        BLPKSC
175300940919     C                   ELSE
175310940919     C                   MOVEL     VIDFLC        BLPKSC
175320940919     C                   ENDIF
175330940919     C                   ENDIF
175340940919     C*
175350900504     C                   MOVEL     VIDRSM        BLPRSM
175360900504     C                   MOVEL     VIDINM        BLPINM
175370900504     C                   MOVEL     VIDCAM        BLPCAM
175380900504     C                   MOVEL     VIDLOM        BLPLOM
175390900504     C                   MOVEL     VIDPRM        BLPPRM
175400930202     C                   MOVEL     *BLANKS       BLPCPI
175410940919     C                   MOVEL     VIDNZM        BLPNZM
175420050114     c* flag unificazione spedizioni impostato solo se provengo da
175430050114     c* conferma bolle da cliente
175440130301     c  n12              clear                   blpxco
175450050114     c                   if        *in12 and *in15
175460050114     c                   eval      blpxco = wxco
175470050114     c                   endif
175480941221     C* MERCE PORTATA A MAGAZZINO
175490990915     C     *IN34         IFEQ      *ON
175500990915     C     VIDPDR        ANDLE     *ZEROS
175510001024     C                   MOVEL     VIDMAG        BLPFDN
175520990915     C                   ELSE
175530941221     C                   MOVEL     APDFCM        BLPFDN
175540990915     C                   ENDIF
175550950626     C* P A R T I T A   I V A
175560950626     C*
175570950626     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
175580950626     C*     NELLA P.IVA
175590950626     C     VIDISM        IFEQ      '$$'
175600950626     C     VIDCPM        ANDEQ     *BLANKS
175610950626     C                   MOVEL     'PRIVATO'     VIDCPM
175620950626     C                   ENDIF
175630950626     C     VIDISD        IFEQ      '$$'
175640950626     C     VIDCPD        ANDEQ     *BLANKS
175650950626     C                   MOVEL     'PRIVATO'     VIDCPD
175660950626     C                   ENDIF
175670950626     C*
175680941103     C  N04VIDISM        IFEQ      *BLANKS
175690940927     C                   MOVEL     VIDCPM        BLPCPI
175700940927     C                   ELSE
175710940927     C                   MOVEL     VIDPIM        BLPCPI
175720940927     C                   ENDIF
175730940927     C   04VIDISD        IFEQ      *BLANKS
175740940927     C                   MOVEL     VIDCPD        BLPCPI
175750940927     C                   ELSE
175760940927     C                   MOVEL     VIDPID        BLPCPI
175770940927     C                   ENDIF
175780950303     C*
175790950303     C* SE BOLLA DIRETTA ALL'ESTERO SCRIVO LE P.IVA
175800950303    1C     WDESIE        IFEQ      'E'
175810100119     c* Se c'e' esenzione IVA seconda bolla, memorizzo la partita IVA
175820100119     c     vi2cei        orne      ' '
175830100119     c* In manutenzione la devo cancellare se non è estero e non c'e' esenz.IVA
175840971230     C     *IN12         OREQ      *ON
175850971230     C     *IN15         ANDEQ     *OFF
175860971230     C     WDESIE        ANDNE     'E'
175870100119     C     vi2cei        andeq     ' '
175880950303     c*
175890971222     C                   CLEAR                   D19NT1
175900950303     C     VIDISD        IFEQ      *BLANKS
175910950303     C                   MOVEL     VIDCPD        W016A
175920950303     C                   ELSE
175930950303     C                   MOVEL     VIDPID        W016A            16
175940950303     C                   ENDIF
175950950303     C*
175960950303     C                   MOVE      W016A         D19NT1
175970950303     C*
175980950303     C     VIDISM        IFEQ      *BLANKS
175990950303     C                   MOVEL     VIDCPM        W016A
176000950303     C                   ELSE
176010950303     C                   MOVEL     VIDPIM        W016A            16
176020950303     C                   ENDIF
176030950303     C*
176040971222     C                   MOVEL     W016A         D19NT1
176050100119     c
176060100119     c                   if        *in12 and not *in15
176070100119     c                             and WDESIE<>'E' and vi2cei=' '
176080100119     C**   12
176090100119     C**ANN15WDESIE        IFNE      'E'
176100971230     C                   CLEAR                   D19NT1
176110971230     C                   ENDIF
176120060216     C                   MOVEL     'T'           D19ftr
176130950303     C                   MOVEL     BLPAAS        D19AAS
176140950303     C                   MOVEL     BLPLNP        D19LNP
176150950303     C                   MOVEL     BLPNRS        D19NRS
176160950303     C                   MOVEL     BLPNSP        D19NSP
176170950303     C                   MOVEL     'P'           D19TRC
176180950303     C                   CLEAR                   D19NT2
176190950303     C                   CALL      'FNLV19R'
176200950303     C                   PARM                    DSLV19
176210950303     C                   ENDIF
176220061110     c* Codice Fiscale mittente se inserito per prepagati non codificati
176230061110     c                   if        (*in34 and vidcdf<>*blanks) or
176240061110     c                             (not *in34 and *in22)
176250061110     C                   CLEAR                   D19NT1
176260061110     c                   movel     vidcdf        d19nt1
176270061110     C                   MOVEL     'T'           D19ftr
176280061110     C                   MOVEL     BLPAAS        D19AAS
176290061110     C                   MOVEL     BLPLNP        D19LNP
176300061110     C                   MOVEL     BLPNRS        D19NRS
176310061110     C                   MOVEL     BLPNSP        D19NSP
176320061110     C                   MOVEL     'Q'           D19TRC
176330061110     C                   CLEAR                   D19NT2
176340061110     C                   CALL      'FNLV19R'
176350061110     C                   PARM                    DSLV19
176360061110     C                   ENDIF
176370940919     C***
176380940919     C***  D E S T I N A T A R I O
176390900504     C                   MOVEL     VIDRSD        BLPRSD
176400950123     C                   MOVE      VIDRSD        WRD2             35
176410941025     C*
176420940919     C* SE SCRITTA ANCHE 2 RAGIONE SOCIALE DESTINATARIO
176430940919     C*  SCRIVO IL FILE DI ESTENSIONE DESCRIZIONI SE SUPERA IL MINIMO
176440940919     C*  CARATTERI PREVISTI  (CAMPO §7KMNC)
176450941025     C*  IN MANUTENZIONE VADO SEMPRE, PER IL RESTO SOLO SE IMMESSA
176460941025     C     *IN12         IFEQ      *ON
176470941025     C     *IN15         ANDEQ     *OFF
176480950123    2C     WRD2          ORNE      *BLANKS
176490060216     C                   MOVEL     'T'           D19ftr
176500941025     C                   MOVEL     BLPAAS        D19AAS
176510941025     C                   MOVEL     BLPLNP        D19LNP
176520941025     C                   MOVEL     BLPNRS        D19NRS
176530941025     C                   MOVEL     BLPNSP        D19NSP
176540941025     C                   MOVEL     'D'           D19TRC
176550971219     C                   MOVEL(P)  WRD2          D19NT1
176560941025     C                   CLEAR                   D19NT2
176570941025     C                   CALL      'FNLV19R'
176580941025     C                   PARM                    DSLV19
176590941025     C                   ENDIF
176600900504     C                   MOVEL     VIDIND        BLPIND
176610900504     C                   MOVEL     VIDCAD        BLPCAD
176620060705     c* se spedizione export DPD diretta in Portogallo devo aggiungere al
176630060705     c* cap immesso tanti 0 a dx quanti ne servono per arrivare ad una
176640060705     c* lunghezza di cap di 7 byte
176650060705     c                   if        a_§ogntw='DPD' and vidnzd = 'P  '
176660060705     c     ' '           checkr(e) blpcad:7      NN                1 0
176670060705     c                   if        %found
176680060705     c                   eval      %subst(blpcad:nn+1:7-nn)=*all'0'
176690060705     c                   endif
176700060705     c                   endif
176710900504     C                   MOVEL     VIDLOD        BLPLOD
176720900504     C                   MOVEL     VIDPRD        BLPPRD
176730940919     C                   MOVEL     VIDNZD        BLPNZD
176740140612     c* se spedizione export e presente la provincia la tengo solo se
176750140612     c* è obbligatoria come da tabella nazione
176760140612     c                   if        blpnzd<>*blanks
176770140612     C                   MOVEL     '15'          COD
176780140612     C                   MOVEL(P)  BLPNZD        KEY
176790140612     C                   EXSR      CTABEL
176800140612     C   30              CLEAR                   DS15
176810140612     C  N30              MOVEL     TBLUNI        DS15
176820140612     c                   if        §15sto<>'S'
176830140612     c                   clear                   blpprd
176840140612     c                   endif
176850140612     c                   endif
176860940919     C*
176870900504     C                   MOVEL     VIDGC1        BLPGC1
176880900504     C                   MOVEL     VIDGC2        BLPGC2
176890900504     C                   MOVEL     VIDCTR        BLPCTR
176900900613     C                   MOVEL     SAVCTS        BLPCTS
176910911008     C                   MOVEL     VIDFBR        BLPFBR
176920000627     C*
176930000627     C* ALLEGA BAM
176940000627     C                   EXSR      AGGFST
176950950127     C*
176960960118     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
176970951009     C                   CLEAR                   BLPFTM
176980950127     C   04SAVFTM        IFEQ      'S'
176990950127     C     VIDFTM        OREQ      'S'
177000950127     C                   MOVEL     'S'           BLPFTM
177010950127     C                   ENDIF
177020950127     C*
177030941230     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
177040941230    2C     APDFCM        IFNE      ' '
177050941230     C                   MOVEL     'C'           BLPFAP
177060941230     C                   ELSE
177070941230     C                   MOVEL     COMFAP        BLPFAP
177080941230    2C                   END
177090940922     C* SE NON IMMESSO TIPO SERVIZIO
177100940922     C     VIDTSP        IFNE      *BLANKS
177110940919    1C                   MOVEL     VIDTSP        BLPTSP
177120940922     C                   ELSE
177130940922     C* LO PRENDO DA TARIFFA
177140940922     C                   MOVEL     COMTSP        BLPTSP
177150940922     C                   ENDIF
177160020725     C*
177170940919     C                   MOVEL     VIDIAS        BLPIAS
177180011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO ASSICURARE > 0
177190011113     C     VIDIAS        IFGT      *ZEROS
177200011113     C                   MOVEL     VIDVAS        BLPVAS
177210011113     C                   ELSE
177220011113     C                   CLEAR                   BLPVAS
177230011113     C                   ENDIF
177240940919     C                   MOVEL     VIDVMD        BLPVMD
177250011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE VALORE MERCE > 0
177260011113     C     VIDVMD        IFGT      *ZEROS
177270011113     C                   MOVEL     VIDVAD        BLPVAD
177280011113     C                   ELSE
177290011113     C                   CLEAR                   BLPVAD
177300011113     C                   ENDIF
177310940919     C                   MOVEL     VIDQFT        BLPQFT
177320900504     C                   MOVEL     VIDNAS        BLPNAS
177330941115     C                   MOVEL     V1CNCL        BLPNCL
177340940919     C                   MOVEL     V2CPKG        BLPPKB
177350940919     C                   MOVEL     V2CPKG        BLPPKF
177360940919     C                   MOVEL     VIDFVR        BLPFVB
177370940919     C                   MOVEL     VARVOL        BLPVLB
177380940919     C                   MOVEL     VIDFVR        BLPFVF
177390940919     C                   MOVEL     VARVOL        BLPVLF
177400030204      * Immissione bolla
177410030204     c                   If        (*In12 and *In15) or Not *In12
177420030204      * Se sono stati impostati i bancali devo sommare al peso e al volume
177430030204      * il peso e il volume dei bancali
177440030922      * no x particolarità varia 'O'
177450030922     c                   If        %subst(VidGva:1:1) <> 'O'
177460110921     c                   If        VidNba > *Zeros and §cliban=*blanks
177470030204     c                   Clear                   w0071
177480030204     c                   Clear                   w0053
177490030204     c     wTbaPkg1      Mult      VidNba        w0071
177500030204     c                   Add       w0071         BlpPkb
177510030204     c                   Add       w0071         BlpPkf
177520030204     c     wTbaVol1      Mult      VidNba        w0053
177530030204     c                   Add       w0053         BlpVlb
177540030204     c                   Add       w0053         BlpVlf
177550030204     c                   EndIf
177560030204     c                   If        VidNb2 > *Zeros
177570030204     c                   Clear                   w0071
177580030204     c                   Clear                   w0053
177590030204     c     wTbaPkg2      Mult      VidNb2        w0071
177600030204     c                   Add       w0071         BlpPkb
177610030204     c                   Add       w0071         BlpPkf
177620030204     c     wTbaVol2      Mult      VidNb2        w0053
177630030204     c                   Add       w0053         BlpVlb
177640030204     c                   Add       w0053         BlpVlf
177650030204     c                   EndIf
177660030922     c                   EndIf
177670030204     c                   EndIf
177680010214     C     VIDFFD        IFEQ      'N'
177690010214     C                   MOVEL     *BLANKS       BLPFFD
177700010214     C                   ELSE
177710940919     C                   MOVEL     VIDFFD        BLPFFD
177720010214     C                   ENDIF
177730940919     C                   MOVEL     COMDRT        BLPDRT
177740000308     C                   CLEAR                   BLPPDR
177750990630     C  N34              MOVEL     VIDLNP        BLPPDR
177760990630     C  N34              MOVE      VIDPDR        BLPPDR
177770940919     C                   MOVEL     VIDFPP        BLPFPP
177780940928     C                   MOVEL     VIDNRT        BLPNRT
177790940919     C                   MOVEL     VIDTCR        BLPTCR
177800940919     C                   MOVEL     COMDCR        BLPDCR
177810940919     C                   MOVEL     VIDHCR        BLPHCR
177820940919     C                   MOVE      VIDMCR        BLPHCR
177830030326      * Data consegna richiesta - Forzata su richiesta del cliente
177840030326      * in immissione bolla
177850030410      * e se non già impostata la data consegna richiesta
177860100219     c                   If        ((*In12 and *In15) or Not *In12)
177870100219     c                               and BlpDcr = *Zeros
177880030326     c                   ExSr      SrDcr
177890100217     c                   EndIf
177900100217     c
177910000214     C* SE E' UN DISK "C" MA NUMERAZIONE AUTOMATICA DPD,
177920000214     C* TRATTO COME DISK "A"
177930940919     C                   MOVEL     VIDSOP        BLPSOP
177940940919     C                   MOVEL     VIDRMN        BLPRMN
177950940919     C                   MOVEL     VIDRMA        BLPRMA
177960940919     C                   MOVEL     VIDRMO        BLPRMO
177970941005     C*
177980941005     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
177990941005     C     VIDCMO        IFNE      *BLANKS
178000941005     C                   MOVEL     VIDCMO        BLPCAM
178010941005     C                   MOVEL     VIDNMO        BLPNZM
178020941005     C                   ENDIF
178030941005     C*
178040940919     C                   MOVEL     VARZNC        BLPZNC
178050950303     C     §3ACTM        IFNE      *BLANKS
178060950303     C                   MOVEL     §3ACTM        BLPCTM
178070950303     C                   ELSE
178080940919     C                   MOVEL     VIDCTM        BLPCTM
178090950303     C                   ENDIF
178100941005     C     BLPCTM        IFEQ      *BLANKS
178110941005     C                   MOVEL     WCTM          BLPCTM
178120941005     C                   ENDIF
178130940919     C                   MOVEL     VIDTC1        BLPTC1
178140940919     C                   MOVEL     VIDTC2        BLPTC2
178150001205     C* SE MANUTENZIONE DI BOLLA POSTE E AGGIUNTA O TOLTA TC1/2 "F"
178160060215     C* DEVO AGGIORNARE ar4 TIPO RECORD J
178170140122     C** 12
178180140122     C**ANN15§ogntw        IFEQ      'PPT'
178190140122     C**                 CLEAR                   WTCP
178200140122     C**                 CLEAR                   WSVTCP
178210140122     C**   VIDTC1        IFEQ      'F'
178220140122     C**   VIDTC2        OREQ      'F'
178230140122     C**                 MOVEL     'F'           WTCP
178240140122     C**                 ENDIF
178250140122     C**   SAVTC1        IFEQ      'F'
178260140122     C**   SAVTC2        OREQ      'F'
178270140122     C**                 MOVEL     'F'           WSVTCP
178280140122     C**                 ENDIF
178290140122     C**                 SELECT
178300001205     C* SE NON E' STATA NE' AGGIUNTA NE' TOLTA LA "F" NON FACCIO NIENTE
178310140122     C**   VIDTC1        WHENNE    'F'
178320140122     C**   VIDTC2        ANDNE     'F'
178330140122     C**   SAVTC1        ANDNE     'F'
178340140122     C**   SAVTC2        ANDNE     'F'
178350140122     C**   WTCP          OREQ      'F'
178360140122     C**   WSVTCP        ANDEQ     'F'
178370140122     C**                 OTHER
178380140122     C**                 MOVEL     'J'           WTRC
178390140122     C**   KBLP4         CHAIN(N)  Fiar401L                           30
178400140122    3C**   *IN30         IFEQ      *OFF
178410140122     C**                 MOVEL     ar4NOT        DSBL4J
178420001205     C* TOLTO LA 'F'
178430140122    4C**   WTCP          IFEQ      *BLANKS
178440140122     C**   WSVTCP        ANDEQ     'F'
178450140122     C**                 CLEAR                   §B4BAI
178460140122   X4C**                 ELSE
178470001205     C* AGGIUNTA 'F'
178480140122    5C**   WTCP          IFEQ      'F'
178490140122     C**   WSVTCP        ANDEQ     *BLANKS
178500140122     C**                 MOVEL     'S'           §B4BAI
178510140122    5C**                 ENDIF
178520140122    4C**                 ENDIF
178530140122     C**                 CLEAR                   DSLV19
178540140122     C**                 MOVEL     DSBL4J        D19NT1
178550140122     c**                 movel     'T'           d19ftr
178560140122     C**                 MOVEL     BLPAAS        D19AAS
178570140122     C**                 MOVEL     BLPLNP        D19LNP
178580140122     C**                 MOVEL     BLPNRS        D19NRS
178590140122     C**                 MOVEL     BLPNSP        D19NSP
178600140122     C**                 MOVEL     'J'           D19TRC
178610140122     C**                 CLEAR                   D19NT2
178620140122     C**                 CALL      'FNLV19R'
178630140122     C**                 PARM                    DSLV19
178640140122   X3C**                 ELSE
178650001205     C* AGGIUNTA 'F' --> CREO RECORD "J"
178660140122    4C**   WTCP          IFEQ      'F'
178670140122     C**   WSVTCP        ANDEQ     *BLANKS
178680140122     C**                 CLEAR                   DSLV19
178690140122     C**                 CLEAR                   DSBL4J
178700140122     c**                 movel     'T'           d19ftr
178710140122     C**                 MOVEL     'S'           §B4BAI
178720140122     C**                 MOVEL     DSBL4J        D19NT1
178730140122     C**                 MOVEL     BLPAAS        D19AAS
178740140122     C**                 MOVEL     BLPLNP        D19LNP
178750140122     C**                 MOVEL     BLPNRS        D19NRS
178760140122     C**                 MOVEL     BLPNSP        D19NSP
178770140122     C**                 MOVEL     'J'           D19TRC
178780140122     C***                CLEAR                   D19NT2
178790140122     C**                 CALL      'FNLV19R'
178800140122     C***                PARM                    DSLV19
178810140122    4C***                ENDIF
178820140122    3C***                ENDIF
178830140122     C***                ENDSL
178840140122     C***                ENDIF
178841141201     c* se spedizione export non memorizzo nè il pin code se presente e nemmeno
178842141201     c* la particolarità consegna se prevede il PIN CODE
178843141201     c                   if        a_§ogntw='DPD' or
178844141201     c                             a_§ogntw='EEX' or
178845141201     c                             a_§ogntw='FED'
178846141201     c                   clear                   wpincode
178847141201     c                   if        §7rpincode='S'
178848141201     c                   clear                   vidgma
178849141201     c                   endif
178850141201     c                   endif
178851141201
178852940919     C                   MOVEL     VIDGGA        BLPGGA
178860940919     C                   MOVEL     VIDGMA        BLPGMA
178868141201
178870940919     C                   MOVEL     VIDGVA        BLPGVA
178880960208     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
178890960208     C* DELLE PARTICOLARITA' VARIE
178900970707     C     W2LN          IFEQ      'S'
178910960208     C                   MOVE      'D'           BLPGVA
178920960208     C                   ELSE
178930960208     C                   MOVE      ' '           BLPGVA
178940960208     C                   ENDIF
178941141201
178950141201
178951940919     C* C/ASSEGNO
178960051115    1C     ar9CAS        IFGT      0
178970940919     C     VIDGCA        ORNE      *BLANKS
178980051115     C                   MOVEL     BLPAAS        ar9AAS
178990051115     C                   MOVEL     BLPLNP        ar9LNP
179000051115     C                   MOVEL     BLPNRS        ar9NRS
179010051115     C                   MOVEL     BLPNSP        ar9NSP
179020051115     C                   MOVEL     VIDGCA        ar9GCA
179030051115     C                   MOVEL     dateu         ar9duv
179040940919     C*
179050051115     C     War9          IFEQ      'E'
179060051115     C                   UPDATE    Fiar9000
179070940926     C                   ELSE
179080051115     C                   WRITE     Fiar9000
179090940926     C                   ENDIF
179100940926     C*
179110940926     C                   ELSE
179120940926     C* SE C'ERA E ORA NON PIU' DELETO
179130051115     C     War9          IFEQ      'E'
179140051115     C                   DELETE    Fiar9000
179150940919     C                   ENDIF
179160940926     C                   ENDIF
179170900828     C*
179180941025     C* SE NO A BORDERO' METTO 99999 IN DATA BORDERO' E NUM.F.VIAGG
179190930628    1C     §1BFG4        IFEQ      'N'
179200900829     C                   MOVEL     DATEU         BLPDBR
179210900828     C                   MOVEL     *ALL'9'       BLPNFV
179220930628   X1C                   ELSE
179230930628    2C     *IN12         IFEQ      *ON
179240930628     C     *IN15         ANDEQ     *ON
179250930628     C     *IN12         OREQ      *OFF
179260930628     C                   MOVEL     *ZEROS        BLPDBR
179270930628     C                   MOVEL     *ZEROS        BLPNFV
179280930628    2C                   END
179290930628    1C                   END
179300910805     C  N12              MOVEL     *BLANKS       BLPFNS
179310910805     C   12              MOVEL     VIDFNS        BLPFNS
179320971212     C**
179330971215     C** SE BOLLA EXP/IMP SDI CON NUMERO AWB SCRITTO, LO MEMORIZZO
179340020211     c** SE BOLLA EXPORT FEDEX ASSEGNO IL NUMERO AWB
179350971217     C   12
179360971217     CAN 15
179370971217     CORN12              CLEAR                   DSBL4E
179380020213     c     A_§ogntw      ifeq      'FED'
179390020320     c     wawbini       andgt     *zeros
179400020211     C                   CLEAR                   DSBL4E
179410020228     c                   movel     wawbini       w0012a           12
179420020228     c* calcolo check digit
179430020228     c                   exsr      chkdgf
179440020228     c                   movel     w0012a        §b4erp
179450020211     C                   MOVEL     'A'           §B4EMA
179460020211     C                   MOVEL     'P'           §B4EAT
179470020212     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
179480051102     c* del ARS trk "F"
179490020208     c                   endif
179500081008    1C**   V6CAWB        IFEQ      0
179510081008     c**   A_§ogntw      andeq     'EUP'
179520971212     C* VEDO SE C'E' IL CONTATORE 19 - NUMERO AWB
179530081008     C***                CLEAR                   AAS
179540081008     C**                 Z-ADD     19            CNU
179550081008     C**                 Z-ADD     BLPTFP        COMLIN
179560081008     C**   KNUF          CHAIN     FLNUF01L                           30
179570081008    2C**   *IN30         IFEQ      *OFF
179580081008     C**                 ADD       1             NUFNUM
179590980623     C* SE SUPERA RANGE FINALE, RIPARTO DA QUELLO INIZIALE
179600081008     C**   NUFNUM        IFGT      NUFRFI
179610081008     C**                 Z-ADD     NUFRIN        NUFNUM
179620081008    6C**                 END
179630081008     C**                 UPDATE    FLNUF
179640081008     C**                 Z-ADD     NUFNUM        W0090
179650081008     C**                 MOVEL     §3IFAW        W0090
179660081008     C**   W0090         DIV       7             RISUL
179670081008     C**                 MVR                     RESTO
179680081008     C**                 MOVEL     W0090         W010A
179690081008     C**                 MOVE      RESTO         W010A
179700971217     C*
179710081008     C**                 CLEAR                   DSBL4E
179720081008     C**                 MOVEL     W010A         §B4ERP
179730081008     C**                 MOVEL     'A'           §B4EMA
179740081008     C**                 MOVEL     'P'           §B4EAT
179750971216     C* SE LA STAMPO IN IMMEDIATO METTO SUBITO LA S DI STAMPATO
179760081008    3C**   §1BFG6        IFEQ      'I'
179770971217     C*
179780081008     C**   §1BFG6        OREQ      'C'
179790081008     C**   §1BFG0        ANDEQ     'I'
179800971217     C*
179810081008     C**   §1BFG6        OREQ      'C'
179820081008     C**   §1BFG0        ANDEQ     'C'
179830081008     C**   §1BF11        ANDEQ     'I'
179840081008     C**                 MOVEL     'S'           §B4EST
179850081008     C**                 ELSE
179860081008     C**                 MOVEL     'N'           §B4EST
179870081008    3C**                 ENDIF
179880081008    2C**                 ENDIF
179890971212     C**
179900081008   X1C**                 ELSE
179910971217     C* IN MANUTENZIONE SOLO SE HO MODIFICATO IL NUMERO
179920971217     C*  ALTRIMENTI LASCIO QUELLO CHE C'E'
179930081008    2C**   V6CAWB        IFGT      0
179940980310     C* SOLO SE EXPORT SDI
179950081008     c**   A_§ogntw      ifeq      'EUP'
179960081008    4C**   SAVAWB        IFNE      V6CAWB
179970081008     C**   §B4EMA        OREQ      ' '
179980081008     C**                 CLEAR                   DSBL4E
179990081008     C**                 MOVEL     V6CAWB        §B4ERP
180000081008     C**                 MOVEL     'M'           §B4EMA
180010081008     C**                 MOVEL     'P'           §B4EAT
180020081008     C**                 MOVEL     'S'           §B4EST
180030081008    4C**                 ENDIF
180040081008    3C**                 ENDIF
180050081008    2C***                ENDIF
180060081008    1C**                 ENDIF
180070971230     C* SE MODIFICATA LA LNA E DIVENTATE ENTRAMBE IN ITALIA
180080060215     C*    AZZERO NUMERO AWB E CANCELLO Fiar4
180090971230    2C     *IN12         IFEQ      *ON
180100971230     C     *IN15         ANDEQ     *OFF
180110120302     C* PER LA LINEA DI PARTENZA VALE SOLO PER BRT
180120020211     c     §ogntw        ifne      'EEX'
180130020211     c     §ogntw        andne     'FED'
180140081008     c***  §ogntw        andne     'EUP'
180150020213     c     A_§ogntw      andne     'FED'
180160081008     c***  A_§ogntw      andne     'EUP'
180170020211     C                   MOVEL     'E'           WTRC
180180060215     C     KBLP4         DELETE    Fiar4000                           30
180190020211     C                   CLEAR                   §B4ERP
180200020211     c                   endif
180210971230    2C                   ENDIF
180220060216     C* SE C'E' NUMERO AWB SCRIVO RECORD E IN ar4
180230971212    1C     §B4ERP        IFNE      *BLANKS
180240971216     C     SAVAWB        ORNE      0
180250081008     c***  A_§ogntw      ifeq      'EUP'
180260081008     c     A_§ogntw      ifeq      'FED'
180270060215     C                   MOVEL     'T'           D19ftr
180280971212     C                   MOVEL     BLPAAS        D19AAS
180290971212     C                   MOVEL     BLPLNP        D19LNP
180300971212     C                   MOVEL     BLPNRS        D19NRS
180310971212     C                   MOVEL     BLPNSP        D19NSP
180320971212     C                   MOVEL     'E'           D19TRC
180330971212     C                   CLEAR                   D19NT1
180340971212     C                   MOVEL     DSBL4E        D19NT1
180350971212     C                   CLEAR                   D19NT2
180360971212     C                   CALL      'FNLV19R'
180370971212     C                   PARM                    DSLV19
180380020211     c                   endif
180390971212    1C                   ENDIF
180400031219      * se ho caricato il riferimento partner estero da FIVAT rcd 'C'
180410060216      * scrivo il Fiar4 rcd 'E'
180420031219    1c                   If        *In12 and *In15
180430080128     c                             and A_§ogntw<>'FED'
180440060215     c                   MOVEL     'T'           D19ftr
180450031219     C                   MOVEL     BLPAAS        D19AAS
180460031219     C                   MOVEL     BLPLNP        D19LNP
180470031219     C                   MOVEL     BLPNRS        D19NRS
180480031219     C                   MOVEL     BLPNSP        D19NSP
180490031219     C                   MOVEL     'E'           D19TRC
180500031219     C                   CLEAR                   D19NT1
180510031219     C                   MOVEL     wrifp         D19NT1
180520031219     C                   CLEAR                   D19NT2
180530031219     C                   CALL      'FNLV19R'
180540031219     C                   PARM                    DSLV19
180550031219    1c                   EndIf
180551141031     c* Memorizzo Pin Code se presente
180552141031    1c                   If        *In12 and *In15 and wPinCode<>*blanks
180553141031     c                   MOVEL     'T'           D19ftr
180554141103
180555141103     c                   clear                   dsbl4y
180556141103     C                   MOVEL     wPinCode      §b4pcd
180557141103
180558141031     C                   MOVEL     BLPAAS        D19AAS
180559141031     C                   MOVEL     BLPLNP        D19LNP
180560141031     C                   MOVEL     BLPNRS        D19NRS
180561141031     C                   MOVEL     BLPNSP        D19NSP
180562141031     C                   MOVEL     'Y'           D19TRC
180563141031     C                   CLEAR                   D19NT1
180564141103     c                   movel     dsbl4y        d19nt1
180565141031     C                   CLEAR                   D19NT2
180566141031     C                   CALL      'FNLV19R'
180567141031     C                   PARM                    DSLV19
180568141031    1c                   endif
180569991203      **
180570060216      ** SE EXPORT DPD CON NUMERO PARCEL SCRITTO, LO MEMORIZZO IN Fiar4
180580060509     c                   if        (*in12 and *in15) or *in12 = '0'
180590061003     C****               CLEAR                   DSBL4F
180600060509     C                   CLEAR                   DSBL4I
180610060509     C                   CLEAR                   DSBL4K
180620060509     c                   endif
180630991203      *
180640020319    1C     A_§OGNTW      IFEQ      'DPD'
180650060620     c*
180660991203      *
180670060616    2C     V7CNPR        IFne      *blanks
180680060620     c* Imposto dsbl4f solo se si utilizza ancora il cappario vecchio
180690061003     C****               CLEAR                   DSBL4F
180700061003    3c****               if        dateu < §vpodpd  AND
180710061003     c****                         %subst(v7cnpr:14:1)=*blanks
180720061003     C****               MOVEL     V7CNPR        §B4FNP
180730061003     C**** §1BF13        IFEQ      'A'
180740061003     C****               MOVEL     'A'           §B4FMA
180750061003     C****               ELSE
180760061003     C****               MOVEL     'M'           §B4FMA
180770061003     C****               ENDIF
180780061003     C****               MOVEL     'P'           §B4FAT
180790061003     C****               MOVEL     'S'           §B4FST
180800061003     C****               MOVEL     OD3NAZ        §B4NAZ
180810061003     C****               MOVEL     OD3RTN        §B4RTN
180820061003     C****               MOVEL     OD3ZON        §B4ZON
180830061003     C****               MOVEL     OD3COL        §B4FNR
180840061003    3c****               endif
180850060616     c* imposto dsbl4i/k
180860060509     c                   clear                   dsbl4i
180870060616     c                   clear                   dsbl4k
180880060509     C                   MOVEL     V7CNPR        §B4IPN
180890060616     c* tolgo il check digit dal parcel number se n. parcel lungo 12
180900060620     c                   if        %subst(§b4ipn:14:1) = *blanks
180910060509     c                   eval      %subst(§b4ipn:12:1)=' '
180920060620     c                   eval      §b4icd=%subst(v7cnpr:12:1)
180930060616     c                   else
180940060616     c* se parcel lungo 14 calcolo il check digit
180950060616     c                   clear                   trul28ds4
180960060616     c                   eval      i284cod=§b4ipn
180970060616     c                   call      'TRUL28R5'
180980060616     c                   parm                    trul28ds4
180990060616     c                   movel     o284ckd       §b4icd
181000060616     c                   endif
181010060616     c* Se ho usato il cappario dpd vecchio imposto dsbl4i con campi
181020060616     c* del cappario vecchio altrimenti perndo quelli del cappario nuov
181030070515     c***                if        dateu < §vpodpd  AND
181040070515     c***                          %subst(v7cnpr:14:1)=*blanks
181050060510     c* depot di arrivo --> muovo uno 0 in prima posizione
181060070515     c***                movel     '0'           §b4ida
181070070515     C***                MOVE      OD3RTN        §B4ida
181080070515     C***                MOVEL     OD3ZON        §B4iza
181090060509     c* imposto dsbl4k
181100070515     C***                MOVEL     OD3COL        §B4krt
181110070515     c***                else
181120060616     c                   movel     osie3dsrt     §b4ids
181130060616     c                   movel     osie3bidp     §b4ibi
181140060616     c                   movel     osie3ddep     §b4ida
181150060616     c                   move      isie3srv      §b4isc
181160061010     c                   movel     osie3iatad    §b4iat
181170061010     c                   movel     osie3ptyg     §b4ipy
181180070515     c***                endif
181190991203      *
181200991203    2C                   ENDIF
181210991203    1C                   ENDIF
181220050228     c*
181230050228    1C     *in79         IFEQ      *on
181240070605    1C     A_§OGNTW      andne     'DPD'
181250060616    2C     v7cnpr        IFne      *blanks
181260061003     C****               CLEAR                   DSBL4F
181270060621     c* solo se parcel lungo 11
181280061003     c****               if        %subst(v7cnpr:14:1) = *blanks
181290061003     c****               movel     v7cnpr        §b4fnp
181300061003     c***                endif
181310060510     c* imposto dsbl4i
181320060616     c                   movel     v7cnpr        §b4ipn
181330060621    3c                   if        %subst(§b4ipn:14:1) = *blanks
181340060616     c                   eval      %subst(§b4ipn:12:1)=' '
181350060619     c                   eval      §b4icd=%subst(v7cnpr:12:1)
181360060621   x3c                   else
181370060616     c* se parcel lungo 14 calcolo il check digit
181380060616     c                   clear                   trul28ds4
181390060616     c                   eval      i284cod=§b4ipn
181400060616     c                   call      'TRUL28R5'
181410060616     c                   parm                    trul28ds4
181420060616     c                   movel     o284ckd       §b4icd
181430060621    3c                   endif
181440060621     c* destination sort
181450060621     c                   move      §oghb1        §b4ids
181460060621     c                   move      a_§ogdp1      §b4ida
181470060621    3c                   select
181480060628     c* immissione o bolla di reso
181490060628     c                   when      *in12='0' or blpfbr = 'S'
181500060621     C                   CLEAR                   PTYPE             2
181510060621     c                   if        blppkb>§3ilmp
181520060621     c                   move      101           §b4isc
181530060621     c                   eval      ptype='01'
181540060621     c                   else
181550060621     c                   move      136           §b4isc
181560060928     c                   eval      ptype='02'
181570060621     c                   endif
181580060628     c                   if        blpfbr='S'
181590060628     c                   move      300           §b4isc
181600060628     c                   endif
181610060621     c                   move      '%'           §b4ibi
181620060621     c                   if        %subst(§b4ipn:14:1)=*blanks
181630060621     c                   eval      §b4krt='39' + %subst(blpcad:1:5)+
181640060621     c                             ptype
181650060621     c                   endif
181660060628     c* conferma da disk
181670060628     c                   when      *in12='1' and *in15='1'
181680060628     c                   move      §VATESCD      §B4ISC
181690060628     c                   move      §VATEbid      §b4ibi
181700060628    4c                   if        §vaterou <> *blanks
181710060628     c                   move      §vaterou      §b4krt
181720060628    4c                   endif
181730060621    3c                   endsl
181740050228    2C                   ENDIF
181750050228    1C                   ENDIF
181760991203      *
181770991203      * SE MODIFICATA LA LNA E NON È PIÙ DPD AZZERO IL NUMERO PARCEL
181780060215      *  E CANCELLO Fiar4
181790991203    2C     *IN12         IFEQ      *ON
181800991203     C     *IN15         ANDEQ     *OFF
181810020319     C     A_§OGNTW      ANDNE     'DPD'
181820050228     c     *in79         andne     *on
181830061003     C***                MOVEL     'F'           WTRC
181840061003     C***  KBLP4         DELETE    Fiar4000                           30
181850060626     C***                CLEAR                   §B4FNP
181860061003     C***                CLEAR                   dsbl4f
181870060510     C                   MOVEL     'I'           WTRC
181880060510     C     KBLP4         DELETE    Fiar4000                           30
181890060626     C                   CLEAR                   dsbl4i
181900060510     C                   MOVEL     'K'           WTRC
181910060510     C     KBLP4         DELETE    Fiar4000                           30
181920060626     C                   CLEAR                   dsbl4k
181930991203    2C                   ENDIF
181940991203      *
181950060620      * SE C'E' NUMERO PARCEL SCRIVO RECORD "I" IN ar4
181960060620     c* Tipo rekord F
181970061003     c***                if        §b4fnp<>*blanks or savfnp<>*blanks
181980061003     C***                MOVEL     'T'           D19ftr
181990061003     C***                MOVEL     BLPAAS        D19AAS
182000061003     C***                MOVEL     BLPLNP        D19LNP
182010061003     C***                MOVEL     BLPNRS        D19NRS
182020061003     C***                MOVEL     BLPNSP        D19NSP
182030061003     C***                MOVEL     'F'           D19TRC
182040061003     C***                MOVEL(P)  DSBL4F        D19NT1
182050061003     C***                CLEAR                   D19NT2
182060061003     C***                CALL      'FNLV19R'
182070061003     C***                PARM                    DSLV19
182080061003     c***                endif
182090060620     c* Tipo record K
182100060620     c                   if        §b4krt<>*blanks or savkrt<>*blanks
182110060620     C                   MOVEL     'T'           D19ftr
182120060620     C                   MOVEL     BLPAAS        D19AAS
182130060620     C                   MOVEL     BLPLNP        D19LNP
182140060620     C                   MOVEL     BLPNRS        D19NRS
182150060620     C                   MOVEL     BLPNSP        D19NSP
182160060620     C                   MOVEL     'K'           D19TRC
182170060620     C                   MOVEL(P)  DSBL4K        D19NT1
182180060620     C                   CLEAR                   D19NT2
182190060620     C                   CALL      'FNLV19R'
182200060620     C                   PARM                    DSLV19
182210060620     c                   endif
182220060620     c* Tipo record I
182230060510    1C     §B4IPN        IFNE      *BLANKS
182240060616     C     SAVNPR        ORNE      *blanks
182250060510     c*
182260060510     C                   MOVEL     'T'           D19ftr
182270060510     C                   MOVEL     BLPAAS        D19AAS
182280060510     C                   MOVEL     BLPLNP        D19LNP
182290060510     C                   MOVEL     BLPNRS        D19NRS
182300060510     C                   MOVEL     BLPNSP        D19NSP
182310060510     C                   MOVEL     'I'           D19TRC
182320060510     C                   MOVEL(P)  DSBL4I        D19NT1
182330060510     C                   CLEAR                   D19NT2
182340060510     C                   CALL      'FNLV19R'
182350060510     C                   PARM                    DSLV19
182360061106     c* se sono in conferma bolle import dpd scrivo depot su DPPDC
182370061106     c* se manca
182380061107     c                   if        §b4ipn<>*blanks and *in79  and *in12
182390061107     c                             and *in15
182400061106     c                   clear                   truldepds
182410061106     c
182420061106     c                   if        %subst(§b4ipn:14:1) <> *blanks
182430061106     c                   movel     §b4ipn        idepdpc
182440061106     c                   else
182450061106     c                   eval      idepdpc='0'+%subst(§b4ipn:1:3)
182460061106     c                   endif
182470061106     c                   call      'TRULDEPR'
182480061106     c                   parm                    truldepds
182490061106     c                   if        odeperr='1'
182500061106     c                   clear                   dppdc000
182510061106     c                   eval      pdcdpc=idepdpc
182520061106     c                   z-add     19900101      pdcdde
182530061106     c                   z-add     20391231      pdcdsc
182540061106     c                   z-add     dateu         pdcdtv
182550061107     c                   time                    pdcorv
182560061106     c                   movel     'FNLS01R'     pdcpru
182570061106     c                   write     dppdc000
182580061106     c                   endif
182590061106     c                   endif
182600991214     C**
182610991214     C* SCRIVO IL NUMERO DI PARCEL ANCHE NELLE NOTE
182620991214     C*
182630050405     c* se import dpd non lo devo fare lo faccio solo per export
182640060616     c                   clear                   dpdsta
182650060616     c                   clear                   dpdsta14         27
182660050405    2c     *in79         ifeq      *off
182670060626     c     §b4ipn        ifne      *blanks
182680060510     C***                MOVEL     §B4FNP        DPDPAR
182690060616     c                   if        %subst(§b4ipn:14:1)=*blanks
182700060510     c                   movel     §b4ipn        dpdpar
182710060510     c                   move      §b4icd        dpdpar
182720991214     C                   MOVEL     DPD1          DPDS1
182730991214     C                   MOVEL     DPD2          DPDS2
182740991214     C                   MOVEL     DPD3          DPDS3
182750991214     C                   MOVEL     CDPD          DPDCOS
182760060616     c                   else
182770060616     c                   eval      dpdsta14=cdpd+%subst(§b4ipn:1:4)+
182780060616     c                             ' '+%subst(§b4ipn:5:10)
182790060616     c                   endif
182800060626     c                   endif
182810991217     C* IN MANUTENZIONE CONTROLLO SE LE NOTE SONO QUELLE MESSE IN AUTOM
182820991217     C*  DEL PARCEL
182830991217     C     *IN12         IFEQ      *ON
182840991217     C     *IN15         ANDEQ     *OFF
182850991217     C                   MOVEL     VIDNT1        W012A            12
182860991217     C*
182870991217     C     W012A         IFEQ      CDPD
182880991217     C                   CLEAR                   VIDNT1
182890991217     C                   ENDIF
182900991217     C                   ENDIF
182910991217     C*
182920060626     c                   if        dpdsta<>*blanks or dpdsta14<>*blanks
182930060626    3C     VIDNT1        IFEQ      *BLANKS
182940060626    4c                   if        dpdsta<>*blanks
182950991214     C                   MOVEL(P)  DPDSTA        VIDNT1
182960060616     c                   else
182970060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
182980060626    4c                   endif
182990060626   x3C                   ELSE
183000991214     C                   MOVEL     VIDNT1        VIDNT2
183010060626    4c                   if        dpdsta<>*blanks
183020991214     C                   MOVEL(P)  DPDSTA        VIDNT1
183030060616     c                   else
183040060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
183050060626    4c                   endif
183060060626    3C                   ENDIF
183070060626     c                   endif
183080050405    2c                   endif
183090991203    1C                   ENDIF
183100991117      *
183110010502      * SE BOLLA CON LNP DPD E NUM. DISTINTA NON IMPOSTATO DEVO:
183120991130      *  - RICAVARE IL NUMERO DISTINTA E MEMORIZZARLO IN RMA
183130000218      *  - CREARE IL FILE EVENTI DPD TRANNE PER BOLLE DI RECUPERO
183140060619     C     *IN79         IFEQ      *ON
183150080304     C***  BLPRMA        ANDEQ     *BLANKS
183160060619     c* solo per parcel number lungo 14 continuo a scrivere n.distinta
183170080304     c                   if        %subst(§b4ipn:14:1)=*blanks
183180080304     c                             and blprma=*blanks
183190060619     C                   EXSR      SPEDPD
183200060619     C                   MOVEL     DPDBRC        BLPRMA
183210060619     c                   endif
183220060619     C     §3ARBL        IFNE      'R'
183230060619     C                   EXSR      EVEDPD
183240060619     C                   ENDIF
183250060619     C                   ENDIF
183260010502     C*
183270010924      * MEMORIZZO IL RIF. ORM NEL RIF. MITTENTE ALFANUMERICO
183280010924      *  - SEMPRE SE QUELLO IN BOLLA E' VUOTO
183290010924      *  - SE ENTRAMBI PIENI SOLO SE IMPOSTATO L'APPOSITO FLAG SULL'ORM
183300010924      *  - MAI SE BOLLA DPD
183310040226if  1c                   If        worm = 'S' and
183320040226     c                             (Not *In79 or wrifm = *Off)
183330010924      *  PREPAGATO
183340010502    2C     PARTCH        IFEQ      'P'
183350010924      *
183360010502    3C     VIDMAG        IFNE      'S'
183370010924     C     BLPRMA        ANDEQ     *BLANKS
183380010502     C                   MOVEL     §RMRFA        BLPRMA
183390010502    3C                   ENDIF
183400010924      *
183410010502   X2C                   ELSE
183420010924      *  NO PREPAGATO
183430010502    3C     FLGFIT        IFNE      'S'
183440010924    4C     BLPRMA        IFEQ      *BLANKS
183450010502     C                   MOVEL     ORMRFA        BLPRMA
183460010924   X4C                   ELSE
183470010924    5C     ORMRFA        IFNE      *BLANKS
183480010924     C     §ORMFR        ANDEQ     'S'
183490010924     C                   MOVEL     ORMRFA        BLPRMA
183500010924    5C                   ENDIF
183510010924    4C                   ENDIF
183520010924    3C                   ENDIF
183530010924      *
183540010502    2C                   ENDIF
183550010924      *
183560010502    1C                   ENDIF
183570991214     C***
183580991214     C***  N O T E
183590060216     C                   MOVEL     'T'           D19ftr
183600991214     C                   MOVEL     BLPAAS        D19AAS
183610991214     C                   MOVEL     BLPLNP        D19LNP
183620991214     C                   MOVEL     BLPNRS        D19NRS
183630991214     C                   MOVEL     BLPNSP        D19NSP
183640991214     C                   MOVEL     VIDNT1        D19NT1
183650991214     C                   MOVEL     VIDNT2        D19NT2
183660991214     C     VIDNT1        IFNE      *BLANKS
183670991214     C     VIDNT2        ORNE      *BLANKS
183680991214     C                   MOVEL     '8'           D19TRC
183690991214     C                   CALL      'FNLV19R'
183700991214     C                   PARM                    DSLV19
183710991214     C                   ENDIF
183720991214     C**
183730991214     C* REIMPOSTO LE NOTE IN MANUTENZIONE
183740991214     C   12
183750991214     CANN15              MOVEL     D19NT1        VIDNT1
183760991214     C   12
183770991214     CANN15              MOVEL     D19NT2        VIDNT2
183780991214     C**
183790991214     C* IN MANUTENZIONE SE IL PGM MI RESTITUISCE LA 2 RIGA VUOTA,
183800991214     C* LA DELETO PERCHE' POTEVA PRIMA ESISTERE
183810991214     C   12
183820991214    1CANN15D19ERR        IFEQ      *BLANKS
183830991214     C     D19NT1        ANDNE     *BLANKS
183840991214     C     D19NT2        ANDEQ     *BLANKS
183850991214     C                   MOVEL     '9'           D19TRC
183860991214     C                   CLEAR                   D19NT1
183870991214     C                   CLEAR                   D19NT2
183880991214     C                   CALL      'FNLV19R'
183890991214     C                   PARM                    DSLV19
183900991214    1C                   ENDIF
183910991214     C* SE TORNATO CODICE DI ERRORE RICHIAMO IL PGM 2 VOLTE
183920991214     C* UNA VOLTA PER NOTA
183930991214    2C     D19ERR        IFNE      *BLANKS
183940991214    1C     *IN12         OREQ      *ON
183950991214     C     *IN15         ANDEQ     *OFF
183960991214     C     VIDNT1        ANDEQ     *BLANKS
183970991214     C     VIDNT2        ANDEQ     *BLANKS
183980991214     C* NOTA 1
183990991214     C                   MOVEL     '8'           D19TRC
184000991214     C                   MOVEL     VIDNT1        D19NT1
184010991214     C                   CLEAR                   D19NT2
184020991214     C                   CALL      'FNLV19R'
184030991214     C                   PARM                    DSLV19
184040991214     C* NOTA 2
184050991214     C                   MOVEL     '9'           D19TRC
184060991214     C                   MOVEL     VIDNT2        D19NT1
184070991214     C                   CLEAR                   D19NT2
184080991214     C                   CALL      'FNLV19R'
184090991214     C                   PARM                    DSLV19
184100991214    1C                   ENDIF
184110000508     C* DATI POSTE SOLO IN CONFERMA
184120140122     C**   *IN12         IFEQ      *ON
184130140122     C***  *IN15         ANDEQ     *ON
184140140122     C***  §ogntw        ANDEQ     'PPT'
184150000509     C* SE CE' IAS O XCO
184160140122     C***  §B4IAS        IFGT      0
184170140122     C**   §B4XCO        ORNE      ' '
184180140122     C**   §B4DSC        ORNE      *BLANKS
184190140122     C**                 CLEAR                   DSLV19
184200140122     C**                 MOVEL     'T'           D19ftr
184210140122     C**                 MOVEL     BLPAAS        D19AAS
184220140122     C**                 MOVEL     BLPLNP        D19LNP
184230140122     C**                 MOVEL     BLPNRS        D19NRS
184240140122     C**                 MOVEL     BLPNSP        D19NSP
184250140122     C**                 MOVEL     DSBL4J        D19NT1
184260140122     C**                 MOVEL     'J'           D19TRC
184270140122     C**                 CALL      'FNLV19R'
184280140122     C**                 PARM                    DSLV19
184290140122     C***                ENDIF
184300140122     C***                ENDIF
184310000623     C*
184320000623     C* SE ESISTE TABELLA 3Q, CREO RECORD VUOTO W
184330060217     c* Se sono in manutenzione aggiorno (azzero la data) solo se cambi
184340060217     c* ato codice
184350000623    1C     WES3Q         IFEQ      'S'
184360060217     c
184370060217     c                   if        *in12 = *off or *in15 = *on or
184380060217     c                             wksc <> savmit
184390000623     C*
184400060217     C                   CLEAR                   DSBL4W
184410060223     C                   CLEAR                   DSLV19
184420000623     C**
184430060217     C                   MOVEL     DSBL4W        d19nt1
184440060217     C                   MOVEL     BLPAAS        d19AAS
184450060217     C                   MOVEL     BLPLNP        d19LNP
184460060217     C                   MOVEL     BLPNRS        d19NRS
184470060217     C                   MOVEL     BLPNSP        d19NSP
184480060217     C                   MOVEL     'W'           d19TRC
184490060223     c                   movel     'T'           d19ftr
184500060217     c                   clear                   d19nt2
184510060217     c* se sono in manutenzione richiamo fnlv19r solo se cambiato codice
184520060217     C                   CALL      'FNLV19R'
184530060217     C                   PARM                    DSLV19
184540060217     c                   endif
184550000623     C*
184560000623   X1C                   ELSE
184570000623     C* SE ESISTEVA MA ADESSO NON ESISTE PIU' DEVO CANCELLARE IL RECORD
184580000623    2C     WBL4W         IFEQ      'E'
184590060223     c                   clear                   dslv19
184600060217     C                   clear                   d19nt1
184610060217     C                   MOVEL     BLPAAS        d19AAS
184620060217     C                   MOVEL     BLPLNP        d19LNP
184630060217     C                   MOVEL     BLPNRS        d19NRS
184640060217     C                   MOVEL     BLPNSP        d19NSP
184650060217     C                   MOVEL     'W'           d19TRC
184660060223     c                   movel     'T'           d19ftr
184670060217     c                   clear                   d19nt2
184680060217     C                   CALL      'FNLV19R'
184690060217     C                   PARM                    DSLV19
184700000623    2C                   ENDIF
184710000623    1C                   ENDIF
184720090325     C* Impostazione campi cliente/tariffa per tassazione porti assegnati
184730090805     c                   clear                   w_ar5ass
184740090325     c                   if        *in04
184750090325     c                   exsr      riewdwcli
184760091027     c                   select
184770091027     c                   when      flgfit<>'S' and ormpag='O'
184780090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
184790090806     c                                 %editc(ormksc:'X')
184800090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
184810090806     c                                 %subst(%editc(ormcor:'X'):1:7)
184820090804     c                   eval      w_ar5ass='T'
184830091027     c                   when      *in12 and *in15 and §lpass='T'
184840091027     c                   eval      w_ar5ass='T'
184850091027     c                   endsl
184860090325     c                   endif
184870091214     c* impostazione campo codice benefeiciario contrassegno
184880091214     c                   clear                   w_ar5cdi
184890091214     c                   select
184900091214     c                   when      wcassel2='X' and wwdwcas='S'
184910091214     c                   eval      w_ar5cdi=wcascor
184920091214     c                   when      *in12 and *in15 and §lpcdi>0
184930091214     c                   eval      w_ar5cdi=§lpcdi
184940091214     c                   endsl
184950090325     c*
184960010215     C* SE ATTIVATA PROCEDURA O.R.M. E NUMERO O.R.M. NON FITTIZIO LO
184970060215     C* MEMORIZZO SU Fiar4 TIPO RECORD "M"
184980060215      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
184990010925      * TIPO RECORD "Z" PER RITORNO VAS
185000010925    1C     WORM          IFEQ      'S'
185010010220     C     PARTCH        ANDNE     'P'
185020010228     C     WORM          OREQ      'S'
185030010228     C     VIDMAG        ANDNE     'S'
185040010713     C     §3ARBL        ANDNE     'R'
185050010215     C                   CLEAR                   DSLV19
185060060215     C                   MOVEL     'T'           D19ftr
185070010215     C                   MOVEL     BLPAAS        D19AAS
185080010215     C                   MOVEL     BLPLNP        D19LNP
185090010215     C                   MOVEL     BLPNRS        D19NRS
185100010215     C                   MOVEL     BLPNSP        D19NSP
185110010925    2C     FLGFIT        IFNE      'S'
185120010228     C     PARTCH        OREQ      'P'
185130010215     C  N12
185140010215     COR 12
185150010215     CAN 15              CLEAR                   DSBL4M
185160010925    3C     PARTCH        IFEQ      'P'
185170010228     C                   Z-ADD     §RMPOO        §B4POE
185180010228     C                   Z-ADD     §RMNSO        §B4NSR
185190010228     C                   Z-ADD     §RMNOO        §B4NOR
185200010228     C                   Z-ADD     §RMNRO        §B4NRV
185210010925   X3C                   ELSE
185220010215     C                   Z-ADD     WOPOE         §B4POE
185230010222     C                   Z-ADD     WONSR         §B4NSR
185240010222     C                   Z-ADD     WONOR2        §B4NOR
185250010215     C                   Z-ADD     WONRV         §B4NRV
185260010925    3C                   ENDIF
185270090325     c*
185280090325     c                   if        *in04
185290090325     c                   eval      §b4clg=wclg
185300090325     c                   endif
185310010221     C*
185320010925     C                   MOVEL     'M'           D19TRC
185330010215     C                   MOVEL     DSBL4M        D19NT1
185340010215     C                   CALL      'FNLV19R'
185350010215     C                   PARM                    DSLV19
185360060216      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
185370010925      * TIPO RECORD "Z" PER RITORNO VAS
185380121123    3c                   if        not *in12 or *in15
185390121123    4C     §ORMKS        IFEQ      'S'
185400040319     C     ORMKSC        ANDGT     *ZEROS
185410010925     C                   MOVEL     'Z'           D19TRC
185420010925     C                   CLEAR                   D19NT1
185430010925     C                   CLEAR                   D19NT2
185440010925     C                   CLEAR                   D19ERR
185450010927     C                   CLEAR                   DSBL4Z
185460010925     C                   MOVEL     ORMKSC        §B4OKC
185470010925     C                   MOVEL     DSBL4Z        D19NT1
185480010925     C                   CALL      'FNLV19R'
185490010925     C                   PARM                    DSLV19
185500121123    4C                   ENDIF
185510121123   x3c                   else
185520121122     c* in manutenzione verifico se modificare cancellare o aggiungere ar4 trk Z
185530130219     c* . . . se situazione invariata non faccio nulla
185540130219     c                   clear                   wnoZ              1
185550130219    4c                   if        wesar4z='S' and §ormks='S'
185560130219     c                             and wkscz=ormksc
185570130219     c                   eval      wnoZ='N'
185580130219    4c                   endif
185590130219    4c                   if        wnoz=*blanks  and
185600130219     c                             (wesar4z='S' and wtrasmz='N' or
185610130219     c                             (§ormks='S' and ormksc>*zeros))
185620121123     C                   MOVEL     'Z'           D19TRC
185630121123     C                   CLEAR                   D19NT1
185640121123     C                   CLEAR                   D19NT2
185650121123     C                   CLEAR                   D19ERR
185660121123     C                   CLEAR                   DSBL4Z
185670121122
185680121123    5c                   select
185690121123     c* era presente tipo record "Z"  ma ora non più : cancella se non trasmesso
185700121123     c                   when      wesar4z='S' and §ormks<>'S'
185710121126     c* era presente tipo record "Z" prima e adesso ma cliente diverso: aggiorna
185720121126     c* a sflagga per la ritrasmissione
185730121123     c                   when      wesar4z='S' and §ormks='S' and ormksc>*zeros
185740121123     c                             and wkscz<>ormksc
185750121123     C                   MOVEL     ORMKSC        §B4OKC
185760121126     C                   clear                   §B4dtr
185770121123     C                   MOVEL     DSBL4Z        D19NT1
185780121123     c* non era presente tipo record "Z" e ora si: scrive nuovo "Z"
185790121123     c                   when      wesar4z<>'S'
185800121123     C                   MOVEL     ORMKSC        §B4OKC
185810121123     C                   MOVEL     DSBL4Z        D19NT1
185820121123    5c                   endsl
185830121123     C                   CALL      'FNLV19R'
185840121123     C                   PARM                    DSLV19
185850121123    4c                   endif
185860121123    3c                   endif
185870010925      *--
185880010925   X2C                   ELSE
185890010925      *--
185900010215     C* SE SONO IN MANUTENZIONE E N. O.R.M. FITTIZIO DEVO CANCELLARE
185910060215     C* ar4 CON TIPO RECORD "M" E "Z" SE PRESENTI
185920010925    3C     *IN12         IFEQ      *ON
185930010215     C     *IN15         ANDEQ     *OFF
185940010925     C                   MOVEL     'M'           D19TRC
185950010215     C                   CALL      'FNLV19R'
185960010215     C                   PARM                    DSLV19
185970121127     c* Record "Z" lo cancello solo se non trasmesso.
185980121127     c* Se invece era stato trasmesso non lo cancello per mantenere traccia di
185990121127     c* quello che era stato fatto
186000121127     c                   if        wesar4z='S' and wtrasmz='N'
186010010925     C                   MOVEL     'Z'           D19TRC
186020010925     C                   CALL      'FNLV19R'
186030010925     C                   PARM                    DSLV19
186040121127     c                   endif
186050040319      * cancello anche il record 'A'
186060040319      * ma solo se prima dell'ORM fittizio era impostato un ORM reale
186070040319      * e lo so testando il flag wmodorm impostato nella ctrorm
186080040319if  4c                   If        wmodorm = *On
186090040319     c                   Movel     'A'           d19trc
186100040319     c                   Call      'FNLV19R'
186110040319     c                   Parm                    dslv19
186120040319e   4c                   EndIf
186130010925    3C                   ENDIF
186140010925      *
186150010925    2C                   ENDIF
186160010925    1C                   ENDIF
186170090325     c*
186180090325     c* memorizzo ksc/ctr per p.assegnati
186190090325     c                   if        *in04
186200090325     c                   Clear                   dsbl4a
186210090325     c                   Clear                   dslv19
186220090325     C                   MOVEL     'T'           D19ftr
186230090325     C                   MOVEL     BLPAAS        D19AAS
186240090325     C                   MOVEL     BLPLNP        D19LNP
186250090325     C                   MOVEL     BLPNRS        D19NRS
186260090325     C                   MOVEL     BLPNSP        D19NSP
186270090325     c                   Movel     'A'           d19trc
186280090327     c                   if        wcliksc>0
186290090327     c                   z-add     wcliksc       §b4aks
186300090326     C                   IF        wclictr<>*blanks
186310090325     c                   move      wclictr       §b4act
186320090325     c                   endif
186330090325     c                   exsr      sr_fncls
186340090325     c                   move      wclsflo8      §b4af1
186350090325     c                   Movel     dsbl4a        d19nt1
186360090325     c                   Call      'FNLV19R'
186370090325     c                   Parm                    Dslv19
186380090325     c                   endif
186390090325     c                   endif
186400110706     c* memorizzo CUP/CIG se presenti
186410110706     c                   if        wcupcup<>*blanks or wcupcig<>*blanks
186420110706     c                   Clear                   dsbl44
186430110706     c                   Clear                   dslv19
186440110706     C                   MOVEL     'T'           D19ftr
186450110706     C                   MOVEL     BLPAAS        D19AAS
186460110706     C                   MOVEL     BLPLNP        D19LNP
186470110706     C                   MOVEL     BLPNRS        D19NRS
186480110706     C                   MOVEL     BLPNSP        D19NSP
186490110706     c                   Movel     '4'           d19trc
186500110706     c                   movel     wcupcup       §b44cup
186510110706     c                   movel     wcupcig       §b44cig
186520110706     c                   Movel     dsbl44        d19nt1
186530110706     c                   Call      'FNLV19R'
186540110706     c                   Parm                    Dslv19
186550110706     c                   else
186560110706     c                   if        *in12 and not *in15
186570110706     c                   Clear                   dslv19
186580110706     C                   MOVEL     'T'           D19ftr
186590110706     C                   MOVEL     BLPAAS        D19AAS
186600110706     C                   MOVEL     BLPLNP        D19LNP
186610110706     C                   MOVEL     BLPNRS        D19NRS
186620110706     C                   MOVEL     BLPNSP        D19NSP
186630110706     c                   Movel     '4'           d19trc
186640110706     c                   Call      'FNLV19R'
186650110706     c                   Parm                    Dslv19
186660110706     c                   endif
186670110706     c                   endif
186671150128
186672150128     c* Località normalizzata
186673150210     c                   if        blplod<>wLocNorm
186674150210     c                             or (*in12 and not *in15)
186675150128     c                   Clear                   dslv19
186676150128     C                   MOVEL     'T'           D19ftr
186677150128     C                   MOVEL     BLPAAS        D19AAS
186678150128     C                   MOVEL     BLPLNP        D19LNP
186679150128     C                   MOVEL     BLPNRS        D19NRS
186680150128     C                   MOVEL     BLPNSP        D19NSP
186681150128     c                   Movel     'X'           d19trc
186682150210     c                   if        blplod<>wlocnorm
186683150128     c                   movel     wLocNorm      d19nt1
186684150210     c                   else
186685150210     c                   clear                   d19nt1
186686150210     c                   endif
186687150128     c                   Call      'FNLV19R'
186688150128     c                   Parm                    Dslv19
186689150210     c                   endif
186690150128
186691130305     c* F I A R 8
186692130924     c                   eval      aggioAr8='S'
186700130924     c                   exsr      sr_gesar8
186710130305     c* F I A R 5
186720030805      * se bolla con bancali - part. varia "B"
186730021218      * scrivo o aggiorno il file estensione FIAR500F record "BAN"
186740030704     c                   If        %subst(VidGva:1:1) = 'B'
186750021218     c                   Clear                   DAr5Ban
186760030704     c                   Eval      Kar5Trd = 'BAN'
186770021218     c     KFiar5        Chain     Fiar501l
186780021218     c                   Move      Dateu         Ar5Dac
186790021218     c                   Movel     W0140         Ar5Orc
186800021218     c                   Movel     VidTba        §Ar5Tba
186810021218     c                   Eval      §Ar5Nba = VidNba
186820021218     c                   Movel     VidTb2        §Ar5Tb2
186830021218     c                   Eval      §Ar5Nb2 = VidNb2
186840021218     c                   Movel(p)  DAr5Ban       Ar5Uni
186850030704     c                   ExSr      Sr_wrtFiar5
186860021218     c                   EndIf
186870030805      * se bolla con bancali - part. varia "O"
186880030704      * scrivo o aggiorno il file estensione FIAR500F record "BNB"
186890030730      * se non richiamto da giacenze
186900031125     c                   If        %subst(VidGva:1:1) = 'O'
186910030704     c                   Clear                   DAr5Bnb
186920030704     c                   Eval      Kar5Trd = 'BNB'
186930030704     c     KFiar5        Chain     Fiar501l
186940030704     c                   Move      Dateu         Ar5Dac
186950030704     c                   Movel     W0140         Ar5Orc
186960030704     c                   Movel     VidTba        §Ar5bTba
186970030704     c                   Eval      §Ar5bNba = VidNba
186980030704     c                   Movel     VidTb2        §Ar5bTb2
186990030704     c                   Eval      §Ar5bNb2 = VidNb2
187000030704     c                   Eval      §Ar5bCor = w03cor
187010030704     c                   Eval      §Ar5bCsf = w03csf
187020030704     c                   Movel(p)  DAr5Bnb       Ar5Uni
187030030704     c                   ExSr      Sr_wrtFiar5
187040030704     c                   EndIf
187050030805      * se bolla con paricolarità consegna "RC"
187060030805      * scrivo o aggiorno il file estensione FIAR500F record "RCC"
187070030912      * solo se non sono richiamata da giacenze
187080100604     c**                 If        VidGma = 'RC' and
187090100604     c                   If        §7rRC  = 'S'  and
187100030912     c                             savfpr <> 'G' and savfpr <> 'P'
187110091124      * Aggiorno l'ORM se sono in immissione
187120091124     c                   If        Not *In12 or
187130091124     c                             (*In12 and *In15)
187140091221      * oppure aggiornamento ed inserito "RC"
187150100604     c                             or (*in12 and Not *in15 and w7rRC <> 'S')
187160091124     c                   Eval      wope = 'A'
187170091124     c                   ExSr      Sr_Ricorm
187180030805     c                   Clear                   DAr5Rcc
187190030805     c                   Eval      Kar5Trd = 'RCC'
187200030805     c     KFiar5        Chain     Fiar501l
187210030805     c                   Move      Dateu         Ar5Dac
187220030805     c                   Movel     W0140         Ar5Orc
187230030805     c                   Eval      §Ar5rPoe = savOrmPoe
187240030805     c                   Eval      §Ar5rNsr = savOrmNsr
187250030805     c                   Eval      §Ar5rNor = savOrmNor
187260030805     c                   Eval      §Ar5rNrv = savOrmNrv
187270030805     c                   Movel(p)  DAr5Rcc       Ar5Uni
187280030805     c                   ExSr      Sr_wrtFiar5
187290091221     c                   EndIf
187300030805     c                   EndIf
187310031113      * Se inseriti il referente o il n. di telefono devo memorizzarli
187320031113      * nel FIAR500F record "GEN"
187330040610      * Idem per tipo merce v-valore
187340090804      * Idem se bolla in assegnato con triangolazione
187350110527      * 27/05/11 Ci sarà sempre il record GEN, quindi chaino sempre e scrivo o
187360110527      *          aggiorno
187370110527if  1c****               If        VidRef <> *Blanks or VidTel <> *Blanks
187380110527     c****                         or vidbva <> *blanks  or w_ar5ass='T'
187390110527     c****                         or w_ar5tcp<>*blanks or w_ar5tic<>*blanks
187400110527     c****                         or ar9tic<>*blanks or
187410110527     c****                         w_ar5cdi>0 or not *in12 or *in15
187420031113     c                   Clear                   DAr5Gen
187430031113     c                   Eval      Kar5Trd = 'GEN'
187440031113     c     KFiar5        Chain     Fiar501l
187450031114if  2c                   If        Not %Found(Fiar501l)
187460031113     c                   Move      Dateu         Ar5Dac
187470031113     c                   Movel     W0140         Ar5Orc
187480110527     c                   eval      §ar5bpru=knmus
187490110527     c                   eval      §ar5bnmtd=knmtd
187500031114     c                   Eval      §Ar5Ref = VidRef
187510031114     c                   Eval      §Ar5Teld = VidTel
187520140416     c* se numero di telefono vuoto ma è presente l'sms, quest'ultimo lo copio
187530140416     c* anche in §arteld
187540150213     c***                if        §ar5teld=*blanks
187550150213     c***                eval      §Ar5Teld = wsms
187560150213     c***                endif
187570040610     c                   Eval      §Ar5bva = Vidbva
187580090804     c                   Eval      §Ar5ass = w_ar5ass
187590091001     c                   Eval      §Ar5tcp = w_ar5tcp
187600091001     c                   Eval      §Ar5tic = w_ar5tic
187610091104     c                   Eval      §Ar5tici =ar9tic
187620091214     c                   if        w_ar5cdi>0
187630091214     c                   Eval      §Ar5CDI  =%editc(w_ar5cdi:'X')
187640091119     c                   else
187650091119     c                   clear                   §ar5cdi
187660091118     c                   endif
187670130308     c                   eval      §ar5alx=w_allx
187680130408     c                   eval      §ar5alm=w_allm
187690130417     c                   eval      §ar5als=w_alls
187700140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
187710140407     c* nazione mittente italia
187720140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
187730140407     c                             blpnzm=*blanks
187740140403     c                   eval      §AR5PK2='S'
187750140403     c                   else
187760140403     c                   clear                   §AR5PK2
187770140403     c                   endif
187780031113     c                   Movel(p)  DAr5Gen       Ar5Uni
187790031113     c                   ExSr      Sr_wrtFiar5
187800031114   x2c                   Else
187810040610     c                   movel     ar5uni        DAr5Gen
187820031114     c                   Eval      §Ar5Ref = VidRef
187830031114     c                   Eval      §Ar5Teld = VidTel
187840040610     c                   eval      §ar5bva = vidbva
187850090804     c                   Eval      §Ar5ass = w_ar5ass
187860091001     c                   Eval      §Ar5tcp = w_ar5tcp
187870091001     c                   Eval      §Ar5tic = w_ar5tic
187880091104     c                   Eval      §Ar5tici =ar9tic
187890091214     c                   if        w_ar5cdi>0
187900091214     c                   Eval      §Ar5cdi  =%editc(w_ar5cdi:'X')
187910091119     c                   else
187920091119     c                   clear                   §ar5cdi
187930091118     c                   endif
187940140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
187950140407     c* nazione mittente italia
187960140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
187970140407     c                             blpnzm=*blanks
187980140403     c                   eval      §AR5PK2='S'
187990140403     c                   else
188000140403     c                   clear                   §AR5PK2
188010140403     c                   endif
188020031113     c                   Movel(p)  DAr5Gen       Ar5Uni
188030031113     c                   Update    Fiar5000
188040031114    2c                   EndIf
188050110527    1c****               EndIf
188060130918     c* Impostazione campo §ar5mmp - "S"=Invio mail per avviso merce partita
188070130923     c* In conferma bolle dipende da quello che ho ricevuto nel vat
188080130923    1c                   if        *in12 and *in15
188090130918     c                   clear                   wmmp_ar5
188100130923    2c                   if        wemdest <> *blanks  and
188110130930     c                             (wmmp<>'N' or §ar5alm='S')
188120130918     c                   eval      wmmp_ar5='S'
188130130923    2c                   endif
188140130923   x1c                   else
188150130923     c* In manutenzione bolle se eliminato indirizzo email abblenco campo per
188160130923     c* invio mail per avviso merce partita
188170130923    2c                   if        *in12 and not *in15
188180130923     c                             and wemdest=*blanks
188190130923     c                   clear                   wmmp_ar5
188200130923    2c                   endif
188210130923    1c                   endif
188220140424     c* Pulizia fla invo sms merce partita se manca numero cell.
188230140424     c                   if        wsms=*blanks
188240140424     c                   clear                   wsmp
188250140424     c                   endif
188260110512      * Indirizzo email destinatario
188270110512      * scrivo o aggiorno il file estensione FIAR500F record "EMD"
188280130315     c                   If        wemdest <> *blanks  or wsms<>*blanks
188290110512     c                   Clear                   DAr5emd
188300110512     c                   Eval      Kar5Trd = 'EMD'
188310110512     c     KFiar5        Chain     Fiar501l
188320110613if  2c                   If        Not %Found(Fiar501l)
188330110512     c                   Move      Dateu         Ar5Dac
188340110512     c                   Movel     W0140         Ar5Orc
188350110512     c                   Movel     wemdest       §Ar5eml
188360130315     c                   movel     wsms          §ar5tel
188370130315     c                   movel     wsmp          §ar5smp
188380130918     c                   movel     wmmp_ar5      §ar5mmp
188390110512     c                   Movel(p)  DAr5emd       Ar5Uni
188400110512     c                   ExSr      Sr_wrtFiar5
188410110613     c                   else
188420110613     c                   movel     ar5uni        DAr5emd
188430110613     c                   Movel     wemdest       §Ar5eml
188440130315     c                   movel     wsms          §ar5tel
188450130315     c                   movel     wsmp          §ar5smp
188460130918     c                   movel     wmmp_ar5      §ar5mmp
188470111012     c                   Movel(p)  DAr5Emd       Ar5Uni
188480110613     c                   Update    Fiar5000
188490110613     c                   endif
188500110512     c                   EndIf
188510040610      * Se non sono inseriti il referente e il n. di telefono e v-valore
188520031114      * e sono in manutenzione cancello il FIAR500F record "GEN"
188530110527if  1c****               If        *In12 and Not *In15 and
188540110527     c*****                        VidRef = *Blanks and VidTel = *Blanks
188550110527     c*****                        and vidbva = *blanks
188560110527     c*****                        and w_ar5ass=*blanks
188570110527     c******                       and w_ar5tcp=*blanks
188580110527     c******                       and w_ar5tic=*blanks
188590110527     c******                       and ar9tic=*blanks
188600110527     c*****                        and w_ar5cdi=0
188610110527     c*****              Eval      Kar5Trd = 'GEN'
188620110527     c**** KFiar5        Chain     Fiar501l
188630110527     c****               If        %Found(Fiar501l)
188640110527     c****               Delete    Fiar5000
188650110527     c****               EndIf
188660110527    1c****               EndIf
188670030805      * se sono in manutenzione bolla e non c'è la particolarità
188680021218      * varie "B" controllo se c'è il record in FIAR500F record "BAN"
188690021218      * se c'è è da cancellare
188700030127     c                   If        *In12 and Not *In15 and
188710030704     c                             %Subst(BlpGva:1:1) <> 'B'
188720030704     c                   Eval      Kar5Trd = 'BAN'
188730021218     c     KFiar5        Chain     Fiar501l
188740021218     c                   If        %Found(Fiar501l)
188750021218     c                   Delete    Fiar5000
188760021218     c                   EndIf
188770021218     c                   EndIf
188780030805      * se sono in manutenzione bolla e non c'è la particolarità
188790030704      * varie "O" controllo se c'è il record in FIAR500F record "BNB"
188800030704      * se c'è è da cancellare
188810030704     c                   If        *In12 and Not *In15 and
188820030704     c                             %Subst(BlpGva:1:1) <> 'O'
188830030704     c                   Eval      Kar5Trd = 'BNB'
188840030704     c     KFiar5        Chain     Fiar501l
188850030704     c                   If        %Found(Fiar501l)
188860030704     c                   Delete    Fiar5000
188870030704     c                   EndIf
188880030704     c                   EndIf
188890030807      * se sono in manutenzione bolla e non c'è la particolarità
188900030807      * consegna "RC" controllo se c'è il record in FIAR500F record "RCC"
188910030807      * se c'è è da cancellare
188920030807     c                   If        *In12 and Not *In15 and
188930100604     c                             §7rRC  <> 'S'
188940100604     c***                          BlpGma <> 'RC'
188950030807     c                   Eval      Kar5Trd = 'RCC'
188960030807     c     KFiar5        Chain     Fiar501l
188970030807     c                   If        %Found(Fiar501l)
188980030807     c                   Delete    Fiar5000
188990030807     c                   EndIf
189000030807     c                   EndIf
189010110512      * In msanutenzine cancello fiar5 rcd EMD se è stato eliminato
189020150213if  1c*                  If        *In12 and Not *In15 and
189030150213     c*                            wemdest = *blanks  and atremd=*blanks
189040150213     c*                            and wsms=*blanks
189050150213     c*                  Eval      Kar5Trd = 'EMD'
189060150213     c*    KFiar5        Chain     Fiar501l
189070150213     c*                  If        %Found(Fiar501l)
189080150213     c*                  Delete    Fiar5000
189090150213     c*                  EndIf
189100150213    1c*                  EndIf
189110061213     c*
189120061213     C                   CLEAR                   WABLT
189130071221     C                   CLEAR                   WAgglna           1
189140071221    0c                   if        *in12 and not *in15
189150071221   0Ac                   if        §1bfg6='C' and savlna<>vidlna and
189160071221     c                             §clidkb='S'
189170071221     c                   eval      wagglna='S'
189180071221  x0Ac                   else
189190071221     C*  12
189200071221    1C*ANN15BLPFNS        IFEQ      ' '
189210071221    1c     blpfns        ifeq      ' '
189220061213     C     BLPNCD        ANDNE     0
189230061213     C     §1BFG8        ANDNE     'N'
189240061213     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
189250061213     C     §1BFG8        OREQ      'N'
189260061213     C**
189270061213     C* VEDO SE CANCELLARE LE SPUNTE ENTRATA:
189280061213     C* 1) SE FG8 = N SEMPRE
189290061213     C* 2) SE MODIFICATA LA LNA SEMPRE
189300061213     C* 3) SE AUMENTATO IL NUMERO DEI COLLI SOLO SE FG6 =D O I
189310061213     C* 4) SE DIMINUITO IL NUMERO DEI COLLI SOLO PER GLI ULTIMI
189320061213     C                   MOVEL     'S'           WDELBR            1
189330061213     C                   MOVEL     'S'           WABLT             1
189340061213    2C                   SELECT
189350061213     C     §1BFG8        WHENEQ    'N'
189360061213     C     SAVLNA        ORNE      VIDLNA
189370061213     C                   Z-ADD     99999         WCONTC            5 0
189380061213     C*
189390061213     C     SAVNCL        WHENLT    VIDNCL
189400061213     C     §1BFG6        ANDEQ     'D'
189410061213     C     SAVNCL        ORLT      VIDNCL
189420061213     C     §1BFG6        ANDEQ     'I'
189430061213     C                   Z-ADD     99999         WCONTC            5 0
189440061213     C*
189450061213     C     SAVNCL        WHENGT    VIDNCL
189460061213     C     §1BFG6        ANDEQ     'D'
189470061213     C     SAVNCL        ORGT      VIDNCL
189480061213     C     §1BFG6        ANDEQ     'I'
189490061213     C                   CLEAR                   WCONTC
189500061213     C     SAVNCD        WHENNE    BLPNCD
189510061213     C     SAVNCA        ORNE      BLPNCA
189520061213     C                   MOVEL     'N'           WDELBR            1
189530061213   X2C                   OTHER
189540061213     C                   MOVEL     'N'           WDELBR            1
189550061213     C                   MOVEL     'N'           WABLT
189560061213    2C                   ENDSL
189570061213    1c                   endif
189580071221   0Ac                   endif
189590071221    0c                   endif
189600061213     c* In manutenzione bolle , se riscrivo  fnblt devo clearare blpncr/ncp
189610061213    1c                   if        *in12 and not *in15
189620061213    2c                   if        wablt='S'
189630061213     c                   clear                   blpncr
189640061213     c                   clear                   blpncp
189650061213     c                   clear                   blpvlc
189660061213     c                   clear                   blppkc
189670061213   x2c                   else
189680061213     c* Se già calcolato volume cml devo reimpostarlo su VLF
189690061213    3c                   if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
189700061213     c                   clear                   dslv20
189710061213     C                   MOVEL     'P'           D20TBO
189720061213     C                   MOVEL     'C'           D20TVL
189730061213     c                   movel     'L'           d20tla
189740061213     C                   MOVEL     BLPvlc        D20vlu
189750061213     C                   MOVEL     BLPncr        D20ncr
189760061213     C                   MOVEL     BLPFVF        D20FVF
189770061213     C                   MOVEL     BLPVLF        D20VLF
189780061213     C                   MOVEL     BLPFVB        D20FVB
189790061213     C                   MOVEL     BLPVLB        D20VLB
189800061213     C                   MOVEL     BLPAAS        D20AAS
189810061213     C                   MOVEL     BLPLNP        D20LNP
189820061213     C                   MOVEL     BLPNRS        D20NRS
189830061213     C                   MOVEL     BLPNSP        D20NSP
189840061213     C                   MOVEL     BLPCBO        D20CBO
189850061213     C                   MOVEL     BLPNCL        D20NCL
189860061213    4C     BLPDBR        IFGT      *ZEROS
189870061213     C                   MOVE      BLPDBR        D20DTE
189880061213     C                   ELSE
189890061213     C                   MOVE      BLPMGS        D20DTE
189900061213     C                   MOVEL     BLPAAS        D20DTE
189910061213    4C                   END
189920061213     C                   MOVEL     DSLV20        KPJBU
189930061213     C*
189940061213     C                   CALL      'FNLV20R'
189950061213     C                   PARM                    KPJBA
189960061213     c                   parm      'N'           pwstor            1
189970061213     C*
189980061213     C                   MOVEL     KPJBU         DSLV20
189990061213     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
190000061213    4C     D20ERR        IFNE      '1'
190010061213     C                   MOVEL     D20FVF        BLPFVF
190020061213     C                   MOVEL     D20VLF        BLPVLF
190030061213E   4C                   ENDIF
190040061213    3c                   endif
190050061213    2c                   endif
190060061213    1c                   endif
190070070403     c*
190080070403     c                   exsr      sr_fiarg
190090070604     c*
190100070529     c* manutenzione di un prepagato ed è stato variato l'importo fattura
190110070529     c* eseguo operazioni per invio dati a PDA
190120070601    1c                   if        *in12 and *in15='0' and *in22
190130080213     c                             and vidimv<>savimvo and s_§ogpdaorm<>*blanks
190140070529     c                             and (ormfao=400 or ormfao=410)
190150070604     c                   exsr      sr_pda
190160070601    1c                   endif
190170111026     c* Richiamo pgm per scrittura R.A. in caso di manutenzione con
190180111026     c* riassegnazione segnacolli
190190111026     c                   if        RA_ncl>0
190200111026     c                   exsr      sr_wrtRA
190210111026     c                   endif
190220040601     c
190230950713     C**
190240950713     C* W R I T E   I N   F N B L P 0 0 F
190250950713     C   12
190260950713     CAN 15
190270950713     CORN12              WRITE     FNBLP000
190280950713     C* SE MANUTENZIONE AGGIORNO
190290950713     C   12
190300950713     CANN15              UPDATE    FNBLP000
190310081014     c                   if        *in12 and *in15 and §3cabd_s<>' '
190320081014     c                   clear                   trtc86drds
190330081020     c                   eval      i86mod='UV'
190340081020     c                   z-add     §fgs          i86fgsv
190350081020     c                   z-add     §lpaac        i86aasv
190360081014     c                   z-add     §lplnp        i86lnpv
190370081014     c                   z-add     §lpnrs        i86nrsv
190380081014     c                   z-add     §lpnsp        i86nspv
190390081014     c                   z-add     §lpccm        i86ccmv
190400081014     c                   z-add     §lprmn        i86rmnv
190410081014     c                   move      §lprma        i86rmav
190420081014     c                   z-add     blpaas        i86aasb
190430081014     c                   z-add     blplnp        i86lnpb
190440081014     c                   z-add     blpnrs        i86nrsb
190450081014     c                   z-add     blpnsp        i86nspb
190460081017     c                   if        blpccm>0
190470081014     c                   z-add     blpccm        i86ccmb
190480081017     c                   else
190490081017     c                   z-add     blpksc        i86ccmb
190500081017     c                   endif
190510081014     c                   z-add     blprmn        i86rmnb
190520081014     c                   move      blprma        i86rmab
190530081014     c                   call      'TRTC86DRR'
190540081014     c                   parm                    trtc86drds
190550081014     c                   endif
190560110902     c* Se valore di accorpamento spedizioni in consegna non valido invio
190570110902     c* email a CED
190580110902     c                   if        werrxco=*on
190590110902     c                   exsr      sr_mail
190600110902     c                   endif
190610971215     C**
190620971215     C** VERIFICO SE C'E' ETICHETTA ESTERA DA STAMPARE
190630081008     C**                 CLEAR                   WESTER
190640000204     C* ANCHE PER DPD
190650081008     C**   A_§OGNTW      IFEQ      'DPD'
190660040525     c* se ogsea = "S" significa che l'etichetta estera viene stampata in
190670040525     c* arrivo e quindi lascio wester = blanks
190680081008     c***  A_§ogsea      andne     'S'
190690081008     C***                MOVEL     'S'           WESTER
190700081008     C***                ENDIF
190710001024     C* MANUTENZIONE: SE MODIFICATA DATA SPEDIZIONE AGGIORNO LA DATA
190720001024     C*               ANCHE SU FISGN
190730001024     C   12
190740001024     CANN15BLPDSP        IFNE      WBDSP
190750001024     C     §3CDKC        IFEQ      'S'
190760001024     C     *IN79         ANDEQ     *ON
190770001024     C     §1BF12        ORNE      'N'
190780001106     C     §1BF12        ANDNE     'E'
190790001106     C     §1BF12        OREQ      'E'
190800001106     C     WASDKC        ANDEQ     'S'
190810001024     C     KBLP3         SETLL     FISGN05L
190820001024     C     KBLP3         READE     FISGN05L                               30
190830001024     C     *IN30         DOWEQ     *OFF
190840001024     C                   MOVE      BLPMGS        §LDMGS
190850010326     C                   Z-ADD     BLPTFA        §LDTNA
190860121213     c* Non serve più anzi crea problemi nel caso di fisgn duplicato su altro
190870121213     c* tfp.
190880121213     C***                Z-ADD     BLPTFP        SGNTNP
190890010116     C                   CLEAR                   SGNT6A
190900010116     C                   CLEAR                   SGNT6B
190910010116     C                   CLEAR                   SGNT6C
190920010116     C                   CLEAR                   SGNT6D
190930010116     C                   CLEAR                   SGNT6E
190940010116     C                   CLEAR                   SGNT6F
190950080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
190960001024     C                   UPDATE    FISGN005
190970001024     C     KBLP3         READE     FISGN05L                               30
190980001024     C                   ENDDO
190990001024     C                   ENDIF
191000001024     C                   ENDIF
191010000908     C*
191020000908     C* PER DISK C INSERITO CON DAL AL LO DEVO ESPLODERE
191030001009     C* (TEORICAMENTE DOVREI ESCLUDERE EXPORT DPD SE CHI SONO IMMESSO
191040001009     C* MANUALMENTE O DA RMN IN PRATICA ESCLUDO SEMPRE SE SI TRATTA
191050001009     C* DI EXPORT DPD DAL MOMENTO CHE LE SPEDIZIONI PER DPD SONO
191060001009     C* MONOCOLLO)
191070050224     c* per lo stesso motivo escludo anche le import dpd
191080000913    1C     §1BF12        IFNE      'N'
191090001011     C     WEXDPD        ANDNE     'S'
191100050223     c     *in79         andne     *on
191110000911     C     OZ1NCL        ANDGT     2
191120000908     C* I COD. CHI SONO CHE ESPLODO LI SCRIVO NEL SUBFILE IN AGGIUNTA
191130000908     C* PARTENDO DA NUMERO DI RECORD=NR8
191140000908     C* PRIMA DI CLEARARE LA DS MEMORIZZO IL DAL AL IMPOSTATI NEL
191150000908     C* RICHIAMO FATTO DURANTE I CONTROLLI
191160000911     C     OZ1MAX        IFEQ      '2'
191170000908     C                   MOVEL     IZ1CH1        CHIDAL
191180000908     C                   MOVEL     IZ1CH2        CHIAL
191190000911     C                   ELSE
191200000911     C                   MOVEL     IZ1CH2        CHIDAL
191210000911     C                   MOVEL     IZ1CH1        CHIAL
191220000911     C                   ENDIF
191230000908     C* FACCIO UN CICLO DI RICHIAMI A FNLSZ1R FINO AD ARRIVARE AL
191240000908     C* "CHI SONO" AL
191250000911     C                   MOVE      *ALL' '       WW               35
191260000911     C                   Z-ADD     1             IX
191270000911     C     WW            LOOKUP    CHI(IX)                                30
191280000908    2C     CHIDAL        DOWNE     CHIAL
191290000908     C                   CLEAR                   DSLSZ1
191300000908     C                   MOVEL     'E'           IZ1MOD
191310000908     C                   MOVEL     CHIDAL        IZ1CH1
191320000908     C                   Z-ADD     V8CKSC        IZ1CCM
191330000908     C                   MOVEL     BLPCTM        IZ1CTM
191340000908     C                   Z-ADD     BLPNRS        IZ1NRS
191350000908     C                   CALL      'FNLSZ1R'
191360010402     C                   PARM                    KPJBA
191370000908     C                   PARM                    DSLSZ1
191380000908     C                   PARM                    DS1B
191390000911     C     OZ1CHI        IFNE      CHIAL
191400000908     C                   MOVEL     OZ1CHI        V8CNOT
191410000908     C                   CLEAR                   V8CSCE
191420000908     C                   CLEAR                   V8HDKC
191430000908     C                   CLEAR                   V8HESG
191440000915     C                   CLEAR                   V8HST2
191450000915     C                   CLEAR                   V8HFLS
191460000915     C                   CLEAR                   V8HLNA
191470000915     C                   CLEAR                   V8HNRS
191480000915     C                   CLEAR                   V8HNSC
191490000921     C                   CLEAR                   V8HPRE
191500000911     C                   ADD       1             NR8
191510000911     C                   MOVEL     OZ1CHI        CHI(IX)
191520000911     C                   Z-ADD     NR8           POS(IX)
191530000918     C                   ADD       1             IX
191540000908     C                   WRITE     LS01S08
191550000911     C                   ENDIF
191560000908     C                   MOVEL     OZ1CHI        CHIDAL
191570000908    2C                   ENDDO
191580000908    1C                   ENDIF
191590070322     c* se sono in immissione/conferma bolla di sped export dpd
191600070322     c* con numero parcel lungo 12 carico vidnrd nel subfile
191610070322     c                   if        (*in12='0' or *in15='1') and
191620070322     c                             wexdpd='S' and wparcel='12'
191630070322     c                             and §1bf13<>'A'
191640070326     C* PULIZIA SFL
191650070326     C                   SETON                                        35
191660070326     C                   WRITE     LS01C08
191670070326     C                   SETOFF                                       357833
191680070326     c*
191690070322     c                   z-add     0             nr8
191700070322     C                   MOVEL     vidnrd        V8CNOT
191710070322     C                   MOVEL     *BLANKS       V8CSCE
191720070322     C                   MOVE      *BLANKS       V8HDKC
191730070322     C                   MOVE      *BLANKS       V8HESG
191740070322     C                   MOVE      *ZEROS        V8HST2
191750070322     C                   clear                   V8HFLS
191760070322     C                   clear                   V8HLNA
191770070322     C                   clear                   V8HNRS
191780070322     C                   clear                   V8HNSC
191790070322     C* SCRIVO SUBFILE
191800070322     C                   ADD       1             NR8
191810070322     C                   WRITE     LS01S08
191820070322     c                   endif
191830000204     C**
191840000204     C** PER SI DISK "C" --> CHAIN   F I S G N 0 0 F
191850000204    1C     §3CDKC        IFEQ      'S'
191860070323     c     *IN79         ANDEQ     *ON
191870000907     C     §1BF12        ORNE      'N'
191880001106     C     §1BF12        ANDNE     'E'
191890001106     C     §1BF12        OREQ      'E'
191900001106     C     WASDKC        ANDEQ     'S'
191910000204     C                   CLEAR                   WESSGN
191920000929     C                   CLEAR                   WSGNR
191930000208     C                   CLEAR                   FISGN000
191940000919     C                   MOVEL     'S'           WDKC              1
191950000204     C                   SELECT
191960000204     C* IMPORT DPD --> RIF.MITTENTE
191970060622     C     *IN79         WHENEQ    *ON
191980050301     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
191990050301     C                   CLEAR                   V8HCOL
192000060619    4C     savnpr        IFNE      v7cnpr
192010060623     c     savnpr        andne     *blanks
192020060622     C****               move      savnpr        W0120            12 0
192030060622     C****               MOVEL(P)  W0120         KWHO
192040060622     C     Kblp3         setll     FISGN05L
192050060622    5C                   do        *hival
192060060622     C     Kblp3         reade     FISGN05L
192070060622     c                   if        %eof(fisgn05l)
192080060622     c                   leave
192090060622     c                   endif
192100050301     C                   EXSR      ANNSGN
192110060622    5C                   ENDdo
192120050301     C                   ELSE
192130050301     C                   MOVE      *HIVAL        V8HCOL
192140050301    4C                   ENDIF
192150060621     c* Il chi sono per chainare fisgn lo compongo come segue:
192160060621     c* 1) se ho il barcode id -> barcodeId+CapDest+n.parcel+serv.code+iso N
192170060621     c* 2) se non ho il barcode id --> numero parcel lungo 11+1
192180060622    4c                   if        §b4ibi<>*blanks
192190060623     c* se sono in conferma bolle o in immissione o in manutenzione di
192200060623     c* bolla immessa a mano (no disk)
192210060623     c* compongo il chi sono con i dati che ho
192220060623    5c                   if        *in12='0' or *in15='1'
192230060623     c                             or  *in13='0'
192240090511    6c                   if        *in15='1'
192250090511    7c                   if        §lpcad<>*blanks
192260060622     c                   eval      §lpcad_w=§lpcad
192270090511   x7c                   else
192280060622     c                   eval      §lpcad_w=blpcad
192290090511    7c                   endif
192300090514     c                   else
192310090514     c                   eval      §lpcad_w=blpcad
192320090511    6c                   endif
192330060621     c                   clear                   outcapdpd
192340060621     c                   call      'XCAPDPD'
192350060622     c                   parm                    §lpcad_w
192360060621     c                   parm                    outcapdpd         7
192370060621     c                   eval      kwho=§b4ibi+outcapdpd
192380060621     c* se parcel lungo 12 lo trucco con 0 e 99
192390060622    6c                   if        %subst(§b4ipn:14:1)=*blanks
192400060621     c                   eval      kwho=%trim(kwho)+'0'
192410060621     c                             +%subst(§b4ipn:1:3)
192420060621     c                             +'99' + %subst(§b4ipn:4:8)
192430060622   x6c                   else
192440060621     c                   eval      kwho=%trim(kwho)+§b4ipn
192450060622    6c                   endif
192460060621     C                   MOVEL     '15'          COD
192470060621     C                   MOVEL(P)  BLPNZD        KEY
192480060621     C                   EXSR      CTABEL
192490060621     C   30              CLEAR                   DS15
192500060621     C  N30              MOVEL     TBLUNI        DS15
192510060621     c                   movel     §15cie        §15ciea           3
192520060621     c                   eval      kwho=%trim(kwho)+§b4isc+§15ciea
192530060622   x5c                   else
192540060623     c* altrimenti se sono in manutenzione di bolla ricevuta da cliente
192550060623     c* (DISK A) il chi sono lo reperisco chainando fisgn per key
192560060623     c* spedizione
192570060622     c     kblp3         chain(N)  fisgn05l
192580060622     c                   eval      kwho=sgnwho
192590060622    5c                   endif
192600060622   x4c                   else
192610060710     C                   clear                   kwho
192620060710     C                   movel     §b4ipn        kwho
192630060621     C                   eval      %subst(kwho:12:1)=§b4icd
192640060622    4c                   endif
192650000908     C                   EXSR      CTRSGN
192660050221     C* EXPORT DPD --> da vat O DIGITATO, DA CTM
192670001011    2C     WEXDPD        WHENEQ    'S'
192680140714     C     §1BF13        ANDNE     'A'
192690070322     c     wparcel       andne     '12'
192691140715     c     §1bf12        andne     'B'
192700000204     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
192710001009     C                   CLEAR                   V8HCOL
192720001009    4C     SAVNPR        IFNE      V7CNPR
192730001009     C                   MOVEL(P)  SAVNPR        KWHO
192740010116     C     KSGN          CHAIN     FISGN01L                           30
192750001009    5C     *IN30         IFEQ      *OFF
192760001009     C                   EXSR      ANNSGN
192770001009    5C                   ENDIF
192780001009     C                   ELSE
192790001009     C                   MOVE      *HIVAL        V8HCOL
192800001009    4C                   ENDIF
192810000209     C*
192820001009     C                   MOVEL(P)  V7CNPR        KWHO
192830001009     C                   EXSR      CTRSGN
192840000915     C* DISK C NO DPD: RICHIAMO CTRSGN PER OGNI RECORD DEL SUBFILE
192850001002     C     §1BF12        WHENNE    'N'
192860000908     C                   Z-ADD     1             NR8
192870000908     C                   MOVE      *BLANKS       SAVDKC            1
192880000915     C                   MOVE      *ZEROS        JJ                3 0
192890000908     C     NR8           CHAIN     LS01S08                            30
192900000908    3C     *IN30         DOWEQ     *OFF
192910000908     C* Escludo record annullati
192920000908    4C     V8CSCE        IFEQ      *BLANKS
192930000908     C                   MOVEL(P)  V8CNOT        KWHO
192940000908     C                   CLEAR                   WESSGN
192950000908     C* Controllo file fisgn
192960000908     C                   EXSR      CTRSGN
192970000908     C                   MOVE      WDKC          V8HDKC
192980000919    5C     WESSGN        IFEQ      'S'
192990000908     C                   MOVEL     'S'           V8HESG
193000000915     C                   Z-ADD     SGNST2        V8HST2
193010000919   X5C                   ELSE
193020000920     C                   CLEAR                   V8HESG
193030000915     C                   CLEAR                   V8HST2
193040000919    5C                   ENDIF
193050000908     C                   UPDATE    LS01S08
193060000920     C* Tratto la spedizione come diskC (scrittura di fisgn) se almeno
193070000920     C* un collo lo tratto come DISK C
193080000919    5C     WDKC          IFEQ      'S'
193090000908     C                   MOVE      WDKC          SAVDKC
193100000919    5C                   ENDIF
193110000908     C                   MOVEL     'S'           WDKC
193120000919   X4C                   ELSE
193130051102     C* MEMORIZZO IN SCHIERA ANNULLATI SE LEGATO A ARS
193140000920    5C     V8HCOL        IFGT      *ZEROS
193150000915     C                   ADD       1             JJ
193160000915     C                   Z-ADD     V8HCOL        ANN(JJ)
193170000919     C* SE RECORD ANNULLATO ANNULLO FISGN
193180010116     C     KSGN8         CHAIN     FISGN01L                           30
193190000920    6C     *IN30         IFEQ      *OFF
193200000921     C* Se annullato con A non lo potrò più riattivare perchè ormai i
193210000921     C* dati memorizzati su fisgn non sono più aggiornati correttamente
193220000921     c* Se annullato con A e progressivo = 0 significa che non ci sono
193230000921     c* più bolle manutenzionabili con questo cod. chi sono e quindi
193240000921     c* annullo con *
193250000921     C                   EXSR      ANNSGN
193260000920    6C                   ENDIF
193270000920    5C                   ENDIF
193280000920    4C                   ENDIF
193290000911     C                   ADD       1             NR8
193300000908     C     NR8           CHAIN     LS01S08                            30
193310000908    3C                   ENDDO
193320000908     C     SAVDKC        IFEQ      'S'
193330000908     C                   MOVE      'S'           WDKC
193340000908     C                   ENDIF
193350000204     C                   OTHER
193360000204     C                   MOVEL     'N'           WDKC
193370000204    2C                   ENDSL
193380000204     C*
193390000929   X1C                   ELSE
193400010515     C* 15/05/01: FISGN NON DEVE PIU' ESSERE SCRITTO PER LA RISTAMPA
193410001106     C                   MOVEL     'N'           WDKC
193420000204    1C                   ENDIF
193430980409     C*
193440980409     C* ABBLENCO CAMPO DI COMODO USATO IN ROUTINE CRTBLD PER SAPERE
193450980409     C* SE RISTAMAPRE O MENO L'ETICHETTA SEGNACOLLO
193460980409     C* (WPRT = ' '--> SI RISTAMPA; WPRT= 'N' --> NO RISTAMPA)
193470980409     C                   MOVE      *BLANKS       WPRT              1
193480950713     C**
193490940914     C* F N V A D 0 0 F : DETTAGLIO SEGNACOLLI
193500910807     C** DISK CLI:  CONTROLLO SE SE SONO RECORD NON SEQUENZIALI
193510000919     C   12
193520000919     CAN 15§1BFG7        IFEQ      'S'
193530980410     C     §1BFG6        ANDEQ     'C'
193540980219     C                   SETOFF                                       3130
193550020917     C     KBLC          SETLL     FIVAD000
193560020917     C     KBLC          READE     FIVAD000                               30
193570001002     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
193580001002     C  N30WSGNR         IFEQ      'S'
193590081008     C***  WESTER        IFEQ      'S'
193600081008     C***                MOVEL     'ALL'         §DETST
193610081008     C***                ELSE
193620001106     C                   MOVEL     'ITA'         §DETST
193630040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
193640040506     c* etichetta Italia con dati esteri
193650040506     C     A_§ogntw      IFEQ      'EEX'
193660040506     C                   MOVEL     'EEX'         §DETSE
193670040506     c                   else
193680040506     c                   clear                   §detse
193690040506     C                   ENDIF
193700081008     C***                ENDIF
193710001005     C                   CLEAR                   WSTSEG
193720001002     C                   EXSR      RIESEG
193730001002     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
193740001002     C                   CLEAR                   DSBLD7
193750150202     C                   MOVE      BLPfls        §LCLNP
193760001002     C                   MOVE      BLPLNA        §LCLNA
193770001002     C                   MOVE      BLPNRS        §LCNRS
193780001002     C                   MOVE      BLPZNC        §LCZSC
193790001002     C                   MOVE      DSBLD         WWBLD
193800001002     C                   MOVE      DSBLDE        WWBLDE
193810001002     C                   ENDIF
193820930930     C*
193830930930     C* SE NON SEQUENZIALI MEMORIZZO IL PRIMO SEGNACOLLO
193840971215    2C  N30BLPFNS        IFEQ      'S'
193850941230     C                   MOVEL     BLDNCD        VIDNCD
193860951019     C                   Z-ADD     1             BLDNC1
193870971215    2C                   ENDIF
193880910802     C*
193890971215    2C     *IN30         DOWEQ     '0'
193900001002     C*
193910001002     C     WSGNR         IFEQ      'S'
193920001002     C                   MOVE      WWBLD         DSBLD
193930001002     C                   MOVE      WWBLDE        DSBLDE
193940001002     C                   ENDIF
193950001002     C*
193960980403     C                   MOVEL     BLDNCD        SV1NCD
193970980319     C*
193980980319    3C     BLDNCA        IFEQ      0
193990980319     C                   Z-ADD     BLDNCD        BLDNCA
194000980319    3C                   ENDIF
194010000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
194020051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
194030000915     C     §1BF12        IFNE      'N'
194040000915     C                   Z-ADD     1             NR8
194050000915     C                   ENDIF
194060000929     C*
194070000929     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
194080000929     C     WSGNR         IFEQ      'S'
194090000929     C                   MOVE      BLDCDP        §LDCDP
194100000929     C                   ENDIF
194110980319     C*
194120980319    3C     BLDNCD        DOWLE     BLDNCA
194130990318     C     BLDNCD        ANDGT     0
194140980319     C*
194150980319     C                   MOVEL     BLDNCD        WNSC
194160000929     C                   EXSR      CRTBLT
194170001003     C* No disk c: scrittura fisgn in ristampa
194180010404     C* N.B.: Scrittura fisgn per ristampa --> REGOLA: viene effettua
194190010404     C*       ta al momento della creazione del dettaglio colli (CRTBLT
194200010404     c*       ). Non viene fatta nell routine stasci o stascd come per
194210010404     c*       la scrittura di fisgn per §1bf12<>"N" o per import dpd
194220010404     c*       in quanto queste routine non vengono sempre richiamate
194230010404     c*       (per esempio in conferma bolle da disk quando fg6='S')
194240020917     c*       ECCEZIONE: Se cliente con fivad e fg6="D" l'fisgn viene
194250010404     C*       creato dentro stascd per non perdere il codice prodotto
194260010404     c*       Idem se sono in manutenzione
194270001002     C     WSGNR         IFEQ      'S'
194280000929     C                   ADD       1             §LDNC1
194290001002     C                   Z-ADD     WNSC          §LDNCD
194300001002     C                   Z-ADD     WNSC          §LCNCD
194310001002     C                   EXSR      M10
194320001002     C                   MOVEA     §CA           V8CNOT
194330010404     C                   EXSR      EUREXP
194340010306     C                   MOVEL     DSBLD         WSBLD
194350010306     C                   MOVEL     DSBLDE        WSBLDE
194360010306     C     KSGN8         CHAIN     FISGN01L                           30
194370010306     C                   MOVEL     WSBLD         DSBLD
194380010306     C                   MOVEL     WSBLDE        DSBLDE
194390010306     C   30              EXSR      WRTSGN
194400010306     C  N30              EXSR      UPDSGN
194410001002     C                   ENDIF
194420980319     C*
194430980319     C                   ADD       1             BLDNCD
194440980319    3C                   ENDDO
194450001002     C*
194460001002     C                   MOVE      DSBLD         WWBLD
194470001002     C                   MOVE      DSBLDE        WWBLDE
194480980319     C*
194490980403     C* REIMPOSTO NUMERO SEGNACOLLO CHE SI E' SPORCATO NEL CICLO
194500980403     C* DI CREAZIONE DEL BLT
194510980403     C                   Z-ADD     SV1NCD        BLDNCD
194520980403    3C     BLDNCA        IFEQ      BLDNCD
194530980319     C                   MOVE      *ZEROS        BLDNCA
194540980319    3C                   ENDIF
194550951019     C* CREO FNBLD PER SEGNACOLLI NON SEQUENZIALI
194560971215    3C     BLPFNS        IFEQ      'S'
194570971215     C**
194580971215    4C     §1BFG9        IFEQ      'S'
194590971217     C*
194600081008     C**   §1BFG0        OREQ      'D'
194610081008     C**   §1BFG6        ANDEQ     'C'
194620081008     C**   WESTER        ANDEQ     'S'
194630971217     C*
194640081008     C**   §1BF11        OREQ      'D'
194650081008     C**   §1BFG0        ANDEQ     'C'
194660081008     C**   WESTER        ANDEQ     'S'
194670951019     C                   Z-ADD     BLDNCD        COMSCD
194680951019     C                   Z-ADD     BLDNCL        VARNCL
194690971224     C                   MOVEL     BLDCDP        VARCDP
194700951019     C                   EXSR      ROTCDP
194710971215    4C                   ENDIF
194720971215     C**
194730971215     C** STAMPA LA SOLA ETICHETTA DELL'ESTERO IN IMMEDIATO
194740120302     C**  PER SDI SEMPRE, PER BRT SOLO SE IN IMMEDIATO
194750081008    4C**   WESTER        IFEQ      'S'
194760081008     C**   §1BFG9        ANDNE     'S'
194770971217     C*
194780081008    5C**   §1BFG0        IFEQ      'I'
194790081008     C**   §1BFG6        ANDEQ     'C'
194800971217     C*
194810081008     C**   §1BF11        OREQ      'I'
194820081008     C**   §1BFG0        ANDEQ     'C'
194830081008     C**                 MOVEL     'EST'         §DETST
194840971215     C**
194850971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
194860081008     C**                 Z-ADD     BLDNCD        CO2SCD
194870081008    6C**   BLDNCA        IFEQ      0
194880081008     C**                 Z-ADD     BLDNCD        STANCA
194890081008     C**                 ELSE
194900081008     C**                 Z-ADD     BLDNCA        STANCA
194910081008    6C**                 END
194920971215     C**
194930081008     C**                 EXSR      STASCI
194940081008    5C**                 ENDIF
194950081008    4C**                 ENDIF
194960971215    3C                   ENDIF
194970951019     C*
194980910802     C* CANCELLO FLBLD
194990020917     C                   DELETE    FIVAD000
195000910802     C* RILEGGO
195010020917     C     KBLC          READE     FIVAD000                               30
195020971215    2C                   ENDDO
195030971215    1C                   ENDIF
195040910802     C*
195050921006     C* CREO FLBLT SEQUENZIALE PER:
195060921006     C*         DISK CLI CON SEGNAC SEQUENZIALI
195070921006     C*         MANUTENZIONE BOLLE SE SEQUENZIALI
195080921006     C*         IMMISSIONE BOLLE
195090921016     C                   SETOFF                                       30
195100960404     C   12
195110960404    1CAN 15§3ABCM        IFEQ      ' '
195120941221     C* SE IL CTM PREVEDE SEGNACOLLI --> LI CREO
195130941221     C     §1BFG8        ANDEQ     'S'
195140960404    2C     §1BFG7        IFNE      'S'
195150980410     C     §1BFG6        ORNE      'C'
195160921006     C                   SETON                                            30
195170960404    2C                   END
195180960404    1C                   END
195190921006     C*
195200071221     c                   if        *in12 and not *in15
195210071221     c                   if        wagglna='S'
195220071221     c     kblp3         setll     fnblt01l
195230071221     c     kblp3         reade     fnblt01l
195240071221     c                   dow       not %eof(fnblt01l)
195250071221     c                   eval      bltlna=blplna
195260071221     c                   if        wsbord='S' and bltdfv=0
195270071221     c                   clear                   bltnfv
195280071221     c                   endif
195290071221     c                   update    fnblt000
195300071221     c     kblp3         reade     fnblt01l
195310071221     c                   enddo
195320120814     c* Ripeto lo stesso aggiornamento anche per fiart
195330120814     c     kblp3         setll     fiart01l
195340120814     c     kblp3         reade     fiart01l
195350120814     c                   dow       not %eof(fiart01l)
195360120814     c                   eval      artlna=blplna
195370120814     c                   if        wsbord='S' and bltdfv=0
195380120814     c                   clear                   artnfv
195390120814     c                   endif
195400120814     c                   update    fiart000
195410120814     c     kblp3         reade     fiart01l
195420120814     c                   enddo
195430071221     c                   else
195440071221     C** 12
195450071221    1C**ANN15BLPFNS        IFEQ      ' '
195460071221     c     blpfns        ifeq      ' '
195470921016     C     BLPNCD        ANDNE     0
195480921019     C     §1BFG8        ANDNE     'N'
195490950504     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
195500950504     C     §1BFG8        OREQ      'N'
195510960404     C*
195520980407   2AC     WABLT         IFEQ      'S'
195530960404     C                   MOVEL     5             KNPG
195540960404     C                   MOVEL     SIMFEL        KFLE
195550980320     C*
195560980320     C                   MOVE      *BLANKS       WCRT
195570960404     C*
195580940915     C     KBLP3         SETLL     FNBLT000
195590960404    2C     *IN30         DOWEQ     *OFF
195600051124     C     KBLP3         READE     FNBLT000                               30
195610960404     C*
195620980407    4C  N30WCONTC        IFNE      99999
195630960404     C                   ADD       1             WCONTC
195640960404    4C                   ENDIF
195650960404     C* CANCELLO LE SPUNTE ENTRATA SOLO SE C'E' 'S' E SE WCONTC
195660960404     C*  > DEL NUMERO DEI COLLI
195670980407    3C  N30WDELBR        IFEQ      'S'
195680980407     C     WCONTC        ANDGT     BLPNCL
195690070123     C     KBRV          CHAIN     FNBRV000                           31
195700960404    4C     *IN31         DOWEQ     *OFF
195710051124     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
195720051124     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
195730051124     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
195740051124     c* no anomalie da cancellare create a fronte della spunta entrata
195750051124     c**                 z-add     brvnfv        wrvnfv
195760051124     c**                 movel     param2        kpjbu
195770051124     C**                 CALL      'FNLSA8R'
195780051124     C**                 PARM                    KPJBA
195790070123     C                   DELETE    FNBRV000
195800070123     C     KBRV          READE     FNBRV000                               31
195810960404    4C                   ENDDO
195820040415     c*
195830040415    3C                   ENDIF
195840040415     c*
195850040415     c* cancello dalle spunte entrata il peso e volume se c'e' S e
195860040415     c*  se WCONT <= del numero dei colli
195870040415    3C  N30WDELBR        IFEQ      'S'
195880040415     C     WCONTC        ANDle     BLPNCL
195890070123     C     KBRV          CHAIN     FNBRV000                           31
195900040415    4C     *IN31         DOWEQ     *OFF
195910040415     c                   clear                   brvvuc
195920040415     c                   clear                   brvpuc
195930070123     C                   update    FNBRV000
195940070123     C     KBRV          READE     FNBRV000                               31
195950040415    4C                   ENDDO
195960960404     C*
195970960404    3C                   ENDIF
195980960404     C*
195990000915    3C     *IN30         IFEQ      *OFF
196000980320     C                   MOVE      'S'           WCRT              1
196010051124     C  N30              DELETE    FNBLT000
196020120814     c     kfiart        delete    fiart000                           31
196030980323     C                   MOVEL     'E'           WTRC
196040051102     C     KARS1         CHAIN     FIARS01L                           31
196050051102     C  N31              DELETE    FIARS000
196060020212     C                   MOVEL     'F'           WTRC
196070051102     C     KARS1         CHAIN     FIARS01L                           31
196080020212     c     *in31         ifeq      *off
196090020212     c* Se ho diminuito il numero dei colli oppure ho variato la linea di
196100020212     c* arrivo non devo riassegnare i numeri awb per il segnacollo fedex
196110051102     c* quindi memorizzo il primo numero awb prima di cancellare il ARS
196120020212     c* 'erchè mi servirà per ricrearlo
196130020212     c     wawbini       ifeq      *zeros
196140051102     c                   movel     ARSnot        wawbini
196150020212     c                   z-add     wawbini       wawb
196160020212     c                   endif
196170051102     C                   DELETE    FIARS000
196180020212     c                   endif
196190000915     C                   MOVEL     'C'           WTRC
196200051102     C     KARS1         CHAIN     FIARS01L                           31
196210000920    4C     *IN31         IFEQ      *OFF
196220000921     C* SE HO ELIMINATO SEGNACOLLI DOVREI ANNULLARE EVENTUALE FISGN
196230001003     C* MA NON LO FACCIO PERCHE' QUESTO CASO NON DOVREBBE MAI VERIFI-
196240000921     C* CARSI DAL MOMENTO CHE IN MANUTENZIONE BOLLE NON E' POSSIBILE
196250000921     C* CAMBIARE IL CODICE TRATTAMENTO MERCE
196260051102     C                   DELETE    FIARS000
196270000920    4C                   ENDIF
196280980320    3C                   ENDIF
196290960404    2C                   ENDDO
196300980320     C* SE HO CANCELLATO IL DETTAGLIO COLLI LO RICREO
196310980320     C     §1BFG8        IFEQ      'S'
196320980320     C     WCRT          ANDEQ     'S'
196330980320     C                   Z-ADD     BLPNCD        CO2SCD
196340980320     C     BLPNCA        IFEQ      0
196350980320     C                   Z-ADD     BLPNCD        BLPNCA
196360980320     C                   END
196370000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
196380051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
196390000915     C     §1BF12        IFNE      'N'
196400000915     C                   Z-ADD     1             NR8
196410000915     C                   ENDIF
196420980320     C*
196430980320     C     CO2SCD        DOWLE     BLPNCA
196440000915     C     CO2SCD        ANDGT     0
196450980320     C                   Z-ADD     CO2SCD        WNSC
196460980320     C                   EXSR      CRTBLT
196470980320     C                   ADD       1             CO2SCD
196480980320     C                   END
196490980320     C                   END
196500980408  X2AC                   ELSE
196510980408     C* SE HO SBORDERIZZATO LA BOLLA ELIMINO BLTNFV SU DETT. COLLI
196520980408    2C     WSBORD        IFEQ      'S'
196530980409     C                   EXSR      SBORD
196540980408    2C                   ENDIF
196550980320   2AC                   ENDIF
196560950713     C*
196570960404   X1C                   ELSE
196580950713     C* SE SEGNACOLLI NON SEQUENZIALI E HO SBORDERIZZATO IN AUTOMATICO
196590950713     C*  LA BOLLA --> ELIMINO BLTNFV SU DETT COLLI
196600960404    2C     BLPFNS        IFEQ      'S'
196610950713     C     WSBORD        ANDEQ     'S'
196620980409     C                   EXSR      SBORD
196630960404    2C                   ENDIF
196640950713     C*
196650960404    1C                   ENDIF
196660071221    1C                   endif
196670071221    1C                   endif
196680000915     C* SE SONO IN MANUTENZIONE E NON SONO AUMENTATI O DIMINUITI I
196690051102     C* COLLI E NON E' VARIATA LA LNA DEVO AGGIORNARE ARS PER
196700000915     C* EVENTUALI ANNULLAMENTI E AGGIUNTE SU SUBFILE COD CHI SONO
196710000915     C                   MOVEL     *BLANKS       WUPDSG            1
196720001009    1C     *IN12         IFEQ      *ON
196730001009     C     *IN15         ANDEQ     *OFF
196740001009     C     WABLT         ANDNE     'S'
196750071221     C     WAgglna       ANDNE     'S'
196760001009    2C                   SELECT
196770050228     c* IMPORT DPD                                                     cel
196780050228     c     *in79         wheneq    *on
196790050228     c     §1bf12        andne     'N'
196800060619     c     savnpr        andne     v7cnpr
196810050228     C                   MOVEL     'C'           WTRC
196820051102     C     KARS1P        CHAIN     FIARS01L                           31
196830060622     C**N31              move      v7cnpr        w0120
196840060622     C**N31              movel     w0120         ARSNOT
196850060622     c  n31              movel     v7cnpr        arsnot
196860051114     C  N31              movel     dateu         ARSduv
196870051102     C  N31              UPDATE    FIARS000
196880050228     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
196890050228     C  N31              MOVEL     'S'           WUPDSG
196900001009     C* EXPORT DPD
196910001009     C     §1BF12        WHENNE    'N'
196920001011     C     WEXDPD        ANDEQ     'S'
196930140714     C     §1BF13        ANDNE     'A'
196931140715     c     §1bf12        andne     'B'
196940070323     c     wparcel       andne     '12'
196950001009     C     SAVNPR        ANDNE     V7CNPR
196960001009     C                   MOVEL     'C'           WTRC
196970051102     C     KARS1P        CHAIN     FIARS01L                           31
196980051102     C  N31              MOVEL     V7CNPR        ARSNOT
196990051114     C  N31              MOVEL     dateu         ARSduv
197000051102     C  N31              UPDATE    FIARS000
197010001009     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
197020001009     C  N31              MOVEL     'S'           WUPDSG
197030001009     C     §1BF12        WHENNE    'N'
197040050224     c     *in79         andeq     *off
197050000915     C     ANN(1)        ANDGT     *ZEROS
197060000915     C                   Z-ADD     1             NR8
197070000915     C                   Z-ADD     1             JJ
197080000915     C     NR8           CHAIN     LS01S08                            31
197090001009   2AC     *IN31         DOWEQ     *OFF
197100001003    3C     V8HCOL        IFEQ      *ZEROS
197110000915     C     V8CSCE        ANDEQ     *BLANKS
197120000915     C                   MOVE      ANN(JJ)       KANNUL
197130000915     C                   MOVEL     'C'           WTRC
197140051102     C     KARS1K        CHAIN     FIARS01L                           31
197150051102     C  N31              MOVEL     V8CNOT        ARSNOT
197160051114     C  N31              MOVEL     dateu         ARSduv
197170051102     C  N31              UPDATE    FIARS000
197180000915     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
197190000915     C  N31              MOVEL     'S'           WUPDSG
197200020212    4C     §ogntw        IFEQ      'EEX'
197210000915     C                   MOVEL     'E'           WTRC
197220051102     C     KARS1K        CHAIN     FIARS01L                           31
197230051102     C  N31              MOVEL     V8CNOT        ARSNOT
197240051114     C  N31              MOVEL     dateu         ARSduv
197250051102     C  N31              UPDATE    FIARS000
197260001003    4C                   ENDIF
197270000915     C                   ADD       1             JJ
197280001003    3C                   ENDIF
197290000915     C                   ADD       1             NR8
197300000915     C     NR8           CHAIN     LS01S08                            31
197310001009   2AC                   ENDDO
197320070323     C     §1BF12        WHENNE    'N'
197330070323     C     WEXDPD        ANDEQ     'S'
197340070323     c     v7cnpr        andne     savnpr
197350070323     C                   MOVEL     'S'           WUPDSG
197360001009    2C                   ENDSL
197370001009    1C                   ENDIF
197380921006     C*
197390921006     C  N12BLPNCD        IFGT      0
197400921006     C                   SETON                                        30
197410921006     C                   END
197420921006     C* CREO FLBLT
197430980320     C   12
197440980320     CAN 15
197450980320     CAN 30
197460980320     CORN12
197470980320     CAN 30              DO
197480910827     C                   Z-ADD     BLPNCD        CO2SCD
197490910826     C     BLPNCA        IFEQ      0
197500910826     C                   Z-ADD     BLPNCD        BLPNCA
197510910826     C                   END
197520000908     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
197530051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
197540000908     C     §1BF12        IFNE      'N'
197550000908     C                   Z-ADD     1             NR8
197560000908     C                   ENDIF
197570001003     C*
197580001003     C     WSGNR         IFEQ      'S'
197590001005     C     §1BFG6        ANDNE     'M'
197600001003     C     §1BFG6        IFNE      'D'
197610001003     C     §1BFG7        ORNE      'S'
197620081008     C**   WESTER        IFEQ      'S'
197630081008     C**                 MOVEL     'ALL'         §DETST
197640081008     C**                 ELSE
197650001003     C                   MOVEL     'ITA'         §DETST
197660040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
197670040506     c* etichetta Italia con dati esteri
197680040506     C     A_§ogntw      IFEQ      'EEX'
197690040506     C                   MOVEL     'EEX'         §DETSE
197700040506     c                   else
197710040506     c                   clear                   §detse
197720040506     C                   ENDIF
197730081008     C***                ENDIF
197740001005     C                   CLEAR                   WSTSEG
197750001003     C                   EXSR      RIESEG
197760001003     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
197770001003     C                   CLEAR                   DSBLD7
197780150202     C                   MOVE      BLPfls        §LCLNP
197790001003     C                   MOVE      BLPLNA        §LCLNA
197800001003     C                   MOVE      BLPNRS        §LCNRS
197810001003     C                   MOVE      BLPZNC        §LCZSC
197820001003     C                   ENDIF
197830001003     C                   ENDIF
197840000908     C*
197850910827     C     CO2SCD        DOWLE     BLPNCA
197860990318     C     CO2SCD        ANDGT     0
197870940926     C                   Z-ADD     CO2SCD        WNSC
197880910802     C                   EXSR      CRTBLT
197890001003     C* No disk c: scrittura fisgn in ristampa
197900001003     C* Se la stampa segnacolli è in differita e il cliente mi passa
197910020917     C* fivad non creo qui fisgn ma lo creo quando scrivo fnbld perchè
197920001003     C* in questo caso devo memorizzare su fisgn anche il codice prodot
197930001003     C     WSGNR         IFEQ      'S'
197940001005     C     §1BFG6        ANDNE     'M'
197950001003     C     §1BFG6        IFNE      'D'
197960001003     C     §1BFG7        ORNE      'S'
197970001003     C                   ADD       1             §LDNC1
197980001003     C                   Z-ADD     WNSC          §LDNCD
197990001003     C                   Z-ADD     WNSC          §LCNCD
198000001003     C                   EXSR      M10
198010001003     C                   MOVEA     §CA           V8CNOT
198020010404     C                   EXSR      EUREXP
198030010306     C                   MOVEL     DSBLD         WSBLD
198040010306     C                   MOVEL     DSBLDE        WSBLDE
198050010306     C     KSGN8         CHAIN     FISGN01L                           30
198060010306     C                   MOVEL     WSBLD         DSBLD
198070010306     C                   MOVEL     WSBLDE        DSBLDE
198080010306     C  N30              EXSR      UPDSGN
198090010306     C   30              EXSR      WRTSGN
198100001003     C                   ENDIF
198110001003     C                   ENDIF
198120910827     C                   ADD       1             CO2SCD
198130910805     C                   END
198140910802     C                   END
198150910802     C*
198160910826     C     BLPNCA        IFEQ      BLPNCD
198170910826     C                   Z-ADD     0             BLPNCA
198180910826     C                   END
198190950504     C* PER ELIMINAZIONE DEI SEGNACOLLI, CANCELLO ANCHE FNBLD
198200950504     C   12
198210950504     CANN15§1BFG8        IFEQ      'N'
198220950504     C     KBLP3         SETLL     FNBLD000                               30
198230950504     C     *IN30         IFEQ      *ON
198240950504     C*
198250950504     C     KBLP3         READE     FNBLD000                               30
198260950504     C     *IN30         DOWEQ     *OFF
198270950504     C                   DELETE    FNBLD000
198280950504     C     KBLP3         READE     FNBLD000                               30
198290950504     C                   ENDDO
198300950504     C                   ENDIF
198310950504     C                   ENDIF
198320980320     C*
198330980320     C* LE SEGUENTI ISTRUZIONI SI COLLOCAVANO, PER ANALOGIA, DOPO
198340980320     C* LA CREAZIONE DEL BLD PER I SEGNACOLLI NON SEQUENZIALI.
198350980320     C* SONO STATE SPOSTATE QUI AFFINCHE' IN OGNI CASO IL DETTAGLIO
198360980320     C* COLLI SIA GIA' STATO CREATO PER POTER PERMETTERE LA STAMPA
198370980320     C* DELLE ETICHETTE ESTERE
198380980320     C*
198390980320     C* SE FG9='S' CREO 1 RECORD IN FNBLD  SE SEGNACOLLI SEQUENZIALI
198400980320     C   12
198410980320    1CAN 15BLPFNS        IFEQ      ' '
198420980320     C*
198430980320    2C     §1BFG6        IFEQ      'C'
198440980320     C     §1BFG9        ANDEQ     'S'
198450980320     C*
198460081008     C**   §1BFG0        OREQ      'D'
198470081008    2C**   §1BFG6        ANDEQ     'C'
198480081008     C**   WESTER        ANDEQ     'S'
198490980320     C*
198500081008     C**   §1BF11        OREQ      'D'
198510081008     C**   §1BFG0        ANDEQ     'C'
198520081008     C**   WESTER        ANDEQ     'S'
198530980320     C                   Z-ADD     BLPNCD        BLDNCD
198540980320     C                   Z-ADD     BLPNCA        BLDNCA
198550980320     C                   Z-ADD     VIDNCL        BLDNCL
198560980320     C                   Z-ADD     1             BLDNC1
198570980320     C                   EXSR      CRTBLD
198580980320    2C                   ENDIF
198590980320     C** STAMPA ETICHETTA IN IMMEDIATO SE ESTERA LA LNA
198600081008    2C**   WESTER        IFEQ      'S'
198610081008     C**   §1BFG9        ANDNE     'S'
198620980320     C*
198630081008    3C**   §1BFG0        IFEQ      'I'
198640081008     C**   §1BFG6        ANDEQ     'C'
198650980320     C*
198660081008     C**   §1BF11        OREQ      'I'
198670081008     C**   §1BFG0        ANDEQ     'C'
198680081008     C**                 MOVEL     'EST'         §DETST
198690980320     C**
198700980320     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
198710081008     C**                 Z-ADD     BLPNCD        CO2SCD
198720081008    4C**   BLPNCA        IFEQ      0
198730081008     C**                 Z-ADD     BLPNCD        STANCA
198740081008     C**                 ELSE
198750081008     C**                 Z-ADD     BLPNCA        STANCA
198760081008    4C**                 END
198770980320     C**
198780081008     C**                 EXSR      STASCI
198790081008    3C**                 ENDIF
198800081008    2C**                 ENDIF
198810980320    1C                   ENDIF
198820910805     C*
198830910805     C* E S T E N S I O N E   B O L L A
198840991006      *
198850991006      * Se agganciata precedentemente riaggancio file tassazione per 2a bolla
198860991006     C     WAR62         IFEQ      'E'
198870991006     C                   MOVEL     '2'           WTRC
198880050331     c                   if        wKSCsf2 <> 0000 and wKSCsf2 <> 9999
198890050331     c     kblp4         delete    fiar6000
198900050331     c                   clear                   war62
198910050331     c                   else
198920991006     C     KBLP4         CHAIN     FIAR6000                           30
198930050331     c                   endif
198940991006     C                   ENDIF
198950991006      *
198960040116if  1c                   If        *In05 and
198970040116     c                             (wesvar1 <> *Blanks or Vi2Cei <> *Blanks)
198980040116      * Carico le varie
198990040116if  2c                   If        wesvar1 <> *Blanks
199000040116     c                   Clear                   wsv1
199010040116     c                   Clear                   wva1
199020040116     c                   Clear                   wsv2
199030040116     c                   Clear                   wva2
199040040116     c                   Clear                   wsv3
199050040116     c                   Clear                   wva3
199060040116     c                   Eval      ContaSv = 1
199070041217do  3c                   Do        6             c
199080040116     c                   If        w2sv(c) <> *Blanks
199090040116     c                   Exsr      Wrtvar1
199100040116     c                   EndIf
199110040116    3c                   EndDo
199120040116    2c                   EndIf
199130991006      *
199140991006     C                   CLEAR                   FIAR6000
199150991006      *
199160991006     C                   MOVEL     '2'           AR6TRC
199170991006     C                   MOVEL     BLPAAS        AR6AAS
199180991006     C                   MOVEL     BLPLNP        AR6LNP
199190991006     C                   MOVEL     BLPNRS        AR6NRS
199200991006     C                   MOVEL     BLPNSP        AR6NSP
199210991006     C                   MOVEL     VI2CEI        AR6CEI
199220040116     c                   Movel     wsv1          Ar6Sv1
199230040116     c                   Z-add     wva1          Ar6Va1
199240040116     c                   Movel     wsv2          Ar6Sv2
199250040116     c                   Z-add     wva2          Ar6Va2
199260040116     c                   Movel     wsv3          Ar6Sv3
199270040116     c                   Z-add     wva3          Ar6Va3
199280991015     C                   MOVEL     VI2DIV        AR6DIV
199290991022     C                   MOVE      9999          AR6KSC
199300991022     C                   MOVEL     AR6LNP        AR6KSC
199310040126     c                   Z-add     Vi2Imv        Ar6Imv
199320991022     C     AR6IMV        IFGT      *ZEROS
199330991022     C                   MOVEL     'P'           AR6FIM
199340991022     C                   ELSE
199350991022     C                   CLEAR                   AR6FIM
199360991022     C                   ENDIF
199370991014     C* DATI PER STAMPA SOLO SE NON è PREPAGATO
199380991014     C     *IN34         IFEQ      *OFF
199390040116     c                   Z-add     Ar6Imv        Db0Imv
199400941108     C                   MOVEL     VI2CEI        DB0CEI
199410991014     C                   MOVEL     V2DCEI        DB0DCE
199420991015     C                   MOVEL     VI2DIV        DB0DIV
199430991014     C                   MOVEL     WFDC2         DB0FDC
199440991014     C                   ENDIF
199450900507     C*
199460991006     C     WAR62         IFEQ      'E'
199470991006     C                   UPDATE    FIAR6000
199480940926     C                   ELSE
199490991006     C                   WRITE     FIAR6000
199500940926     C                   ENDIF
199510930624     C*
199520940920   X1C                   ELSE
199530940926     C*  C'ERA MA ELIMINATA LA ESTENSIONE BOLLA
199540991006    2C     WAR62         IFEQ      'E'
199550991006     C                   DELETE    FIAR6000
199560930624    2C                   ENDIF
199570930624    1C                   ENDIF
199580940926     C***
199590930331     C*** L E G A M E   B O L L A
199600930331     C   12
199610930331     CANN15VIDLNA        IFNE      SAVLNA
199620940915     C     KBLP3         CHAIN     FNLBL000                           30
199630930331     C  N30              Z-ADD     BLPLNA        LBLLAN
199640940928     C  N30              MOVEL     ' '           LBLFT1
199650940928     C  N30              MOVEL     ' '           LBLFT2
199660940915     C  N30              UPDATE    FNLBL000
199670930331     C                   END
199680910117     C***
199690910125     C* IMMISSIONE:
199700910411     C* NO STAMPA SEGNACOLLO IN  D I F F E R I T A:
199710910220     C     §1BFG6        IFNE      'D'
199720951019     C   12
199730951019     CAN 15              EXSR      DELVAD
199740910220     C                   ELSE
199750960805     C*    STAMPA SEGNACOLLO IN DIFFERITA: CREO FNBLD00F
199760910128     C  N12              DO
199770910128     C                   SETON                                        30
199780910128     C                   Z-ADD     BLPNCD        BLDNCD
199790910128     C                   Z-ADD     BLPNCA        BLDNCA
199800910506     C                   Z-ADD     VIDNCL        BLDNCL
199810910128     C                   EXSR      CRTBLD
199820910128     C                   END
199830910129     C* MANUTENZIONE / DISK CLIENTI:
199840910129     C   12              DO
199850910521     C*** DISK CLIENTI NO DETTAGLIO COLLI DA CLIENTE:
199860910411     C   15§1BFG7        IFNE      'S'
199870040618     c     §1bf12        oreq      'B'
199880910411     C                   Z-ADD     BLPNCD        BLDNCD
199890910411     C                   Z-ADD     BLPNCA        BLDNCA
199900910506     C                   Z-ADD     VIDNCL        BLDNCL
199910910521     C                   Z-ADD     1             BLDNC1
199920910411     C                   EXSR      CRTBLD
199930020917     C* DELETO FIVAD SE C'ERA
199940960805     C                   EXSR      DELVAD
199950910411     C*
199960910411     C                   ELSE
199970910411     C*
199980910521     C*** DISK CLIENTI SI DETTAGLIO COLLI DA CLIENTE:
199990020917     C     KBLC          SETLL     FIVAD000
200000020917     C     KBLC          READE     FIVAD000                               30
200010910411     C*
200020940214     C                   Z-ADD     BLPNCD        COMSCD
200030940214     C                   MOVEL     BLDCDP        VARCDP
200040910411     C                   Z-ADD     1             BLDNC1
200050940214     C                   CLEAR                   VARNCL
200060910411     C*
200070930628     C     *IN30         DOWEQ     *OFF
200080940214     C*
200090960805     C* CREO RECORD IN FNBLD00 PER ROTTURA COD PRODOTTO
200100940214     C     BLDCDP        IFNE      VARCDP
200110001018     C* SE DEVO SCRIVERE FISGN IN RISTAMPA IMPOSTO WSGNR = 'B' PER
200120001018     C* RICHIAMARE STASCD (SCRITTURA DI FISGN AL MOMENTO DELLA SCRITTU-
200130001018     C* DI FNBLD)
200140001018     C     WSGNR         IFEQ      'S'
200150010515     C                   MOVEL     'B'           WSGNR             1
200160001018     C                   ENDIF
200170940214     C                   EXSR      ROTCDP
200180940214     C                   ENDIF
200190940214     C*
200200940214     C* SE CODICE PRODOTTO NON MODIFICATO, SOMMO INSIEME I 2 RECORD
200210940214     C                   ADD       BLDNCL        VARNCL
200220940214     C*
200230910411     C* CANCELLO IL RECORD DAL FLBLD DI PASSAGGIO
200240020917     C                   DELETE    FIVAD000
200250910411     C*
200260020917     C     KBLC          READE     FIVAD000                               30
200270940214     C                   ENDDO
200280940214     C* ULTIMA ROTTURA
200290001018     C     WSGNR         IFEQ      'S'
200300001018     C                   MOVEL     'B'           WSGNR
200310001018     C                   ENDIF
200320940214     C                   EXSR      ROTCDP
200330940214     C*
200340910411     C                   END
200350910411     C*
200360910411     C*** MANUTENZIONE BOLLE:
200370910411     C  N15              DO
200380001003     C*
200390001003     C*
200400910201     C                   SETOFF                                       3132
200410910411     C     SAVLNA        COMP      VIDLNA                             3131
200420910411     C  N31VIDNCL        COMP      SAVNCL                             3132
200430910125     C*
200440940214     C*  L I N E A   A R R I V O   > <   O   N C L   A U M E N T A T O
200450910411     C   31              DO
200460000915     C     KBLP3         CHAIN     FNBLD000                           33
200470940214     C*
200480000915     C     *IN33         IFEQ      *OFF
200490940214     C                   Z-ADD     BLPNCD        COMSCD
200500940214     C                   MOVEL     BLDFST        SAVFST
200510940214     C*
200520940214     C     SAVNCL        IFNE      VIDNCL
200530940214     C                   Z-ADD     VIDNCL        BLDNCL
200540940214     C                   ENDIF
200550940214     C                   ENDIF
200560910128     C*
200570001019     C                   CLEAR                   WSTSGN
200580001019     C*
200590000915     C     *IN33         DOWEQ     '0'
200600001018     C     WSGNR         IFEQ      'S'
200610001018     C                   MOVEL     'B'           WSGNR
200620001018     C                   ENDIF
200630940224     C                   Z-ADD     BLDNCL        VARNCL
200640940224     C                   MOVEL     BLDCDP        VARCDP
200650940224     C*
200660940224     C                   EXSR      ROTCDP
200670940214     C*
200680960404     C* SE PUO' AVERE PIU' CODICI PRODOTTO (FLAG 7 = "S") RILEGGO
200690960404     C*  ALTRIMENTI ESCO DALLA LETTURA DI FNBLD00F, PERCHE' SE HO
200700940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
200710940907     C     §1BFG7        IFEQ      'S'
200720000915     C     KBLP3         READE     FNBLD000                               33
200730940907     C                   ELSE
200740000915     C                   SETON                                        33
200750940907     C                   END
200760940907     C*
200770940214     C                   ENDDO
200780910128     C*
200790910128     C                   END
200800910128     C*
200810910405     C** ALTRE MODIFICHE DELLA MANUTENZIONE BOLLE
200820910405     C*
200830940214     C* D I M I N U Z I O N E   N U M E R O   D E I   C O L L I
200840910411     C  N31*IN32         IFEQ      '1'
200850001019     C                   CLEAR                   WSTSGN
200860000915     C     KBLP3         CHAIN     FNBLD000                           33
200870910405     C*
200880910405     C                   Z-ADD     BLPNCD        BLDNCD
200890910405     C                   Z-ADD     BLPNCA        BLDNCA
200900910506     C                   Z-ADD     VIDNCL        BLDNCL
200910000915     C  N33              MOVEL     BLDFST        SAVFST
200920001018     C     WSGNR         IFEQ      'S'
200930001018     C                   MOVEL     'B'           WSGNR
200940001018     C                   ENDIF
200950910405     C                   EXSR      CRTBLD
200960910405     C*
200970910405     C                   ELSE
200980910405     C*
200990910405     C*                    MODIFICHE CON   AGGIORNAMENTO FLBLD
201000940214     C*
201010940921     C     SAVMIT        IFNE      WKSC
201020960926     C     SAVPDR        ORNE      VIDPDR
201030940214     C     SAVRSD        ORNE      VIDRSD
201040910411     C* CODICE PRODOTTO DA RIF ALFABETICO
201050940214     C     §1BFG7        ORNE      'S'
201060940922     C     SAVRMA        ANDNE     VIDRMA
201070940214     C                   SETON                                        31
201080980409     C* Memorizzo di non ristampare l'etichetta
201090050422     c* (solo se non ho variato campi per cui devo ristampare)
201100050422     C     SAVTSP        IFeq      BLPTSP
201110050422     C     SAVCAD        andeq     VIDCAD
201120050422     C     SAVZNC        andeq     VARZNC
201130050422     C     SAVbva        andeq     vidbva
201140980409     C                   MOVE      'N'           WPRT              1
201150050422     c                   endif
201160940214     C                   ENDIF
201170910411     C*
201180910405     C*                    MODIFICHE SENZA AGGIORNAMENTO FLBLD
201190980409     C  N31SAVTSP        IFNE      BLPTSP
201200940214     C     SAVCAD        ORNE      VIDCAD
201210940214     C     SAVZNC        ORNE      VARZNC
201220050421     C     SAVbva        ORNE      vidbva
201230910405     C                   SETON                                        3132
201240930402     C                   END
201250120302     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BRT
201260051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
201270980409     C     SAVCAD        IFNE      VIDCAD
201280051102     C                   EXSR      AGGARS
201290980409     C                   END
201300000915     C* SE HO VARIATO SOLO COD.CHI SONO DEVO ANDARE IN WRITE SU FISGN
201310000915     C     *IN31         IFEQ      *OFF
201320000915     C     *IN32         ANDEQ     *OFF
201330000915     C     WUPDSG        ANDEQ     'S'
201340000915     C                   SETON                                        3132
201350000915     C                   ENDIF
201360940214     C* --> VARIO FLBLD
201370971230     C     *IN31         IFEQ      *ON
201380001019     C                   CLEAR                   WSTSGN
201390000915     C     KBLP3         CHAIN     FNBLD000                           33
201400000915     C  N33              MOVEL     BLDFST        SAVFST
201410941108     C*
201420000915     C     *IN33         DOWEQ     *OFF
201430001018     C     WSGNR         IFEQ      'S'
201440001018     C                   MOVEL     'B'           WSGNR
201450001018     C                   ENDIF
201460980410     C* VARIAZIONE FLBLD00F E STAMPA
201470971230     C     *IN32         IFEQ      *OFF
201480940214     C                   EXSR      CRTBLD
201490971230     C                   ELSE
201500001005     C* RICHIAMO STASCD PER SCRITTURA FISGN IN RISTAMPA
201510001005     C     WSGNR         IFEQ      'B'
201520001005     C                   EXSR      STASCD
201530001005     C                   MOVEL     'S'           WSGNR
201540001005     C                   ENDIF
201550940214     C* SOLO STAMPA
201560971217     C*  NON VENGONO RISTAMPATI I SAGNACOLLI SE SONO SOLO ESTERO
201570971230     C     SAVFST        IFEQ      'S'
201580980319     C                   EXSR      STASCD
201590081008     C**   *IN12         IFEQ      *ON
201600081008     C**   *IN15         ANDEQ     *OFF
201610081008     c**   A_§ogntw      andeq     'EUP'
201620081008     C**                 MOVEL     'E'           WTRC
201630081008     C**   KBLP4         CHAIN     Fiar4000                           90
201640081008     C**   *IN90         IFEQ      *OFF
201650081008     C**                 MOVEL     ar4NOT        DSBL4E
201660081008     C**                 MOVEL     'S'           §B4EST
201670081008     C**                 MOVEL     DSBL4E        ar4NOT
201680081008     C**                 UPDATE    Fiar4000
201690081008     C**                 ENDIF
201700081008     C**                 SETOFF                                       90
201710081008     C**                 ENDIF
201720971230     C                   ENDIF
201730040603     c* disalloco record di fnbld
201740040603     c                   unlock    fnbld01l
201750971230     C                   ENDIF
201760940907     C*
201770940907     C* SE PUO' AVERE PIU' CODICI PORDOTTO (FLAG 7 = "S") RILEGGO
201780940907     C*  ALTRIMENTI ESCO DALLA LETTURA DI FLBLD50F, PERCHE' SE HO
201790940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
201800971230     C     §1BFG7        IFEQ      'S'
201810000915     C     KBLP3         READE     FNBLD000                               33
201820940907     C                   ELSE
201830000915     C                   SETON                                        33
201840971230     C                   END
201850940907     C*
201860940214     C                   ENDDO
201870940214     C                   ENDIF
201880910417     C                   END
201890910128     C*
201900910128     C                   END
201910910411     C                   END
201920910201     C                   END
201930910411     C*
201940910411     C* STAMPA SEGNACOLLO IN  I M M E D I A T O
201950910131     C     §1BFG6        IFEQ      'I'
201960910208     C* PER DISK CLIENTI O IMMISSIONE BOLLE STAMPO SUBITO
201970910208     C                   MOVEL     *BLANKS       §LDRST
201980081008     C**   WESTER        IFEQ      'S'
201990081008     C**                 MOVEL     'ALL'         §DETST
202000081008     C**                 ELSE
202010971215     C                   MOVEL     'ITA'         §DETST
202020040505     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
202030040505     c* etichetta Italia con dati esteri
202040040505     C     A_§ogntw      IFEQ      'EEX'
202050040505     C                   MOVEL     'EEX'         §DETSE
202060040506     c                   else
202070040506     c                   clear                   §detse
202080040505     C                   ENDIF
202090081008     C**                 ENDIF
202100971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
202110971215     C                   Z-ADD     BLPNCD        CO2SCD
202120971215     C     BLPNCA        IFEQ      0
202130971215     C                   Z-ADD     BLPNCD        STANCA
202140971215     C                   ELSE
202150971215     C                   Z-ADD     BLPNCA        STANCA
202160971215     C                   END
202170910131     C   12
202180910131     CAN 15
202190910201     CORN12              EXSR      STASCI
202200910131     C*
202210910405     C* IN MANUTENZIONE STAMPO SOLO SE CAMBIATI:
202220910131     C   12
202230910131     CANN15              DO
202240001005     C     WSGNR         IFEQ      'S'
202250001005     C                   MOVEL     'B'           WSGNR
202260001005     C                   ENDIF
202270980320     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BAR (MA NON LA LNA)
202280051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
202290980409     C     SAVCAD        IFNE      VIDCAD
202300051102     C                   EXSR      AGGARS
202310980409     C                   END
202320000922     C* SE DISK C DEVO RICHIAMARE STASCI ANCHE PER LE SEGUENTI VARIAZ.
202330050228     C***  §1BF12        IFNE      'N'
202340050228     C***  §1BF12        ANDNE     'E'
202350050228     C***  §1BF12        OREQ      'E'
202360050228     C***  WASDKC        ANDEQ     'S'
202370050228     C***  WSGNR         OREQ      'B'
202380050228     C***  SAVMIT        IFNE      WKSC
202390050228     C***  SAVPDR        ORNE      VIDPDR
202400050228     C***  SAVRSD        ORNE      VIDRSD
202410050228     C***  §1BFG7        ORNE      'S'
202420050228     C***  SAVRMA        ANDNE     VIDRMA
202430050228     C***                MOVEL     'S'           WUPDSG
202440050228     C***                ENDIF
202450050228     C***                ENDIF
202460980320     C*
202470001018     C                   CLEAR                   WNOPRT
202480940214     C     SAVLNA        IFNE      VIDLNA
202490940214     C     SAVNCL        ORNE      VIDNCL
202500940214     C     SAVCAD        ORNE      VIDCAD
202510930930     C     SAVZNC        ORNE      VIDZNC
202520941230     C     SAVTSP        ORNE      BLPTSP
202530050421     C     SAVbva        ORNE      vidbva
202540910405     C*
202550930930     C                   EXSR      STASCI
202560001018     C                   ELSE
202570050228     c     wdkc          ifeq      'S'
202580050228     c     wsgnr         oreq      'B'
202590050228     C     SAVMIT        IFNE      WKSC
202600050228     C     SAVPDR        ORNE      VIDPDR
202610050228     C     SAVRSD        ORNE      VIDRSD
202620050228     C     §1BFG7        ORNE      'S'
202630050228     C     SAVRMA        ANDNE     VIDRMA
202640050228     c     wupdsg        oreq      'S'
202650001018     C                   MOVEL     '1'           WNOPRT            1
202660001018     C                   EXSR      STASCI
202670001018     C                   ENDIF
202680050228     c                   endif
202690930930     C                   ENDIF
202700910131     C                   END
202710910117     C                   END
202720910312     C*
202730910129     C* PER DISK CLIENTI SE CAMBIATO CTM E PRIMA ERA "D" CANCELLO
202740020917     C*   IN FIVAD01L I RECORD
202750940222     C     *IN12         IFEQ      *ON
202760940222     C     *IN15         ANDEQ     *ON
202770970328     C* FLAG DI RISTAMPA BOLLA
202780970328     C                   MOVEL     WSTA          CMD8
202790940222     C                   ENDIF
202800980406     C* PER DISK CLIENTI SE CAMBIATO CTM VEDO SE CANCELLARE IL VAT
202810980406     C     *IN12         IFEQ      *ON
202820980406     C     *IN15         ANDEQ     *ON
202830980406     C                   EXSR      DELVAT
202840040601     C                   EXSR      DELVAX
202850980406     C                   END
202860940920     C***
202870940216     C* S T A M P A    B O L L A
202880940920     C***
202890020619     C* ESCLUDO SEMPRE BOLLE DI RECUPERO (TRANNE LE BOLLE FO-ASSEGNATO
202900020619     c* RECUPERO BOLLE firmate perchè in questo caso la bolla firmata
202910020619     c* deve partire con allegata la bolla di recupero)
202920040701     C* ESCLUDO SEMPRE BOLLE EXPORT DPD, BOLLE POSTE (solo se data
202930040701     c* spedizione < data in tabella "VPO" trk "PPT"
202940000121     C*
202950940920     C* 1) SE FLG STAMPA BOLLA CLIENTE NON E' "S" (STAMPATA DAL CLIENT)
202960940920     C*                              E NON E' "B" (DA STAMPARE COL PGM
202970940920     C*                                            DI RISTAMPA BOLLA)
202980940920     C*                                MA  E' "N" (DA STAMPARE IN IMMIS
202990940920     C*                                            SIONE BOLLE)
203000940920     C* IN MANUTENZIONE SI PUO' RISTAMPARE SEMPRE
203010970407     C* 2) SE IN MANUT. SE PREMUTO CMD8  (CMD8= 1)
203020941230     C* 3) SE DA DISK CLIENTI SOLO SE LNP >< DA LNA   PER "G"
203030960321     C* 4) SE DA DISK CLIENTI MAI                     PER "P"
203040970407     C* 5) SE IN MANUT. SE ERA NO DDT E DIVENTA SI DDT STAMPO SUBITO
203050000121     C* 6) SE IN MANUT. SE ERA SI DDT DPD E DIVENTA SI DDT NON DPD
203060000121     C*                                                STAMPO SUBITO
203070940216     C*
203080000121     C* 7) RESI E DIROTTAMENTI SEMPRE SUBITO
203090000121     C* 8) SE BOLLA A3 NON SI PUO' MAI STAMPARE
203100000121     C* 9) SE BOLLA F3 NON SI PUO' STAMPARE IN IMMISSIONE
203110000509     C*10) SE MANUTENZIONE DI PREPAGATO, RISTAMPO SEMPRE SE E' DDT SI
203120000121     C*11) SE IMMISSIONE   DI PREPAGATO, STAMPO SEMPRE
203130960321    0C     §3ATB1        IFNE      'A3'
203140020319     C     A_§OGNTW      ANDNE     'DPD'
203150020319     C     §ogntw        ANDNE     'PPT'
203160020619     c     §3atb1        oreq      'A3'
203170020619     c     blpcbo        andeq     'FO'
203180020319     C     §ogntw        OREQ      'PPT'
203190000713     C     BLPNRS        ANDEQ     0
203200040701     c     §ogntw        oreq      'PPT'
203210040729     c     blpdsp        andge     §vpoptl
203220000218     C* PER I PREPAGATI STAMPO LA BOLLA CHE E'LA FATTURA
203230000218     C     *IN34         OREQ      *ON
203240960321     C*
203250941110    1C     *IN12         IFEQ      *OFF
203260970128     C     BLPFST        ANDEQ     'S'
203270940216     C*
203280940216     C     *IN12         OREQ      *ON
203290940216     C     CMD8          ANDEQ     '1'
203300970404     C     BLPFST        ANDNE     'N'
203310970404     C*
203320970404     C     *IN12         OREQ      *ON
203330970404     C     *IN15         ANDEQ     *OFF
203340970404     C     SAVBAM        ANDNE     'S'
203350970404     C     SAVBAM        ANDNE     'C'
203360970404     C     BLPFST        ANDEQ     'S'
203370970407     C*
203380970407     C     *IN12         OREQ      *ON
203390970407     C     *IN15         ANDEQ     *ON
203400970407     C     CMD8          ANDEQ     'S'
203410990630     C*
203420990630     C     *IN12         OREQ      *ON
203430990701     C     *IN15         ANDEQ     *OFF
203440990630     C     BLPFST        ANDEQ     'S'
203450990701     C     *IN22         ANDEQ     *ON
203460990701     C     *IN12         OREQ      *OFF
203470990701     C     *IN34         ANDEQ     *ON
203480000121     C*
203490000121     C     *IN12         OREQ      *ON
203500000121     C     *IN15         ANDEQ     *OFF
203510020319     C     SAVNTW        ANDEQ     'DPD'
203520020319     C     A_§OGNTW      ANDNE     'DPD'
203530000121     C     BLPFST        ANDEQ     'S'
203540900514     C                   EXSR      STAMPA
203550940216    1C                   END
203560960321    0C                   END
203570911031     C*
203580911031     C* PASSO IL NUMERO DI SPEDIZIONE AL PGM RICHIAMATO
203590911031     C   12              Z-ADD     BLPNSP        §LPNSP
203600921006     C* SE RECUPERO ADDIZIONO 1 AL NUMERO
203610921006     C  N12
203620921006     CAN 98              ADD       1             RECNSP
203630900504     C*
203640040415     c* In manutenzione bolle , se riscritto fnblt devo clearare blpncr/ncp
203650061213    1c*                  if        *in12 and not *in15
203660061213    2c*                  if        wablt='S'
203670061213     c*    blpnrr        chain     fnblp000                           90
203680061213     c*                  clear                   blpncr
203690061213     c*                  clear                   blpncp
203700061213     c*                  clear                   blpvlc
203710061213     c*                  clear                   blppkc
203720061213     c* n90              update    fnblp000
203730061213   x2c*                  else
203740050502     c* Se già calcolato volume cml devo reimpostarlo su VLF
203750061213    3c*                  if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
203760061213     c*    blpnrr        chain     fnblp000                           90
203770061213     c*                  clear                   dslv20
203780061213     C*                  MOVEL     'P'           D20TBO
203790061213     C*                  MOVEL     'C'           D20TVL
203800061213     c*                  movel     'L'           d20tla
203810061213     C*                  MOVEL     BLPvlc        D20vlu
203820061213     C*                  MOVEL     BLPncr        D20ncr
203830061213     C*                  MOVEL     BLPFVF        D20FVF
203840061213     C*                  MOVEL     BLPVLF        D20VLF
203850061213     C*                  MOVEL     BLPFVB        D20FVB
203860061213     C*                  MOVEL     BLPVLB        D20VLB
203870061213     C*                  MOVEL     BLPAAS        D20AAS
203880061213     C*                  MOVEL     BLPLNP        D20LNP
203890061213     C*                  MOVEL     BLPNRS        D20NRS
203900061213     C*                  MOVEL     BLPNSP        D20NSP
203910061213     C*                  MOVEL     BLPCBO        D20CBO
203920061213     C*                  MOVEL     BLPNCL        D20NCL
203930061213    4C*    BLPDBR        IFGT      *ZEROS
203940061213     C*                  MOVE      BLPDBR        D20DTE
203950061213     C*                  ELSE
203960061213     C*                  MOVE      BLPMGS        D20DTE
203970061213     C*                  MOVEL     BLPAAS        D20DTE
203980061213    4C*                  END
203990061213     C*                  MOVEL     DSLV20        KPJBU
204000050502     C*
204010061213     C*                  CALL      'FNLV20R'
204020061213     C*                  PARM                    KPJBA
204030061213     c*                  parm      'N'           pwstor            1
204040050502     C*
204050061213     C*                  MOVEL     KPJBU         DSLV20
204060050502     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
204070061213    4C*    D20ERR        IFNE      '1'
204080061213     C*                  MOVEL     D20FVF        BLPFVF
204090061213     C*                  MOVEL     D20VLF        BLPVLF
204100061213E   4C*                  ENDIF
204110061213     c*                  update    fnblp000
204120061213    3c*                  endif
204130061213    2c*                  endif
204140061213    1c*                  endif
204150070601     c                   if        wmsg_pda='S'
204160070606     c* decodifico l'aut.
204170070606     C                   move      w02pdr_p      kpdpdr
204180070606     C                   move      'A'           kpdtip
204190070606     c                   clear                   w02rsc_p
204200070606     c     kfapd         chain     fiapd01l
204210070606     c                   if        %found(fiapd01l)
204220070606     c                   movel     apdrsc        w02rsc_p
204230070606     c                   endif
204240070601     c                   exfmt     ls01w02pda
204250070601     c                   endif
204260040408     c
204270080603     c* disalloco fisgn01l: Se manutneziono bolla export dpd senza
204280080603     c* modificare nulla, nella routine CTRSGN viene allocato fisgn
204290080603     c* e non viene poi pèiù disallocato
204300080603     c                   unlock    fisgn01l
204310081111     c* in manutenzione se cambiata data ritiro verifico se rielaborare
204320081121     c* statistica partito e a terra
204330090330     c* devo rielaborare anche in immissione se la data ritiro è inferiore
204340090330     c* a udate
204350090330    1c                   if        (*in12 and not *in15 and blpdrt<>s_drtblpi)
204360090330     c                             or ((*in12='0' or *in15) and blpdrt>0)
204370090330     c                   z-add     blpncl        st2ncl
204380090330    2c                   If        blpdrt <= §SdfParU
204390081111     C                   MOVE      blpdrt        SA2DTS            8 0
204400081111     C                   MOVE      'P'           SA2TRC            1
204410090330     C                   exsr      sr_callsa2r3
204420090330    2c                   endif
204430090330    2c                   If        s_drtblpi <= §SdfParU
204440081121     c                             and s_drtblpi > 0
204450081111     C                   MOVE      s_drtblpi     SA2DTS            8 0
204460081111     C                   MOVE      'P'           SA2TRC            1
204470090330     C                   exsr      sr_callsa2r3
204480090330    2c                   endif
204490090330    2c                   If        blpdrt <= §SdfterU
204500081121     C                   MOVE      blpdrt        SA2DTS            8 0
204510081121     C                   MOVE      'T'           SA2TRC            1
204520090330     C                   exsr      sr_callsa2r3
204530090330    2c                   endif
204540090330    2c                   If        s_drtblpi <= §SdfTerU
204550081121     c                             and s_drtblpi > 0
204560081121     C                   MOVE      s_drtblpi     SA2DTS            8 0
204570081121     C                   MOVE      'T'           SA2TRC            1
204580090330     C                   exsr      sr_callsa2r3
204590090330    2c                   endif
204600090330    1c                   endif
204610130308     c* invio messagio a ced se cliente fornisce pdf senza abilitazione
204620130313     c* e nel caso in cui la bolla sia stata confermata senza (hanno
204630130313     c* cambiato il CTM a video)
204640130313     c                   if        wvatpe='S' and §1bf16<>'S'
204650130308     c                   exsr      ced_alert
204660130308     c                   endif
204670080603
204680040408     C     ENDREG        ENDSR
204690090330      *--------------------------------------------------------------*
204700090330      * Richiamo pgm per rielaborazione statistiche partito e a terra
204710090330      *--------------------------------------------------------------*
204720090330     c     sr_callsa2r3  BegSr
204730090330     C                   CALL      'FNLSA2R3'
204740090330     C                   PARM                    SA2TLA            1
204750090330     C                   PARM                    SA2TRC
204760090330     C                   PARM                    SA2DTS
204770090330     C                   PARM                    WWLNA             3 0
204780090330     C                   PARM                    st2ncl            5 0
204790090330     c                   endsr
204800060209      *--------------------------------------------------------------*
204810060209      * Storicizzazione variazione di tassazione prepagato
204820060209      *--------------------------------------------------------------*
204830060209     c     Stoarb        BegSr
204840060209     c*
204850060209     c                   open      fiarbt0f
204860060209     c                   open      fiarbu0f
204870060209     c*
204880060209     c                   movel     '1'           wtrc
204890060209     C     KBLP4         CHAIN     FIAR6000
204900060209     c*
204910060209     c                   z-add     blpaas        arbaas
204920060209     c                   z-add     blplnp        arblnp
204930060209     c                   z-add     blpnrs        arbnrs
204940060209     c                   z-add     blpnsp        arbnsp
204950060209     C                   MOVEL     AR6DIV        ARBDIV
204960060209     C                   MOVEL     AR6POR        ARBPOR
204970060209     C                   MOVEL     AR6SV1        ARBSV1
204980060209     C                   MOVEL     AR6VA1        ARBVA1
204990060209     C                   MOVEL     AR6SV2        ARBSV2
205000060209     C                   MOVEL     AR6VA2        ARBVA2
205010060209     C                   MOVEL     AR6SV3        ARBSV3
205020060209     C                   MOVEL     AR6VA3        ARBVA3
205030060209     C                   MOVEL     AR6IMV        ARBIMV
205040060209     C                   MOVEL     AR6ALI        ARBALI
205050060209     C                   MOVEL     AR6CEI        ARBCEI
205060060209     C                   MOVEL     AR6IFT        ARBIFT
205070060209     C                   MOVEL     AR6DFT        ARBDFT
205080060209     C                   MOVEL     AR6NFT        ARBNFT
205090060209     C                   MOVEL     AR6FIV        ARBFIV
205100060209     C                   MOVEL     AR6FIM        ARBFIM
205110060209     c                   z-add     blpksc        arbksc
205120060209     c                   z-add     blpctr        arbctr
205130060209     c                   move      blpcbo        arbcbo
205140060209      *
205150060209      * Metto nell'ultimo byte del campo arbpru che la bolla aggiornata
205160060209      * è in partenza 'P'
205170060209     C                   MOVE      'P'           ARBPRU
205180060209      *
205190060209     C                   WRITE     FIARBT00
205200060209     C*
205210060209     C* SE HO DELLE ATRE VARIE LE STORICIZZO NEL FILE FIARBU0F
205220060209    1C     WAR7          IFEQ      'E'
205230060209     C     Kblp4         SETLL     FIAR7000
205240060209     C     Kblp4         READE     FIAR7000                               30
205250060209     C*
205260060209    2C     *IN30         DOWEQ     *OFF
205270060209     C                   MOVEL     AR7SVN        ARBSVN
205280060209     C                   MOVEL     AR7VAN        ARBVAN
205290060209     C                   WRITE     FIARBU00
205300060209     C*
205310060209     C     Kblp4         READE(N)  FIAR7000                               30
205320060209    2C                   ENDDO
205330060209     C                   ENDIF
205340060209     C*
205350060209     c                   close     fiarbt0f
205360060209     c                   close     fiarbu0f
205370060209     C*
205380060209     c                   endsr
205390060209
205400050209      *--------------------------------------------------------------*
205410050209      * Chaino fncls per codice ass. per impostazione §b4af1
205420050209      *--------------------------------------------------------------*
205430050209     c     Sr_fncls      BegSr
205440050209     c                   clear                   WCLSflo8
205450050209     c     §b4aks        chain     fncls01l
205460050209     c                   if        %found(fncls01l)
205470050209     c                   eval      wclsflo8 = %SUBST(clsflo:8:1)
205480050209     c                   endif
205490050209     c                   endsr
205500030704
205510030704      *--------------------------------------------------------------*
205520030704      * Scrivo/Aggiorno Fiar5
205530030704      *--------------------------------------------------------------*
205540030704     c     Sr_wrtFiar5   BegSr
205550030704
205560030704     c                   If        %Found(Fiar501l)
205570030704     c                   Update    Fiar5000
205580030704     c                   Else
205590030704     c                   Eval      Ar5Aas = BlpAas
205600030704     c                   Eval      Ar5Lnp = BlpLnp
205610030704     c                   Eval      Ar5Nrs = BlpNrs
205620030704     c                   Eval      Ar5Nsp = BlpNsp
205630030704     c                   Eval      Ar5Trd = KAr5Trd
205640030704     c                   Eval      Ar5Ft1 = 'T'
205650030704     c                   Eval      Ar5Dt1 = *All'9'
205660030704     c                   Eval      Ar5Ft2 = 'T'
205670030704     c                   Eval      Ar5Dt2 = *All'9'
205680030704     c                   Write     Fiar5000
205690030704     c                   EndIf
205700030704
205710030704     c                   EndSr
205720030326
205730030326      *--------------------------------------------------------------*
205740030326      * Forzo la data consegna richiesta
205750030326      *--------------------------------------------------------------*
205760030326     c     SrDcr         BegSr
205770111206     c* questa DS mi serve per controllare la data calcolata con i giorni
205780111206     c*  di chiusura, solo in caso di partciolarità di attesa
205790111206     c*  richiamerò non il TRUL13 ma il TRUL13R1
205800111206     c                   clear                   trul13ds1
205810100218     c
205820100218    1c                   select
205830030409      * Se non ho le ore da aggiungere alla delivery
205840100218If  1c                   when      VidOre > *Zeros
205850100218     c
205860100218     c                   Eval      wwtcr = 'P'
205870100218     c                   Eval      wore = VidOre
205880100218     c                   if        blptsp='C' or blptsp='E'
205890100218     c                   eval      wore=wore+24
205900100218     c                   endif
205910100218     c                   if        blptsp<>'H'
205920100218     c                   Exsr      CalDcr
205930100218     c                   endif
205940100218     c
205950100218     c* Se ho la particolarità, cerco con particolarità
205960100218    1c                   when      vidgma<>'  ' and §7ratt='S'
205970100218     c                   Clear                   dDcr
205980100218     c                   Clear                   dsbs02
205990100218     c                   Eval      T02Mod = 'C'
206000100218     c                   Eval      T02Sif = Knsif
206010100218     c                   Eval      T02Cod = 'DCR'
206020100218     c                   Movel     wksc          T02Ke1
206030100218     c                   Movel     'TTR'         t02ke2
206040100218     c                   Call      'TIBS02R'
206050100218     c                   Parm                    Kpjba
206060100218     c                   Parm                    Dsbs02
206070100218     c
206080100218      * se il cliente è codificato in tabella calcolo la nuova data
206090100218      * consegna richiesta
206100100218If  2c                   If        T02Err = *Blanks
206110100218     c                   Movel     T02Uni        dDcr
206120100218     c                   Eval      wore = §DcrOre
206130100218     c                   Eval      wwtcr = §DcrTcr
206140111206     c* Imposto i giorni di chiusura
206150111206     c                   eval      i13gc1=vidgc1
206160111206     c                   eval      i13gc2=vidgc2
206170111206     c                   eval      i13tcr=wwtcr
206180100218     c                   Exsr      CalDcr
206190100218     c                   endif
206200100218     c
206210100218   x1c                   other
206220100218      * Forzo la data consegna richiesta con tabella DCR se:
206230100218      * 1) non è una bolla di recupero o un conto servizi
206240100218      * 2) non è un tipo serivizio "H"=Consegna ore 10:30
206250100218      * 3) non è un tipo serivizio "E"=priority
206260100218      *  se trovo la tabella DCR con cliente/tariffa o solo cliente
206270100218     c
206280100218If  2c                   If        §3arbl = 'N' and blptsp<>'H'
206290100217     c                             and blptsp<>'E'
206300100215
206310030326     c                   Clear                   dDcr
206320030326     c                   Clear                   dsbs02
206330030326     c                   Eval      T02Mod = 'C'
206340030326     c                   Eval      T02Sif = Knsif
206350030326     c                   Eval      T02Cod = 'DCR'
206360100215     c                   Movel     wksc          T02Ke1
206370100218     c                   Movel     VidCtr        t02ke2
206380030326     c                   Call      'TIBS02R'
206390030326     c                   Parm                    Kpjba
206400030326     c                   Parm                    Dsbs02
206410030326      * se il cliente è codificato in tabella calcolo la nuova data
206420030326      * consegna richiesta
206430100218If  3c                   If        T02Err <>*Blanks
206440100218     c                   Eval      T02Mod = 'C'
206450100218     c                   Eval      T02Sif = Knsif
206460100218     c                   Eval      T02Cod = 'DCR'
206470100218     c                   Movel     wksc          T02Ke1
206480100218     c                   clear                   t02ke2
206490100218     c                   Call      'TIBS02R'
206500100218     c                   Parm                    Kpjba
206510100218     c                   Parm                    Dsbs02
206520100218    3c                   endif
206530100218     c
206540100218If  3c                   If        T02Err = *Blanks
206550030326     c                   Movel     T02Uni        dDcr
206560030409     c                   Eval      wore = §DcrOre
206570030409     c                   Eval      wwtcr = §DcrTcr
206580030409     c                   Exsr      CalDcr
206590100218    3c                   EndIf
206600100218    2c                   EndIf
206610100218    1c                   Endsl
206620030326
206630030326     c                   EndSr
206640030409
206650030409      *--------------------------------------------------------------*
206660030409      * Calcolo le ore da aggiungere alla delivery
206670030409      *--------------------------------------------------------------*
206680030409     c     CalDcr        BegSr
206690100222     c* Se 24 ore per IL o  48 per PRIMA DDEL
206700100219     c*   devo aggiungere alla delivery anche i tempi
206710100219     c*   del C/ass altrimenti non servono (48 ore le ho comunque)
206720100222     c                   if        (wwTCR= ' ' and  wore>24)
206730100222     c                             or (wwTCR='P' and wore>48)
206740100222     c                             or wwTCR='D'
206750100219     c                   eval      UsaCass='N'
206760100219     c                   endif
206770100219     c
206780030409      * CALL AL TNSD99 x calcolare la data consegna teorica
206790030409     c                   ExSr      CLSE98
206800100219     c
206810100219      * Richiamo pgm che calcola la prima data lavorativa disponibile
206820030409     c                   Clear                   Trul13ds
206830030409     c                   Eval      tI13Tla = 'L'
206840030409     c                   Eval      I13Mod = 'A'
206850030409     c                   Eval      I13Fil = BlpLna
206860030409     c                   Eval      I13Din = d98dce
206870030409     c                   Eval      I13Hin = d98hce
206880030409     c                   Eval      I13Ore = wore
206890111206     c
206900111206     c* se impostati i giorni di chiusura, richiamo trul13r1
206910111206     c                   if        i13gc1<>*blanks or i13gc2<>*blanks
206920111206     c                   Call      'TRUL13R1'
206930111206     c                   Parm                    Trul13ds
206940111206     c                   Parm                    Trul13ds1
206950111206     c                   else
206960030409     c                   Call      'TRUL13R'
206970030409     c                   Parm                    Trul13ds
206980111206     c                   endif
206990111206     c
207000111206     c                   If        tO13Err = *Blanks and o13dfi>0
207010030409     c                   Eval      BlpTcr = wwtcr
207020030409     c                   Eval      BlpDcr = O13Dfi
207030030409     c                   EndIf
207040030409
207050030409     c                   EndSr
207060000209     C*
207070000209     C* CONTROLLO FILE FISGN00F -------------------------------------*
207080000209     C     CTRSGN        BEGSR
207090010116     C     KSGN          CHAIN     FISGN01L                           30
207100000209    3C     *IN30         IFEQ      *OFF
207110000209     C* SE NON E' LA STESSA SPEDIZIONE, ANNULLO
207120000209    4C     §LDAAS        IFNE      BLPAAS
207130000209     C     SGNLNP        ORNE      BLPLNP
207140000209     C     §LDNRS        ORNE      BLPNRS
207150000209     C     SGNNSP        ORNE      BLPNSP
207160000919    5C     SGNATB        IFNE      '*'
207170000920     C* Se il chi sono non è di nuova immissione non devo incrementare
207180000920     C* il progressivo ed in generale non è necessario updatare fisgn
207190000920     C* perchè in questo caso risulta già annullato
207200000920    6C     V8HCOL        IFEQ      *ZEROS
207210000209     C                   MOVEL     'A'           SGNATB
207220010116     C                   CLEAR                   SGNT6A
207230010116     C                   CLEAR                   SGNT6B
207240010116     C                   CLEAR                   SGNT6C
207250010116     C                   CLEAR                   SGNT6D
207260010116     C                   CLEAR                   SGNT6E
207270010116     C                   CLEAR                   SGNT6F
207280080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
207290000920    7C     SGNFL1        IFEQ      *BLANKS
207300000920     C                   MOVE      *ZEROS        WSGPRG            1 0
207310000920     C                   ELSE
207320000920     C                   MOVE      SGNFL1        WSGPRG
207330000920    7C                   ENDIF
207340000920     C                   ADD       1             WSGPRG
207350000920     C                   MOVE      WSGPRG        SGNFL1
207360000209     C                   UPDATE    FISGN000
207370000921   X6C                   ELSE
207380001009     C     *IN79         IFEQ      *OFF
207390001011     C     WEXDPD        ANDNE     'S'
207400001009     C                   UNLOCK    FISGN01L
207410001009     C                   ENDIF
207420000920    6C                   ENDIF
207430000209     C                   MOVEL     'N'           WDKC
207440000919   x5C                   ELSE
207450000919     C* altra spedizione ma sgnatb='*' --> posso andare in update
207460000919     C                   MOVEL     'S'           WESSGN            1
207470000921     C                   CLEAR                   SGNST2
207480000920     C     *IN79         IFEQ      *OFF
207490001011     C     WEXDPD        ANDNE     'S'
207500000919     C                   UNLOCK    FISGN01L
207510000919    5C                   ENDIF
207520000920    5C                   ENDIF
207530000209   X4C                   ELSE
207540000209     C*
207550000921     C* MEMORIZZO CHE ESISTE FISGN --> VADO IN UPDATE
207560000921     C* SE PERO' E' ANNULLATO IL COLLO NON DEVO TRATTARLO COME DISK C
207570000921     C     SGNATB        IFEQ      'A'
207580000921     C                   MOVEL     'N'           WDKC
207590000921     C                   ELSE
207600000209     C                   MOVEL     'S'           WESSGN            1
207610000921     C                   ENDIF
207620000918     C     *IN79         IFEQ      *OFF
207630001011     C     WEXDPD        ANDNE     'S'
207640000918     C                   UNLOCK    FISGN01L
207650000918     C                   ENDIF
207660000209    4C                   ENDIF
207670000209     C*
207680000209   X3C                   ELSE
207690000209     C* IMMISSIONE
207700000919     C                   CLEAR                   SGNATB
207710000209     C                   MOVEL(P)  KWHO          SGNWHO
207720000211     C                   Z-ADD     §3ISEA        SGNSEA
207730000209     C                   MOVEL     'S'           SGNST1
207740000921     C                   CLEAR                   SGNST2
207750000921     C                   MOVE      '0'           SGNFL1
207760000211     C     BLPCCM        IFGT      0
207770000211     C                   MOVEL     BLPCCM        SGNKSC
207780000211     C                   ELSE
207790000211     C                   MOVEL     BLPKSC        SGNKSC
207800000908    4C                   ENDIF
207810000921     C                   MOVEL     BLPLNP        SGNLNP
207820000921     C                   MOVEL     BLPNSP        SGNNSP
207830010116     C                   CLEAR                   SGNT6A
207840010116     C                   CLEAR                   SGNT6B
207850010116     C                   CLEAR                   SGNT6C
207860010116     C                   CLEAR                   SGNT6D
207870010116     C                   CLEAR                   SGNT6E
207880010116     C                   CLEAR                   SGNT6F
207890080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
207900000922     C                   CLEAR                   SGNRST
207910000211    3C                   ENDIF
207920000211     C**
207930000209     C                   ENDSR
207940000921     C* ANNULLO FILE FISGN00F -------------------------------------*
207950000921     C     ANNSGN        BEGSR
207960000921    1C     SGNATB        IFEQ      'A'
207970000921    2C     SGNFL1        IFEQ      *BLANKS
207980000921     C                   MOVE      *ZEROS        WSGPRG
207990000921   X2C                   ELSE
208000000921     C                   MOVE      SGNFL1        WSGPRG
208010000921    2C                   ENDIF
208020000921    2C     WSGPRG        IFEQ      0
208030000921     C                   MOVE      '*'           SGNATB
208040000921   X2C                   ELSE
208050000921     C                   SUB       1             WSGPRG
208060000921     C                   MOVE      WSGPRG        SGNFL1
208070000921    2C                   ENDIF
208080000921   X1C                   ELSE
208090000921    2C     SGNATB        IFEQ      *BLANKS
208100000921     C                   MOVEL     '*'           SGNATB
208110000921    2C                   ENDIF
208120000921    1C                   ENDIF
208130010116     C                   CLEAR                   SGNT6A
208140010116     C                   CLEAR                   SGNT6B
208150010116     C                   CLEAR                   SGNT6C
208160010116     C                   CLEAR                   SGNT6D
208170010116     C                   CLEAR                   SGNT6E
208180010116     C                   CLEAR                   SGNT6F
208190080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
208200001005     C     WSGNR         IFEQ      'B'
208210060622     c     *in79         oreq      *on
208220001005     C                   UPDATE    FISGN005
208230001005     C                   ELSE
208240000921     C                   UPDATE    FISGN000
208250001005     C                   ENDIF
208260000921     C                   ENDSR
208270991014      *
208280991014      * AGGIORNO VARIE IN FNBLP E IN FIAR7 -------------------------*
208290991014     C     WRTVAR        BEGSR
208300991014      *
208310991014     C                   SELECT
208320991026    4C     C             WHENGT    3
208330991014     C                   Z-ADD     BLPAAS        AR7AAS
208340991014     C                   Z-ADD     BLPLNP        AR7LNP
208350991014     C                   Z-ADD     BLPNRS        AR7NRS
208360991014     C                   Z-ADD     BLPNSP        AR7NSP
208370991014     C                   MOVEL     '1'           AR7TRC
208380991014     C                   MOVEL     V3CSV1        AR7SVN
208390991014     C                   Z-ADD     V3CVA1        AR7VAN
208400991014     C                   WRITE     FIAR7000
208410991014    4 *
208420991014    4C     C             WHENEQ    3
208430991027     C                   MOVEL     V3CSV1        WSV3
208440991027     C                   Z-ADD     V3CVA1        WVA3
208450991014     C                   ADD       1             C
208460991014    4 *
208470991014    4C     C             WHENEQ    2
208480991027     C                   MOVEL     V3CSV1        WSV2
208490991027     C                   Z-ADD     V3CVA1        WVA2
208500991014     C                   ADD       1             C
208510991014    4 *
208520991014    4C     C             WHENEQ    1
208530991027     C                   MOVEL     V3CSV1        WSV1
208540991027     C                   Z-ADD     V3CVA1        WVA1
208550991014     C                   ADD       1             C
208560991014    4C                   ENDSL
208570991014      *
208580991014     C                   ENDSR
208590040116      *
208600040116      *-------------------------------------------------------------*
208610040116      * Aggiorno le varie della seconda bolla
208620040116      *-------------------------------------------------------------*
208630040116     c     WrtVar1       BegSr
208640040116
208650040116s   1c                   Select
208660040116     c                   When      ContaSv > 3
208670040116     c                   Eval      Ar7Aas = BlpAas
208680040116     c                   Eval      Ar7Lnp = BlpLnp
208690040116     c                   Eval      Ar7Nrs = BlpNrs
208700040116     c                   Eval      Ar7Nsp = BlpNsp
208710040116     c                   Eval      Ar7Trc = '2'
208720040116     c                   Eval      Ar7Svn = w2sv(c)
208730040116     c                   Eval      Ar7Van = w2va(c)
208740040116     c                   Write     Fiar7000
208750040116
208760040116     c                   When      ContaSv = 3
208770040116     c                   Movel     w2sv(c)       wsv3
208780040116     c                   Z-add     w2va(c)       wva3
208790040116     c                   Add       1             ContaSv
208800040116
208810040116     c                   When      ContaSv = 2
208820040116     c                   Movel     w2sv(c)       wsv2
208830040116     c                   Z-add     w2va(c)       wva2
208840040116     c                   Add       1             ContaSv
208850040116
208860040116     c                   When      ContaSv = 1
208870040116     c                   Movel     w2sv(c)       wsv1
208880040116     c                   Z-add     w2va(c)       wva1
208890040116     c                   Add       1             ContaSv
208900040116    1c                   EndSl
208910040116
208920040116     c                   EndSr
208930991014     C*
208940991014     C* CONTROLLO SE BOLLA DA STAMPARE O MNEO ----------------------*
208950991014     C     CTRSTA        BEGSR
208960970328     C                   MOVEL     '1'           WSTA
208970970328     C* SOLO PER RICHIAMO DA CONFERMA BOLLA
208980970328     C*  SE NON E' DA STAMPARE FACCIO FINTA CHE SIA STAMPA STAMPATA
208990970328     C     *IN12         IFEQ      *ON
209000970328     C     *IN15         ANDEQ     *ON
209010970328     C*
209020970407     C                   SELECT
209030970407     C     WFPR          WHENEQ    'G'
209040970328     C     BLPLNP        ANDEQ     BLPLNA
209050970328     C                   MOVEL     ' '           WSTA
209060970328     C* SE NON E' DA STAMPARE, NON STAMPO
209070970407     C     §1BFG3        WHENNE    'N'
209080970328     C                   MOVEL     ' '           WSTA
209090970328     C* SE FLAG "P" NON STAMPO MAI
209100970407     C     WFPR          WHENEQ    'P'
209110970328     C                   MOVEL     ' '           WSTA              1
209120970407     C**
209130970407     C* SE NON VENGO DA CONFERMA BOLLE STAMPO SEMPRE SUBITO
209140140612     C***  §LPRIC        WHENNE    'C'
209150140612     c                   when      §lpric<>'C'
209160140612     c                             and (%lookup('999':sk_VPODIR)=0 and
209170140613     c                                  %lookup(%editc(blplnp:'X'):sk_VPODIR)=0)
209180970407     C                   MOVEL     'S'           WSTA
209190970407     C                   ENDSL
209200970328     C*
209210970328     C                   ENDIF
209220970328     C                   ENDSR
209230970328     C*
209240020917     C*--- CANCELLO RECORD FIVAD00F ----------------------------------*
209250951019     C     DELVAD        BEGSR
209260020917     C     KBLC          SETLL     FIVAD000                               30
209270910220     C   30              DO        *HIVAL
209280020917     C     KBLC          READE     FIVAD000                               30
209290020917     C  N30              DELETE    FIVAD000
209300910220     C  N30              END
209310910220     C*
209320910220     C                   ENDSR
209330020917     C*--- CANCELLO RECORD FIVAT00F ----------------------------------*
209340980406     C     DELVAT        BEGSR
209350020917     C     KBLC          SETLL     FIVAT000                               30
209360980406     C   30              DO        *HIVAL
209370020917     C     KBLC          READE     FIVAT000                               30
209380020917     C  N30              DELETE    FIVAT000
209390980406     C  N30              END
209400980406     C*
209410980406     C                   ENDSR
209420040601     c*
209430040601     C*--- CANCELLO RECORD FIVAX00F ----------------------------------*
209440040601     C     DELVAX        BEGSR
209450040601     C     KBLC          SETLL     FIVAX000                               30
209460040601     C   30              DO        *HIVAL
209470040601     C     KBLC          READE     FIVAX000                               30
209480040601     C  N30              DELETE    FIVAX000
209490040601     C  N30              END
209500040601     C*
209510040601     C                   ENDSR
209520940214     C*
209530940214     C* ROTTURA CODICE PRODOTT DA DETTAGLIO COLLI CLIENTE -----------*
209540940214     C     ROTCDP        BEGSR
209550940214     C*
209560940214     C                   Z-ADD     COMSCD        BLDNCD
209570940214     C     BLDNCD        ADD       VARNCL        BLDNCA
209580940214     C                   SUB       1             BLDNCA
209590940214     C                   ADD       VARNCL        COMSCD
209600940214     C     BLDNCA        IFEQ      BLDNCD
209610940214     C                   Z-ADD     0             BLDNCA
209620940214     C                   END
209630000426     C                   MOVEL     BLDNCL        SA2NCL
209640000426     C                   MOVE      BLDCDP        SA2CDP
209650000426     C                   MOVEL     VARNCL        BLDNCL
209660000426     C                   MOVE      VARCDP        BLDCDP
209670940224     C* CREA O AGGIORNA SEGNACOLLI
209680940214     C                   EXSR      CRTBLD
209690001002     C*
209700000426     C                   MOVEL     SA2NCL        BLDNCL
209710000426     C                   MOVE      SA2CDP        BLDCDP
209720940214     C                   ADD       VARNCL        BLDNC1
209730940214     C                   MOVEL     BLDCDP        VARCDP
209740940214     C                   CLEAR                   VARNCL
209750940214     C                   ENDSR
209760991117     C*
209770991117     C*--- IMPOSTO NUMERO DISTINTA PER SPED DPD ----------------------*
209780991117     C     SPEDPD        BEGSR
209790991117      *
209800991117     C                   CLEAR                   DPDBRC
209810991117      *
209820060510     C                   MOVE      §OGDP1        DPDLNP
209830991117      *
209840991117     C                   MOVEL     BLPMGS        W0020
209850991117     C                   MOVE      W0020         DPDGMS
209860991117     C                   MOVE      BLPMGS        W0020
209870991117     C                   MOVEL     W0020         DPDGMS
209880991117      * Aggancio numeratore 190 per progressivo distinta
209890991117     C                   CLEAR                   NUFNUM
209900991117     C                   EXSR      DPDNUM
209910991117     C                   Z-ADD     NUFNUM        DPDNDS
209920991117      * Calcolo CHECK DIGIT
209930991117     C                   EXSR      M1031
209940991117      *
209950991117     C                   ENDSR
209960991117      *
209970991117      ** CALCOLA CHECK DIGIT -----------------------------
209980991117     C     M1031         BEGSR
209990991117      *
210000991117     C                   MOVE      *ZERO         §TT2              3 0
210010991117     C                   CLEAR                   W0030
210020991117     C                   CLEAR                   W0010
210030991117      *
210040991117      * TOTALIZZO I VALORI, QUELLI NELLE POSIZIONI DISPARI PER 3
210050991117     C                   DO        11            XX                2 0
210060991117      *
210070991117     C     XX            DIV       2             §CTR              3 0
210080991117     C                   MVR                     §RST              3 030
210090991117      *
210100991117     C     *IN30         IFEQ      '1'
210110991117     C     §11(XX)       MULT      3             §CTR
210120991117     C                   ELSE
210130991117     C                   Z-ADD     §11(XX)       §CTR
210140991117     C                   ENDIF
210150991117      *
210160991117     C                   ADD       §CTR          W0030
210170991117     C                   ENDDO
210180991117      *
210190991117     C     W0030         ADD       9             §TT2
210200991117     C                   MOVE      0             §TT2
210210991117     C     §TT2          SUB       W0030         DPDCHD
210220991117      *
210230991117     C                   ENDSR
210240991117      *
210250991117      *--- NUMERO DISTINTA DPD ---------------------------------------*
210260991117     C     DPDNUM        BEGSR
210270991117      *
210280991117     C                   Z-ADD     BLPMGS        DATA6
210290991117     C                   MOVE      BLPAAS        W0020
210300991117     C                   MOVEL     W0020         DATA6
210310991117     C                   Z-ADD     190           CNU
210320991117      *
210330991118     C     KNUF3         CHAIN     FLNUF2                             30
210340991117      * SE NON TROVATO IL NUMERATORE PROVO A CREARLO
210350991117     C     *IN30         IFEQ      *ON
210360991117     C                   CLEAR                   FLNUF2
210370991117     C                   Z-ADD     CNU           NUFCNU
210380991117     C                   Z-ADD     DATA6         NUFDAT
210390991117     C                   WRITE     FLNUF2
210400991118     C     KNUF3         CHAIN     FLNUF2                             30
210410991118     C                   ENDIF
210420991117      *
210430991117     C     *IN30         IFEQ      *OFF
210440991117     C                   ADD       1             NUFNUM
210450991117     C                   UPDATE    FLNUF2
210460991117     C                   ENDIF
210470991117      *
210480991117     C                   ENDSR
210490991130      *
210500991130      *--- EVENTI DPD ------------------------------------------------*
210510991130     C     EVEDPD        BEGSR
210520991130      *
210530060619     C                   MOVE      'S'           WEU12             1
210540991130      *
210550060619     C                   CLEAR                   fieu12ds
210560060619     C                   Z-ADD     BLPAAS        i12AAS
210570060619     C                   Z-ADD     BLPLNP        i12LNP
210580060619     C                   Z-ADD     BLPNRS        i12NRS
210590060619     C                   Z-ADD     BLPNSP        i12NSP
210600060619     C                   Z-ADD     BLPLNA        i12LNA
210610060619     C                   movel     v7cnpr        i12parcel
210620060619     c                   movel     'I'           i12ie
210630991130      *
210640060619     C                   CALL      'FIEU12R'
210650991130     C                   PARM                    KPJBA
210660060619     C                   PARM                    fieu12ds
210670991130      *
210680991130     C                   ENDSR
210690991117      *
210700991117      *--- STAMPA BOLLE ----------------------------------------------*
210710900508     C     STAMPA        BEGSR
210720941107     C*
210730941107     C                   MOVEL     'P'           DB0TBO
210740110323     C                   MOVEL     'B'           DB0GES
210750990610     C* STAMPO DI UN FRANCO PREPAGATO
210760990610     C     PARTCH        IFEQ      'P'
210770010307     C     §LPFPR        OREQ      'O'
210780990610     C                   MOVEL     '8'           DB0TBO
210790110323     c* Per la stampa di un prepagato
210800110323     c* non va più bene richiamare con "B" perchè non c'è la possibilità
210810110323     c* di passare l'importo del bollo (bisognerebbe modificare la fnlsb5ds
210820110323     c* ma per il momento non è il caso mentre non va bene il campo db0ese pechè
210830110323     c* è stato pensato per contenere la somma degli importi esenti..)
210840110323     c* Quindi richiamo con DB0GES=' ': in questo modo il pgm di stampa
210850110323     c* reperisce autonomamente i dati della bolla incluso il bollo se presente
210860110323     C                   MOVEL     ' '           DB0GES
210870990610     C                   ENDIF
210880941108     C*
210890941108     C* SE SONO IN MANUTENZIONE SI TRATTA DI RISTAMPA
210900941108    1C     *IN12         IFEQ      *ON
210910941108     C     *IN15         ANDEQ     *OFF
210920941108     C                   MOVEL     'R'           DB0RIS
210930941108    1C                   ENDIF
210940941107     C*
210950941107     C                   MOVEL     BLPCBO        DB0CBO
210960941107     C                   MOVEL     §3ATB1        DB0TB1
210970941107     C                   MOVEL     §3ATB2        DB0TB2
210980990610     C* DE NON E' PREPAGATO STAMPO LA DECODIFICA DEL TIPO BOLLA
210990990628     C     PARTCH        IFNE      'P'
211000010307     C     §LPFPR        ANDNE     'O'
211010990610     C                   MOVEL(P)  §3ADES        DB0DCB
211020990610     C                   ELSE
211030990610     C                   MOVEL(P)  CPREPA        DB0DCB
211040990610     C                   ENDIF
211050990610     C**
211060941107     C                   MOVEL     BLPTSP        DB0TSP
211070941107     C                   Z-ADD     1             C
211080941107     C     BLPTSP        LOOKUP    TSP(C)                                 30
211090941107     C   30              MOVEL     DTS(C)        DB0DTS
211100941115     C   30              MOVEL     STS(C)        DB0FST
211110941107     C*
211120941107     C                   MOVEL     BLPAAS        DB0AAS
211130941107     C                   MOVEL     BLPMGS        DB0MGS
211140941107     C                   MOVEL     BLPLNP        DB0LNP
211150941107     C                   MOVEL     BLPNRS        DB0NRS
211160941107     C                   MOVEL     BLPNSP        DB0NSP
211170941107     C                   MOVEL     BLPTC1        DB0TC1
211180941107     C                   MOVEL     BLPTC2        DB0TC2
211190941107     C                   MOVEL     BLPFNS        DB0FNS
211200941107     C                   MOVEL     BLPRMN        DB0RMN
211210941107     C                   MOVEL     BLPRMA        DB0RMA
211220941107     C                   MOVEL     BLPIAS        DB0IAS
211230941107     C                   MOVEL     BLPVAS        DB0VAS
211240941107     C                   MOVEL     BLPVMD        DB0VMD
211250941107     C                   MOVEL     BLPVAD        DB0VAD
211260961007     C     TAMFVD        IFNE      '4'
211270941107     C                   MOVEL     BLPQFT        DB0QFT
211280961007     C                   ENDIF
211290941107     C                   MOVEL     VIDTIC        DB0TIC
211300980806     C* SE L'IMPORTO DEL C/A E' OLTRE IL LIMITE PRENDO DESCRIZIONE OLTR
211310980806     C                   MOVEL     §1ADES        DB0DTI
211320980806     C**
211330980806     C     §1ADEO        IFNE      *BLANKS
211340980806     C** DESCRIZIONE OLTRE LIMITE
211350011212     C     FCASAV        IFNE      *BLANKS
211360980806     C                   MOVEL     §1ADEO        DB0DTI
211370980806     C                   ENDIF
211380980806     C                   ENDIF
211390980806     C**
211400950208     C                   MOVEL     §1AUCM        DB0UCM
211410950208     C                   MOVEL     §1ASTE        DB0STE
211420941107     C                   MOVEL     VIDCAS        DB0CAS
211430941107     C                   MOVEL     VIDVCA        DB0VCA
211440941107     C                   MOVEL     VIDGCA        DB0GCA
211450941107     C                   MOVEL     BLPLNA        DB0LNA
211460941107     C                   MOVEL     BLPZNC        DB0ZNC
211470941107     C* CODICE MITENTE PIENO
211480941108    1C     BLPCCM        IFGT      0
211490941107     C                   Z-ADD     BLPCCM        DB0CCM
211500941108   X1C                   ELSE
211510941107     C* SE NON E' ASSEGNO LO IMPOSTO DA KSC
211520941108    2C     *IN04         IFEQ      *OFF
211530941107     C                   MOVEL     BLPKSC        DB0CCM
211540950125     C* SOLO SE BOLLA FRANCO PASSO LA P.IVA
211550061110     C***                MOVEL     BLPCPI        DB0CPI
211560061110     c* Adesso nel campo della partita iva ci passo il codice fiscale per
211570061110     c*  la stampa
211580061110     c                   movel     vidcdf        db0cpi
211590941108    2C                   ENDIF
211600941108    1C                   ENDIF
211610941107     C*
211620941107     C* ASSEGNATO O 2 BOLLA: CODICE DESTINATARIO LNA9999
211630941108    1C     §3ATB2        IFNE      *BLANKS
211640941108     C     *IN04         OREQ      *ON
211650941107     C                   Z-ADD     9999          DB0CCD
211660941107     C                   MOVEL     BLPLNA        DB0CCD
211670941108    1C                   ENDIF
211680941107     C                   MOVEL     BLPRSM        DB0RSM
211690941107     C                   MOVEL     BLPINM        DB0INM
211700941107     C                   MOVEL     BLPLOM        DB0LOM
211710941107     C                   MOVEL     BLPCAM        DB0CAM
211720941107     C                   MOVEL     BLPFAP        DB0FAP
211730941107     C                   MOVEL     BLPNZM        DB0NZM
211740941107     C                   MOVEL     BLPPRM        DB0PRM
211750941107     C*
211760941107     C                   MOVEL     BLPRSD        DB0RSD
211770950123     C                   MOVE      WRD2          DB0RD2
211780941107     C                   MOVEL     BLPIND        DB0IND
211790941107     C                   MOVEL     BLPLOD        DB0LOD
211800941107     C                   MOVEL     BLPCAD        DB0CAD
211810941107     C                   MOVEL     BLPFIN        DB0FIN
211820941107     C                   MOVEL     BLPNZD        DB0NZD
211830941107     C                   MOVEL     BLPPRD        DB0PRD
211840941107     C                   MOVEL     BLPRMO        DB0RMO
211850941107     C                   MOVEL     BLPGC1        DB0GC1
211860941107     C                   MOVEL     BLPGC2        DB0GC2
211870941107     C                   MOVEL     BLPNAS        DB0NAS
211880941107     C                   MOVEL     BLPNCL        DB0NCL
211890941107     C                   MOVEL     BLPPKF        DB0PKF
211900941107     C                   MOVEL     BLPVLF        DB0VLF
211910941115     C                   MOVEL     BLPFVF        DB0FVF
211920941107     C                   MOVEL     BLPFLS        DB0FLS
211930941107     C                   MOVEL     BLPNCD        DB0NCD
211940941107     C                   MOVEL     BLPNCA        DB0NCA
211950941107     C                   MOVEL     BLPXCO        DB0XCO
211960941107     C                   MOVEL     VIDNT1        DB0NT1
211970941107     C                   MOVEL     VIDNT2        DB0NT2
211980941107     C                   MOVEL     BLPFFD        DB0FFD
211990941107     C                   MOVEL     BLPDCR        DB0DCR
212000941107     C                   MOVEL     BLPTCR        DB0TCR
212010941107     C                   MOVEL     BLPHCR        DB0HCR
212020941107     C                   MOVEL     BLPFBR        DB0FBR
212030941107     C                   MOVEL     BLPGGA        DB0GGA
212040941107     C                   MOVEL     BLPGMA        DB0GMA
212050960208     C                   MOVEL     VIDGVA        DB0GVA
212060950125     C                   MOVEL     BLPSOP        DB0SOP
212070950626     C                   MOVEL     BLPCTR        DB0CTR
212080990628     C                   MOVEL     BLPDRT        DB0DRT
212090990628     C                   MOVEL     BLPNRT        DB0NRT
212100990628     C                   MOVEL     BLPPDR        DB0PDR
212110990628     C                   MOVEL     BLPFPP        DB0FPP
212120950102     C   12
212130950102     CANN15              MOVEL     'V'           DB0RIS
212140970206     C*
212150970206     C* ALLEGA BAM
212160970206     C     BLPFST        IFEQ      'S'
212170970206     C     BLPFST        OREQ      'C'
212180970206     C                   MOVEL     'S'           DB0BAM
212190970206     C                   ENDIF
212200970206     C*
212210030611     C                   CALL      WD90PSL
212220030626     C                   PARM                    fnlsb5DS
212230130318     c                   parm                    FNLSB6ds1
212240941108     C*
212250941108     C                   Z-ADD     1             I100
212260941107     C**
212270900508     C                   ENDSR
212280900511     C*
212290990701     C*--- CARICO RECORD DI MANUTENZIONE -----------------------------*
212300010215     C     CARBLP        BEGSR
212310990630     C                   SETOFF                                       22
212320990701     C                   CLEAR                   SAVNFT
212330070918     c                   clear                   s_drt
212340950206     C                   Z-ADD     KCI           CCC
212350011025      *
212360011025     C                   CLEAR                   FLGVRN
212370030204     c                   Clear                   wPkg
212380030204     c                   Clear                   wNba
212390070322     c                   clear                   wparcel
212400091221     c                   clear                   wvidgma
212410100604     c                   clear                   w7rRC
212420011025      *
212430900511     C* CHAIN
212440061212     C     KBLP3         CHAIN     FNBLP01l
212450061212     c                   if        %found(fnblp01l)
212460061218     c                   z-add     blpnrr        savnrr
212470061212     c     blpnrr        chain     fnblp00f                           90
212480950102     C     *IN90         IFEQ      *OFF
212490940927     C*
212500940927     C* DATA SPEDIZIONE
212510930414     C                   Z-ADD     BLPMGS        BLPDSP
212520930414     C                   MOVEL     BLPAAS        BLPDSP
212530000104     C                   Z-ADD     BLPMGS        WBDSP             8 0
212540000104     C                   MOVEL     BLPAAS        WBDSP
212550940927     C* DATA RITIRO MERCE
212560940927     C                   Z-ADD     BLPDRT        VIDDRT
212570081111     C                   Z-ADD     BLPDRT        s_drtblpi
212580940927     C* DATA CONSEGNA RICHIESTA
212590940927     C                   Z-ADD     BLPDCR        VIDDCR
212600940927     C*
212610960926     C* AUTOTRASPORTATORE
212620950126     C                   MOVE      BLPPDR        SAVPDR
212630990915     C                   MOVE      BLPPDR        SAVPD4
212640940928     C                   MOVE      BLPPDR        VIDPDR
212650010220     C                   MOVE      BLPPDR        PREPDR
212660990915     C                   MOVE      BLPFPP        VIDFPP
212670010220     C                   MOVE      BLPFPP        PREFPP
212680991001     C* SE ERA PREPAGATO, FACCIO ALMENO VEDERE SE MERCE PORTATA A MAG
212690991001     C                   MOVEL     BLPFDN        VIDMAG
212700900511     C*
212710900516     C                   MOVE      BLPNSP        VIDNSP
212720900511     C                   MOVEL     BLPNRS        VIDNRS
212730900511     C                   MOVEL     BLPLNP        VIDLNP
212740910805     C                   MOVEL     BLPFNS        VIDFNS            1
212750040506
212760040506      * Imposto la ds di comodo del n. spedizione
212770040506     c                   Z-add     BlpNsp        WidNsp
212780040506     c                   Z-add     BlpNrs        WidNrs
212790040506     c                   Z-add     BlpLnp        WidLnp
212800040506
212810970128     C* ALLEGA BAM
212820970128     C     BLPFST        IFEQ      'S'
212830970128     C     BLPFST        OREQ      'C'
212840970128     C                   MOVEL     'S'           VIDBAM
212850970128     C                   ELSE
212860970128     C                   MOVEL     'N'           VIDBAM
212870970128     C                   ENDIF
212880970404     C                   MOVEL     BLPFST        SAVBAM
212890940920     C* CODICE BOLLA
212900940920     C                   MOVEL     BLPCBO        VIDCBO
212910081023     C                   MOVEL     BLPCBO        cbo_blp
212920940920     C* SIGLA OPERATORE
212930940920     C                   MOVEL     BLPSOP        VIDSOP
212940900511     C* LINEA ARRIVO E DECODIFICA
212950900511     C                   MOVEL     BLPLNA        VIDLNA
212960070404     C                   MOVEL     BLPLNA        lna_sav
212970960926     C* PUNTO OPERATIVO CLIENTE
212980940927     C     BLPCCM        IFGT      0
212990940927     C                   MOVEL     BLPCCM        W0030
213000940927     C                   MOVE      BLPCCM        VIDCCM
213010940927     C                   MOVEL     BLPCCM        WKSC
213020940927     C                   ELSE
213030940927     C                   MOVEL     BLPKSC        W0030
213040940927     C                   MOVE      BLPKSC        VIDCCM
213050940927     C                   MOVEL     BLPKSC        WKSC
213060940927     C                   ENDIF
213070940927     C* SALVO IL CODICE MITTENTE
213080060515     C                   MOVEL     WKSC          bolksc
213090060515     C                   MOVEL     WKSC          SAVMIT
213100941115     C                   MOVEL     VIDCCM        WCCMS
213110940927     C* PARTITA IVA
213120940927     C                   MOVEL     BLPCPI        WPIVA
213130940929     C*
213140940929     C* VEDO SE C'E' TASSAZIONE
213150991006     C                   MOVEL     '1'           WTRC
213160991006     C     KBLP4         CHAIN     FIAR6000                           30
213170940929    1C     *IN30         IFEQ      *OFF
213180050331     c                   move      ar6ksc        wKSCsf1
213190991006     C                   MOVEL     'E'           WAR61             1
213200050331     c* se c'è cod. S.F. significa che bolla tassata in arrivo:NON DEVO
213210050331     c* CARICARLA
213220050331   1ac                   if        wKSCsf1 = 0000 or wKSCsf1 = 9999
213230940929     C*
213240991012     C                   MOVEL     AR6POR        VIDPOR
213250991012     C                   MOVEL     AR6POR        MEMPOR
213260991006     C                   MOVEL     AR6IMV        VIDIMV
213270991006     C                   MOVEL     AR6IMV        SAVIMV
213280060208     C                   MOVEL     AR6IMV        SAVIMVO
213290991006     C                   MOVEL     AR6CEI        VIDCEI
213300991008     C                   MOVEL     AR6DIV        VIDDIV
213310991011     C                   MOVEL     AR6DIV        WDIV1
213320940929     C*
213330991006     C                   MOVEL     AR6NFT        SAVNFT
213340991006     C                   MOVEL     AR6NFT        VIDNFT
213350991006     C                   MOVEL     AR6FIV        VIDFIV
213360991006     C                   MOVEL     AR6DFT        VIDDFT
213370060208     C                   MOVEL     AR6DFT        DFTar6
213380991006     C     AR6NFT        IFGT      0
213390991006     C     AR6NFT        ANDLT     §QTNFT
213400990630     C                   SETON                                        22
213410991006     C                   Z-ADD     AR6IFT        VIDIFT
213420990630     C                   ENDIF
213430991027      *
213440940929     C                   Z-ADD     0             NRR
213450011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
213460011025     C     BLPFBR        IFEQ      'S'
213470011025     C                   SELECT
213480011025     C     AR6SV1        WHENEQ    'N'
213490011025     C     AR6VA1        ANDEQ     88888888
213500011025     C                   MOVEL     '1'           FLGVRN            1
213510011025     C     AR6SV2        WHENEQ    'N'
213520011025     C     AR6VA2        ANDEQ     88888888
213530011025     C                   MOVEL     '1'           FLGVRN
213540011025     C     AR6SV3        WHENEQ    'N'
213550011025     C     AR6VA3        ANDEQ     88888888
213560011025     C                   MOVEL     '1'           FLGVRN
213570011025     C                   ENDSL
213580011025     C                   ENDIF
213590991027      *
213600991027     C                   MOVEL     AR6SV1        WSVN
213610991027     C                   Z-ADD     AR6VA1        WVAN
213620940929     C                   EXSR      CARVAR
213630991027      *
213640991027     C                   MOVEL     AR6SV2        WSVN
213650991027     C                   Z-ADD     AR6VA2        WVAN
213660940929     C                   EXSR      CARVAR
213670991027      *
213680991006    2C     AR6SV3        IFNE      ' '
213690991027     C                   MOVEL     AR6SV3        WSVN
213700991027     C                   Z-ADD     AR6VA3        WVAN
213710940929     C                   EXSR      CARVAR
213720941021     C*
213730940929     C* VISTO CHE C'E' LA 3 VARIA VEDO SE CE NE SONO ANCORA
213740991006     C                   MOVEL     '1'           WTRC
213750991006     C     KBLP4         SETLL     FIAR7000
213760991006     C     KBLP4         READE     FIAR7000                               30
213770940929    3C     *IN30         DOWEQ     *OFF
213780011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
213790011025     C     BLPFBR        IFEQ      'S'
213800011025     C     FLGVRN        ANDNE     '1'
213810011025     C     AR7SVN        ANDEQ     'N'
213820011025     C     AR7VAN        ANDEQ     88888888
213830011025     C                   MOVEL     '1'           FLGVRN
213840011025     C                   ENDIF
213850011025      *
213860991006     C                   MOVEL     'E'           WAR7              1
213870991027     C                   MOVEL     AR7SVN        WSVN
213880991027     C                   MOVEL     AR7VAN        WVAN
213890940929     C                   EXSR      CARVAR
213900991006     C     KBLP4         READE     FIAR7000                               30
213910940929    3C                   ENDDO
213920940929    2C                   ENDIF
213930940929     C*
213940941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
213950941020     C     VIDPOR        IFNE      0
213960941020     C     NRR           ORNE      0
213970941020     C     VIDCEI        ORNE      ' '
213980941020     C                   MOVEL     'S'           WEMD03            1
213990941020     C                   ENDIF
214000991006      *
214010991006     C                   CLEAR                   FIAR6000
214020050331   1ac                   endif
214030940929    1C                   ENDIF
214040941107     C* TIPO SERVIZIO
214050941107     C                   MOVEL     BLPTSP        VIDTSP
214060941107     C                   MOVEL     BLPTSP        SAVTSP
214070941115     C                   MOVEL     BLPTSP        VARTSP
214080941115     C* CONSEGNE PARTICOLARI
214090941115     C                   MOVEL     BLPTC1        VIDTC1
214100941115     C                   MOVEL     BLPTC2        VIDTC2
214110091001     c                   movel     blptc1        sav_tc1
214120091001     c                   movel     blptc2        sav_tc2
214130001205     C                   MOVEL     BLPTC1        SAVTC1
214140001205     C                   MOVEL     BLPTC2        SAVTC2
214150140122     C****               MOVEL     BLPTC1        WSVTCP
214160140122     C****               MOVEL     BLPTC1        WTCP
214170940929     C*
214180940929     C* D E C O D I F I C H E
214190940927     C                   EXSR      DECBOL
214200120926     c* se cod.bolla franco recupero e bolla presente su giacenze in part
214210120926     c* per il recupero delle spese devo disabilitare F16=Annullamento
214220120926     c* Se non voglio più addebitare le spese devono stornare la bolla
214230120926     c* dalla manutenzione bolle di sede
214240120926     c                   if        savrbl='R' and  savtb1='F'
214250120926     C/exec sql
214260120927     c+ Select gcpagc into :wagc
214270120926     c+   from tigcp00f
214280120926     c+   where GCPLPW = :BLPLNP AND GCPASW=:BLPAAS AND GCPNSW=:BLPNRS
214290120927     c+     and GCPNBW = :BLPNSP AND GCPSEDE=' '
214300120926     C/end-exec
214310120926     c                   if        SqlCOD < 0 or sqlCOD = 100
214320120926     c                   else
214330120926      * se qui : ha trovato la giacenza E DISATTIVO QUINDI F16
214340120927     c                   movel     nodi          atrann
214350120926     c                   end
214360120926     c                   endif
214370990702     C* E MANCA LA DATA RITIRO O COD PADR, MI POSIZIONO SULLA DATA
214380990702     C*  RITIRO
214390990702     C     BLPPDR        IFEQ      0
214400990702     C     BLPDRT        OREQ      0
214410990702     C                   SETOFF                                       07
214420040909     c                   z-add     09            h1riga
214430040909     c                   z-add     20            h1colo
214440990702     C                   ENDIF
214450940929     C*
214460950125     C* SALVO LA DECODIFICA DEL TIPO SPEDIZIONE
214470950125     C                   MOVEL     V1DTSP        WDETSP           10
214480940928     C* VEDO SE CARICARE IL MITTENTE O NO
214490941005     C                   MOVEL     *BLANKS       VIDFAP
214500941005    1C     VIDCCM        IFEQ      8888
214510940928     C     VIDCCM        OREQ      9999
214520940928     C                   MOVEL     BLPRSM        VIDRSM
214530940928     C                   MOVEL     BLPINM        VIDINM
214540940928     C                   MOVEL     BLPLOM        VIDLOM
214550940928     C                   MOVEL     BLPCAM        VIDCAM
214560940928     C                   MOVEL     BLPPRM        VIDPRM
214570940928     C                   MOVEL     BLPNZM        VIDNZM
214580941005     C*
214590941005   X1C                   ELSE
214600941005     C*
214610941005     C* CHAIN SU CNACO PER VEDERE SE CAP E NAZIONE DIVERSI
214620941005     C     KACO          CHAIN     CNIND000                           30
214630941005     C*
214640941005    2C     *IN30         IFEQ      *OFF
214650941005    3C     INDCAE        IFNE      BLPCAM
214660941005     C     INDSTA        ORNE      BLPNZM
214670941005     C                   MOVEL     BLPCAM        VIDCMO
214680941005     C                   MOVEL     BLPNZM        VIDNMO
214690941005    3C                   ENDIF
214700941005    2C                   ENDIF
214710941005    1C                   ENDIF
214720910429     C*
214730941005     C* CHAIN PER VEDERE SE ESISTE LA 2 DESCRIZIONE DESTINATARIO
214740940927     C                   MOVEL     'D'           WTRC
214750060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214760940927     C* TROVATA
214770940927     C     *IN30         IFEQ      *OFF
214780060215     C                   MOVE      ar4NOT        VIDRSD
214790060215     C                   MOVE      ar4NOT        SAVRSD
214800940927     C                   ENDIF
214810900511     C                   MOVEL     BLPRSD        VIDRSD
214820910405     C                   MOVEL     BLPRSD        SAVRSD
214830900511     C                   MOVEL     BLPIND        VIDIND
214840070404     C                   MOVEL     BLPIND        savIND
214850900511     C                   MOVEL     BLPPRD        VIDPRD
214860070404     C                   MOVEL     BLPPRD        savPRD
214870910405     C                   MOVEL     BLPCAD        SAVCAD
214880910405     C                   MOVEL     BLPCAD        VIDCAD
214890940930     C                   MOVEL     BLPCAD        VARCAD
214900900511     C                   MOVEL     BLPLOD        VIDLOD
214910070404     C                   MOVEL     BLPLOD        savLOD
214920940927     C                   MOVEL     BLPNZD        VIDNZD
214930020122     C                   MOVEL     BLPNZD        NZDINI
214940911031     C                   MOVEL     BLPCTS        SAVCTS
214950941107     C* CONTROLLO SE IL CLIENTE E' ITALIA O ESTERO
214960941107     C                   MOVEL     BLPNZD        WNAR
214970941107     C                   EXSR      CTRNAR
214980941107     C* NAZIONE CORRETTA
214990941107     C     WEMFOR        IFNE      '1'
215000941107     C     §15ITA        IFEQ      'I'
215010941108     C                   MOVEL     'I'           WDESIE
215020941107     C                   ELSE
215030941108     C                   MOVEL     'E'           WDESIE
215040941107     C                   ENDIF
215050941107     C*
215060941107     C* NAZIONE ERRATA: IMPOSTO SEMPRE "I"
215070941107     C                   ELSE
215080941108     C                   MOVEL     'I'           WDESIE
215090941107     C                   ENDIF
215100941107     C*
215110941107     C* VEDO SE BOLLA ITALIANA O ESTERA
215120971216     C     BLPLNP        CHAIN     AZORG01L      UNIORG               30
215130991203     C                   MOVEL     ORGDE3        OG143
215140000121     C* MEMORIZZO TELEFONO E FAX
215150000121     C                   MOVEL     ORGTEL        LNPTEL           15
215160000121     C                   MOVEL     ORGFAX        LNPFAX           15
215170971210     C**
215180021119     c                   clear                   trul27ds
215190021119     c                   z-add     BlpPkf        I27Pkg
215200021119     c                   move      BlpCtr        I27Ctb
215210020215     c                   exsr      riccar
215220020218     c                   movel     o27fie        savfie
215230970407     C* MI SERVE PER IL CONFRONTO PER CARICARE I CODICI TARIFFA
215240970407     C     VIDCCM        IFNE      9999
215250940927     C                   MOVEL     WKSC          SAVCCM
215260970407     C                   ELSE
215270970407     C                   CLEAR                   SAVCCM
215280970407     C                   ENDIF
215290940927     C*
215300900607     C                   MOVEL     BLPCTR        VIDCTR
215310060515     C                   MOVEL     BLPCTR        BolCTR
215320971210     C* VEDO SE ESISTE NUMERO AWB SOLO PER IMPORTO SDI O EXPORT SDI
215330081008    1c**   §ogntw        ifeq      'EUP'
215340081008     c**   A_§ogntw      oreq      'EUP'
215350081008     C**                 MOVEL     'E'           WTRC
215360081008     C**   KBLP4         CHAIN(N)  Fiar4000                           30
215370081008    2C**   *IN30         IFEQ      *OFF
215380081008     C**                 MOVEL     ar4NOT        DSBL4E
215390081008     C**                 MOVEL     §B4ERP        W010A            10
215400971210     C**
215410081008    3C**   W010A         IFGT      *ZEROS
215420081008     C**                 MOVEL     §B4ERP        V6CAWB
215430081008     C**                 MOVEL     §B4ERP        SAVAWB
215440081008    3C**                 ENDIF
215450971210     C** INSERIMENTO MANUALE
215460081008     C**   §B4EMA        IFEQ      'M'
215470081008     C**                 MOVEL     'MANUALE'     V6CINS
215480081008     C**                 ENDIF
215490971210     C** INSERIMENTO AUTOMATICO
215500081008     C**   §B4EMA        IFEQ      'A'
215510081008     C**                 MOVEL     'AUTOMATI'    V6CINS
215520081008     C**                 MOVE      'CO'          V6CINS
215530081008     C**                 ENDIF
215540971210     C* STAMPATO S/N
215550081008     C**   §B4EST        IFEQ      'S'
215560081008     C**                 MOVEL     'SI'          V6CSTA
215570081008     C**                 ENDIF
215580081008    3C**   §B4EST        IFEQ      'N'
215590081008     C**                 MOVEL     'NO'          V6CSTA
215600081008    3C**                 ENDIF
215610081008    2C**                 ENDIF
215620971210     C**
215630081008    1C**                 ENDIF
215640991203      *
215650060620      * VEDO SE ESISTE NUMERO PARCEL PER IMPORT/EXPORT DPD
215660020319    1C     A_§OGNTW      IFEQ      'DPD'
215670060619    1C     §ogntw        oreq      'DPD'
215680060620     c*
215690061003     C***                MOVEL     'F'           WTRC
215700061003     C***  KBLP4         CHAIN(N)  Fiar4000                           30
215710061003    2C***  *IN30         IFEQ      *OFF
215720061003     C***                MOVEL     ar4NOT        DSBL4F
215730061003     C***                MOVEL     §B4FNP        savfnp
215740061003    2C***                ENDIF
215750060620     c*
215760060620     C                   MOVEL     'K'           WTRC
215770060620     C     KBLP4         CHAIN(N)  Fiar4000                           30
215780060620     C     *IN30         IFEQ      *OFF
215790060620     C                   MOVEL     ar4NOT        DSBL4K
215800060620     C                   MOVEL     §B4krt        savkrt
215810060620     C                   ENDIF
215820060620     c***
215830060605     C                   MOVEL     'I'           WTRC
215840060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
215850991203      *
215860991203    2C     *IN30         IFEQ      *OFF
215870060605     C                   MOVEL     ar4NOT        DSBL4I
215880991203      *
215890060619     c                   if        §b4ipn<>*blanks
215900060605     C                   MOVEL     §B4ipn        V7CNPR
215910060619     c* se parcel number lungo 11 aggiungo a video anche il check digit
215920060619     c                   if        %subst(§b4ipn:14:1)=*blanks
215930060619     c                   eval      %subst(v7cnpr:12:1)=§b4icd
215940060619     c                   endif
215950060619     C                   MOVEL     v7cnpr        SAVNPR
215960991203    3C                   ENDIF
215970991203      *
215980991203    2C                   ENDIF
215990991203    1C                   ENDIF
216000941115     C*
216010941115     C* CARICO LE NOTE
216020941115     C                   MOVEL     '8'           WTRC
216030060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
216040941115     C* TROVATA
216050941115     C     *IN30         IFEQ      *OFF
216060060215     C                   MOVEL     ar4NOT        VIDNT1
216070941115     C*
216080941115     C                   MOVEL     '9'           WTRC
216090060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
216100941115     C* TROVATA
216110941115     C     *IN30         IFEQ      *OFF
216120060215     C                   MOVEL     ar4NOT        VIDNT2
216130941115     C                   ENDIF
216140000124     C                   ENDIF
216150000124     C**
216160000124     C* SE LA PRIMA NOTA E' MESSA IN AUTOMATICO, LA CLEARO
216170000124     C                   MOVEL     VIDNT1        W012A            12
216180000124     C*
216190000124     C     W012A         IFEQ      CDPD
216200000124     C                   CLEAR                   VIDNT1
216210000124     C     VIDNT2        IFNE      *BLANKS
216220000124     C                   MOVEL     VIDNT2        VIDNT1
216230000124     C                   CLEAR                   VIDNT2
216240000124     C                   ENDIF
216250000124     C                   ENDIF
216260000623     C***
216270060216     C* VEDO SE CE' RECORD ar4 W
216280000623     C                   MOVEL     'W'           WTRC
216290060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
216300000623     C  N30              MOVEL     'E'           WBL4W             1
216310121123     C***
216320121123     C* VEDO SE CE' RECORD ar4 Z
216330121123     c                   clear                   wesar4z
216340121123     c                   clear                   wtrasmz
216350121123     c                   clear                   wkscz
216360121123     C                   MOVEL     'Z'           WTRC
216370121123     C     KBLP4         CHAIN(N)  Fiar4000                           30
216380121123     c                   if        not *in30
216390121123     C                   MOVEL     'S'           Wesar4z           1
216400121123     C                   MOVEL     AR4NOT        DSBL4Z
216410121123     c                   if        §B4DTR=0
216420121123     C                   EVAL      WTRASMz='N'
216430121123     C                   ENDIF
216440121123     c                   move      §b4okc        wkscz
216450121123     c                   endif
216460061110     c*
216470061110     C* CARICO il codice fiscale se presente
216480061110     C                   MOVEL     'Q'           WTRC
216490061110     C     KBLP4         CHAIN(N)  Fiar4000                           30
216500061110     C     *IN30         IFEQ      *OFF
216510061110     c                   movel     ar4not        vidcdf
216520061110     c                   endif
216521141201
216522141201     C* CARICO il PIN CODE se presente
216523141201     C                   MOVEL     'Y'           WTRC
216524141201     C     KBLP4         CHAIN(N)  Fiar4000                           30
216525141201     C     *IN30         IFEQ      *OFF
216526141201     c                   movel     ar4not        dsbl4y
216527141201     c                   eval      wpincode=§B4PCD
216528141201     c                   endif
216530950410     c*
216540950410     C* CARICO LE P.IVA MITTENTE E DESTINATARIO
216550950410     C                   MOVEL     'P'           WTRC
216560060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
216570950410     C     *IN30         IFEQ      *OFF
216580950410     C*
216590060215     C                   MOVEL     ar4NOT        WPIVA
216600050921     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
216610050921     c                   select
216620050921     c* solo numeri
216630050921     c* "PRIVATO senza iso
216640050921     c     *in30         wheneq    *off
216650050921     c     wiso          andge     *zeros
216660050921     c     *in30         oreq      *on
216670050921     c     posiz         andlt     3
216680050921     c                   movel     wpiva         vidcpm
216690050921     c* iso + numeri
216700050921     c* iso + "PRIVATO"
216710050921     c     *in30         wheneq    *off
216720050921     c     posiz         orgt      2
216730050921     c                   movel     wpiva         vidpim
216740050921     c                   endsl
216750050921     c
216760950410     C*
216770060215     C                   MOVE      ar4NOT        WPIVA
216780050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
216790050921     c                   select
216800050921     c* solo numeri
216810050921     c* "PRIVATO senza iso
216820050921     c     *in30         wheneq    *off
216830050921     c     wiso          andge     *zeros
216840050921     c     *in30         oreq      *on
216850050921     c     posiz         andlt     3
216860050921     c                   movel     wpiva         vidcpd
216870050921     c* iso + numeri
216880050921     c* iso + "PRIVATO"
216890050921     c     *in30         wheneq    *off
216900050921     c     posiz         orgt      2
216910050921     c                   movel     wpiva         vidpid
216920050921     c                   endsl
216930950410     C*
216940950410     C                   ENDIF
216950900607     C*
216960900604     C* FLAG INOLTRO PULISCO SE NON E' UNA ISOLA
216970900604     C                   MOVEL     ' '           VIDFIN
216980941115     C                   MOVEL     BLPFBR        VIDFBR
216990941115     C                   MOVEL     BLPGC1        VIDGC1
217000900511     C                   MOVEL     BLPGC2        VIDGC2
217010900511     C                   MOVEL     BLPFTM        VIDFTM
217020940927     C                   MOVEL     BLPIAS        VIDIAS
217030940927     C                   MOVEL     BLPVAS        VIDVAS
217040950410     C                   MOVEL     BLPVAS        VARVAS
217050940927     C                   MOVEL     BLPVMD        VIDVMD
217060940927     C                   MOVEL     BLPVAD        VIDVAD
217070950410     C                   MOVEL     BLPVAD        VARVAD
217080940927     C                   MOVEL     BLPQFT        VIDQFT
217090940928     C                   MOVEL     BLPGGA        VIDGGA
217100940928     C                   MOVEL     BLPGMA        VIDGMA
217110091221     c                   eval      wvidgma = blpgma
217120100604     c* Verifico se c'e' ritiro contestuale alla consegna
217130100604     c                   clear                   ds7r
217140100604     C                   MOVEL     '7R'          COD
217150100604     C                   MOVEL(P)  blpGMA        KEY
217160100604     C                   EXSR      CTABEL
217170100604     C  n30              MOVEL     TBLUNI        DS7R
217180100604     c                   eval      w7rRC = §7rRC
217190100604     c
217200960208     C                   CLEAR                   VIDGVA
217210960208     C                   MOVEL     BLPGVA        W001A
217220960208     C                   MOVEL     W001A         VIDGVA
217230900511     C                   MOVEL     BLPNAS        VIDNAS
217240900511     C                   MOVEL     BLPNCL        VIDNCL
217250940819     C                   MOVEL     BLPNCL        V1CNCL
217260930331     C                   MOVEL     BLPNCL        SAVNCL
217270980408     C                   MOVE      BLPNCD        SAVNCD
217280980408     C                   MOVE      BLPNCA        SAVNCA
217290940927     C                   MOVEL     BLPPKB        VIDPKG
217300940927     C                   MOVEL     BLPPKB        V2CPKG
217310980402     C                   MOVEL     BLPPKB        SAVPKG
217320940927     C                   MOVEL     BLPVLB        VIDVOL
217330980402     C                   MOVEL     BLPVLB        SAVVOL
217340090609     c                   movel     blppkb        wpes_pre
217350090609     c                   movel     blpvlb        wvol_pre
217360090609     C                   MOVEL     BLPNCL        wncl_pre
217370930512     C* VEDO RAGGRUPPAMENTO DEL VOLUME
217380940928     C                   MOVEL     BLPFVB        VIDFVR            1
217390930512     C                   MOVEL     '7T'          COD
217400940928     C                   MOVEL(P)  BLPFVB        KEY
217410930708     C                   EXSR      CTABEL
217420930512     C  N30              MOVEL     TBLUNI        DS7T
217430930708     C   30              CLEAR                   DS7T
217440910125     C*
217450900511     C                   MOVEL     BLPRMN        VIDRMN
217460060619     C******             MOVEL     BLPRMN        savrmn
217470940825     C                   MOVEL     BLPRMA        VIDRMA
217480940922     C                   MOVEL     BLPRMA        SAVRMA
217490900511     C                   MOVEL     BLPRMO        VIDRMO
217500900511     C                   MOVEL     BLPNCD        VIDNCD
217510900511     C                   MOVEL     BLPNCA        VIDNCA
217520960808     C                   MOVEL     BLPNCD        WNSNCD
217530960808     C                   MOVEL     BLPNCA        WNSNCA
217540900511     C                   MOVEL     BLPZNC        VIDZNC
217550930401     C                   MOVEL     BLPZNC        VARZNC
217560930402     C                   MOVEL     BLPZNC        SAVZNC
217570900511     C                   MOVEL     BLPCTM        VIDCTM
217580900511     C                   MOVEL     BLPFFD        VIDFFD
217590930401     C                   MOVEL     BLPFFD        VARFFD
217600010214     C     BLPFFD        IFEQ      *BLANKS
217610010214     C                   MOVEL     'N'           VIDFFD
217620010214     C                   MOVEL     'N'           VARFFD
217630010214     C                   ENDIF
217640910114     C*
217650900516     C                   MOVEL     BLPNFV        VIDNFV
217660910114     C                   MOVEL     BLPTCR        VIDTCR
217670940927     C                   MOVEL     BLPHCR        VIDHCR
217680940927     C                   MOVE      BLPHCR        VIDMCR
217690900516     C* GIRO DATA BORDERO
217700940927     C                   CLEAR                   WLBDAT
217710950107     C                   MOVEL     '3'           G02ERR
217720940927     C                   Z-ADD     BLPDBR        G02INV
217730940927     C                   CALL      'XSRDA8'
217740940927     C                   PARM                    WLBDAT
217750940927     C                   Z-ADD     G02DAT        VIDDBR
217760940928     C* VEDO SE ESISTE C/A
217770940928     C     §3AFCA        IFNE      0
217780051115     C     KBLP3         CHAIN     Fiar9000                           30
217790940928     C     *IN30         IFEQ      *OFF
217800051115     C                   MOVEL     'E'           War9              1
217810051115     C                   Z-ADD     ar9CAS        VIDCAS
217820051115     C                   MOVEL     ar9TIC        VIDTIC
217830051115     C                   MOVEL     ar9GCA        VIDGCA
217840051115     C                   MOVEL     ar9VCA        VIDVCA
217850051115     C                   MOVEL     ar9VCA        VARVCA
217860940928     C                   ENDIF
217870940928     C                   ENDIF
217880940928     C*
217890900517     C* SE ESISTE AGGANCIO 2° BOLLA
217900991006     C                   MOVEL     '2'           WTRC
217910991006     C     KBLP4         CHAIN     FIAR6000                           30
217920940927    1C     *IN30         IFEQ      *OFF
217930050331     c                   move      ar6ksc        wKSCsf2
217940991006     C                   MOVEL     'E'           WAR62             1
217950040114
217960050331   1ac                   if        wKSCsf2 = 0000 or wKSCsf2 = 9999
217970040114     c                   Z-add     Ar6Va1        Vi2Va1
217980040116     c                   Z-add     Ar6Va1        Va2va1
217990991006     C                   MOVEL     AR6SV1        VI2SV1
218000040114     c                   Z-add     Ar6Va2        Vi2Va2
218010040114     c                   Z-add     Ar6Va2        Va2Va2
218020040114     c                   Movel     Ar6Sv2        Vi2Sv2
218030040114     c                   Z-add     Ar6Va3        Vi2Va3
218040040114     c                   Z-add     Ar6Va3        Va2Va3
218050040114     c                   Movel     Ar6Sv3        Vi2Sv3
218060040126     c                   Z-add     Ar6Imv        Vi2Imv
218070040114      * Vedo se ci sono altre varie su FIAR7
218080040114     c                   Eval      wtrc = '2'
218090041217     c                   clear                   contasv
218100040114     c     Kblp4         Setll     Fiar7000
218110040114     c                   Do        *Hival
218120040114     c     Kblp4         Reade     Fiar7000
218130040114     c                   If        %Eof(Fiar701l)
218140040114     c                   Leave
218150040114     c                   EndIf
218160040114     c                   Eval      war71 = 'E'
218170041217     c                   select
218180041217     c                   when      contasv = 0
218190040114     c                   Movel     Ar7Svn        Vi2Sv4
218200040114     c                   Z-add     Ar7Van        Vi2Va4
218210040114     c                   Z-add     Ar7Van        Va2Va4
218220041217     c                   add       1             contasv
218230041217     c                   when      contasv = 1
218240041217     c                   Movel     Ar7Svn        Vi2Sv5
218250041217     c                   Z-add     Ar7Van        Vi2Va5
218260041217     c                   Z-add     Ar7Van        Va2Va5
218270041217     c                   add       1             contasv
218280041217     c                   when      contasv = 2
218290041217     c                   Movel     Ar7Svn        Vi2Sv6
218300041217     c                   Z-add     Ar7Van        Vi2Va6
218310041217     c                   Z-add     Ar7Van        Va2Va6
218320040114     c                   Leave
218330041217     c                   endsl
218340040114     c                   EndDo
218350040114
218360991006     C                   MOVEL     AR6CEI        VI2CEI
218370991008     C                   MOVEL     AR6DIV        VI2DIV
218380991011     C                   MOVEL     AR6DIV        WDIV2
218390940927     C* SE ESISTE ESENZIONE IVA DECODIFICO
218400991006    2C     VI2CEI        IFNE      *BLANKS
218410940927     C                   MOVEL     'EI'          COD
218420940927     C                   MOVEL(P)  VI2CEI        KEY
218430940927     C                   EXSR      CTABEL
218440940927     C  N30              MOVEL     TBLUNI        V2DCEI
218450940927    2C                   ENDIF
218460980120     C**
218470050407     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
218480050407     C     VI2imv        IFNE      0
218490050407     C     vi2va1        ORNE      0
218500050407     C     vi2va2        ORNE      0
218510050407     C     vi2va3        ORNE      0
218520050407     C     vi2va4        ORNE      0
218530050407     C     vi2va5        ORNE      0
218540050407     C     vi2va6        ORNE      0
218550050407     C     VI2CEI        ORNE      ' '
218560050407     C                   MOVEL     'S'           WEMD03            1
218570050407     C                   ENDIF
218580050407     c*
218590991006     C                   CLEAR                   FIAR6000
218600050331   1ac                   endif
218610940927    1C                   ENDIF
218620941011     C*
218630941011     C* METTO IL NUMERO DI SPEDIZIONE IN 1 VIDEATA
218640941011     C                   Z-ADD     BLPNRS        PRENRS
218650941011     C                   Z-ADD     BLPNSP        PRENSP
218660941011     C                   MOVEL     BLPLNA        PRELNA
218670941011     C                   Z-ADD     BLPRMN        PRERMN
218680941011     C                   Z-ADD     BLPZNC        PREZNC
218690000913     C*
218700000913     C* SE DISK C CARICO COD.CHI SONO NEL SUBFILE
218710000913     C                   SETOFF                                       96
218720000918     C* PRENDO CTM
218730000918     C                   MOVE      '1B'          COD
218740000918     C                   MOVEL(P)  VIDCTM        KEY
218750000918     C                   EXSR      CTABEL
218760000918     C  N30              MOVEL     TBLUNI        DS1B
218770000918     C   30              CLEAR                   DS1B
218780000918     C*
218790000913    2C     §1BF12        IFNE      'N'
218800020319     C     A_§OGNTW      ANDNE     'DPD'
218810050228     c     §ogntw        andne     'DPD'
218811140715
218820001009     C     §1BF12        ORNE      'N'
218830020319     C     A_§OGNTW      ANDEQ     'DPD'
218840001009     C     §1BF13        ANDEQ     'A'
218841140715
218842140715     C     §1BF12        OReq      'B'
218843140715     C     A_§OGNTW      ANDEQ     'DPD'
218850000913     C* Attivo F22=Manutenzione cod."Chi Sono"
218860000913     C                   SETON                                        96
218870000913     C                   MOVEL     'C'           WTRC
218880000913     C                   Z-ADD     0             NR8
218890120817     C**   KBLT1         SETLL     FNBLT01L
218900120817     C**   KBLT1         READE(N)  FNBLT01L                               30
218910120817     C     KBLT1         SETLL     FIART01L
218920120817     C     KBLT1         READE(N)  FIART01L                               30
218930000913    3C     *IN30         DOWEQ     *OFF
218940120817     C***  KARS1         CHAIN(N)  FIARS01L                           30
218950120817     C     KARS1A        CHAIN(N)  FIARS01L                           30
218960051102     C  N30              EXSR      CARARS
218970120817     C**   KBLT1         READE(N)  FNBLT01L                               30
218980120817     C     KBLT1         READE(N)  FIART01L                               30
218990000913    3C                   ENDDO
219000000913     C     NR8           IFGT      0
219010000913     C                   SETON                                        78
219020000913     C                   ENDIF
219030000918     C                   Z-ADD     NR8           SAVNR8
219040000913    2C                   ENDIF
219050070322     c* se bolla export dpd con numero parcel non automatico verifico
219060070322     c* se chi sono diverso dal numero parcel ed in questo caso memoriz
219070070323     c* zo nel subfile ma non abilito l'f22
219080070322     C     §1BF12        ifNE      'N'
219090070322     C     A_§OGNTW      ANDEQ     'DPD'
219100070322     C     §1BF13        ANDne     'A'
219101140715     C     §1BF12        ANDne     'B'
219110070322     C                   Z-ADD     0             NR8
219120070322     C                   MOVEL     'C'           WTRC
219130120817     C***  KBLT1         chain(N)  FNBLT01L
219140120817     c***                if        %found(fnblt01l)
219150120817     C***  KARS1         CHAIN(N)  FIARS01L
219160120817     C     KBLT1         chain(N)  FIART01L
219170120817     c                   if        %found(fiart01l)
219180120817     C     KARS1A        CHAIN(N)  FIARS01L
219190070322     c                   if        %found(fiars01l)
219200070322     c                             and arsnot<>v7cnpr
219210070322     c                   exsr      carars
219220070322     c                   eval      wparcel='12'
219230070322     C                   SETON                                        78
219240070322     c                   endif
219250070322     c                   endif
219260070322     C                   Z-ADD     NR8           SAVNR8
219270070322     c                   endif
219280010209     C* PRENDO NUMERO ORM SE PRESENTE
219290010209     C                   MOVEL     'M'           WTRC
219300060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
219310060215     C  N30              MOVEL     ar4NOT        DSBL4M
219320010209     C   30              CLEAR                   DSBL4M
219330061122     c                   movel     dsbl4m        S_dsbl4m
219340010209     C                   Z-ADD     §B4POE        VIDPOE
219350010222     C                   MOVEL     §B4NSR        VIDNOR
219360010222     C                   MOVE      §B4NOR        VIDNOR
219370010209     C                   Z-ADD     §B4NRV        VIDNRV
219380010215     C                   MOVEL     VIDORM        W01ORM
219390011126     C                   MOVEL     '1'           WOVUO
219400070427     C                   MOVEL     '1'           WOVUO1
219410011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
219420011126     C                   Z-ADD     VIDPOE        WOPOE
219430011126     C                   Z-ADD     VIDNOR        WONOR
219440011126     C                   Z-ADD     VIDNRV        WONRV
219450091008
219460011126     C                   CLEAR                   DORM01
219470090327     c                   clear                   s_ormksc
219480090327     c                   clear                   s_ormctr
219490011126     C     KORM          CHAIN     FNORM01L                           30
219500011126     C  N30              MOVEL     ORMFLO        DORM01
219510090327     c  n30              z-add     ormksc        s_ormksc
219520090327     c  n30              move      ormctr        s_ormctr
219530011126     C     §ORMFD        IFEQ      'S'
219540011126     C                   MOVEL     PROT          ATRDES
219550011126     C                   ELSE
219560011126     C                   CLEAR                   ATRDES
219570011126     C                   ENDIF
219580021218      * Aggancio file estensione Fiar500f record "BAN" per recuperare i
219590021218      * bancali
219600030704     c                   If        %subst(VidGva:1:1) = 'B'
219610021218     c                   Clear                   DAr5Ban
219620030704     c                   Eval      kAr5Trd = 'BAN'
219630021218     c     KFiar5        Chain(n)  Fiar501l
219640021218     c                   If        %Found(Fiar501l)
219650021218     c                   Movel     Ar5Uni        DAr5Ban
219660021218     c                   EndIf
219670021220     c                   If        §Ar5Tba > *Zeros
219680021218     c                   Movel     §Ar5Tba       VidTba
219690021220     c                   EndIf
219700021218     c                   Eval      VidNba = §Ar5Nba
219710030204     c                   Eval      SavNba = §Ar5Nba
219720021220     c                   If        §Ar5Tb2 > *Zeros
219730021220     c                   Movel     §Ar5Tb2       VidTb2
219740021220     c                   EndIf
219750021218     c                   Eval      VidNb2 = §Ar5Nb2
219760030204     c                   Eval      SavNb2 = §Ar5Nb2
219770030704     c                   EndIf
219780030704
219790030704      * Aggancio file estensione Fiar500f record "BNB" per recuperare i
219800030704      * bancali e i colli originali
219810030704     c                   If        %subst(VidGva:1:1) = 'O'
219820030704     c                   Clear                   DAr5Bnb
219830030704     c                   Eval      kAr5Trd = 'BNB'
219840030704     c     KFiar5        Chain(n)  Fiar501l
219850030704     c                   If        %Found(Fiar501l)
219860030704     c                   Movel     Ar5Uni        DAr5Bnb
219870030704     c                   EndIf
219880030704     c                   If        §Ar5bTba > *Zeros
219890030704     c                   Movel     §Ar5bTba      VidTba
219900030704     c                   EndIf
219910030704     c                   Eval      VidNba = §Ar5bNba
219920030704     c                   Eval      SavNba = §Ar5bNba
219930030704     c                   If        §Ar5bTb2 > *Zeros
219940030704     c                   Movel     §Ar5bTb2      VidTb2
219950030704     c                   EndIf
219960030704     c                   Eval      VidNb2 = §Ar5bNb2
219970030704     c                   Eval      SavNb2 = §Ar5bNb2
219980030704     c                   Eval      w03cor = §Ar5bCor
219990030704     c                   Eval      w03csf = §Ar5bCsf
220000030708     c                   Eval      savw03cor = §Ar5bCor
220010030708     c                   Eval      savw03csf = §Ar5bCsf
220020030704     c                   EndIf
220030031113      * Aggancio file estensione Fiar500f record "GEN" per recuperare
220040040610      * il referente e il telefono e v-valore
220050031113     c                   Clear                   DAr5Gen
220060091001     c                   clear                   w_ar5tcp
220070031114     c                   Eval      kAr5Trd = 'GEN'
220080031113     c     KFiar5        Chain(n)  Fiar501l
220090031113     c                   If        %Found(Fiar501l)
220100031113     c                   Movel     Ar5Uni        DAr5Gen
220110031113     c                   EndIf
220120031113     c                   Eval      VidRef = §Ar5Ref
220130031113     c                   Eval      VidTel = §Ar5Teld
220140040610     c                   Eval      Vidbva = §Ar5bva
220150050421     c                   eval      savbva = §ar5bva
220160091001     c                   eval      w_ar5tcp=§ar5tcp
220170091211     c                   eval      nochkticC=*off
220180091112     c* window scelta beneficiario contrassegno: se presente codice su
220190091112     c* fiar5 rek gen imposto opportunamente campo scelta beneficiario C/A
220200091118     c                   if        dateu>=§vpocas
220210091119     c                   if        §ar5cdi<>*blanks
220220091112     c                   eval      wcassel2='X'
220230091211     c                   eval      nochkticC=*on
220240091112     c                   else
220250091127     C                   CLEAR                   DS1a
220260091127     c                   if        vidtic<>*blanks
220270091127     C                   MOVEL     '1A'          COD
220280091127     C                   MOVEL(P)  vidtic        KEY
220290091127     C                   EXSR      CTABEL
220300091127     C  N30              MOVEL     TBLUNI        DS1a
220310091127     c                   endif
220320091112     c                   if        §3afca<>0 and *in04 and widor1>0
220330091112     c                             and ormpag='O'
220340091204     c                             and §1amro<>'S'
220350091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
220360091112     c                                 %editc(ormksc:'X')
220370091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
220380091112     c                                 %subst(%editc(ormcor:'X'):1:7)
220390091112     c                   eval      wcassel1='X'
220400091211     c                   eval      nochkticC=*on
220410091112     c                   endif
220420091112     c                   endif
220430091118     c                   endif
220440110512      * Aggancio file estensione Fiar500f record "EMD" per recuperare indirizzo
220450130315      * email destinatario e numero di telefono per sms
220460110512     c                   Clear                   DAr5emd
220470110512     c                   Eval      kAr5Trd = 'EMD'
220480110512     c     KFiar5        Chain(n)  Fiar501l
220490110512     c                   If        %Found(Fiar501l)
220500110512     c                   Movel     Ar5Uni        DAr5Emd
220510110512     c                   Eval      wemdest = §Ar5eml
220520130918     c* Per il momento e fino ache non ci sarà la storicicazione di
220530130918     c* varizioni di email destinatario impedisco la variazione se
220540130918     c* già inviata email
220550150213     c***                if        wemdest<>*blanks and §ar5dto=*blanks
220560150213     c***                clear                   atremd
220570150213     c***                clear                   atrwemd
220580150213     c***                endif
220590130315     c                   Eval      wsms    = §Ar5tel
220600140423     c* Per il momento e fino ache non ci sarà la storicicazione di
220610140423     c* varizioni di tel destinatario impedisco la variazione se
220620140423     c* già inviato sms
220630150213     c***                if        wsms   <>*blanks and §ar5dos=*blanks
220640150213     c***                clear                   atremd
220650150213     c***                clear                   atrwtel
220660150213     c****               endif
220670130315     c                   Eval      wsmp    = §Ar5smp
220680130923     c                   Eval      wmmp_ar5= §Ar5mmp
220690110512     c                   EndIf
220700110706     C* Aggancio fiar4 record "4" perr recuperare codici cup e cig
220710110706     C                   MOVEL     '4'           WTRC
220720110706     C     KBLP4         CHAIN(N)  Fiar4000                           30
220730110706     C  N30              MOVEL     ar4NOT        DSBL44
220740110706     C   30              CLEAR                   DSBL44
220750110706     c                   if        §b44cup<> *blanks or §b44cig<>*blanks
220760110706     c                   movel     §b44cup       wcupcup
220770110706     c                   movel     §b44cig       wcupcig
220780110706     c                   endif
220790090326     C* Manutenzione bolle: se sono in manutenzione bolle devo eventualmente
220800090326     c* completare la videata prendendo ksc/ctr memorizzati su data base
220810090326     c* se bolla avente sigla operatore presente in tabella 3M proteggo sempre
220820090326     c* perchè potebbe trattarsi di codici inseriti in automatico in fase di
220830090326     c* bolettazione in quanto passati da chiamante
220840090326     c                   if        *in04
220850090326     c                   exsr      sr_daar4a
220860130918     c                   endif
220870091112     c
220880000913     C*
220890950102     C                   ENDIF
220900061212     C                   ENDIF
220910900511     C                   ENDSR
220920011025     C*
220930011025      *--- TASSAZIONE VARIA 'N' --------------------------------------*
220940011025     C     TASSAN        BEGSR
220950011025      *
220960011025     C                   CLEAR                   DTAS
220970011025     C                   CLEAR                   DTASV
220980011025     C                   Z-ADD     BLPKSC        TASKSC
220990011025     C                   Z-ADD     BLPCTR        TASCTR
221000011025     C                   Z-ADD     BLPPKF        TASPKF
221010011025     C                   MOVEL     BLPLNP        TASLNP
221020011025     C                   MOVEL     BLPCTS        TASCTS
221030011025     C                   MOVEL     BLPDSP        TASDSP
221040011025     C                   MOVEL     BLPDSP        TASDCT
221050011025     C                   MOVEL     BLPVLF        TASVLF
221060011025     C                   MOVEL     BLPTSP        TASTSP
221070011025     C     WBOL          IFEQ      '1'
221080011025     C                   MOVEL     §3ATB1        TASTBL
221090011025     C                   ELSE
221100011025     C                   MOVEL     §3ATB2        TASTBL
221110011025     C                   ENDIF
221120011025     C                   MOVEL     BLPLNA        TASLNA
221130011025     C                   MOVEL     BLPNCL        TASNCL
221140011025     C                   MOVEL     BLPQFT        TASQFT
221150011025     C     WBOL          IFEQ      '1'
221160011025     C     §3AFCA        ANDEQ     1
221170011025     C     WBOL          OREQ      '2'
221180011025     C     §3AFCA        ANDEQ     2
221190051115     C                   MOVEL     ar9CAS        TASCAS
221200051115     C                   MOVEL     ar9VCA        TASVCA
221210051115     C                   MOVEL     ar9TIC        TASTIC
221220011025     C                   ENDIF
221230011025     C                   MOVEL     BLPIAS        TASIAS
221240011025     C                   MOVEL     BLPVAS        TASVAS
221250011025     C                   MOVEL     BLPCAD        TASCAD
221260011025     C                   MOVEL     BLPNZD        TASNZD
221270011025     C                   MOVEL     BLPFIN        TASFIN
221280011025     C                   MOVEL     BLPCAM        TASCAM
221290011025     C                   MOVEL     BLPNZM        TASNZM
221300011025     C                   MOVEL     BLPFAP        TASFAP
221310011025     C                   MOVEL     BLPTC1        TASTC1
221320011025     C                   MOVEL     BLPTC2        TASTC2
221330011025     C     BLPFST        IFEQ      'S'
221340011025     C     BLPFST        OREQ      'C'
221350011025     C                   MOVEL     'S'           TASDDT
221360011025     C                   ELSE
221370011025     C                   MOVEL     'N'           TASDDT
221380011025     C                   ENDIF
221390061002     c*****              movel     blpfbr        §tasflo
221400061002     c* Passo nella DTAS01 il blpfbr
221410061002     c                   clear                   dtas01
221420061002     c                   movel     blpfbr        §asfbr
221430061002     c                   movel(P)  dtas01        §tasflo
221440011025      **
221450011025      * SE BOLLA EXPORT--> NON PASSO MAI IL FLAG CONSEGNA A MAGAZZINO
221460011025      *                    IN MODO CHE TASSI SEMPRE LA VARIA 'U'
221470020219     C     A_§ogntw      ifeq      'COR'
221480020219     c     A_§ogntw      oreq      'MES'
221490020219     c     A_§ogntw      oreq      'PPT'
221500011025     C                   MOVEL     BLPFDN        TASFDN
221510011025     C                   ENDIF
221520011025      **
221530011025      * CHAIN SU CAPPARIO PER PRENDERE COD TASSAZIONE MITTENTE
221540011025     C                   CLEAR                   DSSI95
221550011025     C                   MOVEL     BLPLOM        I95LOC
221560011025     C                   MOVEL     BLPCAM        I95CAP
221570011025     C                   MOVEL     BLPNZM        I95NAR
221580011025     C                   MOVEL     '3'           I95TCN
221590011025     C                   MOVEL     BLPDSP        I95DAT
221600011025     C     §3AFCA        IFNE      0
221610011025     C                   MOVEL     'S'           I95FCA
221620011025     C                   ENDIF
221630011025     C                   MOVEL     §3ATB1        I95TPO
221640020305     c* se network fedex passo flag apposito per dire di prendere i dati
221650020305     c* dalla tabella della nazione
221660020305     c     §ogntw        ifeq      'FED'
221670020305     c                   movel     'S'           i95fi1
221680020305     c                   endif
221690011025     C                   CALL      'TISI95R'
221700011025     C                   PARM                    DSSI95
221710011025     C     O95ERR        IFEQ      *BLANKS
221720011025     C                   MOVEL     O95CTS        TASMCT
221730011025     C                   ENDIF
221740011025     C                   MOVEL     'S'           WCAL13            1
221750020218      * ELABORO E CHIUDO CON RT IL PGM
221760011025     C                   MOVEL     ' '           TASTLA
221770011212     C* DATA TASSAZIONE = 0    : SE STO TASSANDO LA VARIA "N" NON E'
221780011121     C*                          POSSIBILE CHE LA BOLLA SIA GIA' FATTU-
221790011121     C*                          RATA
221800021002     c* imposto peso vdl e colli rilevati
221810030204     c                   z-add     blpncp        Tasncp
221820030204     c                   z-add     blppkc        Taspkc
221830030204      * Bancali
221840030205If  1c                   If        %Subst(VidGva:1:1) ='B'
221850030204     c                   Eval      TasBan = VidNba + VidNb2
221860030205     c                   EndIf
221870030728      * Colli originali
221880030728If  1c                   If        %Subst(VidGva:1:1) ='O'
221890030728     c                   Eval      TasNcl = W03Cor
221900030728     c                   EndIf
221910011025      *
221920011025     C                   CALL      'TNSF20R'
221930011025     C                   PARM                    KPJBA
221940011025     C                   PARM                    DTAS
221950011025     C                   PARM                    DTASV
221960011025      *
221970011025      * Tassazione andata buon fine
221980011025     C     TASERR        IFEQ      *BLANKS
221990011025      *
222000011025      * Controllo la divisa della tassazione con la divisa del video
222010011025      * se non corrispondono devo convertire la varia 'N' nella divisa
222020011025      * del video
222030011025     C     TASDIV        IFNE      VIDDIV
222040011025      * aggancio la tabella CV per sicurezza
222050011025     C                   CLEAR                   DSCV
222060011025     C                   MOVEL     'CV'          COD
222070011025     C                   MOVEL(P)  VIDDIV        KEY
222080011025     C                   EXSR      CTABEL
222090011025     C  N30              MOVEL     TBLUNI        DSCV
222100011025      *
222110011025     C                   CLEAR                   DSYEUR
222120011025     C                   MOVEL     TASDIV        YECDVI
222130011025     C                   MOVEL     VIDDIV        YECDVO
222140011025     C                   Z-ADD     TASIMV        YECIMI
222150011025     C     §CVFDC        IFEQ      'S'
222160011025     C                   MOVE      '3'           YECDCO
222170011025     C                   ELSE
222180011025     C                   MOVE      '0'           YECDCO
222190011025     C                   ENDIF
222200011025     C                   CALL      'YEURCO'
222210011025     C                   PARM                    DSYEUR
222220011025     C     YECESI        IFEQ      ' '
222230011025     C                   Z-ADD     YECIMO        TASIMV
222240011025     C                   ELSE
222250011025     C                   Z-ADD     88888888      TASIMV
222260011025     C                   ENDIF
222270011025     C                   ENDIF
222280011025      *
222290011025     C                   Z-ADD     TASIMV        V3CVA1
222300011025     C                   ENDIF
222310011025      *
222320011025     C                   ENDSR
222330901031     C*
222340901031     C*--- TASSAZIONE BOLLA ------------------------------------------*
222350901031     C     TASSAZ        BEGSR
222360991012      *
222370991007     C                   CLEAR                   DTAS
222380020503     C                   CLEAR                   WTASSA            1
222390030623     C                   CLEAR                   WTASSAD           1
222400030623     C                   CLEAR                   ITASSA           11 3
222410941219     C*
222420941219     C                   MOVEL     VIDCTR        TASCTR
222430990701     C* SE E' FRANCO CODIFICATO SEMPRE CODICE CLIENTE
222440941219    1C     *IN04         IFEQ      *OFF
222450941219     C                   MOVEL     WKSC          TASKSC
222460990701     C* PER 8888 IMPOSTO LA TARIFFA DI TASSAZIONE DEI PREPAGATI
222470990701   1AC     VIDCCM        IFEQ      8888
222480990610     C*
222490990610     C* PER PREPAGATI CERCO LA TARIFFA GIUSTA
222500020117      *
222510020117      * Non più, prendere sempre la tariffa di cartello
222520990610     C**
222530020218     c                   z-add     o27ksc        tasksc
222540020218     c                   z-add     o27ctr        tasctr
222550990610     C**
222560990701   1AC                   ENDIF
222570990701    1C                   ENDIF
222580941219     C*
222590941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
222600941219    1C     *IN04         IFEQ      *ON
222610991007      *
222620941219    2C     SAVFTM        IFEQ      'S'
222630941219     C     VIDFTM        OREQ      'S'
222640941219     C                   MOVE      WKSC          TASKSC
222650941219   X2C                   ELSE
222660941219     C*
222670941219     C* SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
222680941219     C                   MOVEL     COMLNA        TASKSC
222690941219     C                   MOVE      9999          TASKSC
222700941219     C                   Z-ADD     0             TASCTR
222710941219    2C                   END
222720941219    1C                   END
222730941219     C                   MOVEL     VIDCAM        TASCAM
222740991014     C                   MOVEL     VIDNZM        TASNZM
222750990610    1C     APDFCM        IFNE      ' '
222760941230     C                   MOVEL     'C'           TASFAP
222770941230     C                   ELSE
222780941230     C                   MOVEL     COMFAP        TASFAP
222790990610    1C                   END
222800941219     C*
222810941219     C* FLAG INOLTRO
222820990610    0C     *IN90         IFEQ      *OFF
222830990610     C*
222840941219     C                   EXSR      INOLTR
222850941219     C                   MOVEL     WFIN          TASFIN
222860941219     C                   MOVEL     VIDCAD        TASCAD
222870991014     C                   MOVEL     VIDNZD        TASNZD
222880941219     C*
222890941219     C                   Z-ADD     V2CPKG        TASPKF
222900941219     C                   MOVEL     VIDLNP        TASLNP
222910941219     C                   MOVEL     SAVCTS        TASCTS
222920941219     C*
222930941219     C                   MOVEL     BLPDSP        TASDSP
222940970414     C                   MOVEL     BLPDSP        TASDCT
222950941219     C                   MOVEL     VARVOL        TASVLF
222960941219     C     VIDTSP        IFNE      *BLANKS
222970941219    1C                   MOVEL     VIDTSP        TASTSP
222980941219     C                   ELSE
222990941219     C* LO PRENDO DA TARIFFA
223000941219     C                   MOVEL     COMTSP        TASTSP
223010941219    1C                   ENDIF
223020941219     C* SE E' ANCORA VUOTO, IMPOSTO "C"
223030941219    1C     TASTSP        IFEQ      ' '
223040941219     C                   MOVEL     'C'           TASTSP
223050941219    1C                   ENDIF
223060980512     C     WBOL          IFEQ      '1'
223070980512     C                   MOVEL     §3ATB1        TASTBL
223080980512     C                   ELSE
223090980512     C                   MOVEL     §3ATB2        TASTBL
223100020503    1C                   ENDIF
223110941219     C*
223120950116     C* SOLO SE C/A SULLA 1 BOLLA
223130020503    1C     WBOL          IFEQ      '1'
223140980506     C     §3AFCA        ANDEQ     1
223150980506     C     WBOL          OREQ      '2'
223160980506     C     §3AFCA        ANDEQ     2
223170941219     C                   MOVEL     VIDCAS        TASCAS
223180941219     C                   MOVEL     VIDVCA        TASVCA
223190941219     C                   MOVEL     VIDTIC        TASTIC
223200020503    1C                   ENDIF
223210941219     C*
223220941219     C                   MOVEL     COMLNA        TASLNA
223230941219     C                   MOVEL     VIDNCL        TASNCL
223240040127      * passo il porto se sto tassando la prima bolla
223250040127     c                   If        wbol = '1'
223260941219     C                   MOVEL     VIDPOR        TASPOR
223270040127     c                   EndIf
223280941219     C                   MOVEL     VIDIAS        TASIAS
223290941219     C                   MOVEL     VIDVAS        TASVAS
223300941219     C                   MOVEL     VIDTC1        TASTC1
223310941219     C                   MOVEL     VIDTC2        TASTC2
223320941219     C                   MOVEL     VIDQFT        TASQFT
223330020503    1C     VIDBAM        IFEQ      'S'
223340970411     C                   MOVEL     'S'           TASDDT
223350020503    1C                   ENDIF
223360061002     c*vidfbr            movel     vidfbr        §tasflo
223370061002     c* Passo nella DTAS01 il blpfbr
223380061002     c                   clear                   dtas01
223390061002     c                   movel     vidfbr        §asfbr
223400130926     c***                if        wemdest<>*blanks
223410130926     c***                movel     'S'           §asemd
223420130926     c***                endif
223430130926     c                   clear                   w_emd
223440140424     c                   clear                   w_smp
223450130926     c* verifico presenza richiesta avviso mail merce partita
223460130926     c                   select
223470130926     c* manutenzione
223480130926     c                   when      *in12 and not *in15
223490130926     c                             and wmmp_ar5='S' and wemdest<>*blanks
223500130926     c                   eval      w_emd = 'S'
223510130926     c* conferma bolle da cliente
223520130926     c                   when      *in12 and *in15
223530130930     c                   if        wmmp='N'
223540130926     c                   eval      aggioAr8=' '
223550130926     c                   exsr      sr_gesar8
223560130926     c                   endif
223570130926     c                   if        wemdest<>*blanks  and
223580130930     c                             (wmmp<>'N' or w_allm='S')
223590130926     c                   eval      w_emd = 'S'
223600130926     c                   endif
223610130926     c                   endsl
223620140424     c                   if        wsms<>*blanks and wsmp='S'
223630140424     c                   eval      w_smp='S'
223640140424     c                   endif
223650140424     c
223660130926
223670130926     c                   select
223680140424     c                   when      w_emd='S' and w_smp=' '
223690130926     c                   eval      §asemd='S'
223700140424     c                   when      w_emd='S' and w_smp='S'
223710130926     c                   eval      §asemd='E'
223720140424     c                   when      w_smp='S'
223730130926     c                   eval      §asemd='X'
223740130926     c                   endsl
223741150107     c* PIN CODE
223742150107     c                   if        wpincode<>*blanks
223743150107     c                   eval      §aspin='S'
223744150107     c                   endif
223750130926     c
223760061002     c                   movel(P)  dtas01        §tasflo
223770941219     C* LEGGO IL SFL PER PRENDERE LE VARIE
223780980506     C* SOLO PER 1 BOLLA ESISTE TASSAZIONE COMPLETA
223790991007     C                   CLEAR                   DTASV
223800980506    1C     WBOL          IFEQ      '1'
223810941219     C                   Z-ADD     1             NRR
223820941219     C                   Z-ADD     1             C
223830941219     C*
223840980506    2C                   DO        20            NRR
223850941219     C     NRR           CHAIN     LS01S03                            30
223860941219     C*
223870980506    3C     *IN30         IFEQ      *OFF
223880020503     c* se devo tassare una specifica varia(da tabella 3A) e c'e' gia'
223890020503     c*  non richiamo la tassazione
223900020503     c                   if        §3asva<>*blanks and v3csv1=§3asva
223910020503     c                   eval      wtassa='N'
223920030623      * mi salvo l'importo della varia
223930030623     c                   eval      itassa=v3cva1
223940020503     c                   endif
223950030623     c* se esiste già la varia "D" non la ricalcolo
223960030623     c*
223970030623     c                   if        v3csv1='D'
223980030623     c                   eval      wtassad='N'
223990030623     c                   endif
224000030624      * SE ESISTE LA VARIA "&" CON TUTTI 8888888 NON LA PASSO AL TNSF20R
224010030624      * MA PASSO UN FLAG  DI RICHIESTA CALCOLO VARIA "&"
224020030624     C                   IF        V3CSV1 = '&' AND V3CVA1 = 88888888
224030030624     C                   EVAL      TASFCAA = 'S'
224040030624     C                   ELSE
224050941219     C                   MOVEL     V3CSV1        VSV(C)
224060991007     C                   Z-ADD     V3CVA1        VVA(C)
224070030624     c                   ENDIF
224080941219     C                   ADD       1             C
224090980506    3C                   ENDIF
224100980506    2C                   ENDDO
224110980506     C**
224120991019     C                   MOVEL     VIDDIV        TASDIV
224130991019     C**
224140980506     C** 2 BOLLA: IMPOSTO LA VARIA "G"
224150980506   X1C                   ELSE
224160991019     C                   MOVEL     VI2DIV        TASDIV
224170980608     C     VI2VA1        IFGT      0
224180980608     C                   MOVEL     VI2SV1        VSV(1)
224190991007     C                   Z-ADD     VI2VA1        VVA(1)
224200040121     c                   Movel     Vi2Es1        Ves(1)
224210980608     C                   ENDIF
224220040115     c                   If        Vi2Va2 > *Zeros
224230040115     c                   Movel     Vi2Sv2        Vsv(2)
224240040115     c                   Z-add     Vi2Va2        Vva(2)
224250040121     c                   Movel     Vi2Es2        Ves(2)
224260040115     c                   EndIf
224270040115     c                   If        Vi2Va3 > *Zeros
224280040115     c                   Movel     Vi2Sv3        Vsv(3)
224290040115     c                   Z-add     Vi2Va3        Vva(3)
224300040121     c                   Movel     Vi2Es3        Ves(3)
224310040115     c                   EndIf
224320040115     c                   If        Vi2Va4 > *Zeros
224330040115     c                   Movel     Vi2Sv4        Vsv(4)
224340040115     c                   Z-add     Vi2Va4        Vva(4)
224350040121     c                   Movel     Vi2Es4        Ves(4)
224360040115     c                   EndIf
224370041217     c                   If        Vi2Va5 > *Zeros
224380041217     c                   Movel     Vi2Sv5        Vsv(5)
224390041217     c                   Z-add     Vi2Va5        Vva(5)
224400041217     c                   Movel     Vi2Es5        Ves(5)
224410041217     c                   EndIf
224420041217     c                   If        Vi2Va6 > *Zeros
224430041217     c                   Movel     Vi2Sv6        Vsv(6)
224440041217     c                   Z-add     Vi2Va6        Vva(6)
224450041217     c                   Movel     Vi2Es6        Ves(6)
224460041217     c                   EndIf
224470980608     C                   MOVEL     'G'           TASSVA
224480040115     c                   Eval      TascVag = 'S'
224490980506    1C                   ENDIF
224500990915     C* MERCE PORTATA A MAGAZZINO DAL COD.AUTOTRASPORTATORE
224510990915     C*  PER I PREPAGATI LA RICHIESTA VIENE FATTA A VIDEO
224520990915     C     VIDPDR        IFLE      *ZEROS
224530990915     C     *IN22         ANDEQ     *ON
224540001024     C                   MOVEL     VIDMAG        TASFDN
224550990915     C                   ELSE
224560990915     C                   MOVEL     APDFCM        TASFDN
224570990915     C                   ENDIF
224580020220     c* se bolla in assegnato export faccio sempre pagare la varia U
224590020220     c     *in04         ifeq      *on
224600020220     c     A_§ogntw      ifeq      'EEX'
224610081008     c***  A_§ogntw      oreq      'EUP'
224620020220     c     A_§ogntw      oreq      'DPD'
224630020220     c     A_§ogntw      oreq      'FED'
224640020220     c                   clear                   tasfdn
224650020220     c                   endif
224660020220     c                   endif
224670941219     C*
224680970708     C                   MOVEL     MITCTS        TASMCT
224690021002     c**
224700030204
224710030204      * Bancali
224720030205If  1c                   If        %Subst(VidGva:1:1) ='B'
224730030204     c                   Eval      TasBan = VidNba + VidNb2
224740030205     c                   EndIf
224750030728      * Colli originali
224760030728If  1c                   If        %Subst(VidGva:1:1) ='O'
224770030728     c                   Eval      TasNcl = W03Cor
224780030728     c                   EndIf
224790030204
224800020503     c                   if        wtassa=' '
224810020503     c* se devo tassare solo una varia, da tipo bolla, la imposto
224820020503     c                   if        §3asva<>*blanks
224830020503     c                   eval      tassva=§3asva
224840020503     c                   endif
224850030623      *
224860030623     c                   endif
224870030623      * per prepagato passo al TNSF20R la varia  "D" e l'importo del dir.fat.
224880030623      * da sommare che prendo CNIND (INDSIN)
224890030623      *
224900030623     c                   if        *in34  or *in22
224910030623      * recupero le spese incasso
224920030623     c     kaco          chain     cnind00f
224930030623     c                   if        %found(cnind00f)
224940031007      * se diritto di fatturazione a zero con calcolo la varia D
224950031007     c                   if        indsin = 0
224960031007     c                   eval      wtassad='N'
224970031007      *
224980031007     c                   else
224990030623     c                   move      indsin        tasivdf
225000030623     c                   eval      tassvdf = 'D'
225010031007     c                   endif
225020031007      *
225030030623     c                   endif
225040030623      *
225050030623     c                   if        wtassa='N' and wtassad = ' '
225060030623     c* se ho già tassata la singola varia devo sommare il solo diritto di fattu
225070030623     c* maggiore di zero oppure se imponibile a zero ho la singola varia valoriz
225080030623     c                   if        tasimv > 0  or (tasimv = 0 and itassa > 0)
225090030623     c                   eval      tassva='D'
225100030623     c                   else
225110030623     c                   eval      wtassad = 'N'
225120030623     c                   endif
225130030623     c                   endif
225140030623     c**
225150030623     c                   if        wtassa = 'N' and wtassad = 'N'
225160030623     c                   goto      endtas
225170030623     c                   endif
225180040115      * no prepagato
225190040115     c                   Else
225200040115     c                   if        wtassa = 'N'
225210040115     c                   goto      endtas
225220040115     c                   endif
225230040115     c                   endif
225240030623     c*
225250990701     C                   CLEAR                   WFIAS
225260990701     C                   MOVEL     PARAMF        KPJBU
225270991014      *
225280941219     C                   CALL      'TNSF20R'
225290941221     C                   PARM                    KPJBA
225300991007     C                   PARM                    DTAS
225310991007     C                   PARM                    DTASV
225320941219     C*
225330941219     C                   Z-ADD     0             NRR
225340941219     C                   Z-ADD     1             C
225350991014      *
225360991014      * PRIMA BOLLA
225370980506    1C     WBOL          IFEQ      '1'
225380991014     C* IMPOSTO LE VARIE
225390941219    2C                   DO        20            C
225400991027     C                   MOVEL     VSV(C)        WSVN
225410991027     C                   Z-ADD     VVA(C)        WVAN
225420941219     C                   MOVEL     VES(C)        WEV1
225430941219     C                   EXSR      CARVAR
225440941219    2C                   ENDDO
225450991025     C*
225460991025     C                   ADD       1             NRR
225470991025     C     NRR           DO        20            NRR
225480991025     C     NRR           CHAIN     LS01S03                            30
225490991025     C                   CLEAR                   V3CSV1
225500991025     C                   CLEAR                   V3CVA1
225510991025     C                   CLEAR                   V3HVA1
225520991025     C                   CLEAR                   V3CEV1
225530991025     C   30              WRITE     LS01S03
225540991025     C  N30              UPDATE    LS01S03
225550991025     C                   ENDDO
225560930415     C*
225570980506    2C     TASERR        IFEQ      *BLANKS
225580901031     C                   MOVEL     TASPOR        VIDPOR
225590991015     C                   MOVEL     TASPOR        MEMPOR
225600950220     C                   Z-ADD     TASQFT        VIDQFT
225610991014     C                   MOVEL     TASIMV        VIDIMV
225620991015     C                   MOVEL     TASDIV        VIDDIV
225630991015     C                   MOVEL     TASDIV        WDIV1
225640991015      *
225650991015   X2C                   ELSE
225660991015     C     TASMSG        IFEQ      *BLANKS
225670991015     C                   MOVEL     ERR(104)      VIDMSG
225680991015     C                   ELSE
225690991015     C                   MOVEL(P)  TASMSG        VIDMSG
225700991015     C                   ENDIF
225710991015     C                   SETON                                        9052
225720991015    2C                   ENDIF
225730991014      *
225740991014      * 2 BOLLA
225750980506   X1C                   ELSE
225760040115     c                   Clear                   ContaSv
225770040115      * carico le varie
225780040115Do  2c                   Do        20            c
225790040115If  3c                   If        Vsv(c) <> §$2Iva and
225800040115     c                             Vsv(c) <> §$2Bol
225810040115     c                   Add       1             ContaSv
225820040115S   4c                   Select
225830040115     c                   When      ContaSv = 1
225840040115     c                   Movel     Vsv(c)        Vi2Sv1
225850040115     c                   Z-add     Vva(c)        Vi2Va1
225860040121     c                   Movel     Ves(c)        Vi2Es1
225870040115     c                   When      ContaSv = 2
225880040115     c                   Movel     Vsv(c)        Vi2Sv2
225890040115     c                   Z-add     Vva(c)        Vi2Va2
225900040121     c                   Movel     Ves(c)        Vi2Es2
225910040115     c                   When      ContaSv = 3
225920040115     c                   Movel     Vsv(c)        Vi2Sv3
225930040115     c                   Z-add     Vva(c)        Vi2Va3
225940040121     c                   Movel     Ves(c)        Vi2Es3
225950040115     c                   When      ContaSv = 4
225960040115     c                   Movel     Vsv(c)        Vi2Sv4
225970040115     c                   Z-add     Vva(c)        Vi2Va4
225980040121     c                   Movel     Ves(c)        Vi2Es4
225990041217     c                   When      ContaSv = 5
226000041217     c                   Movel     Vsv(c)        Vi2Sv5
226010041217     c                   Z-add     Vva(c)        Vi2Va5
226020041217     c                   Movel     Ves(c)        Vi2Es5
226030041217     c                   When      ContaSv = 6
226040041217     c                   Movel     Vsv(c)        Vi2Sv6
226050041217     c                   Z-add     Vva(c)        Vi2Va6
226060041217     c                   Movel     Ves(c)        Vi2Es6
226070040115    4c                   EndSl
226080040115    3c                   EndIf
226090040115    2c                   EndDo
226100991014      *
2261109806080   2C     TASERR        IFEQ      ' '
226120040115     C                   MOVEL     TASDIV        VI2DIV
226130040115     C                   MOVEL     TASDIV        WDIV2
226140040126     c                   Movel     TasImv        Vi2Imv
226150980506     C**
226160980506   X2C                   ELSE
226170980506     C* MANCA TARIFFA
226180980608     C     TASMSG        IFEQ      *BLANKS
226190980506     C                   MOVEL     ERR(104)      VIDMSG
226200980608     C                   ELSE
226210980608     C                   MOVEL(P)  TASMSG        VIDMSG
226220980608     C                   ENDIF
226230980506     C                   SETON                                        9041
226240980506    2C                   ENDIF
226250980506    1C                   ENDIF
226260990610    0C                   ENDIF
226270940923     C*
226280940919     C     ENDTAS        ENDSR
226290990630     C*
226300990630     C* CALCOLO IL TOTALE FATTURA ------------------------------------*
226310990630     C     TOTFAT        BEGSR
226320991014      *
226330991015      *  RECUPERO L'ARROTONDAMENTO
226340991102     C                   CLEAR                   DSBS02
226350991102     C                   MOVEL     'C'           T02MOD
226360991102     C                   MOVEL     KNSIF         T02SIF
226370991102     C                   MOVEL     'GEI'         T02COD
226380991102     C                   MOVEL     VIDDIV        T02KE1
226390991102      *
226400991102     C                   CALL      'TIBS02R'
226410991102     C                   PARM                    KPJBA
226420991102     C                   PARM                    DSBS02
226430991102      *
226440991102     C     T02ERR        IFEQ      *BLANKS
226450991102     C                   MOVEL     T02UNI        DGEI
226460991102     C                   ELSE
226470991102     C                   CLEAR                   DGEI
226480991102     C                   ENDIF
226490991015      *
226500990630     C     VIDIMV        IFGT      0
226510991014     C                   CLEAR                   DSLV04
226520990630     C                   Z-ADD     COMDFT        D04DFT
226530991014     C                   Z-ADD     VIDIMV        D04IMV
226540991014     C                   MOVEL     VIDDIV        D04DIV
226550990630     C                   MOVEL     VIDCEI        D04CEI
226560991014     C                   MOVEL     VIDTIC        D04TIC
226570990630     C                   Z-ADD     VIDCAS        D04CAS
226580990630     C                   MOVEL     VIDVCA        D04VCA
226590990630     C                   Z-ADD     VIDPOR        D04POR
226600990701     C     *IN22         IFEQ      *ON
226610991015     C                   MOVEL     §GEAED        D04AED
226620991015     C                   Z-ADD     §GEAVL        D04VAR
226630990701     C                   ENDIF
226640991014     C     *IN04         IFEQ      *ON
226650991014     C                   MOVEL     '1'           D04SPE
226660991014     C                   ELSE
226670991014     C                   MOVEL     '8'           D04SPE
226680991014     C                   ENDIF
226690991014     C                   MOVEL     §3ATB1        D04TBL
226700991014      *
226710991014     C                   CALL      'FNLV04R'
226720991014     C                   PARM                    DSLV04
226730991007     C                   PARM                    DTASV
226740990630     C                   ENDIF
226750991014      *
226760990630     C                   ENDSR
226770930915     C*
226780930915     C* ANNULLAMENTO BOLLA -------------------------------------------*
226790930915     C     ANNULL        BEGSR
226800930915     C                   SETOFF                                       90
226810060307     C                   clear                   wf12              1
226820970408     C* NON POSSO ANNULLARE MAI UNA BOLLA LEGATA
226830940915     C     KBLP3         CHAIN     FNLBL01L                           30
226840930915     C*
226850930915    1C     *IN30         IFEQ      *OFF
226860941020     C                   MOVEL     ERR(65)       VIDMSG
226870941020     C                   SETON                                        90
226880970408    1C                   ENDIF
226890040614     c* Non posso annullare mai una bolla £ se lnp=lna
226900040611     C  N90BLPCBO        ifeq      '£ '
226910040611     C     BLPLNP        ANDeq     BLPLNA
226920040611     C                   MOVEL     ERR(282)      VIDMSG
226930040611     C                   SETON                                        90
226940040611     c                   endif
226950061127     c* Non posso annullare bolla con C.A.
226951141202     c                   if        not *in90
226960061127     c                   clear                   fidn12ds
226970061127     c                   eval      dn_i12aas = §LPAAS
226980061127     c                   eval      dn_i12lnp = §LPLNP
226990061127     c                   eval      dn_i12nrs = §LPNRS
227000061127     c                   eval      dn_i12nsp = §LPNSP
227010061127     c                   eval      dn_i12fel = 'E'
227020061127     c                   eval      dn_i12fan = 'E'
227030061127     c                   call      'FIDN12R'
227040061127     c                   parm                    fidn12ds
227050061127     c* se numero di CA trovate maggiore di zero
227060061127     c                   if        dn_o12nca > 0
227070061127     C                   MOVEL     ERR(310)      VIDMSG
227080061127     C                   SETON                                        90
227090061127     c                   endif
227091141202     c                   endif
227100110321     c* avviso se sono presenti spunte entrata
227101141202     c                   if        not *in90
227110110321     c                   if        wforzbrv=*off
227120110321     c                   eval      wcheck=*on
227130110321     c                   exsr      sr_gesbranm
227140110321     c                   if        *in90
227150110321     C                   MOVEL     ERR(336)      VIDMSG
227160110321     c                   endif
227170110321     c                   eval      wforzbrv=*on
227180110321     c                   endif
227181141202     c                   endif
227190060210     c* ANNULLAMENTO DI UN PREPAGATO
227200060210     c* verifico se in caso di annullamento prepagati devo richiedere
227210060210     c* la motivazione
227220060308     c                   movel     'KM'          wcvb
227230060308     c                   exsr      cls_lv85
227240060210     c                   clear                   ilv85cvb
227250070514     c**n90              if        *in22 = *ON and dateu >= §vpogpp
227260070514     c  n90              if        *in22 = *ON
227270060213     c*  Prima di tutto controllo che il prepagato non sia già stato incassa
227280060213     c*  to
227290060213     c                   exsr      sr_callycow
227300060213     c                   if        prmesito <> 0
227310060213     C                   MOVEL     ERR(297)      VIDMSG
227320060213     C                   SETON                                        90
227330060213     c                   else
227340110419     c*  Poi controllo che l'ORM non sia in distinta
227350110419     c                   if        ormndc>0
227360110419     c                   seton                                        90
227370110419     c*        errore: ORM già ritirato
227380110419     c                   if        ormfao=600
227390110419     C                   MOVEL     ERR(337)      VIDMSG
227400110419     c                   else
227410110419     c*        errore: per annullare togliere l'orm dalla distinta
227420110419     C                   MOVEL     ERR(338)      VIDMSG
227430110419     c                   endif
227440110419     c                   else
227450060227     c                   movel     '7L'          cod
227460060227     C                   MOVEL(P)  'KM'          KEY
227470060227     C                   EXSR      CTABEL
227480060227     C                   MOVEL     TBLUNI        DS7L
227490060227     c                   if        §7lmtv = 'S'
227500060210     c                   clear                   fnlv85ds
227510060210     c                   eval      ilv85cvb = 'KM'
227520060210     c                   eval      ilv85tel = 'V'
227530060309     c                   z-add     5             ilv85row
227540060210     c                   movel     fnlv85ds      kpjbu
227550060210     c                   call      'FNLV85R'
227560060210     c                   parm                    kpjba
227570060227     c*****              parm                    ds7l
227580060210     c                   movel     kpjbu         fnlv85ds
227590060210     c* F12=Ritorno --> riemetto formato 01
227600060210     c                   if        olv85f12 = '1'
227610060307     c                   eval      wf12   = '1'
227620060307     c                   goto      fannull
227630060210     c                   endif
227640060227     c                   endif
227650060213     c                   endif
227660060210     c                   endif
227670110419     c                   endif
227680060125
227690060125      * Richiamo il pgm per annullare l'ORM legato alla bolla RC
227700100604     c***                If        blpgma = 'RC'
227710110321     c  n90              If        w7rRC  = 'S'
227720060125     c                   Clear                   fnls25ds
227730060125     c                   If        blpccm > *Zeros
227740060125     c                   Eval      i25Ksc = blpccm
227750060125     c                   Else
227760060125     c                   Eval      i25ksc = blpksc
227770060125     c                   EndIf
227780060125     c                   Move      blpaas        i25aas
227790060125     c                   Eval      i25spe = %editc(blplnp:'X') +
227800060125     c                                      %editc(blpnrs:'X') +
227810060125     c                                      %editc(blpnsp:'X')
227820060125     c                   Call      'FNLS25R'
227830060125     c                   Parm                    Fnls25ds
227840060125     c                   EndIf
227850061122     c* se annullamento di un prepagato richiamo il seguente pgm per
227860061122     c* chiudere l'orm. No considero eventuali errori ricevuti dal
227870061122     c* pgm in quanto ininfluenti per questa operazione
227880070627     c  n90              if        *in22=*on and S_§b4fit<>*all'9'
227890061122     c                   clear                   fior51ds
227900061122     c                   z-add     s_§b4poe      i51poe
227910061122     c                   z-add     s_§b4nsr      I51NSR
227920061122     c                   z-add     s_§b4nor      I51NOR
227930061122     c                   z-add     s_§b4nrv      I51NRV
227940061122     c                   z-add     999           i51far
227950061122     c                   movel     '80'          i51car
227960061122     c                   call      'FIOR51R'
227970061122     c                   parm                    fior51ds
227980061122     c                   endif
227990060125
228000970408     C****
228010930915     C* CANCELLAZIONE FISICA FILES
228020930915     C  N90              EXSR      DELBLP
228030941020     C* PASSO NEL FALG PROVENIENZA '1' PER INDICARE CHE LA BOLLA E'
228040941011     C*  STATA ANNULLATA
228050941020     C                   MOVEL     '1'           §LPFPR
228060930915     C*
228070060307     C     fannull       ENDSR
228080901031     C*
228090930915     C*--- CANCELLAZIONE FISICA BOLLA IN TUTTI I SUOI FILES ----------*
228100930915     C     DELBLP        BEGSR
228110950410     C*
228120930915     C* SCRIVO RECORD IN FLBLA
228130070514     c***                if        *in22 = *off or dateu < §vpogpp
228140070514     c                   if        *in22 = *off
228150900511     C                   MOVEL     BLPLNP        BLALNP
228160900511     C                   MOVEL     BLPAAS        BLAAAS
228170900511     C                   MOVEL     BLPMGS        BLAMGS
228180900511     C                   MOVEL     BLPNRS        BLANRS
228190900511     C                   MOVEL     BLPNSP        BLANSP
228200900511     C                   MOVEL     BLPLNA        BLALNA
228210080904     C                   MOVEL     §3atb1        BLATBL
228220900511     C                   MOVEL     DATEU         BLADAN
228230080904     C                   MOVEL     simfel        BLAfle
228240110411     C                   MOVEL     blpcbo        BLAcbo
228250110411     c                   time                    blaoan
228260110411     c                   movel     knmus         blapru
228270110411     c                   movel     knmtd         blamtd
228280110411     c                   if        blpccm>0
228290110411     c                   z-add     blpccm        blaccm
228300110411     c                   else
228310110411     c                   if        not *in04
228320110411     c                   z-add     blpksc        blaccm
228330110411     c                   endif
228340110411     c                   endif
228350110411     c                   z-add     blprmn        blarmn
228360110411     c                   movel     blprma        blarma
228370110411     c                   movel     blprsm        blarsm
228380110411     c                   movel     blpinm        blainm
228390110411     c                   movel     blpcam        blacam
228400110411     c                   movel     blplom        blalom
228410110411     c                   movel     blpprm        blaprm
228420110411     c                   movel     blpnzm        blanzm
228430110411     c                   movel     blprsd        blarsd
228440110411     c                   movel     blpcad        blacad
228450110411     c                   movel     blplod        blalod
228460110411     c                   movel     blpprd        blaprd
228470110411     c                   movel     blpnzd        blanzd
228480110411     c                   movel     blpctm        blactm
228490110411     c                   z-add     blpncl        blancl
228500110411     c                   z-add     blppkb        blapkb
228510110411     c                   z-add     blpfls        blafls
228520110411     c                   z-add     blpncd        blancd
228530110411     c                   z-add     blpnca        blanca
228540080904     C                   WRITE     TNBLA000
228550060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
228560060210     c* anomalie
228570110321     c                   eval      wcheck=*off
228580060210     c                   exsr      sr_gesbranm
228590060210     c                   endif
228600060210     C* DISALLOCAZIONE FILES
228610001130      *
228620061212     C                   UNLOCK    FNBLP00F
228630051115     C                   UNLOCK    Fiar901L
228640001211     C                   UNLOCK    FIAR601L
228650001211     C                   UNLOCK    FIAR701L
228660060215     C                   UNLOCK    Fiar401L
228670001211     C                   UNLOCK    FNBLT01L
228680051102     C                   UNLOCK    FIARS01L
228690120814     C                   UNLOCK    FIART01L
228700060210     c*
228710070514     c* OPERAZIONI PER PREPAGATI
228720070514     c****               if        *in22 = *on and dateu >= §vpogpp
228730070514     c                   if        *in22 = *on
228740060210     c* richiamo fnlr48r per storicizzare la variazione
228750060210     c* ed effettuare altri eventuali aggiornamenti su file contrassegni
228760060210     c* e tassazione seconda bolla. L'aggiornamento della testata bolla
228770060210     c* viene effettuato in questo pgm al compimento di tutti gli aggiornam.
228780060303     c                   clear                   fnlr48ds
228790060210     C                   MOVEL     'L'           D48TLA
228800060210     C                   z-add     blplnp        D48FGS
228810060210     C                   z-add     blpaas        D48AAS
228820060210     C                   MOVE      blpLNP        D48LNP
228830060210     C                   MOVE      blpNRS        D48NRS
228840060210     C                   MOVE      blpNSP        D48NSP
228850060210     C                   MOVE      blpcbo        D48CBO
228860060210     C                   MOVEL     'KM'          D48CVB
228870060210     C                   MOVEL     'K'           D48TRC
228880060210     C                   MOVEL     'E'           D48FFR
228890060210     C                   MOVEL     ' '           D48ERR
228900060210     C                   MOVEL     *BLANK        D48MSG
228910060210     C                   MOVEL     'P'           D48TBO
228920060303     c                   movel     'N'           d48mct
228930060307     c                   eval      d48mtv = olv85mtv
228940060307     c                   movel     olv85nt1      d48not
228950060307     c                   move      olv85nt2      d48not
228960060210     c                   clear                   dsarbk
228970060210     C                   MOVEL     'M'           §BKcbn
228980060210     C                   MOVEL     fnlr48ds      KPJBU
228990060210     C                   CALL      'FNLR48R'
229000060210     C                   PARM                    KPJBA
229010060210     C                   PARM                    DSARBD
229020060210     C                   PARM                    DSARBK
229030060210     C                   PARM                    DARBT
229040060210     C                   PARM                    DSARBG
229050060210     C                   PARM                    trul90ds
229060060210     C                   MOVEL     KPJBU         fnlr48ds
229070060210     C     D48ERR        IFne      *BLANK
229080060210     c                   seton                                        90
229090060213     c                   movel     D48msg        vidmsg
229100060210     c                   goto      e_del
229110060210     C                   END
229120060210     c* rialloco fnblp
229130061218     C     savnrr        CHAIN     FNBLP000                           90
229140060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
229150060210     c* anomalie
229160110321     c                   eval      wcheck=*off
229170060210     c                   exsr      sr_gesbranm
229180060210     c                   endif
229190001211     C*
229200060210     C* RICHIAMO PROGRAMMA DI CANCELLAZIONE
229210060210     C*
229220001130     C                   MOVE      KPJBU         WA256           256
229230001130     C                   CLEAR                   DSLS63
229240060213     c* se è un prepagato lo richiamo in modalità "P" per cancellare solo
229250060213     c* il dettaglio colli e suoi file legati
229260070514     c****               if        *in22 = *on and dateu >= §vpogpp
229270070514     c                   if        *in22 = *on
229280060210     c                   movel     'P'           i63mod
229290060210     c                   endif
229300001130     C                   MOVE      BLPAAS        I63AAS
229310001130     C                   MOVE      BLPLNP        I63LNP
229320001130     C                   MOVE      BLPNRS        I63NRS
229330001130     C                   MOVE      BLPNSP        I63NSP
229340001130     C                   MOVEL     DSLS63        KPJBU
229350001130     C                   CALL      'FNLS63R'
229360001130     C                   PARM                    KPJBA
229370001130     C                   MOVE      WA256         KPJBU
229380081020     c                   clear                   trtc86drds
229390081020     c* richiamo pgm per cancellare eventuali record su firab
229400081020     c                   eval      i86mod='DC'
229410081020     c                   z-add     blpaas        i86aasb
229420081020     c                   z-add     blplnp        i86lnpb
229430081020     c                   z-add     blpnrs        i86nrsb
229440081020     c                   z-add     blpnsp        i86nspb
229450081020     c                   call      'TRTC86DRR'
229460081020     c                   parm                    trtc86drds
229470060210     c*
229480070514     c* OPERAZIONI PER PREPAGATI
229490070514     c****               if        *in22 = *on and dateu >= §vpogpp
229500070514     c                   if        *in22 = *on
229510060210     C                   exsr      sr_aggblp
229520060210     c                   endif
229530910807     C*
229540060210     C     e_del         ENDSR
229550060210     C*--- Operazioni su spunte e anomalie a fronte di f16=Annullam --*
229560060210     C     sr_gesbranm   BEGSR
229570060210     C* LEGGO FNBLT SE ESISTE
229580060210     C                   MOVEL     5             KNPG
229590060210     C                   MOVEL     SIMFEL        KFLE
229600060210     C*
229610120817     C***  KBLP3         SETLL     FNBLT000                               30
229620120817     C     KBLP3         SETLL     FIART000                               30
229630060210    1C     *IN30         IFEQ      *ON
229640120817     C***  KBLP3         READE(N)  FNBLT000                               30
229650120817     C     KBLP3         READE(N)  FIART000                               30
229660060210    2C     *IN30         DOWEQ     *OFF
229670110321   2ac                   if        wcheck=*on
229680120817     C***  KBRV          setll     FNBRV000
229690120817     C     KBRVA         setll     FNBRV000
229700110321     c                   if        %equal(fnbrv09l)
229710110321     c                   seton                                        90
229720110321     c                   leavesr
229730110321     c                   endif
229740110321  x2ac                   else
229750060210     C* SPUNTE ENTRATA
229760120817     C***  KBRV          CHAIN     FNBRV000                           31
229770120817     C     KBRVA         CHAIN     FNBRV000                           31
229780060210    3C     *IN31         DOWEQ     *OFF
229790060210     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
229800060210     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
229810060210     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
229820060210     c* no anomalie da cancellare create a fronte della spunta entrata
229830060210     c**                 z-add     brvnfv        wrvnfv
229840060210     c**                 movel     param2        kpjbu
229850060210     C**                 CALL      'FNLSA8R'
229860060210     C**                 PARM                    KPJBA
229870070123     C                   DELETE    FNBRV000
229880120817     C***  KBRV          READE     FNBRV000                               31
229890120817     C     KBRVA         READE     FNBRV000                               31
229900060210    3C                   ENDDO
229910060210     c* se presenti anomalie con key segnacollo aventi anche la spedizione
229920060210     C* le aggiorno togliendo i dati della spedizione se invece si tratta
229930060210     c* di anomalie  con key spedizione aventi anche il segnacollo le deleto
229940060210     c     kanm2         setll     fnanm02l
229950060210    3c                   do        *hival
229960060210     c     kanm2         reade     fnanm02l
229970060210    4c                   if        %eof(fnanm02l)
229980060210     c                   leave
229990060210    4c                   endif
230000060210     c                   movel     '7C'          cod
230010060210     c                   movel(p)  anmcaa        key
230020060210     C                   EXSR      CTABEL
230030060210     C                   MOVEL     TBLUNI        DS7C
230040060210    4c                   if        §7ckey = 'S'
230050060210     c                   clear                   anmaas
230060060210     c                   clear                   anmlnp
230070060210     c                   clear                   anmnsp
230080060210     c                   update    fnanm000
230090060210   x4c                   else
230100060210     c                   delete    fnanm000
230110060210    4c                   endif
230120060210    3c                   enddo
230130060210     C*
230140110321   2ac                   endif
230150110321     c*
230160120817     C***  KBLP3         READE(N)  FNBLT000                               30
230170120817     C     KBLP3         READE(N)  FIART000                               30
230180060210    2C                   ENDDO
230190060210    1C                   ENDIF
230200060210     c* leggo eventuali anomalie rimaste con key spedizione e se ce ne sono
230210060210     c* le deleto
230220110321     c                   if        wcheck=*off
230230060210     c     kanm1         setll     fnanm01l
230240060210    1c                   do        *hival
230250060210     c     kanm1         reade     fnanm01l
230260060210     c                   if        %eof(fnanm01l)
230270060210     c                   leave
230280060210     c                   endif
230290060210     c                   delete    fnanm01
230300060210    1c                   enddo
230310110321     c                   endif
230320060210     c                   endsr
230330060210     C*--- Operazioni aggiornamento fnblp  a fronte di f16 su prepagato
230340060210     C     sr_aggblp     BEGSR
230350060210     c                   z-add     dateu         blpdrt
230360060210     c                   z-add     999           blppdr
230370060210     C                   eval      BLPFPP = 'P'
230380060214     c                   movel     'N'           blpft1
230390060214     c                   movel     'N'           blpft2
230400060210     C                   MOVEL     *ALL'9'       BLPNFV
230410060210     C                   MOVEL     '4 '          BLPctm
230420060210     c                   movel     'M '          blpcbo
230430060303     c* azzero importo da assicurare altrimenti in ricezione bolle in sede
230440060303     c* scrive fiar4 trk "c" e fiarbt0e
230450060303     c                   clear                   blpias
230460060303     c                   clear                   blpvas
230470060210     c                   update    fnblp000
230480060210     c                   endsr
230490900824     C*
230500900824     C*--- CARICO RECORD BOLEL DA DISK CLIENTI -----------------------*
230510900824     C     CARBLC        BEGSR
230520100319     c                   clear                   WesORE            1
230530100319     c                   clear                   DoreGEN
230540140122     C***                CLEAR                   DSBL4J
230550980115     C                   MOVEL     CMAIUS        MA               26
230560980115     C                   MOVEL     CMINUS        MI               26
230570000124     C* SPIEGO IL SIGNIFICATO DEL FLAG §LPFPR:
230580950419     C* - SE "V" - VISUALIZZO SEMPRE LA BOLLA CHE CONFERMO
230590950419     C* - SE "X" - VISUALIZZO SOLO SE C'E' ERRORE
230600950419     C* - SE "W" - NON VISUALIZZO MAI MA PASSO CODICE DI ERRORE
230610950419     C*
230620930630     C                   MOVEL     *OFF          *INKL
230630930630     C                   MOVEL     *OFF          *INKC
230640930630     C                   MOVEL     *OFF          *INKI
230650930630     C                   MOVEL     *OFF          *INKF
230660940927     C*
230670940921     C                   Z-ADD     0             WKSC
230680091221     c                   clear                   wvidgma
230690100604     c                   clear                   w7rRC
230691141202     c                   clear                   w7rPC
230700940927     C* D A T E
230710910702     C* DATA SPEDIZIONE
230720940926     C                   Z-ADD     §LPMGS        BLPDSP
230730940926     C                   MOVEL     §LPAAS        BLPDSP
230740970512     C*
230750970512     C* LA LINEA DI PARTENZA E' QUELLA DEL CODICE AUTOTRASP.
230760970512     C                   MOVEL     §LPPDR        VIDLNP
230770971216     C     VIDLNP        IFNE      BLCLNP
230780971216     C                   Z-ADD     VIDLNP        W0030
230790971216     C     W0030         CHAIN     AZORG01L      UNIORG               30
230800000508     C                   MOVEL     ORGDE3        OG143
230810971216     C                   MOVEL     VIDLNP        BLCLNP
230820971216     C                   ENDIF
230830941011     C*
230840940927     C* DATA CONSEGNA RICHIESTA
230850940927     C                   Z-ADD     §LPDCR        VIDDCR
230860941011     C* SIGLA OPERATORE VIDEO
230870941011     C                   MOVEL     §LPSOP        VIDSOP
230880960926     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
230890941011     C                   Z-ADD     §LPDRT        VIDDRT
230900940927     C                   MOVEL     §LPNRT        VIDNRT
230910940927     C                   MOVEL     §LPFPP        VIDFPP
230920010220     C                   MOVEL     §LPFPP        PREFPP
230930900824     C*
230940941011     C                   MOVEL     §LPPDR        W0030
230950960927     C     W0030         IFNE      VIDLNP
230960941011     C                   CLEAR                   VIDPDR
230970010220     C                   CLEAR                   PREPDR
230980941011     C                   ELSE
230990941011     C                   MOVE      §LPPDR        VIDPDR
231000010220     C                   MOVE      §LPPDR        PREPDR
231010941011     C                   ENDIF
231020010212     C* NUMERO O.R.M.
231030010220     C* SE RICHIAMATO DA PGM GIACENZE IMPOSTO NUMERO ORM FITTIZIO
231040020522     c* idem se richiamato da pgm ritiri annullati
231050010220     C     §LPFPR        IFEQ      'G'
231060010220     C     §LPFPR        OREQ      'I'
231070010220     C     §LPFPR        OREQ      'P'
231080020522     C     §LPFPR        OREQ      'T'
231090010220     C                   MOVEL     §LPPDR        W0030             3 0
231100010220     C     W0030         CHAIN     AZORG01L      UNIORG               30
231110010220     C  N30              MOVEL     ORGDE8        OG148
231120010220     C   30              CLEAR                   OG148
231130060926     c* faccio finta che abbia sempre la procedura ORM attiva
231140060926     c                   eval      §ogorm='S'
231150060926     c
231160010220     C     §OGORM        IFEQ      'S'
231170010220     C                   MOVEL     §LPPDR        VIDPOE
231180010220     C                   MOVE      *ALL'9'       VIDNOR
231190010220     C                   MOVE      *ALL'9'       VIDNRV
231200010220     C                   ELSE
231210010220     C                   MOVE      *ZEROS        VIDPOE
231220010220     C                   MOVE      *ZEROS        VIDNOR
231230010220     C                   MOVE      *ZEROS        VIDNRV
231240010220     C                   ENDIF
231250011126     C                   CLEAR                   ATRDES
231260010220     C                   ELSE
231270010212     C                   Z-ADD     §LPPOE        VIDPOE
231280010222     C                   MOVEL     §LPNSR        VIDNOR
231290010222     C                   MOVE      §LPNOR        VIDNOR
231300010212     C                   Z-ADD     §LPNRV        VIDNRV
231310011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
231320011126     C                   Z-ADD     VIDPOE        WOPOE
231330011126     C                   Z-ADD     VIDNOR        WONOR
231340011126     C                   Z-ADD     VIDNRV        WONRV
231350011126     C                   Z-ADD     VIDLNP        WOLNP
231360011126     C                   CLEAR                   DORM01
231370011126     C     KORM          CHAIN     FNORM01L                           30
231380011126     C  N30              MOVEL     ORMFLO        DORM01
231390011126     C     §ORMFD        IFEQ      'S'
231400011126     C                   MOVEL     PROT          ATRDES
231410011126     C                   ELSE
231420011126     C                   CLEAR                   ATRDES
231430011126     C                   ENDIF
231440111209     c* se sull'orm sono presenti le note le visualizzo subito
231450111209     c                   if        not *in30 and
231460111209     c                             (ormno1<> *blanks or ormno2<>*blanks)
231470111209     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
231480120127     c                   movel     ormno1        vidno1
231490120127     c                   movel     ormno2        vidno2
231500120127     c                   movel     'NoteOrm'     viddno
231510111209     c                   endif
231520010220     C                   ENDIF
231530100319     c
231540010212     C                   MOVEL     VIDORM        W01ORM
231550940927     C* CODICE BOLLA
231560940926     C                   MOVEL     §LPCBO        VIDCBO
231570940929     C* PARTITA IVA
231580940929     C                   MOVEL     §LPCPI        WPIVA
231590011206     C*
231600011206     C* IMPOSTO IL CODICE CLIENTE MITTENTE
231610011206     C                   MOVE      §LPCCN        WKSC
231620011206     C                   MOVE      §LPCCN        VIDCCM
231630011206     C                   MOVE      §LPCCN        WCCMS
231640011206     C                   MOVEL     §LPCCN        W0030
231650011206     C* CODICE TRATTAMENTO MERCE
231660011206     C                   MOVEL     §LPCTM        VIDCTM
231670011206     C                   MOVEL     VIDCTM        WCTM
231680011206     C                   EXSR      CTRCTM
231690011206     C* SE TROVATO ERRORE DOPO LO FACCIO RICONTROLLARE
231700011206     C     *IN90         IFEQ      *ON
231710120903     c     vidctm        oreq      *blanks
231720011206     C                   SETOFF                                       90
231730011206     C                   CLEAR                   SAVCTM
231740011206     C                   CLEAR                   DS1B
231750011206     C                   ENDIF
231760940927     C* LINEA ARRIVO
231770020621     C     §1BFG1        IFeq      'S'
231780140506     C     §1BF12        andne     'B'
231790020320     c     §1bf14        oreq      'S'
231800140506     C     §1BF12        andne     'B'
231810980126     C     §LPFPR        OREQ      'G'
231820980126     C     §LPFPR        OREQ      'P'
231830980126     C     §LPFPR        OREQ      'I'
231840011206     C* SE DISK "C" EX DISK "B" LNA E ZNC DEVONO RIMANERE = 0
231850140506     C***  §1BF12        IFNE      'B'
231860911031     C                   MOVEL     §LPLNA        VIDLNA
231870980126     C                   MOVEL     §LPZNC        VIDZNC
231880140506     C***                ENDIF
231890980126     C                   ENDIF
231900970512     C*
231910970512     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
231920970512     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
231930970512     C     W0030         IFNE      VIDLNP
231940970512     C                   SETON                                        1438
231950970512     C                   MOVEL     W0030         VIDFLC
231960970512     C                   ENDIF
231970940929     C* DATI FATTURA
231980940929     C                   MOVEL     §LPCEI        VIDCEI
231990940929     C                   MOVEL     §LPNFT        VIDNFT
232000940929     C                   MOVEL     §LPFIV        VIDFIV
232010940929     C                   Z-ADD     §LPDFT        VIDDFT
232020080327     C* TIPO SERVIZIO: lo carichiamo solo se inseribile dal bollettista/clie
232030080327     C                   MOVEL     §LPTSP        VIDTSP
232040080327     C                   Z-ADD     1             C
232050080327     C     vidtsp        LOOKUP    TSP(C)                                 30
232060080327     c                   if        not *in30 or uts(C)<>'S'
232070080327     c                   clear                   vidtsp
232080080327     c                   endif
232090080327     c
232100941115     C* CONSEGNE PARTICOLARI
232110941115     C                   MOVEL     §LPTC1        VIDTC1
232120941115     C                   MOVEL     §LPTC2        VIDTC2
232130091001     C                   MOVEL     §LPTC1        sav_tc1
232140091001     C                   MOVEL     §LPTC2        sav_tc2
232150091001     c                   clear                   w_ar5tcp
232160940929     C*
232170940929     C* D E C O D I F I C H E   BOLLA
232180940927     C                   EXSR      DECBOL
232190030303
232200030303      * Controllo se proteggere o meno il campo del rif. mitt. alf.
232210080331      * Bolla non manutenzionabile proteggo (solo se rma <> blanks)
232220080331     c                   If        §3aucb = 'N'
232230080331     c                   if        §lprma<>*blanks
232240030304     c                   Movel     Prot1         AtrRma
232250030304     c                   Eval      wrma = 's'
232260080331     c                   endif
232270030303     c                   Else
232280030303      * Provengo da giacenze e il p.o. del cliente è DPD proteggo
232290030303     c                   If        (§lpfpr = 'P' or §lpfpr = 'G')
232300060627     C                   MOVEL     OG143         SAV143
232310030303     c                   Clear                   og143
232320060627     c     w0030         Chain     Azorg01l      uniorg
232330030303     c                   If        %Found(Azorg01l)
232340030303     c                   Movel     orgde3        og143
232350030303     c                   Endif
232360030303     c                   If        §Ogntw = 'DPD'
232370030304     c                   Movel     Prot1         AtrRma
232380030304     c                   Eval      wrma = 's'
232390030303     c                   EndIf
232400060627     C                   MOVEL     SAV143        OG143
232410030303     c                   Endif
232420030303     c                   Endif
232430081014     C** Memorizzo se per il cliente del vab si gestisce il raggruppamento
232440081014     c** bolle
232450081014     C                   CLEAR                   DS3C
232460081014     C                   MOVEL     '3C'          COD
232470081014     C                   MOVEL(P)  §lpccm        KEY
232480081014     C                   EXSR      CTABEL
232490081014     C  N30              MOVEL     TBLUNI        DS3C
232500081014     c                   eval      §3cabd_s=§3cabd
232510980310     C* CARICO LA DS3C DEL CLIENTE PER VEDERE SE MANTIENE IL NUMERO
232520060216     C*  DI SPEDIZIONE PER VEDERE SE CHAINARE RECORD E DI ar4
232530980310     C                   CLEAR                   DS3C
232540980310     C                   MOVEL     '3C'          COD
232550980310     C                   MOVEL(P)  WKSC          KEY
232560980310     C*
232570980310     C                   EXSR      CTABEL
232580980310     C  N30              MOVEL     TBLUNI        DS3C
232590971222     C* VEDO SE ESISTE NUMERO AWB SEMPRE PERCHE' POTREBBE ESSERE SBAGLI
232600971222     C*  ATA LA LNA SULLA BOLLA
232610980310     C     §3CFSP        IFEQ      'S'
232620060216     C     KBLC4         CHAIN(N)  Fiar4000                           30
232630971216     C     *IN30         IFEQ      *OFF
232640060216     C                   MOVEL     ar4NOT        DSBL4E
232650971216     C                   MOVEL     §B4ERP        W010A            10
232660971216     C**
232670971216     C     W010A         IFGT      *ZEROS
232680020208     C                   MOVEL     §B4ERP        v6cawb
232690971216     C                   MOVEL     §B4ERP        SAVAWB
232700971216     C                   ENDIF
232710971222     C                   ENDIF
232720980310     C                   ENDIF
232730110818     c* FLAG ACCORPAMENTO SPEDIZIONI in consegna
232740110818     c* Se cliente abilitato al passaggio del flag accorpamento sped.
232750110818     c* verifico in tabella XCO se flag valido:
232760110818     c* - memorizzo errore, se flag non valido
232770110818     c* - memorizzo il dato nel campo wxco, se flag valido
232780110901     c* - memorizzo se si devee inviare messaggio al ced
232790050114     c                   clear                   wxco
232800110818     c                   eval      werrxco=*off
232810050114    1c                   if        §lpxco <> *blanks
232820050114    2c                   if        §3caus = 'S'
232830050114     C                   CLEAR                   dsbs02
232840110818     c                   clear                   dxco
232850050114     C                   MOVEL     'C'           T02MOD
232860050114     C                   MOVEL     KNSIF         T02SIF
232870110818     C                   MOVEL     'XCO'         T02COD
232880110818     c                   movel(P)  'XCO'         t02ke1
232890050114     c                   call      'TIBS02R'
232900050114     C                   PARM                    KPJBA
232910050114     C                   PARM                    dsbs02
232920050114    3C                   IF        T02ERR = *BLANKS
232930110818     C                   MOVEL     T02uni        dxco
232940050114    3C                   ENDIF
232950110901     c* Se valore non presente in tabella:
232960110901     c* memorizzo che devo inviare email a CED
232970110818    3c                   if        %lookup(§lpxco:vaa)=0
232980110901     c                   eval      werrxco=*on
232990110901     c* e se il valore è numerico>0 lo mantengo comunque
233000110901     c                   if        §lpxco>'0'
233010110901     c                   eval      wxco = §lpxco
233020110901     c                   endif
233030110818     c                   else
233040110901     c* Se valore presente in tabella  ---> tutto ok
233050110818     c                   eval      wxco = §lpxco
233060110818    3c                   endif
233070050114    2c                   endif
233080050114    1c                   endif
233090050114     c*
233100000214     C* VEDO SE DISK 'C'
233110911031     C*
233120940926     C* MITTENTE
233130020507     C* SE 8888 O 9999
233140941010    1C     VIDCCM        IFEQ      8888
233150940926     C     VIDCCM        OREQ      9999
233160980115     C                   MOVEL     §LPRSM        VIDRSM
233170911031     C                   MOVEL     §LPINM        VIDINM
233180911031     C                   MOVEL     §LPLOM        VIDLOM
233190911031     C                   MOVEL     §LPCAM        VIDCAM
233200920130     C                   MOVEL     §LPPRM        VIDPRM
233210940926     C                   MOVEL     §LPNZM        VIDNZM
233220941010     C*
233230941010   X1C                   ELSE
233240941010     C*
233250941010     C* SE CODIFICATO E §LPCAM E §LPNZM SONO PIENI, CONTROLLO CON CNIND
233260941010    2C     §LPCAM        IFNE      *BLANKS
233270941010     C     §LPNZM        ORNE      *BLANKS
233280950529     C                   Z-ADD     KCI           CCC
233290941010     C     KACO          CHAIN     CNIND000                           30
233300941010     C*
233310941010    3C     *IN30         IFEQ      *OFF
233320941010    4C     INDCAE        IFNE      §LPCAM
233330941010     C     INDSTA        ORNE      §LPNZM
233340941010     C                   MOVEL     §LPCAM        VIDCMO
233350941010     C                   MOVEL     §LPNZM        VIDNMO
233360941010    4C                   ENDIF
233370941010    3C                   ENDIF
233380941010    2C                   ENDIF
233390941010     C*
233400941010    1C                   ENDIF
233410941010     C*
233420940926     C                   MOVEL     *BLANKS       VIDFAP
233430940927     C                   MOVEL     *BLANKS       VIDFIN
233440911031     C*
233450980115     C                   MOVEL     §LPRSD        VIDRSD
233460980115     C                   MOVE      §LPRD2        VIDRSD
233470980115     C     MI:MA         XLATE     VIDRSD        VIDRSD
233480980115     C     MI:MA         XLATE     §LPIND        VIDIND
233490980115     C     MI:MA         XLATE     §LPPRD        VIDPRD
233500980115     C     MI:MA         XLATE     §LPCAD        VIDCAD
233510980115     C     MI:MA         XLATE     §LPLOD        VIDLOD
233520980115     C     MI:MA         XLATE     §LPNZD        VIDNZD
233530140211     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
233540140211     c* seguenti la località
233550140211     c                   eval      wtxt=vidlod
233560140211     c                   exsr      chkstringa
233570140211     c                   movel     wtxt          vidlod
233580070404     c                   movel     vidrsd        savrsd
233590070404     c                   movel     vidind        savind
233600070404     c                   movel     vidprd        savprd
233610070404     c                   movel     vidcad        savcad
233620070404     c                   movel     vidlod        savlod
233630070404     c                   movel     vidnzd        nzdini
233640910204     C*
233650940927     C                   MOVEL     §LPCCN        SAVMIT
233660900824     C*
233670980115     C     MI:MA         XLATE     §LPGC1        VIDGC1
233680980115     C     MI:MA         XLATE     §LPGC2        VIDGC2
233690911031     C                   MOVEL     §LPFTM        VIDFTM
233700940927     C                   MOVEL     §LPQFT        VIDQFT
233710940927     C                   MOVEL     §LPIAS        VIDIAS
233720940926     C                   MOVEL     §LPVAS        VIDVAS
233730950517     C                   MOVEL     §LPVAS        VARVAS
233740940926     C                   MOVEL     §LPVMD        VIDVMD
233750940926     C                   MOVEL     §LPVAD        VIDVAD
233760950517     C                   MOVEL     §LPVAD        VARVAD
233770911031     C                   MOVEL     §LPNAS        VIDNAS
233780040610     C                   MOVEL     §LPbva        VIDbva
233790940819     C                   MOVEL     §LPNCL        V1CNCL
233800930401     C                   MOVEL     §LPNCL        SAVNCL
233810930401     C                   MOVEL     §LPNCL        VIDNCL
233820940926     C                   Z-ADD     §LPPKB        VIDPKG
233830940926     C                   Z-ADD     §LPPKB        V2CPKG
233840980402     C                   Z-ADD     0             SAVPKG
233850940926     C                   Z-ADD     §LPVLB        VIDVOL
233860980402     C                   Z-ADD     0             SAVVOL
233870940926     C                   MOVEL     §LPCAS        VIDCAS
233880110519     C     mi:ma         xlate     §LPVCA        VIDVCA
233890110519     C     mi:ma         xlate     §LPVCA        VARVCA
233900911031     C                   MOVEL     §LPTIC        VIDTIC
233910900824     C*
233920911031     C                   MOVEL     §LPRMN        VIDRMN
233930940926     C                   MOVEL     §LPRMA        VIDRMA
233940911031     C                   MOVEL     §LPRMO        VIDRMO
233950091008     C                   MOVEL     '1'           WOVUO1
233960060627     c* se lnp dpd metto rmn in nrd
233970060628     c                   if        §ogntw='DPD' and §3arbl <> 'R'
233980060628     c                   movel     §lpnpr        vidnrd
233990060628     c                   endif
234000900824     C* CONTROLLO SE POSIZIONARMI SU SEGNACOLLO O SU VOLUME
234010911031     C     §LPNCD        IFEQ      0
234020931123     C                   SETOFF                                       36
234030900824     C                   ELSE
234040900827     C                   SETON                                        36
234050900824     C                   END
234060940926     C                   MOVEL     §LPNOT        VIDNT1
234070940926     C                   MOVEL     §LPNT2        VIDNT2
234080910129     C* CODICE TRATTAMENTO MERCE
234090011206     C* QUESTE SPECIFICHE LE HO SPOSTATE PRIMA DELL'IMPOSTAZIONE DI VID
234100011206     C* LNA PERCHE' MI SERVIVA IL CONTENUTO DI §1BF12
234110950504     C*
234120910805     C                   MOVEL     *ZEROS        VIDNCD
234130910805     C                   MOVEL     *ZEROS        VIDNCA
234140921005     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
234150920203     C     §LPFPR        IFEQ      'G'
234160941230     C                   MOVEL     §LPFPR        WFPR              1
234170920203     C                   MOVEL     §LPNCD        VIDNCD
234180920203     C                   MOVEL     §LPNCA        VIDNCA
234190920203     C                   MOVEL     'V'           §LPFPR
234200950420     C                   SETON                                        8744
234210011029     C                   MOVEL     PROT          ATRFTM
234220970328     C     §LPBAM        IFEQ      ' '
234230970328     C                   MOVEL     'S'           §LPBAM
234240920203     C                   END
234250970328     C                   END
234260941230     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
234270941230     C* IN QUESTO CASO NON MI FERMO SULLA BOLLA E NON LA STAMPO
234280941230     C     §LPFPR        IFEQ      'P'
234290941230     C                   MOVEL     §LPFPR        WFPR              1
234300941230     C                   MOVEL     §LPNCD        VIDNCD
234310941230     C                   MOVEL     §LPNCA        VIDNCA
234320941230     C                   MOVEL     'X'           §LPFPR
234330950420     C                   SETON                                        8744
234340011029     C                   MOVEL     PROT          ATRFTM
234350970328     C     §LPBAM        IFEQ      ' '
234360970328     C                   MOVEL     'S'           §LPBAM
234370970328     C                   END
234380941230     C                   END
234390921029     C* CREO BOLLA PER INVIO DISPOSIZIONI MITTENTE AI CLIENTI
234400921029     C     §LPFPR        IFEQ      'I'
234410921029     C                   MOVEL     'X'           §LPFPR
234420940222     C                   MOVEL     'I'           WFPR
234430011029     C                   SETON                                        87
234440011029     C                   MOVEL     PROT          ATRFTM
234450921029     C                   END
234460020522     C     §LPFPR        IFEQ      'T'
234470030609      * se sto creando una bolla "FT" x ORM commissionati
234480030609      * devo impostare §lpfpr = 'X' e proteggere la lna
234490030609    2c                   If        §lpCbo = 'FT'
234500030609     c                   Eval      §lpFpr = 'X'
234510030609     c                   Movel     Prot1         AtrLna
234520030609    xc                   Else
234530020522     C                   MOVEL     'V'           §LPFPR
234540030609    2c                   EndIf
234550020522     c                   endif
234560910208     C* SOLO CON FLAG6=C PRENDO I SEGNACOLLI SE NO COMUNQUE LI AZZERO
234570910208     C     §1BFG6        IFEQ      'C'
234580911031     C                   MOVEL     §LPNCD        VIDNCD
234590911031     C                   MOVEL     §LPNCA        VIDNCA
234600920204     C                   END
234610910805     C* SE FLAG7=S ABILITO TASTO PER GESTIONE DETT. STAMPA SEGNACOLLI
234620910805     C     §1BFG7        IFEQ      'S'
234630020917     C* Se DISKC non devo abilitare l'F21 di manutenzione fivad
234640001016     C     §1BF12        IFEQ      'N'
234650001106     C     §1BF12        OREQ      'E'
234660001106     C     WASDKC        ANDNE     'S'
234670910805     C                   SETON                                        94
234680001016     C                   ENDIF
234690910805     C* SE VI3FNS=S -> C'E' SEGNACOLLO E NON CODICE PRODOTTO
234700020917     C     KBLC          SETLL     FIVAD000
234710020917     C     KBLC          READE(N)  FIVAD000                               31
234720910805     C  N31BLDNCD        IFGT      0
234730920204     C     BLDCDP        ANDEQ     *BLANKS
234740910805     C                   MOVEL     'S'           VI3FNS
234750910805     C                   END
234760910805     C                   END
234770910220     C*
234780120903     C***  §1BFG2        IFNE      'N'
234790120903     C***  §LPFPR        OREQ      'R'
234800120903     C     §1BFG2        IFeq      'S'
234810921005     C                   MOVEL     §LPNSP        VIDNSP
234820921005     C                   MOVEL     §LPNRS        VIDNRS
234830921005     C                   ELSE
234840910129     C                   Z-ADD     0             VIDNSP
234850910129     C                   Z-ADD     0             VIDNRS
234860000829     C                   END
234870050222     C* SE NAZIONE DESTINATARIO ESTERA,
234880050222     C* CONTROLLO IL COD.TARIFFA PER SAPERE SE E' TRAFFICO DPD
234890050222     C                   MOVEL     '15'          COD
234900050222     C                   MOVEL(P)  VIDNZD        KEY
234910050222     C                   EXSR      CTABEL
234920050222     C   30              CLEAR                   DS15
234930050222     C  N30              MOVEL     TBLUNI        DS15
234940050222     C*
234950050222    1C     §15ITA        IFNE      'I'
234960050222     C                   MOVE      WKSC          W0040
234970050222     C*
234980050222     C* SE CLIENTE CODIFICATO, FACCIO COME ADESSO
234990050222     C* SE CLIENTE NON CODIFICATO MA COD.TRATTAMENTO MERCE PER DPD,
235000050222     C*   E LNA DPD, CONSIDERO LO STESSO IL RIF.MITTENTE
235010050222   1AC     W0040         IFEQ      8888
235020050222     C     W0040         OREQ      9999
235030050222     C     VIDLNA        IFGT      *ZEROS
235040050222     C     A_§OGNTW      ANDEQ     'DPD'
235050050222     C                   MOVEL     'D'           VIDDPD
235060050222     C*
235070050222     c                   select
235080050222    5C     §1BF13        wheneq    'R'
235090060628     c                   movel     §lpnpr        vidnrd
235100050222    5C     §1BF13        wheneq    *blanks
235110050222     c                   exsr      sr_vatdpd
235120060612     c                   movel     w014a         vidnrd
235130050222     C                   ENDsl
235140050222     c                   else
235150050222     c     vidlna        ifgt      *zeros
235160050222     c     A_§ogntw      andeq     'FED'
235170050222     c                   movel     'F'           viddpd
235180050222     c                   endif
235190050222     C                   ENDIF
235200050222     C*
235210050222  X1AC                   ELSE
235220050222     C*
235230050921     c                   clear                   fnlv59ds
235240050921     C                   MOVEL     'P'           ilv59tbo
235250050222      * se bolla monovaria pulisco il tipo bolla
235260050222     C                   IF        §3ASVA <> *BLANK
235270050921     C                   CLEAR                   ilv59tbo
235280050921     C                   movel     'P'           ilv59prp
235290050222     C                   ENDIF
235300050222
235310050921     C                   MOVEL     WKSC          ilv59KSC
235320050921     C                   MOVEL     KCI           ilv59KCI
235330050921     C                   MOVEL     BLPDSP        ilv59DSP
235340050921     C                   MOVEL     VIDTSP        ilv59TSP
235350050921     C                   MOVEL     §LPCTR        ilv59CTR
235360050921     C                   MOVEL     'S'           ilv59RIC
235370050921     C                   MOVEL     'S'           ilv59CON
235380050222     C* CONTROLLO TRA LE TARIFFE ESTERE E ITALIADPD
235390050921     C                   MOVEL     'S'           ilv59FIE
235400050921     C                   CALL      'FNLV59R'
235410050921     C                   PARM                    fnlv59ds
235420050222     C*
235430050222     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDOPRG
235440050921    2C     olv59err      IFEQ      ' '
235450050921     C     olv59tks      ANDEQ     'S'
235460050921     C                   MOVEL     olv59prg      COMPRG
235470050222     C                   MOVEL     §LPCTR        COMCTR
235480050222     C     KTAM2         CHAIN     TNTAM000                           30
235490050222     C* TARIFFA VALIDA
235500050222    3C     *IN30         IFEQ      *OFF
235510050222     C     TAMATB        ANDEQ     ' '
235520050222     C                   MOVEL     TAMFLO        DSTA01
235530050222     C* TARIFFA DPD
235540050222    4C     §TADPD        IFEQ      'S'
235550050222     C                   MOVEL     'D'           VIDDPD
235560050222     c                   select
235570050222    5C     §1BF13        wheneq    'R'
235580060628     c                   movel     §lpnpr        vidnrd
235590050222    5C     §1BF13        wheneq    *blanks
235600050222     c                   exsr      sr_vatdpd
235610060612     c                   movel     w014a         vidnrd
235620050222    5C                   endsl
235630050222     c                   else
235640050222     c* tariffa fedex
235650050222     c     §tafed        ifeq      'S'
235660050222     c                   movel     'F'           viddpd
235670050222     c                   endif
235680050222    4C                   ENDIF
235690050222    3C                   ENDIF
235700050222    2C                   ENDIF
235710050222   1AC                   ENDIF
235720050222    1C                   ENDIF
235730000831     C* PER NO DISK "B" CONTROLLO SE DISK "C"
235740000904     C* Spengo indicatore per attivazione tasto funzionale di gestione
235750000904     c* cod. CHI SONO
235760000901     C                   SETOFF                                       96
235770000901    1C     §1BFG1        IFNE      'S'
235780000831     C     WASDKC        ANDEQ     'S'
235790000831     C* SE IMPORT DPD O COD.TRATTAMENTO MERCE CHE PREVEDE IL DISK C
235800000901    2C     §1BF12        IFNE      'N'
235810001013     C     §1BF12        ANDNE     ' '
235820020319     C     §OGNTW        OREQ      'DPD'
235830000919     C     §3CDKC        ANDEQ     'S'
235840000214     C                   MOVEL     ':'           VIDSOP
235850000901     C* Carico subfile prendendo il chi sono dal VAT oppure dal VAB/VAD
235860000901     C* in base al tipo di DISKC
235870050222     c* Non devo caricare il subfile se:
235880050222     c* 1) spedizione export dpd e numero parcel dpd = codice chi sono
235890050222     c* 2) spedizione import dpd
235900050222     c* in questi due casi infatti il cod.chi sono coincide col numero
235910050222     c* parcel dpd che viene già inserito in altro modo
235920051102     c* Sarà il pgm a tenerne conto per la scrittura di fisgn e FIARS
235930000901    3C     §1BF12        IFEQ      'E'
235940050222     c     viddpd        andne     'D'
235950050222     c     §ogntw        andne     'DPD'
235960050222     c     §1bf12        oreq      'E'
235970050222     c     viddpd        andeq     'D'
235980050222     c     §1bf13        andne     *blanks
235990030321      * se non ho superato i 500 colli
236000050222     c     V1cNcl        ifle      500
236010000829     C                   EXSR      CARVAT
236020000901     C                   SETON                                        96
236030000911     C     NR8           IFGT      0
236040000911     C                   SETON                                        78
236050000911     C                   ENDIF
236060050222     c                   endif
236070000901   X3C                   ELSE
236080000901    4C     §1BF12        IFEQ      'B'
236090030321      * se non ho superato i 500 colli
236100030321     c     V1cNcl        andle     500
236110140506     c* se vengo da dirottamenti carico da FIART altrimenti dal VAB
236120140506     c                   if        §lpnspm>0
236130140506     c                   exsr      CARART
236140140506     c                   else
236150000901     C                   EXSR      CARVAB
236160140506     c                   endif
236170000911     C     NR8           IFGT      0
236180000911     C                   SETON                                        78
236190000911     C                   ENDIF
236200000901     C                   SETON                                        96
236210050222     c                   else
236220050222     c* se import dpd e numero parcel nel fivat lo metto nel rmn
236230050222     c     §1bf12        ifeq      'E'
236240050222     c     §ogntw        andeq     'DPD'
236250050222     c                   exsr      sr_vatdpd
236260060612     c                   movel     w014a         vidnrd
236270060616     c                   seton                                        79
236280050222     c                   endif
236290000901    4C                   ENDIF
236300000901    3C                   ENDIF
236310000901    2C                   ENDIF
236320000901    1C                   ENDIF
236330001106     C*
236340001106     C* SE FLAG 12 = 'E' MA AS400 NON ABILITATO A DISK C CARICO LO
236350020917     C* STESSO SUBFILE PRENDENDO I DATI DA FIVAT
236360001106    1C     §1BFG1        IFNE      'S'
236370001106     C     WASDKC        ANDNE     'S'
236380001106     C     §1BF12        ANDEQ     'E'
236390030321      * se non ho superato i 500 colli
236400030321     c     V1cNcl        andle     500
236410050222     c     viddpd        ifne      'D'
236420050222     c     §ogntw        andne     'DPD'
236430050222     c     viddpd        oreq      'D'
236440050222     c     §1bf13        andne     *blanks
236450001106     C                   EXSR      CARVAT
236460001106     C                   SETON                                        96
236470001106     C     NR8           IFGT      0
236480001106     C                   SETON                                        78
236490001106     C                   ENDIF
236500050222     c                   endif
236510001106     C                   ENDIF
236520000831     C*
236530911031     C                   MOVEL     §LPFFD        VIDFFD
236540010214     C     §LPFFD        IFEQ      *BLANKS
236550010214     C                   MOVEL     'N'           VIDFFD
236560010214     C                   ENDIF
236570911031     C                   MOVEL     §LPTCR        VIDTCR
236580940927     C                   MOVEL     §LPHCR        VIDHCR
236590940927     C                   MOVE      §LPHCR        VIDMCR
236591150202     c* non tengo l'ora consegna richiesta del cliente
236592150202     c* se < 8:00 o > 20:00
236593150203     c* se h 10:30 se < 0800 o > 1030
236594150202     c                   if        §lphcr<0800 or
236595150203     c                             (vidtsp='H' and §lphcr>1030) or
236596150202     c                             §lphcr>2000
236597150202     c                   clear                   vidhcr
236598150202     c                   clear                   vidmcr
236599150202     c                   endif
236606150203     c
236607940927     C* MI SERVONO PER IL CONFRONTO PER SAPERE SE CAMBIARE O NO I CAMPI
236610940927     C   04              Z-ADD     §LPCCN        SAVCCM
236620941103     C  N04              Z-ADD     1             SAVCCM
236630920123     C*
236640920123     C                   MOVEL     §LPFBR        VIDFBR
236650031029     c                   Clear                   VidGca
236660940927     C                   MOVEL     §LPGGA        VIDGGA
236670940927     C                   MOVEL     §LPGMA        VIDGMA
236680091221     c                   eval      wvidgma = §lpgma
236690100604     c* Verifico se c'e' ritiro contestuale alla consegna
236700100604     c                   clear                   ds7r
236710100604     C                   MOVEL     '7R'          COD
236720100604     C                   MOVEL(P)  §lpGMA        KEY
236730100604     C                   EXSR      CTABEL
236740100604     C  n30              MOVEL     TBLUNI        DS7R
236750100604     c                   eval      w7rRC = §7rRC
236751141202     c                   eval      w7rPC = §7rpincode
236760100604     c
236770940927     C                   MOVEL     §LPGVA        VIDGVA
236780031029     c                   move      ' '           VidGva
236790920123     C                   MOVEL     §LPPOR        VIDPOR
236800940927     C                   MOVEL     §LPIMV        VIDIMV
236810991026     C                   MOVEL     §LPDIV        VIDDIV
236820970326     C* FLAG DDT S/N
236830970326     C     §LPBAM        IFNE      ' '
236840970328     C     §LPBAM        IFEQ      'S'
236850970328     C     §LPBAM        OREQ      'C'
236860060609     C     §LPBAM        OREQ      'P'
236870060609     C     §LPBAM        OREQ      'Q'
236880991007     C                   MOVEL     'S'           VIDBAM
236890970328     C                   ELSE
236900970328     C                   MOVEL     'N'           VIDBAM
236910970326     C                   ENDIF
236920970328     C                   ENDIF
236930020102     C* SE SONO RICHIAMATA DA PGM DELLE GIACENZE E HO DEGLI IMPORTI DI
236940020102     C* TASSAZIONE SENZA NUMERO FATTURA E LA DIVISA E' DIVERSA DA GE
236950020102     C* DCN MEMORIZZO CHE DEVO CARICARE LA VIDEATA CON GLI IMPORTI CON-
236960020102     C* VERTITI NELLA DIVISA DI CONTO DAL MOMENTO CHE PER §LPFPR = "G",
236970020102     C* "I" O "P" I DATI DI TASSAZIONE SONO PROTETTI ED IN CASO DI
236980020102     C* ERRORE DI DIVISA SCADUTA L'YENTE NON PUO' IN ALCUN MODO INTERVE
236990020102     C* NIRE PER CAMBIARE LA DIVISA
237000020102     C                   CLEAR                   WCONV
237010020102     C     WFPR          IFEQ      'G'
237020020102     C     WFPR          OREQ      'I'
237030020102     C     WFPR          OREQ      'P'
237040020102     C     VIDNFT        IFEQ      0
237050020102     C     VIDDIV        ANDNE     *BLANKS
237060020102     C     VIDDIV        ANDNE     §GEDCN
237070020102     C                   MOVEL     '1'           WCONV             1
237080020102     C                   ENDIF
237090020102     C                   ENDIF
237100940927     C* CARICO LE VARIE
237110940927     C                   Z-ADD     0             NRR
237120941108     C                   DO        20            C
237130991027     C                   MOVEL     VSV(C)        WSVN
237140991027     C                   Z-ADD     VVA(C)        WVAN
237150940927     C                   EXSR      CARVAR
237160020102      * CARICO SCHIERA VARIE X RICALCOLO TOT.IMPONIBILE
237170020102     C     WCONV         IFEQ      '1'
237180020102     C     VIDIMV        ANDGT     *ZEROS
237190020102     C                   MOVEL     V3CSV1        VSV(C)
237200020102     C                   Z-ADD     V3CVA1        VVA(C)
237210020102     C                   MOVEL     V3CEV1        VES(C)
237220020102     C                   ENDIF
237230941108     C                   ENDDO
237240020102     C* CONVERTO ANCHE PORTO E RICALCOLO EVENTUALMENTE IL TOTALE IMPO-
237250020102     C* NIBILE
237260020102    1C     WCONV         IFEQ      '1'
237270020102     C* PORTO
237280020102    2C     VIDPOR        IFGT      *ZEROS
237290020102     C                   CLEAR                   DSYEUR
237300020102     C                   MOVEL     VIDDIV        YECDVI
237310020102     C                   Z-ADD     VIDPOR        YECIMI
237320020102     C                   MOVEL     §GEDCN        YECDVO
237330020102     C     COMFDC        IFEQ      'S'
237340020102     C                   MOVEL     '3'           YECDCO
237350020102     C                   ELSE
237360020102     C                   MOVEL     '0'           YECDCO
237370020102     C                   ENDIF
237380020102     C                   CALL      'YEURCO'
237390020102     C                   PARM                    DSYEUR
237400020102    3C     YECESI        IFEQ      ' '
237410020102     C                   Z-ADD     YECIMO        VIDPOR
237420020102    3C                   ENDIF
237430020102    2C                   ENDIF
237440020102     C* TOTALE IMPONIBILE
237450020102    2C     VIDIMV        IFGT      *ZEROS
237460020102     C                   CLEAR                   DSLV16
237470020102     C                   MOVEL     'T'           D17FIM
237480020102     C                   Z-ADD     VIDPOR        D17POR
237490020102     C                   CALL      'FNLV16R'
237500020102     C                   PARM                    DSLV16
237510020102     C                   PARM                    DTASV
237520020102     C                   Z-ADD     O17IMV        VIDIMV
237530020102    2C                   ENDIF
237540020102     C* DIVISA
237550020102     C                   MOVE      §GEDCN        VIDDIV
237560020102    1C                   ENDIF
237570020102     C                   CLEAR                   WCONV
237580940927     C*
237590940927     C* NUM TENTATIVI PER SUPERARE CONTROLLI FORZATI
237600940927     C     §LPFPR        IFNE      'V'
237610941021     C                   Z-ADD     1             NUMFOR
237620940927     C                   ELSE
237630940927     C                   Z-ADD     1             NUMFOR
237640940927     C                   ENDIF
237650941020     C*
237660941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
237670941020     C     VIDPOR        IFNE      0
237680941020     C     NRR           ORNE      0
237690941020     C     VIDCEI        ORNE      ' '
237700941020     C     VI2SV1        ORNE      ' '
237710040114     c     Vi2Sv2        orne      *Blanks
237720040114     c     Vi2Sv3        orne      *Blanks
237730040114     c     Vi2Sv4        orne      *Blanks
237740941020     C     VI2CEI        ORNE      ' '
237750941020     C                   MOVEL     'S'           WEMD03            1
237760941020    1C                   ENDIF
237770941011     C*
237780941011     C* VISUALIZZO IL NUMERO DI SPEDIZIONE CHE STO CONFERMANDO
237790941011     C                   Z-ADD     §LPNRS        PRENRS
237800941011     C                   Z-ADD     §LPNSP        PRENSP
237810941011     C                   MOVEL     §LPLNA        PRELNA
237820941011     C                   Z-ADD     §LPRMN        PRERMN
237830941011     C                   Z-ADD     §LPZNC        PREZNC
237840040506
237850040506      * Imposto la ds di comodo del n. spedizione
237860060222     c****               Z-add     VidLnp        WidLnp
237870060222     c                   Z-add     §lplnp        WidLnp
237880040506     c                   Z-add     §lpNrs        WidNrs
237890040506     c                   Z-add     §lpNsp        WidNsp
237900000124     C*
237910000508     C*
237920050114     C* SE LNP POSTE, MEMORIZZO A PARTE IAS, PER
237930060216     C*  MEMORIZZARLO NEL ar4 RECORD "J"
237940140122     C**   §ogntw        IFEQ      'PPT'
237950140122     C**                 Z-ADD     VIDIAS        §B4IAS
237960140122     C**                 MOVEL     VIDVAS        §B4VAS
237970140122     C**                 MOVEL     §LPDSK        §B4DSC
237980140122     c**                 clear                   §b4xco
237990140122     C**                 CLEAR                   VIDIAS
238000140122     C**                 CLEAR                   VIDVAS
238010140122     C**                 ENDIF
238020031125
238030021218      * Carico i dati relativi ai bancali
238040021220     c                   If        §LpTba > *Zeros
238050021218     c                   Movel     §LpTba        VidTba
238060021220     c                   EndIf
238070021218     c                   Eval      VidNba = §LpNba
238080030704     c                   Eval      SavNba = §LpNba
238090030224     c                   If        §LpTb2 > *Zeros
238100021218     c                   Movel     §LpTb2        VidTb2
238110021220     c                   EndIf
238120021218     c                   Eval      VidNb2 = §LpNb2
238130030704     c                   Eval      SavNba = §LpNb2
238140031125      * più quelli relativi ai colli sfusi e originali
238150031125     c                   Eval      w03Cor = §LpCor
238160031125     c                   Eval      w03Csf = §LpCsf
238170030409
238180030409      * Ore da sommare alla delivery
238190030409     c                   Move      §ore          VidOre
238200031125
238210031125      * carico i dati del telefono e del referente
238220031125     c                   Eval      VidRef = §LpRef
238230031125     c                   Eval      VidTel = §LpTel
238240031125
238250031125      * Imposto i campi dal FIVAT no record 'E'
238260031125     c                   ExSr      Sr_CarVat
238270031125      * Controllo quali dati dei bancali devo tenere
238280031126      * se non sono richiamta da giacenze
238290031126     c                   If        (savfpr <> 'P' and savfpr <> 'G')
238300031125     c                   ExSr      Sr_CtrBancali
238310031126     c                   EndIf
238320021218
238330900824     C                   ENDSR
238340010301     C*
238350010301     C*--- CARICO RECORD BOLLE DA CONFERMA ORM PREPAGATI -------------*
238360010301     C     CARBLO        BEGSR
238370010301     C                   Z-ADD     §LPPOE        VIDPOE
238380010301     C                   MOVEL     §LPNSR        VIDNOR
238390010301     C                   MOVE      §LPNOR        VIDNOR
238400010301     C                   Z-ADD     §LPNRV        VIDNRV
238410010301     C                   Z-ADD     VIDORM        WIDORM
238420010924     C                   CLEAR                   DORM01
238430010301     C     KORM          CHAIN     FNORM01L                           30
238440010301     C                   Z-ADD     ORMPOR        VIDLNP
238450010301     C                   MOVEL     '1'           VIDCBO
238460010924     C                   MOVEL     ORMFLO        DORM01
238470011121     C* Proteggo i campi a video relativi il destinatario se devo forza
238480011121     C* re il destinatario da orm
238490011121     C     §ORMFD        IFEQ      'S'
238500011121     C                   MOVEL     PROT          ATRDES
238510011121     C                   ELSE
238520011121     C                   CLEAR                   ATRDES
238530011121     C                   ENDIF
238540010301     C                   EXSR      PRPOR1
238550010307     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
238560010307     C* ANDRO' A PROPORRE NELLE NOTE
238570010307     C     'TEL.:'       CAT       ORMTER        W021A            21
238580010307     C     W021A         CAT(P)    ORMRER:1      WTELRF           70
238590010307     C                   MOVE      WTELRF        WTELR2           35
238600010301     C                   ENDSR
238610000627     C*
238620000627     C*--- RISCRIVO AGGIORNATA LA DBLP -------------------------------*
238630000627     C     AGDBLP        BEGSR
238640000627     C* DATA SPEDIZIONE
238650000627     C                   Z-ADD     BLPDSP        §LPMGS
238660000627     C                   MOVEL     BLPDSP        §LPAAS
238670000627     C* DATA CONSEGNA RICHIESTA
238680000627     C                   Z-ADD     COMDCR        §LPDCR
238690000627     C                   MOVEL     VIDSOP        §LPSOP
238700000627     C                   MOVEL     VIDRMN        §LPRMN
238710000627     C                   MOVEL     VIDRMA        §LPRMA
238720000627     C                   MOVEL     VIDRMO        §LPRMO
238730000627     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
238740000627     C                   Z-ADD     COMDRT        §LPDRT
238750000627     C                   MOVEL     VIDNRT        §LPNRT
238760000627     C                   MOVEL     VIDFPP        §LPFPP
238770000627     C                   MOVEL     VIDLNP        §LPPDR
238780000627     C                   MOVE      VIDPDR        §LPPDR
238790000627     C*
238800000627     C* CODICE BOLLA
238810000627     C                   MOVEL     VIDCBO        §LPCBO
238820000627     C                   Z-ADD     VIDCAS        §LPCAS
238830011113     C     VIDCAS        IFGT      *ZEROS
238840011113     C                   MOVEL     VIDVCA        §LPVCA
238850011113     C                   ELSE
238860011113     C                   CLEAR                   §LPVCA
238870011113     C                   ENDIF
238880000627     C                   MOVEL     VIDTIC        §LPTIC
238890000627     C                   MOVEL     VIDGCA        §LPGCA
238900011113     C                   CLEAR                   §LPCMB
238910000627     C* SEGNACOLLI
238920000627    1C     §3ABCM        IFEQ      ' '
238930000627     C                   EXSR      ASSSGN
238940000627     C     WEMFOR        IFEQ      ' '
238950000627     C                   MOVEL     BLPNCD        §LPNCD
238960000627     C                   MOVEL     BLPNCA        §LPNCA
238970000627     C                   ENDIF
238980000627     C                   ELSE
238990000627     C                   CLEAR                   §LPNCD
239000000627     C                   CLEAR                   §LPNCA
239010000627     C                   ENDIF
239020000627     C* TASSAZIONE
239030000627     C                   Z-ADD     VIDPOR        §LPPOR
239040000627     C                   Z-ADD     VIDIMV        §LPIMV
239050000627     C                   MOVEL     VIDCEI        §LPCEI
239060000627     C                   MOVEL     VIDDIV        §LPDIV
239070000627     C* MANCANO LE VARIE E DATI FATTURA !!
239080000627     C**
239090000627     C                   MOVEL     COMLNA        §LPLNA
239100000627     C                   MOVEL     VIDRSM        §LPRSM
239110000627     C                   MOVEL     VIDINM        §LPINM
239120000627     C                   MOVEL     VIDCAM        §LPCAM
239130000627     C                   MOVEL     VIDLOM        §LPLOM
239140000627     C                   MOVEL     VIDPRM        §LPPRM
239150000627     C                   MOVEL     VIDNZM        §LPNZM
239160000627     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
239170000627     C     VIDCMO        IFNE      *BLANKS
239180000627     C                   MOVEL     VIDCMO        §LPCAM
239190000627     C                   MOVEL     VIDNMO        §LPNZM
239200000627     C                   ENDIF
239210000627     C*
239220000627     C                   MOVEL     VARZNC        §LPZNC
239230000627     C     §3ACTM        IFNE      *BLANKS
239240000627     C                   MOVEL     §3ACTM        §LPCTM
239250000627     C                   ELSE
239260000627     C                   MOVEL     VIDCTM        §LPCTM
239270000627     C                   ENDIF
239280000627     C     BLPCTM        IFEQ      *BLANKS
239290000627     C                   MOVEL     WCTM          §LPCTM
239300000627     C                   ENDIF
239310000627     C                   MOVEL     VIDTC1        §LPTC1
239320000627     C                   MOVEL     VIDTC2        §LPTC2
239330000627     C                   MOVEL     VIDGGA        §LPGGA
239340000627     C                   MOVEL     VIDGMA        §LPGMA
239350000627     C                   MOVEL     VIDGVA        §LPGVA
239360000627     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
239370000627     C* DELLE PARTICOLARITA' VARIE
239380000627     C     W2LN          IFEQ      'S'
239390000627     C                   MOVE      'D'           §LPGVA
239400000627     C                   ELSE
239410000627     C                   MOVE      ' '           §LPGVA
239420000627     C                   ENDIF
239430000627     C* P A R T I T A   I V A
239440000627     C*
239450000627     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
239460000627     C*     NELLA P.IVA
239470000627     C     VIDISM        IFEQ      '$$'
239480000627     C     VIDCPM        ANDEQ     *BLANKS
239490000627     C                   MOVEL     'PRIVATO'     VIDCPM
239500000627     C                   ENDIF
239510000627     C     VIDISD        IFEQ      '$$'
239520000627     C     VIDCPD        ANDEQ     *BLANKS
239530000627     C                   MOVEL     'PRIVATO'     VIDCPD
239540000627     C                   ENDIF
239550000627     C*
239560000627     C  N04VIDISM        IFEQ      *BLANKS
239570000627     C                   MOVEL     VIDCPM        §LPCPI
239580000627     C                   ELSE
239590000627     C                   MOVEL     VIDPIM        §LPCPI
239600000627     C                   ENDIF
239610000627     C   04VIDISD        IFEQ      *BLANKS
239620000627     C                   MOVEL     VIDCPD        §LPCPI
239630000627     C                   ELSE
239640000627     C                   MOVEL     VIDPID        §LPCPI
239650000627     C                   ENDIF
239660000627     C**
239670000627     C                   MOVEL     VIDRSD        §LPRSD
239680000627     C                   MOVE      VIDRSD        §LPRD2
239690000627     C                   MOVEL     VIDIND        §LPIND
239700000627     C                   MOVEL     VIDCAD        §LPCAD
239710000627     C                   MOVEL     VIDLOD        §LPLOD
239720000627     C                   MOVEL     VIDPRD        §LPPRD
239730000627     C                   MOVEL     VIDNZD        §LPNZD
239740000627     C                   MOVEL     VIDGC1        §LPGC1
239750000627     C                   MOVEL     VIDGC2        §LPGC2
239760000627     C                   MOVEL     VIDCTR        §LPCTR
239770000627     C                   MOVEL     SAVCTS        §LPCTS
239780000627     C                   MOVEL     VIDFBR        §LPFBR
239790000627     C* ALLEGA BAM
239800000627     C                   EXSR      AGGFST
239810000627     C                   MOVEL     BLPFST        §LPBAM
239820000627     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
239830000627     C                   CLEAR                   §LPFTM
239840000627     C   04SAVFTM        IFEQ      'S'
239850000627     C     VIDFTM        OREQ      'S'
239860000627     C                   MOVEL     'S'           §LPFTM
239870000627     C                   ENDIF
239880000627     C* SE NON IMMESSO TIPO SERVIZIO
239890000627     C     VIDTSP        IFNE      *BLANKS
239900000627    1C                   MOVEL     VIDTSP        §LPTSP
239910000627     C                   ELSE
239920000627     C* LO PRENDO DA TARIFFA
239930000627     C                   MOVEL     COMTSP        §LPTSP
239940000627     C                   ENDIF
239950000627     C                   MOVEL     VIDIAS        §LPIAS
239960011113     C     VIDIAS        IFGT      *ZEROS
239970011113     C                   MOVEL     VIDVAS        §LPVAS
239980011113     C                   ELSE
239990011113     C                   CLEAR                   §LPVAS
240000011113     C                   ENDIF
240010000627     C                   MOVEL     VIDVMD        §LPVMD
240020011113     C     VIDVMD        IFGT      *ZEROS
240030011113     C                   MOVEL     VIDVAD        §LPVAD
240040011113     C                   ELSE
240050011113     C                   CLEAR                   §LPVAD
240060011113     C                   ENDIF
240070000627     C                   MOVEL     VIDQFT        §LPQFT
240080000627     C                   MOVEL     VIDNAS        §LPNAS
240090000627     C                   MOVEL     V1CNCL        §LPNCL
240100000627     C                   MOVEL     V2CPKG        §LPPKB
240110000627     C                   MOVEL     VIDFVR        §LPFVB
240120000627     C                   MOVEL     VARVOL        §LPVLB
240130000627     C                   MOVEL     VIDFFD        §LPFFD
240140010214     C     VIDFFD        IFEQ      'N'
240150010214     C                   MOVE      *BLANKS       §LPFFD
240160010214     C                   ENDIF
240170000627     C                   MOVEL     VIDTCR        §LPTCR
240180000627     C                   MOVEL     COMDCR        §LPDCR
240190000627     C                   MOVEL     VIDHCR        §LPHCR
240200000627     C                   MOVE      VIDMCR        §LPHCR
240210000627     C*
240220000627     C                   MOVEL     VIDNT1        §LPNOT
240230000627     C                   MOVEL     VIDNT2        §LPNT2
240240000627     C***
240250000627     C***  F L A G   I N O L T R O
240260000627     C                   EXSR      INOLTR
240270000627     C                   MOVEL     WFIN          §LPFIN
240280000627     C*
240290000627     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
240300000627    2C     APDFCM        IFNE      ' '
240310000627     C                   MOVEL     'C'           §LPFAP
240320000627     C                   ELSE
240330000627     C                   MOVEL     COMFAP        §LPFAP
240340000627    2C                   END
240350050114     c* flag unificazione spedizioni
240360050114     c                   if        *in12 and *in15
240370050114     c                   eval      §lpxco = wxco
240380050114     c                   endif
240390000627     C**
240400000627     C                   ENDSR
240410940927     C*
240420940927     C* CARICAMENTO BOLLE: DECODIFICHE -------------------------------*
240430940927     C     DECBOL        BEGSR
240440961007     C                   SETOFF                                       0413
240450950410     C                   SETOFF                                       131487
240460940927     C                   SETOFF                                       364494
240470940928     C*
240480940928     C* SE EMETTO 1 VIDEATA MI POSIZIONO SEMPRE SUL MITTENTE
240490010222     C* O SUL NUMERO ORM SE ATTIVATA PROCEDURA E SONO IM MANUTENZIONE
240500961007     C                   SETON                                        0730
240510940927     C*
240520940927     C* M I T T E N T E
240530960926     C* LNP CODICE <> LNP BOLLA: IMPOSTO P.O. CLIENTE
240540950103     C     W0030         IFNE      VIDLNP
240550950103     C                   MOVEL     W0030         VIDFLC
240560950103     C                   SETON                                        14
240570940927     C                   ENDIF
240580950103     C*
240590940927     C* C O D I C E   B O L L A
240600940927     C                   MOVEL     '3A'          COD
240610940927     C                   MOVEL(P)  VIDCBO        KEY
240620940927     C                   EXSR      CTABEL
240630940927     C  N30              MOVEL     TBLUNI        DS3A
240640940927     C  N30              MOVEL     §3ATB1        FLGTB1
240650940927     C   30              MOVEL     'F'           FLGTB1
240660070427     c                   move      flgtb1        savtb1
240670120926     c   30              clear                   savrbl
240680120926     c  n30              movel     §3arbl        savrbl
240690940927     C*
240700940927     C     FLGTB1        IFEQ      'A'
240710940927     C                   SETON                                        04
240720940927     C                   END
240730940927     C*
240740940927     C* CODICE BOLLA NON MANUTENZIONABILE
240750940927     C     §3AUCB        IFEQ      'N'
240760940927     C                   SETON                                        44
240770940927     C                   END
240780051123     c* Proteggo il codice bolla se in manutenzione o conferma bolle
240790051123     c* e bolla monovaria
240800051123     c                   if        *in12 = *on and §3asva <> *blanks
240810051123     c                   Movel     Prot1         AtrCbo
240820051123     c                   endif
240830940927     C* P A R T I T A   I V A
240840050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
240850050921     c                   select
240860050921     c* solo numeri
240870070427     c* "PRIVATO senza iso
240880050921     c     *in30         wheneq    *off
240890050921     c     wiso          andge     *zeros
240900050921     c     *in30         oreq      *on
240910050921     c     posiz         andlt     3
240920050921     c  n04              movel     wpiva         vidcpm
240930050921     c   04              movel     wpiva         vidcpd
240940050921     c* iso + numeri
240950050921     c* iso + "PRIVATO"
240960050921     c     *in30         wheneq    *off
240970050921     c     posiz         orgt      2
240980050921     c  n04              movel     wpiva         vidpim
240990050921     c   04              movel     wpiva         vidpid
241000050921     c                   endsl
241010050921     C***  *IN30         IFEQ      *ON
241020050921     C***  WISO          ORGE      *ZEROS
241030050921     C**N04              MOVEL     WPIVA         VIDCPM
241040050921     C** 04              MOVEL     WPIVA         VIDCPD
241050050921     C**                 ELSE
241060050921     C**N04              MOVEL     WPIVA         VIDPIM
241070050921     C** 04              MOVEL     WPIVA         VIDPID
241080050921     C**                 ENDIF
241090940927     C*
241100940927     C* L I N E A   D I   A R R I V O
241110941011     C                   MOVEL     VIDLNA        SAVLNA
241120940927     C     VIDLNA        IFGT      *ZEROS
241130941011     C                   MOVEL     VIDLNA        COMLNA
241140940927     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
241150940927     C  N30              MOVEL     ORGDES        V1DLNA
241160940927     C   30              MOVEL     *BLANKS       V1DLNA
241170020213     C                   MOVEL     ORGDE3        A_OG143
241180060707     C                   MOVEL     a_§ogntw      savaogntw
241190040525     C                   MOVEL     ORGDF0        A_OG150
241200020215     c                   movel     A_§ogntw      savntw
241210940927     C                   ENDIF
241220940927     C*
241230941011     C* C O D I C E   P A D R O N C I N O
241240990702     C                   CLEAR                   V1DPDR
241250941011     C     VIDPDR        IFGT      *ZEROS
241260941011     C                   MOVEL     VIDLNP        W0070
241270941011     C                   MOVE      VIDPDR        W0070
241280021204     C                   move      w0070         kpdpdr
241290021203     C                   move      'A'           kpdtip
241300021203     C     kfapd         chain     fiapd01l                           30
241310941011     C  N30              MOVEL     APDRSC        V1DPDR
241320940927     C   30              CLEAR                   V1DPDR
241330941011     C                   ENDIF
241340941107     C*
241350941107     C* T I P O   S E R V I Z I O
241360941107     C     VIDTSP        IFNE      ' '
241370941107     C                   Z-ADD     1             C
241380941107     C     VIDTSP        LOOKUP    TSP(C)                                 30
241390090604     C**!30              MOVEL     DTS(C)        V1DTSP
241400090604     C   30              MOVEL     DTS08(C)      V1DTSP
241410941107     C                   ENDIF
241420941115     C*
241430941115     C* C O N S E G N E   P A R T I C O L A R I
241440941115     C                   MOVEL     '1P'          COD
241450941115     C     VIDTC1        IFNE      *BLANKS
241460941115     C                   MOVEL(P)  VIDTC1        KEY
241470941115     C                   EXSR      CTABEL
241480941115     C  N30              MOVEL     TBLUNI        V2DTC1
241490941115     C                   ENDIF
241500941115     C     VIDTC2        IFNE      *BLANKS
241510941115     C                   MOVEL(P)  VIDTC2        KEY
241520941115     C                   EXSR      CTABEL
241530941115     C  N30              MOVEL     TBLUNI        V2DTC2
241540941115     C                   ENDIF
241550940927     C*
241560940927     C* S I G L A   O P E R A T O R E
241570940927     C* SE E' IN TABELLA  3M  SIGNIFICA CHE NON SI PUO' MANUTENZIONARE
241580940927     C                   MOVEL     '3M'          COD
241590940927     C                   MOVEL(P)  VIDSOP        KEY
241600940927     C                   EXSR      CTABEL
241610940927     C* SE TROVATA IN TABELLA --> PROTEGGO IL CAMPO
241620940927     C     *IN30         IFEQ      *OFF
241630940927     C                   SETON                                        13
241640940927     C                   END
241650940929     C* E S E N Z I O N E   I V A
241660940929     C     VIDCEI        IFNE      ' '
241670940929     C                   MOVEL     'EI'          COD
241680940929     C                   MOVEL(P)  VIDCEI        KEY
241690940929     C                   EXSR      CTABEL
241700940929     C  N30              MOVEL     TBLUNI        V3DCEI
241710940929     C                   ENDIF
241720940927     C* G I R O   D A T E
241730940927     C                   CLEAR                   WLBDAT
241740940927     C                   MOVE      BLPDSP        G02INV
241750940927     C                   MOVEL     '3'           G02ERR
241760940927     C                   CALL      'XSRDA8'
241770940927     C                   PARM                    WLBDAT
241780940927     C                   MOVEL     G02DAT        VIDDSP
241790940927     C* LA CONTROLLO SEMPRE LA DATA RITIRO
241800940927     C                   CLEAR                   SAVDRT
241810940927     C*
241820940927     C                   CLEAR                   WLBDAT
241830940927     C                   Z-ADD     VIDDRT        G02INV
241840940927     C                   MOVEL     '3'           G02ERR
241850940927     C                   CALL      'XSRDA8'
241860940927     C                   PARM                    WLBDAT
241870940927     C                   MOVEL     G02DAT        VIDDRT
241880010221     C                   Z-ADD     VIDDRT        PREDRT
241890070829     C                   Z-ADD     VIDDRT        s_drtblp
241900940927     C*
241910940927     C                   CLEAR                   WLBDAT
241920940927     C                   Z-ADD     VIDDCR        G02INV
241930940927     C                   MOVEL     '3'           G02ERR
241940940927     C                   CALL      'XSRDA8'
241950940927     C                   PARM                    WLBDAT
241960940927     C                   MOVEL     G02DAT        VIDDCR
241970940929     C*
241980940929     C                   CLEAR                   WLBDAT
241990940929     C                   Z-ADD     VIDDFT        G02INV
242000941115     C                   MOVEL     '3'           G02ERR
242010940929     C                   CALL      'XSRDA8'
242020940929     C                   PARM                    WLBDAT
242030940929     C                   Z-ADD     G02DAT        VIDDFT
242040940927     C                   ENDSR
242050910117     C*
242060910117     C*--- CREO RECORD PER STAMPA BOLLA ------------------------------*
242070910117     C     CRTBLD        BEGSR
242080910129     C  N12              MOVEL     *BLANKS       BLDATB
242090910201     C                   MOVEL     BLPLNP        BLDLNP
242100910117     C                   MOVEL     BLPAAS        BLDAAS
242110910117     C                   MOVEL     BLPNSP        BLDNSP
242120910117     C                   MOVEL     BLPNRS        BLDNRS
242130940214     C*
242140991201     C* RIFERIMENTO MITTENTE ALFABETICO, SE LNP DPD SCRIVO NUMERICO
242150910411     C     §1BFG7        IFNE      'S'
242160020319     C     §OGNTW        IFNE      'DPD'
242170940825     C                   MOVEL     BLPRMA        BLDCDP
242180991201     C                   ELSE
242190060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
242200060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
242210060622     c* in ogni caso non lo prendo più dal rmn
242220060622     c                   if        %subst(§b4ipn:14:1)=*blanks
242230060622     C                   eval      bldcdp=%subst(§b4ipn:1:3) + ' ' +
242240060622     c                             %subst(§b4ipn:4:8) + ' ' +
242250060622     c                             §b4icd
242260060622     c                   else
242270060622     c                   eval      bldcdp=§b4ipn
242280060622     c                   endif
242290991201     C                   ENDIF
242300940214     C                   ENDIF
242310940214     C*
242320910201     C  N12              MOVEL     *BLANKS       BLDFST
242330910220     C  N12              Z-ADD     1             BLDNC1
242340971215     C   12
242350971215     CAN 15              SELECT
242360971215     C* DEVO RISTAMPARE ENTRAMBE LE ETICHETTE
242370971215     C     §1BFG9        WHENEQ    'S'
242380951019     C     §1BFG6        ANDEQ     'C'
242390951019     C                   MOVEL     'S'           BLDFST
242400971215     C* DEVO STAMPARE SOLO ETICHETTA ESTERA
242410971215     C     §1BFG0        WHENEQ    'D'
242420971215     C     §1BFG6        ANDEQ     'C'
242430971215     C                   MOVEL     'E'           BLDFST
242440971217     C     §1BFG0        WHENEQ    'C'
242450971217     C     §1BFG6        ANDEQ     'C'
242460971217     C     §1BF11        ANDEQ     'D'
242470971217     C                   MOVEL     'E'           BLDFST
242480971215     C                   OTHER
242490951019     C                   MOVEL     ' '           BLDFST
242500971215     C                   ENDSL
242510971215     C*
242520971215     C                   MOVEL     BLPPDR        BLDPDR
242530910205     C                   MOVEL     BLPLNA        BLDLNA
242540910205     C                   MOVEL     BLPTFA        BLDTFA
242550910405     C                   MOVEL     BLPRSD        BLDRSD
242560910412     C                   MOVEL     BLPRSM        BLDRSM
242570910117     C     BLPCCM        IFGT      0
242580910117     C                   MOVEL     BLPCCM        BLDCCM
242590910117     C                   ELSE
242600910117     C                   MOVEL     BLPKSC        BLDCCM
242610910117     C                   END
242620000204     C**
242630000204     C* SE DEVO CREARE IL FILE METTO LA "S" DI STAMPATO
242640000204     C     WDKC          IFEQ      'S'
242650001003     C     WSGNR         OREQ      'B'
242660000211     C                   EXSR      STASCD
242670001005     C* Reimposto a "S" flag per scrittura fisgn in ristampa perchè
242680001005     C* se viene richiamato deve essere lanciato il pgm di stampa e non
242690001005     C* deve più scrivere fisgn
242700001005     C     WSGNR         IFEQ      'B'
242710001005     C                   MOVEL     'S'           WSGNR
242720001005     C                   ENDIF
242730000914     C                   ENDIF
242740000211     C*
242750000914     C* SE DISK C FLAGGO COME STAMPATO BLDFST
242760020917     C* SE FLAG 12 = E (DISK A CON FIVAT) FLAGGO SOLO SE AS400 ABILITA-
242770001106     C* TO AL DISK C
242780000914     C     *IN79         IFEQ      *ON
242790000925     C     §3CDKC        ANDEQ     'S'
242800000914     C     §1BF12        ORNE      'N'
242810001106     C     §1BF12        ANDNE     'E'
242820001106     C     §1BF12        OREQ      'E'
242830001106     C     WASDKC        ANDEQ     'S'
242840000204     C                   MOVEL     'S'           BLDFST
242850000211     C                   ENDIF
242860910117     C*
242870910204     C   15
242880000911     CORN12
242890000915     COR 12
242900000915     CANN15
242910000915     CAN 33              WRITE     FNBLD000
242920000915     C   12
242930000915     CANN15
242940000915     CANN33              UPDATE    FNBLD000
242950940214     C*
242960940214     C* SE LI AVEVO GIA' STAMPATI LI RISTAMPO SUBITO
242970971217     C*  NON VENGONO RISTAMPATI SE SONO SOLO ESTERO
242980980409     C*  NON RISTAMPO ANCHE SE E' UNA SOLUZIONE A E NON HANNO VARIATO
242990980409     C*  NESSUNO DEI CAMPI CHE INTERESSANO (N.COLLI,LNA,ZONA,CAP DEST.,
243000980409     C*  TSP.) --> WPRT = "N"
243010971217     C     SAVFST        IFEQ      'S'
243020980409     C     WPRT          ANDEQ     ' '
243030001003     C* PER DISK C STASCD L'HO GIA' RICHIAMATA
243040000915     C     WDKC          IFNE      'S'
243050940214     C                   EXSR      STASCD
243060000915     C                   ENDIF
243070060216     C* SE C'E' Fiar4 PER LNA ESTERO SDI AGGIORNO IL FLAG DI STAMPA
243080081008     C**   *IN12         IFEQ      *ON
243090081008     C**   *IN15         ANDEQ     *OFF
243100081008     c**   A_§ogntw      andeq     'EUP'
243110081008     C**                 MOVEL     'E'           WTRC
243120081008     C**   KBLP4         CHAIN     Fiar4000                           90
243130081008    2C**   *IN90         IFEQ      *OFF
243140081008     C**                 MOVEL     ar4NOT        DSBL4E
243150081008     C**                 MOVEL     'S'           §B4EST
243160081008     C**                 MOVEL     DSBL4E        ar4NOT
243170081008     C**                 UPDATE    Fiar4000
243180081008     C**                 ENDIF
243190081008     C**                 SETOFF                                       90
243200081008     C**                 ENDIF
243210971230     C                   ENDIF
243220910117     C*
243230910117     C                   ENDSR
243240940927     C*
243250940927     C* CARICO LA VARIA IN SFL ---------------------------------------*
243260940927     C     CARVAR        BEGSR
243270991012      *
243280991027     C     WSVN          IFNE      ' '
243290950418     C     *IN87         OREQ      *ON
243300991027      *
243310991027     C     WSVN          IFNE      §$2IVA
243320991027     C     WSVN          ANDNE     §$2BOL
243330991027      *
243340940927     C                   ADD       1             NRR
243350940927     C     NRR           CHAIN     LS01S03                            30
243360991027     C                   MOVEL     WSVN          V3CSV1
243370991027     C                   Z-ADD     WVAN          V3CVA1
243380991027     C                   Z-ADD     WVAN          V3HVA1
243390020102    3C     WCONV         IFEQ      '1'
243400020102     C     WVAN          ANDGT     0
243410020102    4C     VIDIMV        IFGT      *ZEROS
243420020102     C     WSVN          ORNE      'N'
243430020102     C     WVAN          ORNE      88888888
243440020102     C                   CLEAR                   DSYEUR
243450020102     C                   MOVEL     VIDDIV        YECDVI
243460020102     C                   MOVEL     §GEDCN        YECDVO
243470020102     C                   Z-ADD     WVAN          YECIMI
243480020102     C     COMFDC        IFEQ      'S'
243490020102     C                   MOVEL     '3'           YECDCO
243500020102     C                   ELSE
243510020102     C                   MOVEL     '0'           YECDCO
243520020102     C                   ENDIF
243530020102     C                   CALL      'YEURCO'
243540020102     C                   PARM                    DSYEUR
243550020102    5C     YECESI        IFEQ      ' '
243560020102     C                   Z-ADD     YECIMO        V3CVA1
243570020102     C                   Z-ADD     YECIMO        V3HVA1
243580020102    5C                   ENDIF
243590020102    4C                   ENDIF
243600020102    3C                   ENDIF
243610941021     C                   MOVEL     WEV1          V3CEV1
243620940927     C   30              WRITE     LS01S03
243630940927     C  N30              UPDATE    LS01S03
243640991027      *
243650940927     C                   ENDIF
243660991027     C                   ENDIF
243670991012      *
243680940927     C                   ENDSR
243690910117     C*
243700971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO ----------------------------*
243710910201     C     STASCI        BEGSR
243720000121     C                   MOVEL     'I'           WSTSEG            1
243730000121     C                   EXSR      RIESEG
243740971215     C**
243750971215     C**  SOLO SE DEVO STAMPARE QUALCHE COSA
243760971215     C     §DETST        IFNE      *BLANKS
243770001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
243780001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
243790001005     C   12
243800001005     CANN15WSGNR         IFEQ      'B'
243810001005     C     KBLP3         SETLL     FISGN05L
243820001005     C                   ENDIF
243830971215     C     CO2SCD        DOWLE     STANCA
243840990318     C     CO2SCD        ANDGT     0
243850980320     C* Routine per segnacolli euroexpress: imposta §DEEUR e §LDCDP
243860980320     C                   EXSR      EUREXP
243870980319     C*
243880910208     C                   ADD       1             §LDNC1
243890911119     C                   Z-ADD     CO2SCD        §LDNCD
243900910201     C*
243910000914     C* SE DISK C NON STAMPO MAI IN IMMEDIATO
243920001018     C* ANCHE SE SCRIVO FISGN SOLO PER RISTAMPA E HO VBARIATO CAMPI
243930001018     C* PER I QUALI NON È NECESSARIO RISTAMPARE IMMEDIATAMENTE L'ETICH.
243940050302     C     *IN79         IFEQ      *OFF
243950050302     C     §1BF12        ANDEQ     'N'
243960050302     C     WNOPRT        ANDNE     '1'
243970001107     C*
243980050302     C     §1BF12        oreq      'E'
243990050302     C     WASDKC        ANDNE     'S'
244000050302     C     WNOPRT        ANDNE     '1'
244010001107     C*
244020050302     C     §1BF12        OREQ      'N'
244030050302     C     *IN79         ANDEQ     *ON
244040050302     C     §3CDKC        ANDNE     'S'
244050050302     C     WNOPRT        ANDNE     '1'
244060001107     C*
244070030611     C                   CALL      WD90pss
244080910201     C                   PARM                    DSBLD
244090971216     C                   PARM                    DSBLDE
244100001005     C                   ENDIF
244110001107     C* SCRITTURA/AGGIORNAMENTO FISGN00F: PER DISKC O PER SOLA RISTAMP
244120050302     C     §1BF12        IFNE      'N'
244130050302     C     §1BF12        ANDNE     'E'
244140050302     C     §1BF12        OREQ      'E'
244150050302     C     WASDKC        ANDEQ     'S'
244160050302     C     *IN79         OREQ      *ON
244170050302     C     §3CDKC        ANDEQ     'S'
244180001005     C     WSGNR         OREQ      'B'
244190000225     C*
244200000225     C* PULISCO PERCHE' HO AGGIORNATO
244210000913    3C                   SELECT
244220050225     c* import dpd (ctm disk c)
244230050225     c     §1bf12        whenne    'N'
244240050225     c     *in79         andeq     *on
244250050302     c     wdkc          ifeq      'S'
244260050225     C     WESSGN        IFEQ      'S'
244270050225     C                   EXSR      UPDSGN
244280050225     C                   ELSE
244290050225     C                   Z-ADD     COMTFP        SGNTNP
244300050225     C                   WRITE     FISGN000
244310050225     C                   ENDIF
244320060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
244330060622     c* anche fisgn con key composta dal solo numero parcel
244340060622     c                   if        §b4ibi<>*blanks
244350060622     c                             and %subst(§b4ipn:14:1)=*blanks
244360060622     c                   clear                   kwho
244370060622     C                   movel     §b4ipn        kwho
244380060622     C                   eval      %subst(kwho:12:1)=§b4icd
244390060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
244400060623     c* serviranno per la seconda scrittura
244410060623     C                   MOVEL     DSBLD         WSBLD
244420060623     C                   MOVEL     DSBLDE        WSBLDE
244430060622     C                   CLEAR                   WESSGN
244440060622     C                   CLEAR                   WSGNR
244450060622     C                   CLEAR                   FISGN000
244460060622     C                   MOVEL     'S'           WDKC              1
244470060622     C                   EXSR      CTRSGN
244480060622     C     WDKC          IFEQ      'S'
244490060623     C                   MOVEL     WSBLD         dsbld
244500060623     C                   MOVEL     WSBLDE        dsblde
244510060622     C     WESSGN        IFEQ      'S'
244520060622     C                   EXSR      UPDSGN
244530060622     C                   ELSE
244540060622     C                   Z-ADD     COMTFP        SGNTNP
244550060622     C                   WRITE     FISGN000
244560060622     C                   ENDIF
244570060622     C                   ENDIF
244580060622     c                   endif
244590050302     C                   ENDIF
244600050221     C* EXPORT DPD DA VAT O MANUALE
244610001009     C     §1BF12        WHENNE    'N'
244620001011     C     WEXDPD        ANDEQ     'S'
244630140714     C     §1BF13        ANDNE     'A'
244631140715     c     §1bf12        andne     'B'
244640070323     c     wparcel       andne     '12'
244650050302     C     WDKC          IFEQ      'S'
244660001009     C     WESSGN        IFEQ      'S'
244670001009     C                   EXSR      UPDSGN
244680001009     C                   ELSE
244690010116     C                   Z-ADD     COMTFP        SGNTNP
244700001009     C                   WRITE     FISGN000
244710001009     C                   ENDIF
244720050302     C                   ENDIF
244730000912     C     §1BF12        WHENNE    'N'
244740000911     C                   Z-ADD     CO2SCD        WO2SCD
244750000911     C                   MOVEL     'C'           WTRC
244760051102     C     KARS01        CHAIN(N)  FIARS01L                           30
244770000913    4C     *IN30         IFEQ      *OFF
244780000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
244790000911     C                   Z-ADD     1             IX
244800051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
244810000911     C     POS(IX)       CHAIN     LS01S08                            30
244820000204     C*
244830000204     C* SCRITTURA DEL FILE  PER DISK "C"
244840000913    5C     V8HDKC        IFEQ      'S'
244850000913    6C     V8HESG        IFEQ      'S'
244860000919     C                   MOVEL     DSBLD         WSBLD
244870000919     C                   MOVEL     DSBLDE        WSBLDE
244880010116     C     KSGN8         CHAIN     FISGN01L                           30
244890000919     C                   MOVEL     WSBLD         DSBLD
244900000919     C                   MOVEL     WSBLDE        DSBLDE
244910000921     C                   EXSR      UPDSGN
244920000913   X6C                   ELSE
244930000929     C                   EXSR      WRTSGN
244940000913    6C                   ENDIF
244950000913    5C                   ENDIF
244960000913    4C                   ENDIF
244970050225     C* IMPORT DPD (ctm no diskc)
244980000912     C     *IN79         WHENEQ    *ON
244990000912     C     WESSGN        IFEQ      'S'
245000000921     C                   EXSR      UPDSGN
245010000912     C                   ELSE
245020010116     C                   Z-ADD     COMTFP        SGNTNP
245030000912     C                   WRITE     FISGN000
245040000912     C                   ENDIF
245050001005     C* SCRIVO O UPDATO FISGN PER RISTAMPA
245060001005     C     WSGNR         WHENEQ    'B'
245070001005     C                   MOVEL     DSBLD         WSBLD
245080001005     C                   MOVEL     DSBLDE        WSBLDE
245090001005     C     KBLP3         READE     FISGN05L                               30
245100001013     C                   MOVE      *IN30         WIN30
245110001005     C                   MOVEL     WSBLD         DSBLD
245120001005     C                   MOVEL     WSBLDE        DSBLDE
245130001013     C                   CLEAR                   DSBLD7
245140001013     C                   MOVE      §LDLNP        §LCLNP
245150001013     C                   MOVE      §LDLNA        §LCLNA
245160001013     C                   MOVE      §LDNRS        §LCNRS
245170001013     C                   MOVE      §LDZSC        §LCZSC
245180001013     C                   MOVE      §LDNCD        §LCNCD
245190001013     C                   EXSR      M10
245200001013     C                   MOVEA     §CA           SGNWHO
245210001013     C                   MOVEA     §CA           V8CNOT
245220001013     C                   MOVE      WIN30         *IN30
245230001005     C     *IN30         IFEQ      *OFF
245240001005     C                   EXSR      UPDSGN
245250001005     C                   ELSE
245260001005     C                   EXSR      WRTSGN
245270001005     C                   ENDIF
245280000913    3C                   ENDSL
245290000204     C                   ENDIF
245300910201     C*
245310910827     C                   ADD       1             CO2SCD
245320910201     C*
245330971215     C                   ENDDO
245340001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
245350001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
245360001005     C   12
245370001005     CANN15WSGNR         IFEQ      'B'
245380001005     C     VIDNCL        ANDLT     SAVNCL
245390001005     C     KBLP3         READE     FISGN05L                               30
245400001005     C     *IN30         DOWEQ     *OFF
245410001005     C                   EXSR      ANNSGN
245420001005     C     KBLP3         READE     FISGN05L                               30
245430001005     C                   ENDDO
245440001005     C                   ENDIF
245450971215     C                   ENDIF
245460910404     C*
245470910117     C                   ENDSR
245480000121     C*
245490000121     C* RIEMPO DS PER STAMPA SEGNACOLLI ------------------------------*
245500000121     C     RIESEG        BEGSR
245510000124     C                   CLEAR                   §DEEUR
245520000124     C                   CLEAR                   §DEAWB
245530000124     C                   CLEAR                   §DEFCA
245540040506     C                   CLEAR                   §DEISA
245550000124     C                   CLEAR                   §DESIA
245560000201     C                   CLEAR                   §DESSE
245570010302     C                   CLEAR                   SAVCDP
245580000124     C*
245590000121     C     WSTSEG        IFEQ      'I'
245600000929     C* WSGNR = 'S' --> Scrivo fisgn per eventuale ristampa
245610001107     C* (Se provengo da manutenzione non devo azzerare nc1 prechè in
245620001107     C*  questo caso devo richiamare pgm di stampa e non scrittura di
245630001107     C*  fisgn. Se azzerassi, la stampa del progressivo sull'etichetta
245640001107     C*  partirebbe da 0 anzichè da 1)
245650000929     C     WSGNR         OREQ      'S'
245660001107     C     *IN12         ANDEQ     *OFF
245670001107     C     WSGNR         OREQ      'S'
245680001107     C     *IN15         ANDEQ     *ON
245690000121     C                   Z-ADD     0             §LDNC1
245700000121     C                   ELSE
245710000121     C                   Z-ADD     BLDNC1        §LDNC1
245720000121     C                   ENDIF
245730000208     C*
245740000208     C                   MOVEL     WDLA          §LDDLA
245750000208     C                   MOVEL     BLPFLS        §LDLNP
245760000121     C     BLPFLS        CHAIN     AZORG01L      UNIORG               30
245770000121     C  N30              MOVEL     ORGDES        §LDDLP
245780000121     C   30              MOVEL     *BLANKS       §LDDLP
245790000121     C     WSTSEG        IFEQ      'D'
245800000121     C                   MOVEL     BLDCDP        §LDCDP
245810000121     C                   ELSE
245820000121      * RIFERIMENTO MITTENTE ALFABETICO
245830000121     C                   MOVEL     BLPRMA        §LDCDP
245840000121     C                   ENDIF
245850000121      *
245860000121      * SE LNP DPD SCRIVO NUMERICO
245870020319     C     §OGNTW        IFEQ      'DPD'
245880060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
245890060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
245900060622     c* in ogni caso non lo prendo più dal rmn
245910060622     c                   if        %subst(§b4ipn:14:1)=*blanks
245920060622     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
245930060622     c                             %subst(§b4ipn:4:8) + ' ' +
245940060622     c                             §b4icd
245950060622     c                   else
245960060622     c                   eval      §ldcdp=§b4ipn
245970060622     c                   endif
245980000121     C                   ENDIF
245990000121      *
246000000121      * PER EXPORT DPD SCRIVO NUMERO PARCEL
246010020319    1C     A_§OGNTW      IFEQ      'DPD'
246020060510    2C     §B4ipn        ANDNE     *BLANKS
246030010302     C* Se RMA diverso da blanks lo devo stampare, allineato a dx,
246040120302     C* nella prima riga di stampa dell'etichetta brt andando
246050010302     C* a coprire in parte la ragione sociale del mittente
246060010302     C* In questo punto mi salvo quindi il rma che andrò a muovere
246070010302     c* nela campo della ragione sociale se <> da blank (v.sotto)
246080060510     c* ATTENZIONE: per numero parcel lungo 14 continuiamo a stamparlo
246090120302     c* sull'etichetta brt ma non più distanziato in quanto
246100060510     c* §ldcdp non è abbastanza lungo
246110010302     C                   MOVE      §LDCDP        SAVCDP
246120060626     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
246130060626     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
246140060626     c                   if        %subst(§b4ipn:14:1)=*blanks
246150060626     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
246160060626     c                             %subst(§b4ipn:4:8) + ' ' +
246170060626     c                             §b4icd
246180060626     c                   else
246190060626     c                   eval      §ldcdp=§b4ipn
246200060626     c                   endif
246210000121    2C                   ENDIF
246220020211     c*
246230020211      * PER EXPORT FEDEX SCRIVO AWB
246240020213    1C     A_§ogntw      IFEQ      'FED'
246250020211     C                   MOVEL     §B4ERP        §LDCDP
246260020211    1C                   ENDIF
246270000201     C*
246280000201     C* ALTRI DATI ETICHETTA ESTERA
246290000201     C                   EXSR      ETIEST
246300000121     C*
246310000121     C                   MOVEL     BLPNRS        §LDNRS
246320000121     C                   MOVEL     BLPLNA        §LDLNA
246330000121     C                   MOVEL     BLPTFA        §LDTNA
246340000121     C                   MOVE      BLPPDR        §LDCPD
246350000121     C                   MOVEL     BLPTSP        §LDTSP
246360000121     C                   MOVEL     BLPZNC        §LDZSC
246370000121     C                   MOVE      BLPNCL        §LDNC2
246380000121     C                   MOVEL     BLPRSM        §LDRSM
246390010302     C* SOLO PER SEGNACOLLI EXPORT DPD:
246400010302     C* MUOVO ALLINEATO, A SX DELLA RSM, IL RMA SE <> DA BLANKS
246410010302     C* E LO COMPATTO PERDENDO CIOÈ I BLANK NON SIGNIFICATIVI
246420010302     C     SAVCDP        IFNE      *BLANKS
246430010302     C                   CLEAR                   W35
246440010302     C                   MOVEA     SAVCDP        W35
246450010302     C     ' '           CHECKR    SAVCDP        §Z                2 0
246460010302     C                   ADD       2             §Z
246470010302     C                   MOVEA     BLPRSM        W35(§Z)
246480010302     C                   MOVEA     W35           §LDRSM
246490010302     C                   ENDIF
246500000121     C                   MOVEL     BLPPRM        §LDPRM
246510000121     C                   MOVEL     BLPRSD        §LDRSD
246520000121     C                   MOVEL     BLPCAD        §LDCAD
246530000121     C                   MOVEL     BLPLOD        §LDLOD
246540000121     C                   MOVEL     BLPIND        §LDIND
246550000121     C                   MOVE      BLPPRD        §LDPRD
246560000121     C                   MOVEL     *ZEROS        §LDNCP
246570000121     C                   MOVEL     *ZEROS        §LDNCU
246580000121     C                   MOVEL     BLPFVF        §LDFVR
246590000121     C                   MOVEL     BLPVLF        §LDVOL
246600000121     C                   MOVEL     BLPPKF        §LDPKG
246610000121     C                   MOVEL     BLPAAS        §LDAAS
246620000121     C                   MOVEL     BLPMGS        §LDMGS
246630050422     c                   clear                   §ldrst
246640050422     c* in conferma o in immissione imposto "V" di valore se collo
246650050422     c* di valore
246660050422     c                   if        (*in12 = *off or *in15 = *on) and
246670050422     c                             vidbva <> *blanks
246680050422     c                   eval      §ldrst = 'V'
246690050422     c                   endif
246700050422     c* in manutenzione metto "M" se modificato no collo di valore
246710050422     c*                 metto "W" se modificato    collo di valore
246720050422     C     *IN12         IFEQ      *ON
246730050422     C     *IN15         ANDEQ     *OFF
246740050422     c     vidbva        ifeq      *blanks
246750050422     c* Se è un disk c non ha senso stampare l'etichetta con la "M" in
246760050422     c* quanto questa esce solo quando il collo passa sull'impianto
246770050422     c     wdkc          ifne      'S'
246780050422     c     wsgnr         andne     'B'
246790050422     C                   MOVEL     'M'           §LDRST
246800050422     c                   endif
246810050422     c                   else
246820050422     c     wdkc          ifne      'S'
246830050422     c     wsgnr         andne     'B'
246840050422     c                   movel     'W'           §ldrst
246850050422     c                   else
246860050422     c                   movel     'V'           §ldrst
246870050422     c                   endif
246880050422     c                   endif
246890050422     c                   endif
246900000121     C                   ENDSR
246910000929     C*
246920971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO COME RISTAMPA DEL "D" ------*
246930910201     C     STASCD        BEGSR
246940910201     C* RICHIAMO DIRETTAMENTE IL PROGRAMMA DI STAMPA SEGNACOLLO
246950910827     C                   Z-ADD     BLDNCD        CO2SCD
246960910201     C     BLDNCA        IFEQ      0
246970910201     C                   Z-ADD     BLDNCD        BLDNCA
246980910201     C                   END
246990040506     C* IMPOSTO DSBLDE
247000081008     C**   WESTER        IFEQ      'S'
247010081008     C**                 MOVEL     'ALL'         §DETST
247020081008     C**                 ELSE
247030040506     C                   MOVEL     'ITA'         §DETST
247040040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
247050040506     c* etichetta Italia con dati esteri
247060040506     C     A_§ogntw      IFEQ      'EEX'
247070040506     C                   MOVEL     'EEX'         §DETSE
247080040506     c                   else
247090040506     c                   clear                   §detse
247100040506     C                   ENDIF
247110081008     C***                ENDIF
247120000121     C* RIEMPO LE DS
247130060622     C                   MOVEL     'D'           WSTSEG
247140000121     C                   EXSR      RIESEG
247150000211     C**
247160000919     C*
247170001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
247180001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
247190001005     C   12
247200001005     CANN15WSGNR         IFEQ      'B'
247210001019     C     WSTSGN        ANDEQ     *BLANKS
247220001005     C     KBLP3         SETLL     FISGN05L
247230001019     C                   MOVE      '1'           WSTSGN            1
247240001005     C                   ENDIF
247250980320     C*
247260000908     C     CO2SCD        DOWLE     BLDNCA
247270990318     C     CO2SCD        ANDGT     0
247280980320     C* Routine per impostazione campi segnacollo euroexpress di dsblde
247290980320     C                   EXSR      EUREXP
247300911122     C                   Z-ADD     CO2SCD        §LDNCD
247310910201     C*
247320000204     C     WDKC          IFNE      'S'
247330001003     C     WSGNR         ANDNE     'B'
247340030611     C                   CALL      WD90pss
247350910201     C                   PARM                    DSBLD
247360971216     C                   PARM                    DSBLDE
247370000913     C                   ELSE
247380000225     C*
247390000225     C* PULISCO PERCHE' HO AGGIORNATO
247400000912    3C                   SELECT
247410050224     C* IMPORT DPD
247420050224     c     §1bf12        whenne    'N'
247430050224     C     *IN79         andeq     *ON
247440050224     C     WDKC          IFEQ      'S'
247450050224     C     WESSGN        IFEQ      'S'
247460050224     C                   EXSR      UPDSGN
247470050224     C                   ELSE
247480050224     C                   Z-ADD     COMTFP        SGNTNP
247490050224     C                   WRITE     FISGN000
247500050224     C                   ENDIF
247510050224     C                   ENDIF
247520060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
247530060622     c* anche fisgn con key composta dal solo numero parcel
247540060622     c                   if        §b4ibi<>*blanks
247550060622     c                             and %subst(§b4ipn:14:1)=*blanks
247560060622     c                   clear                   kwho
247570060622     C                   movel     §b4ipn        kwho
247580060622     C                   eval      %subst(kwho:12:1)=§b4icd
247590060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
247600060623     c* serviranno per la seconda scrittura
247610060623     C                   MOVEL     DSBLD         WSBLD
247620060623     C                   MOVEL     DSBLDE        WSBLDE
247630060622     C                   CLEAR                   WESSGN
247640060622     C                   CLEAR                   WSGNR
247650060622     C                   CLEAR                   FISGN000
247660060622     C                   MOVEL     'S'           WDKC              1
247670060622     C                   EXSR      CTRSGN
247680060622     C     WDKC          IFEQ      'S'
247690060623     C                   MOVEL     WSBLD         dsbld
247700060623     C                   MOVEL     WSBLDE        dsblde
247710060622     C     WESSGN        IFEQ      'S'
247720060622     C                   EXSR      UPDSGN
247730060622     C                   ELSE
247740060622     C                   Z-ADD     COMTFP        SGNTNP
247750060622     C                   WRITE     FISGN000
247760060622     C                   ENDIF
247770060622     C                   ENDIF
247780060622     c                   endif
247790050221     C* DISK C EXPORT DPD DA vat O MANUALE
247800001009     C     §1BF12        WHENNE    'N'
247810001011     C     WEXDPD        ANDEQ     'S'
247820140714     C     §1BF13        ANDNE     'A'
247821140715     c     §1bf12        andne     'B'
247830070323     C     wparcel       ANDNE     '12'
247840001009     C     WDKC          IFEQ      'S'
247850001009     C     WESSGN        IFEQ      'S'
247860001009     C                   EXSR      UPDSGN
247870001009     C                   ELSE
247880010116     C                   Z-ADD     COMTFP        SGNTNP
247890001009     C                   WRITE     FISGN000
247900001009     C                   ENDIF
247910001009     C                   ENDIF
247920000912     C     §1BF12        WHENNE    'N'
247930000911     C                   Z-ADD     CO2SCD        WO2SCD
247940000911     C                   MOVEL     'C'           WTRC
247950051102     C     KARS01        CHAIN(N)  FIARS01L                           30
247960000912    4C     *IN30         IFEQ      *OFF
247970000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
247980000911     C                   Z-ADD     1             IX
247990051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
248000000911     C     POS(IX)       CHAIN     LS01S08                            30
248010000204     C*
248020000204     C* SCRITTURA DEL FILE  PER DISK "C"
248030000912    5C     V8HDKC        IFEQ      'S'
248040000912    6C     V8HESG        IFEQ      'S'
248050000919     c* prima di chainare fisgn mi salvo la ds
248060000919     C                   MOVEL     DSBLD         WSBLD
248070000919     C                   MOVEL     DSBLDE        WSBLDE
248080010116     C     KSGN8         CHAIN     FISGN01L                           30
248090000919     C                   MOVEL     WSBLD         DSBLD
248100000919     C                   MOVEL     WSBLDE        DSBLDE
248110000912     C                   EXSR      UPDSGN
248120000912   X6C                   ELSE
248130000929     C                   EXSR      WRTSGN
248140000912    6C                   ENDIF
248150000912    5C                   ENDIF
248160000912    4C                   ENDIF
248170050224     C* IMPORT DPD (ctm no disk c)
248180000912     C     *IN79         WHENEQ    *ON
248190000912     C     WESSGN        IFEQ      'S'
248200000912     C                   EXSR      UPDSGN
248210000912     C                   ELSE
248220010116     C                   Z-ADD     COMTFP        SGNTNP
248230000912     C                   WRITE     FISGN000
248240000912     C                   ENDIF
248250001003     C* FISGN IN RISTAMPA
248260001003     C     WSGNR         WHENEQ    'B'
248270001005     c* prima di leggere fisgn mi salvo la ds
248280001005     C                   MOVEL     DSBLD         WSBLD
248290001005     C                   MOVEL     DSBLDE        WSBLDE
248300001005     C     KBLP3         READE     FISGN05L                               30
248310001013     C                   MOVE      *IN30         WIN30             1
248320001005     C                   MOVEL     WSBLD         DSBLD
248330001005     C                   MOVEL     WSBLDE        DSBLDE
248340001013     C                   CLEAR                   DSBLD7
248350001013     C                   MOVE      §LDLNP        §LCLNP
248360001013     C                   MOVE      §LDLNA        §LCLNA
248370001013     C                   MOVE      §LDNRS        §LCNRS
248380001013     C                   MOVE      §LDZSC        §LCZSC
248390001013     C                   MOVE      §LDNCD        §LCNCD
248400001013     C                   EXSR      M10
248410001013     C                   MOVEA     §CA           SGNWHO
248420001013     C                   MOVEA     §CA           V8CNOT
248430001013     C                   MOVE      WIN30         *IN30
248440001005     C     *IN30         IFEQ      *OFF
248450001005     C                   EXSR      UPDSGN
248460001005     C                   ELSE
248470001003     C                   EXSR      WRTSGN
248480001005     C                   ENDIF
248490000912    3C                   ENDSL
248500000911     C                   ENDIF
248510910201     C*
248520910827     C                   ADD       1             CO2SCD
248530910313     C                   ADD       1             §LDNC1
248540910201     C*
248550910201     C                   END
248560001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
248570001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
248580001005     C   12
248590001005     CANN15WSGNR         IFEQ      'B'
248600001005     C     VIDNCL        ANDLT     SAVNCL
248610001005     C     KBLP3         READE     FISGN05L                               30
248620001005     C     *IN30         DOWEQ     *OFF
248630001005     C                   EXSR      ANNSGN
248640001005     C     KBLP3         READE     FISGN05L                               30
248650001005     C                   ENDDO
248660001005     C                   ENDIF
248670910201     C                   ENDSR
248680910805     C*
248690910805     C*--- CREO FLBLT00F ---------------------------------------------*
248700910805     C     CRTBLT        BEGSR
248710940926     C                   CLEAR                   FNBLT000
248720910805     C                   MOVEL     BLPAAS        BLTAAS
248730940926     C                   MOVEL     BLPLNP        BLTLNP
248740910805     C                   MOVEL     BLPNRS        BLTNRS
248750000921     C                   MOVEL     BLPNSP        BLTNSP
248760910828     C                   MOVEL     BLPLNA        BLTLNA
248770910828     C                   MOVEL     BLPFLS        BLTFLS
248780060622     C                   MOVEL     BLPNFV        BLTNFV
248790920910     C                   MOVEL     BLPFLP        BLTFLP
248800940926     C                   MOVEL     WNSC          BLTNSC
248810940915     C                   WRITE     FNBLT000
248820120817     c* richiamo creazione dettaglio colli unico
248830120817     c                   exsr      crtFIART
248840980318     C*
248850000908     C* RICHIAMO CREAZIONE ESTENSIONE DETTAGLIO SEGNACOLLO
248860000908     C* PER MEMORIZZAZIONE COD. "CHI SONO"
248870051102     C                   EXSR      CRTARS
248880910805     C*
248890910805     C                   ENDSR
248900120814     C*--- CREO FIART00F ---------------------------------------------*
248910120814     C     crtFIART      BEGSR
248920120814     C                   CLEAR                   FIART000
248930120814     C                   MOVEL     BLPAAS        ARTAAS
248940120814     C                   MOVEL     BLPLNP        ARTLNP
248950120814     C                   MOVEL     BLPNRS        ARTNRS
248960120814     C                   MOVEL     BLPNSP        ARTNSP
248970120814     C                   MOVEL     BLPLNA        ARTLNA
248980120814     C                   MOVEL     BLPFLS        ARTFLS
248990120814     C                   MOVEL     BLPNFV        ARTNFV
249000120814     C                   MOVEL     BLPFLP        ARTFLP
249010120814     C                   MOVEL     WNSC          ARTNSC
249020120814     C                   WRITE     FIART000
249030120814     c                   endsr
249040051102     C*--- CREO FIARS00F ---------------------------------------------*
249050051102     C     CRTARS        BEGSR
249060001009     C*
249070001013    1C                   SELECT
249080050221     C* DISK C EXPORT DPD DA vat O MANUALE
249090001011     C     WEXDPD        WHENEQ    'S'
249100140714     C     §1BF13        ANDNE     'A'
249110001009     C     §1BF12        ANDNE     'N'
249111140715     C     §1BF12        ANDNE     'B'
249120070322     c     wparcel       andne     '12'
249130051102     C                   CLEAR                   FIARS000
249140120817     C***                MOVE      BLTFLS        ARSFLS
249150120817     C***                MOVE      BLTLNA        ARSLNA
249160120817     C***                MOVE      BLTNRS        ARSNRS
249170120817     C***                MOVE      BLTNSC        ARSNSC
249180120817     C                   MOVE      ARTFLS        ARSFLS
249190120817     C                   MOVE      ARTLNA        ARSLNA
249200120817     C                   MOVE      ARTNRS        ARSNRS
249210120817     C                   MOVE      ARTNSC        ARSNSC
249220051102     C                   MOVEL     'C'           ARSTRC
249230051102     C                   MOVEL     V7CNPR        ARSNOT
249240051114     C                   MOVEL     dateu         ARSduv
249250051102     C                   WRITE     FIARS000
249260050224     c* Disk C import DPD
249270050224     c     *in79         wheneq    *on
249280050224     c     §1bf12        andne     'N'
249290051102     C                   CLEAR                   FIARS000
249300120817     C***                MOVE      BLTFLS        ARSFLS
249310120817     C***                MOVE      BLTLNA        ARSLNA
249320120817     C***                MOVE      BLTNRS        ARSNRS
249330120817     C***                MOVE      BLTNSC        ARSNSC
249340120817     C                   MOVE      ARTFLS        ARSFLS
249350120817     C                   MOVE      ARTLNA        ARSLNA
249360120817     C                   MOVE      ARTNRS        ARSNRS
249370120817     C                   MOVE      ARTNSC        ARSNSC
249380051102     C                   MOVEL     'C'           ARSTRC
249390060622     c***                z-add     blprmn        w0120
249400060622     C***                MOVEL     w0120         ARSNOT
249410060622     c                   movel     v7cnpr        arsnot
249420051114     C                   MOVEL     dateu         ARSduv
249430051102     C                   WRITE     FIARS000
249440980318     C*
249450000908     C* DISK C
249460000608     C*
249470000908     C     §1BF12        WHENNE    'N'
249480000908     C     NR8           CHAIN     LS01S08                            30
249490000908     C     *IN30         DOWEQ     *OFF
249500000908     C     V8CSCE        ANDEQ     'A'
249510000908     C                   ADD       1             NR8
249520000908     C     NR8           CHAIN     LS01S08                            30
249530000908     C                   ENDDO
249540000908     C     *IN30         IFEQ      *OFF
249550051102     C                   CLEAR                   FIARS000
249560120817     C***                MOVE      BLTFLS        ARSFLS
249570120817     C***                MOVE      BLTLNA        ARSLNA
249580120817     C***                MOVE      BLTNRS        ARSNRS
249590120817     C***                MOVE      BLTNSC        ARSNSC
249600120817     C                   MOVE      ARTFLS        ARSFLS
249610120817     C                   MOVE      ARTLNA        ARSLNA
249620120817     C                   MOVE      ARTNRS        ARSNRS
249630120817     C                   MOVE      ARTNSC        ARSNSC
249640051102     C                   MOVEL     'C'           ARSTRC
249650051102     C                   MOVEL     V8CNOT        ARSNOT
249660051114     C                   MOVEL     dateu         ARSduv
249670051102     C                   WRITE     FIARS000
249680000911     C                   ADD       1             NR8
249690000908     C                   ENDIF
249700120302     C* SE IMPORT BRT DEVO MEMORIZZARE SEMPRE SU ARS ANCHE
249710000911     C* RECORD TIPO 'E' PER SEGNACOLLO EUROEXPRESS
249720020211     c     §ogntw        ifeq      'EEX'
249730000911     C     §1BF12        ANDEQ     'E'
249740051102     C                   CLEAR                   FIARS000
249750120817     C***                MOVE      BLTFLS        ARSFLS
249760120817     C***                MOVE      BLTLNA        ARSLNA
249770120817     C***                MOVE      BLTNRS        ARSNRS
249780120817     C***                MOVE      BLTNSC        ARSNSC
249790120817     C                   MOVE      ARTFLS        ARSFLS
249800120817     C                   MOVE      ARTLNA        ARSLNA
249810120817     C                   MOVE      ARTNRS        ARSNRS
249820120817     C                   MOVE      ARTNSC        ARSNSC
249830051102     C                   MOVEL     'E'           ARSTRC
249840051102     C                   MOVEL     V8CNOT        ARSNOT
249850051114     C                   MOVEL     dateu         ARSduv
249860051102     C                   WRITE     FIARS000
249870000911     C                   ENDIF
249880000908    1C                   ENDSL
249890051020     c*
249900051020     c                   select
249910120302     C* EXPORT BRT
249920051020     c     A_§ogntw      wheneq    'EEX'
249930051102     C                   CLEAR                   FIARS000
249940120817     C***                MOVE      BLTFLS        ARSFLS
249950120817     C***                MOVE      BLTLNA        ARSLNA
249960120817     C***                MOVE      BLTNRS        ARSNRS
249970120817     C***                MOVE      BLTNSC        ARSNSC
249980120817     C                   MOVE      ARTFLS        ARSFLS
249990120817     C                   MOVE      ARTLNA        ARSLNA
250000120817     C                   MOVE      ARTNRS        ARSNRS
250010120817     C                   MOVE      ARTNSC        ARSNSC
250020051102     C                   MOVEL     'E'           ARSTRC
250030051020     c                   clear                   dsbld7
250040120817     c***                eval      §lclnp=bltfls
250050120817     c***                eval      §lclna=bltlna
250060120817     c***                eval      §lcnrs=bltnrs
250070120817     c***                eval      §lcncd=bltnsc
250080120817     c                   eval      §lclnp=artfls
250090120817     c                   eval      §lclna=artlna
250100120817     c                   eval      §lcnrs=artnrs
250110120817     c                   eval      §lcncd=artnsc
250120051020     c                   eval      §lczsc=blpznc
250130051020     c                   exsr      m10
250140051102     C                   MOVEA     §CA           ARSnot
250150051114     C                   MOVEL     dateu         ARSduv
250160051020     C*
250170051102     C                   WRITE     FIARS000                             30
250180051020     C* EXPORT FEDEX
250190051020     c     A_§ogntw      wheneq    'FED'
250200051102     C                   CLEAR                   FIARS000
250210120817     C***                MOVE      BLTFLS        ARSFLS
250220120817     C***                MOVE      BLTLNA        ARSLNA
250230120817     C***                MOVE      BLTNRS        ARSNRS
250240120817     C***                MOVE      BLTNSC        ARSNSC
250250120817     C                   MOVE      ARTFLS        ARSFLS
250260120817     C                   MOVE      ARTLNA        ARSLNA
250270120817     C                   MOVE      ARTNRS        ARSNRS
250280120817     C                   MOVE      ARTNSC        ARSNSC
250290051102     C                   MOVEL     'F'           ARSTRC
250300051020     c                   movel     wawb          w0012a           12
250310051020     c* calcolo check digit
250320051020     c                   exsr      chkdgf
250330051102     c                   movel     w0012a        ARSnot
250340051114     C                   MOVEL     dateu         ARSduv
250350051020     C*
250360051102     C                   WRITE     FIARS000
250370051020     c                   add       1             wawb
250380051020     C                   ENDsl
250390980318     C                   ENDSR
250400980320     C*--- COMPATTO IL CAP TOGLIENDO TUTTI I BLANK -------------------*
250410980320     C     WRKCAP        BEGSR
250420011120     C     WNO55L        IFEQ      *BLANKS
250430980320     C* Compongo il segnacollo Euroexpress
250440980320     C                   MOVE      *ZEROS        §Y                2 0
250450980320     C                   MOVE      *BLANKS       §S9
250460980320     C                   MOVE      *BLANK        §O9
250470980320     C                   MOVEA     WRKCAD        §S9
250480980320     C* Compatto il cap togliendo tutti i blank
250490980320    2C                   DO        9             §X1               2 0
250500980320    3C     §S9(§X1)      IFNE      *BLANKS
250510980320     C                   ADD       1             §Y
250520980320     C                   MOVE      §S9(§X1)      §O9(§Y)
250530980320    3C                   END
250540980320    2C                   END
250550011120     C                   ENDIF
250560980320     C* Prendo codice iso della nazione
250570980320     C                   MOVEL     '15'          COD
250580980320     C                   MOVEL(P)  BLPNZD        KEY
250590980320     C                   EXSR      CTABEL
250600980320     C   30              CLEAR                   DS15
250610980320     C  N30              MOVEL     TBLUNI        DS15
250620980320     C* Unisco il cap compattato alla nazione
250630980320     C                   MOVEL     §15COD        W15COD            2
250640980320     C                   ENDSR
250650051102     C*--- AGGIORNO FIARS00F -----------------------------------------*
250660051102     C     AGGARS        BEGSR
250670040514     c                   clear                   jf                2 0
250680980320     C                   MOVEL     'E'           WTRC
250690020213    1C     A_§ogntw      IFEQ      'EEX'
250700120817     C***  KBLT1         SETLL     FNBLT01L
250710120817     C***  KBLT1         READE(N)  FNBLT01L                               30
250720120817     C     KBLT1         SETLL     FIART01L
250730120817     C     KBLT1         READE(N)  FIART01L                               30
250740980320    2C     *IN30         DOWEQ     *OFF
250750120817     C***  KARS1         CHAIN     FIARS01L                           30
250760120817     C     KARS1A        CHAIN     FIARS01L                           30
250770980320    3C     *IN30         IFEQ      *OFF
250780051102     c                   eval      jf=%scan(wjut:ARSnot)
250790040514    4c     jf            ifgt      *zeros
250800051102     C                   MOVEL     ARSNOT        DSEEX
250810980320     C* Compatto il cap nuovo e prendo cod.iso
250820980320     C                   MOVEL     VIDCAD        WRKCAD
250830980320     C                   EXSR      WRKCAP
250840011120     C     WNO55L        IFEQ      *BLANKS
250850980320     C                   MOVEA     §O9           WCAD
250860980320     C* Unisco il cap compattato alla nazione salvata
250870980408     C                   CLEAR                   WCADN
250880980320     C     WCAD          CAT       W15COD:0      WCADN
250890011107     C                   ELSE
250900011107     C                   CLEAR                   WCADN
250910011126     C                   CLEAR                   W55L
250920011120     C                   MOVEL     W15COD        W15C
250930011107     C                   ENDIF
250940980320     C*
250950051102     C                   MOVEL     DSEEX         ARSNOT
250960051114     C                   MOVEL     dateu         ARSduv
250970051102     C                   UPDATE    FIARS000
250980040514    4c                   endif
250990980320    3C                   END
251000040514     c     jf            ifgt      *zeros
251010120817     C**** KBLT1         READE(N)  FNBLT01L                               30
251020120817     C     KBLT1         READE(N)  FIART01L                               30
251030040514     c                   else
251040040514     c                   seton                                        30
251050040514     c                   endif
251060980320    2C                   ENDDO
251070980320    1C                   END
251080980320     C                   ENDSR
251090980320     C*--- IMPOSTO CAMPI SEGNAC.EUROEX DA PASSARE A PGM DI STAMPA ----*
251100980320     C     EUREXP        BEGSR
251110040505     C     §ogntw        ifeq      'EEX'
251120980320     C                   MOVEL     'E'           WTRC
251130980320     C                   Z-ADD     CO2SCD        WO2SCD            7 0
251140051102     C     KARS01        CHAIN(N)  FIARS01L                           30
251150980320    2C     *IN30         IFEQ      *OFF
251160980320     C* PASSO AL PGM DI STAMPA ETICHETTE IL N. SEGNACOLLO EUROEXPRESS
251170051102     C                   MOVEL     ARSNOT        §DEEUR
251180120302     C* SE IMPORT BRT METTO NEL CODICE PRODOTTO DELL'ETICHETTA
251190980320     C* ITALIA IL N.SEGNACOLLO EUROEXPRESS
251200000209     C*
251210051102     C                   MOVEA     ARSNOT        W35
251220980330     C                   Z-ADD     1             BB                2 0
251230980330     C     ' '           LOOKUP    W35(BB)                                30
251240980330     C   30              MOVEA     *BLANKS       W35(BB)
251250980330     C                   MOVEA     W35(6)        §LDCDP
251260980320    2C                   ENDIF
251270980320    1C                   ENDIF
251280020212     c* EXPORT FEDEX
251290020213    1C     A_§ogntw      IFEQ      'FED'
251300020212     C                   MOVEL     'F'           WTRC
251310020212     C                   Z-ADD     CO2SCD        WO2SCD            7 0
251320051102     C     KARS01        CHAIN(N)  FIARS01L                           30
251330020212    2C     *IN30         IFEQ      *OFF
251340020212     C* METTO NEL CODICE PRODOTTO DELL'ETICHETTA ITALIA il n.segnac. FEDEX
251350051102     C                   MOVEL     ARSNOT        §ldcdp
251360020212    2C                   ENDIF
251370020212    1C                   ENDIF
251380980320     C                   ENDSR
251390980409     C*
251400980409     C*--- SBORDERIZZAZIONE ------------------------------------------*
251410980409     C     SBORD         BEGSR
251420981020     C                   SETOFF                                       30
251430980409     C     KBLP3         SETLL     FNBLT000
251440980409    1C     *IN30         DOWEQ     *OFF
251450980409     C     KBLP3         READE     FNBLT000                               30
251460980409     C* SOLO SE NON C'E' GIA' LA DATA DI PARTENZA
251470980409    2C  N30BLTDFV        IFEQ      0
251480980409     C                   CLEAR                   BLTNFV
251490980409     C                   UPDATE    FNBLT000
251500120814     c     kfiart        chain     fiart01l
251510120814     c                   if        %found(fiart01l)
251520120814     C                   CLEAR                   ARTNFV
251530120814     C                   UPDATE    FIART000
251540120814     c                   endif
251550980409    2C                   ENDIF
251560980409    1C                   ENDDO
251570980409     C                   ENDSR
251580940916     C*
251590930708     C*--- CHAIN TABEL00F --------------------------------------------*
251600930708     C     CTABEL        BEGSR
251610930708     C     KTAB2         CHAIN     TABEL                              30
251620930708     C  N30TBLFLG        IFNE      ' '
251630930708     C                   SETON                                        30
251640930708     C                   END
251650930708     C                   ENDSR
251660930708     C*
251670930708     C*--- READ  TABEL00F --------------------------------------------*
251680930708     C     RTABEL        BEGSR
251690930708     C     KTAB3         READE     TABEL                                  30
251700930708     C                   ENDSR
251710940214     C*
251720940214     C*--- PASSO DATI PER CALCOLARE CONSEGNA TEORICA -----------------*
251730940214     C     CLSE98        BEGSR
251740970925     C                   CLEAR                   DSSD99
251750940214     C*
251760941230     C     VIDTSP        IFNE      *BLANKS
251770940214     C                   MOVEL     VIDTSP        D98TSP
251780941230     C                   ELSE
251790941230     C                   MOVEL     COMTSP        D98TSP
251800941230     C                   ENDIF
251810940214     C                   MOVEL     VIDCAD        D98CAD
251820970925     C                   MOVEL     VIDLOD        D98LOD
251830950102     C                   MOVEL     VIDNZD        D98NZD
251840940628     C* CALCOLO FLAG INOLTRO
251850940628     C                   EXSR      INOLTR
251860940628     C                   MOVEL     WFIN          D98FIN
251870940214     C*
251880001031     C* TERMINAL DI PARTENZA
251890960130     C                   MOVEL     COMTFP        D98TFP
251900940214     C*
251910001031     C* TERMINAL DI ARRIVO
251920970925     C                   CLEAR                   DSLV55
251930970925     C                   MOVEL     'A'           D55TPT
251940001031     C                   MOVEL     VIDLNP        D55LNP
251950001031     C*
251960970925     C                   MOVEL     COMLNA        D55LIN
251970970925     C                   MOVEL     BLPDSP        D55DRF
251980970925     C                   CALL      'FNLV55R'
251990970925     C                   PARM                    DSLV55
252000970925     C*
252010001031    1C     D55ERR        IFEQ      ' '
252020970925     C                   MOVEL     D55TFA        D98TFA
252030970925     C                   ELSE
252040970925     C                   MOVEL     COMLNA        D98TFA
252050001031    1C                   ENDIF
252060960927     C*
252070970925     C                   MOVEL     VIDLNP        D98LNP
252080970925     C                   MOVEL     COMLNA        D98LNA
252090940214     C                   MOVEL     BLPDSP        D98DSP
252100950102     C                   MOVE      BLPDSP        D98MGS
252110940214     C                   MOVEL     VIDGC1        D98GC1
252120940214     C                   MOVEL     VIDGC2        D98GC2
252130950102     C                   MOVEL     §3ATB1        D98TBL
252140950102     C                   MOVEL     WKSC          D98KSC
252150130826     c                   if        %subst(%editc(wksc:'X'):4:4)='9999'
252160130826     c                   move      8888          d98ksc
252170130826     c                   endif
252180100219     c* In alcuni casi, per la delivery, non devo tenere conto dei tempi
252190100219     c*  del C/Ass e fermo deposito
252200100219     c                   if        UsaCass=' '
252210010823     C                   Z-ADD     VIDCAS        D98CAS
252220010823     C                   MOVEL     VIDVCA        D98VCA
252230940214     C                   MOVEL     VIDTIC        D98TIC
252240940214     C                   MOVEL     VIDFFD        D98FFD
252250010214     C     D98FFD        IFEQ      'N'
252260010214     C                   MOVE      *BLANKS       D98FFD
252270010214     C                   ENDIF
252280100219     C                   ENDIF
252290950102     C*
252300970925     C                   CALL      'TNSD99R'
252310970925     C                   PARM                    DSSD99
252320940214     C* FLAG CHE TENGO MEMORIZZATO PER POI CHIUDERE I FILES
252330940214     C                   MOVEL     '1'           WCL98             1
252340940214     C*
252350100219     c                   clear                   UsaCass
252360900427     C                   ENDSR
252370950126     C*
252380950126     C* SPENGO INDICATORI DELLA 1 VIDEATA ---------------------------*
252390950126     C     OFFD01        BEGSR
252400950126     C                   SETOFF                                       404142
252410000313     C                   SETOFF                                       614356
252420950126     C                   SETOFF                                       455150
252430950126     C                   SETOFF                                       626346
252440950126     C                   SETOFF                                       474849
252450950126     C                   SETOFF                                       646566
252460950126     C                   SETOFF                                       676869
252470950126     C                   SETOFF                                       701090
252480950303     C                   SETOFF                                       553871
252490000120     C                   SETOFF                                       5257
252500010222     C                   CLEAR                   H1RIGA
252510010222     C                   CLEAR                   H1COLO
252520010214     C                   CLEAR                   H0RIGA
252530010214     C                   CLEAR                   H0COLO
252540071107     c****               if        dateu<§vpodrt
252550071107     C****               CLEAR                   ATRDRT
252560071107     c****               endif
252570010214     C                   CLEAR                   ATRPDR
252580010214     C                   CLEAR                   ATRCCM
252590010214     C                   CLEAR                   ATRFFD
252600010214     C                   CLEAR                   ATRFPP
252610010220     C                   CLEAR                   ATRLNA
252620010305     C                   CLEAR                   ATRNCL
252630010305     C                   CLEAR                   ATRPKG
252640100319     C                   CLEAR                   ATRTSP
252650950126     C                   ENDSR
252660950126     C*
252670950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE -------------*
252680950126     C     OFFD02        BEGSR
252690950126     C                   SETOFF                                       929399
252700950126     C                   SETOFF                                       414243
252710961111     C                   SETOFF                                       454686
252720950126     C                   SETOFF                                       474849
252730950126     C                   SETOFF                                       505152
252740950126     C                   SETOFF                                       535455
252750950126     C                   SETOFF                                       565759
252760950126     C                   SETOFF                                       606162
252770950126     C                   SETOFF                                       636465
252780950410     C                   SETOFF                                       586667
252790950410     C                   SETOFF                                       686970
252800950126     C                   SETOFF                                       717273
252810950126     C                   SETOFF                                       109040
252820950126     C                   SETOFF                                       808182
252830950126     C                   SETOFF                                       839784
252840961111     C                   SETOFF                                       747586
252850991117     C                   SETOFF                                       77
252860040610     c     atrbva        ifne      prri
252870040610     c                   movel     hiul          atrbva
252880040610     c                   endif
252890040216
252900040301     c                   Eval      wkk = *Off
252910021217
252920021218     c                   Clear                   H2riga
252930021218     c                   Clear                   H2colo
252940021217
252950950126     C                   ENDSR
252960950126     C*
252970950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE 3 VIDEATA-----*
252980950126     C     OFFD03        BEGSR
252990991025     C                   SETOFF                                       404142
253000991025     C                   SETOFF                                       434546
253010991025     C                   SETOFF                                       474849
253020991025     C                   SETOFF                                       505152
253030991025     C                   SETOFF                                       5390
253040040116     c                   Clear                   Atrsv2
253050040116     c                   Clear                   Atrsv3
253060040116     c                   Clear                   Atrsv4
253070041217     c                   Clear                   Atrsv5
253080041217     c                   Clear                   Atrsv6
253090950126     C                   ENDSR
253100950126     C*
253110950126     C* SE DISK CLIENTI CON "X" ESCO DAL PGM ED EMETTO NUOVA BOLLA----*
253120091111     C     ESCIER        BEGSR
253130950126     C*
253140091111     c* devo entrare se presente errore (90 on) oppure se devo per forza
253150091111     c* emettere una videata
253160020123     c     *in90         ifeq      *on
253170091111     c     wvidobb       oreq      '1'
253180020123     C     §LPFPR        IFEQ      'V'
253190950419     C     §LPFPR        OREQ      'X'
253200950126     C     *IN12         OREQ      *OFF
253210950126     C     *IN15         OREQ      *OFF
253220010305     C     §LPFPR        IFNE      'O'
253230950126     C  N12
253240950126     COR 12
253250950126     CANN15              CLEAR                   §LPFPR
253260070307     C                   ENDIF
253270950126     C*
253280950126     C                   ELSE
253290950126     C*
253300950126     C                   MOVEL     '5'           §LPFPR
253310950126     C                   ENDIF
253320020123     C                   ENDIF
253330950126     C                   ENDSR
253340950127     C* SE E' STATA BATTUTA UNA CHIAVE RICERCA
253350950127     C*          E NON E STATO IMMESSO CODICE-01 ON ABILITATA LA RICERC
253360950127     C     RICALF        BEGSR
253370950127    1C   01WCCM          IFEQ      0
253380950127     C     PAXDMT        ANDNE     *BLANKS
253390950127     C* DESCRIZIONE AZIENDA
253400950127     C                   MOVEL     VIDDSA        PAXDUT           30
253410950127     C* PAXSTA=9 ESCLUDO ANNULLATI
253420950127     C                   Z-ADD     9             PAXSTA
253430950127     C* CAPOCONTO CLIENTI
253440950127     C                   Z-ADD     KCI           PAXCCC
253450950127     C* CODICE DA RICERCARE: SE IMMESSA LNP CERCO SOLO AL SUO INTERNO
253460000207     C                   MOVEL(P)  WFLC          PAXFLR
253470980929     C                   CLEAR                   PAXDIT
253480000121     C                   Z-ADD     1             PAXNUM
253490950127     C*
253500000121     C                   CALL      'XALFA3BR'
253510950127     C                   PARM                    PAXDUT
253520950127     C                   PARM                    CODUT
253530950127     C                   PARM                    PAXDMT
253540950127     C                   PARM                    PAXCCC
253550950127     C                   PARM                    PAXSTA            1 0
253560961016     C                   PARM                    PAXFLR           90
253570980701     C                   PARM                    PAXDIT            3
253580000121     C                   PARM                    PAXNUM            2 0
253590000121     C                   PARM                    PAXKCM           80
253600000121     C                   PARM                    PAXKSM          140
253610000121     C                   PARM                    PAXKDM           60
253620950127     C*
253630950127     C                   MOVEL     '1'           WEMFOR
253640950127     C* NON TROVATO O PREMUTO CMD12
253650950127    2C     PAXSTA        IFGT      -1
253660950127     C* CODICE SELEZIONATO: IMPOSTO A VIDEO
253670000127     C                   MOVEL     PAXKSM        W0070             7 0
253680000127     C                   MOVE      W0070         WCCM
253690000127     C                   MOVEL     W0070         W0030
253700950127     C                   SETON                                        50
253710950127     C*
253720950127     C* SE LA LINEA DEL CODICE NON CORRISPONDE ALLA LINEA PARTENZA
253730960926     C*  IMPOSTO ANCHE IL PUNTO OPEATIVO CLIENTE
253740950127     C     W0030         IFNE      WLNP
253750950127     C                   MOVEL     W0030         WFLC
253760950127     C                   SETON                                        14
253770950127     C                   ENDIF
253780950127    2C                   ENDIF
253790950127    1C                   ENDIF
253800950127     C                   ENDSR
253810950104     C**************************************************************************
253820950104     C*  ABBLANCA ZERO NON SIGNIFICATIVI
253830950104     C**************************************************************************
253840950104     C     ABBL          BEGSR
253850950104     C*
253860950104     C     SKI(I)        DOWEQ     '0'
253870950717     C     I             ANDLT     15
253880950104     C                   MOVEL     ' '           SKI(I)
253890950104     C                   ADD       1             I
253900950717     C                   ENDDO
253910950104     C*
253920950104     C                   ENDSR
253930950717     C**************************************************************************
253940950717     C*  CONTROLLO SEGNACOLLO DOPPIO ALL'INTERNO DELLA STESSA BOLLA
253950950717     C**************************************************************************
253960950717     C     VADDOP        BEGSR
253970020917     C     KBLC          SETLL     FIVAD000
253980020917     C     KBLC          READE(N)  FIVAD000                               30
253990950717     C                   CLEAR                   WNCD
254000950717     C*
254010950717     C     *IN30         DOWEQ     *OFF
254020950717     C*
254030950717     C     WNCD          IFNE      BLDNCD
254040950717     C                   MOVEL     BLDNCD        WNCD
254050020917     C     KBLC          READE(N)  FIVAD000                               30
254060950717     C                   ELSE
254070950717     C                   SETON                                        629030
254080950717     C                   ENDIF
254090950717     C*
254100950717     C                   ENDDO
254110950717     C* PREPARO MESSAGGIO
254120950717     C     *IN90         IFEQ      *ON
254130950717     C                   MOVEA     ERR(120)      K78
254140950717     C                   MOVEL     WNCD          W007A
254150950717     C                   MOVEA     W007A         SKI(9)
254160950717     C                   Z-ADD     9             I                 3 0
254170950717     C                   EXSR      ABBL
254180950717     C                   MOVEA     SKI(9)        K78(37)
254190950717     C                   MOVEA     K78           VIDMSG
254200950717     C                   ENDIF
254210950717     C*
254220950717     C                   ENDSR
254230001031     C**
254240120302     C* STAMPA ETICHETTA ESTERA SDI O BRT ----------------------------*
254250971215     C     ETIEST        BEGSR
254260971215     C*
254270040506     c* entro in questa routine anche per la stampa dell'etichetta Ita
254280040506     c* lia se segnacollo export Euroexpress per impostare la nazione
254290040506     c* §defca viene impostato ma per il momento non utilizzato nel
254300040506     c* pgm di stampa
254310040506     c*
254320081008    1C***  WESTER        IFEQ      'S'
254330081008     c     §detse        ifeq      'EEX'
254340971215     C                   MOVEL     DESCOD        §DEISA
254350971215     C**
254360971215    3C                   SELECT
254370971215     C     FLGTB1        WHENEQ    'A'
254380971215     C     §3AFCA        ANDEQ     0
254390971215     C                   MOVEL     'A'           §DEFCA
254400971215     C     FLGTB1        WHENEQ    'A'
254410971215     C     §3AFCA        ANDNE     0
254420971215     C                   MOVEL     'X'           §DEFCA
254430971215     C     §3AFCA        WHENNE    0
254440971215     C                   MOVEL     'S'           §DEFCA
254450971215    3C                   ENDSL
254460971215    1C                   ENDIF
254470971215     C**
254480971215     C                   ENDSR
254490000901     C*****************************************************
254500000901     C* CALCOLA CIFRA DI CONTROLLO SECONDO IL MODULO 10 IBM
254510000901     C*****************************************************
254520000901     C     M10           BEGSR
254530000901     C                   MOVE      *ZERO         §TT               3 0
254540000906     C                   MOVE      *ZERO         §TT2              3 0
254550000901     C                   MOVE      *ZERO         §1                1 0
254560000901     C                   Z-ADD     18            §S                2 0
254570000901     C                   DO        17            §N                2 0
254580000901     C                   SUB       1             §S
254590000901     C* INTANTO SPOSTO DA UNA SCHIERA AL CAMPO COD.BARRE
254600000901     C                   MOVE      §C(§N)        §CB(§N)
254610000901     C     §N            DIV       2             §CTR              3 0
254620000901     C                   MVR                     §RST              3 030
254630000901     C     *IN(30)       IFEQ      '1'
254640000901     C     §C(§S)        MULT      2             §N2               2 0
254650000901     C                   MOVE      §N2           §A2               2
254660000901     C                   MOVEA     §A2           §2A
254670000901     C                   XFOOT     §2            §CTR
254680000901     C                   ELSE
254690000901     C                   Z-ADD     §C(§S)        §CTR
254700000901     C                   END
254710000901     C                   ADD       §CTR          §TT
254720000901     C                   END
254730000901     C*
254740000901     C     §TT           ADD       9             §TT2
254750000901     C                   MOVE      0             §TT2
254760000901     C     §TT2          SUB       §TT           §1
254770000901     C*
254780000901     C                   MOVE      §1            §CB(18)
254790000901     C                   ENDSR
254800000901     C**************************************************************************
254810020917     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIVAT
254820000901     C**************************************************************************
254830000901     C     CARVAT        BEGSR
254840000905     C* CAMPI SFL CONTROL
254850000912     C                   MOVE      §LPCCN        V8CKSC
254860000905     C                   Z-ADD     KCI           CCC
254870000905     C     KACO          CHAIN     CNACO000                           30
254880000905     C  N30              MOVEL     ACORAG        V8DKSC
254890000905     C   30              MOVEL     *BLANKS       V8DKSC
254900000905     C*
254910000901     C                   Z-ADD     0             NR8
254920000901     C                   MOVEL     'E'           WTRC
254930020917     C     KVAT          SETLL     FIVAT000
254940061010     C     KVAT          READE(N)  FIVAT000                               30
254950000901     C     *IN30         DOWEQ     *OFF
254960000901     C                   MOVEL     *BLANKS       V8CSCE
254970040302     c                   Eval      wtxt = VatNot
254980041117     c                   eval      uppercase = '1'
254981141202     c                   clear                   ElencoChar
254990040302     c                   ExSr      Sr_Chk
255000040302     c                   Movel     wtxt          V8cNot
255010000908     C                   MOVE      *BLANKS       V8HDKC
255020000908     C                   MOVE      *BLANKS       V8HESG
255030000915     C                   MOVE      *ZEROS        V8HST2
255040000915     C                   CLEAR                   V8HFLS
255050000915     C                   CLEAR                   V8HLNA
255060000915     C                   CLEAR                   V8HNRS
255070000915     C                   CLEAR                   V8HNSC
255080000921     C                   CLEAR                   V8HPRE
255090000901     C* SCRIVO SUBFILE
255100040617     c* potrebbe succcedere che il cliente ci passi più di 500 record
255110040617     c* di vat ma sul vab il numero colli è inferiore a 500
255120040617     c* In questo caso ne carico al max 500
255130040617     c     nr8           ifeq      500
255140040617     c                   seton                                        30
255150040617     c                   else
255160000901     C                   ADD       1             NR8
255170000901     C                   WRITE     LS01S08
255180061010     C     KVAT          READE(N)  FIVAT000                               30
255190040617     c                   endif
255200000901     C                   ENDDO
255210000918     C                   Z-ADD     NR8           SAVNR8
255220000901     C*
255230000901     C                   ENDSR
255240050221     C**************************************************************************
255250050221     C*  CARICAMENTO numero parcel dpd
255260050221     C**************************************************************************
255270050221     C     sr_vatdpd     BEGSR
255280050221     C                   MOVEL     'E'           WTRC
255290050221     c                   clear                   werrvat           1
255300060612     c                   clear                   w014a
255310050221     C     KVAT          SETLL     FIVAT000
255320061010     C     KVAT          READE(N)  FIVAT000                               30
255330050221     C     *IN30         DOWEQ     *OFF
255340050221     c     werrvat       andeq     *blanks
255350060612     c     w014a         ifeq      *blanks
255360060612     c                   if        §ogntw = 'DPD'
255370060612     c                   movel     vatnot        dvate
255380060612     c                   movel     §VATEPRN      w014a
255390060612     c                   else
255400060612     c                   movel     vatnot        w014a
255410060612     c                   endif
255420050221     c                   else
255430050221     c                   eval      werrvat = '1'
255440050221     c                   endif
255450061010     C     KVAT          READE(N)  FIVAT000                               30
255460050221     c                   enddo
255470050221     c                   endsr
255480000901     C**************************************************************************
255490020917     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIVAB O FIVAD
255500000901     C**************************************************************************
255510000901     C     CARVAB        BEGSR
255520000901     C                   Z-ADD     0             NR8
255530000905     C* CAMPI SFL CONTROL
255540000912     C                   MOVE      §LPCCN        V8CKSC
255550000905     C                   Z-ADD     KCI           CCC
255560000905     C     KACO          CHAIN     CNACO000                           30
255570000905     C  N30              MOVEL     ACORAG        V8DKSC
255580000905     C   30              MOVEL     *BLANKS       V8DKSC
255590000901     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
255600000901     C                   CLEAR                   DSBLD7
255610000901     C                   MOVE      §LPLNP        §LCLNP
255620000901     C                   MOVE      §LPLNA        §LCLNA
255630000901     C                   MOVE      §LPNRS        §LCNRS
255640000901     C                   MOVE      §LPZNC        §LCZSC
255650020917     C* SEGNACOLLI SEQUENZIALI: CARICO CHI SONO DA FIVAB
255660000901    1C     §1BFG7        IFNE      'S'
255670000901     C                   MOVE      §LPNCD        §LCNCD
255680000901     C* Calcolo il check digit
255690000901     C                   EXSR      M10
255700000911     C                   MOVEA     §CA           V8CNOT
255710000901     C                   MOVEL     *BLANKS       V8CSCE
255720000908     C                   MOVE      *BLANKS       V8HDKC
255730000908     C                   MOVE      *BLANKS       V8HESG
255740000915     C                   MOVE      *ZEROS        V8HST2
255750000915     C                   CLEAR                   V8HFLS
255760000915     C                   CLEAR                   V8HLNA
255770000915     C                   CLEAR                   V8HNRS
255780000915     C                   CLEAR                   V8HNSC
255790000921     C                   CLEAR                   V8HPRE
255800000901     C                   ADD       1             NR8
255810000901     C                   WRITE     LS01S08
255820101217     c                   movel     v8cnot        chidal
255830000901    2C     §LPNCA        IFGT      *ZEROS
255840001016     C     §LPNCA        ANDNE     §LPNCD
255850101217     C                   MOVE      §LPNCA        §LCNCD
255860101217     C* Calcolo il check digit
255870101217     C                   EXSR      M10
255880101217     C                   MOVEA     §CA           V8CNOT
255890101217     C                   MOVEL     *BLANKS       V8CSCE
255900101217     C                   ADD       1             NR8
255910101217     C                   WRITE     LS01S08
255920101217     c                   movel     v8cnot        chial
255930101217     c     chidal        downe     chial
255940101216     C                   CLEAR                   DSLSZ1
255950101216     C                   MOVEL     'E'           IZ1MOD
255960101216     C                   MOVEL     CHIDAL        IZ1CH1
255970101216     C                   Z-ADD     V8CKSC        IZ1CCM
255980101216     C                   MOVEL     wctm          IZ1CTM
255990101216     C                   Z-ADD     §lpnrs        IZ1NRS
256000101216     C                   CALL      'FNLSZ1R'
256010101216     C                   PARM                    KPJBA
256020101216     C                   PARM                    DSLSZ1
256030101216     C                   PARM                    DS1B
256040101217     c     oz1chi        ifne      chial
256050101216     C                   MOVEL     OZ1CHI        V8CNOT
256060000901     C                   MOVEL     *BLANKS       V8CSCE
256070000901     C                   ADD       1             NR8
256080000901     C                   WRITE     LS01S08
256090000901    2C                   ENDIF
256100101217     c                   eval      chidal=oz1chi
256110101217     c                   enddo
256120101217     c                   endif
256130000918     C                   Z-ADD     NR8           SAVNR8
256140000901   X1C                   ELSE
256150020917     C* ALTRIMENTI LI CARICO DA FIVAD
256160020917     C     KBLC          SETLL     FIVAD000
256170020917     C     KBLC          READE     FIVAD000                               30
256180000904    2C     *IN30         DOWEQ     *OFF
256190000904    3C     BLDNCA        IFEQ      0
256200000904     C                   Z-ADD     BLDNCD        BLDNCA
256210000904    3C                   ENDIF
256220000904     C*
256230000904    3C     BLDNCD        DOWLE     BLDNCA
256240000904     C     BLDNCD        ANDGT     0
256250000904     C                   MOVE      BLDNCD        §LCNCD
256260000904     C* Calcolo il check digit
256270000904     C                   EXSR      M10
256280000911     C                   MOVEA     §CA           V8CNOT
256290000901     C                   MOVEL     *BLANKS       V8CSCE
256300000908     C                   MOVE      *BLANKS       V8HDKC
256310000908     C                   MOVE      *BLANKS       V8HESG
256320000915     C                   MOVE      *ZEROS        V8HST2
256330000915     C                   CLEAR                   V8HFLS
256340000915     C                   CLEAR                   V8HLNA
256350000915     C                   CLEAR                   V8HNRS
256360000915     C                   CLEAR                   V8HNSC
256370000921     C                   CLEAR                   V8HPRE
256380000901     C* SCRIVO SUBFILE
256390000901     C                   ADD       1             NR8
256400000901     C                   WRITE     LS01S08
256410000904     C                   ADD       1             BLDNCD
256420000904    3C                   ENDDO
256430020917     C     KBLC          READE     FIVAD000                               30
256440000904    2C                   ENDDO
256450000918     C                   Z-ADD     NR8           SAVNR8
256460000904     C*
256470000904    1C                   ENDIF
256480000901     C*
256490000901     C                   ENDSR
256500140506     C**************************************************************************
256510140506     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIART (dirottamenti)
256520140506     C**************************************************************************
256530140506     C     CARART        BEGSR
256540140506     C                   Z-ADD     0             NR8
256550140506     C* CAMPI SFL CONTROL
256560140506     C                   MOVE      §LPCCN        V8CKSC
256570140506     C                   Z-ADD     KCI           CCC
256580140506     C     KACO          CHAIN     CNACO000                           30
256590140506     C  N30              MOVEL     ACORAG        V8DKSC
256600140506     C   30              MOVEL     *BLANKS       V8DKSC
256610140506     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
256620140506     C                   CLEAR                   DSBLD7
256630140506     c     kbolm         chain     fnarb01l
256640140506     c                   if        %found(fnarb01l)
256650140710     C                   MOVE      arbfls        §LCLNP
256660140506     C                   MOVE      arbnrs        §LCNRS
256670140716     C                   MOVE      arbZNC        §LCZSC
256680140506     C                   MOVE      arbLNA        §LCLNA
256690140506     c                   endif
256700140506     C*
256710140506     C     Kbolm         SETLL     fiart01l
256720140506     C     kbolm         READE(n)  fiart01l
256730140506    2C                   DOW       not %eof(fiart01l)
256740140506     C*
256750140506     C                   MOVE      artnsc        §LCNCD
256751140716     c* Prendo zona dall'ultima spunta fatta. Se non trovo spunte
256752140716     c* tengo la zona della bolla
256753140716     c                   exsr      sr_zona
256754140716     c                   if        wokzona='1'
256755140716     C                   MOVE      wznbrv        §LCZSC
256757140716     c                   else
256758140716     C                   MOVE      arbZNC        §LCZSC
256759140716     c                   endif
256760140506     C* Calcolo il check digit
256770140506     C                   EXSR      M10
256780140506     C                   MOVEA     §CA           V8CNOT
256790140506     C                   MOVEL     *BLANKS       V8CSCE
256800140506     C                   MOVE      *BLANKS       V8HDKC
256810140506     C                   MOVE      *BLANKS       V8HESG
256820140506     C                   MOVE      *ZEROS        V8HST2
256830140506     C                   CLEAR                   V8HFLS
256840140506     C                   CLEAR                   V8HLNA
256850140506     C                   CLEAR                   V8HNRS
256860140506     C                   CLEAR                   V8HNSC
256870140506     C                   CLEAR                   V8HPRE
256880140506     C* SCRIVO SUBFILE
256890140506     C                   ADD       1             NR8
256900140506     C                   WRITE     LS01S08
256910140506     C     kbolm         READE(n)  fiart01l
256920140506    2C                   ENDDO
256930140506     C                   Z-ADD     NR8           SAVNR8
256940140506     C*
256950140506     C*
256960140506     C                   ENDSR
256961140716     C**************************************************************************
256962140716     C*  determinazinoe zona segnacollo da spunta
256963140716     C**************************************************************************
256964140716     C     sr_zona       BEGSR
256965140716     c
256966140716     c                   clear                   wznbrv
256967140716     c                   clear                   wokzona
256968140716     c     kbrv7z        setll     fnbrv07l
256969140716     c     kbrv7z        reade     fnbrv07l
256970140716     c                   dow       not %eof(fnbrv07l)
256971140716     c* scarto se categoria 8 o manca la data caricamento (spunta autogenerata)
256972140716     c                   if        brvnpg<>8 and brvdcs>0
256973140716     c                   if        wokzona=*blanks or
256974140716     c                             brvdfs>wdfs or
256975140716     c                             (brvdfs=wdfs and brvhms>whms)
256976140716     c                   z-add     brvznc        wznbrv
256977140716     c                   eval      wokzona='1'
256978140716     c                   z-add     brvdfs        wdfs
256979140716     c                   z-add     brvhms        whms
256980140716     c                   endif
256981140716     c                   endif
256982140716     c     kbrv7z        reade     fnbrv07l
256983140716     c                   enddo
256984140716     c                   endsr
256985000913     C**************************************************************************
256986051102     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIARS
256990000913     C**************************************************************************
257000051102     C     CARARS        BEGSR
257010000913     C* CAMPI SFL CONTROL
257020000913     C                   MOVE      WKSC          V8CKSC
257030000913     C                   Z-ADD     KCI           CCC
257040000913     C     KACO          CHAIN     CNACO000                           30
257050000913     C  N30              MOVEL     ACORAG        V8DKSC
257060000913     C   30              MOVEL     *BLANKS       V8DKSC
257070000913     C*
257080000913     C                   MOVEL     *BLANKS       V8CSCE
257090051102     C                   MOVEL     ARSNOT        V8CNOT
257100000913     C                   MOVE      *BLANKS       V8HDKC
257110000913     C                   MOVE      *BLANKS       V8HESG
257120000915     C                   MOVE      *ZEROS        V8HST2
257130051102     C                   Z-ADD     ARSFLS        V8HFLS
257140051102     C                   Z-ADD     ARSLNA        V8HLNA
257150051102     C                   Z-ADD     ARSNRS        V8HNRS
257160051102     C                   Z-ADD     ARSNSC        V8HNSC
257170000913     C* SCRIVO SUBFILE
257180000913     C                   ADD       1             NR8
257190000913     C                   WRITE     LS01S08
257200000913     C*
257210000913     C                   ENDSR
257220031114      *------------------------------------------------------------------------*
257230031114      *  CARICAMENTO DATI DA FIVAT00F
257240031114      *------------------------------------------------------------------------*
257250031114     c     Sr_CarVat     BegSr
257260110818     c**
257270110818     c** N.B: l'elenco dei tipi record del fivat e le relative descrizioni
257280110818     c**      sono interrogabili sulla tabella "VAT"
257290110818     c**
257300031125     c                   Clear                   dVato
257310031125
257320031114      * Leggo FIVAT00f
257330031114     c     kVat1         Setll     Fivat01l
257340031114     c                   Do        *Hival
257350061010     c     kVat1         Reade(N)  Fivat01l
257360031114     c                   If        %Eof(Fivat01l)
257370031114     c                   Leave
257380031114     c                   EndIf
257390031114      * Escludo i record "E"
257400031114     c                   If        VatTrc = 'E'
257410031114     c                   Iter
257420031114     c                   EndIf
257430040302
257440040302      * Controllo i dati inviati dal cliente, tranne il rcd 'O' xchè è tutto
257450040302      * numerico
257451141202      * per tipo record "Y"  - PIN CODE i controlli non li devo fare in
257452141202      * questo momento
257460141202     c                   If        VatTrc <> 'O' and
257461141202     c                             VatTrc <>'Y'
257470040302     c                   Eval      wtxt = VatNot
257480131003     c                   clear                   uppercase
257481141202     c                   clear                   ElencoChar
257490040302     c                   ExSr      Sr_Chk
257500040302     c                   Movel     wtxt          VatNot
257510040302     c                   EndIf
257520031114      * Imposto i campi in base al tipo record
257530031114     c                   Select
257540031114      * Referente
257550031114     c                   When      VatTrc = 'A'
257560031114     c                   Eval      VidRef = VatNot
257570031114      * Telefono
257580031114     c                   When      VatTrc = 'B'
257590031114     c                   Eval      VidTel = VatNot
257600031125      * Bancali x particolarità varia 'O'
257610031125     c                   When      VatTrc = 'O'
257620031125     c                   Movel     VatNot        dVato
257630031219      * Riferimento partener estero
257640031219     c                   When      VatTrc = 'C'
257650031219     c                   Movel     VatNot        wrifp
257660110510      * E-mail al destinatario - indirizzo
257670110510     c                   When      VatTrc = 'I'
257680150213     c*                  Clear                   atremd
257690150213     c*                  Clear                   atrwemd
257700110510     c                   Movel     VatNot        wemdest
257710110512     c                   When      VatTrc = 'J'
257720150213     c*                  Clear                   atremd
257730150213     c*                  Clear                   atrwemd
257740110512     c                   if        wemdest<>*blanks
257750110512     c                   eval      wemdest=%trimr(wemdest) + vatnot
257760110512     c                   else
257770110512     c                   Movel     VatNot        wemdest
257780110512     c                   endif
257790110704      * codici CUP e CIG per tracciabilità flussi finanziari
257800110704     c                   when      VatTrc='4'
257810110704     c                   movel     vatnot        dvat4
257820120606     c                   exsr      impocupcig
257830120606     c***                eval      Wcupcup=§vat4cup
257840120606     c***                eval      Wcupcig=§vat4cig
257850130315     c* numero di telefono per invio sms
257860130918     c* flag per negare l'invio di mail per merce partita
257870130315     c                   when      VatTrc='S'
257880130315     c                   Movel     VatNot        dVats
257890130403     c                   eval      wsms=§vatstel
257900150213     c*                  if        wsms<>*blanks
257910150213     c*                  clear                   atremd
257920150213     c*                  clear                   atrwtel
257930150213     c*                  endif
257940130930     c                   clear                   wsmp
257950130930     c                   if        wsms<>*blanks and §vatssmp<>'N'
257960130930     c                   eval      wsmp='S'
257970130930     c                   endif
257980130918     c                   eval      wmmp=§vatsmmp
257981141031      * PIN CODE
257982141031     c                   when      VatTrc='Y'
257983141031     c                   Movel     VatNot        wPinCode
257984141202     c* memorizzo la lunghezza del PIN ricevuto dal cliente
257985141202     c                   eval      lenPC=%checkr(' ':vatnot)
257990031219      * Altri record non li carico
258000031219     c                   Other
258010031219     c                   Iter
258020031114
258030031114     c                   EndSl
258040031114
258050031114     c                   EndDo
258051150213
258052150213     c* Se ho il numero di cellulare lo metto anche nel Tel.Dest. se manca
258053150213     c                   if        wsms<>*blanks and vidtel=*blanks
258054150216      /free
258055150216       pInCell = %trim(wsms);
258056150216       pOutErr = *blanks;
258057150216       if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
258059150216           // Numero di cellulare KO
258063150216           clear wsms;
258064150216       else;
258065150216           vidtel=wsms;
258066150216       endif;
258067150216      /end-free
258069150213     c                   endif
258070031114
258071031114     c                   EndSr
258080040302      *---------------------------------------------------------
258090040302      * Controllo i caratteri dei campi alfanumerici
258100040302      *---------------------------------------------------------
258110040302     c     Sr_Chk        BegSr
258120040302
258130040302     c                   Eval      TxtInOut = wtxt
258140040302     c                   Call      'XCHKCHAR'
258150040302     c                   Parm                    TxtInOut
258160040302     c                   Parm                    ElencoChar
258170040302     c                   Parm                    TipoElenco
258180040302     c                   Parm                    CharSost
258190040302     c                   Parm                    UpperCase
258200040302     c                   Parm                    ChkNull
258210040302     c                   Parm                    CharNull
258220040302     c                   Parm                    Esito
258230040302     c                   If        Esito = '1'
258240040302     c                   Move      TxtInOut      wtxt
258250040302     c                   EndIf
258260040302
258270040302     c                   EndSr
258280140110      *---------------------------------------------------------
258290140110      * Controllo caratteri di punteggiatura precedenti e seguenti
258300140110      *---------------------------------------------------------
258310140110     c     chkstringa    BegSr
258320140110
258330140110     c* trovo la prima posizione "buona" da utilizzare
258340140110     c                   eval      posl=%check(charnook:wtxt)
258350140207     c* trovo l'ultima posizione "buona" da utilizzare (escludo il ".")
258360140207     c                   eval      posr=%checkr(charnookf:wtxt)
258370140207     c                   if        posl=0
258380140207     c                   clear                   wtxt
258390140207     c                   else
258400140110     c* determino la lunghezza della stringa "buona"
258410140110     c                   eval      lung=(posr-posl)+1
258420140207     c                   eval      wtxt=%subst(wtxt:posl:lung)
258430140110     c                   endif
258440140110
258450140110     c                   EndSr
258460120606      *---------------------------------------------------------
258470120606      * Verifica e impostazione CUP e  CIG ricevuti dal cliente
258480120606      *---------------------------------------------------------
258490120606     c     impocupcig    BegSr
258500120606     c                   clear                   wstringa
258510120606     c     '0':' '       xlate     §vat4cup      wstringa
258520120606     c                   if        wstringa<>*blanks
258530120606     c                   eval      Wcupcup=§vat4cup
258540120606     c                   endif
258550120606     c                   clear                   wstringa
258560120606     c     '0':' '       xlate     §vat4cig      wstringa
258570120606     c                   if        wstringa<>*blanks
258580120606     c                   eval      Wcupcig=§vat4cig
258590120606     c                   endif
258600120606     c                   EndSr
258610110512      *---------------------------------------------------------
258620110512      * Controllo indirizzo email destinatario
258630110512      *---------------------------------------------------------
258640110512     c     Sr_Chkemd     BegSr
258650110512     c                   Clear                   dsemail
258660110512     c                   Eval      §emlindi = wemdest
258670110512     c                   Call      'XEMAIL'
258680110512     c                   Parm                    dsemail
258690110512     c                   EndSr
258700031125      *------------------------------------------------------------------------*
258710031125      *  CONTROLLO CHE DATI TENERE PER I BANCALI
258720031125      *------------------------------------------------------------------------*
258730031125     c     Sr_CtrBancali BegSr
258740031125
258750031125     c                   Clear                   wgva
258760031125
258770031126     c                   Select
258780031126      * particolarità varia 'O'
258790031126w   1c                   When      %subst(VidGva:1:1) = 'O'
258800031126      * dati trovati in FIVAT rcd 'O'
258810031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
258820031126      * carico i dati del FIVAT
258830031126     c                   Clear                   VidTba
258840031126     c                   If        §VatoTba > *Zeros
258850031126     c                   Movel     §VatoTba      VidTba
258860031126     c                   EndIf
258870031126     c                   Eval      VidNba = §VatoNba
258880031126     c                   Eval      SavNba = §VatoNba
258890031126     c                   Clear                   VidTb2
258900031126     c                   If        §VatoTb2 > *Zeros
258910031126     c                   Movel     §VatoTb2      VidTb2
258920031126     c                   EndIf
258930031126     c                   Eval      VidNb2 = §VatoNb2
258940031126     c                   Eval      SavNba = §VatoNb2
258950031126     c                   Eval      w03Cor = §VatoCor
258960031126     c                   Eval      w03Csf = §VatoCsf
258970031126      * dati non trovati in FIVAT rcd 'O'
258980031126   x2c                   Else
258990031126      * pulisco i campi del video
259000031126     c                   Clear                   VidTba
259010031126     c                   Clear                   VidNba
259020031126     c                   Clear                   SavNba
259030031126     c                   Clear                   VidTb2
259040031126     c                   Clear                   VidNb2
259050031126     c                   Clear                   SavNba
259060031126    2c                   EndIf
259070031126
259080031126      * particolarità varia 'B'
259090031126w   1c                   When      %subst(VidGva:1:1) = 'B'
259100031126      * dati trovati in FIVAT rcd 'O'
259110031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
259120031126      * pulisco i dati del FIVAT
259130031126     c                   Clear                   dVato
259140031126    2c                   EndIf
259150031126
259160031126      * particolarità varia = ' '
259170031126w   1c                   When      %subst(VidGva:1:1) = ' '
259180031126      * dati trovati in FIVAT rcd 'O'
259190031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
259200031126      * carico i dati del FIVAT
259210031126     c                   Clear                   VidTba
259220031126     c                   If        §VatoTba > *Zeros
259230031126     c                   Movel     §VatoTba      VidTba
259240031126     c                   EndIf
259250031126     c                   Eval      VidNba = §VatoNba
259260031126     c                   Eval      SavNba = §VatoNba
259270031126     c                   Clear                   VidTb2
259280031126     c                   If        §VatoTb2 > *Zeros
259290031126     c                   Movel     §VatoTb2      VidTb2
259300031126     c                   EndIf
259310031126     c                   Eval      VidNb2 = §VatoNb2
259320031126     c                   Eval      SavNba = §VatoNb2
259330031126     c                   Eval      w03Cor = §VatoCor
259340031126     c                   Eval      w03Csf = §VatoCsf
259350031126      * imposto un flag per emettere un msg mirato in seconda videata
259360031126     c                   Eval      wgva = 'O'
259370031126      * dati non trovati in FIVAT rcd 'O'
259380031126   x2c                   Else
259390031126      * se ho i bancali
259400031126if  3c                   If        §LpNba > *Zeros or §LpNb2 > *Zeros
259410031126      * imposto un flag per emettere un msg mirato in seconda videata
259420031126     c                   Eval      wgva = 'B'
259430031126    3c                   EndIf
259440031126    2c                   EndIf
259450031126
259460031126   o1c                   other
259470031126      * dati trovati in FIVAT rcd 'O'
259480031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
259490031126      * pulisco i dati del FIVAT
259500031126     c                   Clear                   dVato
259510031126      * dati non trovati in FIVAT rcd 'O'
259520031126   x2c                   Else
259530031126      * pulisco i campi del video
259540031126     c                   Clear                   VidTba
259550031126     c                   Clear                   VidNba
259560031126     c                   Clear                   SavNba
259570031126     c                   Clear                   VidTb2
259580031126     c                   Clear                   VidNb2
259590031126     c                   Clear                   SavNba
259600031126    2c                   EndIf
259610031126
259620031126    1c                   EndSl
259630031125
259640031125     c                   EndSr
259650000904     C**************************************************************************
259660000904     C*  GESTIONE VIDEATA MANUTENZIONE COD. CHI SONO
259670000904     C**************************************************************************
259680000904     C     GESD08        BEGSR
259690000905     C  N90              Z-ADD     1             V8CNBR
259700000904     C                   CLEAR                   V8ZMSG
259710000905     C   90              MOVEL     W08MSG        V8ZMSG
259720000928     C* SE DSIK C EX DISK BI ACCENDO 33 PER DISABILITARE F9-AGGIUNTA
259730000928     C     §1BF12        IFEQ      'B'
259740000928     C                   SETON                                        33
259750000928     C                   ENDIF
259760000904     C* EMISSIONE VIDEATA
259770000904     C     EMD08         TAG
259780000904     C                   WRITE     LS01Z08
259790000904     C                   EXFMT     LS01C08
259800000911     C                   SETOFF                                       6190
259810000904     C                   CLEAR                   V8ZMSG
259820000904     C     *INKL         CABEQ     *ON           ENDD08
259830010504     C* CONTROLLO EVENTUALI RECORD ANNULLATI E LI TOLGO DALLA SCHIERA
259840010504     C* DI WORK
259850010504     C                   EXSR      CTRS8A
259860000904     C* F9=AGGIUNTA CODICI
259870000904     C     *INKI         IFEQ      *ON
259880000904     C                   EXSR      GESD09
259890000914     C     *INKL         CABEQ     *ON           ENDD08
259900000904     C                   ENDIF
259910010504     C* CONTROLLO DATI
259920010504     C                   EXSR      CTRS08
259930010504     C   90              MOVEL     W08MSG        V8ZMSG
259940010504     C  NKF
259950010504     COR 90              GOTO      EMD08
259960000904     C     ENDD08        ENDSR
259970000830     C**************************************************************************
259980000830     C*  GESTIONE VIDEATA INSERIMENTO COD. CHI SONO
259990000830     C**************************************************************************
260000000904     C     GESD09        BEGSR
260010000905     C* QUESTA ROUTINE POTREBBE ESSERE RICHIAMATA DURANTE LA MANUTENZIO
260020000905     C* NE DEL SUBFILE: IN QUESTO CASO DEVO MANTENERE IL POSIZIONAMENTO
260030000905     C* NEL SUBFILE CHE C'È GIA'
260040000904     C     V8CNBR        IFEQ      0
260050000830     C                   Z-ADD     1             V8CNBR
260060000904     C                   ENDIF
260070000918     C                   Z-ADD     SAVNR8        NR8
260080051121     c                   write     ls01d08
260090000904     C     EMD09         TAG
260100000830     C                   WRITE     LS01C08
260110000830     C                   EXFMT     LS01D09
260120000904     C                   SETOFF                                       61
260130000921     C* SCRIVO SUBFILE (SE CHI SONO GIA' IMMESSO NON LO RICARICO E NON
260140000921     C* DO ERRORE)
260150000830     C     V9CNOT        IFNE      *BLANKS
260160000921     C     V9CNOT        LOOKUP    CH2                                    31
260170000921     C     *IN31         IFEQ      *OFF
260180000830     C                   ADD       1             NR8
260190000830     C                   Z-ADD     NR8           V8CNBR
260200000911     C                   MOVEL     V9CNOT        V8CNOT
260210000830     C                   CLEAR                   V8CSCE
260220000908     C                   CLEAR                   V8HDKC
260230000908     C                   CLEAR                   V8HESG
260240000915     C                   CLEAR                   V8HST2
260250000915     C                   CLEAR                   V8HFLS
260260000915     C                   CLEAR                   V8HLNA
260270000915     C                   CLEAR                   V8HNRS
260280000915     C                   CLEAR                   V8HNSC
260290000921     C                   CLEAR                   V8HPRE
260300000830     C                   WRITE     LS01S08
260310000921     C                   SETON                                        78
260320000921     C                   ADD       1             I2                3 0
260330000921     C                   MOVE      V9CNOT        CH2(I2)
260340000921     C                   ENDIF
260350000911     C                   CLEAR                   V9CNOT
260360000830     C                   ENDIF
260370000918     C                   Z-ADD     NR8           SAVNR8
260380000905     C* PER F6 ESCO DALLA VIDEATA DI IMMISSIONE "CHI SONO"
260390000914     C     *INKF         IFEQ      *OFF
260400000914     C     *INKL         ANDEQ     *OFF
260410000914     C                   GOTO      EMD09
260420000914     C                   ENDIF
260430000830     C                   ENDSR
260440000830     C**************************************************************************
260450000830     C*   CONTROLLO SUBFILE CHI SONO
260460000905     C**************************************************************************
260470000830     C     CTRS08        BEGSR
260480000830     C                   CLEAR                   CHI
260490000907     C                   CLEAR                   POS
260500021119     c                   Clear                   Prefisso
260510000830     C                   CLEAR                   W08MSG
260520000830     C                   Z-ADD     0             IX                4 0
260530000911    0C     *IN78         IFEQ      *ON
260540000830     C                   Z-ADD     1             NR8
260550000921     C                   SETOFF                                       9061
260560000830     C     NR8           CHAIN     LS01S08                            31
260570000831    1C     *IN31         DOWEQ     *OFF
260580000904     C* IGNORO CODICE SE ANNULLATO
260590000904   1AC     V8CSCE        IFEQ      ' '
260600000904     C* IL CODICE CHI SONO NON DEVE ESSERE RIPETUTO ALL'INTERNO
260610000904     C* DEL SUBFILE
260620000830     C     V8CNOT        LOOKUP    CHI                                    31
260630000831    2C     *IN31         IFEQ      *ON
260640000830     C* SE IL CODICE È DOPPIO ERRORE - ESCO DAL CICLO MEMORIZZANDO IL
260650000830     C* NRR IN ERRORE
260660000905     C                   Z-ADD     NR8           V8CNBR
260670000905     C                   SETON                                        9061
260680000911     C     WC01FG        IFEQ      'C'
260690000831     C                   MOVEL     ERR(205)      W08MSG
260700000911     C                   ELSE
260710000911     C                   MOVEA     ERR(205)      K78
260720000911     C                   MOVEA     *BLANKS       K78(44)
260730000911     C                   MOVEA     K78           W08MSG
260740000911     C                   ENDIF
260750000905     C                   UPDATE    LS01S08
260760000831     C                   GOTO      ENDS08
260770000831    2C                   ENDIF
260780021119      * Controllo prefisso chi sono
260790021119     c                   Movel     V8cNot        Wpre
260800080307     c     digits        check     v8cnot:3      wy
260810021119      * prefisso "FD" o "FM possibile solo per bolle FedEx
260820080307      * (se è seguito da 12 cifre)
260830021119     c                   If        (Wpre = 'FD' or Wpre = 'FM')
260840021119     c                              and A_§OgNtw <> 'FED' and
260850021119     c                                   VidDpd <> 'F'
260860080307     c                              and wy=15
260870021119     c                   Z-Add     Nr8           V8cNbr
260880021119     c                   Eval      *In90 = *On
260890021119     c                   Eval      *In61 = *On
260900021119     c                   Movel     Err(261)      W08Msg
260910021119     c                   Update    Ls01s08
260920021119     c                   GoTo      EndS08
260930021119     c                   EndIf
260940021119      * solo per bolle FedEx
260950021119If  2c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED')
260960021119     c                              and ix > 1
260970021119      * immesso prefisso "FM" o "FD"
260980021119      * tutti i segnacolli devono avere lo stesso prefisso
260990021119If  3c                   If        (Wpre = 'FD' or Wpre = 'FM')
261000021119     c     Wpre          Lookup    Prefisso                               30
261010021119      * Deve essere lo stesso prefisso già inserito
261020021119If  4c                   If        Not *In30
261030021119     c                   Z-Add     Nr8           V8cNbr
261040021119     c                   Eval      *In90 = *On
261050021119     c                   Eval      *In61 = *On
261060021119     c                   Movel     Err(260)      W08Msg
261070021119     c                   Update    Ls01s08
261080021119     c                   GoTo      EndS08
261090021119    4c                   EndIf
261100021119   x3c                   Else
261110021119      * immesso altro prefisso
261120021119      * non devono essere stati inseriti prefissi "FD" o "FM"
261130021119     c     'FD'          Lookup    Prefisso                               30
261140021119If  4c                   If        *In30
261150021119     c                   Z-Add     Nr8           V8cNbr
261160021119     c                   Eval      *In90 = *On
261170021119     c                   Eval      *In61 = *On
261180021119     c                   Movel     Err(260)      W08Msg
261190021119     c                   Update    Ls01s08
261200021119     c                   GoTo      EndS08
261210021119    4c                   EndIf
261220021119     c     'FM'          Lookup    Prefisso                               30
261230021119If  4c                   If        *In30
261240021119     c                   Z-Add     Nr8           V8cNbr
261250021119     c                   Eval      *In90 = *On
261260021119     c                   Eval      *In61 = *On
261270021119     c                   Movel     Err(260)      W08Msg
261280021119     c                   Update    Ls01s08
261290021119     c                   GoTo      EndS08
261300021119    4c                   EndIf
261310021119    3c                   EndIf
261320021119    2c                   EndIf
261330020308     c* Richiamo routine per controllare che cod. chi sono non sia
261340020308     c* doppio su fisgn e su blp (se segnacollo euroexpress)
261350020308     c                   eval      w8hcol = v8hcol
261360020308     c                   eval      w8cnot = v8cnot
261370020308     c                   eval      wnopos = ' '
261380020308     c                   exsr      ctrchidop
261390020308     c   90              goto      ends08
261400020308     C* SE NON C'È ERRORE MEMORIZZO IN SCHIERA
261410020308     C                   ADD       1             IX
261420020308     C                   MOVE      V8CNOT        CHI(IX)
261430020308     C                   Z-ADD     NR8           POS(IX)
261440021119      * Mi carico un Sk con solo il prefisso dei chi sono
261450021119     c                   Movel     Chi(ix)       Prefisso(ix)
261460000904   1AC                   ENDIF
261470000921     C                   UPDATE    LS01S08
261480000830     C                   ADD       1             NR8
261490000830     C  N90NR8           CHAIN     LS01S08                            31
261500000831    1C                   ENDDO
261510000911     C   31              SUB       1             NR8
261520000911    0C                   ENDIF
261530000907     C     IX            IFEQ      *ZEROS
261540000905     C                   SETON                                        90
261550000911     C     WC01FG        IFEQ      'C'
261560000905     C                   MOVEL     ERR(152)      W08MSG
261570000911     C                   ELSE
261580000911     C                   MOVEA     ERR(152)      K78
261590000911     C                   MOVEA     *BLANKS       K78(27)
261600000911     C                   MOVEA     K78           W08MSG
261610000911     C                   ENDIF
261620000911     C                   GOTO      ENDS08
261630000905     C                   ENDIF
261640000907     C* Richiamo pgm controllo Cod."CHI SONO"
261650010306     C* Se inseriti solo 2 codici E NUMERO COLLI A VIDEO > DI 2
261660000918     C* si potrebbe trattare di un dal/al
261670000907     C* e quindi richiamo pgm una volta sola passando entrambi i codici
261680000907    1C     IX            IFEQ      2
261690010306     C     V1CNCL        ANDGT     2
261700000907     C                   CLEAR                   DSLSZ1
261710000907     C                   MOVEL     'C'           IZ1MOD
261720000911     C                   MOVEL     WCTM          IZ1CTM
261730000907     C                   Z-ADD     V8CKSC        IZ1CCM
261740000907     C     §1BF12        IFEQ      'B'
261750000907     C                   Z-ADD     §LPNRS        IZ1NRS
261760000907     C                   ENDIF
261770000907     C                   MOVEL     CHI(1)        IZ1CH1
261780000907     C                   MOVEL     CHI(2)        IZ1CH2
261790000907     C                   CALL      'FNLSZ1R'
261800010402     C                   PARM                    KPJBA
261810000907     C                   PARM                    DSLSZ1
261820000907     C                   PARM                    DS1B
261830000907    2C     OZ1ERR        IFNE      ' '
261840000907    3C     OZ1ECH        IFEQ      '1'
261850000907     C                   Z-ADD     POS(1)        V8CNBR
261860000907   X3C                   ELSE
261870000907     C                   Z-ADD     POS(2)        V8CNBR
261880000907    3C                   ENDIF
261890000918     C     V8CNBR        CHAIN     LS01S08                            31
261900000907     C                   SETON                                        9061
261910000911     C     WC01FG        IFEQ      'C'
261920000907     C                   MOVEL     ERR(208)      W08MSG
261930000911     C                   ELSE
261940000911     C                   MOVEA     ERR(208)      K78
261950000911     C                   MOVEA     *BLANKS       K78(45)
261960000911     C                   MOVEA     K78           W08MSG
261970000911     C                   ENDIF
261980000907     C                   UPDATE    LS01S08
261990000911     C                   GOTO      ENDS08
262000000908     C                   ELSE
262010000908     C* SE NO ERRORE MEMORIZZO IL NUMERO DEI COLLI
262020000908     C                   Z-ADD     OZ1NCL        IX
262030020308    3c     oz1ncl        ifgt      2
262040020308     c                   movel     dslsz1        sav_dslsz1
262050020308     c* se numero dei colli > 2 si tratta di un dal/al
262060020308     c* devo quindi esplodere i codici per controllare che anche
262070020308     c* quelli all'interno del range non siano già presenti su fisgn
262080020308    4C     OZ1MAX        IFEQ      '2'
262090020308     C                   MOVEL     IZ1CH1        CHIDAL
262100020308     C                   MOVEL     IZ1CH2        CHIAL
262110020308   x4C                   ELSE
262120020308     C                   MOVEL     IZ1CH2        CHIDAL
262130020308     C                   MOVEL     IZ1CH1        CHIAL
262140020308    4C                   ENDIF
262150030214      * Prima di esplodere (per evitare giri inutili) controllo che il
262160030214      * n. dei cod. CHI SONO coincida con il n. dei colli immesso in
262170030214      * prima videata
262180030214If  4c                   If        Ix <> V1cNcl
262190030214     c                   Eval      *In90 = *On
262200030214If  5c                   If        Wc01Fg = 'C'
262210030214     c                   Eval      w08msg = Err(154)
262220030214   x5c                   Else
262230030214     c                   Movea     Err(154)      K78
262240030214     c                   Movea     *Blanks       K78(54)
262250030214     c                   Movea     K78           w08msg
262260030214    5c                   EndIf
262270030214     c                   GoTo      EndS08
262280030214    4c                   EndIf
262290020308    4C     CHIDAL        DOWNE     CHIAL
262300020308     C                   CLEAR                   DSLSZ1
262310020308     C                   MOVEL     'E'           IZ1MOD
262320020308     C                   MOVEL     CHIDAL        IZ1CH1
262330020308     C                   Z-ADD     V8CKSC        IZ1CCM
262340020308     C                   MOVEL     WCTM          IZ1CTM
262350020308     C     §1BF12        IFEQ      'B'
262360020308     C                   Z-ADD     §LPNRS        IZ1NRS
262370020308     C                   ENDIF
262380020308     C                   CALL      'FNLSZ1R'
262390020308     C                   PARM                    KPJBA
262400020308     C                   PARM                    DSLSZ1
262410020308     C                   PARM                    DS1B
262420020308    5C     OZ1CHI        IFNE      CHIAL
262430020308     c                   clear                   w8hcol
262440020308     c                   movel     '1'           wnopos
262450020308     c                   eval      w8cnot = oz1chi
262460020308     c                   exsr      ctrchidop
262470020308     c   90              movel     sav_dslsz1    dslsz1
262480020308     c   90              goto      ends08
262490020308    5c                   endif
262500020308     C                   MOVEL     OZ1CHI        CHIDAL
262510020308    4C                   ENDDO
262520020308     c                   movel     sav_dslsz1    dslsz1
262530020308    3c                   endif
262540000907    2C                   ENDIF
262550000907   X1C                   ELSE
262560010306     C* Se codici inseriti diverso da 2 O NUMERO COLLI <= 2
262570000918     C* li controllo una alla volta
262580001031     C                   Z-ADD     1             II                4 0
262590000907    2C     II            DOWLE     IX
262600000907     C                   CLEAR                   DSLSZ1
262610000907     C                   MOVEL     'C'           IZ1MOD
262620000911     C                   MOVEL     WCTM          IZ1CTM
262630000907     C                   Z-ADD     V8CKSC        IZ1CCM
262640000907     C     §1BF12        IFEQ      'B'
262650000907     C                   Z-ADD     §LPNRS        IZ1NRS
262660000907     C                   ENDIF
262670000907     C                   MOVEL     CHI(II)       IZ1CH1
262680000907     C                   CALL      'FNLSZ1R'
262690010402     C                   PARM                    KPJBA
262700000907     C                   PARM                    DSLSZ1
262710000907     C                   PARM                    DS1B
262720000907    3C     OZ1ERR        IFNE      ' '
262730000907     C                   Z-ADD     POS(II)       V8CNBR
262740000918     C     V8CNBR        CHAIN     LS01S08                            31
262750000907     C                   SETON                                        9061
262760000911     C     WC01FG        IFEQ      'C'
262770000907     C                   MOVEL     ERR(208)      W08MSG
262780000911     C                   ELSE
262790000911     C                   MOVEA     ERR(208)      K78
262800000911     C                   MOVEA     *BLANKS       K78(45)
262810000911     C                   MOVEA     K78           W08MSG
262820000911     C                   ENDIF
262830000907     C                   UPDATE    LS01S08
262840000911     C                   GOTO      ENDS08
262850000907    3C                   ENDIF
262860000911     C                   ADD       1             II
262870000907    2C                   ENDDO
262880000907    1C                   ENDIF
262890000908     c* Controllo che numero cod.chi sono corrisponda con numero colli
262900000908     c* in prima videata
262910000908     C     IX            IFNE      V1CNCL
262920000908     C                   SETON                                        90
262930000911     C     WC01FG        IFEQ      'C'
262940000908     C                   MOVEL     ERR(154)      W08MSG
262950000911     C                   ELSE
262960000911     C                   MOVEA     ERR(154)      K78
262970000911     C                   MOVEA     *BLANKS       K78(54)
262980000911     C                   MOVEA     K78           W08MSG
262990000911     C                   ENDIF
263000000908     C                   ENDIF
263010000911     C     ENDS08        TAG
263020000911     C                   MOVE      *BLANKS       WC01FG
263030000911     C                   ENDSR
263040020308     C**************************************************************************
263050020308     C*   Controllo se cod. chi sono già esistente
263060020308     C**************************************************************************
263070020308     C     CTRCHIDOP     BEGSR
263080020308     C* Se segnac. EUROEX controllo che non sia doppio in altra bolla
263090040505    1c     §ogntw        ifeq      'EEX'
263100020308     C     W8HCOL        ANDEQ     *ZEROS
263110020308     C                   MOVEL     'E'           WTRC
263120051102     C     KARS2         SETLL     FIARS02L                               31
263130020308    2C     *IN31         IFEQ      *ON
263140020308    3c     wnopos        ifeq      *blanks
263150020308     C                   Z-ADD     NR8           V8CNBR
263160020308     c                   seton                                        61
263170020308    3c                   endif
263180020308     C                   SETON                                        90
263190020308     C                   MOVEA     ERR(155)      K78
263200020308     C                   MOVEL     w8CNOT        W030A            30
263210020308     C                   MOVEA     W030A         K78(18)
263220020308     C                   MOVEA     K78           W08MSG
263230020308    3c     wnopos        ifeq      *blanks
263240020308     C                   UPDATE    LS01S08
263250020308    3c                   endif
263260020308     C                   GOTO      ENDCDOP
263270020308    2C                   ENDIF
263280020308    1C                   ENDIF
263290020308     C* MSG FORZABILE SE CHI SONO GIA' PRESENTE SU FISGN
263300020308     C* (SOLO SE RECORD E' DI NUOVA IMMISSIONE)
263310020308     C* 02/05/01: RENDO ERRORE BLOCCANTE SU RICHIESTA DELLA LORENA
263320020308    1C     W8HCOL        IFEQ      *ZEROS
263330020308     C     KSGN88        CHAIN(N)  FISGN01L                           31
263340020308    2C     *IN31         IFEQ      *OFF
263350020308     C     SGNATB        ANDNE     '*'
263360020308    3c     wnopos        ifeq      *blanks
263370020308     C                   Z-ADD     NR8           V8CNBR
263380020308     c                   seton                                        61
263390020308    3c                   endif
263400020308     C                   SETON                                        90
263410020308     c                   eval      w08msg = %trim(err(209)) + ' '
263420020308     c                             + %trim(w8cnot)
263430020308     c                             + ' presente in altra bolla'
263440020308    3c     wnopos        ifeq      *blanks
263450020308     C                   UPDATE    LS01S08
263460020308    3c                   endif
263470020308     C                   GOTO      ENDCDOP
263480020308    2C                   ENDIF
263490020308    1C                   ENDIF
263500020308     c     ENDCDOP       endsr
263510010504     C**************************************************************************
263520010504     C*   ELIMINAZIONE CHI SONO ANNULLATI DA SUBFILE
263530010504     C**************************************************************************
263540010504     C     CTRS8A        BEGSR
263550010504    0C     *IN78         IFEQ      *ON
263560010504     C                   Z-ADD     1             NR8
263570010504     C     NR8           CHAIN     LS01S08                            31
263580010504    1C     *IN31         DOWEQ     *OFF
263590010504     C* SE RECORD ANNULLATO DEVO TOGLIERLO DA CH2
263600010504     C     V8CSCE        IFEQ      'A'
263610010504     C                   Z-ADD     1             WK                3 0
263620010504     C     V8CNOT        LOOKUP    CH2(WK)                                31
263630010504     C   31              MOVE      *BLANKS       CH2(WK)
263640010504     C                   UPDATE    LS01S08
263650010504     C                   ENDIF
263660010504     C                   ADD       1             NR8
263670010504     C  N90NR8           CHAIN     LS01S08                            31
263680010504    1C                   ENDDO
263690010504     C   31              SUB       1             NR8
263700010504    0C                   ENDIF
263710010504     C                   ENDSR
263720000912     C**************************************************************************
263730000912     C*   AGGIORNAMENTO FILE FISGN00F
263740000912     C**************************************************************************
263750000912     C     UPDSGN        BEGSR
263760000921     C* QUESTO CAMPO NON CREDO CHE SIA UTILIZZATO ADOGNI MODI MI SEMBRA
263770000921     C* GIUSTO IN QUESTO CASO ABBLENCARLO
263780000921     C     SGNATB        IFEQ      '*'
263790000921     C                   CLEAR                   SGNSQU
263800000921     C                   ENDIF
263810000921     C*
263820000919     C                   CLEAR                   SGNATB
263830000921     C                   Z-ADD     §3ISEA        SGNSEA
263840000921     C                   MOVEL     'S'           SGNST1
263850000925     C     §1BF12        IFNE      'N'
263860001011     C     WEXDPD        ANDNE     'S'
263870050228     c     *in79         andeq     *off
263880090624      *
263890001009     C     §1BF12        ORNE      'N'
263900001011     C     WEXDPD        ANDEQ     'S'
263910001009     C     §1BF13        ANDEQ     'A'
263911140715
263912140715     C     §1BF12        OReq      'B'
263913140715     C     WEXDPD        ANDEQ     'S'
263920090624      *
263930070323     C     §1BF12        ORNE      'N'
263940070323     C     WEXDPD        ANDEQ     'S'
263950090624     C     wparcel       andeq     '12'
263960090624      *
263970000925     C                   Z-ADD     V8HST2        SGNST2
263980000925     C                   ENDIF
263990000921     C                   MOVE      '0'           SGNFL1
264000000912     C     BLPCCM        IFGT      0
264010000912     C                   MOVEL     BLPCCM        SGNKSC
264020000912     C                   ELSE
264030000912     C                   MOVEL     BLPKSC        SGNKSC
264040000912     C                   ENDIF
264050000921     C                   Z-ADD     BLPLNP        SGNLNP
264060000921     C                   Z-ADD     BLPNSP        SGNNSP
264070010116     C                   CLEAR                   SGNT6A
264080010116     C                   CLEAR                   SGNT6B
264090010116     C                   CLEAR                   SGNT6C
264100010116     C                   CLEAR                   SGNT6D
264110010116     C                   CLEAR                   SGNT6E
264120010116     C                   CLEAR                   SGNT6F
264130080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
264140000922     C                   CLEAR                   SGNRST
264150001005     C     WSGNR         IFEQ      'B'
264160001005     C                   UPDATE    FISGN005
264170001005     C                   ELSE
264180000912     C                   UPDATE    FISGN000
264190001005     C                   ENDIF
264200000912     C                   ENDSR
264210000929     C**************************************************************************
264220000929     C*   SCRITTURA     FILE FISGN00F
264230000929     C**************************************************************************
264240000929     C     WRTSGN        BEGSR
264250000929     C                   CLEAR                   SGNATB
264260000929     C                   MOVEL(P)  V8CNOT        SGNWHO
264270000929     C                   Z-ADD     §3ISEA        SGNSEA
264280000929     C                   MOVEL     'S'           SGNST1
264290001002     C     WSGNR         IFEQ      *BLANKS
264300000929     C                   CLEAR                   SGNST2
264310001002     C                   ELSE
264320001002     C                   Z-ADD     1             SGNST2
264330010405     C* SGNFL2 = N SIGNIFICA CHE SI TRATTA DI FISGN SCRITTO PER SOLA
264340010405     C* RISTAMPA --> NON E' UN REALE DISK C
264350010405     C                   MOVEL     'N'           SGNFL2
264360001002     C                   ENDIF
264370000929     C                   MOVE      '0'           SGNFL1
264380000929     C                   MOVEL     BLPLNP        SGNLNP
264390000929     C                   MOVEL     BLPNSP        SGNNSP
264400000929     C     BLPCCM        IFGT      0
264410000929     C                   MOVEL     BLPCCM        SGNKSC
264420000929     C                   ELSE
264430000929     C                   MOVEL     BLPKSC        SGNKSC
264440000929    4C                   ENDIF
264450010116     C                   CLEAR                   SGNT6A
264460010116     C                   CLEAR                   SGNT6B
264470010116     C                   CLEAR                   SGNT6C
264480010116     C                   CLEAR                   SGNT6D
264490010116     C                   CLEAR                   SGNT6E
264500010116     C                   CLEAR                   SGNT6F
264510080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
264520000929     C                   CLEAR                   SGNRST
264530010116     C                   Z-ADD     COMTFP        SGNTNP
264540001005     C     WSGNR         IFEQ      'B'
264550001005     C                   WRITE     FISGN005
264560001005     C                   ELSE
264570001005     C                   WRITE     FISGN000
264580001005     C                   ENDIF
264590001005     C*
264600000929     C                   ENDSR
264610010209     C**************************************************************************
264620010209     C*   VERIFICO SE ATTIVATA PROCEDURA O.R.M.
264630011121     C**************************************************************************
264640010209     C     ATTORM        BEGSR
264650010209     C                   MOVE      *BLANKS       WORM              1
264660010220     C   12
264670010220     CAN 15VIDPOE        IFGT      *ZEROS
264680010209     C                   MOVEL     'S'           WORM
264690010209     C                   ENDIF
264700010305     C     §LPFPR        IFNE      'O'
264710010215     C     *IN12         IFEQ      *OFF
264720010215     C     *IN15         OREQ      *OFF
264730010219     C                   MOVE      WLNPO         W0030
264740010215     C     W0030         CHAIN     AZORG01L      UNIORG               30
264750010209     C  N30              MOVEL     ORGDE8        OG148
264760010209     C   30              CLEAR                   OG148
264770060926     c                   eval      §ogorm='S'
264780010209     C     §OGORM        IFEQ      'S'
264790010209     C                   MOVEL     'S'           WORM
264800010209     C                   ENDIF
264810010215     C                   ENDIF
264820010305     C                   ELSE
264830010301     C                   MOVEL     'S'           WORM
264840010301     C                   ENDIF
264850010209     C* IMPOSTO INDICATORI PER NON VISUALIZZARE KEY ORM SE P.O. NON
264860010209     C* ABILITATO
264870010209     C     WORM          IFEQ      *BLANKS
264880010223     C                   SETOFF                                       37
264890010209     C                   MOVEL     NDPR          ATRPOE
264900010215     C                   MOVEL     NDPR          ATRORM
264910010219     C                   MOVEL     NODI          ATRDOR
264920010209     C                   CLEAR                   VIDPOE
264930010209     C                   CLEAR                   VIDNOR
264940010209     C                   CLEAR                   VIDNRV
264950010209     C* Campi della videata di personalizzazione
264960010209     C                   MOVEL     NDPR          AT0POE
264970010215     C                   MOVEL     NDPR          AT0ORM
264980010219     C                   MOVEL     NODI          AT0DOR
264990010209     C                   CLEAR                   V0CPOE
265000010209     C                   CLEAR                   V0CNOR
265010010209     C                   CLEAR                   V0CNRV
265020010222     C* Questa routine viene richiamata anche in immissione bolle
265030010222     C* tutte le volte che variano la linea di partenza.
265040010222     C* Se si passa da lnp attivata a proc. ORM ad una NON attivata
265050010222     C* bisogna spegnere indicatore 06 di posiz. cursore su N. ORM
265060010222     C* se è acceso e al suo posto bisogna accendere lo 07
265070010222     C  N12*IN06         IFEQ      *ON
265080010222     C                   SETOFF                                       06
265090010222     C                   SETON                                        07
265100010222     C                   ENDIF
265110010209     C                   ELSE
265120010209     C* PROCEDURA ORM ATTIVA
265130010409     C* Chaino tabella DFT per prendere il massimo peso in KG per la
265140010409     C* richiesta note obbligatoria
265150010409     C* Provo prima con key = p.o. ritiro
265160010409     c* Se record non trovato chaino record 999
265170010409     C                   CLEAR                   WTRDFT
265180010409     C                   CLEAR                   DSBS02
265190010409     C                   MOVEL     'C'           T02MOD
265200010409     C                   MOVEL     KNSIF         T02SIF
265210010409     C                   MOVEL     'DFT'         T02COD
265220010409     C                   MOVEL(P)  WLNPO         T02KE1
265230010409     C     WTRDFT        DOWEQ     *BLANKS
265240010409      *
265250010409     C                   CALL      'TIBS02R'
265260010409     C                   PARM                    KPJBA
265270010409     C                   PARM                    DSBS02
265280010409      *
265290010409     C     T02ERR        IFEQ      *BLANKS
265300010409     C     T02KE1        OREQ      '999'
265310010409     C                   MOVEL     '1'           WTRDFT            1
265320010409     C     T02ERR        IFEQ      *BLANKS
265330010409     C                   MOVEL     T02UNI        DDFT
265340010409     C                   ELSE
265350010409     C                   CLEAR                   DDFT
265360010409     C                   ENDIF
265370010409     C                   ELSE
265380010409     C                   MOVEL     '999'         T02KE1
265390010409     C                   CLEAR                   T02ERR
265400010409     C                   ENDIF
265410010409     C                   ENDDO
265420010409     C*
265430010209     C                   CLEAR                   ATRPOE
265440010215     C                   CLEAR                   ATRORM
265450010219     C                   CLEAR                   ATRDOR
265460010209     C* Campi della videata di personalizzazione
265470010209     C                   CLEAR                   AT0POE
265480010215     C                   CLEAR                   AT0ORM
265490010219     C                   CLEAR                   AT0DOR
265500010209     C* IN IMMISSIONE PREPAGATI  MIEI KEY ORM = ND + PR
265510010220     C     PARTCH        IFEQ      'P'
265520010220     C                   MOVEL     NDPR          ATRPOE
265530010220     C                   MOVEL     NDPR          ATRORM
265540010220     C                   MOVEL     NODI          ATRDOR
265550010220     C                   MOVEL     NDPR          AT0POE
265560010220     C                   MOVEL     NDPR          AT0ORM
265570010220     C                   MOVEL     NODI          AT0DOR
265580010220     C                   ENDIF
265590010209     C* IN IMMISSIONE PREPAG.NON MIEI KEY ORM =      PR
265600010301     C     §LPFPR        IFEQ      'O'
265610010209     C* IN CONFERMA                   KEY ORM =      PR
265620010301     C     *IN12         OREQ      *ON
265630010301     C     *IN15         ANDEQ     *ON
265640010301     C                   MOVEL     PROT          ATRPOE
265650010301     C                   MOVEL     PROT          ATRORM
265660010301     C                   ENDIF
265670010213     C*
265680010213     C* INIZIALIZZO ANCHE CAMPI DI CMODO CHE MI SERVONO NELLA ROUTINE
265690010213     C* DEI CONTROLLI SE PROCEDURA ORM ATTIVATA
265700010220     C     *IN12         IFEQ      *OFF
265710010301     C     §LPFPR        ANDNE     'O'
265720010213     C                   CLEAR                   PREDRT
265730010214     C                   CLEAR                   PREPDR
265740010214     C                   CLEAR                   PREFPP
265750010214     C                   CLEAR                   PRECCM
265760010214     C                   CLEAR                   PREFFD
265770010222     C* Questa routine viene richiamata anche in immissione bolle
265780010222     C* tutte le volte che variano la linea di partenza.
265790010222     C* Se si passa da lnp non attivata a proc. ORM ad una attivata
265800010222     C* bisogna spegnere indicatore 07 di posiz. cursore su cod mitt
265810010222     C* se è acceso e al suo posto bisogna accendere lo 06
265820010222     C     *IN07         IFEQ      *ON
265830010222     C                   SETOFF                                       07
265840010222     C                   SETON                                        06
265850010222     C                   ENDIF
265860010220     C                   ENDIF
265870010215     C                   CLEAR                   WORMMD
265880010220     C                   CLEAR                   WPRIMV
265890040319     c                   Eval      wmodorm = *Off
265900010222     C* SE SONO IN MANUTENZIONE DEVO POSIZIONARE IL CURSORE SUL
265910010222     C* NUMERO ORM
265920010222     C     *IN12         IFEQ      *ON
265930010222     C     *IN15         ANDEQ     *OFF
265940040323      * ma se bolla di recupero o bolla 'FW' devo proteggere il n. ORM
265950040323if  3c                   If        §3arbl = 'R' or vidcbo = 'FW'
265960040323     c                   Movel     prot          atrpoe
265970040323     c                   Movel     prot          atrorm
265980040324     c                   Eval      *In06 = *Off
265990040323     c                   GoTo      Endattorm
266000040323e   3c                   EndIf
266010040323      * o se bolla legata devo proteggere il n. ORM
266020040323     c     kBlp3         Setll     Fnlbl01l
266030040323if  3c                   If        %Equal(Fnlbl01l)
266040040323     c                   Movel     prot          atrpoe
266050040323     c                   Movel     prot          atrorm
266060040324     c                   Eval      *In06 = *Off
266070040323     c                   GoTo      Endattorm
266080040323    3c                   EndIf
266090010222     C                   SETOFF                                       07
266100010222     C                   SETON                                        06
266110010222     C                   ENDIF
266120010209     C                   ENDIF
266130011121     C*
266140040323     C     endattorm     ENDSR
266150010228     C**************************************************************************
266160010228     C*   RIEMPIMENTO CAMPI DI PASSAGGIO A PGM FIOR05R
266170010228     C**************************************************************************
266180010228     C     RIEO05        BEGSR
266190010228     C                   CLEAR                   DSOR05
266200010228     C*
266210010228     C                   MOVEL     '2'           §RMTLA
266220010228     C                   MOVEL     'B'           §RMFPR
266230010228     C                   Z-ADD     VIDLNP        §RMPOE
266240010228     C                   Z-ADD     VIDLNP        §RMPOR
266250010228     C                   MOVEL     'P'           §RMTOR
266260010228     C                   MOVEL     'P'           §RMTCO
266270010305     C                   Z-ADD     VIDCCM        W0070             7 0
266280010228     C     VIDFLC        IFEQ      0
266290010228     C                   MOVEL     VIDLNP        W0070
266300010228     C                   ELSE
266310010228     C                   MOVEL     VIDFLC        W0070
266320010228     C                   ENDIF
266330010228     C                   CLEAR                   §RMCRA
266340010228     C     VIDCCM        IFNE      8888
266350010228     C                   MOVEL     W0070         §RMCRA
266360010228     C                   ENDIF
266370010228     C                   MOVEL     VIDRSM        §RMRSR
266380010228     C                   MOVEL     VIDINM        §RMINR
266390010228     C                   MOVEL     VIDCAM        §RMCAR
266400010228     C                   MOVEL     VIDLOM        §RMLOR
266410010228     C                   MOVEL     VIDPRM        §RMPRR
266420010228     C                   MOVEL     VIDNZM        §RMNAR
266430010228     C                   MOVEL     VIDRSD        §RMRSC
266440010228     C                   MOVEL     VIDIND        §RMINC
266450010228     C                   MOVEL     VIDCAD        §RMCAC
266460010228     C                   MOVEL     VIDLOD        §RMLOC
266470010228     C                   MOVEL     VIDPRD        §RMPRC
266480010228     C                   MOVEL     VIDNZD        §RMNAC
266490010228     C     VIDFFD        IFEQ      'N'
266500010228     C                   MOVEL     *BLANKS       §RMFFD
266510010228     C                   ELSE
266520010228     C                   MOVEL     VIDFFD        §RMFFD
266530010228     C                   ENDIF
266540010228     C                   MOVEL     VIDNAS        §RMNAM
266550010228     C                   Z-ADD     VIDNCL        §RMNCL
266560010228     C                   Z-ADD     VIDPKG        §RMPKG
266570010228     C                   Z-ADD     VIDVOL        §RMVLM
266580010228     C                   MOVEL     'M'           §RMPAG
266590010228     C                   MOVEL     VIDNT1        §RMNO1
266600010228     C                   MOVEL     VIDNT2        §RMNO2
266610010228     C                   MOVEL     VIDRMA        §RMRFA
266620010228     C                   ENDSR
266630011212     C**************************************************************************
266640011212     C*   RICHIAMO PGM DI UTILITA' PER EDITARE CAMPO NUMERICO
266650011212     C**************************************************************************
266660011212     C     CALLXE        BEGSR
266670011212     C                   CLEAR                   DSEDIT
266680011212     C                   CLEAR                   W014A
266690011212     C                   MOVE      WNUMED        IEDNUM
266700011212     C                   Z-ADD     3             IEDNRD
266710011212     C                   MOVE      '4'           IEDEDT
266720011212     C                   Z-ADD     14            IEDLEN
266730011212     C                   CALL      'XEDIT'
266740011212     C                   PARM                    DSEDIT
266750011212     C     OEDFLG        IFEQ      *OFF
266760011212     C                   MOVEL     OEDNUM        W014A            14
266770011212     C                   ENDIF
266780011212     C                   ENDSR
266790020212     C**************************************************************************
266800020212     C*   Calcolo check digit AWB FEDEX
266810020212     C**************************************************************************
266820020212     C     CHKDGF        BEGSR
266830020212      * Il check digit del codice a barre di FedEx va colcolato moltiplicando
266840020212      * il numero del codice a barre (partendo dall'undicesimo e andando a
266850020212      * a ritroso) per un valore alternato (1 - 3 - 7) e sommati tra loro, il
266860020212      * totale va diviso per 11 e il resto è i check digit
266870020212      * se il resto è 10 o 0 il check digit deve essere 0
266880020212      * Esempio:
266890020212      * codice a barre 0 1  2 3 4  5  6 7  8  9 8
266900020212      * valore         3 1  7 3 1  7  3 1  7  3 1
266910020212      * totale         0 1 14 9 4 35 18 7 56 27 8 = 179
266920020212      * check digit    179 / 11 = 16 resto 3
266930020212     c                   move      w0012a        fedexbrc
266940020214     c                   clear                   totale
266950020212
266960020212      * Carico 1 - 3 - 7 in una schiera di comodo 'base'
266970020212
266980020212     c                   eval      base(1) = 1
266990020212     c                   eval      base(2) = 3
267000020212     c                   eval      base(3) = 7
267010020212
267020020212     c                   eval      zw = 0
267030020212
267040020212      * parto dall'undicesimo numero
267050020212     c     11            do        11            xw
267060020212      * andando all'indietro il contatore arriva a 0 e devo uscire dal ciclo
267070020212     c                   if        xw = 0
267080020212     c                   leave
267090020212     c                   endif
267100020212     c                   eval      zw = zw + 1
267110020212     c                   eval      totale = totale + (fbrc(xw) * base(zw))
267120020212
267130020212     c                   if        zw = 3
267140020212     c                   eval      zw = 0
267150020212     c                   endif
267160020212      * torno indietro
267170020212     c                   enddo     -1
267180020212
267190020212     c     totale        div       11            intero
267200020212     c                   mvr                     restof
267210020212
267220020212     c                   if        restof = 0 or restof = 10
267230020212     c                   move      '0'           fchd
267240020212     c                   else
267250020212     c                   move      restof        fchd
267260020212     c                   endif
267270020212
267280020212     c                   move      fedexbrc      w0012a
267290020212     c                   ENDSR
267300040601     C**************************************************************************
267310040601     C*   Scrittura fiar8
267320040601     C**************************************************************************
267330040601     C     SR_fiar8      BEGSR
267340040601     c     kblc          setll     fivax01l
267350040601     c                   do        *hival
267360061010     c     kblc          reade(N)  fivax01l
267370040601     c                   if        %eof(fivax01l)
267380040601     c                   leave
267390040601     C                   endif
267400040601     c                   clear                   fiar8000
267410040601     c                   Eval      Ar8Aas = BlpAas
267420040601     c                   Eval      Ar8Lnp = BlpLnp
267430040601     c                   Eval      Ar8Nrs = BlpNrs
267440040601     c                   Eval      Ar8Nsp = BlpNsp
267450040601     c                   eval      ar8tmd = vaxtmd
267460040601     c                   eval      ar8prr = vaxprr
267470040601     c                   eval      ar8trk = vaxtrk
267480050913     c                   eval      ar8uni = %trimr(vaxdtt)
267490130924     c                   if        aggioAr8='S'
267500040601     c                   write     fiar8000
267510130924     c                   endif
267520130308     c                   eval      w_allx='S'
267530040601     c                   enddo
267540040601     c                   endsr
267550130304     C**************************************************************************
267560130304     C*   Scrittura fiar8 da fivat tipo record "P"
267570130304     C**************************************************************************
267580130304     C     SR_fiar8_vatp BEGSR
267590130304     c                   clear                   w_prr
267600130304     c                   clear                   w_pdfn
267610130304     C                   MOVEL     'P'           WTRC
267620130304     c     kvat          setll     fivat01l
267630130305    1c                   do        *hival
267640130304     c     kvat          reade(N)  fivat01l
267650130305    2c                   if        %eof(fivat01l)
267660130304     c                   leave
267670130305    2C                   endif
267680130304     c                   movel(P)  vatnot        dvatp
267690130305    2c                   if        §vatppdfn=*blanks
267700130304     c                             or §vatppdfn=w_pdfn
267710130304     C                   iter
267720130305    2c                   endif
267730130304     c                   movel     §vatppdfn     w_pdfn
267740130304     c                   eval      w_prr+=1
267750130304     c                   clear                   fiar8000
267760130304     c                   Eval      Ar8Aas = BlpAas
267770130304     c                   Eval      Ar8Lnp = BlpLnp
267780130304     c                   Eval      Ar8Nrs = BlpNrs
267790130304     c                   Eval      Ar8Nsp = BlpNsp
267800130304     c                   eval      ar8tmd = '§PDF'
267810130304     c                   eval      ar8prr = w_prr
267820130304     c                   clear                   dar8§pdf
267830130304     c                   eval      §AR8PIDZ=§VATPIDZ
267840130306     c                   eval      §AR8PPDFP=§clipdfp
267850130306     c                   eval      §AR8PPDFn=§VATPPDFN
267860130311     c* se non prevista la stampa imposto a "N" il flag per il trattamento
267870130311     c* dell'allegato (su richiesta di FG)
267880130315     c                   if        %subst(§ar8pidz:1:1)<>'1'
267890130311     c                   eval      §ar8ptrt='N'
267900130315     c                   endif
267910130408     c* se non prevista la mail   imposto a "N" il flag per invio email
267920130408     c                   if        %subst(§ar8pidz:2:1)<>'1'
267930130408     c                   eval      §ar8peml='N'
267940130408     c                   else
267950130408     c                   eval      w_allm='S'
267960130408     c                   endif
267970130304     c                   eval      ar8uni = %trimr(dar8§pdf)
267980130924     c                   if        aggioAr8='S'
267990130304     c                   write     fiar8000
268000130924     c                   endif
268010130305    1c                   enddo
268020130304     c                   endsr
268030060308     C**************************************************************************
268040060308     C*   Richiamo lv85r per chiusura in LR
268050060308     C**************************************************************************
268060060308     C     CLS_lv85      BEGSR
268070060308     c*   ATTENZIONE: Il pgm fnlv85r serve per gestire richiesta, controllo
268080060308     c*               registrazione su data base del motivo variazione
268090060308     c*
268100060308     c*               Per ora il pgm di bollettazione richiama l'lv85
268110060308     c*               in due casi diversi di variazione bolla:
268120060308     c*               1)variazione totale imponibile di un prepagato (cvb TR
268130060308     c*               2)annullamento di un prepagato (cvb KM)
268140060308     c*
268150060308     c*               Quando fnlv85r viene richiamato in modalità "V"
268160060308     c*               (richiesta e controllo della motivazione)
268170060308     c*               viene passato tipo lancio (ilv85tla) = blanks
268180060308     c*               per chiudere in return.
268190060308     c*               In questo modo la window di richiesta motivazione
268200060308     c*               non viene pulita ed in caso di F12=Ritorno e successi-
268210060308     c*               va riconferma della variazione la window viene ripropo
268220060308     c*               sta con i dati precedentemente immessi.
268230060308     c*               Il pgm deve però essere chiuso con LR se la window
268240060308     c*               precedente era stata emessa a fronte di una causale
268250060308     c*               diversa dalla quale si era usciti con f12 anzichè
268260060308     c*               con f6=Conferma. Questa routine serve proprio per
268270060308     c*               chiudere con LR se cambiata la causale variazione
268280060308     c*               al fine di emettere la window pulita.
268290060308     c*
268300060308     c                   if        ilv85cvb <> *blanks and ilv85cvb <> wcvb
268310060308     c                   clear                   fnlv85ds
268320060308     c                   eval      ilv85tla = 'C'
268330060308     c                   movel     fnlv85ds      kpjbu
268340060308     c                   call      'FNLV85R'
268350060308     c                   parm                    kpjba
268360060308     c                   endif
268370060308     c                   endsr
268380060427     C**************************************************************************
268390060427     C*   Forzature per orm esteri con triangolazione
268400060427     C**************************************************************************
268410060427     C     sr_FOrmEst    BEGSR
268420060427      * Forzo che deve essere un porto franco
268430060427     c                   Eval      §OrPfb = 'F'
268440060427      * Flag di appoggio per portare l'ordinante nel mittente
268450060427      * e il mittente orm nel mittente originale
268460060427     c                   Eval      wforpf = '1'
268470060427if 1ac                   if        wnoccm = '1'
268480130212     c                   clear                   wnoccm
268490060427      * Ksc da ORM
268500060427if  2c                   If        OrmKsc > *Zeros
268510060427      * propongo il ksc dell'ORM
268520060427     c                   Move      OrmKsc        vidccm
268530060427     c                   Movel     OrmKsc        w0030
268540130212     c                   Z-add     w0030         vidflc
268550060427      * SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
268560060427      *  BOLLA --> ABILITA LA FILIALE CLIENTE
268570060427if  3C                   If        w0030 <> vidlnp
268580130212     c****               Z-add     w0030         vidflc
268590060427     c                   Seton                                        14
268600060427    3c                   EndIf
268610060427      * no Ksc da ORM
268620060427   x2c                   Else
268630060427      * propongo la ragione sociale dell'ordinante nella ricerca alfabetica
268640060427     c                   Movel     OrmRso        viddmt
268650060427     c                   clear                   vidccm
268660060427if  3c                   If        viddmt <> *Blanks
268670060427     c***                Seton                                        0138
268680060427     c                   Seton                                        01
268690060427    3c                   EndIf
268700060427    2c                   EndIf
268710060427   1ac                   endif
268720060427     c                   endsr
268730070403     C**************************************************************************
268740070403     C*   Aggiornamento/scrittura numero giro
268750070403     C**************************************************************************
268760070403     C     sr_FIARG      BEGSR
268770070404     c                   clear                   wupd              1
268780100323     c                   clear                   wFGI              1
268790100323     c                   clear                   wAggioARG
268800100323     c* Verifico se per il cliente mittente è presente una forzatura GIRO
268810100323     c*  nel file azfgi
268820100323     c                   eval      kksc=wksc
268830100323     c                   eval      klnp=blplnp
268840100323     c                   eval      klna=blplna
268850100323     c                   exsr      LeggiFGI
268860100323     c
268870100323    1c                   if        wfgi=*blanks
268880100323     c                   eval      klnp=999
268890100323     c                   exsr      LeggiFGI
268900100323    1c                   endif
268910100323     c
268920100323    1c                   select
268930070405     c* conferma bolla di reso
268940070405     c                   when      *in12='1' and *in15='1' and
268950070405     c                             vidfbr='S' and *in44='1'
268960070705     c*                  if        §lpcgi<>*blanks and
268970070705     c*                            vidrsd=savrsd and
268980070705     c*                            vidind=savind and
268990070705     c*                            vidprd=savprd and
269000070705     c*                            vidcad=savcad and
269010070705     c*                            vidlod=savlod and
269020070705     c*                            vidnzd=nzdini
269030100323    2c                   if        §lpcgi<>*blanks
269040070405     c                   eval      w_cgi=§lpcgi
269050070405     c                   exsr      ges_arg
269060100323    2c                   endif
269070100323
269080100323     c* Immissione oppure conferma bolla NON di reso
269090100323    1c                   when      *in12='0' or *in15='1'
269100100323     c*  Se c'e' AZFGI --> vince sui destinatari
269110100323    2c                   if        wfgi='S'
269120100323     c                   eval      w_cgi=fgicgi
269130100323     c                   exsr      ges_arg
269140100323   x2c                   else
269150100323    3c                   if        ot0err=*blanks and ot0x1cgi<>*blanks
269160070924     c                             and comlna=ot0x1pog
269170070924     c                   eval      w_cgi=ot0x1cgi
269180070404     c                   exsr      ges_arg
269190100323    3c                   endif
269200100323    2c                   endif
269210100323     c* Manutenzione bolla
269220100323    1c                   when      *in12='1' and *in15='0'
269230100323     c* Se modificato il mittente ed il nuovo ha il giro forzato --> vince
269240100323    2c                   if        wksc<>savmit  or
269250100323     c                             blplna<>lna_sav
269260100323     c                   clear                   wupd              1
269270100323     c     kblp3         chain     fiarg01l
269280100323    3c                   if        %found(fiarg01l)
269290100323     c                   eval      wupd='1'
269300100323    3c                   endif
269310100323     c
269320100323    3c                   if        wFGI='S'
269330100323     c                   eval      w_cgi=fgicgi
269340100323     c                   exsr      ges_arg
269350100323   x3c                   else
269360100323     c
269370100323     c* Se non ha il giro ed il vecchio ce lo aveva, cancello FIARG
269380100323     c*  e poi proseguo con gli altri controlli
269390100323     c
269400100323    4c                   if        %found(fiarg01l)
269410100323     c                   eval      klna=lna_sav
269420100323     c                   eval      kksc=savmit
269430100323     c                   eval      klnp=blplnp
269440100323     c                   exsr      LeggiFGI
269450100323     c
269460100323    5c                   if        wfgi=*blanks
269470100323     c                   eval      klnp=999
269480100323     c                   exsr      LeggiFGI
269490100323    5c                   endif
269500100323     c
269510100323    5c                   if        wfgi='S' and fgicgi=argcgi
269520100323     c                   delete    fiarg000
269530100323    5c                   endif
269540100323    4c                   endif
269550100323    3c                   endif
269560100323    2c                   endif
269570100323     c
269580100323    2c                   if        vidrsd<>savrsd or
269590070404     c                             blpind<>savind or
269600070404     c                             blpprd<>savprd or
269610070404     c                             blpcad<>savcad or
269620070404     c                             blplod<>savlod or
269630070404     c                             blpnzd<>savnzd or
269640100323     c                             blplna<>lna_sav or
269650100323     c                             wksc<>savmit
269660100323     c
269670100323     c* non Faccio nulla se ho già aggiornato FIARG col nuovo mittente o
269680100323     c*  nuova linea di arrivo
269690100323    3c                   if        WaggioARG=' '
269700100323     c
269710100323    4c                   if        ot0err=*blanks and
269720071010     c                             ot0x1cgi<>*blanks and comlna=ot0x1pog
269730070924     c                   eval      w_cgi=ot0x1cgi
269740100323     c                   clear                   wupd              1
269750070404     c     kblp3         chain     fiarg01l
269760100323    5c                   if        %found(fiarg01l)
269770070404     c                   eval      wupd='1'
269780100323    5c                   endif
269790070404     c                   exsr      ges_arg
269800100323   x4c                   else
269810070404     c     kblp3         delete(e) fiarg01l
269820100323    4c                   endif
269830100323    3c                   endif
269840100323    2c                   endif
269850100323    1c                   endsl
269860070403     c
269870070403     c                   endsr
269880070404     C**************************************************************************
269890070404     C*   Aggiornamento/scrittura numero giro
269900070404     C**************************************************************************
269910070404     C     ges_arg       BEGSR
269920100323     c                   clear                   WaggioARG         1
269930070404     c                   if        wupd=*blanks
269940070404     c                   clear                   fiarg000
269950070404     c                   z-add     blpaas        argaas
269960070404     c                   z-add     blplnp        arglnp
269970070404     c                   z-add     blpnrs        argnrs
269980070404     c                   z-add     blpnsp        argnsp
269990070404     c                   endif
270000070404     c                   z-add     blplna        arglna
270010070404     c* p.o. di consegna capofila della £6 del p.o. di arrivo
270020070404     c                   clear                   dslv55
270030070404     c                   eval      d55tpt = '6'
270040070404     c                   z-add     blplna        d55lin
270050070404     c                   z-add     blpdsp        d55drf
270060070404     c                   call      'FNLV55R'
270070070404     c                   parm                    dslv55
270080070404     c                   z-add     d55tfa        argpoc
270090070404     c                   movel     'M'           argtgi
270100070404     c                   movel     w_cgi         argcgi
270110070404     c                   if        wupd=*blanks
270120070404     c                   write     fiarg000
270130070404     c                   else
270140070404     c                   update    fiarg000
270150070404     c                   endif
270160100323     c
270170100323     c                   eval      wAggioARG='S'
270180070404     c                   endsr
270190100323     C**************************************************************************
270200100323     c* Lettura file forzatura giro di consegna
270210100323     C**************************************************************************
270220100323     c     LeggiFGI      BEGSR
270230100323     c     kfgi          setll     azfgi01l
270240100323     c     kfgi          reade     azfgi01l
270250100323     c
270260100323     c                   dow       not %eof(azfgi01l)
270270100323     c                   if        blpdsp>=fgidde and blpdsp<=fgidsc
270280100323     c                             and fgiatb=' '  and klna = fgipog
270290100323     c                   eval      wfgi='S'
270300100323     c                   leave
270310100323     c                   endif
270320100323     c
270330100323     c     kfgi          reade     azfgi01l
270340100323     c                   enddo
270350100323
270360100323     c                   ENDSR
270370070604     C**************************************************************************
270380070604     C*   Aggiornamento dati per PDA
270390070604     C**************************************************************************
270400070604     C     Sr_pda        BEGSR
270410070604     c* verifico se già estratti orm per pda
270420080111     C****               CLEAR                   dsbs02
270430080111     c****               clear                   dpdo
270440080111     C****               MOVEL     'C'           T02MOD
270450080111     C****               MOVEL     KNSIF         T02SIF
270460080111     C****               MOVEL     'PDO'         T02COD
270470080111     c****               movel(P)  g_ormpor      t02ke1
270480080111     C****               CALL      'TIBS02R'
270490080111     C****               PARM                    KPJBA
270500080111     C****               PARM                    dsbs02
270510080111    2C****               IF        T02ERR = *BLANKS
270520080111     C****               MOVEL     T02uni        dpdo
270530080111    2C****               ENDIF
270540080111     c****               clear                   aggpda            1
270550080111    1c****               if        d§pdodata>0
270560080111    2c****               if        ormddc<> d§pdodata
270570070604     c     kfnorf        chain     fnorf01l
270580070604    3c                   if        %found(fnorf01l)
270590080221     c**!!!kfipdo        chain     fipdo01t
270600080111    4c****               if        not %found(fipdo01t)
270610080221    4c**!!!              if        %found(fipdo01t)
270620080111     c****               eval      aggpda='N'
270630080111    4c****               endif
270640080111    3c****               endif
270650080111    2c****               endif
270660080111    2c****               if        aggpda=' '
270670070604     c                   clear                   fior56ds
270680070604     c                   eval      or56tla = 'O'
270690070604     c                   eval      or56poe = ormpoe
270700070604     c                   eval      or56nsr = ormnsr
270710070604     c                   eval      or56nor = ormnor
270720070604     c                   eval      or56nrv = ormnrv
270730080111     c                   eval      or56fgs = orffgs
270740080111     c                   eval      or56ndcd = orfndc
270750080111     c                   eval      or56ndca = orfndc
270760080111     c                   eval      or56ddc = orfddc
270770140121     c                   eval      or56cmd  = 'V'
270780140121     c                   eval      or56var = 'I'
270790070604     c                   call      'FIOR56R'
270800070604     c                   parm                    kpjbu
270810070604     c                   parm                    fior56ds
270820070604     c* se effettuato scarico memorizzo di avvisare dell'avvenuto sca-
270830070604     c* rico a PDA
270840070604    3c                   if        or56err=*blanks
270850070604     c                   eval      wmsg_pda='S'
270860070606     c                   exsr      sr_dst
270870070606     c                   move      dstpdr        w02pdr_p
270880070604    3c                   endif
270890080221    2c**!!!              endif
270900070604    1c                   endif
270910070604     c                   endsr
270920071023     C**************************************************************************
270930071023     C*   Impostazione campo partita iva mittente
270940071023     C**************************************************************************
270950071023     C     Sr_wpiva      BEGSR
270960071023     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
270970071023     c                   select
270980071023     c* solo numeri
270990071023     c* "PRIVATO senza iso
271000071023     c     *in30         wheneq    *off
271010071023     c     wiso          andge     *zeros
271020071023     c     *in30         oreq      *on
271030071023     c     posiz         andlt     3
271040071023     c                   movel     wpiva         vidcpm
271050071023     c* iso + numeri
271060071023     c* iso + "PRIVATO"
271070071023     c     *in30         wheneq    *off
271080071023     c     posiz         orgt      2
271090071023     c                   movel     wpiva         vidpim
271100071023     c                   endsl
271110071023     c                   endsr
271120071218     C**************************************************************************
271130071218     C*   Reperimento dati tabella cli
271140071218     C**************************************************************************
271150071218     C     Sr_dcli       BEGSR
271160071218     C                   CLEAR                   dsbs02
271170071218     c                   clear                   dcli
271180071218     C                   MOVEL     'C'           T02MOD
271190071218     C                   MOVEL     KNSIF         T02SIF
271200071218     C                   MOVEL     'CLI'         T02COD
271210071221     c                   movel(P)  wksc          t02ke1
271220071218     C                   CALL      'TIBS02R'
271230071218     C                   PARM                    KPJBA
271240071218     C                   PARM                    dsbs02
271250071218    2C                   IF        T02ERR = *BLANKS
271260071218     C                   MOVEL     T02uni        dcli
271270071218    2C                   ENDIF
271280131003     c* Personalizzazione instradamento merce:
271290131003     c* se pieni, sposto peso e volume medio in campi numerici
271300131003     c                   clear                   n_§clipsm
271310131003     c                   clear                   n_§clivlm
271320131003     c                   testn                   §clipsm              30
271330131003     c                   if        *in30 and %subst(§clipsm:7:1)>='0'
271340131003     c                   move      §clipsm       n_§clipsm
271350131003     c                   endif
271360131003     c                   testn                   §clivlm              30
271370131003     c                   if        *in30 and %subst(§clivlm:5:1)>='0'
271380131003     c                   move      §clivlm       n_§clivlm
271390131003     c                   endif
271400131003     c
271410071218     c                   endsr
271420071220     C**************************************************************************
271430071220     C*   Controlli per abilitazione modifica lna di sped. disk B
271440071220     C**************************************************************************
271450071220     C     Sr_chkabilna  BEGSR
271460120817     c***  kblt1         setll     fnblt01l
271470120817     c***  kblt1         reade(N)  fnblt01l
271480120817     c***                dow       not %eof(fnblt01l)
271490120817     c     kblt1         setll     fiart01l
271500120817     c     kblt1         reade(N)  fiart01l
271510120817     c                   dow       not %eof(fiart01l)
271520120817     c     kanm2         setll     fnbrv07l
271530071220     c* - presenti spunte dei segnacolli con la vecchia lna
271540071220     c                   if        %equal(fnbrv07l)
271550071220     c                   seton                                        4790
271560071221     c                   movel     err(315)      vidmsg
271570071220     c                   goto      f_chkabilna
271580071220     c                   endif
271590071220     c* - non presenti spunte dei segnacolli con la nuova lna
271600071221     c     kbrv7         setll     fnbrv07l
271610071220     c                   if        not %equal(fnbrv07l)
271620071220     c                   seton                                        4790
271630071221     c                   movel     err(316)      vidmsg
271640071220     c                   goto      f_chkabilna
271650071220     c                   endif
271660071220     c* - segnacolli doppi sulla nuova lna
271670120829     c* - Non controlla presenza su fiars perchè in questa situazione ars non c'
271680120829     c*   è
271690120817     c**   kbrv7         setll     fnblt27l
271700120817     c**                 if        %equal(fnblt27l)
271710120817     c**   kbrv7         chain     fnblt27l
271720120817     c     kbrv7         setll     fiart27l
271730120817     c                   if        %equal(fiart27l)
271740120817     c     kbrv7         chain     fiart27l
271750071221     c                   seton                                        4790
271760071221     c                   clear                   vidmsg
271770080103     c                   eval      vidmsg='SEGNACOLLO'
271780071221     c                   eval      vidmsg=%trim(vidmsg) + ' ' +
271790120817     c                             %char(artnsc)
271800071221     c                   eval      vidmsg=%trim(vidmsg)+
271810080103     c                             ' DOPPIO: presente su spedizione '
271820120817     c                             + %char(artlnp)
271830120817     c                   eval      vidmsg=%trim(vidmsg)+ ' ' + %char(artnrs)
271840080103     c                             + '-'
271850080103     c                   eval      vidmsg=%trim(vidmsg) +
271860120817     c                             %char(artnsp) +' ' + %char(artaas)
271870071221     c                   goto      f_chkabilna
271880071221     c                   endif
271890120817     c***  kblt1         reade(N)  fnblt01l
271900120817     c     kblt1         reade(N)  fiart01l
271910071220     c                   enddo
271920071220     c* - nuova lna è estera
271930100210     c                   if        a_§ogntw<>'COR' and a_§ogntw<>'MES'
271940100210     c                   seton                                        4790
271950100210     c                   movel     err(317)      vidmsg
271960100210     c                   goto      f_chkabilna
271970100210     c                   endif
271980071220     c     f_chkabilna   endsr
271990080313     C**************************************************************************
272000080313     C*   Verifica se cliente con serie parziale
272010080313     C**************************************************************************
272020100517     C**   Sr_parz       BEGSR
272030100517     c**                 clear                   wparz
272040100517     c**                 clear                   wparz_d
272050100517     c**                 clear                   wparz_a
272060100517    1c**                 if        vidnrs>0
272070100517     c**                 eval      k_tbecod = '3CP'
272080100517     c**                 movel(p)  wksc          k_tbeke1
272090100517     c**   ktbe1         setll     tntbe01l
272100100517    2c**                 do        *hival
272110100517     c**   ktbe1         reade(N)  tntbe01l
272120100517    3c**                 if        %eof(tntbe01l)
272130100517     c**                 leave
272140100517    3c**                 endif
272150100517    3c**                 if        tbeatb='A'
272160100517     c**                 iter
272170100517    3c**                 endif
272180100517     c**                 movel     tbeuni        d3cp
272190100517     c**                 clear                   w007a             7
272200100517     c**                 eval      w007a  = %subst(tbeke2: 3: 7)
272210100517     c**                 move      w007a         wparz_d
272220100517     c**                 z-add     §3cpal        wparz_a
272230100517     c**                 eval      wparz = 'S'
272240100517    2c**                 enddo
272250100517    1c**                 endif
272260100517     c**                 endsr
272270090327     C**************************************************************************
272280090327     C*    PULIZIA CAMPI window cliente/tariffa tassazione porti assegnati
272290090327     C**************************************************************************
272300090327     C     sr_inzwdwcli  BEGSR
272310090327     c                   clear                   wcliksc
272320090327     c                   clear                   wclidks
272330090327     c                   clear                   wclictr
272340090327     c                   clear                   atrwksc
272350090327     c                   clear                   atrwctr
272360090327     c                   endsr
272370090323     C**************************************************************************
272380090323     C*   Gestione window per immissione/modifica cli/tariffa per tassaz. p.a.
272390090323     C**************************************************************************
272400090323     C     geswdw_clitar BEGSR
272410090323     c                   exsr      riewdwcli
272420090325     c                   clear                   hcliriga
272430090325     c                   clear                   hclicolo
272440090327     c                   eval      s_wcliksc=wcliksc
272450090326     c                   eval      s_wclictr=wclictr
272460090324     c                   eval      $fine='0'
272470090323     c*
272480090323     c                   dow       $fine='0'
272490090323     c                   exfmt     ls01wcli
272500090325     c                   eval      *in90='0'
272510090325     c                   clear                   hcliriga
272520090325     c                   clear                   hclicolo
272530090323     c                   select
272540090323     c* f12=Ritorno
272550090323     c                   when      *inkl='1'
272560090323     c                   eval      $fine='1'
272570090327     c                   eval      wcliksc=s_wcliksc
272580090326     c                   eval      wclictr=s_wclictr
272590090323     c                   other
272600090323     c* f6=conferma o enter
272610090323     c                   exsr      ctrwdwcli
272620090323     c                   if        *inkf and not *in90
272630090326     c                   eval      $fine='1'
272640090323     c                   endif
272650090323     c                   endsl
272660090323     c                   enddo
272670090323     c*
272680090323     c                   endsr
272690090324     C**************************************************************************
272700090324     C* Riempimento campi window cliente/tariffa per tassazione porti assegnati
272710090324     C**************************************************************************
272720090325     C     riewdwcli     BEGSR
272730090324
272740090324     c                   select
272750090324     c* DA ORM
272760090324     c                   when      partch<>'P' and flgfit<>'S'
272770090325     c                   exsr      sr_clearing
272780090324      * Se ORM richiede la bolla in porto assegnato e bolla in porto assegnato
272790090324      * memorizzo il codice cliente che servirà in arrivo in tassazione
272800090324      * porti assegnati. Memorizzo il codice cliente anche nel caso
272810090324      * di bolla in p.a. che fa parte del clearing dpd
272820090324if  2c                   If         ((§OrPfb = 'A' or wforpf = '1') and *In04
272830090324     c                              and Ormksc > *Zeros) or *in04 and wclg='S'
272840090324    3c                   if        wclg=' '
272850090327     c                   Z-add     OrmKsc        wcliksc
272860090325     c                   eval      atrwksc=prot
272870090327     c                   if        ormctr<>*blanks
272880090324     c                   Move      OrmCtr        wclictr
272890090325     c                   eval      atrwctr=prot
272900090324     c                   endif
272910090324   x3c                   else
272920090324     c* se spedizione che va nel clearing il codice cliente è da
272930090324     c* reperire su EDTAB tab 'PU'
272940090324     c                   eval      kedcod='PU'
272950090324     c                   clear                   kedkey
272960090324     c                   move      wopoe         com003a           3
272970090324     c                   eval      kedkey='DPD'+com003a
272980090324     c     kedtab        chain     edtab01l
272990090324    4c                   if        %found(edtab01l)
273000090324     c                   movel     tabuni        edidspu
273010090324     c                   if        §puormaksc>*zeros
273020090327     c                   move      §PUORMAKSC    wcliksc
273030090325     c                   eval      atrwksc=prot
273040090324     c                   endif
273050090327     c                   if        §puormactr<>*blanks
273060090324     c                   move      §PUORMACTR    wclictr
273070090325     c                   eval      atrwctr=prot
273080090324     c                   endif
273090090324    4c                   endif
273100090324    3c                   endif
273110090324e   2c                   EndIf
273120090324     c* DA PGM CHIAMANTE
273130090327     c                   when      *in12 and *in15 and *in04 and vidcbo<>'FW'
273140090325    1c                   if        §lpksca>*zeros
273150090325     c                   eval      w_§lpksca=§lpksca
273160090325     c                   eval      w_§lpctra=§lpctra
273170090325   x1c                   else
273180090325    2c                   if        savfpr='T' or savfpr='P'
273190090325     c                   z-add     §lpccm        w0040
273200090325     c                   if        w0040<> 9999
273210090325     c                   move      §lpccm        w_§lpksca
273220090325     c                   if        §lpctr<>999
273230090325     c                   move      §lpctr        w_§lpctra
273240090325     c                   endif
273250090325     c                   endif
273260090325    2c                   endif
273270090325    1c                   endif
273280090325    1c                   if        w_§lpksca>*zeros
273290090327     c                   movel     w_§lpksca     wcliksc
273300090324     c                   eval      atrwksc=prot
273310090327    2c                   if        w_§lpctra<>*blanks
273320090325     c                   move      w_§lpctra     wclictr
273330090324     c                   eval      atrwctr=prot
273340090325    2c                   endif
273350090325    1c                   endif
273360090324     c* DA CONFERMA BOLLE PER BOLLE "FW"
273370090324     c                   when      *in12 and *in15 and vidcbo='FW'
273380090324     c                             and (%Subst(§lpNot:1:18) = wnotfw
273390090324     c                             or   %Subst(§lpNt2:1:18) = wnotfw)
273400090324     c                   Clear                   w007a
273410090324     c                   If        %Subst(§lpNot:1:18) = wnotfw
273420090324     c                   Eval      w007a = %Subst(§lpNot:20:7)
273430090324     c                   Else
273440090324     c                   Eval      w007a = %Subst(§lpNt2:20:7)
273450090324     c                   EndIf
273460090324      * verifico che siano tutti numeri
273470090324     c                   if        %check(digits:w007a)=0
273480090327     c                   Move      w007a         wcliksc
273490090324     c                   eval      atrwksc=prot
273500090324     c                   EndIf
273510090325     c                   endsl
273520090326     c*
273530090327     c                   if        wcliksc>0
273540090326     C                   clear                   TIBS69DS
273550090327     C                   z-add     wcliksc       I69kac
273560090326     C                   call      'TIBS69R'
273570090326     C                   parm                    tibs69DS
273580090326     C                   parm                    ds_cnaco
273590090326     C                   parm                    ds_cnind
273600090326     C                   parm                    ds_cnclp
273610090326     C                   parm                    ds_fncls
273620090515     c                   eval      wclidks=BS_acorag
273630090326     c                   endif
273640090324     c
273650090324     c                   endsr
273660090325     C**************************************************************************
273670090325     C* Controllo window cliente/tariffa per tassazione porti assegnati
273680090325     C**************************************************************************
273690090325     C     ctrwdwcli     BEGSR
273700090327     c                   if        wcliksc=0
273710090326     c                   clear                   wclidks
273720090326     c                   endif
273730090325     c* codice cliente
273740090326     c                   if        atrwksc=*blanks
273750090327     c                   if        wcliksc>0
273760090326     c                   clear                   wclidks
273770090325     C                   clear                   TIBS69DS
273780090327     C                   z-add     wcliksc       I69kac
273790090327     C                   z-add     wcliksc       I69kin
273800090325     C                   call      'TIBS69R'
273810090325     C                   parm                    tibs69DS
273820090325     C                   parm                    ds_cnaco
273830090325     C                   parm                    ds_cnind
273840090325     C                   parm                    ds_cnclp
273850090325     C                   parm                    ds_fncls
273860090515     c                   eval      wclidks=BS_acorag
273870090325     C* ERRORE
273880090325     c     O69Err        Ifeq      '1'
273890090515     c     BS_acoflg     Orne      *Blanks
273900090325     C     wcliksc       OREQ      8888
273910090325     c                   eval      *in90=*on
273920090325     C                   MOVEL     err(319)      wclimsg
273930090325     c                   z-add     04            Hcliriga
273940090325     c                   z-add     18            Hclicolo
273950090325     c                   goto      endwcli
273960090325    2C                   ENDIF
273970130312    2C***  BS_Acoabl     IFEQ      '8'
273980130312    2C***  BS_acoabl     OREQ      '*'
273990130312    2C     BS_Acoabl     IFne      *blanks
274000090325     c                   eval      *in90=*on
274010090325     C                   MOVEL     err(320)      wclimsg
274020090325     c                   z-add     04            Hcliriga
274030090325     c                   z-add     18            Hclicolo
274040090325     c                   goto      endwcli
274050090325    2C                   END
274060090325     c                   endif
274070090325     c                   endif
274080090325     c* codice tariffa
274090090326     c                   if        atrwctr=*blanks and wclictr<>*blanks
274100090325     c* errore se manca il codice cliente
274110090327     c                   if        wcliksc=*zeros
274120090325     c                   eval      *in90=*on
274130090325     C                   MOVEL     err(319)      wclimsg
274140090325     c                   z-add     04            Hcliriga
274150090325     c                   z-add     18            Hclicolo
274160090325     c                   goto      endwcli
274170090325     c                   endif
274180090325     c*
274190090325     c                   eval      s_fnlv59ds=fnlv59ds
274200090325     C                   CLEAR                   fnlv59ds
274210090325     C                   MOVEL     'A'           ilv59tbo
274220090325      * Se bolla monovaria carico tutte le tariffe ma propongo la partenza
274230090325     C                   IF        §3ASVA <> *BLANK
274240090325     C                   movel     ' '           ilv59tbo
274250090325     C                   movel     'P'           ilv59prp
274260090325     C                   ENDIF
274270090325      *
274280090327     C                   MOVEL     wcliksc       ilv59KSC
274290090325     C                   MOVEL     KCI           ilv59KCI
274300090325     C                   MOVEL     WFIE          ilv59FIE
274310090325     C                   MOVEL     blpdsp        ilv59DSP
274320090325     C                   MOVEL     vidtsp        ilv59TSP
274330090325     C                   MOVEL     'S'           ilv59RIC
274340090325     c                   move      wclictr       ilv59ctr
274350090325     C*
274360090325     C                   CALL      'FNLV59R'
274370090325     C                   PARM                    fnlv59ds
274380090325     C* ERRORE
274390090325     C     olv59msg      IFNE      *BLANKS
274400090325     C                   MOVEL     olv59msg      wclimsg
274410090325     C                   eval      *in90='1'
274420090325     c                   z-add     05            Hcliriga
274430090325     c                   z-add     18            Hclicolo
274440090325     c                   eval      fnlv59ds=s_fnlv59ds
274450090325     C                   GOTO      endwcli
274460090325     C                   ENDIF
274470090325     c*
274480090325     c                   eval      fnlv59ds=s_fnlv59ds
274490090325     c                   endif
274500090325     c     endwcli       endsr
274510090324     C**************************************************************************
274520090324     C* Verifica se spedizione che va nel clearing
274530090324     C**************************************************************************
274540090324     C     sr_clearing   BEGSR
274550090324     c                   clear                   wclg
274560090324    1c                   if        *in12 and *in15='0' and
274570090324     c                             s_§b4poe=wopoe and
274580090324     c                             s_§b4nsr=wonsr and
274590090324     c                             s_§b4nor=wonor2 and
274600090324     c                             s_§b4nrv=wonrv
274610090324     c                   eval      wclg=§b4clg
274620090324   x1c                   else
274630090324     c* se spedizione commissionata da dpd con orm automatico
274640090324     c* verifico se
274650090324     c* sono presenti altre bolle aventi lo stesso orm per l'impostazione
274660090324     c* del flag §b4clg
274670090324     C
274680090324    2c                   if        ormrfa<>*blanks and %subst(ormrfa:1:
274690090324     c                             3)='DPD'
274700090324     c                   eval      kdpodep=%subst(ormrfa:4:4)
274710090324     c                   eval      w006a=%subst(ormrfa:8:6)
274720090324     c                   move      w006a         kdpoord
274730090324     c     kdpo          setll     fidpo03l
274740090324    3c                   if        %equal(fidpo03l)
274750090324     c                   eval      wclg='S'
274760090324     c                   movel     'M'           kar4trc
274770090324     c                   movel     widorm        kar4n14
274780090324     c     kar403        setll     fiar404l
274790090324    4c                   do        *hival
274800090324     c     kar403        reade     fiar404l
274810090324     c* fine file
274820090324    5c                   if        %eof(fiar404l)
274830090324     c                   leave
274840090324    5c                   endif
274850090324     c*
274860090324     c                   eval      wclg=' '
274870090324    4c                   enddo
274880090324    3c                   endif
274890090324    2c                   endif
274900090324    1c                   endif
274910090324     c                   endsr
274920090326     C**************************************************************************
274930090326     C* Carico cliente/tariffa per tassazione p.a. da fiar4 trk 'A'
274940090326     C**************************************************************************
274950090326     C     sr_daar4a     BEGSR
274960090326     C                   MOVEL     'A'           WTRC
274970090326     c     kblp4         chain(N)  fiar401l
274980090326     c                   if        %found(fiar401l)
274990090326     c                   movel     ar4not        dsbl4a
275000090326     C                   MOVEL     '3M'          COD
275010090326     C                   MOVEL(P)  Vidsop        KEY
275020090326     C                   EXSR      CTABEL
275030090327     c                   if        §b4aks>0
275040090327     c                   z-add     §b4aks        wcliksc
275050090327     c                   if        s_ormksc>0  or not *in30
275060090326     c                   eval      atrwksc=prot
275070090326     c                   endif
275080090327     c                   if        §b4act<>*blanks
275090090326     c                   move      §b4act        wclictr
275100090327     c                   if        (s_ormksc>0 and s_ormctr<>*blanks)
275110090327     c                             or (not *in30 and s_ormksc=0)
275120090326     c                   eval      atrwctr=prot
275130090326     c                   endif
275140090327     c                   else
275150090327     c* se cod.tariffa non presente ma bolla non da orm proteggo comunque se
275160090327     c* ksc impostato altrimenti poi se fosse sprotetto non avrebbero più
275170090327     c* la possibiltà di correggerlo in caso di errore
275180090327     c                   if        not *in30 and wcliksc>0 and s_ormksc=0
275190090327     c                   eval      atrwctr=prot
275200090327     c                   endif
275210090326     c                   endif
275220090326     c                   endif
275230090326     c                   endif
275240090326     c                   endsr
275250110512     C**************************************************************************
275260110512     C*   Gestione window per manutenzione indirizzo email destinatario
275270110512     C**************************************************************************
275280150213     C*    sr_geswdwemd  BEGSR
275290150213     c*                  clear                   hemdriga
275300150213     c*                  clear                   hemdcolo
275310150213     c*                  eval      $fine='0'
275320150213     c*                  eval      s_wemdest=wemdest
275330150213     c*                  eval      s_wsms   =wsms
275340110512     c*
275350150213     c*                  dow       $fine='0'
275360150213     c*                  exfmt     ls01wemd
275370150213     c*                  eval      *in90='0'
275380150213     c*                  clear                   hemdriga
275390150213     c*                  clear                   hemdcolo
275400150213     c*                  clear                   wemdmsg
275410150213     c*                  select
275420110512     c* f12=Ritorno
275430150213     c*                  when      *inkl='1'
275440150213     c*                  eval      $fine='1'
275450150213     c*                  eval      wemdest=s_wemdest
275460150213     c*                  eval      wsms=s_wsms
275470150213     c*                  other
275480110512     c* f6=conferma o enter
275490150213     c*                  if        wemdest<>*blanks
275500150213     c*                  if        wdesie='E'
275510150213     c*                  Eval      *In90 = *On
275520150213     c*                  Eval      wemdmsg = err(342)
275530150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
275540150213     c*                            ':eliminare Indir.'
275550150213     c*                  eval      hemdriga=3
275560150213     c*                  eval      hemdcolo=7
275570150213     c*                  else
275580150213     c*                  exsr      Sr_Chkemd
275590110512      * Errore
275600150213if  3c*                  If        §emlerro <> '0'
275610150213     c*                  Eval      *In90 = *On
275620150213     c*                  Eval      wemdmsg = err(340)
275630150213     c*                  eval      hemdriga=3
275640150213     c*                  eval      hemdcolo=7
275650150213   x3c*                  else
275660150213     c*                  Eval      wemdest = §emlindo
275670150213    3c*                  EndIf
275680150213     c*                  EndIf
275690150213     c*                  endif
275700150213     c*                  if        wsms<>*blanks
275710150213     c*                  if        wdesie='E'
275720150213     c*                  Eval      *In90 = *On
275730150213     c*                  Eval      wemdmsg = err(342)
275740150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
275750150213     c*                            ':eliminare Cell.'
275760150213     c*                  eval      hemdriga=5
275770150213     c*                  eval      hemdcolo=7
275780150213     c*                  else
275790140423      /free
275800150216       //pinCell = %trim(wsms);
275810150216       //pOutErr = *blanks;
275820150213       //if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
275830140423
275840140423           // Numero di cellulare KO
275850150213       //   *In90 = *On;
275860150213       //   wemdmsg = err(351);
275870150213       //   hemdriga=5;
275880150213       //   hemdcolo=7;
275890150213    3  //EndIf;
275900140423      /end-free
275910150213     c*                  EndIf
275920150213     c*                  endif
275930150213     c*                  if        *inkf and not *in90
275940150213     c*                  eval      $fine='1'
275950150213     c*                  endif
275960150213     c*                  endsl
275970150213     c*                  enddo
275980110512     c*
275990150213     c*                  endsr
276000110705     C**************************************************************************
276010110705     C*   Gestione window per codici CUP e CIG
276020110705     C**************************************************************************
276030110705     C     sr_geswdwcup  BEGSR
276040110705     c                   eval      $fine='0'
276050110705     c                   eval      s_wcupcup=wcupcup
276060110705     c                   eval      s_wcupcig=wcupcig
276070110705     c*
276080110705     c                   dow       $fine='0'
276090110705     c                   exfmt     ls01wcup
276100110705     c                   eval      *in90='0'
276110110705     c                   select
276120110705     c* f12=Ritorno
276130110705     c                   when      *inkl='1'
276140110705     c                   eval      $fine='1'
276150110705     c                   eval      wcupcup=s_wcupcup
276160110705     c                   eval      wcupcig=s_wcupcig
276170110705     c                   other
276180110705     c* f6=conferma
276190110705     c                   if        *inkf
276200110705     c                   eval      $fine='1'
276210110705     c                   endif
276220110705     c                   endsl
276230110705     c                   enddo
276240110705     c*
276250110705     c                   endsr
276260090608     C**************************************************************************
276270090608     C* Carico limiti (peso/colli/volume) per tipo servizio
276280090608     C**************************************************************************
276290090608     C     sr_limtsp     BEGSR
276300090609     c                   clear                   wmsgtsp
276310090608     c                   clear                   trul73ds
276320090608     c                   if        vidtsp<>*blanks
276330090608     c                   eval      i73tsp=vidtsp
276340090608     c                   else
276350090608     c                   eval      i73tsp=comtsp
276360090608     c                   endif
276370111026     c* campi per la forzatura del messaggio di errore --> pulizia a cambio di
276380111026     c* tipo servizio
276390111026     c                   if        i73tsp<>savtsp73
276400111026     c                   clear                   wncl_pre
276410111026     c                   clear                   wpes_pre
276420111026     c                   clear                   wvol_pre
276430111026     c                   eval      savtsp73=i73tsp
276440111026     c                   endif
276450090619     c* Esco dalla routine senza effettuare il controllo se non ho il tipo
276460090619     c* servizio e provengo da controlli della prima videata:
276470090619     c* è successo che abbiano fatto un dirottamento ma il codice tariffa
276480090619     c* della bolla mamma utilizzato non è uno dei codici presenti per il
276490090619     c* cliente della bolla di dirottamento e quindi il tipo serivizio in
276500090619     c* questi casi è vuoto. In seconda videata poi saranno costretti a
276510090619     c* modificare il codice tariffa e di conseguenza i controlli limiti per
276520090619     c* tipo servizio verranno eseguiti correttamente
276530090619     c                   if        wvid='1' and i73tsp=*blanks
276540090619     c                   leavesr
276550090619     c                   endif
276560090609     c                   z-add     1             c
276570090609     c     i73tsp        lookup    tsp(c)                                 30
276580090609     c                   eval      i73psk=wpes
276590090608     c                   eval      i73vmc=wvol
276600090608     c                   eval      i73ncl=wncl
276610090608     c                   call      'TRUL73R'
276620090608     c                   parm                    trul73ds
276630090608     c                   select
276640090608     c                   when      o73err='E'
276650090608     c                   seton                                        90
276660090609     c                   eval      wmsgtsp=err(324)
276670090609     c                   eval      %subst(wmsgtsp: 40: 8)=dts08(c)
276680090609     c* colli bloccante
276690090608     c                   when      o73fclm='1'
276700090608     c                   seton                                        90
276710090609     c                   if        wvid='1'
276720090609     c                   seton                                        62
276730090609     c                   else
276740090609     c                   seton                                        41
276750090609     c                   endif
276760090609     c                   eval      wmsgtsp=err(325)
276770090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
276780090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclm:'4')
276790090609     c* peso kg bloccante
276800090608     c                   when      O73FKGM='1'
276810090608     c                   seton                                        90
276820090609     c                   if        wvid='1'
276830090609     c                   seton                                        63
276840090609     c                   else
276850090609     c                   seton                                        42
276860090609     c                   endif
276870090609     c                   eval      wmsgtsp=err(326)
276880090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
276890090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgm:'4')
276900090609     c*volume mc bloccante
276910090608     c                   when      O73FMCM='1'
276920090609     c                   seton                                        9047
276930090609     c                   eval      wmsgtsp=err(327)
276940090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
276950090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcm:'4')
276960090609     c* colli forzabile
276970090608     c                   when      O73FCLF='1' and wncl<>wncl_pre
276980090608     c                   seton                                        90
276990090609     c                   if        wvid='1'
277000090609     c                   seton                                        62
277010090609     c                   else
277020090609     c                   seton                                        41
277030090609     c                   endif
277040090609     c                   eval      wmsgtsp=err(325)
277050090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
277060090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclf:'4')
277070090610     c                   eval      wmsgtsp=%trim(wmsgtsp)+ '. ENTER per forzare'
277080090609     c                   eval      wncl_pre=wncl
277090090609     c* peso kg forzabile
277100090609     c                   when      O73Fkgf='1' and wpes<>wpes_pre
277110090608     c                   seton                                        90
277120090609     c                   if        wvid='1'
277130090609     c                   seton                                        63
277140090609     c                   else
277150090609     c                   seton                                        42
277160090609     c                   endif
277170090609     c                   eval      wmsgtsp=err(326)
277180090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
277190090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgf:'4')
277200090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
277210090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
277220090609     c                   eval      wpes_pre=wpes
277230090609     c* volume mc forzabile
277240090608     c                   when      O73FmcF='1' and wvol<>wvol_pre
277250090609     c                   seton                                        9047
277260090609     c                   eval      wmsgtsp=err(327)
277270090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
277280090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcf:'4')
277290090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
277300090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
277310090609     c                   eval      wvol_pre=wvol
277320090608     c                   endsl
277330090608     c                   endsr
277340091111     C**************************************************************************
277350091111     C*   Gestione window per scelta beneficiario contrassegno
277360091111     C**************************************************************************
277370091111     C     geswdw_cas    BEGSR
277380091111     c                   exsr      riewdwcas
277390091111     c                   clear                   hcasriga
277400091111     c                   clear                   hcascolo
277410091111     c                   eval      $fine='0'
277420091111     c*
277430091111     c                   dow       $fine='0'
277440091111     c                   exfmt     ls01wcas
277450091111     c                   eval      *in90='0'
277460091111     c                   clear                   hcasriga
277470091111     c                   clear                   hcascolo
277480091111     c                   select
277490091111     c* f12=Ritorno
277500091111     c                   when      *inkl='1'
277510091111     c                   eval      $fine='1'
277520091111     c                   other
277530091111     c* f6=conferma o enter
277540091111     c                   exsr      ctrwdwcas
277550091111     c                   if        *inkf and not *in90
277560091111     c                   eval      $fine='1'
277570091111     c                   endif
277580091111     c                   endsl
277590091111     c                   enddo
277600091111     c*
277610091111     c                   endsr
277620091111     C**************************************************************************
277630091111     C* Riempimento campi window scelta beneficiario contrassegno
277640091111     C**************************************************************************
277650091111     C     riewdwcas     BEGSR
277660091111     c* mittente spedizione
277670091111     c                   eval      wcasmit=vidrsm
277680091111     c* ordinante O.R.M.
277690091117     c                   eval      wcascor=ormksc
277700091112     c* ..ragione sociale da cnaco
277710091112     C                   clear                   TIBS69DS
277720091112     C                   z-add     ormksc        I69kac
277730091112     C                   call      'TIBS69R'
277740091112     C                   parm                    tibs69DS
277750091112     C                   parm                    ds_cnaco
277760091112     C                   parm                    ds_cnind
277770091112     C                   parm                    ds_cnclp
277780091112     C                   parm                    ds_fncls
277790091112     c                   eval      wcasord=BS_acorag
277800091112     c*
277810091111     c* destinatario spedizione
277820091111     c                   eval      wcasdest=v2crsd
277830091111     c                   endsr
277840091111     C**************************************************************************
277850091111     C* Controllo window scelta beneficiario contrassegno
277860091111     C**************************************************************************
277870091111     C     ctrwdwcas     BEGSR
277880091111     c                   select
277890091111     c* Effettuare alemno una selazione
277900091111     c                   when      wcassel1=*blanks and wcassel2=*blanks
277910091111     c                   z-add     15            Hcasriga
277920091111     c                   z-add     36            Hcascolo
277930091112     C                   MOVEL     err(329)      wcasmsg
277940091112     c                   seton                                        90
277950091111     c* Selezionare o mittente o ordinante
277960091111     c                   when      wcassel1='X' and wcassel2='X'
277970091111     c                   z-add     15            Hcasriga
277980091111     c                   z-add     36            Hcascolo
277990091112     C                   MOVEL     err(330)      wcasmsg
278000091112     c                   seton                                        90
278010091211     c* ricontrollo il tipo incasso in base alla scelta effettuata
278020091211     c                   other
278030091211     c                   exsr      sr_trultic
278040091211     c                   if        oticerr='T' or  oticerr='C'
278050091211     C                   MOVEL     err(331)      wcasmsg
278060091214     c* eccendo anche indicatore per posizionamento su tic in seconda videata
278070091214     c                   seton                                        9049
278080091211     c                   endif
278090091111     c                   endsl
278100091111     c                   endsr
278110091119     C**************************************************************************
278120091119     C* Inizializzazione campi window scelta beneficiario D/A
278130091127     C**************************************************************************
278140091119     C     inzwdwcas     BEGSR
278150091119     c                   clear                   wcasmit
278160091119     c                   clear                   wcascor
278170091119     c                   clear                   wcasord
278180091119     c                   clear                   wcasdest
278190091119     c                   clear                   wcassel1
278200091119     c                   clear                   wcassel2
278210091211     c                   eval      nochkticC=*off
278220091119     c                   endsr
278230110516     C**************************************************************************
278240110516     C* Window per richiesta conferma annullamento
278250110516     C**************************************************************************
278260110516     C     sr_geswdwconf BEGSR
278270110516     c                   clear                   wvann
278280110516     c                   eval      $fine='0'
278290110516     c*
278300110516     c                   dow       $fine='0'
278310110516     c                   exfmt     ls01wann
278320110516     c                   if        *inkf
278330110516     c                   eval      $fine='1'
278340110516     c                   endif
278350110516     c                   enddo
278360110516     c                   endsr
278370110519     C**************************************************************************
278380110519     C* Controllo presenza bolle da confermare
278390110519     C**************************************************************************
278400110519     C     sr_chkvab     BEGSR
278410110519    4c                   if        s_wksc<>wksc
278420110519     c                   eval      wfvab=*off
278430110519    4c                   endif
278440110519     c     wksc          setll     fivab01l
278450110519     c     wksc          setll     edivab1l
278460110519    4c                   if        (%equal(fivab01l) or %equal(edivab1l) )
278470110519     c                             and (s_wksc<>wksc or wfvab=*off)
278480110519     c                   movel     '1'           wemfor
278490110519     c                   eval      wms1=err(341)
278500110519     c                   eval      wfvab=*on
278510110519    5c*                  select
278520110519     c*                  when      %equal(fivab01l) and
278530110519     c*                            %equal(edivab1l)
278540110519     c*                  eval      wms1=err(341)
278550110519     c*                  eval      wfvab=*on
278560110519     c*                  when      %equal(fivab01l)
278570110519     c*                  eval      wms1=err(341)
278580110519     c*                  eval      wfvab=*on
278590110519     c*                  when      %equal(edivab1l)
278600110519     c*                  eval      wfvab=*on
278610110519     c*                  eval      wms1=err(341)
278620110519    5c*                  endsl
278630110519     c                   eval      $fine='0'
278640110519     c                   dow       $fine='0'
278650110519     c                   exfmt     ls01wvab
278660110519     c* f12=Ritorno
278670110519     c                   if        *inkl='1'
278680110519     c                   eval      $fine='1'
278690110519     c                   endif
278700110519     c                   enddo
278710110519     c*
278720110519    4c                   endif
278730110519     c                   eval      s_wksc=wksc
278740110519     c                   endsr
278750110902     C**************************************************************************
278760110902     C* Invio email a CED per errore valore accorpamento spedizioni in consegna
278770110902     C**************************************************************************
278780110902     C     sr_mail       BEGSR
278790110902     C* Inizializzo variabili
278800110902     C                   movel     *blanks       wrkEmlTo        253
278810110902     C                   movel     *blanks       wrkEmlCc        253
278820110902     C                   movel     *blanks       wrkMsg         5000
278830110902     C                   movel     *blanks       wrkOgg           44
278840110902     C                   movel     *blanks       wrkesito          1
278850120302     C* Valorizzo i campi della @-mail
278860120302     C                   eval      wrkEmlTo='ced@brt.it'
278870110902     c                   eval      wrkEmlCc = *blank
278880110902     C                   eval      wrkOgg='PERFECT ORDER WURTH'
278890110902     C                   eval      wrkMsg='Valore di accorpamento "'   +
278900110902     c                             §lpxco                              +
278910110902     C                             '" non presente in tabella "XCO"'   +':/N'+
278920110902     C                             ' '                                 +':/N'+
278930110902     C                             'SPEDIZIONE: ' +%editc(blplnp:'X')  +
278940110902     c                             ' ' +%editc(blpnrs:'Z') + ' '       +
278950110902     c                             %editc(blpnsp:'Z') +' '             +
278960110902     c                             %editc(blpaas:'X')                  +':/N'+
278970110902     C                             'RMN: '+%editc(blprmn:'Z')          +':/N'+
278980110902     C                             'RMA: '+blprma                      +':/N'+
278990110902     c                             ' '                                 +':/N'+
279000110902     c                             ' '
279010110902     C*
279020110902     C                   call(e)   'TIS701C1'
279030110902     C                   parm                    wrkEmlto
279040110902     C                   parm                    wrkEmlCc
279050110902     C                   parm                    wrkOgg
279060110902     C                   parm                    wrkMsg
279070110902     C                   parm                    wrkesito
279080110902     c                   endsr
279090111026     C**************************************************************************
279100111026     C* Memorizzazione dati vecchi colli per scrittura R.A.
279110111026     C**************************************************************************
279120111026     C     sr_memRA      BEGSR
279130111026     c* devo memorizzare il numero dei colli e il range dal/al prima della
279140111026     c* riassegnazione per poi poterli memorizzare nel file delle R.A.
279150111026     c* Devo memorizzare anche se si tratta di variazione di lna o di
279160111026     c* aumento colli
279170111026     c                   eval      RA_ncd=vidncd
279180111026     c                   eval      RA_nca=vidnca
279190111026     c                   eval      RA_ncl=savncl
279200111026     c                   eval      RA_lna=savlna
279210111026     c
279220111026     c                   endsr
279230111026     C**************************************************************************
279240111026     C* Richiamo pgm di scrittura R.A. per bolla modificata con riass.segnacolli
279250111026     C**************************************************************************
279260111026     C     sr_wrtRA      BEGSR
279270140507     c                   clear                   fidna6ds
279280140507     c                   eval      ida06mad=' 30'
279290140507     c                   eval      ida06tor='S'
279300140507     c                   eval      ida06ogg=%editc(blplnp:'X') +
279310140507     c                             %editc(blpnrs:'X')+
279320111026     c                             %editc(blpnsp:'X')+%editc(blpaas:'X')
279330111026     c                   move      RA_lna        wRA_lna
279340111026     c                   if        wRa_lna<>blplna
279350140507     c                   eval      ida06no2='Ex LNA'
279360140507     c                   eval      ida06no2=%trim(ida06no2)+' '+RA_lna
279370140507     c                   eval      ida06no2=%trim(ida06no2)+' colli'
279380111026     c                   else
279390140507     c                   eval      ida06no2='Ex Nr. colli'
279400111026     c                   endif
279410140507     c                   eval      ida06no2=%trim(ida06no2)+
279420140507     c                             ' '+%editc(RA_ncl:'Z')
279430140507     c                   eval      %subst(ida06no2:36:13)='Segnacolli da'
279440140507     c                   eval      ida06no2=%trim(ida06no2)+
279450140507     c                             ' '+%editc(RA_ncd:'2')
279460111026     c                   if        RA_nca>0
279470140507     c                   eval      ida06no2=%trim(ida06no2)+
279480140507     c                             ' a '+%editc(RA_nca:'2')
279490111026     c                   endif
279500140507     c                   eval      ida06ute=knmus
279510140507     c                   eval      ida06fil=simpou
279520140507     c                   call      'FIDNA6R'
279530140507     c*****              parm                    kpjba
279540140507     c                   parm                    fidna6ds
279550111026     c                   endsr
279560130304     C* CONTROLLO SE nome file PDF doppio ---------------------------*
279570130304     C     pdfdop        BEGSR
279580130307     c                   movel     dsblp0        savblp
279590130304     c     kvat          reade(N)  fivat01l
279600130304    1c                   dow       not  %eof(fivat01l)
279610130304     c                   movel     vatnot        dvatp
279620130304    2c                   if        §vatppdfn<>*blanks
279630130306     c     kar8§pdf      setll     fiar802l
279640130306     c     kar8§pdf      reade     fiar802l
279650130304    3c                   dow       not %eof(fiar802l)
279660130304     c     kblpar8       chain     fnblp01l
279670130304    4c                   if        %found(fnblp01l)
279680130304     C                   Z-ADD     BLPMGS        WDSP
279690130304     C                   MOVEL     BLPAAS        WDSP
279700130305    5C     WDSP          IFGE      datapdf
279710130304     c     blpcca        andne     '7'
279720130304     C                   MOVEL     ERR(348)      VIDMSG
279730130304     C                   SETON                                        90
279740130307     C                   MOVEL     SAVBLP        DSBLP0
279750130304     c                   leavesr
279760130304     c                   endif
279770130304     c                   endif
279780130306     c     kar8§pdf      reade     fiar802l
279790130304    3c                   enddo
279800130304    2c                   endif
279810130304     c     kvat          reade(n)  fivat01l
279820130304    1c                   enddo
279830130307     C                   MOVEL     SAVBLP        DSBLP0
279840130304     c*
279850130304     C                   ENDSR
279860130308     C* Invio messagio a Ced se cliente fornisce pdf ma non abilitato*
279870130308     C     ced_alert     BEGSR
279880130311     c                   eval      wrkEmlTo = 'CedAlert@brt.it'
279890130308     c                   eval      wrkEmlcc = *blank
279900130312     c                   eval      wrkOgg = 'PDF del cliente ' +
279910130312     c                                      %editc(§lpccn:'X') +
279920130313     c                                      ' NON ELABORATO'
279930130313     C                   eval      wrkMsg = 'Il cliente ha trasmesso FIVAT' +
279940130313     c                                      ' Tipo Rek "P" ma non è abilitato.'
279950130308     c
279960130308     C                   CALL      'TIS701C1'
279970130308     C                   PARM                    wrkEmlTo        253
279980130308     C                   PARM                    wrkEmlCc        253
279990130308     C                   PARM                    wrkOgg           44
280000130308     C                   PARM                    wrkMsg         5000
280010130308     C                   PARM                    wrkesito          1
280020130308     c                   endsr
280030130924
280040130924     C* Scrittura Fiar8 + impostazione campi per fiar5 record GEN  --*
280050130924     c     sr_gesar8     begsr
280060130924     c* Se sono in conferma bolle da dischetto e ctm che prevede fivax
280070130924     c* scrivo fiar8
280080130924     c                   clear                   w_allx
280090130924     c                   clear                   w_allm
280100130924     c                   clear                   w_alls
280110130924     c                   If        *In12 and *In15
280120130924     c                             and §1bf16 = 'S'
280130130924     c                   if        wvax='S'
280140130924     c                   exsr      sr_fiar8
280150130924     c                   endif
280160130924     c                   if        wvatp='S'
280170130924     c                   exsr      sr_fiar8_vatp
280180130924     c                   endif
280190130924     c                   endif
280200130924     c* se richiamato da pgm "Wanda" vedo se creare fiar8 oer la nuova
280210130924     c* bolla copiando i dati dal fiar8 della bolla mamma
280220130924     c   12
280230130924    1can 15savfpr        ifeq      'G'
280240130924     c     savfpr        oreq      'P'
280250130924    2c     §lpar8        ifeq      'S'
280260130924     c     kbolm         setll     fiar801l
280270130924    3c                   do        *hival
280280130924     c     kbolm         reade(n)  fiar801l
280290130924    4c                   if        %eof(fiar801l)
280300130924     c                   leave
280310130924    4c                   endif
280320130924     c                   Eval      Ar8Aas = BlpAas
280330130924     c                   Eval      Ar8Lnp = BlpLnp
280340130924     c                   Eval      Ar8Nrs = BlpNrs
280350130924     c                   Eval      Ar8Nsp = BlpNsp
280360130924     c                   if        aggioAr8='S'
280370130924     c                   write     fiar8000
280380130924     c                   endif
280390130924    4c                   if        ar8tmd<>'§PDF'
280400130924     c                   eval      w_allx='S'
280410130924     c                   else
280420130924     c                   eval      dar8§pdf=ar8uni
280430130924     c* il secondo byte è per la mail  ('1'=invia mail)
280440130924    5c                   if        %subst(§ar8pidz:2:1)='1'
280450130924     c                   eval      w_allm='S'
280460130924    5c                   endif
280470130924     c*
280480130924    5c                   if        %subst(§ar8pidz:1:1)='1' and
280490130924    5c                             (§ar8ptrt='S' or §ar8ptrt='X')
280500130924     c                   eval      w_alls='S'
280510130924    5c                   endif
280520130924     c*
280530130924    4c                   endif
280540130924    3c                   enddo
280550130924    2c                   endif
280560130924    1c                   endif
280570130924     c                   endsr
280580941221     OFNLV22P   T    LRNLR
280590011212**   GGG
2806009006111234567
280610900511**   VAR
280620941011 ** IMMISSIONE  BOLLE  PARTENZE **
280630941011 ** MANUTENZIONE BOLLE PARTENZE **
280640941011 ** CONFERMA  BOLLE  DA CLIENTI **
280650941011 ** RECUPERO  IMMISSIONE  BOLLE **
280660941011 ** RECUPERO   CONFERMA   BOLLE **
280670990602 **   IMMISSIONE   PREPAGATI    **
280680030409** RigW  Max lung.67                                             67
280690030409              Spedizione da affidare a network FedEx
280700030409         Spedizione relativa ad ORM Commissionato da FedEx
280710030409- Indicare la NATURA DELLA MERCE in lingua inglese
280720030409- Indicare PESO e VOLUME reali
280730030409- Allegare COPIA della fattura alla lettera di vettura (DDT=SI)
280740030520- Allegare ai colli gli altri documenti ritirati dal cliente
280750030409- Indicare AWB FedEx nel Riferimento mittente numerico
280760030520- Allegare alla LDV TUTTI i documenti ritirati dal cliente (DDT=SI)
280770060110       Destinatario con obbligo del DDT in fase di consegna
280780060110Allegare alla LDV l'originale del documento di trasporto (DDT=SI)
280790040329** cmdt
280800040329OVRDBF FILE(TITAS30C) TOFILE(
280810030409** ERR
280820030417Data cons. richiesta superiore a 1 mese dalla data odierna. ENTER x forzare   01
280830950920Data Spedizione formalmente errata  o  superiore a data sospensione xx/xx/xx
280840941020L'anno di spedizione non si puo' variare
280850941020Per le bolle di RECUPERO la Data Spedizione non puo' essere minore di 3 Giorni
280860061221Data Spedizione -per Spedizioni non di Recupero- non minore del xx/xx/xxxx
280870941020Data Ritiro Merce Errata
280880960926Data Ritiro Merce Errata:già confermati i conteggi autotrasp. in questa data
280890941020Linea di PARTENZA Errata
280900941021Immessa Varia "R" per 8888 o 9999 :obbligatorio l'imp.Assicur.Se 0 da tariffa 09
280910941020Codice Bolla Errato o non utilizzabile                                        10
280920941020Discordanza tra codice bolla e codice cliente mittente
280930110217Linea di Arrivo errata o annullata o bloccata                                 12
280940941020Non si puo' variare la linea di arrivo se bolla da cliente
280950941020Immettere la linea di arrivo
280960941110Tipo Servizio Errato o non inseribile dal bollettista                         15
280970941102Codice Trattamento Merce errato
280980950125ATTENZIONE!! TIPO SERVIZIO da x-xxxxxxxx   diventa  x-xxxxxxxx
280990030415Immettere il codice cliente se immessi i dati della Consegna Richiesta        18
281000941020Data Consegna Richiesta Errata
281010150202Ora Consegna richiesta Errata o non gestibile                                 20
281020960926Codice Autotrasportatore errato
281030941020Cliente Errato o Annullato
281040941020Codice inutilizzabile: cliente che non spedisce
281050941020Se immessa"Tassazione con Tariffa Mittente" inserire anche codice cliente mitt
281060941021Se immessa la Descrizione del Mittente indicare anche il codice: 8888 o 9999  25
281070980623ATTENZIONE! Spedizione di volume > xx,xxx mc. Avvisare ROM. ENTER per forzare 26
281080030728ATTENZIONE! Il numero colli è inferiore ai bancali inseriti                   27
281090940822Nazione Errata
281100950713Sigla Operatore non utilizzabile o non immessa
281110030905L'ORM richiede la bolla in Porto xxxxxxxxx                                    30
281120031029Non immettere la particolarità C/Assegno                                      31
281130031125Immettere la particolarità varia "O" per spedizione con bancali               32
281140941020Numero Spedizione gia' esistente o non immesso
281150941020Manca Numero COLLI
281160031125Immettere la particolarità varia "B" per spedizione con bancali               35
281170040216Referente e Telefono obbligatori per bolla Export con C/A. ENTER X FORZARE    36
281180941020Manca Dettaglio colli: inserirlo con F21 !!!
281190941021PESO Errato o diverso da precedente videata
281200941020MANCA NUMERATORE BOLLE: telefonare in Sede !!!!!!!
281210941020CONTO SERVIZIO : F6  per l'Immissione !!!                                     40
281220941020MANCA NUMERATORE PER STAMPA SEGNACOLLI: Telefonare in Sede !!!!!!
281230991117NUMERATORE BOLLE/SEGNACOLLI non disponibile: RITENTARE  NUOVAMENTE !!!
281240941102Se immesso tipo immettere anche la data o l'ora Consegna Richiesta
281250941020Inoltro Forzato:  F6  per Confermare l'Immissione
281260941102Numero Colli errato o diverso dalla prima videata                             45
281270980402Immettere il peso
281280941020Manca Riferimento Mittente Numerico
281290030805Serie ORM xx non gestita - AVVISARE IL CED                                    48
281300941020Serie incongruente con codice trattamento Merce
281310941020Numero Spedizione indicato in prima videata gia' esistente
281320941020Segnacollo Errato
281330980623ATTENZIONE! Spedizione di peso > xxxxxx,x kg. Avvisare ROM. ENTER per forzare 52
281340941020Manca natura merce
281350040216Referente e Tel. obbligatori per bolla EXPORT in P.Assegnato. ENTER X FORZARE 54
281360040727Spedizione già esistente!!!! Non è possibile confermare la bolla.             55
281370040213Bolla Export FedEx inserire il Telefono del destinatario. ENTER X FORZARE     56
281380090901T.Servizio "H" non ammesso per i tempi di trazione della bolla:F12 x corregg. 57
281390040216Spedizione con consegna a PRIVATI ins. il Telefono del dest.                  58
281400941110T A S S A Z I O N E   C O N   T A R I F F A   M I T T E N T E !!!!            59
281410090901Consegna richiesta non ammessa per tipo servizio "H"                          60
281420941020Zona digitata inesistente per la linea di arrivo della bolla
281430051007Consegna richiesta MINORE della data consegna teorica.
281440941020Giorno Chiusura Errato
281450030411§§Consegna particolare errata                                                 64
281460970408Impossibile annullare bolla LEGATA                                            65
281470030411§§dice Tariffa immesso ha TIPO SERVIZIO x-xxxxxxxx, diverso da quello in bolla66
281480100517Spedizione da cliente,impossibile modificare cod.Cliente Mittente:SERIE DIVERS67
281490030411§§Importo obbligatorio se immessa la sigla varia                              68
281500050429Non si puo' variare: bolla da disk clienti
281510030411§§Per bolla con C/Assegno e' obbligatoria la varia "G"                        70
281520100319ORM non inseribile: Tipo Servizio personalizzato o da disk"B" diverso dall'ORM71
281530100208Cod.Trattam.Merce "xx" non utilizzabile:forzato da"ConfermaBolle"in 1°videata 72
281540100319ORM non inseribile: linea Arrivo personalizzata o da disk"B" diversa dall'ORM
281550100319Forzata linea di arrivo e tipo servizio come da O.R.M.                        74
281560100319Forzato Tipo Servizio come da O.R.M.                                          75
281570100319Tipo Servizio diverso da quello definito sull'O.R.M.                          76
281580030411§§bligatorio dichiarare VALORE MERCE se destinat.estero con attraversam.dogana77
281590950410Non ammessi importi con decimali per la divisa indicata
281600950410Divisa errata                                                                 79
281610100210CAP Destin.Incongruente con L.Arrivo/PESO/VOLM:correggere T.Servizio"H" in "E"80
281620960926Codice non ammesso se cliente di altro punto operativo
281630941110Impossibile usare tariffa cliente per calcolare varia "G":tariffa inesistente
281640970724Bolla legata: impossibile impostare linea di arrivo uguale a linea di partenza83
281650950208Il cliente non presenta tariffe per la bolla ITALIA o ESTERO:ENTER per forzare84
281660950220La bolla presenta un numero segnacollo = 0 : verificare con F21               85
281670940909La serie non e' quella del cliente
281680940909Totale colli del dettaglio segnacolli non corrisponde
281690950525Partita IVA obbligatoria se bolla diretta all'estero con attraversam. dogana  88
281700980310Non e' possibile inserire il numero AWB                                       89
281710970415CAP Destin.Incongruente con L.Arrivo/PESO/VOLM: ENTR x forzare; F12 x corregg.90
281720030904§§CAP Destinatario incongruente con Linea Arrivo:x spediz.in F.DEP. non si forza
281730941011SEGNACOLLO DOPPIO xxxxxxx  presente su  spedizione xxxx xxx xx xxxxxxx per xxx
281740940916Importo da Assicurare = 0 : ENTER per prendere il massimo importo da Tariffa
281750940916Importo da Assicurare obbligatorio, come indicato nella tariffa del cliente
281760011211Importo da Assicurare da non immettere, come indicato nella tariffa del clien.
281770011211Importo da Ass. > DEL LIMITE IMPOSTO XXXXXXXXXX,XXX EUR:TEL.IN SEDE X AUTORIZ.96
281780940916Importo da Assicurare superiore al mandato esposto in tariffa:ENTER x Forzare
281790940919Importo C/Assegno Errato
281800941110Tipo Incasso C/Assegno inesistente o non e' da indicare
281810110217Se immesso CAP o Nazione Mit.Originale immettere tutti 3 i campi:CAP NAZ e MIT
281820090921Fermo Deposito non ammesso per tipo servizio "H"                              01
281830940919Consegna Particolare inesistente o non utilizzabile
281840940919Particolarita' C/A errata,non ammessa o non utilizzabile x il cliente indicato
281850941219Errori in Tassazione                                                           4
281860001106Se modificata la divisa, ridigitare il relativo importo
281870950102Q.ta'da fatturare = 0 per tariffa a valore:ENTER per prendere importo da assic 6
281880950103Inserire la quantita' fatturare  per tariffa a valore
281890950102Q.ta'da fatturare non inseribile per tariffa a valore:assunto importo da assic 8
281900950103Q.ta'da fatturare = 0 per tariffa a quantita'
281910950525Riferimento mitt.alfabetico obbligatorio se destin.estero con attravers.dogana
281920950410Se Imp.Assicurare e Val.Merce uguali, devono anche avere la stessa divisa     11
281930950410Se stessa divisa, importo da Assicurare e Valore Merce devono essere uguali
281940030411§§IMPOSSIBILE ANNULLARE BOLLA: gia' consegnata                                13
281950030411§§IMPOSSIBILE ANNULLARE BOLLA: bolla in consegna                              14
281960950421Zona arrivo xx da bolla cliente diversa da zona xx risultante dal Cappario    15
281970950421Data fattura prepagato deve essere dello stesso mese della data spedizione    16
281980950525Impossibile forzare LINEA ARRIVO ITALIA se destinatario estero                17
281990950525Impossibile forzare LINEA ARRIVO ESTERA se destinatario italiano              18
282000950717"Tassazione con Tariffa Mittente"ammessa solo per assegnati con mittente codif19
282010951027Bolla non confermabile: segnacollo  xxxxxxx  presente piu' volte in bolla     20
282020951027Le consegne particolari non possono essere uguali                             21
282030050714Attenzione!! Verificare Importo da Assicurare e Valore Merce. ENTER X FORZARE 22
282040960213Fermo Deposito errato                                                         23
282050960319Spedizione legata a bolla precedente: non si puo' modificare il codice bolla
282060960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio: F12 x corregg
282070960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio
282080960805Bolla cliente con dettaglio colli: impossibile modificare il numero segnacolli27
282090970704Manca provincia del Mittente in anagrafica: INSERIRLA!!!!                     28
282100961111Se "FRANCO FRONTIERA" tassare la spedizione fino a Milano indicando il PORTO  29
282110080327Tipo Servizio immesso DIVERSO da tariffa e non forzabile                      30
282120011211Importo C/Assegno SUPERIORE al limite imposto XXXXXXXXXX,XXX EUR              31
282130030411§§Per porti assegnati EXPORT, impossibile inserire l'importo da assicurare    32
282140030411§§Per bolle IMPORT, impossibile inserire l'importo da assicurare              33
282150961204Per bolle di RESO  impossibile inserire il C/Assegno
282160970115Dicitura "                non ammessa nella natura merce per bolla ESTERO     35
282170970115Dicitura "                non ammessa nella natura merce per bolla ITALIA     36
282180970128Impossibile ristampare bolla non ancora stampata                              37
282190970328Bolle di recupero devono avere per forza  NO   D D T                          38
282200011212Il CAP prevede obbligatoriamente il documento di trasporto ( SI DDT )         39
282210970408Bolle dirette a nazione con attraversamento dogana devono avere   SI   D D T
282220970414Impossibile modificare linea di arrivo: bolla legata e legame gia' inviato
282230100118Non possono esserci bolle export con servizio XXXXXXXXXX                      42
282240970528Codice bolla non utilizzabile per bolle export                                43
282250030411§§Tassazione non ammessa per P.A. export. Accettata solo la varia N           44
282260971211Non e' possibile togliere il numero A.W.B.                                    45
282270980311Numero A.W.B. obbligatorio per questo codice mittente : F18 per inserirlo     46
282280971211Ultima cifra (CHECK DIGIT) del numero A.W.B. errata: deve essere x            47
282290030805Utilizzare codice bolla xx - ritiro contestuale a consegna.                   48
282300090921T.Servizio "H" non ammesso per C/Assegno da abilitare:F12 x correggere        49
282310030808Ritiro contestuale alla consegna: non trovato ORM abbinato. AVVISARE CED.     50
282320030411§§Impossibile variare il numero colli per bolle import etichettate EUROEXPRESS51
282330000904Codici "CHI SONO" mancanti: F22 per immetterli                                52
282340030411§§lla non confermabile:presenti in bolla segn.Euroexpress doppi.F22 X corregg.53
282350000904Il nr. colli non corrisponde al tot. cod."CHI SONO". F22 X CORREGGERE         54
282360980403Segn.EuroExpress XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX già presente in altra bolla   55
282370030411§§Impossibile selezionare cliente di altro Circuito                           56
282380060921Nazione destinatario valida per DPD soltanto per bolle di RESO!!              57
282390060922CAP inutilizzabile per il network xxx                                         58
282400990610Prepagato: Immettere nelle note il TELEFONO e REFERENTE del RITIRO            59
282410990610Prepagato: premere F14 per tassare o inserire tassazione fino all'imponibile
282420030411§§Non trovata tariffa per tassare i prepagati !!                              61
282430030411§§Per i prepagati i dati della fattura sono obbligatori                       62
282440990628Immettere la prestazione ritiro: mattina o pomeriggio                         63
282450990630MANCA NUMERATORE fatture Prepagati:impossibile confermare.Inserirlo in contab 64
282460060221Importo da assicurare INFERIORE a quanto previsto dalla legge                 65
282470030411§§Per i Prepagati, Numero fattura deve essere maggiore di XXXXXX              66
282480990830Data fattura modificata perche' gia' bloccata per contabilizzazione           67
282490990915Cod.Autotrasport.incongruente con indicazione di merce a magazzino.ENTR forza 68
282500991011E' obbligatorio indicare la divisa                                            69
282510030411§§Prepagati: cliente non codificato o senza tariffa obbligatoria la divisa xxx70
282520991026Numero di decimali errato per la divisa immessa                               71
282530030411§§Prepagati: utilizzare la divisa della tariffa del cliente, xxx              72
282540991026Codice bolla non valido per prepagati                                         73
282550991130Rif.Mittente numerico contiene PARCEL DPD non valido                          74
282560991203Numero PARCEL obbligatorio per EXPORT DPD : F18 per inserirlo                 75
282570991203Non e' possibile togliere il numero PARCEL DPD                                76
282580991203Il numero PARCEL DPD inserito non è corretto                                  77
282590991206Se linea di partenza DPD la spedizione deve essere di 1 collo                 78
282600991206Se linea di arrivo DPD la spedizione deve essere di 1 collo                   79
282610991213Spedizione D.P.D. : non ammesso un peso superiore a xxxxxx,x kg.              80
282620991214Numero  PARCEL D.P.D.  gia' presente                                          81
282630000113Data fattura errata perche'gia'contabilizzata ma impossibile il cambio d'anno!82
282640020214Linea di arrivo errata: non e' una linea prevista per il network              83
282650020214Numero DPD inseribile soltanto se richiesto il network DPD per l'estero       84
282660000120Numero DPD non inseribile: attribuito in modo automatico                      85
282670060612Manca il numero DPD. Inserirlo!!                                              86
282680061030Per network xxxxxx non ammesse spedizioni con C/Assegno per la nazione indicat
282690020214Non trovate tariffe DPD per il cliente: IMPOSSIBILE utilizzare il network DPD 88
282700061011CAP no trovato su cappario D.P.D:F12 x attivazione automatica int.Cappario DPD
282710000124Numero  PARCEL D.P.D.inserito in prima videata, gia' presente !!              90
282720060109Non si posso fare bolle export DPD per clienti soluzioni "B"
282730020214Per la nazione del destinatario non è previsto il network DPD                 92
282740000508Per corretta contabilizzazione,impossibile bollettare la fattura in SOSPENSION93
282750020201Tipo servizio non ammesso per la linea di partenza indicata                   94
282760000509Se linea di partenza POSTE la spedizione deve essere di 1 collo               95
282770000509Spedizione POSTE : peso superiore a xxxxxx,x kg.  Enter per forzare!          96
282780101022Data consegna richiesta immessa errata: cade in giorno festivo                97
282790000509Consegna particolare non ammessa per spedizione POSTE                         98
282800000509Sono ammesse solo spedizioni in  FRANCO  per le  POSTE
282810000509Ammessi soltanto clienti POSTE per spedizioni POSTE                           00
282820000622CAP o localita' inutilizzabili perche' obsoleti                               01
282830000622In conferma di bolle autogenerate POSTE non si puo'cambiare la linea di arrivo
282840000627Impossibile stampare la bolla:dati in controllo e non in aggiornamento!       03
282850000725Bolle poste: utilizzabili solo cod.trattamento merce soluzioni "B"            04
282860000830Presenti in bolla codici "CHI SONO" doppi. F22 PER CORREGGERE                 05
282870000904Terminal di partenza non abilitato all'uso del DISK C                         06
282880030904§§Cliente non abilitato all'uso del DISK C                                    07
282890000918Presenti in bolla codici "CHI SONO" errati. F22 PER CORREGGERE                08
282900020308ATTENZIONE:cod."CHI SONO"                                                     09
282910110419Immettere l'Autotrasportatore per interrogare l'O.R.M.                        10
282920001024Non trovato terminal di partenza della linea di partenza. TELEFONARE IN SEDE  11
282930001024Non trovato terminal di arrivo della linea di arrivo.     TELEFONARE IN SEDE  12
282940110217
282950001220SEGNAC.DOPPIO: presente su spedizione xxxx xxx xx xxxxxxx per xxx.ENTR x FORZ.
282960001212Cliente DPD: la linea di partenza deve essere uguale al p.o. cliente
282970010212Immettere il numero O.R.M.                                                    16
282980010212O.R.M. inesistente                                                            17
282990010220Immettere un  O.R.M. avente p.o. ritiro uguale alla linea di partenza bolla
283000010212O.R.M. in fase non bollettabile. ENTER PER FORZARE
283010010213Forzata linea di arrivo come da O.R.M.                                        20
283020010221Dati diversi rispetto a quelli definiti sull'O.R.M. ENTER PER FORZARE         21
283030010214Il numero O.R.M. non deve essere un prepagato                                 22
283040010214Il numero O.R.M. deve essere un prepagato                                     23
283050010215Codice tariffa diverso da quello definito sull'O.R.M.                         24
283060100319Linea di arrivo diversa da quella definita sull'O.R.M.                        25
283070100319ATTENZIONE:MODIFICATO O.R.M. - Alcuni dati potrebbero aver subito variazioni  26
283080010313La bolla presenta,nel dettaglio colli,un tot.colli errato: verificare con F21 27
283090010409O.R.M. annullato
283100020207Bolla Export       in p.ass.: immettere O.R.M. reale commiss. da p.o.         29
283110010504O.R.M. utilizzabile solo in "Conferma bolle da clienti". F20 PER FORZARE
283120090921Per tipo servizio "H" non ammesse consegne per APPUNTAMENTO o SUPERMERCATI    31
283130011112Divisa scaduta                                                                32
283140011114Manca la varia 'N'                                                            33
283150011211Importo da assicurare non ammesso                                             34
283160011212Importo da assicurare > di XXXXXXXXXX,XXX EUR: VERIFICARE. ENTER PER FORZARE  35
283170011212Importo C/Assegno INFERIORE a xxxxxxxxxx,xxx EUR                              36
283180011212Importo C/Assegno > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE       37
283190011212Valore merce dichiarato obbligatorio                                          38
283200011212Valore merce dichiarato INFERIORE a xxxxxxxxxx,xxx EUR                        39
283210011212Valore merce dichiarato SUPERIORE al limite imposto xxxxxxxxxx,xxx EUR        40
283220011212Valore merce dichiarato > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE 41
283230011212Gli importi inseriti SUPERANO il limite fatturabile, xxxxxxxxxx,xxx xxx       42
283240040116§§ orto varia SUPERA il limite fatturabile, xxxxxxxxxx,xxx xxx                43
283250020214Per la nazione del destinatario non è previsto il network FedEx               44
283260030221Bolla export FedEx: non ammesse spedizioni in C/Servizio                      45
283270020214Non trovate tariffe FedEx x il cliente:IMPOSSIBILE utilizzare il network FedEx46
283280020228Per la nazione del destinatario non è previsto il network Euroexpress         47
283290020319Non trovato il progressivo della tariffa di cartello: TELEFONARE IN SEDE      48
283300020320Linea di arrivo non manutenzionabile                                          49
283310020320Manca il numeratore per l'assegnazione dell'AWB FedEx:TELEFONARE IN SEDE      50
283320020320Numeratore AWB FedEx non disponibile: RITENTARE NUOVAMENTE !!!                51
283330020320Numeratore AWB FedEx oltre il massimo del range previsto: TELEFONARE IN SEDE  52
283340020417Non ammesso cliente mittente non codificato per P.A. Euroexpress              53
283350020507Bolle di recupero per bolle firmate devono avere  per forza  SI   D D T       54
283360040608Destinatario                 :immettere la relativa consegna particolare      55
283370020611C/servizio non ammesso per un prepagato                                       56
283380020731Non è possibile indicare contemporaneamente consegne particolari 'S' e 'X'    57
283390021111Spedizione xxxx xxx xx xxxxxxx per xxx già consegnata                         58
283400021118Valore merce dichiarato obbligatorio per territori Extra CEE                  59
283410021119Se immesso prefisso "FD" o "FM" tutti i segnacolli devo avere lo stesso pref. 60
283420021119Prefisso segnacollo valido solo per bolle FedEx                               61
283430021120Immettere codice tariffa della relativa cartello FedEx                        62
283440030904§§Non ammessa tariffa FedEx Documenti: peso superiore a Kg. xxxxxx,x          63
283450021120Peso incongruente con Bolla FedEx tipo Documenti                              64
283460030904§§Peso incongruente con Bolla FedEx tipo Merci                                65
283470021209Immettere il rif.mittente alfabetico, bolla con cons.particolare Supermercati 66
283480040213Spedizione con APPUNTAMENTO inserire il Telefono del destin.                  67
283490030114Immettere il n. bancali                                                       68
283500021218Tipo bancale errato                                                           69
283510021218Non ammesso stesso tipo bancale                                               70
283520030805Immettere il tipo e il n. bancali x particolarità varie "B" o "O"             71
283530030204Spedizione con bancali, verificare peso e volume                              72
283540030204Modificato il numero dei bancali, verificare peso e volume                    73
283550030805Immettere la particolarità varie "B" o "O" per spedizione con bancali         74
283560030321Bolla con più di 500 colli non è possibile bollettare "DISK C"                75
283570030411Immettere o i dati della consegna richiesta o il numero delle ore             76
283580051215Data consegna richiesta non ammessa: oltre                                    77
283590030415Le ore da aggiungere alla delivery devono essere:  24 - 48 - 72               78
283600130312Mancano dati per la gestione del Packing List/PDF del cliente                 79
283610040603Presenti progressivi riga duplicati nei dati per stampa DDT del cliente
283620040610Bolla senza colli: tipo merce V=valore non ammesso                            81
283630040614Impossibile annullare questa bolla "£ " --> già presente anche in arrivo      82
283640040917Attenzione: inserito mittente estero, VERIFICARE. Enter per continuare        83
283650040930Codice cliente non utilizzabile                                               84
283660041012Particolarità Varie='U':consegna per Appuntamento o a Supermercati non ammessa85
283670041013Per l'O.R.M. immesso già presenti altre bolle con diverso autotrasportatore   86
283680041110Spedizione che prevede la stampa del DDT nella LdV: obbligatorio NO DDT       87
283690041126Codice particolarità varie non utilizzabile per questa linea di partenza bolla88
283700041117ATTENZIONE! Il numero parcel DPD non inizia per 84. ENTER per FORZARE         89
283710041210ATTENZIONE! Manca il logo                                                     90
283720050221Presenti numeri parcel dpd da cliente ripetuti o in numero maggiore di 1      91
283730050309ATTENZIONE: manca il codice bolla. Telefonare IMMEDIATAMENTE in sede          92
283740050914Volume obbligatorio                                                           93
283750051214Consegna richiesta supera di                                                  94
283760060103Bolla in P.Assegnato diretta a destinatario che richiede il SI DDT.ENTER x FOR95
283770060109Bolla export DPD "Disk B":codice trattamento merce errato."Chi Sono" non Autom96
283780060208Prepagato già incassato: impossibile variare totale imponibile                97
283790060324Consegna part. per Appuntamento non valida: presente data consegna "Tassativa"98
283800060612Numero Parcel DPD non valido
283810060613Manca il numeratore per l'assegnazione del Parcel DPD:TELEFONARE IN SEDE      00
283820060613Numeratore Parcel DPD non disponibile: RITENTARE NUOVAMENTE !!!               01
283830060613Numeratore Parcel DPD oltre il massimo del range previsto: TELEFONARE IN SEDE 02
283840060621ATTENZIONE! Il numero parcel DPD non inizia per 084. ENTER per FORZARE        03
283850060707Per il Tipo Incasso C/Assegno richiesto immettere anche il Mittente Originale 04
283860060707Non è possibile variare Linea Arr. passando da network NON DPD a network DPD  05
283870061109Parcel DPD errato:i caratteri iniziali non corrispondono a un Depot esistente 06
283880090827Località non servita per il tipo servizio indicato                            07
283890061109Codice Fiscale obbligatorio per Prepagato non codificato: ENTER per forzare
283900061121O.R.M. commissionato da DPD: selezionare network "DPD"                        09
283910061127Presente C.A.: impossibile annullare                                          10
283920070307Linea di Arrivo     non ammessa per un prepagato di mitt. non codificato      11
283930070620Preapagato: numero O.R.M. non modificabile
283940070806Completare l'indirizzo del destinatario                                       13
283950071023P.Iva/Cd.Fiscale obbligatori per Prepagato non codificato: ENTER per forzare  14
283960071221Linea di arrivo non modificabile:presenti spunte sulla vecchia linea di arrivo15
283970071221Per la linea di arrivo richiesta mancano le spunte: modifica non ammessa      16
283980071221Linea di arrivo estera: non utilizzabile per manutenzione bolla cliente diskB 17
283990081110Codice bolla non valido per un codice trattamento merce di recupero           18
284000090325Codice cliente errato o inesistente                                           19
284010090325Codice cliente non utilizzabile: bloccato in Piano dei Conti                  20
284020090326Attenzione:cambiando l'ORM potrebbe cambiare il cliente/tariffa per tassazione21
284030090326Tasto funzionale non abilitato                                                22
284040090429ORM commissionato da DPD: la spedizione deve essere di 1 collo                23
284050090609Manca tabella Limiti per Tipo Servizio          - TELEFONARE IN SEDE          24
284060090901ATTENZIONE! Sped."   " di n.colli > xxxxx  non ammessa                        25
284070090901ATTENZIONE! Sped."   " di peso > xxxxxx,x Kg. non ammessa                     26
284080090901ATTENZIONE! Sped."   " di volume > xx,xxx mc. non ammessa                     27
284090091008Dato obbligatorio per Porto Assegnato Import                                  28
284100091112Effettuare almeno una selezione                                               29
284110091211Selezionare il mitt. OPPURE l'ordinante ORM                                   30
284120091211Tp.incasso C/A errato --> F12 x correggere                                    31
284130100215Particolarità CONSEGNA incongruente con tipo servizio della bolla             32
284140100217Particolarità CONSEGNA non ammessa se presente consegna richiesta             33
284150100217Particolarità CONSEGNA non ammessa per bolle di recupero o in C/servizio      34
284160101105Bolle dirette a  FEDEX  devono avere   SI   D D T                             35
284170110321ATTENZIONE! Presenti spunte entrata: F16 per forzare                          36
284180110419IMPOSSIBILE ANNULLARE IL PREPAGATO: O.R.M. già ritirato                       37
284190110419O.R.M. ASSEGNATO: disassegnare l'ORM per poter annullare il prepagato         38
284200110422ATTENZIONE: inserita data ritiro più vecchia di xx gg lavorativi.ENTERxFORZARE39
284210110516Presenti errori nell'indirizzo Email Destinatario                             40
284220110519Presenti bolle da VAS non confermate per il cliente mittente: VERIFICARE      41
284230110613Avviso al destinatario non previsto per bolla export                          42
284240130131Inserire la P.Iva o il Codice Fiscale.                                        43
284250130131P.Iva obbligatoria per cliente Italia.                                        44
284260120508P.Iva "$$" non ammessa per prepagato                                          45
284270120515Bolla con attraversamento dogana: inserire la P.Iva o Cod.Fiscale se privato  46
284280120926Non si può trasformare un franco recupero in una bolla non di recupero        47
284290130312Nome PDF per gestione DDT del cliente già presente in altra bolla.Avvisare CED48
284300130313Cliente non abilitato al PDF.                                                 49
284310140114Presenti caratteri di punteggiatura all'Inizio e/o alla Fine della Località   50
284320140417Presenti errori nel numero di cellulare del destinatario                      51
284400141203Particolarità CONSEGNA con PIN CODE non gestita per Export:non sarà registrata52
284500141201Spedizione con PIN CODE: inserire una particolarità CONSEGNA con PIN CODE     53
284600141201Particolarità CONSEGNA con PIN CODE non valida per spedizione senza PIN CODE  54
284700141202Presente PIN CODE più lungo del massimo previsto: impossibile confermare      55
284800141202Presente PIN CODE con caratteri non ammessi: impossibile confermare           56
284900141203Non è possibile modificare la Particolarità Consegna: presente PIN CODE       57
