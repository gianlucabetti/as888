000100120302     /*PRM dbgview(*source)
000110120302     /*CMD ovrdbf file(TITAS30C) tofile(GAITRAGRPS/TITAS30C) +
000120120302     /*CMD        ovrscope(*calllvl)
000130120302     /*CMD ovrdbf file(TNBLA00F) tofile(GAITRAGRPS/TNBLA00F) +
000140120302     /*CMD        ovrscope(*calllvl)
000150120302     /*END dltovr file(TITAS30C TNBLA00F) lvl(*)
000160120302     /*END
000170120302      *
000180000920     H DECEDIT('0,') DATEDIT(*DMY.)
000190140423     h dftactgrp(*no) actgrp(*caller) bnddir('UBBNDDIR')
000200940819     F* FNLS01R *-----------------------------------------------------*
000210900427     F*       IMMISSIONE BOLLE
000220040329      *
000230040329      * COMPILARE CON
000240040329      *               OVRDBF FILE(TITAS30C) TOFILE(GAITRAGRPS/TITAS30C)
000250050407      *
000260170216      *?BISOGNA FARE ATTENZIONE AI PGM EVENTUALMENTE RICHIAMATI NEL CASO
000270170216      *?UTILIZZASSERO SIMFEL: SAREBBE UN PROBLEMA IN CASO DI BOLLETTAZIONE PER
000280170216      *?LNP DI ALTRO TERMINAL DI PARTENZA
000290170216
000300050407      * Annotazioni:
000310050407     c* La gest.del richiamo a fnls01r con §lpfpr='R'(recupero bolle DskCli)
000320050407     c* è rimasta nel pgm ma non viene più utilizzata. Non è stata tolta
000330050407     c* solo per comodità visto che è presente in più punti del pgm
000340000000     F*---------------------------------------------------------------*
000350160613     FFNLS01D   CF   E             WORKSTN usropn
000360161129     F                                     maxdev(*file)
000370940923     F                                     SFILE(LS01S03:NRR)
000380000829     F                                     SFILE(LS01S08:NR8)
000390021203     FFIAPD01L  IF   E           K DISK
000400950920     FAZCLN01L  IF   E           K DISK
000410990630     FCNNUM00F  UF   E           K DISK    USROPN
000420940822     FCNACO00F  IF   E           K DISK
000430900427     FCNIND00F  IF   E           K DISK
000440050209     Ffncls01l  IF   E           K DISK
000450080904     FTNBLA00F  O  A E           K DISK    USROPN extfile(WTNBLA)
000460930120     FFLNUF01L  UF   E           K DISK
000470991117     FFLNUF02L  UF A E           K DISK
000480991117     F                                     RENAME(FLNUF:FLNUF2)
000490940822     FTNTAM01L  IF   E           K DISK
000500990818     FTITPT01L  IF   E           K DISK
000510930629     FAZORG01L  IF   F 5000     2PIDISK    KEYLOC(4)
000520991117     FTABEL00F  IF   E           K DISK
000530941110     FFNBLD01L  UF A E           K DISK
000540020917     FFIVAD02L  UF   E           K DISK    USROPN
000550020917     FFIVAT01L  UF   E           K DISK    USROPN
000560040601     FFIVAX01L  UF   E           K DISK    USROPN
000570110518     FFIVAb01L  UF   E           K DISK    USROPN
000580110518     Fedivab1L  UF   E           K DISK    USROPN
000590940825     F*
000600061212     FFNBLP01L  IF   E           K DISK
000610061212     F                                     INFDS(FNBLP1)
000620061212     F                                     RENAME(FNBLP000:FNBLP001)
000630061212     FFNBLP00F  UF A E             DISK
000640940825     F*
000650140506     FFNarb01l  iF   E           k DISK
000660140506     f*
000670150929     FFIAR801L  IF A E           K DISK
000680130304     FFIAR802L  iF   E           K DISK    rename(fiar8000:fiar802)
000690940825     F* ESTENSIONE DESCRIZIONI
000691170918     FFipnd01l  UF A E           K DISK
000700060216     FFiar401L  UF A E           K DISK
000710060215     FFiar403L  IF   E           K DISK
000720060215     F                                     RENAME(Fiar4000:Fiar4003)
000730160209     FFiar405l  IF   E           K DISK
000740060215     F                                     RENAME(fiar4000:Fiar4004)
000750021218     fFiar501l  uf a e           k Disk
000760940825     F*
000770991006     F* TASSAZIONE
000780991006     FFIAR701L  UF A E           K DISK
000790991006     FFIAR601L  UF A E           K DISK
000800940825     F*
000810940825     F* C/ASSEGNO
000820051115     FFiar901L  UF A E           K DISK
000830040603     F*
000840940825     F* DETTAGLIO COLLI
000850940825     FFNBLT01L  UF A E           K DISK
000860120814     FFIART01L  UF A E           K DISK
000870120817     FFIART27L  IF   E           K DISK
000880120817     F                                     RENAME(FIART000:FIART027)
000890120828     FFNBLT27L  IF   E           K DISK
000900120828     F                                     RENAME(FNBLT000:FNBLT027)
000910120816     F***FNBLT29L  IF   E           K DISK
000920120816     F***                                  RENAME(FNBLT000:FNBLT029)
000930120828     FFNART27L  IF   E           K DISK    prefix(BLT:3)
000940051102     FFIARS01L  UF A E           K DISK
000950170131     FFIARS03L  IF   E           K DISK
000960170131     F                                     RENAME(FIARS000:FIARS3)
000970940825     F*
000980940825     FFNLBL01L  UF   E           K DISK    USROPN
000990011126     FFIFTT02L  IF   E           K DISK
001000011126     FFIFST02L  IF   E           K DISK
001010011126     F                                     RENAME(FIFTT000:FIFST000)
001020070123     FFNBRV09L  UF   E           K DISK    USROPN
001030071221     FFNBRV07L  iF   E           K DISK    USROPN
001040071221     F                                     RENAME(Fnbrv000:Fnbrv007)
001050080313     F*TNTBE02L  UF A E           K DISK
001060080313     FTNTBE01L  IF   E           K DISK
001070970107     F* FILE DI EDI
001080970107     FEDRDE01L  UF   E           K DISK    USROPN
001090000204     FFISGN01L  UF A E           K DISK
001100001005     FFISGN05L  UF A E           K DISK
001110001005     F                                     RENAME(FISGN000:FISGN005)
001120010212     F*
001130010212     FFNORM01L  IF   E           K DISK
001140100319     FFNORE01L  IF   E           K DISK
001150120611     FFIDST01L  IF   E           K DISK
001160010214     FFNFVV01L  IF   E           K DISK
001170051123     FFNANM02L  UF   E           K DISK
001180051124     FFNANM01L  UF   E           K DISK
001190051124     F                                     RENAME(FNANM000:FNANM01)
001200151112     Fdppdc01l  uf a E           k DISK
001210040329      * Bolle sede
001220040329     fTitas30c  if   e           k Disk    UsrOpn
001230151014     ffiar531c  uf a e           k disk    usropn
001240151014     F                                     RENAME(Fiar5000:fiar500s)
001250151014     F                                     ignore(Fiar5p00)
001260060209      * STORICIZZAZIONE VARIAZIONI
001270060209     FFIARBT0F  O  A E             DISK    usropn
001280060209     FFIARBU0F  O  A E             DISK    usropn
001290070404     FFIARG01L  UF A E           K DISK
001300160120     F*.......... V A R I A Z I O N I   B O L L E
001310160120     FFiARBF2C  IF   E           K DISK    usropn
001320160120     f                                     rename(fnarbd00:fnarbd0c)
001330160120     f                                     rename(fnarbk00:fnarbk0c)
001340160120     f                                     rename(fnarbg00:fnarbg0c)
001350160120     f                                     rename(fiarbt00:fiarbt0c)
001360160120     f                                     rename(fnarbm00:fnarbm0c)
001370160120     f                                     rename(fnarbv00:fnarbv0c)
001380160120     f                                     rename(fnarbp00:fnarbp0c)
001390160120     f                                     rename(fnarbn00:fnarbn0c)
001400070530     F*
001410080221     f**!!!fipdo01t  if   e           k disk
001420070601     ffnorf01l  if   e           k disk
001430070612     FEDTAB01L  IF   E           K DISK
001440070626     ffidpo03l  if   e           k disk
001450100323     fazfgi01l  if   e           k disk
001460160201     ftiidc01l  uf   e           k disk
001470160125      *.......... T E L E F O N A T E   /   R E C L A M I
001480160303     fFITGD32L  if   e           k disk
001490160203     fFITGD01L  if   e           k disk    RENAME(Fitgd000:fitgd001)
001500970107     F*
001510941221     FFNLV22P   O    F  132        PRINTER
001520960926     D L1              S              3  0 DIM(30)
001530070807     D L6              S              3  0 DIM(30)
001540970925     D*
001550940922     D CPA             S              2    DIM(30)
001560970115     D*
001570970115     D TBO             S              1    DIM(30)
001580970115     D LDC             S              2    DIM(30)
001590941108     D*
001600941107     D TSP             S              1    DIM(10)
001610941107     D UTS             S              1    DIM(10)
001620941115     D STS             S              1    DIM(10)
001630941107     D DTS             S             15    DIM(10)
001640000509     D USO             S              1    DIM(10)
001650090604     D DTS08           S              8    DIM(10)
001660090609     D DTS03           S              3    DIM(10)
001670090827     D TSttc           S              5    DIM(10)
001680960209     D*
001690960209     D TBL             S              2    DIM(20)
001700101022     D S1Y             S              1    DIM(20)
001710940916     D*
001720940923     D K07             S              1    DIM(7)
001730940923     D K09             S              1    DIM(9)
001740940919     D K35             S              1    DIM(35)
001750950920     D K31             S              1    DIM(31)
001760940919     D K78             S              1    DIM(78)
001770970115     D K89             S              1    DIM(89)
001780950104     D SKI             S              1    DIM(15)
001790011211     D SKII            S              1    DIM(14)
001800001214     D KOL             S             10    DIM(20)
001810971211     D*
001820971211     D KSS             S              7    DIM(12)
001830940922     D*
001840900611     D GGG             S              1    DIM(8) CTDATA PERRCD(8)
001850990602     D DES             S             34    DIM(6) CTDATA PERRCD(1)
001860151015     d rigw            s             67    Dim(13) Ctdata Perrcd(1)
001870160718     d cmdt            s             60    dim(02) ctdata perrcd(1)
001880170615     D ERR             S             78    DIM(368) CTDATA PERRCD(1)
001890930611     D*
001900980318     D*  SCHIERE PER COMPORRE SEGNACOLLO EUROEXPRESS
001910980318     D §S9             S              1    DIM(9)
001920980318     D §O9             S              1    DIM(9)
001930980330     D W35             S              1    DIM(35)
001940991201      *  SCHIERA PER COMPORRE BARCODE SU LETTERA VETTURA DPD IMPORT
001950991201      *  SCHIERA PER COMPORRE RMN IN STAMPA SEGNACOLLO DPD IMPORT
001960991201     D W15             S              1    DIM(15)
001970991026      *
001980000830     D* COD. CHI SONO PER CONTROLLI DI RECORD DOPPIO
001990021104     D CHI             S             35    DIM(500)
002000021104     D POS             S              4  0 DIM(500)
002010021104     D ANN             S             15  0 DIM(500)
002020021104     D CH2             S             35    DIM(500)
002030021119     d Prefisso        s              2    Dim(500)
002040930629     D UNIORG        E DS          5000    EXTNAME(AZORG00F)
002050040116      * sk x gestire le varie della seconda bolla
002060041217     d w2sv            s              1    Dim(6)
002070041217     d w2va            s             11  3 DIm(6)
002080061011     d
002090061011     D CAP             S              1    DIM(9)
002100061011     D CAF             S              1    DIM(9)
002110020212     D*
002120130117
002130130117      // - Sk per Tabella OSR
002140130117     d skCLIosr        s              7  0 dim(900)
002150130117     d skLNPNRSosr     s              5    dim(900)
002160150414
002170150414      * filiali abilitate a cons.part "Z"=Expo
002180151119     d*fil_expo        s              3    dim(85)
002190130117
002200130117      // - Indici di schiera
002210130117     d osrxx           s              3  0 inz
002220130117
002230130117      // - Campo di comodo per Ordinante ORM lungo 7
002240130117     d wORMcor         s              7s 0 inz
002250130117
002260090827     d Wttc            s              5
002270090827     d WttcCAP         s              5
002280150929     d KoreTrc         s                   like(oretrc) inz('G')
002290100319     d KAr5Trd         s                   like(Ar5Trd)
002300060515     d Bolksc          s                   Like(blpksc)
002310060515     d Bolctr          s                   Like(vidctr)
002320110304     d savnot          s                   Like(tamnot)
002330020212     D wawb            s             11  0
002340020212     D wawbini         s             11  0
002350021119     d Wpre            s              2
002360030204     d wPkg            s              1
002370030204     d wNba            s              1
002380030204     d w0071           s              7  1
002390030204     d w0053           s              5  3
002400050119     d wsolo_prp       s              1
002410030204     d wTbaPkg1        s                   Like(§TbaPkg)
002420030204     d wTbaVol1        s                   Like(§TbaVol)
002430030204     d wTbaPkg2        s                   Like(§TbaPkg)
002440030204     d wTbaVol2        s                   Like(§TbaVol)
002450150302     d wTba            s                   Like(igatba)
002460030204     d SavNba          s                   Like(§Ar5Nba)
002470030204     d SavNb2          s                   Like(§Ar5Nb2)
002480090804     d w_ar5ass        s                   Like(§Ar5ass)
002490091001     d w_ar5tcp        s                   Like(§Ar5tcp)
002500151117     d w_ar5als        s                   Like(§Ar5als)
002510151117     d w_ar5alx        s                   Like(§Ar5alx)
002520151117     d w_§b4ado        s                   Like(§b4ado)
002530091001     d w_ar5tic        s                   Like(§Ar5tic)
002540091214     d w_ar5cdi        s                   Like(§lpcdi)
002550091001     d sav_tc1         s                   like(vidtc1)
002560091001     d sav_tc2         s                   like(vidtc1)
002570030304     d wrma            s              1    Inz
002580030409     d Dataiso         s               d   datfmt(*iso)
002590030415     d woggi5          s              8  0
002600051214     d*woggi1m         s              8  0
002610051214     d woggidcgm1      s              8  0
002620051214     d woggidcgm2      s              8  0
002630051214     d s_woggidcg      s                   like(woggidcgm1)
002640051214     d s_vpodcg        s                   like(§vpodcgm1)
002650080603     d datam40         s              8  0
002660130305     d datapdf         s              8  0
002670030409     d wwtcr           s              1
002680030409     d wflagore        s              1
002690030409     d wore            s              3  0
002700030409     d §ore            s              2  0
002710030417     d fordcr          s              1    Inz
002720060103     d savddt          s                   like(vidbam)
002730030520     d wnonum          s              1    Inz
002740030704     d wforw03         s              1    Inz
002750030704     d wtotncl         s              6  0
002760030708     d savw03cor       s                   Like(§Ar5bCor)
002770030708     d savw03csf       s                   Like(§Ar5bCsf)
002780030718     d savinkh         s              1
002790030718     d savinki         s              1
002800030728     d wfornba         s              1    Inz
002810030728     d wtotnba         s              3  0
002820031125     d wgva            s              1
002830030805     d wkosr           s              5  0
002840030805     d w012a           s             12
002850040608     d w016ad          s             16
002860031001     d wfortbo         s              1    Inz
002870031201     d wnoccm          s              1    Inz
002880031201     d wforpf          s              1    inz
002890091006     d wope            s                        Like(I28Ope)
002900031219     d wrifp           s                        Like(VatNot)
002910141031     d wPinCode        s             15
002920040114     d va2va2          s                        Like(Vi2Va2)
002930040114     d va2va3          s                        Like(Vi2Va3)
002940040114     d va2va4          s                        Like(Vi2Va4)
002950041217     d va2va5          s                        Like(Vi2Va5)
002960041217     d va2va6          s                        Like(Vi2Va6)
002970040603     d s_vaxprr        s                        Like(vaxprr)
002980050119     d s_vidorm        s                        Like(vidorm)
002990050315     d s_ormpers       s              1
003000040114     d war71           s              1
003010040116     d ContaSv         s              2  0
003020121123     d wesvar1         s              1
003030040216     d wforza1         s              1    inz(*off)
003040040216     d wforza2         s              1    inz(*off)
003050110321     d wforzbrv        s              1    inz(*off)
003060110422     d wforzadrt       s              1    inz(*off)
003070141124     d wforz_lna       s                   like(comlna)
003080141124     d wforz_lnap      s                   like(v0clna)
003090141201     d wForzPCExp      s              1
003100110321     d wcheck          s              1    inz(*off)
003110040226     d p26vol          s              8  3
003120040226     d wrifm           s              1    Inz(*Off)
003130040301     d wkk             s              1    Inz(*Off)
003140040319     d wmodorm         s              1    Inz(*Off)
003150170228     d*LnpOgAs         s                   Like(§OgAs)
003160070529     d s_§ogpdaorm     s                   Like(§Ogpdaorm)
003170080111     d*g_ormpor        s                   Like(ormpor)
003180040329     d wlib            s             10
003190040329     d comman          s             80
003200040329     d lenght          s             15  5 inz(80)
003210040302
003220040302     d wtxt            S           2048
003230040302     d TxtInOut        S           2048
003240040302     d ElencoChar      S            256
003250040302     d TipoElenco      S              1
003260100219     d UsaCAss         S              1
003270040302     d CharSost        S              1
003280040302     d UpperCase       S              1
003290040302     d ChkNull         S              1    Inz('1')
003300040302     d CharNull        S              1
003310040302     d Esito           S              1
003320050209     D wclsflo8        S              1
003330081008     D w005a           S              5
003340050331     d wKSCsf1         s              4  0
003350050331     d wKSCsf2         s              4  0
003360051214     d s_d98dce        s                   like(d98dce)
003370061011     d savcapDPD       s                   like(vidcad)
003380061109     d savrsm          s                   like(vidrsm)
003390070827     d W_vidind        s                   like(vidind)
003400061109     d wcdf            s                   like(vidcdf)
003410071022     d wiva            s                   like(vidpim)
003420151106     d wCdfFlg         s                   like(xcfivaflg)
003430061221     d salvatgi        s                   like(g02tgi)
003440081014     d §3cabd_s        s                   like(§3cabd)
003450081023     d cbo_blp         s                   like(vidcbo)
003460061011     d Cappariodpd     S              1
003470120611     d w0050           S              5  0
003480080904     d WTNBLA          s             21    inz('GAITRAGRU /TNBLA00F')
003490091221     d wvidgma         s                   like(vidgma)
003500100604     d w7rRC           s                   like(§7rRC)
003510141202     d w7rPC           s                   like(§7rpincode)
003520100319     d Wofit           s             11  0 inz(99999999999)
003530100323     d kksc            s                   like(acoksc)
003540100323     d klnp            s                   like(blplnp)
003550100323     d klna            s                   like(blplnp)
003560110518     d s_wksc          s                   like(wksc) inz(0)
003570111122     d prelnp          s                   like(vidlnp)
003580111123     d pr0lnp          s                   like(v0clnp)
003590150304     d v2cpkg_i        s                   like(v2cpkg)
003600150304     d varvol_i        s                   like(varvol)
003610130308     d w_allx          s              1
003620130408     d w_allm          s              1
003630130417     d w_alls          s              1
003640130308     d wvatpe          s              1
003650130308     d wvatp           s              1
003660130306     d wvax            s              1
003670130403     d w_prr           s                   like(ar8prr)
003680140307     d w_pdfn          s                   like(§vatppdfn)
003690020212     D*
003700940930     D* PASSO A GESTIONE DETTAGLIO COLLI DA DISK CLIENTI-FNLS78R -
003710900511     D PARAM           DS
003720950321     D  PARCCM               101    107  0
003730941221     D  PARAAS               108    111  0
003740941221     D  PARLNP               112    114  0
003750941221     D  PARNRS               115    116  0
003760941221     D  PARNSP               117    123  0
003770941221     D  PARLNA               124    126  0
003780941221     D  VI3FNS               127    127
003790941221     D  KCI                  128    131  0
003800020917     D  PARFGS               132    134  0
003810160120      * PASSAGGIO A INTERROGAZIONE VARIAZIONI            - FNLR75R -
003820160120     D PARAM1          DS
003830160120     D  PA1AAS                14     17  0
003840160120     D  PA1LNP                18     20  0
003850160120     D  PA1NRS                21     22  0
003860160120     D  PA1NSP                23     29  0
003870160120      *  PREMUTO F3
003880160120     D  PA1F03                30     30
003890160120      *  FLG = "C" CHIUSURA FILES
003900160120     D  PA1FLG                31     31
003910160120     D  PA1PGM                32     41
003920160120     D  PA1DSA                42     61
003930160120     D  PA1GIA               144    144
003940160120     D  PA1FEL               145    147  0
003950160120     D  PA1TBO               148    148
003960160120      *
003970021203      * Ds esterna per ricerca codice padroncino
003980021203     D FNLV24DS      E DS
003990991008     D* STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO/PREPAGATI DA KPJBU
004000950118     D PARAM3          DS
004010170216     D**WPGMSS               246    255
004020990602     D  PARTCH               256    256
004030951228     D* PASSO A CREAZIONE NUMERATORI                   - FNLVCNR -
004040951228     D PARAM4          DS
004050951228     D  PA4CNU                 1      3  0
004060990701     D* PASSO A TASSAZIONE BOLLE                       - TNSF20R -
004070990701     D PARAMF          DS
004080990701     D  WFIAS                256    256
004090940822     D V0DMIT          DS
004100940822     D  V0CRSM                 1     35
004110940907     D  V0CINM                36     70
004120940907     D  V0CLOM                71    105
004130940907     D  V0CCAM               106    114
004140940907     D  V0CPRM               115    116
004150940907     D  V0CNZM               117    119
004160940825     D VIDMIT          DS
004170940825     D  VIDRSM                 1     35
004180940907     D  VIDINM                36     70
004190940907     D  VIDLOM                71    105
004200940907     D  VIDCAM               106    114
004210940907     D  VIDPRM               115    116
004220940907     D  VIDNZM               117    119
004230940824     D*
004240940824     D                 DS
004250940927     D  V0CISM                 1      2
004260940927     D  V0CCPM                 3     16
004270940927     D  V0CPIM                 1     16
004280940824     D                 DS
004290940927     D  VIDISM                 1      2
004300940927     D  VIDCPM                 3     16
004310940927     D  VIDPIM                 1     16
004320940824     D                 DS
004330940927     D  VIDISD                 1      2
004340940927     D  VIDCPD                 3     16
004350940927     D  VIDPID                 1     16
004360940824     D                 DS
004370940927     D  WISO                   1      2
004380940927     D  WCPI                   3     16
004390940927     D  WPIVA                  1     16
004400900427     D TCUDS           DS
004410000000     D  F1                     1      1
004420000000     D  F3                     3      3
004430000000     D  F2                     2      2
004440000000     D  F4                     4      4
004450000000     D  F56                    5      6
004460900514     D                 DS
004470900514     D  VIDLNP                 1      3  0
004480900514     D  VIDNRS                 4      5  0
004490900514     D  VIDNSP                 6     12  0
004500900514     D  VIDSPE                 1     12  0
004510040506     d                 DS
004520040506     d  widlnp                 1      3  0
004530040506     d  widnrs                 4      5  0
004540040506     d  widnsp                 6     12  0
004550040506     d  widspe                 1     12  0
004560900514     D                 DS
004570120828     D  BLTLNP                 1      3  0
004580120828     D  BLTNRS                 4      5  0
004590120828     D  BLTNSP                 6     12  0
004600120828     D**ARTLNP                 1      3  0
004610120828     D**ARTNRS                 4      5  0
004620120828     D**ARTNSP                 6     12  0
004630910829     D  BLPSPE                 1     12  0
004640940214     D                 DS
004650940214     D  VARNCL                 1      5  0
004660940214     D  VARCDP                 6     20
004670940214     D  VARCN                  1     20
004680950921     D                 DS
004690950921     D  WAA                    1      4  0
004700950921     D  WMM                    5      6  0
004710950921     D  WGG                    7      8  0
004720950921     D  WDATA                  1      8  0
004730991201      * PER SEGNACOLLO DPD
004740991214     D                 DS
004750991214     D  DPDSTA                 1     26
004760991214     D  DPDCOS                 1     12
004770991214     D  DPDSTP                13     26
004780991214     D  DPDS1                 13     15
004790991214     D  DPDV1                 16     16    INZ
004800991214     D  DPDS2                 17     24
004810991214     D  DPDV2                 25     25    INZ
004820991214     D  DPDS3                 26     26
004830991214     D                 DS
004840991214     D  DPDPAR                 1     12
004850991214     D  DPD1                   1      3
004860991214     D  DPD2                   4     11
004870991214     D  DPD3                  12     12
004880940819     D***
004890940819     D* PARAMETRI PER CONTROLLO DATA E TRASFORM IN GIORNI - XSRDA8 -
004900940819     D***
004910940819     D WLBDAT          DS                  INZ
004920940819     D  G02DAT                 1      8  0
004930940819     D  G02INV                 9     16  0
004940940819     D  G02ERR                17     17
004950940819     D  G02TGI                18     22  0
004960940819     D***
004970940819     D* PARAMETRI PER TRASFORM GIORNI IN DATA             - XSRDGI -
004980940819     D***
004990940819     D WGIDAT          DS                  INZ
005000940819     D  GIODAT                 1      8  0
005010940819     D  GIOINV                 9     16  0
005020940819     D  GIOTGI                17     21  0
005030000000     D KPJBA         E DS
005040991117      * CALCOLO DEL CHCK DIGIT PER BARCODE DPD
005050991117     D                 DS
005060991117     D  DPDLNP                 1      3  0
005070991117     D  DPDGMS                 4      7  0
005080010222     D  DPDNDS                 8     11  0
005090991117     D  §11                    1     11  0
005100991201     D                                     DIM(11)
005110991117     D  DPDCHD                12     12  0
005120991117     D  DPDBRC                 1     12  0
005130000915     D                 DS
005140000915     D  V8HFLS                 1      3  0
005150000915     D  V8HLNA                 4      6  0
005160000915     D  V8HNRS                 7      8  0
005170000915     D  V8HNSC                 9     15  0
005180000915     D  V8HCOL                 1     15  0
005190000915     D                 DS
005200000915     D  KFLSAN                 1      3  0
005210000915     D  KLNAAN                 4      6  0
005220000915     D  KNRSAN                 7      8  0
005230000915     D  KNSCAN                 9     15  0
005240000915     D  KANNUL                 1     15  0
005250010212     D                 DS
005260010213     D  WOPOE                  1      3  0
005270010222     D  WONSR                  4      5  0
005280010222     D  WONOR2                 6     12  0
005290010222     D  WONOR                  4     12  0
005300010213     D  WONRV                 13     14  0
005310010222     D  WIDOR1                 4     14  0
005320010215     D  WIDORM                 1     14  0
005330010215     D                 DS
005340010215     D  VIDPOE                 1      3  0
005350010222     D  VIDNOR                 4     12  0
005360010215     D  VIDNRV                13     14  0
005370010215     D  VIDORM                 1     14  0
005380010219     D                 DS
005390010219     D  V0CPOE                 1      3  0
005400010222     D  V0CNOR                 4     12  0
005410010219     D  V0CNRV                13     14  0
005420041220     D  V0CORM1                4     14  0
005430010219     D  V0CORM                 1     14  0
005440041220     D                 DS
005450041220     D  s_v0cpoe               1      3  0
005460041220     D  s_v0cnor               4     12  0
005470041220     D  s_v0cnrv              13     14  0
005480041220     D  s_v0corm               1     14  0
005490030805     d                 ds
005500030805     d  savOrmPoe              1      3  0
005510030805     d  savOrmNsr              4      5  0
005520030805     d  savOrmNor              6     12  0
005530030805     d  savOrmNrv             13     14  0
005540030805     d  savkeyorm              1     14  0
005550040227
005560040227     d  OrmRfa         ds
005570040227     d  wrmbolla               1      1
005580040227     d  wrmaas                 2      3
005590040227     d  wrmlnp                 4      6
005600040227     d  wrmnrs                 7      8
005610040227     d  wrmnsp                 9     15
005620030805
005630000901     D DSBLD7        E DS
005640000901     D  §C                     1     17  0
005650000901     D                                     DIM(17)
005660001012     D                 DS
005670000911     D  §CB                    1     18  0
005680000901     D                                     DIM(18)
005690000911     D  §CA                    1     18
005700000911     D                                     DIM(18)
005710001012     D                 DS
005720001012     D  §2                     1      2  0
005730000901     D                                     DIM(2)
005740001012     D  §2A                    1      2
005750000901     D                                     DIM(2)
005760991011     D* DS PER YEURCO - EURO CONVERTITORE
005770991011     D DSYEUR        E DS                  EXTNAME(YEURCODS)
005780061109     d
005790061109     d* Controllo codice fiscale
005800151106     d xcfiva1ds     e ds
005810061109     d
005820061110     D* DS PER YCO601R - RICERCA codice fiscale
005830061109     D YCO600DS      E DS
005840940819     D*
005850991007     D DS$2          E DS
005860991007     D OG148         E DS
005870000204     D OG150         E DS
005880000204     D OG143         E DS
005890020213     D A_og143       E DS                  EXTNAME(OG143)
005900020213     D                                     prefix(A_)
005910040525     D A_og150       E DS                  EXTNAME(OG150)
005920040525     D                                     prefix(A_)
005930080623     D edidspu       E DS
005940000623     D DSBL4W        E DS
005950140122     D*DSBL4J        E DS
005960010212     D DSBL4M        E DS
005970141103     D DSBL4Y        E DS
005980110706     D DSBL44        E DS
005990061122     D S_dsbl4m      E DS                  EXTNAME(dsbl4m)
006000061122     D                                     prefix(S_)
006010070620     D  s_§b4orm               1     14  0
006020070627     D  s_§b4fit               4     14  0
006030160209     D A_dsbl4m      E DS                  EXTNAME(dsbl4m)
006040160209     D                                     prefix(A_)
006050070620
006060020523     D DSBL4A        E DS
006070010925     D DSBL4Z        E DS
006080061003     D*DSBL4F        E DS
006090060509     D DSBL4I        E DS
006101170915     D DpndDP5       E DS
006102170920     D DpndDP4       E DS                  prefix(DP4_)
006103170920     D DpndDI4       E DS                  prefix(DI4_)
006104170915     D DpndFLO       E DS
006110991203     D DSBL4E        E DS
006120971215     D DSBLDE        E DS
006130971215     D DSBLD         E DS
006140000627     D DBLP          E DS
006150150916     D DBLP01        E DS
006160991007     D DTAS          E DS
006170040329     d  §tasflo      e                     extfld(tasflo)
006180991007     D DTASV         E DS
006190941108     D  VSV                    1     20
006200941108     D                                     DIM(20)
006210991008     D  VVA                   21    140P 3
006220991007     D                                     DIM(20)
006230991007     D  VES                  141    160
006240941108     D                                     DIM(20)
006250971216     D DS1A          E DS
006260900529     D DS1B          E DS
006270940928     D DS1P          E DS
006280061030     d
006290940928     D DS15          E DS
006300080414     D*ds15x         E DS                  EXTNAME(ds15)
006310080414     d**                                   prefix(X_)
006320160224     D DS16          E DS
006330061030     d
006340101022     D DS1Y          E DS
006350101022     D DS3A          E DS
006360921217     D DS3C          E DS
006370100517     D** D3cp          E DS
006380940825     D DS3I          E DS
006390991213     D DS3IDP        E DS
006400000509     D DS3IPT        E DS
006410941102     D DS5E          E DS
006420980806     D DS7T          E DS
006430041126     D DS7S          E DS
006440051124     D DS7c          E DS
006450100217     D DS7R          E DS
006460921217     D DSCC          E DS
006470921217     D DSCT          E DS
006480940826     D DSCV          E DS
006490011108     D DSCW          E DS
006500020725     D DYIV          E DS
006510000124     D DSTA01        E DS
006520061002     d* campo §tasflo della DTAS
006530061002     D DTAS01        E DS
006540000124     D DSTB          E DS
006550940914     D DSQT1         E DS
006560921217     D DSTM          E DS
006570060208     D DS7L          E DS
006580991008     D DGED          E DS
006590991008     D DGEI          E DS
006600161229     D*Dfsc          E DS
006610010924     D DORM01        E DS
006620010409     D DDFT          E DS
006630010409     D  §DFORA       E                     EXTFLD(D§DFTORA)
006640010409     D  §DFORR       E                     EXTFLD(D§DFTORR)
006650010409     D  §DFTOR       E                     EXTFLD(D§DFTTOR)
006660010409     D  §DFTCO       E                     EXTFLD(D§DFTTCO)
006670010409     D  §DFDDT       E                     EXTFLD(D§DFTDDT)
006680010409     D  §DFPAG       E                     EXTFLD(D§DFTPAG)
006690010409     D  §DFPKG       E                     EXTFLD(D§DFTPKG)
006700010409     D  §DFBNC       E                     EXTFLD(D§DFTBNC)
006710010409     D  §DFMAX       E                     EXTFLD(D§DFTMAXKG)
006720000120     D DCHI          E DS
006730010212     D DFAR          E DS
006740010215     D  §FARDS       E                     EXTFLD(D§FARDES)
006750010215     D  §FARFB       E                     EXTFLD(D§FARFFB)
006760010309     D  §FARNF       E                     EXTFLD(D§FARNONF)
006770010319     D  §FARMN       E                     EXTFLD(D§FARMAN)
006780010319     D  §FARST       E                     EXTFLD(D§FARSTP)
006790010319     D  §FARAF       E                     EXTFLD(D§FARAFVV)
006800010319     D  §FARCF       E                     EXTFLD(D§FARCFVV)
006810011025     D  §FAROO       E                     EXTFLD(D§FARNOO)
006820011025     D  §FARUV       E                     EXTFLD(D§FARUVA)
006830011025     D  §FARDV       E                     EXTFLD(D§FARDVA)
006840060103     d ddstflo       e ds
006850021120     D DDFE          E DS
006860021218     d Dar5Ban       e Ds
006870030704     d Dar5Bnb       e Ds
006880151015     d Dar5FAT       e Ds
006890130306     d Dar8§pdf      e Ds
006900030204     d dTba          e ds
006910030326     d dDcr          e ds
006920030805     d dAr5Rcc       e Ds
006930030805     d dOsr          e Ds
006940031113     d Dar5Gen       e Ds
006950100319     d DoreGen       e Ds
006960110512     d Dar5Emd       e Ds
006970031125     d dVato         e ds
006980110704     d dVat4         e ds
006990130306     d dVatP         e ds
007000130315     d dVats         e ds
007010040701     d dVpoppt       e ds
007020041217     d dVpo          e ds
007030160829     d dVpols01      e ds
007040060207     d dVpodeco      e ds
007050150304     d dVpotellus    e ds
007060121017     d ddgd          e ds
007070160323     d dnsd          e ds
007080081111      * Ds date statistiche
007090081111     d dSdf          e ds
007100110818     d*** dVUS          e ds
007110110818     d dxco          e ds
007120110818     D  vaa                    1     10    dim(10)
007130060612     d dVate         e ds
007140070529     d dPdo          e ds
007150071220     d dcli          e ds
007160090625     d trulticds     E DS
007170100517     d trulNRSds     E DS
007180061106     D TRULdepds     E DS
007190030610      * DS - PARAMETRI PER STAMPA BOLLE ED ETICHETTE
007200030610     D TRUL90DS      E DS
007210030611     D WTRUL90DS     E DS                  extname(TRUL90DS) prefix(W)
007220060619      * DS PER FIEU12R - CREAZIONE EVENTI FISSI DPD
007230060619     D fieu12ds      E DS
007240941005     D* DS PER TRTB69R - TRTB70R - TRTB72R - TRTB73R - INT E GEST PARTI
007250941005     D DS7PQR        E DS                  EXTNAME(DS7PQRS)
007260940919     D* DS PER TRUL06R - CARICAMENTO £X
007270940919     D DSUL06        E DS                  EXTNAME(TRUL06DS)
007280940919     D  LIN                    1     90  0
007290960926     D                                     DIM(30)
007300011211     D* DS PER TRUL21R - CONTROLLO LIMITI IMPORTO DA C/ASSEGNO
007310011211     D DSUL21        E DS                  EXTNAME(TRUL21DS)
007320011211     D* DS PER TRUL22R - CONTROLLO LIMITI IMPORTO DA ASSICURARE
007330011211     D DSUL22        E DS                  EXTNAME(TRUL22DS)
007340011211     D  I22TLS       E                     EXTFLD(I22TLA)
007350011211     D  I22LNS       E                     EXTFLD(I22LNA)
007360011212     D  I22LPS       E                     EXTFLD(I22LNP)
007370011212     D* DS PER TRUL23R - CONTROLLO LIMITI VALORE MERCE
007380011212     D DSUL23        E DS                  EXTNAME(TRUL23DS)
007390090608     D* DS PER TRUL73R - CONTROLLO LIMITI per tipo servizio
007400090608     D trul73ds      E DS
007410020320     D* DS PER TRUL33R - REPERIMENTO/AGGIORNAMENTO NUMERATORI SU AZNUM
007420020320     D TRUL33DS      E DS
007430991102     D* DS PER TIBS02R - GESTIONE TNTBE00F
007440991102     D DSBS02        E DS                  EXTNAME(TIBS02DS)
007450050502     D* DS PER FNLV20R - DS DEI CAMPI PER CALCOLO VOLUME DA FATTURARE
007460050502     D DSLV20        E DS                  EXTNAME(FNLV20DS)
007470030626     D* DS PER STAMPA BOLLA
007480030626     D fnlsb5DS      E DS
007490130315     d FNLSB6ds1     e ds                  inz
007500130419     d   DB6pdf      e                     inz('X')
007510991014     D* DS PER FNLV04R - CALCOLO TOTALE FATTURA SE IMMESSO NUMERO E DAT
007520991014     D DSLV04        E DS                  EXTNAME(FNLV04DS)
007530970707     D* DS PER FNLV13R - CONTROLLO DI UN CAP
007540970707     D DSLV13        E DS                  EXTNAME(FNLV13DS)
007550970707     D* DS PER FNLV14R - CONTROLLO DI INDIRIZZO COMPLETO  SENZA CAP
007560970707     D DSLV14        E DS                  EXTNAME(FNLV14DS)
007570970702     D* DS PER TISI95R - CONTROLLO DI CAP
007580970702     D DSSI95        E DS                  EXTNAME(TISI95DS)
007590060922     D TISI97DS      E DS
007600160223     D d_TISI97DS    E DS                  extname(tisi97ds)
007610160223     D                                     prefix(d_)
007620150731
007630150731     D DSSI00        E DS                  EXTNAME(TISI00DS)
007640150731     D tisi30ds      E DS
007650150731
007660060619     D* DS PER TISIE3R - CAPPARIO DPD  - NUOVO
007670060619     D TISIe3ds      E DS
007671170915     D TISID4DS      E DS                  INZ
007680170918     D* DS PER TISID8R - interrogazione CAPPARIO DPD  - NUOVO
007690170918     D*TISIe8ds      E DS
007691170918     D TISId8ds      E DS
007700991008     D* DS PER FNLV16R - CONTROLLO TASSAZIONE
007710991008     D DSLV16        E DS                  EXTNAME(FNLV16DS)
007720040115     D DLV1601       E DS
007730941025     D* DS PER FNLV18R - CALCOLO DI UN VOLUME AUTOMATICO
007740941025     D DSLV18        E DS                  EXTNAME(FNLV18DS)
007750060215     D* DS PER FNLV19R - PER SCRITTURA Fiar400F
007760941028     D DSLV19        E DS                  EXTNAME(FNLV19DS)
007770050920     D* DS PER FNLV59R - CARICAMENTO E CONTROLLO TARIFFE DI 1 CLIENTE
007780050920     D fnlv59ds      E DS
007790970925     D* DS PER FNLV55R - RICERCA TERMINAL DI PARTENZA/ARRIVO
007800970925     D DSLV55        E DS                  EXTNAME(FNLV55DS)
007810970925     D* DS PER TNSD99R - CALCOLO  DELLA CONSEGNA TEORICA BOLLA
007820970925     D DSSD99        E DS                  EXTNAME(TNSD99DS)
007830000907     D* DS PER FNLSZ1R - CONTROLLO COD. "CHI SONO"
007840000907     D DSLSZ1        E DS                  EXTNAME(FNLSZ1DS)
007850020213     D* DS PER TRUL27R - Ricerca tarfiffa di cartello
007860160219     D*trul27ds      E DS
007870160219     D* DS PER TRUL27R1 - Ricerca network bolla
007880160219     D trul27ds1     E DS
007890160219     D* DS PER TRUC27R  - Ricerca tariffa di cartello
007900160219     D trulc7ds      E DS
007910051206     D* DS PER tntb51R - controllo se dati EDI trasferiti
007920051206     D tntb50ds      E DS
007930061122     D fior51ds      E DS
007940070604     D fior56ds      E DS
007950081014     D trtc86drds    E DS
007960150226     D tisigads      E DS
007970030326     d Trul13ds      e ds
007980030326     D  tI13Tla      e                     EXTFLD(I13Tla)
007990030326     D  tO13Err      e                     EXTFLD(O13Err)
008000030326     D  tO13Msg      e                     EXTFLD(O13Msg)
008010111206     d
008020111206     d Trul13ds1     e ds
008030090325
008040090325     D TIBS69DS      E DS
008050090515     D ds_cnaco      E DS                  extname(CNACO00F) prefix(BS_)
008060090515     D ds_cnind      E DS                  extname(CNIND00F) prefix(BS_)
008070090515     D ds_cnclp      E DS                  extname(CNCLP00F) prefix(BS_)
008080090515     D ds_fncls      E DS                  extname(FNCLS00F) prefix(BS_)
008090090325
008100980108     D CNCR80        E DS
008110900427     D UT§DSE        E DS                  EXTNAME(UT§DSE0F)
008120000000     D  TCU                  398    697
008130000000     D                                     DIM(50)
008140000000     D  KCU                  698    847P 0
008150000000     D                                     DIM(50)
008160000000     D                                     PACKEVEN
008170000000     D  DTU                  848    895P 0
008180000000     D                                     DIM(12)
008190000000     D                                     PACKEVEN
008200991214     D* DS DI BLP
008210000211     D DSBLP0        E DS                  EXTNAME(FNBLP00F)
008220000211     D DSBLD0        E DS                  EXTNAME(FNBLD00F)
008230000211     D DSSGN0        E DS                  EXTNAME(FISGN00F)
008240041019     D SAVBLP        E DS                  EXTNAME(FNBLP00F)
008250041019     D                                     prefix(x_)
008260001130     D* DS RICHIAMO PROGRAMMA CANCELLAZIONE BOLLA SINGOLA
008270001130     D DSLS63        E DS                  EXTNAME(FNLS63DS)
008280010216     D* DS RICHIAMO PROGRAMMA RICERCA O.R.M.
008290150928     D*DSOR04        E DS                  EXTNAME(FIOR04DS)
008300150928     D fior010ds     E DS
008310110419     D fior58ds      E DS
008320010228     D* DS RICHIAMO PROGRAMMA IMMISSIONE ORM PREPAGATO
008330010228     D DSOR05        E DS                  EXTNAME(FIOR05DS)
008340010228     D  §RMPOO       E                     EXTFLD(§RMPOEO)
008350010228     D  §RMNSO       E                     EXTFLD(§RMNSRO)
008360010228     D  §RMNOO       E                     EXTFLD(§RMNORO)
008370010228     D  §RMNRO       E                     EXTFLD(§RMNRVO)
008380980318     D* DS PER COMPOSIZIONE SEGNACOLLO EUROEXPRESS
008390980318     D                 DS
008400980318     D  WJUT                   1      3    INZ('JUT')
008410980318     D  WIT                    4      5    INZ('IT')
008420051102     D  ARSFLS                 6      8  0
008430051102     D  ARSNRS                 9     10  0
008440051102     D  ARSNSC                11     17  0
008450011120     D  W15C                  18     19
008460011107     D  W55L                  18     21
008470980408     D  WCADN                 22     32
008480980408     D  DSEEX                  1     32
008490010216     D*
008500010216     D* DS PER RICHIAMO FIOR07R PER VISUALIZZAZIONE ORM
008510010216     D FIOR07          DS
008520010216     D  D07POE                 1      3  0
008530010216     D  D07NOR                 4     10  0
008540010216     D  D07NSR                11     12  0
008550010216     D  D07NRV                13     14  0
008560010216     D  D07SCE                15     15
008570010216     D  D07FGS                16     18  0
008580010216     D  D07POR                19     21  0
008590010216     D  D07DTR                22     29  0
008600010216     D  D07MDB                30     39
008610010216     D  D07PRB                40     49
008620010216     D  D07DTS                50     57  0
008630010216     D  D07RMP                58     58
008640010216     D  D07BRC                59     59
008650010216     D  D07REF                60     61
008660010216     D  D07MIO                62     62
008670011108     D DSEDIT        E DS                  EXTNAME(XEDITDS)
008680011108     D  IEDNUM       E                     EXTFLD(IEDNUMERO)
008690011108     D  IEDNRD       E                     EXTFLD(IEDNRDEC)
008700011108     D  IEDEDT       E                     EXTFLD(IEDEDTCOD)
008710011108     D  IEDLEN       E                     EXTFLD(IEDLENFLD)
008720011108     D  OEDNUM       E                     EXTFLD(OEDNUMAN)
008730011108     D  OEDFLG       E                     EXTFLD(OEDFLGERR)
008740011108     D  OEDCOD       E                     EXTFLD(OEDCODERR)
008750020530     D*
008760060213     D DSARBD        E DS
008770060213     D DSARBG        E DS
008780060213     D DARBT         E DS
008790060213     D DSARBK        E DS
008800060213     D fnlr48ds      E DS
008810020530     D tisit0ds      E DS
008820070924     D tisit0x1ds    E DS
008830091006      * ds x richiamo pgm FNLS28R
008840091006     d Fnls28ds      e ds
008850040227      * ds x richiamo pgm FNLS26R
008860040227     d Fnls26ds      e ds
008870060125      * ds x richiamo pgm FNLS25R
008880060125     d Fnls25ds      e ds
008890060207      * ds x richiamo pgm FNLv85R
008900060207     d Fnlv85ds      e ds
008910161220
008920161220     d Fnlv84ds      e ds
008930060616     d trul28ds4     e ds
008940061127     d fidn12ds      e ds                  prefix(dn_)
008950110512     d dsemail       e ds
008960110517     d Fnls80ds      e ds
008970110517     d  dPog                   1     90  0 Dim(30)
008980140507     d fidna6ds      e ds
008990160129     d fidna7ds      e ds
009000160125     d FIDNA2ds      e ds                  inz
009010160125     d  IA2mod       e                     inz('I')
009020160125     d  IA2tor       e                     inz('S')
009030060208     D cndizion      E DS
009040060208     D                                     BASED(nullPtr)
009050060208     D                                     PREFIX(diz)
009060120615     d trulflbds     e ds
009070080109      * - Aggiunta/Sottrazione di n giorni lavorativi ad una data
009080080109     d TRUL52ds      e ds
009090151023
009100151023     d fieulpdds     e ds
009110151023
009120051123     d* Ds per richiamo fnlsa8r
009130051124     D*PARAM2          DS
009140051123     D* PARAM2: PASSAGGIO AD ANNULLAMENTO ANOMALIE E DATE
009150051124     D**wrvnfv                 2      6  0
009160051124     D**BRVNPG                 7      7  0
009170051124     D**BRVLNP                 8     10  0
009180051124     D**BRVLNA                11     13  0
009190051124     D**BRVNRS                14     15  0
009200051124     D**BRVNSC                16     22  0
009210051124     D**BRVCAN                23     23
009220051124     D**BRVVUC                24     30  6
009230051124     D**PARFLG                31     31
009240051124     D**PARFEL                92     94  0
009250051124     D**BRVNPS                95     96  0
009260051124     D**BRVFGS                97     99  0
009270051124     D**BRVFLE               100    102  0
009280051124     D**BRVpes               103    105  0
009290080410     D dcppflo       e ds
009300080410     D dntw          e ds
009310140121     D dspr          e ds
009320140612
009330140612     d TRULVPODS     e ds
009340160304     d** sk_VPODIR            16    765    inz   dim(250)
009350160310     d   sk_VPODPD            16    765    inz   dim(250)
009360150701     d* Aggiorna record di FISGN duplicati su altro Terminal di Partenza
009370150701     d fnlssgnds     e ds
009380160223      *
009390160223     d fnlvdpds      e ds
009400061212     d*
009410061212     D FNBLP1          DS
009420061212     D  BLPNRR               397    400B 0
009430160125      *?definizione oggetto reclamo come spedizione?
009440160125     d ds_OggSped      ds                  inz
009450160125     d  wdna2lnp                      3s 0 inz
009460160125     d  wdna2nrs                      2s 0 inz
009470160125     d  wdna2nsp                      7s 0 inz
009480160125     d  wdna2aas                      4s 0 inz
009490020212     d*
009500020212     d xw              s              2  0
009510020212     d zw              s              2  0
009520020212     d totale          s              3  0
009530020212     d intero          s              2  0
009540020212     d restof          s              2  0
009550021120     d Ksc8888         s              4  0
009560021120     d DueCtr          s              2  0
009570021120     d Wctr            s                   Like(VidCtr)
009580020212     d*
009590020212     d fedexbrc        ds
009600020212     d  fbrc                   1     11  0 dim(11)
009610020212     d  fchd                  12     12  0
009620020212     d*
009630020212     d base            s              1  0 dim(3)
009640020308     d*
009650020308     d sav_dslsz1      s                   like(dslsz1)
009660021118     d SavGdd          s                   Like(O95Gdd)
009670020308     d w8hcol          s                   like(v8hcol)
009680020308     d w8cnot          s                   like(v8cnot)
009690020308     d wnopos          s              1
009700020319     d clintw          s                   like(§ogntw)
009710081215     d ntwpor          s                   like(§ogntw)
009720020530     d wdisag          s                   like(ot0dos)
009730030305     d savdisag        s                   like(ot0dos)
009740070924     d savpart         s                   like(ot0dos)
009750080307     D WY              s              2  0
009760021203
009770021203     D kpdpdr          S                   LIKE(APDpdr)
009780021203     D kpdtip          S                   LIKE(APDtip)
009790060109     d d_o95lna        s                   like(o95lna)
009800060109     d d_o95znc        s                   like(o95znc)
009810060109     d d_o952ln        s                   like(o952ln)
009820060308     d wcvb            s                   like(ilv85cvb)
009830060522     d kfgs            s                   like(dstfgs)
009840060522     d w_pogest        s                   like(dstfgs)
009850060622     d §lpcad_w        s                   like(§lpcad)
009860060707     d savaogntw       s                   like(§ogntw)
009870061121     d poentw          s                   like(§ogntw)
009880061012     d wdpc            s                   like(pdcdpc)
009890060613     d wsolo_num       s              1
009900060614     d comnrd          s             14  0
009910061218     d savnrr          s                   like(blpnrr)
009920070322     d wparcel         s              2
009930070404     d w_cgi           s                   like(§lpcgi)
009940070404     d lna_sav         s                   like(blplna)
009950070427     d savtb1          s                   like(flgtb1)
009960120926     d savrbl          s                   like(§3arbl)
009970120927     d wagc            s                   like(blpaas)
009980070612     d kedcod          s                   like(tabcod)
009990070612     d kedkey          s                   like(tabkey)
010000070626     d kdpodep         s                   like(dpodep)
010010070626     d kdpoord         s                   like(dpoord)
010020070829     d s_drt           s                   like(viddrt)
010030070829     d s_drtblp        s                   like(viddrt)
010040081111     d s_drtblpi       s                   like(blpdrt)
010050071023     d w_callyco       s              1
010060080313     d k_tbecod        S                   LIKE(tbecod)
010070080313     d k_tbeke1        S                   LIKE(tbeke1)
010080100517     d** wparz           s              1
010090100517     d** wparz_d         s                   like(vidncd)
010100100517     d** wparz_a         s                   like(vidnca)
010110080314     d w_bldncd        s                   like(bldncd)
010120080314     d w_bldnca        s                   like(bldnca)
010130100517     d** no_range        s              1
010140080314     d f_range         s              1
010150160726     d*wemznc          s              2  0
010160160726     d*wmsgzo          s              1
010170090609     d wmsgtsp         s             78
010180090609     d wvid            s              1
010190090609     d wncl            s                   like(v1cncl)
010200090609     d wpes            s                   like(vidpkg)
010210090609     d wvol            s                   like(vidvol)
010220090609     d wncl_pre        s                   like(v1cncl)
010230090609     d wpes_pre        s                   like(vidpkg)
010240090609     d wvol_pre        s                   like(vidvol)
010250160219     d oc7prgc_        s                   like(tamprg)
010260160219     d s_27ntw         s                   like(o27ntw)
010270060208     d*
010280060208     D nullPtr         S               *
010290060208     D prmAas          S
010300060208     D                                     LIKE(diz$Aas)
010310060208     D prmLnp          S
010320060208     D                                     LIKE(diz$Lnp)
010330060208     D prmNrs          S
010340060208     D                                     LIKE(diz$Nrs)
010350060208     D prmNsp          S
010360060208     D                                     LIKE(diz$Nsp)
010370060208     D prmFiv          S
010380060208     D                                     LIKE(diz$Fiv)
010390060208     D prmDft          S
010400060208     D                                     LIKE(diz$Dft)
010410060208     D prmNft          S
010420060208     D                                     LIKE(diz$Nft)
010430060208     D prmEsito        S             10I 0
010440020212     d*
010450090325     d $Fine           s               n   inz(*off)
010460090326     d wclg            s                   like(§b4clg)
010470090326     d w_§lpksca       s                   like(§lpksca)
010480090326     d w_§lpctra       s                   like(§lpctra)
010490090326     d s_fnlv59ds      s                   like(fnlv59ds)
010500090326
010510090327     d s_wcliksc       s                   like(wcliksc)
010520090326     d s_wclictr       s                   like(wclictr)
010530090327     d s_ormksc        s                   like(ormksc)
010540090327     d s_ormctr        s                   like(ormctr)
010550140211     d ormloc_n        s                   like(ormloc)
010560110516     d s_wemdest       s                   like(wemdest)
010570140423     d s_wsms          s                   like(wsms)
010580160511     d sav_wemdest     s                   like(wemdest)
010590160511     d sav_wsms        s                   like(wsms)
010600130315     d wsms            s                   like(§vatstel)
010610130315     d wsmp            s                   like(§vatssmp)
010620130918     d wmmp            s                   like(§vatsmmp)
010630130918     d wmmp_ar5        s                   like(§ar5mmp)
010640110705     d s_wcupcup       s                   like(wcupcup)
010650110705     d s_wcupcig       s                   like(wcupcig)
010660110705
010670091211     d nochkticC       s               n   inz(*off)
010680110518     d wfvab           s               n   inz(*off)
010690110818     d werrxco         s               n   inz(*off)
010700111026     d RA_ncd          s                   like(vidncd)
010710111026     d RA_nca          s                   like(vidnca)
010720111026     d RA_ncl          s                   like(savncl)
010730111026     d RA_lna          s                   like(savlna)
010740111026     d wRA_lna         s                   like(blplna)
010750111026     d savtsp73        s                   like(i73tsp)
010760120606     d wstringa        s                   like(§VAT4CUP)
010770121123     d wesar4z         s              1
010780121123     d wtrasmz         s              1
010790121123     d wkscz           s                   like(§b4okc)
010800130219     d wnoZ            s              1
010810130924     d aggioAr8        s              1
010820130927     d w_emd           s              1
010830140424     d w_smp           s              1
010840131003     d n_§clipsm       s                   like(blppkb)
010850131003     d n_§clivlm       s                   like(blpvlb)
010860140110     d posl            s              2  0
010870140110     d posr            s              2  0
010880140110     d lung            s              2  0
010890141202     d lenPC           s              2  0
010900140212     d* Lunghezza di CHARNOOK deve essere:  lunghezza di tbeuni + 1
010910140212     d* Il +1 è necessario per assicurarmi che nella stringa sia sempre
010920140212     d* presente un blank
010930141202     d charnook        s            257
010940140212     d charnookf       s                   like(charnook)
010950160112     d charnooki       s                   like(charnook)
010960140403     d comgf2          s                   like(o95gf2)
010970140716     d wznbrv          s                   like(brvznc)
010980140716     d wdfs            s                   like(brvdfs)
010990140716     d whms            s                   like(brvhms)
011000140716     d wokzona         s              1
011010150202     d wLocNorm        s                   like(o95loc)
011020141202     d charPCok        s            256
011030150305     d wfiglia         s              1
011040150907     d wlv13           s              1
011050150907     d wlv13_giro2     s              1
011060151014     d PesVolpkcn      s                   Like(Taspkcn)
011070151014     d PesVolSpc       s                   Like(TasSpc)
011080151014     d PesVolIMV       s                   Like(Ar6IMV)
011090151014     d savimv_fat      s                   Like(vidimv)
011100160120     d $finef10        s              1
011110160120     d wf10            s              1
011120160126     d wf16            s              1
011130160201     d wfine           s              1
011140160223     d pkgbolla        s                   like(vidpkg)
011150160224     d w_aDpd          s              1
011160160302     d wtip            s                   like(i27tip)
011170160421     d w_VariaZnc      s              1
011180161229     d*wcadal          s                   like(§fscdal)
011190161229     d*wcaal           s                   like(§fscal)
011200161019     d w_unoI          s              1
011210161019     d w_unoJ          s              1
011220170214     d simfel_s        s                   like(simfel)
011230170214     d simpou_s        s                   like(simpou)
011240170214     d simtpp_s        s                   like(simtpp)
011250170214     d ParLnpB         s              3  0
011260170214     d s_ParLnpB       s                   like(ParLnpB)
011270170214     d wcarsimfel      s              1
011271170928     d w_dpe           s                   like(pnddpe)
011272171006     d                 ds
011273171006     d d5_lnpds                     255
011274171006     d d5_lnp                         3    dim(85) overlay(d5_lnpds)
011275171005     d wcdpderr        s                   like(osid4err)
011276171006     d wlna_dp         s                   like(comlna)
011280170214
011290011211     D                SDS
011300011211     D  NOMPGM                 1     10
011310930629     D*
011320930629     D* DEFINIZIONE COSTANTI
011330930629     D*
011340990610     D CPREPA          C                   CONST('FRANCO PREPAGATO')
011350990610     D CNOSEQ          C                   CONST('NON SEQUENZIALI')
011360941011     D CULTSP          C                   CONST('ULTIMA SPEDIZIONE: ')
011370941011     D CVARIA          C                   CONST('S P E D I Z I O N E')
011380941011     D CCONFE          C                   CONST('BOLLA DA CONFERMARE')
011390941231     D CPDC            C                   CONST('su Piano dei Conti')
011400950303     D CPIVA           C                   CONST('Partita IVA:')
011410050427     D CAUT            C                   CONST('(AUT.       ) ENTER x FORZ.')
011420980115     D CMAIUS          C                   CONST('ABCDEFGHIJKLMNOPQRS-
011430980115     D                                     TUVWYXZ')
011440980115     D CMINUS          C                   CONST('abcdefghijklmnopqrs-
011450980115     D                                     tuvwyxz')
011460991214     D CDPD            C                   CONST('PARCEL DPD: ')
011470020726      * - Società chiave per tabella "YIV"
011480020725     D C_Soc           c                   const('201')
011490010209     D*
011500010209     D* CAMPO PER DSPATR "REVERSE IMAGE"        DEI CAMPI A VIDEO
011510010209     D RIMM            C                   CONST(X'21')
011520040610     D* CAMPO PER DSPATR "HI" + "UL"            DEI CAMPI A VIDEO
011530040610     D HIUL            C                   CONST(X'26')
011540040610     D* CAMPO PER DSPATR "RI" + "UL"            DEI CAMPI A VIDEO
011550040610     D RIUL            C                   CONST(X'25')
011560010209     D* CAMPO PER DSPATR "NO DISPLAY"+"PROTECT" DEI CAMPI A VIDEO
011570010209     D NDPR            C                   CONST(X'A7')
011580011122     D* CAMPO PER DSPATR "PROTECT" + "HI"       DEI CAMPI A VIDEO
011590011122     D PROT            C                   CONST(X'A2')
011600040609     D* CAMPO PER DSPATR "PROTECT" + "RI"       DEI CAMPI A VIDEO
011610040609     D PRRI            C                   CONST(X'A1')
011620010219     D* CAMPO PER DSPATR "NO DISPLAY"
011630010219     D NODI            C                   CONST(X'27')
011640070801     D* CAMPO PER DSPATR "Blinking"
011650111206     D*BLNK            C                   CONST(X'28')
011660111206     D BLNK            C                   CONST(X'2E')
011670061110     D* CAMPO PER DSPATR "UL"
011680061110     D ul              C                   CONST(X'24')
011690030304     D* CAMPO PER DSPATR "PROTECT"+ HI + UL     DEI CAMPI A VIDEO
011700030304     D PROT1           C                   CONST(X'A6')
011710030627      * testo x cliente tassazione bolle FW
011720030627     d wnotfw          c                   Const('cliente tassazione')
011730130117
011740130117      // - Tabella OSR
011750130117     d c_tabosr        c                   const('OSR')
011760080307
011770080307     D digits          c                   '0123456789'
011780130117
011790130117      // - Reperimento tabella
011800130117     d tibs02r         pr                  extpgm('TIBS02R')
011810130117     d  kpjba                              likeds(kpjba)    const
011820130117     d  dsbs02                             likeds(dsbs02)
011830140423
011840140423      // ? PROTOTIPI ?
011850140423      /copy gaitrasrc/srcprotopr,ubchkcel
011860140423      /copy gaitrasrc/srcprotopi,ubchkcel
011870130117
011880020917     IFIVAD000
011890020917     I              VADATB                      BLDATB
011900941230     I              VADCCM                      BLDCCM
011910941230     I              VADLNP                      BLDLNP
011920941230     I              VADAAS                      BLDAAS
011930941230     I              VADNRS                      BLDNRS
011940941230     I              VADNSP                      BLDNSP
011950941230     I              VADCDP                      BLDCDP
011960941230     I              VADNCL                      BLDNCL
011970941230     I              VADNCD                      BLDNCD
011980941230     I              VADNCA                      BLDNCA
011990000208     IFISGN000
012000000204     I              SGNFLS                      §LDLNP
012010000204     I              SGNDLP                      §LDDLP
012020000204     I              SGNCDP                      §LDCDP
012030000204     I              SGNNRS                      §LDNRS
012040000208     I              SGNNCD                      §LDNCD
012050000204     I              SGNLNA                      §LDLNA
012060000204     I              SGNDLA                      §LDDLA
012070000204     I              SGNTNA                      §LDTNA
012080000204     I              SGNTSP                      §LDTSP
012090000207     I              SGNZSC                      §LDZSC
012100000204     I              SGNNC1                      §LDNC1
012110000204     I              SGNNC2                      §LDNC2
012120000204     I              SGNRSM                      §LDRSM
012130000204     I              SGNPRM                      §LDPRM
012140000204     I              SGNRSD                      §LDRSD
012150000204     I              SGNCAD                      §LDCAD
012160000204     I              SGNIND                      §LDIND
012170000204     I              SGNLOD                      §LDLOD
012180000204     I              SGNPRD                      §LDPRD
012190000204     I              SGNCPD                      §LDCPD
012200000204     I              SGNNCP                      §LDNCP
012210000204     I              SGNNCU                      §LDNCU
012220050421     I              SGNRST                      §LDRST
012230000204     I              SGNVOL                      §LDVOL
012240000204     I              SGNPKG                      §LDPKG
012250000204     I              SGNFVR                      §LDFVR
012260000204     I              SGNAAS                      §LDAAS
012270000204     I              SGNMGS                      §LDMGS
012280000208     I              SGNTST                      §DETST
012290000208     I              SGNTSE                      §DETSE
012300000208     I              SGNSSE                      §DESSE
012310000208     I              SGNSIP                      §DESIP
012320000208     I              SGNSIA                      §DESIA
012330000208     I              SGNAWB                      §DEAWB
012340000208     I              SGNISA                      §DEISA
012350000208     I              SGNFCA                      §DEFCA
012360000208     I              SGNEUR                      §DEEUR
012370000208     I              SGNXX1                      §DEXX1
012380000208     I              SGNXX2                      §DEXX2
012390001005     IFISGN005
012400001005     I              SGNFLS                      §LDLNP
012410001005     I              SGNDLP                      §LDDLP
012420001005     I              SGNCDP                      §LDCDP
012430001005     I              SGNNRS                      §LDNRS
012440001005     I              SGNNCD                      §LDNCD
012450001005     I              SGNLNA                      §LDLNA
012460001005     I              SGNDLA                      §LDDLA
012470001005     I              SGNTNA                      §LDTNA
012480001005     I              SGNTSP                      §LDTSP
012490001005     I              SGNZSC                      §LDZSC
012500001005     I              SGNNC1                      §LDNC1
012510001005     I              SGNNC2                      §LDNC2
012520001005     I              SGNRSM                      §LDRSM
012530001005     I              SGNPRM                      §LDPRM
012540001005     I              SGNRSD                      §LDRSD
012550001005     I              SGNCAD                      §LDCAD
012560001005     I              SGNIND                      §LDIND
012570001005     I              SGNLOD                      §LDLOD
012580001005     I              SGNPRD                      §LDPRD
012590001005     I              SGNCPD                      §LDCPD
012600001005     I              SGNNCP                      §LDNCP
012610001005     I              SGNNCU                      §LDNCU
012620001005     I              SGNVOL                      §LDVOL
012630001005     I              SGNPKG                      §LDPKG
012640001005     I              SGNFVR                      §LDFVR
012650001005     I              SGNAAS                      §LDAAS
012660001005     I              SGNMGS                      §LDMGS
012670001005     I              SGNTST                      §DETST
012680001005     I              SGNTSE                      §DETSE
012690001005     I              SGNSSE                      §DESSE
012700001005     I              SGNSIP                      §DESIP
012710001005     I              SGNSIA                      §DESIA
012720001005     I              SGNAWB                      §DEAWB
012730001005     I              SGNISA                      §DEISA
012740001005     I              SGNFCA                      §DEFCA
012750001005     I              SGNEUR                      §DEEUR
012760001005     I              SGNXX1                      §DEXX1
012770001005     I              SGNXX2                      §DEXX2
012780930611     IAZORG01L  AA
012790000000     I/SPACE 3
012800900504     C****************************************************************
012810900504     C*  RIEPILOGO INDICATORI
012820011115     C* N.B.: IL 92,93 E 99 SONO RIUTILIZZABILI DOPO AVERLI TOLTI ANCHE
012830011115     C*       DAL FORMATO VIDEO
012840900504     C***************************************************************
012850990628     C* 01    - ON-RICERCA ANAGRAFICA ATTIVATA
012860940825     C* 02    - PROTEGGO MITTENTE IN 2 VIDEATA
012870941103     C* 03    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE ORIGINALE
012880900504     C* 04    - BOLLA ASSEGNATO
012890940920     C* 05    - ESISTE 2 BOLLA E NON E' TASSATO DESTINO
012900010222     C* 06    - POSIZIONAMENTO CURSORE SU NUMERO ORM DAL SECONDO GIRO
012910040915     C*         IN POI SE ATTIVATA PRCEDURA ORM
012920960926     C* 07    - IL PRIMO GIRO SI POSIZIONA SUL COD AUTOTRASPORTATORE
012930940928     C*         DAL 2 IN POI SUL MITTENTE
012940900507     C* 08    - TASSATO DESTINO
012950940922     C* 09    - EMETTO IL TIPO SERVIZIO IN "RI" SE DA TARIFFA
012960941004     C* 10    - EVIDENZIO IL CODICE ISO DELLA P.IVA SE IMPOSTATO DA NAZ
012970941219     C* 11    - CHANGE SU C/ASSEGNO
012980941219     C* 12    - PROVENGO DA MANUTENZIONE
012990940920     C* 13    - PROTEGGO IL CODICE OPERATORE QUANDO NON MODIFICABILE
013000991130     C*          E SE LNP DPD, *IN79=*ON, PROTEGGO RMN
013010940913     C* 14    - SPROTEGGO LA LNP CLIENTE E MI POSIZIONO
013020900824     C* 15    - PROVENGO DA CARICAMENTO BOLLE DA DISK CLIENTI
013030940825     C* 16    - IMMISS.  BOLLE - PERSONALIZ.DATA CONSEGNA RICHIESTA
013040940825     C* 17    - IMMISS.  BOLLE - PERSONALIZ.TIPO CONSEGNA RICHIESTA
013050930329     C* 18    - IMMISS.  BOLLE - PERSONALIZ.ESPRESSO
013060940825     C* 19    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE
013070930329     C* 20    - IMMISS.  BOLLE - PERSONALIZ.LINEA ARRIVO
013080930329     C* 21    - IMMISS.  BOLLE - PERSONALIZ.CODICE BOLLA
013090990630     C* 22    - PROTEZIONE DATI FATTURA E VISUAL.TOT.FATTURA PER PREPAG
013100940920     C* 23    - IMMISS.  BOLLE - PERSONALIZ.ORA  CONSEGNA RICHIESTA
013110930329     C* 24    - IMMISS.  BOLLE - PERSONALIZ.DATA SPEDIZIONE
013120940826     C* 25    - CTM PER CREAZIONE SEGNACOLLI
013130930329     C* 26    - IMMISS.  BOLLE - PERSONALIZ.COD TRATTAM MERCE
013140940825     C* 27    - IMMISS.  BOLLE - PERSONALIZ. DELLA NATURA MERCE
013150930329     C* 28    - IMMISS.  BOLLE - PERSONALIZ.COD TARIFFA MITTENTE
013160930329     C* 29    - IMMISS.  BOLLE - PERSONALIZ.IL CODICE TARIFFA
013170900508     C* 30/32 - DI COMOD RIUTILIZZABILI
013180980219     C* 33    - PROTEGGO LA DIVISA DEL C/A
013190000928     C*         IN MANUTENZIONE MI SERVE PER AGGIORNAMENTO FNBLD
013200000928     C*         IN CONFERMA DISK (DISK C EX DISK B) LO ACCENDO PER
013210000928     C*         DISABILITARE AGGIUNTA COD.CHI SONO
013220990610     C* 34    - ELABORAZIONE PER PREPAGATI
013230940926     C* 35    - SFLDSP
013240940825     C* 36    - BOLLE DISK CLI - ON -POSIZIONAMENTO CURSORE SU VOLUME
013250931123     C*       - BOLLE DISK CLI - OFF-POSIZIONAMENTO CURSORE SU SEGNACOL
013260010222     C* 37    - IMMISS.  BOLLE - PERSONALIZ.NUMERO ORM
013270941020     C* 38    - POSIZIONAMENTO CURSORE STD SE SPENTO.
013280941020     C*         SE ACCESO SIGNIFICA CHE E' STATO ATTIVATO UN ALTRO POSZ
013290960319     C* 39    - PROTEGGO LA P.IVA DEL MITTENTE
013300960319     C* 40/84 - ERRORE
013310940826     C* 44    - BOLLE DISK CLI - SE DA GIACENZE O CAMBIO PORTO
013320930330     C*          E MANUT BOLLE -   NO VARIAZIONE DEL TIPO BOLLA
013330960319     C* 71/73 - ERRORE SU CAP/NAZIONE/RAGIONE SOCIAL MITTENTE ORIGINALE
013340980219     C* 76    - PROTEZIONE DEI CAMPI TIPO INCASSO C/A SE EXPORT
013350000905     C* 77    - ERRORE SU FLAG DDT
013360000830     C* 78    - INDICATORE SFLDSP PER SFL COD."CHI SONO"
013370991130     C* 79    - PROTEZIONE DEL RIF.ALFABETICO PER BOLLE DPD E SE CODICE
013380991130     C*          OPERATORE NON MODIFICABILE, *IN13=*ON, PROTEGGO RMN
013390950303     C* 85    - IMMISS.  BOLLE - PERSONALIZ.SOLO COD CLIENTE
013400961111     C* 86    - ERRORE SULLE NOTE
013410961111     C* 87    - PROTEZIONE DELLA TASSAZIONE SE PGM RICHIAMO DA GIACENZE
013420950410     C* 88    - change su VALORE MERCE DICHIARATO
013430941219     C* 89    - change su importo da assicurare
013440941219     C* 90    - SEGNALA LA PRESENZA DI ERRORI
013450960319     C* 91    - IMMISS.  BOLLE - PERSONALIZ.I GIORNI DI CHIUSURA
013460011115     C* 92    - EVIDENZIO DIVISA IMP ASSIC SE DA MITTENTE(E NON E' IT)
013470011115     C* 93    - EVIDENZIO DIVISA C/A       SE DA DESTINAT(E NON E' IT)
013480930414     C* 94    - BOLLE DISK CLI - ABILITO CM21 X GEST. DETT.STAMPA SEGN
013490940922     C* 95    - ABILITA INSERIM.SERIE PER BOLLETTAZIONE
013500940922     C*         CLIENTI CON SERIE CHE DANNO SOLO ETICH
013510980324     C* 96    - BOLLE DISK CLI - ABILITO F22 X GEST.ESTENS. DETT.COLLI
013520940922     C* 97    - EMETTO I CAMPI RIPRESI DA TARIFFA IN "RI"
013530940922     C* 98    - BOLLE DI RECUPERO
013540011115     C* 99    - EVIDENZIO DIVISA VAL MERCE SE DA MITTENTE(E NON E' IT)
013550900504     C*****************************************************************
013560930611     C     *ENTRY        PLIST
013570930611     C                   PARM                    KPJBA
013580991007     C                   PARM                    DBLP
013590991007     C                   PARM                    DTASV
013600030610     C                   PARM                    trul90ds
013610170214     C                   PARM                    ParLnpB
013620030610      *
013630030610      * Il numero dei parametri ricevuti è testato, in caso di modifica
013640030610      *  ricercare la stringa "%PARMS"
013650020917      *
013660021002      * Controllo se p.o. gestione numerico
013670021002     C                   IF        %subst(§lpfgs:1:1) < '0' or
013680021002     C                             %subst(§lpfgs:2:1) < '0' or
013690021002     C                             %subst(§lpfgs:3:1) < '0'
013700021002     C                   clear                   §fgs              3 0
013710021002     C                   ELSE
013720021002     C                   movel     §lpfgs        §FGS
013730021002     C                   ENDIF
013740030409      * controllo le ore
013750030409     c                   IF        %subst(§lpore:1:1) < '0' or
013760030409     c                             %subst(§lpore:2:1) < '0'
013770030409     c                   Clear                   §ore
013780030409     c                   Else
013790030409     c                   Move      §lpOre        §ore
013800030409     c                   EndIf
013810170214     c
013820170214     c* Routine per impostazione del simfel e di tutto ciò che si
013830170214     c* lega a SIMFEL
013840170214     c                   exsr      sr_Simfel
013850001219     C*
013860000000     C*----------------------------------------------------*
013870930628     C* §LPFPR = 'M' VENGO DA MANUTENZIONE   : CHIUDO IN RETRN
013880930628     C* §LPFPR = 'X' VENGO DA DISK CLI       : CHIUDO IN RETRN
013890930628     C* §LPFPR = 'V' VENGO DA DISK CLI       : CHIUDO IN RETRN
013900950419     C* §LPFPR = 'W' VENGO DA DISK CLI       : CHIUDO IN RETRN
013910160627     C* §LPFPR = 'D' Richiamo batch per "Vedi Pacco DPD" : CHIUDO CON LR
013920160829     c*              valido anche per il richiamo batch per creazione
013930160829     c*              bolle F* import dpd per recuperare dal ns. cliente
013940160829     c*              le spese di dirottamento addebitateci da DPD
013950050407     C* §LPFPR = 'R' VENGO DA REC BOL DSK CLI: CHIUDO IN RETRN --> OBSOLETO
013960010213     C* §LPFPR = 'O' VENGO DA CONFERMA O.R.M.: CHIUDO IN RETRN
013970990602     C* §LPFPR = 'G' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013980941230     C* §LPFPR = 'P' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013990941230     C*              NON DEVO STAMPARE LA BOLLA
014000930628     C* §LPFPR = 'I' VENGO DA INVIO DISPOSIZ : CHIUDO CON LR
014010150302     C* §LPFPR = 'B' VENGO DA GEST. BANCALI  : CHIUDO CON LR
014020020522     C* §LPFPR = 'T' VENGO DA RITIRI ANNULLATI:CHIUDO CON LR
014030030609      *                  o da ORM commissionati
014040930707     C* §LPFPR = 'C'                           CHIUDO CON LR
014050900511     C*
014060941020     C* CODICI DI RITORNO:
014070941020     C* §LPFPR = '1'                           BOLLA ANNULLATA
014080111007     C* §LPFPR = '2'                           Richiesto annullamento VAB...
014090000517     C* §LPFPR = '3'                           CMD03
014100941020     C* §LPFPR = '4'                           CMD12
014110941020     C* §LPFPR = '5'                           TROVATI ERRORI IN CONFER
014120161129     C* §LPFPR = '6'                           uscita dopo 50 secondi
014130000627     C*
014140000627     C* §LPFLG = 'C' - EFFETTUARE SOLO CONTROLLI RESTITUENDO DBLP
014150000627     C*                AGGIORNATA
014160930707    1C     §LPFPR        IFEQ      'C'
014170930628     C     §LPFPR        OREQ      'G'
014180930628     C     §LPFPR        OREQ      'I'
014190950102     C     §LPFPR        OREQ      'P'
014200020522     C     §LPFPR        OREQ      'T'
014210150302     C     §LPFPR        OREQ      'B'
014220160627     C     §LPFPR        OREQ      'D'
014230930628     C                   SETON                                        LR
014240010103   X1C                   ENDIF
014250010103     C*
014260010103     C     *LIKE         DEFINE    §LPFPR        SAVFPR
014270010103     C                   CLEAR                   SAVFPR
014280010103    1C     §LPFPR        IFEQ      'G'
014290010103     C     §LPFPR        OREQ      'P'
014300020522     C     §LPFPR        OREQ      'T'
014310150302     C     §LPFPR        OREQ      'B'
014320160613     C     §LPFPR        OREQ      'D'
014330010103     C                   MOVEL     §LPFPR        SAVFPR
014340010103     C                   ENDIF
014350011029      * PULISCO CAMPO DI ATTRIBUTI VISUALIZZAZIONE X 'FLAG TARIFFA MITTENTE'
014360011029     C                   CLEAR                   ATRFTM
014370030911      * pulisco ds di work del numero ORM
014380030911     c                   Clear                   widorm
014390040506      * pulisco ds di work del numero bolla da dsblp
014400040506     c                   Clear                   widspe
014410091221      * pulisco campo appoggio per particolarità consegna
014420091221     c                   clear                   wvidgma
014430100604     c                   clear                   w7rRC
014440141202     c                   clear                   w7rPC
014450111007     C* Attributo di visualizzazione F16=Annull:
014460111007     c* in conferma     è da visualizzare solo se richiamata con "X" o "V"
014470111007     c* in manutenzione sempre
014480111007     c                   clear                   atrann
014490111007     c                   if        *in15 and §lpfpr<> 'V' and §lpfpr <>'X'
014500111007     c                   movel     nodi          atrann
014510111007     c                   endif
014520900509     C* PULISCO CAMPI FOR02 E FOR03
014530941115    1C     §LPFPR        IFNE      'C'
014540000829     C                   EXSR      INZ08
014550991203     C                   EXSR      INZ07
014560991203     C                   EXSR      INZ06
014570971210     C                   EXSR      INZ03
014580941011     C                   EXSR      INZ02
014590940819     C                   EXSR      INZ01
014600930628     C*  MANUTENZIONE
014610950102     C   12
014620950102     CANN15              DO
014630950102     C                   EXSR      CARBLP
014640950102     C   90              GOTO      FINE
014650950102     C                   ENDDO
014660950126     C*
014670930628     C*  CARICAMENTO BOLLE DA DISK CLI
014680900824     C   12
014690900824     CAN 15              EXSR      CARBLC
014700010301     C*  CARICAMENTO DA CONFERMA ORM PREPAGATI
014710010301     C     §LPFPR        IFEQ      'O'
014720010301     C                   EXSR      CARBLO
014730010301     C                   ENDIF
014740010209     C*
014750010209     C*  HO CARICATO LA VIDEATA: VERIFICO SE ATTIVATA PROC. O.R.M.
014760010209     C*  SE PGM RICHIAMATO DA GIACENZE O CONFERMA BOLLE LA PROCED. ORM
014770010209     C*  NON E' ATTIVATA SE P.O. EMITTENTE = 0
014780010219     C                   Z-ADD     VIDLNP        WLNPO
014790010209     C*  NEGLI ALTRI CASI FACCIO CHAIN SU ORGANIGRAMMA
014800010209     C                   EXSR      ATTORM
014810010219     C* SE SONO IN MANUTENZIONE E ORM FITTIZIO IMPOSTO NUMERO ORM A VI-
014820010219     C* DEO
014830010219     C     WORM          IFEQ      'S'
014840010219     C     *IN12         ANDEQ     *ON
014850010219     C     *IN15         ANDEQ     *OFF
014860010219     C     VIDPOE        ANDEQ     *ZEROS
014870010219     C                   Z-ADD     VIDLNP        VIDPOE
014880010219     C                   MOVE      *ALL'9'       VIDNOR
014890010219     C                   MOVE      *ALL'9'       VIDNRV
014900010219     C                   MOVEL     VIDORM        W01ORM
014910070627     C                   MOVEL     VIDORM        s_dsbl4m
014920010219     C                   ENDIF
014930010502     C* IN IMMISSIONE E NO PREPAGATO E PROCEDURA ORM ATTIVA IL FLAG
014940010502     C* MATTINO/POMERIGGIO LO LASCIO VUOTO
014950010502     C     WORM          IFEQ      'S'
014960010502     C     *IN12         ANDEQ     *OFF
014970010502     C     PARTCH        ANDNE     'P'
014980010502     C     §LPFPR        ANDNE     'O'
014990010502     C                   CLEAR                   VIDFPP
015000010502     C                   ENDIF
015010010209     C*
015020910108     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
015030910108     C*    AI CONTROLLI
015040940214     C   12
015050940214    2CAN 15§LPFPR        IFNE      'V'
015060910108     C                   GOTO      CT1TAG
015070940214    2C                   END
015071170831     C   12
015072170831    2CANn15§LPFPR        IFeq      'N'
015073170831     C                   GOTO      CT1TAG
015074170831    2C                   END
015080900427     C*
015090900427     C     FOR01         TAG
015100121017      * Se la data del giorno è compresa nel range dal/al per blocco immiss.
015110121017      * prepagati (tabella DGD) --> ERRORE
015120041217     c                   If        (Partch = 'P' or §LpFpr = 'O') and
015130121017     c                              dateu>= §dgdbpd and dateu<=§dgdbpa
015140121017     c****                          Dateu = §vpodip
015150041217     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
015160041217     c                             spedizioni in Porto Prepagato'
015170041217     c                   Eval      *In90 = *On
015180041217     c                   EndIf
015190940825     C* V I D E O   1
015200050119     c                   z-add     VIDORM        S_VIDORM
015210160120     c* se sono in manutenzione e sono presenti variazioni effettuate
015220160120     c* dall'arrivo devo emmettere una finestra di avviso con gestione tasto
015230160120     c* funzionale per permettere di interrogare le variazioni presenti
015240160126     c* Idem se presenti R.A.
015250160126     c                   if        *in12 and not *in15 and (
015260160126     c                             (at0fva=*blanks and wF10='S')  or
015270160126     c                             (at0fra=*blanks and wf16='S'))
015280160120     c                   eval      $finef10='0'
015290160120     c                   exsr      sr_WdwF10
015300160120     c                   clear                   wf10
015310160126     c                   clear                   wf16
015320160120     c                   endif
015330161129     c
015340161129     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
015350161129     c                   if        *in12 and not *in15
015360161129     C                   write     LS01D01
015370161129     C                   read(E)   fnls01d
015380161129     c                   else
015390161129     C                   exfmt     LS01D01
015400161129     c                   endif
015410941003     C*
015420941003     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
015430950126     C                   EXSR      OFFD01
015440161129     c
015450161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
015460161129     c                   if        %error
015470161129     C                   MOVEL     '6'           §LPFPR
015480161129     c                   goto      fine
015490161129     c                   endif
015500900427     C* CMD3 - FINE LAVORO
015510920713     C   KL
015520920713     CAN 12
015530920713     CAN 15              MOVEL     '4'           §LPFPR
015540000518     C   KC
015550000518     CAN 12
015560000518     CAN 15              MOVEL     '3'           §LPFPR
015570010308     C* IDEM SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI (IN QUESTO
015580010308     C* CASO *IN12 = OFF
015590010308     C     §LPFPR        IFEQ      'O'
015600010308     C   KL              MOVEL     '4'           §LPFPR
015610010308     C   KC              MOVEL     '3'           §LPFPR
015620010308     C   KC
015630010308     COR KL              GOTO      FINE
015640010308     C                   ENDIF
015650940825     C   KC
015660940825     COR KL
015670940825     CAN 12              GOTO      FINE
015680121017      * Se la data del giorno è nel range dal/al per blocco immissione
015690121017      * prepagati (tabella DGD) ---> ERRORE
015700050215     c                   If        (Partch = 'P' or §LpFpr = 'O') and
015710121017     c                              dateu>=§dgdbpd and dateu<=§dgdbpa
015720121017     c****                          Dateu = §vpodip
015730050215     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
015740050215     c                             spedizioni in Porto Prepagato'
015750050215     c                   Eval      *In90 = *On
015760050215     c                   goto      for01
015770050215     c                   EndIf
015780940819     C*
015790900427     C* CMD13 - PERSONALIZZAZIONE CAMPI
015800940819     C     *INKM         IFEQ      *ON
015810150722     c* per richiamo con "O" non abilito la personalizzazione che
015820150722     c* non ha senso e tra l'altro può generare errori (sul n. orm
015830150722     c* se imposto il fittizio, al ritorno in prima videata si perdono
015840150722     c* i 99999 in quanto la routine ctrorm non considera la personalizzazione
015850150722     c* per §lpfpr='O')
015860150722     c     §lpfpr        ifne      'O'
015870940819    2C                   EXSR      GESD00
015880150722     C** KC§LPFPR        IFEQ      'O'
015890150722     C**                 MOVEL     '3'           §LPFPR
015900150722     C**                 ENDIF
015910940819     C   KC              GOTO      FINE
015920040908     c* se personalizzato n. orm prima di riemettere la videata di
015930040908     c* bollettazione devo effettuare i controlli per poporre eventuali
015940040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
015950040908     c* porti allo stesso modo di quando dalla prima videata viene
015960040908     c* immesso il numero orm con la pistola (enter automatico)
015970041221     c***37              exsr      ctrd01
015980041221     c                   if        *in37 = *on
015990050119     c***                if        flgfit <> 'S' and s_v0corm <> V0corm
016000050119     c                   if        flgfit <> 'S'
016010050119     c* passo flag a ctrd01 per dire di riemettere la videata dopo aver
016020050119     c* elaborato eventuali proposte a prescindere dal fatto che vi siano
016030050119     c* dati da proporre o meno (serve per non dare errore sul n.colli blocc
016040050119     c* ando così la tastiera)
016050050119     c                   eval      wsolo_prp = '1'
016060041221     c                   exsr      ctrd01
016070041221     c                   else
016080041221     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
016090041221     c* (per uniformità: fa così anche per orm reale)
016100050117     c* Idem se orm non fittizio ma rimasto invariato
016110041221     c  n38              z-add     13            h1riga
016120041221     c  n38              z-add     20            h1colo
016130041221     c                   endif
016140041221     c                   endif
016150150722     c                   endif
016160940825     C                   GOTO      FOR01
016170940819     C                   ENDIF
016180930330     C**
016190051207     C* F16 - ANNULLAMENTO
016200111007    2C     *INKQ         IFEQ      *ON
016210111007    3c     atrann        ifeq      *blanks
016220110516     c* window per richiesta conferma
016230110516     c                   exsr      sr_geswdwconf
016240161202
016250161202     c* Se tempo max --> esco dal pgm
016260161202     c                   if        §lpfpr='6'
016270161202     c                   goto      fine
016280161202     c                   endif
016290161202     c
016300111007    4c                   select
016310111007   whc                   when      wvann='N'
016320110516     c                   goto      for01
016330111007   whc                   when      wvann='S'
016340111007     c* f16 in manutenzione --> cancello bolla da blp e file collegati
016350111007    5c                   if        *in15=*off
016360930915     C                   EXSR      ANNULL
016370111007    6C                   if        wf12 = '1' or *in90 = '1'
016380060307     c                   goto      for01
016390111007    6c                   endif
016400930915     C                   GOTO      FINE
016410111007   x5c                   else
016420111007     c* f16 in conferma --> ritorno al chiamante codice '2' per far cancellare
016430111007     c* vab e suoi collegati
016440111007     c                   eval      §lpfpr='2'
016450111007     C                   GOTO      FINE
016460111007    5c                   endif
016470111007    4c                   endsl
016480111007   x3c                   else
016490111007     c* se premuto f16 ma non è abilitato riemetto la videata
016500111007     c                   goto      for01
016510111007    3c                   endif
016520940214    2C                   END
016530010216     C**
016540051207     C* F8 - INTERROGAZIONE O.R.M.
016550010223     C     *INKH         IFEQ      *ON
016560010219     C     WORM          ANDEQ     'S'
016570010227     C     PARTCH        ANDNE     'P'
016580010220     C     VIDNOR        ANDEQ     *ZEROS
016590111122     c* se lnp import continuo a richiamare FIOR04R
016600111122     c*****              if        %lookup(vidlnp:fio)=0
016610111122     c****                         and %lookup(999:fio)=0
016620111122     c                   if        vidlnp<>prelnp
016630111122     c                   clear                   og143
016640111122     C     vidlnp        CHAIN     AZORG01L      UNIORG
016650111122     c                   if        %found(azorg01l)
016660111122     C                   MOVEL     ORGDE3        OG143
016670111122     c                   endif
016680111122     c                   eval      prelnp=vidlnp
016690111122     c                   endif
016700111122     c                   if        §ogntw='DPD' or §ogntw='EEX' or
016710111122     c                             §ogntw='FED'
016720150928     C***                CLEAR                   DSOR04
016730150928     C***                MOVEL     '1'           I04RIC
016740150928     C****               Z-ADD     VIDLNP        I04POR
016750150928     c                   clear                   fior010ds
016760150928     c                   eval      ior010ric='1'
016770150928     c                   eval      ior010por=vidlnp
016780051207     c
016790051207     c* Richiamo tnsb51r per vedere che p.o. ritiro passare
016800150929     c* non per DPD
016810150929     c                   if        *in12 and not *in15 and vidccm>0
016820150929     c                             and §ogntw<>'DPD'
016830150929     c                   clear                   tntb50ds
016840150929     C                   move      VIDCCM        b50ke2
016850051207     C*
016860150929    3C     VIDFLC        IFEQ      0
016870150929     C                   MOVEL     VIDLNP        b50ke2
016880150929     C                   ELSE
016890150929     C                   MOVEL     VIDFLC        b50ke2
016900150929    3C                   ENDIF
016910051207     c
016920150929     c                   movel     b50ke2        b50ke1
016930051207     c* controllo linea
016940150929     c                   movel     'C'           b50opz
016950150929     c                   movel     vidlnp        b50poa
016960150929     c                   call      'TNTB51R'
016970150929     c                   parm                    kpjba
016980150929     c                   parm                    tntb50ds
016990051207     c
017000150929     c                   if        b50err=' ' and b50ormreso>*zeros
017010150929     c***                movel     b50ormreso    i04por
017020150929     c                   movel     b50ormreso    ior010por
017030150929     c                   endif
017040150929     c                   endif
017050051207     c
017060150928     C***                CALL      'FIOR04R'
017070150928     C***                PARM                    KPJBA
017080150928     C***                PARM                    DSOR04
017090150928     C***  O04CM3        IFEQ      *BLANKS
017100150928     C***                Z-ADD     O04POE        VIDPOE
017110150928     C***                MOVEL     O04NSR        VIDNOR
017120150928     C***                MOVE      O04NOR        VIDNOR
017130150928     C***                Z-ADD     O04NRV        VIDNRV
017140150929     c                   call      'FIOR010R'
017150150928     c                   parm                    kpjba
017160150928     c                   parm                    fior010ds
017170150928     C     OOR010F03     IFEQ      *BLANKS
017180150928     C     OOR010F12     andeq     *BLANKS
017190150928     C     OOR010err     andeq     *BLANKS
017200150928     C                   Z-ADD     OOR010POE     VIDPOE
017210150928     C                   MOVEL     OOR010NSR     VIDNOR
017220150928     C                   MOVE      OOR010NOR     VIDNOR
017230150928     C                   Z-ADD     OOR010NRV     VIDNRV
017240050117     c                   eval      *inkh = '0'
017250050117     c                   else
017260010216     C                   GOTO      FOR01
017270050117     c                   endif
017280110419     c                   else
017290161215     c                   setoff                                       30
017300161215     c                   clear                   w001a
017310161215     c                   if        vidpdr>*zeros
017320161215     C                   TESTN                   vidpdr               30
017330161215     C                   MOVE      vidpdr        W001A
017340161215     c                   endif
017350161215     c                   if        vidpdr<=*zeros or not *in30 or
017360161215     c                             w001a<'0'
017370110419     c                   eval      *in90='1'
017380110419     c                   eval      *in56='1'
017390110419     c                   eval      vidmsg=err(210)
017400110419     c                   goto      for01
017410110419     c                   else
017420110419     c                   clear                   fior58ds
017430110419     c                   movel     vidlnp        ior58pdr
017440110419     c                   move      vidpdr        IOR58PDR
017450110419     C                   CALL      'FIOR58R'
017460110419     C                   PARM                    KPJBA
017470110419     C                   PARM                    fior58ds
017480110419     C     OOR58F03      IFEQ      *BLANKS
017490110419     C                   Z-ADD     OOR58POE      VIDPOE
017500110419     C                   MOVEL     OOR58NSR      VIDNOR
017510110419     C                   MOVE      OOR58NOR      VIDNOR
017520110419     C                   Z-ADD     OOR58NRV      VIDNRV
017530110419     c                   eval      *inkh = '0'
017540110419     c                   else
017550110419     C                   GOTO      FOR01
017560110419     c                   endif
017570110419     c                   endif
017580110419     c                   endif
017590010216     C                   ENDIF
017600010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
017610010227     C* SE NON SEMPRE VISUALIZZATO. SE NON ATTIVATA PROCEDURA ORM
017620010227     C* O SONO NEL GIRO DEI PREPAGATI MIEI RIEMETTO VIDEATA
017630010227     C   KHWORM          IFNE      'S'
017640010227     C     PARTCH        OREQ      'P'
017650010227     C                   GOTO      FOR01
017660010227     C                   ENDIF
017670930915     C*
017680910219     C* CMD21 - GESTIONE DETTAGLIO SEGNACOLLI (SOLO IN DISK CLI)
017690940214    2C   KV              DO
017700950321     C                   MOVEL     §LPCCM        PARCCM
017710991116     C                   MOVEL     §LPAAC        PARAAS
017720920204     C                   MOVEL     §LPNRS        PARNRS
017730911031     C                   MOVEL     §LPLNP        PARLNP
017740911031     C                   MOVEL     §LPLNA        PARLNA
017750911031     C                   MOVEL     §LPNSP        PARNSP
017760020917      * P.O DI GESTIONE
017770021002     C                   MOVEL     §FGS          PARFGS
017780910219     C                   MOVEL     PARAM         KPJBU
017790941230     C                   CALL      'FNLS78R'
017800910219     C                   PARM                    KPJBA
017810910219     C                   GOTO      FOR01
017820940214    2C                   END
017830990701     C* F22 - GESTIONE ESTENSIONE DETT. SEGNACOLLI (SOLO IN DISK CLI)
017840980325    2C   KW              DO
017850000904     C                   EXSR      GESD08
017860161129     c
017870161129     c                   if        §lpfpr='6'
017880161129     c                   goto      fine
017890161129     c                   endif
017900161129     c
017910980325     C                   GOTO      FOR01
017920980325    2C                   END
017930110512     c* F17-Indirizzo Email destinatario
017940150213     c***                if        *inkr=*on
017950150213     c***                if        atremd=*blanks
017960150213     c***                exsr      sr_geswdwemd
017970150213     c***                endif
017980150213     C***                GOTO      FOR01
017990150213     c***                endif
018000110705     c* F5-Riepilogo bolle da confermare
018010110519     c                   if        *inke=*on
018020110517     c                   Clear                   Fnls80ds
018030110517     c                   Movea     l1            dpog
018040110517     c                   z-add     99            d80Nsr
018050110517     c                   if        vidccm>0
018060110517     C                   MOVE      VIDCCM        d80ccm
018070110517     C     VIDFLC        IFNE      0
018080110517     C                   movel     VIDFLC        d80ccm
018090110517     C                   ELSE
018100110517     C                   movel     VIDLNP        d80ccm
018110110517     C                   ENDIF
018120110517     c                   endif
018130110517     c                   if        vidlna>*zeros
018140110517     c                   Movel     Vidlna        d80lna
018150110517     c                   else
018160110517     c                   z-add     999           d80lna
018170110517     c                   endif
018180110517     c                   call      'FNLS80R'
018190110517     c                   parm                    kpjba
018200110517     c                   parm                    fnls80ds
018210110517     C                   GOTO      FOR01
018220110517     c                   endif
018230110705     c* F19-codici CUP/CIG per tacciabilità flussi finanziari
018240110705     c                   if        *inkt=*on
018250110705     c                   if        atrcup=*blanks
018260110705     c                   exsr      sr_geswdwcup
018270110705     c                   endif
018280110705     C                   GOTO      FOR01
018290110705     c                   endif
018300150731     c* F11-Cappario
018310150731     c                   if        *inkk=*on
018320150731     C                   CLEAR                   DSSI00
018330150731     C                   MOVEL     'L01'         D00OP0
018340150731     C                   MOVEL     vidlod        D00LOC
018350150731     C                   MOVEL     blpdsp        D00DRI
018360150731     c                   movel     'S'           i30flg
018370150731     c                   movel     vidcad        i30cap
018380150731     c                   movel     vidlod        i30loc
018390150731     c                   movel     vidprd        i30prv
018400150731     c                   movel     vidnzd        i30nar
018410150731     c                   call      'TISI30R'
018420150731     C                   PARM                    KPJBA
018430150731     C                   PARM                    DSSI00
018440150731     C                   PARM                    tisi30ds
018450150731     C* Se Selezione
018460150731    5C     D00CAP        IFNE      *BLANKS
018470150731     C                   MOVEL     D00CAP        vidcad
018480150731     C                   MOVEL     D00LOC        vidlod
018490150731     C                   MOVEL     D00NAR        vidnzd
018500150731     C                   MOVEL     D00PRV        vidprd
018510150731     c                   endif
018520150731     C                   GOTO      FOR01
018530150731     c                   endif
018540940825     C*
018550971211     C* F7  - ABILITO CAMPO PER RICERCA ALFABETICA
018560941021     C   KG              SETON                                        0138
018570900427     C   KG              GOTO      FOR01
018580971211     C* F10 - ABILITO CAMPO PUNTO OPERATIVO CLIENTE
018590941020     C   KJ              SETON                                        1438
018600940921     C   KJ              GOTO      FOR01
018610900427     C* CONTROLLI FORMATO1
018620900824     C     CT1TAG        TAG
018630050119     c* imposto flag per dire se fare solo eventuali proposte da orm
018640050119     c* e poi riemettere sempre la videata o se dopo le proposte even
018650050119     c* tuali continuare coi controlli
018660050119     c* Serve perchè se sono stati personalizzati tutti i campi proponi
018670050119     c* bili il pgm emetterebbe messaggio di errore su n.colli bloccand
018680050119     c* la tastiera senza aver dato il tempo al bollettista di inserire
018690050119     c* i dati mancanti
018700050209     c* lo faccio solo se sono in immissione bolle non lo faccio in
018710050209     c* conferma bolle e in manutenzione
018720050209     c                   eval      wsolo_prp = ' '
018730050209     c                   if        s_vidorm = *zeros and *in12 = *off
018740050119     c                   eval      wsolo_prp = '1'
018750050119     c                   endif
018760010216     C                   EXSR      CTRD01
018770950126     C*
018780950126     C* CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
018790950126     C* DI ERRORE
018800950126     C     WEMFOR        IFEQ      '1'
018810010816     C                   EXSR      ESCIER
018820950126     C     §LPFPR        IFNE      '5'
018830161129     C     §LPFPR        andne     '6'
018840950127     C                   GOTO      FOR01
018850950127     C                   ELSE
018860950127     C                   GOTO      FINE
018870950126     C                   ENDIF
018880950126     C                   ENDIF
018890010215     C* RIEMETTO LA VIDEATA PER VISUALIZZARE CAMPI VIDEO DA ORM
018900010215     C     WEFORM        IFEQ      '1'
018910010215     C                   GOTO      FOR01
018920010215     C                   ENDIF
018930010214     C* ESEGUO CONTROLLI DI INCONGRUENZA CON CAMPI DELL'ORM
018940010214     C     WORM          IFEQ      'S'
018950010214     C                   EXSR      CNFOR1
018960010214     C     WEMFOR        IFEQ      '1'
018970010214     C                   EXSR      ESCIER
018980010214     C     §LPFPR        IFNE      '5'
018990161129     C     §LPFPR        andne     '6'
019000010214     C                   GOTO      FOR01
019010010214     C                   ELSE
019020010214     C                   GOTO      FINE
019030010214     C                   ENDIF
019040010214     C                   ENDIF
019050010214     C                   ENDIF
019060020122     C* SE IMMESSA LA NAZIONE EMETTO WINDOW  PER RICHIESTA CONFERMA
019070020131     c* (Se si tratta di nazione per cui è richiesta forzatura (§15FFN="S"))
019080020122     C* IN MANUTENZIONE LA EMETTO SOLO SE È DIVERSA DA QUELLA CHE C'ERA
019090020122    2C     VIDNZD        IFNE      *BLANKS
019100020131     c     DESFFN        ANDEQ     'S'
019110030707      * e se non è una bolla di recupero
019120030707     c     §3arbl        andne     'R'
019130161006     c* e se non è un disk "B"
019140161006     c                   if        §1bfg6<>'C' or §1bfg2<>'S'
019150020123     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
019160020123     c* se devo emettere la window o ritornare al chiamante con errore
019170091111     c                   move      '1'           wvidobb           1
019180020123     c                   exsr      escier
019190091111     c                   move      ' '           wvidobb
019200020123    3c     §lpfpr        ifne      '5'
019210161129    3c     §lpfpr        andne     '6'
019220020122     C* Manutenzione
019230020123    4C     *IN12         IFEQ      *ON
019240020122     C     *IN15         ANDEQ     *OFF
019250020122     C     VIDNZD        ANDNE     NZDINI
019260020122     C* Immissione
019270020122     C     *IN12         OREQ      *OFF
019280020122     c* Conferma bolle
019290020122     C     *IN15         OREQ      *ON
019300020122     C                   MOVEL     '15'          COD
019310020122     C                   MOVEL(P)  VIDNZD        KEY
019320020122     C                   EXSR      CTABEL
019330020122     C                   MOVEL     TBLUNI        DS15
019340020123     c                   eval      w01nzd = %trim(vidnzd) + '-' + §15des
019350020123     c     §lpfpr        ifne      'V'
019360020123     c                   write     ls01d01
019370020123     c                   endif
019380020124     c     forw01        tag
019390161129     c                   if        *in12 and not *in15
019400161129     C                   write     LS01W01
019410161129     C                   read(E)   fnls01d
019420161129     c                   else
019430020122     C                   EXFMT     LS01W01
019440161129     c                   endif
019450161129     c
019460161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
019470161129     c                   if        %error
019480161129     C                   MOVEL     '6'           §LPFPR
019490161129     c                   goto      fine
019500161129     c                   endif
019510020122     C* Se premuto F12 riemetto prima videata.
019520020123     C* Se pgm richiamato con "W" anzichè riemettere la prima videata ritorn
019530020123     c* l'errore al chiamante
019540020123     C   KL              goto      for01
019550020124     c  NKF              goto      forw01
019560020123    4C                   ENDIF
019570020123   x3c                   else
019580020123     c                   goto      fine
019590020123    3c                   endif
019600161006     c                   endif
019610020122    2C                   ENDIF
019620900926     C*
019630000831     C* DISK C
019640000830     C* Emetto videata per inserimento del cod. CHI SONO" se DISK C
019650020917     C* in bollettazione o se diska senza fivat
019660160226     c*    Instradamento forzato a DPD: in immissione/conferma wexdpd conterrà
019670160226     c*    blanks e va bene così perchè in questo caso la richiesta del CHI
019680160226     c*    SONO sarà da fare solo in base al flag 12 (il parcel dpd in
019690160226     c*    questi casi sarà sempre automatico a prsecindere dal flag 13)
019700050223     c* Escludo:
019710050223     C* 1) Bolle export dpd disk c se chi sono non automatico perchè in
019720050223     c*    questo caso il chi sono non viene immesso da sfl
019730050223     c* 2) Bolle import dpd sempre perchè anche in questo caso il chi sono
019740050223     c*    non viene immesso da sfl
019750000913     C  N12
019760000913     COR 12
019770000913     CAN 15§1BF12        IFEQ      'S'
019780001011     C     WEXDPD        ANDNE     'S'
019790050223     c     *in79         andeq     *off
019800001009     C     §1BF12        OREQ      'S'
019810001011     C     WEXDPD        ANDEQ     'S'
019820001009     C     §1BF13        ANDEQ     'A'
019830030321      * se non ho superato i 500 colli
019840030321If  2c                   If        v1cncl <= 500
019850000911     C     FOR09         TAG
019860010816     C* IMPOSTO CAMPI SUBFILE CONTROL
019870010816     C                   MOVE      WKSC          V8CKSC
019880010816     C                   MOVEL     VIDDMT        V8DKSC
019890000904     C                   EXSR      GESD09
019900161129
019910000914     C     *INKL         CABEQ     *ON           FOR01
019920000830     C* Controllo i dati immessi
019930000830     C                   EXSR      CTRS08
019940161129
019950000830     C     *IN90         IFEQ      *ON
019960000830     C                   EXSR      ESCIER
019970000830     C     §LPFPR        IFNE      '5'
019980000904     c* Se errore riemetto videata subfile cod.chi sono per poterla
019990000904     c* manutenzionare
020000000904     C                   EXSR      GESD08
020010000904     C   KL              GOTO      FOR01
020020000830     C                   ELSE
020030000830     C                   GOTO      FINE
020040000830     C                   ENDIF
020050000830     C                   ENDIF
020060030321   x2c                   Else
020070030321     c                   Eval      VidMsg = Err(275)
020080030321     c                   Eval      *In90 = *On
020090030321     c                   Eval      *In62 = *On
020100030321     C                   EXSR      ESCIER
020110030321     C     §LPFPR        IFNE      '5'
020120030321     C                   GOTO      FOR01
020130030321     C                   ELSE
020140030321     C                   GOTO      FINE
020150030321     C                   ENDIF
020160030321    2c                   EndIf
020170000830     C                   ENDIF
020180021120
020190021120      * Solo x FedEx richiamo di nuovo il trul27 xchè in questo momento ho anche
020200021120      * il prefisso del segnacollo che mi serve per ricerare la cartello
020210021120      * FedEx giusta
020220021120     c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED') and
020230021120     c                             (Prefisso(1) = 'FD' or Prefisso(1) = 'FM')
020240160216     c                   Clear                   Trul27Ds1
020250021120     c                   Movel     Prefisso(1)   I27Tip
020260160322     c                   eval      wtip= Prefisso(1)
020270021120     c                   Exsr      TarCar
020280021120     c                   If        Not *In12
020290021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
020300021120      * a quanto indicato in tabella "DFE"
020310021120     c                   If        O27Fie = 'N' and VidPkg > §DfePkgD
020320021120     c                   Movel     Err(264)      VidMsg
020330021120     c                   Eval      *In90 = *On
020340021120     c                   Eval      *In63 = *On
020350021120     c                   EndIf
020360021120     c                   EndIf
020370021120      * Errori
020380021120     c                   If        *In90
020390021120      * CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
020400021120      * DI ERRORE
020410021120     C                   EXSR      ESCIER
020420021120     C     §LPFPR        IFNE      '5'
020430161129     C     §LPFPR        andne     '6'
020440021120     C                   GOTO      FOR01
020450021120     C                   ELSE
020460021120     C                   GOTO      FINE
020470021120     C                   ENDIF
020480021120     c                   EndIf
020490021120     c                   EndIf
020500021120
020510011107     C* SE ATTIVATA PRCEDURA ORM E NUMERO ORM NON FITTIZIO DEVO
020520010215     C* PROPORRE I CAMPI DELLA SECONDA VIDEATA PRIMA DI EMETTERLA
020530010215     C* LO FACCIO SOLO SE NON SONO IN CONFERMA BOLLE DA DISCHETTO
020540010215     C     WORM          IFEQ      'S'
020550010215     C     FLGFIT        ANDNE     'S'
020560010215     C     PARTCH        ANDNE     'P'
020570070427     C     *IN12         IFEQ      *OFF
020580070427     C     *IN15         OREQ      *OFF
020590010215     C* in manutenzione propongo solo se variato il numero ORM
020600070427     C     WORMMD        ANDEQ     '1'
020610010215     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
020620010215     c* fine dell'immissione
020630010215     C                   EXSR      PRPOR2
020640010220     C* SE SONO IN MANUTENZIONE SEGNALO CHE POTREBBERO ESSERE VARIATI
020650010220     C* DEI DATI PRENDENDOLI DAL NUOVO N.ORM
020660010220     C   12
020670010220     CANN15WPRIMV        IFEQ      *BLANKS
020680010220     C                   SETON                                        90
020690010220     C                   MOVEL     ERR(226)      VIDMSG
020700010220     C                   MOVEL     '1'           WPRIMV            1
020710010220     C                   ENDIF
020720010215     C                   ENDIF
020730091008     c* se bolla import     porto assegnato abbinata ad orm devo proporre
020740070427     c* il mittente dell'orm nel mittente originale
020750091008     c***                if        *in79 and flgtb1='A'
020760091008     c                   if        flgtb1='A' and (§ogntw='EEX' or
020770091008     c                             §ogntw='FED' or §ogntw='DPD')
020780070427     c                   if        *in12='0' or *in15 or
020790070427     c                             (*in15='0' and (wormmd='1' or
020800070427     c                             (flgtb1='A' and flgtb1<>savtb1)))
020810070427     c                   exsr      prpor2_rmo
020820070427     c                   endif
020830070427     c                   endif
020840010215     C                   ENDIF
020850001020     C*
020860001020     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
020870001020     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
020880060113     C** 12
020890060113    2C**AN 15§LPFPR        IFNE      'V'
020900060113     C***                   GOTO      TAG02
020910060113    2C**                   END
020920040226
020930040227      * Salto il prossimo controllo se bolla con Lnp o Lna DPD
020940040227S   1c                   Select
020950040227     c                   When      *In79
020960160224     c                   When      VidDpd = 'D' or a_§OgNtw = 'DPD' or
020970160224     c                             w_aDpd='S'
020980040227     c                   Other
020990040226      * se orm con serie devo recuperare i riferimenti del mittente
021000040226      * immessi nella bolla originale legata al ritiro contestuale
021010040226      * se previsto da tabella 'OSR'
021020040227      * non forzo se bolla con Lna o Lnp DPD
021030040227if  2c                   If        wonsr > *Zeros and flgfit <> 'S' and
021040040227     c                             (d§OsrRmn = 'S' or d§OsrRma = 'S')
021050040226      * richiamo pgm x recupero dei riferimenti
021060040226     c                   Clear                   Fnls26ds
021070040227     c                   Move      wrmaas        I26Aas
021080040227     c                   Move      wrmlnp        I26Lnp
021090040227     c                   Move      wrmnrs        I26Nrs
021100040227     c                   Move      wrmnsp        I26Nsp
021110040226     c                   Call      'FNLS26R'
021120040226     c                   Parm                    Fnls26ds
021130040227if  3c                   If        O26Err = *Zeros
021140040227if  4c                   If        d§OsrRmn = 'S'
021150040227     c                   Eval      VidRmn = O26Rmn
021160040226      * proteggo il campo
021170040226     c                   Movel     Prot1         AtrRmn
021180040226     c                   Eval      wrifm = *On
021190040227    4c                   EndIf
021200040227if  4c                   If        d§OsrRma = 'S'
021210040226     c                   Eval      VidRma = O26Rma
021220040226      * proteggo il campo
021230040226     c                   Movel     Prot1         AtrRma
021240040226     c                   Eval      wrifm = *On
021250040227    4c                   EndIf
021260040227    3c                   EndIf
021270040227    2c                   EndIf
021280040227    1c                   EndSl
021290030409
021300030409      * Prima di procedere con la seconda videata devo emettere una finestra
021310030409      * se spedizione con lna FedEx o se spedizione relative ad ORM
021320030409      * commissionati da FedEx
021330030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
021340091111     c                   move      '1'           wvidobb           1
021350060113     c                   exsr      escier
021360091111     c                   move      ' '           wvidobb
021370060113    3c     §lpfpr        ifne      '5'
021380161129    3c     §lpfpr        andne     '6'
021390060113     c     §lpfpr        ifne      'V'
021400060113     c                   write     ls01d01
021410060113     c                   endif
021420091112     c                   eval      $fine='0'
021430091112     c                   Dow       $fine='0'
021440060110     c                   clear                   w02tes1
021450030409     c                   Eval      w02Tes = Rigw(1)
021460030409     c                   Eval      w02Rig1 = Rigw(3)
021470030409     c                   Eval      w02Rig2 = Rigw(4)
021480030409     c                   Eval      w02Rig3 = Rigw(5)
021490030409     c                   Eval      w02Rig4 = Rigw(6)
021500161129     c                   if        *in12 and not *in15
021510161129     C                   write     LS01W02
021520161129     C                   read(E)   fnls01d
021530161129     c                   else
021540030409     c                   Exfmt     ls01w02
021550161129     c                   endif
021560161129     c
021570161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
021580161129     c                   if        %error
021590161129     C                   MOVEL     '6'           §LPFPR
021600161129     c                   goto      fine
021610161129     c                   endif
021620161129
021630030409     c                   If        *InKl = *On
021640091112     c                   eval      $fine='1'
021650110309     c                   eval      *inkl=*off
021660030409     c                   EndIf
021670030409     c                   EndDo
021680060113   x3c                   else
021690060113     c                   goto      fine
021700060113    3c                   endif
021710030409     c                   EndIf
021720060113     c*
021730030409     c                   If        §orMic = 'F'
021740091111     c                   move      '1'           wvidobb           1
021750060113     c                   exsr      escier
021760091111     c                   move      ' '           wvidobb
021770060113    3c     §lpfpr        ifne      '5'
021780161129    3c     §lpfpr        andne     '6'
021790060113     c     §lpfpr        ifne      'V'
021800060113     c                   write     ls01d01
021810060113     c                   endif
021820091112     c                   eval      $fine='0'
021830091112     c                   Dow       $fine='0'
021840060110     c                   clear                   w02tes1
021850030409     c                   Eval      w02Tes = Rigw(2)
021860030409     c                   Eval      w02Rig1 = Rigw(7)
021870030409     c                   Eval      w02Rig2 = Rigw(4)
021880030409     c                   Eval      w02Rig3 = Rigw(8)
021890030409     c                   Clear                   w02Rig4
021900161129     c                   if        *in12 and not *in15
021910161129     C                   write     LS01W02
021920161129     C                   read(E)   fnls01d
021930161129     c                   else
021940030409     c                   Exfmt     ls01w02
021950161129     c                   endif
021960161129     c
021970161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
021980161129     c                   if        %error
021990161129     C                   MOVEL     '6'           §LPFPR
022000161129     c                   goto      fine
022010161129     c                   endif
022020161129     c
022030030409     c                   If        *InKl = *On
022040091112     c                   eval      $fine='1'
022050110309     c                   eval      *inkl=*off
022060030409     c                   EndIf
022070030409     c                   EndDo
022080060113   x3c                   else
022090060113     c                   goto      fine
022100060113    3c                   endif
022110030409     c                   EndIf
022120151015      * Prima di procedere con la seconda videata devo emettere una finestra
022130151015      * se spedizione export EEX con attraversamento doganale
022140151015     c                   if        ((wdesie='E' and viddpd=*blanks and
022150160303     c                               comlna=*zeros )
022160160224     c                              or A_§ogntw='EEX' )
022170151015     C                   MOVEL     '15'          COD
022180151015     C                   MOVEL(P)  VIDNZD        KEY
022190151015     C                   EXSR      CTABEL
022200151015     C                   MOVEL     TBLUNI        DS15
022210151015    2c                   if        §15dog<>*blanks
022220151015     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
022230151015     c* se devo emettere la window o ritornare al chiamante con errore
022240151015     c                   move      '1'           wvidobb           1
022250151015     c                   exsr      escier
022260151015     c                   move      ' '           wvidobb
022270151015    3c     §lpfpr        ifne      '5'
022280161129    3c     §lpfpr        andne     '6'
022290151015     c     §lpfpr        ifne      'V'
022300151015     c                   write     ls01d01
022310151015     c                   endif
022320151015     c                   eval      $fine='0'
022330151015    4c                   Dow       $fine='0'
022340151015     c                   clear                   w02tes
022350151015     c                   clear                   w02tes1
022360151015     c                   clear                   w02Rig2
022370151015     c                   Eval      w02rig1 = Rigw(11)
022380151015     c                   Eval      w02Rig3 = Rigw(12)
022390151015     c                   Eval      w02Rig4 = Rigw(13)
022400161129     c                   if        *in12 and not *in15
022410161129     C                   write     LS01W02
022420161129     C                   read(E)   fnls01d
022430161129     c                   else
022440151015     c                   Exfmt     ls01w02
022450161129     c                   endif
022460161129
022470161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
022480161129     c                   if        %error
022490161129     C                   MOVEL     '6'           §LPFPR
022500161129     c                   goto      fine
022510161129     c                   endif
022520161129     c
022530151015     c                   If        *InKl = *On
022540151015     c                   eval      $fine='1'
022550151015     c                   eval      *inkl=*off
022560151015     c                   EndIf
022570151015    4c                   EndDo
022580151015   x3c                   else
022590151015     c                   goto      fine
022600151015    3c                   endif
022610151015    2c                   endif
022620151015     c                   endif
022630151015      *
022640060113      * Prima di procedere con la seconda videata devo emettere una finestra
022650060113      * se spedizione in porto assegnato con destinatario con obbligo ddt in
022660060113      * fase di consegna (DDT=SI)
022670060113    2c                   If        Vidbam = 'S' and §dstddt = 'S' and
022680060113     c                             §3arbl <> 'R' and §1bf16 <> 'S' and
022690060113     c                             flgtb1 = 'A'
022700060113     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
022710060113     c* se devo emettere la window o ritornare al chiamante con errore
022720091111     c                   move      '1'           wvidobb           1
022730060113     c                   exsr      escier
022740091111     c                   move      ' '           wvidobb
022750060113    3c     §lpfpr        ifne      '5'
022760161129    3c     §lpfpr        andne     '6'
022770060113     c     §lpfpr        ifne      'V'
022780060113     c                   write     ls01d01
022790060113     c                   endif
022800091112     c                   eval      $fine='0'
022810091112    4c                   Dow       $fine='0'
022820060113     c                   clear                   w02tes
022830060113     c                   Eval      w02Tes1 = Rigw(9)
022840060113     c                   Eval      w02Rig2 = Rigw(10)
022850060113     c                   clear                   w02Rig1
022860060113     c                   clear                   w02Rig3
022870060113     c                   clear                   w02Rig4
022880161129
022890161129     c                   if        *in12 and not *in15
022900161129     C                   write     LS01W02
022910161129     C                   read(E)   fnls01d
022920161129     c                   else
022930060113     c                   Exfmt     ls01w02
022940161129     c                   endif
022950161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
022960161129     c                   if        %error
022970161129     C                   MOVEL     '6'           §LPFPR
022980161129     c                   goto      fine
022990161129     c                   endif
023000161129
023010060113     c                   If        *InKl = *On
023020091112     c                   eval      $fine='1'
023030110309     c                   eval      *inkl=*off
023040060113     c                   EndIf
023050060113    4c                   EndDo
023060060113   x3c                   else
023070060113     c                   goto      fine
023080060113    3c                   endif
023090060113    2c                   EndIf
023100090323     c
023110090323     c* tasto funzionale f15=cli/tar per tassazione porto assegnato
023120090323     c* Se la bolla non è in porto assegnato non è da visualizzare
023130090323     c                   if        flgtb1<>'A'
023140090323     c                   eval      atrf15=nodi
023150090323     c                   else
023160090323     c                   clear                   atrf15
023170090323     c                   endif
023180060113     c*
023190060113     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
023200060113     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
023210060113     C   12
023220060113    2CAN 15§LPFPR        IFNE      'V'
023230060113     C                   GOTO      TAG02
023240060113    2C                   END
023241170831     C   12
023242170831    2CANN15§LPFPR        IFeq      'N'
023243170831     C                   GOTO      TAG02
023244170831    2C                   END
023250941020     C*
023260941020     C* SE TUTTO OK EMETTO FORMATO2
023270941020     C     FOR02         TAG
023280940825     C* V I D E O   2
023290161129     c                   if        *in12 and not *in15
023300161129     C                   write     LS01D02
023310161129     C                   read(E)   fnls01d
023320161129     c                   else
023330940819     C                   EXFMT     LS01D02
023340161129     c                   endif
023350161201
023360161201     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
023370161201     c                   if        %error
023380161201     C                   MOVEL     '6'           §LPFPR
023390161201     c                   goto      fine
023400161201     c                   endif
023410941003     C*
023420900926     C     TAG02         TAG
023430950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
023440950126     C                   EXSR      OFFD02
023450161129
023460900926     C*
023470000905     C* CMD12 - RITORNO VIDEATA PRECEDENTE
023480000905     C     *INKL         IFEQ      *ON
023490000914     C* PER DISK C MANUTENZIONE RITORNO ALLA PRIMA VIDIEATA
023500000914     C* (IN QUESTO CASO INFATTI LA VIDEATA DI MANUTENZIONE COD CHI SONO
023510000914     C* DEVE ESSERE RICHIESTA CON F22 IN PRIMA VIDEATA)
023520160226
023530160226     c* Disk C da inserire in immissione/conferma no DPD
023540160226     c                   if        (§1bf12='S' and
023550160226     c                              Wexdpd<>'S' and
023560160226     c                              *in79 = *off and
023570160226     c                              (*in12 = *off or *in15))
023580160226     c                              OR
023590160226     c* Disk C da inserire in immissione/conferma Export DPD e numero parcel
023600160226     c* calcolato in automatico - (se bolla EEX da forzare in DPD WEXDPD non è
023610160226     c* a "S" - va bene così: in questo caso il chi sono non sarà mail numero
023620160226     c* parcel dpd e devo quindi trattarlo come una bolla non dpd)
023630160226     c                             (§1bf12='S' and
023640160226     c                              wexdpd='S' and
023650160226     c                              §1bf13='A' and
023660160226     c                              (*in12 = *off or *in15))
023670001009     C*
023680000905     C                   GOTO      FOR09
023690000905     C                   ELSE
023700000905     C                   GOTO      FOR01
023710000905     C                   ENDIF
023720000905     C                   ENDIF
023730010215     C* PRIMA DI FARE I CONTROLLI DELLA VIDEATA, SE ATTIATA PROC.ORM,
023740010215     C* E ORM NON FITTIZIO, PROPONGO EVENTUALI CAMPI SE A VIDEO SONO
023750010215     C* VUOTI
023760010215     C     WORM          IFEQ      'S'
023770010215     C     FLGFIT        ANDNE     'S'
023780010215     C     PARTCH        ANDNE     'P'
023790010215     C     *IN12         IFEQ      *OFF
023800010226     C     *IN15         OREQ      *OFF
023810010215     C                   EXSR      PRPOR2
023820010215     c* Se ho proposto dei campi non continuo i controlli ma devo
023830010215     c* riemettere videata per visualizzare i dati aggiunti
023840010215     C     WEFORM        IFEQ      '1'
023850010215     C                   GOTO      FOR02
023860010215     C                   ENDIF
023870010215     C                   ENDIF
023880091008     c****               if        *in79 and flgtb1='A'
023890091008     c                   if        flgtb1='A'  and (§ogntw='DPD' or
023900091008     c                             §ogntw='FED' or §ogntw='EEX')
023910070427     c                   exsr      prpor2_rmo
023920070427     C     weform        ifeq      '1'
023930070427     C                   goto      for02
023940070427     C                   endif
023950150414     c                   endif
023960010215     C                   ENDIF
023970040226
023980040226      * F11 - Calcolo volume
023990040226     c                   If        *Inkk = *On
024000040226     c                   Clear                   p26vol
024010040226     c                   Call      'TRUL36R'
024020040226     c                   Parm                    p26vol
024030040226     c                   Add       p26vol        VidVol
024040040226      * imposto wemfor per riemettere la videata
024050040301     c                   Eval      wkk = *On
024060040226     c                   EndIf
024070040226
024080900427     C* CONTROLLI
024090940825     C                   EXSR      CTRD02
024100040301
024110040301      * Se ho richiamato il calcolo del volume riemetto la videata
024120040301      * in modo da far vedere il volume calcolato in automatico
024130040301     c                   If        wkk = *On
024140040301     c                   Eval      wemfor = '1'
024150040301     c                   EndIf
024160940826     C* RIEMETTO FORMATO
024170950127     C     WEMFOR        IFEQ      '1'
024180950127     C                   EXSR      ESCIER
024190950127     C     §LPFPR        IFNE      '5'
024200161129     C     §LPFPR        andne     '6'
024210950127     C                   GOTO      FOR02
024220950127     C                   ELSE
024230950127     C                   GOTO      FINE
024240950127     C                   ENDIF
024250950127     C                   ENDIF
024260010215     C* RICHIAMO ROUTINE DI CONTROLLO INCONGRUENZA COD.TARIFFA CON
024270010306     C* O.R.M.
024280010215     C     WORM          IFEQ      'S'
024290010215     C     FLGFIT        ANDNE     'S'
024300010215     C     PARTCH        ANDNE     'P'
024310010215     C     *IN12         IFEQ      *OFF
024320010301     C     *IN15         OREQ      *OFF
024330010215     C                   EXSR      CNFOR2
024340010215     C* RIEMETTO FORMATO
024350010215     C     WEMFOR        IFEQ      '1'
024360010215     C                   EXSR      ESCIER
024370010215     C     §LPFPR        IFNE      '5'
024380161129     C     §LPFPR        andne     '6'
024390010215     C                   GOTO      FOR02
024400010215     C                   ELSE
024410010215     C                   GOTO      FINE
024420010215     C                   ENDIF
024430010215     C                   ENDIF
024440010215     C                   ENDIF
024450010215     C                   ENDIF
024460090323     c***
024470090323     C* F15=Cli/tariffa per tassazione porti assegnati
024480090323     c***
024490090323     c* emetto window solo se tasto di funzione è abilitato
024500090326     c                   if        *inkp='1'
024510090326     c                   if        atrf15=*blanks
024520090323     c                   exsr      geswdw_clitar
024530161202     c
024540161202     c                   if        §lpfpr='6'
024550161202     c                   goto      fine
024560161202     c                   endif
024570161202     c
024580090326     c                   else
024590090326     c                   movel     err(322)      vidmsg
024600090326     c                   seton                                        90
024610090326     c                   endif
024620090323     c                   goto      for02
024630090326     c                   endif
024640941115     C***
024650941115     C* CMD8 - RISTAMPA BOLLA
024660941115     C***
024670000627     C* NON POSSO FARE RISTAMPA SE SONO SOLO NEI CONTROLLI
024680000627     C     §LPFLG        IFEQ      'C'
024690000627     C     *INKH         ANDEQ     *ON
024700000627     C                   MOVEL     ERR(203)      VIDMSG
024710000627     C                   SETON                                        90
024720000627     C                   GOTO      FOR02
024730000627     C                   ENDIF
024740000627     C**
024750970128     C* POSSO RISTAMPARE SOLTANTO SE ALLEGA BAM E' S
024760970128     C*  O NO MA LA BOLLA E' GIA' STATA STAMPATA
024770000112     C  N22*INKH         IFEQ      *ON
024780970128     C     VIDBAM        IFEQ      'N'
024790970128     C     BLPFST        IFEQ      'N'
024800970128     C     BLPFST        OREQ      'S'
024810970128     C* ERRORE
024820000627     C                   MOVEL     ERR(137)      VIDMSG
024830970128     C                   SETON                                        90
024840970128     C                   GOTO      FOR02
024850970128     C                   ENDIF
024860970128     C                   ENDIF
024870970128     C*
024880970128     C                   MOVEL     '1'           CMD8              1
024890970128     C                   ENDIF
024900091111
024910091111     c*** Gestione window per scelta Beneficiario Contrassegno
024920091124     c*** per spedizione con contrassegno legata ad orm che paga ordinante
024930091124     C*** (spedizione in assegnato con triangolazione)
024940091123     c                   clear                   wwdwcas           1
024950091211     c                   if        nochkticC=*on
024960091111     c                   eval      wvidobb='1'
024970091111     c                   exsr      escier
024980091111     c                   eval      wvidobb=' '
024990091111    2c                   if        §lpfpr<>'5'
025000091111    3c                   if        *in12 and *in15 and §lpfpr<>'V'
025010091111     c                   write     ls01d02
025020091111    3c                   endif
025030091111     c                   exsr      geswdw_cas
025040091123     c                   eval      wwdwcas='S'
025050091111     c   kl              goto      for02
025060091111   x2c                   else
025070091111     c                   goto      fine
025080091111    2c                   endif
025090091119     c                   endif
025100940920     C***
025110990610     C* F9  - ESTENSIONE BOLLA
025120940920     C***       VISUALIZZA LA 2 BOLLA SE ESISTE E LA TASSAZIONE
025130940923     C* SE TASSAZIONE CON TARIFFA MITTENTE CI VADO OBBLIGATORIAMENTE
025140940923     C* SE INSERITO ALMENO UN CAMPO E POI CMD12 CI RITORNO OBBLIGATOR
025150940826    2C     *INKI         IFEQ      *ON
025160940923     C     SAVFTM        ORNE      ' '
025170950125     C     *IN04         ANDEQ     *ON
025180940923     C     VIDFTM        ORNE      ' '
025190950125     C     *IN04         ANDEQ     *ON
025200961111     C* SE FRANCO FRONTIERA DEVO OBBLIGATORIAMENTE INDICARE IL PORTO
025210961111     C     VIDFBR        OREQ      'F'
025220940923     C     WEMD03        ORNE      ' '
025230990610     C* SE PREPAGATO CI VADO OBBLIGATORIAMENTE
025240990610     C     PARTCH        OREQ      'P'
025250010305     C     §LPFPR        OREQ      'O'
025260000112     C     *IN22         OREQ      *ON
025270940826     C                   EXSR      GESD03
025280940826     C   KL              GOTO      FOR02
025290941020     C*
025300950419     C* SE E' ERRORE E PGM DA DISK CLIENTI CHIAMATO CON "W" --> ESCO
025310950127     C     §LPFPR        IFEQ      '5'
025320161202     C     §LPFPR        oreq      '6'
025330950127     C                   GOTO      FINE
025340950127     C                   ENDIF
025350940923     C*
025360940923   X2C                   ELSE
025370940923     C*
025380101104     C* SE CONTO SERVIZIO IMMISSIONE PER F6   o F8
025390101104     c                   if        not *inkf and not *inkh
025400101104    3C     WFPR          IFNE      'I'
025410940923     C     §3ARBL        ANDEQ     'C'
025420950407     C*
025430950407     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
025440950410    4C     VIDLNP        IFNE      102
025450950407     C     *IN12         OREQ      *OFF
025460950407     C     *IN15         OREQ      *OFF
025461170904     c     §lpfpr        andne     'N'
025470940923     C                   MOVEL     ERR(40)       VIDMSG
025480940923     C                   SETON                                        90
025490940923     C                   GOTO      FOR02
025500950410    4C                   ENDIF
025510950410    3C                   ENDIF
025520101104     c                   endif
025530960318     C**
025540960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
025550960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
025560960805     C* NON LO FACCIO PER LE SPEDIZIONI DI RECUPERO
025570960805     C  NKF§3ARBL        IFNE      'R'
025580030704     c     wforw03       andeq     *Blanks
025581170904     c     §lpfpr        andne     'N'
025590121003     C                   EXSR      CTRCRG
025600161202     c
025610161202     c                   if        §lpfpr='6'
025620161202     c                   goto      fine
025630161202     c                   endif
025640161202     c
025650121003     c   41              GoTo      For02
025660960805     C                   ENDIF
025670940923     C*
025680940923    2C                   ENDIF
025690940920     C***
025700900608     C* CMD8 - RISTAMPA BOLLA
025710940920     C***
025720970128     C     *INKH         IFEQ      *ON
025730970128     C     VIDBAM        IFEQ      'N'
025740970128     C     BLPFST        IFEQ      'N'
025750970128     C     BLPFST        OREQ      'N'
025760970128     C* ERRORE
025770970128     C                   MOVEL     ERR(137)      VIDMSG
025780970128     C                   SETON                                        90
025790970128     C                   GOTO      FOR02
025800970128     C                   ENDIF
025810970128     C                   ENDIF
025820970128     C*
025830970128     C                   MOVEL     '1'           CMD8              1
025840970128     C                   ENDIF
025850940920     C***
025860930930     C* SE VARIATA LIN.ARRIVO O DATA SPEDIZIONE DI UNA BOLLA BORDERIZZ.
025870930930     C* EMETTO IL MESSAGGIO E LA SBORDERIZZO (SONO ESCLUSI I RECUPERI)
025880161202     c* ES 02/12/16 - visto che ora borderizziamo alla chiusura FGV
025890161202     c*               lascio per sicurezza le specifiche di pulizia dei
025900161202     c*               campi di borderizzazione ma toglo l'emissione della vid
025910940214     C   12
025920940214    2CANN15§1BFG4        IFEQ      'S'
025930940920     C     BLPDBR        ANDGT     0
025940940920     C*
025950940920    3C     COMLNA        IFNE      BLPLNA
025960940920     C     BLPDSP        ORGT      BLPDBR
025970930331     C* DECODIFICA LNA
025980930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
025990940928     C  N30              MOVEL     ORGDES        V1DLNA
026000930331     C*
026010161202     C***                write     LS01D05
026020161202     C***                exfmt     fnls01d
026030161129     C*
026040940920     C                   CLEAR                   BLPNFV
026050940920     C                   CLEAR                   BLPDBR
026060940920     C                   CLEAR                   BLPFLP
026070950126     C* MEMORIZZO CHE HO SBORDERIZZATO LA BOLLA PER CANCELLARE ANCHE
026080950126     C* SUL DETTAGLIO COLLI IL NUMERO DI FOGLIO VIAGGIO
026090950126     C                   MOVEL     'S'           WSBORD            1
026100940920    3C                   ENDIF
026110940920    2C                   ENDIF
026120940920     C***
026130000627     C* SE SOLO CONTROLLI AGGIORNO LA DBLP CHE RESTITUISCO AL CHIAMANTE
026140940920     C***
026150000627     C     §LPFLG        IFEQ      'C'
026160000627     C                   EXSR      AGDBLP
026170000627     C                   ELSE
026180000627     C***
026190000627     C* REGISTRO BOLLA E STAMPO
026200000627     C***
026210900504     C                   EXSR      REGIS
026220000627     C                   ENDIF
026230000313     C*
026240000313     C* SE PGM RICHIAMATO PASSO INDIETRO IL FLAG DDT, CHE SERVE
026250000313     C* QUANDO SONO RICHIAMATO DA GIACENZE PER POI DECIDERE SE RISTAMPA
026260000313     C*  RE O MENO LA BOLLA
026270000627     C   12
026280000627     CAN 15§LPFLG        IFNE      'C'
026290000627     C                   MOVEL     VIDBAM        §LPBAM
026300000627     C                   ENDIF
026310950127     C* RIEMETTO FORMATO
026320950127     C     WEMFOR        IFEQ      '1'
026330950127     C                   EXSR      ESCIER
026340950127     C     §LPFPR        IFNE      '5'
026350950127     C                   GOTO      FOR02
026360950127     C                   ELSE
026370950127     C                   GOTO      FINE
026380950127     C                   ENDIF
026390950127     C                   ENDIF
026400900504     C*
026410900508     C* PULISCO CAMPI FOR01 E FOR02
026420940214    2C     *IN12         IFEQ      *OFF
026430010307     C     §LPFPR        ANDNE     'O'
026440940819     C                   EXSR      INZ01
026450940819     C                   EXSR      INZ02
026460941011     C                   EXSR      INZ03
026470971210     C                   EXSR      INZ06
026480991203     C                   EXSR      INZ07
026490000911     C                   EXSR      INZ08
026500040908     c* se personalizzato n. orm prima di riemettere la videata di
026510040908     c* bollettazione devo effettuare i controlli per poporre eventuali
026520040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
026530040908     c* porti allo stesso modo di quando dalla prima videata viene
026540040908     c* immesso il numero orm con la pistola (enter automatico)
026550041217     c* Non lo faccio se ORM fittizio in quanto non c'è nulla da proporre
026560041220     c                   if        *in37 = *on
026570041220     c                   if        flgfit <> 'S'
026580050119     c                   eval      wsolo_prp = '1'
026590041217     c                   exsr      ctrd01
026600041220     c                   else
026610041220     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
026620041220     c* (per uniformità: fa così anche per orm reale)
026630041220     c                   z-add     13            h1riga
026640041220     c                   z-add     20            h1colo
026650041220     c                   endif
026660041217     c                   endif
026670930628     C                   GOTO      FOR01
026680940214    2C                   END
026690930628     C*
026700000000     C     FINE          TAG
026710940214     C*
026720930628     C  N12              SETON                                        LR
026730060308     c* Chiudo con LR pgm gestione motivazione variazione ad ogni bolla per
026740060308     c* pulire la videata
026750060308     c                   clear                   fnlv85ds
026760060308     c                   eval      ilv85tla = 'C'
026770060308     c                   movel     fnlv85ds      kpjbu
026780060308     c                   call      'FNLV85R'
026790060308     c                   parm                    kpjba
026800060222     c*
026810150929     c                   if        not *inlr
026820150929     C* DISALLOCAZIONE FILES
026830150929      *
026840150929     C                   UNLOCK    FNBLP00F
026850150929     C                   UNLOCK    Fiar901L
026860150929     C                   UNLOCK    FIAR601L
026870150929     C                   UNLOCK    FIAR701L
026880150929     C                   UNLOCK    Fiar401L
026890150929     C                   UNLOCK    FNBLT01L
026900150929     C                   UNLOCK    FIARS01L
026910150929     C                   UNLOCK    FIART01L
026920150929     c                   endif
026930130419     c  nlr              return
026940940214    1C                   ENDIF
026950940214     C* CHIUDO FILES
026960941108     C     *INLR         IFEQ      *ON
026970941108     C*
026980941108     C     WCL98         IFEQ      '1'
026990940214     C                   MOVEL     'C'           D98TLA
027000970925     C                   CALL      'TNSD99R'
027010970925     C                   PARM                    DSSD99
027020940214    1C                   ENDIF
027030970722     C**
027040991102     C                   CLEAR                   DSBS02
027050991102     C                   MOVEL     'C'           T02TLA
027060991102     C                   CALL      'TIBS02R'
027070991102     C                   PARM                    KPJBA
027080991102     C                   PARM                    DSBS02
027090991102     C**
027100970722     C                   MOVEL     'C'           I13TLA
027110970722     C                   CALL      'FNLV13R'
027120970722     C                   PARM                    KPJBA
027130970722     C                   PARM                    DSLV13
027140970722     C                   PARM                    DSSI95
027150061109     C**
027160061109     C                   MOVEL     'C'           ISIE3TLA
027170061109     C                   CALL      'TISIE3R'
027180061109     C                   PARM                    TISIE3DS
027190061109     c
027200151106     C                   MOVEL     'C'           XCFIVA1ds
027210151106     C                   CALL      'XCFIVAR1'
027220151106     C                   PARM                    XCFIVA1ds
027230991130     C**
027240060619    2C     WEU12         IFEQ      'S'
027250060619     C                   MOVEL     'C'           i12TLA
027260060619     C                   CALL      'FIEU12R'
027270991130     C                   PARM                    KPJBA
027280060619     C                   PARM                    fieu12ds
027290991130    3C                   ENDIF
027300011212     C*
027310011212     C                   CLEAR                   DSUL21
027320011212     C                   MOVEL     'C'           I21TLA
027330011212     C                   CALL      'TRUL21R'
027340011212     C                   PARM                    DSUL21
027350011212     C*
027360011212     C                   CLEAR                   DSUL22
027370011212     C                   MOVEL     'C'           I22TLS
027380011212     C                   CALL      'TRUL22R'
027390011212     C                   PARM                    DSUL22
027400011212     C*
027410011212     C                   CLEAR                   DSUL23
027420011212     C                   MOVEL     'C'           I23TLA
027430011212     C                   CALL      'TRUL23R'
027440011212     C                   PARM                    DSUL23
027450941108     C*
027460941108    2C     *IN12         IFEQ      *OFF
027470941108     C     *IN15         OREQ      *ON
027480941108     C*
027490941108    3C     I100          IFEQ      1
027500941108     C                   MOVEL     '*'           DB0GES
027510941108    3C                   ENDIF
027520941108    2C                   ENDIF
027530941108     C*
027540160630     c                   if        savfpr<>'D'
027550941108     C                   MOVEL     'C'           DB0TLA
027560030611     C                   CALL      WD90PSL
027570030626     C                   PARM                    fnlsb5DS
027580160630     c                   endif
027590970925     C*
027600970925     C                   CLEAR                   DSLV55
027610970925     C                   MOVEL     'C'           D55TLA
027620970925     C                   CALL      'FNLV55R'
027630970925     C                   PARM                    DSLV55
027640000918     C*
027650000918     C                   CLEAR                   DSLSZ1
027660000918     C                   MOVEL     'C'           IZ1TLA
027670000918     C                   CALL      'FNLSZ1R'
027680010402     C                   PARM                    KPJBA
027690000918     C                   PARM                    DSLSZ1
027700000918     C                   PARM                    DS1B
027710020213     c*
027720160219     C                   CLEAR                   trul27ds1
027730020213     C                   MOVEL     'C'           I27TLA
027740160219     C                   CALL      'TRUL27R1'
027750160219     C                   PARM                    TRUL27DS1
027760020218     c*
027770160219     C                   CLEAR                   trulc7ds
027780160219     C                   MOVEL     'C'           Ic7TLA
027790160219     C                   CALL      'TRULC7R'
027800160219     C                   PARM                    TRULc7DS
027810160219
027820020218     c                   movel     'C'           tastla
027830020218     C                   CALL      'TNSF20R'
027840020218     C                   PARM                    KPJBA
027850020218     C                   PARM                    DTAS
027860020218     C                   PARM                    DTASV
027870020320     c*
027880020320     c                   clear                   trul33ds
027890020320     c                   movel     'C'           i33tla
027900020320     c                   movel     trul33ds      kpjbu
027910020320     C                   CALL      'TRUL33R'
027920020320     C                   PARM                    KPJBA
027930020531     c*
027940020531     c                   clear                   tisit0ds
027950071010     c                   clear                   tisit0x1ds
027960020531     c                   movel     'C'           it0tla
027970020531     C                   CALL      'TISIT5R'
027980020531     C                   PARM                    tisit0ds
027990071010     C                   PARM                    tisit0x1ds
028000031217
028010091006     c                   Clear                   Fnls28ds
028020091006     c                   Eval      I28Tla = 'C'
028030091006     c                   Call      'FNLS28R'
028040091006     c                   Parm                    kpjba
028050091006     c                   Parm                    Fnls28ds
028060040227
028070040227     c                   Clear                   Fnls26ds
028080040227     c                   Eval      I26Tla = 'C'
028090040227     c                   Call      'FNLS26R'
028100040227     c                   Parm                    Fnls26ds
028110061107     c*
028120061107     c                   Eval      Ideptla = 'C'
028130061107     c                   call      'TRULDEPR'
028140061107     c                   parm                    truldepds
028150061127     c* Richiamo il *pgm d utilità FIDN12R in modalità "solo chiusura"
028160061127     c                   clear                   fidn12ds
028170061127     c                   eval      dn_i12tla = 'C'
028180061127     c                   call      'FIDN12R'
028190061127     c                   parm                    fidn12ds
028200081111
028210081111     C                   MOVEL     'C'           SA2TLA
028220081111     C                   CALL      'FNLSA2R3'
028230081111     C                   PARM                    SA2TLA
028240081111     C                   PARM                    SA2TRC
028250081111     C                   PARM                    SA2DTS
028260081111     C                   PARM                    WWLNA             3 0
028270090626     c*
028280090626     c                   clear                   trulticds
028290090626     c                   eval      itictla='C'
028300090626     c                   call      'TRULTICR'
028310090626     c                   parm                    TRULTICDS
028320090626     c                   parm                    ds1a
028330120615     c*
028340120615     c                   clear                   trulflbds
028350120615     c                   eval      iflbtla='C'
028360120615     c                   call      'TRULFLBR'
028370120615     c                   parm                    TRULFLBDS
028380061107     c*
028390040329      * Chiudo Titas30c
028400040329     c                   If        %Open(Titas30c)
028410040329     c                   Close     Titas30c
028420040329     c                   EndIf
028430151014      * Chiudo fiar531c
028440151014     c                   If        %Open(fiar531c)
028450151014     c                   Close     fiar531c
028460151014     c                   EndIf
028470160613      * Chiudo FNLS01D
028480160613     c                   If        %Open(fnls01d)
028490160613     c                   Close     fnls01d
028500160613     c                   EndIf
028510150302
028520150302     c                   clear                   tisigads
028530150302     c                   movel     'C'           igatla
028540150302     c                   movel     tisigads      kpjbu
028550150302     C                   CALL      'TISIGAR'
028560150302     C                   PARM                    KPJBA
028570150701
028580150701     c                   clear                   fnlssgnds
028590150701     c                   movel     'C'           isgntla
028600150701     C                   CALL      'FNLSSGNR1'
028610150701     C                   PARM                    fnlssgnds
028620160226
028630160226     c                   clear                   fnlvdpds
028640160226     c                   movel     'C'           idptla
028650160226     c                   movel     fnlvdpds      kpjbu
028660160226     C                   CALL      'FNLVDPR'
028670160226     C                   PARM                    kpjba
028680161220
028690161220     c                   if        *in12 and *in15
028700161220     c                   clear                   fnlv84ds
028710161220     c                   movel     'C'           ilv84tla
028720161220     C                   CALL      'FNLV84R'
028730161220     C                   PARM                    fnlv84ds
028740161220     c                   endif
028750160120
028760160711     C                   IF        *in12 and not *in15 and (at0fva=*blanks or
028770160126     c                             at0fra=*blanks)
028780160120     C                   MOVEL     'C'           PA1FLG
028790160120     C                   MOVEL     PARAM1        KPJBU
028800160120     C                   CALL      'FNLR75R'                            99
028810160120     C                   PARM                    KPJBA
028820160120     c                   endif
028830941108     C*
028840941108    1C                   ENDIF
028850991008      *----------------------------------------------------------------
028860991008      *--  OPERAZIONI INIZIALI   -------------------------------------*
028870991008      *----------------------------------------------------------------
028880940819     C     *INZSR        BEGSR
028890011114     C* N.B.: QUANDO NON SI VORRÀ PIÙ STAMPARE BLANK+55L+CAP DESTINO:
028900011114     C*       ASTERISCARE    "MOVE *BLANKS   WNO55L"
028910011114     C*       DISASTERISCARE "MOVE '1'       WNO55L"
028920020725     C***                MOVE      *BLANKS       WNO55L            1
028930011126     C                   MOVE      '1'           WNO55L            1
028940030610      * MEMORIZZO STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO
028950950118     C                   MOVEL     KPJBU         PARAM3
028960030610      *
028970030610      * SE RICEVO TRUL90DS TENGO BUONO I PGM DELLA DS, in caso contrario
028980030610      *  quello della KPJBU + FNLSB0R
028990030610      * ....... modifica da togliere dopo aver eliminato TRUL01R
029000160613     C***                IF        %PARMS < 4
029010160613     C***                movel(P)  Wpgmss        WD90PSS
029020160613     C***                movel(P)  'FNLSB0R'     WD90PSL
029030160613     C***                ELSE
029040030611     C                   movel(P)  D90PSS        WD90PSS
029050030611     C                   movel(P)  D90PSL        WD90PSL
029060160613     c***                ENDIF
029070030610      *
029080011107     C     WNO55L        IFEQ      *BLANKS
029090011107     C                   MOVEL     ' 55L'        W55L
029100011107     C                   ELSE
029110011107     C                   CLEAR                   W55L
029120011107     C                   ENDIF
029130040329
029140040329      * Se sono in ambiente buono - GAITRAGRU
029150040329     c                   If        knsif = 'FILTRA201 '
029160040329     c                   Eval      wlib = 'GAITRAGRU '
029170040329      *  Se sono in ambiente di prova - GAITRAGRPS
029180040329     c                   Else
029190040329     c                   Eval      wlib = 'GAITRAGRPS'
029200040329     c                   EndIf
029210940819     C***
029220940819     C* KLIST
029230940819     C***
029240940819     C* ACCESSO   CNACO
029250940819     C     KACO          KLIST
029260940819     C                   KFLD                    CODUT
029270940819     C                   KFLD                    CCC
029280940909     C                   KFLD                    WKSC
029290990630     C     KNUM          KLIST
029300990630     C                   KFLD                    DATAAS            2 0
029310990630     C                   KFLD                    RGS               1 0
029320990630     C                   KFLD                    FIV               3 0
029330990630     C**
029340990630     C                   Z-ADD     2             RGS
029350990630     C**
029360950920     C* ACCESSO   AZCLN
029370950920     C     KCLN          KLIST
029380950920     C                   KFLD                    SIMFEL
029390950920     C                   KFLD                    W0030
029400950920     C                   KFLD                    WAA               4 0
029410950920     C                   KFLD                    WMM               2 0
029420101022     C     KCLNA         KLIST
029430101022     C                   KFLD                    w0030
029440101022     C                   KFLD                    comlna
029450101022     C                   KFLD                    WAA               4 0
029460101022     C                   KFLD                    WMM               2 0
029470940819     C* ACCESSO   TFTAM SENZA PROGRESSIVO
029480940819     C     KTAM2         KLIST
029490940909     C                   KFLD                    WKSC
029500940819     C                   KFLD                    COMCTR            3 0
029510940819     C                   KFLD                    COMPRG            3 0
029520940819     C* ACCESSO   TFTPT SENZA PROGRESSIVO
029530940819     C     KTPT          KLIST
029540940909     C                   KFLD                    WKSC
029550940819     C                   KFLD                    COMCTR            3 0
029560940819     C                   KFLD                    COMPRG            3 0
029570990818     C                   KFLD                    FTC               2
029580940819     C* ACCESSO   TFTAM TARIFFA DI CARTELLO
029590020208     c*
029600160216     C***  KCAR2         KLIST
029610160216     C**+                KFLD                    TARKSC
029620160216     C***                KFLD                    TARCTR            3 0
029630160216     C****               KFLD                    TARPRG            3 0
029640160216     C     KCAR2         KLIST
029650160216     C                   KFLD                    OC7KSCC
029660160216     C                   KFLD                    OC7CTRC
029670160219     C                   KFLD                    OC7PRGC_
029680940819     C* ACCESSO   TABEL
029690940819     C     KTAB2         KLIST
029700940819     C                   KFLD                    CODUT
029710940819     C                   KFLD                    COD               2
029720940819     C                   KFLD                    KEY               8
029730940819     C* ACCESSO   TABEL
029740940819     C     KTAB3         KLIST
029750940819     C                   KFLD                    CODUT
029760940819     C                   KFLD                    COD               2
029770170214     C*    KTBE          KLIST
029780170214     C*                  KFLD                    KTCOD
029790170214     C*                  KFLD                    KTLIN
029800170214     C*                  KFLD                    KTSIF
029810170214     C*                  KFLD                    KTKE1
029820170214     C*                  KFLD                    KTKE2
029830070612     C* ACCESSO   EDTAB
029840070612     C     KEDTAB        KLIST
029850070612     C                   KFLD                    Kedcod
029860070612     C                   KFLD                    kedkey
029870940819     C* ACCESSO   FILE DISCHETTO CLIENTI
029880940819     C     KBLC          KLIST
029890020917     C                   KFLD                    §FGS
029900020917     C                   KFLD                    §LPCCM
029910970407     C                   KFLD                    §LPAAC
029920940819     C                   KFLD                    §LPLNP
029930940819     C                   KFLD                    §LPNRS
029940940819     C                   KFLD                    §LPNSP
029950970107     C     KBLC4         KLIST
029960970407     C                   KFLD                    §LPAAC
029970970107     C                   KFLD                    §LPLNP
029980970107     C                   KFLD                    §LPNRS
029990970107     C                   KFLD                    §LPNSP
030000940819     C* ACCESSO   FILE BOLLE VISTA LOGICA 1
030010940819     C     KBLP3         KLIST
030020940819     C                   KFLD                    §LPAAS
030030940819     C                   KFLD                    §LPLNP
030040940819     C                   KFLD                    §LPNRS
030050940819     C                   KFLD                    §LPNSP
030060051124     C**   KBLP33        KLIST
030070051124     C**                 KFLD                    §LPAAS
030080051124     C**                 KFLD                    §LPLNP
030090051124     C**                 KFLD                    §LPNRS
030100051124     C**                 KFLD                    §LPNSP
030110051124     C**                 KFLD                    bltnsc
030111170918     C     Kpnd          KLIST
030112170918     C                   KFLD                    §LPAAS
030113170918     C                   KFLD                    §LPLNP
030114170918     C                   KFLD                    §LPNRS
030115170918     C                   KFLD                    §LPNSP
030120940926     C     KBLP4         KLIST
030130940926     C                   KFLD                    §LPAAS
030140940926     C                   KFLD                    §LPLNP
030150940926     C                   KFLD                    §LPNRS
030160940926     C                   KFLD                    §LPNSP
030170940926     C                   KFLD                    WTRC
030180041013     C     KBLP4M        KLIST
030190060215     c                   kfld                    ar4aas
030200060215     c                   kfld                    ar4lnp
030210060215     c                   kfld                    ar4nrs
030220060215     c                   kfld                    ar4nsp
030230001212     C* Usata per controllo segnacolli doppi bolle poste
030240120817     C***  KBLP1         KLIST
030250120817     C***                KFLD                    BLTAAS
030260120817     C***                KFLD                    BLTLNP
030270120817     C***                KFLD                    BLTNRS
030280120817     C***                KFLD                    BLTNSP
030290120814     C     Kfiart        KLIST
030300120814     C                   KFLD                    BLTAAS
030310120814     C                   KFLD                    BLTLNP
030320120814     C                   KFLD                    BLTNRS
030330120814     C                   KFLD                    BLTNSP
030340120814     C                   KFLD                    BLTNSC
030350120817     C***  KBLP4P        KLIST
030360120817     C***                KFLD                    BLTAAS
030370120817     C***                KFLD                    BLTLNP
030380120817     C***                KFLD                    BLTNRS
030390120817     C***                KFLD                    BLTNSP
030400120817     C***                KFLD                    WTRC
030410940819     C* KEY PER SEGNACOLLI DOPPI IN FLBLT
030420940819     C     KBLT          KLIST
030430940916     C                   KFLD                    WFLS
030440940819     C                   KFLD                    COMLNA
030450940819     C                   KFLD                    VIDNRS
030460940819     C                   KFLD                    COMSCD
030470120816     C***  KBLT29        KLIST
030480120816     C***                KFLD                    WFLS
030490120816     C***                KFLD                    VIDNRS
030500120816     C***                KFLD                    COMSCD
030510980320     C     KBLT1         KLIST
030520980320     C                   KFLD                    BLPAAS
030530980320     C                   KFLD                    BLPLNP
030540980320     C                   KFLD                    BLPNRS
030550980320     C                   KFLD                    BLPNSP
030560080103     C     KBRV          KLIST
030570960404     C                   KFLD                    KNPG
030580960404     C                   KFLD                    BLTFLS
030590960404     C                   KFLD                    BLTLNA
030600960404     C                   KFLD                    BLTNRS
030610960404     C                   KFLD                    BLTNSC
030620960404     C                   KFLD                    KFLE
030630120817     C     KBRVA         KLIST
030640120817     C                   KFLD                    KNPG
030650120817     C                   KFLD                    ARTFLS
030660120817     C                   KFLD                    ARTLNA
030670120817     C                   KFLD                    ARTNRS
030680120817     C                   KFLD                    ARTNSC
030690120817     C                   KFLD                    KFLE
030700940819     C* ACCESSO   FILE NUMERATORE
030710940819     C     KNUF          KLIST
030720940819     C                   KFLD                    AAS               2 0
030730940819     C                   KFLD                    CNU               3 0
030740940819     C                   KFLD                    COMLIN            3 0
030750940819     C     KNUF2         KLIST
030760940819     C                   KFLD                    AAS               2 0
030770940819     C                   KFLD                    CNU
030780940819     C                   KFLD                    COMLIN
030790940819     C                   KFLD                    LIV2              3 0
030800991117     C     KNUF3         KLIST
030810991117     C                   KFLD                    CNU
030820991118     C                   KFLD                    DATA6             6 0
030830000509     C     KNUFSP        KLIST
030840000509     C                   KFLD                    AAS               2 0
030850000509     C                   KFLD                    CNU               3 0
030860000509     C                   KFLD                    COMLIN            3 0
030870000509     C                   KFLD                    WNUF2             3 0
030880940819     C* PER CONTROLLO NUM DI SPEDIZIONE
030890940819     C     KNSP          KLIST
030900940916     C                   KFLD                    WAAS
030910940819     C                   KFLD                    VIDLNP
030920940819     C                   KFLD                    VIDNRS
030930940819     C                   KFLD                    RECNSP
030940940819     C     KFTT          KLIST
030950940819     C                   KFLD                    W01PDR
030960940819     C                   KFLD                    W01FVL
030970940819     C                   KFLD                    COMDRT
030980940819     C                   KFLD                    W01TSR
030990980318     C     KVAT          KLIST
031000020917     C                   KFLD                    §FGS
031010020917     C                   KFLD                    §LPCCM
031020980318     C                   KFLD                    §LPAAC
031030980318     C                   KFLD                    §LPLNP
031040980318     C                   KFLD                    §LPNRS
031050980318     C                   KFLD                    §LPNSP
031060980318     C                   KFLD                    WTRC
031070031114
031080031114     c     kVat1         Klist
031090031114     C                   Kfld                    §Fgs
031100031114     C                   Kfld                    §LpCcm
031110031114     C                   Kfld                    §LpAac
031120031114     C                   Kfld                    §LpLnp
031130031114     C                   Kfld                    §LpNrs
031140031114     C                   Kfld                    §LpNsp
031150031114
031160980320     C*
031170051102     C     KARS1         KLIST
031180980320     C                   KFLD                    BLTFLS
031190980320     C                   KFLD                    BLTLNA
031200980320     C                   KFLD                    BLTNRS
031210980320     C                   KFLD                    BLTNSC
031220980320     C                   KFLD                    WTRC
031230120817     C     KARS1A        KLIST
031240120817     C                   KFLD                    ARTFLS
031250120817     C                   KFLD                    ARTLNA
031260120817     C                   KFLD                    ARTNRS
031270120817     C                   KFLD                    ARTNSC
031280120817     C                   KFLD                    WTRC
031290051102     C     KARS1P        KLIST
031300050211     C                   KFLD                    BLpFLS
031310050211     C                   KFLD                    BLpLNA
031320050211     C                   KFLD                    BLpNRS
031330050211     C                   KFLD                    BLpNcd
031340050211     C                   KFLD                    WTRC
031350120817     C***  KARSD         KLIST
031360120817     C***                KFLD                    BLTFLS
031370120817     C***                KFLD                    BLTLNA
031380120817     C***                KFLD                    BLTNRS
031390120817     C***                KFLD                    BLTNSC
031400051102     C     KARS1K        KLIST
031410000915     C                   KFLD                    KFLSAN
031420000915     C                   KFLD                    KLNAAN
031430000915     C                   KFLD                    KNRSAN
031440000915     C                   KFLD                    KNSCAN
031450000915     C                   KFLD                    WTRC
031460051102     C     KARS01        KLIST
031470980320     C                   KFLD                    BLPFLS
031480980320     C                   KFLD                    BLPLNA
031490980320     C                   KFLD                    BLPNRS
031500980320     C                   KFLD                    WO2SCD
031510980320     C                   KFLD                    WTRC
031520051102     C     KARS2         KLIST
031530980325     C                   KFLD                    WTRC
031540170131     C                   KFLD                    W8CNOT
031550060215     C     Kar4F         KLIST
031560991217     C                   KFLD                    WTRC
031570991217     C                   KFLD                    W030A
031580060215     C     Kar4B         KLIST
031590060215     C                   KFLD                    ar4AAS
031600060215     C                   KFLD                    ar4LNP
031610060215     C                   KFLD                    ar4NRS
031620060215     C                   KFLD                    ar4NSP
031630060215     C     Kar403        KLIST
031640060215     C                   KFLD                    kar4trc
031650060215     C                   KFLD                    kar4n14
031660010116     C     KSGN          KLIST
031670010116     C                   KFLD                    COMTFP
031680010116     C                   KFLD                    KWHO
031690010116     C     KSGN8         KLIST
031700010116     C                   KFLD                    COMTFP
031710010116     C                   KFLD                    V8CNOT
031720020308     C     KSGN88        KLIST
031730020308     C                   KFLD                    COMTFP
031740020308     C                   KFLD                    W8CNOT
031750010212     C     KORM          KLIST
031760010212     C                   KFLD                    WOPOE
031770010212     C                   KFLD                    WONSR
031780010222     C                   KFLD                    WONOR2
031790010212     C                   KFLD                    WONRV
031800100319     C     KORME         KLIST
031810100319     C                   KFLD                    WOPOE
031820100319     C                   KFLD                    WONSR
031830100319     C                   KFLD                    WONOR2
031840100319     C                   KFLD                    WONRV
031850100319     C                   KFLD                    koretrc
031860010212     C     KDST          KLIST
031870120611     C                   KFLD                    ormnpg
031880120611     C                   KFLD                    ormndc
031890060522     C                   KFLD                    kfgs
031900010214     C     KFVV          KLIST
031910010214     C                   KFLD                    ORMNPG
031920010215     C                   KFLD                    W0050
031930060522     C                   KFLD                    kfgs
031940021203     C     Kfapd         klist
031950021203     C                   kfld                    kpdtip
031960021203     C                   kfld                    kpdpdr
031970021218     c     KFiar5        Klist
031980021218     c                   Kfld                    BlpAas
031990021218     c                   Kfld                    BlpLnp
032000021218     c                   Kfld                    BlpNrs
032010021218     c                   Kfld                    BlpNsp
032020021218     c                   Kfld                    KAr5Trd
032030040601     c     Kbolm         Klist
032040040601     c                   Kfld                    §lpaasm
032050040601     c                   Kfld                    §lplnpm
032060040601     c                   Kfld                    §lpNrsm
032070040601     c                   Kfld                    §lpNspm
032080130305     c     Kbolm5        Klist
032090130305     c                   Kfld                    §lpaasm
032100130305     c                   Kfld                    §lplnpm
032110130305     c                   Kfld                    §lpNrsm
032120130305     c                   Kfld                    §lpNspm
032130130305     c                   Kfld                    KAr5Trd
032140051123     c     Kanm2         Klist
032150120817     c***                Kfld                    bltfls
032160120817     c***                Kfld                    bltlna
032170120817     c***                Kfld                    bltnrs
032180120817     c***                Kfld                    bltnsc
032190120817     c                   Kfld                    artfls
032200120817     c                   Kfld                    artlna
032210120817     c                   Kfld                    artnrs
032220120817     c                   Kfld                    artnsc
032230051124     c     Kanm1         Klist
032240051125     C                   KFLD                    §LPAAS
032250051125     C                   KFLD                    §LPLNP
032260051125     C                   KFLD                    §LPNRS
032270051125     C                   KFLD                    §LPNSP
032280070601     c*
032290070601     c     kfnorf        klist
032300070601     c                   kfld                    ormpoe
032310070601     c                   kfld                    ormnsr
032320070601     c                   kfld                    ormnor
032330070601     c                   kfld                    ormnrv
032340070601     c                   kfld                    ormdfo
032350070601     c                   kfld                    ormofo
032360070601     c                   kfld                    ormfao
032370080221     c**!!!kfipdo        klist
032380080221     c**!!!              kfld                    orffgs
032390080221     c**!!!              kfld                    orfndc
032400080221     c**!!!              kfld                    orfpoe
032410080221     c**!!!              kfld                    orfnsr
032420080221     c**!!!              kfld                    orfnor
032430080221     c**!!!              kfld                    orfnrv
032440070613     c     kdpo          klist
032450070626     c                   kfld                    kdpodep
032460070626     c                   kfld                    kdpoord
032470071221
032480071221     c     Kbrv7         Klist
032490120817     c***                Kfld                    bltfls
032500120817     c***                Kfld                    comlna
032510120817     c***                Kfld                    bltnrs
032520120817     c***                Kfld                    bltnsc
032530120817     c                   Kfld                    artfls
032540120817     c                   Kfld                    comlna
032550120817     c                   Kfld                    artnrs
032560120817     c                   Kfld                    artnsc
032570140716     c     Kbrv7z        Klist
032580140716     c                   Kfld                    artfls
032590140716     c                   Kfld                    artlna
032600140716     c                   Kfld                    artnrs
032610140716     c                   Kfld                    artnsc
032620080313
032630080313     C     KTbe1         KLIST
032640080313     C                   KFLD                    k_tbecod
032650080313     C                   KFLD                    k_tbeke1
032660100323     C     Kfgi          KLIST
032670100323     C                   KFLD                    kksc
032680100323     C                   KFLD                    klnp
032690130304     C     Kblpar8       KLIST
032700130304     C                   KFLD                    ar8AAS
032710130304     C                   KFLD                    ar8LNP
032720130304     C                   KFLD                    ar8NRS
032730130304     C                   KFLD                    ar8NSP
032740130306     C     Kar8§pdf      KLIST
032750130306     C                   KFLD                    §clipdfp
032760130306     C                   KFLD                    §VATPPDFN
032770160303      * File FITGD32L
032780160125     c     K02TGD02      klist
032790160125     c                   kfld                    TGDtor
032800160125     c                   kfld                    TGDogg
032810160203     c     Ktgd01        klist
032820160203     c                   kfld                    idcant
032830160203     c                   kfld                    idcnut
032840160203     c                   kfld                    idcpdt
032850940819     C***
032860940819     C* DEFINIZIONE CAMPI
032870940819     C***
032880001031     C     *LIKE         DEFINE    BLPTFA        COMTFA
032890000508     C     *LIKE         DEFINE    DSBLD         WSBLD
032900000211     C     *LIKE         DEFINE    DSBLDE        WSBLDE
032910001002     C     *LIKE         DEFINE    DSBLD         WWBLD
032920001002     C     *LIKE         DEFINE    DSBLDE        WWBLDE
032930000211     C     *LIKE         DEFINE    DSBLD0        SAVBLD
032940000211     C     *LIKE         DEFINE    §LDDLA        WDLA
032950000208     C     *LIKE         DEFINE    SGNWHO        KWHO
032960000204     C     *LIKE         DEFINE    OG143         SAV143
032970000201     C     *LIKE         DEFINE    V7CNPR        WNPR
032980041116     C     *LIKE         DEFINE    V7CNPR        WNPRpre
032990051124     c     *LIKE         DEFINE    O14LAD        DESLAD
033000060920     c     *LIKE         DEFINE    O14red        DESred
033010080414     c**   *LIKE         DEFINE    §15cex        DEScaeex
033020080414     c**   *LIKE         DEFINE    §15cdp        DEScadpd
033030080414     c**   *LIKE         DEFINE    §15cfe        DEScafed
033040060613     C**** *LIKE         DEFINE    VIDNRD        COMNRD
033050170214     C**** *LIKE         DEFINE    TBECOD        KTCOD
033060170214     C**** *LIKE         DEFINE    TBELIN        KTLIN
033070170214     C**** *LIKE         DEFINE    TBESIF        KTSIF
033080170214     C**** *LIKE         DEFINE    TBEKE1        KTKE1
033090170214     C**** *LIKE         DEFINE    TBEKE2        KTKE2
033100000120     C     *LIKE         DEFINE    BLPDSP        WDSP
033110020102     C     *LIKE         DEFINE    §CVFDC        COMFDC
033120011113     C     *LIKE         DEFINE    §CVDEC        COMDEC
033130991028     C     *LIKE         DEFINE    O17FDC        WFDC1
033140991015     C     *LIKE         DEFINE    O17FDC        WFDC2
033150991014     C     *LIKE         DEFINE    VIDPOR        MEMPOR
033160991012     C     *LIKE         DEFINE    VI2VA1        VA2VA1
033170991011     C     *LIKE         DEFINE    AR6DIV        WDIV1
033180991011     C     *LIKE         DEFINE    AR6DIV        WDIV2
033190990701     C     *LIKE         DEFINE    VIDNFT        SAVNFT
033200990701     C     *LIKE         DEFINE    VIDIMV        SAVIMV
033210060208     C     *LIKE         DEFINE    VIDIMV        SAVIMVO
033220990630     C     *LIKE         DEFINE    O95CZC        WCZC
033230980211     C     *LIKE         DEFINE    O95CZO        WCZO
033240980211     C     *LIKE         DEFINE    VIDLNP        BLCLNP
033250971216     C     *LIKE         DEFINE    BLPNCA        STANCA
033260971215     C     *LIKE         DEFINE    V6CAWB        SAVAWB
033270050228     C     *LIKE         DEFINE    V7CNPR        SAVNPR
033280061003     C***  *LIKE         DEFINE    §b4fnp        SAVfnp
033300060619     C***  *LIKE         DEFINE    vidrmn        savrmn
033310941104     C*  MI IMPOSTO IL FLAG I/E DELLE TARIFFE DA CARICARE
033320941104     C     *LIKE         DEFINE    TAMFIE        WFIE
033330941107     C* FLAG SALVATO DA MANUTENZIONE BOLLE
033340941117     C     *LIKE         DEFINE    TAMFIE        SAVFIE
033350020122     C     *LIKE         DEFINE    BLPNZD        NZDINI
033360061124     C     *LIKE         DEFINE    BLPNZD        savnzd
033370941107     C* =S CLIENTE CON TARIFFE VALIDE
033380050921     C     *LIKE         DEFINE    olv59tks      WTKS
033390980701     C* CAMPI DELLA PARAM PER RICERCA ALFABETICA
033400940928     C     *LIKE         DEFINE    ACOKCC        PAXCCC
033410940928     C     *LIKE         DEFINE    ACORAG        PAXDMT
033420940928     C     *LIKE         DEFINE    ACOKCC        CCC
033430940928     C* SALVO IL MITTENTE PER IL QUALE HO CARICATO LE TARIFFE: SE MODIF
033440940928     C*  RICARICO LE TARIFFE
033450940928     C     *LIKE         DEFINE    BLPKSC        SAVCCM
033460940928     C* SE MODIFICATO IL CODICE TARIFFA EMETTO I CAMPI PRESI DA TARIFFA
033470940928     C*  IN "RI"
033480940928     C     *LIKE         DEFINE    VIDCTR        SAVCTR
033490950504     C     *LIKE         DEFINE    VIDCTM        SAVCTM
033500941219     C     *LIKE         DEFINE    VIDVCA        VARVCA
033510941219     C     *LIKE         DEFINE    VIDVAS        VARVAS
033520941219     C     *LIKE         DEFINE    VIDVAD        VARVAD
033530970702     C     *LIKE         DEFINE    VIDLOD        VARLOD
033540970704     C     *LIKE         DEFINE    VIDLOM        VARLOM
033550940928     C*
033560940928     C     *LIKE         DEFINE    §15VLT        MITVLT
033570940922     C     *LIKE         DEFINE    §15VLT        DESVLT
033580940928     C     *LIKE         DEFINE    §15EFT        DESEFT
033590000321     C     *LIKE         DEFINE    §15EFD        DESEFD
033600020130     C     *LIKE         DEFINE    §15EFD        DESEFf
033610020131     C     *LIKE         DEFINE    §15ffn        DESffn
033620971215     C     *LIKE         DEFINE    §15COD        DESCOD
033630940922     C     *LIKE         DEFINE    BLDFST        SAVFST
033640950717     C     *LIKE         DEFINE    BLDNCD        WNCD
033650950321     C     *LIKE         DEFINE    BLPCCM        SAVMIT
033660000426     C     *LIKE         DEFINE    VARNCL        SA2NCL
033670000426     C     *LIKE         DEFINE    VARCDP        SA2CDP
033680940819     C     *LIKE         DEFINE    TBLKUT        §KUT
033690940819     C     *LIKE         DEFINE    TBLCOD        §COD
033700940819     C     *LIKE         DEFINE    TBLKEY        §KEY
033710940819     C     *LIKE         DEFINE    VIDINM        VI2INM
033720940819     C     *LIKE         DEFINE    VIDCAM        VI2CAM
033730940819     C     *LIKE         DEFINE    VIDPIM        VI2PIM
033740120817     C     *LIKE         DEFINE    ARTNSC        WNSC
033750940926     C     *LIKE         DEFINE    BLPAAS        WAAS
033760940926     C     *LIKE         DEFINE    BLPFIN        WFIN
033770940916     C     *LIKE         DEFINE    BLPFLS        WFLS
033780060216     C     *LIKE         DEFINE    ar4TRC        WTRC
033790060215     C     *LIKE         DEFINE    ar4TRC        kar4trc
033800060215     C     *LIKE         DEFINE    ar4n14        kar4n14
033810991006     C     *LIKE         DEFINE    AR6SV1        WSV1
033820991027     C     *LIKE         DEFINE    AR6VA1        WVA1
033830991027     C     *LIKE         DEFINE    AR6SV1        WSV2
033840991027     C     *LIKE         DEFINE    AR6VA1        WVA2
033850991027     C     *LIKE         DEFINE    AR6SV1        WSV3
033860991027     C     *LIKE         DEFINE    AR6VA1        WVA3
033870991027     C     *LIKE         DEFINE    AR6SV1        WSVN
033880991027     C     *LIKE         DEFINE    AR6VA1        WVAN
033890941021     C     *LIKE         DEFINE    §CCCEI        WEV1
033900950123     C     *LIKE         DEFINE    VIDRSD        SAVRSD
033910070404     C     *LIKE         DEFINE    VIDind        SAVind
033920070404     C     *LIKE         DEFINE    VIDprd        SAVprd
033930070404     C     *LIKE         DEFINE    VIDlod        SAVlod
033940171012     C**   *LIKE         DEFINE    §LDCDP        SAVCDP
033950940930     C* CONTROLLO SE MODIFICATO CAP MITT E DESTIN PER RICONTROLLARE
033960940930     C     *LIKE         DEFINE    BLPCAD        VARCAD
033970940930     C     *LIKE         DEFINE    BLPCAM        VARCAM
033980940930     C     *LIKE         DEFINE    BLPCAM        VARCMO
033990950102     C     *LIKE         DEFINE    BLPQFT        VARQFT
034000940922     C* SALVO DA TARIFFA PER VEDERE COSA MEMORIZZARE SU COLLO
034010940922     C     *LIKE         DEFINE    BLPTSP        COMTSP
034020940922     C* SALVATO IN MANUTENZIONE PER VEDERE SE RISTAMPARE SEGNACOLLO
034030100209     C     *LIKE         DEFINE    BLPTSP        SA2TSP
034040100209     C     *LIKE         DEFINE    BLPTSP        SAVTSP
034050940819     C     *LIKE         DEFINE    BLPCAD        SAVCAD
034060050421     C     *LIKE         DEFINE    vidbva        SAVbva
034070940922     C     *LIKE         DEFINE    BLPRMA        SAVRMA
034080940819     C     *LIKE         DEFINE    BLPFTM        SAVFTM
034090961111     C     *LIKE         DEFINE    BLPFBR        SAVFBR
034100961122     C     *LIKE         DEFINE    BLPCBO        SAVCBO
034110970404     C     *LIKE         DEFINE    VIDBAM        SAVBAM
034120940922     C* CAMPI USATI NELLE ROUTINE DI CONTROLLO, UNICHE PER
034130960319     C*  VIDEATA PERSONALIZZAZIONE E 1 VIDEATA
034140960319     C     *LIKE         DEFINE    VIDGC1        WGC1
034150960319     C     *LIKE         DEFINE    VIDGC2        WGC2
034160960319     C     *LIKE         DEFINE    VIDTSP        WTSP
034170940928     C     *LIKE         DEFINE    VIDNZM        WNAR
034180941103     C     *LIKE         DEFINE    VIDCMO        WCMO
034190941103     C     *LIKE         DEFINE    VIDRMO        WRMO
034200940824     C     *LIKE         DEFINE    VIDLNA        WLNA
034210940824     C     *LIKE         DEFINE    VIDPDR        WPDR
034220940824     C     *LIKE         DEFINE    VIDCBO        WCBO
034230940824     C     *LIKE         DEFINE    VIDLNP        WLNP
034240940825     C     *LIKE         DEFINE    VIDFTM        WFTM
034250940825     C     *LIKE         DEFINE    VIDCCM        WCCM
034260940928     C     *LIKE         DEFINE    VIDCCM        WCCMS
034270940921     C     *LIKE         DEFINE    VIDFLC        WFLC
034280940922     C     *LIKE         DEFINE    COD           WCOD
034290940922     C     *LIKE         DEFINE    VIDVAS        WVLT
034300940928     C     *LIKE         DEFINE    VIDCTM        WCTM
034310940923     C     *LIKE         DEFINE    VIDIMV        COMIMV
034320940921     C     *LIKE         DEFINE    VIDCCM        SAVFLC
034330940928     C     *LIKE         DEFINE    VIDPDR        SAVPDR
034340990915     C     *LIKE         DEFINE    VIDPDR        SAVPD4
034350940819     C     *LIKE         DEFINE    VIDNCL        SAVNCL
034360940819     C     *LIKE         DEFINE    VIDFFD        VARFFD
034370010214     C     *LIKE         DEFINE    VIDFFD        COMFFD
034380011211     C     *LIKE         DEFINE    VIDIAS        VARIAS
034390011211     C     *LIKE         DEFINE    VIDIAS        WARIAS
034400011212     C     *LIKE         DEFINE    VIDCAS        WARCAS
034410011212     C     *LIKE         DEFINE    VIDVMD        WARVMD
034420940819     C     *LIKE         DEFINE    VIDVOL        VARVOL
034430980402     C     *LIKE         DEFINE    VIDVOL        SAVVOL
034440940819     C     *LIKE         DEFINE    VIDVOL        VA2VOL
034450940819     C     *LIKE         DEFINE    VIDPKG        VARPKG
034460980402     C     *LIKE         DEFINE    VIDPKG        SAVPKG
034470020531     C     *LIKE         DEFINE    VIDtc1        VARtc1
034480020531     C     *LIKE         DEFINE    VIDtc2        VARtc2
034490060110     C     *LIKE         DEFINE    VIDrsd        D_VARrsd
034500060110     C     *LIKE         DEFINE    VIDind        D_VARind
034510060110     C     *LIKE         DEFINE    VIDlod        D_VARlod
034520060110     C     *LIKE         DEFINE    VIDprd        D_VARprd
034530060110     C     *LIKE         DEFINE    VIDnzd        D_VARnzd
034540940819     C     *LIKE         DEFINE    VIDZNC        VARZNC
034550940819     C     *LIKE         DEFINE    VIDZNC        SAVZNC
034560940819     C     *LIKE         DEFINE    VIDPRD        VARPRD
034570940819     C     *LIKE         DEFINE    VIDDSP        SAVDSP
034580940819     C     *LIKE         DEFINE    VIDFAP        COMFAP
034590940919     C     *LIKE         DEFINE    VIDFIN        COMFIN
034600940819     C     *LIKE         DEFINE    VIDDRT        SAVDRT
034610940928     C     *LIKE         DEFINE    VIDDCR        WDCR
034620940913     C     *LIKE         DEFINE    VIDHCR        WHCR
034630940913     C     *LIKE         DEFINE    VIDMCR        WMCR
034640940913     C     *LIKE         DEFINE    VIDTCR        WTCR
034650941011     C     *LIKE         DEFINE    VIDLNA        SAVLNA
034660941011     C     *LIKE         DEFINE    BLPLNP        SAVLNP
034670940824     C     *LIKE         DEFINE    BLPLNA        COMLNA
034680940824     C     *LIKE         DEFINE    BLPLNA        CO2LNA
034690940819     C     *LIKE         DEFINE    BLPCTM        COMCTM
034700940819     C     *LIKE         DEFINE    BLPDRT        COMDRT
034710991006     C     *LIKE         DEFINE    AR6DFT        COMDFT
034720060208     C     *LIKE         DEFINE    AR6DFT        dftar6
034730940819     C     *LIKE         DEFINE    FTTPDR        W01PDR
034740940819     C     *LIKE         DEFINE    FTTTSR        W01TSR
034750940819     C     *LIKE         DEFINE    FTTFVL        W01FVL
034760941005     C* CAMPI DI CONFRONTO PER RICARICARE IL CODICE TARIFFA MITTENTE
034770941005     C     *LIKE         DEFINE    VIDTSP        VARTSP
034780960404     C     *LIKE         DEFINE    BRVFLE        KFLE
034790960404     C     *LIKE         DEFINE    BRVNPG        KNPG
034800960805     C* CAMPI che non devono essere modificati
034810960805     C     *LIKE         DEFINE    VIDNCD        WNSNCD
034820960805     C     *LIKE         DEFINE    VIDNCA        WNSNCA
034830960927     C*
034840980318     C     *LIKE         DEFINE    BLPCAD        WCAD
034850980320     C     *LIKE         DEFINE    BLPCAD        WRKCAD
034860980320     C     *LIKE         DEFINE    BLPNCA        SAVNCA
034870980320     C     *LIKE         DEFINE    BLPNCD        SAVNCD
034880980403     C     *LIKE         DEFINE    BLPNCD        SV1NCD
034890000830     C     *LIKE         DEFINE    V8CNBR        WNBR
034900000908     C     *LIKE         DEFINE    IZ1CH1        CHIDAL
034910000908     C     *LIKE         DEFINE    IZ1CH2        CHIAL
034920000911     C     *LIKE         DEFINE    V8CNBR        NR8
034930000911     C     *LIKE         DEFINE    V8ZMSG        W08MSG
034940000918     C     *LIKE         DEFINE    NR8           SAVNR8
034950001205     C     *LIKE         DEFINE    BLPTC1        SAVTC1
034960001205     C     *LIKE         DEFINE    BLPTC2        SAVTC2
034970140122     C***  *LIKE         DEFINE    BLPTC1        WTCP
034980140122     C***  *LIKE         DEFINE    BLPTC1        WSVTCP
034990010215     C* CAMPI PER O.R.M.
035000010215     C     *LIKE         DEFINE    VIDPDR        PREPDR
035010010215     C     *LIKE         DEFINE    VIDPDR        WDPDR
035020010215     C     *LIKE         DEFINE    VIDDRT        PREDRT
035030010215     C     *LIKE         DEFINE    VIDFPP        PREFPP
035040010215     C     *LIKE         DEFINE    ORMKSC        PRECCM
035050010215     C     *LIKE         DEFINE    VIDCTR        PRECTR
035060010215     C     *LIKE         DEFINE    VIDFFD        PREFFD
035070010305     C     *LIKE         DEFINE    V1CNCL        PRENCL
035080010305     C     *LIKE         DEFINE    VIDPKG        PREPKG
035090010215     C     *LIKE         DEFINE    VIDORM        W01ORM
035100010215     C     *LIKE         DEFINE    V0CLNP        WOLNP
035110010215     C     *LIKE         DEFINE    ORMKSC        WOCCM
035120010219     C     *LIKE         DEFINE    WLNP          WLNPO
035130010220     C     *LIKE         DEFINE    ORMFAO        PREFAO
035140010313     C     *LIKE         DEFINE    BLDNCD        WNCOL
035150010313     C     *LIKE         DEFINE    BLDNCD        WNCOA
035160011108     C*
035170011212     C     *LIKE         DEFINE    §CVDEC        DECCN
035180011212     C     *LIKE         DEFINE    O21FCA        FCASAV
035190011212     C     *LIKE         DEFINE    §GEIMF        IMFGEI
035200011205     C     *LIKE         DEFINE    §ORMFD        SORMFD
035210011212     C     *LIKE         DEFINE    IEDNUM        WNUMED
035220020211     C     *LIKE         DEFINE    tamksc        tarksc
035230020215     C     *LIKE         DEFINE    §ogntw        savntw
035240050114     C     *LIKE         DEFINE    §lpxco        wxco
035250940819     C***
035260940819     C* CAMPI CHE INIZIALIZZO SOLO ALL'ENTRATA DEL PROGRAMMA E BASTA
035270940819     C***
035280940819     C                   CLEAR                   VIDSOP
035290940819     C                   CLEAR                   VIDDRT
035300000104     C                   CLEAR                   WBDSP
035310990603     C* PER TIPO CHIAMATA PREPAGATO, NON IMPOSTO IL PADORNCINO
035320010301     C* NON LO IMPOSTO NEMMENO PER CHIAMATA DA CONFERMA ORM PREPAGATI
035330010301     C* DI ALTRO P.O.
035340990603     C     PARTCH        IFNE      'P'
035350010301     C     §LPFPR        ANDNE     'O'
035360941021     C                   MOVEL     '?   '        VIDPDR
035370990628     C                   MOVEL     'P'           VIDFPP
035380990603     C                   ENDIF
035390940819     C                   CLEAR                   VIDNRT
035400940819     C                   CLEAR                   VIDLNP
035410961016     C                   CLEAR                   PAXFLR
035420010212     C                   CLEAR                   VIDPOE
035430010212     C                   CLEAR                   VIDNOR
035440010212     C                   CLEAR                   VIDNRV
035450010212     C                   CLEAR                   W01ORM
035460941107     C**
035470170216     c* ATTENZIONE: in caso di sostituzione dell' X§PARUT con il TIBS34R
035480170216     c* non bisogna aggiornare l'area dati utente in quanto questo pgm,
035490170216     c* se richiesto dal chiamante, modifica il campi SIMFEL/SIMPOU/SIMTPP
035500170216     c* ma tale modifica deve valere solo in bollettazione.
035510930628     C                   Z-ADD     1             CODUT
035520930628     C                   CALL      'X§PARUT'
035530930628     C                   PARM                    UT§DSE
035540940819     C                   MOVEL     RAGUT         VIDDSA
035550930628     C                   MOVEL     REC80         CNCR80
035560170214     c* mi salvo simfel/simpou/simtpp nel caso il pgm sia richiamato per
035570170214     c* la bollettazione in altro terminal di partenza
035580170214     c                   eval      simfel_s=simfel
035590170214     c                   eval      simpou_s=simpou
035600170214     c                   eval      simtpp_s=simtpp
035610170214     c                   eval      wcarsimfel=' '
035620170214     c                   clear                   s_ParLnpB
035630930628     C*--- RICERCA CAPOCONTI
035640930628     C                   DO        50            X                 2 0
035650930628     C                   MOVE      TCU(X)        TCUDS
035660930628     C     F56           CABNE     'CG'          END1
035670930628     C     F4            COMP      '1'                                    21
035680930628     C     F4            COMP      '2'                                    22
035690930628     C     F4            COMP      '3'                                    23
035700930628     C     F4            COMP      '6'                                    27
035710930628     C** 1 CLIENTI   21
035720930628     C** 2 FORNITORI 22
035730930628     C** 3 AGENTI    23
035740930628     C     F3            COMP      '0'                                242425
035750930628     C     F3            COMP      'I'                                    26
035760930628     C** 0 ITALIA   25
035770930628     C** 1 ESTERO   24
035780930628     ** I CAPO CONTO IVA
035790930628     C   21
035800930628     CAN 24              Z-ADD     KCU(X)        KCE               4 0
035810930628     C   21
035820930628     CAN 25              Z-ADD     KCU(X)        KCI               4 0
035830930628     C   22
035840930628     CAN 24              Z-ADD     KCU(X)        KFE               4 0
035850930628     C   22
035860930628     CAN 25              Z-ADD     KCU(X)        KFI               4 0
035870930628     C   23
035880930628     CAN 24              Z-ADD     KCU(X)        KAE               4 0
035890930628     C   23
035900930628     CAN 25              Z-ADD     KCU(X)        KAI               4 0
035910930628     C   26              Z-ADD     KCU(X)        KIVA              4 0
035920930628     C   27              Z-ADD     KCU(X)        KBNA              4 0
035930930628     C     END1          TAG
035940930628     C                   END
035950940614     C                   SETOFF                                       212223
035960940614     C                   SETOFF                                       242526
035970940614     C                   SETOFF                                       27
035980991214     C                   CLEAR                   DSBLP0
035990950920     C***
036000950920     C* CARICO DATI VARIABILI PARTENZE
036010950920     C***
036020950920     C                   MOVEL     '3I'          COD
036030950920     C                   MOVEL     '1       '    KEY
036040950920     C                   EXSR      CTABEL
036050950920     C  N30              MOVEL     TBLUNI        DS3I
036060950920     C   30              CLEAR                   DS3I
036070991213     C***
036080991213     C* CARICO TABELLA DPD
036090991213     C***
036100991213     C                   MOVEL     '3I'          COD
036110991213     C                   MOVEL(P)  'DPD'         KEY
036120991213     C*
036130991213     C                   EXSR      CTABEL
036140991213     C  N30              MOVEL     TBLUNI        DS3IDP
036150991213     C   30              CLEAR                   DS3IDP
036160000509     C***
036170000509     C* CARICO TABELLA POSTE
036180000509     C***
036190000509     C                   MOVEL     '3I'          COD
036200000509     C                   MOVEL(P)  'POSTE'       KEY
036210000509     C*
036220000509     C                   EXSR      CTABEL
036230000509     C  N30              MOVEL     TBLUNI        DS3IPT
036240000509     C   30              CLEAR                   DS3IPT
036250971211     C***
036260971211     C* CARICO CODICI CLIENTI SDI PER I QUALI INSERISCO OBBLIGATORIAM
036270971211     C*  NUMERO AWB CON CONTROLLO CHECK DIGIT
036280971211     C***
036290971211     C                   MOVEL     '3I'          COD
036300971211     C                   MOVEL     'E       '    KEY
036310971211     C                   EXSR      CTABEL
036320971211     C  N30              MOVEA     TBLUNI        KSS
036330971212     C* 2 CIFRE INIZIALI FISSE PER NUMERO AWB
036340971212     C  N30              MOVE      TBLUNI        §3IFAW            2 0
036350971211     C   30              CLEAR                   KSS
036360971212     C   30              CLEAR                   §3IFAW
036370950920     C**
036380930401     C* CODICE PER ASSICURAZIONE PER CONTO
036390950920     C**
036400990818     C                   MOVEL     'C '          FTC
036410041217     c**
036420041217      * Aggancio tabella "VPO" per reperimento giorni per calcolo
036430041217      * max data consegna richiesta
036440041217     C                   CLEAR                   dsbs02
036450041217     c                   clear                   dvpo
036460041217     C                   MOVEL     'C'           T02MOD
036470041217     C                   MOVEL     KNSIF         T02SIF
036480041217     C                   MOVEL     'VPO'         T02COD
036490041217     c                   movel(P)  'VPO'         t02ke1
036500041217     C                   CALL      'TIBS02R'
036510041217     C                   PARM                    KPJBA
036520041217     C                   PARM                    dsbs02
036530041217    2C                   IF        T02ERR = *BLANKS
036540041217     C                   MOVEL     T02uni        dvpo
036550041217    2C                   ENDIF
036560121017      * Aggancio tabella "VPODECO"
036570060207     C                   CLEAR                   dsbs02
036580060207     c                   clear                   dvpodeco
036590060207     C                   MOVEL     'C'           T02MOD
036600060207     C                   MOVEL     KNSIF         T02SIF
036610060207     C                   MOVEL     'VPO'         T02COD
036620060207     c                   movel(P)  'DECO'        t02ke1
036630060207     C                   CALL      'TIBS02R'
036640060207     C                   PARM                    KPJBA
036650060207     C                   PARM                    dsbs02
036660060207    2C                   IF        T02ERR = *BLANKS
036670060207     C                   MOVEL     T02uni        dvpodeco
036680060207    2C                   ENDIF
036690150414      * Aggancio tabella "VPO" "EXPO"
036700151119     C*                  CLEAR                   dsbs02
036710151119     c*                  clear                   fil_expo
036720151119     C*                  MOVEL     'C'           T02MOD
036730151119     C*                  MOVEL     KNSIF         T02SIF
036740151119     C*                  MOVEL     'VPO'         T02COD
036750151119     c*                  movel(P)  'EXPO'        t02ke1
036760151119     C*                  CALL      'TIBS02R'
036770151119     C*                  PARM                    KPJBA
036780151119     C*                  PARM                    dsbs02
036790151119    2C*                  IF        T02ERR = *BLANKS
036800151119     C*                  MOVEa     T02uni        fil_expo
036810151119    2C*                  ENDIF
036820150304      * Aggancio tabella "VPO" "TELLUS"
036830150304     C                   CLEAR                   dsbs02
036840150304     c                   clear                   dvpotellus
036850150304     C                   MOVEL     'C'           T02MOD
036860150304     C                   MOVEL     KNSIF         T02SIF
036870150304     C                   MOVEL     'VPO'         T02COD
036880150304     c                   movel(P)  'TELLUS'      t02ke1
036890150304     C                   CALL      'TIBS02R'
036900150304     C                   PARM                    KPJBA
036910150304     C                   PARM                    dsbs02
036920150304    2C                   IF        T02ERR = *BLANKS
036930150304     C                   MOVEL     T02uni        dvpotellus
036940150304    2C                   ENDIF
036950121017      * Aggancio tabella "DGD"
036960121017     C                   CLEAR                   dsbs02
036970160321     c                   clear                   ddgd
036980121017     C                   MOVEL     'C'           T02MOD
036990121017     C                   MOVEL     KNSIF         T02SIF
037000121017     C                   MOVEL     'DGD'         T02COD
037010121017     c                   movel(P)  '1'           t02ke1
037020121017     C                   CALL      'TIBS02R'
037030121017     C                   PARM                    KPJBA
037040121017     C                   PARM                    dsbs02
037050121017    2C                   IF        T02ERR = *BLANKS
037060121017     C                   MOVEL     T02uni        ddgd
037070121017    2C                   ENDIF
037080160323      * Aggancio tabella "NSD"
037090160323     C                   CLEAR                   dsbs02
037100160323     c                   clear                   dnsd
037110160323     C                   MOVEL     'C'           T02MOD
037120160323     C                   MOVEL     KNSIF         T02SIF
037130160323     C                   MOVEL     'NSD'         T02COD
037140160323     c                   movel(P)  '1'           t02ke1
037150160323     C                   CALL      'TIBS02R'
037160160323     C                   PARM                    KPJBA
037170160323     C                   PARM                    dsbs02
037180160323    2C                   IF        T02ERR = *BLANKS
037190160323     C                   MOVEL     T02uni        dnsd
037200160323    2C                   ENDIF
037210140212      * Aggancio tabella "CSP"--> Caratteri Speciali per eliminazione
037220140212      *                           caratteri di punteggiatura da loc.dest.
037230160112     c*  Caratteri da togliere validi per TUTTO il campo  tab "CSP" "LOC_ALL"
037240140212     C                   CLEAR                   dsbs02
037250140212     C                   CLEAR                   charnook
037260140212     C                   MOVEL     'C'           T02MOD
037270140212     C                   MOVEL     KNSIF         T02SIF
037280140212     C                   MOVEL     'CSP'         T02COD
037290160112     c****               movel(P)  'LOC'         t02ke1
037300160112     c                   movel(P)  'LOC_ALL'     t02ke1
037310140212     C                   CALL      'TIBS02R'
037320140212     C                   PARM                    KPJBA
037330140212     C                   PARM                    dsbs02
037340140212    2C                   IF        T02ERR = *BLANKS
037350140212     C                   MOVEL     T02uni        charnook
037360140212    2C                   ENDIF
037370160112
037380160112     c*  Caratteri da togliere validi per la FINE del campo  tab "CSP" "LOC_F"
037390160112     C                   CLEAR                   dsbs02
037400160112     C                   CLEAR                   charnookf
037410160112     C                   MOVEL     'C'           T02MOD
037420160112     C                   MOVEL     KNSIF         T02SIF
037430160112     C                   MOVEL     'CSP'         T02COD
037440160112     c                   movel(P)  'LOC_F'       t02ke1
037450160112     C                   CALL      'TIBS02R'
037460160112     C                   PARM                    KPJBA
037470160112     C                   PARM                    dsbs02
037480160112    2C                   IF        T02ERR = *BLANKS
037490160112     C                   MOVEL     T02uni        charnookf
037500160112    2C                   ENDIF
037510160112     c*  Caratteri da togliere validi per l'INIZIO del campo  tab "CSP" "LOC_I"
037520160112     C                   CLEAR                   dsbs02
037530160112     C                   CLEAR                   charnooki
037540160112     C                   MOVEL     'C'           T02MOD
037550160112     C                   MOVEL     KNSIF         T02SIF
037560160112     C                   MOVEL     'CSP'         T02COD
037570160112     c                   movel(P)  'LOC_I'       t02ke1
037580160112     C                   CALL      'TIBS02R'
037590160112     C                   PARM                    KPJBA
037600160112     C                   PARM                    dsbs02
037610160112    2C                   IF        T02ERR = *BLANKS
037620160112     C                   MOVEL     T02uni        charnooki
037630160112    2C                   ENDIF
037640140212     c* imposto stringa contenente caratteri speciali per il controllo
037650140212     c* della parte finale (uguale alla charnook maa senza l'eventuale '.')
037660160112     c****               eval      charnookf=%xlate('.':' ':charnook)
037670141202      * Aggancio tabella "CSP"--> Caratteri ammessi per PIN CODE
037680141202     C                   CLEAR                   dsbs02
037690141202     C                   CLEAR                   charPCok
037700141202     C                   MOVEL     'C'           T02MOD
037710141202     C                   MOVEL     KNSIF         T02SIF
037720141202     C                   MOVEL     'CSP'         T02COD
037730141202     c                   movel(P)  'PINCODE'     t02ke1
037740141202     C                   CALL      'TIBS02R'
037750141202     C                   PARM                    KPJBA
037760141202     C                   PARM                    dsbs02
037770141202    2C                   IF        T02ERR = *BLANKS
037780141202     C                   MOVEL     T02uni        charPCok
037790141202    2C                   ENDIF
037800140612
037810140612     c* ricerca P.O. abilitati da tabella VPO per step di test
037820160304     c***                clear                   trulvpods
037830160304     c****               eval      ivpoke1 = 'DECOFIDIR'
037840160304     c***                call      'TRULVPOR'
037850160304     c***                parm                    trulvpods
037860140212     c
037870160310     c* ricerca P.O. abilitati da tabella VPO per progetto
037880160310     c* forzatura instradamento da eex a dpd
037890160310     c                   clear                   trulvpods
037900160310     c                   eval      ivpoke1 = 'DECOFIDPD'
037910160310     c                   call      'TRULVPOR'
037920160310     c                   parm                    trulvpods
037930111130     c
037940101022     C***
037950101022     C* CARICO TABELLA SIMBOLI CALENDARIO FESTIVI
037960101022     C***
037970101022     C                   MOVEL     '1Y'          COD
037980101022     C                   Z-ADD     1             C
037990101022     C     KTAB3         SETLL     TABEL
038000101022     C                   EXSR      RTABEL
038010101022     C*
038020101022     C     *IN30         DOWEQ     '0'
038030101022     C     TBLFLG        IFEQ      ' '
038040101022     C                   MOVEL     TBLUNI        DS1Y
038050101022     C     §1Yfec        IFEQ      'S'
038060101022     C                   MOVEL     TBLKEY        s1Y(C)
038070101022     C                   ADD       1             C
038080101022     C                   ENDIF
038090101022     C                   ENDIF
038100101022     C*
038110101022     C                   EXSR      RTABEL
038120101022     C                   ENDDO
038130930401     C*
038140950920     C* DATA BOLLETTAZIONE:  TRA UDATE E DATA GIORNO + §3IGGS
038150950920     C*  SOLO PER LE SPEDIZ.DI RECUPERO E' TRA DATA G. - 3  E  + §3IGGS
038160940920     C                   TIME                    W0140            14 0
038170940920     C* UDATE IN GGMMAAAA
038180940920     C                   MOVE      W0140         WDTGIO            8 0
038190990630     C                   MOVE      WDTGIO        DATAAS
038200940819     C*
038210940920     C* UDATE IN AAAAMMGG
038220940920     C                   Z-ADD     WDTGIO        G02DAT
038230910208     C                   MOVEL     *BLANK        G02ERR
038240940819     C                   CALL      'XSRDA8'
038250910208     C                   PARM                    WLBDAT
038260940819     C                   MOVEL     G02INV        DATEU             8 0
038270030409
038280030415      * Calcolo oggi + 5 gg.
038290051215     c****               Move      Dateu         Dataiso
038300051215     c****               Adddur    §vpodcg:*d    Dataiso
038310051215     c****               Move      Dataiso       woggi5
038320051215     c*
038330051215     c                   Move      Dateu         Dataiso
038340051215     c                   Adddur    §vpodcgm1:*d  Dataiso
038350051215     c                   Move      Dataiso       woggidcgm1
038360051215     c*
038370051215     c                   Move      Dateu         Dataiso
038380051215     c                   Adddur    §vpodcgm2:*d  Dataiso
038390051215     c                   Move      Dataiso       woggidcgm2
038400030416
038410051214      **Calcolo oggi + 1 mm.
038420051214     c**                 Move      Dateu         Dataiso
038430051214     c**                 Adddur    1:*m          Dataiso
038440051214     c**                 Move      Dataiso       woggi1m
038450030409
038460950921     C* SE NON FOSSE PERMESSO BOLLETTARE IN SOSPENSIONE
038470950921     C*  SI PUO' BOLLETTARE SOLO FINO A OGGI
038480950921     C                   Z-ADD     G02INV        DATAPA            8 0
038490950921     C                   MOVEL     G02DAT        DATAPG            8
038500950919     C* SOTTRAGGO  3
038510950919     C     G02TGI        SUB       3             GIOTGI
038520950919     C*
038530950919     C                   CALL      'XSRGI8'
038540950919     C                   PARM                    WGIDAT
038550950919     C*
038560950919     C                   Z-ADD     GIOINV        DATAM             8 0
038570080109     C* SOTTRAGGO  giorni per ottenere data minima per data ritiro
038580080109     c                   clear                   TRUL52ds
038590080109     c                   eval      d52gio=§3iggb
038600080109     c                   eval      d52sgn='-'
038610080109     c                   z-add     dateu         D52din
038620080109     c                   call      'TRUL52R'
038630080109     c                   parm                    TRUL52ds
038640080109     C*
038650080109     C                   Z-ADD     d52dfi        DATAmin           8 0
038660080603     c* sottraggo 40 gg. per otternere data minima per data ritiro per
038670080603     c* prepagati
038680080603     c                   move      dateu         dataiso
038690080603     c                   subdur    40:*d         dataiso
038700080603     c                   move      dataiso       datam40
038710080603     c
038720061220     c                   z-add     g02tgi        salvatgi
038730991214     C*
038740991214     C* SOTTRAGGO  I GIORNI PER LA DATA CONTROLLO OPPIO PARCEL DPD
038750991214     C     G02TGI        SUB       §3IGGU        GIOTGI
038760991214     C*
038770991214     C                   CALL      'XSRGI8'
038780991214     C                   PARM                    WGIDAT
038790991214     C*
038800991214     C                   Z-ADD     GIOINV        DPDDSP            8 0
038810130305     c* sottraggo i giorni per controllo pdf cliente doppio
038820130305     c                   move      dateu         dataiso
038830130305     c                   subdur    §vpogpdf:*d   dataiso
038840130305     c                   move      dataiso       datapdf
038850950919     C*
038860950919     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
038870990602     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
038880990602     C* PER I PREPAGATI
038890950920     C                   Z-ADD     1             X
038900950920    1C     X             DOWLE     §3IGGS
038910990602     C     PARTCH        ANDNE     'P'
038920010301     C     §LPFPR        ANDNE     'O'
038930990602    1C     X             ORLE      §3IGGP
038940990602     C     PARTCH        ANDEQ     'P'
038950010301    1C     X             ORLE      §3IGGP
038960010301     C     §LPFPR        ANDEQ     'O'
038970950920     C*
038980950921     C                   MOVEL     'F'           WFEST             1
038990950920     C*
039000950920    2C     WFEST         DOWNE     ' '
039010950919     C     G02TGI        ADD       1             GIOTGI
039020950919     C                   ADD       1             G02TGI
039030940819     C                   CALL      'XSRGI8'
039040910208     C                   PARM                    WGIDAT
039050910221     C*
039060950920     C                   Z-ADD     GIOINV        DATAPA            8 0
039070950920     C                   MOVEL     GIODAT        DATAPG            8
039080950920     C*
039090950920     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
039100950921     C                   Z-ADD     GIOINV        WDATA
039110950920     C                   CLEAR                   W0030
039120120302     C* CHAIN SUL CALENDARIO BRT
039130950920     C     KCLN          CHAIN     AZCLN01L                           30
039140950920     C   30              CLEAR                   CLNPOM
039150950921     C                   MOVEA     CLNPOM        K31
039160950920     C                   MOVEL     K31(WGG)      WFEST
039170101022     c* Se non è festivo pulisco il campo WFEST
039180101022     c     wfest         lookup    S1Y                                    30
039190101022     c                   if        not *in30
039200101022     c                   clear                   wfest
039210101022     c                   endif
039220101022     c
039230950920    2C                   ENDDO
039240950920     C*
039250950920     C                   ADD       1             X
039260990602    1C                   ENDDO
039270061220     c
039280061220     c* trovo primo giorno lavorativo minore di oggi per bollettare in
039290061220     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
039300061220     C                   TIME                    orapgm            6 0
039310061221    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
039320061220     C                   MOVEL     'F'           WFEST             1
039330061220     c                   z-add     salvatgi      giotgi
039340061220     C*
039350061220    1C     WFEST         DOWNE     ' '
039360061221     C     salvatgi      sub       1             GIOTGI
039370061221     C                   sub       1             salvatgi
039380061220     C                   CALL      'XSRGI8'
039390061220     C                   PARM                    WGIDAT
039400061220     C*
039410061220     C                   Z-ADD     GIOINV        DATAmeno1         8 0
039420061221     C                   MOVEL     GIODAT        DATgmeno1         8 0
039430061220     C*
039440061220     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
039450061220     C                   Z-ADD     GIOINV        WDATA
039460061220     C                   CLEAR                   W0030
039470120302     C* CHAIN SUL CALENDARIO BRT
039480061220     C     KCLN          CHAIN     AZCLN01L                           30
039490061220     C   30              CLEAR                   CLNPOM
039500061220     C                   MOVEA     CLNPOM        K31
039510061220     C                   MOVEL     K31(WGG)      WFEST
039520101022     c* Se non è festivo pulisco il campo WFEST
039530101022     c     wfest         lookup    S1Y                                    30
039540101022     c                   if        not *in30
039550101022     c                   clear                   wfest
039560101022    2C                   ENDif
039570101022     c
039580061220    1C                   ENDDO
039590061220   x0c                   else
039600061220     C*
039610061221     C                   Z-ADD     dateu         DATAmeno1
039620061221     C                   MOVEL     wdtgio        DATgmeno1
039630061220    0c                   endif
039640941109     C***
039650941109     C* CARICO CAMPI FISSI PER TASSAZIONE/BOLLETTAZIONE
039660941109     C***
039670941109     C                   MOVEL     'QT'          COD
039680941109     C                   MOVEL     '1       '    KEY
039690941109     C                   EXSR      CTABEL
039700941109     C  N30              MOVEL     TBLUNI        DSQT1
039710941109     C   30              CLEAR                   DSQT1
039720930601     C*
039730920427     C* NUMERO PER FORZARE GLI ERRORI: 1 PER IMM E MANUT.BOLLE
039740920427     C*                                2 PER DISK CLI
039750920427     C                   Z-ADD     1             NUMFOR            1 0
039760940923     C***
039770940923     C* DTU,10 LA PORTO A 8 PER I CONTROLLO
039780940923     C***
039790940923     C                   CLEAR                   WLBDAT
039800940923     C                   Z-ADD     DTU(10)       G02INV
039810940923     C                   MOVEL     '3'           G02ERR
039820940923     C                   CALL      'XSRDA8'
039830940923     C                   PARM                    WLBDAT
039840940923     C                   MOVEL     G02INV        WDTU10            8 0
039850990830     C* ADDIZIONO  3
039860990830     C     G02TGI        ADD       1             GIOTGI
039870990830     C*
039880990830     C                   CALL      'XSRGI8'
039890990830     C                   PARM                    WGIDAT
039900990830     C*
039910990830     C                   Z-ADD     GIODAT        WDTUPI            8 0
039920000113     C                   MOVE      GIODAT        WAAUPI            4 0
039930990830     C*
039940941107     C***
039950960926     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
039960941107     C***
039970941107     C                   CLEAR                   DSUL06
039980941107     C                   MOVE      '£1'          D06COD
039990941107     C                   MOVEL     SIMFEL        D06KEY
040000961003     C                   MOVEL     'L'           D06TLA
040010941107     C                   MOVEL     DSUL06        KPJBU
040020941107     C*
040030941107     C                   CALL      'TRUL06R'
040040941107     C                   PARM                    KPJBA
040050941107     C                   MOVEL     KPJBU         DSUL06
040060941107     C                   MOVEA     LIN           L1
040070070807     C***
040080070807     C* CARICO £6
040090070807     C***
040100070807     C                   CLEAR                   DSUL06
040110070807     C                   MOVE      '£6'          D06COD
040120070807     C                   movel     SImpou        D06KEY
040130070807     C                   MOVEL     'L'           D06TLA
040140070807     C                   MOVEL     DSUL06        KPJBU
040150070807     C*
040160070807     C                   CALL      'TRUL06R'
040170070807     C                   PARM                    KPJBA
040180070807     C                   MOVEL     KPJBU         DSUL06
040190070807     C                   MOVEA     LIN           L6
040200941107     C***
040210941107     C* CARICO TABELLA 5E : TIPI SERVIZIO
040220941107     C***
040230941107     C                   MOVEL     '5E'          COD
040240941107     C                   Z-ADD     1             C
040250941107     C     KTAB3         SETLL     TABEL
040260941107     C                   EXSR      RTABEL
040270941107     C*
040280941107     C     *IN30         DOWEQ     '0'
040290941107     C     TBLFLG        IFEQ      ' '
040300941107     C                   MOVEL     TBLKEY        TSP(C)
040310941108     C                   MOVEL     TBLUNI        DS5E
040320941107     C                   MOVEL     §5EDES        DTS(C)
040330941107     C                   MOVEL     §5EFUB        UTS(C)
040340941115     C                   MOVEL     §5EFST        STS(C)
040350000509     C                   MOVEL     §5EUSO        USO(C)
040360090604     c                   eval      dts08(c) = §5ed08
040370090609     c                   eval      dts03(c) = §5ed03
040380090827     c                   eval      tsTTC(c) = §5ettc
040390941107     C                   ADD       1             C
040400941107     C                   ENDIF
040410941107     C*
040420941107     C                   EXSR      RTABEL
040430941107     C                   ENDDO
040440960209     C***
040450960209     C* CARICO TABELLA TIPI BOLLA CHE PREVEDONO L'ASSICURAZIONE
040460960209     C***
040470960209     C                   MOVEL     'TB'          COD
040480960209     C                   Z-ADD     1             C
040490960209     C     KTAB3         SETLL     TABEL
040500960209     C                   EXSR      RTABEL
040510960209     C*
040520960209     C     *IN30         DOWEQ     '0'
040530960209     C     TBLFLG        IFEQ      ' '
040540960209     C                   MOVEL     TBLUNI        DSTB
040550960209     C     §TBFAS        IFEQ      '1'
040560960209     C                   MOVEL     TBLKEY        TBL(C)
040570960209     C                   ADD       1             C
040580960209     C                   ENDIF
040590960209     C                   ENDIF
040600960209     C*
040610960209     C                   EXSR      RTABEL
040620960209     C                   ENDDO
040630970115     C***
040640970115     C* CARICO TABELLA 3F : DICITURE NON AMMESSE NELLA NATURA MERCE
040650970115     C***
040660970115     C                   MOVEL     '3F'          COD
040670970115     C                   Z-ADD     1             C
040680970115     C     KTAB3         SETLL     TABEL
040690970115     C                   EXSR      RTABEL
040700970115     C*
040710970115     C     *IN30         DOWEQ     *OFF
040720970115     C     TBLFLG        IFEQ      ' '
040730970115     C                   MOVEL     TBLKEY        W003A
040740970115     C                   MOVEL     W003A         TBO(C)
040750970115     C                   MOVE      W003A         LDC(C)
040760970115     C                   ADD       1             C
040770970115     C                   ENDIF
040780970115     C*
040790970115     C                   EXSR      RTABEL
040800970115     C                   ENDDO
040810991007     c***
040820991007     c* CARICO TABELLA CODICI VARIE
040830991007     c***
040840991007     C                   MOVEL     '$2'          COD
040850991007     C                   MOVEL     *BLANKS       KEY
040860991007     C                   MOVEL     '1'           KEY
040870991007     C     KTAB2         CHAIN     TABEL                              30
040880991007     C     *IN30         IFEQ      *OFF
040890991007     C                   MOVEL     TBLUNI        DS$2
040900991007     C                   ELSE
040910991007     C                   CLEAR                   DS$2
040920991007     C                   ENDIF
040930991008      *
040940991102      * AGGANCIO TABELLA GED PER DIVISA DELLA MONETA DI CONTO
040950991102     C                   CLEAR                   DSBS02
040960000124     C                   MOVEL     'C'           T02MOD
040970991102     C                   MOVEL     KNSIF         T02SIF
040980991102     C                   MOVEL     'GED'         T02COD
040990991102     C                   MOVEL     '1'           T02KE1
041000991102      *
041010991102     C                   CALL      'TIBS02R'
041020991102     C                   PARM                    KPJBA
041030991102     C                   PARM                    DSBS02
041040991102      *
041050991102     C     T02ERR        IFEQ      *BLANKS
041060991102     C                   MOVEL     T02UNI        DGED
041070991008     C                   ELSE
041080991008     C                   CLEAR                   DGED
041090991008     C                   ENDIF
041100011108     c*
041110011108      * Tabella CV della moneta di conto
041120011212     C                   CLEAR                   DSCV
041130011212     C                   CLEAR                   DECCN
041140020102     C                   CLEAR                   COMFDC
041150011212     C                   MOVEL     'CV'          COD
041160011212     C                   MOVEL(P)  §GEDCN        KEY
041170011212     C                   EXSR      CTABEL
041180011212     C     *IN30         IFEQ      *OFF
041190011212     C                   MOVEL     TBLUNI        DSCV
041200011212     C                   MOVEL     §CVDEC        DECCN
041210020102     C                   MOVEL     §CVFDC        COMFDC
041220011212     C                   ENDIF
041230011108     C*
041240011212      * AGGANCIO TABELLA GEI PER LIMITE FATTURABILE
041250011212     C                   CLEAR                   DSBS02
041260011212     C                   MOVEL     'C'           T02MOD
041270011212     C                   MOVEL     KNSIF         T02SIF
041280011212     C                   MOVEL     'GEI'         T02COD
041290011212     C                   MOVEL     §GEDCN        T02KE1
041300011108      *
041310011212     C                   CALL      'TIBS02R'
041320011212     C                   PARM                    KPJBA
041330011212     C                   PARM                    DSBS02
041340011108      *
041350011212     C     T02ERR        IFEQ      *BLANKS
041360011212     C                   MOVEL     T02UNI        DGEI
041370011212     C                   ELSE
041380011212     C                   CLEAR                   DGEI
041390011212     C                   ENDIF
041400011212     C                   Z-ADD     §GEIMF        IMFGEI
041410000124      *
041420000124      * AGGANCIO TABELLA "CHI" PER TEL E FAX PER EXPORT DPD
041430040525     C***                CLEAR                   DSBS02
041440040525     C***                MOVEL     'C'           T02MOD
041450040525     C***                MOVEL     KNSIF         T02SIF
041460040525     C***                MOVEL     'CHI'         T02COD
041470040525     C***                MOVEL     'TELFAX'      T02KE1
041480000124      *
041490040525     C***                CALL      'TIBS02R'
041500040525     C***                PARM                    KPJBA
041510040525     C***                PARM                    DSBS02
041520000124      *
041530040525     C***  T02ERR        IFEQ      *BLANKS
041540040525     C***                MOVEL     T02UNI        TELFAX
041550040525     C***                ELSE
041560040525     C***                MOVEL     *ALL'?'       TELFAX
041570040525     C***                ENDIF
041580021120
041590021120      * Aggancio tabella default tariffe fedex
041600021120     c                   Clear                   Dsbs02
041610021120     c                   Movel     'C'           T02Mod
041620021120     c                   Movel     KNSIF         T02Sif
041630021120     c                   Movel     'DFE'         T02Cod
041640021120     c                   Movel     'FED'         T02Ke1
041650021120     c                   Call      'TIBS02R'
041660021120     c                   Parm                    Kpjba
041670021120     c                   Parm                    Dsbs02
041680021120     c                   If        T02Err = *Blanks
041690021120     c                   Movel     T02Uni        DDfe
041700021120     c                   Else
041710021120     c                   Clear                   DDfe
041720021120     c                   EndIf
041730040701      * Aggancio tabella "VPO" per reperimento data ultima fase poste
041740040701     C                   CLEAR                   dsbs02
041750040701     c                   clear                   dvpoppt
041760040701     C                   MOVEL     'C'           T02MOD
041770040701     C                   MOVEL     KNSIF         T02SIF
041780040701     C                   MOVEL     'VPO'         T02COD
041790040701     c                   movel(P)  'PPT'         t02ke1
041800040701     C                   CALL      'TIBS02R'
041810040701     C                   PARM                    KPJBA
041820040701     C                   PARM                    dsbs02
041830040701    2C                   IF        T02ERR = *BLANKS
041840040701     C                   MOVEL     T02uni        dvpoppt
041850040701    2C                   ENDIF
041860160829      * Aggancio tabella "VPO" "FNLS01R" per recupero eventuali flag di
041870160829      * forzatura temporanee
041880160829     C                   CLEAR                   dsbs02
041890160829     c                   clear                   dvpols01
041900160829     C                   MOVEL     'C'           T02MOD
041910160829     C                   MOVEL     KNSIF         T02SIF
041920160829     C                   MOVEL     'VPO'         T02COD
041930160829     c                   movel(P)  'LS01'        t02ke1
041940160829     C                   CALL      'TIBS02R'
041950160829     C                   PARM                    KPJBA
041960160829     C                   PARM                    dsbs02
041970160829    2C                   IF        T02ERR = *BLANKS
041980160829     C                   MOVEL     T02uni        dvpols01
041990160829    2C                   ENDIF
042000081111      * Recupero le date delle statistiche
042010081111     c                   Clear                   dsbs02
042020081111     c                   Clear                   dSdf
042030081111     c                   Eval      T02Mod = 'C'
042040081111     c                   Eval      T02Sif = Knsif
042050081111     c                   Eval      T02Cod = 'SDF'
042060081111     c                   Movel(p)  Simfel        T02Ke1
042070081111     c                   Call      'TIBS02R'
042080081111     c                   Parm                    Kpjba
042090081111     c                   Parm                    dsbs02
042100081111     c                   If        T02Err = *Blanks
042110081111     c                   Movel     T02Uni        dSdf
042120081111     c                   EndIf
042130021120
042140000202     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
042150000202     C                   Z-ADD     SIMFEL        W0030
042160000202     C     W0030         CHAIN     AZORG01L      UNIORG               30
042170000202     C                   MOVEL     ORGFEL        WASFEL            3 0
042180000204     C                   MOVEL     ORGDF0        OG150
042190000204     C                   MOVEL     §OGDKC        WASDKC            1
042200170228     c****               Eval      Og143 = Orgde3
042210170228     c****               Eval      LnpOgAs = §OgAs
042220991008     C*
042230930628     C***
042240930628     C* VEDO SE SONO SIMFEL O REMOTO
042250930628     C***
042260930628     C                   MOVEL     SIMFEL        CDU               3 0
042270930628     C*
042280020513     c     simtpp        ifeq      '2'
042290020513     c     simtpp        oreq      *blanks
042300020513     c                   movel     simpou        cdu
042310930628     C                   END
042320941115     C**
042330941115     C* VEDO IL RICHIAMO
042340941115     C**
042350160613     c* Se richiamato in batch per "Vedi Pacco DPD" non bisogna aprire
042360160613     c* il file display
042370160613    1c                   if        §lpfpr<>'D'
042380160613     c                   open      fnls01d
042390160613    1c                   endif
042400160613
042410941115    1C     §LPFPR        IFNE      'C'
042420941115     C     §LPFPR        ANDNE     'G'
042430941115     C     §LPFPR        ANDNE     'I'
042440150302     C     §LPFPR        ANDNE     'B'
042450941115     C*
042460990602     C                   SELECT
042470990602     C* RECUPERO BOLLE
042480990602    2C     PARTCH        WHENEQ    'R'
042490941115     C                   MOVE      DES(4)        VIDTES
042500941115     C                   SETON                                        98
042510990602     C* PROCEDURA PREPAGATI
042520990602    2C     PARTCH        WHENEQ    'P'
042530010301     C     §LPFPR        OREQ      'O'
042540990602     C                   MOVE      DES(6)        VIDTES
042550990602   X2C                   OTHER
042560941115     C                   MOVE      DES(1)        VIDTES
042570990602    2C                   ENDSL
042580941115    1C                   ENDIF
042590941115     C*
042600941115     C* SE IMMISSIONE VISUALIZZO: ULTIMA SPEDIZIONE
042610941115     C                   MOVEL     CULTSP        PREDSS
042620941115     C*
042630941115    1C     §LPFPR        IFNE      'C'
042640941115     C* ESEGUO SOLO UNA VOLTA
042650941115    2C     RIC           IFEQ      ' '
042660941115    3C     §LPFPR        IFNE      ' '
042670010301     C     §LPFPR        ANDNE     'O'
042680941115     C*
042690941115     C* PROVENGO DA MANUTENZIONE
042700941115    4C     §LPFPR        IFEQ      'M'
042701170831    4C     §LPFPR        oreq      'N'
042710941115     C                   SETON                                        12
042720941115     C                   MOVE      DES(2)        VIDTES
042730941115     C                   MOVEL     CVARIA        PREDSS
042740941115     C                   OPEN      FNLBL01L
042750070123     C                   OPEN      FNBRV09L
042760071221     C                   OPEN      FNBRV07L
042770080904     C                   OPEN(e)   TNBLA00F
042780160120     c                   open      fiarbf2c
042790080904     c
042800080904     c                   if        not %open(tnbla00f)
042810080904     c                   eval      %subst(WTNBLA:7:4)='GRPS'
042820080904     C                   OPEN      TNBLA00F
042830080904     c                   endif
042840941115     C*
042850941115   X4C                   ELSE
042860941115     C* PROVENGO DA CARICAMENTO BOLLE DA DISK
042870941115     C                   SETON                                        1215
042880941115     C                   MOVEL     CCONFE        PREDSS
042890020917     C                   OPEN      FIVAD02L
042900020917     C                   OPEN      FIVAT01L
042910040601     C                   OPEN      FIVAX01L
042920140716     C                   OPEN      FNBRV07L
042930941115     C     *IN98         IFEQ      *OFF
042940941115     C                   MOVE      DES(3)        VIDTES
042950941115     C                   ELSE
042960941115     C                   MOVE      DES(5)        VIDTES
042970941115     C                   ENDIF
042980941115     C*
042990941115    4C                   END
043000941115    3C                   END
043010941115    2C                   END
043020941115    1C                   END
043030110518     c*
043040110518     c                   if        not *in12
043050110518     c                   open      fivab01l
043060110518     c                   open      edivab1l
043070110518     c                   endif
043080940819     C*
043090940915     C* QUESTI 2 CAMPI UNA VOLTA IMPOSTATI NON LI TOCCO PIU':
043100070828     c* Non più: la data ritiro a nuova bolla la reimposterò sempre a udate
043110940915     C*
043120960926     C* LINEA DI PARTENZA --> IMPOSTO
043130940915     C  N12              MOVEL     CDU           VIDLNP
043140940915     C* DATA RITIRO       --> IMPOSTO DATA DEL GIORNO
043150990628     C  N12PARTCH        IFNE      'P'
043160010301     C     §LPFPR        ANDNE     'O'
043170070828     C                   MOVEL     WDTGIO        VIDDRT
043180990630     C                   ELSE
043190990630     C                   OPEN      CNNUM00F
043200990628     C                   ENDIF
043210940915     C*
043220930628     C* CAMPI CHE INIZIALIZZO SOLO IN IMMISSIONE BOLLE
043230930628     C*   E PER DISK CLIENTI
043240930628     C   12
043250930628     CAN 15
043260930628     CORN12              DO
043270930628     C                   MOVEL     *ZEROS        RECNSP
043280930628     C                   MOVEL     *ZEROS        VIDDBR
043290930628     C                   MOVEL     *ZEROS        VIDNFV
043300930628     C                   MOVEL     *ZEROS        VIDNSP
043310930628     C                   MOVE      *BLANKS       BLPATB
043320940915     C                   MOVEL     CDU           BLPFLB
043330111128     C****               MOVEL     SIMFEL        BLPFLE
043340940915     C                   MOVEL     *ZEROS        BLPDPC
043350940915     C                   MOVEL     *ZEROS        BLPDUC
043360940819     C                   MOVEL     *ZEROS        BLPFLP
043370930628     C                   MOVEL     *ZEROS        BLPDAM
043380930628     C                   MOVEL     *ZEROS        BLPDCM
043390930628     C                   MOVEL     *ZEROS        BLPHMC
043400930628     C                   MOVEL     *ZEROS        BLPDUT
043410930628     C                   MOVEL     *ZEROS        BLPDET
043420930628     C                   MOVEL     *ZEROS        BLPDSE
043430940915     C                   MOVEL     *ZEROS        BLPVLC
043440930628     C                   MOVEL     *ZEROS        BLPNCR
043450940915     C                   MOVEL     *ZEROS        BLPDT1
043460940915     C                   MOVEL     *ZEROS        BLPDT2
043470940915     C                   MOVEL     *ZEROS        BLPDT3
043480940915     C                   MOVEL     *BLANKS       BLPFT1
043490940915     C                   MOVEL     *BLANKS       BLPFT2
043500940915     C                   MOVEL     *BLANKS       BLPFT3
043510940915     C                   Z-ADD     DATEU         BLPDIM
043520940915     C                   CLEAR                   BLPFDN
043530940915     C                   CLEAR                   BLPNCP
043540940915     C                   CLEAR                   BLPPKC
043550940915     C                   CLEAR                   BLPDTI
043560940915     C                   CLEAR                   BLPHTI
043570940915     C                   CLEAR                   BLPDCE
043580940915     C                   CLEAR                   BLPNPI
043590940915     C                   CLEAR                   BLPNCI
043600940915     C                   CLEAR                   BLPNCR
043610940915     C                   CLEAR                   BLPNDC
043620940915     C                   CLEAR                   BLPDDC
043630940915     C                   CLEAR                   BLPDCP
043640940915     C                   CLEAR                   BLPCCA
043650940915     C                   CLEAR                   BLPTMC
043660040901     c                   clear                   blpscl
043670040329      * per immissione bolle o per conferma bolle da clienti
043680040329      * Se il p.o. è già su AS unico apro TITAS
043690170228     c***                If        LnpOgAs = 946
043700170228     c***                          and Not %Open(Titas30c)
043710170228     c                   if        Not %Open(Titas30c)
043720040329     c                   Clear                   comman
043730040329     c                   Movel(p)  cmdt(1)       comman
043740040329     c                   Eval      %Subst(comman:30:10) = wlib
043750040329     c                   Eval      comman =
043760040329     c                             %trim(comman) + '/TITAS30C)'
043770040329     c                   Call      'QCMDEXC'                            99
043780040329     c                   Parm                    comman
043790040329     c                   Parm                    lenght
043800040329     c  n99              Open      Titas30c
043810040329     c                   EndIf
043820940928     C                   ENDDO
043830151014      * Se il p.o. è già su AS unico apro FIAR5 di sede
043840170228     c****               If        LnpOgAs = 946
043850170228     c***                          and Not %Open(fiar531c)
043860170228     c                   if        Not %Open(fiar531c)
043870151014     c                   Clear                   comman
043880151015     c                   Movel(p)  cmdt(2)       comman
043890151014     c                   Eval      %Subst(comman:30:10) = wlib
043900151014     c                   Eval      comman =
043910151014     c                             %trim(comman) + '/FIAR531C)'
043920151014     c                   Call      'QCMDEXC'                            99
043930151014     c                   Parm                    comman
043940151014     c                   Parm                    lenght
043950151014     c  n99              Open      fiar531c
043960151014     c                   EndIf
043970930611     C*
043980930611     C* STAMPA DEI 3 ASTERISCHI ALLA FINE SE><0
043990930611     C                   Z-ADD     0             I100              1 0
044000930628     C*
044010930628     C                   MOVEL     'C'           RIC               1
044020940920     C* SIGLA OPERATORE:
044030940920     C* IN IMMISSIONE SEMPRE SPROTETTA
044040940920     C     *IN12         IFEQ      *OFF
044050940920     C                   SETOFF                                       13
044060940920     C                   ENDIF
044070940920     C*
044080940920     C* IN DISK CLIENTI SEMPRE PROTETTA
044090940920     C     *IN12         IFEQ      *ON
044100940920     C     *IN15         ANDEQ     *ON
044110940920     C                   SETON                                        13
044120940920     C                   ENDIF
044130940920     C* IN MANUTENZIONE SOLO SE E' UNA SIGNA NON UTILIZABILE:
044140940920     C* LO CONTROLLO BOLLA PER BOLLA QUINDI IN CARBLP LO FACCIO
044150941117     C                   CLEAR                   SAVFIE
044160160219     C                   CLEAR                   s_27ntw
044170971215     C* IMPOSTO LA DS ESTERA PER I CAMPI FISSI
044180971215     C                   CLEAR                   DSBLD
044190971215     C                   CLEAR                   DSBLDE
044200000120     C*
044210170214     C***                MOVEL     'CHI'         KTCOD
044220170214     C***                MOVEL     WASFEL        KTKE1
044230170214     C***                CLEAR                   KTLIN
044240170214     C***                CLEAR                   KTSIF
044250170214     C***                CLEAR                   KTKE2
044260010319     C* VEDO SE IN L1 PRESENTE P.O. DPD
044270010319     C                   CLEAR                   WSIDPD
044280010319     C                   Z-ADD     1             II
044290010319     C     II            DOWLE     30
044300010319     C     WSIDPD        ANDEQ     *BLANKS
044310010319     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
044320010319     C  N30              MOVEL     ORGDE3        OG143
044330010319     C   30              CLEAR                   OG143
044340020319     C     §OGntw        IFEQ      'DPD'
044350010319     C                   MOVEL     'S'           WSIDPD            1
044360010319     C                   ENDIF
044370010319     C                   ADD       1             II
044380010319     C                   ENDDO
044390051124     c* imposto campi fissi da passare a fnlsa8r
044400051124     c**                 z-add     simfel        parfel
044410051124     c**                 movel     '1'           parflg
044420130117
044430130117      * Carico la tabella OSR
044440130117     c                   exsr      carosr
044450130117
044460920220     C                   ENDSR
044470130117
044480130117      /free
044490130117       // ----------------------------------------------------------------------
044500130117       //?Carico tabella OSR.
044510130117       // ----------------------------------------------------------------------
044520130117       begsr carosr;
044530130117
044540130117         clear osrxx;
044550130117
044560130117       //?carico tutta la tabella OSR delle LNP/NRS ORM
044570130117         setll    c_tabosr tntbe01l;
044580130117         reade(n) c_tabosr tntbe01l;
044590130117
044600130117         dow not %eof(tntbe01l);
044610130122           IF  TBEatb = *blanks;
044620130117           dosr = tbeuni;
044630130117       //?carico in sk tutti i clienti che trovo
044640130117       //?skCLIosr = cliente
044650130117       //?skLNPNRSosr = LNP + serie (TBEke1)
044660130117           IF d§osrcli <> 0;
044670130117             osrxx = %lookup(d§OSRcli:skCLIosr);
044680130117             IF  osrxx = 0;
044690130117               osrxx = %lookup(*zeros:skCLIosr);
044700130117               IF  osrxx > 0;
044710130117                 skCLIosr(osrxx) = d§OSRcli;
044720130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044730130117               ENDIF;
044740130117             ENDIF;
044750130117           ENDIF;
044760130117
044770130117           IF d§osrcl2 <> 0;
044780130117             osrxx = %lookup(d§OSRcl2:skCLIosr);
044790130117             IF  osrxx = 0;
044800130118               osrxx = %lookup(*zeros:skCLIosr);
044810130117               IF  osrxx > 0;
044820130117                 skCLIosr(osrxx) = d§OSRcl2;
044830130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044840130117               ENDIF;
044850130117             ENDIF;
044860130117           ENDIF;
044870130117
044880130117           IF d§osrcl3 <> 0;
044890130117             osrxx = %lookup(d§OSRcl3:skCLIosr);
044900130117             IF  osrxx = 0;
044910130117               osrxx = %lookup(*zeros:skCLIosr);
044920130117               IF  osrxx > 0;
044930130117                 skCLIosr(osrxx) = d§OSRcl3;
044940130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044950130117               ENDIF;
044960130117             ENDIF;
044970130117           ENDIF;
044980130117
044990130117           IF d§osrcl4 <> 0;
045000130117             osrxx = %lookup(d§OSRcl4:skCLIosr);
045010130117             IF  osrxx = 0;
045020130117               osrxx = %lookup(*zeros:skCLIosr);
045030130117               IF  osrxx > 0;
045040130117                 skCLIosr(osrxx) = d§OSRcl4;
045050130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045060130117               ENDIF;
045070130117             ENDIF;
045080130117           ENDIF;
045090130117
045100130117           IF d§osrcl5 <> 0;
045110130117             osrxx = %lookup(d§OSRcl5:skCLIosr);
045120130117             IF  osrxx = 0;
045130130117               osrxx = %lookup(*zeros:skCLIosr);
045140130117               IF  osrxx > 0;
045150130117                 skCLIosr(osrxx) = d§OSRcl5;
045160130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045170130117               ENDIF;
045180130117             ENDIF;
045190130117           ENDIF;
045200130117
045210130117           IF d§osrcl6 <> 0;
045220130117             osrxx = %lookup(d§OSRcl6:skCLIosr);
045230130117             IF  osrxx = 0;
045240130117               osrxx = %lookup(*zeros:skCLIosr);
045250130117               IF  osrxx > 0;
045260130117                 skCLIosr(osrxx) = d§OSRcl6;
045270130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045280130117               ENDIF;
045290130117             ENDIF;
045300130117           ENDIF;
045310130117
045320130117           IF d§osrcl7 <> 0;
045330130117             osrxx = %lookup(d§OSRcl7:skCLIosr);
045340130117             IF  osrxx = 0;
045350130117               osrxx = %lookup(*zeros:skCLIosr);
045360130117               IF  osrxx > 0;
045370130117                 skCLIosr(osrxx) = d§OSRcl7;
045380130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045390130117               ENDIF;
045400130117             ENDIF;
045410130117           ENDIF;
045420130117
045430130117           IF d§osrcl8 <> 0;
045440130117             osrxx = %lookup(d§OSRcl8:skCLIosr);
045450130117             IF  osrxx = 0;
045460130117               osrxx = %lookup(*zeros:skCLIosr);
045470130117               IF  osrxx > 0;
045480130117                 skCLIosr(osrxx) = d§OSRcl8;
045490130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045500130117               ENDIF;
045510130117             ENDIF;
045520130117           ENDIF;
045530130117
045540130117           IF d§osrcl9 <> 0;
045550130117             osrxx = %lookup(d§OSRcl9:skCLIosr);
045560130117             IF  osrxx = 0;
045570130117               osrxx = %lookup(*zeros:skCLIosr);
045580130117               IF  osrxx > 0;
045590130117                 skCLIosr(osrxx) = d§OSRcl9;
045600130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045610130117               ENDIF;
045620130117             ENDIF;
045630130117           ENDIF;
045640130117
045650130117           IF d§osrcl10 <> 0;
045660130117             osrxx = %lookup(d§OSRcl10:skCLIosr);
045670130117             IF  osrxx = 0;
045680130117               osrxx = %lookup(*zeros:skCLIosr);
045690130117               IF  osrxx > 0;
045700130117                 skCLIosr(osrxx) = d§OSRcl10;
045710130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045720130117               ENDIF;
045730130117             ENDIF;
045740130117           ENDIF;
045750130117
045760130117           IF d§osrcl11 <> 0;
045770130117             osrxx = %lookup(d§OSRcl11:skCLIosr);
045780130117             IF  osrxx = 0;
045790130117               osrxx = %lookup(*zeros:skCLIosr);
045800130117               IF  osrxx > 0;
045810130117                 skCLIosr(osrxx) = d§OSRcl11;
045820130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045830130117               ENDIF;
045840130117             ENDIF;
045850130117           ENDIF;
045860130117
045870130117           IF d§osrcl12 <> 0;
045880130117             osrxx = %lookup(d§OSRcl12:skCLIosr);
045890130117             IF  osrxx = 0;
045900130117               osrxx = %lookup(*zeros:skCLIosr);
045910130117               IF  osrxx > 0;
045920130117                 skCLIosr(osrxx) = d§OSRcl12;
045930130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045940130117               ENDIF;
045950130117             ENDIF;
045960130117           ENDIF;
045970130117
045980130117           IF d§osrcl13 <> 0;
045990130117             osrxx = %lookup(d§OSRcl13:skCLIosr);
046000130117             IF  osrxx = 0;
046010130117               osrxx = %lookup(*zeros:skCLIosr);
046020130117               IF  osrxx > 0;
046030130117                 skCLIosr(osrxx) = d§OSRcl13;
046040130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
046050130117               ENDIF;
046060130117             ENDIF;
046070130117           ENDIF;
046080130117
046090130117           IF d§osrcl14 <> 0;
046100130117             osrxx = %lookup(d§OSRcl14:skCLIosr);
046110130117             IF  osrxx = 0;
046120130117               osrxx = %lookup(*zeros:skCLIosr);
046130130117               IF  osrxx > 0;
046140130117                 skCLIosr(osrxx) = d§OSRcl14;
046150130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
046160130117               ENDIF;
046170130117             ENDIF;
046180130117           ENDIF;
046190130117
046200130117           IF d§osrcl15 <> 0;
046210130117             osrxx = %lookup(d§OSRcl15:skCLIosr);
046220130117             IF  osrxx = 0;
046230130117               osrxx = %lookup(*zeros:skCLIosr);
046240130117               IF  osrxx > 0;
046250130117                 skCLIosr(osrxx) = d§OSRcl15;
046260130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
046270130117               ENDIF;
046280130117             ENDIF;
046290130117           ENDIF;
046300130117
046310130117           IF d§osrcl16 <> 0;
046320130117             osrxx = %lookup(d§OSRcl16:skCLIosr);
046330130117             IF  osrxx = 0;
046340130117               osrxx = %lookup(*zeros:skCLIosr);
046350130117               IF  osrxx > 0;
046360130117                 skCLIosr(osrxx) = d§OSRcl16;
046370130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
046380130117               ENDIF;
046390130117             ENDIF;
046400130117           ENDIF;
046410130122
046420130122           ENDIF;
046430130117
046440130117           reade(n) c_tabosr tntbe01l;
046450130117         enddo;
046460130117
046470130117       endsr;
046480130117      /end-free
046490900427     C*
046500900427     C*--- PULIZIA CAMPI FORMATO1 ------------------------------------*
046510940819     C     INZ01         BEGSR
046520950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
046530950126     C                   EXSR      OFFD01
046540900427     C*
046550991014     C                   CLEAR                   DSLV04
046560940222     C                   MOVE      ' '           UNO               1
046570940930     C                   MOVE      0             DUE               1 0
046580940930     C                   MOVE      0             TRE               1 0
046590920427     C                   MOVE      0             QUA               1 0
046600100209     C                   MOVE      0             QUAH              1 0
046610940930     C                   MOVE      0             CIN               1 0
046620940930     C                   MOVE      0             SEI               1 0
046630941020     C                   MOVE      0             SET               1 0
046640940930     C                   MOVE      0             OTT               1 0
046650910801     C                   MOVEL     ' '           NOV               1
046660940930     C                   MOVEL     0             DIE               1 0
046670950102     C                   MOVEL     0             UND               1 0
046680950410     C                   MOVEL     0             DOD               1 0
046690160726     C*****              MOVEL     0             QUI               1 0
046700961111     C                   MOVEL     0             SED               1 0
046710040213     C**!!!              MOVEL     0             DIC               1 0
046720040213     C**!!!              MOVEL     0             VEN               1 0
046730990610     C                   MOVEL     0             SES               1 0
046740970702     C                   MOVEL     0             AAA               1 0
046750970702     C                   MOVEL     0             AAB               1 0
046760990915     C                   MOVEL     0             AAC               1 0
046770991213     C                   MOVEL     0             AAD               1 0
046780970704     C                   MOVEL     0             MMA               1 0
046790970704     C                   MOVEL     0             MMB               1 0
046800000622     C                   MOVEL     0             MMD               1 0
046810970704     C                   MOVEL     0             COMA              1 0
046820970704     C                   MOVEL     0             COMB              1 0
046830990915     C                   MOVEL     ' '           WFPR              1
046840000509     C                   MOVEL     ' '           WPT1              1
046850001025     C                   MOVEL     ' '           VIDMAG
046860010504     C                   MOVE      ' '           WFORZO
046870990915     C                   CLEAR                   SAVPD4
046880030417     c                   Clear                   fordcr
046890030704     c                   Clear                   wforw03
046900030728     c                   Clear                   wfornba
046910031001     c                   Clear                   wfortbo
046920031201     c                   Clear                   wnoccm
046930060515     c                   clear                   bolksc
046940060515     c                   clear                   bolctr
046950040216     c                   Eval      wforza1 = *Off
046960040216     c                   Eval      wforza2 = *Off
046970110321     c                   Eval      wforzbrv = *Off
046980110422     c                   Eval      wforzadrt = *Off
046990141124     c                   clear                   wforz_lna
047000141124     c                   clear                   wforz_lnap
047010041116     c                   clear                   wnprpre
047020060104     C                   MOVEL     *ZEROS        VARZNC
047030941107     C* PULISCO LA DS DI STAMPA
047040991007     C  N12              CLEAR                   DTAS
047050991007     C  N12              CLEAR                   DTASV
047060030626     C                   CLEAR                   fnlsb5DS
047070941115     C                   CLEAR                   WESVAR
047080950209     C                   CLEAR                   DS1A
047090950120     C                   CLEAR                   WIN11
047100950120     C                   CLEAR                   WIN88
047110940926     C*
047120940926     C* CAMPI CHE MI INDICATO SE E' PRESENTE UNA ESTENSIONE BOLLA
047130991006     C                   CLEAR                   WAR62
047140991006     C                   CLEAR                   WAR61
047150050331     C                   CLEAR                   WKSCsf1
047160050331     C                   CLEAR                   WKSCsf2
047170991006     C                   CLEAR                   WAR7
047180040114     c                   Clear                   war71
047190051115     C                   CLEAR                   War9
047200000623     C                   CLEAR                   WES3Q
047210000623     C                   CLEAR                   WBL4W
047220040116     c                   Clear                   wesvar1
047230940926     C*
047240950126     C                   CLEAR                   WSBORD
047250940930     C                   CLEAR                   VARCAD
047260940930     C                   CLEAR                   VARCAM
047270940926     C                   CLEAR                   SAVFTM
047280940921     C                   CLEAR                   SAVFLC
047290940922     C                   CLEAR                   SAVCTR
047300961111     C                   CLEAR                   SAVFBR
047310961122     C                   CLEAR                   SAVCBO
047320000211     C                   CLEAR                   WESSGN
047330100209     C                   CLEAR                   Sa2TSP
047340941005     C* CANCELLO I CAMPI DI CONFRONTO PER RICARICARE COD TARIFFA
047350941005     C                   CLEAR                   VARTSP
047360941107     C                   CLEAR                   WFIE
047370990610     C                   CLEAR                   WCOCCM
047380050926     c* pulizia campo per errore forzabile su volume in base alla tarif
047390050926     c* fa
047400050926     c                   clear                   fvol
047410941231     C**
047420941231     C* IL CAMPO SAVCCM MI SERVE PER IL CONFRONTO DEL CODICE CLI
047430941231     C*  PER CARICARE LE TARIFFE RELATIVE
047440941231     C                   Z-ADD     1             SAVCCM
047450940922     C* SPENGO INDICATORI DI ABILITAZIONE RICERCA MITTENTE E FIL CLIENT
047460941020     C                   SETOFF                                       0138
047470940922     C* INDICATORI DI "RI" PER CAMPI PRESI DA TARIFFA
047480941107     C                   SETOFF                                       97
047490040610     c     atrbva        ifne      prri
047500040610     c                   movel     hiul          atrbva
047510040610     c                   endif
047520990630     C* INDICATORI DI PTOTEZIONE DATI FATTURA E VISUL.TOT IMPONIBILE
047530990630     C                   SETOFF                                       22
047540000915     C* INDICATORE ABILITAZIONE TASTO F22-MANTUENZIONE COD.CHI SONO
047550000915     C                   SETOFF                                       96
047560051123     c* Protezione codice bolla
047570051123     C                   CLEAR                   ATRcbo
047580070801     c* imposto no display l'attributo della costante video:"Da ORM" che
047590070801     c* deve essere visualizzata quando la data ritiro viene modificata
047600070801     c* proponendola da ORM
047610070801     c                   movel     nodi          atrdaorm
047620070918     c                   clear                   s_drt
047630070831     c* data ritiro
047640070831     c                   exsr      inzdrt
047650111124     c*
047660111124     c                   clear                   vidno1
047670111124     c                   clear                   vidno2
047680111128     c                   clear                   viddno
047690940922     C*
047700940819     C* 24 ON - DATA SPEDIZIONE PERSONALIZZATA
047710940819     C     *IN24         IFEQ      *OFF
047720940819     C                   Z-ADD     WDTGIO        VIDDSP
047730940819     C                   ENDIF
047740010222     C* 37 ON - NUMERO O.R.M. PERSONALIZZATO
047750010222     C     *IN37         IFEQ      *OFF
047760040909     c                   clear                   vidpoe
047770010222     C                   CLEAR                   VIDNOR
047780010222     C                   CLEAR                   VIDNRV
047790011126     C                   CLEAR                   ATRDES
047800011205     C                   CLEAR                   SORMFD
047810010222     C                   ENDIF
047820940819     C* 21 ON - CODICE BOLLA   PERSONALIZZATO
047830940819     C     *IN21         IFEQ      *OFF
047840940819     C                   MOVEL     *BLANKS       VIDCBO
047850940819     C                   ENDIF
047860940819     C* 20 ON - LINEA DI ARRIVO PERSONALIZZATO
047870940819     C     *IN20         IFEQ      *OFF
047880950208     C                   Z-ADD     0             CO2LNA
047890950208     C                   Z-ADD     0             COMLNA
047900020213     C                   CLEAR                   A_OG143
047910040525     C                   CLEAR                   A_OG150
047920940819     C                   MOVEL     *BLANKS       VIDLNA
047930940920     C                   MOVEL     *BLANKS       V1DLNA
047940940819     C                   ENDIF
047950940819     C* 18 ON - TIPO SERVIZIO PERSONALIZZATO
047960940819     C     *IN18         IFEQ      *OFF
047970940819     C                   MOVEL     *BLANKS       VIDTSP
047980941005     C                   MOVEL     *BLANKS       V1DTSP
047990950303     C                   CLEAR                   V2DTSP
048000940819     C                   ENDIF
048010940819     C* 26 ON - CODICE TRATTAMENTO MERCE PERSONALIZZATO
048020940819     C     *IN26         IFEQ      *OFF
048030940819     C                   MOVEL     *BLANKS       VIDCTM
048040940920     C                   MOVEL     *BLANKS       V1DCTM
048050940819     C                   ENDIF
048060940920     C* 28 ON - TASSAZ TARIFFA MITTENTE PERSONALIZZATO
048070940819     C     *IN28         IFEQ      *OFF
048080940819     C                   MOVEL     *BLANKS       VIDFTM
048090940819     C                   ENDIF
048100940921     C* 19 ON - MITTENTE PERSONALIZZATO
048110950303     C* 85 ON - COD.MITTENTE PERSONALIZZATO
048120940921     C     *IN19         IFEQ      *OFF
048130950303     C*
048140950303     C     *IN85         IFEQ      *OFF
048150950123     C                   CLEAR                   WCCMS
048160941005     C                   CLEAR                   VIDFLC
048170941005     C                   CLEAR                   VIDCCM
048180950303     C                   CLEAR                   VIDDMT
048190950303     C                   ENDIF
048200950303     C                   CLEAR                   V2DTEL
048210940921     C                   CLEAR                   VIDRSM
048220940921     C                   CLEAR                   VIDINM
048230940921     C                   CLEAR                   VIDCAM
048240940921     C                   CLEAR                   VIDPRM
048250950303     C                   CLEAR                   VIDLOM
048260940921     C                   CLEAR                   VIDPIM
048270061109     C                   CLEAR                   VIDcdf
048280061109     c                   movel     hiul          atrcdf
048290080804     c                   clear                   forzcdf           1
048300120504     c                   clear                   forzcdf1          1
048310061109     c                   clear                   savrsm
048320940921     C                   CLEAR                   VIDNZM
048330940921     C                   CLEAR                   VIDFAP
048340941020     C                   SETOFF                                       14
048350940921     C                   ENDIF
048360940825     C* DESTINATARIO
048370940819     C                   MOVEL     *BLANKS       VIDRSD
048380940819     C                   MOVEL     *BLANKS       VIDIND
048390940819     C                   MOVEL     *BLANKS       VIDLOD
048400940819     C                   MOVEL     *BLANKS       VIDPRD
048410940819     C                   MOVEL     *BLANKS       VARPRD
048420940819     C                   MOVEL     *BLANKS       VIDNZD
048430940819     C                   CLEAR                   VIDCAD
048440940928     C                   CLEAR                   VIDPID
048450940819     C                   MOVEL     *BLANKS       VIDFIN
048460030305     c                   Clear                   savdisag
048470070924     c                   Clear                   savpart
048480050214     c                   Clear                   wdesie
048490940819     C*
048500940915     C* ULTIMA SPEDIZIONE        SE IMMISSIONE BOLLA (12 OFF)
048510940819     C     *IN12         IFEQ      *OFF
048520010301     C     §LPFPR        ANDNE     'O'
048530900427     C                   Z-ADD     BLPNRS        PRENRS
048540900427     C                   Z-ADD     BLPNSP        PRENSP
048550941011     C                   MOVEL     BLPLNA        PRELNA
048560900427     C                   Z-ADD     BLPRMN        PRERMN
048570910128     C                   Z-ADD     BLPZNC        PREZNC
048580940819     C                   ENDIF
048590940819     C*
048600900427     C                   Z-ADD     0             VIDPKG
048610980402     C                   Z-ADD     0             SAVPKG
048620940819     C                   Z-ADD     0             V1CNCL
048630090609     c                   clear                   wncl_pre
048640090609     c                   clear                   wpes_pre
048650111026     c                   clear                   savtsp73
048660971222     C* PULISCO I CAMPI DELL'EXPORT SDI
048670971222     C                   CLEAR                   DSBL4E
048680900502     C* PULISCO ALCUNI CAMPI DEL FOR02
048690900517     C                   Z-ADD     0             VIDZNC
048700930628     C     *IN12         IFEQ      *ON
048710930628     C                   CLEAR                   VIDTCR
048720930628     C                   CLEAR                   VIDDCR
048730930628     C                   CLEAR                   VIDHCR
048740030409     c                   Clear                   VidOre
048750930628     C                   CLEAR                   VIDMCR
048760930628     C                   CLEAR                   VIDCTR
048770930628     C                   CLEAR                   DEFCTR
048780930628     C                   CLEAR                   VIDNAS
048790040610     c                   clear                   vidbva
048800960319     C                   CLEAR                   VIDGC1
048810960319     C                   CLEAR                   VIDGC2
048820930628     C                   ELSE
048830940920     C  N17              MOVEL     ' '           VIDTCR
048840930628     C  N16              MOVEL     *ZEROS        VIDDCR
048850940920     C  N23              MOVEL     *ZEROS        VIDHCR
048860940920     C  N23              MOVEL     *ZEROS        VIDMCR
048870030409     c                   If        wflagore = *Blanks
048880030409     c                   Clear                   VidOre
048890030409     c                   EndIf
048900930628     C  N29              CLEAR                   VIDCTR
048910930628     C  N29              CLEAR                   DEFCTR
048920940825     C  N27              CLEAR                   VIDNAS
048930040610     c     atrbva        ifne      prri
048940040610     c                   clear                   vidbva
048950040610     c                   endif
048960960319     C  N91              CLEAR                   VIDGC1
048970960319     C  N91              CLEAR                   VIDGC2
048980960319     C                   ENDIF
048990990630     C* MEMORIZZO E PROTEGGO LA DATA PER I PREPAGATI
049000990630     C     PARTCH        IFEQ      'P'
049010010301     C     §LPFPR        OREQ      'O'
049020990630     C                   Z-ADD     WDTGIO        VIDDSP
049030990701     C                   SETON                                        2426
049040990630     C                   SETON                                        3422
049050990630     C* IMPOSTO FISSO IL CTM
049060990630     C                   MOVEL     §3ICTP        VIDCTM
049070990630     C* IMPOSTO IL COD MITTENTE --> 8888
049080990720     C* SOLO SE NON PERSONALIZZATO
049090010307     C     PARTCH        IFEQ      'P'
049100990720     C  N19
049110990720     CANN85              Z-ADD     8888          VIDCCM
049120010307     C                   ENDIF
049130990630     C                   ENDIF
049140050126     c* autotrasportatore
049150050426     c***  atrpdr        ifne      prri
049160050426     c***                clear                   vidpdr
049170050426     c***                clear                   v1dpdr
049180050426     c**n34              movel     '?'           vidpdr
049190050426     c***                endif
049200050126     c* flag mattino pomeriggio
049210050426     c***  atrfpp        ifne      prri
049220050426     c***                clear                   vidfpp
049230050426     c***                endif
049240031113     c                   Clear                   VidRef
049250031113     c                   Clear                   VidTel
049260031219     c                   Clear                   wrifp
049270141031     c                   Clear                   wPinCode
049280000120     C*
049290000120     C                   CLEAR                   VIDDPD
049300000120     C                   CLEAR                   VIDNRD
049310000120     C                   CLEAR                   COMNRD
049320050315     C                   MOVE      *BLANKS       VIDFFD
049330010223     C                   CLEAR                   WOVUO
049340070427     C                   CLEAR                   WOVUO1
049350010226     C                   CLEAR                   CHGORM
049360090327     C                   CLEAR                   CHGORM1
049370091120     C                   CLEAR                   CHGORM2
049380090327     C                   CLEAR                   w_fcli
049390110512     c* imposto no display l'attributo della costante video:"F17=ind.mail dest
049400110512     c* che deve essere visualizzata solo quando ricevo il dato da VAT
049410150213     c                   movel     nodi          atremd
049420150213     c***                movel     ndpr          atrwemd
049430150213     c***                movel     ndpr          atrwtel
049440110512     c                   clear                   wemdest
049450160511     c                   clear                   sav_wemdest
049460130315     c                   clear                   wsms
049470160511     c                   clear                   sav_wsms
049480130315     c                   clear                   wsmp
049490130918     c                   clear                   wmmp
049500130923     c                   clear                   wmmp_ar5
049510110705     c* visualizzazione f19=CUP/CIG solo da data attivazione
049520110705     C                   IF        DATEU < §VPOTFF
049530110705     c                   movel     nodi          atrCUP
049540110705     C                   ELSE
049550110705     c                   clear                   atrCUP
049560110705     C                   ENDIF
049570110706     c                   clear                   wcupcup
049580110706     c                   clear                   wcupcig
049590141201     c                   clear                   wpincode
049600130311
049610130311     c                   clear                   wvatpe
049620160323     c                   clear                   wtip
049630160323     c                   clear                   w_vediP
049640900427     C                   ENDSR
049650070831     C*
049660070831     C* inizializzazione campo data ritiro --------------------------*
049670070831     C     inzdrt        BEGSR
049680070831     c* data ritiro=udate se data ritiro non personalizzata
049690070831     C  N12PARTCH        IFNE      'P'
049700070831     C     §LPFPR        ANDNE     'O'
049710071107     c***  dateu         andge     §vpodrt
049720070831     c                   if        atrdrt<>prri or viddrt=0
049730070831     C                   MOVEL     WDTGIO        VIDDRT
049740070831     c                   endif
049750070831     c                   endif
049760070831     c                   endsr
049770940819     C*
049780940819     C* GESTIONE VIDEATA DI PERSONALIZZAZIONE -----------------------*
049790050118     C     GESD00        BEGSR
049800940824     C                   MOVEL     'P'           WPERSO            1
049810940819     C*
049820941230     C                   CLEAR                   V0CRSM
049830941230     C                   CLEAR                   V0CINM
049840941230     C                   CLEAR                   V0CCAM
049850941230     C                   CLEAR                   V0CLOM
049860941230     C                   CLEAR                   V0CPRM
049870941230     C                   CLEAR                   V0CNZM
049880941230     C                   CLEAR                   V0CPIM
049890061109     C                   CLEAR                   V0Ccdf
049900061109     c                   movel     hiul          atrcdf
049910941230     C                   CLEAR                   V0CFAP
049920941230     C                   CLEAR                   V0CLNA
049930941230     C                   CLEAR                   V0CCBO
049940941230     C                   CLEAR                   V0CTSP
049950941230     C                   CLEAR                   V0CCTM
049960941230     C                   CLEAR                   V0CCCM
049970941230     C                   CLEAR                   V0CFLC
049980941230     C                   CLEAR                   V0CCTR
049990941230     C                   CLEAR                   V0CNAS
050000040610     C                   CLEAR                   V0Cbva
050010941230     C                   CLEAR                   V0CTCR
050020941230     C                   CLEAR                   V0CDCR
050030941230     C                   CLEAR                   V0CHCR
050040941230     C                   CLEAR                   V0CMCR
050050941230     C                   CLEAR                   V0CRMO
050060941230     C                   CLEAR                   V0CNMO
050070941230     C                   CLEAR                   V0CCMO
050080960319     C                   CLEAR                   V0CGC1
050090960319     C                   CLEAR                   V0CGC2
050100010209     C                   CLEAR                   V0CNOR
050110010209     C                   CLEAR                   V0CNRV
050120030409     c                   Clear                   V0cOre
050130050426     c***                clear                   v0cpdr
050140050426     c***                clear                   v0cfpp
050150940819     C* MUOVO TUTTI I CAMPI DAL VIDEO 1 PER LA PERSONALIZZAIZONE
050160941230     C* SOLO SE LI AVEVO PERSONALI<ZZATI E QUELLI CHE RIMANGONO
050170941230     C*  SEMPRE IMPOSTATI
050180941230     C                   MOVEL     VIDSOP        V0CSOP
050190010502     C* NON IMPOSTO, NELLA VIDEATA DI PERSONALIZZAZIONE LA RICERCA ALFA
050200010502     C* BETICA SU PADRONCINO SE ATTIVATA PROCEDURA ORM
050210050426     c***  atrpdr        ifeq      prri
050220050426     C     WORM          IFNE      'S'
050230050426     C     VIDPDR        ORNE      '?   '
050240940819     C                   MOVEL     VIDPDR        V0CPDR
050250050426     c***                clear                   vidpdr
050260010502     C                   ENDIF
050270050426     c***  atrfpp        ifeq      prri
050280050126     C                   MOVEL     VIDFPP        V0CFPP
050290050426     c***                clear                   vidfpp
050300050426     c***                endif
050310940819     C                   MOVEL     VIDNRT        V0CNRT
050320940819     C                   MOVEL     VIDLNP        V0CLNP
050330010222     C                   Z-ADD     VIDPOE        V0CPOE
050340010222     C   37              Z-ADD     VIDNOR        V0CNOR
050350041108     C   37              Z-ADD     VIDNRV        V0CNRV
050360070828     c***37              movel     atrdaorm      at0daorm
050370070828     c                   movel     nodi          at0daorm
050380071107     c***                if        dateu>=§vpodrt
050390070828     c                   clear                   viddrt
050400071107     c***                endif
050410041220     c                   z-add     vidpoe        s_v0cpoe
050420041220     c                   z-add     vidnor        s_v0cnor
050430041220     c                   z-add     vidnrv        s_v0cnrv
050440050315     C   37              MOVE      'P'           s_ormpers
050450050315     C  N37              MOVE      ' '           s_ormpers
050460010222     C   37              CLEAR                   VIDPOE
050470010222     C   37              CLEAR                   VIDNOR
050480010222     C   37              CLEAR                   VIDNRV
050490941230     C   20              MOVEL     VIDLNA        V0CLNA
050500941231     C   20              CLEAR                   VIDLNA
050510941230     C   21              MOVEL     VIDCBO        V0CCBO
050520941231     C   21              CLEAR                   VIDCBO
050530941230     C   18              MOVEL     VIDTSP        V0CTSP
050540941231     C   18              CLEAR                   VIDTSP
050550941230     C   26              MOVEL     VIDCTM        V0CCTM
050560941231     C   26              CLEAR                   VIDCTM
050570950125     C     *IN19         IFEQ      *ON
050580950303     C     *IN85         OREQ      *ON
050590950125     C                   MOVEL     VIDCCM        V0CCCM
050600950125     C                   CLEAR                   VIDCCM
050610050120     c***                clear                   viddmt
050620950125     C                   MOVEL     VIDFLC        V0CFLC
050630950125     C                   CLEAR                   VIDFLC
050640950303     C                   ENDIF
050650941221     C* SE NON E' UN CODIFICATO, IMPOSTO IL MITTENTE COSI' COME E'
050660950303     C     *IN19         IFEQ      *ON
050670020507     C     V0CCCM        ifeQ      8888
050680950125     C     V0CCCM        OREQ      9999
050690940819     C                   MOVEL     VIDRSM        V0CRSM
050700940819     C                   MOVEL     VIDINM        V0CINM
050710940819     C                   MOVEL     VIDLOM        V0CLOM
050720940819     C                   MOVEL     VIDCAM        V0CCAM
050730940819     C                   MOVEL     VIDPRM        V0CPRM
050740940819     C                   MOVEL     VIDNZM        V0CNZM
050750940819     C                   MOVEL     VIDFAP        V0CFAP
050760940819     C                   MOVEL     VIDPIM        V0CPIM
050770061109     C                   MOVEL     VIDcdf        V0Ccdf
050780950125     C                   ENDIF
050790941231     C                   CLEAR                   VIDRSM
050800941231     C                   CLEAR                   VIDINM
050810941231     C                   CLEAR                   VIDLOM
050820941231     C                   CLEAR                   VIDCAM
050830941231     C                   CLEAR                   VIDPRM
050840941231     C                   CLEAR                   VIDNZM
050850941231     C                   CLEAR                   VIDFAP
050860941231     C                   CLEAR                   VIDPIM
050870061109     C                   CLEAR                   VIDcdf
050880941230     C                   ENDIF
050890941230     C   28              MOVEL     VIDFTM        V0CFTM
050900941231     C   28              CLEAR                   VIDFTM
050910941230     C   27              MOVEL     VIDNAS        V0CNAS
050920941231     C   27              CLEAR                   VIDNAS
050930040610     c     atrbva        ifeq      prri
050940040610     C                   MOVEL     VIDbva        V0Cbva
050950040610     C                   CLEAR                   VIDbva
050960040610     c                   endif
050970941230     C   17              MOVEL     VIDTCR        V0CTCR
050980941231     C   17              CLEAR                   VIDTCR
050990941230     C   16              MOVEL     VIDDCR        V0CDCR
051000941231     C   16              CLEAR                   VIDDCR
051010941230     C   23              MOVEL     VIDHCR        V0CHCR
051020941230     C   23              MOVEL     VIDMCR        V0CMCR
051030941231     C   23              CLEAR                   VIDHCR
051040941231     C   23              CLEAR                   VIDMCR
051050030409     c                   If        wflagore = '1'
051060030409     c                   Eval      V0cOre = VidOre
051070030409     c                   Clear                   VidOre
051080030409     c                   EndIf
051090941230     C   03              MOVEL     VIDRMO        V0CRMO
051100941230     C   03              MOVEL     VIDNMO        V0CNMO
051110941231     C   03              CLEAR                   VIDRMO
051120941231     C   03              CLEAR                   VIDNMO
051130941230     C   03              MOVEL     VIDCMO        V0CCMO
051140941231     C   03              CLEAR                   VIDCMO
051150950206     C   29              MOVEL     VIDCTR        V0CCTR
051160950206     C   29              CLEAR                   VIDCTR
051170960319     C     *IN91         IFEQ      *ON
051180960319     C                   MOVEL     VIDGC1        V0CGC1
051190960319     C                   CLEAR                   VIDGC1
051200960319     C                   MOVEL     VIDGC2        V0CGC2
051210960319     C                   CLEAR                   VIDGC2
051220960319     C                   ENDIF
051230050119     C                   MOVEL     *BLANKS       VIDDMT
051240940819     C*
051250990720     C* SPENGO GLI INDICATORI DI PROTEZIONE DELLA VIDEATA DELLE PERSON
051260990719     C*  CHE SERVONO PER LA PROCEDURA PREPAGATI
051270990719     C     PARTCH        IFNE      'P'
051280010307     C     §LPFPR        ANDNE     'O'
051290990720     C                   SETOFF                                       2426
051300990719     C                   ENDIF
051310990720     C                   SETOFF                                       19
051320041214     C* ABILITA LA RICERCA ALFABETICA
051330041214     C                   SETON                                        01
051340041214     C                   SETOFF                                       1438
051350990719     C**
051360940819     C     FORD00        TAG
051370041109     c****               z-add     v0cnrv        v0cnrvv
051380071107     c****               if        dateu>=§vpodrt
051390070828     c                   clear                   atrdrt
051400071107     c****               endif
051410940819     C                   EXFMT     LS01D00
051420041109     c****               z-add     v0cnrvv       v0cnrv
051430940819     C* CMD3 - FINE LAVORO
051440940819     C   KC              GOTO      ENDG00
051450161215     C* F8 - INTERROGAZIONE O.R.M.
051460010223     C     *INKH         IFEQ      *ON
051470010226     C     WORM          ANDEQ     'S'
051480010227     C     PARTCH        ANDNE     'P'
051490010220     C     V0CNOR        ANDEQ     *ZEROS
051500111123     c* se lnp import continuo a richiamare FIOR04R
051510111123     c****               if        %lookup(v0clnp:fio)=0
051520111123     c*****                        and %lookup(999:fio)=0
051530111123     c                   if        v0clnp>pr0lnp
051540111123     c                   clear                   og143
051550111123     C     v0clnp        CHAIN     AZORG01L      UNIORG
051560111123     c                   if        %found(azorg01l)
051570111123     C                   MOVEL     ORGDE3        OG143
051580111123     c                   endif
051590111123     c                   eval      pr0lnp=v0clnp
051600111123     c                   endif
051610111123     c                   if        §ogntw='DPD' or §ogntw='EEX' or
051620111123     c                             §ogntw='FED'
051630150928     C                   CLEAR                   fior010ds
051640150928     C                   MOVEL     '1'           Ior010ric
051650150928     C                   Z-ADD     V0CLNP        ior010por
051660051207     c
051670150928     C                   CALL      'FIOR010R'
051680150928     C                   PARM                    KPJBA
051690150928     C                   PARM                    fior010ds
051700150928     C     OOR010F03     IFEQ      *BLANKS
051710150928     C     OOR010F12     andeq     *BLANKS
051720150928     C     OOR010err     andeq     *BLANKS
051730150928     C                   Z-ADD     OOR010POE     V0CPOE
051740150928     C                   MOVEL     OOR010NSR     V0CNOR
051750150928     C                   MOVE      OOR010NOR     V0CNOR
051760150928     C                   Z-ADD     OOR010NRV     V0CNRV
051770050117     c                   eval      *inkh = '0'
051780050117     c                   else
051790010226     C                   GOTO      FORD00
051800050117     c                   endif
051810110419     c                   else
051820161215     c                   setoff                                       30
051830161215     c                   clear                   w001a
051840161215     c                   if        v0cpdr>*zeros
051850161215     C                   TESTN                   v0cpdr               30
051860161215     C                   MOVE      v0cpdr        W001A
051870161215     c                   endif
051880161215     c                   if        v0cpdr<=*zeros or not *in30 or
051890161215     c                             w001a<'0'
051900110419     c                   eval      *in90='1'
051910110419     c                   eval      *in56='1'
051920110419     c                   eval      vidmsg=err(210)
051930110419     c                   goto      ford00
051940110419     c                   else
051950110419     c                   clear                   fior58ds
051960110419     c                   movel     v0clnp        ior58pdr
051970110419     c                   move      v0cpdr        IOR58PDR
051980110419     C                   CALL      'FIOR58R'
051990110419     C                   PARM                    KPJBA
052000110419     C                   PARM                    fior58ds
052010110419     C     OOR58F03      IFEQ      *BLANKS
052020110419     C                   Z-ADD     OOR58POE      V0cPOE
052030110419     C                   MOVEL     OOR58NSR      V0cNOR
052040110419     C                   MOVE      OOR58NOR      V0cNOR
052050110419     C                   Z-ADD     OOR58NRV      V0cNRV
052060110419     c                   eval      *inkh = '0'
052070110419     c                   else
052080110419     C                   GOTO      FORd00
052090110419     c                   endif
052100110419     c                   endif
052110110419     c                   endif
052120010226     C                   ENDIF
052130010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
052140010227     C* SE NON SEMPRE VISUALIZZATO. PER CMD8 E PROCEDURA NON ATTIVATA
052150010227     C* O SONO NEL GIRO DEI MIEI PREPAGATI RIEMETTO SEMPRE LA VIDEATA
052160010227     C   KHWORM          IFNE      'S'
052170010227     C     PARTCH        OREQ      'P'
052180010227     C                   GOTO      FORD00
052190010227     C                   ENDIF
052200940819     C*
052210940819     C* CONTROLLO CAMPI PERSONALIZZATI
052220940819     C                   EXSR      CTRD00
052230940929     C     WEMFOR        IFEQ      '1'
052240040908     c* Se no Errori ma non premuto F6 riemetto la videata
052250040908     c     *inkf         oreq      *off
052260940929     C                   GOTO      FORD00
052270940929     C                   ENDIF
052280041220     c* SOLO SE CAMBIATO ORM:
052290041220     c* pulisco la prima videata per essere sicura che
052300041220     c* non rimangano impostati campi del precedente orm ma non giusti per i
052310041220     c* l nuovo ORM
052320050315     c                   if        s_v0corm <> v0corm and (v0corm1 > 0 or
052330050315     c                             s_ormpers='P')
052340041220     c                   exsr      inz01
052350041220     c                   endif
052360070831     c
052370070831     c* Se non è cambiato l'ORM ma la data ritiro è = 0 forzo comunque
052380070831     c* data ritiro=udate
052390070831     c                   if        viddrt=0
052400070831     c                   exsr      inzdrt
052410070831     c                   endif
052420070831     c
052430940819     C*
052440940819     C* MUOVO TUTTI I CAMPI CHE HO PERSONALIZZATO
052450041129     c*
052460940819     C                   MOVEL     V0CSOP        VIDSOP
052470050426     c***  atrpdr        ifeq      prri
052480940819     C                   MOVEL     V0CPDR        VIDPDR
052490050426     c***                endif
052500070806     c                   movel     at0daorm      atrdaorm
052510011122     C* SE SONO IN IMMISSIONE PREPAGATI NON DEVO METTERE "?" IN QUANTO
052520011122     C* IN QUESTO CASO IL CODICE AUTOTRASPORTATORE NON E' DA IMMETTERE
052530011122     C  N34V0CPDR        IFEQ      *BLANKS
052540010502     C     WORM          ANDEQ     'S'
052550010502     C                   MOVEL     '?   '        VIDPDR
052560050128     c                   clear                   v1dpdr
052570010502     C                   ENDIF
052580960926     C* SE HO GIA' INSERITO IL AUTOTRASPORTATORE MI POSIZIONO SOTTO
052590950206     C     V0CPDR        IFGT      *ZEROS
052600010222     C     WORM          IFEQ      'S'
052610010222     C     PARTCH        ANDNE     'P'
052620010307     C     §LPFPR        ANDNE     'O'
052630010222     C                   SETON                                        06
052640010222     C                   ELSE
052650950206     C                   SETON                                        07
052660010222     C                   ENDIF
052670950206     C                   ENDIF
052680940819     C                   MOVEL     V0CNRT        VIDNRT
052690050426     c***  atrfpp        ifeq      prri
052700940819     C                   MOVEL     V0CFPP        VIDFPP
052710050426     c***                endif
052720940819     C                   MOVEL     V0CLNP        VIDLNP
052730010222     C                   Z-ADD     V0CPOE        VIDPOE
052740010222     C   37              Z-ADD     V0CNOR        VIDNOR
052750010222     C   37              Z-ADD     V0CNRV        VIDNRV
052760941230     C   20              MOVEL     V0CLNA        VIDLNA
052770941230     C   21              MOVEL     V0CCBO        VIDCBO
052780941230     C   18              MOVEL     V0CTSP        VIDTSP
052790941230     C   26              MOVEL     V0CCTM        VIDCTM
052800941230     C*
052810941230     C     *IN19         IFEQ      *ON
052820950303     C     *IN85         OREQ      *ON
052830941230     C                   MOVEL     V0CCCM        VIDCCM
052840941230     C                   MOVEL     V0CFLC        VIDFLC
052850941011     C     V0CFLC        IFNE      0
052860941020     C                   SETON                                        14
052870941011     C                   ENDIF
052880950303     C                   ENDIF
052890940825     C*
052900940825     C* IMPOSTO I CAMPI DEL MITTENTE SE PERSONALIZZATO
052910061109    1C     *IN19         IFEQ      *ON
052920061109    2C     V0CINM        IFEQ      *BLANKS
052930940825     C                   MOVEL     ACORAG        VIDRSM
052940940825     C                   MOVEL     ACORAG        VIDDMT
052950940825     C                   MOVEL     INDVIA        VIDINM
052960941005     C                   MOVEL     INDCAE        VIDCAM
052970940825     C                   MOVEL     INDCIT        VIDLOM
052980940825     C                   MOVEL     INDPRV        VIDPRM
052990940825     C                   MOVEL     INDSTA        VIDNZM
053000940825     C                   MOVEL     INDIVA        WISO
053010950125     C     WISO          IFGE      '00'
053020940825     C                   MOVEL     INDIVA        VIDCPM
053030120504     C                   clear                   VIDism
053040940825     C                   ELSE
053050940825     C                   MOVEL     INDIVA        VIDPIM
053060940825     C                   ENDIF
053070120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
053080120508     c* in contabilità crea problemi
053090120508     c                   if        *in22 and wiso='$$'
053100120508     c                   clear                   vidpim
053110120508     c                   endif
053120061110     c   22              movel     indcdf        vidcdf
053130941230     C*
053140061109   x2C                   ELSE
053150941230     C*
053160941230     C                   MOVEL     V0CRSM        VIDRSM
053170941230     C                   MOVEL     V0CINM        VIDINM
053180941230     C                   MOVEL     V0CLOM        VIDLOM
053190941230     C                   MOVEL     V0CCAM        VIDCAM
053200941230     C                   MOVEL     V0CPRM        VIDPRM
053210941230     C                   MOVEL     V0CNZM        VIDNZM
053220941230     C                   MOVEL     V0CFAP        VIDFAP
053230941230     C                   MOVEL     V0CPIM        VIDPIM
053240061109     C                   CLEAR                   VIDcdf
053250071023     c                   eval      w_callyco=' '
053260071023     c* Codice fiscale: se non c'e' effettuo la ricerca
053270061110    3c   22              if        v0ccdf<>*BLANKS
053280061109     C                   MOVEL     V0Ccdf        VIDcdf
053290061109   x3C                   ELSE
053300061109    4c                   if        vidnzm=*blanks
053310061110     c* richiamo pgm di richiesta
053320071023     c****               EXSR      CAlLyco
053330071023     c                   eval      w_callyco='1'
053340061109     c
053350061109    4C                   endif
053360061109    3C                   endif
053370071023     c* Partita Iva: se non c'e' effettuo la ricerca
053380071023    3c   22              if        vidpim=*BLANKS and vidnzm=*blanks
053390071023     c* memorizzo di richiamare pgm di richiesta
053400071023     c                   eval      w_callyco='1'
053410071023    3C                   endif
053420071023
053430120503     c                   if        w_callyco='1'
053440120503     c                   exsr      CALLyco
053450120503     c                   endif
053460061109     c
053470061109    2C                   ENDIF
053480061109     c* proteggo il campo del codice fiscale
053490061109     c                   movel     riul          atrcdf
053500061109    1C                   ENDIF
053510941230     C* IMPOSTO SOLO QUELLI PESONALIZZATI, GLI ALTRI LI LASCIO
053520941230     C*  COME SONO
053530950206     C   29              MOVEL     V0CCTR        VIDCTR
053540950206     C   28              MOVEL     V0CFTM        VIDFTM
053550941230     C   27              MOVEL     V0CNAS        VIDNAS
053560040610     c     atrbva        ifeq      prri
053570040610     c                   movel     v0cbva        vidbva
053580040610     c                   endif
053590941230     C   17              MOVEL     V0CTCR        VIDTCR
053600941230     C   16              MOVEL     V0CDCR        VIDDCR
053610941230     C   23              MOVEL     V0CHCR        VIDHCR
053620941230     C   23              MOVEL     V0CMCR        VIDMCR
053630030409     c                   If        wflagore = '1'
053640030409     c                   Eval      VidOre = V0cOre
053650030409     c                   EndIf
053660941230     C   03              MOVEL     V0CRMO        VIDRMO
053670941230     C   03              MOVEL     V0CNMO        VIDNMO
053680941230     C   03              MOVEL     V0CCMO        VIDCMO
053690960319     C   91              MOVEL     V0CGC1        VIDGC1
053700960319     C   91              MOVEL     V0CGC2        VIDGC2
053710940824     C* FINE PERSONALIZZAZIONE
053720940921     C                   SETOFF                                       01
053730940824     C                   MOVEL     ' '           WPERSO            1
053740940819    2C     ENDG00        ENDSR
053750061110     c*
053760061110     c* RICHIAMO PGM DI RICERCA COD FISCALE X 8888 O 9999-----------------*
053770061110     c     CALLYCO       BEGSR
053780061110     c                   eval      i600ela='R'
053790071023     c                   if        vidcdf=*blanks
053800061110     c                   eval      i600aCF='SI'
053810071023     c                   endif
053820071023     c                   if        vidpim=*blanks
053830071023     c                   eval      i600api='SI'
053840071023     c                   endif
053850061110     c     *iso          movel     20000101      i600dti
053860061110     c     *iso          movel     29991231      i600dtf
053870061110     c                   eval      i600rsc=vidrsm
053880061110     c                   eval      i600ind=vidinm
053890061110     c                   eval      i600cap=vidcam
053900061110     c                   eval      i600loc=vidlom
053910061110     c                   eval      i600prv=vidprm
053920061110     c                   movel     yco600ds      kpjbu
053930061110     c                   call      'YCO601R'
053940061110     c                   parm                    kpjba
053950061110     c
053960061110     c                   movel     kpjbu         yco600ds
053970061110    5c                   if        o600err=*blanks
053980071023     c                   if        vidcdf=*blanks
053990061110     c                   movel     o600cdfi      vidcdf
054000071023     c                   endif
054010071023     c                   if        vidpim=*blanks
054020071023     c                   movel     o600piva      wpiva
054030071023     c                   exsr      sr_wpiva
054040120508     c* Se partita iva $$ la puilisco: crea problemi in contabilità
054050120508     c                   if        vidism='$$'
054060120508     c                   clear                   vidpim
054070120508     c                   endif
054080071023     c                   endif
054090061110    5c                   endif
054100061110     c                   ENDSR
054110900427     C*
054120900427     C*--- CONTROLLO CAMPI PERSONALIZZAZIONE -------------------------*
054130940819     C     CTRD00        BEGSR
054140941115     C                   CLEAR                   VIDMSG
054150941103     C                   CLEAR                   WCMO
054160941103     C                   CLEAR                   WNAR
054170940824     C                   CLEAR                   WCBO
054180940824     C                   CLEAR                   WLNP
054190940824     C                   CLEAR                   WPDR
054200940824     C                   CLEAR                   WLNA
054210940824     C                   CLEAR                   WCTM
054220940824     C                   CLEAR                   WCCM
054230940825     C                   CLEAR                   WFTM
054240940824     C                   CLEAR                   WTSP
054250960319     C                   CLEAR                   WGC1
054260960319     C                   CLEAR                   WGC2
054270940929     C                   SETOFF                                       90
054280941003     C* SPENGO GLI INDICATORI DI PERSONALIZZAZIONE
054290941004     C                   SETOFF                                       161710
054300941103     C                   SETOFF                                       181903
054310990720     C                   SETOFF                                       202123
054320941003     C                   SETOFF                                       272829
054330990720     C                   SETOFF                                       859119
054340010222     C                   SETOFF                                       37
054350030409     c                   Clear                   wflagore
054360040610     c                   movel     hiul          atrbva
054370050426     c****               clear                   atrpdr
054380050426     c****               clear                   atrfpp
054390070829     c                   clear                   atrdrt
054400990602     C* GLI INDICATORI DELLA DATA E CTM LI SPENGO SOLO SE
054410990602     C*  NON PROVENGO DA PREPAGATI
054420990602     C     PARTCH        IFNE      'P'
054430010307     C     §LPFPR        ANDNE     'O'
054440990720     C                   SETOFF                                       2426
054450990602     C                   ENDIF
054460940929     C* SPENGO GLI INDICATORI DI POSIZONAMENTO CURSORE
054470940929     C                   SETOFF                                       404142
054480940929     C                   SETOFF                                       435645
054490940929     C                   SETOFF                                       464748
054500940929     C                   SETOFF                                       495051
054510940929     C                   SETOFF                                       525354
054520940929     C                   SETOFF                                       556870
054530940929     C                   SETOFF                                       585960
054540960319     C                   SETOFF                                       616274
054550040611     c                   clear                   h0riga
054560040611     c                   clear                   h0colo
054570030411     c                   Clear                   At0Tcr
054580030415     c                   Clear                   At0Ore
054590940929     C                   CLEAR                   WEMFOR
054600950504     C                   CLEAR                   DS3A
054610950209     C***
054620950209     C*** RICERCA ALFABETICA
054630950209     C                   MOVEL     V0CLNP        WLNP
054640950209     C                   Z-ADD     V0CCCM        WCCM
054650950209    2C     V0CFLC        IFNE      0
054660950209     C                   Z-ADD     V0CFLC        WFLC
054670950209     C                   ELSE
054680950209     C                   Z-ADD     V0CLNP        WFLC
054690950209    2C                   ENDIF
054700950209     C                   MOVEL(P)  V0CRSM        PAXDMT
054710050119     C                   CLEAR                   VIDDMT
054720950209     C* ESEGUO RICERCA ALFABETICA
054730950209     C                   EXSR      RICALF
054740950209     C                   MOVE      WCCM          V0CCCM
054750950209     C     *IN14         IFEQ      *ON
054760950209     C                   MOVEL     WFLC          V0CFLC
054770950209     C                   ENDIF
054780940822     C***
054790910208     C*** DATA SPEDIZIONE ***
054800930708     C                   EXSR      CTRDSP
054810001031     C   90              GOTO      ENDC00
054820940920     C***
054830940920     C*** SIGLA OPERATORE ***
054840940920     C* CONTROLLO SOLO SE NON E' PROTETTO
054850940928    1C     *IN13         IFEQ      *OFF
054860940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
054870940920     C                   MOVEL     '3M'          COD
054880940920     C                   MOVEL(P)  V0CSOP        KEY
054890940920     C                   EXSR      CTABEL
054900940928    2C     *IN30         IFEQ      *OFF
054910950713     C     V0CSOP        OREQ      ' '
054920940920     C                   MOVEL     ERR(29)       VIDMSG
054930940920     C                   SETON                                        4290
054940940920     C                   GOTO      ENDC00
054950940928    2C                   ENDIF
054960940928    1C                   ENDIF
054970940822     C***
054980940824     C*** DATA RITIRO MERCE ***
054990070806     C***                EXSR      CTRDRT
055000070806     C***90              GOTO      ENDC00
055010940822     C***
055020940819     C*** LINEA PARTENZA ***
055030940928     C                   MOVEL     V0CLNP        WLNP
055040940824     C                   EXSR      CTRLNP
055050940824     C   90              GOTO      ENDC00
055060010213     C***
055070010213     C*** NUMERO O.R.M.
055080010213     C*
055090010213     C* Controllo solo se attivata procedura O.R.M.
055100010213     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
055110010213     c* fine dell'immissione
055120010213     C     WORM          IFEQ      'S'
055130010213     C     PARTCH        ANDNE     'P'
055140010213     C                   Z-ADD     V0CPOE        WOPOE
055150010213     C                   Z-ADD     V0CNOR        WONOR
055160010213     C                   Z-ADD     V0CNRV        WONRV
055170010213     C                   Z-ADD     V0CLNP        WOLNP
055180010222     C     WIDOR1        IFGT      *ZEROS
055190010213     C                   EXSR      CTRORM
055200010213     C   90              GOTO      ENDC00
055210010216     C     WEMFOR        IFEQ      '1'
055220010216     C                   GOTO      ENDC00
055230010216     C                   ENDIF
055240010222     C                   ENDIF
055250010213     C                   ENDIF
055260010227     C* SE PREMUTO F8 E SONO NEL GIRO DEI PREPAGATI DEVO RIEMETTERE LA
055270010227     C* VIDEATA
055280010227     C   KH              GOTO      ENDC00
055290070806     c***
055300070806     C*** DATA RITIRO MERCE ***
055310070806     c* se orm non fittizio forzo data ritiro prendendola da ORM
055320070806     c                   if        flgfit <> 'S' and widor1>*zeros
055330071107     c*****                        and dateu>=§vpodrt
055340070828     c                   clear                   weform
055350070806     c                   exsr      fordrt
055360070831     c                   if        weform='1'
055370070831     c                   eval      wemfor='1'
055380070828     c                   goto      endc00
055390070828     c                   endif
055400070806     c                   endif
055410070828     c* se orm fittizio non controllo la data ritiro se non immessa
055420070905     c***                if        flgfit='S' and widor1>*zeros and viddrt=0
055430070905     c***                          and dateu>=§vpodrt
055440070905     c***                else
055450070806     C                   EXSR      CTRDRT
055460070806     C   90              GOTO      ENDC00
055470070905     c***                endif
055480070831     c* se immesso orm  proteggo la data ritiro
055490070831     c                   if        widor1>*zeros and viddrt>0
055500071107     c****                         and dateu>=§vpodrt
055510070828     c                   eval      atrdrt=prri
055520070828     c                   endif
055530940822     c***
055540960926     C*** CODICE AUTOTRASPORTATORE ***
055550940928    1C     V0CPDR        IFNE      *BLANKS
055560940824     C     V0CPDR        ANDNE     *ZEROS
055570940824     C*
055580940928     C                   MOVE      V0CPDR        WPDR
055590940824     C                   EXSR      CTRPDR
055600940915     C                   MOVE      WPDR          V0CPDR
055610940928    2C     WEMFOR        IFEQ      '1'
055620940824     C                   GOTO      ENDC00
055630940928    2C                   ENDIF
055640050126     c*
055650050426     c***                movel     prri          atrpdr
055660940824     C*
055670940928    1C                   ENDIF
055680050126     c*** FLAG MATTINO/POMERIGGIO  ***
055690050426     c***  v0cfpp        ifne      *blanks
055700050426     c***                movel     prri          atrfpp
055710050426     c***                endif
055720940822     C***
055730940822     C*** CODICE BOLLA ***
055740940928    1C     V0CCBO        IFNE      *BLANKS
055750940824     C*
055760940824     C                   MOVEL     V0CCBO        WCBO
055770940824     C                   EXSR      CTRCBO
055780940824     C                   MOVEL     WCBO          V0CCBO
055790940928    2C     WEMFOR        IFEQ      '1'
055800940824     C                   GOTO      ENDC00
055810940928    2C                   ENDIF
055820940824     C*
055830940928    1C                   ENDIF
055840940822     C***
055850940822     C*** LINEA ARRIVO ***
055860940824     C                   MOVEL     V0CLNA        WLNA
055870110217     C                   EXSR      CTRLNA_vid
055880940824     C                   MOVEL     WLNA          V0CLNA
055890940928    1C     WEMFOR        IFEQ      '1'
055900940824     C                   GOTO      ENDC00
055910940928    1C                   ENDIF
055920940824     C***
055930940822     C*** TIPO SERVIZIO ***
055940940824     C                   MOVEL     V0CTSP        WTSP
055950940824     C                   EXSR      CTRTSP
055960940824     C                   MOVEL     WTSP          V0CTSP
055970940928    1C     WEMFOR        IFEQ      '1'
055980940824     C                   GOTO      ENDC00
055990940928    1C                   ENDIF
056000940824     C***
056010940822     C*** CODICE TRATTAMENTO MERCE ***
056020940928     C* CONTROLLO SOLO SE IMMESSO
056030950504    1C     V0CCTM        IFNE      *BLANKS
056040940824     C                   MOVEL     V0CCTM        WCTM
056050940824     C                   EXSR      CTRCTM
056060940824     C                   MOVEL     WCTM          V0CCTM
056070950504    2C     WEMFOR        IFEQ      '1'
056080940824     C                   GOTO      ENDC00
056090950504    2C                   ENDIF
056100040611     c                   ENDIF
056110040611     c*** TIPO MERCE V-VALORE
056120040611     c     v0cbva        ifne      *blanks
056130040611     c     v0cctm        ifne      *blanks
056140040611     c     §1bfg8        andeq     'N'
056150040611     c                   Eval      *In90 = *On
056160040611     c                   Eval      VidMsg = Err(281)
056170040611     c                   z-add     21            H0riga
056180040611     c                   z-add     73            H0colo
056190040611     c                   GoTo      EndC00
056200040611     c                   endif
056210040611     c                   movel     prri          atrbva
056220040611     c                   endif
056230040611     C* PERSONALIZZAZIONE CTM
056240040611    1C     V0CCTM        IFNE      *BLANKS
056250950504     C                   SETON                                        26
056260950504     C                   MOVEL     TBLUNI        V1DCTM
056270940928    1C                   ENDIF
056280940822     C*
056290940822     C*** CODICE CLIENTE ***
056300940928    1C     V0CCCM        IFNE      0
056310940824     C     V0CRSM        ORNE      *BLANKS
056320940824     C*
056330940825     C                   MOVEL     V0CFTM        WFTM
056340940915     C                   Z-ADD     V0CCCM        WCCM
056350940928    2C     V0CFLC        IFNE      0
056360940915     C                   Z-ADD     V0CFLC        WFLC
056370940921     C                   ELSE
056380940921     C                   Z-ADD     V0CLNP        WFLC
056390940928    2C                   ENDIF
056400940920     C                   MOVEL(P)  V0CRSM        PAXDMT
056410050120     C                   CLEAR                   VIDDMT
056420950127     C*
056430940824     C                   EXSR      CTRCCM
056440950127     C*
056450940915     C                   MOVE      WCCM          V0CCCM
056460941011     C     *IN14         IFEQ      *ON
056470941011     C                   MOVEL     WFLC          V0CFLC
056480941011     C                   ENDIF
056490941011     C*
056500940928    2C     WEMFOR        IFEQ      '1'
056510940824     C                   GOTO      ENDC00
056520940928    2C                   ENDIF
056530950303     C*
056540950303   X1C                   ELSE
056550940825     C*
056560940825     C* SE CLIENTE A 0 NON IMMETTERE NEMMENO IL MITTENTE PER ESTESO
056570940928    2C     V0DMIT        IFNE      *BLANKS
056580940825     C                   MOVEL     ERR(25)       VIDMSG
056590940920     C                   SETON                                        5090
056600940825     C                   GOTO      ENDC00
056610940928    2C                   ENDIF
056620940928    1C                   ENDIF
056630940825     C***
056640940822     C*** CODICE TARIFFA MITTENTE ***
056650940825     C     V0CFTM        IFEQ      'S'
056660940822     C* SE IMMESSO DEVE ESISTERE IL CODICE MITTENTE
056670940822     C     V0CCCM        IFEQ      *ZEROS
056680940822     C                   MOVEL     ERR(24)       VIDMSG
056690940920     C                   SETON                                        5090
056700940822     C                   GOTO      ENDC00
056710940822     C                   END
056720940822     C* PERSONALIZZAZIONE
056730940822     C                   SETON                                        28
056740940822     C                   END
056750940825     C***
056760940825     C*** MITTENTE ****
056770940822     C* SOLO SE 8888 O 9999 O NON IMMESSO CLIENTE POSSO INDICARE IL MIT
056780950303    0C     V0DMIT        IFNE      *BLANKS
056790950303     C*
056800940909    1C     WCCM          IFEQ      8888
056810940909     C     WCCM          OREQ      9999
056820950303     C*
056830970703     C                   MOVEL     V0CRSM        I14RSC
056840970703     C                   CLEAR                   I14RS2
056850970703     C                   MOVEL     V0CINM        I14IND
056860970703     C                   MOVEL     V0CLOM        E14LOC
056870970703     C                   MOVEL     V0CPIM        E14PIP
056880970703     C                   MOVEL     V0CPRM        E14PRV
056890970703     C                   MOVEL     V0CNZM        E14NAR
056900970703     C                   MOVEL     V0CCAM        E14CAP
056910970704     C                   MOVEL     'M'           WCLI
056920061109     C                   MOVEL     v0ccdf        Wcdf
056930071022     C                   MOVEL     v0cpim        Wiva
056940970704     C                   EXSR      CTRIND
056950941020     C*
056960941020     C* CAMPI CHE POSSO AVER IMPOSTATO
056970970703     C                   MOVEL     E14LOC        V0CLOM
056980970703     C                   MOVEL     E14PIP        V0CPIM
056990970703     C                   MOVEL     E14PRV        V0CPRM
057000970703     C                   MOVEL     E14NAR        V0CNZM
057010970703     C                   MOVEL     E14CAP        V0CCAM
057020970704     C*
057030061109     c* Se errore sulla partita iva , visualizzo messaggio
057040061109     c                   if        xcfivaflg < *zeros
057050120503     c*****              if        wiva=*blanks and dateu>=§vpopiv
057060120504     c                   if        wcdf=*blanks or %subst(wcdf:12:1)=' '
057070071023     c                   z-add     16            H0riga
057080071022     c                   else
057090071023     c                   z-add     17            H0riga
057100071022     c                   endif
057110061109     c                   z-add     64            H0colo
057120061109     c                   endif
057130061109     c
057140970704     C     WEMFOR        IFEQ      '1'
057150970704     C     *IN90         OREQ      *ON
057160970704     C                   GOTO      ENDC00
057170970704     C                   ENDIF
057180040917     c* Segnalazione se inserito mittente estero
057190040917     c     wmitie        ifeq      'E'
057200040917     c     wcontmit      andeq     *blanks
057210040917     c                   movel     '1'           wcontmit
057220040917     c                   seton                                        90
057230040917     c                   z-add     16            h0riga
057240040917     c                   z-add     49            h0colo
057250040917     c                   movel     ERR(283)      vidmsg
057260040917     c                   goto      endc00
057270040917     c                   endif
057280941020     C**
057290950303     C                   SETON                                        1902
057300941110     C                   MOVEL     V0CRSM        VIDDMT
057310940930     C*
057320940930     C                   ELSE
057330940930     C*
057340940930     C* SE NON IMNMESSO CLIENTE O E' UN CODIFICATO PULISCO IL CAMPO
057350940930     C*  DEL CONTROLLO CAP VARIATO
057360940930     C                   CLEAR                   VARCAM
057370940930     C                   CLEAR                   OTT
057380940930    1C                   ENDIF
057390950303    0C                   ENDIF
057400930329     C*
057410930329     C**** CODICE TARIFFA ****
057420941107    1C     V0CCTR        IFNE      *BLANKS
057430050920     C                   CLEAR                   fnlv59ds
057440050920     C                   MOVEL     'S'           ilv59cfo
057450050920     C                   MOVEL     V0CCTR        ilv59ctr
057460050920     C                   CALL      'FNLV59R'
057470050920     C                   PARM                    fnlv59ds
057480941107     C* ERRORE
057490050920    2C     olv59msg      IFNE      *BLANKS
057500050920     C                   MOVEL     olv59msg      VIDMSG
057510941107     C                   SETON                                        9058
057520941107     C                   MOVEL     '1'           WEMFOR
057530941107     C                   GOTO      ENDC00
057540941107    2C                   ENDIF
057550940819     C*
057560050921     C                   MOVEL     olv59dfs      DEFCTR
057570930329     C                   SETON                                        29
057580941107    1C                   ENDIF
057590941103     C*
057600941103     C*** MITTENTE ORIGINALE ***
057610941110     C     V0CRMO        IFNE      *BLANKS
057620941110     C     V0CCMO        ORNE      *BLANKS
057630941103     C                   MOVEL     V0CRMO        WRMO
057640941103     C                   MOVEL     V0CCMO        WCMO
057650941103     C                   MOVEL     V0CNMO        WNAR
057660941103     C                   EXSR      CTRMO
057670941103     C                   MOVEL     WNAR          V0CNMO
057680941103     C     WEMFOR        IFEQ      '1'
057690941103     C                   GOTO      ENDC00
057700941103     C                   ENDIF
057710941110     C                   ENDIF
057720030415      * I dati relativi alla consegna richiesta
057730030411      * possono essere immessi solo se è stato inserito il codice cliente
057740030411      * mittente (no 8888/9999)
057750030411     c                   If        (V0cCcm = *Zeros or
057760030411     c                              V0cCcm = 8888   or  V0cCcm = 9999)   and
057770030411     c                             (V0cTcr <> *Blanks or V0cDcr > *Zeros or
057780030411     c                              V0cHcr >  *Zeros  or V0cMcr > *Zeros or
057790030411     c                              V0cOre >  *Zeros)
057800030411     c                   Eval      *In50 = *On
057810030411     c                   Eval      *In90 = *On
057820030411     c                   Eval      VidMsg = Err(18)
057830030416     c                   GoTo      EndC00
057840030411     c                   EndIf
057850960319     C***
057860930329     C*** CONSEGNA RICHIESTA ***
057870940913     C                   MOVEL     V0CDCR        WDCR
057880940913     C                   MOVEL     V0CHCR        WHCR
057890940913     C                   MOVEL     V0CMCR        WMCR
057900940913     C                   MOVEL     V0CTCR        WTCR
057910940913     C                   EXSR      CTRCR
057920940916     C                   MOVEL     WDCR          V0CDCR
057930940913     C   90              GOTO      ENDC00
057940030410      * o data consegna richiesta o n. ore
057950030409     c                   If        V0cOre > *Zeros
057960030411     c                   If        V0cTcr <> *Blanks
057970030411     c                   Movel     Rimm          At0Tcr
057980030411     c                   Eval      *In90 = *On
057990030411     c                   Eval      VidMsg = Err(276)
058000030411     c                   z-add     21            H0riga
058010030411     c                   z-add     14            H0colo
058020030411     c                   GoTo      EndC00
058030030411     c                   EndIf
058040030409     c                   If        V0cDcr > *Zeros
058050030409     c                   Eval      *In59 = *On
058060030409     c                   Eval      *In90 = *On
058070030409     c                   Eval      VidMsg = Err(276)
058080030409     c                   GoTo      EndC00
058090030409     c                   EndIf
058100030411     c                   If        V0cHcr > *Zeros or V0cMcr > *Zeros
058110030411     c                   Eval      *In60 = *On
058120030411     c                   Eval      *In90 = *On
058130030411     c                   Eval      VidMsg = Err(276)
058140030411     c                   GoTo      EndC00
058150030411     c                   EndIf
058160030415      * Si possono immettere solo 24 48 72 ore
058170030415     c                   If        V0cOre <> 24 and V0cOre <> 48 and
058180030415     c                             V0cOre <> 72
058190030415     c                   Movel     Rimm          At0Ore
058200030415     c                   Eval      *In90 = *On
058210030415     c                   Eval      VidMsg = Err(278)
058220030415     c                   z-add     23            H0riga
058230030415     c                   z-add     31            H0colo
058240030415     c                   GoTo      EndC00
058250030415     c                   EndIf
058260030409     c                   Eval      wflagore = '1'
058270030411     c                   Eval      *In17 = *On
058280030411     c                   Eval      *In16 = *On
058290030411     c                   Eval      *In23 = *On
058300030409     c                   EndIf
058310960319     C***
058320960319     C*** GIORNI DI CHIUSURA ***
058330960319     C                   MOVEL     V0CGC1        WGC1
058340960319     C                   MOVEL     V0CGC2        WGC2
058350960319     C                   EXSR      CTRGCH
058360960319     C   90              GOTO      ENDC00
058370930413     C*** NATURA MERCE ***
058380950112     C     V0CNAS        IFNE      *BLANKS
058390940825     C                   SETON                                        27
058400930329     C                   END
058410940824     C*
058420940824     C     ENDC00        TAG
058430940824     C   90              MOVEL     '1'           WEMFOR
058440940824     C                   ENDSR
058450940922     C*
058460940922     C* CALL AL PGM DI RICERCA TABELLE X§TABER -----------------------*
058470940922     C     CX§TAB        BEGSR
058480990915     C                   CLEAR                   §KEY
058490940922     C                   CALL      'X§TABER'
058500940922     C                   PARM                    CODUT
058510940922     C                   PARM                    COD
058520940922     C                   PARM                    §KEY
058530940922     C                   PARM                    §DES             25
058540940922     C                   MOVEL     '1'           WEMFOR
058550940922     C                   ENDSR
058560940916     C*
058570940916     C* CONTROLLO DATA SPEDIZIONE ------------------------------------*
058580940916     C     CTRDSP        BEGSR
058590940916     C*
058600940916     C                   Z-ADD     VIDDSP        G02DAT
058610940916     C                   MOVEL     *BLANK        G02ERR
058620940916     C                   CALL      'XSRDA8'
058630940916     C                   PARM                    WLBDAT
058640940916     C* ERRATA
058650940916    1C     G02ERR        IFEQ      '1'
058660940920     C                   SETON                                        41  90
058670950920     C* PREPARO L'ERRORE
058680950920     C                   MOVEA     ERR(2)        K78
058690950920     C     2             SUBST     DATAPG:1      W002A
058700950920     C                   MOVEA     W002A         K78(69)
058710950920     C                   MOVEL     '/'           K78(71)
058720950920     C     2             SUBST     DATAPG:3      W002A
058730950920     C                   MOVEA     W002A         K78(72)
058740950920     C                   MOVEL     '/'           K78(74)
058750950920     C     2             SUBST     DATAPG:7      W002A
058760950920     C                   MOVEA     W002A         K78(75)
058770950920     C                   MOVEA     K78           VIDMSG
058780940916    1C                   ENDIF
058790940916     C*
058800940916     C* REIMPOSTO LA DATA SPEDIZIONEGGMMAA PRENDENDO L'ANNO A 4 SE NON
058810940916     C*  IMMESSO DA VIDEO
058820940916    1C     *IN90         IFEQ      *OFF
058830940928     C                   Z-ADD     G02DAT        VIDDSP
058840940916     C*
058850940916     C* IM MANUT O DISK NON SI PUO' CAMBIARE L'ANNO DI SPEDIZIONE
058860940916     C                   MOVE      VIDDSP        WAAS
058870940916    2C   12WAAS          IFNE      §LPAAS
058880940920     C                   SETON                                        4190
058890940916     C                   MOVEL     ERR(3)        VIDMSG
058900940916    2C                   ENDIF
058910940916    1C                   ENDIF
058920001121      *
058930001124      * SE SONO IN MANUTENZIONE DI UN PREPAGATO NON POSSO METTERE IN
058940001124      * SOSPENSIONE LA BOLLA SE CAMBIO MESE
058950001121    1C   22*IN90         IFEQ      *OFF
058960001124     C     PARTCH        ANDNE     'P'
058970010307     C     §LPFPR        ANDNE     'O'
058980001121     C                   MOVEL     BLPAAS        W0080             8 0
058990001121     C                   MOVE      BLPMGS        W0080
059000001121     C                   MOVEL     W0080         W0060             6 0
059010001121     C                   MOVEL     G02INV        W0060S            6 0
059020001121     C     W0060         IFLT      W0060S
059030001121     C                   SETON                                        4190
059040001121     C                   MOVEL     ERR(193)      VIDMSG
059050001121     C                   ENDIF
059060121017     c* Errore se data compresa nel range dal/al per blocco immissione
059070121017     c* prepagati (tabella "DGD")
059080121017     c***                if        *in90 = '0' and g02inv = §vpodip
059090121017     c                   if        *in90 = '0' and
059100121017     c                             g02inv>=§dgdbpd and g02inv<=§dgdbpa
059110050215     c                   Eval      VidMsg = 'Data non ammessa per spedizioni +
059120050215     c                             in Porto Prepagato'
059130050215     c                   seton                                        4190
059140050215     c                   endif
059150001121     C                   ENDIF
059160940916     C*
059170940916    1C     *IN90         IFEQ      *OFF
059180940916     C                   Z-ADD     G02INV        BLPDSP            8 0
059190950920     C* DATE SPEDIZIONE NO > DATA MAX DI SOSPENSIONE
059200950920    2C     BLPDSP        IFGT      DATAPA
059210940920     C                   SETON                                        4190
059220950920     C                   MOVEA     ERR(2)        K78
059230950920     C     2             SUBST     DATAPG:1      W002A
059240950920     C                   MOVEA     W002A         K78(69)
059250950920     C                   MOVEL     '/'           K78(71)
059260950920     C     2             SUBST     DATAPG:3      W002A
059270950920     C                   MOVEA     W002A         K78(72)
059280950920     C                   MOVEL     '/'           K78(74)
059290950921     C     2             SUBST     DATAPG:7      W002A
059300950920     C                   MOVEA     W002A         K78(75)
059310950920     C                   MOVEA     K78           VIDMSG
059320940916    2C                   ENDIF
059330940916    1C                   ENDIF
059340940916     C* PERSONALIZZAZIONE
059350940916    1C  N90WPERSO        IFEQ      'P'
059360940928     C     BLPDSP        ANDNE     DATEU
059370940916     C                   SETON                                        24
059380940916    1C                   ENDIF
059390940916     C*
059400940916     C                   ENDSR
059410940916     C*
059420970704     C* CONTROLLO INDIRIZZO COMPLETO MITT/DESTIN ---------------------*
059430970704     C     CTRIND        BEGSR
059440970710     C* LE DS SONO DA CLEARARE PRIMA ALTRIMENTI DANNO PROBLEMI IN CTRER
059450970710     C                   CLEAR                   DSLV13
059460970710     C                   CLEAR                   DSSI95
059470060922     C                   CLEAR                   tisi97ds
059480151106     c                   clear                   xcfiva1ds
059490970710     C*
059500970704     C                   CLEAR                   I14ISO
059510970714     C                   MOVEL     BLPDSP        I14DRI
059520020205     c                   movel     'S'           i14cnz
059530100115     c                   movel     'S'           i14forzait
059540080414     c***                clear                   ds15x
059550151106     c                   if        wcli='M' and *in22
059560151105     c                   eval      I14P88='8'
059570151105     c                   endif
059580970704     C                   CALL      'FNLV14R'
059590970707     C                   PARM                    KPJBA
059600970707     C                   PARM                    DSLV14
059610080414     C***                PARM                    ds15x
059620970707     C*
059630970707     C                   MOVEL     O14ERR        WERR              1
059640970707     C                   MOVEL     O14MSG        VIDMSG
059650150907     C                   eval      wlv13_giro2=' '
059660970707     C                   EXSR      CTRERR
059670970707     C**
059680970707     C     WEMFOR        IFEQ      '1'
059690970707     C                   GOTO      ENDIND
059700970707     C                   ENDIF
059710061109     c
059720151106     c* Controllo il codice fiscale
059730151106     c*****              if        wcdf<>*blanks
059740151106     c                   clear                   xcfiva1ds
059750061109     c                   clear                   xcfivamod
059760061109     c                   eval      xcfivapar = wcdf
059770061109     c                   eval      xcfivanar = e14nar
059780061109     c                   eval      xcfivaprv = e14prv
059790151106     c                   eval      xcfivacap = e14cap
059800151106     c                   eval      xcfivaloc = e14loc
059810151106     c                   eval      xcfivapiva= wiva
059820151106     c                   if        *in22=*on
059830151106     c                   eval      XCFIVAP88='8'
059840151106     c                   endif
059850151106     c                   call      'XCFIVAR1'
059860151106     c                   parm                    xcfiva1ds
059870061109     c*
059880061109     c                   if        xcfivaflg < *zeros
059890080904     c                   movel     xcfivamsg     vidmsg
059900061109     c                   seton                                        2890
059910061109     C                   GOTO      ENDIND
059920061109     c                   endif
059930151106     c                   eval      wCdfFlg=xcfivaflg
059940151106     c*****              endif
059950061109     c
059960061109     c* MITTENTE: COD FISCALE OBBLIGATORIO FORZABILE, SE prepagato 8888
059970071022     c*  22              if        Wcli='M' and wccm=8888  and
059980071022     c*                            wcdf=*blanks  and e14nar=*blanks
059990120503     c*  22              if        Wcli='M' and wccm=8888
060000120503     c*                            and e14nar=*blanks and (wcdf=*blanks
060010120503     c*                            or (wiva=*blanks and dateu>=§vpopiv))
060020120508     c* MITTENTE: PREPAGATO
060030120508    1c   22              if        Wcli='M' and e14nar=*blanks
060040120508     c* P.iva $$ sempre errore
060050120508    2c                   if        %scan('$$':wiva) >0
060060120508     c                   movel     err(345)      vidmsg
060070120508     c                   seton                                        702890
060080120508     C                   GOTO      ENDIND
060090120508    2c                   endif
060100120508     c* Prepagato 8888
060110120508   1ac                   if        wccm=8888
060120120503     c* errore forzabile: Codice fiscale o Partita iva
060130120504    2c                   if        wcdf=*blanks   and wiva=*blanks
060140120503     c* errore forzabile: se inserito codice fiscale lungo 11 inserire anche la
060150120503     c*                   P.IVA
060160120503     c                             or (wcdf<>*blanks and %subst(wcdf:12:1)=' '
060170120503     c                                 and wiva=*blanks)
060180061109     c* Se cambiato mittente ricontrollo
060190120504    3c                   if        i14rsc<>savrsm
060200120503     c                   clear                   forzcdf           1
060210120504     c                   clear                   forzcdf1          1
060220120503     c                   movel     i14rsc        savrsm
060230120504    3c                   endif
060240151106
060250151106     c                   clear                   xcfiva1ds
060260151106     c                   eval      xcfivamod = 'P'
060270151106     c                   eval      xcfivapar = wcdf
060280151106     c                   eval      xcfivanar = e14nar
060290151106     c                   eval      xcfivaprv = e14prv
060300151106     c                   eval      xcfivacap = e14cap
060310151106     c                   eval      xcfivaloc = e14loc
060320151106     c                   eval      xcfivapiva= wiva
060330151106     c                   eval      XCFIVAP88='8'
060340151106     c                   call      'XCFIVAR1'
060350151106     c                   parm                    xcfiva1ds
060360061109     c*
060370130131     c* 31/01/2013: Errori non più forzabili ma sempre bloccanti
060380120504    3c                   select
060390130131     c****               when      forzcdf=' ' and wcdf=*blanks
060400151106     c                   when      wcdf=*blanks
060410151106     c                   select
060420151106     c* entrambi inseribili --> chiedo uno o l'altro
060430151106     c                   when      wcdfflg<>9 and xcfivaflg<>9
060440151106     c                   movel     err(343)      vidmsg
060450151106     c* solo codice fiscale
060460151106     c                   when      wcdfflg<>9
060470151106     c                   movel     err(364)      vidmsg
060480151106     c* solo partita IVA
060490151106     c                   when      xcfivaflg<>9
060500151106     c                   movel     err(344)      vidmsg
060510151106     c                   endsl
060520151106     c                   if        wcdfflg<>9 or xcfivaflg<>9
060530120504     c                   movel     '1'           forzcdf
060540120504     c                   z-add     -1            xcfivaflg
060550120504     c                   seton                                        2890
060560120504     C                   GOTO      ENDIND
060570151106     c                   endif
060580130131     c****               when      forzcdf1=' ' and wcdf<>*blanks
060590151106     c                   when      wcdf<>*blanks and xcfivaflg<>9
060600120503     c                   movel     err(344)      vidmsg
060610120504     c                   movel     '1'           forzcdf1
060620120503     c                   z-add     -1            xcfivaflg
060630120503     c                   seton                                        2890
060640120503     C                   GOTO      ENDIND
060650120504    3c                   endsl
060660120504    2c                   endif
060670120508   1ac                   endif
060680120504    1c                   endif
060690061109     c
060700020207     c* DESTINATARIO
060710020207     c     WCLI          ifeq      'D'
060720020207     C* SE IMMESSA LINEA DI ARRIVO PER DPD DEVE ESSERE UNA LINEA
060730020207     C* DPD    -   STESSA COSA PER FED-EX
060740020207     C     VIDDPD        IFEQ      'D'
060750051028     C**   O14IE         ANDEQ     'E'
060760020207     C     COMLNA        andgt     0
060770020207     C     COMLNA        ANDNE     O14LAD
060780020319     C     A_§OGNTW      ANDNE     'DPD'
060790020207     C     VIDDPD        oreq      'F'
060800051028     C**   O14IE         ANDEQ     'E'
060810020207     C     COMLNA        andgt     0
060820020207     C     COMLNA        ANDNE     O14LAF
060830020213     C     A_§OGNTW      ANDNE     'FED'
060840020207     C*
060850020207     C                   MOVEa     ERR(183)      k78
060860020207     C                   SETON                                        4790
060870020207     c     viddpd        ifeq      'D'
060880020207     c                   eval      w005a = 'DPD  '
060890020207     c                   else
060900020207     c                   eval      w005a = 'FedEx'
060910020207     c                   endif
060920020214     c                   movea     w005a         k78(66)
060930020207     C                   MOVEA     K78           VIDMSG
060940020211     C                   GOTO      ENDind
060950020207     c*
060960020207     C                   ENDIF
060970020207     c*
060980020207     c                   select
060990020207     C* SE LNA DPD =000 NON C'E' IL SERVIZIO
061000020207     c     viddpd        wheneq    'D'
061010020207     C     o14lad        andle     *ZEROS
061020020213     c     comlna        andeq     *zeros
061030020319     c     A_§ogNTW      oreq      'DPD'
061040020207     c     o14lad        andle     *zeros
061050060921     c* se però c'e' reso non do errore
061060060921     c                   if        o14red=' ' or
061070060921     c                             (o14red='S' and vidfbr<>'S')
061080020207     C                   MOVEL     ERR(192)      VIDMSG
061090020207     C                   SETON                                        90
061100020207     c     viddpd        ifeq      'D'
061110020207     c                   z-add     21            h1riga
061120020207     c                   z-add     10            h1colo
061130020207     c                   else
061140020207     C                   SETON                                        47
061150020207     c                   endif
061160020207     C                   GOTO      ENDind
061170060921     c                   endif
061180060921     c
061190020207     C* SE LNA FEDEX=000 NON C'E' IL SERVIZIO
061200020207     c     viddpd        wheneq    'F'
061210020207     C     o14laf        andle     *ZEROS
061220020213     c     comlna        andeq     *zeros
061230020213     c     A_§ogntw      oreq      'FED'
061240020207     C     o14laf        andle     *ZEROS
061250020207     C                   MOVEL     ERR(244)      VIDMSG
061260020207     C                   SETON                                          90
061270020207     c     viddpd        ifeq      'F'
061280020207     c                   z-add     21            h1riga
061290020207     c                   z-add     10            h1colo
061300020207     c                   else
061310020207     c                   seton                                        47
061320020207     c                   endif
061330020207     C                   GOTO      ENDind
061340020207     c* se flag EuroExpress = blank non c'è il servizio
061350020207     c     viddpd        wheneq    ' '
061360020207     c     o14ie         andeq     'E'
061370020207     c     o14eex        andeq     *blanks
061380020213     c     comlna        andeq     *zeros
061390020213     c     A_§ogntw      oreq      'EEX'
061400020207     c     o14eex        andeq     *blanks
061410020214     C                   MOVEL     ERR(247)      VIDMSG
061420020207     C                   SETON                                          90
061430020213     c     A_§ogntw      ifeq      'EEX'
061440020212     c     *in12         oreq      *on
061450020212     c     *in15         andeq     *off
061460020207     c                   seton                                        47
061470020207     c                   else
061480020207     c                   z-add     21            h1riga
061490020207     c                   z-add     10            h1colo
061500020207     c                   endif
061510020207     C                   GOTO      ENDind
061520020207     c                   endsl
061530020207     c                   endif
061540970707     C*************
061550020214     C* CONTROLLO CAP -
061560160324     c*****              if        w_vediP=*blanks
061570970707     C                   MOVEL     '7'           I95TCN
061580160324     c****               else
061590160324     C****               MOVEL     '3'           I95TCN
061600160324     C****               eval      i13cng='S'
061610160324     c****               endif
061620970707     C                   MOVEL     E14CAP        I95CAP
061630970707     C                   MOVEL     E14LOC        I95LOC
061640970707     C                   MOVEL     E14PRV        I95PRV
061650970707     C                   MOVEL     E14NAR        I95NAR
061660970714     C                   MOVEL     BLPDSP        I95DAT
061670971201     C     §3AFCA        IFNE      0
061680971201     C                   MOVEL     'S'           I95FCA
061690971201     C                   ENDIF
061700971201     C                   MOVEL     FLGTB1        I95TPO
061710970707     C                   MOVEL     'S'           I13AF0
061720061122     c* per disk "B" non deve controllare la congruenza della località
061730061122     c* con il cap anche quando quest'ultimo ha eccezioni
061740160323     c* anche per vedi pacco dpd
061750160323     c                   if        (wcli='D' and §1bfg6='C'
061760160323     c                             and §1bfg2='S') or
061770160323     c                             w_vediP='1'
061780061122     C                   clear                   I13AF1
061790061122     c                   else
061800970707     C                   MOVEL     'S'           I13AF1
061810061122     c                   endif
061820061122     c
061830970707     C                   MOVEL     'S'           I13SZ2
061840140122     C* CAP CON VIARIO: NON CONTROLLO PER DISK B
061850160323     c* non controllo nemmeno per vedi pacco dpd
061860000704     C     §1BFG6        IFNE      'C'
061870160324     C     w_vediP       andne     '1'
061880140122     C**** §1BFG2        ORNE      'S'
061890150304     c                   if        §vpouttlls='N'
061900150623     c******                       and simpou<>28 and simpou<>50
061910150304     C                   MOVEL     'S'           I13CNV
061920150304     c                   else
061930150121     C                   MOVEL     'Y'           I13CNV
061940150123     c                   movel     vidind        i95ind
061950150304     c                   endif
061960000704     C                   ENDIF
061970970707     C                   MOVEL     'S'           I13SZV
061980140121     c                   if        wcli='D'
061990140121     c                   clear                   dspr
062000140121     C                   MOVEL     'PR'          COD
062010140121     C                   MOVEL(P)  i95prv        KEY
062020140121     c     ktab2         chain     tabel00f
062030140121     c                   if        %found(tabel00f)
062040140121     c                   eval      dspr=tbluni
062050140121     c                   endif
062060140121     c                   if        §prpla='S'
062070140121     c                   clear                   i13szv
062080140121     c                   endif
062090140121     c                   endif
062100991213     C* PER LNP DPD, CONTROLLO CONGRUENZA LOCALITA' CAP E PROVINCIA
062110160323     C*  E NON SOLO CAP E PROVINCIA
062120160323     c* Per Vedi pacco dpd non faccio mai questo controllo
062130160323     c     w_vediP       ifne      '1'
062140020319     C     §OGNTW        IFEQ      'DPD'
062150000622     C* CONTROLLO PER TUTTI TRANNE CHE PER DSK "B"
062160000622     C     §1BFG6        ORNE      'C'
062170000622     C     §1BFG2        ORNE      'S'
062180000314      * TESTIAMO CONTROLLO SU SPEDIZIONI DI VERONA 15/03/00
062190000322      * TESTIAMO CONTROLLO SU SPEDIZIONI DI TREVISO 22/03/00
0622009912139/12 C                   MOVEL     'S'           I13LA3
0622109912139/12 C                   MOVEL     'S'           I13SZ3
062220991213     C                   ENDIF
062230160323     C                   ENDIF
062240970707     C**
062250970708     C**  M I T T E N T E
062260970707    1C     WCLI          IFEQ      'M'
062270970707     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO : ERRORE FORZABILE
062280970707    2C     E14CAP        IFNE      VARCAM
062290970707     C                   CLEAR                   OTT
062300970707     C                   CLEAR                   MMA
062310970707     C                   CLEAR                   MMB
062320000622     C                   CLEAR                   MMD
062330970707     C                   MOVEL     E14CAP        VARCAM
062340970707    2C                   ENDIF
062350970707     C** MODIFICA LOCALITA'
062360970707    2C     E14LOC        IFNE      VARLOM
062370970707     C                   MOVEL     E14LOC        VARLOM
062380970707     C                   CLEAR                   MMA
062390970707     C                   CLEAR                   MMB
062400000622     C                   CLEAR                   MMD
062410970707    2C                   ENDIF
062420970708     C**
062430970707     C                   MOVEL     OTT           E13FZV
062440970707     C                   MOVEL     MMA           E13FZ1
062450970707     C                   MOVEL     MMB           E13FZ2
062460000622     C                   MOVEL     MMD           E13FZ3
062470020218     c* se network fedex passo flag apposito per dire di prendere i dati
062480020218     c* dalla tabella della nazione
062490020218     c     §ogntw        ifeq      'FED'
062500020218     c                   movel     'S'           i95fi1
062510020218     c                   endif
062520970708     C**
062530970708     C                   ELSE
062540970708     C**
062550970708     C**  D E S T I N A T A R I O
062560970708     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO
062570970708    2C     E14CAP        IFNE      VARCAD
062580970708     C                   CLEAR                   DIE
062590970708     C                   CLEAR                   SET
062600970708     C                   CLEAR                   AAA
062610970708     C                   CLEAR                   AAB
062620991213     C                   CLEAR                   AAD
062630970708     C*
062640970708     C* SE CAMBIATO MA IN MANUTENZIONE RIMESSO QUELLO DELLA BOLLA  -->
062650970708     C*  COME SE NON FOSSE CAMBIATO NULLA
062660970708    3C     *IN12         IFEQ      *ON
062670970708     C     *IN15         ANDEQ     *OFF
062680970708     C     E14CAP        ANDEQ     BLPCAD
062690970708     C                   CLEAR                   NOV
062700970708     C                   ELSE
062710970708     C                   CLEAR                   QUA
062720100209     C                   CLEAR                   QUAH
062730970708     C                   MOVEL     '1'           NOV
062740970708    3C                   ENDIF
062750970708     C* MEMORIZZO NUOVO CAP
062760970708     C                   MOVEL     E14CAP        VARCAD
062770970708    2C                   ENDIF
062780970708     C* MODIFICA LA LOCALITA'
062790970708    2C     E14LOC        IFNE      VARLOD
062800970708     C                   MOVEL     E14LOC        VARLOD
062810970708     C                   CLEAR                   AAA
062820970708     C                   CLEAR                   AAB
062830991213     C                   CLEAR                   AAD
062840970708    2C                   ENDIF
062850970708     C**
062860970708     C                   MOVEL     SET           E13FZV
062870970708     C                   MOVEL     AAA           E13FZ1
062880970708     C                   MOVEL     AAB           E13FZ2
062890991213     C                   MOVEL     AAD           E13FZ3
062900020212     c* se network fedex passo flag apposito per dire di prendere i dati
062910020212     c* dalla tabella della nazione
062920020213     c     A_§ogntw      ifeq      'FED'
062930020212     c     viddpd        oreq      'F'
062940020218     c     o14ie         andeq     'E'
062950020212     c                   movel     'S'           i95fi1
062960060922     c                   movel     'FED'         i97ntw
062970020212     c                   endif
062980060922     c*
062990060922     c     A_§ogntw      ifeq      'DPD'
063000060922     c     viddpd        oreq      'D'
063010060922     c     o14ie         andeq     'E'
063020060922     c                   movel     'DPD'         i97ntw
063030060922     c                   endif
063040060922     c* se non ancora impostato ed è estero, è euroexpress
063050060922     c                   if        (i97ntw=*blanks and o14ie='E') or
063060060922     c                             (i97ntw=*blanks and A_§ogntw='EEX')
063070060922     c                   movel     'EEX'         i97ntw
063080060922     c                   endif
063090970707    1C                   ENDIF
063100970722     C**
063110970722     C* SE RICHIAMO DALLA CONFERMA BOLLE SENZA FERMARSI SULLA BOLLA
063120970722     C*  IN CASO DI ERRORE NON DO L'INTERROGAZIONE LOCALITA' IN CASO
063130970722     C*  DI RESTITUZIONE AFFIDABILITA'=1
063140970722     C   12
063150970722     CAN 15§LPFPR        IFNE      'V'
063160970722     C     §LPFPR        ANDNE     'X'
063170970722     C                   MOVEL     1             E13FZ1
063180970722     C                   ENDIF
063181170831     C   12
063182170831     CANN15§LPFPR        IFeq      'N'
063183170831     C                   MOVEL     1             E13FZ1
063184170831     C                   ENDIF
063190970707     C**
063200970707     C** CALL
063210150907     C                   eval      wlv13_giro2=' '
063220150907     c                   exsr      sr_LV13
063230970708     C**
063240970708     C     WEMFOR        IFEQ      '1'
063250970708     C                   GOTO      ENDIND
063260970708     C                   ENDIF
063270150907
063280150907     c                   if        wlv13='S'
063290150907     C                   MOVEL     E14CAP        I95CAP
063300150907     C                   eval      wlv13_giro2='S'
063310150907     c                   exsr      sr_lv13
063320150907     C     WEMFOR        IFEQ      '1'
063330150907     C                   GOTO      ENDIND
063340150907     C                   ENDIF
063350150907     c                   endif
063360080410     c* PORTI ASSEGNATI
063370080410     c* Se porto assegnato effettuabile solo a fronte di orm commissionato
063380080410     c* da p.o. del network verifico che il p.o. emittente sia quello del
063390080410     c* network
063400080410     c                   clear                   wnocont
063410080411    1c                   if        o97uti='N' and wcli='D'
063420080410     c* Se provengo da manutenzione di bolla di reso lo memorizzo
063430080410     c* per non effettuare il controllo seguente
063440080411    2c     *in12         ifeq      *on
063450080410     c     *in15         andeq     *off
063460080410     c     vidfbr        andeq     'S'
063470080410     c                   move      'N'           wnocont           1
063480080411    2c                   endif
063490080410     c                   movel     o97flo        dcppflo
063500080410     c* ricavo p.o. emittente
063510080411    2c                   if            §cpppas='O' and wnocont=*blanks
063520080410     c                             and i95tpo='A'
063530080410     c* non richiamato da giacenze o ritiri annullati
063540080410     c                             and savfpr<>'P' and savfpr<>'G'
063550080410     c                             and savfpr<>'T'
063560080410     c* orm fittizio oppure orm non commissionato da po del network
063570080411    3c                   if        flgfit='S' or i97ntw<>poentw
063580080411    4c                   if        wperso='P'
063590080410     C                   Z-ADD     05            H0RIGA
063600080410     C                   Z-ADD     20            H0COLO
063610080410     c                   else
063620080410     C                   Z-ADD     06            H1RIGA
063630080410     C                   Z-ADD     20            H1COLO
063640080411    4c                   endif
063650080410     c                   seton                                        90
063660080410     c* preparo il testo del messaggio
063670080410     c                   movel     err(229)      vidmsg
063680080411     C                   CLEAR                   dsbs02
063690080411     c                   clear                   dntw
063700080411     C                   MOVEL     'C'           T02MOD
063710080411     C                   MOVEL     KNSIF         T02SIF
063720080411     C                   MOVEL     'NTW'         T02COD
063730080411     c                   movel(P)  i97ntw        t02ke1
063740080411     C                   CALL      'TIBS02R'
063750080411     C                   PARM                    KPJBA
063760080411     C                   PARM                    dsbs02
063770080411    4C                   IF        T02ERR = *BLANKS
063780080411     C                   MOVEL     T02uni        dntw
063790080411    4C                   ENDIF
063800080411     c                   eval      %subst(vidmsg:14:5)=%subst(§ntwdes:1:5)
063810080411     c                   eval      %subst(vidmsg:71:5)=%subst(§ntwdes:1:5)
063820080410     C                   GOTO      ENDIND
063830080411    3c                   endif
063840080411    2c                   endif
063850080411    1c                   endif
063860090827     c*
063870090921     c* Per destinatario vedo se il tipo servizio prevede un codice tempo
063880090827     c*  consegna obbligato, anche parziale
063890100322     c* Se esiste FNORE --> dico che si può utilizzare
063900100322     c                   if        Wcli='D' and WesORE='N'
063910100322     c                   movel     'S'           wesore
063920100322     c                   endif
063930100322     c
063940100125    1c                   if        vidtsp<>' ' and wcli='D'
063950100322
063960090827     C                   Z-ADD     1             C
063970090827     C     vidtsp        LOOKUP    TSP(C)                                 30
063980090827    2C                   IF        *in30  and TSttc(c)<>*blanks
063990090827     c* controllo posizione per posizione escudendo le "x"
064000090827     c                   eval      Wttc=TSttc(c)
064010090827     c                   eval      WttcCAP=%editc(o95ttc:'X')
064020090827     c                   z-add     1             c
064030090921    3c                   do        5             c
064040090827     c                   if        %subst(wttc:c:1)<>'x'
064050090827     c                             and
064060090827     c                             %subst(wttc:c:1)<>%subst(wttcCAP:c:1)
064070090827     C                   MOVEL     ERR(307)      VIDMSG
064080090827     c                   seton                                        9048
064090090827     C                   MOVEL     '1'           WEMFOR
064100100319     c* Se vengo da ORM --> memorizzo di non considerare FNORE
064110100319     c*  perchè incongruente col CAP
064120100319     c                   if        wesORE='S'
064130100319     c                   movel     'N'           wesore
064140100319     c                   endif
064150100319
064160100319     C                   GOTO      ENDIND
064170090827     c                   endif
064180090921    3c                   enddo
064190090827     c
064200090921    2c                   endif
064210090921     c
064220090921     c* Se fermo deposito non accetto tipo servizio H
064230090921    2c                   if        vidtsp='H'  and vidffd='S'
064240090921     C                   MOVEL     ERR(101)      VIDMSG
064250090921     c                   seton                                        9048
064260090921     C                   MOVEL     '1'           WEMFOR
064270090921     C                   GOTO      ENDIND
064280090921    2c                   endif
064290090921    1c                   endif
064300080410     c
064310000622     C**
064320000622     C* SE SI TATTA DI CAP OBSOLETO, ERRORE NO FORZABILE
064330061010     C***  §1BFG6        IFNE      'C'
064340061010     C***  §1BFG2        ORNE      'S'
064350061010     C***  O95CF1        IFEQ      'O '
064360061010     C***  WCLI          IFEQ      'M'
064370061010     C***                SETON                                        5390
064380061010     C***                ELSE
064390061010     C***                SETON                                        6590
064400061010     C***                ENDIF
064410061010     C***                MOVEL     ERR(201)      VIDMSG
064420061010     C***                MOVEL     '1'           WEMFOR
064430061010     C***                GOTO      ENDIND
064440061010     C***                ENDIF
064450061010     C***                ENDIF
064460970704     C**
064470970704     C* M I T T E N T E
064480970704    1C     WCLI          IFEQ      'M'
064490970704     C                   MOVEL     O14IE         WMITIE            1
064500970704     C                   MOVEL     O14VLT        MITVLT
064510970704     C                   MOVEL     O95ISO        COMFAP
064520970708     C                   MOVEL     O95CTS        MITCTS            2
064530140403     C                   MOVEL     O95gf2        comgf2
064540970704     C**
064550970704   X1C                   ELSE
064560970704     C*
064570970704     C                   MOVEL     O14IE         WDESIE            1
064580970704     C                   MOVEL     O14VLT        DESVLT
064590970704     C                   MOVEL     O14EFT        DESEFT
064600000321     C                   MOVEL     O14EFD        DESEFD
064610971215     C                   MOVEL     O14COD        DESCOD
064620000120     C                   MOVEL     O14LAD        DESLAD
064630060920     C                   MOVEL     O14red        DESred
064640020130     C                   MOVEL     O14eff        DESeff
064650020131     C                   MOVEL     O14ffn        DESffn
064660080414     c***                movel     x_§15cex      descaeex
064670080414     c***                movel     x_§15cdp      descadpd
064680080414     c***                movel     x_§15cfe      descafed
064690970704     C                   MOVEL     O95ISO        COMFIN
064700970704     C                   MOVEL     O95GDD        DESGDD            1
064710021118      * Se spedizione export il DDT va sempre impostato a 'N'
064720021118     c                   If        O14ie = 'E'
064730021118     c                   Eval      DesGdd = 'N'
064740021118     c                   EndIf
064750021118      * Mi salvo flag ddt
064760021118     c                   Eval      SavGdd = O95Gdd
064770970704     C   12
064780970704     CAN 15
064790970704     CORN12              MOVEL     O95CTS        SAVCTS            2
064800970704     C*
064810970704     C* MANUTENZIONE RICALCOLO COD TASSAZIONE SOLO SE CAMBIATA PROV
064820990629     C*  NAZIONE E CAP
064830970704     C   12
064840970704     CANN15BLPPRD        IFNE      E14PRV
064850990629     C     BLPNZD        ORNE      E14NAR
064860990629     C     BLPCAD        ORNE      E14CAP
064870030320     c     blpnzd        orne      *Blanks
064880030320     c     e14nar        orne      *Blanks
064890970704     C                   MOVEL     O95CTS        SAVCTS
064900970704     C                   ENDIF
064910970704     C**
064920970704    1C                   ENDIF
064930970704     C*
064940970704     C     ENDIND        ENDSR
064950970707     C*
064960970707     C* CONTROLLO SE C'E' ERRORE-------------------------------------*
064970970707     C     CTRERR        BEGSR
064980150907     c                   clear                   wlv13
064990970708     C* IMPOSTO CAMPI PASSATI
065000970708     C     O13RON        IFEQ      'S'
065010970708     C                   MOVEL     O95NAR        E14NAR
065020970708     C                   ENDIF
065030970708     C     O13ROC        IFEQ      'S'
065040970708     C                   MOVEL     O95CAP        E14CAP
065050970708     C                   ENDIF
065060970708     C     O13ROP        IFEQ      'S'
065070970708     C                   MOVEL     O95PRV        E14PRV
065080970708     C                   ENDIF
065090970708     C     O13ROL        IFEQ      'S'
065100970708     C                   MOVEL     O95LOC        E14LOC
065110970708     C                   ENDIF
065120970708     C**
065130970707     C* ERRORE O RICERCA CAMPO
065140970707    1C     WERR          IFNE      ' '
065150150907     c* Per controllo dati Destinatario
065160150907     c* l'errore con il posizionamento cursore lo emetto solo se
065170150907     c* CAP non reperito o non è stato reperito il SOLO cap
065180150907     c* L'unico caso è il msg:
065190150907     c* ATTENZIONE!! Presenti dati incongruenti: modificati.Enter per continuare
065200150907     c* che si è deciso di non emettere più perchè inutile al bollettista pur
065210150907     c* modificando i dati inseriti da quest'ultimo in base a quanto rieperito
065220150907     c* da lv13/tisi95
065230150907     c                   if        wcli='M' or
065240150907     c                             o13roc<>'S' or
065250150907     c                             (o13rop='S' or o13rol='S' or o13ron='S')
065260150907     c                             or wlv13_giro2='S'
065270970707     C*
065280970707    2C     VIDMSG        IFNE      *BLANKS
065290970707     C                   SETON                                        90
065300970707    2C                   ENDIF
065310970707     C* POSIZIONAMENTO CURSORE
065320970707    2C                   SELECT
065330970707    2C     WERR          WHENEQ    '1'
065340970707     C     WERR          OREQ      '2'
065350970707    3C     WCLI          IFEQ      'M'
065360970707     C                   SETON                                        52
065370970707     C                   ELSE
065380970707     C                   SETON                                        64
065390970707    3C                   ENDIF
065400970707    2C     WERR          WHENEQ    '3'
065410970707    3C     WCLI          IFEQ      'M'
065420970707     C                   SETON                                        54
065430970707     C                   ELSE
065440150826     C                   SETON                                        6638
065450970707    3C                   ENDIF
065460970707    2C     WERR          WHENEQ    '4'
065470970707    3C     WCLI          IFEQ      'M'
065480970707     C                   SETON                                        55
065490970707     C                   ELSE
065500970707     C                   SETON                                        71
065510970707    3C                   ENDIF
065520970707    2C     WERR          WHENEQ    '5'
065530970707    3C     WCLI          IFEQ      'M'
065540970707     C                   SETON                                        53
065550970707     C                   ELSE
065560150826     C                   SETON                                        6538
065570970707    3C                   ENDIF
065580970707    2C     WERR          WHENEQ    '6'
065590970707     C                   SETON                                        68
065600970707    2C     WERR          WHENEQ    '7'
065610970707     C                   SETON                                        70
065620970707    2C     WERR          WHENEQ    '8'
065630970707     C                   SETON                                        10
065640020204     c     werr          wheneq    '0'
065650020204    3C     WCLI          IFEQ      'M'
065660020204     C                   SETON                                        55
065670020204     C                   ELSE
065680020204     C                   SETON                                        71
065690020204    3C                   ENDIF
065700970707    2C                   ENDSL
065710970707     C*
065720970707     C                   MOVEL     '1'           WEMFOR
065730150907     c                   else
065740150907     c* Controllo indirizzo destinatario e poposto cap
065750150907     c* per avere i dati corretti del cappario bisogna richiamare nuovamente
065760150907     c* lv13
065770150907     c                   eval      wlv13='S'
065780970707    1C                   ENDIF
065790150825    1C                   ENDIF
065800970707    1C                   ENDSR
065810150907     c
065820150907     C* Richiamo FNLV13R da CTRIND  ---------------------------------*
065830150907     C     sr_LV13       BEGSR
065840150907
065850150907     c                   if        §3arbl<>'R'
065860150907     C                   CALL      'FNLV13R'
065870150907     C                   PARM                    KPJBA
065880150907     C                   PARM                    DSLV13
065890150907     C                   PARM                    DSSI95
065900150907     C                   PARM      ' '           flgbac            1
065910150907     C                   PARM                    tisi97ds
065920150907     c                   else
065930150907     C                   CALL      'FNLV13R'
065940150907     C                   PARM                    KPJBA
065950150907     C                   PARM                    DSLV13
065960150907     C                   PARM                    DSSI95
065970150907     C                   PARM      ' '           flgbac            1
065980150907     c                   endif
065990150907     C*
066000150907     C                   MOVEL     O13ERR        WERR              1
066010150907     C                   MOVEL     O13MSG        VIDMSG
066020150907     C                   EXSR      CTRERR
066030150907     C**
066040150907     C* REIMPOSTO LE FORZATURE
066050150907     C     WCLI          IFEQ      'M'
066060150907     C                   MOVEL     E13FZV        OTT
066070150907     C                   MOVEL     E13FZ1        MMA
066080150907     C                   MOVEL     E13FZ2        MMB
066090150907     C                   MOVEL     E13FZ3        MMD
066100150907     C                   ELSE
066110150907     C                   MOVEL     E13FZV        SET
066120150907     C                   MOVEL     E13FZ1        AAA
066130150907     C                   MOVEL     E13FZ2        AAB
066140150907     C                   MOVEL     E13FZ3        AAD
066150150907     C                   ENDIF
066160150907     c                   endsr
066170970704     C*
066180940916     C* CONTROLLO DATA RITIRO MERCE ----------------------------------*
066190940916     C     CTRDRT        BEGSR
066200940916     C*
066210940916     C* CONTROLLO SOLO QUANDO VIENE MODIFICATA
066220990610   0AC     PARTCH        IFEQ      'P'
066230990610     C     VIDDRT        ANDGT     0
066240010307     C     §LPFPR        OREQ      'O'
066250010307     C     VIDDRT        ANDGT     0
066260990610     C     PARTCH        ORNE      'P'
066270010307     C     §LPFPR        ANDNE     'O'
066280940916    0C     VIDDRT        IFNE      SAVDRT
066290950215     C     VIDDRT        OREQ      0
066300070808     C* Se O.R.M. fittizio imposto a no display la scritta "DA O.R.M."
066310070808     c                   if        flgfit='S'
066320070808     c                   if        wperso='P'
066330070808     c                   movel     nodi          at0daorm
066340070808     c                   else
066350070808     c                   movel     nodi          atrdaorm
066360070808     c                   endif
066370070808     c                   endif
066380070808     c*
066390070831     c
066400940920     C                   Z-ADD     VIDDRT        G02DAT
066410940916     C                   CLEAR                   G02ERR
066420940916     C                   CALL      'XSRDA8'
066430940916     C                   PARM                    WLBDAT
066440940916     C*
066450070831     c* se in personalizzazione e non immessa data ritiro non è obbligatoria
066460070905     c* se l'orm è fittizio
066470070905     c* non è obbligatoria anche se non immessa la data e non immesso l'ORM
066480071107     c****               if        wperso='P' and dateu>=§vpodrt and
066490071107     c                   if        wperso='P' and
066500070905     c                             viddrt=0 and
066510070905     c                             ((flgfit='S' and widor1>*zeros) or
066520070905     c                             widor1=*zeros)
066530070831     c                   else
066540940916     C* SE ERRATA O MAGGIORE DI WDTGIO ERRORE
066550080109     C* NO < DI xx GIORNI DA OGGI (come da tabella "3I")
066560070904    1C*    G02ERR        IFEQ      '1'
066570070904     C*    G02INV        ORGT      DATEU
066580070904     C*    PARTCH        ANDNE     'P'
066590070904     C*    §LPFPR        ANDNE     'O'
066600070904     C*    G02INV        ORLT      DATAM
066610070904     c                   if        g02err='1' or (g02inv>dateu and
066620070904     c                             partch<>'P' and §lpfpr<>'O')
066630110420     c                             or (g02inv<datamin and not *in22)
066640110420     c                             or (g02inv<datam40 and     *in22)
066650071107     c***                          or (g02inv<datam and (dateu<§vpodrt or
066660080109     c***                          or (g02inv<datamin and (
066670080109     c***                          flgfit='S' or s_drt<>viddrt))
066680940916     C                   MOVEL     ERR(6)        VIDMSG
066690940920     C                   SETON                                        4390
066700080109     c* se errore data ritiro in quanto viene forzata data orm aggiungo
066710080109     c* nel messaggio di verificare l'orm
066720080128     c                   if        g02inv<datamin and flgfit<>'S' and not *in22
066730080109     c                   eval      vidmsg=%trim(vidmsg)
066740080109     c                             + ': verificare l''O.R.M.'
066750080109     c                   endif
066760940916    1C                   ENDIF
066770110422     c* Se prepagato e immessa data più vecchia di datamin
066780110422     c* errore forzabile
066790110422     c                   if        g02inv<datamin and *in22 and wforzadrt=*off
066800110422     C                   MOVEL     ERR(339)      VIDMSG
066810110422     c                   eval      %subst(vidmsg:49:2)=%char(§3iggb)
066820110422     C                   SETON                                        4390
066830110422     c                   eval      wforzadrt=*on
066840110422     c                   endif
066850070831     c                   endif
066860940916     C* OK
066870940916     C  N90              MOVE      G02INV        COMDRT
066880940916     C  N90              MOVE      G02DAT        VIDDRT
066890940916     C*
066900950215     C  N90              MOVEL     VIDDRT        SAVDRT
066910070829     C  N90              MOVEL     VIDDRT        S_DRT
066920940916    0C                   ENDIF
066930990610   0AC                   ENDIF
066940990610     C*
066950990610     C     VIDDRT        IFEQ      0
066960990610     C                   CLEAR                   COMDRT
066970990610     C                   CLEAR                   SAVDRT
066980990610     C                   ENDIF
066990990628     C* PRESTAZIONE MATTINO POMERIGGIO
067000040909     C  N90PARTCH        IFNE      'P'
067010010307     C     §LPFPR        ANDNE     'O'
067020990628     C     VIDFPP        ANDEQ     ' '
067030010503     C     WPERSO        ANDNE     'P'
067040990628     C                   MOVEL     ERR(163)      VIDMSG
067050990628     C                   SETON                                        4090
067060990628    1C                   ENDIF
067070940916     C                   ENDSR
067080940824     C*
067090940824     C* CONTROLLO NAZIONE E P.IVA ------------------------------------*
067100940907     C     CTRNAR        BEGSR
067110940824     C*
067120020211     C                   MOVEL     '15'          COD
067130020211     C                   MOVEL     '15'          CODTAB
067140940824     C* RICERCA
067150940824     C     '?'           SCAN      WNAR                                   30
067160941003    1C     *IN30         IFEQ      *ON
067170020213     c                   call      'TRUL19R'
067180020130     c                   parm                    codtab            2
067190020305     c                   parm      '1'           ordina            1
067200020130     c                   parm                    keytab            8
067210020130     c                   parm                    cmd               1
067220020130     C                   MOVEL     keytab        WNAR
067230940824     C                   GOTO      ENDCNA
067240941003    1C                   ENDIF
067250940824     C* CONTROLLO
067260940920     C                   MOVEL(P)  WNAR          KEY
067270940824     C*
067280940824     C                   EXSR      CTABEL
067290940824     C*
067300941003    1C     *IN30         IFEQ      *ON
067310940824     C                   MOVEL     ERR(28)       VIDMSG
067320940920     C                   SETON                                        6890
067330940824     C                   GOTO      ENDCNA
067340941003    1C                   ENDIF
067350941003     C*
067360941003     C                   MOVEL     TBLUNI        DS15
067370940907     C*
067380940825     C     ENDCNA        TAG
067390940825     C   90              MOVEL     '1'           WEMFOR
067400940825     C                   ENDSR
067410940824     C*
067420940824     C* CONTROLLO LINEA DI PARTENZA ---------------------------------*
067430940824     C     CTRLNP        BEGSR
067440940824     C*
067450940824    1C     SAVLNP        IFNE      WLNP
067460981007     C     BLPDSP        ORNE      SAVDSP
067470000518     C* RICNTROLLO SE BOLLA IMPORT DPD MA INDICATORE RELATIVO SPENTO
067480020319     C     §OGNTW        OREQ      'DPD'
067490000518     C     *IN79         ANDEQ     *OFF
067500940824     C* CONTROLLO CHE SIA GESTIBILE
067510070807     c                   if        simtpp='2' or simtpp=*blanks
067520070807     C     WLNP          LOOKUP    L6                                     30
067530070807     c                   else
067540940824     C     WLNP          LOOKUP    L1                                     30
067550070807     c                   endif
067560940928    2C     *IN30         IFEQ      *OFF
067570940824     C                   MOVEL     ERR(8)        VIDMSG
067580940920     C                   SETON                                        9045
067590940824     C                   GOTO      ENDCLP
067600940928    2C                   ENDIF
067610941230     C*
067620940824     C                   Z-ADD     WLNP          W0030             3 0
067630940824     C     W0030         CHAIN     AZORG01L      UNIORG               30
067640940928    2C     *IN30         IFEQ      *ON
067650940921     C     *IN30         OREQ      *OFF
067660940921     C     ORGFVA        ANDNE     *BLANKS
067670940824     C                   MOVEL     ERR(8)        VIDMSG
067680940920     C                   SETON                                        9045
067690940824     C                   GOTO      ENDCLP
067700940928    2C                   ENDIF
067710971211     C**
067720971211     C* MEMORIZZO IL CAPO SDI E SE E' ESTERO
067730000121     C*
067740991130      * DATI DPD: SE LNP DPD PROTEGGO SEMPRE RMA E SE LA SIGLA OPERATORE
067750991130      *           È UNA DI QUELLE PROTETTE, *IN13 = *ON, ANCHE RMN
067760991117     C                   MOVEL     ORGDE3        OG143
067770020319     C     §OGNTW        COMP      'DPD'                                  79
067780940824     C*
067790940824     C* PRENDO TERMINAL PARTENZA LINEA DI PARTENZA
067800970925     C                   CLEAR                   DSLV55
067810970925     C                   MOVEL     'P'           D55TPT
067820970925     C                   MOVEL     W0030         D55LIN
067830970925     C                   MOVEL     BLPDSP        D55DRF
067840970925     C                   CALL      'FNLV55R'
067850970925     C                   PARM                    DSLV55
067860970925     C     D55ERR        IFEQ      ' '
067870970925     C                   MOVEL     D55TFP        COMTFP            3 0
067880970925     C                   ELSE
067890001024     C                   MOVEL     ERR(211)      VIDMSG
067900001024     C                   SETON                                        9045
067910001024     C                   GOTO      ENDCLP
067920970925     C                   ENDIF
067930940824     C*
067940940824     C* PRENDO COD TRATTAMENTO MERCE DI DFT DELLA LINEA DI PARTENZA
067950940824     C                   MOVEL     '3G'          COD
067960940920     C                   MOVEL(P)  WLNP          KEY
067970940824     C*
067980940824     C                   EXSR      CTABEL
067990940824     C  N30              MOVEL     TBLUNI        COMCTM
068000940824     C   30              MOVEL     '  '          COMCTM
068010940824     C*
068020990610     C* CAMBIATA LNP: CONTROLLO IL CLIENTE ANCHE SE PERSONALIZZATO
068030990610     C                   MOVEL     'S'           WCOCCM            1
068040010219     C* RICHIAMO ROUTINE CHE DETERMINA SE LINEA CON PROC. ORM ATTIVATA
068050010219     C     SAVLNP        IFNE      WLNP
068060010219     C                   Z-ADD     WLNP          WLNPO
068070010219     C                   EXSR      ATTORM
068080011122     C* Se cambiata lnp devo ricordarmi di eseguire il controllo O.R.M.
068090011122     C* anche se è stato personalizzato
068100011122     C     WORM          IFEQ      'S'
068110011122     C                   MOVEL     '1'           WCKORM            1
068120011122     C                   ENDIF
068130010219     C                   ENDIF
068140010219     C                   MOVEL     WLNP          SAVLNP
068150010219     C                   MOVEL     BLPDSP        SAVDSP
068160990610     C                   ENDIF
068170940824     C     ENDCLP        ENDSR
068180940824     C*
068190010212     C* CONTROLLO NUMERO O.R.M. -------------------------------------*
068200010212     C     CTRORM        BEGSR
068210010305     C     §LPFPR        IFEQ      'O'
068220010305     C                   CLEAR                   FLGFIT
068230010305     C                   ENDIF
068240011122     C* SOLO SE NON È STATO PERSONALIZZATO
068250011122     C* DEVO PERO' RICONTROLARE SEMPRE IN CASO DI VARIAZIONE DELLA LINE
068260011122     C* DI PARTENZA
068270010222    0C     *IN37         IFEQ      *OFF
068280010305     C     §LPFPR        ANDNE     'O'
068290011122     C     WCKORM        OREQ      '1'
068300010212     C                   CLEAR                   FLGFIT
068310060522     C                   CLEAR                   w_pogest
068320061124     c                   clear                   wforpf
068330010212     C* ERRORE SE NUMERO ORM = 0
068340010223    1C     WIDOR1        IFEQ      *ZEROS
068350010212     C                   MOVEL     ERR(216)      VIDMSG
068360010212     C                   SETON                                        90
068370010215    2C     WPERSO        IFEQ      'P'
068380040901     C                   Z-ADD     05            H0RIGA
068390040909     C                   Z-ADD     20            H0COLO
068400010213     C                   ELSE
068410040901     C                   Z-ADD     06            H1RIGA
068420040909     C                   Z-ADD     20            H1COLO
068430010215    2C                   ENDIF
068440010212     C                   GOTO      ENDORM
068450010212    1C                   ENDIF
068460010212     C*
068470070620     c* in manutenzione di un prepagato non si può variare il n.orm
068480070620     c                   if        *in12='1' and *in15='0' and *in22
068490070620     c                             and widorm<>s_§b4orm
068500070620     C                   SETON                                        90
068510070620     C                   MOVEL     ERR(312)      VIDMSG
068520070620     C                   SETON                                        90
068530070620    3C     WPERSO        IFEQ      'P'
068540070620     C                   Z-ADD     05            H0RIGA
068550070620     C                   Z-ADD     20            H0COLO
068560070620     C                   ELSE
068570070620     C                   Z-ADD     06            H1RIGA
068580070620     C                   Z-ADD     20            H1COLO
068590070620    3C                   ENDIF
068600070620     C                   GOTO      ENDORM
068610070620     c                   endif
068620040322      * ORM reale
068630040322if  1c                   If        widor1 <> wofit
068640010924     C                   CLEAR                   DORM01
068650010212     C     KORM          CHAIN     FNORM01L                           30
068660010924     C  N30              MOVEL     ORMFLO        DORM01
068670040322     c* se non trovato errore
068680040322    2C     *IN30         IFEQ      *ON
068690010212     C                   MOVEL     ERR(217)      VIDMSG
068700010212     C                   SETON                                        90
068710010215    3C     WPERSO        IFEQ      'P'
068720040901     C                   Z-ADD     05            H0RIGA
068730040909     C                   Z-ADD     20            H0COLO
068740010213     C                   ELSE
068750040901     C                   Z-ADD     06            H1RIGA
068760040909     C                   Z-ADD     20            H1COLO
068770010215    3C                   ENDIF
068780010212     C                   GOTO      ENDORM
068790040322    2C                   ENDIF
068800100319     c
068810100319     c* Verifico se esiste FNORE
068820100319     c*  sempre se cambiato ORM oppure se non c'è la N di IGNORARE
068830100319    2C     WIDORM        IFNE      W01ORM
068840100319     c     wesore        orne      'N'
068850100319     c                   clear                   wesore
068860100319     c                   clear                   DoreGEN
068870100319     C     KORME         CHAIN     FNORE01L                           30
068880100319     c                   if        %found(fnore01l)
068890100319     C                   MOVEL     OReDati       DOReGEN
068900100319     C                   Z-ADD     1             C
068910100319     C     §oretsp       LOOKUP    TSP(C)                                 30
068920100319    4c                   if        *in30 and uts(c)='S'
068930100319     c                   eval      WEsORE='S'
068940100319     c                   endif
068950100319     c                   endif
068960100319     c                   endif
068970040322      * ORM fittizzio
068980040322   x1c                   Else
068990100322     c                   clear                   wesore
069000100322     c                   clear                   DoreGEN
069010040322      * memorizzo
069020010212     C                   MOVEL     'S'           FLGFIT            1
069030150303     c                   if        savfpr<>'B'
069040011121     C                   CLEAR                   ATRDES
069050100319     C* devo anche pulire i campi del destinatario solo se il
069060011205     C* precedente orm prevedeva la forzatura del destinatario
069070011205     C     SORMFD        IFEQ      'S'
069080011205     C                   CLEAR                   VIDRSD
069090011205     C                   CLEAR                   VIDIND
069100011205     C                   CLEAR                   VIDCAD
069110011205     C                   CLEAR                   VIDLOD
069120011205     C                   CLEAR                   VIDPRD
069130011205     C                   CLEAR                   VIDNZD
069140011205     C                   CLEAR                   SORMFD
069150011205     C                   ENDIF
069160150303     c                   endif
069170010212    1C                   ENDIF
069180051207     c
069190051207     c                   clear                   vidmsg
069200010212     C* eseguo i seguenti controlli solo se orm non fittizio
069210010215    1C     FLGFIT        IFEQ      *BLANKS
069220010409     C* ERRORE SE O.R.M. ANNULLATO
069230010409    2C     ORMATB        IFNE      *BLANKS
069240010409     C                   MOVEL     ERR(228)      VIDMSG
069250010409   X2C                   ELSE
069260010212     C* ERRORE SE P.O. RITIRO DIVERSO DA LINEA DI PARTENZA BOLLA
069270010409    3C     ORMPOR        IFNE      WOLNP
069280060522     c* verifico se p.o. ritiro gestito dalla lnp bolla
069290060522     c* perchè in tal caso non devo dare errore se p.o. ritiro <> da
069300060522     c* lnp bolla
069310060522     c                   clear                   dslv55
069320060522     c                   eval      d55tpt = '6'
069330060522     c                   z-add     ormpor        d55lin
069340060522     c                   z-add     blpdsp        d55drf
069350060522     c                   call      'FNLV55R'
069360060522     c                   parm                    dslv55
069370060522     c                   if        d55err <> *blanks or d55tfa <> wolnp
069380051207     c* Verifico se si tratta di dati edi trasferiti: in questo caso
069390051206     c*  non do errore
069400051206     c                   clear                   tntb50ds
069410051206     C                   move      VIDCCM        b50ke2
069420051206     C*
069430051206    3C     VIDFLC        IFEQ      0
069440051206     C                   MOVEL     VIDLNP        b50ke2
069450051206     C                   ELSE
069460051206     C                   MOVEL     VIDFLC        b50ke2
069470051206    3C                   ENDIF
069480051206     c
069490051206     c                   movel     b50ke2        b50ke1
069500051207     c* controllo linea e p.o. orm
069510051207     c                   movel     'O'           b50opz
069520051207     c                   movel     ormpor        b50ormreso
069530051206     c                   movel     wolnp         b50poa
069540051206     c                   call      'TNTB51R'
069550051206     c                   parm                    kpjba
069560051206     c                   parm                    tntb50ds
069570051206     c
069580051206     c                   if        b50err<>' '
069590081215     c* po ritiro orm diverso da lnp vanno bene per dpd purchè entrambi
069600081215     c* i network siano dpd
069610081215     c                   clear                   ntwpor
069620081215     c                   if        §ogntw='DPD'
069630081215     C     ORMPOr        CHAIN     AZORG01L      UNIORG
069640081215     C                   MOVEL     OG143         SAV143
069650081215     C                   MOVEL     ORGDE3        OG143
069660081215     c                   movel     §ogntw        ntwpor
069670081215     C                   MOVEL     SAV143        OG143
069680081215     c                   endif
069690081215     c                   if        §ogntw<>'DPD' or ntwpor<>'DPD'
069700010212     C                   MOVEL     ERR(218)      VIDMSG
069710081215     c                   endif
069720010409    3C                   ENDIF
069730060522     c                   else
069740060522     c*se p.o. ritiro gestito da lnp bolla memorizzo
069750060522     c                   z-add     d55tfa        w_pogest
069760060522    3C                   ENDIF
069770051206    3C                   ENDIF
069780070529     c* verifico se p.o. ritiro abilitato allo scarico dei PDA
069790070606     c* cerco la capofila del p.o. ritiro
069800070606     c                   clear                   dslv55
069810070606     c                   z-add     ormpor        d55lin
069820070606     c                   movel     '6'           d55tpt
069830070606     c                   z-add     ormddc        d55drf
069840070606     c                   call      'FNLV55R'
069850070606     c                   parm                    dslv55
069860070606     c     d55tfa        chain     azorg01l      uniorg
069870070529     c                   if        %found(azorg01l)
069880070529     C                   MOVEL     ORGDE8        OG148
069890070529     c                   else
069900070529     c                   clear                   og148
069910070529     c                   endif
069920070529     c                   movel     §ogpdaorm     s_§ogpdaorm
069930070606     c* memorizzo il p.o. gestore del p.o. ritiro per eventuali ricerche su
069940070606     c* tab "PDO"
069950080111     c****               z-add     d55tfa        g_ormpor
069960010409    2C                   ENDIF
069970051206     c
069980051207    2C**   ORMATB        IFNE      *BLANKS
069990051207     C**   ORMPOR        ORNE      WOLNP
070000051207     c* Visto che in un caso p.o. ritiro <> da linea bolla va bene, tes
070010051207     c*  to il campo messaggio
070020051207     c                   if        vidmsg<>*blanks
070030010212     C                   SETON                                        90
070040010215    3C     WPERSO        IFEQ      'P'
070050040901     C                   Z-ADD     05            H0RIGA
070060040909     C                   Z-ADD     20            H0COLO
070070010213     C                   ELSE
070080040901     C                   Z-ADD     06            H1RIGA
070090040909     C                   Z-ADD     20            H1COLO
070100010215    3C                   ENDIF
070110010212     C                   GOTO      ENDORM
070120010215    2C                   ENDIF
070130010216     C* CMD14 - VISUALIZZA ORM
070140010223     C     *INKH         IFEQ      *ON
070150010216     C                   CLEAR                   FIOR07
070160010216     C                   Z-ADD     WOPOE         D07POE
070170010222     C                   Z-ADD     WONSR         D07NSR
070180010222     C                   Z-ADD     WONOR2        D07NOR
070190010216     C                   Z-ADD     WONRV         D07NRV
070200020513     c     simtpp        ifeq      '2'
070210020513     c     simtpp        oreq      *blanks
070220020513     c                   move      simpou        d07fgs
070230010216     C                   ELSE
070240010216     C                   Z-ADD     SIMFEL        D07FGS
070250010216     C                   ENDIF
070260010216     C                   MOVEL     FIOR07        KPJBU
070270010216     C                   CALL      'FIOR07R'
070280010216     C                   PARM                    KPJBA
070290010227     C                   MOVEL     '1'           WEMFOR
070300010216     C                   GOTO      ENDORM
070310010216     C                   ENDIF
070320010214     C* SE NON SONO NEL GIRO DEI PREPAGATI ORMTOR DEVE ESSERE DIVERSO
070330010214     C* DA "P"
070340010215    2C     *IN22         IFEQ      *OFF
070350010214     C     ORMTOR        ANDEQ     'P'
070360010214     C                   MOVEL     ERR(222)      VIDMSG
070370010214     C                   SETON                                        90
070380010215    3C     WPERSO        IFEQ      'P'
070390040901     C                   Z-ADD     05            H0RIGA
070400040909     C                   Z-ADD     20            H0COLO
070410010214     C                   ELSE
070420040901     C                   Z-ADD     06            H1RIGA
070430040909     C                   Z-ADD     20            H1COLO
070440010215    3C                   ENDIF
070450010503     C                   GOTO      ENDORM
070460010215    2C                   ENDIF
070470010214     C* VICEVERSA DEVE ESSERE = "P"
070480010215    2C     *IN22         IFEQ      *ON
070490010214     C     ORMTOR        ANDNE     'P'
070500010214     C                   MOVEL     ERR(223)      VIDMSG
070510010214     C                   SETON                                        90
070520010215    3C     WPERSO        IFEQ      'P'
070530040901     C                   Z-ADD     05            H0RIGA
070540040909     C                   Z-ADD     20            H0COLO
070550010214     C                   ELSE
070560040901     C                   Z-ADD     06            H1RIGA
070570040909     C                   Z-ADD     20            H1COLO
070580010215    3C                   ENDIF
070590010503     C                   GOTO      ENDORM
070600010215    2C                   ENDIF
070610100319     c
070620100319     c* Se presente LINEA DI ARRIVO personalizzata e  <> dall'ORM
070630100319     c*  oppure disk B --> erore bloccante
070640100319    2c                   if         not *in12 or not *in15
070650100319    3c                   if         ormpoc>0
070660100319     c
070670100319    4c                   if        (vidlna>*zeros  and *in20 )
070680100319     c                             or (*in12 and not *in15 and §1bfg6='C')
070690100319     c                   movel     vidlna        w0030
070700100319    5c                   if        w0030<>ormpoc
070710100319     C                   MOVEL     ERR(73)       VIDMSG
070720100319     C                   SETON                                        90
070730100319    6C     WPERSO        IFEQ      'P'
070740100319     C                   Z-ADD     05            H0RIGA
070750100319     C                   Z-ADD     20            H0COLO
070760100319     C                   ELSE
070770100319     C                   Z-ADD     06            H1RIGA
070780100319     C                   Z-ADD     20            H1COLO
070790100319    6C                   ENDIF
070800100319     C                   GOTO      ENDORM
070810100319    5C                   ENDIF
070820100319    4C                   ENDIF
070830100319    3C                   ENDIF
070840100319     c
070850100319     c* Se presente FNORE e TSP personalizzato <> dall'ORM
070860100319     c*  errore bloccante
070870100319    3c                   if        wesORE='S'
070880100319    4c                   if        (vidtsp<>' '    and *in18) or
070890100319     c                             (*in12 and not *in15 and §1bfg6='C')
070900100319
070910100319    5c                   if        vidtsp<>§oretsp
070920100319     C                   MOVEL     ERR(71)       VIDMSG
070930100319     C                   SETON                                        90
070940100319    6C     WPERSO        IFEQ      'P'
070950100319     C                   Z-ADD     05            H0RIGA
070960100319     C                   Z-ADD     20            H0COLO
070970100319     C                   ELSE
070980100319     C                   Z-ADD     06            H1RIGA
070990100319     C                   Z-ADD     20            H1COLO
071000100319    6C                   ENDIF
071010100319     C                   GOTO      ENDORM
071020100319    5C                   ENDIF
071030100319    4C                   ENDIF
071040100319    3C                   ENDIF
071050100319    2C                   ENDIF
071060100319     c
071070030805      * controllo la serie dell'ORM, se inserita deve esistere la key
071080030805      * poe + nrs in tab. 'OSR'
071090130116      * dal 16/01/2013 non è più così
071100130116      * la tabella OSR la leggo per cliente ORDINANTE dell'ORM
071110130116      * controllare solo la serie dell'ORM immessa è inutile
071120130116      * l'importante è che esista l'ORM
071130130117If  2c                   If        wonsr > *Zeros
071140130117      /free
071150130117       //?Non faccio controlli se OK orm RC, l'orm è stato controllato
071160130117       //?prima e se è un ORM con serie i controlli sono già stati fatti
071170130117       //?all'immissione dell'ORM
071180130117       //?qua devo solo recuperare i dati dalla tabella OSR
071190130117       //?la tabella la devo agganciare per cliente ordinante dell'ORM
071200130117       //?(solo i primi 7 caratteri del campo ORMCOR)
071210130117         clear dOSR;
071220130117         wORMcor = %dec(%subst(%editc(ORMcor:'X'):1:7):7:0);
071230130117         osrxx = %lookup(wORMcor:skCLIosr);
071240130117         IF  osrxx > 0;
071250130117         //?aggancio tabella OSR per recupero dati x ORM da tabella
071260130117           clear dsbs02;
071270130117           T02mod = 'C';
071280130117           T02cod = 'OSR';
071290130117           T02ke1 = skLNPNRSosr(osrxx);
071300130117           tibs02r(kpjba:dsbs02);
071310130117           IF  T02err = *blank;
071320130117             dOSR = T02uni;
071330130117           ENDIF;
071340130117         ENDIF;
071350130117      /end-free
071360130117
071370130116     c**!!!              Clear                   dOsr
071380130116     c**!!!              Clear                   dsbs02
071390130116     c**!!!              Clear                   wkosr
071400130116     c**!!!              Eval      T02Mod = 'C'
071410130116     c**!!!              Eval      T02Sif = Knsif
071420130116     c**!!!              Eval      T02Cod = 'OSR'
071430130116     c**!!!              Movel     wopoe         wkosr
071440130116     c**!!!              Move      wonsr         wkosr
071450130116     c**!!!              Movel(p)  wkosr         T02Ke1
071460130116     c**!!!              Call      'TIBS02R'
071470130116     c**!!!              Parm                    Kpjba
071480130116     c**!!!              Parm                    Dsbs02
071490130116If  3c**!!!              If        T02Err <> *Blanks
071500130116If  4C**!!!              If        wperso = 'P'
071510130116     c**!!!              Z-Add     05            H0riga
071520130116     c**!!!              Z-Add     20            H0colo
071530130116   x4c**!!!              Else
071540130116     c**!!!              Z-Add     06            H1riga
071550130116     c**!!!              Z-Add     20            H1colo
071560130116    4c**!!!              EndIf
071570130116     c**!!!              Eval      VidMsg = Err(48)
071580130116     c**!!!              Move      wonsr         w002a
071590130116     c**!!!              Eval      %subst(VidMsg:11:2) = w002a
071600130116     c**!!!              Eval      *In90 = *On
071610130116     c**!!!              GoTo      EndOrm
071620130116    3c**!!!              EndIf
071630130116     c**!!!              Movel     T02Uni        dOsr
071640030805      * se non inserito dall'utente imposto il codice bolla
071650030805If  3C                   If        wperso = 'P'
071660030805If  4c                   If        V0cCbo = *Blanks
071670030805     c                   Eval      V0cCbo = d§OsrCbo
071680030805    4c                   EndIf
071690030805   x3c                   Else
071700030805If  4c                   If        VidCbo = *Blanks
071710030805     c                   Eval      VidCbo = d§OsrCbo
071720030805    4c                   EndIf
071730030805    3c                   EndIf
071740030805    2c                   EndIf
071750010404     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
071760010404     C* ANDRO' A PROPORRE NELLE NOTE
071770050211     C***  ORMPOE        IFNE      ORMPOR
071780050211     C***  'TEL.:'       CAT       ORMTER        W021A            21
071790050211     C***  W021A         CAT(P)    ORMRER:1      WTELRF           70
071800050211     C***                MOVE      WTELRF        WTELR2           35
071810050211     C***                ENDIF
071820010212     C* L'ORM DEVE ESSERE IN UNA FASE BOLLETTABILE
071830010212     c* Errore forzabile
071840010220    2C     ORMFAO        IFNE      PREFAO
071850010220     C                   MOVE      ORMFAO        PREFAO
071860010220     C                   CLEAR                   DSBS02
071870010220     C                   MOVEL     'C'           T02MOD
071880010220     C                   MOVEL     KNSIF         T02SIF
071890010220     C                   MOVEL     'FAR'         T02COD
071900010220     C                   MOVEL     ORMFAO        T02KE1
071910010220      *
071920010220     C                   CALL      'TIBS02R'
071930010220     C                   PARM                    KPJBA
071940010220     C                   PARM                    DSBS02
071950010220    3C     T02ERR        IFEQ      *BLANKS
071960010220     C                   MOVEL     T02UNI        DFAR
071970010220     C                   ELSE
071980010220     C                   CLEAR                   DFAR
071990010220    3C                   ENDIF
072000010220    2C                   ENDIF
072010010620     C* Se fase 999: errore bloccante
072020010620     C     §FARFB        IFEQ      'N'
072030050504     c     §lpfpr        andne     'O'
072040010620     C                   MOVEL     ERR(219)      VIDMSG
072050010620     C                   MOVE      *BLANKS       BLANK            45
072060010620     C                   MOVE      BLANK         VIDMSG
072070010620     C                   SETON                                        90
072080010620    4C     WPERSO        IFEQ      'P'
072090040901     C                   Z-ADD     05            H0RIGA
072100040909     C                   Z-ADD     20            H0COLO
072110010620     C                   ELSE
072120040901     C                   Z-ADD     06            H1RIGA
072130040909     C                   Z-ADD     20            H1COLO
072140010620    4C                   ENDIF
072150010620     C                   GOTO      ENDORM
072160010620     C                   ENDIF
072170010220     C*
072180010215    2C     WIDORM        IFNE      W01ORM
072190010223     C                   CLEAR                   WOVUO
072200070427     C                   CLEAR                   WOVUO1
072210070918     C                   CLEAR                   savdrt
072220010226     C                   MOVEL     'S'           CHGORM            1
072230090327     C                   MOVEL     'S'           CHGORM1           1
072240091120     C                   MOVEL     'S'           CHGORM2           1
072250090327     c                   clear                   w_fcli            1
072260031001     c                   Clear                   wfortbo
072270010215     C* Se sono in manutenzione memorizzo che è cambiato il numero
072280010215     C* O.R.M. (Mi serve nelle routine che propongono i campi da orm
072290010215     C* che se in manutenzione devo proporre solo se modificato n. orm)
072300010215    3C     *IN12         IFEQ      *ON
072310010215     C     *IN15         ANDEQ     *OFF
072320010215     C                   MOVEL     '1'           WORMMD            1
072330010215    3C                   ENDIF
072340010214     C* Quando cambia il numero O.R.M. devo pulire i campi per la forza
072350010214     C* tura usati nella routine di controllo congruenza con campi dell
072360010214     c* O.R.M.
072370090326     C                   CLEAR                   PREDRT
072380010214     C                   CLEAR                   PREPDR
072390010214     C                   CLEAR                   PREFPP
072400010214     C                   CLEAR                   PRECCM
072410010214     C                   CLEAR                   PREFFD
072420010214     C                   CLEAR                   PRECTR
072430010504     C* Pulisco anche campo per forzatura su n. O.R.M.
072440010504     C                   CLEAR                   WFORZO
072450070905     c                   clear                   s_drt
072460070905     c                   if        wperso='P'
072470070905     c                   movel     nodi          at0daorm
072480070905     c                   else
072490070905     c                   movel     nodi          atrdaorm
072500070905     c                   endif
072510011122     C* A cambio numero O.R.M. devo anche reimpostare la lna + FLAG DPD
072520111124     c* e clearo i campi note da orm
072530011122    3C     *IN12         IFEQ      *OFF
072540011122     C     *IN15         OREQ      *OFF
072550111124     c                   clear                   vidno1
072560111124     c                   clear                   vidno2
072570111128     c                   clear                   viddno
072580011122     C                   CLEAR                   VIDDPD
072590070214     c* in manutenzione e lna dpd o fedex non la clearo altrimenti non
072600070214     c* è possibile reinstradarla a dpd/fedex
072610070214    4C     ORMPOC        IFEQ      *ZEROS
072620070214     c                   if        *in12='0' or (savntw<>'DPD' and savntw<>
072630070214     c                             'FED')
072640011122     C                   CLEAR                   VIDLNA
072650070214     c                   endif
072660011122     C* SE LNA PERSONALIZZATA DEVO IMPOSTARE QUESTA
072670011122    5C     *IN20         IFEQ      *ON
072680011122     C                   MOVE      V0CLNA        VIDLNA
072690011122    5C                   ENDIF
072700011122    4C                   ENDIF
072710011122     C* Sempre a cmabio di O.R.M. devo anche pulire i campi del desti-
072720011205     C* natario solo se il precedente orm prevedeva la forzatura del
072730011205     C* destinatario
072740011205     C     SORMFD        IFEQ      'S'
072750011122     C                   CLEAR                   VIDRSD
072760011122     C                   CLEAR                   VIDIND
072770011122     C                   CLEAR                   VIDCAD
072780011122     C                   CLEAR                   VIDLOD
072790011122     C                   CLEAR                   VIDPRD
072800011122     C                   CLEAR                   VIDNZD
072810011205     C                   CLEAR                   SORMFD
072820011205     C                   ENDIF
072830011122    3C                   ENDIF
072840010214     C*
072850011122     C                   MOVE      WIDORM        W01ORM
072860010215    3C     §FARFB        IFNE      'S'
072870050504     c     §lpfpr        andne     'O'
072880010212     C                   MOVEL     ERR(219)      VIDMSG
072890010212     C                   SETON                                        90
072900010215    4C     WPERSO        IFEQ      'P'
072910040901     C                   Z-ADD     05            H0RIGA
072920040909     C                   Z-ADD     20            H0COLO
072930010213     C                   ELSE
072940040901     C                   Z-ADD     06            H1RIGA
072950040909     C                   Z-ADD     20            H1COLO
072960010215    4C                   ENDIF
072970010212     C                   GOTO      ENDORM
072980010215    3C                   ENDIF
072990010212     C*
073000010215    2C                   ENDIF
073010010504     C* IN IMMISSIONE NON E' POSSIILE UTILIZZARE UN O.R.M. LE CUI BOLLE
073020010504     C* VENGONO TRASMESSE CON DISK
073030010504     C* ERRORE FORZABILE CON F20
073040010504    2C     *IN12         IFEQ      *OFF
073050010504     C* MEMORIZZO SE PREMUTO COMANDO PER FORZATURA
073060010504     C     *INKU         IFEQ      *ON
073070010504     C                   MOVEL     '1'           WFORZO            1
073080010504     C                   ENDIF
073090010924    3C     §ORMCB        IFEQ      'S'
073100010504     C     WFORZO        ANDEQ     *BLANKS
073110010504     C                   SETON                                        90
073120010504     C                   MOVEL     ERR(230)      VIDMSG
073130010504    4C     WPERSO        IFEQ      'P'
073140040901     C                   Z-ADD     05            H0RIGA
073150040909     C                   Z-ADD     20            H0COLO
073160010504     C                   ELSE
073170040901     C                   Z-ADD     06            H1RIGA
073180040909     C                   Z-ADD     20            H1COLO
073190010504    4C                   ENDIF
073200010504     C                   GOTO      ENDORM
073210010504    3C                   ENDIF
073220010504    2C                   ENDIF
073230011122     C* Proteggo i campi a video relativi il destinatario se devo forza
073240011122     C* re il destinatario da orm
073250011122     C     §ORMFD        IFEQ      'S'
073260011122     C                   MOVEL     PROT          ATRDES
073270011122     C                   ELSE
073280011122     C                   CLEAR                   ATRDES
073290011122     C                   ENDIF
073300090429
073310090429     c                   clear                   poentw
073320090429     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
073330090429     C                   MOVEL     OG143         SAV143
073340090429     C  N30              MOVEL     ORGDE3        OG143
073350090429     C   30              CLEAR                   OG143
073360090429     c                   eval      poentw=§ogntw
073370090429     C                   MOVEL     SAV143        OG143
073380090429
073390010227     C* SE ORM FITTIZIO E PREMUTO F8 DEVO RIEMETTERE LA VIDEATA
073400010227   X1C                   ELSE
073410040319      * imposto flag se sono in manutenzione ed ho modificato il n. ORM
073420040319if  2c                   If        *In12 and Not *In15 and
073430040319     c                             widorm <> w01orm
073440040319     C                   Eval      wmodorm = *On
073450040319e   2c                   EndIf
073460070829     c* a cambio numero orm devo mettere in ND la scritta
073470070829     c* eventuale "DA O.R.M."
073480070829     c                   if        widorm <> w01orm
073490090327     C                   MOVE      WIDORM        W01ORM
073500090327     C                   MOVEL     'S'           CHGORM1           1
073510091120     C                   MOVEL     'S'           CHGORM2           1
073520090327     c                   clear                   w_fcli
073530070918     c                   clear                   savdrt
073540070829     c                   if        wperso='P'
073550070829     c                   eval      at0daorm=nodi
073560070829     c                   else
073570070829     c                   eval      atrdaorm=nodi
073580070829     c                   endif
073590111124     c                   clear                   vidno1
073600111124     c                   clear                   vidno2
073610111128     c                   clear                   viddno
073620070829     c* solo in immissione: reimposto la data ritiro a udate se l'utente non
073630070829     c* l'ha variata
073640070829     c                   if        *in12='0' and viddrt<>wdtgio and viddrt>0
073650071107     c****                         and viddrt=s_drt  and dateu>=§vpodrt
073660071107     c                             and viddrt=s_drt
073670070831     c                   if        wperso='P'
073680070831     c                   clear                   viddrt
073690070831     c                   eval      s_drt=viddrt
073700070831     c                   else
073710070829     c                   eval      viddrt=wdtgio
073720070829     c                   eval      s_drt=wdtgio
073730070831     c                   endif
073740070829     c                   movel     '1'           wemfor
073750070829     c                   goto      endorm
073760070829     c                   endif
073770070904     c* Per ora non faccio il seguente controllo: se passo da un reale a un
073780070904     c* fittizio l'utente deve stare attento alla data ritiro.
073790070829     c* in manutenzione: se orm sulla bolla 999999 e data ritiro video<>da
073800070829     c* data ritiro bolla rimetto data ritiro bolla
073810070904     c*                  if        *in12 and *in15='0' and viddrt<>s_drtblp
073820070904     c*                  eval      viddrt=s_drtblp
073830070904     c*                  movel     '1'           wemfor
073840070904     c*                  goto      endorm
073850070904     c*                  endif
073860070829     c                   endif
073870040319
073880010227     C   KH              MOVEL     '1'           WEMFOR
073890010227     C   KH              GOTO      ENDORM
073900010215    1C                   ENDIF
073910010222     C* PERSONALIZZAZIONE
073920010222     C     WPERSO        IFEQ      'P'
073930010222     C                   SETON                                        37
073940010222     C                   ENDIF
073950011122     C  N90              CLEAR                   WCKORM
073960011205     C* Mi salvo il contenuto §ormfd per sapere se a cambio di O.R.M.
073970011205     C* devo pulire i dati del destinatario
073980090429     c                   clear                   sormfd
073990090429     c                   if        flgfit<>'S'
074000011205     C                   MOVE      §ORMFD        SORMFD
074010090429     c                   endif
074020010222   X0C                   ELSE
074030010226     C* SE PERSONALIZZATO GESTISCO EVENTUALE CMD08
074040010227     C* CMD8 - VISUALIZZA ORM
074050010223     C     *INKH         IFEQ      *ON
074060010227     C     FLGFIT        IFNE      'S'
074070010222     C                   CLEAR                   FIOR07
074080010222     C                   Z-ADD     WOPOE         D07POE
074090010222     C                   Z-ADD     WONSR         D07NSR
074100010222     C                   Z-ADD     WONOR2        D07NOR
074110010222     C                   Z-ADD     WONRV         D07NRV
074120070627     c     simtpp        ifeq      '2'
074130020513     c     simtpp        oreq      *blanks
074140020513     c                   move      simpou        d07fgs
074150010222     C                   ELSE
074160010222     C                   Z-ADD     SIMFEL        D07FGS
074170010222     C                   ENDIF
074180010222     C                   MOVEL     FIOR07        KPJBU
074190010222     C                   CALL      'FIOR07R'
074200010222     C                   PARM                    KPJBA
074210010226     C                   ENDIF
074220010227     C                   MOVEL     '1'           WEMFOR
074230010222     C                   GOTO      ENDORM
074240010222     C                   ENDIF
074250010222    0C                   ENDIF
074260090327     c* Se era stato impostato cliente/tariffa per tassazione porti assegnati
074270090327     c* verifico se emettere messaggio per avvisare che cambiando l'orm
074280090327     c* i dati verranno automaticamente modificati
074290091120    1c                   if        chgorm1='S' and *in04
074300090327    2c***                if        flgfit<>'S' and ormksc>0
074310090327    2c****                         and wcliksc>0 and atrwksc=*blanks
074320090327    3c***                if        w_fcli=' '
074330090327     c***                movel     '1'           w_fcli
074340090327     C***                MOVEL     ERR(321)      VIDMSG
074350090327     C***                SETON                                        90
074360090327     C***                GOTO      ENDORM
074370090327    3c***                endif
074380090327    2c****               endif
074390090327    2c                   if        (flgfit<>'S' and ormksc>0)
074400090327     c                             or atrwksc<>*blanks
074410090327     c                   exsr      sr_inzwdwcli
074420090327    2c                   endif
074430090327     c                   clear                   chgorm1
074440090327    1c                   endif
074450091120     c* a cambio di orm inzializzo window per scelta beneficiario c/a
074460091120    1c                   if        chgorm2='S'
074470091120     c                   exsr      inzwdwcas
074480091123     c                   clear                   chgorm2
074490091120     c                   endif
074500010212     C     ENDORM        ENDSR
074510010215     C*
074520010214     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA I° VIDEATA) -----------*
074530010215     C     PRPOR1        BEGSR
074540010212     C                   CLEAR                   WEFORM
074550070806     C*
074560070905     C* DATA RITIRO (SOLO SE ORM E' IN UNA FASE valida ai fini della da
074570070905     c* ta ritiro)
074580070905    2C     §LPFPR        ifne      'O'
074590070905     c                   exsr      fordrt
074600070905    2C                   ENDIF
074610111124     c* NOTE in visualizzazione
074620111124     c                   if        (ormno1<> *blanks or ormno2<>*blanks)
074630111124     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
074631170904     c                             and §lpfpr<>'N'
074640120127     c                   movel     ormno1        vidno1
074650120127     c                   movel     ormno2        vidno2
074660120127     c                   movel     'NoteOrm'     viddno
074670120127     C                   MOVEL     '1'           WEFORM
074680111124     c                   endif
074690070806     c*
074700010215    1C     *IN12         IFEQ      *OFF
074710010220     C* In manutenzione propongo solo se variato il numero ORM
074720010215     C     *IN15         OREQ      *OFF
074730010220     C     WORMMD        ANDEQ     '1'
074740010215     C     *IN15         OREQ      *ON
074750010212     C*
074760040901     c*
074770050426     c*****              exsr      PRPOR1bis
074780010215     C*
074790010212     C* ATTENZIONE! SE SONO IN CONFERMA BOLLE DA DISCHETTO I SEGUENTI
074800010212     C* DATI NON LI DEVO PRENDERE DALL'ORM:
074810011121     C* (FANNO ECCEZIONE LE PROPOSTE DEL DESTINATARIO SE §ORMFD='S')
074820010212     C*
074830010212     C* CLIENTE MITTENTE
074840010215    2C     *IN12         IFEQ      *OFF
074850010212     C     *IN15         OREQ      *OFF
074860010215    3C     VIDCCM        IFEQ      *ZEROS
074870031201     c                   Eval      wnoccm = '1'
074880010215    4C     ORMKSC        IFGT      *ZEROS
074890010213     C                   MOVEL     '1'           WEFORM
074900030905      * Propongo il ksc dell'orm se l'ORM preve la bolla in porto franco
074910091020    5c     §OrPfb        Ifne      'A'
074920010212     C                   MOVE      ORMKSC        VIDCCM
074930010212     C                   MOVEL     ORMKSC        W0030             3 0
074940130212     C                   Z-ADD     W0030         VIDFLC
074950010215    6C     W0030         IFNE      VIDLNP
074960130212     C****               Z-ADD     W0030         VIDFLC
074970010302     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
074980010302     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
074990041129     C                   SETON                                        14
075000010215    6C                   ENDIF
075010010215   X5C                   ELSE
075020030905      * Propongo 9999 se l'orm prevede la bolla in porto assegnato
075030010212     C                   Z-ADD     9999          VIDCCM
075040010215    5C                   ENDIF
075050010214     C                   MOVE      VIDCCM        PRECCM
075060010214     C                   MOVEL     VIDFLC        PRECCM
075070010215    5C     VIDFLC        IFEQ      0
075080010214     C                   MOVEL     VIDLNP        PRECCM
075090010215    5C                   ENDIF
075100010215   X4C                   ELSE
075110030905      * se Ksc vuoto e l'orm prevede la bolla in porto franco propongo la
075120010214     C* RAGIONE SOCIALE NEL CAMPO DELLA RICERCA ALFABETICA
075130030905    5c     §OrPfb        Ifne      'A'
075140010215    6C     VIDDMT        IFEQ      *BLANKS
075150010215     C                   MOVEL     ORMRSR        VIDDMT
075160041129     C                   MOVEL     '1'           WEFORM
075170041129     C     VIDDMT        IFNE      *BLANKS
075180041129     C***                SETON                                        0138
075190041129     C                   SETON                                        01
075200041129     C                   ENDIF
075210010215    6C                   ENDIF
075220010328   X5C                   ELSE
075230030905      * se ksc vuoto e l'orm prevede la bolla in porto assegnato
075240030905      * PROPONGO 9999 IN CCM
075250010328     C                   Z-ADD     9999          VIDCCM
075260010328     C                   MOVEL     '1'           WEFORM
075270010215    5C                   ENDIF
075280010215    4C                   ENDIF
075290010215    3C                   ENDIF
075300011121    2C                   ENDIF
075310010212     C* DESTINATARIO (RAG SOC,INDIR....)
075320011121    2C     *IN12         IFEQ      *OFF
075330011121     C     *IN15         OREQ      *OFF
075340011121     C     *IN15         OREQ      *ON
075350011121     C     §ORMFD        ANDEQ     'S'
075360011121     C*
075370010215    3C     ORMTOR        IFEQ      'S'
075380010301     C     §LPFPR        OREQ      'O'
075390010215    4C     VIDRSD        IFEQ      *BLANKS
075400011122     C     ORMRSC        ANDNE     *BLANKS
075410011121     C     §ORMFD        OREQ      'S'
075420011122     C     ORMRSC        ANDNE     VIDRSD
075430010214     C                   MOVEL     '1'           WEFORM
075440010212     C                   MOVEL     ORMRSC        VIDRSD
075450010215    4C                   ENDIF
075460010215    4C     VIDIND        IFEQ      *BLANKS
075470011122     C     ORMINC        ANDNE     *BLANKS
075480011121     C     §ORMFD        OREQ      'S'
075490011122     C     ORMINC        ANDNE     VIDIND
075500010213     C                   MOVEL     '1'           WEFORM
075510010212     C                   MOVEL     ORMINC        VIDIND
075520010215    4C                   ENDIF
075530010215    4C     VIDCAD        IFEQ      *BLANKS
075540011122     C     ORMCAC        ANDNE     *BLANKS
075550011121     C     §ORMFD        OREQ      'S'
075560011122     C     ORMCAC        ANDNE     VIDCAD
075570010213     C                   MOVEL     '1'           WEFORM
075580010212     C                   MOVEL     ORMCAC        VIDCAD
075590010215    4C                   ENDIF
075600160112     c* eseguo routine per eliminare caratteri non ammessi nella
075610160112     c* località destinatario da ORM
075620140211     c                   clear                   ormloc_n
075630140211     c                   if        ormloc<>*blanks
075640160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
075650140211     c                   eval      wtxt=ormloc
075660160112     c                   eval      ElencoChar=charnook
075670160112     c                   eval      TipoElenco='1'
075680160112     c                   clear                   UpperCase
075690160112     c                   exsr      sr_chk
075700160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
075710160112     c* alla  fine
075720140211     c                   exsr      chkstringa
075730140211     c                   movel     wtxt          ormloc_n
075740140211     c                   endif
075750010215    4C     VIDLOD        IFEQ      *BLANKS
075760140211     C     ORMLOC_n      ANDNE     *BLANKS
075770011121     C     §ORMFD        OREQ      'S'
075780140211     C     ORMLOC_n      ANDNE     VIDLOD
075790010213     C                   MOVEL     '1'           WEFORM
075800140211     C                   MOVEL     ORMLOC_n      VIDLOD
075810010215    4C                   ENDIF
075820010216    4C     VIDPRD        IFEQ      *BLANKS
075830010216     C     ORMPRC        ANDNE     *BLANKS
075840010216     C     VIDCAD        ANDEQ     ORMCAC
075850010216     C     VIDCAD        ANDNE     *BLANKS
075860011121     C     §ORMFD        OREQ      'S'
075870011122     C     ORMPRC        ANDNE     VIDPRD
075880010216     C                   MOVEL     '1'           WEFORM
075890010216     C                   MOVEL     ORMPRC        VIDPRD
075900010216    4C                   ENDIF
075910010216    4C     VIDNZD        IFEQ      *BLANKS
075920010216     C     ORMNAC        ANDNE     *BLANKS
075930010216     C     VIDCAD        ANDEQ     ORMCAC
075940010216     C     VIDCAD        ANDNE     *BLANKS
075950011121     C     §ORMFD        OREQ      'S'
075960011122     C     ORMNAC        ANDNE     VIDNZD
075970010216     C                   MOVEL     '1'           WEFORM
075980010216     C                   MOVEL     ORMNAC        VIDNZD
075990010216    4C                   ENDIF
076000010215    3C                   ENDIF
076010011121    2C                   ENDIF
076020011121     C*
076030011121    2C     *IN12         IFEQ      *OFF
076040011121     C     *IN15         OREQ      *OFF
076050010212     C* LINEA DI ARRIVO
076060010214     C* La linea di arrivo se presente sull'orm deve sempre essere
076070010214     C* uguale a video quindi, se diversa, la forzo
076080010228     C* Il messaggio di errore lo emetto solo se lna a video > 0 e <> DA ORM
076090010215    3C     ORMPOC        IFGT      *ZEROS
076100010215    4C     VIDLNA        IFGT      *ZEROS
076110010215     C                   MOVE      VIDLNA        W0030
076120010215    5C     W0030         IFNE      ORMPOC
076130010213     C                   MOVEL     RIMM          ATRLNA
076140010213     C                   MOVEL     ERR(220)      VIDMSG
076150010216     C                   MOVEL     '1'           WEFORM
076160010216     C                   MOVE      ORMPOC        VIDLNA
076170010216     C                   SETON                                        9047
076180010215    5C                   ENDIF
076190010216   X4C                   ELSE
076200010216     C                   MOVEL     '1'           WEFORM
076210010216     C                   MOVE      ORMPOC        VIDLNA
076220010216    4C                   ENDIF
076230020204     C* SE LNA DPD DEVO IMPOSTARE 'D' NEL network
076240020207     C* SE LNA FEDEX DEVO IMPOSTARE 'F' NEL network
076250010214     C* SE SONO IM MANUTENZIONE NON LO DEVO FARE PERCHE' IN QUESTO
076260010214     C* CASO NON C'E' IL CAMPO VIDDPD
076270010215    4C     *IN12         IFEQ      *OFF
076280010215     C     ORMPOC        CHAIN     AZORG01L      UNIORG               30
076290010214     C                   MOVEL     OG143         SAV143
076300010214     C                   MOVEL     ORGDE3        OG143
076310020319    5C     §OGNTW        IFEQ      'DPD'
076320020204     C                   MOVEL     'D'           VIDDPD
076330020204     c                   else
076340020204     c     §ogntw        ifeq      'FED'
076350020204     c                   movel     'F'           viddpd
076360020204     c                   endif
076370010215    5C                   ENDIF
076380010214     C                   MOVEL     SAV143        OG143
076390010215    4C                   ENDIF
076400010215    3C                   ENDIF
076410010314     C* FERMO DEPOSITO  - RIEMETTO LA VIDEATA SOLO SE SU ORM E' = 'S'
076420010215    3C     VIDFFD        IFEQ      *BLANKS
076430010215    4C     ORMFFD        IFEQ      'S'
076440010213     C                   MOVE      'S'           VIDFFD
076450010314     C                   MOVEL     '1'           WEFORM
076460010213     C                   ELSE
076470010213     C                   MOVE      'N'           VIDFFD
076480010215    4C                   ENDIF
076490010214     C                   MOVE      VIDFFD        PREFFD
076500010215    3C                   ENDIF
076510100319     c*
076520100319     c* TIPO SERVIZIO da FNORE
076530100319     c*  come per la linea di arrivo, se diversa la cambio emettendo MSG
076540100319   3ac                   if        Wesore<>'N'
076550100319     c                   clear                   WesORE
076560100319     c                   clear                   DoreGEN
076570100319     c     korme         chain     fnore01l
076580100319    3c                   if        %found(fnore01l)
076590100319     c                   movel     oredati       doreGEN
076600100319     c                   eval      wesore='S'
076610100319     C                   Z-ADD     1             C
076620100319     C     §oretsp       LOOKUP    TSP(C)                                 30
076630100319    4c                   if        *in30 and uts(c)='S'
076640100319    5c                   if        vidtsp<>*blanks and
076650100319     c                             vidtsp<>§oretsp
076660100319     C                   MOVEL     RIMM          ATRtsp
076670100319     c* Se già impostato per la linea di arrivo --> uni msg
076680100319    6c                   if        vidmsg=err(220)
076690100319     C                   MOVEL     ERR(74)       VIDMSG
076700100319     c                   else
076710100319     C                   MOVEL     ERR(75)       VIDMSG
076720100319    6c                   endif
076730100319     c
076740100319     C                   MOVEL     '1'           WEFORM
076750100319     C                   SETON                                        9048
076760100319    5C                   ENDIF
076770100319     c
076780100319     c* Riemetto video anche se TSP vuoto
076790100319     c                   if        vidtsp=' '
076800100319     C                   MOVEL     '1'           WEFORM
076810100319     c                   endif
076820100319     C                   MOVE      §oretsp       VIDtsp
076830100319    4c                   endif
076840100319    3c                   endif
076850100319   3ac                   endif
076860100319     c
076870010215    2C                   ENDIF
076880010301     C* SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI DEVO PROPORRE
076890010301     C* ANCHE COLLI E PESO
076900010301     C     §LPFPR        IFEQ      'O'
076910010301     C     V1CNCL        IFEQ      *ZEROS
076920010301     C                   Z-ADD     ORMNCL        V1CNCL
076930010301     C                   MOVEL     '1'           WEFORM
076940010305     C                   Z-ADD     ORMNCL        PRENCL
076950010301     C                   ENDIF
076960010301     C     VIDPKG        IFEQ      *ZEROS
076970010301     C                   Z-ADD     ORMPKG        VIDPKG
076980010305     C                   Z-ADD     ORMPKG        PREPKG
076990010301     C                   MOVEL     '1'           WEFORM
077000010301     C                   ENDIF
077010010301     C                   ENDIF
077020061124     c*
077030061124     c                   if        wforpf='1'
077040061124     c                   eval      §orpfb='A'
077050061124     c                   clear                   wforpf
077060061124     c                   endif
077070031201
077080031201      * se non sono in conferma bolle da clienti
077090060428if  1c                   If        (Not *In12 or Not *In15) and
077100031201      * e l'ORM prevede:
077110031201      *               --> la bolla in porto Assegnato
077120031201      *               --> paga ordinante orm
077130031201      *               --> destinatario orm estero
077140031201      *               --> ordinante orm italia
077150060428      * n.b.:per sapere se destinatario estero nei casi in cui sull'orm
077160060428      *      non è indicato ma è indicato a video devo testare il contenuto
077170060428      *      di vidnzd (wdesie infatti è disponibile solo dopo che il pgm
077180060428      *      ha fatto i controlli del destinatario che vengono fatti dopo
077190060428      *      questo controllo). Anche se non è corretto testare vidnzd
077200060428      *      per sapere se nazione estera (è il flag §15ita che me lo dice)
077210060428      *      era l'unico modo per gestire la videata in maniera chiara
077220060428      *      per il bollettista effettuando la forzatura nel momento
077230060428      *      giusto anzichè dare altre segnalazioni di errore che con-
077240060428      *      fonderebbero sicuramente.
077250031201     c                             (§OrPfb = 'A' and OrmPag = 'O' and
077260060914     c                             (OrmNac<>*Blanks or vidnzd<>*blanks))
077270060914     c*
077280060914    2c                   if        ormnao <> *blanks
077290060914     c                   movel     ormcor        po_cor            3 0
077300060914     c                   clear                   w_ordntw          1
077310060914     c     po_cor        chain     azorg01l      uniorg
077320060914    3c                   if        %found(azorg01l)
077330060914     C                   MOVEL     OG143         SAV143
077340060914     c                   movel     orgde3        og143
077350060914    4c                   if        §ogntw = 'EEX' or §ogntw='DPD'
077360060914     c                             or  §ogntw='FED'
077370060914     c                   movel     'E'           w_ordntw
077380060914    4c                   endif
077390060914     C                   MOVEL     SAV143        OG143
077400060914    3c                   endif
077410060914    2c                   endif
077420060914    2c                   if        ormnao = *blanks or w_ordntw<>'E'
077430050622      **non era impostato vidccm
077440050622     c***                          wnoccm = '1'
077450060427     c                   exsr      sr_FOrmEst
077460060914    2c                   endif
077470031201    1c                   EndIf
077480031201
077490010301     C*
077500010213     C   90              MOVEL     '1'           WEMFOR
077510010215    2C  N90WEFORM        IFEQ      '1'
077520010213     C* SE SONO IN CONFERMA RICHIAMATA CON X O W NON DEVO RIEMETTERE
077530010213     C* LA VIDEATA PER VISUALIZZARE CAMPI DA ORM QUINDI PULISCO FLAG
077540010215    3C     §LPFPR        IFEQ      'V'
077550010213     C     *IN12         OREQ      *OFF
077560010213     C     *IN15         OREQ      *OFF
077561170904     c     §lpfpr        andne     'N'
077570010213     C                   ELSE
077580010213     C                   CLEAR                   WEFORM
077590010215    3C                   ENDIF
077600010215    2C                   ENDIF
077610010215    1C                   ENDIF
077620040901     C                   ENDSR
077630070806     c***
077640070806     c* Forzatura data ritiro da orm ---------------------------------*
077650070806     c***
077660070806     c     fordrt        begsr
077670070905     c*
077671171009     c* la data ritiro da orm non è da
077680070806     C                   CLEAR                   WLBDAT
077690070806     C                   MOVEL     '3'           G02ERR
077700070806     c* se fase utilizzabile propongo la data della fase
077710070806    3C     d§fardar      ifeq      'S'
077720071112     c                   if        ormfao=400
077730071112     c                   z-add     ormddc        g02inv
077740071112     c                   else
077750070806     C                   Z-ADD     ORMDFO        G02INV
077760071112     c                   endif
077770070806   x3c                   else
077780070806     c* se l'orm non è in una fase utilizzabile per la data ritiro prendo
077790070806     c* la data ritiro presente sull'orm
077800070806     C                   Z-ADD     ORMDAR        G02INV
077810070806    3c                   endif
077820070806     c* se la data ritiro da proporre è maggiore della data odierna non
077830070905     c* propongo nulla. Non propongo la data anche se bolla import
077840070905    3c                   if        g02inv<=dateu and
077850081008     c                              §ogntw<>'EEX' and §ogntw<>'FED'
077860081008     c                              and §ogntw<>'DPD'
077870071107    4c***                if        viddrt= *zeros  or
077880071107     c****                          dateu>=§vpodrt
077890081008     c*                            (§ogntw<>'EEX' and §ogntw<>'FED'
077900081008     c*                             and §ogntw<>'DPD' and
077910070905     c*                             dateu>=§vpodrt)
077920070806     C                   CALL      'XSRDA8'
077930070806     C                   PARM                    WLBDAT
077940070905    5c                   if        g02dat<>viddrt
077950070806     c* se modificata data avviso con dicitura "DA ORM" blinking
077960070806    6c                   if        viddrt>0
077970070806     c                   if        wperso='P'
077980070806     c                   movel     blnk          at0daorm
077990070806     c                   else
078000070806     c                   movel     blnk          atrdaorm
078010070806     c                   endif
078020070806    6c                   endif
078030070905     C                   MOVEL     '1'           WEFORM            1
078040070806     C                   Z-ADD     G02DAT        VIDDRT
078050070806     C                   Z-ADD     VIDDRT        PREDRT
078060070806    5c                   endif
078070070918     C                   Z-ADD     G02DAT        s_drt
078080071107    4C****               ENDIF
078090070905   x3c                   else
078100070905     c* se non propongo la data perchè > data giorno o bolla import
078110070905     c* propongo udate
078120070918     c                   if        *in12='0'
078130070918     c                   if        viddrt=*zeros or
078140071107     c                             s_drt=0
078150071107     c****                         (dateu>=§vpodrt and s_drt=0)
078160070918     c****               if        s_drt=0 or (Dateu<§vpodrt and viddrt=0)
078170070918     c                   if        viddrt<>wdtgio
078180070918     C                   MOVEL     '1'           WEFORM            1
078190070918     c                   endif
078200070905     c                   z-add     wdtgio        viddrt
078210070905     c                   z-add     wdtgio        s_drt
078220070905     C                   Z-ADD     VIDDRT        PREDRT
078230070905     c                   endif
078240070918     c                   endif
078250070806    3C                   ENDIF
078260070806    cc                   endsr
078270040901     C*
078280040901     C* Proposta dati da orm - bis - Campi della prima videata ------*
078290060522     c* ATTENZIONE! Questa routine è al momento inutilizzata. Se diveni
078300060522     c* sse necessario riattivarla occorre rivederla in quanto non
078310060522     c* è sufficiete cercare la distinta con ormpor in quanto ormpor
078320060522     c* potrebbe essere un p.o. gestito ed in questo caso bisogna
078330060522     c* cercare la distinta della lnp bolla
078340120611     C**** PRPOR1bis     BEGSR
078350040901     C*
078360040901     C* PADRONCINO - LO DETERMINO DALLA DISTINTA
078370040901     C* IDEM FLAG MATTINO/POMERIGGIO
078380040901     C* Propongo il flag mattino/pomeriggio solo se non immesso e se il
078390040901     c* padroncino a video è uguale a quello della distinta
078400040901     C* Non propongo mai se richiamata da conferma prepagati
078410120611     C**** §LPFPR        IFNE      'O'
078420120611    2C**** ORMNDC        IFGT      *ZEROS
078430120611     C**** VIDPDR        ANDEQ     *ZEROS
078440120611     C**** *IN22         ANDEQ     *OFF
078450120611    2C**** ORMNDC        ORGT      *ZEROS
078460120611     C**** VIDPDR        ANDEQ     *BLANKS
078470120611     C**** *IN22         ANDEQ     *OFF
078480120611     C**** ORMNDC        ORGT      *ZEROS
078490120611     C**** VIDPDR        ANDEQ     '?   '
078500120611     C**** *IN22         ANDEQ     *OFF
078510120611     C**** ORMNDC        ORGT      *ZEROS
078520120611     C**** VIDFPP        ANDEQ     *BLANKS
078530120611     C**** *IN22         ANDEQ     *OFF
078540120611     c****
078550120611     C****               MOVE      ORMNDC        W0050             5 0
078560120611     C**** KDST          CHAIN     FIDST01L                           30
078570120611    3C**** *IN30         IFEQ      *OFF
078580120611    4C**** VIDPDR        IFEQ      *ZEROS
078590120611    4C**** VIDPDR        OREQ      *BLANKS
078600120611    4C**** VIDPDR        OREQ      '?   '
078610120611     C****               MOVE      DSTPDR        VIDPDR
078620120611     c****               clear                   v1dpdr
078630120611     C****               MOVE      DSTPDR        PREPDR
078640120611     C****               MOVEL     '1'           WEFORM
078650120611    4C****               ENDIF
078660120611     C****               MOVE      DSTPDR        WDPDR
078670120611    4C**** VIDPDR        IFEQ      WDPDR
078680120611     C**** VIDFPP        ANDEQ     *BLANKS
078690120611     C****               MOVE      ORMNDC        W0050
078700120611     C**** KFVV          CHAIN     FNFVV01L                           30
078710120611     C****               MOVE      FVVFPP        VIDFPP
078720120611     C****               MOVEL     FVVFPP        PREFPP
078730120611     C****               MOVEL     '1'           WEFORM
078740120611    4C****               ENDIF
078750120611    3C****               ENDIF
078760120611    2C****               ENDIF
078770120611     C****               ENDIF
078780120611     c****               ENDSR
078790010214     C*
078800010214     C* CONTROLLI DI CONGRUENZA CAMPI I°VIDEATA CON CAMPI DELL'ORM --*
078810010214     C     CNFOR1        BEGSR
078820050427     c                   clear                   wcaut            27
078830010214     C*
078840010214     C* I seguenti errori sono tutti forzabili e vengono effettuati
078850010214     C* solo se numero ORM non fittizio e se non sono in immissione
078860010214     C* dei miei prepagati perchè in questo caso l'ORM viene crato
078870010214     C* dopo l'immissione del prepagato
078880010214     C*
078890010215    1C     FLGFIT        IFNE      'S'
078900010214     C     PARTCH        ANDNE     'P'
078910010214     C*
078920010214     C*** DATA RITIRO ***
078930010214     C*
078940071107     c****               if        dateu<§vpodrt
078950071107    2C**** VIDDRT        IFGT      *ZEROS
078960071107     C**** §LPFPR        ANDNE     'O'
078970071107     C**** d§fardar      ANDEQ     'S'
078980071107     C**** VIDDRT        ANDNE     PREDRT
078990071107     C**** ORMDFO        ANDNE     COMDRT
079000071107     C****               MOVEL     RIMM          ATRDRT
079010071107     C****               Z-ADD     VIDDRT        PREDRT
079020071107     C****               SETON                                        90
079030071107    2C****               ENDIF
079040071107     c****               endif
079050040902     c                   exsr      CNFOR1bis
079060010214     C* I SEGUENTI CONTROLLI VENGONO FATTI SOLO SE NON SONO IN CONFERMA
079070010214     C* BOLLE DA DISCHETTO
079080010215    2C     *IN12         IFEQ      *OFF
079090010214     C     *IN15         OREQ      *OFF
079100010214     C*
079110010214     C** CODICE CLIENTE MITTENTE
079120010214     C*
079130010215    3C     VIDCCM        IFGT      *ZEROS
079140010214     C     ORMKSC        ANDGT     *ZEROS
079150010214     C                   MOVE      VIDCCM        WOCCM
079160010214     C                   MOVEL     VIDFLC        WOCCM
079170010215    4C     WOCCM         IFNE      PRECCM
079180010214     C                   Z-ADD     WOCCM         PRECCM
079190010215    5C     VIDFLC        IFEQ      *ZEROS
079200010214     C                   MOVEL     VIDLNP        WOCCM
079210010215    5C                   ENDIF
079220010215    5C     WOCCM         IFNE      ORMKSC
079230030905    6c                   If        §OrPfb <> 'A'
079240010214     C                   MOVEL     RIMM          ATRCCM
079250010214     C                   SETON                                        90
079260010215   X6C                   ELSE
079270030905    7c                   If        Vidccm <> 9999
079280010214     C                   MOVEL     RIMM          ATRCCM
079290010214     C                   SETON                                        90
079300010215    7C                   ENDIF
079310010215    6C                   ENDIF
079320010215    5C                   ENDIF
079330010215    4C                   ENDIF
079340010215    3C                   ENDIF
079350010214     C*
079360010214     C** FERMO DEPOSITO
079370010214     C*
079380010215     C     ORMFFD        IFEQ      ' '
079390010215     C                   MOVE      'N'           W001A             1
079400010215     C                   ELSE
079410010215     C                   MOVE      ORMFFD        W001A
079420010215     C                   ENDIF
079430010215    3C     VIDFFD        IFNE      W001A
079440010214     C     VIDFFD        ANDNE     PREFFD
079450010220     C                   MOVE      VIDFFD        PREFFD
079460010214     C                   MOVEL     RIMM          ATRFFD
079470010214     C                   SETON                                        90
079480010215    3C                   ENDIF
079490010305     C*
079500010305     C** COLLI E PESO ** SE SONO IN CONFERMA PREPAGATI DI ALTRI P.O.
079510010305     C*
079520010305    3C     §LPFPR        IFEQ      'O'
079530010305    4C     V1CNCL        IFNE      ORMNCL
079540010305     C     V1CNCL        ANDNE     PRENCL
079550010305     C                   Z-ADD     V1CNCL        PRENCL
079560010305     C                   MOVEL     RIMM          ATRNCL
079570010305     C                   SETON                                        90
079580010305    4C                   ENDIF
079590010305    4C     VIDPKG        IFNE      ORMPKG
079600010305     C     VIDPKG        ANDNE     PREPKG
079610010305     C                   Z-ADD     VIDPKG        PREPKG
079620010305     C                   MOVEL     RIMM          ATRPKG
079630010305     C                   SETON                                        90
079640010305    4C                   ENDIF
079650010305    3C                   ENDIF
079660010215    2C                   ENDIF
079670010214     C*
079680010214     C   90              MOVEL     ERR(221)      VIDMSG
079690010214     C   90              MOVEL     '1'           WEMFOR
079700050427     c   90              if        wcaut <> *blanks
079710050427     c                   move      wcaut         vidmsg
079720050427     c                   endif
079730010215    1C                   ENDIF
079740010214     C                   ENDSR
079750040902     C*
079760040902     C* CONTROLLI DI CONGRUENZA CAMPI PDR e FPP CON CAMPI DELL'ORM --*
079770040902     C     CNFOR1bis     BEGSR
079780040902     C*
079790040902     C**
079800040902     C* CODICE PADRONCINO + FLAG MATTINO/POMERIGGIO
079810040902     C**
079820040902    2C     ORMNDC        IFGT      *ZEROS
079830040902     C     VIDPDR        ANDGT     *ZEROS
079840040902     C     VIDPDR        ANDNE     PREPDR
079850070606     c                   exsr      sr_dst
079860040902     C                   MOVE      DSTPDR        WDPDR
079870040902    3C     WDPDR         IFNE      VIDPDR
079880050426     c**   atrpdr        ifne      prri
079890040902     C                   MOVEL     RIMM          ATRPDR
079900050426     c**                 endif
079910040902     C                   MOVE      VIDPDR        PREPDR
079920040902     C                   SETON                                        90
079930050427     c                   move      dstpdr        wadpdr            7
079940050427     c                   eval      wcaut = caut
079950050427     c                   eval      %subst(wcaut: 6: 7) = wadpdr
079960040902    3C                   ENDIF
079970040902    2C                   ENDIF
079980040902     C* Il flag mattino/pomeriggio lo controllo solo se il PDR è =
079990040902    2C     ORMNDC        IFGT      *ZEROS
080000040902     C     VIDPDR        ANDEQ     WDPDR
080010040902     C     VIDFPP        ANDNE     *BLANKS
080020040902     C     VIDFPP        ANDNE     PREFPP
080030040902     C                   MOVE      ORMNDC        W0050
080040060522     c                   if        w_pogest = *zeros
080050060522     c                   z-add     ormpor        kfgs
080060060522     c                   else
080070060522     c                   z-add     w_pogest      kfgs
080080060522     c                   endif
080090040902     C     KFVV          CHAIN     FNFVV01L                           30
080100040902    3C     FVVFPP        IFNE      VIDFPP
080110050426     c***  atrfpp        ifne      prri
080120040902     C                   MOVEL     RIMM          ATRFPP
080130050426     c***                endif
080140040902     C                   MOVE      VIDFPP        PREFPP
080150040902     C                   SETON                                        90
080160040902    3C                   ENDIF
080170040902    2C                   ENDIF
080180040902     c                   ENDSR
080190120611     c
080200120611     C* Ricerca codice autotrasportatore che ha eseguito l'orm ----------------
080210070606     C     sr_dst        BEGSR
080220120611     c
080230120611     C                   MOVE      ORMNDC        W0050
080240070606     c                   if        w_pogest = *zeros
080250070606     C                   z-add     ORMpor        kfgs
080260070606     c                   else
080270070606     c                   z-add     w_pogest      kfgs
080280070606     c                   endif
080290120611     C     KDST          CHAIN     FIDST01L                           30
080300070606     C   30              CLEAR                   DSTPDR
080310070606     c                   endsr
080320010215     C*
080330010215     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA II° VIDEATA) ----------*
080340010215     C     PRPOR2        BEGSR
080350010215     C                   CLEAR                   WEFORM
080360010215     C*
080370010215     C** MITTENTE (RAG.SOC.,INDIRIZZO...)
080380030912      * da mittente ORM se l'ORM prevede la bolla in porto assegnato
080390030912      * o se conferma ORM prepagati
080400010215     C*
080410030912    1c                   If        Not *In02 and
080420030923     c                             (VidCcm = 9999 or
080430030923     c                             (§LpFpr = 'O' and VidCcm = 8888))
080440010215    3C     WOVUO         IFEQ      *BLANKS
080450010215     C     VIDRSM        OREQ      *BLANKS
080460010215     C                   MOVEL     ORMRSR        VIDRSM
080470010215     C                   MOVEL     '1'           WEFORM
080480010215    3C                   ENDIF
080490010215    3C     WOVUO         IFEQ      *BLANKS
080500010215     C     VIDINM        OREQ      *BLANKS
080510010215     C                   MOVEL     ORMINR        VIDINM
080520010215     C                   MOVEL     '1'           WEFORM
080530010215    3C                   ENDIF
080540010215    3C     WOVUO         IFEQ      *BLANKS
080550010215     C     VIDCAM        OREQ      *BLANKS
080560010215     C                   MOVEL     ORMCAR        VIDCAM
080570010215     C                   MOVEL     '1'           WEFORM
080580010215    3C                   ENDIF
080590010215    3C     WOVUO         IFEQ      *BLANKS
080600010215     C     VIDLOM        OREQ      *BLANKS
080610010215     C                   MOVEL     ORMLOR        VIDLOM
080620010215     C                   MOVEL     '1'           WEFORM
080630010215    3C                   ENDIF
080640010215    3C     WOVUO         IFEQ      *BLANKS
080650010329     C     VIDPRM        OREQ      *BLANKS
080660010329     C     ORMPRR        ANDNE     *BLANKS
080670010329     C     VIDCAM        ANDEQ     ORMCAR
080680010329     C     ORMCAR        ANDNE     *BLANKS
080690010215     C                   MOVEL     ORMPRR        VIDPRM
080700010215     C                   MOVEL     '1'           WEFORM
080710010215    3C                   ENDIF
080720010216    3C     WOVUO         IFEQ      *BLANKS
080730010329     C     VIDNZM        OREQ      *BLANKS
080740010329     C     ORMNAR        ANDNE     *BLANKS
080750010329     C     VIDCAM        ANDEQ     ORMCAR
080760010329     C     ORMCAR        ANDNE     *BLANKS
080770010216     C                   MOVEL     ORMNAR        VIDNZM
080780010216     C                   MOVEL     '1'           WEFORM
080790010216    3C                   ENDIF
080800061113     c*
080810061113     c                   if        *in22 and ormtco='I' and ormcor=0
080820161019     c                   if        wovuo=*blanks or
080830161019     c                             (vidcdf=*blanks and vidpim=*blanks)
080840061113     c                   move      ormino        vidcdf
080850061113     c                   endif
080860161019     c                   endif
080870031201    1C                   ENDIF
080880031201      * se ho forzato il porto franco
080890031201if  1c                   If        wforpf = '1'
080900031201if  2c                   If        Not *In02
080910031201      * imposto l'ordinante dell'orm nel mittente bolla
080920031201    3C     WOVUO         IFEQ      *BLANKS
080930031201     C     VIDRSM        OREQ      *BLANKS
080940031201     C                   MOVEL     ORMRSO        VIDRSM
080950031201     C                   MOVEL     '1'           WEFORM
080960031201    3C                   ENDIF
080970031201    3C     WOVUO         IFEQ      *BLANKS
080980031201     C     VIDINM        OREQ      *BLANKS
080990031201     C                   MOVEL     ORMINO        VIDINM
081000031201     C                   MOVEL     '1'           WEFORM
081010031201    3C                   ENDIF
081020031201    3C     WOVUO         IFEQ      *BLANKS
081030031201     C     VIDCAM        OREQ      *BLANKS
081040031201     C                   MOVEL     ORMCAO        VIDCAM
081050031201     C                   MOVEL     '1'           WEFORM
081060031201    3C                   ENDIF
081070031201    3C     WOVUO         IFEQ      *BLANKS
081080031201     C     VIDLOM        OREQ      *BLANKS
081090031201     C                   MOVEL     ORMLOO        VIDLOM
081100031201     C                   MOVEL     '1'           WEFORM
081110031201    3C                   ENDIF
081120031201    3C     WOVUO         IFEQ      *BLANKS
081130031201     C     VIDPRM        OREQ      *BLANKS
081140031201     C     ORMPRO        ANDNE     *BLANKS
081150031201     C     VIDCAM        ANDEQ     ORMCAO
081160031201     C     ORMCAO        ANDNE     *BLANKS
081170031201     C                   MOVEL     ORMPRO        VIDPRM
081180031201     C                   MOVEL     '1'           WEFORM
081190031201    3C                   ENDIF
081200031201    3C     WOVUO         IFEQ      *BLANKS
081210031201     C     VIDNZM        OREQ      *BLANKS
081220031201     C     ORMNAO        ANDNE     *BLANKS
081230031201     C     VIDCAM        ANDEQ     ORMCAO
081240031201     C     ORMCAO        ANDNE     *BLANKS
081250031201     C                   MOVEL     ORMNAO        VIDNZM
081260031201     C                   MOVEL     '1'           WEFORM
081270031201    3C                   ENDIF
081280031201    2c                   EndIf
081290031201      * imposto il mittente dell'orm nel mittente originale bolla
081300031201    2c                   If        wovuo = *Blanks or vidrmo = *Blanks
081310031201     c                   Movel     OrmRsr        vidrmo
081320031201     c                   Eval      wemfor = '1'
081330031201    2c                   EndIf
081340031201    2c                   If        wovuo = *Blanks or vidcmo = *Blanks
081350031201     c                   Movel     OrmCar        vidcmo
081360031201     c                   Eval      wemfor = '1'
081370031201    2c                   EndIf
081380031201    2c                   If        wovuo = *Blanks or  vidnmo = *Blanks
081390031201     c                   Movel     OrmNar        vidnmo
081400031201     c                   Eval      wemfor = '1'
081410031201    2c                   EndIf
081420031201    1c                   EndIf
081430010306     C*
081440010306     C* VOLUME - SOLO SE RICHIAMATA DA CONFERMA PREPAGATI DI ALTRO P.O.
081450010306     C*
081460010306    1C     §LPFPR        IFEQ      'O'
081470010306     C     ORMVLM        ANDGT     *ZEROS
081480010306     C* Metto il test su campo wovuo anche per volume per uniformità
081490010306     C* anche se in questo caso forse non serve perchè il volume
081500010306     c* non viene mai impostato diverso da 0 in ctrd01
081510010306     C     WOVUO         IFEQ      *BLANKS
081520010306     C     VIDVOL        OREQ      *ZEROS
081530010306     C                   Z-ADD     ORMVLM        VIDVOL
081540010306     C                   MOVEL     '1'           WEFORM
081550010306     C                   ENDIF
081560010306    1C                   ENDIF
081570010215     C*
081580010215     C* CODICE TARIFFA
081590010215     C*
081600031201     c                   If        Not *In29 and §OrPfb <> 'A'
081610010215     C                   MOVE      VIDCCM        W0070             7 0
081620010215    2C     VIDFLC        IFEQ      *ZEROS
081630010215     C                   MOVEL     VIDLNP        W0070
081640010215     C                   ELSE
081650010215     C                   MOVEL     VIDFLC        W0070
081660010215    2C                   ENDIF
081670010226     C* Propongo il codice tariffa da orm solo se:
081680010226     C* Stesso codice cliente mittente
081690010215    2C     W0070         IFEQ      ORMKSC
081700010226     C* immesso codice tariffa su orm
081710010215     C     ORMCTR        ANDNE     *BLANKS
081720010226     C* codice tariffa a video = blanks
081730010226     C     VIDCTR        ANDEQ     *BLANKS
081740010215     C                   MOVE      ORMCTR        VIDCTR
081750010215     C                   MOVE      ORMCTR        PRECTR
081760010215     C                   MOVEL     '1'           WEFORM
081770010215    2C                   ENDIF
081780010215    1C                   ENDIF
081790010215     C*
081800010215     C* NATURA MERCE
081810010215     C*
081820011221    1C  N27              DO
081830011221     C                   MOVEL     ORMNAM        W015A
081840011221    2C     W015A         IFNE      *BLANKS
081850010226     C     VIDNAS        ANDEQ     *BLANKS
081860010215     C                   MOVEL     ORMNAM        VIDNAS
081870010215     C                   MOVEL     '1'           WEFORM
081880011221    2C                   ENDIF
081890011221    1C                   ENDDO
081900010215     C*
081910010404     C* NOTE: SE PESO > 50 Q.LI
081920010404     C*       SE O.R.M. COMMISSIONATI DA ALTRO P.O. NELLE NOTE METTO
081930010404     C*       SEMPRE E SOLO IL REFERENTE E NUMERO DI TELEFONO
081940010307    1C                   SELECT
081950010307     C     §LPFPR        WHENEQ    'O'
081960050211     C***  ORMPOE        ORNE      ORMPOR
081970010307     C     VIDNT1        IFEQ      *BLANKS
081980010307     C                   MOVEL     WTELRF        VIDNT1
081990010307     C                   MOVEL     '1'           WEFORM
082000010307     C                   ENDIF
082010010307     C     WTELR2        IFNE      *BLANKS
082020010307     C     VIDNT2        IFEQ      *BLANKS
082030010307     C     WOVUO         OREQ      *BLANKS
082040010307     C                   MOVE      WTELR2        VIDNT2
082050010307     C                   MOVEL     '1'           WEFORM
082060010307     C                   ENDIF
082070010307     C                   ENDIF
082080010409     C     VIDPKG        WHENGE    §DFMAX
082090010215    2C     ORMNO1        IFNE      *BLANKS
082100010226     C     VIDNT1        ANDEQ     *BLANKS
082110010215     C                   MOVEL     ORMNO1        VIDNT1
082120010215     C                   MOVEL     '1'           WEFORM
082130010215    2C                   ENDIF
082140010215    2C     ORMNO2        IFNE      *BLANKS
082150010226     C     VIDNT2        IFEQ      *BLANKS
082160010226     C     WOVUO         OREQ      *BLANKS
082170010215     C                   MOVEL     ORMNO2        VIDNT2
082180010215     C                   MOVEL     '1'           WEFORM
082190010226     C                   ENDIF
082200010215    2C                   ENDIF
082210010307    1C                   ENDSL
082220010223     C                   MOVE      '1'           WOVUO             1
082230010215     C                   ENDSR
082240010215     C*
082250010215     C* CONTROLLI DI CONGRUENZA COD.TARIFFA CON CAMPO DELL'ORM ------*
082260010215     C     CNFOR2        BEGSR
082270010215     C*
082280010215     C*** CODICE TAR. ***
082290010215     C*
082300010223     C                   MOVE      VIDCCM        W0070
082310010223     C     VIDFLC        IFEQ      *ZEROS
082320010223     C                   MOVEL     VIDLNP        W0070
082330010223     C                   ELSE
082340010223     C                   MOVEL     VIDFLC        W0070
082350010223     C                   ENDIF
082360030905     C* ORM NON PAGATO DA DESTINATARIO
082370030905      * L'orm prevede la bolla in porto franco
082380030905     c     §OrPfb        Ifne      'A'
082390010223     C* PRESENTE CODICE CLIENTE SU ORM
082400010223     C     ORMKSC        ANDGT     *ZEROS
082410010223     C     ORMKSC        ANDEQ     W0070
082420010215     C     VIDCTR        IFNE      *BLANKS
082430010215     C     VIDCTR        ANDNE     PRECTR
082440010215     C     ORMCTR        ANDNE     VIDCTR
082450010215     C     ORMCTR        ANDNE     *BLANKS
082460010215     C                   MOVEL     RIMM          ATRCTR
082470010215     C                   MOVEL     VIDCTR        PRECTR
082480010215     C                   SETON                                        90
082490010215     C                   ENDIF
082500010223     C                   ENDIF
082510010215     C*
082520010215     C   90              MOVEL     ERR(224)      VIDMSG
082530010215     C   90              MOVEL     '1'           WEMFOR
082540010215     C                   ENDSR
082550070427     C*
082560070427     C* PROPOSTA mittente originale da orm per import dpd in porto assegnato
082570070427     C     PRPOR2_rmo    BEGSR
082580091008     c****               if        dateu>=§vpormo and §vpormo>0
082590070427     C                   CLEAR                   WEFORM
082600070427    2c                   If        wovuo1= *Blanks or vidrmo = *Blanks
082610070427     c                   Movel     OrmRsr        vidrmo
082620070430     c                   Eval      weform = '1'
082630070427    2c                   endif
082640070427    2c                   If        wovuo1= *Blanks or vidcmo = *Blanks
082650070427     c                   Movel     OrmCar        vidcmo
082660070430     c                   Eval      weform = '1'
082670070427    2c                   endif
082680070427    2c                   If        wovuo1= *Blanks or vidnmo = *Blanks
082690070427     c                   Movel     OrmNar        vidnmo
082700070430     c                   Eval      weform = '1'
082710070427    2c                   endif
082720070427     c                   movel     '1'           wovuo1            1
082730091008     c****               endif
082740070427     c                   endsr
082750091008     c*
082760960926     C* CONTROLLO CODICE AUTOTRASPORTATORE --------------------------*
082770940824     C     CTRPDR        BEGSR
082780940824     C*
082790940930     C                   CLEAR                   V1DPDR
082800990614     C                   CLEAR                   APDRSC
082810990614     C                   CLEAR                   APDFCM
082820990614     C                   CLEAR                   APDATB
082830940929     C*
082840940824     C     '?'           SCAN      WPDR                                   30
082850940824     C*
082860990915    1C     *IN30         IFEQ      *ON
082870021203      *
082880021203      * imposto i campi della ds esterna fnlv24ds
082890021203     C                   clear                   fnlv24ds
082900021203     C                   eval      d24fil   = wlnp
082910021203     C                   eval      d24tip   = 'A'
082920021203     C                   eval      d24flg   = 'R'
082930021203     C                   movel     fnlv24ds      kpjbu
082940940824     C                   CALL      'FNLV24R'
082950940824     C                   PARM                    KPJBA
082960021203      *
082970021203      * valorizzo i campi a video
082980021203     C                   movel     kpjbu         fnlv24ds
082990021203     C                   if        d24pdr   <> *zeros
083000021203     C                   move      d24pdr        wpdr
083010021203     C                   movel     d24rsc        v1dpdr
083020021203     C                   endif
083030021203     C                   MOVEL     '1'           WEMFOR
083040941011     C                   SETON                                        56
083050940824     C                   GOTO      ENDCPD
083060990915    1C                   END
083070940928     C* ESEGUO TESTN
083080990915    1C     PARTCH        IFNE      'P'
083090010307     C     §LPFPR        ANDNE     'O'
083100990610     C* PER PREPAGATI SOLO SE IL CAMPO E' PIENO
083110990610     C     PARTCH        OREQ      'P'
083120990610     C     WPDR          ANDNE     *BLANKS
083130990610     C     WPDR          ANDNE     *ZEROS
083140010307     C     §LPFPR        OREQ      'O'
083150010307     C     WPDR          ANDNE     *BLANKS
083160010307     C     WPDR          ANDNE     *ZEROS
083170990610     C*
083180940928     C                   TESTN                   WPDR                 30
083190940928     C                   MOVE      WPDR          W001A
083200990915    2C     *IN30         IFEQ      *OFF
083210940928     C     W001A         ORLT      '0'
083220940928     C                   MOVEL     ERR(21)       VIDMSG
083230940928     C                   SETON                                        5690
083240940928     C                   GOTO      ENDCPD
083250990915    2C                   ENDIF
083260940824     C*
083270940928     C                   MOVEL     WLNP          W0070             7 0
083280940928     C                   MOVE      WPDR          W0070
083290021204     C                   move      w0070         kpdpdr
083300021203     C                   move      'A'           kpdtip
083310021203     C     kfapd         chain     fiapd01l                           30
083320990915    2C     *IN30         IFEQ      *ON
083330940824     C     *IN30         OREQ      *OFF
083340940824     C     APDATB        ANDNE     *BLANKS
083350940824     C                   MOVEL     ERR(21)       VIDMSG
083360940920     C                   SETON                                        5690
083370940824     C                   GOTO      ENDCPD
083380990915    2C                   ENDIF
083390940824     C*
083400940824     C* NON POSSO INSERIRE UNA DATA RITIRO SE ESISTE LA CONFERMA DEI
083410960926     C*  CONTEGGI AUTOTRASPORTATORI PER QUEL GIORNO
083420950116     C                   MOVE      W0070         W01PDR
083430940824     C                   MOVEL     ' '           W01TSR
083440940824     C                   MOVEL     'C'           W01FVL
083450011126     C     KFTT          SETLL     FIFTT000                               90
083460011126     C  N90KFTT          SETLL     FIFST000                               90
083470940824     C*
083480990915    2C     *IN90         IFEQ      *ON
083490940824     C                   MOVEL     ERR(7)        VIDMSG
083500940920     C                   SETON                                        56
083510940824     C                   GOTO      ENDCPD
083520990915    2C                   ENDIF
083530990915     C*
083540990915     C* SE SI TRATTA DELLA CONFERMA DI UN PREPAGATO, DO MSG SE FLAG
083550990915     C*  MERCE A MAGAZZINO DIVERSO DAL COD AUTOTRASPORTATORE
083560990915     C     VIDPDR        IFNE      SAVPD4
083570990915     C                   CLEAR                   AAC
083580990915     C                   MOVEL     VIDPDR        SAVPD4
083590990915     C                   ENDIF
083600991001     C*
083610991001     C* CONTROLLO PER IL MOMENTO SOSPESO: QUANDO ATTIVEREMO PER I
083620991001     C*  PREPAGATI LA VARIA "U" SI DEVE RIMETTERE
083630001024     C* RIATTIVATO IL 24/10/00
083640990915     C*
083650001024     C     *IN22         IFEQ      *ON
083660990915     C     *IN12         ANDEQ     *ON
083670990915     C     *IN15         ANDEQ     *OFF
083680990915     C     AAC           ANDEQ     0
083690990915     C     BLPPDR        ANDEQ     0
083700990915     C     VIDMAG        IFNE      APDFCM
083710990915     C                   MOVEL     1             AAC
083720990915     C                   MOVEL     ERR(168)      VIDMSG
083730990915     C                   SETON                                        5690
083740990915     C                   GOTO      ENDCPD
083750990915     C                   ENDIF
083760990915     C                   ENDIF
083770940824     C*
083780940824     C                   MOVEL     APDRSC        V1DPDR
083790041013     c* se orm reale controllo che non esistano altre bolle associate
083800041013     c* allo stesso orm ma abbinate ad altro autotrasportatore.
083810041013     c* Se presenti --> errore bloccante
083820041013     C     WORM          IFEQ      'S'
083830041013     C     FLGFIT        ANDNE     'S'
083840041013     c                   exsr      SR_CtrOrmPdr
083850041013     C   90              GOTO      ENDCPD
083860041013     c                   endif
083870990915    1C                   ENDIF
083880940824     C*
083890940824     C     ENDCPD        TAG
083900940824     C   90              MOVEL     '1'           WEMFOR
083910940824     C                   ENDSR
083920041013     C**************************************************************************
083930041013     C*   Controllo esistenza altre bolle associate all'orm immesso
083940041013     C**************************************************************************
083950041013     C     SR_CtrOrmPdr  BEGSR
083960041013     C                   MOVEL     DSBLP0        SAVBLP
083970041019     c     *in12         ifeq      *on
083980041019     c     *in15         andeq     *off
083990041019     c                   movel     *blanks       savbol           16
084000041019     c                   eval      savbol = %EDITW(BLPAAS:'    ')     +
084010041019     C                                      %editw(BLPLNP:'   ')      +
084020041019     C                                      %editw(BLPNRS:'  ')       +
084030041019     C                                      %editw(BLPNSP:'       ')
084040041019     c                   endif
084050041019     c
084060060215     c                   movel     'M'           kar4trc
084070060215     c                   movel     widorm        kar4n14
084080160209     c     kar403        setll     fiar405l
084090041013     c                   do        *hival
084100160209     c     kar403        reade     fiar405l
084110041013     c* fine file
084120160209     c                   if        %eof(fiar405l)
084130041013     c                   leave
084140041013     c                   endif
084150061212     c     kblp4m        chain     fnblp01l
084160041019     c
084170041019     c     *in12         ifeq      *on
084180041019     c     *in15         andeq     *off
084190041019     c                   movel     *blanks       blpbol           16
084200041019     C                   eval      blpbol = %editw(BLPAAS:'    ')   +
084210041019     C                                      %editw(BLPLNP:'   ')    +
084220041019     C                                      %editw(BLPNRS:'  ')     +
084230041019     C                                      %editw(BLPNSP:'       ')
084240041019     c                   endif
084250041013     c* trovata bolla con aut diverso errore --> esco dal ciclo
084260041013     c                   if        %found(fnblp01l) and
084270041019     c                             blppdr <> w01pdr and
084280041019     c                             blppdr > 0
084290041019     c* se sono in manutenzione e ho letto la bolla che sto manutenzion
084300041019     c* ando ignoro
084310041019     c     *in12         ifeq      *on
084320041019     c     *in15         andeq     *off
084330041019     c     blpbol        andne     savbol
084340041019     c     *in12         oreq      *off
084350041019     c     *in15         oreq      *on
084360041019     c
084370041013     C                   MOVEL     ERR(286)      VIDMSG
084380041013     C                   SETON                                        5690
084390041013     C                   leave
084400041019     c                   endif
084410041013     c                   endif
084420041013     c
084430041013     c                   enddo
084440041013     c
084450041013     C                   MOVEL     SAVBLP        DSBLP0
084460041013     c                   endsr
084470940824     C*
084480940824     C* CONTROLLO CODICE BOLLA ---------------------------------------*
084490940824     C     CTRCBO        BEGSR
084500940824     C* NO PERSONALIZZAZIONE
084510940824    0C     *IN21         IFEQ      *OFF
084520941103     C                   SETOFF                                       040508
084530940824     C* RICERCA
084540940922     C                   MOVEL     '3A'          COD
084550940824     C     '?'           SCAN      WCBO                                   30
084560940824    1C     *IN30         IFEQ      *ON
084570940922     C                   EXSR      CX§TAB
084580940824     C                   MOVEL     §KEY          WCBO
084590941011     C                   SETON                                        46
084600940824     C                   GOTO      ENDCCB
084610940824    1C                   ENDIF
084620940824     C*
084630940920     C                   MOVEL(P)  WCBO          KEY
084640940824     C*
084650940824     C                   EXSR      CTABEL
084660940824    1C     *IN30         IFEQ      *ON
084670940824     C                   MOVEL     ERR(10)       VIDMSG
084680940920     C                   SETON                                        4690
084690940824     C                   GOTO      ENDCCB
084700940824    1C                   ENDIF
084710940824     C*
084720940824     C                   MOVEL     TBLUNI        DS3A
084730940824     C                   MOVEL     §3ATB1        FLGTB1            1
084740940824     C                   MOVEL     §3ADES        V2DCBO
084750940824     C* VEDO SE CAUSALE UTILIZZABILE
084760940824     C  N12
084770940824     CORN44
084780940824    1CAN 12§3AUCB        IFEQ      'N'
084790940824     C                   MOVEL     ERR(10)       VIDMSG
084800940920     C                   SETON                                        4690
084810940824     C                   GOTO      ENDCCB
084820940824    1C                   END
084830000509     C*
084840000509     C* PER BOLLE POSTE AMMESSO SOLO FRANCO
084850020319     C     §ogntw        IFEQ      'PPT'
084860000906     C     FLGTB1        IFNE      'F'
084870000906     C     §3ATB2        ORNE      '  '
084880000509     C                   MOVEL     ERR(199)      VIDMSG
084890000509     C                   SETON                                        4690
084900000509     C                   GOTO      ENDCCB
084910000509     C                   ENDIF
084920000911     C                   ENDIF
084930940824     C*
084940991026     C     FLGTB1        COMP      'A'                                    04
084950941103     C*
084960940929     C* 08 ON - TASSATO DESTINO
084970940826     C     §3AFTD        IFEQ      1
084980940826     C                   SETON                                        08
084990940920     C                   ENDIF
085000940920     C* 05 ON - 2 BOLLA E NON E' TASSATO DESTINO
085010940920     C  N08§3ATB2        IFNE      *BLANKS
085020940920     C                   SETON                                        05
085030940920     C                   ENDIF
085040991026      *
085050991026      * SE SONO NELLA PROCEDURA PREPAGATI DEVO SELEZIONARE UN PORTO FRANCO
085060991026     C     *IN04         IFEQ      *ON
085070991026     C     PARTCH        ANDEQ     'P'
085080010307     C     *IN04         OREQ      *ON
085090010307     C     §LPFPR        ANDEQ     'O'
085100991026     C                   MOVEL     ERR(173)      VIDMSG
085110991026     C                   SETON                                        4690
085120991026     C                   GOTO      ENDCCB
085130991026     C                   ENDIF
085140020611     c* X prepagati non posso bollettare come C/servizio
085150020611     c     *in22         ifeq      *on
085160020611     c     §3arbl        andeq     'C'
085170020611     c                   movel     err(256)      vidmsg
085180020611     C                   SETON                                        4690
085190020611     C                   GOTO      ENDCCB
085200020611     c                   endif
085210030805      * se ORM con serie il codice bolla non può essere diverso da quello
085220030805      * indicato in tabella 'OSR'
085230030805If  1c                   If        wonsr > *Zeros and flgfit <> 'S' and
085240030808     c                             wCbo <> d§OsrCbo and d§OsrCbo <> *Blanks
085250030805     c                   Eval      VidMsg = Err(148)
085260030805     c                   Eval      %subst(VidMsg:25:2) = d§OsrCbo
085270030805     c                   Eval      *In46 = *On
085280030805     c                   Eval      *In90 = *On
085290030805     c                   GoTo      EndCcb
085300030805    1c                   EndIf
085310040122
085320040122      * Il codice bolla '2R' è ammesso solo se ho inserito un ORM con la serie
085330040203     c                   If        wcbo = '2R' and
085340040203     c                             (flgfit = 'S' or wonsr = *Zeros)
085350040122     c                   Eval      VidMsg = Err(10)
085360040122     c                   Eval      *In46 = *On
085370040122     c                   Eval      *In90 = *On
085380040122     c                   GoTo      EndCcb
085390040122     c                   EndIf
085400991026     C*
085410940824    0C                   ENDIF
085420940824     C*
085430940824     C* SE BOLLA DI RECUPERO NO DATA SPEDIZIONE < DATA GIORNO -3
085440940824     C* ALTRIMENTI NO < DATA GIORNO
085450940824    0C     §3ARBL        IFEQ      'R'
085460940824     C*
085470000113    1C     *IN12         IFEQ      *OFF
085480000113     C     *IN15         OREQ      *ON
085490000113     C     BLPDSP        ORNE      WBDSP
085500000113    2C     BLPDSP        IFLT      DATAM
085510940824     C                   MOVEL     ERR(4)        VIDMSG
085520940929     C                   SETON                                        4190
085530000113    2C                   ENDIF
085540000113    1C                   ENDIF
085550940824     C*
085560940824   X0C                   ELSE
085570940824     C*
085580000104     C* IMMISSIONE O CONFERMA
085590000104    1C     *IN12         IFEQ      *OFF
085600000104     C     *IN15         OREQ      *ON
085610000104     C     BLPDSP        ORNE      WBDSP
085620061221     c
085630000104     C* MANUTENZIONE : SOLO SE LA DATA SPEDIZIONE E' STATA CAMBIATA
085640061221    2C***  BLPDSP        IFLT      DATEU
085650061221    2C     BLPDSP        IFLT      datameno1
085660940824     C                   MOVEL     ERR(5)        VIDMSG
085670061221     c                   eval      %subst(vidmsg:65:10) =
085680061221     c                             %editw(datgmeno1: '  /  /    ')
085690940929     C                   SETON                                        4190
085700000104    2C                   ENDIF
085710000104    1C                   ENDIF
085720940824    0C                   ENDIF
085730000104     C   90              GOTO      ENDCCB
085740960319     C* IN MANUTENZIONE NON POSSO MODIFICARE IL TIPO BOLLA SE BOLLA
085750960319     C*  FIGLIA
085760960319     C   12
085770960319     CANN15BLPCBO        IFNE      WCBO
085780960319     C     KBLP3         SETLL     FNLBL01L                               90
085790960319     C     *IN90         IFEQ      *ON
085800960319     C                   MOVEL     ERR(124)      VIDMSG
085810960319     C                   SETON                                        46
085820960319     C                   GOTO      ENDCCB
085830120926     c*
085840120926     c                   else
085850120926     c                   if        savrbl='R' and savtb1='F' and
085860120926     c                             §3arbl<>'R'
085870120926     C                   MOVEL     ERR(347)      VIDMSG
085880120926     C                   SETON                                        4690
085890120926     C                   GOTO      ENDCCB
085900120926     c                   endif
085910960319     C                   ENDIF
085920960319     C                   ENDIF
085930961122     C*
085940990518     C* SE MODIFICATO TIPO BOLLA, PULISCO CAMPO DIC/VEN
085950961122     C     WCBO          IFNE      SAVCBO
085960040213     C**!!!              CLEAR                   DIC
085970040213     C**!!!              CLEAR                   VEN
085980961122     C                   MOVEL     WCBO          SAVCBO
085990961122     C                   ENDIF
086000070427     c* In manutenzione
086010070427     c* se modificato porto da franco ad assegnato pulisco campo per
086020070427     c* controlli proposte mittente originale
086030070427     c                   if        *in12='1' and *in15='0' and
086040070427     C                             flgtb1<>savtb1 and flgtb1='A'
086050070427     c                   clear                   wovuo1
086060070427     c                   endif
086070940824     C* personalizzazione
086080940824     C     WPERSO        IFEQ      'P'
086090940824     C                   SETON                                        21
086100940824     C                   ENDIF
086110940824     C*
086120940928     C     ENDCCB        TAG
086130940824     C   90              MOVEL     '1'           WEMFOR
086140940824     C                   ENDSR
086150050214     C* CONTROLLO codice bolla --------------------------------------*
086160050214     C     CTRCBO_orm    BEGSR
086170060918    1C     *IN12         IFEQ      *OFF
086180091019    1C     *IN15         oreq      *On
086190091019     c     flgfit        andne     'S'
086200091019     c     §orpfb        andeq     'A'
086210060918     C* In manutenzione controllo solo se variato il numero ORM
086220060918     C     *IN15         OREQ      *OFF
086230060918     C     WORMMD        ANDEQ     '1'
086240081023     c* se bolla export dpd controllo anche se variato il codice bolla
086250081023     c     *in15         oreq      *off
086260081023     c     A_§ogntw      andeq     'DPD'
086270081023     c     vidcbo        andne     cbo_blp
086280050214      * Controllo il tipo bolla con quanto memorizzato sull'ORM
086290050214     c                   If        §OrPfb <> *Blanks and Flgtb1 <> §OrPfb
086300050214     c                             and flgfit <> 'S'
086310050214     c                   If        §OrPfb = 'F'
086320061124     c                             and wfortbo = *Blanks
086330061124     c                   Eval      VidMsg = Err(30)
086340050214     c                   Eval      %subst(VidMsg:34:9) = 'Franco   '
086350050214     c                   Eval      %subst(VidMsg:45:15) = 'ENTER X FORZARE'
086360061124     c                   Eval      *In46 = *On
086370061124     c                   Eval      *In90 = *On
086380050214     c                   Eval      WforTbo = '1'
086390050214     c                   EndIf
086400050214     c                   If        §OrPfb = 'A'
086410061124     c                   Eval      VidMsg = Err(30)
086420050214     c                   Eval      %subst(VidMsg:34:9) = 'Assegnato'
086430061124     c                   Eval      *In46 = *On
086440061124     c                   Eval      *In90 = *On
086450050214     c                   EndIf
086460050214     c                   EndIf
086470060918     c                   endif
086480050214     c                   endsr
086490081107     C* CONTROLLO codice bolla con cod. trattamento merce -----------*
086500081107     C     CTRCBO_ctm    BEGSR
086510081107     c* se cd. trattamento merce di recupero non posso usarlo con cod.
086520081107     c* bolla non di recupero a meno che non sia un codice bolla abili-
086530081107     c* tato
086540081107     c                   if        §1bfg8='N' and §3arbl<>'R'
086550081107     c                              and §3aurc=' '
086560081107     C                   MOVEL     ERR(318)      VIDMSG
086570081107     C                   SETON                                        4690
086580081107     c                   endif
086590081107     c                   endsr
086600940824     C*
086610940824     C* CONTROLLO LINEA DI ARRIVO -----------------------------------*
086620110217     C     CTRLNA_vid    BEGSR
086630110217     c
086640940824     C* NON E' STATA PERSONALIZZATA
086650940824    0C     *IN20         IFEQ      *OFF
086660940824     C*
086670940928     C                   CLEAR                   V1DLNA
086680940824     C* SOLO SE INSERITA, ALTRIMENTI LA CALCOLO IN AUTOMATICO
086690940824    1C     WLNA          IFNE      *BLANKS
086700940824     C     WLNA          ANDNE     *ZEROS
086710940824     C*
086720940824     C     '?'           SCAN      WLNA                                   30
086730940824     C*
086740940824    2C     *IN30         IFEQ      *ON
086750940824     C                   MOVE      *BLANKS       §COD1
086760940824     C                   MOVE      *BLANKS       WLNA
086770941230     C                   CALL      'TNSD19R'
086780940824     C                   PARM                    §COD1             3
086790940824     C                   PARM                    §TIP              1
086800940928     C                   PARM                    §DES
086810940824     C                   MOVEL     §COD1         WLNA
086820940928     C                   MOVEL     §DES          V1DLNA
086830940824     C                   MOVEL     '1'           WEMFOR
086840941011     C                   SETON                                        47
086850940824     C                   GOTO      ENDCLA
086860940824    2C                   ENDIF
086870110217     c
086880110217     c                   exsr      Ctrlna_Base
086890110217     c
086900110217     c* Se errore accendo indicatore di posizionamento cursore
086910110217     c                   if        *in90
086920110217     c                   seton                                        47
086930110217     C                   GOTO      ENDCLA
086940110217     c                   endif
086950940824     C*
086960991202     C* SE CAMBIATA
086970940824    2C     CO2LNA        IFNE      COMLNA
086980940824     C                   MOVEL     0             QUA
086990100209     C                   MOVEL     0             QUAH
087000040213     C**!!!              MOVEL     0             DIC
087010040213     C**!!!              MOVEL     0             VEN
087020940920     C                   MOVEL     COMLNA        CO2LNA
087030940824    2C                   END
087040940824     C* DESCRIZIONE
087050940824     C                   MOVEL     ORGDES        V1DLNA
087060940824     C* PERSONALIZZAZIONE
087070940824    2C     WPERSO        IFEQ      'P'
087080940824     C                   SETON                                        20
087090940824    2C                   ENDIF
087100940824     C*
087110940824   X1C                   ELSE
087120940824     C* LINEA NON IMMESSA
087130940824     C                   MOVEL     *BLANKS       V1DLNA
087140940824     C                   Z-ADD     0             COMLNA
087150020213     C                   CLEAR                   A_OG143
087160040525     C                   CLEAR                   A_OG150
087170940824     C* RICONTROLLO SEMPRE IL CAP
087180940824     C                   MOVEL     0             QUA
087190100209     C                   MOVEL     0             QUAH
087200940824    1C                   END
087210010220     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
087220010220     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
087230010220     C     WPERSO        IFEQ      'P'
087240010220     C     WORM          ANDEQ     'S'
087250010220     C     PARTCH        ANDNE     'P'
087260010220     C     FLGFIT        ANDNE     'S'
087270010220     C     WLNA          ANDGT     *ZEROS
087280010220     C                   MOVE      WLNA          W0030             3 0
087290010220     C     W0030         IFNE      ORMPOC
087300010220     C     ORMPOC        ANDGT     *ZEROS
087310010220     C                   SETON                                        9047
087320010220     C                   MOVEL     ERR(225)      VIDMSG
087330010220     C                   GOTO      ENDCLA
087340010220     C                   ENDIF
087350010220     C                   ENDIF
087360940928    0C                   END
087370940824     C*
087380940824     C     ENDCLA        TAG
087390940824     C   90              MOVEL     '1'           WEMFOR
087400940824     C                   ENDSR
087410110217     C*
087420110217     C* CONTROLLI di base 1° e 2° videata della linea di arrivo ------*
087430110217     c     CTRLNA_Base   BEGSR
087440110217     c
087450110217     C                   TESTN                   WLNA                 30
087460110217     C                   MOVE      WLNA          W001A             1
087470110217    2C     *IN30         IFEQ      *OFF
087480110217     C     W001A         ORLT      '0'
087490110217     C                   MOVEL     ERR(12)       VIDMSG
087500110217     C                   SETON                                        90
087510110217     C                   leavesr
087520110217    2C                   ENDIF
087530110217     c
087540110217     c* Se in immissione prepagati e lna Portogallo o Spagna errore
087550110217     c                   if        (partch='P' or §lpfpr='O') and
087560120608     c                             (wlna='340' or wlna='345' or wlna='341')
087570120608     c                             and (wccm=8888 or wccm=0)
087580110217     C                   SETON                                        90
087590110217     C                   MOVEA     ERR(311)      K78
087600110217     C                   MOVE      wlna          W003A             3
087610110217     C                   MOVEA     W003A         K78(17)
087620110217     C                   MOVEA     K78           VIDMSG
087630110217     C                   leavesr
087640110217     c                   endif
087650110217     C*
087660110217    2C     WLNA          IFGT      *ZEROS
087670110217     C                   MOVEL     WLNA          COMLNA
087680110217     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
087690110217     C                   ELSE
087700110217     C                   SETON                                        30
087710110217    2C                   END
087720110217     C*
087730110217     C* CONTROLLO SE ANNULLATO
087740110217     C* CONSIDERO SOLO I TIPI "F" E "A"
087750110217    2C  N30ORGFVA        IFNE      *BLANKS
087760110217    2C     ORGFAG        ORNE      'F'
087770110217     C     ORGFAG        ANDNE     'A'
087780110217     C                   SETON                                        30
087790110217    2C                   END
087800110217     C* CONTROLLO CHE NON SIA UNA LINEA BLOCCATA
087810110217     C                   MOVEL     ORGDE8        OG148
087820110217     C     §OGLBL        IFEQ      'N'
087830110217     C                   SETON                                        30
087840110217    2C                   END
087850110217     C*
087860110217    2C     *IN30         IFEQ      *ON
087870110217     C                   MOVEL     ERR(12)       VIDMSG
087880110217     C                   SETON                                        90
087890110217     C                   leavesr
087900110217    2C                   ENDIF
087910110217     c
087920110217     C* TERMINAL DI ARRIVO
087930110217     C                   CLEAR                   DSLV55
087940110217     C                   MOVEL     'A'           D55TPT
087950110217     C** PER POSTE DEVO PASARE LA LINEA E NON IL TERMINAL
087960110217     C                   MOVEL     VIDLNP        D55LNP
087970110217     C**
087980110217     C                   MOVEL     COMLNA        D55LIN
087990110217     C                   MOVEL     BLPDSP        D55DRF
088000110217     C                   CALL      'FNLV55R'
088010110217     C                   PARM                    DSLV55
088020110217     C     D55ERR        IFEQ      ' '
088030110217     C                   MOVEL     D55TFA        COMTFA
088040110217     C                   ELSE
088050110217     C                   SETON                                        90
088060110217     C                   MOVEL     ERR(212)      VIDMSG
088070110217     C                   leavesr
088080110217     C                   ENDIF
088090110217     C*
088100110217     C                   MOVEL     ORGDE3        A_OG143
088110110217     C                   MOVEL     ORGDF0        A_OG150
088120110217     c                   ENDSR
088130940824     C*
088140940824     C* CONTROLLO TIPO SERVIZIO --------------------------------------*
088150940824     C     CTRTSP        BEGSR
088160940824     C* SOLO SE NON PERSONALIZZATO
088170941107    0C     *IN18         IFEQ      *OFF
088180941107     C                   SETOFF                                       09
088190940824     C                   CLEAR                   V1DTSP
088200940824     C*
088210080327     c                   clear                   NOutiTSP          1
088220940824    1C     WTSP          IFNE      *BLANKS
088230940922     C                   MOVEL     '5E'          COD
088240940922     C* RICERCA
088250940824    2C     WTSP          IFEQ      '?'
088260940922     C                   EXSR      CX§TAB
088270940824     C                   MOVEL     §KEY          WTSP
088280090604     C**!!!              MOVEL     §DES          V1DTSP
088290090604     C                   Z-ADD     1             C
088300090604     C     WTSP          LOOKUP    TSP(C)                                 30
088310090604    2C                   IF        *in30
088320090604     C                   MOVEL     DTS08(C)      V1DTSP
088330090604     c                   else
088340090604     c                   clear                   v1dtsp
088350090604     c                   endif
088360941011     C                   SETON                                        48
088370940824     C                   GOTO      ENDCSP
088380940824    2C                   END
088390940922     C* CONTROLLO
088400941107     C                   Z-ADD     1             C
088410941107     C     WTSP          LOOKUP    TSP(C)                                 30
088420940922     C* ERRORE
088430941107    2C     *IN30         IFEQ      *OFF
088440940824     C                   MOVEL     ERR(15)       VIDMSG
088450940929     C                   SETON                                        4890
088460940824     C                   MOVEL     '1'           WEMFOR
088470940824     C                   GOTO      ENDCSP
088480940824    2C                   ENDIF
088490940824     C*
088500090604     C**!!!              MOVEL     DTS(C)        V1DTSP
088510090604     C**!!!              MOVEL     DTS(C)        V2DTSP
088520090604     C                   MOVEL     DTS08(C)      V1DTSP
088530090604     C                   MOVEL     DTS08(C)      V2DTSP
088540941102     C*
088550941102     C* DEVE ESSERE UTILIZZABILE IN BOLLETTAZIONE
088560080327     c                   clear                   NOutiTSP          1
088570941107    2C     UTS(C)        IFNE      'S'
088580080327     C* IN IMMISSIONE  SEMPRE ERRORE
088590941108   3 C     *IN12         IFEQ      *OFF
088600080327     c* per  disk clienti se non utilizzabile do errore solo se
088610080327     c*    diverso da tariffa e  quindi posticipo il controllo
088620080326     C**** *IN12         OREQ      *OFF
088630080327     C**** *IN15         ANDEQ     *ON
088640941107     C* IN MANUTENZ SOLO SE E' CAMBIATO
088650941107     C     *IN12         OREQ      *ON
088660941107     C     *IN15         ANDEQ     *OFF
088670941107     C     WTSP          ANDNE     BLPTSP
088680941107     C*
088690941102     C                   MOVEL     ERR(15)       VIDMSG
088700941102     C                   SETON                                        4890
088710941102     C                   MOVEL     '1'           WEMFOR
088720941102     C                   GOTO      ENDCSP
088730941108    3C                   ENDIF
088740080327     c
088750080327     c                   if        *in12 and *in15
088760080327     c                   eval      NOutiTSP='N'
088770080327     c                   endif
088780080327     c
088790941108    2C                   ENDIF
088800080327     c
088810120302     C* VEDO SE VALIDO PER POSTE, BRT/SDI
088820000509     C     USO(C)        IFEQ      'P'
088830020319     C     §ogntw        ANDNE     'PPT'
088840000509     C                   MOVEL     ERR(194)      VIDMSG
088850000509     C                   SETON                                        4890
088860000509     C                   MOVEL     '1'           WEMFOR
088870000509     C                   GOTO      ENDCSP
088880000509    3C                   ENDIF
088890000509     C     USO(C)        IFEQ      'E'
088900020319     C     §ogntw        ANDEQ     'PPT'
088910000509     C                   MOVEL     ERR(194)      VIDMSG
088920000509     C                   SETON                                        4890
088930000509     C                   MOVEL     '1'           WEMFOR
088940000509     C                   GOTO      ENDCSP
088950000509    3C                   ENDIF
088960100209     c
088970100209     c* Se modifico pulisco i flag di controllo linea di arrivo
088980100209     c                   if        wtsp<>sa2tsp
088990100209     c                   clear                   qua
089000100209     c                   clear                   quaH
089010100209     c                   eval      sa2tsp=wtsp
089020100209     c                   endif
089030100319     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
089040100319     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
089050100319     C     WPERSO        IFEQ      'P'
089060100319     C     WORM          ANDEQ     'S'
089070100319     C     PARTCH        ANDNE     'P'
089080100319     C     FLGFIT        ANDNE     'S'
089090100319     C     WesORE        ANDeq     'S'
089100100319     C     Wtsp          ANDne     ' '
089110100319     C     wtsp          andne     §oretsp
089120100319     C                   SETON                                        9048
089130100319     C                   MOVEL     ERR(76)       VIDMSG
089140100319     C                   GOTO      ENDCSP
089150100319     C                   ENDIF
089160000509     C*
089170940824     C* PERSONALIZZAZIONE
089180940824    2C     WPERSO        IFEQ      'P'
089190940922     C                   SETON                                        18
089200940824    2C                   ENDIF
089210940824     C*
089220941107   X1C                   ELSE
089230941107     C                   SETON                                        09
089240940824    1C                   ENDIF
089250941107    0C                   ENDIF
089260940824     C*
089270940824     C     ENDCSP        ENDSR
089280940824     C*
089290940824     C* CONTROLLO CODICE TRATTAMENTO MERCE --------------------------*
089300940824     C     CTRCTM        BEGSR
089310950504     C* NON E' CAMBIATO IL CTM
089320950504     C     WCTM          IFNE      SAVCTM
089330940824     C                   CLEAR                   V1DCTM
089340940824     C* RICERCA
089350940922     C                   MOVE      '1B'          COD
089360940824     C     '?'           SCAN      WCTM                                   30
089370940922     C* RICERCA
089380940824    1C     *IN30         IFEQ      *ON
089390940922     C                   EXSR      CX§TAB
089400940824     C                   MOVEL     §KEY          WCTM
089410941011     C                   SETON                                        49
089420940824     C                   GOTO      ENDCTM
089430940824    1C                   END
089440940922     C* COTROLLO
089450940920     C                   MOVEL(P)  WCTM          KEY
089460940824     C                   EXSR      CTABEL
089470940922     C* ERRORE
089480940824    1C     *IN30         IFEQ      *ON
089490940824     C                   MOVEL     ERR(16)       VIDMSG
089500940920     C                   SETON                                        4990
089510940824     C                   GOTO      ENDCTM
089520940824    1C                   ENDIF
089530940824     C*
089540940824     C                   MOVEL     TBLUNI        DS1B
089550940824     C*
089560940824     C* FLAG2 >< "S" (NUM SPEDIZIONE DAL CLIENTE) IN IMMISSIONE
089570940824    1C  N12§1BFG2        IFEQ      'S'
089580100208     C                   MOVEL     ERR(16)       VIDMSG
089590940920     C                   SETON                                        4990
089600940824     C                   GOTO      ENDCTM
089610940824    1C                   END
089620940824     C*
089630940824     C* IN RECUPERO SOLO CTM DA MAGAZZINO
089640990602    1C  N12PARTCH        IFEQ      'R'
089650940824     C     §1BFG6        ANDNE     'M'
089660940824     C                   MOVEL     ERR(16)       VIDMSG
089670940920     C                   SETON                                        4990
089680940824     C                   GOTO      ENDCTM
089690940824    1C                   END
089700940824     C* IM IMMISSIONE NON POSSO USARE CTM CON FLG7=S
089710940824    1C  N12§1BFG7        IFEQ      'S'
089720940824     C                   MOVEL     ERR(16)       VIDMSG
089730940920     C                   SETON                                        4990
089740940824     C                   GOTO      ENDCTM
089750940824    1C                   END
089760000911     C*
089770000919     C* POSSO USARE CTM DISK C SOLO SE TERMINAL ABILITATO
089780001106     C* NON FACCIO QUESTO CONTROLLO SE FLAG 12 = 'E'. IN QUESTO CASO
089790001106     C* INFATTI DEVE ESSERE POSSIBILE BOLLETTARE SEMPRE E SE TERMINAL
089800001106     C* NON AIBLITATO NON LO CONSIDERERO' UN DISK C
089810000904     C     §1BF12        IFNE      'N'
089820001106     C     §1BF12        ANDNE     'E'
089830000904     C     WASDKC        ANDNE     'S'
089840000904     C                   MOVEL     ERR(206)      VIDMSG
089850000904     C                   SETON                                        4990
089860000904     C                   GOTO      ENDCTM
089870000904     C                   ENDIF
089880000911     C*
089890000919     C                   MOVEL     '3C'          COD
089900000919     C                   MOVEL(P)  WKSC          KEY
089910000919     C                   CLEAR                   DS3C
089920000919     C                   EXSR      CTABEL
089930000919     C  N30              MOVEL     TBLUNI        DS3C
089940000911     C*
089950940824     C* CONTROLLO SE PREVEDE L'ASSEGNAZIONE DEI SEGNACOLLI IN AUTOMATIC
089960980424     C                   SETOFF                                       25
089970940824    1C     §1BFG6        IFEQ      'D'
089980940824     C     §1BFG6        OREQ      'I'
089990940824     C     §1BFG6        OREQ      'N'
090000940824     C                   SETON                                        25
090010940824    1C                   END
090020950504     C* SALVO IL CTM
090030950504     C                   MOVEL     WCTM          SAVCTM
090040940824     C*
090050940824     C     ENDCTM        TAG
090060940824     C   90              MOVEL     '1'           WEMFOR
090070950504     C   90              CLEAR                   SAVCTM
090080940824    0C                   ENDIF
090090940824     C                   ENDSR
090100940824     C*
090110940824     C* CONTROLLO CODICE CLIENTE -------------------------------------*
090120940824     C     CTRCCM        BEGSR
090130000201     C*
090140940825    0C     *IN19         IFEQ      *OFF
090150990610     C     WCOCCM        OREQ      'S'
090160950303     C                   SETOFF                                       02
090170020319     c                   clear                   clintw
090180940922     C                   CLEAR                   MITVLT
090190940920     C* 19 ON - MITTENTE PERSONALIZZATO
090200950209     C     WFLC          IFEQ      WLNP
090210950209     C                   SETOFF                                       14
090220020319     C                   MOVEL     §ogntw        CLIntw
090230950209     C                   ELSE
090240950209     C                   SETON                                        14
090250000201     C**
090260020306     c     wccm          ifeq      8888
090270020507     c     wccm          oreq      9999
090280020306     C                   SETON                                        9050
090290020306     C                   MOVEL     ERR(81)       VIDMSG
090300020306     C                   GOTO      ENDCCM
090310020306     c                   endif
090320051207     C* Imposto campo del codice
090330051207     C                   MOVEL     WFLC          WKSC
090340051207     C                   MOVE      WCCM          WKSC
090350051207     C*
090360000201     C* CONTROLLO SE CLIENTE DPD
090370000201     C     WFLC          CHAIN     AZORG01L      UNIORG               30
090380000201     C                   MOVEL     OG143         SAV143
090390000201     C                   MOVEL     ORGDE3        OG143
090400020319     C     §OGNTW        IFEQ      'DPD'
090410010103     C     SAVFPR        IFNE      'P'
090420010103     C     SAVFPR        ANDNE     'G'
090430010319     C     WSIDPD        ANDEQ     'S'
090440051207     c* Possibile linea diversa solo se prevista da tabella 3TR
090450150929     c****               clear                   tntb50ds
090460150929     C****               movel     wksc          b50ke2
090470051207     C*
090480150929     c****               movel     b50ke2        b50ke1
090490150929     c****               movel     'C'           b50opz
090500150929     c****               movel     wlnp          b50poa
090510150929     c****               call      'TNTB51R'
090520150929     c****               parm                    kpjba
090530150929     c****               parm                    tntb50ds
090540051207     c
090550150929     c***                if        b50err<>' '
090560150730     c* filiale cliente diversa da lnp va bene per dpd purchè entrambi
090570150730     c* i network siano dpd
090580150929     c***                if        §ogntw<>'DPD'  or *in79=*off
090590150929     c                   if        *in79=*off
090600001212     C                   SETON                                        9045
090610001212     C                   MOVEL     ERR(215)      VIDMSG
090620001212     C                   GOTO      ENDCCM
090630150730     c                   endif
090640150929     C****               ENDIF
090650051207     c
090660051207     C                   ENDIF
090670000201     C                   ENDIF
090680020319     C                   MOVEL     §OGntw        CLINTW
090690040930     c* errore se network cliente è logistica o sede
090700040930     c     clintw        ifeq      'LOG'
090710040930     c     clintw        oreq      'XXX'
090720040930     C                   SETON                                        9051
090730040930     C                   MOVEL     ERR(284)      VIDMSG
090740040930     C                   GOTO      ENDCCM
090750040930     c                   endif
090760000201     C                   MOVEL     SAV143        OG143
090770950209     C                   ENDIF
090780051207     C* Imposto campo del codice
090790051207     C                   MOVEL     WFLC          WKSC
090800051207     C                   MOVE      WCCM          WKSC
090810940928     C                   Z-ADD     KCI           CCC
090820940824     C     KACO          CHAIN     CNACO000                           30
090830940824     C* ANNULLATO
090840940921    2C  N30ACOFLG        IFEQ      '*'
090850940824     C                   SETON                                        30
090860940921    2C                   END
090870940824     C*
090880940921    2C     *IN30         IFEQ      *ON
090890940824     C                   MOVEL     ERR(22)       VIDMSG
090900940922     C                   SETON                                        9050
090910940824     C                   GOTO      ENDCCM
090920940921    2C                   ENDIF
090930940824     C* FLAG=8 NON SPEDISCE - NO BOLLE
090940130312    2C***  ACOABL        IFEQ      '8'
090950130312    2C***  ACOABL        OREQ      '*'
090960130312    2C     ACOABL        IFne      *blanks
090970940824     C                   MOVEL     ERR(23)       VIDMSG
090980940922     C                   SETON                                        9050
090990940824     C                   GOTO      ENDCCM
091000940921    2C                   END
091010941011     C*
091020941011     C                   MOVEL     ACORAG        VIDDMT
091030940824     C*
091040940921    2C     WCCM          IFNE      8888
091050940909     C     WCCM          ANDNE     9999
091060940824     C     KACO          CHAIN     CNIND000                           30
091070940921    3C     *IN30         IFEQ      *ON
091080940824     C                   MOVEL     ERR(22)       VIDMSG
091090940922     C                   SETON                                        9050
091100940921    3C                   ENDIF
091110000509     C* PER BOLLA LNP POSTE, AMMESSI SOLO CLIENTI POSTE E VICEVERSA
091120020319     c     §ogntw        ifeq      'PPT'
091130020319     c     clintw        oreq      'PPT'
091140020319     C     §ogntw        IFNE      clintw
091150000509     C                   MOVEL     ERR(200)      VIDMSG
091160000509     C                   SETON                                        9050
091170020319     c                   endif
091180000509    3C                   ENDIF
091190000509     C*
091200970703     C* CONTROLLO LA NAZIONE
091210970703     C* VISTO CHE E' UN CODIFICATO PRENDO LA DIVISA CHE MI PUO' SERVIRE
091220970703     C*  PER L'IMPORTO DA ASSICURARE O VALORE MERCE DICHIARATO
091230970703     C                   MOVEL     '15'          COD
091240970703     C                   MOVEL(P)  INDSTA        KEY
091250970703     C                   EXSR      CTABEL
091260970703     C* NAZIONE ERRATA
091270970703    3C     *IN30         IFEQ      *ON
091280970703     C                   MOVEL     ERR(28)       VIDMSG
091290970703     C                   SETON                                        9050
091300970703   X3C                   ELSE
091310970703     C                   MOVEL     TBLUNI        DS15
091320970703     C                   MOVEL     §15VLT        MITVLT
091330970703    4C     §15ITA        IFNE      'I'
091340970703     C                   MOVEL     'E'           WMITIE            1
091350970703     C                   ELSE
091360970703     C                   MOVEL     'I'           WMITIE
091370970703    4C                   ENDIF
091380970703    3C                   ENDIF
091390970704     C*
091400970704     C* controllo se esiste in anagrafica la provincia
091410970704     C* SOLO SE NAZIONE ITALIA CIOE' ='   '
091420970704     C     INDSTA        IFEQ      *BLANKS
091430970704    3C     INDPRV        ANDEQ     *BLANKS
091440970704     C                   MOVEL     ERR(128)      VIDMSG
091450970704     C                   SETON                                        9050
091460970704     C                   GOTO      ENDCCM
091470100120    3C                   ENDIF
091480970703     C*
091490970703     C* CAP OBBLIGATORIO : CONTROLLO
091500970703     C                   CLEAR                   DSSI95
091510970708     C                   CLEAR                   DSLV13
091520970703     C                   MOVEL     '3'           I95TCN
091530970703     C                   MOVEL     INDCAE        I95CAP
091540970703     C                   MOVEL     INDSTA        I95NAR
091550970703     C                   MOVEL     INDPRV        I95PRV
091560970703     C                   MOVEL     INDCIT        I95LOC
091570970714     C                   MOVEL     BLPDSP        I95DAT
091580971201     C     §3AFCA        IFNE      0
091590971201     C                   MOVEL     'S'           I95FCA
091600971201     C                   ENDIF
091610971201     C                   MOVEL     FLGTB1        I95TPO
091620970708     C* ERRORE AFFIDABILITA = 0
091630970708     C                   MOVEL     'S'           I13AF0
091640970708     C* CONTROLLO CONGRUENZA CAP PROVINCIA
091650970708     C                   MOVEL     'S'           I13CNG
091660970708     C* CONTROLLO NON FORZABILE CITTA' CON VIARIO
091670100120     C*******            MOVEL     'S'           I13CNV
091680020212     c*
091690020212     c* mittente fedex passo flag apposito per dire di prendere i dati i
091700020212     c* dalla tabella della nazione
091710020212     c     §ogntw        ifeq      'FED'
091720020212     c                   movel     'S'           i95fi1
091730020212     c                   endif
091740970703     C                   CALL      'FNLV13R'
091750970708     C                   PARM                    KPJBA
091760970708     C                   PARM                    DSLV13
091770970708     C                   PARM                    DSSI95
091780941230     C* ERRORE
091790970708     C     O13ERR        IFNE      *BLANKS
091800970708     C                   MOVEL     O13MSG        W077A            77
091810970703     C* IMPOSTO IL MESSAGGIO METTENDO VICIVO LA SCRITTA:
091820970703     C*   "SUL PIANO DEI CONTI"
091830970703     C                   CLEAR                   K78
091840970703     C                   MOVEA     W077A         K78
091850970703     C     ' '           CHECKR    W077A         WP                2 0
091860970703     C                   ADD       2             WP
091870970703     C     WP            IFLT      61
091880970703     C                   MOVEA     CPDC          K78(WP)
091890970703     C                   MOVEA     K78           VIDMSG
091900970703     C                   ELSE
091910970703     C                   MOVEL     O95MSG        VIDMSG
091920970703     C                   MOVE      CPDC          VIDMSG
091930970703     C                   ENDIF
091940940922     C                   SETON                                        9050
091950941231     C                   GOTO      ENDCCM
091960941231    3C                   ENDIF
091970941230     C* SALVO IL FLAG ANTEPORTO
091980970703     C                   MOVEL     O95ISO        COMFAP
091990970708     C                   MOVEL     O95ISO        VIDFAP
092000970708     C                   MOVEL     O95CTS        MITCTS
092010140403     C                   MOVEL     O95gf2        comgf2
092020940922     C*
092030940921    2C                   ENDIF
092040940824     C*
092050940824     C   90              GOTO      ENDCCM
092060940824     C*
092070940921     C* PER MANUTENZIONE O DISK CLI OBBLIGATORIO IL COD.CLI ORIGINALE
092080960805     C* OPPURE UN CODICE CLIENTE CON LA STESSA SERIE
092090980410    1C   12§1BFG6        IFEQ      'C'
092100940824     C     §1BFG7        OREQ      'S'
092110940909    2C     WKSC          IFNE      SAVMIT
092120100517     c
092130960805     C*
092140100517     C**                 MOVEL     '3C'          COD
092150100517     C**                 MOVEL(P)  WKSC          KEY
092160960805     C*
092170100517     C**                 EXSR      CTABEL
092180100517     C**N30              MOVEL     TBLUNI        DS3C
092190960805     C*
092200100517    3C**   *IN30         IFEQ      *ON
092210100517     C**   §3CNRS        ORNE      VIDNRS
092220980805     C* E' VALIDA LA 3C SOLO SE HA L'ASTERISCO
092230100517     C**   §3COKD        ORNE      '*'
092240100517     C**                 MOVEL     ERR(67)       VIDMSG
092250100517     C**                 SETON                                        5090
092260100517    3C**                 ENDIF
092270100517     c
092280100517     c                   clear                   trulnrsds
092290100517     c                   movel     wksc          inrsCCM
092300100517     c                   movel     vidnrs        inrsNRS
092310100517     c                   movel     wfls          inrsFLS
092320100517     c
092330100517     c                   call      'TRULNRSR'
092340100517     c                   parm                    trulnrsds
092350100517     c                   if        onrserr<>' '
092360100517     C                   MOVEL     ERR(67)       VIDMSG
092370100517     C                   SETON                                        5090
092380100517    3C                   endif
092390100517     c
092400960805    2C                   END
092410940825    1C                   END
092420940825     C*
092430940825     C   90              GOTO      ENDCCM
092440940825    0C                   ENDIF
092450940824     C*
092460940824     C* CONTROLLI CODICE BOLLA CON CODICE CLIENTE
092470940825    0C     WCBO          IFNE      *BLANKS
092480941103    1C  N04WCCM          IFEQ      9999
092490940824     C                   MOVEL     ERR(11)       VIDMSG
092500940922     C                   SETON                                        5090
092510940825    1C                   END
092520940824     C* SE ASSEGNATO
092530940909    1C   04WCCM          IFEQ      8888
092540940824     C                   MOVEL     ERR(11)       VIDMSG
092550940922     C                   SETON                                        5090
092560940825    1C                   ENDIF
092570940824     C*
092580940824     C   90              GOTO      ENDCCM
092590940825    0C                   ENDIF
092600950125     C*
092610950125     C* SE E' FRANCO NON  SI PUO' TASSARE CON TARIFFA MITTENTE
092620990720    0C  N04WCBO          IFNE      *BLANKS
092630990720     C     WFTM          ANDEQ     'S'
092640950717     C                   MOVEL     ERR(119)      VIDMSG
092650950125     C                   SETON                                        5090
092660950125     C                   GOTO      ENDCCM
092670990720    0C                   ENDIF
092680940825     C*
092690020507     C* SE 8888 O 9999
092700940909    0C     WCCM          IFEQ      8888
092710940909     C     WCCM          OREQ      9999
092720940825     C*
092730950125     C* NON E' POSSIBILE IMMETTERE TASSAZIONE CON TAR MIT
092740940825    1C     WFTM          IFEQ      'S'
092750950717     C                   MOVEL     ERR(119)      VIDMSG
092760940922     C                   SETON                                        5090
092770940825     C                   GOTO      ENDCCM
092780940825    1C                   ENDIF
092790940921     C*
092800940921     C* SE PRIMA ERA CODIFICAT E ADESSO NO PULISCO I CAMPI DEL MITTENTE
092810990720    1C     WCCM          IFNE      WCCMS
092820950125     C                   CLEAR                   V2DTEL
092830940921     C*
092840940921     C* NON PULISCO SE CAMBIATO CODICE DA 8888 A 9999 O VICEVERSA
092850020507     C     WCCMS         ifNE      9999
092860940921     C     WCCMS         ANDNE     8888
092870010213     C*
092880940921     C                   CLEAR                   VIDRSM
092890940921     C                   CLEAR                   VIDLOM
092900940921     C                   CLEAR                   VIDINM
092910940921     C                   CLEAR                   VIDCAM
092920940921     C                   CLEAR                   VIDPRM
092930940921     C                   CLEAR                   VIDNZM
092940940921     C                   CLEAR                   VIDPIM
092950940921     C                   CLEAR                   VIDFAP
092960061110     C                   CLEAR                   VIDcdf
092970020507     c
092980990720    2C                   ENDIF
092990940921     C                   MOVEL     WCCM          WCCMS
093000990720    1C                   ENDIF
093010020507     c* se richiesta bolla firmata i dati del mittente sono quelli del
093020020507     c* p.o. mittente
093030020513     c     vidcbo        ifeq      'FO'
093040020507     c     wflc          chain     azorg01l      uniorg               30
093050020507     c                   movel     orgdes        vidrsm
093060020507     c                   movel     orgind        vidinm
093070020507     c                   movel     orgcpf        vidcam
093080020507     c                   movel     orgloc        vidlom
093090020507     c                   movel     orgpro        vidprm
093100020507     c                   endif
093110000113     C* SE E' IN PERSONALIZZAZIONE, RIPROTEGGO, E PROTETTO
093120000113     C   19              SETON                                        02
093130940825     C*
093140940825   X0C                   ELSE
093150110519     c* in immissione controllo se per il cliente mittente sono
093160110519     c* presenti bolle da confermare
093170110519     c* Se ce ne sono: messaggio forzabile
093180110519    3c                   if        not *in12
093190110519     c                   exsr      sr_chkvab
093200110519     c                   if        wemfor='1'
093210110519     c                   goto      endccm
093220110519     c                   endif
093230110519    3c                   endif
093240960926     C* SE TUTTO OK E NON E' 8888 O 9999 E CLIENTE DI ALTRO P.O.
093250940921     C* PROTEGGO IL MITTENTE E MEMORIZZO I CAMPI
093260940909     C*
093270940825     C                   SETON                                        02
093280990720    1C     WPERSO        IFEQ      'P'
093290950303     C                   SETON                                        19
093300990720    1C                   END
093310940909     C                   MOVEL     ACORAG        VIDRSM
093320940909     C                   MOVEL     INDCIT        VIDLOM
093330940909     C                   MOVEL     INDVIA        VIDINM
093340941005     C                   MOVEL     INDCAE        VIDCAM
093350940909     C                   MOVEL     INDPRV        VIDPRM
093360940909     C                   MOVEL     INDSTA        VIDNZM
093370940909     C                   MOVEL     INDIVA        WISO
093380990720    1C     WISO          IFGE      '00'
093390940909     C                   MOVEL     INDIVA        VIDCPM
093400120504     C                   clear                   VIDism
093410940909     C                   ELSE
093420940909     C                   MOVEL     INDIVA        VIDPIM
093430990720    1C                   END
093440120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
093450120508     c* in contabilità crea problemi
093460120508     c                   if        *in22 and wiso='$$'
093470120508     c                   clear                   vidpim
093480120508     c                   endif
093490061110     c   22              movel     indcdf        vidcdf
093500950123     C*
093510950123     C                   MOVE      INDTEL        V2DTEL
093520950123     C                   MOVEL     'Tel.'        V2DTEL
093530940825    0C                   ENDIF
093540940824     C* OK
093550940825    0C     WPERSO        IFEQ      'P'
093560950303     C                   SETON                                        85
093570940825    0C                   END
093580990720     C                   CLEAR                   WCOCCM
093590110921     c* accedo a tabella "CLI" del cliente mittente
093600080104     c                   clear                   dcli
093610110921     c****               if        *in12 and not *in15 and
093620110921     c*****                        vidnrs>0
093630071218     c                   exsr      sr_dcli
093640110922     c****               endif
093650061110     c
093660061110     c* se no prepagato solo sottolineato il campo del codice fiscale
093670061110     c  n22              movel     ul            atrcdf
093680940824     C*
093690940824     C     ENDCCM        TAG
093700940824     C   90              MOVEL     '1'           WEMFOR
093710940824     C                   ENDSR
093720941103     C*
093730941103     C* CONTROLLO IL MITTENTE ORIGINALE ------------------------------*
093740941103     C     CTRMO         BEGSR
093750941103     C*
093760941103    0C     *IN03         IFEQ      *OFF
093770941103     C*
093780941103     C* SE IMMESSO CAP O NAZIONE IMMETTERE TUTTI E 3
093790941103    1C     WCMO          IFNE      *BLANKS
093800950206     C     WRMO          ANDEQ     *BLANKS
093810941103     C                   MOVEL     ERR(100)      VIDMSG
093820941103     C                   SETON                                        7190
093830941103     C                   GOTO      ENDCMO
093840941103    1C                   ENDIF
093850941103     C*
093860941103    1C     WNAR          IFNE      *BLANKS
093870941103    2C     WCMO          IFEQ      *BLANKS
093880941103     C     WRMO          OREQ      *BLANKS
093890941103     C                   MOVEL     ERR(100)      VIDMSG
093900941103     C                   SETON                                        7190
093910941103     C                   GOTO      ENDCMO
093920941103    2C                   ENDIF
093930941103    1C                   ENDIF
093940941103     C*
093950941103     C* CONTROLLO NAZIONE MITTENTE ORIGINALE
093960941103    1C     WNAR          IFNE      *BLANKS
093970941103     C                   EXSR      CTRNAR
093980941103    2C     WEMFOR        IFEQ      '1'
093990941103     C                   SETOFF                                       68
094000941103     C                   SETON                                        73
094010941103     C                   GOTO      ENDCMO
094020941103    2C                   END
094030950215    1C                   END
094040941103     C*
094050941103     C* CONTROLLO ESISTENZA CAP MITTENTE ORIGINALE
094060950215    1C     WCMO          IFNE      *BLANKS
094070970708     C**
094080970708     C* CAP CON VIARIO --> ERRORE FORZABILE
094090970708    2C     WCMO          IFNE      VARCMO
094100970708     C                   CLEAR                   DUE
094110970708     C                   MOVEL     WCMO          VARCMO
094120970708    2C                   ENDIF
094130970708     C**
094140970704     C                   CLEAR                   DSSI95
094150970708     C                   CLEAR                   DSLV13
094160970704     C                   MOVEL     WNAR          I95NAR
094170970704     C                   MOVEL     WCMO          I95CAP
094180970704     C                   MOVEL     '3'           I95TCN
094190970708     C* NON POSSO DARE ERRORE PER AFFIDABILITA=0 PERCHE' NON HO LA
094200970708     C*  PROVINCIA
094210970708     C                   MOVEL     'S'           I13CNV
094220970708     C                   MOVEL     'S'           I13SZV
094230970708     C                   MOVEL     DUE           E13FZV
094240970704     C                   CALL      'FNLV13R'
094250970708     C                   PARM                    KPJBA
094260970708     C                   PARM                    DSLV13
094270970708     C                   PARM                    DSSI95
094280970708     C* FLAG FORZATURA
094290970708     C                   MOVEL     E13FZV        DUE
094300941103     C*
094310941103     C* SE CAP NON TROVATO  ERRORE
094320970708    2C     O13ERR        IFNE      *BLANKS
094330970708     C                   MOVEL     O13MSG        VIDMSG
094340941103     C                   SETON                                        7290
094350941103     C                   GOTO      ENDCMO
094360970704    2C                   ENDIF
094370941103     C*
094380941103    1C                   ENDIF
094390941103     C*
094400941103     C     WPERSO        IFEQ      'P'
094410941103     C                   SETON                                        03
094420941103     C                   ENDIF
094430941103     C*
094440941103     C     ENDCMO        TAG
094450941103     C   90              MOVEL     '1'           WEMFOR
094460941103    0C                   ENDIF
094470941103     C*
094480941103     C                   ENDSR
094490940913     C*
094500940913     C* CONTROLLO CONSEGNA RICHIESTA ---------------------------------*
094510940913     C     CTRCR         BEGSR
094520940913     C*
094530940913    1C     *IN16         IFEQ      *OFF
094540971007    2C     WDCR          IFEQ      0
094550940913     C                   Z-ADD     0             COMDCR
094560940913     C* DATA
094570971007   X2C                   ELSE
094580940913     C                   Z-ADD     WDCR          G02DAT
094590940913     C                   MOVEL     *BLANKS       G02ERR
094600940913     C                   CALL      'XSRDA8'
094610941115     C                   PARM                    WLBDAT
094620941115     C* ERRORE
094630940913    3C     G02ERR        IFEQ      '1'
094640940913     C                   MOVEL     ERR(19)       VIDMSG
094650941102     C                   SETON                                        5990
094660940913     C                   GOTO      ENDCR
094670940913    3C                   END
094680940913     C*  SE CAMBIATA LA DATA CONSEGNA RICHIESTA PULISCO LA FORZATURA
094690940913    3C     G02INV        IFNE      COMDCR
094700940913     C                   MOVEL     ' '           UNO
094710030417     c                   Clear                   fordcr
094720940913    3C                   ENDIF
094730940916     C*
094740940913     C                   MOVE      G02INV        COMDCR            8 0
094750940916     C                   MOVE      G02DAT        WDCR
094760940913     C*
094770940913     C* SE < ALLA DATA SPEDIZIONE: ERRORE
094780940913    3C     COMDCR        IFLT      BLPDSP
094790940916     C                   MOVEL     ERR(19)       VIDMSG
094800941102     C                   SETON                                        5990
094810940913     C                   GOTO      ENDCR
094820940913    3C                   ENDIF
094830101022     c* Verifico che non cada in giorno festivo per "IL"
094840101022     c* In personalizzazione lo posso fare solo col calendario partenza
094850101022     c                   if        WPERSO='P' and   wtcr=' '
094860101022     c                   movel     comdcr        wdata
094870101022     C                   CLEAR                   W0030
094880101022     C     KCLN          CHAIN     AZCLN01L                           30
094890101022     C   30              CLEAR                   CLNPOM
094900101022     C                   MOVEA     CLNPOM        K31
094910101022     C                   MOVEL     K31(WGG)      WFEST
094920101022     c     wfest         lookup    S1Y                                    30
094930101022     c
094940101022    4c                   if        *in30 and wfest<>' '
094950141124     c                   select
094960141124     c                   when      v0clna=*blanks or
094970141124     c                             (a_§ogntw<>'DPD' and a_§ogntw<>'EEX'
094980141124     c                              and a_§ogntw<>'FED')
094990101022     C                   MOVEL     ERR(197)      VIDMSG
095000101022     C                   SETON                                        5990
095010101022     C                   GOTO      ENDCR
095020141124     c                   when      v0clna<>wforz_lnap
095030141124     c                   eval      wforz_lnap=v0clna
095040141124     C                   MOVEL     ERR(197)      VIDMSG
095050141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
095060141124     C                   SETON                                        5990
095070141124     C                   GOTO      ENDCR
095080141124     c                   endsl
095090101022    4c                   endif
095100101022    3c                   endif
095110940913     C*
095120940913     C* 16 ON - PERSONALIZZAZIONE
095130940913    3C     WPERSO        IFEQ      'P'
095140940913     C                   SETON                                        16
095150940913    3C                   ENDIF
095160940913    2C                   ENDIF
095170940913    1C                   ENDIF
095180030409
095190051214      **Se sono in personalizzazione controllo che la data consegna
095200051214      **richiesta non sia superiore a oggi + i giorni previsti in §vpodcg
095210051214     c***                If        Wperso = 'P' and ComDcr > woggi5
095220051214     c***                Eval      *In59 = *On
095230051214     c***                Eval      *In90 = *On
095240051214     c***                Eval      VidMsg = Err(277)
095250051214     c***                Eval      VidMsg = %trim(vidmsg) + ' ' +
095260051214     c***                          %trim(%editc(§vpodcg:'Z'))  +
095270051214     c***                          ' giorni dalla data odierna'
095280051214     c***                GoTo      EndCr
095290051214     c***                EndIf
095300051214     c* controllo che la data consegna richiesta non sia superiore a oggi +
095310051214     c* i giorni previsti in tabella VPO
095320051214     c                   if        wtcr = 'P'
095330051214     c                   z-add     woggidcgm1    s_woggidcg
095340051214     c                   z-add     §vpodcgm1     s_vpodcg
095350051214     c                   else
095360051214     c                   z-add     woggidcgm2    s_woggidcg
095370051214     c                   z-add     §vpodcgm2     s_vpodcg
095380051214     c                   endif
095390051214     c*
095400051214     c                   if        comdcr > s_woggidcg
095410051214     c                   Eval      *In59 = *On
095420051214     c                   Eval      *In90 = *On
095430051214     c                   Eval      VidMsg = Err(277)
095440051214     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
095450051214     c                             %trim(%editc(s_vpodcg:'Z'))  +
095460051215     c                             ' giorni dalla data odierna.'
095470051214     c                   GoTo      EndCr
095480051214     c                   endif
095490030416
095500030416      * Controllo che la data consegna richiesta non sia superiore a oggi + 1 mm
095510051214     c*                  If        ComDcr > woggi1m
095520051214     c*                            and fordcr = *Blanks
095530051214     c*                  Eval      *In59 = *On
095540051214     c*                  Eval      *In90 = *On
095550051214     c*                  Eval      VidMsg = Err(1)
095560051214     c*                  Eval      fordcr = '1'
095570051214     c*                  GoTo      EndCr
095580051214     c*                  EndIf
095590030409
095600940913     C* ORA
095610940920    1C     *IN23         IFEQ      *OFF
095620940913     C*
095630150202    2C***  WHCR          IFLT      0
095640150202     C***  WHCR          ORGT      24
095650150203     c                   if        whcr>0  or wmcr>0
095660150202    2C     WHCR          IFLT      08
095670150202     C     WHCR          ORGT      20
095680940913     C                   MOVEL     ERR(20)       VIDMSG
095690960319     C                   SETON                                        6090
095700940913     C                   GOTO      ENDCR
095710940913    2C                   ENDIF
095720150202    2C                   ENDIF
095730940913     C*
095740940913    2C     WMCR          IFLT      0
095750940913     C     WMCR          ORGT      59
095760940913     C                   MOVEL     ERR(20)       VIDMSG
095770960319     C                   SETON                                        6090
095780940913     C                   GOTO      ENDCR
095790940913    2C                   ENDIF
095800150203     c*
095810150203     c                   if        whcr=20 and wmcr>0
095820150203     C                   MOVEL     ERR(20)       VIDMSG
095830150203     C                   SETON                                        6090
095840150203     C                   GOTO      ENDCR
095850150203     c                   endif
095860150203
095870940916     C* PERSONALIZZAZIONE
095880940913    2C     WPERSO        IFEQ      'P'
095890941102    3C     WHCR          IFNE      0
095900941102     C     WMCR          ORNE      0
095910940920     C                   SETON                                        23
095920940913    3C                   ENDIF
095930940913    2C                   ENDIF
095940940913     C*
095950941102     C* SE IMMESSO TIPO DEVO IMMETTERE ANCHE ORA O DATA
095960941005    2C     WTCR          IFNE      ' '
095970941102     C*
095980941102    3C     WDCR          IFEQ      0
095990941102     C     WHCR          ANDEQ     0
096000941102     C     WMCR          ANDEQ     0
096010941102     C                   MOVEL     ERR(43)       VIDMSG
096020941102     C                   SETON                                        5990
096030941102     C                   GOTO      ENDCR
096040941102    3C                   ENDIF
096050941102     C*
096060941102    3C     WPERSO        IFEQ      'P'
096070940913     C                   SETON                                        17
096080941102    3C                   ENDIF
096090941005    2C                   ENDIF
096100941005    1C                   ENDIF
096110940913     C*
096120940916     C     ENDCR         ENDSR
096130900427     C*
096140900427     C* CONTROLLO DATI FORMATO1 --------------------------------------
096150020531     C     CTRD01        BEGSR
096160961111     C                   SETOFF                                       953976
096170000915     C                   SETOFF                                       33
096180941003     C                   CLEAR                   WEMFOR
096190010412     C                   CLEAR                   WEFORM
096200941115     C                   CLEAR                   VIDMSG
096210070323     c                   if        *in12='0' or *in15='1'
096220070322     c                   clear                   wparcel
096230070323     c                   endif
096240950127     C***
096250950127     C*** ESEGUO RICERCA ALFABETICA
096260950127     C                   MOVEL     VIDCCM        WCCM
096270950209     C                   MOVEL     VIDLNP        WLNP
096280950127     C     VIDFLC        IFNE      0
096290950127     C                   Z-ADD     VIDFLC        WFLC
096300950127     C                   ELSE
096310950127     C                   Z-ADD     VIDLNP        WFLC
096320950127     C                   ENDIF
096330950127     C                   MOVEL(P)  VIDDMT        PAXDMT
096340950127     C                   EXSR      RICALF
096350950127     C                   MOVEL     WCCM          VIDCCM
096360050215     C                   MOVEL(p)  PAXDMT        VIDDMT
096370950127     C     *IN14         IFEQ      *ON
096380950127     C                   MOVEL     WFLC          VIDFLC
096390950127     C                   ENDIF
096400010216     C     WEMFOR        IFEQ      '1'
096410010216     C                   GOTO      ENDC01
096420010216     C                   ENDIF
096430970925     C***
096440160223     c*** DATA SPEDIZIONE ***
096450970925     C                   EXSR      CTRDSP
096460970925     C   90              GOTO      ENDC01
096470950208     C***
096480950208     C*** LINEA PARTENZA ***
096490950208     C                   MOVEL     VIDLNP        WLNP
096500950208     C                   EXSR      CTRLNP
096510950208     C   90              GOTO      ENDC01
096520991206      *
096530991206      * PER LNP DPD OBBLIGATORIO 1 COLLO
096540020319     C     §OGNTW        IFEQ      'DPD'
096550000509     C     V1CNCL        ANDNE     1
096560991206     C                   SETON                                        6290
096570991206     C                   MOVEL     ERR(178)      VIDMSG
096580991206     C                   GOTO      ENDC01
096590000509     C                   ENDIF
096600010212     C***
096610010212     C*** NUMERO O.R.M.
096620010212     C*
096630010212     C* Controllo solo se attivata procedura O.R.M.
096640010212     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
096650010212     c* fine dell'immissione
096660010212     C     WORM          IFEQ      'S'
096670010212     C     PARTCH        ANDNE     'P'
096680010213     C                   Z-ADD     VIDPOE        WOPOE
096690010213     C                   Z-ADD     VIDNOR        WONOR
096700010213     C                   Z-ADD     VIDNRV        WONRV
096710010213     C                   Z-ADD     VIDLNP        WOLNP
096720010212     C                   EXSR      CTRORM
096730010212     C   90              GOTO      ENDC01
096740010216     C     WEMFOR        IFEQ      '1'
096750010216     C                   GOTO      ENDC01
096760010216     C                   ENDIF
096770010212     C* Propongo campi da O.R.M. se non immessi da utente
096780010212     C* ** Solo se orm non è fittizio **
096790010212     C     FLGFIT        IFEQ      *BLANKS
096800010215     C                   EXSR      PRPOR1
096810010213     C   90              GOTO      ENDC01
096820010212     c* Se ho proposto dei campi non continuo i controlli ma devo
096830010212     c* riemettere videata per visualizzare i dati aggiunti
096840050119     c* idem se richiesto espressamente di non continuare i controlli
096850010212     C     WEFORM        IFEQ      '1'
096860050119     c     wsolo_prp     oreq      '1'
096870040915     c* posizionamento cursore su cod mittente dopo proposte campi da orm
096880040915     c* se però cod.mittente personalizzato mi posiziono su n.ro colli
096890041108     c**** *in19         ifeq      *off
096900041108     c**** *in85         andeq     *off
096910041108     c**** *in38         andeq     *off
096920041108     c****               z-add     12            h1riga
096930041108     c****               z-add     24            h1colo
096940041108     c****               else
096950041129     c     *in38         ifeq      *off
096960041108     c**** *in19         ifeq      *on
096970041108     c**** *in85         oreq      *on
096980040915     c                   z-add     13            h1riga
096990040915     c                   z-add     20            h1colo
097000040915     c                   endif
097010041108     c*****              endif
097020041108     c*****              endif
097030050321     c                   eval      weform = '1'
097040010212     C                   GOTO      ENDC01
097050010212     C                   ENDIF
097060010212     C                   ENDIF
097070010212     C                   ENDIF
097080010227     C* SE PREMUTO F8 MA PROC.ORM NON ATTIVATA RIEMETTO LA VIDEATA
097090010227     C   KH              MOVEL     '1'           WEMFOR
097100010227     C   KH              GOTO      ENDC01
097110940920     C***
097120940920     C*** SIGLA OPERATORE ***
097130940920     C* CONTROLLO SOLO SE NON E' PROTETTO
097140941011     C     *IN13         IFEQ      *OFF
097150940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
097160940920     C                   MOVEL     '3M'          COD
097170940920     C                   MOVEL(P)  VIDSOP        KEY
097180940920     C                   EXSR      CTABEL
097190940920     C     *IN30         IFEQ      *OFF
097200950713     C     VIDSOP        OREQ      ' '
097210940920     C                   MOVEL     ERR(29)       VIDMSG
097220940923     C                   SETON                                        4290
097230940920     C                   GOTO      ENDC01
097240940920     C                   ENDIF
097250940920     C                   ENDIF
097260940823     C***
097270990628     C*** DATA RITIRO MERCE E PRESTAZIONE M/P ***
097280020131     C                   EXSR      CTRDRT
097290940920     C   90              GOTO      ENDC01
097300940823     C***
097310960926     C*** CODICE AUTOTRASPORTATORE ***
097320940824     C                   MOVEL     VIDPDR        WPDR
097330940824     C                   EXSR      CTRPDR
097340940824     C                   MOVEL     WPDR          VIDPDR
097350940824     C     WEMFOR        IFEQ      '1'
097360940920     C                   GOTO      ENDC01
097370940824     C                   ENDIF
097380940823     C***
097390921006     C*** NUMERO SPEDIZIONE ***
097400990602     C  N12PARTCH        IFEQ      'R'
097410921006     C     RECNSP        ANDEQ     0
097420940823     C                   MOVEL     ERR(33)       VIDMSG
097430940923     C                   SETON                                        6190
097440940920     C                   GOTO      ENDC01
097450921006     C                   END
097460950127     C***
097470950127     C*** NUMERO COLLI ***
097480950127     C     V1CNCL        IFEQ      0
097490950127     C                   MOVEL     ERR(34)       VIDMSG
097500950127     C                   SETON                                        6290
097510950127     C                   GOTO      ENDC01
097520950127     C                   END
097530950127     C***
097540950127     C*** PESO   ***
097550950127     C* LO CONTROLLO SOLO IN SECONDA VIDEATA SE CARICAMENTO DISK  CLI
097560950127     C* >< DA 0
097570980402     C*
097580980402     C* OBBLIGATORIO
097590950127     C  N12VIDPKG        IFEQ      0
097600950127     C                   MOVEL     ERR(46)       VIDMSG
097610950127     C                   SETON                                        6390
097620950127     C                   GOTO      ENDC01
097630950127     C                   ENDIF
097640980402     C*
097650980402     C* NON MAGGIORE DEL LIMITE POSTO (forzabile)
097660090609     C* N12VIDPKG        IFGT      §QTPKB
097670090609     C*    VIDPKG        ANDNE     SAVPKG
097680090609     C*                  MOVE      VIDPKG        SAVPKG
097690090609     C*                  CLEAR                   WPT1
097700980623     C* PREPARO MSG
097710090609     C*                  MOVEA     ERR(52)       K78
097720090609     C*                  MOVEL     §QTPKB        W006A             6
097730090609     C*                  MOVEA     W006A         SKI(10)
097740090609     C*                  Z-ADD     10            I                 3 0
097750090609     C*                  EXSR      ABBL
097760090609     C*                  MOVEA     SKI(10)       K78(34)
097770090609     C*                  MOVE      §QTPKB        W001A
097780090609     C*                  MOVEL     W001A         K78(41)
097790090609     C*                  MOVEA     K78           VIDMSG
097800090609     C*                  SETON                                        6390
097810090609     C*                  GOTO      ENDC01
097820090609     C*                  ENDIF
097830940823     C***
097840940823     C*** CODICE BOLLA ***
097850940824     C                   MOVEL     VIDCBO        WCBO
097860940824     C                   EXSR      CTRCBO
097870940824     C                   MOVEL     WCBO          VIDCBO
097880940824     C     WEMFOR        IFEQ      '1'
097890940920     C                   GOTO      ENDC01
097900940824     C                   ENDIF
097910940929     C***
097920940929     C*** CODICE MITTENTE ***
097930940929     C                   MOVEL     VIDFTM        WFTM
097940940929     C                   MOVEL     VIDCCM        WCCM
097950940929     C     VIDFLC        IFNE      0
097960940929     C                   Z-ADD     VIDFLC        WFLC
097970940929     C                   ELSE
097980940929     C                   Z-ADD     VIDLNP        WFLC
097990941108     C                   ENDIF
098000940929     C                   EXSR      CTRCCM
098010941011     C                   MOVEL     WCCM          VIDCCM
098020941011     C     *IN14         IFEQ      *ON
098030941011     C                   MOVEL     WFLC          VIDFLC
098040941011     C                   ENDIF
098050941011     C*
098060940929     C     WEMFOR        IFEQ      '1'
098070940929     C                   GOTO      ENDC01
098080940929     C                   ENDIF
098090940823     C***
098100940823     C*** TIPO SERVIZIO ***
098110940824     C                   MOVEL     VIDTSP        WTSP
098120940929     C                   EXSR      CTRTSP
098130940929     C                   MOVEL     WTSP          VIDTSP
098140940824     C     WEMFOR        IFEQ      '1'
098150940920     C                   GOTO      ENDC01
098160940824     C                   ENDIF
098170940823     C***
098180940823     C*** CODICE TRATTAMENTO MERCE ***
098190940824     C*
098200940824     C* SE CODICE BOLLA PREVEDE IL CODICE TRATTAMENTO MERCE QUESTO
098210940824     C* PREVALE SUL CODICE DELL'ANAGRAFICA E SU QUELLO DIGITATO
098220940824     C     §3ACTM        IFNE      *BLANKS
098230940929     C                   MOVEL     §3ACTM        WCTM
098240940824     C                   ELSE
098250940824     C* SE NON IMMESSO PRENDO VALORE DI DEFAULT
098260940824     C     VIDCTM        IFEQ      *BLANKS
098270940929     C                   MOVEL     COMCTM        WCTM
098280940929     C                   ELSE
098290940929     C                   MOVEL     VIDCTM        WCTM
098300940824     C                   ENDIF
098310940824     C                   ENDIF
098320940824     C*
098330940824     C* CONTROLLO
098340950504     C                   CLEAR                   W003A
098350940929     C                   MOVEL     WCTM          W003A
098360940824     C                   EXSR      CTRCTM
098370940929     C* SCRIVO IL CTM SOLO SE AVEVO DIGITATO UN '?'
098380941005     C* SE IMPOSTO QUELLO DI DFT NON LO FACCIO VEDERE A VIDEO
098390940929     C     '?'           SCAN      W003A                                  30
098400940929     C     *IN30         IFEQ      *ON
098410940824     C                   MOVEL     WCTM          VIDCTM
098420940929     C                   ENDIF
098430940824     C     WEMFOR        IFEQ      '1'
098440940920     C                   GOTO      ENDC01
098450940824     C                   ENDIF
098460121106
098470121106     c* Non posso utilizzare un CTM che mantiene in numero di spedizione
098480121106     c*  se = 0
098490121106     C   12
098500121106    1Can 15§1BFG3        IFEQ      'S'
098510121106     c     vidnsp        andeq     0
098520121106     C                   MOVEL     ERR(72)       VIDMSG
098530121106     c                   eval      %subst(vidmsg:20:2)=vidctm
098540121106     C                   SETON                                        4990
098550121106     C                   GOTO      ENDC01
098560121106    1C                   END
098570940824     C*
098580910828     C* SE FLAG6=M O C  OBBLIGATORIA LA LINEA DI ARRIVO
098590910828     C     §1BFG6        IFEQ      'M'
098600910828     C     §1BFG6        OREQ      'C'
098610921019     C     §1BFG8        ANDNE     'N'
098620940823     C*
098630910828     C     VIDLNA        IFEQ      *BLANKS
098640910828     C     VIDLNA        OREQ      *ZEROS
098650940823     C                   MOVEL     ERR(14)       VIDMSG
098660940923     C                   SETON                                        4790
098670940920     C                   GOTO      ENDC01
098680910828     C                   END
098690910828     C                   END
098700081107     c* controllo la congruenza fra codice bolla e il codice trattamento merce
098710081107     c                   exsr      ctrcbo_ctm
098720081107     C     *in90         IFEQ      '1'
098730081107     C                   GOTO      ENDC01
098740081107     C                   ENDIF
098750910828     C*
098760910828     C* PER DISK CLI CONTROLLO ESISTENZA DETTAGLIO SEGNACOLLI X FLG7=S
098770950718     C   15
098780950718     CAN 12§1BFG7        IFEQ      'S'
098790020917     C     KBLC          SETLL     FIVAD000                               30
098800940823     C     *IN30         IFEQ      *OFF
098810940823     C                   MOVEL     ERR(37)       VIDMSG
098820940923     C                   SETON                                        6290
098830940920     C                   GOTO      ENDC01
098840970107     C                   ENDIF
098850950717     C* SE SEGNACOLLI DA CLIENTE, CONTROLLO CHE NON CI SIANO SEGNACOLLI
098860950717     C*  RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
098870950719     C     §1BFG6        IFEQ      'C'
098880980325     C                   EXSR      VADDOP
098890950717     C   90              GOTO      ENDC01
098900940823     C                   ENDIF
098910950719     C                   ENDIF
098920040601     C* PER DISK CLI CONTROLLO ESISTENZA estensione stmpa ddt x FLG16=S
098930040601     C   15
098940040603    1CAN 12§1BF16        IFEQ      'S'
098950130301     c                   clear                   wvax
098960130301     c                   clear                   wvatp
098970130301     C     KBLC          SETLL     FIVAX000
098980130301    2c                   if        %equal(fivax01l)
098990130301     c                   eval      wvax='S'
099000130301    2c                   endif
099010130301     C                   MOVEL     'P'           WTRC
099020130301     C     Kvat          SETLL     FIVAt000
099030130301    2C                   if        %equal(fivat01l)
099040130313     c* cliente abilitato al pdf: memkorizzo presenza pdf
099050130313     c                   eval      wvatp='S'
099060130313     c* cliente non abilitato alla gestione del PDF:
099070130313     c* memorizzo per l'invio mail di alert
099080130313     c                   if        §clipdfp=*blanks
099090130313     c                   eval      wvatpe='S'
099100130313     c                   endif
099110130301    2c                   endif
099120130301    2c                   if        wvax=*blanks and wvatp=*blanks
099130040601     C                   MOVEL     ERR(279)      VIDMSG
099140040601     C                   SETON                                        6290
099150040601     C                   GOTO      ENDC01
099160130313     c                   else
099170130313     c* cliente non abilitato al PDF
099180130313     c                   if        wvatp='S' and §clipdfp=*blanks
099190130313     C                   MOVEL     ERR(349)      VIDMSG
099200130313     C                   SETON                                        4990
099210130313     C                   GOTO      ENDC01
099220130313     c                   endif
099230040603    2C                   ENDIF
099240130301   2ac                   if        wvax='S'
099250040603     c                   clear                   s_vaxprr
099260040603    2c                   do        *hival
099270061010     c     kblc          reade(N)  fivax000
099280040603    3c                   if        %eof(fivax01l)
099290040603     c                   leave
099300040603    3c                   endif
099310040603    3c                   if        vaxprr = s_vaxprr
099320040603     C                   MOVEL     ERR(280)      VIDMSG
099330040603     c                   seton                                        6290
099340040603     C                   GOTO      ENDC01
099350040603   x3c                   else
099360040603     c                   eval      s_vaxprr=vaxprr
099370040603    3c                   endif
099380040603    2c                   enddo
099390041210     c* controllo esistenza logo su tabella ar8
099400041210     C                   CLEAR                   DSBS02
099410041210     C                   MOVEL     'C'           T02MOD
099420041210     C                   MOVEL     KNSIF         T02SIF
099430041210     C                   MOVEL     'AR8'         T02COD
099440041210     C                   MOVEL(P)  vaxtmd        T02KE1
099450041210      *
099460041210     C                   CALL      'TIBS02R'
099470041210     C                   PARM                    KPJBA
099480041210     C                   PARM                    DSBS02
099490041210      *
099500041210     C     T02ERR        IFne      *BLANKS
099510041210     C                   MOVEL     ERR(290)      VIDMSG
099520041210     c                   eval      vidmsg = %trim(vidmsg) + ' "' + vaxtmd + '" '
099530041210     c                             + 'per stampa Lettera di vettura.AVVISARE IL'
099540041210     c                             + ' CED'
099550041210     c                   seton                                        90
099560041210     C                   GOTO      ENDC01
099570041210     c                   endif
099580130301   2ac                   endif
099590130305     c* controlli pdf: verifico che non sia doppio negli ultimi 30gg
099600130304     c                   if        wvatp='S'
099610130304     c                   exsr      pdfdop
099620130304     c                   if        *in90
099630130304     C                   goto      ENDC01
099640130304     c                   endif
099650130301     c                   endif
099660040603    1C                   ENDIF
099670050221     c
099680970904     C**
099690970904     C* IN MANUTENZIONE NON SI PUO' VARIARE COLLI PER DISK CLIENTI B
099700050429     C   12
099710050429     CANN15V1CNCL        IFNE      SAVNCL
099720050429     C     §1BFG6        andeq     'C'
099730050429     C     §1BFG2        ANDEQ     'S'
099740050429     C                   MOVEL     ERR(69)       VIDMSG
099750050429     C                   SETON                                        6290
099760050429     C                   GOTO      ENDC01
099770050429     C                   ENDIF
099780940823     C***
099790940823     C*** LINEA ARRIVO ***
099800910805     C* IN MANUTENZIONE NON POSSO VARIARE LA LINEA PER DISK CLIENTI B
099810100210     c*  ES 10/02/10 parlando con Luciano ci sembrava non corretto far
099820100210     c*     modificare la data anche in conferma. Per evitare errori
099830100210     c*     anche dovuti al fatto che per servizio  H non ci può essere incongru
099840100210     c*     enza, metto il messaggio anche per la conferma
099850100210     c
099860100210     C*  12
099870100210     C*NN15§1BFG6        IFEQ      'C'
099880100210
099890100210     C   12§1BFG6        IFEQ      'C'
099900940928     C     SAVLNA        ANDNE     VIDLNA
099910071220     c     §clidkb       andne     'S'
099920100210     c     savlna        andgt     *zeros
099930940823     C                   MOVEL     ERR(13)       VIDMSG
099940940923     C                   SETON                                        4790
099950940920     C                   GOTO      ENDC01
099960910805     C                   END
099970020320     c* Non posso variare la linea di arrivo anche in base a §1bf14
099980020320     c   12
099990020320     cANN15§1bf14        ifeq      'S'
100000020320     C     SAVLNA        ANDNE     VIDLNA
100010020320     C                   MOVEL     ERR(249)      VIDMSG
100020020320     C                   SETON                                        4790
100030020320     C                   GOTO      ENDC01
100040020320     C                   END
100050970414     C* SE BOLLA DIROTTATA POSSO VARIARLA SOLO SE NON HO TRASMESSO
100060970414     C*  il LEGAME BOLLA
100070970414     C   12
100080970414     CANN15SAVLNA        IFNE      VIDLNA
100090970414     C     KBLP3         CHAIN(N)  FNLBL000                           32
100100970724     C  N32LBLFT1        IFNE      ' '
100110970414     C     LBLFT2        ORNE      ' '
100120970414     C                   MOVEL     ERR(141)      VIDMSG
100130970414     C                   SETON                                        4790
100140970414     C                   GOTO      ENDC01
100150970414     C                   END
100160970724     C* SE C'E' LEGAME BOLLA NON POSSO METTERE  L.ARRIVO=L.PARTENZA
100170970724     C  N32              MOVEL     VIDLNP        W003A
100180970724     C  N32W003A         IFEQ      VIDLNA
100190970724     C                   MOVEL     ERR(83)       VIDMSG
100200970724     C                   SETON                                        4790
100210970724     C                   GOTO      ENDC01
100220970724     C                   END
100230970414     C                   END
100240940824     C*
100250940824     C                   MOVEL     VIDLNA        WLNA
100260110217     C                   EXSR      CTRLNA_vid
100270940824     C                   MOVEL     WLNA          VIDLNA
100280940824     C     WEMFOR        IFEQ      '1'
100290940920     C                   GOTO      ENDC01
100300940824     C                   ENDIF
100310060707     c*
100320060707     c* Non posso variare la lna passando da lna non dpd a lna dpd
100330060707     c   12
100340060707     cann15savlna        ifne      vidlna
100350060707     c     savaogntw     andne     A_§ogntw
100360060707     c     A_§ogntw      andeq     'DPD'
100370060707     C                   MOVEL     ERR(305)      VIDMSG
100380060707     C                   SETON                                        4790
100390060707     C                   GOTO      ENDC01
100400060707     c                   endif
100410071220     c* Disk "B" - non posso variare la linea se:
100420071220     c                   if        *in12 and not *in15  and
100430071220     c                             §1bfg6='C' and savlna<>vidlna
100440071220     c                   exsr      sr_chkabilna
100450071221     c                   if        *in90
100460071221     c                   goto      endc01
100470071221     c                   endif
100480061124     c*
100490071220     c                   endif
100500061124     C* PER DISK A CON VAT OPPURE PER DISK C EX DISK B  CONTROLLO
100510061124     C* ESISTENZA CODICI CHI SONO
100520061124     C* IDEM SE SONO IN MANTUENZIONE
100530061124     C     A_§OGNTW      IFEQ      'DPD'
100540061124     C     VIDDPD        OREQ      'D'
100550061124     C                   MOVEL     'S'           WEXDPD            1
100560061124     C                   ELSE
100570061124     C                   CLEAR                   WEXDPD
100580061124     C                   ENDIF
100590061124     C*
100600160226     c* Disk A con VAT non DPD
100610160226     c                   if        (§1bf12='E' and wexdpd<>'S' and *in79=*off)
100620160226     c                             or
100630160226     c* Disk A con VAT export dpd con numero parcel automatico
100640160226     c                             (§1bf12='E' and wexdpd='S' and §1bf13='A')
100650160226     c                             or
100660160226     c* Dsik C ex disk B
100670160226     c                             (§1bf12='B')
100680160226     c                             or
100690160226     c* Manutenzione: Disk C (di qualunque tipo) no DPD
100700160226     c                             (*in12 and *in15=*off and
100710160226     c                              §1bf12<>'N' and wexdpd<>'S' and not *in79)
100720160226     c                             or
100730160226     c* Manutenzione: Disk C (di qualunque tipo) export dpd
100740160226     c* Con parcel automatico o instradamento forzato a dpd con parcel autom
100750160226     c                             (*in12 and *in15=*off and
100760160226     c                              §1bf12<>'N' and wexdpd='S' and (
100770160226     c                              §1bf13='A' or w_adpd='S'))
100780070323     c*  Per bolla export dpd con parcel  lungo 12 bypasso questo con-
100790070323     c*  trollo che non funzionerebbe
100800061124      * se non ho superato i 500 colli
100810061124If  2c                   If        v1cncl <= 500
100820061124     C* CONTROLLO CHE NON CI SIANO SEGNACOLLI
100830061124     C*                         RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
100840061124     C* CONTEGGIO ANCHE N° RECORD "CHI SONO" PERCHE' DEVE ESSERE = AL
100850061124     C* NUMERO DEI COLLI
100860061124     C* PASSO A ROUTINE UN FLAG PER SEGNALARE CHE E' RICHIAM.DA CTRD01
100870061124     C                   MOVEL     'C'           WC01FG            1
100880061124     C                   EXSR      CTRS08
100890061124     C   90              MOVEL     W08MSG        VIDMSG
100900061124     C   90              SETON                                        62
100910061124     C   90              GOTO      ENDC01
100920061124   x2c                   Else
100930061124     c                   Eval      VidMsg = Err(275)
100940061124     c                   Eval      *In90 = *On
100950061124     c                   Eval      *In62 = *On
100960061124     c                   GoTo      EndC01
100970061124    2c                   EndIf
100980061124     C                   ENDIF
100990061124     c* se sono in conferma bolle da disk di bolla dpd errore se
101000061124     c* il cliente mi ha passato più di un VAT
101010061124     c                   if        *in12 and *in15 and §1bf12 = 'E'
101020061124     c                             and werrvat = '1'  and
101030061124     c                             ((§1bf13 = *blanks and wexdpd = 'S')
101040061124     c                              or (*in79 = *on))
101050061124     c                   Eval      VidMsg = Err(291)
101060061124     c                   Eval      *In90 = *On
101070061124     c                   Eval      *In62 = *On
101080061124     c                   GoTo      EndC01
101090061124     c                   endif
101100960320     C*
101110960320     C* PER LNA 102 OBBLIGATORIO IL C/S
101120960320     C     COMLNA        IFEQ      102
101130960320     C     §3ARBL        ANDNE     'C'
101140960320     C                   SETON                                        4690
101150960320     C                   MOVEL     ERR(126)      VIDMSG
101160960320     C                   GOTO      ENDC01
101170960320    3C                   ENDIF
101180000609     C**
101190060109     C* PER BOLLA EXPORT DPD, NON POSSO ACCETTARE SOLUZIONI "B" se ctm
101200060109     c* che non prevede l'assegnazione automatica del "chi sono DPD"
101210000609     C   15
101220000609     CAN 12§1BFG6        IFEQ      'C'
101230000609     C     §1BFG2        ANDEQ     'S'
101240060109     c     §1bf13        andne     'A'
101250020319     C     A_§OGNTW      IFEQ      'DPD'
101260020204     C     VIDDPD        OREQ      'D'
101270060109     C                   MOVEL     ERR(296)      VIDMSG
101280000609     C                   SETON                                        6290
101290000609     C                   GOTO      ENDC01
101300000609     C                   ENDIF
101310000609     C                   ENDIF
101320061121     c*
101330080411     c* 11/04/2008: Asterisco i seguenti controlli perchè li ho spostat
101340080411     c* dentro la CTRIND
101350061121     C* VERIFICO SE P.O. EMITTENTE DPD o fed-ex
101360080411     c***                clear                   poentw
101370080411    2C***  FLGFIT        IFNE      'S'
101380080411     C***  ORMPOE        CHAIN     AZORG01L      UNIORG               30
101390080411     C***                MOVEL     OG143         SAV143
101400080411     C**N30              MOVEL     ORGDE3        OG143
101410080411     C** 30              CLEAR                   OG143
101420080411     c**                 eval      poentw=§ogntw
101430080411     C**                 MOVEL     SAV143        OG143
101440080411    2C***                ENDIF
101450010503     C* SE BOLLA EXPORT DPD IN PORTO ASSEGNATO DEVE ESSERE ASSOCIATA AD
101460010503     C* UN ORM REALE COMMISSIONATO DA UN P.O. DPD
101470020207     c* IDEM PER BOLLA FEDEX
101480010508     C* NON FACCIO QUESTO CONTROLLO SE PGM RICHIAMATO DA PGM GIACENZE
101490020527     c* o da ritiri annullati (savfpr="T")
101500080411    0c***  *in04         ifeq      *on
101510080411     c***                clear                   pofed             1
101520080411     c***                clear                   podpd             1
101530080411     C***                MOVEA     ERR(229)      K78
101540080411    1C***  A_§OGNTW      IFEQ      'DPD'
101550080411     C***  VIDDPD        OREQ      'D'
101560080411     c***                movel     '1'           podpd
101570080411     C***                MOVE      'DPD  '       W005A             5
101580080411     C***                MOVEA     W005A         K78(14)
101590080411     C***                MOVEA     W005A         K78(71)
101600080411     c***                endif
101610080411     c***  A_§ogntw      ifeq      'FED'
101620080411     c***  viddpd        oreq      'F'
101630080411     c***                movel     '1'           pofed
101640080411     C***                MOVE      'FedEx'       W005A             5
101650080411     C***                MOVEA     W005A         K78(14)
101660080411     C***                MOVEA     W005A         K78(71)
101670080411     c***                endif
101680040907     c*
101690080411     c***                clear                   wnocont
101700040907     c* Se provengo da manutenzione di bolla di reso lo memorizzo
101710040907     c* per non effettuare il controllo seguente
101720080411     c***  *in12         ifeq      *on
101730080411     c***  *in15         andeq     *off
101740080411     c***  vidfbr        andeq     'S'
101750080411     c***                move      'N'           wnocont           1
101760080411     c***                endif
101770020131     c
101780080411    1C**   podpd         IFEQ      '1'
101790080411     c**   pofed         oreq      '1'
101800080411   1AC**   SAVFPR        IFNE      'P'
101810080411     C*    SAVFPR        ANDNE     'G'
101820080411     C*    SAVFPR        ANDNE     'T'
101830080411     c*    wnocont       andeq     *blanks
101840080411    2C*    FLGFIT        IFEQ      'S'
101850080411     C*    poentw        ORNE      'DPD'
101860080411     c*    podpd         andeq     '1'
101870080411     C*    poentw        ORNE      'FED'
101880080411     c*    pofed         andeq     '1'
101890080411     C*                  MOVEA     K78           VIDMSG
101900080411     C*                  SETON                                        90
101910080411    3C*    WPERSO        IFEQ      'P'
101920080411     C*                  Z-ADD     05            H0RIGA
101930080411     C*                  Z-ADD     20            H0COLO
101940080411     C*                  ELSE
101950080411     C*                  Z-ADD     06            H1RIGA
101960080411     C*                  Z-ADD     20            H1COLO
101970080411    3C*                  ENDIF
101980080411     C*                  GOTO      ENDC01
101990080411    2C*                  ENDIF
102000080411   1AC*                  ENDIF
102010080411    1C*                  ENDIF
102020080411    0c*                  endif
102030940823     C***
102040940823     C*** DESTINATARIO  ***
102050001121      ***
102060001121      * ALLINEO A SX LA LOCALITA'
102070001121     C     VIDLOD        IFNE      *BLANKS
102080001121     C                   MOVEL     VIDLOD        W001A
102090001121     C     W001A         IFEQ      *BLANKS
102100001121     C                   MOVEA     VIDLOD        K35
102110001121     C     ' '           CHECK     VIDLOD        XX
102120001121     C                   CLEAR                   VIDLOD
102130001121     C                   MOVEA     K35(XX)       VIDLOD
102140001121     C                   ENDIF
102150001121     C                   ENDIF
102160130923     c* controllo dei caratteri
102170130923     c                   eval      wtxt=vidrsd
102180131003     c                   eval      uppercase = '1'
102190141202     c                   clear                   ElencoChar
102200160112     c                   clear                   TipoElenco
102210130923     c                   exsr      sr_chk
102220130923     c                   movel     wtxt          vidrsd
102230130923     c                   eval      wtxt=vidind
102240131003     c                   eval      uppercase = '1'
102250141202     c                   clear                   ElencoChar
102260160112     c                   clear                   TipoElenco
102270130923     c                   exsr      sr_chk
102280130923     c                   movel     wtxt          vidind
102290130923     c                   eval      wtxt=vidlod
102300131003     c                   eval      uppercase = '1'
102310141202     c                   clear                   ElencoChar
102320160112     c                   clear                   TipoElenco
102330130923     c                   exsr      sr_chk
102340160112     c* eseguo routine per eliminare caratteri non ammessi nella località come
102350160112     c* da tabella "CSP"
102360160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
102370160112     c                   clear                   uppercase
102380160112     c                   eval      ElencoChar=Charnook
102390160112     c                   eval      TipoElenco='1'
102400160112     c                   exsr      sr_chk
102410140207     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
102420140207     c* seguenti la località
102430140207     c                   exsr      chkstringa
102440140110     c                   movel     wtxt          vidlod
102450140113     c* segnalo errore se località contenente caratteri di punteggiatura
102460140113     c* a destra e/o a sinistra
102470140207     c***                if        vidlod<>*blanks
102480140207     c***                exsr      chkstringa
102490140207     c***                if        posl=0 or wtxt<>%subst(wtxt:posl:lung)
102500140207     C***                MOVEL     ERR(350)      VIDMSG
102510140207     C***                SETON                                        6690
102520140207     C***                GOTO      ENDC01
102530140207     c***                endif
102540140207     c***                endif
102550001121      *
102560970701     C                   MOVEL     VIDRSD        I14RSC
102570970701     C                   MOVE      VIDRSD        I14RS2
102580970701     C                   MOVEL     VIDIND        I14IND
102590970701     C                   MOVEL     VIDLOD        E14LOC
102600970701     C                   MOVEL     VIDPID        E14PIP
102610970701     C                   MOVEL     VIDPRD        E14PRV
102620970701     C                   MOVEL     VIDNZD        E14NAR
102630970701     C                   MOVEL     VIDCAD        E14CAP
102640970704     C                   MOVEL     'D'           WCLI              1
102650061121     c                   clear                   wcdf
102660970704     C                   EXSR      CTRIND
102670970702     C*
102680970702     C* IMPOSTO I CAMPI DI UNA EVENTUALE RICERCA
102690970704     C                   MOVEL     E14LOC        VIDLOD
102700970704     C                   MOVEL     E14CAP        VIDCAD
102710970704     C                   MOVEL     E14NAR        VIDNZD
102720970704     C                   MOVEL     E14PRV        VIDPRD
102730970702     C                   MOVEL     E14PIP        VIDPID
102740970704     C* ERRORE
102750970704     C     WEMFOR        IFEQ      '1'
102760970704     C     *IN90         OREQ      *ON
102770970704     C                   GOTO      ENDC01
102780970704     C                   ENDIF
102790160223     c*
102800160223     c* Se bolla export eex verifico se instradabile su DPD
102810160223     c*
102820160302     c                   if        not *in12 or *in15
102830160302     c                   clear                   w_adpd
102840160302     c                   if        viddpd=' ' and wdesie='E' and
102850160302     c                             (vidlna = *zeros or vidlna=*blanks)
102860160302     c                             and not *in44
102870160407     c                             and §lpfpr<>'O' and partch<>'P'
102880160407     c                             and §3arbl<>'R'
102890160226     c                             and not *in04
102900160223     c                   exsr      sr_instrADPD
102910160223     c                   endif
102920160223     c                   endif
102930160223
102940070808     c* Per TELLUS --> Indirizzo: deve essere di almeno 6 caratteri
102950090202     c* Ignoro l'errore se destinatario estero protetto
102960070808     c                   eval      w_vidind=%trim(vidind)
102970070827     c     ' '           checkr    w_vidind      num               2 0
102980090202     c                   if        num<6 and (wdesie<>'E' or atrdes<>prot)
102990070808     C                   SETON                                        90
103000070808     C                   Z-ADD     18            H1RIGA
103010070808     C                   Z-ADD     02            H1COLO
103020070808     C                   MOVEL     ERR(313)      VIDMSG
103030070808     C                   GOTO      ENDC01
103040070808     c                   endif
103050061121     c* Se destinatario estero e orm avente p.o. emittente DPD errore se
103060061121     c* il network non è dpd
103070061121     c                   if        wdesie='E' and flgfit<>'S'
103080061121     c                             and poentw='DPD' and viddpd<>'D'
103090061121     c                             and A_§ogntw<>'DPD'
103100061121     c                   seton                                        90
103110061121     c                   Eval      VidMsg = Err(309)
103120061121     c                   z-add     21            H1riga
103130061121     c                   z-add     10            H1colo
103140061121     c                   GoTo      EndC01
103150061121     c                   endif
103160160513     c* Se destinatario estero e orm avente p.o. emittente EEX errore se
103170160513     c* il network non è EEX
103180160513     c                   if        wdesie='E' and flgfit<>'S'
103190160513     c                             and poentw='EEX' and
103200160513     c                             (viddpd<>' ' or
103210160513     c                              (A_§ogntw<>*blanks and A_§ogntw<>'EEX'))
103220160513     c                   seton                                        90
103230160513     c                   Eval      VidMsg = Err(365)
103240160513     c                   if        viddpd<>' '
103250160513     c                   z-add     21            H1riga
103260160513     c                   z-add     10            H1colo
103270160513     c                   else
103280160513     c                   z-add     14            H1riga
103290160513     c                   z-add     55            H1colo
103300160513     c                   endif
103310160513     c                   GoTo      EndC01
103320160513     c                   endif
103330141202     c* Se presente PIN CODE lo controllo - SE sono in Conferma Bolle
103340141202
103350141202     c                   if        *in12 and *in15  and
103360141202     c                             wpincode<>*blanks
103370141202     c* se bolla export non lo controllo perchè per l'export non lo
103380141202     c* memorizziamo
103390141202     c                   if        (comlna>0 and
103400141202     c                              a_§ogntw<>'FED' and
103410141202     c                              a_§ogntw<>'EEX' and
103420141202     c                              a_§ogntw<>'DPD' ) or
103430141202     c                             (comlna = 0 and wdesie<>'E')
103440141202     c* errore se Pin Code ricevuto > di 15 caratteri
103450141202     c                   if        lenPC>15
103460141202     c                   Eval      *In90 = *On
103470141202     c                   Eval      vidmsg=err(355)
103480141202     c                   goto      endc01
103490141202     c                   endif
103500141202     c* verifico la presenza di caratteri non validi
103510141209     c* se presenti dati in tabella CSP record "PINCODE" altrimenti
103520141203     c* i caratteri sono tutti validi
103530141203     c                   if        charpcok<>*blanks
103540141202     c                   eval      wtxt=wpincode
103550141202     c                   clear                   uppercase
103560141202     c                   eval      ElencoChar=charPCok
103570160112     c                   clear                   TipoElenco
103580141202     c                   exsr      sr_chk
103590141202     c                   if        esito<>'0'
103600141202     c                   Eval      *In90 = *On
103610141202     c                   Eval      vidmsg=err(356)
103620141202     c                   goto      endc01
103630141202     c                   endif
103640141209     c                   endif
103650141209     c* verifico che non siano presenti dei blank dentro al pin code
103660141209     c                   if        %scan(' ':%subst(wpincode:1:lenpc))>0
103670141209     c                   Eval      *In90 = *On
103680141209     c                   Eval      vidmsg=err(356)
103690141209     c                   goto      endc01
103700141209     c                   endif
103710141202     c                   endif
103720141202     c                   endif
103730050214     c*
103740050214     c* SE DESTINATARIO ESTERO vedo se devo forzare il porto franco
103750050214     C* (si tratta delle stesse operazioni effettuate anche routine prp
103760050214     c* or1 che devono essere effettuate anche in questo momento
103770050214     c* se l'orm è multiplo per cui deve prima essere controllato il
103780060427     c* destinatario per sapere se è estero- Idem se orm singolo ma non è
103790060427     c* specificato il destinatario ORM)
103800060428if  1c****               If        (Not *In12 or Not *In15) and
103810060428     c****                         (ormtor = 'M' or ormrsc=*blanks  )  and
103820050214      * e l'ORM prevede:
103830060428      *****           --> la bolla in porto Assegnato
103840060428      *****           --> paga ordinante orm
103850060428      *****           --> destinatario estero
103860060428      *****           --> ordinante orm italia
103870060428     c*****                        (§OrPfb = 'A' and OrmPag = 'O' and
103880060428     c****                          wdesie = 'E' and OrmNao = *Blanks)
103890060428     c****               exsr      sr_FOrmEst
103900060428    1c****               EndIf
103910061124     c                   if        vidnzd<>savnzd
103920061124     c                   clear                   wfortbo
103930061124     c                   move      vidnzd        savnzd
103940061124     c                   endif
103950140423
103960050214     c                   exsr      CTRCBO_orm
103970050214     C     *in90         IFEQ      '1'
103980050214     c                   eval      wemfor = '1'
103990050214     C                   GOTO      ENDC01
104000050214     C                   ENDIF
104010061011     c
104020061011     c* Per bolla dpd con CAP errato richiamo in automatico int cappar
104030061011     c*  DPD
104040061011    1c                   if        CapparioDPD='S' or *inkb
104050061011     c* Se non è + dpd tolgo il flag
104060061011    2C     A_§OGNTW      IFEQ      'DPD'
104070061011     C     VIDDPD        OREQ      'D'
104080061011     C     WDESIE        ANDEQ     'E'
104090061011     c* Se modificato il CAP vado avanti senza l'interrogazione
104100061011    3c                   if        vidcad=savcapdpd   or *inkb
104110061011     c* Per l'interrogazione passo solo il cap fittizio
104120061011     C                   MOVEL     '15'          COD
104130061011     C                   MOVEL(P)  VIDNZD        KEY
104140061011     C                   EXSR      CTABEL
104150061011     C                   MOVEL     TBLUNI        DS15
104160061011     c                   movea     vidcad        cap
104170061011     C                   CLEAR                   CAF
104180061011     C                   MOVEA     CAP(§15pcf)   CAF(§15pcf)
104190061011     c     §15ecf        add       §15pcf        finefit           2 0
104200061011     c                   movea     *blanks       caf(finefit)
104210061011     c
104220170918     C***                CLEAR                   tisie8ds
104230170918     c***                z-add     blpdsp        isie8dri
104240170918     c***                movel     'D01'         isie8op0
104250170918     C***                MOVEL     vidnzd        isie8nar
104260170918     C***                MOVEa     caf           isie8cap
104270170918     C***                CALL      'TISIE8R'
104280170918     C***                PARM                    kpjba
104290170918     C***                PARM                    tisie8ds
104291170918     C                   CLEAR                   tisiD8ds
104292170918     c                   z-add     blpdsp        isid8dri
104293170918     c                   movel     'D01'         isid8op0
104294170918     C                   MOVEL     vidnzd        isid8nar
104295170918     C                   MOVEa     caf           isid8cap
104296170918     C                   CALL      'TISID8R'
104297170918     C                   PARM                    kpjba
104298170918     C                   PARM                    tisiD8ds
104300061011     c*
104310061011     c* Se errore lo emetto
104320170918     c                   if        osid8err<>' '
104330170918     C                   MOVEL     osid8msg      VIDMSG
104340061011     C                   SETON                                        6590
104350061011     C                   GOTO      ENDC01
104360061011     c                   endif
104370061011     c
104380170918    4c                   if        osid8capb<>*blanks
104390170918     c                   movel     osid8capb     vidcad
104400061011     c                   clear                   cappariodpd
104410061011     c
104420061011     c* In manutenzione se cambiato CAP riemetto videata
104430061011     c* In immissione/conferma no tanto devo confermare la videata
104440061011     c*    x nazione estera
104450150825     c****               if        *in12 and not *in15
104460061011     c                   eval      wemfor='1'
104470150825    4c****               endif
104480061011     c
104490061011     c                   else
104500061011     c* se non selezionato riemetto videata
104510061011     c                   eval      wemfor='1'
104520061011    4c                   endif
104530061011    3c                   endif
104540061011     c
104550061011   x2c                   else
104560061011     c                   clear                   cappariodpd
104570150729     c                   eval      wemfor='1'
104580061011    2c                   endif
104590061011    1c                   endif
104600020530     c*
104610941020     C**
104620950303     C* SE DESTINATARIO ESTERO --> P.IVA OBBLIGATORIA
104630950525     C* SOLO SE PAESE EFTA
104640050427     c* e non è bolla di recupero
104650000905     C     WDESIE        IFEQ      'E'
104660950616     C     VIDPID        ANDEQ     *BLANKS
104670050427     c     §3arbl        andne     'R'
104680000321     C*
104690020319    2C     A_§OGNTW      IFEQ      'DPD'
104700000321     C     DESEFD        ANDNE     *BLANKS
104710000321     C*
104720020204     C     VIDDPD        OREQ      'D'
104730000321     C     DESEFD        ANDNE     *BLANKS
104740020131     c*
104750020213    2C     A_§OGntw      oreq      'FED'
104760020131     C     DESEFf        ANDNE     *BLANKS
104770020131     C*
104780020131     C     VIDDPD        OREQ      'F'
104790020131     C     DESEFf        ANDNE     *BLANKS
104800000321     C*
104810020319     C     A_§OGNTW      ORNE      'DPD'
104820020213     c     A_§ogntw      andne     'FED'
104830000321     C     VIDDPD        ANDEQ     ' '
104840000321     C     O14EFT        ANDNE     *BLANKS
104850950303     C                   MOVEL     '1'           WEMFOR
104860950303     C                   SETON                                        387090
104870950303     C                   MOVEL     ERR(88)       VIDMSG
104880950303     C                   GOTO      ENDC01
104890000321    2C                   ENDIF
104900000321    1C                   ENDIF
104910970528     C* NON POSSO USARE L'ESPRESSO PER BOLLE IMPORT/EXPORT
104920970528     C     VIDTSP        IFEQ      'E'
104930970528     C     WDESIE        IFEQ      'E'
104940100118     c**   §ogntw        oreq      'EEX'
104950100118     c**   §ogntw        oreq      'FED'
104960100118     c**   §ogntw        oreq      'DPD'
104970970528     C                   MOVEL     '1'           WEMFOR
104980970528     C                   SETON                                        487090
104990970528     C                   MOVEL     ERR(142)      VIDMSG
105000100118     c                   eval      %subst(vidmsg:47:10) = v1dtsp
105010090604     c                   eval      vidmsg = %trim(vidmsg) + '!!'
105020970528     C                   GOTO      ENDC01
105030970528    1C                   ENDIF
105040970528    1C                   ENDIF
105050020415     c* NON POSSO USARE CLIENTE 9999 PER PORTI ASSEGNATI EUROEXPRESS
105060020416     c* Lo posso usare solo se bolla associata a orm reale commissionato da
105070020416     c* un p.o. EEX
105080020416     C     SAVFPR        IFNE      'P'
105090020416     C     SAVFPR        ANDNE     'G'
105100020527     C     SAVFPR        ANDNE     'T'
105110020416     c     vidccm        andeq     9999
105120020415     c     wdesie        ifeq      'E'
105130020415     c     viddpd        andeq     *blanks
105140020415     c     comlna        andeq     *zeros
105150020415     c     A_§ogntw      oreq      'EEX'
105160020416     c                   clear                   wokccm            1
105170020416     C* Verifico se P.O. emittente "EEX"
105180020416    2C     FLGFIT        IFNE      'S'
105190020416     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
105200020416     C                   MOVEL     OG143         SAV143
105210020416     C  N30              MOVEL     ORGDE3        OG143
105220020416     C   30              CLEAR                   OG143
105230020416     c     §ogntw        ifeq      'EEX'
105240020416     c                   movel     'S'           wokccm
105250020416     c                   endif
105260020416     C                   MOVEL     sav143        og143
105270020416    2C                   ENDIF
105280020416     c     flgfit        ifeq      'S'
105290020416     c     wokccm        oreq      *blanks
105300020415     C                   MOVEL     ERR(253)      VIDMSG
105310020415     C                   SETON                                        9050
105320020415     c   90              goto      endc01
105330020416     c                   endif
105340020415     c                   endif
105350020415     c                   endif
105360970528     C* NON POSSO USARE TIPO BOLLA 5
105370970528     C     WDESIE        IFEQ      'E'
105380970528     C     VIDCBO        ANDEQ     '5 '
105390970528     C                   MOVEL     '1'           WEMFOR
105400970528     C                   SETON                                        467090
105410970528     C                   MOVEL     ERR(143)      VIDMSG
105420970528     C                   GOTO      ENDC01
105430970528    1C                   ENDIF
105440030707
105450030707      * Se non sto facendo una bolla di recupero
105460030707If  1c                   If        §3aRbl <> 'R'
105470991206      **
105480991206      * SE CAP ESTERO--> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ITALIA
105490020319      ***                TRANNE SE LINEA DPD
105500950525     C     WDESIE        IFEQ      'E'
105510950525     C     COMLNA        ANDGT     0
105520020319     c     A_§ogntw      ifeq      'COR'
105530020319     c     A_§ogntw      oreq      'MES'
105540020319     c     A_§ogntw      oreq      'PPT'
105550950525     C                   MOVEL     ERR(117)      VIDMSG
105560950525     C                   SETON                                        4790
105570950525     C                   GOTO      ENDC01
105580020319     c                   endif
105590950525     C                   ENDIF
105600950525     C*
105610991206      * SE CAP ITALIA -> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ESTERO
105620020319     C***NEMMENO DPD
105630950525     C     WDESIE        IFEQ      'I'
105640971211     C     COMLNA        ANDGT     0
105650020319     c     A_§ogntw      ifeq      'EEX'
105660020319     c     A_§ogntw      oreq      'FED'
105670020319     c     A_§ogntw      oreq      'DPD'
105680950525     C                   MOVEL     ERR(118)      VIDMSG
105690950525     C                   SETON                                        4790
105700950525     C                   GOTO      ENDC01
105710950525     C                   ENDIF
105720000121     C                   ENDIF
105730030707    1c                   EndIf
105740000121      *
105750000121      * PER LNA DPD OBBLIGATORIO 1 COLLO
105760020319     C     A_§OGNTW      IFEQ      'DPD'
105770020204     C     VIDDPD        OREQ      'D'
105780000121     C     WDESIE        ANDEQ     'E'
105790000121     C     V1CNCL        IFNE      1
105800000121     C                   SETON                                        6290
105810000121     C                   MOVEL     ERR(179)      VIDMSG
105820000121     C                   GOTO      ENDC01
105830000121     C                   ENDIF
105840000121     C                   ENDIF
105850090429      * OBBLIGATORIETA' DI un collo anche per orm commissionato da dpd
105860151002     c                   if        flgfit<>'S' and poentw='DPD' and v1cncl<>1
105870090429     C                   SETON                                        6290
105880090429     C                   MOVEL     ERR(323)      VIDMSG
105890090429     C                   GOTO      ENDC01
105900090429     c                   endif
105910000121      * PER LNA O LNP DPD Massimo peso inseribile da tabella
105920020319     C  N12A_§OGNTW      IFEQ      'DPD'
105930020319     C     §OGNTW        OREQ      'DPD'
105940020204     C     VIDDPD        OREQ      'D'
105950000121     C     WDESIE        ANDEQ     'E'
105960000121     C     VIDPKG        IFGT      §3IPKD
105970000121     C                   SETON                                        6390
105980000121     C                   MOVEA     ERR(180)      K78
105990000121     C                   MOVEL     §3IPKD        W006A             6
106000000121     C                   MOVEA     W006A         SKI(10)
106010000121     C                   Z-ADD     10            I                 3 0
106020000121     C                   EXSR      ABBL
106030000121     C                   MOVEA     SKI(10)       K78(53)
106040000121     C                   MOVE      §3IPKD        W001A
106050000121     C                   MOVEL     W001A         K78(60)
106060000121     C                   MOVEA     K78           VIDMSG
106070000121     C                   GOTO      ENDC01
106080000121     C                   ENDIF
106090000121     C                   ENDIF
106100020201     c* per servizio dpd non accettato tipo bolla con C/A  - IDEM per FED-EX
106110080414     c*    viddpd        ifeq      'D'
106120080414     c*    A_§ogntw      oreq      'DPD'
106130080414     c*                  eval      w006a = 'DPD   '
106140080414     c*                  else
106150080414     c*    viddpd        ifeq      'F'
106160080414     c*    A_§ogntw      oreq      'FED'
106170080414     c*                  eval      w006a = 'FedEx '
106180080414     c*                  else
106190080414     c*                  if        wdesie='E'
106200080414     c*                  eval      w006a = 'EUROEX'
106210080414     c*                  endif
106220080414     c*                  endif
106230080414     c*                  endif
106240061030     c
106250061030     c* Controllo se ammesso C/A per estero in base ai vari network
106260080414     c****               setoff                                       90
106270080414     c*****              select
106280080414     C***  VIDDPD        wheneq    'D'
106290080414     C**** WDESIE        ANDEQ     'E'
106300061030     c*
106310080414     C***  A_§OGNTW      OREQ      'DPD'
106320080414     c***                if        descadpd=' '  and §3afca<>0
106330080414     c****               seton                                        90
106340080414     c****               endif
106350061030     c
106360080414     C***  VIDDPD        wheneq    'F'
106370080414     C***  WDESIE        ANDEQ     'E'
106380061030     c
106390080414     C***  A_§OGntw      OREQ      'FED'
106400080414     c****               if        descafed=' '  and §3afca<>0
106410080414     c***                seton                                        90
106420080414     c****               endif
106430080414     c***                other
106440080414     c****               if        wdesie='E' and
106450080414     c****                         descaeex=' '  and §3afca<>0
106460080414     c****               seton                                        90
106470080414     c****               endif
106480080414     c***                endsl
106490061030     c
106500080414     C***                IF        *in90
106510080414     c***                movea     err(187)      k78
106520080414     c***                movea     w006a         k78(13)
106530080414     C***                MOVEa     k78           VIDMSG
106540080414     C***                SETON                                        4690
106550080414     C***                GOTO      ENDC01
106560080414     C***                ENDIF
106570061030     c*
106580030221     c* Per bolle export fedex non è ammesso l'inserimento di C/Servizio
106590030221     c     viddpd        ifeq      'F'
106600030221     c     A_§ogntw      oreq      'FED'
106610030221     c     §3arbl        ifeq      'C'
106620020228     C                   MOVEL     ERR(245)      VIDMSG
106630020228     C                   SETON                                        4690
106640020228     C                   GOTO      ENDC01
106650030221     c                   endif
106660020228     c                   endif
106670060613     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
106680060613     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
106690060613     C     *IN79         IFEQ      *ON
106700060613     C     VIDDPD        ANDne     'D'
106710060613     C     A_§OGNTW      ANDNE     'DPD'
106720060613     C     WDESIE        ANDEQ     'E'
106730060613     C                   SETOFF                                       79
106740060613     C                   ENDIF
106750000120     c* Numero dpd
106760000120     c*  INSERIBILE SOLTANTO SE RICHIESTO IL SERVIZIO O LNA ESTERA DPD
106770060612     c*  o se import dpd
106780000120     C  N12
106790060612    1COR 15VIDNRD        IFne      *blanks
106800060613   1ac     *in79         ifeq      *off
106810000120    2C     COMLNA        IFEQ      0
106820000120     C     VIDDPD        ANDEQ     ' '
106830020201    2C     COMLNA        oreq      0
106840020201     C     VIDDPD        andeq     'F'
106850000121    2C     COMLNA        ORGT      0
106860020319     C     A_§OGNTW      ANDNE     'DPD'
106870060921     c
106880000120     C     DESLAD        OREQ      0
106890060921     c     desred        andeq     ' '
106900060921     c
106910060921     C     DESLAD        OREQ      0
106920060921     c     desred        andeq     'S'
106930060921     c     vidfbr        andne     'S'
106940000120     C                   MOVEL     ERR(184)      VIDMSG
106950000120     C                   SETON                                        4790
106960000120     C                   GOTO      ENDC01
106970000120    2C                   ENDIF
106980060612     c
106990000120     C* NON INSERIBILE SE NON ACCETTATTO DAL CTM
107000000120    2C     §1BF13        IFEQ      'A'
107010000120     C                   MOVEL     ERR(185)      VIDMSG
107020000120     C                   SETON                                        5790
107030000120     C                   GOTO      ENDC01
107040000120    2C                   ENDIF
107050060612   1aC                   ENDIF
107060000120     C* SE INSERITO, e no bolla reupero,  CONTROLLO IL CHK DIGITS
107070000308    2C     §3ARBL        IFNE      'R'
107080060612     C                   movel     VIDNRD        WNPR
107090000124     C                   EXSR      DPDVAL
107100000124     C   90              SETON                                        57
107110000124     C   90              GOTO      ENDC01
107120060613     c* per import effettuo subito il controllo per parcel doppio
107130060613     c                   if        *in79='1' and §1bfg8='S'
107140060613     c                   exsr      dpddop_imp
107150060613     C   90              SETON                                        57
107160060613     C   90              GOTO      ENDC01
107170060613     c                   endif
107180070326     c* per export imposto campo wparcel
107190070326     c                   if        *in79='0' and %subst(wnpr:14:1)=*blanks
107200070326     c                             and vidfbr<>'S'
107210070326     c                   eval      wparcel='12'
107220080612     c* in questo caso devo anche controllare che il chi sono inserito non
107230080612     c* sia doppio su fisgn
107240080612     c                   clear                   w8hcol
107250080612     c                   movel     wnpr          w8cnot
107260080612     c                   clear                   w08msg
107270080612     c                   eval      wnopos='1'
107280080612     c                   exsr      ctrchidop
107290080612     C                   MOVEL     w08msg        VIDMSG
107300080612     C   90              SETON                                        57
107310080612     C   90              GOTO      ENDC01
107320070326     c                   endif
107330060613     c
107340000120    2C                   ENDIF
107350000120     C*
107360000120   X1C                   ELSE
107370000120     C*
107380060613     c     *in79         ifeq      *on
107390060612     C     §3ARBL        ANDNE     'R'
107400060612     C                   MOVEL     ERR(186)      VIDMSG
107410060612     C                   SETON                                        5790
107420060612     C                   GOTO      ENDC01
107430060612     c                   endif
107440060612    2C     §1BF13        ifne      'A'
107450000308     C     §3ARBL        ANDNE     'R'
107460000121     C     WDESIE        ANDEQ     'E'
107470020204    3C     VIDDPD        IFEQ      'D'
107480020319     C     A_§OGNTW      OREQ      'DPD'
107490000120     C                   MOVEL     ERR(186)      VIDMSG
107500000120     C                   SETON                                        5790
107510000120     C                   GOTO      ENDC01
107520000120    3C                   ENDIF
107530000120    2C                   ENDIF
107540000120    1C                   ENDIF
107550960213     C***
107560960213     C*** FERMO DEPOSITO ERRATO
107570960213     C     VIDFFD        IFNE      'S'
107580010214     C     VIDFFD        ANDNE     'N'
107590010220     C     VIDFFD        ANDNE     ' '
107600960213     C                   MOVEL     ERR(123)      VIDMSG
107610960213     C                   SETON                                        5290
107620960213     C                   GOTO      ENDC01
107630960213     C                   ENDIF
107640940916     C***
107650940916     C*** FLAG INOLTRO: SE IMPOSTATO FORZARE CON CMD6
107660940909     C  NKF
107670940909     CANN15
107680940909     CAN 12
107690940909     CORNKF
107700940909     CANN12VIDFIN        IFNE      ' '
107710940907     C                   MOVEL     ERR(44)       VIDMSG
107720940923     C                   SETON                                        6990
107730940920     C                   GOTO      ENDC01
107740940909     C                   ENDIF
107750110818     c***
107760110901     c*** valore per accorpamento spedizioni in consegna:
107770110818     c*** errore bloccante se il cliente ha passato un valore non previsto
107780110818     c*   in tabella "xco"
107790110901     c***                if        *in12 and *in15 and werrxco=*on
107800110901     C***                SETON                                        90
107810110901     c***                eval      vidmsg=err(343)
107820110901     C***                GOTO      ENDC01
107830110901     c***                endif
107840110818     c*
107850031121      * Obbligatori se spedizione per supermercato
107860040213if  1c**!!!              If        wdisag = 'S'
107870040213if  2c**!!!              If        VidRef = *Blanks
107880040213     c**!!!              Eval      VidMsg = Err(267)
107890040213     c**!!!              z-add     20            H1riga
107900040213     c**!!!              z-add     21            H1colo
107910040213     c**!!!              Eval      *In90 = *On
107920040213     c**!!!              Eval      wemfor = '1'
107930040213     c**!!!              GoTo      EndC01
107940040213    2c**!!!              EndIf
107950040213if  2c**!!!              If        VidTel = *Blanks
107960040213     c**!!!              Eval      VidMsg = Err(267)
107970040213     c**!!!              z-add     20            H1riga
107980040213     c**!!!              z-add     64            H1colo
107990040213     c**!!!              Eval      *In90 = *On
108000040213     c**!!!              Eval      wemfor = '1'
108010040213     c**!!!              GoTo      EndC01
108020040213    2c**!!!              EndIf
108030040213    1c**!!!              EndIf
108040941003     C*
108050941003     C* IMPOSTO LA LOCALITA' DEL DESTINATARIO IN 2 VIDEATA
108060941003     C                   MOVEL     VIDLOD        V2CLOD
108070950123     C                   MOVEL     VIDRSD        V2CRSD
108080910125     C****
108090020917     C* CONTO QUANTI COLLI E QUANTI RECORD HO IN Fivad:
108100040618    1C***12§1BFG7        IFEQ      'S'
108110040618     c* in conferma
108120040618    1c                   if        (*in12 = *on and *in15 = *on
108130040618     c                             and §1bfg7 = 'S' and §1bf12 <> 'B')
108140040618     c* in manutenzione
108150040618     c                             or (*in12 = *on and *in15 = *off
108160040618     c                             and §1bfg7 = 'S')
108170940909     C  N15KBLP3         SETLL     FNBLD000
108180020917     C   15KBLC          SETLL     FIVAD000
108190940908     C* CONT  = NUMERO RECORD
108200910125     C                   Z-ADD     0             CONT
108210940908     C* CONT2 = NUMERO COLLI
108220910128     C                   Z-ADD     0             CONT2
108230940908     C*
108240940909     C  N15KBLP3         READE(N)  FNBLD000                               31
108250020917     C   15KBLC          READE(N)  FIVAD000                               31
108260950220     C*
108270950220    2C     *IN31         DOWEQ     *OFF
108280950220     C                   ADD       1             CONT              3 0
108290950220     C                   ADD       BLDNCL        CONT2             6 0
108300950220     C*
108310950220     C* SE E' DA DISK CLIENTI VEDO SE IL COLLO E' > 0
108320950220     C     *IN15         IFEQ      *ON
108330980410     C     §1BFG6        ANDEQ     'C'
108340950220     C     BLDNCD        ANDEQ     0
108350950220     C                   MOVEL     ERR(85)       VIDMSG
108360950220     C                   SETON                                        629031
108370950220    3C                   ENDIF
108380010313     C* SE E' DA DISK CLIENTI CONTROLLO CHE IL NUMERO COLLI SIA
108390010313     C* CORRETTO RISPETTO AL RANGE DAL/AL PASSATO
108400010313    3C     *IN15         IFEQ      *ON
108410010313     C     §1BFG6        ANDEQ     'C'
108420010313     C* CONTO IL NUMERO COLLI NEL RANGE DAL/AL
108430010313    4C     BLDNCA        IFEQ      *ZEROS
108440010313     C     BLDNCA        OREQ      BLDNCD
108450010313     C                   Z-ADD     1             WNCOL
108460010313   X4C                   ELSE
108470010313     C                   Z-ADD     BLDNCD        WNCOA
108480010313     C                   CLEAR                   WNCOL
108490010313    5C     WNCOA         DOWLE     BLDNCA
108500010313     C                   ADD       1             WNCOL
108510010313     C                   ADD       1             WNCOA
108520010313    5C                   ENDDO
108530010313    4C                   ENDIF
108540010313    4C     WNCOL         IFNE      BLDNCL
108550010313     C                   MOVEL     ERR(227)      VIDMSG
108560010313     C                   SETON                                        629031
108570010313    4C                   ENDIF
108580010313    3C                   ENDIF
108590950220     C*
108600950220     C  N15
108610950220     CANN31KBLP3         READE(N)  FNBLD000                               31
108620950220     C   15
108630020917     CANN31KBLC          READE(N)  FIVAD000                               31
108640940909    2C                   ENDDO
108650950220     C*
108660950220     C   90              GOTO      ENDC01
108670940908     C*
108680910225     C* SE NUMERO SEGNACOLLI DEL DETTAGLIO BOLLE NON E' UGUALE
108690910225     C*   AL NUMERO INDICATO SULLA BOLLA
108700050113     C     CONT2         ifne      V1CNCL
108710940908     C*
108720910225     C* IN DISK CLIENTI SEMPRE ERRORE
108730940909    3C     *IN15         IFEQ      *ON
108740940908     C* IN MANUTENZIONE BOLLE SOLO SE + DI UN RECORD
108750940908     C     *IN15         OREQ      *OFF
108760940908     C     CONT          ANDGT     1
108770940908     C                   MOVEL     ERR(87)       VIDMSG
108780940923     C                   SETON                                        6290
108790940920     C                   GOTO      ENDC01
108800940909    3C                   ENDIF
108810910225     C*
108820940909    2C                   ENDIF
108830910128     C*
108840940909    1C                   END
108850000413     C**
108860000413     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
108870000413     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
108880060613     c*  13/06/06 - Sposto questi controlli prima dei controlli su vidnrd
108890060613     C**   *IN79         IFEQ      *ON
108900060613     C**   VIDDPD        ANDne     'D'
108910060613     C***  A_§OGNTW      ANDNE     'DPD'
108920060613     C***  WDESIE        ANDEQ     'E'
108930060613     C***                SETOFF                                       79
108940060613     C***                ENDIF
108950940909     C*
108960160216     c* richiamo trul27r1 per sapere che cosa devo passare in FIE a fnlv59r
108970160216     c                   Clear                   Trul27Ds1
108980021120     c                   Exsr      TarCar
108990021120     c                   If        *In90
109000021120     c                   GoTo      EndC01
109010021120     c                   EndIf
109020080327     c
109030080327     c* Se tipo servizio tariffa <> da fnvab in conferma bolle, errore
109040080327     c*   se non utilizzabile in bollettazione
109050080327     c                   if        *in12 and *in15 and NOutiTSP='N'
109060080327     c                             and tamtsp<>vidtsp
109070080327     C                   MOVEL     ERR(130)      VIDMSG
109080080327     C                   SETON                                        4890
109090080327     C                   GOTO      ENDC01
109100080327     c                   endif
109110090609     c* controllo i limiti di colli e peso
109120090609     c
109130090609     c                   z-add     v1cncl        wncl
109140090609     c  n12              z-add     vidpkg        wpes
109150090609     c   12              clear                   wpes
109160090609     c                   clear                   wvol
109170090609     c                   eval      wvid='1'
109180160224     c                   exsr      sr_limtsp
109190090609     c                   if        *in90
109200090609     C                   MOVEL     wmsgtsp       VIDMSG
109210090609     C                   GOTO      ENDC01
109220090609     c                   endif
109230041011     c*
109240041011     c* Verifico se destinatario disagiato
109250041011     c* Per bolle poste non faccio niente
109260091210     c                   clear                   wdisag
109270091210     c  n12              clear                   w_ar5tcp
109280091210     c                   clear                   ddstflo
109290041012    1c     §ogntw        ifne      'PPT'
109300091210     c
109310091210     c                   clear                   tisit0ds
109320091210     c                   clear                   tisit0x1ds
109330091210     c                   movel     'E'           it0tla
109340091210     c                   movel     vidnzd        it0naz
109350091210     c                   movel     vidprd        it0prv
109360091210     c                   movel     vidcad        it0cap
109370091210     c                   movel     vidlod        it0loc
109380091210     c                   movel     vidind        it0ind
109390091210     c                   movel     vidrsd        it0rag
109400091210     c                   call      'TISIT5R'
109410091210     c                   parm                    tisit0ds
109420091210     c                   parm                    tisit0x1ds
109430041012    2c     ot0err        ifeq      *blanks
109440060113     c                   movel     ot0flo        ddstflo
109450060102   2ac                   if        ot0dos = 'A' or ot0dos = 'D' or
109460060102     c                             ot0dos = 'S'
109470041011     c                   movel     ot0dos        wdisag
109480041012    3c     wdisag        ifeq      'D'
109490041011     c                   movel     'X'           wdisag
109500041012    3c                   endif
109510060102   2ac                   endif
109520041011     c                   Eval      savdisag = wdisag
109530070924     c                   Eval      savpart = 'S'
109540041012   x2c                   else
109550041011     c                   clear                   wdisag
109560041012    2c                   endif
109570041012     c                   exsr      sr_imptc12
109580070924     c* propongo eventuali gg. di chiusura se previsti nei dest.particolari
109590070924     c                   exsr      sr_impgc12
109600041012    1c                   endif
109610040608     c*
109620040608      * --> Referente e Telefono del destinatario
109630040608      *     (messaggio forzabile)
109640150213      * Solo in immissione
109650150213    0c                   If        not *in12
109660040608      * Da indicare se
109670091209      * - Spedizione FedEx
109680040608      * - Spedizione a Privati
109690040608      * - Spedizione con Appuntamento
109700040608      * - Spedizione Export in c/assegno o in porto assegnato
109710040608      * -> Referente solo sped. Export
109720040608if  1c                   If        VidRef = *Blanks and wforza1 = *Off and
109730040608     c                             ((comlna > *Zeros and
109740040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
109750040608     c                             (comlna = *Zeros and wdesie = 'E'))
109760040608if  2c                   If        §3aFca > *Zeros
109770040608     c                   Eval      VidMsg = Err(36)
109780040608     c                   Eval      *In90 = *On
109790040608    2c                   EndIf
109800040608if  2c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
109810040608     c                   Eval      VidMsg = Err(54)
109820040608     c                   Eval      *In90 = *On
109830040608    2c                   EndIf
109840040608if  2c                   If        *In90
109850040608     c                   z-add     20            H1riga
109860040608     c                   z-add     21            H1colo
109870040608     c                   Eval      wforza1 = *On
109880040608     c                   GoTo      EndC01
109890040608    2c                   EndIf
109900040608    1c                   EndIf
109910040608      * -> Telefono
109920040608if  1c                   If        VidTel = *Blanks and wforza1 = *Off
109930040608s   2c                   Select
109940040608     c                   When      a_§OgNtw = 'FED' or viddpd = 'F'
109950040608     c                   Eval      VidMsg = Err(56)
109960040608     c                   Eval      *In90 = *On
109970040608     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
109980040608     c                   Eval      VidMsg = Err(267)
109990040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
110000040608     c                   Eval      *In90 = *On
110010170412     c***                When      %subst(VidGva:1:1) = 'P'
110020170412     c***                Eval      VidMsg = Err(58)
110030170412     c***                Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
110040170412     c***                Eval      *In90 = *On
110050040608     c                   When      (comlna > *Zeros and
110060040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
110070040608     c                             (comlna = *Zeros and wdesie = 'E')
110080040608if  3c                   If        §3aFca > *Zeros
110090040608     c                   Eval      VidMsg = Err(36)
110100040608     c                   Eval      *In90 = *On
110110040608    3c                   EndIf
110120040608if  3c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
110130040608     c                   Eval      VidMsg = Err(54)
110140040608     c                   Eval      *In90 = *On
110150040608    3c                   EndIf
110160040608    2c                   EndSl
110170040608if  2c                   If        *In90
110180040608     c                   z-add     20            H1riga
110190040608     c                   z-add     64            H1colo
110200040608     c                   Eval      wforza1 = *On
110210040608     c                   GoTo      EndC01
110220040608    2c                   EndIf
110230040608    1c                   EndIf
110240150213    0c                   EndIf
110250910220     C*
110260910220     C* VEDO SE SPROTEGGERE LA SERIE
110270950103     C*
110280950103     C     *IN12         IFEQ      *OFF
110290950103     C                   CLEAR                   VIDNRS
110300950103     C                   ENDIF
110310930624     C* PER DISK CLIENTI
110320940930    1C     *IN12         IFEQ      *ON
110330930624     C     *IN15         ANDEQ     *ON
110340930624     C* PER SPEDIZIONI DI RECUPERO
110350930624     C     *IN12         OREQ      *OFF
110360930624     C     *IN98         ANDEQ     *ON
110370930624     C* PER SPEDIZIONI DI CLIENTI CHE SI ASSEGNANO SOLO I NUMERI SEGNAC
110380930624     C     *IN12         OREQ      *OFF
110390980410     C     §1BFG6        ANDEQ     'C'
110400930624     C     §1BFG2        ANDEQ     'N'
110410930803     C* PER CLIENTI CON SERIE
110420930803     C     *IN12         OREQ      *ON
110430930803     C     *IN15         ANDEQ     *OFF
110440930803     C     VIDNRS        ANDGT     0
110450000225     C* PER CLIENTI DISK "C"
110460000225     C     *IN12         OREQ      *ON
110470000225     C     *IN15         ANDEQ     *OFF
110480000225     C     VIDSOP        ANDEQ     ':'
110490930624     C*
110500000911     C                   CLEAR                   DS3C
110510910311     C                   MOVEL     'N'           §3CFG1
110520921012     C                   MOVEL     ' '           §3CFSP
110530910220     C                   MOVEL     '3C'          COD
110540940921     C                   MOVEL(P)  WKSC          KEY
110550910220     C*
110560930708     C                   EXSR      CTABEL
110570910301     C  N30              MOVEL     TBLUNI        DS3C
110580100517     C* SE IL TERMINAL NON HA ANCHILOSATO, NON LO HA NEMMENO IL CLIENT
110590000204     C     WASDKC        IFNE      'S'
110600000204     C                   CLEAR                   §3CDKC
110610000204     C                   ENDIF
110620921006     C*
110630980805   1AC     *IN30         IFEQ      *OFF
110640980805     C     §3COKD        ANDEQ     '*'
110650980805    2C     *IN12         IFEQ      *OFF
110660921006     C     *IN98         ANDEQ     '1'
110670921006     C                   SETON                                        95
110680921006     C                   MOVEL     §3CNRS        VIDNRS
110690921006     C*
110700940930   X2C                   ELSE
110710921006     C*
110720940930    3C     §3CFG1        IFEQ      'S'
110730910220     C                   SETON                                        95
110740910426     C* SE FLAG6 DEL CLIENTE PROPONGO GIA' LA SERIE
110750940930    4C     §1BFG6        IFEQ      'C'
110760921006     C     VIDNRS        ANDEQ     0
110770910426     C                   MOVEL     §3CNRS        VIDNRS
110780940930    4C                   END
110790910426     C*
110800940930    3C                   END
110810940930    2C                   END
110820980805   1AC                   END
110830980805    1C                   END
110840940930     C*
110850080313      * verifico se cliente ha serie parziale
110860100517     c******             exsr      sr_parz
110870940930     C* PER DISK CLI TENGO QUELLO PASSATO SOLO SE :
110880940930     C*  ABILITATO DA DS DEL CLIENTE
110890940930     C*  ABILITATO IL COD TASSAZIONE ALLA FORZATURA
110900120712     c* ES 12/07/12 --> tolto non più usata da tempo questa forzatura
110910120712     C** 12
110920120712     C*N 15§3CFCT        IFEQ      'S'
110930120712     C**                 MOVEL     'CT'          COD
110940120712     C**                 MOVEL(P)  §LPCTS        KEY
110950940930     C*
110960120712     C**                 EXSR      CTABEL
110970120712     C**N30              MOVEL     TBLUNI        DSCT
110980120712     C**N30§CTFDK        IFEQ      'S'
110990120712     C**                 MOVEL     §LPCTS        SAVCTS
111000120712     C**                 ENDIF
111010120712     C**                 ENDIF
111020910805     C*
111030910805     C* PER DISK CLI SE FLAG 6 NON E' "C" AZZERO LA SERIE
111040910805     C   12
111050910805     CAN 15§1BFG6        IFNE      'C'
111060921019     C     §1BFG8        ANDNE     'N'
111070910805     C                   Z-ADD     0             VIDNRS
111080910805     C                   END
111090940930     C*
111100910410     C* PULIZIA CAMPI NUMERO SEGNACOLLI SE IMMISSIONE E STAMPA SEGNAC
111110910410     C* NELL'ORGANIZZAZIONE
111120910410     C  N12
111130910410     CAN 25              Z-ADD     0             VIDNCD
111140910410     C  N12
111150910410     CAN 25              Z-ADD     0             VIDNCA
111160910606     C* PER DISK CLI AZZERO SOLO SE NON SI ASSEGNA I NUMERI SEGNACOLLI
111170980410     C   12
111180980410     CAN 25
111190980410     CAN 15§1BFG6        IFNE      'C'
111200910606     C                   Z-ADD     0             VIDNCD
111210910606     C                   Z-ADD     0             VIDNCA
111220910607     C                   END
111230910808     C  N12
111240910808     COR 12
111250910808     CAN 15              MOVEL     *BLANKS       VIDFNS
111260910805     C* CONTROLLO SE NON SEQUENZIALI
111270960805     C   12
111280960805    1CAN 15§1BFG7        IFEQ      'S'
111290980410     C     §1BFG6        ANDEQ     'C'
111300920917     C*
111310020917     C     KBLC          SETLL     FIVAD000
111320020917     C     KBLC          READE(N)  FIVAD000                               30
111330960805    3C  N30BLDNCA        IFNE      0
111340941230     C                   Z-ADD     BLDNCA        COMSCD
111350920917     C                   ELSE
111360941230     C                   Z-ADD     BLDNCD        COMSCD
111370960805    3C                   ENDIF
111380941230     C                   Z-ADD     BLDNCD        VIDNCD
111390941230     C                   SUB       BLDNCL        COMSCD
111400910805     C*
111410960805    3C     *IN30         DOWEQ     *OFF
111420941230     C                   ADD       BLDNCL        COMSCD
111430960805    4C     BLDNCA        IFNE      0
111440960805    5C     COMSCD        IFNE      BLDNCA
111450920917     C                   SETON                                        30
111460960805    5C                   ENDIF
111470920917     C*
111480960805   X4C                   ELSE
111490920917     C*
111500960805    5C     COMSCD        IFNE      BLDNCD
111510910805     C                   SETON                                        30
111520960805    5C                   ENDIF
111530960805    4C                   ENDIF
111540920917     C*
111550920917     C   30              MOVEL     'S'           VIDFNS
111560020917     C  N30KBLC          READE(N)  FIVAD000                               30
111570960805    3C                   ENDDO
111580920917     C* NON SEQ.: AZZERO
111590960805    3C     VIDFNS        IFEQ      'S'
111600910805     C                   Z-ADD     0             VIDNCD
111610910805     C                   Z-ADD     0             VIDNCA
111620920917     C*
111630960805   X3C                   ELSE
111640920917     C* SEQ : IMPOSTO SEGNACOLLO AL
111650960805    4C     V1CNCL        IFGT      1
111660960805    5C     BLDNCA        IFNE      0
111670941230     C                   Z-ADD     BLDNCA        VIDNCA
111680960805   X5C                   ELSE
111690941230     C                   Z-ADD     BLDNCD        VIDNCA
111700960805    5C                   ENDIF
111710960805    4C                   ENDIF
111720960805    3C                   ENDIF
111730960805     C* MI SALVO I SEGNACOLLI DAL / AL CHE NON POSSONO ESSERE MODIFICAT
111740960805     C                   Z-ADD     VIDNCD        WNSNCD
111750960805     C                   Z-ADD     VIDNCA        WNSNCA
111760910805     C*
111770960805    1C                   ENDIF
111780961111     C***
111790961111     C*** SE BOLLA EXPORT CON C/A PROTEGGO TIPO INCASSO E DIVISA
111800961111     C***
111810121022     C     COMLNA        IFEQ      0
111820121022     C     WDESIE        ANDEQ     'E'
111830121022     C     COMLNA        ORGT      0
111840121022     c     A_§ogntw      andeq     'EEX'
111850121022     C     COMLNA        ORGT      0
111860121022     c     A_§ogntw      andeq     'FED'
111870121022     C     COMLNA        ORGT      0
111880121022     c     A_§ogntw      andeq     'DPD'
111890020319     c
111900121022     C     §3AFCA        IFGT      0
111910121022     C***                SETON                                        76
111920121022     C***                MOVEL     'BM'          VIDTIC
111930011108     C**         VIDVCA    IFEQ *BLANKS
111940011108     C* Con l'euro la divisa non sarà mai più a blank, quindi propongo
111950011108     C* la divisa della nazione del destinatario solo se importo C/A=0
111960050504     c* 04/05/05: Se divisa della nazione diversa da "EUR" o "USD"
111970050504     c* non propongo niente. Questo per evitare errori da parte del
111980050504     c* bollettista di indicazione della divisa sbagliata in particolar
111990050504     c* per le spedizioni dirette a paesi europei che hanno conservato
112000050504     c* la loro divisa (Svizzera, Danimarca...)
112010121022     C     VIDCAS        IFEQ      *ZEROS
112020121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
112030121022     C                   MOVEL     DESVLT        VIDVCA
112040121022     C                   MOVEL     DESVLT        VARVCA
112050121022     c                   else
112060121022     C                   clear                   VIDVCA
112070121022     C                   clear                   VARVCA
112080121022     c                   endif
112090121022     C                   ENDIF
112100980219     C**
112110121022     C                   ELSE
112120121022     C                   CLEAR                   VIDTIC
112130121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
112140121022     C                   MOVEL     DESVLT        VIDVCA
112150121022     C                   MOVEL     DESVLT        VARVCA
112160121022     c                   else
112170121022     C                   clear                   VIDVCA
112180121022     C                   clear                   VARVCA
112190121022     c                   endif
112200121022     C                   ENDIF
112210011108     C                   ELSE
112220011108     C* SE DESTINATARIO NON È EXPORT E IMPORTO CONTRASSEGNO = 0
112230011108     C* PROPONGO GEDCN
112240011108     C     VIDCAS        IFEQ      *ZEROS
112250011108     C                   MOVEL     §GEDCN        VIDVCA
112260011108     C                   MOVEL     §GEDCN        VARVCA
112270011108     C                   ENDIF
112280961111     C                   ENDIF
112290091210     c***
112300091210     C*** Richiamo routine per impostare eventuali forzature flag DDT
112310091210     c***
112320091210     c                   exsr      SR_FRZBAM
112330070326     c***
112340070326     C* IMPOSTO LNA DPD SE NON 'C'E'
112350070326    1C     VIDDPD        IFEQ      'D'
112360070326     C     WDESIE        ANDEQ     'E'
112370070326     C     A_§OGNTW      OREQ      'DPD'
112380160302     c**** w_aDpd        oreq      'S'
112390070326    2C     VIDLNA        IFLE      *ZEROS
112400070326     C     DESLAD        ANDGT     0
112410070326     C                   Z-ADD     DESLAD        COMLNA
112420070326    2C                   ENDIF
112430070326    1C                   ENDIF
112440070326     C* SE NUMERO AUTOMATICO, LO PRELEVO
112450070326     c* 22/03/07: Prelevo quello automatico anche nel caso di inserimen
112460070326     c* to numero parcel lungo 12 in quanto dal 01/04/07 non saranno
112470070326     c* più gestiti da DPD
112480070326     C  N12
112490070326    1COR 15VIDDPD        IFEQ      'D'
112500070326     C     WDESIE        ANDEQ     'E'
112510070326     C     A_§OGNTW      OREQ      'DPD'
112520160224     c     w_ADpd        oreq      'S'
112530070326    2c                   if        Comnrd=0 and (§1bf13='A' or
112540160225     c                             wparcel='12' or w_aDpd='S')
112550070515    3c****               if        dateu >= §vpodpd
112560070326     c                   clear                   trul33ds
112570070326     c                   z-add     25            i33cnu
112580070326     c                   z-add     1             i33num
112590070326     c                   movel     trul33ds      kpjbu
112600070326     c                   call      'TRUL33R'
112610070326     c                   PARM                    kpjba
112620070326     c                   movel     kpjbu         trul33ds
112630070326    4c     o33err        ifgt      *zeros
112640070326     c                   seton                                        90
112650070326    5c                   select
112660070326     c     o33err        wheneq    1
112670070326     c                   movel     err(300)      vidmsg
112680070326     c     o33err        wheneq    2
112690070326     c                   movel     err(301)      vidmsg
112700070326     c     o33err        wheneq    3
112710070326     c                   movel     err(302)      vidmsg
112720070326    5c                   endsl
112730070326     c                   goto      endc01
112740070326    4c                   endif
112750070326     c                   z-add     o33nri        comnrd
112760070515   x3c****               else
112770070515     C**** KTBE          CHAIN     TNTBE02L                           30
112780070326     C* E NON C'E' LO CREO
112790070515     C***30              CLEAR                   TNTBE000
112800070515     C***30              CLEAR                   DCHI
112810070515     C**N30              MOVEL     TBEUNI        DCHI
112820070515     C***                ADD       1             §CHINM
112830070515     C***                MOVEL     DCHI          TBEUNI
112840070515    3C***  *IN30         IFEQ      *OFF
112850070515     C***                UPDATE    TNTBE000
112860070515     C***                ELSE
112870070515     C***                MOVEL     KTCOD         TBECOD
112880070515     C***                MOVEL     KTLIN         TBELIN
112890070515     C***                MOVEL     KTSIF         TBESIF
112900070515     C***                MOVEL     KTKE1         TBEKE1
112910070515     C***                MOVEL     KTKE2         TBEKE2
112920070515     C***                MOVEL     'DP'          TBEKE2
112930070515     C***                WRITE     TNTBE000
112940070515    3C***                ENDIF
112950070515     C***                CLEAR                   DPDBRC
112960070515     C***                MOVEL     §CHINM        DPDBRC
112970070515     C***                CLEAR                   DPDCHD
112980070515     C***                EXSR      M1031
112990070515     C***                z-add     DPDBRC        COMNRD
113000070515    3c***                endif
113010070326    2c                   endif
113020070326    1c                   endif
113030070326     c* Impostazione numero parcel dpd: se attribuzione automatica o
113040070326     c* numero parcel lungo 12 coincide con numero preso da numeratore
113050070326     c* altrimenti è quello immesso a video
113060070326    1c                   if        (*in12='0' or *in15=*on) and
113070070326     c                             ((viddpd='D' and wdesie='E') or
113080160225     c                             A_§ogntw='DPD' or W_aDpd='S')
113090160225     c                             and (§1bf13='A' or wparcel='12' or
113100160225     c                             W_aDpd='S')
113110070515    2c***                if        dateu >= §vpodpd
113120070326     c                   move      comnrd        v7cnpr
113130070515   x2c***                else
113140070326     c** parcel lungo 12
113150070515     c***                z-add     comnrd        w0120            12 0
113160070515     C***                movel     w0120         V7CNPR
113170070515    2c***                endif
113180070326     c* se sono in bollettazione (no conferma bolle) non propongo più
113190070326     c* numero parcel dpd nel RMN
113200070326    2C   15VIDRMN        IFEQ      0
113210070326     C                   z-add     COMNRD        VIDRMN
113220070326    2C                   ENDIF
113230070326   x1c                   else
113240070326    2c                   if        (*in12='0' or *in15=*on) and
113250070326     c                             vidnrd<>*blanks
113260070326     c* se numero dpd numerico lo propongo nel rif.mittente come segue:
113270070326     c* - Se spedizione export --> solo in conferma bolle da cliente
113280070326     c* - Se spedizione import --> sempre
113290070326     c* se numero dpd alfanumerico e spedizione import imposto 1 in rmn
113300070326     c* Numero parcel dpd numerico
113310070326    3c                   if        wsolo_num=*blanks
113320070326     c* export
113330070326    4c                   if        (*in15=*on and *in79=*off
113340070326     c                             and vidrmn=0)
113350070326     c* import
113360070326     c                             or (*in79='1')
113370070326     c                   clear                   vidrmn
113380070326    5c                   if        %subst(vidnrd:14:1) <> *blanks
113390070326     C                   move      VIDNRD        VIDRMN
113400070326     c                   else
113410070326     c                   eval      w012a=%subst(vidnrd:1:12)
113420070326     c                   move      w012A         vidrmn
113430070326    5c                   endif
113440070326    4C                   ENDIF
113450070326   x3c                   else
113460070326     c* Numero parcel dpd alfanumerico
113470070326    4c                   if        *in79='1'
113480070326     c                   z-add     1             vidrmn
113490070326    4c                   endif
113500070326    3c                   endif
113510070326     C                   movel     VIDNRD        V7CNPR
113520070326    2c                   endif
113530070326    1c                   endif
113540000623     C***
113550000623     C* CONTROLLO SE ESISTE LA DS3Q PER IL CIENE MITTENTE
113560970326     C***
113570000623     C                   CLEAR                   WES3Q
113580000623     C                   MOVEL     '3Q'          COD
113590000623     C                   MOVEL(P)  WKSC          KEY
113600000623     C*
113610000623     C                   EXSR      CTABEL
113620000623     C  N30              MOVEL     'S'           WES3Q             1
113630000623     C   30              MOVEL     ' '           WES3Q             1
113640011112     C***
113650011112     C* DIVISA IMPORTO DA ASSICURARE: PROPONGO DIVISA NAZIONE MITTENTE
113660011112     C*        SE ESTERO ALTIMENTI PROPONGO §GEDCN
113670011112     C***
113680011112     C     VIDIAS        IFEQ      *ZEROS
113690011112     C     MITVLT        IFNE      *BLANKS
113700011112     C     WMITIE        ANDEQ     'E'
113710011112     C                   MOVEL     MITVLT        VIDVAS
113720011112     C                   MOVEL     MITVLT        VARVAS
113730011112     C                   ELSE
113740011112     C                   MOVEL     §GEDCN        VIDVAS
113750011112     C                   MOVEL     §GEDCN        VARVAS
113760011112     C                   ENDIF
113770011112     C                   ENDIF
113780011113     C***
113790011113     C* DIVISA VALORE MERCE DICHIAR.: PROPONGO DIVISA NAZIONE MITTENTE
113800011113     C*        SE ESTERO, ALTIMENTI PROPONGO §GEDCN
113810011113     C***
113820011113     C     VIDVMD        IFEQ      *ZEROS
113830011115     C     MITVLT        IFNE      *BLANKS
113840011113     C     WMITIE        ANDEQ     'E'
113850011113     C                   MOVEL     MITVLT        VIDVAD
113860011113     C                   MOVEL     MITVLT        VARVAD
113870011113     C                   ELSE
113880011113     C                   MOVEL     §GEDCN        VIDVAD
113890011113     C                   MOVEL     §GEDCN        VARVAD
113900011113     C                   ENDIF
113910011115     C                   ENDIF
113920000120     C***
113930940920     C     ENDC01        TAG
113940940909     C   90              MOVEL     '1'           WEMFOR
113950940909     C                   ENDSR
113960940224     C*
113970940921     C* RICERCA E CARICAMENTO A VIDEO TARIFFE ------------------------*
113980940224     C     RICTAR        BEGSR
113990940921     C                   SETOFF                                       30
114000941221     C                   CLEAR                   WTACAR
114010941221     C                   CLEAR                   WTKS
114020991026     C                   CLEAR                   COMDIV
114030940921     C*
114040940921     C* PER DISK CLI PRENDO SEMPRE LA TARIFFA DEL CLIENTE
114050940921    1C     *IN12         IFEQ      *ON
114060940921     C     *IN15         ANDEQ     *ON
114070940921     C                   MOVEL     §LPCTR        VIDCTR
114080050921     C                   MOVEL     §LPCTR        ilv59ctr
114090050921     C                   MOVEL     'S'           ilv59ric
114100940921     C*
114110940921   X1C                   ELSE
114120010223     C*
114130130404     c* 1) caso IMISSIONE
114140130404     c* 2) caso manutenzione con ricaricamento tariffe
114150010223    2C  N29WORM          IFEQ      'S'
114160010223     C     FLGFIT        ANDNE     'S'
114170010223     C     PARTCH        ANDNE     'P'
114180050921     C     ilv59ric      ANDEQ     'S'
114190010223    3C     *IN12         IFEQ      *OFF
114200010223     C     *IN15         OREQ      *OFF
114210010223     C     WORMMD        ANDEQ     '1'
114220030905    4c                   If        §OrPfb <> 'A'
114230010223     C                   MOVE      VIDCCM        W0070             7 0
114240010223    5C     VIDFLC        IFEQ      *ZEROS
114250010223     C                   MOVEL     VIDLNP        W0070
114260010223     C                   ELSE
114270010223     C                   MOVEL     VIDFLC        W0070
114280010223    5C                   ENDIF
114290010223    5C     W0070         IFEQ      ORMKSC
114300010223     C     ORMCTR        ANDNE     *BLANKS
114310010223     C                   MOVE      ORMCTR        VIDCTR
114320010223     C                   MOVE      ORMCTR        PRECTR
114330050921     C                   MOVE      ORMCTR        ilv59ctr
114340010223    5C                   ENDIF
114350010223    4C                   ENDIF
114360010223    3C                   ENDIF
114370010223    2C                   ENDIF
114380130404     c*
114390130404     c* 3) caso manutenzione solo con  cambio ORM
114400130404    2C  N29WORM          IFEQ      'S'
114410130404     C     FLGFIT        ANDNE     'S'
114420130404     C     PARTCH        ANDNE     'P'
114430130404     C     ilv59ric      ANDEQ     ' '
114440130404     C     *IN12         andeq     *On
114450130404     C     *IN15         andeq     *OFF
114460130404     C     WORMMD        ANDEQ     '1'
114470130404     C     ORMCTR        ANDNE     *BLANKS
114480130404    4c                   If        §OrPfb <> 'A'
114490130404     C                   MOVE      VIDCCM        W0070             7 0
114500130404    5C     VIDFLC        IFEQ      *ZEROS
114510130404     C                   MOVEL     VIDLNP        W0070
114520130404     C                   ELSE
114530130404     C                   MOVEL     VIDFLC        W0070
114540130404    5C                   ENDIF
114550130404    5C     W0070         IFEQ      ORMKSC
114560130404     c                   if        ormctr<>vidctr
114570130404     c                   eval      CambiaCTR='S'
114580130404     c                   endif
114590130404     C                   MOVE      ORMCTR        VIDCTR
114600130404     C                   MOVE      ORMCTR        PRECTR
114610130404     C                   MOVE      ORMCTR        ilv59ctr
114620130404    5C                   ENDIF
114630130404    4C                   ENDIF
114640130404    2C                   ENDIF
114650940921     C*
114660940224     C* PER : IMMISSIONE (SE NON PERSONALIZZATO IL COD TARIFFA)
114670940921     C*       E MANUTENZIONE BOLLE
114680941107    2C     *IN29         IFEQ      *ON
114690941231     C* SE NON LO DEVO RICARICARE, IMPOSTO IL CODICE TARIFFA
114700050921     C     ilv59ric      ORNE      'S'
114710050921     C                   MOVEL     VIDCTR        ilv59ctr
114720941107    2C                   ENDIF
114730941107    1C                   ENDIF
114740950525     C* SE VIDCTR = '   ' E' COME SE LO DOVESSI RICARICARE
114750950525     C     VIDCTR        IFEQ      *BLANKS
114760050921     C                   MOVEL     'S'           ilv59ric
114770950525     C                   ENDIF
114780150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
114790150415     c* accetto anche tariffe bloccate
114800150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
114810150415     c                              and §3arbl='R' and §lpimv>0)
114820150415     C                   EVAL      ILV59blo='S'
114830150415     C                   ENDIF
114840941107     C*
114850941107     C* SE ESISTONO TARIFFE PER IL CLIENTE CERCO
114860050921     C                   MOVEL     'P'           ilv59tbo
114870040512      * se bolla monovaria pulisco il tipo bolla
114880040512     C                   IF        §3ASVA <> *BLANK
114890050921     C                   CLEAR                   ilv59tbo
114900050921     c                   movel     'P'           ilv59prp
114910040512     C                   ENDIF
114920040512
114930050921     C                   MOVEL     WKSC          ilv59ksc
114940050921     C                   MOVEL     KCI           ilv59kci
114950050921     C                   MOVEL     BLPDSP        ilv59dsp
114960050921     C                   MOVEL     VIDTSP        ilv59tsp
114970160216     C                   MOVEL     WFIE          ilv59fie
114980160216     c                   clear                   ilv59ta3
114990160216     c                   select
115000160216     c     viddpd        wheneq    'D'
115010160216     c     wdesie        andeq     'E'
115020160222     c     a_§ogntw      oreq      'DPD'
115030160216     c                   movel     'D'           ilv59ta3
115040160216     c     viddpd        wheneq    'F'
115050160216     c     wdesie        andeq     'E'
115060160222     c     a_§ogntw      oreq      'FED'
115070160216     c                   movel     'F'           ilv59ta3
115080160216     c     viddpd        wheneq    ' '
115090160216     c     wdesie        andeq     'E'
115100160222     c     a_§ogntw      oreq      'EEX'
115110160216     c                   movel     'E'           ilv59ta3
115120160216     c                   other
115130160216     c                   movel     'I'           ilv59ta3
115140160216     c                   endsl
115150050921     C                   CALL      'FNLV59R'
115160050921     C                   PARM                    fnlv59ds
115170160428
115180160428     c                   if        ilv59ric=' ' and ilv59con=' ' and
115190160428     c                             ilv59ta4='S' and ilv59ctr<>olv59ctr
115200160428     c                   eval      ilv59ric='S'
115210160428     c                   endif
115220900528     C*
115230050922     c* se avevo richiamato con CON e RIC vuoti il cod.tariffa non
115240050922     c* viene impostato. Quindi in questo caso non imposto vidctr
115250050922     c* Avrei potuto condizionare il richiamo di fnlv59r da con e/o ric
115260050922     c* pieni ma in questo caso mi si poneva il problema dell'impostazi
115270050922     c* one di wtacar, wtks e comdiv in caso di manutenzione.
115280050922     c                   if        ilv59ric <> ' ' or ilv59con <> ' '
115290080403     c*
115300080326     c                   if        olv59ctr<>vidctr
115310080326     c                   eval      CambiaCTR='S'
115320160428     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
115330160428     c* mettere in RI i campi presi da tariffa per avvisare della variazione
115340160428     c                   if        *in12 and not *in15
115350160428     c                   seton                                        97
115360160428     c     atrbva        ifne      prri
115370160428     c                   movel     riul          atrbva
115380160428     c                   endif
115390160428     c                   endif
115400080326     c                   endif
115410080326     c
115420050921     C                   MOVEL     olv59ctr      VIDCTR
115430050921     C                   MOVEL     olv59dfs      DEFCTR
115440050922     c                   endif
115450941221     C*
115460941221     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDO SEMPRE DATI DAL
115470941221     C* LA TARIFFA DI CARTELLO
115480050921     C     olv59tks      IFEQ      ' '
115490941221     C                   MOVEL     'S'           WTACAR            1
115500950410     C                   CLEAR                   UND
115510170517     c
115520950410     C* SOLO SE LA DEVO RICARICARE LA AZZERO
115530050921     C  N29ilv59ric      IFEQ      'S'
115540941221     C                   MOVEL     *ZEROS        VIDCTR
115550170517     C* SE PIENO IL CAMPO DI PUTPUT DA FNLV59R , LO PRENDO PERCHÈ
115560170517     C*  SI TRATTA del primo ctr utilizzabile NON esistente
115570170517     c                   if        olv59ctr<>'   '
115580170517     C                   MOVEL     olv59ctr      VIDCTR
115590170517     c                   endif
115600170517     c
115610021120      * Per bolla FedEx imposto il codice tariffa della cartello FedEx
115620021120     c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
115630160219     c***                Movel     O27Ctr        VidCtr
115640160219     c                   clear                   trulc7ds
115650160222     c                   eval      IC7tFIE =  'F'
115660160219     c                   eval      IC7DTA  =  blpdsp
115670160219     c                   eval      IC7PKG  =  vidpkg
115680160219     c                   eval      IC7tip  =  i27tip
115690160219     c                   call      'TRULC7R'
115700160219     c                   parm                    trulc7ds
115710160219     c                   Movel     Oc7Ctrc       VidCtr
115720021120     c                   EndIf
115730950410     C                   ENDIF
115740941221     C                   ENDIF
115750950410     C*
115760050921     C                   MOVEL     olv59tks      WTKS
115770941231     C* SE HO RICERCATO LA TARIFFA RICARICO IL PRG ALTRIMENTI
115780941231     C*  LO PULISCO
115790050921     C     ilv59ric      IFEQ      'S'
115800150424     C     ilv59con      oreq      'S'
115810150424     C     olv59err      ifeq      ' '
115820050921     C     olv59tks      ANDEQ     'S'
115830050921     C                   MOVEL     olv59prg      COMPRG
115840941231     C                   ENDIF
115850150424     C                   ENDIF
115860950103     C*
115870050921     C     olv59err      IFNE      ' '
115880050921     C     olv59tks      ORNE      'S'
115890941231     C                   Z-ADD     0             COMPRG
115900941231     C                   ENDIF
115910940921     C*
115920940921     C* SE LA TARIFFA E' FRA QUELLE TROVATE, CARICO GLI ALTRI DATI DEL
115930941110     C* ALTRIMENTI LI PRENDO SEMPRE DALLA TARIFFA DI CARTELLO
115940050921     C     ilv59ric      IFEQ      'S'
115950150424     c     CambiaCTR     oreq      'S'
115960940922     C                   EXSR      CTNTAM
115970010223     C*
115980950103     C                   ENDIF
115990941107     C*
116000941107     C* IMPOSTO I CAMPI DEI CODICI TARIFFA A VIDEO
116010050921     C                   MOVEL     olv59ct2      VIDCT2
116020050921     C                   MOVEL     olv59ct3      VIDCT3
116030050921     C                   MOVEL     olv59ct4      VIDCT4
116040050921     C                   MOVEL     olv59ct5      VIDCT5
116050050921     C                   MOVEL     olv59es2      VIDES2
116060050921     C                   MOVEL     olv59es3      VIDES3
116070050921     C                   MOVEL     olv59es4      VIDES4
116080050921     C                   MOVEL     olv59es5      VIDES5
116090940921     C*
116100940922     C* OGNI VOLTA CHE MODIFICATO IL COD MITTENTE, PER CUI RICARICO
116110940922     C*  LE TARIFFE, IMPOSTO "SAVCTR" CON QUELLO PROPOSTO
116120940922     C*  IN QUANTO I CAMPI LI HO PROPOSTI A VIDEO
116130940922     C                   MOVEL     VIDCTR        SAVCTR
116140930803     C                   SETOFF                                       30
116150900504     C                   ENDSR
116160940922     C*
116170940922     C* CHAIN SU TNTAM00F PER PRENDERE I CAMPI DA PROPORRE -----------*
116180940922     C     CTNTAM        BEGSR
116190941221     C                   SETOFF                                       30
116200010226     C                   CLEAR                   WNNTAR
116210010226     C                   CLEAR                   WN1TAR
116220050926     C                   CLEAR                   fvol              1
116230941231     C*
116240941231    1C     WTACAR        IFEQ      ' '
116250941231     C* ERRORE: NON TROVATA PROGRESSIVO COL CODICE TARIFFA
116260941231     C* IMPOSTATO
116270050921    2C     olv59err      IFNE      ' '
116280941221     C                   SETON                                        30
116290941221     C                   ELSE
116300941231     C                   MOVEL     VIDCTR        COMCTR
116310941231     C**
116320940922     C     KTAM2         CHAIN     TNTAM000                           30
116330110304     c
116340941231    2C                   ENDIF
116350941221     C*
116360941231   X1C                   ELSE
116370941221     C* TARIFFA DI CARTELLO
116380160216     c                   clear                   trulc7ds
116390160224     c                   select
116400160226     c                   when      o27ntw='DPD' or w_aDpd='S'
116410160224     c                   eval      IC7tFIE = 'D'
116420160224     c                   when      o27ntw='FED'
116430160224     c                   eval      IC7tFIE = 'F'
116440160224     c                   when      o27ntw='EEX'
116450160224     c                   eval      IC7tFIE = 'E'
116460160224     c                   other
116470160224     c                   eval      IC7tFIE = 'I'
116480160224     c                   endsl
116490160216     c                   eval      IC7DTA  =  blpdsp
116500160216     c                   eval      IC7CTB  =  vidctr
116510160216     c                   eval      IC7PKG  =  vidpkg
116520160219     c                   eval      IC7tip  =  i27tip
116530160216     c                   call      'TRULC7R'
116540160216     c                   parm                    trulc7ds
116550160219     c                   clear                   oc7prgc_
116560160219     c                   if        oc7prgc<>*blanks
116570160219     c                   movel     oc7prgc       oc7prgc_
116580160219     c                   endif
116590160216     c
116600160216     c
116610941107     C     KCAR2         CHAIN     TNTAM000                           30
116620941231    1C                   ENDIF
116630941221     C  N30              MOVEL     TAMDCV        DEVCTR
116640040610     C  N30              MOVEL     TAMflo        dsta01
116650961203     C* PRENDO TASSAZIONE TARIFFA MITT SOLO SE NON PROVENGO DA
116660961203     C*  GIACENZE PERCHE' IN DIROTTAMENTO NON HO PIU' LE TARIFFE
116670961203     C*  ORIGINALI
116680961203     C  N30
116690961203     CANN87              MOVEL     TAMFTM        SAVFTM
116700941221     C   30              CLEAR                   DEVCTR
116710941221     C   30              CLEAR                   SAVFTM
116720940922     C*
116730940922     C* PER DISK CLIENTI
116740940922     C* I CAMPI LI PRENDO SOLO SE SONO VUOTI
116750940922     C* PER IL RESTO       SEMPRE
116760941231    1C     *IN12         IFEQ      *ON
116770940922     C     *IN15         ANDEQ     *ON
116780970328     C*
116790970328     C  N30§LPBAM        IFEQ      ' '
116800970328     C                   MOVEL     TAMBAM        VIDBAM
116810970328     C                   ENDIF
116820940922     C*
116830941231    2C     §LPNAS        IFEQ      *BLANKS
116840941221     C  N30              MOVEL     TAMNAS        VIDNAS
116850030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
116860030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
116870030409     c                             and Not *In30
116880030409     c                   Clear                   VidNas
116890030409     c                   EndIf
116900941221     C   30              CLEAR                   VIDNAS
116910941231    2C                   ENDIF
116920040610     c* Tipo merce: V-Valore
116930040610     C  N30§lpbva        IFEQ      ' '
116940040610     c     §1bfg8        andne     'N'
116950040610     C                   MOVEL     §tabva        VIDbva
116960040610     C                   ENDIF
116970040610     c*
116980941231    2C     §LPNOT        IFEQ      *BLANKS
116990941221     C  N30              MOVEL     TAMNOT        VIDNT1
117000941221     C   30              CLEAR                   VIDNT1
117010941231   X2C                   ELSE
117020941231    3C     §LPNT2        IFEQ      *BLANKS
117030941221     C  N30              MOVEL     TAMNOT        VIDNT2
117040941221     C   30              CLEAR                   VIDNT2
117050941231    3C                   ENDIF
117060941231    2C                   ENDIF
117070940922     C*§
117080940922     C* GESTIONE PARTIC.C/A SOLO SE BOLLA CON C/A
117090941231    2C     §3AFCA        IFNE      0
117100940922     C     §LPGCA        ANDEQ     *BLANKS
117110940922     C     §3AFCA        ANDNE     0
117120941221     C  N30              MOVEL     TAMGCA        VIDGCA
117130941221     C   30              CLEAR                   VIDGCA
117140941231    2C                   ENDIF
117150941231    2C     §LPGGA        IFEQ      *BLANKS
117160941221     C  N30              MOVEL     TAMGGA        VIDGGA
117170941221     C   30              CLEAR                   VIDGGA
117180941231    2C                   ENDIF
117190941231    2C     §LPGMA        IFEQ      *BLANKS
117200160509     c     §3arbl        andne     'R'
117210100215     C  N30              MOVEL     TAMGMA        VIDGMA
117220941221     C   30              CLEAR                   VIDGMA
117230941231    2C                   ENDIF
117240941231    2C     §LPGVA        IFEQ      *BLANKS
117250941221     C  N30              MOVEL     TAMGVA        VIDGVA
117260941221     C   30              CLEAR                   VIDGVA
117270941231    2C                   ENDIF
117280940922     C*
117290941231   X1C                   ELSE
117300010226     C*
117310010226     C* NATURA MERCE
117320010226     C* SE NON E' STATA PERSONALIZZATA ED E' ATTIVATA PROCEDURA ORM
117330010226     C* DEVO PROPORRE LA NATURA MERCE DELL'ORM SE PRESENTE E NON
117340010226     C* QUELLA DA TARIFFA.
117350010226     C* IDEM PER LE NOTE
117360011221     C                   MOVEL     ORMNAM        W015A
117370150424    3C*    WORM          IFEQ      'S'
117380150424     C*    FLGFIT        ANDNE     'S'
117390150424     C*    PARTCH        ANDNE     'P'
117400150424     C*    ilv59ric      ANDEQ     'S'
117410150424    3c                   if        worm='S' and flgfit<>'S' and partch<>'P'
117420150424     c                             and (ilv59ric='S' or CambiaCTR='S')
117430010226     C     *IN27         IFEQ      *OFF
117440011221     C     W015A         ANDNE     *BLANKS
117450010226     C                   MOVEL     ORMNAM        VIDNAS
117460010226     C                   MOVEL     '1'           WNNTAR            1
117470010226     C                   ENDIF
117480010404     C* NOTE SE PESO > 50 Q.LI  O SE O.R.M COMMISSIONATO
117490010307    4C                   SELECT
117500010307     C     §LPFPR        WHENEQ    'O'
117510050211     C***  ORMPOE        ORNE      ORMPOR
117520080326     c                   if        vidnt1=*blanks
117530010307     C                   MOVEL     WTELRF        VIDNT1
117540080326     c                   else
117550080326     c                   if        vidnt2=*blanks
117560080326     C                   MOVEL     WTELRF        VIDNT2
117570080326     c                   endif
117580080326     c                   endif
117590080326     c
117600010307     C                   MOVEL     '1'           WN1TAR
117610010409     C     VIDPKG        WHENGE    §DFMAX
117620010226    5C     ORMNO1        IFNE      *BLANKS
117630080326     c                   if        vidnt1=*blanks
117640010226     C                   MOVEL     ORMNO1        VIDNT1
117650080326     c                   else
117660080326     c                   if        vidnt2=*blanks
117670150427     c                             and ormno1<>vidnt1
117680080326     C                   MOVEL     ORMNO1        VIDNT2
117690080326     c                   endif
117700080326     c                   endif
117710010226     C                   MOVEL     '1'           WN1TAR            1
117720010226    5C                   ENDIF
117730010307    4C                   ENDSL
117740010226    3C                   ENDIF
117750941231     C*
117760941231    3C     *IN30         IFEQ      *OFF
117770080326   3ac                   if        CambiaCTR='S'
117780080326     c
117790080326    4C     WNNTAR        IFEQ      *BLANKS
117800080326     c* solo se ho modificato la tariffa
117810941231     C  N27              MOVEL     TAMNAS        VIDNAS
117820030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
117830160411    5c                   If        (VidDpd = 'F' or a_§OgNtw = 'FED')
117840030409     c                             and Not *In27
117850030409     c                   Clear                   VidNas
117860080326    5c                   EndIf
117870080326    4C                   ENDIF
117880080326    4C     WN1TAR        IFEQ      *BLANKS
117890080326     c* In manutenzione solo se sono vuote
117900080326    5c     vidnt1        ifeq      *blanks
117910110304     c     vidnt1        oreq      savnot
117920940922     C                   MOVEL     TAMNOT        VIDNT1
117930110304     c                   movel     tamnot        savnot
117940080326     c                   else
117950080326    6c     vidnt2        ifeq      *blanks
117960110304     c     vidnt2        oreq      savnot
117970080326     C                   MOVEL     TAMNOT        VIDNT2
117980110304     c                   movel     tamnot        savnot
117990080326    6c                   endif
118000080326    5c                   endif
118010080326     c
118020080326    4C                   ENDIF
118030080326     c
118040080326    4c     atrbva        ifne      prri
118050040610     c     §1bfg8        andne     'N'
118060040610     c                   movel     §tabva        vidbva
118070080326    4c                   endif
118080941231    4C     §3AFCA        IFNE      0
118090940922     C                   MOVEL     TAMGCA        VIDGCA
118100941231    4C                   ENDIF
118110940922     C                   MOVEL     TAMGGA        VIDGGA
118120160509     c                   if        §3arbl<>'R'
118130940922     C                   MOVEL     TAMGMA        VIDGMA
118140160509     c                   endif
118150940922     C                   MOVEL     TAMGVA        VIDGVA
118160970128     C                   MOVEL     TAMBAM        VIDBAM
118170080326   3ac                   endif
118180080326     c
118190941231   X3C                   ELSE
118200941221     C*
118210941221     C* PULISCO I CAMPI CHE PRENDO DA TARIFFA
118220010226     C     WNNTAR        IFEQ      *BLANKS
118230941221     C  N27              CLEAR                   VIDNAS
118240010226     C                   ENDIF
118250080326   3ac                   if        CambiaCTR='S'
118260080326     C**   WN1TAR        IFEQ      *BLANKS
118270080326     C**                 CLEAR                   VIDNT1
118280080326     C**                 ENDIF
118290040610     c                   clear                   vidbva
118300941221     C                   CLEAR                   VIDGCA
118310941221     C                   CLEAR                   VIDGGA
118320941221     C                   CLEAR                   VIDGMA
118330941221     C                   CLEAR                   VIDGVA
118340970128     C                   MOVEL     'N'           VIDBAM
118350080326   3aC                   ENDIF
118360080326    3C                   ENDIF
118370010226     C*
118380941231    1C                   ENDIF
118390940922     C*
118400950125     C* IN MANUTENZIONE SE CAMBIANO CLIENTE, CAMBIO SEMPRE
118410950125     C*     IL TIPO SERVIZIO a meno che non sia stato inserito
118420950125     C*
118430950125     C* IN IMMISSIONE TIPO SERVIZIO LO PRENDO SOLO SE NON IMMESSO
118440150424    1C*    VIDTSP        IFEQ      ' '
118450950125     C*
118460150424     C*    *IN12         OREQ      *ON
118470150424     C*    *IN15         ANDEQ     *OFF
118480150424     C*    VIDTSP        ANDEQ     BLPTSP
118490150424     C*    TAMTSP        ANDNE     BLPTSP
118500150424     C*    ilv59ric      ANDEQ     'S'
118510150424     C*    DOD           ANDEQ     0
118520150424     c*    wesore        andne     'S'
118530100330     c
118540150424     c*    wesore        andne     'S'
118550150424     c                   if        vidtsp=' ' or
118560150424     c                             (*in12 and not *in15 and
118570150424     c                             vidtsp=blptsp and tamtsp<>blptsp and
118580150424     c                             (ilv59ric='S' or CambiaCtr='S') and DOD=0
118590150424     c                             and wesore<>'S')
118600941110     C* DECODIFICO
118610941110     C                   Z-ADD     1             C                 3 0
118620941110     C     TAMTSP        LOOKUP    TSP(C)                                 30
118630090604     C**!30              MOVEL     DTS(C)        V2DTSP
118640090604     C   30              MOVEL     DTS08(C)      V2DTSP
118650941110     C  N30              CLEAR                   V2DTSP
118660941110     C* SALVO
118670941110     C                   MOVEL     TAMTSP        COMTSP
118680941107     c*
118690950410     C* EMETTO IL MESSAGGIO SOLO SE CIO' CHE C'E' IN BOLLA E' DIVERSO
118700950103    2C     *IN12         IFEQ      *ON
118710941110     C     *IN15         ANDEQ     *OFF
118720941107     C                   MOVEA     ERR(17)       K78
118730941107     C*
118740950125     C                   MOVEA     BLPTSP        K78(31)
118750950125     C                   MOVEL     WDETSP        W008A             8
118760950125     C                   MOVEA     W008A         K78(33)
118770941107     C*
118780950125     C                   MOVEA     TAMTSP        K78(53)
118790090604     C**!!!              MOVEL     DTS(C)        W008A             8
118800090604     C                   MOVEL     DTS08(C)      W008A             8
118810950125     C                   MOVEA     W008A         K78(55)
118820941107     C                   MOVEA     K78           VIDMSG
118830950125     C                   CLEAR                   VIDTSP
118840950125     C                   CLEAR                   V1DTSP
118850950125     C                   CLEAR                   VARTSP
118860950410     C                   MOVEL     1             DOD
118870950410     C                   SETON                                        9048
118880950103    2C                   ENDIF
118890950103    1C                   ENDIF
118900941107     C*
118910151106     c                   if        vidnt1=vidnt2
118920151106     c                   clear                   vidnt2
118930151106     c                   endif
118940940922     C                   ENDSR
118950021120      *---------------------------------------------------------------*
118960021120      * Ricerco e carico tariffe
118970021120      *---------------------------------------------------------------*
118980021120     c     TarCar        BegSr
118990021120
119000160218     c* recupero il network bolla per il caricamento tariffe
119010021120     c                   exsr      riccar
119020160302     c** 90              goto      endTar
119030021120     c                   movel     o27fie        wfie
119040021120
119050021120     c* protezione p.iva del mittente
119060021120     c     *in04         ifeq      *on
119070021120     c                   select
119080021120     c     o27ntw        wheneq    'DPD'
119090021120     c     desefd        andeq     *blanks
119100021120     c     wdesie        andeq     'E'
119110021120     c                   seton                                        39
119120021120     c     o27ntw        wheneq    'FED'
119130021120     c     deseff        andeq     *blanks
119140021120     c     wdesie        andeq     'E'
119150021120     c                   seton                                        39
119160021120     c     o27ntw        wheneq    'EEX'
119170021120     c     deseft        andeq     *blanks
119180021120     c     wdesie        andeq     'E'
119190021120     c                   seton                                        39
119200021120     c     o27ntw        wheneq    'PPT'
119210021120     c     o27ntw        oreq      'COR'
119220021120     C                   SETON                                        39
119230021120     c                   endsl
119240021120     c                   endif
119250021120     C***
119260021120     C*** CARICAMENTO DEI CODICI TARIFFA ***
119270050921     C                   CLEAR                   fnlv59ds
119280080403     c                   clear                   CambiaCTR         1
119290080403     c*
119300150424     c                   if        *in29 and vidctr<>savctr
119310080403     C                   MOVEL     'S'           ilv59ric
119320080403     c                   MOVEL     'S'           CambiaCTR
119330080403     c                   endif
119340021120     C*
119350021120     C* SE MODIFICATO IL FLAG ITALIA ESTERO --> SEMPRE
119360021120     C     WFIE          IFNE      SAVFIE
119370160219     C     O27NTW        ORNE      S_27NTW
119380160219     C
119390160219     c
119400050921     C                   MOVEL     'S'           ilv59ric
119410021120     C                   MOVEL     WFIE          SAVFIE
119420160219     C                   MOVEL     O27NTW        S_27NTW
119430021120     C                   ENDIF
119440021120     C* IL TIPO SERVIZIO
119450160303     C     VIDTSP        IFNE      VARTSP
119460160428     C                   IF        VIDTSP=*BLANKS
119470160428     C                   MOVEL     'S'           ilv59ric
119480160428     C                   else
119490160428     C                   MOVEL     'S'           ilv59ta4
119500160428     c                   endif
119510160303     C                   MOVEL     VIDTSP        VARTSP
119520160303     C                   ENDIF
119530021120     C*
119540021120     C*  IL CODICE MITTENTE PER MANUTENZIONE
119550021120    1C     *IN12         IFEQ      *OFF
119560021120     C     *IN15         OREQ      *OFF
119570021120     C*
119580021120     C* DA ASSEGNATO CODIFICATO AD ASSEGNATO NON CODIFICATO --> PULISCO
119590021120     C*  I CAMPI PRESI DA TARIFFA
119600021120    2C     VIDCCM        IFEQ      9999
119610021120     C     SAVCCM        IFNE      0
119620021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
119630021120     C                   MOVEL     *ZEROS        SAVCCM
119640021120     C                   CLEAR                   TRE
119650021120     C                   CLEAR                   DOD
119660021120     C*
119670021120     C* VADO IN CARICAMENTO TARIFFA SOLO PER PULIRE LE SKIERE
119680050921     C                   MOVEL     'S'           ilv59ric
119690080403     C                   MOVEL     'S'           CambiaCTR
119700080403     c
119710021120     C                   ENDIF
119720021120     C*
119730021120   X2C                   ELSE
119740021120     C* ASSEGNATO CON MITTENTE CODIFICATO
119750021120     C*
119760021120     C* MITTENTE MODIFICATO
119770021120    3C     WKSC          IFNE      SAVCCM
119780050921     C                   MOVEL     'S'           ilv59ric
119790080403     C                   MOVEL     'S'           CambiaCTR
119800160429     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
119810160429     c* mettere in RI i campi presi da tariffa per avvisare della variazione
119820160429     c                   if        *in12 and not *in15
119830160429     c                   seton                                        97
119840160429     c     atrbva        ifne      prri
119850160429     c                   movel     riul          atrbva
119860160429     c                   endif
119870160429     c                   endif
119880021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
119890021120     C                   MOVEL     WKSC          SAVCCM
119900021120     C                   CLEAR                   TRE
119910021120     C                   CLEAR                   DOD
119920021120    3C                   ENDIF
119930021120    2C                   ENDIF
119940021120     C* VARIATO NUMERO ORM
119950021120     C     CHGORM        IFEQ      'S'
119960021120     C                   CLEAR                   CHGORM
119970130404     C******             MOVEL     'S'           ilv59ric
119980021120     C                   ENDIF
119990021120     C*
120000021120    1C                   ENDIF
120010150424      * Se cambiato codice tariffa tra prima e seconda videata
120020150424      * devo far assumere questa variazione a fnlv59r in modo da
120030150424      * ricevere i dati della nuova tariffa
120040150424     c                   if        vidctr<>savctr and ilv59ric=' '
120050150424     c                   eval      ilv59con='S'
120060150424     c                   eval      CambiaCTR='S'
120070150427     c                   seton                                        97
120080160429     c     atrbva        ifne      prri
120090160429     c                   movel     riul          atrbva
120100160429     c                   endif
120110150424     c                   endif
120120021120     C*
120130021120     C* CARICO TARIFFE DEL CLIENTE
120140021120     C*
120150021120     C* IMPOSTO CODICE TARIFFA A VIDEO
120160021120     C* IN MANUTENZIONE LE TARIFFE VENGONO RICARICATE SOLO SE MODIFICAT
120170021120     C                   EXSR      RICTAR
120180021120     C* SE IL CLIENTE NON HA TARIFFA--> ERRORE FORZABILE
120190160226     C* SE IL CLIENTE NON HA TARIFFA FED --> ERRORE NON FORZABILE
120200021120     C     WTKS          IFEQ      ' '
120210021120     C     VIDCCM        ANDNE     8888
120220021120     C     VIDCCM        ANDNE     9999
120230160226     C***  WFIE          IFNE      'D'
120240160226     c     wfie          ifne      'F'
120250021120     c     wfie          andne     'N'
120260021120     c     wfie          andne     'M'
120270021120     C     TRE           IFEQ      0
120280021120     C                   MOVEL     ERR(84)       VIDMSG
120290021120     C                   SETON                                        9050
120300021120     C                   MOVEL     1             TRE
120310021120     C                   GOTO      ENDTar
120320021120     C                   ENDIF
120330021120     C                   ELSE
120340160226     c*    wfie          ifeq      'D'
120350160226     C*                  MOVEL     ERR(188)      VIDMSG
120360160226     c*                  else
120370021120     C                   MOVEL     ERR(246)      VIDMSG
120380160226     c*                  endif
120390021120     C                   SETON                                        9050
120400021120     C                   GOTO      ENDTar
120410021120     C                   ENDIF
120420021120     C                   ENDIF
120430021120
120440021120     c     EndTar        EndSr
120450020207     C*
120460160224     C* RECUPERA NETWORK TARIFFA -------------------------------------*
120470020207     C     RICCAR        BEGSR
120480020213     c*
120490021120     c                   Z-Add     VidPkg        I27Pkg
120500020213     c                   movel     vidtsp        i27tsp
120510020213     c                   z-add     vidlnp        i27lnp
120520020213     c     comlna        ifgt      *zeros
120530020213     c                   z-add     comlna        i27lna
120540020213     c                   else
120550020213     c                   select
120560020213     c     viddpd        wheneq    'D'
120570020213     c     wdesie        andeq     'E'
120580020213     c                   movel     'D'           i27tln
120590020213     c     viddpd        wheneq    'F'
120600020213     c     wdesie        andeq     'E'
120610020213     c                   movel     'F'           i27tln
120620020213     c     viddpd        wheneq    ' '
120630020213     c     wdesie        andeq     'E'
120640020213     c                   movel     'E'           i27tln
120650020213     c                   other
120660020213     c                   movel     'I'           i27tln
120670020213     c                   endsl
120680020213     c                   endif
120690020213     c     vidflc        ifgt      *zeros
120700020213     c                   movel     vidflc        i27cli
120710020213     c                   else
120720020213     c                   movel     vidlnp        i27cli
120730020213     c                   endif
120740020213     c                   move      vidccm        i27cli
120750160216     c*****              z-add     blpdsp        i27dta
120760020213     c*
120770160216     c                   call      'TRUL27R1'
120780160216     c                   parm                    trul27ds1
120790160216     c***                z-add     o27ksc        tarksc
120800160216     c***                z-add     o27ctr        tarctr
120810020319     c* errore bloccante se non trovato il progressivo
120820160216     c***  o27prg        ifge      *zeros
120830160216     c***                move      o27prg        tarprg
120840160216     c***                else
120850160216     C***                SETON                                        90
120860160216     C***                MOVEL     ERR(248)      VIDMSG
120870160216     c***                endif
120880020213     c*
120890020207     c                   ENDSR
120900091210     C*--- IMPOSTAZIONE FORZATURE FLAG DDT ------------------------
120910091210     C     SR_FRZBAM     BEGSR
120920091210     C***
120930091210     C* SE BOLLA CON OBBLIGO DDT  RIMANE IMPOSTATO "S"
120940091210     C***
120950091210     C                   SELECT
120960101104     c* Se spedizione diretta a FEDEX sempre DDT SI
120970101104     c                   when      VidDpd = 'F' or a_§OgNtw = 'FED'
120980101104     C                   MOVEL     'S'           VIDBAM
120990091210     C* SE PAESE CON ATTRAVERSAMENTO DOGANA --> OBBLIGATORIA SI DDT
121000091210     C     DESEFT        WHENNE    ' '
121010091210     C     A_§OGNTW      ANDNE     'DPD'
121020091210     C     VIDDPD        ANDEQ     ' '
121030091210     c     A_§ogntw      andne     'FED'
121040091210     C                   MOVEL     'S'           VIDBAM
121050091210     c* Se richiesta bolla firmata --> Forzo si ddt
121060091210     c     vidcbo        wheneq    'FO'
121070091210     C                   MOVEL     'S'           VIDBAM
121080091210     C* SE BOLLA DI RECUPERO --> FORZI NO DDT
121090091210     C     §3ARBL        WHENEQ    'R'
121100091210     c**** vidcbo        andne     'FO'
121110091210     C                   MOVEL     'N'           VIDBAM
121120091210     C* SE OBBLIGO DDT DA CAPPARIO FORZO SI DDT
121130091210     C     DESGDD        WHENEQ    'S'
121140091210     c     savfpr        andne     'G'
121150091210     c     savfpr        andne     'P'
121160150302     c     savfpr        andne     'B'
121170091210     C                   MOVEL     'S'           VIDBAM
121180091210     c* se bolla con estensione ddt cliente (FIVAX) forzo NO DDT
121190091210     c     §1bf16        wheneq    'S'
121200091210     c                   movel     'N'           VIDBAM
121210091210     c     §dstddt       wheneq    'S'
121220091210     c     flgtb1        andeq     'A'
121230091210     c     vidcbo        andne     'FW'
121240091210     c     vidfbr        andne     'S'
121250091210     c     savfpr        andne     'G'
121260091210     c     savfpr        andne     'P'
121270091210     c                   movel     'S'           vidbam
121280091210     C                   ENDSL
121290091210     c                   eval      savddt = vidbam
121300091210     c                   endsr
121310041012     C*
121320041012     C*--- IMPOSTAZIONE CONSEGNE PARTICOLARI Per destinatario disagiat*
121330041012     C     SR_IMPtc12    BEGSR
121340041012     C*
121350041012     c* Referente e numero di telefono: se campi a video con '#'
121360041012     c* sono quelli automatici (dal tisit5) e quindi li pulisco
121370041012    2c                   if        %subst(Vidref:1:1) = '#'
121380041012     c                   clear                   vidref
121390041012    2c                   endif
121400041012    2c                   if        %subst(Vidtel:1:1) = '#'
121410041012     c                   clear                   vidtel
121420041012    2c                   endif
121430041012     c*
121440060324    2c                   if        (wdisag = 'X') OR
121450060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
121460060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
121470060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
121480041012     c                   select
121490041012     c     vidtc1        wheneq    *blanks
121500041012     c                   movel     wdisag        vidtc1
121510041012     c     vidtc2        wheneq    *blanks
121520041012     c                   movel     wdisag        vidtc2
121530041012     c                   endsl
121540041012    3c     vidtc1        ifeq      vidtc2
121550041012     c                   clear                   vidtc2
121560041012    3c                   endif
121570041012    3c                   if        vidref = *blanks
121580041012     c                   movel     ot0ref        vidref
121590041012    3c                   endif
121600041012    3c                   if        vidtel = *blanks
121610041012     c                   movel     ot0tel        vidtel
121620041012    3c                   endif
121630041012   x2c                   else
121640041012     c* se destinatario non disagiato e sono in immissione pulisco tc1 e tc2
121650041012     c* entro qui anche se destinatario supermercato/appuntamento ma previst
121660041012     c* ta consegna ad uffici
121670041012    3c                   if        *in12 = '0'
121680041012      * e se era stato precedentemente impostato da programma
121690041012     c                             and savdisag <> *Blanks
121700041012     c                   Eval      savdisag = wdisag
121710041012    4c     vidtc1        ifeq      'X'
121720091001     c     vidtc1        oreq      'S'
121730041012     c     vidtc1        oreq      'A'
121740041012     c                   clear                   vidtc1
121750041012     c                   Clear                   v2dtc1
121760041012    4c                   endif
121770041012    4c     vidtc2        ifeq      'X'
121780041012     c     vidtc2        oreq      'S'
121790041012     c     vidtc2        oreq      'A'
121800041012     c                   clear                   vidtc2
121810041012     c                   Clear                   v2dtc2
121820041012    4c                   endif
121830041012    3c                   endif
121840041012     c
121850041012    2c                   endif
121860091001     c* Memorizzo forzatura consegna particolare da destinatari particolari
121870091001     c                   if        wdisag<>*blanks and
121880091001     c                             (wdisag=vidtc1 or wdisag=vidtc2)
121890091001     c                   if        *in12=*off or
121900091001     c                             (wdisag<>sav_tc1 and wdisag<>sav_tc2)
121910091001     c                   eval      w_ar5tcp=wdisag
121920091001     c                   endif
121930091001     c                   endif
121940041012     c                   endsr
121950070924     C*--- IMPOSTAZIONE giorni di chiusura per destinatario particolar*
121960070924     C     SR_IMPgc12    BEGSR
121970070924     c*
121980070924    2c                   if        ot0err=*blanks
121990070924     c* propongo solo se a video non è stato specificato nulla.
122000070924     c* In manutenzione solo se cambiato il destinatario
122010070924     c                   if        vidgc1=*blanks and vidgc2=*blanks
122020070924     c                             and (*in12='0' or *in15='1' or
122030070924     c                             vidrsd<>savrsd or vidind<>savind or
122040070924     c                             vidprd<>savprd or vidcad<>savcad or
122050070924     c                             vidlod<>savlod or vidnzd<>savnzd)
122060070924     c                   eval      vidgc1=OT0X1GC1
122070070924     c                   eval      vidgc2=OT0X1GC2
122080070924     c                   endif
122090070924   x2c                   else
122100070924     c* se destinatario non presente e sono in immissione pulisco gc1 e gc2
122110070924    3c                   if        *in12 = '0'
122120070924      * e se era stato precedentemente impostato da programma
122130070924     c                             and savpart <> *Blanks
122140070924     c                   Eval      savpart = *blanks
122150070924     c                   clear                   vidgc1
122160070924     c                   Clear                   vidgc2
122170070924    3c                   endif
122180070924     c
122190070924    2c                   endif
122200070924     c                   endsr
122210900502     C*
122220900502     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
122230940819     C     INZ02         BEGSR
122240950126     C*
122250950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
122260971210     C                   EXSR      OFFD02
122270900502     C*
122280940923     C* SPENGO INDICATORI CHE EVIDENZIANO LE VALUTE
122290940923     C                   SETOFF                                       929399
122300940825     C                   MOVEL     *ZEROS        VIDRMN
122310060619     C***                MOVEL     *ZEROS        savRMN
122320940825     C                   MOVEL     *BLANKS       VIDRMA
122330941103     C* 03 ON - PERSONALIZZAIZONE MITTENTE ORIGINALE
122340941103     C     *IN03         IFEQ      *OFF
122350900502     C                   MOVEL     *BLANKS       VIDRMO
122360940930     C                   MOVEL     *BLANKS       VIDCMO
122370940930     C                   MOVEL     *BLANKS       VIDNMO
122380941103     C                   ENDIF
122390050315     C****               MOVE      *BLANKS       VIDFFD
122400940825     C                   MOVEL     *BLANKS       VIDFBR
122410900503     C                   MOVEL     *BLANKS       DEVCTR
122420940825     C                   MOVEL     *BLANKS       VIDTC1
122430940825     C                   MOVEL     *BLANKS       V2DTC1
122440940825     C                   MOVEL     *BLANKS       VIDTC2
122450940825     C                   MOVEL     *BLANKS       V2DTC2
122460900502     C                   MOVEL     *ZEROS        VIDNCL
122470930414     C                   MOVEL     *ZEROS        VARNCL
122480940825     C                   MOVEL     *ZEROS        V2CPKG
122490980402     C                   MOVEL     *ZEROS        SAVPKG
122500900502     C                   MOVEL     *ZEROS        VIDNRS
122510900502     C                   MOVEL     *ZEROS        VIDNCD
122520900502     C                   MOVEL     *ZEROS        VIDNCA
122530940825     C                   MOVEL     *BLANKS       VIDFVR
122540900502     C                   MOVEL     *ZEROS        VIDVOL
122550980402     C                   MOVEL     *ZEROS        SAVVOL
122560090609     c                   clear                   wvol_pre
122570940825     C                   MOVEL     *ZEROS        VIDCAS
122580011107     C                   MOVEL     §GEDCN        VIDVCA
122590011107     C                   MOVEL     §GEDCN        VARVCA
122600940825     C                   MOVEL     *BLANKS       VIDTIC
122610940825     C                   MOVEL     *ZEROS        VIDVMD
122620011113     C                   MOVEL     §GEDCN        VIDVAD
122630940825     C                   MOVEL     *ZEROS        VIDIAS
122640011211     C                   MOVEL     *ZEROS        VARIAS
122650011211     C                   MOVEL     *ZEROS        WARIAS
122660011212     C                   MOVEL     *ZEROS        WARCAS
122670011212     C                   MOVEL     *ZEROS        WARVMD
122680011112     C                   MOVEL     §GEDCN        VIDVAS
122690011112     C                   MOVEL     §GEDCN        VARVAS
122700940825     C                   MOVEL     *ZEROS        VIDQFT
122710950102     C                   MOVEL     *ZEROS        VARQFT
122720910912     C                   MOVEL     *ZEROS        BLPSPE
122730940825     C                   MOVEL     *BLANKS       VIDGGA
122740940825     C                   MOVEL     *BLANKS       VIDGCA
122750940825     C                   MOVEL     *BLANKS       VIDGMA
122760940825     C                   MOVEL     *BLANKS       VIDGVA
122770940922     C                   MOVEL     *BLANKS       VIDGGR
122780940922     C                   MOVEL     *BLANKS       VIDGCR
122790940922     C                   MOVEL     *BLANKS       VIDGMR
122800940922     C                   MOVEL     *BLANKS       VIDGVR
122810940825     C                   MOVEL     *BLANKS       VIDNT1
122820940825     C                   MOVEL     *BLANKS       VIDNT2
122830110304     c                   clear                   savnot
122840010220     C                   MOVEL     *BLANKS       VARFFD
122850930401     C                   MOVEL     *ZEROS        VA2VOL
122860930401     C                   MOVEL     *ZEROS        VARPKG
122870020531     C                   MOVEL     *ZEROS        VARtc1
122880020531     C                   MOVEL     *ZEROS        VARtc2
122890060110     C                   MOVEL     *ZEROS        D_VARrsd
122900060110     C                   MOVEL     *ZEROS        D_VARind
122910060110     C                   MOVEL     *ZEROS        D_VARlod
122920060110     C                   MOVEL     *ZEROS        D_VARprd
122930060110     C                   MOVEL     *ZEROS        D_VARnzd
122940060104     c* visto che in un caso questo campo lo andrò ad impostare anche
122950060104     c* nella routine ctrd01 sposto la pulizia nella inz01
122960060104     C****               MOVEL     *ZEROS        VARZNC
122970970128     C                   MOVEL     'N'           VIDBAM
122980021217     c                   Clear                   VidTba
122990021217     c                   Clear                   VidNba
123000030808     c                   Clear                   SavNba
123010021217     c                   Clear                   VidTb2
123020021217     c                   Clear                   VidNb2
123030030808     c                   Clear                   SavNb2
123040001214     C                   CLEAR                   KOL
123050001214     C                   Z-ADD     0             XY                2 0
123060040917     c* pulisco campo per forzatura mittente
123070040917     c                   clear                   wcontmit          1
123080030731
123090030731      * pulisco i campi di attributi visualizzazione e flag di work per
123100030731      * rif.mittente alfabetico, bancali, part.consegna varie
123110040226      * rif.mittente numerico
123120030731     c                   Clear                   AtrRma
123130030731     c                   Clear                   wrma
123140030731     c                   Clear                   AtrTba
123150030731     c                   Clear                   AtrNba
123160030731     c                   Clear                   AtrTb2
123170030731     c                   Clear                   AtrNb2
123180030731     c                   Clear                   AtrGva
123190040226     c                   Clear                   AtrRmn
123200150302     c                   clear                   atrnt1
123210150302     c                   clear                   atrnt2
123220150302     c                   clear                   atrncl2
123230150302     c                   clear                   atrpkg2
123240040226     c                   Eval      wrifm = *Off
123250150427     c                   clear                   atrctr
123260030708      * pulisco i campi della window x i colli originali + sfusi
123270030708     c                   Clear                   w03rig1
123280030708     c                   Clear                   w03rig2
123290030708     c                   Clear                   w03cor
123300030708     c                   Clear                   w03csf
123310030708     c                   Clear                   At3c01
123320030708     c                   Clear                   At3cor
123330030708     c                   Clear                   At3c02
123340030708     c                   Clear                   At3csf
123350030708     c                   Clear                   At3f12
123360030708     c                   Clear                   H3riga
123370030708     c                   Clear                   H3colo
123380030708     c                   Clear                   wtotncl
123390030708     c                   Clear                   savw03cor
123400030708     c                   Clear                   savw03csf
123410030805
123420030805     c                   Clear                   savkeyorm
123430080314     c* pulisco campo per forzatura serie parziale
123440080314     c                   clear                   f_range
123450090323     c* Campo per visualizzazione taso funzionale f15=cli/tar per tassaz.
123460090323     c* porti assegnati
123470090323     c                   clear                   atrf15
123480090327     c                   exsr      sr_inzwdwcli
123490091119     c*
123500091119     c                   exsr      inzwdwcas
123510940825     C                   ENDSR
123520940825     C*
123530940825     C*--- PULIZIA CAMPI FORMATO3 ------------------------------------*
123540940825     C     INZ03         BEGSR
123550950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
123560971210     C                   EXSR      OFFD03
123570950126     C*
123580940923     C* CAMPO CHE INDICA SE DEVO OBBLIGATORIAMENTE EMETTERE IL FORMATO3
123590940923     C                   CLEAR                   WEMD03
123600940923     C* TASSAZIONE
123610971211     C                   CLEAR                   V3CLNA
123620971211     C                   CLEAR                   V3DLNA
123630991008     C                   CLEAR                   VIDDIV
123640991011     C                   CLEAR                   WDIV1
123650940826     C                   MOVEL     *ZEROS        VIDPOR
123660991012     C                   MOVEL     *ZEROS        MEMPOR
123670940825     C                   MOVEL     *ZEROS        VIDIMV
123680940825     C                   MOVEL     *ZEROS        VIDFIV
123690991029     C                   MOVEL     *ZEROS        VA2VA1
123700040130     C                   MOVEL     *ZEROS        VA2VA2
123710040130     C                   MOVEL     *ZEROS        VA2VA3
123720040130     C                   MOVEL     *ZEROS        VA2VA4
123730041217     C                   MOVEL     *ZEROS        VA2VA5
123740041217     C                   MOVEL     *ZEROS        VA2VA6
123750940825     C                   MOVEL     *ZEROS        VIDNFT
123760940825     C                   MOVEL     *ZEROS        VIDDFT
123770940923     C                   MOVEL     ' '           VIDCEI
123780940826     C                   MOVEL     *BLANKS       V3DCEI
123790940929     C                   MOVEL     *BLANKS       V2DCEI
123800940923     C* PULIZIA SFL
123810940923     C                   SETON                                        35
123820160613     c* Per "Vedi Pacco DPD" in batch non si può utilizzare il file dislpay
123830160613     c                   if        savfpr<>'D'
123840941011     C                   WRITE     LS01C03
123850160613     c                   endif
123860940923     C                   SETOFF                                       35
123870940923     C*
123880940923     C                   CLEAR                   V3CSV1
123890940923     C                   CLEAR                   V3CVA1
123900940923     C                   CLEAR                   V3CEV1
123910991008     C                   CLEAR                   V3HVA1
123920940923     C*
123930160613     c                   if        savfpr<>'D'
123940941021     C                   DO        20            NRR               5 0
123950940923     C                   WRITE     LS01S03
123960940923     C                   ENDDO
123970160613     c                   endif
123980940923     C* ESTENSIONE BOLLA
123990940923     C                   MOVEL     ' '           VI2SV1
124000940923     C                   MOVEL     *ZEROS        VI2VA1
124010040114     c                   Clear                   Vi2Sv2
124020040114     c                   Clear                   Vi2Va2
124030040114     c                   Clear                   Vi2Sv3
124040040114     c                   Clear                   Vi2Va3
124050040114     c                   Clear                   Vi2Sv4
124060040114     c                   Clear                   Vi2Va4
124070041217     c                   Clear                   Vi2Sv5
124080041217     c                   Clear                   Vi2Va5
124090041217     c                   Clear                   Vi2Sv6
124100041217     c                   Clear                   Vi2Va6
124110930628     C                   MOVEL     ' '           VI2CEI
124120940923     C                   MOVEL     *BLANKS       V2DCEI
124130040121     c                   Clear                   Vi2Es1
124140040121     c                   Clear                   Vi2Es2
124150040121     c                   Clear                   Vi2Es3
124160040121     c                   Clear                   Vi2Es4
124170041217     c                   Clear                   Vi2Es5
124180041217     c                   Clear                   Vi2Es6
124190040126     c                   Clear                   Vi2Imv
124200991011     C                   CLEAR                   WDIV2
124210991011     C                   CLEAR                   VI2DIV
124220990701     C                   CLEAR                   VIDIFT
124230990701     C                   CLEAR                   SAVIMV
124240060208     C                   CLEAR                   SAVIMVO
124250151014     C                   CLEAR                   SAVIMV_fat
124260151014     c                   Clear                   PesVolPkcn
124270151014     c                   Clear                   PesVolSpc
124280151014     c                   Clear                   PesVolImv
124290991008      *
124300900502     C                   ENDSR
124310971210     C**
124320971210     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
124330971210     C     INZ06         BEGSR
124340081008     C**                 CLEAR                   V6CINS
124350081008     C**                 CLEAR                   V6CSTA
124360971210     C                   CLEAR                   V6CAWB
124370971211     C                   CLEAR                   SAVAWB
124380081008     C**                 CLEAR                   V6CLNA
124390081008     C**                 CLEAR                   V6DLNA
124400971210     C                   ENDSR
124410900502     C*
124420991203     C**
124430991203     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
124440991203     C     INZ07         BEGSR
124450991203     C                   CLEAR                   V7CNPR
124460991203     C                   CLEAR                   SAVNPR
124470991203     C                   CLEAR                   V7CLNA
124480991203     C                   CLEAR                   V7DLNA
124490061003     C***                CLEAR                   savfnp
124510991203     C                   ENDSR
124520000829     C*
124530000829     C*--- PULIZIA CAMPI FORMATO8 ------------------------------------*
124540000829     C     INZ08         BEGSR
124550000829     C*
124560000829     C                   CLEAR                   V8CKSC
124570000829     C                   CLEAR                   V8DKSC
124580000829     C* PULIZIA SFL
124590000829     C                   SETON                                        35
124600160613     c* Per "Vedi Pacco DPD" in batch non si può utilizzare il file dislpay
124610160613     c                   if        savfpr<>'D'
124620000829     C                   WRITE     LS01C08
124630160613     c                   endif
124640000928     C                   SETOFF                                       357833
124650000829     C                   MOVE      *ZEROS        V8CNBR
124660000829     C                   MOVE      *ZEROS        NR8
124670000918     C                   MOVE      *ZEROS        SAVNR8
124680000829     C*
124690000829     C                   CLEAR                   V8CSCE
124700000829     C                   CLEAR                   V8CNOT
124710000908     C                   CLEAR                   V8HDKC
124720000908     C                   CLEAR                   V8HESG
124730000915     C                   CLEAR                   V8HST2
124740000915     C                   CLEAR                   V8HFLS
124750000915     C                   CLEAR                   V8HLNA
124760000915     C                   CLEAR                   V8HNRS
124770000915     C                   CLEAR                   V8HNSC
124780000921     C                   CLEAR                   V8HPRE
124790000830     C*
124800000830     C* PULISCO ANCHE CAMPO FORMATO 9
124810000830     C                   CLEAR                   V9CNOT
124820000921     C                   CLEAR                   CH2
124830000921     C                   CLEAR                   I2
124840000829      *
124850000829     C                   ENDSR
124860960404     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
124870940825     C     CTRD02        BEGSR
124880940929     C                   CLEAR                   WEMFOR
124890941115     C                   CLEAR                   VIDMSG
124900930414     C                   Z-ADD     0             COMCTR
124910940216     C                   CLEAR                   CMD8
124920000321     C                   CLEAR                   WEFT
124930160302     c* Se bolla export eex verifico se instradabile su DPD
124940160302     c* Controllo già fatto nella ctrd01 ma qui è da ripetere nel caso
124950160302     c* cambiassero il peso in conferma bolle
124960160302     c                   if        *in12 and *in15
124970160302     c                   clear                   w_adpd
124980160302     c                   if        viddpd=' ' and wdesie='E' and
124990160302     c                             (vidlna = *zeros or vidlna=*blanks)
125000160302     c                             and not *in44
125010160407     c                             and §lpfpr<>'O' and partch<>'P'
125020160407     c                             and §3arbl<>'R'
125030160302     c                             and not *in04
125040160302     c                   exsr      sr_instrADPD
125050160302     c                   endif
125060160302     c                   endif
125070160406     c* In immissione bolle se immesso il volume verifico subito se rientra
125080160406     c* nei limiti per instradamento forzato a dpd
125090160406     c* (W_aDpd viene utilizzato per la ricerca della cartello in caso di bolla
125100160406     c* di cliente codificato con manca tariffa )
125110160406     c* se invece il volume non è immesso il controllo viene comunque rieseguito
125120160406     c* dopo il calcolo del volume automatico
125130160406     c                   if        not *in12 and w_aDpd='S' and vidvol>§16vld
125140160406     c                   eval      w_aDpd='N'
125150160406     c                   endif
125160160302     c* Se si vuole instradare a DpD una bolla EEX devo richiamare il
125170160302     c* cappario DPD per verificare che esista altrimenti devo mantenere
125180160302     c* EEX
125190160303    1c                   if        (not *in12 or *in15)
125200160303    2c                   select
125210160303   WHc                   when      w_aDpd='S'
125220170928     c***                exsr      sr_tisie3
125230170928    3C***                IF        Osie3err <> ' '
125231171006     c                   eval      wlna_dp=deslad
125232170928     c                   exsr      sr_tisicDpd
125233170928    3C                   IF        wCDpdErr <> ' '
125240160302     c                   eval      w_aDpd='N'
125250160303     c                   clear                   comlna
125260160303   x3c                   else
125270160302     C* IMPOSTO LNA DPD SE NON 'C'E'
125280160302     C                   Z-ADD     DESLAD        COMLNA
125290160303    3c                   endif
125300160303   WHc                   when      w_aDpd='N'
125310160303     c                   clear                   comlna
125320160303    2c                   endsl
125330160303     c* Se eseguirò instradamento forzato a DPD
125340160303     c* Ripeto il controllo obbligatorietà p.iva destinatario già fatto
125350160303     c* in prima videata
125360160303     c                   if        w_aDpd='S' and
125370160303     c                             vidpid=*blanks and desefd<>*blanks
125380160303     C                   MOVEL     ERR(88)       VIDMSG
125390160303     c                   eval      vidmsg=%trim(vidmsg)+'; F12=x inserirla'
125400160303     C                   SETON                                        90
125410160303     C                   GOTO      ENDC02
125420160303     c                   endif
125430160324     c* Si è deciso di non memorizzare mai mail e cell per sped eex per
125440160324     c* le quali si forza l'instradamento a dpd e quindi non servono più
125450160324     c* le seguenti specifiche
125460160324     c****               if        wemdest<>*blanks and wdesie='E'
125470160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
125480160324     c****               clear                   wemdest
125490160324     c****               endif
125500160324     c****               if        wsms<>*blanks and wdesie='E'
125510160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
125520160324     c****               clear                   wsms
125530160324     c****               endif
125540160303    1c                   endif
125550160302
125560000321     C* SE DPD PAESE EFTA DA DPD
125570020319     C     A_§OGNTW      IFEQ      'DPD'
125580020204     C     VIDDPD        OREQ      'D'
125590160224     C     w_aDpd        OREQ      'S'
125600000321     C                   MOVEL     DESEFD        WEFT
125610000321     C                   ELSE
125620020213     c     A_§ogntw      ifeq      'FED'
125630020201     c     viddpd        oreq      'F'
125640020130     c                   movel     deseff        weft
125650020130     c                   else
125660000321     C                   MOVEL     DESEFT        WEFT              1
125670000321     C                   ENDIF
125680020130     C                   ENDIF
125690000321     C**
125700980219     C* SE VARIATO IMPORTO C/A LO SALVO
125710980219     C     *IN11         IFEQ      *ON
125720980219     C                   MOVEL     '1'           WIN11             1
125730980219     C                   ENDIF
125740980219     C* SE VARIATO IMPORTO ME LO SALVO
125750980219     C     *IN88         IFEQ      *ON
125760980219     C                   MOVEL     '1'           WIN88             1
125770980219     C                   ENDIF
125780940825     C***
125790940825     C*** MITTENTE ***
125800940825    1C     *IN02         IFEQ      *OFF
125810970703     C                   MOVEL     VIDRSM        I14RSC
125820970703     C                   CLEAR                   I14RS2
125830970703     C                   MOVEL     VIDINM        I14IND
125840970703     C                   MOVEL     VIDLOM        E14LOC
125850970703     C                   MOVEL     VIDPIM        E14PIP
125860970703     C                   MOVEL     VIDPRM        E14PRV
125870970703     C                   MOVEL     VIDNZM        E14NAR
125880970703     C                   MOVEL     VIDCAM        E14CAP
125890970704     C                   MOVEL     'M'           WCLI
125900061110     c   22              movel     vidcdf        wcdf
125910071023     c   22              movel     vidpim        wiva
125920970704     C                   EXSR      CTRIND
125930941020     C*
125940941020     C* CAMPI CHE POSSO AVER IMPOSTATO
125950970703     C                   MOVEL     E14LOC        VIDLOM
125960970703     C                   MOVEL     E14PIP        VIDPIM
125970970703     C                   MOVEL     E14PRV        VIDPRM
125980970703     C                   MOVEL     E14NAR        VIDNZM
125990970703     C                   MOVEL     E14CAP        VIDCAM
126000061109     C*
126010061109     c* Se errore sulla partita iva , visualizzo messaggio
126020061109     c                   if        xcfivaflg < *zeros
126030120504     c                   if        wcdf=*blanks OR %subst(wcdf:12:1)=' '
126040071023     c                   z-add     07            h2riga
126050071022     c                   else
126060071023     c                   z-add     08            H2riga
126070071022     c                   endif
126080061109     c                   z-add     64            H2colo
126090061109     c                   endif
126100970704     C*
126110970704     C     WEMFOR        IFEQ      '1'
126120970704     C     *IN90         OREQ      *ON
126130970704     C                   GOTO      ENDC02
126140970704     C                   ENDIF
126150040917     c* Segnalazione se inserito mittente estero
126160160628     c     savfpr        ifne      'G'
126170160628     c     savfpr        andne     'P'
126180160829     c     savfpr        andne     'D'
126190160628     c     wmitie        andeq     'E'
126200040917     c     wcontmit      andeq     *blanks
126210040917     c                   movel     '1'           wcontmit
126220040917     c                   seton                                        90
126230040917     c                   z-add     7             h2riga
126240040917     c                   z-add     49            h2colo
126250040917     c                   movel     ERR(283)      vidmsg
126260040917     c                   goto      endc02
126270040917     c                   endif
126280061110     C
126290061110     C** SE PREPAGATO 8888, CERCO IL CODICE FISCALE SE NON INSERITO
126300120503     C   22              IF        VIDCCM=8888 AND VIDNZM=*BLANKS AND
126310120504     C                             (VIDCDF=*BLANKS or vidpim=*blanks)
126320120503     C                   EXSR      CALLYCO
126330120503     C                   ENDIF
126340970704     C**
126350950303     C* SE BOLLA DIRETTA ALL'ESTERO --> P.IVA OBBLIGATORIA
126360120515     c* oppure obbligatorio il codice fiscale lungo 16
126370970704    2C     WDESIE        IFEQ      'E'
126380000321     C     WEFT          ANDNE     *BLANKS
126390050427     c     §3arbl        andne     'R'
126400120515     C***  VIDPIM        ANDEQ     *BLANKS
126410120515     c                   if        vidpim=*blanks and
126420120515     c                             (vidcdf=*blank or %subst(vidcdf:12:1)=' ')
126430950303     C                   MOVEL     '1'           WEMFOR
126440950303     C                   SETON                                        7090
126450120515     C                   MOVEL     ERR(346)      VIDMSG
126460950303     C                   GOTO      ENDC02
126470120515     c                   endif
126480000120    2C                   ENDIF
126490970704    1C                   ENDIF
126500930331     C***
126510930331     C*** NUMERO COLLI     ***
126520940928    1C     VIDNCL        IFNE      V1CNCL
126530940825     C                   MOVEL     ERR(45)       VIDMSG
126540940922     C                   SETON                                        4190
126550940920     C                   GOTO      ENDC02
126560940928    1C                   ENDIF
126570930331     C***
126580930331     C*** PESO ***
126590940928    1C   12V2CPKG        IFEQ      0
126600941110     C                   MOVEL     ERR(46)       VIDMSG
126610940922     C                   SETON                                        4290
126620940920     C                   GOTO      ENDC02
126630940928    1C                   END
126640030204      * Manutenzione di bolla con bancali
126650030204      * Se viene modificato il peso o il volume
126660030204      * emetto un msg info
126670030204     c                   If        *In12 and Not *In15                      and
126680030204     c                             (VidNba > *Zeros or VidNb2 > *Zeros)     and
126690030204     c                             (V2cPkg <> SavPkg or Vidvol <> SavVol)   and
126700110921     c                             wPkg = *Blanks                           and
126710110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
126720030204     c                   Eval      wPkg = '1'
126730030204     c                   Eval      VidMsg = Err(272)
126740030204     c                   If        V2cPkg <> SavPkg
126750030204     c                   Eval      *In42 = *On
126760030204     c                   EndIf
126770030204     c                   If        Vidvol <> SavVol
126780030204     c                   Eval      *In47 = *On
126790030204     c                   EndIf
126800030204     c                   Eval      *In90 = *On
126810030204     c                   GoTo      EndC02
126820030204     c                   EndIf
126830980402     C*
126840090609    1C** 12V2CPKG        IFGT      §QTPKB
126850090609     C**   V2CPKG        ANDNE     SAVPKG
126860090609     C**                 MOVE      V2CPKG        SAVPKG
126870090609     C***                CLEAR                   WPT1
126880980623     C* PREPARO MSG
126890090609     C***                MOVEA     ERR(52)       K78
126900090609     C***                MOVEL     §QTPKB        W006A             6
126910090609     C***                MOVEA     W006A         SKI(10)
126920090609     C***                Z-ADD     10            I                 3 0
126930090609     C***                EXSR      ABBL
126940090609     C***                MOVEA     SKI(10)       K78(34)
126950090609     C***                MOVE      §QTPKB        W001A
126960090609     C***                MOVEL     W001A         K78(41)
126970090609     C***                MOVEA     K78           VIDMSG
126980090609     C***                SETON                                        4290
126990090609     C***                GOTO      ENDC02
127000090609    1C**                 END
127010000509     C*
127020000509     C     V2CPKG        IFNE      SAVPKG
127030000509     C                   CLEAR                   WPT1
127040000509     C                   MOVE      V2CPKG        SAVPKG
127050000509     C                   ENDIF
127060000509     C*
127070930331     C* NON CONTROLLO SE SONO IN MANUTENZIONE PERCHE' NON ESISTE DISCOR
127080940928    1C  N12VIDPKG        IFNE      V2CPKG
127090940825     C                   MOVEL     ERR(38)       VIDMSG
127100940922     C                   SETON                                        4290
127110940920     C                   GOTO      ENDC02
127120940928    1C                   END
127130160322     c* Ricarica network bolla per FED se peso modificato
127140160322     c                   if        *in12 and
127150160322     c                             (a_§ogntw='FED' or viddpd='F')
127160160322     c                   clear                   trul27ds1
127170160322     c                   eval      i27tip=wtip
127180160322     c                   z-add     v2cpkg        vidpkg
127190160322     c                   exsr      riccar
127200160322     c                   movel     o27fie        wfie
127210160322     c                   endif
127220021120
127230021120     c                   If        *In12
127240021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
127250021120      * a quanto indicato in tabella "DFE"
127260021121     c                   If        O27Fie = 'N' and V2cPkg > §DfePkgD
127270021120     c                   Movel     Err(264)      VidMsg
127280021120     c                   Eval      *In90 = *On
127290021120     c                   Eval      *In42 = *On
127300021120     c                   GoTo      EndC02
127310021120     c                   EndIf
127320021120     c                   EndIf
127330930331     C***
127340941107     C*** CODICE TARIFFA ***
127350050921     C                   CLEAR                   fnlv59ds
127360050921     C                   MOVEL     'S'           ilv59con
127370050921     C                   MOVEL     'P'           ilv59tbo
127380040512      * se bolla monovaria pulisco il tipo bolla
127390040512     C                   IF        §3ASVA <> *BLANK
127400050921     C                   CLEAR                   ilv59tbo
127410050921     C                   movel     'P'           ilv59prp
127420040512     C                   ENDIF
127430040512
127440050921     C                   MOVEL     WKSC          ilv59ksc
127450050921     C                   MOVEL     KCI           ilv59kci
127460050921     C                   MOVEL     WFIE          ilv59fie
127470050921     C                   MOVEL     VIDCTR        ilv59ctr
127480050921     C                   MOVEL     BLPDSP        ilv59dsp
127490050921     C                   MOVEL     VIDTSP        ilv59tsp
127500060515     c* Se non  cambiato il cod tariffa nè il cod cliente e
127510060515     c*  sono in manutenzione, non controllo in assenza di tariffe
127520060515     c*  se tariffa bloccata o usata per altri network
127530060515     c                   if        wksc=bolksc and vidctr=bolctr
127540060515     C                             AND *IN12 AND NOT *IN15
127550060515     C                   EVAL      ILV59TA2='B'
127560060515     C                   ENDIF
127570150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
127580150415     c* accetto anche tariffe bloccate
127590150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
127600150415     c                              and §3arbl='R' and §lpimv>0)
127610150415     C                   EVAL      ILV59blo='S'
127620150415     c                   endif
127630941107     C*
127640050921     C                   CALL      'FNLV59R'
127650050921     C                   PARM                    fnlv59ds
127660050921     C                   MOVEL     olv59dfs      DEFCTR
127670941107     C*
127680941107     C* ATTIVATA LA RICERCA
127690050921     C     olv59err      IFEQ      'R'
127700050921     C                   MOVEL     olv59ctr      VIDCTR
127710941231     C                   SETON                                        83
127720941107     C                   MOVEL     '1'           WEMFOR
127730941107     C                   GOTO      ENDC02
127740941107     C                   ENDIF
127750941107     C* ERRORE
127760050921     C     olv59msg      IFNE      *BLANKS
127770050921     C                   MOVEL     olv59msg      VIDMSG
127780941231     C                   SETON                                        9083
127790941107     C                   GOTO      ENDC02
127800941107     C                   ENDIF
127810021120
127820021120      * Per bolla FedEx
127830021120If  1c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
127840160216     c****               Movel     O27Ctr        Wctr
127850021120      * --> Se non ho trovato tariffe
127860021121      *     Naturalmente questo può capitare solo per i clienti non codificati
127870021121      *     il pezzo che riguarda i clienti codificati lo lascio ma lo asterisco
127880021120If  2c                   If        Wtks <> 'S'
127890160322     c**                 Movel     Oc7ctrc       Wctr
127900021121      * ---> se ho richiamato il trul27r con i27tip = "FM" o "FD"
127910160322If  3c                   If        I27Tip = 'FM' or I27Tip = 'FD'
127920021121      * ---> oppure ho O27Fie = 'M'
127930021122     c                             or WFie = 'M'
127940160322     c                   clear                   trulc7ds
127950160322     c                   eval      IC7tFIE =  wfie
127960160322     c                   eval      IC7DTA  =  blpdsp
127970160322     c                   eval      IC7PKG  =  v2cpkg
127980160322     c                   eval      IC7tip  =  i27tip
127990160322     c                   call      'TRULC7R'
128000160322     c                   parm                    trulc7ds
128010021120      * la tariffa in bolla deve essere quella della cartello
128020160322     c                   Movel     Oc7ctrc       Wctr
128030160322If  4c                   If        VidCtr <> wctr
128040021120     c                   Eval      *In83 = *On
128050021120     c                   Eval      *In90 = *On
128060021120     c                   Movel     Err(262)      VidMsg
128070021120     c                   Goto      EndC02
128080021120    4c                   EndIf
128090021120    3c                   EndIf
128100021121      * ---> se ho richiamato il trul27r con i27tip <> "FM" e "FD"
128110160322If  3c                   If        I27Tip <> 'FM' and I27Tip <> 'FD'
128120021121      * ---> e O27Fie non è = 'M'
128130021122     c                             and WFie <> 'M'
128140021121     c                   Move      Wksc          Ksc8888
128150021120      * ----> cliente non codificato
128160021120If  4c                   If        Ksc8888 = 8888
128170021120      * richiamo il trul27r xchè la tariffa in bolla deve essere una delle
128180021120      * 2 cartello FedEx
128190160216     c***                clear                   trul27ds
128200160216     c***                Z-Add     VidPkg        I27Pkg
128210160216     c***                Movel     Vidctr        I27Ctb
128220160216     c***                ExSr      RicCar
128230160229     c***90              GoTo      EndC02
128240160229     c                   clear                   trulc7ds
128250160229     c                   eval      IC7tFIE = 'F'
128260160322     c                   Z-Add     V2cPkg        Ic7Pkg
128270160229     c                   Movel     Vidctr        Ic7Ctb
128280160229     c                   call      'TRULC7R'
128290160229     c                   parm                    trulc7ds
128300160216     c                   Movel     Oc7Ctrc       Wctr
128310021120If  5c                   If        VidCtr <> WCtr
128320021120     c                   Eval      *In83 = *On
128330021120     c                   Eval      *In90 = *On
128340021120     c                   Movel     Err(262)      VidMsg
128350021120     c                   Goto      EndC02
128360021120    5c                   EndIf
128370021120    4c                   EndIf
128380021120    3c                   EndIf
128390021120    2c                   EndIf
128400021120    1c                   EndIf
128410940922     C*
128420950103     C* MEMORIZZO SEMPRE IL CODICE TARIFFE E PROGRESSIVO
128430941107     C     WTKS          IFEQ      'S'
128440050921     C                   MOVEL     olv59prg      COMPRG
128450050921     C                   MOVEL     olv59ctr      COMCTR
128460050921     C                   MOVEL     olv59div      COMDIV            3
128470991028     C*
128480991028     C                   MOVEL     'CV'          COD
128490991028     C                   MOVEL(P)  COMDIV        KEY
128500991028     C                   EXSR      CTABEL
128510991028     C                   MOVEL     TBLUNI        DSCV
128520011113     C                   MOVEL     §CVDEC        COMDEC
128530950103     C*
128540950102     C* PER MANUTENZIONE CHAIN SULLA TARIFFA
128550950102     C   12
128560950102     CANN15KTAM2         CHAIN     TNTAM000                           30
128570950102     C   12
128580950102     CANN15*IN30         IFEQ      *ON
128590950102     C                   CLEAR                   WTKS
128600050914     c                   else
128610050914     C                   MOVEL     TAMflo        dsta01
128620950102     C                   ENDIF
128630950102     C*
128640950103     C* SE HO CAMBIATO IL CODICE TARIFFA, DEVO RIPROPORRE I CAMPI MODIF
128650940928    2C     VIDCTR        IFNE      SAVCTR
128660940922     C                   SETON                                        97
128670040610     c     atrbva        ifne      prri
128680040610     c                   movel     riul          atrbva
128690040610     c                   endif
128700950102     C* E' COME SE AVESSI MODIFICATO IL MITTENTE: RICARICO I DATI
128710080326     c                   eval      CambiaCTR='S'
128720050921     C                   MOVEL     'S'           ilv59ric
128730940922     C                   EXSR      CTNTAM
128740091210     c* verifico se impostare eventuali forzature flag DDT
128750091210     c                   EXSR      SR_FRZBAM
128760950102     C*
128770940922     C                   MOVEL     VIDCTR        SAVCTR
128780941231     C                   MOVEL     '1'           WEMFOR
128790950102     C                   CLEAR                   UND
128800041012     c* se destinatario supermercato/appuntamento ed in base a vidgva
128810041012     c* devo eventualmente aggiungere o togliere telefono,referente,tc1
128820041012     c* e tc2
128830041012     c     §ogntw        ifne      'PPT'
128840041012     c                   exsr      SR_IMPtc12
128850041012     c                   endif
128860940922     C                   GOTO      ENDC02
128870940928    2C                   ENDIF
128880930331     C*
128890940922    1C                   ENDIF
128900930331     C***
128910930331     C*** VOLUME ***
128920940928    1C     VIDVOL        IFGT      §QTVLB
128930980402    1C     VIDVOL        ANDNE     SAVVOL
128940980402     C                   MOVE      VIDVOL        SAVVOL
128950980623     C* PREPARO MSG
128960090609     C***                MOVEA     ERR(26)       K78
128970090609     C***                MOVEL     §QTVLB        W002A             2
128980090609     C***                MOVEA     W002A         SKI(14)
128990090609     C***                Z-ADD     2             I                 3 0
129000090609     C***                EXSR      ABBL
129010090609     C***                MOVEA     SKI(14)       K78(36)
129020090609     C***                MOVE      §QTVLB        W003A
129030090609     C***                MOVEA     W003A         K78(39)
129040090609     C***                MOVEA     K78           VIDMSG
129050090609     C***                SETON                                        4790
129060090609     C***                GOTO      ENDC02
129070940928    1C                   ENDIF
129080090609     c*
129090930331     C* CALCOLO VOLUME
129100050415     c* prima però se bancali 'O' devo controllare i bancali per avere
129110050415     c* il n.colli originali per calcolare correttamente il volume auto
129120050415     c* matico
129130050415     c                   if        %subst(vidgva:1:1)='O'
129140050415     c                   exsr      sr_CntPVBan
129150050415     c     wemfor        ifeq      '1'
129160050415     c                   goto      endc02
129170050415     c                   endif
129180050415     c                   endif
129190050913     c* Se previsto da tariffa richiedo obbligatorio l'inserimento del volum
129200050926     c                   select
129210050926     c* §taovb='M' --> obbligatorio l'inserimento del volume --> no calcolo
129220050926     c*                automatico
129230050926     c                   when      vidvol=0 and §taovb = 'M'
129240050913     C                   MOVEL     ERR(293)      VIDMSG
129250050913     C                   SETON                                        4790
129260050913     c                   goto      endc02
129270050926     c* §taovb='O' --> se volume non immesso errore forzabile --> calcolo
129280050926     c*                opzionale del volume automatico
129290050926     c                   when      vidvol=0 and §taovb = 'O' and fvol = ' '
129300050926     C                   MOVEL     ERR(293)      VIDMSG
129310050926     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
129320050926     C                   SETON                                        4790
129330050926     c                   eval      fvol = '1'
129340050926     c                   goto      endc02
129350050926     c                   endsl
129360050913     c*
129370930331     C                   EXSR      CALVOL
129380160406     c* se bolla che prevede instradamento forzato a dpd tolgo la forzatura se
129390160406     c* il volume suepera il max stabilito
129400160406     c                   if        (not *in12 or *in15) and
129410160406     c                             w_aDpd='S' and varvol>§16vld
129420160406     c                   eval      w_aDpd='N'
129430160406     c                   clear                   weft
129440160406     c                   clear                   comlna
129450160406     c                   endif
129460100607     c* controllo i limiti di colli peso e volume
129470100607     c
129480100607     c                   z-add     vidncl        wncl
129490100607     c                   z-add     v2cpkg        wpes
129500100607     c                   z-add     vidvol        wvol
129510100607     c                   if        vidvol=0
129520100607     c                   z-add     varvol        wvol
129530100607     c                   endif
129540100607     c                   eval      wvid='2'
129550100607     c                   exsr      sr_limtsp
129560100607     c                   if        *in90
129570100607     C                   MOVEL     wmsgtsp       VIDMSG
129580100607     C                   GOTO      ENDC02
129590100607     c                   endif
129600020531     C***
129610020531     C*** CONSEGNE PARTICOLARI ***
129620020531     c* N.B.: Ho spostato il controllo delle consegne particolari prima del
129630020531     c*       del richiamo all'fnlv13r perchè con la gestione dei supermerca
129640020531     c*       ti le devo passare a lv13 affinchè il tisi95r mi ritorni la
129650020531     c*       giusta lna e zona. Prima il controllo veniva fatto dopo il
129660020531     c*       controllo dei giorni di chiusura
129670020531     C                   MOVEL     *BLANKS       DB0DC1
129680020531     C                   MOVEL     *BLANKS       V2DTC1
129690020531    1C     VIDTC1        IFNE      ' '
129700020531     C                   MOVEL     '1P'          COD
129710020531     C* RICERCA
129720020531    2C     VIDTC1        IFEQ      '?'
129730020531     C                   EXSR      CX§TAB
129740020531     C                   MOVEL     §KEY          VIDTC1
129750020531     C                   MOVEL     §DES          V2DTC1
129760020531     C                   GOTO      ENDC02
129770020531    2C                   END
129780020531     C* CONTROLLO
129790020531     C                   MOVEL(P)  VIDTC1        KEY
129800020531     C                   EXSR      CTABEL
129810020531     C  N30              MOVEL     TBLUNI        DS1P
129820020531     C* ERRORE: INESISTENTE
129830020531    2C     *IN30         IFEQ      *ON
129840020531     C*         NON UTILIZZABILE IN PARTENZA
129850020531     C     §1PUPR        ORNE      'S'
129860020531     C     §ogntw        ANDNE     'PPT'
129870020531     C                   MOVEL     ERR(102)      VIDMSG
129880020531     C                   SETON                                        6390
129890020531     C                   GOTO      ENDC02
129900020531    2C                   ENDIF
129910020531     C*
129920020531     C                   MOVEL     §1PDES        DB0DC1
129930020531     C                   MOVEL     §1PDES        V2DTC1
129940120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
129950020531    2C     §ogntw        IFEQ      'PPT'
129960020531    3C     §1PFPC        IFNE      'E'
129970020531     C     §1PFPC        ANDNE     'P'
129980020531     C                   MOVEL     ERR(198)      VIDMSG
129990020531     C                   SETON                                        6390
130000020531     C                   GOTO      ENDC02
130010020531    3C                   ENDIF
130020020531    2C                   ENDIF
130030020531    1C                   ENDIF
130040020531     C***
130050020531     C                   MOVEL     *BLANKS       DB0DC2
130060020531     C                   MOVEL     *BLANKS       V2DTC2
130070020531    1C     VIDTC2        IFNE      ' '
130080020531     C                   MOVEL     '1P'          COD
130090020531     C* RICERCA
130100020531    2C     VIDTC2        IFEQ      '?'
130110020531     C                   EXSR      CX§TAB
130120020531     C                   MOVEL     §KEY          VIDTC2
130130020531     C                   MOVEL     §DES          V2DTC2
130140020531     C                   GOTO      ENDC02
130150020531    2C                   END
130160020531     C* CONTROLLO
130170020531     C                   MOVEL(P)  VIDTC2        KEY
130180020531     C                   EXSR      CTABEL
130190020531     C  N30              MOVEL     TBLUNI        DS1P
130200020531     C* ERRORE: INESISTENTE
130210020531    2C     *IN30         IFEQ      *ON
130220020531     C*         NON UTILIZZABILE IN PARTENZA
130230020531     C     §1PUPR        ORNE      'S'
130240020531     C     §ogntw        ANDNE     'PPT'
130250020531     C                   MOVEL     ERR(102)      VIDMSG
130260020531     C                   SETON                                        6490
130270020531     C                   GOTO      ENDC02
130280020531    2C                   ENDIF
130290120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
130300020531    2C     §ogntw        IFEQ      'PPT'
130310020531    3C     §1PFPC        IFNE      'E'
130320020531     C     §1PFPC        ANDNE     'P'
130330020531     C                   MOVEL     ERR(198)      VIDMSG
130340020531     C                   SETON                                        6490
130350020531     C                   GOTO      ENDC02
130360020531    3C                   ENDIF
130370020531    2C                   ENDIF
130380020531     C* NON POSSONO ESSERE UGUALI
130390020531     C     VIDTC1        IFEQ      VIDTC2
130400020531     C                   MOVEL     ERR(121)      VIDMSG
130410020531     C                   SETON                                        6490
130420020531     C                   GOTO      ENDC02
130430020531    2C                   ENDIF
130440020731     C* Non è possibile indicare contemporaneamente consegne particolari
130450051121     C*  'S' ed 'X' / 'S' ed 'A' / "S" e "P" / "X" e "P"
130460020731    2C                   IF           (VIDTC1 = 'X'  and  VIDTC2 = 'S')
130470020731     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'X')
130480050915     C                             or (VIDTC1 = 'A'  and  VIDTC2 = 'S')
130490050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'A')
130500050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'P')
130510050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'S')
130520051121     C*                            or (VIDTC1 = 'X'  and  VIDTC2 = 'A')
130530051121     C*                            or (VIDTC1 = 'A'  and  VIDTC2 = 'X')
130540050915     C                             or (VIDTC1 = 'X'  and  VIDTC2 = 'P')
130550050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'X')
130560020731     C                   movel     ERR(257)      VIDmsg
130570050915     c                   eval      %subst(vidmsg:67:1) = vidtc1
130580050915     c                   eval      %subst(vidmsg:73:1) = vidtc2
130590020731     C                   seton                                        6490
130600020731     C                   goto      ENDC02
130610020731    2C                   ENDIF
130620020531     C*
130630020531     C                   MOVEL     §1PDES        DB0DC2
130640020531     C                   MOVEL     §1PDES        V2DTC2
130650020531    1C                   ENDIF
130660150413
130670020531     c* Se destinatario disagiato o supermercato errore se non indicato
130680020531     c* in nessuno dei due campi di consegna particolare
130690040608     c* idem se destinatario con appuntamento
130700041012     c*
130710041012     c* Se particolarità varia="U" --> consegna ad uffici devo invece
130720041012     c* dare errore se immesso supermercato o appuntamento
130730041012     c                   if        %subst(vidgva:1:1)='U'
130740041013     c                             and (vidtc1='S' or vidtc1='A' or vidtc2='S'
130750041013     c                             or vidtc2='A')
130760041012     C                   MOVEl     ERR(285)      vidmsg
130770041012     C                   SETON                                        636490
130780041012     C                   GOTO      ENDC02
130790041012     c                   endif
130800060324     c* Se immesso appuntamento e richiesta data consegna tassativa
130810060324     c* ---> errore
130820060324     c                   if        vidtcr = *blanks and viddcr > *zeros  and
130830060324     c                             (vidtc1='A' or vidtc2='A')
130840161229     c* non segnalo quest'errore se in manutenzione e presenti variazioni
130850161229     C                   IF        *in12 and not *in15 and (at0fva=*blanks or
130860161229     c                             at0fra=*blanks)
130870161229     c                   else
130880060324     C                   MOVEl     ERR(298)      vidmsg
130890060324     C                   SETON                                        636490
130900060324     C                   GOTO      ENDC02
130910161229     c                   endif
130920060324     c                   endif
130930041012     c*
130940041012     C***  wdisag        ifne      *blanks
130950060324     c                   if        (wdisag = 'X') OR
130960060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
130970060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
130980060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
130990041012     c     wdisag        ifne      vidtc1
131000020531     c     wdisag        andne     vidtc2
131010020531     C                   MOVEa     ERR(255)      k78
131020020531     c                   select
131030020531     c     wdisag        wheneq    'X'
131040040608     c                   eval      w016ad = 'Disagiato     '
131050020531     c     wdisag        wheneq    'S'
131060040608     c                   eval      w016ad = '"Supermercato"  '
131070040608     c     wdisag        wheneq    'A'
131080040608     c                   eval      w016ad = 'con Appuntamento'
131090020531     c                   endsl
131100040608     C                   MOVEa     w016ad        k78(14)
131110020531     C                   MOVEA     K78           VIDMSG
131120020531     C                   SETON                                        636490
131130020531     C                   GOTO      ENDC02
131140041012     c                   endif
131150020531     c                   endif
131160090921     c
131170090921     c* Per tipo servizio "H" non accetto S o A
131180090921     c                   if        vidtc1='A' or vidtc1='S' or
131190090921     c                             vidtc2='A' or vidtc2='S'
131200090921     c                   if        vidtsp='H'
131210090921     C                   MOVEl     err(231)      VIDMSG
131220090921     C                   SETON                                        6390
131230090921     C                   GOTO      ENDC02
131240090921     c                   endif
131250090921     c                   endif
131260150304     c* BANCALI
131270150304     c* Se particolarita varia = 'O' il controllo seguente l'ho già
131280150304     c* fatto prima del calcolo del volume automatico
131290150304     c                   if        %subst(vidgva:1:1)<>'O'
131300150304     c                   exsr      sr_CntPVBan
131310150304     c     wemfor        ifeq      '1'
131320150304     c                   goto      endc02
131330150304     c                   endif
131340150304     c                   endif
131350940922     C***
131360070223     C*** CONTROLLO CAP
131370150304     c* se spedizione con bancali devo tenere conto anche del peso e volume dei
131380150304     c* bancali per il calcolo dell'instradamento
131390150304     c                   z-add     v2cpkg        v2cpkg_i
131400150304     c                   z-add     varvol        varvol_i
131410150304     c                   if        (not *in12 or (*in15 and not *in44)) and
131420150304     c                             %subst(VidGva:1:1) <> 'O'            and
131430150304     c                             §cliban=*blanks
131440150304     c                   if        vidnba>*zeros
131450150304     c                   Clear                   w0071
131460150304     c                   Clear                   w0053
131470150304     c     wTbaPkg1      Mult      VidNba        w0071
131480150304     c                   Add       w0071         v2cpkg_i
131490150304     c     wTbaVol1      Mult      VidNba        w0053
131500150304     c                   Add       w0053         varvol_i
131510150304     c                   endif
131520150304     c                   if        vidnb2>*zeros
131530150304     c                   Clear                   w0071
131540150304     c                   Clear                   w0053
131550150304     c     wTbaPkg2      Mult      VidNb2        w0071
131560150304     c                   Add       w0071         v2cpkg_i
131570150304     c     wTbaVol2      Mult      VidNb2        w0053
131580150304     c                   Add       w0053         varvol_i
131590150304     c                   endif
131600150304     c                   endif
131610911008      *
131620020531     C* SE CAMBIATO F.D. O PESO O VOLUME  o consegne particolari RICONTROLLO
131630940916    2C     VARFFD        IFNE      VIDFFD
131640150304     C     VARPKG        ORNE      V2CPKG_i
131650150304     C     VA2VOL        ORNE      VARVOL_i
131660020531     C     VArtc1        ORNE      vidtc1
131670020531     C     VArtc2        ORNE      Vidtc2
131680060110     c     D_varrsd      andeq     vidrsd
131690060110     c     D_varind      andeq     vidind
131700060110     c     D_varlod      andeq     vidlod
131710060110     c     D_varprd      andeq     vidprd
131720060110     c     D_varnzd      andeq     vidnzd
131730010214     C                   MOVE      VIDFFD        COMFFD
131740010214     C     COMFFD        IFEQ      'N'
131750010214     C                   MOVE      *BLANKS       COMFFD
131760010214     C                   ENDIF
131770930414     C                   MOVEL     0             DIE
131780940916     C*
131790930402     C* IN MANUTENZIONE SE SONO TORNATI COME IN BOLLA NON FACCIO NIENTE
131800940916    3C     *IN12         IFEQ      '1'
131810930402     C     *IN15         ANDEQ     '0'
131820940916     C*
131830940916     C* IN MANUTENZ.SE NOV =" " SIGNIFICA CHE IL CAP E' DI NUOVO UGUALE
131840940916     C*  A QUELLO DELLA BOLLA
131850940916     C     NOV           ANDEQ     ' '
131860010214     C     COMFFD        ANDEQ     BLPFFD
131870940928     C     V2CPKG        ANDEQ     BLPPKB
131880940928     C     VARVOL        ANDEQ     BLPVLB
131890020531     C     vidtc1        ANDEQ     BLPtc1
131900020531     C     vidtc2        ANDEQ     BLPtc2
131910060110     c     vidrsd        andeq     blprsd
131920060110     c     vidind        andeq     blpind
131930060110     c     vidlod        andeq     blplod
131940060110     c     vidprd        andeq     blpprd
131950060110     c     vidnzd        andeq     blpnzd
131960930402     C                   MOVEL     BLPZNC        VARZNC
131970940916   X3C                   ELSE
131980920427     C                   MOVEL     0             QUA
131990100209     C                   MOVEL     0             QUAH
132000930406     C                   MOVEL     '1'           NOV
132010940916    3C                   END
132020940916    2C                   END
132030930402     C*
132040910129     C* CONTROLLO IN PAESARIO LA LNA
132050940916    2C     QUA           IFNE      NUMFOR
132060910801     C*
132070930401     C                   MOVEL     VIDFFD        VARFFD
132080150304     C                   MOVEL     V2CPKG_i      VARPKG
132090150304     C                   MOVEL     VARVOL_i      VA2VOL
132100020531     C                   MOVEL     Vidtc1        VArtc1
132110020531     C                   MOVEL     Vidtc2        VArtc2
132120060110     C                   MOVEL     Vidrsd        D_VArrsd
132130060110     C                   MOVEL     Vidind        D_VArind
132140060110     C                   MOVEL     Vidlod        D_VArlod
132150060110     C                   MOVEL     Vidprd        D_VArprd
132160060110     C                   MOVEL     Vidnzd        D_VArnzd
132170940919     C*
132180970704     C                   CLEAR                   DSSI95
132190970708     C                   CLEAR                   DSLV13
132200970707     C                   CLEAR                   W2LN
132210970704     C                   MOVEL     VIDNZD        I95NAR
132220970704     C                   MOVEL     VIDCAD        I95CAP
132230970704     C                   MOVEL     VIDLOD        I95LOC
132240970704     C                   MOVEL     VIDPRD        I95PRV
132250970704     C                   MOVEL     VIDFFD        I95FFD
132260010214     C     VIDFFD        IFEQ      'N'
132270010214     C                   MOVE      *BLANKS       I95FFD
132280010214     C                   ENDIF
132290131003     c* Se per il cliente è presente personalizzazione instradamento merce
132300131003     c* imposto peso e volume medio al posto del peso e volume della sped.
132310150304     C                   Z-ADD     V2CPKG_i      I95LKG
132320131003     c                   if        n_§clipsm>0
132330131003     C                   Z-ADD     n_§clipsm     I95LKG
132340131003     c                   endif
132350980219     C* PASSO IL VOLUME AL CALCOLO DELLA LNA SOLO SE NON E' CLIENTE B
132360980219     C*  O E' CLIENTE B CON VOLUME REALE
132370980219     C     VIDNRS        IFEQ      0
132380980219     C     VIDFVR        OREQ      'R'
132390150304     C                   Z-ADD     VARVOL_i      I95LMC
132400131003     c                   if        n_§clivlm>0
132410131003     C                   Z-ADD     n_§clivlm     I95Lmc
132420131003     c                   endif
132430980219     C                   ENDIF
132440000623     C** SE BOLLA POSTA DEVO PASSARE LNP AL POSTO DI TFP
132450020319     C     §ogntw        IFEQ      'PPT'
132460000623     C                   Z-ADD     VIDLNP        I95TFP
132470000623     C                   ELSE
132480000623     C                   Z-ADD     COMTFP        I95TFP
132490000623     C                   ENDIF
132500000623     C*
132510970704     C     VIDTSP        IFNE      *BLANKS
132520970704    1C                   MOVEL     VIDTSP        I95TSP
132530970704     C                   ELSE
132540970704     C* LO PRENDO DA TARIFFA
132550970704     C                   MOVEL     COMTSP        I95TSP
132560970704     C                   ENDIF
132570131003     c                   if        §clitspf<>*blanks
132580131003     c                   movel     §clitspf      i95tsp
132590131003     c                   endif
132600971201     C     §3AFCA        IFNE      0
132610971201     C                   MOVEL     'S'           I95FCA
132620971201     C                   ENDIF
132630971201     C                   MOVEL     FLGTB1        I95TPO
132640970704     C                   MOVEL     '7'           I95TCN
132650970714     C                   MOVEL     BLPDSP        I95DAT
132660980602     C                   MOVEL     'S'           I95FRE
132670020212     c* se network fedex passo flag apposito per dire di prendere i dati
132680020212     c* dalla tabella della nazione
132690020213     c     A_§ogntw      ifeq      'FED'
132700020212     c     viddpd        oreq      'F'
132710020212     c     wdesie        andeq     'E'
132720020212     c                   movel     'S'           i95fi1
132730020212     c                   endif
132740020531     c*
132750020531     c                   movel     vidtc1        i95fi2
132760020531     c                   move      vidtc2        i95fi2
132770131003     c                   if        (vidtc1='S' or vidtc2='S')
132780131003     c                             and §clisup='N'
132790131003     c                   if        vidtc1='S'
132800131003     c                   movel     ' '           i95fi2
132810131003     c                   else
132820131003     c                   move      ' '           i95fi2
132830131003     c                   endif
132840131003     c                   endif
132850970704     C*
132860970704     C                   CALL      'FNLV13R'
132870970708     C                   PARM                    KPJBA
132880970708     C                   PARM                    DSLV13
132890970708     C                   PARM                    DSSI95
132900060105     c*
132910150128     c                   move      o95loc        wLocNorm
132920060105     c                   move      o95lna        d_o95lna
132930060105     c                   move      o95znc        d_o95znc
132940060105     c                   move      o952ln        d_o952ln
132950111201     c* EVENTUALE FORZATURA LINEA DI ARRIVO: non valida per i disk B e
132960111201     c* le bolle di reso
132970170322     c* Per il dirottamento bisogna sempre entrare (anche fnlg20r fa così)
132980170322     c* Per i resi non bisogna mai entrare nelle specifiche seguenti perchè
132990170322     c*     lg20r non usa mai le eccezioni tranne quando è presente il luogo
133000170322     c*     ma ls01r non è in grado di determinarlo
133010170322     c                   if        §1bfg6<>'C' and vidfbr<>'S'
133020170322     c****                         (vidfbr <> 'S' and *in44 = *off)
133030111201     c* .... Forzatura da archivio destinatari particolari
133040111201     c                   if        §dstlna > *zeros
133050060105     c                   movel     §dstlna       d_o95lna
133060060105     c                   clear                   d_o95znc
133070060105     c                   clear                   d_o952ln
133080060105     c                   if        §dstznc >= *zeros
133090060105     c                   movel     §dstznc       d_o95znc
133100060105     c                   endif
133110060105     c                   endif
133120120615     c* .... Forzatura da tabella "FLB/FLA"
133130120615     c* Forzatura linea di arrivo per codice cliente mittente o per linea di p.
133140120615     c                   clear                   trulflbds
133150120615     c                   movel     d_o95lna      iflblna
133160120615     c                   move      vidlnp        Iflblnp
133170120615    2c                   if        vidccm<>9999 and vidccm<>8888
133180120614     c                   move      vidccm        iflbccm
133190120615    3C     VIDFLC        IFEQ      0
133200120614     C                   MOVEL     VIDLNP        iflbccm
133210120614     C                   ELSE
133220120614     C                   MOVEL     VIDFLC        iflbccm
133230120614    3C                   ENDIF
133240120615    2c                   endif
133250120614     c                   call      'TRULFLBR'
133260120614     c                   parm                    trulflbds
133270120615    2c                   if        Oflblfz>*zeros
133280120615     c                   move      OflbLFZ       d_o95lna
133290170301     c                   if        oflberr='F'
133300170301     c                   clear                   d_o952ln
133310170301     c                   z-add     90            d_o95znc
133320170301     c                   movel     'S'           vidffd
133330170301     c                   clear                   wemdest
133340170301     c                   clear                   wsms
133350170301     c                   clear                   sav_wemdest
133360170301     c                   clear                   sav_wsms
133370170301     c                   endif
133380120615    2c                   endif
133390160829     c                   if        *in12  and *in15 and §ogntw='DPD'
133400161114     c                   clear                   wfbdp             1
133410161114     c                   eval       SQLCOD = 0
133420161114     C/EXEC SQL
133430161115     C+ SELECT  'S' into :wfbdp
133440161115     C+   FROM  WFBDP00F   WHERE  BDPnpr = :v7cnpr
133450161114     C+    fetch first row only
133460161114     C/END-EXEC
133470161114     c* verifico se numero parcel presente in work file
133480161114     c                   if        (§vpofl1='S'
133490170725     c***                          and %subst(v7cnpr:1:4)='1597'
133491170725     c                             and ( %subst(v7cnpr:1:4)='1597' or
133492170725     c                                   %subst(v7cnpr:1:4)='1550'   )
133500161026     c                             and (
133550170725     c**                           %scan('ALL TIME EXPRESS LTD':vidrmo)>0 or
133560170725     c**                           %scan('WINMORE LIMITED':vidrmo)>0  or
133570161028     c                             %scan('UNIVERSAL AIR EXPRESS':vidrmo)>0 or
133580161114     c                             %scan('JUST IN TIME CONSULTING':vidrmo)>0 ))
133590161114     c                             or
133600161114     c                             sqlcod = 0 and wfbdp='S'
133610170725     c***                z-add     172           d_o95lna
133611170725     c                   z-add     001           d_o95lna
133620160829     c                   clear                   d_o95znc
133630160829     c                   clear                   d_o952ln
133640160829     c                   z-add     90            d_o95znc
133650160829     c                   movel     'S'           vidffd
133660161028     c                   clear                   wemdest
133670161028     c                   clear                   wsms
133680161028     c                   clear                   sav_wemdest
133690161028     c                   clear                   sav_wsms
133700160829     c                   endif
133710161114     c                   endif
133720111201     c                   endif
133730160224
133740930409     C*
133750110217     C* L I N E A    D I    A R R I V O    N O N    I M M E S S A
133760110217     c*     I T A L I A    O    E U R O E X P R E S S
133770110217     C
133780940916     C*  LA PRENDO DA CAPPARIO
133790000121    3C     VIDLNA        IFLE      *ZEROS
133800000121     C     VIDDPD        ANDEQ     ' '
133810160224     c     w_aDpd        andne     'S'
133820000121    3C     VIDLNA        ORLE      *ZEROS
133830000121     C     WDESIE        ANDEQ     'I'
133840970711     C                   CLEAR                   WMSGLN
133850160726     C**                 CLEAR                   WMSGZO
133860970711     C**
133870060105     C                   MOVEL     d_o95lna      COMLNA
133880060105     C                   MOVEL     d_o952ln      W2LN
133890110217     c
133900111123     c* Controlli di base della linea di arrivo
133910110217     c                   movel     comlna        wlna
133920110217     c                   exsr      CTRLNA_Base
133930110217     c
133940110217     c                   if        *in90
133950110217     C                   GOTO      ENDC02
133960160411     c                   seton                                        40
133970110217     c                   endif
133980940916     C* Z O N A:
133990940916     C* 1) IMMISSIONE E DISK CLIENTI--> PRENDO SEMPRE
134000910801     C  N12
134010970704     COR 12
134020060105     C****AN 15              MOVEL     O95ZNC        VARZNC
134030060105     CAN 15              MOVEL     d_o95znc      VARZNC
134040940916     C* 2) MANUTENZIONE --> SE CAMBIATO CAP O FD O ZONA=0 RIPRENDO
134050940916     C   12
134060940916    4CANN15NOV           IFEQ      '1'
134070930402     C     VIDZNC        OREQ      0
134080060105     C                   MOVEL     d_o95znc      VARZNC
134090940916    4C                   END
134100910129     C*
134110940916   X3C                   ELSE
134120970711     C                   CLEAR                   WMSGLN
134130160726     C***                CLEAR                   WMSGZO
134140930401     C*
134150940916     C* L I N E A   D I   A R R I V O           I M M E S S A
134160110217     C*   N O N   C O N G R U E N T E  CON QUELLA DEL CAPPARIO ITALIA O EUROEXPR
134170110217     C*  OPPURE LINEA DI ARRIVO   D P D
134180110217     C*  OPPURE LINEA DI ARRIVO   F E D E X
134190110217     C
134200060105    4C     d_o95lna      IFNE      COMLNA
134210020204    5C     VIDDPD        OREQ      'D'
134220000222     C     WDESIE        ANDEQ     'E'
134230020319     C     A_§OGNTW      OREQ      'DPD'
134240160224     c     w_aDpd        oreq      'S'
134250020201    5C     VIDDPD        OREQ      'F'
134260020201     C     WDESIE        ANDEQ     'E'
134270020213     C     A_§OGntw      OREQ      'FED'
134280030516      * se linea di partenza 102 da conferma bolla clienti non devo
134290030516      * dare incongruenza
134300030516  5aac                   If        (vidlnp <> 102 and *in12 and *in15)
134310030516     c                             or not *in12 or not *in15
134320000222     C**
134330000120     C* SE FORZATA LNA DPD, NON DEVO DARE INCONGRUENZA
134340020204    5C     VIDDPD        IFEQ      'D'
134350000121     C     WDESIE        ANDEQ     'E'
134360020319     C     A_§OGNTW      OREQ      'DPD'
134370160224     C     w_aDpd        OREQ      'S'
134380020201     C     VIDDPD        oreq      'F'
134390020201     C     WDESIE        ANDEQ     'E'
134400020213     C     A_§OGntw      OREQ      'FED'
134410000218     C**
134420020204    6C     VIDDPD        IFEQ      'D'
134430020201     C     WDESIE        ANDEQ     'E'
134440020319     C     A_§OGNTW      OREQ      'DPD'
134450160224     C     w_aDpd        OREQ      'S'
134460000229     C* PER DPD IMPOSTO ZONA 00 PER RESI ZONA 80
134470000218     C     VIDFBR        IFEQ      'S'
134480000229     C                   MOVEL     80            VARZNC
134490000218     C                   ELSE
134500000218     C                   MOVEL     00            VARZNC
134510000218     C                   ENDIF
134520170928     c***                exsr      sr_tisie3
134530060703     c*SE ERRORE DA CAPPARIO DPD, verificare
134540170928     C***  Osie3err      IFNE      ' '
134541171006     c                   eval      wlna_dp=comlna
134542170928     c                   exsr      sr_tisicDpd
134543170928    3C                   IF        wCDpdErr <> ' '
134550060615     C                   MOVEL     ERR(189)      VIDMSG
134560061011     C                   EVAL      CAPPARIODPD='S'
134570061011     c                   movel     vidcad        savcapdpd
134580060615     C                   SETON                                        4090
134590060615     C                   ENDIF
134600070515     c*****              endif
134610020201   x6c                   else
134620060105     c                   movel     D_o95lna      comlna
134630060105     c                   movel     d_o95znc      varznc
134640020201    6c                   endif
134650110217     c
134660110217     c* Controlli di base della linea di arrivo
134670110217     c                   movel     comlna        wlna
134680110217     c                   exsr      CTRLNA_Base
134690110217     c
134700110217     c                   if        *in90
134710110217     C                   GOTO      ENDC02
134720110217     c                   seton                                        40
134730110217     c                   endif
134740110217     c
134750000120  X 5C                   ELSE
134760970711     C**
134770940916     C* NON E' FERMO DEPOSITO
134780010214    6C     VIDFFD        IFEQ      'N'
134790010220     C     VIDFFD        OREQ      ' '
134800000704     C* NON CONTROLLO PER BOLLE POSTE DISK B
134810020319   6Ac     §ogntw        IFNE      'PPT'
134820000704     C     §1BFG6        ORNE      'C'
134830000704     C     §1BFG2        ORNE      'S'
134840940916     C* NON SEGNALO ERRORE SE BOLLA DA DISP MITTENTE
134850000120    7C     WFPR          IFNE      'I'
134860970711     C     WMSGLN        ANDEQ     ' '
134870030627      * non segnalo errore se bolle di recupero
134880100209      * non segnalo errore se prima lo avevo dato per tipo servizio H
134890100209If  8c                   If        §3arbl <> 'R'  and (vidtsp='H' or
134900100209     c                             quah=0)
134910100208     c
134920100208     c* Messaggio diverso per tipo servizio "H"
134930100210     c                   if        vidtsp='H'  and  §1bfg6='C'
134940100210     C                   MOVEL     ERR(80)       VIDMSG
134950100210     C                   sub       1             QUA
134960100210     C                   add       1             QUAH
134970100210     c                   else
134980100208     C                   MOVEL     ERR(90)       VIDMSG
134990100210    8c                   EndIf
135000100208
135010940916     C                   SETON                                        4090
135020030627    8c                   EndIf
135030000120    7C                   END
135040920427     C                   ADD       1             QUA
135050000704   6AC                   END
135060930409     C*
135070000120    6C                   END
135080910801     C* AZZERO LA ZONA
135090910801     C  N12
135100930401     COR 12
135110930401     CAN 15              Z-ADD     0             VARZNC
135120060829     c                   if        wfpr = 'G'
135130060829     c                   z-add     vidznc        varznc
135140060829     c                   endif
135150940916     C* IN MANUTENZIONE: se HO variato i dati --> AZZERO LA ZONA
135160000120     C   12
135170000120    6CANN15NOV           IFEQ      '1'
135180930401     C                   Z-ADD     0             VARZNC
135190940916     C*
135200000120   x6C                   ELSE
135210940916     C* SE CAMBIATA SOLO LA LINEA             --> AZZERO LA ZONA
135220000120    7C     SAVLNA        IFNE      VIDLNA
135230930401     C                   Z-ADD     0             VARZNC
135240910801     C                   MOVEL     '1'           NOV
135250940916     C*
135260000120   X7C                   ELSE
135270940916     C* SE NON HO CAMBIATO NULLA             -->LASCIO QUELLA CHE C'ERA
135280930402     C                   Z-ADD     BLPZNC        VARZNC
135290930402     C                   MOVEL     ' '           NOV
135300000120    7C                   ENDIF
135310910801     C*
135320000120    6C                   ENDIF
135330980806     C**
135340980806     C* SE LNA ESTERA ANCHE SE FORZO LA LINEA INCONGRUENTE COL CAP
135350980806     C*  PRENDO LA ZONA
135360020319     c     A_§ogntw      ifeq      'EEX'
135370980806     C  N12
135380980806     COR 12
135390060105     CAN 15              Z-ADD     d_o95znc      VARZNC
135400980806     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
135410000120     C   12
135420000120    7CANN15NOV           IFEQ      '1'
135430980806     C     VIDZNC        OREQ      0
135440060105     C                   Z-ADD     d_o95znc      VARZNC
135450000120    7C                   END
135460000120    6C                   ENDIF
135470000120    5C                   ENDIF
135480970711     C* PER ERRORE ESCO
135490970711     C   90              GOTO      ENDC02
135500030516
135510030516  5aac                   endif
135520921029     C*
135530940928   X4C                   ELSE
135540940916     C*
135550110217     C* L I N E A   D I   A R R I V O           I M M E S S A
135560110217     c*     I T A L I A    O    E U R O E X P R E S S
135570940916     C*  LINEA     CONGRUENTE CON QUELLA DEL CAPPARIO --> PRENDO ZONA
135580960208     C* LINEA ORIGINALE SE SECONDA LINEA DISTRIBUZIONE
135590060105     C                   MOVEL     d_o952ln      W2LN              1
135600060829     C  N12
135610060829     COR 12
135620060829     CAN 15              Z-ADD     d_o95znc      VARZNC
135630060829     c                   if        *in12='1' and *in15='1' and
135640060829     c                                 wfpr='G' and vidznc>0
135650060829     C                   Z-ADD     vidznc        VARZNC
135660060829     c                   endif
135670930402     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
135680940916     C   12
135690940916    5CANN15NOV           IFEQ      '1'
135700930402     C     VIDZNC        OREQ      0
135710060105     C                   Z-ADD     d_o95znc      VARZNC
135720940916    5C                   END
135730970711     C* DISK CLI
135740970711     C                   MOVEL     'N'           WMSGLN            1
135750160726     C***                MOVEL     O95ZNC        WEMZNC
135760910801     C*
135770940916    4C                   ENDIF
135780940916    3C                   ENDIF
135790970618    2C                   ENDIF
135800940916     C*
135810020917     C* PER DISK CLI CON SERIE PRENDO ZONA DA FIVAB
135820950410     C* --> SEGNALO PERO' SE E' DISCORDANTE CON QUELLA CALCOLATA
135830950421     C*     SEMPRE SE NON SI TRATTA DI UNA ZONA PRESA DALL'OLTRE O FD
135840160726     c* Non segnalo più: il controllo non è più di nessuna utilità ed è scomodo
135850160726     c* in particolare per le bolle del mittente Amazon
135860970618     C   12
135870970618    2CAN 15VIDNRS        IFNE      0
135880950410     C*
135890160726    3C***  §LPZNC        IFNE      WEMZNC
135900160726     C***  §ogntw        ANDNE     'PPT'
135910160726     C***  QUI           ANDEQ     0
135920160726     C***  WMSGLN        ANDEQ     'N'
135930160726     C***  WMSGZO        ANDEQ     ' '
135940030515      * non controllo per linea di partenza 102
135950160726     c***  §lplnp        Andne     102
135960160726     C***                MOVEA     ERR(115)      K78
135970160726     C***                MOVEL     WEMZNC        W002A             2
135980160726     C***                MOVEA     W002A         K78(49)
135990160726     C***                MOVEL     §LPZNC        W002A             2
136000160726     C***                MOVEA     W002A         K78(13)
136010160726     C***                MOVEA     K78           VIDMSG
136020160726     C***                SETON                                        5790
136030160726     C***                MOVEL     1             QUI
136040160726     C***                GOTO      ENDC02
136050160726    3C***                ENDIF
136060950410     C*
136070930401     C                   Z-ADD     §LPZNC        VARZNC
136080970618    2C                   ENDIF
136090980410     C*
136100980410     C   12
136110980410    2CANN15§1BFG6        IFEQ      'C'
136120980410     C     §1BFG2        ANDEQ     'S'
136130980410     C     NOV           ANDEQ     '1'
136140980410     C*
136150160726    3C***  BLPZNC        IFNE      WEMZNC
136160160726     C***  §ogntw        ANDNE     'PPT'
136170160726     C***  QUI           ANDEQ     0
136180160726     C***  WMSGLN        ANDEQ     'N'
136190160726     C***  WMSGZO        ANDEQ     ' '
136200160726     C***                MOVEA     ERR(115)      K78
136210160726     C***                MOVEL     WEMZNC        W002A             2
136220160726     C***                MOVEA     W002A         K78(49)
136230160726     C***                MOVEL     BLPZNC        W002A             2
136240160726     C***                MOVEA     W002A         K78(13)
136250160726     C***                MOVEA     K78           VIDMSG
136260160726     C***                SETON                                        5790
136270160726     C***                MOVEL     1             QUI
136280160726     C***                GOTO      ENDC02
136290160726    3C***                ENDIF
136300980410     C*
136310980410     C                   Z-ADD     BLPZNC        VARZNC
136320980410    2C                   ENDIF
136330930402     C***
136340930402     C*** CONTROLLO ZONA IN MANUTENZIONE ***
136350930409     C* SE MODIFICATA E SE NON RICALCOLATA DEVE ESISTERE NELLA TAB. 03
136360940916     C   12
136370940916    2CANN15NOV           IFNE      '1'
136380930409     C     BLPZNC        ANDNE     VIDZNC
136390930409     C     VIDZNC        ANDGT     0
136400930402     C                   MOVEL     VIDZNC        VARZNC
136410930406     C*
136420930409     C                   MOVEL     '03'          COD
136430930409     C                   MOVEL     COMLNA        ALF5              5
136440930409     C                   MOVE      VIDZNC        ALF5
136450940919     C                   MOVEL(P)  ALF5          KEY
136460930409     C*
136470930708     C                   EXSR      CTABEL
136480940928    3C     *IN30         IFEQ      *ON
136490940916     C                   MOVEL     ERR(61)       VIDMSG
136500940922     C                   SETON                                        5790
136510940920     C                   GOTO      ENDC02
136520940916    3C                   ENDIF
136530940916    2C                   ENDIF
136540930406     C*
136550150414     c* Controlli per EXPO
136560151119     c*                  if        vidtc1='Z' or vidtc2='Z'
136570151119     c*                  move      comlna        w003a
136580151119     c*                  select
136590150414     c* Errore se bolla con C/A
136600151119     c*                  when      §3afca=1
136610151119     C*                  movel     ERR(360)      VIDmsg
136620151119     C*                  seton                                        90
136630150414     c* errore se non è bolla FRANCO
136640151119     c*                  when      flgtb1<>'F'
136650151119     C*                  movel     ERR(361)      VIDmsg
136660151119     C*                  seton                                        90
136670150414     c* errore se lna non in tabella
136680151119     c*                  when      %lookup(w003a:fil_expo)=0
136690151119     C*                  movel     ERR(362)      VIDmsg
136700151119     c*                  eval      vidmsg=%trim(vidmsg) + ' ' + w003a
136710151119     C*                  seton                                        90
136720151119     c*                  endsl
136730151119     c*                  if        *in90
136740151119     c*                  if        vidtc1='Z'
136750151119     c*                  seton                                        63
136760151119     c*                  else
136770151119     c*                  seton                                        64
136780151119     c*                  endif
136790151119     C*                  goto      ENDC02
136800151119     c*                  endif
136810151119     c*                  endif
136820960320     C***
136830960320     C*** PER LNA 102 OBBLIGATORIO IL C/S
136840000706    1C     COMLNA        IFEQ      102
136850960320     C     §3ARBL        ANDNE     'C'
136860960320     C                   SETON                                        4090
136870960320     C                   MOVEL     ERR(125)      VIDMSG
136880160303     C                   GOTO      ENDC02
136890000706    1C                   ENDIF
136900991206      **
136910110217      ** Aggancio AZORG di LNA per prednere dati
136920110217      ** Es: lo tolgo perchè lo fa già sopra avenfo unificato i controllo
136930110217      **     con la CTRLNA_Base non serrve più
136940110217      **
136950110217    1C**   VIDLNA        IFLE      *ZEROS
136960110217     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
136970110217     C**                 MOVEL     ORGDE3        A_OG143
136980110217     C**                 MOVEL     ORGDF0        A_OG150
136990110217    1C**                 ENDIF
137000991206      *
137010991206      * PER LNA DPD OBBLIGATORIO 1 COLLO
137020020319     C     A_§OGNTW      IFEQ      'DPD'
137030000120     C     VIDNCL        IFNE      1
137040991206     C                   SETON                                        4190
137050991206     C                   MOVEL     ERR(179)      VIDMSG
137060991206     C                   GOTO      ENDC02
137070991206     C                   ENDIF
137080000124     c* controllo numero parcel dpd doppio
137090000308     C*  NON LO CONTROLLO SE DA CTM NON HA SEGNACOLLI (PER BOLLA
137100000308     C*  RECUPERO O PER BOLLA LEGATA I CUI SEGNACOLLI SONO SULLA MAMMA)
137110000203     C     §1BFG8        IFEQ      'S'
137120060615     C                   move      V7CNPR        WNPR
137130000124     C                   EXSR      DPDDOP
137140000124     C     *IN90         IFEQ      *ON
137150000124     C                   SETON                                        41
137160000124     C                   MOVEL     ERR(190)      VIDMSG
137170000124     C                   GOTO      ENDC02
137180000124     C                   ENDIF
137190000203     C                   ENDIF
137200000120     C                   ENDIF
137210991213      * PER LNA O LNP DPD Massimo peso inseribile da tabella
137220020319     C     A_§OGNTW      IFEQ      'DPD'
137230020319     C     §OGNTW        OREQ      'DPD'
137240160411     c     *in44         andeq     *off
137250991214     C     V2CPKG        IFGT      §3IPKD
137260991213     C                   SETON                                        4290
137270991213     C                   MOVEA     ERR(180)      K78
137280991213     C                   MOVEL     §3IPKD        W006A             6
137290991213     C                   MOVEA     W006A         SKI(10)
137300991213     C                   Z-ADD     10            I                 3 0
137310991213     C                   EXSR      ABBL
137320991213     C                   MOVEA     SKI(10)       K78(53)
137330991213     C                   MOVE      §3IPKD        W001A
137340991213     C                   MOVEL     W001A         K78(60)
137350991213     C                   MOVEA     K78           VIDMSG
137360991213     C                   GOTO      ENDC02
137370991213     C                   ENDIF
137380991213     C                   ENDIF
137390991206      **
137400991203     C                   SETOFF                                       30
137410991203      *
137420991203     C                   SELECT
137430991203      *
137440060629      * IMPORT/EXPORT DPD  (import solo se in manutenzione e solo per
137450060629      * la visualizzazione)
137460991203      *  Premuto F18
137470020319     C     A_§OGNTW      WHENEQ    'DPD'
137480991203     C     *INKS         ANDEQ     *ON
137490060616     c     *in79         oreq      *on
137500060616     C     *INKS         ANDEQ     *ON
137510060616     c     *in12         andeq     *on
137520060616     c     *in15         andeq     *off
137530991203     C                   EXSR      GESD07
137540991203     C                   SETON                                        41
137550991203     C                   MOVEL     '1'           WEMFOR
137560161129     c
137570991203     C                   GOTO      ENDC02
137580991203      *
137590991203      * EXPORT DPD
137600000307      *  Non premuto F18 e PARCEL non inserito. ESCLUDO I RECUPERI
137610020319     C     A_§OGNTW      WHENEQ    'DPD'
137620991203     C     *INKS         ANDEQ     *OFF
137630151104     C     V7CNPR        ANDEQ     *blanks
137640000308     C     §3ARBL        ANDNE     'R'
137650991203     C                   SETON                                        4190
137660991203     C                   MOVEL     ERR(175)      VIDMSG
137670991203     C                   GOTO      ENDC02
137680991203      *
137690991203      * SPEDIZIONE non ESTERO SDI E MITTENTE CON OBBLIGO AWB e non DPD
137700991203      * Premuto F18
137710991203     C     *INKS         WHENEQ    *ON
137720991203     C                   MOVEL     ERR(89)       VIDMSG
137730991203     C                   SETON                                        4190
137740991203     C                   GOTO      ENDC02
137750991203      *
137760991203     C                   ENDSL
137770940825     C***
137780910829     C*** RIFERIMENTO MITTENTE NUMERICO ***
137790940916    1C     VIDRMN        IFEQ      0
137800940825     C                   MOVEL     ERR(47)       VIDMSG
137810940922     C                   SETON                                        4390
137820940920     C                   GOTO      ENDC02
137830991130    1C                   ENDIF
137840970328     C***
137850970328     C*** FLAG D D T     ******
137860970408     C* PAESE CON ATTRAVERSAMENTO DOGANA: OBBLIGATORIO SI DDT
137870970408    1C     VIDBAM        IFEQ      'N'
137880000321     C     WEFT          ANDNE     ' '
137890970408     C                   MOVEL     ERR(140)      VIDMSG
137900970408     C                   SETON                                        7790
137910970408     C                   GOTO      ENDC02
137920970408     C                   ENDIF
137930101105     C* per Fedex : obbligatorio SI DDT
137940120523     c                   if        vidbam='N' and  §3arbl <>'R' and
137950101108     c                             (VidDpd = 'F' or a_§OgNtw = 'FED' )
137960101105     C                   MOVEL     ERR(335)      VIDMSG
137970101105     C                   SETON                                        7790
137980101105     C                   GOTO      ENDC02
137990101105     C                   ENDIF
138000970408     C* SE BOLLA DI RECUPERO, OBBLIGATORIO NO BAM
138010970408    1C     VIDBAM        IFEQ      'S'
138020970408     C     §3ARBL        ANDEQ     'R'
138030000321     C     WEFT          ANDEQ     ' '
138040020513     c     vidcbo        andne     'FO'
138050970408     C                   MOVEL     ERR(138)      VIDMSG
138060970408     C                   SETON                                        7790
138070970408     C                   GOTO      ENDC02
138080970408     C                   ENDIF
138090020507     C* SE BOLLA DI RECUPERO per bolle firmate, obbligatorio SI DDT
138100020507    1C     VIDBAM        IFEQ      'N'
138110020513     c     vidcbo        andeq     'FO'
138120020507     C                   MOVEL     ERR(254)      VIDMSG
138130020507     C                   SETON                                        7790
138140020507     C                   GOTO      ENDC02
138150020507     C                   ENDIF
138160970703     C* bolle CON OBBLIGO DDT DA CAPPARIO: SE NON E' RECUPERO ERRORE
138170970703     C*  SE IMMESSO NODDT
138180970408    1C     VIDBAM        IFEQ      'N'
138190970703     C     DESGDD        ANDEQ     'S'
138200970408     C     §3ARBL        ANDNE     'R'
138210081127     c     savfpr        andne     'G'
138220081127     c     savfpr        andne     'P'
138230150302     c     savfpr        andne     'B'
138240970328     C                   MOVEL     ERR(139)      VIDMSG
138250970328     C                   SETON                                        7790
138260970328     C                   GOTO      ENDC02
138270970408    1C                   ENDIF
138280041109     c* bolla con vax (con estensione ddt del cliente) errore se SI DDT
138290050211     c* solo se nazione e/o cap non prevedono l'obbligo del ddt si
138300050211     c                   if        §1bf16 = 'S' and vidbam = 'S' and
138310050211     c                             weft = *blanks and desgdd <> 'S'
138320041109     C                   MOVEL     ERR(287)      VIDMSG
138330041109     C                   SETON                                        7790
138340041109     C                   GOTO      ENDC02
138350041109     c                   endif
138360950303     C***
138370950303     C*** RIFERIMENTO MITTENTE ALFABETICO ***
138380950303     C* SE DESTINATARIO ESTERO -->  OBBLIGATORIO
138390950303     C     WDESIE        IFEQ      'E'
138400000321     C     WEFT          ANDNE     *BLANKS
138410950303     C     VIDRMA        ANDEQ     *BLANKS
138420950303     C                   MOVEL     '1'           WEMFOR
138430950303     C                   SETON                                          5890
138440950303     C                   MOVEL     ERR(110)      VIDMSG
138450950303     C                   GOTO      ENDC02
138460950303    1C                   ENDIF
138470021209      * Obbligatorio se è una bolla con consegna supermercato
138480030303      * ma non se è DPD
138490021209     c                   If        (VidTc1 = 'S' or VidTc2 = 'S')
138500021209     c                              and VidRma = *Blanks
138510030304     c                              and Not *In79 and wrma = *Blanks
138520021209     c                   Eval      Wemfor = '1'
138530021209     c                   Movel     Err(266)      VidMsg
138540021209     c                   Eval      *In58 = *On
138550021209     c                   Eval      *In90 = *On
138560021209     c                   GoTo      EndC02
138570021209     c                   EndIf
138580961111     C***
138590961111     C*** FLAG BOLLA RIENTRO
138600961111     C***
138610060920     c* se linea di arrivo dpd valida solo per resi ci deve essere
138620060920     c*  il flag
138630060921     c     viddpd        ifeq      'D'
138640060921     c     comlna        andeq     *zeros
138650060921     c     A_§ogNTW      oreq      'DPD'
138660060921     c* se però c'e' reso non do errore
138670060921     c                   if        o14lad<=*zeros and desred='S' and vidfbr<>'S'
138680060920     C                   SETON                                            90
138690060920     c                   z-add     20            h2riga
138700060920     c                   z-add     67            h2colo
138710060920     C                   MOVEL     ERR(157)      VIDMSG
138720060920     C                   GOTO      ENDC02
138730060920     c                   endif
138740060921     c                   endif
138750060920     c
138760961111     C     VIDFBR        IFNE      SAVFBR
138770961111     C                   MOVEL     VIDFBR        SAVFBR
138780961111     C                   CLEAR                   SED
138790961111     C                   ENDIF
138800090901     c*
138810090921     c* controllo se tipo servizio H accettabile x  linea di arrivo della bolla
138820090901     c*   tenendo conto dei tempi di trazione
138830090901     c                   if        vidtsp='H'
138840090901     c
138850100219     c                   clear                   UsaCass
138860090901     c                   exsr      ClsE98
138870090901     c
138880090922     c                   if        d98tcc<>10
138890100119     C                   SETON                                            90
138900090901     C                   MOVEL     ERR(57)       VIDMSG
138910100319     c* Se vengo da ORRM --> cancello il tipo servizio
138920100319     c                   if        wesORE='S'
138930100319     c                   movel     'N'           wesore
138940100319     c                   endif
138950090901     C                   GOTO      ENDC02
138960090901     c                   endif
138970100322     c* Se eiste FNORE --> dico che si può utilizzare
138980100322     c                   else
138990100322     c                   if        WesORE='N'
139000100322     c                   movel     'S'           wesore
139010100322     c                   endif
139020090901     c                   endif
139030060920     c*
139040900604     C*
139050900621     C*** CONTROLLO SEGNACOLLI DAL - AL ***
139060910118     C* SE FLAG STAMPA BOLLA E' "D" O "I" E PER BOLLE DI RECUPERO
139070910118     C*  OBBLIGATORIA LA NON IMMISSIONE
139080910117     C*
139090910118     C                   SETOFF                                       30
139100940825     C                   CLEAR                   WNOSEG
139110921019     C* NO SEGNACOLLO
139120930402     C* SE VENGO DA DISK CLIENTI SOLO SE E' BOLLA SENZA MAMMA
139130930402     C*  NEGLI ALTRI CASI SEMPRE
139140940825    1C     §1BFG8        IFEQ      'N'
139150930402     C*
139160940825    2C     *IN12         IFEQ      '1'
139170930402     C     *IN15         ANDEQ     '1'
139180940825     C*
139190940825    3C     §3ABCM        IFEQ      ' '
139200940825     C                   MOVEL     '1'           WNOSEG            1
139210940825    3C                   END
139220940825     C*
139230940825   X2C                   ELSE
139240940825     C                   MOVEL     '1'           WNOSEG            1
139250940825    2C                   END
139260940825    1C                   END
139270910805     C* NON SEQUENZIALI
139280940825    1C   12VIDFNS        IFEQ      'S'
139290940825     C                   MOVEL     '1'           WNOSEG            1
139300940825    1C                   END
139310910118     C*
139320940825    1C     WNOSEG        IFEQ      '1'
139330940825    2C     VIDNCD        IFGT      0
139340940825     C                   MOVEL     ERR(51)       VIDMSG
139350940922     C                   SETON                                        4590
139360940920     C                   GOTO      ENDC02
139370940825    2C                   END
139380910118     C*
139390940825    2C     VIDNCA        IFGT      0
139400940825     C                   MOVEL     ERR(51)       VIDMSG
139410940922     C                   SETON                                        4690
139420940920     C                   GOTO      ENDC02
139430940825    2C                   END
139440940825    1C                   END
139450960805     C* SE C'E' IL DETTAGLIO COLLI NON LI POSSO MODIFICARE
139460960805    1C     §1BFG7        IFEQ      'S'
139470980410     C     §1BFG6        ANDEQ     'C'
139480960805    2C     VIDNCD        IFNE      WNSNCD
139490960805     C     VIDNCA        ORNE      WNSNCA
139500960805     C                   MOVEL     ERR(127)      VIDMSG
139510960805     C                   SETON                                        4590
139520960805     C                   GOTO      ENDC02
139530960805    2C                   ENDIF
139540960805     C*
139550960805    1C                   ENDIF
139560910118     C*
139570940216     C*CAMBIO PORTO DIROTTAMENTO --> NON DO QUESTO ERRORE
139580940825     C* (44 ON )                     PERCHE' SEGNACOLLI SULLA MAMMA
139590940825     C  N44
139600940825    1CANN25WNOSEG        IFEQ      ' '
139610940825     C*
139620940825    2C     VIDNCD        IFEQ      0
139630940825     C                   MOVEL     ERR(51)       VIDMSG
139640940922     C                   SETON                                        4590
139650940920     C                   GOTO      ENDC02
139660940825    2C                   END
139670940916     C***
139680910117     C*
139690940825    3C     VIDNCA        IFNE      0
139700020315     C     VIDNCA        SUB       VIDNCD        COMNCL            8 0
139710900502     C                   ADD       1             COMNCL
139720900508     C                   ELSE
139730900508     C                   Z-ADD     1             COMNCL
139740940825    3C                   END
139750940825     C*
139760940825     C* CONTROLLO DIFFERENZA SEGNACOLLO DAL-AL CON NUMERO COLLI
139770940825    3C     COMNCL        IFNE      VIDNCL
139780940825     C                   MOVEL     ERR(45)       VIDMSG
139790940922     C                   SETON                                        4190
139800940920     C                   GOTO      ENDC02
139810940825    3C                   END
139820910117     C*
139830940825    1C                   END
139840910208     C*
139850940825     C* SE DEVO ATTRIBUIRE I SEGNACOLLI CONTROLLO CHE CI SIA LA NUMERAZ
139860991209     C                   CLEAR                   AAS
139870910208     C                   Z-ADD     9             CNU
139880930120     C                   MOVE      VIDLNP        COMLIN
139890930120     C                   MOVE      COMLNA        LIV2
139900930629     C     KNUF2         CHAIN(N)  FLNUF                              30
139910910508     C*
139920940916    1C     *IN30         IFEQ      *ON
139930940916    2C     *IN25         IFEQ      *ON
139940940825     C                   MOVEL     ERR(41)       VIDMSG
139950940922     C                   SETON                                        4590
139960940920     C                   GOTO      ENDC02
139970940916    2C                   ENDIF
139980940825     C                   Z-ADD     0             NUFRIN
139990940825     C                   Z-ADD     0             NUFRFI
140000940916    1C                   ENDIF
140010910208     C*
140020910208     C                   SETOFF                                       30
140030941021     C*
140040960926     C* LINEA SEGNACOLLO:
140050950525     C* PER DISK CLIENTI KA LNP E SEMPRE QUELLA DEL DISK
140060950525     C* SOLO PERO' SE IL CTM E' DI UNA SOLUZIONE "B"
140070950525     C   12
140080950525     CAN 15§1BFG6        IFEQ      'C'
140090950525     C                   MOVEL     §LPLNP        WFLS
140100170113     c* se filiale segnacollo = 0 --> errore
140110170113     c                   if        wfls=0
140120170113     C                   SETON                                        90
140130170113     C                   MOVEL     ERR(366)      VIDMSG
140140170113     C                   GOTO      ENDC02
140150170113     c                   endif
140160950525     C                   ELSE
140170950525     C                   MOVEL     VIDLNP        WFLS
140180950525     C                   ENDIF
140190941021     C* PER IMMISSIONE E' LA LINEA DI PARTENZA
140200941021     C  N12              MOVEL     VIDLNP        WFLS
140210941021     C* PER MANUTENZIONE E' QUELLA GIA' MEMORIZZATA
140220941021     C   12
140230941021     CANN15              MOVEL     BLPFLS        WFLS
140240940825     C*
140250921006     C* SE SEGNACOLLI COMPRESI NEL RANGE DI QUELLI ASSEGNATI IN
140260921006     C*  AUTOMATICO  ERRORE
140270920203     C* NON CONTROLLO SE TIPO BOLLA CON MAMMA (§3ABCM=S)
140280950713    1C     §3ABCM        IFNE      'S'
140290950713    2C     VIDNCD        IFNE      0
140300921006     C*
140310921006     C* NON CONTROLLO IL RANGE SE SONO IN RECUPERO
140320950713     C   12
140330950713    3CAN 15§LPFPR        IFEQ      'R'
140340921006     C                   SETON                                        30
140350950713    3C                   END
140360921006     C*
140370990602    3C  N12PARTCH        IFEQ      'R'
140380921006     C                   SETON                                        30
140390950713    3C                   END
140400921006     C*
140410950713     C  N30
140420950713    3CANN25VIDNRS        IFEQ      0
140430910208     C*
140440950713    4C     VIDNCD        IFLT      NUFRIN
140450950713    5C     VIDNCA        IFGT      NUFRIN
140460940825     C                   MOVEL     ERR(51)       VIDMSG
140470940922     C                   SETON                                        4690
140480940920     C                   GOTO      ENDC02
140490950713    5C                   END
140500950713   X4C                   ELSE
140510950713    5C     VIDNCD        IFLE      NUFRFI
140520940825     C                   MOVEL     ERR(51)       VIDMSG
140530940922     C                   SETON                                        4590
140540940920     C                   GOTO      ENDC02
140550950713    5C                   END
140560950713    4C                   END
140570910208     C*
140580950713    3C                   END
140590950713    2C                   END
140600910208     C*
140610910208     C* S E G N A C O L L I   D O P P I
140620910117     C*
140630910208     C* IN MANUTENZIONE/DISK CLIENTI CONTROLLO SE NON CAMBIATA LNA
140640921006     C                   SETOFF                                       30
140650971211     C                   MOVEL     COMLNA        W003A
140660971211     C   12
140670971211    2CAN 25SAVLNA        IFNE      W003A
140680910208     C                   SETON                                        30
140690950713    2C                   ENDIF
140700950713     C*
140710910208     C*  E SE NON AUMENTATI SEGNACOLLI
140720940916     C   12
140730050113    2Can 25SAVNCL        iflt      V1CNCL
140740910208     C                   SETON                                        30
140750950713    3C                   ENDIF
140760950713     C*
140770950713     C* NON CONTROLLO SE DEVO ASSEGNARE IL PGM I SEGNACOLLI
140780950713    2C     §1BFG6        IFEQ      'D'
140790950713     C     §1BFG6        OREQ      'I'
140800950713     C     §1BFG6        OREQ      'N'
140810950713     C                   SETON                                        30
140820950713    2C                   ENDIF
140830000627     C* NON CONTROLLO IN CASO DI CHIAMATA PER CONTROLLO DI BOLLA
140840000627     C*  AUTOGENERATA  POSTE
140850000627     C     §LPFLG        IFEQ      'C'
140860000627     C     VIDSOP        ANDEQ     '&'
140870020319     c     §ogntw        andeq     'PPT'
140880000627     C                   SETON                                        30
140890000627    2C                   ENDIF
140900940916     C*
140910910826     C*
140920920123     C* PER DISK CLI  SE NON SONO SEQUENZIALI
140930141119     c*
140940141119     c* W_bldncd e W_bldnca servono per il controllo range segnacolli
140950141119     c* per serie parziale se segnacolli non sequenziali
140960141119     c* Li imposto solo in conferma bolle.
140970141119     c* In Immissione bolle e manutenzione LI LASCIO SEMPRE VUOTI in quanto
140980141119     c* non sono da controllare (TRULNRSR se vuoti non li controlla)
140990141119     c* - In immissione non è possibile bollettare con segnacolli non
141000141119     c*   sequenziali
141010141119     c* - In manutenzione non è possibile variare i dati sensibili per
141020141119     c*   il controllo range segnacolli (ccm, serie, fls, numeri segnacolli)
141030141118     c                   if        *in12 and *in15
141040080313     c                   z-add     *hival        w_bldncd
141050141118     c                   else
141060141118     c                   clear                   w_bldncd
141070141118     c                   endif
141080080313     c                   clear                   w_bldnca
141090940916     C   12
141100940916     CAN 15
141110940916    2CANN30VIDFNS        IFEQ      'S'
141120920123     C*
141130020917     C     KBLC          SETLL     FIVAD000
141140020917     C     KBLC          READE(N)  FIVAD000                               31
141150910826     C*
141160940916    3C     *IN31         DOWEQ     *OFF
141170941230     C                   Z-ADD     BLDNCD        COMSCD
141180080313     c* mi memorizzo in campi di comodo il numero più basso e quello più
141190080313     c* alto di segnacollo che mi servirà per il controllo range se
141200080313     c* cliente con serie parziale
141210080313    4c                   if        bldncd<w_bldncd
141220080313     C                   Z-ADD     BLDNCD        W_bldncd
141230080313    4c                   endif
141240080313    4c                   if        bldnca>0
141250080313    5c                   if        bldnca>W_bldnca
141260080313     C                   Z-ADD     BLDNCA        W_bldnca
141270080313    5c                   endif
141280080313   x4c                   else
141290080313    5c                   if        bldncd>w_bldnca
141300080313     C                   Z-ADD     BLDNCD        W_bldnca
141310080313    5c                   endif
141320080313    4c                   endif
141330120828     C     KBLT          CHAIN     FNBLT27L                           32
141340051102    4c                   if        *in32
141350120828     C     KBLT          CHAIN(N)  Fiars01L                           32
141360120828    5c                   if        not *in32
141370120828     c     kblt          chain     fnart27l                           32
141380051102     c* Se non trovato ART record presente x errore: lo cancello
141390120828     c   32kblt          delete    fiars01l
141400120828    5c                   endif
141410051102    4c                   endif
141420960319     C  N32              SETON                                        3190
141430020917     C   32KBLC          READE(N)  FIVAD000                               31
141440940916    3C                   ENDDO
141450940916     C*
141460940916    3C     *IN90         IFEQ      *ON
141470940916     C                   EXSR      PRPMSG
141480940920     C                   GOTO      ENDC02
141490940916    3C                   ENDIF
141500940916     C                   SETON                                        30
141510940916    2C                   ENDIF
141520910826     C*
141530920124     C* PER GLI ALTRI CASI
141540940916    2C  N30VIDFNS        IFEQ      ' '
141550910118     C                   Z-ADD     VIDNCD        CO2SCD            8 0
141560910118     C                   Z-ADD     VIDNCD        COMSCD            7 0
141570940916    3C     VIDNCA        IFEQ      0
141580900503     C                   Z-ADD     VIDNCD        COMSCA
141590900502     C                   ELSE
141600910118     C                   Z-ADD     VIDNCA        COMSCA            8 0
141610940916    3C                   END
141620900502     C*
141630940916    3C     CO2SCD        DOWLE     COMSCA
141640990318     C     CO2SCD        ANDGT     0
141650920124     C*
141660920124     C* PER IMMISSIONE  / DISK CLIENTI SEQUENZIALI
141670920124     C   12
141680920124     CAN 15
141690940916    4CORN12              DO
141700120828     C     KBLT          CHAIN     FNBLT27L                           32
141710051102     c
141720051102    5C   32§ogntw        IFne      'PPT'
141730120828     C     KBLT          CHAIN(N)  Fiars01L                           32
141740120828    6c                   if        not *in32
141750120828     c     kblt          chain     fnart27l                           32
141760051102     c* Se non trovato ART record presente x errore: lo cancello
141770120828     c   32kblt          delete    fiars01l
141780120828    6c                   endif
141790051102    5c                   endif
141800051102     c
141810051102     C  N32              SETON                                        90
141820940916     C*
141830001212     C* PREPARA MESSAGGIO DI ERRORE
141840100517     c
141850100517     C   90              EXSR      PRPMSG
141860100517    4C                   END
141870920124     C*
141880920124     C* PER MANUTENZIONE CONTROLLO ANCHE DI NON ESSERE ME STESSA
141890940916     C   12
141900940916    4CANN15              DO
141910120828     C     KBLT          SETLL     FNBLT27L
141920120828     C     KBLT          READE     FNBLT27L                               32
141930920124     C*
141940940916    5C     *IN32         DOWEQ     *OFF
141950940916    6C     VIDSPE        IFNE      BLPSPE
141960940916     C                   SETON                                        9032
141970920124     C                   ELSE
141980120828     C     KBLT          READE     FNBLT27L                               32
141990940916    6C                   ENDIF
142000940916    5C                   ENDDO
142010940916    4C                   ENDDO
142020940916     C* SEGNACOLLO DOPPIO --> PREPARA MESSAGGIO DI ERRORE
142030940916    4C     *IN90         IFEQ      *ON
142040940916     C                   EXSR      PRPMSG
142050940920     C                   GOTO      ENDC02
142060940916    4C                   ENDIF
142070920124     C*
142080910826     C* CONTROLLO ALTRO NUMERO
142090910826     C                   ADD       1             CO2SCD
142100910826     C                   ADD       1             COMSCD
142110940916    3C                   END
142120940916    2C                   END
142130920124     C*
142140940916    1C                   END
142150910220     C*
142160910220     C*** NUMERO SERIE ***
142170940826     C*
142180100517    2C     VIDNRS        IFNE      0
142190100517     c
142200940922     C*
142210940922     C* SE SERIE <> DA 0 E FLAG6 DEL CTM NON E' "C" ERRORE
142220940916    3C     §1BFG6        IFNE      'C'
142230940916     C                   MOVEL     ERR(49)       VIDMSG
142240940922     C                   SETON                                        5690
142250940920     C                   GOTO      ENDC02
142260940916    3C                   END
142270100517     c
142280100517     c                   clear                   trulnrsds
142290100517     c                   movel     wksc          inrsCCM
142300100517     c                   movel     vidnrs        inrsNRS
142310100517     c                   movel     wfls          inrsFLS
142320100517    3c                   if        vidfns='S'
142330100517     c                   movel     w_bldncd      inrsNCD
142340100517     c                   movel     w_bldnca      inrsNCA
142350100517     c                   else
142360100517     c                   movel     vidncd        inrsNCD
142370100517     c                   movel     vidnca        inrsNCA
142380100517    3c                   endif
142390100517     c
142400100517     c                   call      'TRULNRSR'
142410100517     c                   parm                    trulnrsds
142420100517     c
142430110902    3c****               select
142440110902    3c****               when      onrserr<>' ' and
142450110902     c****                         onrserr<>'N'
142460110902    3c                   if        onrserr<>' '
142470100517     C                   MOVEL     onrsmsg       VIDMSG
142480100517     C                   SETON                                        9056
142490100517     C                   GOTO      ENDC02
142500110902     c                   endif
142510100517     c
142520110902    3c*********          when      onrserr= 'N' and f_range=' '
142530080313      *
142540110902     c
142550110902     c******             eval      f_range='1'
142560110902     c*******            seton                                        90
142570110902     c******             exsr      escier
142580110902    4C**** §lpfpr        IFNE      '5'
142590080314     C* gestione window con errore forzabile
142600110902     c*****              setoff                                       90
142610100517     c* riempi i campi col messaggio
142620110902     c*****              eval      w3cpfl1=%subst(onrsmsg:1:24)
142630110902     c*****              eval      w3cpfl2=%subst(onrsmsg:25:38)
142640110902     c*****              eval      w3cpfl3=%subst(onrsmsg:63:16)
142650100517     c
142660110902    5c****               if        §lpfpr<>'V'
142670110902     c****               write     ls01d02
142680110902    5c****               endif
142690110902    5c****               dou       *inkf
142700110902     c****               exfmt     ls01w3cp
142710110902    5c****               enddo
142720110902     c****               eval      wemfor='1'
142730110902     c****               goto      endc02
142740110902   x4C***+               ELSE
142750110902     c***                seton                                        90
142760110902     C****               GOTO      ENDC02
142770110902    4C****               ENDIF
142780110902    3c******             ENDSL
142790910308     C*
142800940916   X2C                   ELSE
142810910308     C* SERIE =0 FLAG6 DEL CTM = "C" ERRORE
142820940916    3C     §1BFG6        IFEQ      'C'
142830940916     C                   MOVEL     ERR(49)       VIDMSG
142840940922     C                   SETON                                        5690
142850940920     C                   GOTO      ENDC02
142860940916    3C                   END
142870940916    2C                   END
142880921006     C*
142890940916     C* SE RECUPERO CONTROLLO NUM SPEDIZIONE DOPPIO
142900990602    1C  N12PARTCH        IFEQ      'R'
142910940915     C     KNSP          SETLL     FNBLP01L                               30
142920940928    2C     *IN30         IFEQ      *ON
142930940916     C                   MOVEL     ERR(50)       VIDMSG
142940940922     C                   SETON                                        5690
142950940920     C                   GOTO      ENDC02
142960940928    2C                   END
142970940928    1C                   END
142980940916     C***
142990900502     C*** NATURA MERCE ***
143000940928    1C  N27VIDNAS        IFEQ      *BLANKS
143010940928     C                   MOVEL     ERR(53)       VIDMSG
143020940922     C                   SETON                                        4890
143030940920     C                   GOTO      ENDC02
143040940928    1C                   END
143050970115     C*
143060970115     C* CONTROLLO QUALI DICITURE NON SONO AMMESSE E PER QULI BOLLE
143070970115     C                   Z-ADD     1             C
143080970115    1C     LDC(C)        DOWNE     *BLANKS
143090970115     C*
143100970115     C                   CLEAR                   WRICER
143110970115    2C     WDESIE        IFEQ      'E'
143120970115    3C     TBO(C)        IFEQ      ' '
143130970115     C     TBO(C)        OREQ      'E'
143140970115     C                   MOVEL     'S'           WRICER            1
143150970115    3C                   ENDIF
143160970115    2C                   ENDIF
143170970115    2C     WDESIE        IFEQ      'I'
143180970115    3C     TBO(C)        IFEQ      ' '
143190970115     C     TBO(C)        OREQ      'I'
143200970115     C                   MOVEL     'S'           WRICER            1
143210970115    3C                   ENDIF
143220970115    2C                   ENDIF
143230970115     C*
143240970115    2C     WRICER        IFEQ      'S'
143250970115     C                   MOVEL     TBO(C)        W003A
143260970115     C                   MOVE      LDC(C)        W003A
143270970115     C                   MOVEL     '3F'          COD
143280970115     C                   MOVEL(P)  W003A         KEY
143290970115     C     KTAB2         CHAIN     TABEL                              30
143300970115    3C     *IN30         IFEQ      *OFF
143310970115     C                   MOVEA     TBLUNI        K89
143320970115    3C                   ENDIF
143330970115     C                   MOVEL     LDC(C)        Z                 2 0
143340970115     C                   Z-ADD     1             Y                 3 0
143350970115     C*
143360970115    3C     Y             DOWLT     86
143370970115     C                   CLEAR                   W015A
143380970115     C                   MOVEA     K89(Y)        W015A            15
143390970115    4C     W015A         IFNE      *BLANKS
143400970115     C     W015A:Z       SCAN      VIDNAS                                 31
143410970115     C* ERRORE
143420970115    5C     *IN31         IFEQ      *ON
143430970115     C*
143440970115     C     WDESIE        IFEQ      'E'
143450970115     C                   MOVEA     ERR(135)      K78
143460970115     C                   ELSE
143470970115     C                   MOVEA     ERR(136)      K78
143480970115     C                   ENDIF
143490970115     C                   Z-ADD     11            YY                3 0
143500970115     C                   DO        Z
143510970115     C                   MOVEL     K89(Y)        K78(YY)
143520970115     C                   ADD       1             YY
143530970115     C                   ADD       1             Y
143540970115     C                   ENDDO
143550970115     C                   MOVEL     '"'           K78(YY)
143560970115     C                   MOVEA     K78           VIDMSG
143570970115     C*
143580970115     C                   SETON                                        4890
143590970115     C                   Z-ADD     89            Y
143600970115     C                   Z-ADD     29            C
143610970115    5C                   ENDIF
143620970115    4C                   ENDIF
143630970115     C*
143640970115     C                   ADD       Z             Y
143650970115    3C                   ENDDO
143660970115    2C                   ENDIF
143670970115     C*
143680970115     C                   ADD       1             C
143690970115    1C                   ENDDO
143700940930     C***
143710940930     C*** MITTENTE ORIGINALE ***
143720941103     C                   MOVEL     VIDRMO        WRMO
143730941103     C                   MOVEL     VIDCMO        WCMO
143740941108     C                   MOVEL     VIDNMO        WNAR
143750941103     C                   EXSR      CTRMO
143760941103     C                   MOVEL     WNAR          VIDNMO
143770941103     C     WEMFOR        IFEQ      '1'
143780941103     C                   GOTO      ENDC02
143790941103     C                   ENDIF
143800091008     c*** . . .obbligatorio per porti assegnati import
143810091008     c                   if        §3atb1='A2' and (§ogntw='FED' or
143820091008     c                             §ogntw='DPD' or §ogntw='EEX')
143830091008     c                             and (vidrmo=*blanks or vidcmo=*blanks)
143840091016     c                             and *in44=*off and vidfbr<>'S'
143850091008     C                   MOVEL     ERR(328)      VIDMSG
143860091008     C                   SETON                                        90
143870091008     c                   select
143880091008     c                   when      vidrmo=*blanks
143890091008     c                   seton                                        71
143900091008     c                   when      vidcmo=*blanks
143910091008     c                   seton                                        72
143920091008     c                   endsl
143930091008     C                   GOTO      ENDC02
143940091008     c                   endif
143950091008     c
143960940922     C***
143970940922     C*** CONTRASSEGNO ***
143980961204     c***
143990961204     C* PER BOLLE DI RESO NON SI PUO' INSERIRE
144000961204     C     VIDFBR        IFEQ      'S'
144010961204     C     §3AFCA        ANDGT     0
144020961204     C                   MOVEL     ERR(134)      VIDMSG
144030961204     C                   SETON                                        5090
144040961204     C                   GOTO      ENDC02
144050961204    1C                   ENDIF
144060940922     C* IN MANUTENZIONE: SE BOLLA CHE PREVEDE C/A MA E' CON MAMMA E
144070940922     C*  SI TRATTA DI UN TIPO BOLLA NON MANUTENZ, NON POSSO INSERIRE:
144080940922     C*  NE' TIPO INCASSO NE' C/ASSEGNO, MENTRE POSSO INSERIRE LE VARIE
144090940922     C*
144100940922    1C     *IN12         IFEQ      *ON
144110940922     C     *IN15         ANDEQ     *OFF
144120940922     C     *IN44         ANDEQ     *ON
144130940922     C     §3ABCM        ANDNE     ' '
144140940922     C     §3AFCA        ANDNE     0
144150940922     C*
144160940922    2C     VIDTIC        IFNE      *BLANKS
144170940922     C                   MOVEL     ERR(99)       VIDMSG
144180940922     C                   SETON                                        4990
144190940922    2C                   END
144200940922    2C  N90VIDCAS        IFNE      0
144210940922     C                   MOVEL     ERR(98)       VIDMSG
144220940922     C                   SETON                                        5090
144230940922    2C                   END
144240940922     C*
144250940922   X1C                   ELSE
144260940922     C*
144270940922     C* IN TUTTI GLI ALTRI CASI SI SEGUONO LE REGOLE CORRETTE
144280940922     C* NON C'E' FLAG C/ASSEGNO SU TIPO BOLLA
144290940922    2C     §3AFCA        IFEQ      0
144300940922     C*
144310940922    3C     VIDTIC        IFNE      *BLANKS
144320940922     C                   MOVEL     ERR(99)       VIDMSG
144330940922     C                   SETON                                        4990
144340940922    3C                   ENDIF
144350940922    3C  N90VIDCAS        IFNE      0
144360940922     C                   MOVEL     ERR(98)       VIDMSG
144370940922     C                   SETON                                        5090
144380940922    3C                   ENDIF
144390940922     C*
144400940922   X2C                   ELSE
144410940922     C*
144420940922     C*     C'E' FLAG C/ASSEGNO SU TIPO BOLLA
144430940922    3C     VIDCAS        IFEQ      0
144440940922     C                   MOVEL     ERR(98)       VIDMSG
144450940922     C                   SETON                                        5090
144460940922    3C                   ENDIF
144470011108     C  N90VIDVCA        IFEQ      *BLANKS
144480011108     C                   MOVEL     ERR(169)      VIDMSG
144490011108     C                   SETON                                        5190
144500011108     C                   ENDIF
144510940922    2C                   ENDIF
144520940922     C*
144530940922    1C                   ENDIF
144540940922     C* ERRORE
144550940922     C   90              GOTO      ENDC02
144560090622     c*
144570090622     c* Controllo tipo incasso C/A e relativa divisa
144580090622     c* richiamo pgm TRULTICR
144590090625    1c                   if        vidtic<>*blanks or vidcas>0
144600091211     c                   exsr      sr_trultic
144610091211     c                   exsr      sr_impochktic
144620090622     c
144630090625    2c                   if        oticric='T'
144640090624     c                   movel     otictic       vidtic
144650090624     c                   eval      wemfor='1'
144660090624     C                   GOTO      ENDC02
144670090625    2c                   endif
144680090625    2c                   if        oticric='D'
144690090624     c                   movel     oticdiv       vidvca
144700090624     C                   eval      wemfor='1'
144710090624     C                   GOTO      ENDC02
144720090625    2c                   endif
144730090622     c* Errore tipo incasso
144740091211     c* Se errore di tipo "C" lo segnalo solo se non c'è orm con
144750091211     c* triangolazione oppure se è stato già scelto il beneficiario
144760091211     c* del contrassegno
144770091211    2c                   if        oticerr='T' or (oticerr='C' and
144780091211     c                             (nochkticC=*off or (wcassel1='X'or
144790091211     c                             wcassel2='X')))
144800090624     C                   MOVEL     oticmsg       VIDMSG
144810090624     C                   SETON                                        4990
144820090624     C                   GOTO      ENDC02
144830091211    2C                   ENDIF
144840090622     c* Errore divisa
144850090625    2c                   if        oticerr='D'
144860090624     C                   MOVEL     oticmsg       VIDMSG
144870090624     C                   SETON                                        5190
144880090624     C                   GOTO      ENDC02
144890090624    2C                   ENDIF
144900090624     c* Ulteriori controlli non presenti in TRULTICR
144910090625
144920060707     c* se tipo incasso richiede il mittente originale controllo che
144930060707     c* sia stato immesso
144940090625    2c                   if        §1amro='S' and vidrmo=*blanks
144950060707     C                   MOVEL     ERR(304)      VIDMSG
144960060707     C                   SETON                                        7190
144970060707     C                   GOTO      ENDC02
144980090625    2c                   endif
144990090625      * Devo lo stesso agganciare tabella "TM" perchè serve poi nella
145000090625      * routine di registrazione
145010090625     C                   MOVEL     'TM'          COD
145020090625     C                   MOVEL(P)  WKSC          KEY
145030090625     C*
145040090625     C                   EXSR      CTABEL
145050090625     c  n30              movel     tbluni        dstm
145060090625     c   30              clear                   dstm
145070090625     c*
145080090625    1c                   endif
145090011108     C*
145100011108     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE IL C/A
145110011108     C* INDICATORE DI CHANGE 11 ON
145120011108    1C     VARVCA        IFNE      VIDVCA
145130011108    2C     WIN11         IFEQ      *BLANKS
145140011108     C     VIDCAS        ANDNE     0
145150011108     C                   MOVEL     ERR(105)      VIDMSG
145160011108     C                   SETON                                        5090
145170011108     C                   GOTO      ENDC02
145180011108    2C                   ENDIF
145190011108     C*
145200011108    1C                   ENDIF
145210011108     C*
145220011212      * pulisco il flag x la forzatura importo C/Assegno
145230011212     C     VIDCAS        IFNE      WARCAS
145240011212     C                   CLEAR                   FORCAS
145250011212     C                   Z-ADD     VIDCAS        WARCAS
145260011212     C                   ENDIF
145270011212     C                   CLEAR                   FCASAV
145280011211     C* Richiamo TRUL21R per controllo limiti importo C/Assegno
145290090921    1C     VIDCAS        IFGT      *ZEROS
145300011211     C                   CLEAR                   DSUL21
145310011211     C                   MOVEL     VIDCBO        I21CBO
145320090921    2C     VIDTSP        IFNE      *BLANKS
145330011211     C                   MOVEL     VIDTSP        I21TSP
145340011211     C                   ELSE
145350011211     C                   MOVEL     COMTSP        I21TSP
145360090921    2C                   ENDIF
145370011211     C                   Z-ADD     VIDLNP        I21LNP
145380011211     C                   MOVEL     VIDNZM        I21NZM
145390011211     C                   Z-ADD     COMLNA        I21LNA
145400011211     C                   MOVEL     VIDNZD        I21NZD
145410130826    2C**   *IN04         IFEQ      *ON
145420130826     C**                 Z-ADD     9999          I21KSC
145430130826     C**                 MOVEL     VIDLNP        I21KSC
145440130826   x2C**                 ELSE
145450130826     c* in I21ksc passo il mittente
145460011211     C                   Z-ADD     VIDCCM        I21KSC
145470090921    3C     VIDFLC        IFEQ      0
145480011211     C                   MOVEL     VIDLNP        I21KSC
145490090921   x3C                   ELSE
145500011211     C                   MOVEL     VIDFLC        I21KSC
145510090921    3C                   ENDIF
145520130826     c                   if        vidccm=9999
145530130826     c                   move      8888          i21ksc
145540130826     c                   endif
145550130826    2C**                 ENDIF
145560011211     C                   MOVEL     VIDCTR        I21CTR
145570011211     C                   MOVEL     VIDTIC        I21TIC
145580011211     C                   Z-ADD     VIDCAS        I21IMP
145590011211     C                   MOVEL     VIDVCA        I21DIV
145600011211     C                   MOVEL     KNMUS         I21UTE
145610011211     C                   MOVEL     NOMPGM        I21PGM
145620011211     C                   CALL      'TRUL21R'
145630011211     C                   PARM                    DSUL21
145640011212     C* Salvo il flag del limite di abilitazione C/A che mi servirà per
145650011212     C* il richiamo del pgm di stampa L.V.
145660011212     C                   MOVE      O21FCA        FCASAV
145670011211     C* IMPORTO MAGGIORE DEL LIMITE MAX
145680090921    2C     O21FX2        IFNE      *BLANKS
145690011211     C                   MOVEA     ERR(131)      K78
145700011212     C                   MOVE      O21LX2        WNUMED
145710011212     C* richiamo routine per editare il limite
145720011212     C                   EXSR      CALLXE
145730011211      * metto il numero editato nel campo del messaggio
145740011211     C                   MOVEA     W014A         SKII(1)
145750011211     C                   MOVEA     SKII(1)       K78(47)
145760011211     C*
145770011211     C                   MOVEA     K78           VIDMSG
145780011211     C                   SETON                                        5090
145790011211     C                   GOTO      ENDC02
145800090921    2C                   ENDIF
145810090921     c
145820011211     C* IMPORTO INFERIORE AL LIMITE MINIMO
145830090921    2C     O21FMN        IFNE      *BLANKS
145840011212     C                   MOVEA     ERR(236)      K78
145850011212     C                   MOVE      O21LMN        WNUMED
145860011212     C* richiamo routine per editare il limite
145870011212     C                   EXSR      CALLXE
145880011212      * metto il numero editato nel campo del messaggio
145890011212     C                   MOVEA     W014A         SKII(1)
145900011212     C                   MOVEA     SKII(1)       K78(31)
145910011212     C*
145920011212     C                   MOVEA     K78           VIDMSG
145930011212     C                   SETON                                        5090
145940011212     C                   GOTO      ENDC02
145950090921    2C                   ENDIF
145960090921     c
145970011211     C* IMPORTO MAGGIORE DEL LIMITE FORZABILE
145980090921    2C     O21FX1        IFNE      *BLANKS
145990011212     C     FORCAS        ANDEQ     *BLANKS
146000011212     C                   MOVEL     '1'           FORCAS            1
146010011212     C                   MOVEA     ERR(237)      K78
146020011212     C                   MOVE      O21LX1        WNUMED
146030011212     C* richiamo routine per editare il limite
146040011212     C                   EXSR      CALLXE
146050011212      * metto il numero editato nel campo del messaggio
146060011212     C                   MOVEA     W014A         SKII(1)
146070011212     C                   MOVEA     SKII(1)       K78(24)
146080011212     C                   MOVEA     K78           VIDMSG
146090011212     C                   SETON                                        5090
146100011212     C                   GOTO      ENDC02
146110090921    2C                   ENDIF
146120090921     c
146130090921     c* Tipo servizio H non ammesso er C/ASS da abilitare
146140090921     c                   if        fcasav<>*blanks  and  vidtsp='H'
146150090921     c                   SETON                                        5090
146160090921     C                   MOVEL     ERR(149)      VIDMSG
146170090921     C                   GOTO      ENDC02
146180090921     c                   endif
146190090921     c
146200090921    1C                   ENDIF
146210090625     C*
146220011108     C                   MOVEL     VIDVCA        VARVCA
146230011108     C                   CLEAR                   WIN11
146240940916     C***
146250961111     C*** N O T E    ***
146260990610     C* SONO OBBLIGATORIE SE BOLLA PREPAGATO PER TELEFONO E REFERENTE
146270990610     C*  RITIRO
146280990610    3C     PARTCH        IFEQ      'P'
146290990610     C     SES           ANDEQ     0
146300010306    3C     §LPFPR        OREQ      'O'
146310010306     C     SES           ANDEQ     0
146320990610     C                   MOVEL     ERR(159)      VIDMSG
146330990610     C                   MOVEL     1             SES
146340990610     C                   SETON                                        8690
146350990610     C                   GOTO      ENDC02
146360990610    3C                   END
146370990610     C*
146380990610    3C     VIDNT1        IFEQ      *BLANKS
146390990610     C     VIDNT2        ANDEQ     *BLANKS
146400990610     C     PARTCH        ANDEQ     'P'
146410010306    3C     VIDNT1        OREQ      *BLANKS
146420010306     C     VIDNT2        ANDEQ     *BLANKS
146430010306     C     §LPFPR        ANDEQ     'O'
146440990610     C                   MOVEL     ERR(159)      VIDMSG
146450990610     C                   SETON                                        8690
146460990610     C                   GOTO      ENDC02
146470990610    3C                   END
146480961111     C***
146490961111     C*** IMPORTO DA ASSICURARE ***
146500961111     C***
146510950120     C* SE VARIATO ME LO SALVO
146520950120     C     *IN89         IFEQ      *ON
146530950120     C                   MOVEL     '1'           WIN89             1
146540950120     C                   ENDIF
146550950104     C*
146560011112     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
146570011112     C     VIDIAS        IFGT      *ZEROS
146580011112     C     VIDVAS        ANDEQ     *BLANKS
146590011112     C                   MOVEL     ERR(169)      VIDMSG
146600011114     C                   SETON                                        8190
146610011112     C                   GOTO      ENDC02
146620011112     C                   ENDIF
146630011112     C*
146640950104     C                   MOVEL     VIDVAS        WVLT
146650950104     C                   Z-ADD     VIDIAS        W0133            13 3
146660950104     C* CONTROLLO LA DIVISA
146670950104     C                   EXSR      CTRVLT
146680950104     C                   MOVEL     WVLT          VIDVAS
146690950104     C* ERRORE
146700950104     C   90              SETON                                        81
146710950104     C*
146720950104     C     WEMFOR        IFEQ      '1'
146730950104     C                   GOTO      ENDC02
146740950104     C                   ENDIF
146750011113     C*
146760011113     C* CONTROLLO SCADENZA DIVISA
146770011113     C     BLPDSP        IFGT      §CVDLI
146780011113     C     VIDIAS        ANDNE     0
146790011113     C                   MOVEL     ERR(232)      VIDMSG
146800011114     C                   SETON                                        8190
146810011113     C                   GOTO      ENDC02
146820011113     C                   ENDIF
146830950104     C*
146840950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
146850950104     C* INDICATORE DI CHANGE 89 ON
146860950104     C     VIDVAS        IFNE      VARVAS
146870950120     C     WIN89         ANDEQ     *BLANKS
146880011112     C     VIDIAS        ANDNE     0
146890950104     C                   MOVEL     ERR(105)      VIDMSG
146900950104     C                   SETON                                        8090
146910950104     C                   GOTO      ENDC02
146920950104    2C                   ENDIF
146930950104     C*
146940950104     C                   MOVEL     VIDVAS        VARVAS
146950950120     C                   CLEAR                   WIN89
146960940922     C*
146970940922     C* LO PRENDO SOLO PER LE SPEDIZIONI IN FRANCO PERCHE' IN ASSEGNATO
146980940922     C*  LA MERCE E' FRANCO STABILIMENTO, PER CUI DIVENTA DEL DESTINAT
146990941103    1C     *IN04         IFEQ      *OFF
147000940922     C* SOLO SE IL MITTENTE HA TARIFFE
147010941108     C     WTKS          ANDEQ     'S'
147020950104     C*
147030950104     C* SE <> 0 CONTROLLO CHE NON SUPERI IL VALORE IN TARIFFA
147040011211    2C     VIDIAS        IFNE      VARIAS
147050950104     C     VIDNCL        ORNE      VARNCL
147060950104     C                   Z-ADD     0             DIE
147070991028    2C                   END
147080940922     C*
147090940922    2C     VIDIAS        IFGT      0
147100940922     C     DIE           ANDNE     NUMFOR
147110950215     C     TAMFIS        ORNE      '0'
147120011211     C                   Z-ADD     VIDIAS        VARIAS
147130940922     C                   MOVEL     VIDNCL        VARNCL
147140960209     C* NON CONTROLLA DA TARIFFA SE OBBLIG.SE TIPO BOLLA NON PREVISTO
147150960209     C     §3ATB1        LOOKUP    TBL                                    30
147160960209     C*
147170960209   2AC     *IN30         IFEQ      *ON
147180940922     C*
147190940922     C* SOLO SE E' ASSICURAZIONE ANCHE PER LE PARTENZE ( <> A )
147200990818     C     KTPT          CHAIN     TITPT000                           30
147210950220    3C     *IN30         IFEQ      *ON
147220950220     C     TPTATB        ORNE      ' '
147230950220     C     TPTAPL        ORNE      'A'
147240950215     C*
147250950215     C* TAMFIS=1 OBBLIGATORIO     FORZABILE --> CON ENTER PRENDO MAX
147260950215     C*                                         IMPORTO DA TARIFFA
147270950215    4C     TAMFIS        IFEQ      '1'
147280950215     C     CIN           ANDNE     NUMFOR
147290011211     C     VIDIAS        ANDEQ     0
147300950215     C                   MOVEL     ERR(93)       VIDMSG
147310950215     C                   SETON                                        8090
147320950215     C                   ADD       1             CIN
147330950215     C                   GOTO      ENDC02
147340950215    4C                   ENDIF
147350950215     C*
147360950215     C* TAMFIS=3 OBBLIGATORIO NON FORZABILE --> ERRORE SEMPRE
147370950215    4C     TAMFIS        IFEQ      '3'
147380011211     C     VIDIAS        ANDEQ     0
147390950215     C                   MOVEL     ERR(94)       VIDMSG
147400950215     C                   SETON                                        8090
147410950215     C                   GOTO      ENDC02
147420950215    4C                   ENDIF
147430950215     C*
147440950215     C* TAMFIS=2 NON INSERIBILE             --> ERRORE SEMPRE
147450950215    4C     TAMFIS        IFEQ      '2'
147460011211     C     VIDIAS        ANDNE     0
147470950215     C                   MOVEL     ERR(95)       VIDMSG
147480950217     C                   SETON                                        8090
147490950215     C                   GOTO      ENDC02
147500950215    4C                   ENDIF
147510950220    3C                   ENDIF
147520950215     C* SE C'E VALORE MERCE:
147530950220    3C  N30TPTATB        IFEQ      ' '
147540950220     C     TPTAPL        ANDNE     'A'
147550950220     C     TPTVLM        ANDGT     0
147560940922     C* VALORE A COLLO
147570950220    4C     TPTFVM        IFEQ      '1'
147580991028     C     VIDNCL        MULT      TPTVLM        W0133A           13 3
147590950220   X4C                   ELSE
147600950220    5C     TPTFVM        IFEQ      '2'
147610991028     C                   Z-ADD     TPTVLM        W0133A
147620950220   X5C                   ELSE
147630940922     C     V2CPKG        ADD       0,9           W0060             6 0
147640991028     C     W0060         MULT      TPTVLM        W0133A
147650950220    5C                   END
147660950220    4C                   END
147670991028     C**
147680991028     C* TRASFORMO L'IMPORTO DA ASSICURARE NELLA DIVISA DELLA TARIFFA
147690011113     C                   Z-ADD     VIDIAS        IASTAR
147700991028    5C     COMDIV        IFNE      VIDVAS
147710991028     C                   CLEAR                   DSYEUR
147720991028     C                   MOVEL     VIDVAS        YECDVI
147730991028     C                   MOVEL     COMDIV        YECDVO
147740991028     C                   Z-ADD     VIDIAS        YECIMI
147750011113     C                   MOVE      COMDEC        YECDCO
147760991028     C*
147770991028     C                   CALL      'YEURCO'
147780991028     C                   PARM                    DSYEUR
147790991028     C*
147800991028    6C     YECESI        IFEQ      ' '
147810011113     C                   Z-ADD     YECIMO        IASTAR           17 3
147820991028    6C                   ENDIF
147830991028    5C                   ENDIF
147840940922     C*
147850011113    4C     IASTAR        IFGT      W0133A
147860950217     C     DIE           ANDNE     NUMFOR
147870940922     C                   ADD       1             DIE
147880940922     C                   MOVEL     ERR(97)       VIDMSG
147890941231     C                   SETON                                        8090
147900940922     C                   GOTO      ENDC02
147910950220    4C                   ENDIF
147920940922     C*
147930950215    3C                   ENDIF
147940960209   2AC                   ENDIF
147950960209    2C                   ENDIF
147960940922    1C                   ENDIF
147970940916     C*
147980011211      * pulisco il flag x la forzatura importo da assicurare forzabile
147990011211     C     VIDIAS        IFNE      WARIAS
148000011211     C                   CLEAR                   FORIAS
148010011211     C                   Z-ADD     VIDIAS        WARIAS
148020011211     C                   ENDIF
148030011211     C*
148040011211     C* CONTROLLO LIMITI IMPORTO DA ASSICURARE
148050011211     C     VIDIAS        IFGT      0
148060011211     C                   CLEAR                   DSUL22
148070011211     C                   MOVEL     VIDCBO        I22CBO
148080011211     C     VIDTSP        IFNE      *BLANKS
148090011211     C                   MOVEL     VIDTSP        I22TSP
148100011211     C                   ELSE
148110011211     C                   MOVEL     COMTSP        I22TSP
148120011211     C                   ENDIF
148130011212     C                   Z-ADD     VIDLNP        I22LPS
148140011211     C                   MOVEL     VIDNZM        I22NZM
148150011211     C                   Z-ADD     COMLNA        I22LNS
148160011211     C                   MOVEL     VIDNZD        I22NZD
148170011211     C     *IN04         IFEQ      *ON
148180011211     C                   Z-ADD     9999          I22KSC
148190011211     C                   MOVEL     VIDLNP        I22KSC
148200011211     C                   ELSE
148210011211     C                   Z-ADD     VIDCCM        I22KSC
148220011211     C     VIDFLC        IFEQ      0
148230011211     C                   MOVEL     VIDLNP        I22KSC
148240011211     C                   ELSE
148250011211     C                   MOVEL     VIDFLC        I22KSC
148260011211     C                   ENDIF
148270011211     C                   ENDIF
148280011211     C                   MOVEL     VIDCTR        I22CTR
148290011211     C                   Z-ADD     VIDIAS        I22IMP
148300011211     C                   MOVEL     VIDVAS        I22DIV
148310011211     C                   MOVEL     KNMUS         I22UTE
148320011211     C                   MOVEL     NOMPGM        I22PGM
148330011211     C                   CALL      'TRUL22R'
148340011211     C                   PARM                    DSUL22
148350011211     C* IMPORTO DA ASSICUARE NON AMMESSO
148360011211     C     O22FMN        IFNE      *BLANKS
148370011211     C     O22FX1        ANDNE     *BLANKS
148380011211     C     O22FX2        ANDNE     *BLANKS
148390011211     C                   MOVEL     ERR(234)      VIDMSG
148400011211     C                   SETON                                        8090
148410011211     C                   GOTO      ENDC02
148420011211     C                   ENDIF
148430011211     C* IMPORTO DA ASSICURARE > DEL LIMITE IMPOSTO
148440011211     C     O22FX2        IFNE      *BLANKS
148450011211     C                   MOVEA     ERR(96)       K78
148460011212     C                   MOVE      O22LX2        WNUMED
148470011212     C* richiamo routine per editare il limite
148480011212     C                   EXSR      CALLXE
148490011211      * metto il numero editato nel campo del messaggio
148500011211     C                   MOVEA     W014A         SKII(1)
148510011211     C                   MOVEA     SKII(1)       K78(38)
148520011211     C                   MOVEA     K78           VIDMSG
148530011211     C                   SETON                                        8090
148540011211     C                   GOTO      ENDC02
148550011211     C                   ENDIF
148560011211     C* IMPORTO DA ASSICURARE INFERIORE DEL LIMITE DI LEGGE
148570011211     C     O22FMN        IFNE      *BLANKS
148580011211     C                   MOVEA     ERR(165)      VIDMSG
148590011211     C                   SETON                                        8090
148600011211     C                   GOTO      ENDC02
148610011211     C                   ENDIF
148620011211     C* IMPORTO DA ASSICURARE > DEL LIMITE FORZABILE
148630011211     C     O22FX1        IFNE      *BLANKS
148640011211     C     FORIAS        ANDEQ     *BLANKS
148650011211     C                   MOVEL     '1'           FORIAS            1
148660011211     C                   MOVEA     ERR(235)      K78
148670011212     C                   MOVE      O22LX1        WNUMED
148680011212     C* richiamo routine per editare il limite
148690011212     C                   EXSR      CALLXE
148700011211      * metto il numero editato nel campo del messaggio
148710011211     C                   MOVEA     W014A         SKII(1)
148720011211     C                   MOVEA     SKII(1)       K78(28)
148730011211     C                   MOVEA     K78           VIDMSG
148740011211     C                   SETON                                        8090
148750011211     C                   GOTO      ENDC02
148760011211     C                   ENDIF
148770011211     C                   ENDIF
148780950102     C***
148790950102     C*** QUANTITA' DA FATTURARE  ***
148800950102     C                   MOVEL     VIDCTR        W001A
148810950102     C*
148820950103     C* SE MODIFICATA, PULISCO IL FLAG DI CONTROLLO
148830950102     C     VIDQFT        IFNE      VARQFT
148840950102     C                   CLEAR                   UND
148850950102     C                   MOVEL     VIDQFT        VARQFT
148860950102     C                   ENDIF
148870950102     C*
148880950103     C* CONTROLLO LA Q.TA DA FATTURARE CON TARIFFE SOLO SE C'E'
148890950103     C*  TARIFFA E SE E' FRANCO, PER ASSEGNATO E' DEL DESTINATARIO
148900950102    1C     WTKS          IFEQ      'S'
148910950102     C     W001A         ANDEQ     '4'
148920950103     C     *IN04         ANDEQ     *OFF
148930950102     C*
148940950102    2C     VIDQFT        IFEQ      0
148950950102     C*
148960950102     C* TAMFVD = '1' ASSUMO VALORE DA ASSICURARE SE NON IMMESSO
148970950103    3C     TAMFVD        IFEQ      '1'
148980950103     C     UND           ANDEQ     0
148990950102     C                   MOVEL     ERR(106)      VIDMSG
149000950102     C                   SETON                                        8490
149010950102     C                   MOVEL     1             UND
149020950102     C                   GOTO      ENDC02
149030950103    3C                   ENDIF
149040961007     C* TAMFVD = '2' O '4'  INSERIRE IN BOLLETTAZIONE
149050950103    3C     TAMFVD        IFEQ      '2'
149060961007     C     TAMFVD        OREQ      '4'
149070950102     C                   MOVEL     ERR(107)      VIDMSG
149080950102     C                   SETON                                        8490
149090950102     C                   GOTO      ENDC02
149100950103    3C                   ENDIF
149110950102     C*
149120950102   X2C                   ELSE
149130950102     C* TAMFVD = '3' ASSUME SEMPRE IMPORTO DA ASSICURARE: DA NON INSER
149140950102    3C     TAMFVD        IFEQ      '3'
149150950102     C                   MOVEL     ERR(108)      VIDMSG
149160950102     C                   SETON                                        8490
149170950102     C                   GOTO      ENDC02
149180950102    3C                   ENDIF
149190950102    2C                   ENDIF
149200950102    1C                   ENDIF
149210950102     c* TARIFFA A QUANTITA'
149220950102     C     W001A         IFEQ      '5'
149230950102     C     VIDQFT        ANDEQ     0
149240950102     C                   MOVEL     ERR(109)      VIDMSG
149250950102     C                   SETON                                        8490
149260950102     C                   GOTO      ENDC02
149270950102    3C                   ENDIF
149280940922     C***
149290940922     C*** VALORE MERCE DICHIARATO ***
149300940922     C*
149310011113     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
149320011113     C     VIDVMD        IFGT      *ZEROS
149330011113     C     VIDVAD        ANDEQ     *BLANKS
149340011113     C                   MOVEL     ERR(169)      VIDMSG
149350011113     C                   SETON                                        6990
149360011113     C                   GOTO      ENDC02
149370011113     C                   ENDIF
149380021118
149390021118      * Se Spedizione Export EuroExpress con ddt "S"
149400021118      *  ---> Obbligatorio il valore merce
149410021118     c                   If        SavGdd = 'S' and VidVmd = *Zeros
149420021118     c                             and a_§OgNtw = 'EEX'
149430021118     c                   Movel     Err(259)      VidMsg
149440021118     c                   Eval      *In82 = *On
149450021118     c                   Eval      *In90 = *On
149460021118     c                   Goto      Endc02
149470021118     c                   EndIf
149480011113     C*
149490940922     C                   MOVEL     VIDVAD        WVLT
149500940922     C                   Z-ADD     VIDVMD        W0133            13 3
149510940922     C* CONTROLLO LA DIVISA
149520940922     C                   EXSR      CTRVLT
149530940922     C                   MOVEL     WVLT          VIDVAD
149540940922     C* ERRORE
149550950410     C   90              SETON                                        69
149560940922     C*
149570940928    1C     WEMFOR        IFEQ      '1'
149580940922     C                   GOTO      ENDC02
149590940928    1C                   ENDIF
149600011113     C*
149610011113     C* CONTROLLO SCADENZA DIVISA
149620011113     C     BLPDSP        IFGT      §CVDLI
149630011113     C     VIDVMD        ANDNE     0
149640011113     C                   MOVEL     ERR(232)      VIDMSG
149650011113     C                   SETON                                        6990
149660011113     C                   GOTO      ENDC02
149670011113     C                   ENDIF
149680941219     C*
149690950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
149700941219     C* INDICATORE DI CHANGE 88 ON
149710941219    2C     VARVAD        IFNE      VIDVAD
149720950120     C     WIN88         ANDEQ     *BLANKS
149730011113     C     VIDVMD        ANDNE     0
149740941220     C                   MOVEL     ERR(105)      VIDMSG
149750941231     C                   SETON                                        8290
149760941219     C                   GOTO      ENDC02
149770941219     C                   ENDIF
149780941219     C*
149790941219     C                   MOVEL     VIDVAD        VARVAD
149800950120     C                   CLEAR                   WIN88
149810011212      * pulisco il flag x la forzatura valore merce
149820011212     C     VIDVMD        IFNE      WARVMD
149830011212     C                   CLEAR                   FORVMD
149840050714     c                   Clear                   forzavmd          1
149850011212     C                   Z-ADD     VIDVMD        WARVMD
149860011212     C                   ENDIF
149870011212     C* CONTROLLO LIMITI
149880011212     C                   CLEAR                   DSUL23
149890011212     C                   MOVEL     VIDCBO        I23CBO
149900011212     C     VIDTSP        IFNE      *BLANKS
149910011212     C                   MOVEL     VIDTSP        I23TSP
149920011212     C                   ELSE
149930011212     C                   MOVEL     COMTSP        I23TSP
149940011212     C                   ENDIF
149950011212     C                   Z-ADD     VIDLNP        I23LNP
149960011212     C                   MOVEL     VIDNZM        I23NZM
149970011212     C                   Z-ADD     COMLNA        I23LNA
149980011212     C                   MOVEL     VIDNZD        I23NZD
149990011212     C     *IN04         IFEQ      *ON
150000011212     C                   Z-ADD     9999          I23KSC
150010011212     C                   MOVEL     VIDLNP        I23KSC
150020011212     C                   ELSE
150030011212     C                   Z-ADD     VIDCCM        I23KSC
150040011212     C     VIDFLC        IFEQ      0
150050011212     C                   MOVEL     VIDLNP        I23KSC
150060011212     C                   ELSE
150070011212     C                   MOVEL     VIDFLC        I23KSC
150080011212     C                   ENDIF
150090011212     C                   ENDIF
150100011212     C                   MOVEL     VIDCTR        I23CTR
150110011212     C                   Z-ADD     VIDVMD        I23IMP
150120011212     C                   MOVEL     VIDVAD        I23DIV
150130011212     C                   MOVEL     KNMUS         I23UTE
150140011212     C                   MOVEL     NOMPGM        I23PGM
150150011212     C                   CALL      'TRUL23R'
150160011212     C                   PARM                    DSUL23
150170011212     C* IMPORTO INFERIORE AL LIMITE MINIMO
150180011212    1C     O23FMN        IFNE      *BLANKS
150190011212     C* Il messaggio è diverso a seconda che l'importo passato sia 0
150200011212     C* O > 0
150210011212    2C     VIDVMD        IFEQ      *ZEROS
150220011212     C                   MOVEL     ERR(238)      VIDMSG
150230011212   x2C                   ELSE
150240011212     C                   MOVEA     ERR(239)      K78
150250011212     C                   MOVE      O23LMN        WNUMED
150260011212     C* richiamo routine per editare il limite
150270011212     C                   EXSR      CALLXE
150280011212      * metto il numero editato nel campo del messaggio
150290011212     C                   MOVEA     W014A         SKII(1)
150300011212     C                   MOVEA     SKII(1)       K78(37)
150310011212     C                   MOVEA     K78           VIDMSG
150320011212    2C                   ENDIF
150330011212     C                   SETON                                        8290
150340011212     C                   GOTO      ENDC02
150350011212    1C                   ENDIF
150360011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO BLOCCANTE
150370011212     C     O23FX2        IFNE      *BLANKS
150380011212     C                   MOVEA     ERR(240)      K78
150390011212     C                   MOVE      O23LX2        WNUMED
150400011212     C* richiamo routine per editare il limite
150410011212     C                   EXSR      CALLXE
150420011212      * metto il numero editato nel campo del messaggio
150430011212     C                   MOVEA     W014A         SKII(1)
150440011212     C                   MOVEA     SKII(1)       K78(53)
150450011212     C                   MOVEA     K78           VIDMSG
150460011212     C                   SETON                                        8290
150470011212     C                   GOTO      ENDC02
150480011212     C                   ENDIF
150490011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO FORZABILE
150500011212     C     O23FX1        IFNE      *BLANKS
150510011212     C     FORVMD        ANDEQ     *BLANKS
150520011212     C                   MOVE      '1'           FORVMD            1
150530011212     C                   MOVEA     ERR(241)      K78
150540011212     C                   MOVE      O23LX1        WNUMED
150550011212     C* richiamo routine per editare il limite
150560011212     C                   EXSR      CALLXE
150570011212      * metto il numero editato nel campo del messaggio
150580011212     C                   MOVEA     W014A         SKII(1)
150590011212     C                   MOVEA     SKII(1)       K78(30)
150600011212     C                   MOVEA     K78           VIDMSG
150610011212     C                   SETON                                        8290
150620011212     C                   GOTO      ENDC02
150630011212     C                   ENDIF
150640950410     C* SE IMP ASSICURARE E VAL MERCE HANNO STESSO IMPORTO--> DEVONO
150650950410     C*  AVERE  ANCHE STESSA DIVISA E VICEVERSA
150660050714      * msg forzabile
150670950410    1C     VIDVMD        IFGT      0
150680950410     C*
150690950410     C     VIDIAS        IFEQ      VIDVMD
150700950410     C     VIDVAD        ANDNE     VIDVAS
150710050714     c     forzavmd      andeq     *Blanks
150720050714     c                   Eval      vidmsg = ERR(122)
150730950410     C                   SETON                                        6990
150740050714     c                   Eval      forzavmd = '1'
150750950410     C                   GOTO      ENDC02
150760950410    2C                   ENDIF
150770950410     C     VIDVAD        IFEQ      VIDVAS
150780950410     C     VIDIAS        ANDGT     0
150790950410     C     VIDIAS        ANDNE     VIDVMD
150800050714     c     forzavmd      andeq     *Blanks
150810050714     c                   Eval      vidmsg = ERR(122)
150820950410     C                   SETON                                        8290
150830050714     c                   Eval      forzavmd = '1'
150840950410     C                   GOTO      ENDC02
150850950410    2C                   ENDIF
150860950410     C*
150870950410    1C                   ENDIF
150880940913     C***
150890930329     C*** CONSEGNA RICHISTA ***
150900090901     c*  non accetto la consegna richiesta se tipo servizio H
150910150202     c                   if        (viddcr>0 or vidhcr>0) and vidtsp='H'
150920090901     C                   MOVEL     ERR(60)       VIDMSG
150930090901     C                   SETON                                        5990
150940090901     c                   goto      endc02
150950090901     c                   endif
150951170725     c*  LE SEGUENTI SPECIFICHE SARANNO DA ATTIVARE CON LA PROSSIMA CED
150952170615     c*  non accetto la consegna richiesta contrassegno da abilitare
150953170725     c*******            if        viddcr>0 and vidtcr<>'D' and fcasav<>*blanks
150954170725     C*******            MOVEL     ERR(367)      VIDMSG
150955170725     C********           SETON                                        5990
150956170725     c********           goto      endc02
150957170725     c********           endif
150958170615     c*  non accetto la consegna richiesta se sped in F.D.
150959170615     c                   if        (viddcr>0 or vidhcr>0) and vidffd='S'
150960170615     C                   MOVEL     ERR(368)      VIDMSG
150961170615     C                   SETON                                        5990
150962170615     c                   goto      endc02
150963170615     c                   endif
150964090901     c
150970941115     C                   Z-ADD     VIDDCR        WDCR
150980941115     C                   Z-ADD     VIDHCR        WHCR
150990941115     C                   Z-ADD     VIDMCR        WMCR
151000940913     C                   MOVEL     VIDTCR        WTCR
151010940913     C                   EXSR      CTRCR
151020940916     C                   MOVEL     WDCR          VIDDCR
151030940920     C   90              GOTO      ENDC02
151040101022     c
151050101022     c* Controllo se cade in giorno festivo col calendario arrivi
151060101022    1c                   if        vidtcr=' '  and viddcr>0
151070101022     c                   movel     comdcr        wdata
151080101022     c                   clear                   w0030
151090101022     C     KCLNa         CHAIN     AZCLN01L                           30
151100101022     C   30              CLEAR                   CLNPOM
151110101022     C                   MOVEA     CLNPOM        K31
151120101022     C                   MOVEL     K31(WGG)      WFEST
151130101022     c     wfest         lookup    S1Y                                    30
151140101022     c
151150101022     c                   if        *in30 and wfest<>' '
151160141124     c                   select
151170141124     c                   when      a_§ogntw<>'FED' and a_§ogntw<>'DPD'
151180141124     c                             and a_§ogntw<>'EEX'
151190101022     C                   MOVEL     ERR(197)      VIDMSG
151200101022     C                   SETON                                        5990
151210101022     C                   GOTO      ENDC02
151220141124     c                   when      comlna<>wforz_lna
151230141124     c                   eval      wforz_lna=comlna
151240141124     C                   MOVEL     ERR(197)      VIDMSG
151250141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
151260141124     C                   SETON                                        5990
151270141124     C                   GOTO      ENDC02
151280141124     c                   endsl
151290101022    2C                   ENDIF
151300101022    1C                   ENDIF
151310940916     C***
151320960319     C*** GIORNI DI CHIUSURA ***
151330960319     C                   MOVEL     VIDGC1        WGC1
151340960319     C                   MOVEL     VIDGC2        WGC2
151350960319     C                   EXSR      CTRGCH
151360960319     C   90              GOTO      ENDC02
151370940214     C*
151380100219     c
151390940919     C***
151400940919     C*** PARTICOLARITA' C/A ***
151410940919    1C     VIDGCA        IFNE      *BLANKS
151420941005     C     VIDGCR        ORNE      *BLANKS
151430031029      * salto questo controllo
151440031029      * xchè per ora la particolarità c/a non deve essere gestita
151450031029     c                   GoTo      DopoMsg
151460940922     C*
151470940922     C* non posso indicarla se tipo bolla non prevede C/Assegno
151480940928    2C     §3AFCA        IFEQ      0
151490941005     C     VIDGCA        ANDNE     *BLANKS
151500940922     C                   SETON                                        6590
151510940922     C                   MOVEL     ERR(103)      VIDMSG
151520940922     C                   GOTO      ENDC02
151530940922    2C                   ENDIF
151540031029     c     DopoMsg       Tag
151550940922     C*
151560941005     C* RICHIAMO IL PRG DI RICERCA
151570941005    2C     VIDGCR        IFEQ      '?'
151580031029      * non devo fare nessuna ricerca xchè per ora la particolarità c/a non
151590031029      * deve essere gestita
151600031029     c                   GoTo      DopoRicGca
151610941005     C                   CLEAR                   DS7PQR
151620941005     C                   MOVEL     'S'           DS7RIC
151630941005     C                   MOVEL     'V'           DS7GES
151640941005     C                   MOVEL     WKSC          DS7KSC
151650941005     C                   MOVEL     VIDGCA        DS7COD
151660941005     C                   MOVEL     DS7PQR        KPJBU
151670941005     C                   CALL      'TRTB72R'
151680941005     C                   PARM                    KPJBA
151690941005     C                   MOVEL     KPJBU         DS7PQR
151700111110     C***                CLEAR                   VIDGCR
151710941005     C*
151720941005     C     VIDGCA        IFEQ      *BLANKS
151730941005     C                   MOVEL     DS7COD        VIDGCA
151740941005    2C                   ENDIF
151750941005     C*
151760111110     c     DopoRicGca    Tag
151770111110     C                   CLEAR                   VIDGCR
151780960109     C                   SETON                                        65
151790941005     C                   MOVEL     '1'           WEMFOR
151800111110     c***  DopoRicGca    Tag
151810941005     C                   GOTO      ENDC02
151820941005    2C                   ENDIF
151830941005     C* CONTROLLO
151840031029      * non devo fare nessun controllo xchè per ora la particolarità c/a non
151850031029      * deve essere gestita
151860031029      * ma se immessa emetto un errore
151870031029     c                   Eval      VidMsg = Err(31)
151880031029     c                   Eval      *In65 = *On
151890031029     c                   Eval      *In90 = *On
151900031029     c                   Goto      EndC02
151910031029
151920941005     C                   CLEAR                   DS7PQR
151930941005     C                   MOVEL     'S'           DS7RIC
151940941005     C                   MOVEL     'C'           DS7GES
151950941005     C                   MOVEL     WKSC          DS7KSC
151960941005     C                   MOVEL     VIDGCA        DS7COD
151970941005     C                   MOVEL     DS7PQR        KPJBU
151980941005     C                   CALL      'TRTB72R'
151990941005     C                   PARM                    KPJBA
152000941005     C                   MOVEL     KPJBU         DS7PQR
152010941005     C* ERRORE
152020941005    2C     DS7ERR        IFEQ      '1'
152030941005     C                   MOVEL     DS7MSG        VIDMSG
152040941005     C                   SETON                                        6590
152050940920     C                   GOTO      ENDC02
152060940919    2C                   ENDIF
152070940922     C*
152080940922    1C                   ENDIF
152090940919     C***
152100940919     C*** PARTICOLARITA' GIACENZA ***
152110940919    1C     VIDGGA        IFNE      *BLANKS
152120941005     C     VIDGGR        ORNE      *BLANKS
152130941005     C*
152140941005     C* RICHIAMO IL PRG DI RICERCA
152150951120    2C     VIDGGR        IFEQ      '?'
152160941005     C                   CLEAR                   DS7PQR
152170941005     C                   MOVEL     'S'           DS7RIC
152180941005     C                   MOVEL     'V'           DS7GES
152190941005     C                   MOVEL     VIDGGA        DS7COD
152200941005     C                   MOVEL     DS7PQR        KPJBU
152210941005     C                   CALL      'TRTB69R'
152220941005     C                   PARM                    KPJBA
152230941005     C                   MOVEL     KPJBU         DS7PQR
152240960109     C                   CLEAR                   VIDGGR
152250941005     C*
152260941005     C     VIDGGA        IFEQ      *BLANKS
152270941005     C                   MOVEL     DS7COD        VIDGGA
152280941005    2C                   ENDIF
152290941005     C*
152300960109     C                   SETON                                        66
152310941005     C                   MOVEL     '1'           WEMFOR
152320941005     C                   GOTO      ENDC02
152330941005    2C                   ENDIF
152340941005     C* CONTROLLO
152350941005     C                   CLEAR                   DS7PQR
152360941005     C                   MOVEL     'S'           DS7RIC
152370941005     C                   MOVEL     'C'           DS7GES
152380941005     C                   MOVEL     WKSC          DS7KSC
152390941005     C                   MOVEL     VIDGGA        DS7COD
152400941005     C                   MOVEL     DS7PQR        KPJBU
152410941005     C                   CALL      'TRTB69R'
152420941005     C                   PARM                    KPJBA
152430941005     C                   MOVEL     KPJBU         DS7PQR
152440941005     C* ERRORE
152450941005    2C     DS7ERR        IFEQ      '1'
152460941005     C                   MOVEL     DS7MSG        VIDMSG
152470941005     C                   SETON                                        6690
152480940920     C                   GOTO      ENDC02
152490940919    2C                   ENDIF
152500940919    1C                   ENDIF
152510940919     C***
152520940919     C*** PARTICOLARITA' CONSEGNA ***
152530100218     c                   clear                   ds7r
152540940922    1C     VIDGMA        IFNE      *BLANKS
152550951120     C     VIDGMR        ORNE      *BLANKS
152560941005     C* RICHIAMO IL PRG DI RICERCA
152570941005    2C     VIDGMR        IFEQ      '?'
152580941005     C                   CLEAR                   DS7PQR
152590941005     C                   MOVEL     'S'           DS7RIC
152600941005     C                   MOVEL     'V'           DS7GES
152610941005     C                   MOVEL     VIDGMA        DS7COD
152620941005     C                   MOVEL     DS7PQR        KPJBU
152630941005     C                   CALL      'TRTB70R'
152640941005     C                   PARM                    KPJBA
152650941005     C                   MOVEL     KPJBU         DS7PQR
152660960109     C                   CLEAR                   VIDGMR
152670941005     C*
152680941005     C     VIDGMA        IFEQ      *BLANKS
152690941005     C                   MOVEL     DS7COD        VIDGMA
152700941005    2C                   ENDIF
152710941005     C*
152720960109     C                   SETON                                        67
152730941005     C                   MOVEL     '1'           WEMFOR
152740941005     C                   GOTO      ENDC02
152750941005    2C                   ENDIF
152760941005     C* CONTROLLO
152770941005     C                   CLEAR                   DS7PQR
152780941005     C                   MOVEL     'S'           DS7RIC
152790941005     C                   MOVEL     'C'           DS7GES
152800941005     C                   MOVEL     WKSC          DS7KSC
152810941005     C                   MOVEL     VIDGMA        DS7COD
152820941005     C                   MOVEL     DS7PQR        KPJBU
152830941005     C                   CALL      'TRTB70R'
152840941005     C                   PARM                    KPJBA
152850941005     C                   MOVEL     KPJBU         DS7PQR
152860941005     C* ERRORE
152870941005    2C     DS7ERR        IFEQ      '1'
152880100215     C                   MOVEL     DS7MSG        VIDMSG
152890941005     C                   SETON                                        6790
152900940920     C                   GOTO      ENDC02
152910940919    2C                   ENDIF
152920100215     c*
152930100215     c* Da tabella 7R verifico se prevede il calcolo della consegna
152940100215     c*  richeista (Tab DCR) e segnalo eventuali incongruenze
152950100215     C                   MOVEL     '7R'          COD
152960100215     C                   MOVEL(P)  VIDGMA        KEY
152970100215     C                   EXSR      CTABEL
152980100215     C                   MOVEL     TBLUNI        DS7R
152990100215     c
153000100215     c                   if        §7ratt ='S' and
153010100215     c                             (vidtsp='H' or vidtsp='E')
153020100215     C                   MOVEL     err(332)      VIDMSG
153030100215     C                   SETON                                        6790
153040100215     C                   GOTO      ENDC02
153050100215    2C                   ENDIF
153060100218     c
153070100224    1c                   if        §7ratt ='S' and
153080100217     c                             (vidore>0 or viddcr>0 )
153090100218     c* In manutenzione non do errore se la particolarità c'era
153100100218     c*  anche prima
153110100224     c* Se richiamato da pgm di cambio porto dirottamento non do errore
153120100224     c                   if        not *in44 and (not *in12 or *in15 or
153130100224     c                              blpgma<>vidgma)
153140100215     C                   MOVEL     err(333)      VIDMSG
153150100215     C                   SETON                                        6790
153160100215     C                   GOTO      ENDC02
153170100215    2C                   ENDIF
153180100224    1C                   ENDIF
153190100218     c
153200100224     c                   if        §7ratt ='S' and (§3arbl='R' or
153210100224     c                             §3arbl='C' and §3aucb=' ')
153220100217     C                   MOVEL     err(334)      VIDMSG
153230100217     C                   SETON                                        6790
153240141201c    C                   GOTO      ENDC02
153250100217    2C                   ENDIF
153260151015
153270151015     c* Particolarità consegna "RC"  non utilizzabile per bolle export
153280151015If  2c                   If        §7rRC = 'S'  and
153290151015     c                             (A_§ogntw='FED' or
153300151015     c                             a_§ogntw='EEX' or
153310151015     c                             a_§ogntw='DPD')
153320151015     c                   seton                                        6790
153330151015     C                   MOVEL     err(363)      VIDMSG
153340151015     c                   eval      %subst(vidmsg:25:2)=vidgma
153350151015     c                   GoTo      EndC02
153360151015     c                   endif
153370100215     c
153380030805      * Se la bolla prevede la particolarità consegne 'RC' devo controllare
153390030805      * che esista l'ORM da utilizzare per il ritiro contestuale alla consegna
153400030912      * solo se non sono chiamata da giacenze
153410100604If  2c**                 If        VidGma = 'RC' and
153420100604If  2c                   If        §7rRC = 'S'   and
153430030912If  2c                             savfpr <> 'G' and savfpr <> 'P'
153440150302     c                             and savfpr<>'B'
153450031217     c                   Eval      wope = 'C'
153460030805     c                   ExSr      Sr_RicOrm
153470030805If  3c                   If        *In90 = *On
153480030805     c                   GoTo      EndC02
153490030805    3c                   EndIf
153500030805    2c                   EndIf
153510940919    1C                   ENDIF
153520100219     c
153530141201     c* Controlli Congruenza fra PinCode e Codice Particolarità
153540141201     c* se bolla export errore forzabile se presente particolartià che
153550141201     c* prevede PIN Code
153560141201     c                   if        A_§ogntw='FED' or
153570141201     c                             a_§ogntw='EEX' or
153580141201     c                             a_§ogntw='DPD'
153590141201     c                   if        §7rpincode='S' and WforzPCExp=' '
153600141201     c                   eval      WforzPCExp='1'
153610141201     c                   seton                                        6790
153620141201     C                   MOVEL     err(352)      VIDMSG
153630141201     c                   GoTo      EndC02
153640141201     c                   endif
153650141201     c                   else
153660141201     c* Controlli per bolla NON Export
153670141202     c* non eseguo questi controlli se provengo da pgm giacenze
153680141202     c                   if        not *in44
153690141201     c                   select
153700141201     c                   when      wpincode<>*blanks and  (
153710141201     c                             (vidgma=*blanks) or
153720141201     c                             (vidgma<>*blanks and §7rpincode<>'S'))
153730141201     c                   seton                                        6790
153740141201     C                   MOVEL     err(353)      VIDMSG
153750141201     c                   GoTo      EndC02
153760141201     c                   when      wpincode=*blanks and vidgma<>*blanks
153770141201     c                             and §7rpincode='S'
153780141201     c                   seton                                        6790
153790141201     C                   MOVEL     err(354)      VIDMSG
153800141201     c                   GoTo      EndC02
153810141201     c                   endsl
153820141202     c* se provengo da pgm giacenze controllo che non si modifichi la particola-
153830141202     c* rità giacenza rispetto a quella passata da "pin code" a "no pin code"
153840141202     c* o viceversa
153850141202     c                   else
153860141202     c                   if        vidgma<>§lpgma and
153870141202     c                             w7rPC<>§7rpincode
153880141202     c                   seton                                        6790
153890141202     C                   MOVEL     err(357)      VIDMSG
153900141202     c                   GoTo      EndC02
153910141202     c                   endif
153920141202     c                   endif
153930141201     c                   endif
153940141201     c*
153950100219     C* DATA CONSEGNA NON PUO' ESSERE < DATA CONSEGNA TEORICA
153960100219     C* SE TIPO CONSEGNA E' ' ' O 'P' (IL O PRIMA DEL)
153970100219     C* (QUESTO CONTROLLO LO METTO DOPO I GIORNI CHIUSURA e dopo la partic.
153980100219     C*  consegna perchè mi SERVONO E CORRETTI)
153990100219     c* data consegna non puo' essere > data consegna teorica più i gio
154000100219     c* rni di tolleranza oltre delivery come da tabella vpo
154010100219    1C     VIDDCR        IFGT      0
154020100219     C* CALL AL TNSD99
154030100219     c                   clear                   UsaCass
154040100219     C                   EXSR      CLSE98
154050100219     c                   z-add     d98dce        s_d98dce
154060100219   1aC     VIDTCR        ifne      'D'
154070100219     C*
154080100219    2C     COMDCR        IFLT      D98DCE
154090100219     c* se tipo servizio "Distribuzione" richiamo nuovamente TNSD99R passand
154100100219     c* ogli tipo servizio corriere. Infatti se la data consegna richiesta
154110100219     c* è inferiore anche della data teorica per il servizio corriere l'erro
154120100219     c* re è bloccante altrimenti è forzabile
154130100219    3c                   if        d98tsp = 'D'
154140100219     c                   eval      d98tsp = 'C'
154150100219     C                   CALL      'TNSD99R'
154160100219     C                   PARM                    DSSD99
154170100219    4c     comdcr        ifge      d98dce
154180100219    5c     uno           ifne      '1'
154190100219     C                   MOVEL     ERR(62)       VIDMSG
154200100219     C                   seTON                                        5990
154210100219     C                   MOVEL     '1'           UNO
154220100219     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
154230100219     C                   GOTO      ENDC02
154240100219    5c                   endif
154250100219   x4c                   else
154260100219     C                   MOVEL     ERR(62)       VIDMSG
154270100219     C                   SETON                                        5990
154280100219     c                   goto      endc02
154290100219    4c                   endif
154300100219   x3c                   else
154310100219     C                   MOVEL     ERR(62)       VIDMSG
154320100219     C                   SETON                                        5990
154330100219     C                   GOTO      ENDC02
154340100219    3c                   endif
154350100219    2C                   ENDIF
154360100219   1aC                   ENDIF
154370100219     c** Aggiungo alla data consegna teorica i giorni previsti in tabella
154380100219      *  escludendo i festivi
154390100219      *  questo messaggio non lo do per particolarità di ATTESA
154400100219    2c                   if        vidgma= *blanks  or  §7rATT=' '
154410100219     c                   Clear                   Trul13ds
154420100219     c                   Eval      tI13Tla = 'L'
154430100219     c                   Eval      I13Mod = 'A'
154440100219     c                   Eval      I13Fil = comlna
154450100219     c                   Eval      I13Din = S_d98dce
154460100219     c                   Eval      I13gio = §vpodcrod
154470100219     c                   Call      'TRUL13R'
154480100219     c                   Parm                    Trul13ds
154490100219    3c                   If        tO13Err = *Blanks  and
154500100219     c                             comdcr > o13dfi and fordcr = *blanks
154510100219     c                   eval      vidmsg = err(294)
154520100219     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
154530100219     c                             %trim(%editc(§vpodcrod:'Z'))  +
154540100219     c                             ' giorni la data consegna teorica.' +
154550100219     c                             'ENTER x FORZ.'
154560100219     C                   SETON                                        5990
154570100219     c                   movel     '1'           fordcr
154580100219     C                   GOTO      ENDC02
154590100219    3c                   endif
154600100219    2C                   ENDIF
154610100219    1C                   ENDIF
154620100219     c
154630050415     c* Se particolarita varia = 'O' il controllo seguente l'ho già
154640050415     c* fatto prima del calcolo del volume automatico
154650150304     c****               if        %subst(vidgva:1:1)<>'O'
154660150304     c****               exsr      sr_CntPVBan
154670150304     c**** wemfor        ifeq      '1'
154680150304     c***                goto      endc02
154690150304     c****               endif
154700150304     c****               endif
154710040216
154720040216      * --> Telefono del destinatario
154730040216      *     (da immettere in prima videata)
154740040216      * x Spedizione con Appuntamento
154750040216      * x Spedizione con consegna a PRIVATI
154760040216if  1c                   If        VidTel = *Blanks and wforza1 = *Off and
154770150213     c                             wforza2 = *Off and not *in12
154780040216s   2c                   Select
154790040216     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
154800040216     c                   Eval      VidMsg = Err(267)
154810040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
154820040216     c                   Eval      *In90 = *On
154830170412     c****               When      %subst(VidGva:1:1) = 'P'
154840170412     c****               Eval      VidMsg = Err(58)
154850170412     c****               Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
154860170412     c****               Eval      *In90 = *On
154870040216    2c                   EndSl
154880040216if  2c                   If        *In90
154890040216     c                   Eval      wforza2 = *On
154900040216     c                   GoTo      EndC02
154910040216    2c                   EndIf
154920040216    1c                   EndIf
154930040610     C***
154940040610     C*** Tipo MERCE V-Valore ***
154950040610    1C     VIDbva        ifne      *BLANKS
154960040610     c     §1bfg8        andne     'S'
154970040610     C                   MOVEL     ERR(281)      VIDMSG
154980040610     C                   SETON                                        90
154990040610     c                   z-add     20            H2riga
155000040610     c                   z-add     80            H2colo
155010040610     C                   GOTO      ENDC02
155020040610    1C                   END
155030940919     C***
155040050309     c*
155050050309     c* Essendosi verificato un caso di bolla immessa senza il cod boll
155060050309     c* per sicurezza aggiungo il seguente controllo
155070050309     c     vidcbo        ifeq      *blanks
155080050309     C                   MOVEL     ERR(292)      VIDMSG
155090050309     C                   SETON                                        90
155100050309     C                   GOTO      ENDC02
155110050309     c                   endif
155120160511     c* Indirizzo email e numero di cellulare per invio SMS:
155130160512     c* non sono da memorizzare se bolla export NON DPD
155140170421     c* ora EEX come DPD
155150160511     c                   if        sav_wemdest<>*blanks
155160160511     c                   if            wdesie='E' and
155170170421     c                             a_§ogntw<>'DPD' and
155180170421     c                             a_§ogntw<>'EEX'
155190160511     c                   clear                   wemdest
155200160511     c                   else
155210160511     c* se hanno cambiato il newtork riprendo l'eventuale indirizzo email
155220160511     c                   eval      wemdest=sav_wemdest
155230160511     c                   endif
155240160511     c                   endif
155250160511     c* numero di cellulare per invio sms
155260160511     c                   if        sav_wsms<>*blanks
155270160511     c                   if        wdesie='E' and
155280170421     c                             a_§ogntw<>'DPD' and
155290170421     c                             a_§ogntw<>'EEX'
155300160511     c                   clear                   wsms
155310160511     c                   else
155320160511     c* se hanno cambiato il newtork riprendo l'eventuale numero di cell
155330160511     c                   eval      wsms=sav_wsms
155340160511     c                   endif
155350160511     c                   endif
155360940919     C*** FINE SUBROUTINE
155370940920     C     ENDC02        TAG
155380940826     C   90              MOVEL     '1'           WEMFOR
155390941021     C*
155400940826     C                   ENDSR
155410160224     C* Richiamo cappario dpd -----------------------------------
155420160224     c     sr_tisie3     begsr
155430160224     c                   clear                   tisie3ds
155440160224     c                   eval      isie3tla='E'
155450160224     c                   z-add     blpdsp        isie3dri
155460160224     C                   z-add     BLPDSP        Isie3dsp
155470160224     c                   time                    isie3hsp
155480160224     C                   MOVEL     VIDNZD        isie3nzd
155490160224     C                   MOVEL     VIDCAD        Isie3cad
155500160224     c                   movel     vidlod        isie3cty
155510160224     c                   z-add     vidlnp        isie3lnp
155520160224     C     VIDFBR        IFEQ      'S'
155530160224     c                   z-add     300           isie3srv
155540160224     c                   else
155550160224     c                   if        v2cpkg>§3ilmp
155560160224     c                   z-add     101           isie3srv
155570160224     c                   else
155580160224     c                   z-add     136           isie3srv
155590160224     c                   endif
155600160224     c                   endif
155610160224     c                   movel     'N'           isie3exc
155620160224     C                   CALL      'TISIE3R'
155630160224     C                   PARM                    tisie3ds
155640160224     c                   endsr
155641170928     C* Richiamo cappario dpd vecchio o nuovo -------------------
155642170928     c     sr_tisiCDpd   begsr
155644170928     c* verifico il cappario da richiamare
155645170928     c                   exsr      sr_dp5
155646170928     c                   if        w_dpe='DP4'
155647170928     c                   exsr      sr_tisie3
155648170928     c                   eval      wCDpdErr=Osie3err
155649170928     c                   else
155650170928     c                   exsr      sr_tisid4
155651170928     c                   eval      wCDpdErr=OSID4ERR
155652170928     c                   endif
155653170928     c                   endsr
155654170928      *--------------------------------------------------------------*
155655170928      * Reperimento tipo etichetta export DPD da utilizzare
155656170928      *--------------------------------------------------------------*
155657170928       begsr sr_dp5 ;
155658170928       // per ora il default è "DP4"
155659170928           w_dpe='DP4'  ;
155660170928           clear dsbs02;
155661170928           T02mod = 'C';
155662170928           T02cod = 'DP5';
155663171006           T02ke1 = %editc(wlna_dp:'X');
155664170928           tibs02r(kpjba:dsbs02);
155665170928           // Trovato record DP5 per la linea di arrivo
155666170928           IF  T02err = *blank     ;
155667170928           // la data del giorno rientra nella data decorrenza
155668171006           //if %dec(%date())>=%dec(tbeke2:8:0);
155669171006                d5_lnpds = T02uni;
155670170928           // Se è presente la lnp oppure sono state tutte attivate (999) -->
155671170928           // assumo "DP5"
155672170928                if %lookup(%editc(vidlnp:'X'):d5_lnp)>0 or
155673170928                   %lookup('999':d5_lnp)>0  ;
155674170928                      w_dpe='DP5';
155675170928                endif;
155676171006           //endif;
155677170928           ENDIF;
155678170928       endsr;
155679170928     C* Richiamo cappario dpd per DP5 ---------------------------
155680170928     c     sr_tisid4     begsr
155681170928     c                   clear                   tisid4ds
155683170928     c                   z-add     blpdsp        isid4dri
155686170928     C                   MOVEL     VIDNZD        isid4nzd
155687170928     C                   MOVEL     VIDCAD        Isid4cad
155688171005     c                   movel     vidlod        isid4lod
155689170928     c                   z-add     vidlnp        isid4lnp
155690170928     C     VIDFBR        IFEQ      'S'
155691170928     c                   z-add     300           isid4sorc
155692170928     c                   else
155693170928     c                   if        v2cpkg>§3ilmp
155694170928     c                   z-add     101           isid4sorc
155695170928     c                   else
155696170928     c                   z-add     136           isid4sorc
155697170928     c                   endif
155698170928     c                   endif
155700170928     C                   CALL      'TISID4R'
155701170928     C                   PARM                    tisid4ds
155702170928     c                   endsr
155703091211     C* Richiamo trulticr per controllo tipo incasso c/a e divisa  ---*
155704091211     c     sr_trultic    begsr
155705091211     c                   clear                   trulticds
155706091211     c                   clear                   ds1a
155707091211     c                   eval      iticTBO='P'
155708091211     c                   eval      iticlnp=vidlnp
155710091211     c                   eval      iticlna=comlna
155720091211     c                   eval      iticlnantw=A_§ogntw
155730091211     c                   eval      iticnzd=vidnzd
155740091211     c                   eval      iticprd=vidprd
155750091211     c                   eval      iticcad=vidcad
155760091211     c                   eval      iticlod=vidlod
155770091211     c                   eval      iticind=vidind
155780091211     c                   eval      iticrsd=vidrsd
155790091211     c                   eval      iticdsp=blpdsp
155800091211     c* se orm con triangolazione e beneficiario ordinante-->passo ordinante
155810091211     c* altrimenti sempre il mittente
155820091211     c                   if        nochkticC=*on and wcassel2='X'
155830091211     C                   eval      iticccm=ormksc
155840091211     c                   else
155850091211     C                   eval      iticccm=wksc
155860091211     c                   endif
155870091211
155880091211     c                   eval      itictic=vidtic
155890091211     c                   eval      iticdiv=vidvca
155900091211     c                   eval      iticcas=vidcas
155910091211     c                   eval      iticpgm='FNLS01R'
155920091211     c* 44 on = richiamato da pgm giacenze --> devo passare
155930091211     c*         l'info a trultic per far si che venga bypassato il
155940091211     c*         controllo su tabella "TM"
155950091211    2c                   if        *in44
155960091211     c                   eval      %subst(iticpgm:10:1)='1'
155970091211    2c                   endif
155980091211     c                   call      'TRULTICR'
155990091211     c                   parm                    TRULTICDS
156000091211     c                   parm                    ds1a
156010091211     c*
156020091211     c                   endsr
156030091211     c*
156040091211     C* Impostazinoe flag per controllo tic --------------------------*
156050091211     C     sr_impochktic BEGSR
156060091211     C*
156070091214     c                   eval      nochkticC=*off
156080091211     c                   if        dateu>=§vpocas
156090091211     c                   if        §3afca<>0 and flgfit<>'S' and ormpag='O'
156100091211     c                             and §1amro<>'S'
156110091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
156120091211     c                                 %editc(ormksc:'X')
156130091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
156140091211     c                                 %subst(%editc(ormcor:'X'):1:7)
156150091211     c                   eval      nochkticC=*on
156160091211     c                   endif
156170091211     c                   endif
156180091211     c                   endsr
156190940922     C*
156200940922     C* CONTROLLO DIVISA ---------------------------------------------*
156210940922     C     CTRVLT        BEGSR
156220940922     C*
156230940922     C                   MOVEL     'CV'          COD
156240940922     C* RICERCA
156250940922     C     '?'           SCAN      WVLT                                   30
156260940922     C     *IN30         IFEQ      *ON
156270940922     C                   EXSR      CX§TAB
156280940922     C                   MOVEL     §KEY          WVLT
156290940922     C                   GOTO      ENDVLT
156300940922     C                   ENDIF
156310940922     C*
156320940922     C* CONTROLLO DIVISA
156330940922     C                   MOVEL(P)  WVLT          KEY
156340940922     C                   EXSR      CTABEL
156350940922     C* ERRORE
156360940922    1C     *IN30         IFEQ      *ON
156370941110     C                   MOVEL     ERR(79)       VIDMSG
156380940922     C                   SETON                                        90
156390940922     C                   GOTO      ENDVLT
156400940922    1C                   ENDIF
156410940922     C                   MOVEL     TBLUNI        DSCV
156420940922     C*
156430940922     C* VEDO SE AMMESSI IMPORTI DECIMALI NELL'IMPORTO
156440940922    1C     §CVFDC        IFNE      'S'
156450940922     C                   MOVE      W0133         W0033             3 3
156460940922    2C     W0033         IFNE      0
156470941110     C                   MOVEL     ERR(78)       VIDMSG
156480940922    2C                   ENDIF
156490991025      *
156500991025   X1C                   ELSE
156510991025      * VERIFICO SE I DECIMALI INSERITI SONO QUELLLI AMMESSI
156520991025     C                   SELECT
156530991025     C     §CVDEC        WHENEQ    3
156540991025     C     §CVDEC        WHENEQ    2
156550991025     C                   MOVE      W0133         W0010             1 0
156560991025     C     W0010         IFNE      *ZEROS
156570991025     C                   MOVEL     ERR(171)      VIDMSG
156580991025     C                   ENDIF
156590991025     C     §CVDEC        WHENEQ    1
156600991025     C                   MOVE      W0133         W0020             2 0
156610991025     C     W0020         IFNE      *ZEROS
156620991025     C                   MOVEL     ERR(171)      VIDMSG
156630991025     C                   ENDIF
156640991025     C     §CVDEC        WHENEQ    0
156650991025     C                   ENDSL
156660991025      *
156670991025    1C                   ENDIF
156680991025      *
156690991025     C     VIDMSG        IFNE      *BLANKS
156700991025     C                   SETON                                        90
156710991025     C                   GOTO      ENDVLT
156720991025     C                   ENDIF
156730940922     C*
156740940922     C     ENDVLT        TAG
156750940922     C   90              MOVEL     '1'           WEMFOR
156760940922     C                   ENDSR
156770940916     C*
156780940916     C* PREPARA IL MESSAGGIO DI SEGNACOLLO DOPPIO -------------------*
156790940916     C     PRPMSG        BEGSR
156800940916     C* MUOVO LA SKIERA DELL ERRORE
156810940916     C                   MOVEA     ERR(92)       K78
156820940916     C*
156830940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL SEGNACOLLO
156840940916     C                   MOVEL     COMSCD        W007A             7
156850950718     C                   MOVEA     W007A         SKI(9)
156860950718     C                   Z-ADD     9             I                 3 0
156870950718     C                   EXSR      ABBL
156880940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
156890950718     C                   MOVEA     SKI(9)        K78(19)
156900940916     C* IMPOSTO L'ANNO
156910120828     C                   MOVE      BLTAAS        W004A             4
156920120828     C***                MOVE      ARTAAS        W004A             4
156930940916     C                   MOVEA     W004A         K78(52)
156940940916     C* LINEA DI PARTENZA
156950120828     C                   MOVEL     BLTLNP        W003A             3
156960120828     C***                MOVEL     ARTLNP        W003A             3
156970940916     C                   MOVEA     W003A         K78(57)
156980940916     C* SERIE
156990120828     C     BLTNRS        IFEQ      00
157000120828     C***  ARTNRS        IFEQ      00
157010940916     C                   MOVEA     '  '          K78(61)
157020940916     C                   ELSE
157030120828     C                   MOVEL     BLTNRS        W002A             2
157040120828     C***                MOVEL     ARTNRS        W002A             2
157050940916     C                   MOVEA     W002A         K78(61)
157060940916     C                   ENDIF
157070940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL NUM.SPEDIZIONE
157080120828     C                   MOVEL     BLTNSP        W007A
157090120828     C***                MOVEL     ARTNSP        W007A
157100950718     C                   MOVEA     W007A         SKI(9)
157110950718     C                   Z-ADD     9             I
157120950718     C                   EXSR      ABBL
157130940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
157140950718     C                   MOVEA     SKI(9)        K78(64)
157150940916     C* LINEA DI ARRIVO
157160120828     C                   MOVEL     BLTLNA        W003A             3
157170120828     C***                MOVEL     ARTLNA        W003A             3
157180940916     C                   MOVEA     W003A         K78(76)
157190940916     C*
157200940916     C* MUOVO LA SKIERA NEL MESSAGGIO
157210940916     C                   MOVEA     K78           VIDMSG
157220940922     C                   SETON                                        45
157230940916     C                   ENDSR
157240960318     C*
157250960318     C* CONTROLLO SE SPEDIZIONE CON COLLI > DEL PREVISTO-------------*
157260960318     C     CTRCRG        BEGSR
157270960318    1C     VIDNCL        IFGT      §3INCL
157280030704      * Se devo bancalare i colli emetto la finestra
157290030704     c                   Clear                   w03rig1
157300030704     c                   Clear                   w03rig2
157310030704     c                   Eval      w03rig1 =
157320030704     c                                      'Attenzione numero colli +
157330030704     c                                       superiore a'
157340030704     c                   Eval      w03rig1 =
157350030704     c                                      %trim(w03rig1) + ' ' +
157360030704     c                                      %trim(%editc(§3iNcl:'4'))
157370030704     c                   Eval      w03rig2 =
157380030704     c                                      'Bancalare i colli prima di +
157390030704     c                                       bollettare'
157400030704     c                   Eval      At3c01 = nodi
157410030704     c                   Eval      At3cor = ndpr
157420030704     c                   Eval      At3c02 = nodi
157430030704     c                   Eval      At3csf = ndpr
157440030704     c                   Eval      At3f12 = nodi
157450030704     c                   Do        *Hival
157460161202     c                   if        *in12 and not *in15
157470161202     c                   write     Ls01w03
157480161202     C                   read(E)   fnls01d
157490161202     c                   else
157500161202     c                   Exfmt     Ls01w03
157510161202     c                   endif
157520161202     c
157530161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
157540161202     c                   if        %error
157550161202     C                   MOVEL     '6'           §LPFPR
157560161202     c                   leave
157570161202     c                   endif
157580161202     c
157590030704     c                   Eval      *In41 = *On
157600030704     c                   Eval      wforw03 = '1'
157610030704     c   kf              Leave
157620030704     c                   EndDo
157630030704
157640960318    1C                   ENDIF
157650960318     C                   ENDSR
157660030704      *---------------------------------------------------------------*
157670030704      * Emetto window x colli originali + controlli
157680030704      *---------------------------------------------------------------*
157690030704     c     Sr_Over25     BegSr
157700030704
157710030704     c                   Clear                   w03rig1
157720030704     c                   Clear                   w03rig2
157730030704     c                   Eval      w03rig1 =
157740030704     c                             'Spedizione con colli bancalati'
157750030704     c                   If        *In12 and Not *In15
157760030704     c                   Eval      w03rig2 =
157770030704     c                             'Immettere i seguenti dati:'
157780030704     c                   EndIf
157790030704     c                   Clear                   At3c01
157800030704     c                   Clear                   At3cor
157810030704     c                   Clear                   At3c02
157820030704     c                   Clear                   At3csf
157830030704     c                   Clear                   At3f12
157840030708     c                   Clear                   H3riga
157850030708     c                   Clear                   H3colo
157860030718      * Salvo i comandi F8 e F9
157870030718     c                   Eval      savinkh = *Inkh
157880030718     c                   Eval      savinki = *Inki
157890030708      * Controllo il totale dei colli
157900030708     c                   If        wtotncl > *Zeros
157910030708      * deve essere uguale ai bancali + sfusi
157920030708     c                   If        wtotncl <> vidncl
157930030707     c                   Eval      At3csf = rimm
157940030707     c                   z-add     04            H3riga
157950030707     c                   z-add     37            H3colo
157960030707     c                   Eval      w03msg =
157970030708     c                             'sfusi+bancali diversi da colli bolla'
157980030707     c                   Eval      *In90 = *On
157990030708     c                   EndIf
158000040128      *  NON deve essere superiore ai colli originali
158010040128     c                   If        wtotncl > w03cor and Not *In90
158020030708     c                   Eval      At3cor = rimm
158030030708     c                   z-add     04            H3riga
158040030708     c                   z-add     18            H3colo
158050030708     c                   Eval      w03msg =
158060030708     c                             'Colli originali minori di sfusi+bancali'
158070030708     c                   Eval      *In90 = *On
158080030708     c                   EndIf
158090030707     c                   EndIf
158100030704
158110030704     c                   Do        *Hival
158120161202     c                   if        *in12 and not *in15
158130161202     c                   write     Ls01w03
158140161202     C                   read(E)   fnls01d
158150161202     c                   else
158160030704     c                   Exfmt     Ls01w03
158170161202     c                   endif
158180030704
158190030707     c                   Eval      *In90 = *Off
158200030704     c                   Clear                   w03msg
158210030704     c                   Clear                   At3c01
158220030704     c                   Clear                   At3cor
158230030704     c                   Clear                   At3c02
158240030704     c                   Clear                   At3csf
158250030704     c                   Clear                   At3f12
158260030704     c                   Clear                   H3riga
158270030704     c                   Clear                   H3colo
158280161202     c
158290161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
158300161202     c                   if        %error
158310161202     C                   MOVEL     '6'           §LPFPR
158320161202     c                   Movel     '1'           WEMFOR
158330161202     c                   leave
158340161202     c                   endif
158350030704
158360030708      * F12 Ritorno
158370030708     c                   If        *Inkl
158380030708     c                   Eval      w03cor = savw03cor
158390030708     c                   Eval      w03csf = savw03csf
158400030708     c                   If        w03csf = *Zeros
158410030708     c                   Clear                   wtotncl
158420030708     c                   Else
158430030708     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
158440030708     c                   EndIf
158450030718     c                   Movel     '1'           WEMFOR
158460030708     c                   Leave
158470030708     c                   EndIf
158480030708      * colli originali obbligatori
158490030704     c                   If        w03Cor = *zeros
158500030704     c                   Eval      At3cor = rimm
158510030704     c                   z-add     04            H3riga
158520030707     c                   z-add     18            H3colo
158530030704     c                   Eval      w03msg = 'Immettere i colli originali'
158540030704     c                   Eval      *In90 = *On
158550030704     c                   Iter
158560030704     c                   EndIf
158570030707
158580030707     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
158590040129      * il totale dei colli NON deve essere superiore ai colli originali
158600040129     c                   If        wtotncl > w03cor
158610030708     c                   Eval      At3cor = rimm
158620030708     c                   z-add     04            H3riga
158630030708     c                   z-add     18            H3colo
158640030708     c                   Eval      w03msg =
158650030708     c                             'Colli originali minori di sfusi+bancali'
158660030708     c                   Eval      *In90 = *On
158670030708     c                   Iter
158680030708     c                   EndIf
158690030708      * il totale dei colli deve essere uguali ai bancali + sfusi
158700030707     c                   If        wtotncl <> vidncl
158710030707     c                   Eval      At3csf = rimm
158720030707     c                   z-add     04            H3riga
158730030707     c                   z-add     37            H3colo
158740030707     c                   Eval      w03msg =
158750030708     c                             'sfusi+bancali diversi da colli bolla'
158760030707     c                   Eval      *In90 = *On
158770030707     c                   Iter
158780030707     c                   EndIf
158790030704
158800030704     c   kf              Leave
158810030704
158820030704     c                   EndDo
158830030718      * Ripristino i comandi F8 e F9
158840030718     c                   Eval      *Inkh = savinkh
158850030718     c                   Eval      *InKi = savinki
158860030704
158870030704     c                   EndSr
158880030805      *---------------------------------------------------------------*
158890030805      * Ricerco l'orm x fare il ritiro contestuale alla consegna
158900030805      *---------------------------------------------------------------*
158910030805     c     Sr_RicOrm     BegSr
158920030805
158930091006      * Preparo la ds x il richiamo a FNLS28R
158940091006      * Solo se richiamato FNLS28R x i controlli
158950031217if  1c                   If        wope = 'C'
158960091006     c                   Clear                   Fnls28ds
158970091006     c                   Eval      I28Ope = wope
158980091006     c                   Eval      I28ccm = wksc
158990080407     c                   if        *in12
159000091006     c                   Move      §lpaac        I28Aas
159010080407     c                   endif
159020120326      * passo sempre la lnp del video in quanto ad oggi dei traduttori
159030120326      * personalizzati per ORM RC non ce ne sono.
159040120326      * Attenzione che se dovessero esserci di nuovo dei traduttori
159050120326      * personalizzati il pgm prevede di controllare l'esistenza dell'ORM RC
159060120326      * e per collegare ORM con Bolla si fa tramite RFA dell'ORM = al n. bolla
159070120326      * memorizzato sul VAB di conseguenza la LNP del video non va più bene.
159080120326     c                   move      vidlnp        I28lnp
159090091006     c                   if        widspe <> 0
159100120326     c**!!!              Move      Widlnp        I28lnp
159110091006     c                   Move      Widnrs        I28nrs
159120091006     c                   Move      Widnsp        I28nsp
159130091006     c                   else
159140091006     c  n12              eval      i28aas = waas
159150120326     c**!!!              move      vidlnp        i28lnp
159160091006     c                   endif
159170091006     c                   Eval      I28Lna = comlna
159180091006     c                   Move      varznc        I28Znc
159190091006     c                   eval      i28rsd = vidrsd
159200091006     c                   eval      i28ind = vidind
159210091006     c                   eval      i28cad = vidcad
159220091006     c                   eval      i28lod = vidlod
159230091006     c                   eval      i28prd = vidprd
159240091006     c                   eval      i28nzd = vidnzd
159250091006     c                   eval      i28ncl = v1cncl
159260091006     c                   eval      i28pkb = vidpkg
159270091006      * Solo se richiamato FNLS28R x i aggiornare passo solo I28Ope
159280031217      * gli altri dati sono già impostati
159290031217   x1c                   Else
159300091006     c                   Eval      I28Ope = wope
159310040227      * se sono in conferma bolle da dischetto e il cliente non mantiene il
159320040227      * numero di spedizione devo aggiornare anche il riferimento sull'ORM
159330091006      * o immissione bolla
159340091006if  2c                   If        (*In12 and *In15 and BlpNsp <> WidNsp)
159350091006     c                              or not *in12
159360091006     c                   Eval      I28nAas = BlpAas
159370091006     c                   Eval      I28Lnp = BlpLnp
159380091006     c                   Eval      I28Nrs = BlpNrs
159390091006     c                   Eval      I28Nsp = BlpNsp
159400040227    2c                   EndIf
159410031217    1c                   EndIf
159420091006     c                   Call      'FNLS28R'
159430091006     c                   parm                    kpjba
159440091006     c                   Parm                    Fnls28ds
159450091006      * Solo se ho richiamato FNLS28R x i controlli verifico gli errori
159460031217if  1c                   If        wope = 'C'
159470031217      * Orm Non trovato
159480091006if  2c                   If        O28Err = 01
159490031217     c                   Eval      VidMsg = Err(150)
159500031217     c                   Eval      *In67 = *On
159510031217     c                   Eval      *In90 = *On
159520031217    2c                   EndIf
159530031217      * Altri errori sull'ORM
159540091006if  2c                   If        O28Err > *Zeros and O28Err <> 01
159550091006     c                   Eval      VidMsg = O28Msg
159560031217     c                   Eval      *In67 = *On
159570031217     c                   Eval      *In90 = *On
159580031217    2c                   EndIf
159590091124    1c                   EndIf
159600031217      * Ok ORM - imposto campi x memorizzarli in FIAR5 rcd 'RCC'
159610091006     c                   Eval      savOrmPoe = O28Poe
159620091006     c                   Eval      savOrmNsr = O28Nsr
159630091006     c                   Eval      savOrmNor = O28Nor
159640091006     c                   Eval      savOrmNrv = O28Nrv
159650030805
159660030805     c                   EndSr
159670960319     C*
159680960319     C* CONTROLLO GIORNI DI CHIUSURA --------------------------------*
159690960319     C     CTRGCH        BEGSR
159700960319     C*** 1° GIORNO CHIUSURA ***
159710960319    1C     WGC1          IFNE      *BLANKS
159720960319     C                   MOVEL     WGC1          ACOM              1
159730960319     C                   MOVE      WGC1          BCOM              1
159740960319     C                   Z-ADD     1             B                 3 0
159750960319     C     ACOM          LOOKUP    GGG(B)                                 30
159760960319     C* ERRORE
159770960319    2C     *IN30         IFEQ      *OFF
159780960319     C                   MOVEL     ERR(63)       VIDMSG
159790960319     C                   SETON                                        7490
159800960319     C                   GOTO      ENDGCH
159810960319    2C                   ENDIF
159820960319     C*
159830960319    2C     BCOM          IFNE      ' '
159840960319     C     BCOM          ANDNE     'P'
159850960319     C     BCOM          ANDNE     'M'
159860960319     C                   MOVEL     ERR(63)       VIDMSG
159870960319     C                   SETON                                        7490
159880960319     C                   GOTO      ENDGCH
159890960319    2C                   END
159900960319     C*
159910960319    1C                   END
159920960319     C***
159930960319     C*** 2° GIORNO CHIUSURA ***
159940960319    1C     WGC2          IFNE      *BLANKS
159950960319     C                   MOVEL     WGC2          ACOM              1
159960960319     C                   MOVE      WGC2          BCOM              1
159970960319     C                   Z-ADD     1             B
159980960319     C     ACOM          LOOKUP    GGG(B)                                 30
159990960319     C* ERRORE
160000960319    2C     *IN30         IFEQ      *OFF
160010960319     C                   MOVEL     ERR(63)       VIDMSG
160020960319     C                   SETON                                        6290
160030960319     C                   GOTO      ENDGCH
160040960319    2C                   ENDIF
160050960319     C*
160060960319    2C     BCOM          IFNE      ' '
160070960319     C     BCOM          ANDNE     'P'
160080960319     C     BCOM          ANDNE     'M'
160090960319     C                   MOVEL     ERR(63)       VIDMSG
160100960319     C                   SETON                                        6290
160110960319     C                   GOTO      ENDGCH
160120960319    2C                   END
160130960319     C*
160140960319     C* I GIORNI DI CHIUSURA NON POSSO ESSERE UGUALI
160150960319    2C     WGC1          IFEQ      WGC2
160160960319     C                   MOVEL     ERR(63)       VIDMSG
160170960319     C                   SETON                                        6290
160180960319     C                   GOTO      ENDGCH
160190960319    2C                   END
160200960319    1C                   END
160210960319     C* NON POSSONO ESSERE ' P' ' M'
160220960319    1C     WGC1          IFEQ      ' M'
160230960319     C     WGC1          OREQ      ' P'
160240960319    2C     WGC2          IFEQ      ' M'
160250960319     C     WGC2          OREQ      ' P'
160260960319     C                   MOVEL     ERR(63)       VIDMSG
160270960319     C                   SETON                                        6290
160280960319     C                   GOTO      ENDGCH
160290960319    2C                   END
160300960319    1C                   END
160310960319     C* personalizzazione
160320960319    2C     WPERSO        IFEQ      'P'
160330960319     C     WGC1          IFNE      '  '
160340960319     C     WGC2          ORNE      '  '
160350960319     C                   SETON                                        91
160360960319    2C                   ENDIF
160370960319    2C                   ENDIF
160380960319     C*
160390960319     C     ENDGCH        ENDSR
160400050415     C* CONTROLLO PARTICOLARITA' VARIE E BANCALI --------------------*
160410050415     c     sr_CntPVBan   begsr
160420050415     C***
160430050415     C*** PARTICOLARITA' VARIE    ***
160440050415     C*   PER ORA NON ESISTONO E SALTO COMPLETAMENTE IL CONTROLLO
160450050415     C*   SI PUO' SOLO IMMETTERE 'P ' CHE INDICA CONSEGNA A PRIVATI
160460050415      *   si può inserire anche 'B' bancali o 'O' bancali x over 25
160470050415    1C     VIDGVA        IFNE      *BLANKS
160480050415     C     VIDGVR        ORNE      *BLANKS
160490050415     C* RICHIAMO IL PRG DI RICERCA
160500050415    2C     VIDGVR        IFEQ      '?'
160510050415     C                   CLEAR                   DS7PQR
160520050415     C                   MOVEL     'S'           DS7RIC
160530050415     C                   MOVEL     'V'           DS7GES
160540050415     C                   MOVEL     WKSC          DS7KSC
160550050415     C                   MOVEL     VIDGVA        DS7COD
160560050415     C                   MOVEL     DS7PQR        KPJBU
160570050415     C                   CALL      'TRTB73R'
160580050415     C                   PARM                    KPJBA
160590050415     C                   MOVEL     KPJBU         DS7PQR
160600050415     C                   CLEAR                   VIDGVR
160610050415     C*
160620050415     C     VIDGVA        IFEQ      *BLANKS
160630050415     C                   MOVEL     DS7COD        VIDGVA
160640050415    2C                   ENDIF
160650050415     C*
160660050415     C                   MOVEL     '1'           WEMFOR
160670050415     C                   GOTO      ENDpvban
160680050415    2C                   ENDIF
160690050415     C* CONTROLLO
160700050415     C                   CLEAR                   DS7PQR
160710050415     C                   MOVEL     'S'           DS7RIC
160720050415     C                   MOVEL     'C'           DS7GES
160730050415     C                   MOVEL     WKSC          DS7KSC
160740050415     C                   MOVEL     VIDGVA        DS7COD
160750050415     C                   MOVEL     DS7PQR        KPJBU
160760050415     C                   CALL      'TRTB73R'
160770050415     C                   PARM                    KPJBA
160780050415     C                   MOVEL     KPJBU         DS7PQR
160790050415     C* ERRORE
160800050415    2C     DS7ERR        IFEQ      '1'
160810050415     C                   MOVEL     DS7MSG        VIDMSG
160820050415     C                   SETON                                        7590
160830050415     C                   GOTO      ENDpvban
160840050415    2C                   ENDIF
160850050415     c* controllo ambito di utilizzo particolarità varia
160860050415     C                   MOVEL     '7S'          COD
160870050415     C                   MOVEL(P)  vidgva        KEY
160880050415     c                   clear                   ds7s
160890050415     C                   EXSR      CTABEL
160900050415     C                   MOVEL     TBLUNI        DS7S
160910050415     c     §7suti        ifeq      'B'
160920050415     c     §ogntw        andeq     'PPT'
160930050415     c     §7suti        oreq      'P'
160940050415     c     §ogntw        andne     'PPT'
160950050415     C                   MOVEL     err(288)      VIDMSG
160960050415     C                   SETON                                        7590
160970050415     C                   GOTO      ENDpvban
160980050415     c                   endif
160990050415    1C                   ENDIF
161000050415      * B A N C A L I
161010050415      * tipo bancali
161020050415If  1c                   If        VidTba <> *Blanks and VidTba <> '00'
161030050415      * ricerca
161040050415     c     '?'           Scan      VidTba                                 30
161050050415If  2c                   If        *In30
161060050415     c                   Clear                   Dsbs02
161070050415     c                   Eval      T02Mod = 'R'
161080050415     c                   Eval      T02Sif = Knsif
161090050415     c                   Eval      T02Cod = 'TBA'
161100050415     c                   Call      'TIBS02R'
161110050415     c                   Parm                    Kpjba
161120050415     c                   Parm                    Dsbs02
161130050415     c                   Movel     T02Ke1        VidTba
161140050415     c                   Eval      Wemfor = '1'
161150050415     c                   z-add     23            H2riga
161160050415     c                   z-add     16            H2colo
161170050415     c                   GoTo      ENDpvban
161180050415    2c                   EndIf
161190050415      * controllo
161200050415     c                   Clear                   Dsbs02
161210050415     c                   Clear                   dTba
161220050415     c                   Eval      T02Mod = 'C'
161230050415     c                   Eval      T02Sif = Knsif
161240050415     c                   Eval      T02Cod = 'TBA'
161250050415     c                   Movel(p)  VidTba        T02Ke1
161260050415     c                   Call      'TIBS02R'
161270050415     c                   Parm                    Kpjba
161280050415     c                   Parm                    Dsbs02
161290050415If  2c                   If        T02Err <> *Blanks
161300050415     c                   Movel     Rimm          AtrTba
161310050415     c                   Eval      VidMsg = Err(269)
161320050415     c                   Eval      *In90 = *On
161330050415     c                   z-add     23            H2riga
161340050415     c                   z-add     16            H2colo
161350050415     c                   GoTo      ENDpvban
161360050415    2c                   EndIf
161370050415     c                   Movel     T02Uni        dTba
161380050415     c                   Z-Add     §TbaPkg       wTbaPkg1
161390050415     c                   Z-Add     §TbaVol       wTbaVol1
161400150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
161410150305     c                   exsr      sr_figlia
161420150305     c                   if        wfiglia=*blanks
161430150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
161440150226     c* sia utilizzabile per la varia B/O
161450150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
161460150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
161470150226     c                   Movel     Rimm          AtrTba
161480150226     c                   Eval      VidMsg = Err(358)
161490150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
161500150226     c                   Eval      *In90 = *On
161510150226     c                   z-add     23            H2riga
161520150226     c                   z-add     16            H2colo
161530150226     c                   GoTo      ENDpvban
161540150226    2c                   endif
161550150226     c* se inserita la particolarità varia B controllo che il cliente sia
161560150226     c* abilitato all'utilizzo del tipo bancale
161570150226    2c                   if        %subst(VidGva:1:1)='B'
161580150302     c                   move      vidtba        wtba
161590150226     c                   exsr      sr_callTisigar
161600150226     c                   if        ogaesito<>*blanks
161610150226     c                   Movel     Rimm          AtrTba
161620150226     c                   Eval      VidMsg = Err(359)
161630150226     c                   Eval      *In90 = *On
161640150226     c                   z-add     23            H2riga
161650150226     c                   z-add     16            H2colo
161660150226     c                   GoTo      ENDpvban
161670150226     c                   endif
161680150226    2c                   endif
161690150305     c                   endif
161700050415   x1c                   Else
161710050415If  2c                   If        VidNba > *Zeros
161720050415     c                   Movel     Rimm          AtrTba
161730050415     c                   Eval      VidMsg = Err(269)
161740050415     c                   Eval      *In90 = *On
161750050415     c                   z-add     23            H2riga
161760050415     c                   z-add     16            H2colo
161770050415     c                   GoTo      ENDpvban
161780050415    2c                   EndIf
161790050415    1c                   EndIf
161800050415      * numero bancali
161810050415If  1c                   If        VidNba = *Zeros and VidTba > *Zeros
161820050415     c                   Movel     Rimm          AtrNba
161830050415     c                   Eval      VidMsg = Err(268)
161840050415     c                   Eval      *In90 = *On
161850050415     c                   z-add     23            H2riga
161860050415     c                   z-add     22            H2colo
161870050415     c                   GoTo      ENDpvban
161880050415    1c                   EndIf
161890050415      * tipo bancali 2
161900050415If  1c                   If        VidTb2 <> *Blanks and VidTb2 <> '00'
161910050415      * ricerca
161920050415     c     '?'           Scan      VidTb2                                 30
161930050415If  2c                   If        *In30
161940050415     c                   Clear                   Dsbs02
161950050415     c                   Eval      T02Mod = 'R'
161960050415     c                   Eval      T02Sif = Knsif
161970050415     c                   Eval      T02Cod = 'TBA'
161980050415     c                   Call      'TIBS02R'
161990050415     c                   Parm                    Kpjba
162000050415     c                   Parm                    Dsbs02
162010050415     c                   Movel     T02Ke1        VidTb2
162020050415     c                   Eval      Wemfor = '1'
162030050415     c                   z-add     23            H2riga
162040050415     c                   z-add     32            H2colo
162050050415     c                   GoTo      ENDpvban
162060050415    2c                   EndIf
162070050415      * controllo
162080050415     c                   Clear                   Dsbs02
162090050415     c                   Clear                   dTba
162100050415     c                   Eval      T02Mod = 'C'
162110050415     c                   Eval      T02Sif = Knsif
162120050415     c                   Eval      T02Cod = 'TBA'
162130050415     c                   Movel(p)  VidTb2        T02Ke1
162140050415     c                   Call      'TIBS02R'
162150050415     c                   Parm                    Kpjba
162160050415     c                   Parm                    Dsbs02
162170050415If  2c                   If        T02Err <> *Blanks
162180050415     c                   Movel     Rimm          AtrTb2
162190050415     c                   Eval      VidMsg = Err(269)
162200050415     c                   Eval      *In90 = *On
162210050415     c                   z-add     23            H2riga
162220050415     c                   z-add     32            H2colo
162230050415     c                   GoTo      ENDpvban
162240050415    2c                   EndIf
162250050415     c                   Movel     T02Uni        dTba
162260050415     c                   Z-Add     §TbaPkg       wTbaPkg2
162270050415     c                   Z-Add     §TbaVol       wTbaVol2
162280150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
162290150305     c                   exsr      sr_figlia
162300150305     c                   if        wfiglia=*blanks
162310150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
162320150226     c* sia utilizzabile per la varia B/O
162330150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
162340150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
162350150226     c                   Movel     Rimm          AtrTb2
162360150226     c                   Eval      VidMsg = Err(358)
162370150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
162380150226     c                   Eval      *In90 = *On
162390150226     c                   z-add     23            H2riga
162400150226     c                   z-add     32            H2colo
162410150226     c                   GoTo      ENDpvban
162420150226    2c                   endif
162430150226     c* se inserita la particolarità varia B controllo che il cliente sia
162440150226     c* abilitato all'utilizzo del tipo bancale
162450150226    2c                   if        %subst(VidGva:1:1)='B'
162460150302     c                   move      vidtb2        wtba
162470150226     c                   exsr      sr_callTisigar
162480150226     c                   if        ogaesito<>*blanks
162490150226     c                   Movel     Rimm          AtrTb2
162500150226     c                   Eval      VidMsg = Err(359)
162510150226     c                   Eval      *In90 = *On
162520150226     c                   z-add     23            H2riga
162530150226     c                   z-add     32            H2colo
162540150226     c                   GoTo      ENDpvban
162550150226     c                   endif
162560150226    2c                   endif
162570150305     c                   endif
162580050415   x1c                   Else
162590050415If  2c                   If        VidNb2 > *Zeros
162600050415     c                   Movel     Rimm          AtrTb2
162610050415     c                   Eval      VidMsg = Err(269)
162620050415     c                   Eval      *In90 = *On
162630050415     c                   z-add     23            H2riga
162640050415     c                   z-add     32            H2colo
162650050415     c                   GoTo      ENDpvban
162660050415    2c                   EndIf
162670050415    1c                   EndIf
162680050415      * numero bancali 2
162690050415If  1c                   If        VidNb2 = *Zeros and VidTb2 > *Zeros
162700050415     c                   Movel     Rimm          AtrNb2
162710050415     c                   Eval      VidMsg = Err(268)
162720050415     c                   Eval      *In90 = *On
162730050415     c                   z-add     23            H2riga
162740050415     c                   z-add     38            H2colo
162750050415     c                   GoTo      ENDpvban
162760050415    1c                   EndIf
162770050415      * non si possono immettere 2 tipi bancali uguali
162780050415If  1c                   If        VidTba > *Zeros and VidTb2 > *Zeros
162790050415     c                             and VidTba = VidTb2
162800050415     c                   Movel     Rimm          AtrTb2
162810050415     c                   Eval      VidMsg = Err(270)
162820050415     c                   Eval      *In90 = *On
162830050415     c                   z-add     23            H2riga
162840050415     c                   z-add     32            H2colo
162850050415     c                   GoTo      ENDpvban
162860050415    1c                   EndIf
162870050415      * se inseriti i bancali la particolarità Varie "B" è obbligatoria
162880050415      * oppure la particolarità Varie "O"
162890050415If  1c                   If        (VidTba > *Zeros or VidTb2 > *Zeros) and
162900050415     c                              %Subst(VidGva:1:1) <> 'B' and
162910050415     c                              %Subst(VidGva:1:1) <> 'O'
162920050415     c                   Select
162930050415     c                   When      wgva = 'O'
162940050415     c                   Eval      VidMsg = Err(32)
162950050415     c                   When      wgva = 'B'
162960050415     c                   Eval      VidMsg = Err(35)
162970050415     c                   Other
162980050415     c                   Eval      VidMsg = Err(274)
162990050415     c                   EndSl
163000050415     c                   Eval      *In90 = *On
163010050415     c                   Eval      *In75 = *On
163020050415     c                   GoTo      ENDpvban
163030050415    1c                   EndIf
163040050415      * se inserita la particolarità Varie "B" sono obbligatori
163050050415      * oppure la particolarità Varie "O"
163060050415If  1c                   If        (%subst(VidGva:1:1) ='B' or
163070050415     c                              %subst(VidGva:1:1) ='O')  and
163080050415     c                             (VidTba = *Blanks or VidTba = '00') and
163090050415     c                             (VidTb2 = *Blanks or Vidtb2 = '00')
163100050415     c                   Movel     Rimm          AtrTba
163110050415     c                   Eval      VidMsg = Err(271)
163120050415     c                   Eval      *In90 = *On
163130050415     c                   z-add     23            H2riga
163140050415     c                   z-add     16            H2colo
163150050415     c                   GoTo      ENDpvban
163160050415    1c                   EndIf
163170050415      * msg info x n. colli inferiore al tot. bancali
163180050415     c                   Eval      wtotnba = VidNba + VidNb2
163190050415     c                   If        VidNcl < wtotnba and wtotnba > *Zeros
163200050415     c                             and wfornba = *Blanks
163210050415     c                   Eval      VidMsg = Err(27)
163220050415     c                   Eval      *In41 = *On
163230050415     c                   Eval      *In90 = *On
163240050415     c                   Eval      wfornba = '1'
163250050415     c                   GoTo      ENDpvban
163260050415     c                   EndIf
163270050415      * Manutenzione di bolla con bancali
163280050415      * Se viene modificato il numero di bancali
163290050415      * emetto un msg info
163300050415     c                   If        *In12 and Not *In15                      and
163310050415     c                             (VidNba <> SavNba or VidNb2 <> SavNb2)   and
163320110921     c                             wNba = *Blanks                           and
163330110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
163340050415     c                   Eval      wNba = '1'
163350050415     c                   Eval      VidMsg = Err(273)
163360050415     c                   If        VidNba <> SavNba
163370050415     c                   Movel     Rimm          AtrNba
163380050415     c                   z-add     23            H2riga
163390050415     c                   z-add     22            H2colo
163400050415     c                   EndIf
163410050415     c                   If        VidNb2 <> SavNb2
163420050415     c                   Movel     Rimm          AtrNb2
163430050415     c                   z-add     23            H2riga
163440050415     c                   z-add     38            H2colo
163450050415     c                   EndIf
163460050415     c                   Eval      *In90 = *On
163470050415     c                   GoTo      ENDpvban
163480050415     c                   EndIf
163490050415      * per Particolarità varie 'O'
163500050415      * questi controlli non li faccio se richiamato da giacenze
163510050415     c                   If        %subst(VidGva:1:1) = 'O'
163520050415      * se colli originali già immessi devo controllare il n. dei colli sfusi
163530050415      * con i bancali
163540050415     c                   If        w03Cor > *zeros
163550050415     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
163560050415     c                   EndIf
163570050415      * devo controllare se inseriti i colli originali
163580050415      * se non sono stati inseriti emetto la window per inserirli
163590050415     c                   If        w03cor = *Zeros     or
163600050415      * oppure se sono in manutenzione bolla e sono stati variati
163610050415      * o i bancali o il n. dei colli
163620050415      * emetto la window
163630050415     c                             (*In12 and Not *In15)                   or
163640050415     c                             (wtotncl > *Zeros  and
163650050415     c                             (wtotncl <> vidncl or
163660050415     c                             (wtotncl >= w03cor and w03cor > *Zeros)))
163670050415     c                   ExSr      Sr_Over25
163680050415     c                   EndIf
163690050415     c                   EndIf
163700050415     c     endpvban      tag
163710050415     C   90              MOVEL     '1'           WEMFOR
163720050415     c                   endsr
163730150305     c*---------------------------------------------------------------*
163740150305     C* verifica se bolla figlia
163750150305     c*---------------------------------------------------------------*
163760150305     c     sr_figlia     begsr
163770150305     c                   clear                   wfiglia
163780150305     c                   select
163790150305     c                   when       *in12 and *in15 and *in44
163800150305     c                   eval      wfiglia='S'
163810150305     c                   when       *in12 and not *in15
163820150305     c     kblp3         setll     fnlbl01l
163830150305     c                   if        %equal(fnlbl01l)
163840150305     c                   eval      wfiglia='S'
163850150305     c                   endif
163860150305     c                   endsl
163870150305     c                   endsr
163880150226     c*---------------------------------------------------------------*
163890150226     C* richiamo pgm di controllo abilitazione cliente al tipo bancale*
163900150226     c*---------------------------------------------------------------*
163910150226     c     sr_callTisigarbegsr
163920150226     c                   clear                   tisigads
163930150226     c                   if        dateu>=§vpobanc
163940150226     c                   z-add     vidccm        igaksc
163950150226     c                   if        vidflc=0
163960150226     c                   movel     vidlnp        igaksc
163970150226     c                   else
163980150226     c                   movel     vidflc        igaksc
163990150226     c                   endif
164000150226     c                   eval      IGADAT=blpdsp
164010150226     c                   eval      IGATSC='B'
164020150226     c                   eval      IGATBA=wtba
164030150226     c                   movel     tisigads      kpjbu
164040150226     c                   call      'TISIGAR'
164050150226     c                   parm                    kpjba
164060150226     c                   movel     kpjbu         tisigads
164070150226     c                   endif
164080150226     c                   endsr
164090940826     C*
164100940826     C* GESTIONE 3 VIDEATA ------------------------------------------*
164110940826     C     GESD03        BEGSR
164120991008      *
164130940928     C                   CLEAR                   WEMD03
164140971211     C                   MOVEL     COMLNA        V3CLNA
164150940826     C* DECODIFICA LNA
164160940826     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
164170971211     C  N30              MOVEL     ORGDES        V3DLNA
164180940923     C*
164190940923     C* SE TASSAZIONE CON TARIFFA MITTENTE, TASSO LA BOLLA
164200950125     C* SOLO PER GLI ASSEGNATI
164210950125     C   04SAVFTM        IFNE      ' '
164220940923     C     VIDFTM        ORNE      ' '
164230940923     C     VIDIMV        IFEQ      0
164240980506     C                   MOVEL     '1'           WBOL
164250011025      *
164260011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
164270011025      * varia 'N'
164280011025     C     FLGVRN        IFEQ      '1'
164290011115      * leggo il sbfl delle varie
164300011115     C                   DO        20            NRR
164310011115     C     NRR           CHAIN     LS01S03                            30
164320011115     C     V3CSV1        IFEQ      'N'
164330011115     C     V3CVA1        ANDEQ     88888888
164340011115     C                   EXSR      TASSAN
164350011115     C  N30              UPDATE    LS01S03
164360011115     C                   ENDIF
164370011115     C                   ENDDO
164380011025     C                   ENDIF
164390011025      *
164400151014     c                   clear                   PesVolPkcn
164410151014     c                   clear                   PesVolSpc
164420151014     c                   clear                   PesVolImv
164430940923     C                   EXSR      TASSAZ
164440151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
164450151014     c                   if        vidimv>0
164460151014     c                   eval      PesVolPkcn=taspkcn
164470151014     c                   eval      PesVolSpc=tasspc
164480151014     c                   eval      PesVolIMV=vidimv
164490151014     c                   endif
164500941219     C* SE TASSAZIONE RIUSCITA, MSG CHE E' TASSATA CON TARIFFA MITTEN
164510950504     C* IN CONFERMA BOLLE DA  CLIENTI NON LO DO'
164520941219     C     *IN90         IFEQ      *OFF
164530950504     C     *IN12         IFEQ      *OFF
164540950504     C     *IN15         OREQ      *OFF
164550950504     C     §LPFPR        OREQ      'V'
164560941110     C                   MOVEL     ERR(59)       VIDMSG
164570940923     C                   SETON                                        90
164580940923     C                   ENDIF
164590950504     C                   ENDIF
164600941219     C*
164610941219     C                   ENDIF
164620940923     C                   ENDIF
164630950504     C*
164640950504     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
164650950504     C*    AI CONTROLLI --> SE NON C'E' STATO UN ERRORE IN TASSAZIONE
164660950504     C  N90
164670950504     CAN 12
164680950504    2CAN 15§LPFPR        IFNE      'V'
164690950504     C                   GOTO      CT3TAG
164700950504    2C                   END
164701170831     C  N90
164702170831     CAN 12
164703170831    2CANN15§LPFPR        IFeq      'N'
164704170831     C                   GOTO      CT3TAG
164705170831    2C                   END
164710961111     C* EMETTO MSG CHE DEVO TASSARE IL PORTO SE FRANCO FRONTIERA
164720961111     C     VIDFBR        IFEQ      'F'
164730961111     C     SED           ANDEQ     0
164740961111     C                   MOVEL     ERR(129)      VIDMSG
164750961111     C                   SETON                                        9052
164760961111     C                   MOVEL     1             SED
164770961111     C                   ENDIF
164780940923     C*
164790940826     C     FOR03         TAG
164800941011     C                   Z-ADD     1             NRR
164810940826     C*
164820940923     C                   WRITE     LS01D04
164830161202     C*
164840161202     c                   if        *in12 and not *in15
164850161202     C                   write     LS01C03
164860161202     C                   read(E)   fnls01d
164870161202     c                   else
164880161202     C                   EXFMT     LS01C03
164890161202     c                   endif
164900161202
164910161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
164920161202     c                   if        %error
164930161202     C                   MOVEL     '6'           §LPFPR
164940161202     c                   goto      endd03
164950161202     c                   endif
164960950504     C*
164970950504     C     CT3TAG        TAG
164980941115     C*
164990941021     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
165000950126     C                   EXSR      OFFD03
165010940826     C*
165020990701     C* F22 - CALCOLO PROVVIGIONI DEL MITTENTE
165030940928    3C     *INKW         IFEQ      *ON
165040940919     C* SOLO SE SI TRATTA DI UN CODIFICATO
165050940919    4C     VIDCCM        IFNE      9999
165060940919    4C     VIDCCM        ANDNE     8888
165070940919     C* SOLO SE IL CLIENTE HA UNA TARIFFA ALMENO VALIDA
165080980608     C*  ALTRIMENTI USA LA TARIFFA DI CARTELLO IL PGM TNSF20R
165090980506     C                   MOVEL     '2'           WBOL              1
165100980506     C                   EXSR      TASSAZ
165110980506     C** IMPOSTO LA VARIA SE TROVATA IN VI2VA1
165120940826   X4C                   ELSE
165130940919     C* ERRORE PER 8888 O 9999
165140941110     C                   MOVEL     ERR(82)       VIDMSG
165150980608     C                   SETON                                        4090
165160940919    4C                   ENDIF
165170940919     C*
165180940826     C                   GOTO      FOR03
165190940919    3C                   ENDIF
165200941115     C*
165210940826     C* CONTROLLI
165220940826     C                   EXSR      CTRD03
165230940826     C* RIEMETTO FORMATO
165240950127     C     WEMFOR        IFEQ      '1'
165250950127     C                   EXSR      ESCIER
165260950127     C     §LPFPR        IFNE      '5'
165270000113     C  NKL              GOTO      FOR03
165280950127     C                   ELSE
165290950127     C                   GOTO      ENDD03
165300950127     C                   ENDIF
165310950127     C                   ENDIF
165320941115     C*
165330990701     C* F12 - RITORNO VIDEATA 2
165340941115     C     *INKL         IFEQ      *ON
165350990701     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA F9 QUESTA VIDEATA
165360941115     C     VIDPOR        IFNE      0
165370941115     C     WESVAR        ORNE      ' '
165380941115     C     VIDCEI        ORNE      ' '
165390040116     c     wesvar1       orne      *Blanks
165400941115     C     VI2CEI        ORNE      ' '
165410000113     C     WEMFOR        OREQ      '1'
165420941115     C                   MOVEL     'S'           WEMD03            1
165430000113     C                   CLEAR                   WEMFOR
165440000113     C                   CLEAR                   VIDMSG
165450000113     C                   SETOFF                                       90
165460941115     C                   ENDIF
165470941115     C                   GOTO      ENDD03
165480941115     C                   ENDIF
165490940826     C*
165500990630     C* F14 - TASSAZIONE BOLLA
165510990630     C     *INKN         IFEQ      *ON
165520990630     C                   MOVEL     '1'           WBOL
165530011025      *
165540011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
165550011025      * varia 'N'
165560011025     C     FLGVRN        IFEQ      '1'
165570011115      * leggo il sbfl delle varie
165580011115     C                   DO        20            NRR
165590011115     C     NRR           CHAIN     LS01S03                            30
165600011115     C     V3CSV1        IFEQ      'N'
165610011115     C     V3CVA1        ANDEQ     88888888
165620011025     C                   EXSR      TASSAN
165630011115     C  N30              UPDATE    LS01S03
165640011115     C                   ENDIF
165650011115     C                   ENDDO
165660011025     C                   ENDIF
165670011025      *
165680151014     c                   clear                   PesVolPkcn
165690151014     c                   clear                   PesVolSpc
165700151014     c                   clear                   PesVolImv
165710990630     C                   EXSR      TASSAZ
165720151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
165730151014     c                   if        vidimv>0
165740151014     c                   eval      PesVolPkcn=taspkcn
165750151014     c                   eval      PesVolSpc=tasspc
165760151014     c                   eval      PesVolIMV=vidimv
165770151014     c                   endif
165780990701     C*
165790990630     C* PER PREPAGATI CALCOLO IL TOTALE FATTURA
165800990701     C     *IN22         IFEQ      *ON
165810990716     C     VIDIMV        IFGT      0
165820060208     c* se sono in manutenzione ed è variato il totale imponibile
165830060208     c* errore se prepagato già incassato
165840070514     c***                if        *in12 = *on and *in15 = *off  and
165850070514     c***                          dateu >= §vpogpp
165860070514     c                   if        *in12 = *on and *in15 = *off
165870060208     c                   exsr      sr_callycow
165880060208     c                   if        prmesito <> 0
165890060208     C                   MOVEL     ERR(297)      VIDMSG
165900060208     C                   SETON                                        90
165910060208     C                   GOTO      FOR03
165920060208     c                   endif
165930060208     c                   endif
165940120105     c                   if        viddft>0
165950120105     C                   Z-ADD     viddft        G02DAT
165960120105     C                   MOVEL     *BLANK        G02ERR
165970120105     C                   CALL      'XSRDA8'
165980120105     C                   PARM                    WLBDAT
165990120105     C                   MOVEL     G02INV        comdft
166000120105     c                   else
166010171005     C****               Z-ADD     DATEU         COMDFT
166011171005     c                   eval      comdft=%dec(%date())
166020120105     c                   endif
166030991014     C                   EXSR      TOTFAT
166040990701     C                   Z-ADD     D04IFT        VIDIFT
166050990701     C                   Z-ADD     D04IMV        VIDIMV
166060990701     C                   Z-ADD     D04POR        VIDPOR
166070990701     C                   Z-ADD     D04IMV        SAVIMV
166080991014     C                   Z-ADD     D04POR        MEMPOR
166090990701     C                   ENDIF
166100990716     C                   ENDIF
166110990630     C*
166120990630     C                   GOTO      FOR03
166130990630     C                   ENDIF
166140060207     c*
166150060207     c* MANUTENZIONE: GESTIONE MOTIVAZIONE PER PREPAGATI
166160060207     c* Se sono in manutenzione di un prepagato ed è stato variato il
166170060207     c* totale imponibile richiedo motivazione
166180060308     c*
166190060308     c                   movel     'TR'          wcvb
166200060308     c                   exsr      cls_lv85
166210060308     c*
166220060208     c                   clear                   ilv85cvb
166230060207     c                   if        *in12 = *on and *in15= *off and
166240070514     c****                         dateu >= §vpogpp  and
166250060208     c                             *in22 = *on and vidimv <> savimvo
166260060227     c                   movel     '7L'          cod
166270060227     C                   MOVEL(P)  'TR'          KEY
166280060227     C                   EXSR      CTABEL
166290060227     C                   MOVEL     TBLUNI        DS7L
166300060227     c                   if        §7lmtv = 'S'
166310060227     c                   clear                   fnlv85ds
166320060208     c                   eval      ilv85cvb = 'TR'
166330060209     c                   eval      ilv85tel = 'V'
166340060207     c                   movel     fnlv85ds      kpjbu
166350060207     c                   call      'FNLV85R'
166360060207     c                   parm                    kpjba
166370060210     c                   movel     kpjbu         fnlv85ds
166380060207     c* F12=Ritorno --> riemetto formato 03
166390060209     c                   if        olv85f12 = '1'
166400060207     c                   goto      for03
166410060207     c                   endif
166420060227     c                   endif
166430060207     c                   endif
166440940826     C*
166450940919     C* SE CONTO SERVIZIO IMMISSIONE PER CMD6
166460101104     c                   if        not *inkf and not *inkh
166470101104     C     WFPR          IFNE      'I'
166480940919     C     §3ARBL        ANDEQ     'C'
166490950410     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
166500950410    4C     VIDLNP        IFNE      102
166510950410     C     *IN12         OREQ      *OFF
166520950410     C     *IN15         OREQ      *OFF
166530940928     C                   MOVEL     ERR(40)       VIDMSG
166540940923     C                   SETON                                        90
166550940919     C                   GOTO      FOR03
166560900504     C                   END
166570950410     C                   END
166580101104     c                   endif
166590960318     C**
166600960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
166610960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
166620960805     C* NON LO FACCIO SE BOLLA DI RECUPERO
166630960805     C  NKF§3ARBL        IFNE      'R'
166640130927     c     wforw03       andeq     *Blanks
166650960805     C                   EXSR      CTRCRG
166660030704     c   41              GoTo      For03
166670960805     C                   ENDIF
166680940919     C*
166690940923     C     ENDD03        ENDSR
166700900507     C*
166710900507     C*--- CONTROLLO FORMATO 3 ---------------------------------------*
166720940826     C     CTRD03        BEGSR
166730991008      *
166740941004     C                   SETOFF                                       90
166750941115     C                   CLEAR                   VIDMSG
166760940826     C                   CLEAR                   WEMFOR
166770030623     C                   CLEAR                   WVAR3A            1
166780991028     C**
166790991028     C* CONTROLLO DIVISA SE MODIFICATA
166800991028    1C     VI2DIV        IFNE      *BLANKS
166810991028     C     VI2DIV        ANDNE     WDIV2
166820991028     C     WDIV2         ANDNE     *BLANKS
166830991028     C                   CLEAR                   DSLV16
166840991028     C                   CLEAR                   DTASV
166850991028     C                   MOVEL     'D'           D17FIM
166860991028     C                   MOVE      VI2DIV        D17DIV
166870991028     C                   Z-ADD     BLPDSP        D17DSP
166880991028     C                   CALL      'FNLV16R'
166890991028     C                   PARM                    DSLV16
166900991028     C                   PARM                    DTASV
166910991028     C                   MOVEL     D17DIV        VI2DIV
166920991028     C* ERRORE
166930991028    2C     O17ERR        IFNE      *BLANKS
166940991028     C                   SETON                                        43
166950991028    3C     O17MSG        IFNE      *BLANKS
166960991028     C                   MOVEL     O17MSG        VIDMSG
166970991028     C                   SETON                                        90
166980991028    3C                   ENDIF
166990991028     C                   GOTO      ENDC03
167000991028    2C                   ENDIF
167010991028     C**
167020991028      * SE VARIATA DIVISA DEVO CONVERTIRE GLI IMPORTI NON MODIFICATI
167030991028    2C     VI2VA1        IFEQ      VA2VA1
167040991028     C     VI2VA1        ANDGT     *ZEROS
167050991028     C                   CLEAR                   DSYEUR
167060991028     C                   MOVEL     WDIV2         YECDVI
167070991028     C                   Z-ADD     VI2VA1        YECIMI
167080991028     C                   MOVEL     VI2DIV        YECDVO
167090991028    3C     O17FDC        IFEQ      'S'
167100991028     C                   MOVEL     '3'           YECDCO
167110991028    3C                   ENDIF
167120991028     C**
167130991028     C                   CALL      'YEURCO'
167140991028     C                   PARM                    DSYEUR
167150991028     C**
167160991028    3C     YECESI        IFEQ      ' '
167170991028     C                   Z-ADD     YECIMO        VI2VA1
167180991028     C                   MOVEL     '1'           WEMFOR
167190991028    3C                   ENDIF
167200991028    2C                   ENDIF
167210040114      * Varia 2
167220040114    2c                   If        Vi2Va2 = Va2Va2 and Vi2Va2 > 0
167230040114     c                   Clear                   dsyeur
167240040114     c                   Movel     wdiv2         YecDvi
167250040114     c                   Z-add     Vi2va2        YecImi
167260040114     c                   Movel     Vi2Div        YecDvo
167270040114    3c                   If        O17fDc = 'S'
167280040114     c                   Movel     '3'           YecDco
167290040114    3c                   EndIf
167300040114     c                   Call      'YEURCO'
167310040114     c                   Parm                    dsyeur
167320040114    3c                   If        YecEsi = *Blanks
167330040114     c                   Z-add     YecImo        Vi2Va2
167340040114     c                   Eval      wemfor = '1'
167350040114    3c                   EndIf
167360040114    2c                   EndIf
167370040114      * Varia 3
167380040114    2c                   If        Vi2Va3 = Va2Va3 and Vi2Va3 > 0
167390040114     c                   Clear                   dsyeur
167400040114     c                   Movel     wdiv2         YecDvi
167410040114     c                   Z-add     Vi2va3        YecImi
167420040114     c                   Movel     Vi2Div        YecDvo
167430040114    3c                   If        O17fDc = 'S'
167440040114     c                   Movel     '3'           YecDco
167450040114    3c                   EndIf
167460040114     c                   Call      'YEURCO'
167470040114     c                   Parm                    dsyeur
167480040114    3c                   If        YecEsi = *Blanks
167490040114     c                   Z-add     YecImo        Vi2Va3
167500040114     c                   Eval      wemfor = '1'
167510040114    3c                   EndIf
167520040114    2c                   EndIf
167530040114      * Varia 4
167540040114    2c                   If        Vi2Va4 = Va2Va4 and Vi2Va4 > 0
167550040114     c                   Clear                   dsyeur
167560040114     c                   Movel     wdiv2         YecDvi
167570040114     c                   Z-add     Vi2va4        YecImi
167580040114     c                   Movel     Vi2Div        YecDvo
167590040114    3c                   If        O17fDc = 'S'
167600040114     c                   Movel     '3'           YecDco
167610040114    3c                   EndIf
167620040114     c                   Call      'YEURCO'
167630040114     c                   Parm                    dsyeur
167640040114    3c                   If        YecEsi = *Blanks
167650040114     c                   Z-add     YecImo        Vi2Va4
167660040114     c                   Eval      wemfor = '1'
167670040114    3c                   EndIf
167680040114    2c                   EndIf
167690041217      * Varia 5
167700041217    2c                   If        Vi2Va5 = Va2Va5 and Vi2Va5 > 0
167710041217     c                   Clear                   dsyeur
167720041217     c                   Movel     wdiv2         YecDvi
167730041217     c                   Z-add     Vi2va5        YecImi
167740041217     c                   Movel     Vi2Div        YecDvo
167750041217    3c                   If        O17fDc = 'S'
167760041217     c                   Movel     '3'           YecDco
167770041217    3c                   EndIf
167780041217     c                   Call      'YEURCO'
167790041217     c                   Parm                    dsyeur
167800041217    3c                   If        YecEsi = *Blanks
167810041217     c                   Z-add     YecImo        Vi2Va5
167820041217     c                   Eval      wemfor = '1'
167830041217    3c                   EndIf
167840041217    2c                   EndIf
167850041217      * Varia 6
167860041217    2c                   If        Vi2Va6 = Va2Va6 and Vi2Va6 > 0
167870041217     c                   Clear                   dsyeur
167880041217     c                   Movel     wdiv2         YecDvi
167890041217     c                   Z-add     Vi2va6        YecImi
167900041217     c                   Movel     Vi2Div        YecDvo
167910041217    3c                   If        O17fDc = 'S'
167920041217     c                   Movel     '3'           YecDco
167930041217    3c                   EndIf
167940041217     c                   Call      'YEURCO'
167950041217     c                   Parm                    dsyeur
167960041217    3c                   If        YecEsi = *Blanks
167970041217     c                   Z-add     YecImo        Vi2Va6
167980041217     c                   Eval      wemfor = '1'
167990041217    3c                   EndIf
168000041217    2c                   EndIf
168010040114
168020991028    1C                   ENDIF
168030991028      *
168040991028     C                   Z-ADD     VI2VA1        VA2VA1
168050040114     c                   Z-add     Vi2Va2        Va2Va2
168060040114     c                   Z-add     Vi2Va3        Va2Va3
168070040114     c                   Z-add     Vi2Va4        Va2Va4
168080041217     c                   Z-add     Vi2Va5        Va2Va5
168090041217     c                   Z-add     Vi2Va6        Va2Va6
168100040121     C                   Z-ADD     VI2VA1        VVA(1)
168110040121     c                   Z-add     Vi2Va2        Vva(2)
168120040121     c                   Z-add     Vi2Va3        Vva(3)
168130040121     c                   Z-add     Vi2Va4        Vva(4)
168140041217     c                   Z-add     Vi2Va5        Vva(5)
168150041217     c                   Z-add     Vi2Va6        Vva(6)
168160991028     C                   MOVEL     VI2DIV        WDIV2
168170991028     C* RIEMETTO VIDEATA
168180991028     C     WEMFOR        IFEQ      '1'
168190991028     C                   GOTO      ENDC03
168200991028    2C                   ENDIF
168210940826     C*
168220100119      * Gli altri controlli sono demandati al FNLV16
168230100119     C                   CLEAR                   Dlv1601
168240100119     C                   CLEAR                   DSLV16
168250100119     C                   CLEAR                   DTASV
168260100119
168270940920     C* 2 BOLLA --> CONTROLLO I CAMPI
168280991011    1C     VI2SV1        IFNE      *BLANKS
168290991011     C     VI2VA1        ORNE      *ZEROS
168300040114     c     Vi2Sv2        orne      *Blanks
168310040114     c     Vi2Va2        orne      *Zeros
168320040114     c     Vi2Sv3        orne      *Blanks
168330040114     c     Vi2Va3        orne      *Zeros
168340040114     c     Vi2Sv4        orne      *Blanks
168350040114     c     Vi2Va4        orne      *Zeros
168360041217     c     Vi2Sv5        orne      *Blanks
168370041217     c     Vi2Va5        orne      *Zeros
168380041217     c     Vi2Sv6        orne      *Blanks
168390041217     c     Vi2Va6        orne      *Zeros
168400991011     C     VI2DIV        ORNE      *BLANKS
168410100119     C                   MOVEL     'E'           D17FIM
168420100119   x1c                   else
168430100119     c* controllo solo il codice esenzione IVA
168440100119    2C     VI2CEI        ifne      *BLANKS
168450100119     C                   MOVEL     'I'           D17FIM
168460100119    2c                   endif
168470100119    1c                   endif
168480991026      *
168490100119    1c                   if        d17fim<>' '
168500991011     C                   MOVEL     'P'           D17TBO
168510991011     C                   MOVEL     WKSC          D17KSC
168520991028     C                   Z-ADD     BLPDSP        D17DSP
168530991011     C                   MOVEL     VIDLNP        D17LNP
168540991011     C                   MOVEL     VIDLNA        D17LNA
168550991011     C                   MOVEL     §3ATB2        D17TBL
168560991011     C                   MOVEL     §3ARBL        D17RBL
168570020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
168580040115     c                   Movel     §3asva        §d17Sva
168590040115      * passo che devo controllare la seconda bolla
168600040115     c                   Eval      §d17Tb2 = 'S'
168610100119     c                   Eval      §d17ctriso='S'
168620100119     c                   Eval      §d17iso=vidisd
168630100119
168640100119     c                   if        vidpid<>*blanks and vidisd=*blanks
168650100119     c                   eval      §d17iso='IT'
168660100119     c                   endif
168670100119
168680040115     c                   Movel     Dlv1601       D17Flo
168690991011     C                   MOVEL     VI2DIV        D17DIV
168700991011     C                   MOVEL     WDIV2         D17DVP
168710991011     C     §3AFCA        IFEQ      2
168720991011     C                   MOVEL     'S'           D17FCA
168730991011     C                   ENDIF
168740991011     C                   MOVEL     VI2CEI        D17CEI
168750991012     C                   MOVEL     VI2SV1        VSV(1)
168760991012     C                   MOVEL     VI2VA1        VVA(1)
168770040121     c                   Movel     Vi2Es1        ves(1)
168780040115     C                   MOVEL     VI2SV2        VSV(2)
168790040115     C                   Z-add     VI2VA2        VVA(2)
168800040121     c                   Movel     Vi2Es2        ves(2)
168810040115     C                   MOVEL     VI2SV3        VSV(3)
168820040115     C                   Z-add     VI2VA3        VVA(3)
168830040121     c                   Movel     Vi2Es3        ves(3)
168840040115     C                   MOVEL     VI2SV4        VSV(4)
168850040115     C                   Z-add     VI2VA4        VVA(4)
168860040121     c                   Movel     Vi2Es4        ves(4)
168870041217     C                   MOVEL     VI2SV5        VSV(5)
168880041217     C                   Z-add     VI2VA5        VVA(5)
168890041217     c                   Movel     Vi2Es5        ves(5)
168900041217     C                   MOVEL     VI2SV6        VSV(6)
168910041217     C                   Z-add     VI2VA6        VVA(6)
168920041217     c                   Movel     Vi2Es6        ves(6)
168930100119     c* In questo caso passo il codice iso della partita iva del destinatario
168940100119     c
168950991011      *
168960991011     C                   CALL      'FNLV16R'
168970991011     C                   PARM                    DSLV16
168980991012     C                   PARM                    DTASV
168990991011      *
169000991011     C                   MOVEL     D17CEI        VI2CEI
169010991011     C                   MOVEL     D17DIV        VI2DIV
169020991015     C                   MOVEL     O17FDC        WFDC2
169030991011     C                   MOVEL     O17DEI        V2DCEI
169040040115      * Ricarico le varie
169050040115     c                   Movel     Vsv(1)        Vi2Sv1
169060040115     c                   Z-add     Vva(1)        Vi2Va1
169070040121     c                   Movel     Ves(1)        Vi2Es1
169080040115     c                   Movel     Vsv(2)        Vi2Sv2
169090040115     c                   Z-add     Vva(2)        Vi2Va2
169100040121     c                   Movel     Ves(2)        Vi2Es2
169110040115     c                   Movel     Vsv(3)        Vi2Sv3
169120040115     c                   Z-add     Vva(3)        Vi2Va3
169130040121     c                   Movel     Ves(3)        Vi2Es3
169140040115     c                   Movel     Vsv(4)        Vi2Sv4
169150040115     c                   Z-add     Vva(4)        Vi2Va4
169160040121     c                   Movel     Ves(4)        Vi2Es4
169170041217     c                   Movel     Vsv(5)        Vi2Sv5
169180041217     c                   Z-add     Vva(5)        Vi2Va5
169190041217     c                   Movel     Ves(5)        Vi2Es5
169200041217     c                   Movel     Vsv(6)        Vi2Sv6
169210041217     c                   Z-add     Vva(6)        Vi2Va6
169220041217     c                   Movel     Ves(6)        Vi2Es6
169230991011      *
169240991011     C     O17ERR        IFNE      *BLANKS
169250991011      *
169260991011      *  Se errore riemetto videata con messaggio
169270991011     C     O17MSG        IFNE      *BLANKS
169280991011     C                   MOVEL     O17MSG        VIDMSG
169290991011     C                   SETON                                        90
169300991011      *  Se interrogazione riemetto videata
169310991011     C                   ELSE
169320991011     C                   MOVEL     '1'           WEMFOR            1
169330991011     C                   ENDIF
169340991011      *
169350991011     C                   SELECT
169360991011     C     O17ERR        WHENEQ    '1'
169370991011     C                   SETON                                        42
169380991011     C     O17ERR        WHENEQ    '6'
169390040116     c                   If        O17Erv = 1
169400991011     C                   SETON                                        40
169410040115     c                   EndIf
169420040116     c                   If        O17Erv = 2
169430040115     c                   z-add     09            H3riga
169440041217     c                   z-add     49            H3colo
169450040115     c                   EndIf
169460040116     c                   If        O17Erv = 3
169470041217     c                   z-add     09            H3riga
169480041217     c                   z-add     65            H3colo
169490040115     c                   EndIf
169500040116     c                   If        O17Erv = 4
169510040115     c                   z-add     10            H3riga
169520041217     c                   z-add     33            H3colo
169530040115     c                   EndIf
169540041217     c                   If        O17Erv = 5
169550041217     c                   z-add     10            H3riga
169560041217     c                   z-add     49            H3colo
169570041217     c                   EndIf
169580041217     c                   If        O17Erv = 6
169590041217     c                   z-add     10            H3riga
169600041217     c                   z-add     65            H3colo
169610041217     c                   EndIf
169620991011     C     O17ERR        WHENEQ    '7'
169630991011     C                   SETON                                        43
169640991011     C                   ENDSL
169650991011      *
169660991011     C   90              GOTO      ENDC03
169670991011     C                   ENDIF
169680991011      *
169690991011    1C                   ENDIF
169700040130      * salvo le varie in una sk per poterle poi riorganizzare al momento
169710040130      * della scrittura dei file FIAR6 e FIAR7
169720040130     c                   Eval      W2sv(1) = vi2sv1
169730040130     c                   Eval      W2va(1) = vi2va1
169740040130     c                   Eval      W2sv(2) = vi2sv2
169750040130     c                   Eval      W2va(2) = vi2va2
169760040130     c                   Eval      W2sv(3) = vi2sv3
169770040130     c                   Eval      W2va(3) = vi2va3
169780040130     c                   Eval      W2sv(4) = vi2sv4
169790040130     c                   Eval      W2va(4) = vi2va4
169800041217     c                   Eval      W2sv(5) = vi2sv5
169810041217     c                   Eval      W2va(5) = vi2va5
169820041217     c                   Eval      W2sv(6) = vi2sv6
169830041217     c                   Eval      W2va(6) = vi2va6
169840040130      * Controllo se caricata almeno una varia
169850041217do  1c                   Do        6             c
169860040130     c                   If        w2sv(c) <> *Blanks
169870040130     c                   Eval      wesvar1 = 'S'
169880040130     c                   EndIf
169890040130    1c                   EndDo
169900011212     C* CONTROLLO CHE LA L'IMPORTO NON SUPERI IL LIMITE FATTURABILE
169910040130     c                   xfoot     w2va          wsomts
169920040116if  1c                   If        wsomts > *Zeros
169930011212     C     VI2DIV        IFNE      §GEDCN
169940011212     C                   CLEAR                   DSYEUR
169950011212     C                   MOVEL     VI2DIV        YECDVI
169960011212     C                   MOVEL     §GEDCN        YECDVO
169970040114     c                   Z-add     wsomts        YecImi
169980011212     C                   MOVE      DECCN         YECDCO
169990011212     C                   CALL      'YEURCO'
170000011212     C                   PARM                    DSYEUR
170010011212     C     YECESI        IFEQ      ' '
170020011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
170030011212     C                   ENDIF
170040011212     C                   ENDIF
170050011212     C     WSOMTS        IFGT      IMFGEI
170060040115     c                   Movea     err(242)      k78
170070011212     C                   MOVE      IMFGEI        WNUMED
170080011212     C* richiamo routine per editare il limite
170090011212     C                   EXSR      CALLXE
170100011212      * metto il numero editato nel campo del messaggio
170110011212     C                   MOVEA     W014A         SKII(1)
170120040115     c                   Movea     skii(1)       k78(54)
170130040115     c                   Movea     §gedcn        k78(69)
170140011212     C*
170150011212     C                   MOVEA     K78           VIDMSG
170160011212     C                   SETON                                        4190
170170011212     C                   GOTO      ENDC03
170180011212     C                   ENDIF
170190040116    1C                   ENDIF
170200040126
170210040126     c                   Z-add     wsomts        Vi2Imv
170220991011      *
170230991012      * SE TASSAZIONE CON TARIFFA MITTENTE PROVO A RITASSARE
170240991012      * NON TASSO SE P.A. EXPORT
170250950127    1C   04SAVFTM        IFEQ      'S'
170260950127     C     VIDFTM        OREQ      'S'
170270950127    2C     VIDIMV        IFEQ      0
170280980506     C                   MOVEL     '1'           WBOL
170290151014     c                   clear                   PesVolPkcn
170300151014     c                   clear                   PesVolSpc
170310151014     c                   clear                   PesVolImv
170320950127     C                   EXSR      TASSAZ
170330151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
170340151014     c                   if        vidimv>0
170350151014     c                   eval      PesVolPkcn=taspkcn
170360151014     c                   eval      PesVolSpc=tasspc
170370151014     c                   eval      PesVolIMV=vidimv
170380151014     c                   endif
170390950127    2C                   END
170400950127    1C                   END
170410991012      *
170420991012      * SE VARIATA LA DIVISA: LA CONTROLLO, CONVERTO IMPORTI MODIFICATI
170430991012      *                       E RIEMETTO LA VIDEATA
170440991012     C     VIDDIV        IFNE      WDIV1
170450991015     C     VIDDIV        ANDNE     *BLANKS
170460991026     C     WDIV1         ANDNE     *BLANKS
170470991012     C                   EXSR      VARDIV
170480991028     C     WEMFOR        IFEQ      '1'
170490991012     C                   GOTO      ENDC03
170500991028     C                   ENDIF
170510991012     C                   ENDIF
170520991012      *
170530100119     C                   CLEAR                   Dlv1601
170540100119     C                   CLEAR                   DSLV16
170550991007     C                   CLEAR                   DTASV
170560941219     C                   MOVEL     'P'           D17TBO
170570991012      * PER PREPAGATI IMPOSTO IL FLAG APPOSITO
170580991012     C   22              MOVEL     'S'           D17PRP
170590991012     C  N04              MOVEL     WKSC          D17KSC
170600941219     C*
170610941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
170620991012    1C     SAVFTM        IFEQ      'S'
170630991012     C     *IN04         ANDEQ     *ON
170640941219     C     VIDFTM        OREQ      'S'
170650991012     C     *IN04         ANDEQ     *ON
170660941221     C                   MOVE      WKSC          D17KSC
170670941219     C                   MOVEL     'S'           D17FTM
170680991012      *
170690991012      * SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
170700941219   X2C                   ELSE
170710941221     C                   MOVEL     COMLNA        D17KSC
170720941221     C                   MOVE      9999          D17KSC
170730991012    1C                   ENDIF
170740991012      *
170750991012     C                   MOVEL     'C'           D17FIM
170760941219     C                   MOVEL     VIDLNP        D17LNP
170770941219     C                   MOVEL     VIDLNA        D17LNA
170780941219     C                   MOVEL     §3ATB1        D17TBL
170790941219     C                   MOVEL     §3ARBL        D17RBL
170800020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
170810020503     C                   MOVEL     §3ASVA        D17FLO
170820950103     C     §3AFCA        IFEQ      1
170830941219     C                   MOVEL     'S'           D17FCA
170840941219     C                   ENDIF
170850941219     C                   MOVEL     VIDIAS        D17IAS
170860941219     C                   MOVEL     VIDQFT        D17QFT
170870941219     C                   MOVEL     VIDPOR        D17POR
170880991014     C     COMDFT        IFGT      *ZEROS
170890991014     C                   Z-ADD     COMDFT        D17DSP
170900991012     C                   ELSE
170910991028     C                   Z-ADD     BLPDSP        D17DSP
170920991012     C                   ENDIF
170930941219     C                   MOVEL     VIDIMV        D17IMV
170940941219     C                   MOVEL     VIDCEI        D17CEI
170950941219     C                   MOVEL     VIDFIV        D17FIV
170960941219     C                   MOVEL     VIDNFT        D17NFT
170970941219     C                   MOVEL     VIDDFT        D17DFG
170980941219     C                   MOVEL     'S'           D17FFI
170990991012     C                   MOVEL     VIDDIV        D17DIV
171000991012     C                   MOVEL     WDIV1         D17DVP
171010100119     c
171020100119     c* Controllo codice esenzione iva con partita iva del "chi paga"
171030100120     c*  sempre se ASSEGNATO
171040100119
171050100119     c                   if        *in04
171060100120     c                   Eval      §d17ctriso='S'
171070100119     c                   Eval      §d17iso=vidisd
171080100119     c                   if        vidpid<>*blanks and vidisd=*blanks
171090100119     c                   eval      §d17iso='IT'
171100100119     c                   endif
171110100119
171120100119     c                   else
171130100120     c*  solo per prepagati se FRANCO
171140100120     c                   if        *in22
171150100120     c                   Eval      §d17ctriso='S'
171160100119     c                   Eval      §d17iso=vidism
171170100119     c                   if        vidpim<>*blanks and vidism=*blanks
171180100119     c                   eval      §d17iso='IT'
171190100119     c                   endif
171200100120     c                   endif
171210100120     c
171220100119     c                   endif
171230100119
171240100119     c                   Movel     Dlv1601       D17Flo
171250991012      *
171260991012      * CARICO SCHIERA VARIE
171270941219     C                   CLEAR                   C
171280941219     C                   DO        20            NRR
171290941219     C     NRR           CHAIN     LS01S03                            30
171300941219     C     *IN30         IFEQ      *OFF
171310970604     C**
171320941219     C                   ADD       1             C
171330941219     C                   MOVEL     V3CSV1        VSV(C)
171340991007     C                   Z-ADD     V3CVA1        VVA(C)
171350030623     C* MEMORIZZO SE C'E' LA VARIA DELLA BOLLA NEL CASO DI BOLLE CON SINGOLA VAR
171360030623     C                   IF        §3ASVA <> *BLANKS AND V3CSV1 = §3ASVA
171370030623     C                   MOVEL     'S'           WVAR3A            1
171380030623     C                   ENDIF
171390941219     C                   ENDIF
171400941219     C                   ENDDO
171410970604     C* ERRORE
171420970604     C   90              GOTO      ENDC03
171430990701     C**
171440941219     C** CALL
171450991008     C                   CALL      'FNLV16R'
171460991008     C                   PARM                    DSLV16
171470991007     C                   PARM                    DTASV
171480991012      *
171490991012     C                   MOVEL     D17DIV        VIDDIV
171500991015     C                   MOVEL     O17FDC        WFDC1
171510941219     C                   MOVEL     D17CEI        VIDCEI
171520991011     C                   MOVEL     O17DEI        DESCEI            8
171530991011     C                   MOVEL     O17DEI        V3DCEI
171540941219     C                   Z-ADD     D17DFG        VIDDFT
171550991011     C                   Z-ADD     O17DFA        COMDFT
171560991012      *
171570991012      * RICARICO LE VARIE
171580941219     C                   DO        20            NRR
171590941219     C     NRR           CHAIN     LS01S03                            30
171600941219     C                   MOVEL     VSV(NRR)      V3CSV1
171610941219     C                   MOVEL     VES(NRR)      V3CEV1
171620941223     C*
171630941223     C     VSV(NRR)      IFNE      *BLANKS
171640941223     C                   MOVEL     'S'           WESVAR            1
171650941223     C                   ENDIF
171660941219     C* SE C'E' ERRORE SU VARIA, ACCENDO INDICATORE DI POSIZIONAMENTO
171670991011     C     O17ERV        IFEQ      NRR
171680941219     C                   SETON                                        5090
171690991019     C                   MOVEL     O17MSG        VIDMSG
171700941219     C                   ELSE
171710941219     C                   SETOFF                                       50
171720941219     C                   ENDIF
171730991012      *
171740941219     C  N30              UPDATE    LS01S03
171750941219     C   30              WRITE     LS01S03
171760941219     C                   ENDDO
171770991012      *
171780991015     C   90              GOTO      ENDC03
171790991015      *
171800991012      * GESTIONE ERRORI
171810991011    1C     O17ERR        IFNE      *BLANKS
171820941219     C                   MOVEL     '1'           WEMFOR
171830941021     C*
171840991011    2C     O17MSG        IFNE      *BLANKS
171850991011     C                   MOVEL     O17MSG        VIDMSG
171860941219     C                   SETON                                        90
171870941021    2C                   ENDIF
171880941021     C**
171890941021     C* ESENZIONE IVA
171900991011    2C     O17ERR        IFEQ      '1'
171910950103     C                   SETON                                        46
171920940920     C                   GOTO      ENDC03
171930941021    2C                   ENDIF
171940941021     C**
171950941021     C* NUMERO FATTURA
171960991011     C     O17ERR        IFEQ      '2'
171970941219     C                   SETON                                        48
171980941021     C                   GOTO      ENDC03
171990941021    2C                   ENDIF
172000941021     C**
172010960926     C* REGISTRO IVA FATTURA
172020991011    2C     O17ERR        IFEQ      '3'
172030941219     C                   SETON                                        47
172040941021     C                   GOTO      ENDC03
172050941021    2C                   ENDIF
172060941021     C**
172070941021     C* DATA FATTURA
172080991011     C     O17ERR        IFEQ      '4'
172090941219     C                   SETON                                        49
172100941021     C                   GOTO      ENDC03
172110941021    2C                   ENDIF
172120941021     C**
172130941021     C* IMPONIBILE
172140991011     C     O17ERR        IFEQ      '5'
172150941219     C                   SETON                                        45
172160941021     C                   GOTO      ENDC03
172170941021    2C                   ENDIF
172180991012     C**
172190991012     C* DIVISA
172200991012     C     O17ERR        IFEQ      '7'
172210991012     C                   SETON                                        53
172220991012     C                   GOTO      ENDC03
172230991012    2C                   ENDIF
172240991012     C**
172250991012     C* PORTO
172260991012     C     O17ERR        IFEQ      '8'
172270991012     C                   SETON                                        52
172280991012     C                   GOTO      ENDC03
172290991012    2C                   ENDIF
172300941021     C*
172310941021    1C                   ENDIF
172320991104      *
172330991104      * MEMORIZZO GLI IMPORTI DI TASSAZIONE IN CAMPI DI COMODO PER CONFRONTI
172340011212     C* MENTRE MEMORIZZO FACCIO ANCHE LA SOMMA DEGLI IMPORTI PER POI
172350011212     C* CONTROLLARLA COL LIMITE FATTURABILE
172360991104     C                   Z-ADD     VIDPOR        MEMPOR
172370011212     C                   Z-ADD     VIDPOR        WSOMTS           17 3
172380991104     C                   MOVEL     VIDDIV        WDIV1
172390991104     C                   DO        20            NRR
172400991104     C     NRR           CHAIN     LS01S03                            30
172410991104     C                   Z-ADD     V3CVA1        V3HVA1
172420011219     C* Se è bolla di rientro non tassata fino all'imponibile con varia
172430011219     c* "N" 88888888 non la considero per il confronto con §geimf
172440011219     C     VIDFBR        IFEQ      'S'
172450011219     C     V3CSV1        ANDEQ     'N'
172460011219     C     V3CVA1        ANDEQ     88888888
172470011219     C     VIDIMV        ANDEQ     *ZEROS
172480030624     C* oppure varia & 8888888
172490030624     C     V3CSV1        OREQ      '&'
172500030624     C     V3CVA1        ANDEQ     88888888
172510030624     C     VIDIMV        ANDEQ     *ZEROS
172520011219     C                   ELSE
172530011212     C                   ADD       V3CVA1        WSOMTS
172540011219     C                   ENDIF
172550991104     C  N30              UPDATE    LS01S03
172560991104     C                   ENDDO
172570011212     C***
172580011212     C     VIDIMV        IFGT      *ZEROS
172590011212     C                   Z-ADD     VIDIMV        WSOMTS
172600011212     C                   ENDIF
172610011212     C* CONTROLLO CHE LA SOMMA DEGLI IMPORTI O IL TOTALE IMPONIBILE,
172620011212     C* SE PRESENTE, NON SUPERI IL LIMITE FATTURABILE
172630011212     C     WSOMTS        IFGT      *ZEROS
172640011212     C     VIDDIV        IFNE      §GEDCN
172650011212     C                   CLEAR                   DSYEUR
172660011212     C                   MOVEL     VIDDIV        YECDVI
172670011212     C                   MOVEL     §GEDCN        YECDVO
172680011212     C                   Z-ADD     WSOMTS        YECIMI
172690011212     C                   MOVE      DECCN         YECDCO
172700011212     C                   CALL      'YEURCO'
172710011212     C                   PARM                    DSYEUR
172720011212     C     YECESI        IFEQ      ' '
172730011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
172740011212     C                   ENDIF
172750011212     C                   ENDIF
172760011212     C     WSOMTS        IFGT      IMFGEI
172770011212     C                   MOVEA     ERR(242)      K78
172780011212     C                   MOVE      IMFGEI        WNUMED
172790011212     C* richiamo routine per editare il limite
172800011212     C                   EXSR      CALLXE
172810011212      * metto il numero editato nel campo del messaggio
172820011212     C                   MOVEA     W014A         SKII(1)
172830011212     C                   MOVEA     SKII(1)       K78(54)
172840011212     C                   MOVEA     §GEDCN        K78(69)
172850011212     C*
172860011212     C                   MOVEA     K78           VIDMSG
172870011212     C                   SETON                                        5290
172880011212     C                   GOTO      ENDC03
172890011212     C                   ENDIF
172900011212     C                   ENDIF
172910991012      *
172920991012     C* PER COD 8888 O 9999 CON VARIA "R" OBBLIGATORIO IMPORTO DA ASSICURARE
172930991012     C*  "S" IN O17FAS INDICA QUESTO TIPO DI ERRORE
172940991011    3C     O17FAS        IFEQ      'S'
172950940923     C* SE = 0 E FORZO CON ENTER PRENDO VALORE DA TARIFFA
172960941021    4C     SEI           IFNE      NUMFOR
172970941021     C                   MOVEL     ERR(9)        VIDMSG
172980940923     C                   SETON                                        5090
172990940923     C                   ADD       1             SEI
173000940923     C                   GOTO      ENDC03
173010940923    4C                   ENDIF
173020940923    3C                   ENDIF
173030940826     C*
173040950421     C* DATA FATTURA DEVE APPARTENERE ALLO STESSO MESE DELLA DATA SPEDI
173050990701    3C     VIDDFT        IFGT      0
173060990830     C     *IN22         ANDEQ     *OFF
173070950421     C                   MOVEL     VIDDFT        W0040             4 0
173080950421     C                   MOVE      W0040         W0020F            2 0
173090950421     C                   MOVEL     VIDDSP        W0040
173100950421     C                   MOVE      W0040         W0020S            2 0
173110990701    4C     W0020S        IFNE      W0020F
173120950421     C                   SETON                                        4990
173130950421     C                   MOVEL     ERR(116)      VIDMSG
173140950421     C                   GOTO      ENDC03
173150990701    4C                   ENDIF
173160990701    3C                   ENDIF
173170961111     C**
173180990830     C* SE LA DATA FATTURA <=10 DATA DI PARUT, IMPOSTO LA PRIMA DATA
173190000113     C*  DEL GIORNO, SE NON CAMBIA L'ANNO, ALTRIMENTI ERRORE
173200991011    2C   22O17DFA        IFLE      WDTU10
173210991011     C     O17DFA        ANDGT     0
173220000113     C                   MOVEL     O17DFA        W0040
173230000113     C     W0040         IFEQ      WAAUPI
173240990830     C* IMPOSTO WDTU10 + 1 E AVVISO
173250990830     C                   Z-ADD     WDTUPI        VIDDFT
173260990830     C                   SETON                                        4990
173270990830     C                   MOVEL     ERR(167)      VIDMSG
173280990830     C                   GOTO      ENDC03
173290000113     C                   ELSE
173300000113     C**
173310000113     C                   SETON                                        4990
173320000113     C                   MOVEL     ERR(182)      VIDMSG
173330000113     C                   GOTO      ENDC03
173340991012    2C                   ENDIF
173350000113    2C                   ENDIF
173360001121     C* SE DATA FATTURA < DATA SPEDIZIONE E CAMBIO MESE, NON POSSO
173370001121     C*  METTERE IN SOSPENSIONE LA BOLLA
173380000508    2C   22O17DFA        IFGT      WDTU10
173390000508     C     O17DFA        ANDGT     0
173400001121     C                   MOVEL     O17DFA        W0060F            6 0
173410001121     C                   MOVEL     BLPDSP        W0060S            6 0
173420000508     C     W0060F        IFLT      W0060S
173430000508     C     BLPDSP        ANDGT     DATEU
173440000508     C                   SETON                                        4990
173450000508     C                   MOVEL     ERR(193)      VIDMSG
173460000508     C                   GOTO      ENDC03
173470000508     C                   ENDIF
173480000508     C                   ENDIF
173490000113     C*
173500990610     C* SE FRANCO FRONTIERA SPECIFICARE IL PORTO
173510961111     C  NKLVIDPOR        IFEQ      0
173520961111     C     VIDFBR        ANDEQ     'F'
173530961111     C                   SETON                                        5290
173540961111     C                   MOVEL     ERR(129)      VIDMSG
173550961111     C                   GOTO      ENDC03
173560961111     C                   ENDIF
173570990610     C*
173580990610     C* SE PREPAGATO INSERIRE TASSAZIONE O F14 PER TASSARE
173590990701     C  NKL
173600990701    1CANNKN*IN22         IFEQ      *ON
173610990701    2C     VIDIMV        IFEQ      0
173620990614     C                   SETON                                        5290
173630990610     C                   MOVEL     ERR(160)      VIDMSG
173640990610     C                   GOTO      ENDC03
173650990701   X2C                   ELSE
173660990701    3C     VIDIMV        IFNE      SAVIMV
173670990716     C     VIDIMV        ANDGT     0
173680060207     c* se sono in manutenzione errore se già incassato
173690060208     c                   if        *in12 = *on and *in15 = *off and
173700070514     c****                         dateu >= §vpogpp and vidimv <> savimvo
173710070514     c                             vidimv <> savimvo
173720060208     c                   exsr      sr_callycow
173730060208     c                   if        prmesito <> 0
173740060208     C                   SETON                                        90
173750060208     C                   MOVEL     ERR(297)      VIDMSG
173760060208     C                   GOTO      ENDC03
173770060208     c                   endif
173780060207     c                   endif
173790120105     c                   if        viddft>0
173800120105     C                   Z-ADD     viddft        G02DAT
173810120105     C                   MOVEL     *BLANK        G02ERR
173820120105     C                   CALL      'XSRDA8'
173830120105     C                   PARM                    WLBDAT
173840120105     C                   MOVEL     G02INV        comdft
173850120105     c                   else
173860990630     C                   Z-ADD     DATEU         COMDFT
173870120105     c                   endif
173880990630     C                   EXSR      TOTFAT
173890990630     C                   Z-ADD     D04IFT        VIDIFT
173900990701     C                   Z-ADD     D04IMV        VIDIMV
173910990701     C                   Z-ADD     D04POR        VIDPOR
173920991014     C                   Z-ADD     D04POR        MEMPOR
173930990701     C                   MOVEL     '1'           WEMFOR
173940990701     C                   Z-ADD     VIDIMV        SAVIMV
173950990701    3C                   ENDIF
173960990701    2C                   ENDIF
173970990630     C* LIBRO IVA
173980990701    2C     *IN34         IFEQ      *ON
173990020725     C                   clear                   DSBS02
174000020725     C                   clear                   DYIV
174010020725     C                   movel     'C'           T02mod
174020020725     C                   movel     KNSIF         T02sif
174030020725     C                   movel     'YIV'         T02cod
174040020725     C                   movel     C_Soc         T02ke1
174050020725     C                   movel     VIDLNP        T02ke2
174060020725     C                   call      'TIBS02R'
174070020725     C                   parm                    KPJBA
174080020725     C                   parm                    DSBS02
174090020725     C                   IF        T02err = *blanks
174100020725     C                   movel     T02uni        DYIV
174110020725     C                   movel     §IVLVF        FIV
174120020725     C                   else
174130020725     C                   clear                   DYIV
174140020725     C                   movel     VIDLNP        FIV
174150020725     C                   endif
174160990630     C* NUMERO FATTURA
174170990630     C     KNUM          CHAIN(N)  CNNUM000                           30
174180990630     C* ERRORE : MANCA IL NUMERATORE DELLE FATTURE
174190990701    3C     *IN30         IFEQ      *ON
174200990630     C                   MOVEL     ERR(164)      VIDMSG
174210990630     C                   SETON                                        5290
174220990630     C                   GOTO      ENDC03
174230990701    3C                   ENDIF
174240990701    2C                   ENDIF
174250990701    1C                   ENDIF
174260011025      * Se è bolla di reso con varia 'N' 88888888 deve esserci la varia 'N'
174270011025     C                   SETOFF                                       50
174280011025    1C     FLGVRN        IFEQ      '1'
174290011025    2C                   DO        20            NRR
174300011025     C     NRR           CHAIN     LS01S03                            30
174310011025    3C     *IN32         IFEQ      *OFF
174320011025     C                   SETON                                        50
174330011025    4C     V3CSV1        IFEQ      'N'
174340011025     C                   SETOFF                                       50
174350011025     C                   LEAVE
174360011025    4C                   ENDIF
174370011025    3C                   ENDIF
174380011025    2C                   ENDDO
174390011025    2C     *IN50         IFEQ      '1'
174400011025     C     1             CHAIN     LS01S03                            30
174410011025     C  N30              UPDATE    LS01S03
174420011114     C                   MOVEL     ERR(233)      VIDMSG
174430011025     C                   SETON                                        90
174440011025     C                   GOTO      ENDC03
174450011025    2C                   ENDIF
174460011025    1C                   ENDIF
174470991012      *
174480940923     C     ENDC03        TAG
174490940928     C   90              MOVEL     '1'           WEMFOR            1
174500991012      *
174510940923     C                   ENDSR
174520060208     C* Richiamo pgm che verifca se prepagato incassato -------------*
174530060208     C     sr_callycow   BEGSR
174540060208     c                   z-add     §lpaas        prmaas
174550060208     c                   z-add     §lplnp        prmlnp
174560060208     c                   z-add     §lpnrs        prmnrs
174570060208     c                   z-add     §lpnsp        prmnsp
174580060208     c                   z-add     vidfiv        prmfiv
174590060208     c                   z-add     vidnft        prmnft
174600060208     c                   z-add     dftar6        prmdft
174610060209     c                   clear                   prmesito
174620060607     c                   call      'YCOW0121R1'
174630060208     C                   PARM                    prmaas
174640060208     C                   PARM                    prmLnp
174650060208     C                   PARM                    prmNrs
174660060208     C                   PARM                    prmNsp
174670060208     C                   PARM                    prmFiv
174680060208     C                   PARM                    prmDft
174690060208     C                   PARM                    prmNft
174700060208     C                   PARM                    prmEsito
174710060208     C                   ENDSR
174720971211     C*
174730971211     C* GESTIONE 6 VIDEATA ------------------------------------------*
174740081008     C**   GESD06        BEGSR
174750081008     C**                 MOVEL     COMLNA        V6CLNA
174760971211     C* DECODIFICA LNA
174770081008     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
174780081008     C**N30              MOVEL     ORGDES        V6DLNA
174790971211     C*
174800081008     C**   FOR06         TAG
174810971211     C*
174820081008     C**                 EXFMT     LS01D06
174830081008     C**                 SETOFF                                       4090
174840971211     C* CONTROLLO SE INSERITO NUMERO AWB: NON POSSO CANCELLARLO SE
174850971211     C*  C'ERA
174860081008     C** 12
174870081008    1C**ANN15V6CAWB        IFEQ      0
174880081008     C**   SAVAWB        ANDGT     0
174890081008     C**                 SETON                                        4090
174900081008     C**                 MOVEL     ERR(145)      VIDMSG
174910081008     C**                 GOTO      FOR06
174920081008    1C**                 ENDIF
174930971211     C*
174940081008     c**   A_§ogntw      ifeq      'EUP'
174950081008     C**                 MOVEL     WKSC          W007A
174960081008     C**   W007A         LOOKUP    KSS                                    30
174970081008    2C**   *IN30         IFEQ      *ON
174980971211     C**
174990971211     C* CONTROLLO CHECK DIGIT
175000081008    3C**   V6CAWB        IFGT      0
175010081008     C**                 MOVEL     V6CAWB        W0090             9 0
175020081008     C**   W0090         DIV       7             RISUL            10 0
175030081008     C**                 MVR                     RESTO             1 0
175040971211     C**
175050081008     C**                 MOVE      V6CAWB        W0010             1 0
175060081008    4C**   RESTO         IFNE      W0010
175070081008     C**                 SETON                                        4090
175080081008     C**                 MOVEA     ERR(147)      K78
175090081008     C**                 MOVEL     RESTO         K78(66)
175100081008     C**                 MOVEA     K78           VIDMSG
175110081008     C**                 GOTO      FOR06
175120081008    4C**                 ENDIF
175130081008    3C**                 ENDIF
175140081008    2C**                 ENDIF
175150081008    1C**                 ENDIF
175160971211     C**
175170081008     C**                 ENDSR
175180991203     C*
175190991203     C* GESTIONE 7 VIDEATA ------------------------------------------*
175200991203     C     GESD07        BEGSR
175210991203     C                   MOVEL     COMLNA        V7CLNA
175220991203     C* DECODIFICA LNA
175230991203     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
175240991203     C  N30              MOVEL     ORGDES        V7DLNA
175250991203     C*
175260991203     C     FOR07         TAG
175270991203     C*
175280161129     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
175290161129     c                   if        *in12 and not *in15
175300161129     C                   write     LS01D07
175310161129     C                   read(E)   fnls01d
175320161129     c                   else
175330161129     C                   exfmt     LS01D07
175340161129     c                   endif
175350161129     c
175360991203     C                   SETOFF                                       4090
175370161129
175380161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
175390161129     c                   if        %error
175400161129     C                   MOVEL     '6'           §LPFPR
175410161129     c                   leavesr
175420161129     c                   endif
175430161129
175440991203     C* CONTROLLO SE INSERITO NUMERO PARCEL: NON POSSO CANCELLARLO SE
175450991203     C*  C'ERA
175460991203     C   12
175470060616     CANN15V7CNPR        IFEQ      *blanks
175480060616     C     SAVNPR        ANDne     *blanks
175490991203     C                   SETON                                        4090
175500991203     C                   MOVEL     ERR(176)      VIDMSG
175510991203     C                   GOTO      FOR07
175520991203     C                   ENDIF
175530991203      **
175540991203      * CONTROLLO VALIDITA'
175550060616    1C     V7CNPR        IFne      *blanks
175560000308     C     §3ARBL        ANDNE     'R'
175570000124     C                   MOVEL     V7CNPR        WNPR
175580000124     C                   EXSR      DPDVAL
175590000124     C   90              SETON                                        40
175600000124     C   90              GOTO      FOR07
175610070323     c* Sped. export DPD:
175620070323     c* dal I° aprile non più ammessi parcel dpd lunghi 12
175630070326     C                   if        A_§OGNTW='DPD' and dateu >=20070401
175640070326     c                             and %subst(wnpr:14:1)=*blanks
175650070326     c                             and vidfbr<>'S'
175660070323     c                   seton                                        9040
175670070323     C                   MOVEL     ERR(299)      VIDMSG
175680070323     C                   GOTO      FOR07
175690070323     c                   endif
175700000124     C*
175710991227    1C                   ENDIF
175720070323     c
175730000124     C**
175740000124     C* CONTROLLO NUMERO PARCEL DPD DOPPIO
175750000308     C* IGNORO PER BOLLA SENZA SEGNACOLLI
175760000308     C     §1BFG8        IFEQ      'S'
175770060616     C                   movel     V7CNPR        WNPR
175780060616     c                   if        *in79=*on
175790060616     c                   exsr      dpddop_imp
175800060616     c                   else
175810000124     C                   EXSR      DPDDOP
175820060616     c                   endif
175830000124     C* ERRORE
175840000124     C   90              SETON                                        40
175850000124     C   90              GOTO      FOR07
175860060612     C                   ENDIF
175870991217     C**
175880060623     c* se import dpd metto il nuovo numero nel rmn se possibile
175890060623     c                   if        *in79='1' and *in13='0' and
175900060623     c                             wsolo_num=*blanks
175910060623     c                   clear                   vidrmn
175920060623     c                   if        %subst(v7cnpr:14:1) <> *blanks
175930060623     C                   move      VIDNRD        VIDRMN
175940060623     c                   else
175950060623     c                   eval      w012a=%subst(v7cnpr:1:12)
175960060623     c                   move      w012A         vidrmn
175970060623     c                   endif
175980060623     c
175990060623     c                   endif
176000000124     C                   ENDSR
176010000124     C**
176020000124     C* CONTROLLO VALIDITA' PARCEL DPD--------------------------------*
176030000124     C     DPDVAL        BEGSR
176040060613     c                   clear                   wsolo_num         1
176050060612     c                   select
176060060612     c* controllo parcel lungo 14 --> non devono esserci dei blanks
176070060613     c* e ammesso solo a partire da data in tabella "VPO" (per export)
176080060612     c                   when      %subst(wnpr:14:1) <> *blanks
176090070515     c***                if        *in79='0' and §vpodpd > dateu
176100070515     c***                          and vidfbr =' '
176110070515     C***                SETON                                        90
176120070515     C***                MOVEL     ERR(299)      VIDMSG
176130070515     c***                else
176140060612     c                   if        %scan(' ':wnpr) > 0
176150060612     C                   SETON                                        90
176160060612     C                   MOVEL     ERR(299)      VIDMSG
176170060613     c                   endif
176180070515     c****               endif
176190060613     c                   if        *in90='0'
176200060613     c* controllo se parcel lungo 14 contiene solo numeri
176210060619     c                   z-add     1             hh                2 0
176220061031     c                   z-add     0             hy                2 0
176230060613     c     hh            dowle     14
176240061031     c***  wsolo_num     andeq     *blanks
176250060619     c                   if        %subst(wnpr:hh:1) < '0'
176260060613     c                   eval      wsolo_num='N'
176270061031     c                   eval      hy=hh
176280060613     c                   endif
176290060613     c                   add       1             hh
176300060613     c                   enddo
176310061031     c* le lettere possono esserci solo nei primi 4 bytes dal quinto in poi
176320061031     c* devono essere solo numeri
176330061031     c                   if        wsolo_num='N' and hy >4
176340061031     C                   SETON                                        90
176350061031     C                   MOVEL     ERR(299)      VIDMSG
176360061031     c                   endif
176370061031     c
176380060613     c                   endif
176390060612     c* errore se parcel lungo 13
176400060612     c                   when      %subst(wnpr:13:1) <> *blanks
176410060612     C                   SETON                                        90
176420060612     C                   MOVEL     ERR(299)      VIDMSG
176430060612     c                   other
176440060612     c* controllo parcel lungo 12. Deve contenere solo numeri
176450060612     c                   z-add     1             hh
176460060612     c     hh            dowle     12
176470060612     c     *in90         andeq     '0'
176480060619     c                   if        %subst(wnpr:hh:1) < '0'
176490060612     C                   SETON                                        90
176500060612     C                   MOVEL     ERR(299)      VIDMSG
176510060612     c                   endif
176520060612     c                   add       1             hh
176530060612     c                   enddo
176540060612     c                   if        *in90 = '0'
176550060620     C                   movel     WNPR          DPDBRC
176560060619     C                   Z-ADD     DPDCHD        WDPDBR            1 0
176570061012     C                   CLEAR                   DPDCHD
176580000124     C                   EXSR      M1031
176590000124    3C     DPDCHD        IFNE      WDPDBR
176600000124     C                   SETON                                        90
176610060612     C                   MOVEL     ERR(299)      VIDMSG
176620060612    3C                   ENDIF
176630060612     C                   ENDIF
176640060612     c                   endsl
176650061012     c* Siccome i primi byte del numero parcel dpd corrispondono al
176660061012     c* depot dpd viene segnalato errore bloccante se il numero non
176670061012     c* è presente nell'archivio dei depot
176680061106     c                   if        *in90='0' and
176690061106     c                             ((*in79 and *in12='0') or *in79='0')
176700061012     c                   if        %subst(wnpr:14:1) <> *blanks
176710061012     c                   movel     wnpr          wdpc
176720061012     c                   else
176730061012     c                   eval      wdpc='0'+%subst(wnpr:1:3)
176740061012     c                   endif
176750061107     c                   clear                   truldepds
176760061107     c                   movel     wdpc          idepdpc
176770061107     c                   call      'TRULDEPR'
176780061107     c                   parm                    truldepds
176790061107     c                   if        odeperr='1'
176800061012     C                   SETON                                        90
176810061012     C                   MOVEL     ERR(306)      VIDMSG
176820061012     c                   endif
176830061012     c                   endif
176840060612      *se spedizione export devo anche controllare che numero parcel
176850060621      * inizi per '084' altrimenti errore forzabile
176860060626     c                   if        *in79='0' and *in90='0'
176870060621     c                   if        %subst(wnpr:14:1) <> *blanks
176880060621     c                   movel     wnpr          w0003a            3
176890060621     c     w0003a        ifne      '084'
176900060612     c     wnpr          andne     wnprpre
176910060612     C                   SETON                                        90
176920060621     C                   MOVEL     ERR(303)      VIDMSG
176930060612     c                   endif
176940060621     c                   else
176950060621     c                   movel     wnpr          w0020n            2 0
176960060621     c     w0020n        ifne      84
176970060621     c     wnpr          andne     wnprpre
176980060621     C                   SETON                                        90
176990060621     C                   MOVEL     ERR(289)      VIDMSG
177000060621     c                   endif
177010060621     c                   endif
177020060612     c                   move      wnpr          wnprpre
177030060612     c                   endif
177040000124     C                   ENDSR
177050000124      *
177060000124     C* CONTROLLO SE NUMERO PARCEL EXPORT DPD E' DOPPIO--------------*
177070000124     C     DPDDOP        BEGSR
177080070305     c* non eseguo controllo se pgm richiamato da giacenze
177090070305     c                   if        savfpr<>'G' and savfpr<>'P'
177100000124     C* NON DEVE ESSERE GIA' ESISTENTE
177110000124     C                   MOVEL(P)  WNPR          W030A            30
177120060601     c* tologo il check digit per ricercare il parcel number su fiar4
177130060615    1c                   if        %subst(wnpr:14:1) = *blanks
177140060601     c                   eval      %subst(w030a:12:1)= ' '
177150060616    1c                   endif
177160060601     C                   MOVEL     'I'           WTRC
177170060215     C     Kar4F         SETLL     Fiar403l
177180060215     C     WTRC          READE     fiar403l                               30
177190000124    1C     *IN30         DOWEQ     *OFF
177200000124    2C     *IN12         IFEQ      *OFF
177210000124     C     *IN15         OREQ      *ON
177220060215     C     ar4NRS        ORNE      §LPNRS
177230060215     C     ar4AAS        ORNE      §LPAAS
177240060215     C     ar4NSP        ORNE      §LPNSP
177250000124     C*
177260060615     C                   MOVEL     ar4N30        W014a
177270060615     c                   movel     wnpr          wnpr14           14
177280060707    1c                   if        %subst(wnpr:14:1) = *blanks
177290060707     c                   eval      %subst(wnpr14:12:1)= ' '
177300060707    1c                   endif
177310060615    3C     W014a         IFEQ      WNPR14
177320070305     C**   Kar4B         CHAIN(N)  FNBLT01L                           30
177330070305     C**SOLO SE LNA E LNP UGUALE DO ERRORE
177340070305    4C**N30BLTLNA        IFEQ      COMLNA
177350070305     C**   BLTLNP        ANDEQ     VIDLNP
177360000124     C                   MOVEL     ERR(181)      VIDMSG
177370000124     C                   SETON                                        90
177380000124     C                   GOTO      ENDDOP
177390070305    4C**                 ENDIF
177400000124    3C                   ENDIF
177410000124     C**
177420000203     C                   SETOFF                                       30
177430060615    3C     W014a         IFGT      WNPR14
177440000124     C                   SETON                                        30
177450000124    3C                   ENDIF
177460000124    2C                   ENDIF
177470000124     C*
177480060215     C  N30WTRC          READE     Fiar403l                               30
177490000124    1C                   ENDDO
177500070305     c                   endif
177510000124     C     ENDDOP        ENDSR
177520060613     C* CONTROLLO SE NUMERO PARCEL import DPD E' DOPPIO--------------*
177530060613     C     DPDDOP_imp    BEGSR
177540060613     C* NON DEVE ESSERE GIA' ESISTENTE
177550060613     C                   MOVEL(P)  vidnrd        W030A            30
177560060614     c* se immesso numero parcel lungo 12
177570060613     c* tolgo il check digit per ricercare il parcel number su fiar4
177580060614    1c                   if        %subst(vidnrd:14:1) = *blanks
177590060613     c                   eval      %subst(w030a:12:1)= ' '
177600060614    1c                   endif
177610060613     C                   MOVEL     'I'           WTRC
177620060613     C     Kar4F         SETLL     Fiar403l
177630060613     C     WTRC          READE     fiar403l                               30
177640060614    1C     *IN30         DOWEQ     *OFF
177650060613    2C     *IN12         IFEQ      *OFF
177660060613     C     *IN15         OREQ      *ON
177670060613     C     ar4NRS        ORNE      §LPNRS
177680060613     C     ar4AAS        ORNE      §LPAAS
177690060613     C     ar4NSP        ORNE      §LPNSP
177700060613     C*
177710060613     C                   MOVEL     ar4N30        W014a            14
177720060623     c                   movel     w030a         wnpr14           14
177730060613    3C     W014a         ifeq      WNPR14
177740060628     c     ar4lnp        andeq     vidlnp
177750060614     c
177760060613     c                   movel     dsblp0        savblp
177770061212     c     kblp4m        chain     fnblp01l
177780060614    4c                   if        %found(fnblp01l)
177790060614     C                   Z-ADD     BLPMGS        WDSP
177800060614     C                   MOVEL     BLPAAS        WDSP
177810060614    5C     WDSP          IFGE      DPDDSP
177820061012     c     blpcca        andne     '7'
177830060614     C                   MOVEL     ERR(181)      VIDMSG
177840060614     C                   SETON                                        3090
177850060614    5C                   ENDIF
177860060614    4c                   endif
177870060614     C                   MOVEL     SAVBLP        DSBLP0
177880060613    3C                   ENDIF
177890060613    3C     W014a         IFGT      WNPR14
177900060613     C                   SETON                                        30
177910060613    3C                   ENDIF
177920060613    2C                   ENDIF
177930060613     C*
177940060613     C  N30WTRC          READE     Fiar403l                               30
177950060614    1c                   ENDDO
177960060614     c*
177970060614     c
177980060613     C     ENDDOP_imp    ENDSR
177990991012      *
178000991012      *--- CONVERTO IMPORTI VIDEATA FATTURAZIONE NON MODIFICATI ------*
178010991104     C     VARDIV        BEGSR
178020991012      *
178030991012      * CONTROLLO DIVISA
178040991012     C                   CLEAR                   DSLV16
178050991012     C                   CLEAR                   DTASV
178060991012     C                   MOVEL     'D'           D17FIM
178070991014     C     COMDFT        IFGT      *ZEROS
178080991014     C                   Z-ADD     COMDFT        D17DSP
178090991012     C                   ELSE
178100991028     C                   Z-ADD     BLPDSP        D17DSP
178110991012     C                   ENDIF
178120991012     C                   MOVEL     VIDDIV        D17DIV
178130991012      *
178140991012     C                   CALL      'FNLV16R'
178150991012     C                   PARM                    DSLV16
178160991012     C                   PARM                    DTASV
178170991104      *
178180991104     C                   MOVEL     D17DIV        VIDDIV
178190991012      *
178200991012     C     O17ERR        IFEQ      '7'
178210991012     C                   SETON                                        53
178220991028     C                   MOVEL     '1'           WEMFOR
178230991012     C     O17MSG        IFNE      *BLANKS
178240991015     C                   MOVEL     O17MSG        VIDMSG
178250991012     C                   SETON                                        90
178260991012    2C                   ENDIF
178270991012     C                   GOTO      ENDDIV
178280991012    2C                   ENDIF
178290991012      *
178300991012     C                   CLEAR                   WCONVE
178310991012     C                   CLEAR                   DTASV
178320991012      *
178330991012      * PORTO
178340991012     C     VIDPOR        IFGT      *ZEROS
178350991012    3C     VIDPOR        ANDEQ     MEMPOR
178360991012     C                   CLEAR                   DSYEUR
178370991012     C                   MOVEL     WDIV1         YECDVI
178380991012     C                   Z-ADD     VIDPOR        YECIMI
178390991012     C                   MOVEL     VIDDIV        YECDVO
178400991012     C     O17FDC        IFEQ      'S'
178410991012     C                   MOVEL     '3'           YECDCO
178420991012     C                   ENDIF
178430991012     C                   CALL      'YEURCO'
178440991012     C                   PARM                    DSYEUR
178450991028    4C     YECESI        IFEQ      ' '
178460991012     C                   Z-ADD     YECIMO        VIDPOR
178470991015     C                   MOVEL     'S'           WCONVE            1
178480991028    4C                   ENDIF
178490991028    3C                   ENDIF
178500991012      *
178510991012      * VARIE
178520991012     C                   DO        20            NRR
178530991012     C     NRR           CHAIN     LS01S03                            30
178540991012     C     V3CVA1        IFGT      *ZEROS
178550991012    3C     V3CVA1        ANDEQ     V3HVA1
178560991012     C                   CLEAR                   DSYEUR
178570991012     C                   MOVEL     WDIV1         YECDVI
178580991012     C                   Z-ADD     V3CVA1        YECIMI
178590991012     C                   MOVEL     VIDDIV        YECDVO
178600991012     C     O17FDC        IFEQ      'S'
178610991012     C                   MOVEL     '3'           YECDCO
178620991012     C                   ENDIF
178630991012     C                   CALL      'YEURCO'
178640991012     C                   PARM                    DSYEUR
178650991028    4C     YECESI        IFEQ      ' '
178660991012     C                   Z-ADD     YECIMO        V3CVA1
178670991012     C                   Z-ADD     YECIMO        V3HVA1
178680991019     C                   UPDATE    LS01S03
178690991012     C                   MOVEL     'S'           WCONVE
178700991028    4C                   ENDIF
178710991028    3C                   ENDIF
178720991012     C                   Z-ADD     NRR           C
178730991012      * CARICO SCHIERA VARIE X RICALCOLO TOT FATTURA
178740991012     C     VIDIMV        IFGT      *ZEROS
178750991012     C                   MOVEL     V3CSV1        VSV(C)
178760991012     C                   Z-ADD     V3CVA1        VVA(C)
178770991015     C                   MOVEL     V3CEV1        VES(C)
178780991012     C                   ENDIF
178790991012     C                   ENDDO
178800991012      *
178810991012      * SE CONVERTITI IMPORTI ED è IMPOSTATO IL TOTALE FATTURA LO RICALCOLO
178820991012     C     WCONVE        IFEQ      'S'
178830991028     C                   MOVEL     '1'           WEMFOR
178840991028     C     VIDIMV        IFGT      *ZEROS
178850991012     C                   CLEAR                   DSLV16
178860991012     C                   MOVEL     'T'           D17FIM
178870991012     C                   Z-ADD     VIDPOR        D17POR
178880991012     C                   CALL      'FNLV16R'
178890991012     C                   PARM                    DSLV16
178900991012     C                   PARM                    DTASV
178910991012     C                   ENDIF
178920991028     C                   ENDIF
178930991012      *
178940991012     C     O17ERR        IFEQ      *BLANKS
178950991012     C                   Z-ADD     O17IMV        VIDIMV
178960991012     C                   ELSE
178970991012     C                   CLEAR                   VIDIMV
178980991012     C                   ENDIF
178990991012      *
179000991012     C                   MOVEL     VIDDIV        WDIV1
179010991012     C                   Z-ADD     VIDPOR        MEMPOR
179020991012      *
179030991012     C     ENDDIV        ENDSR
179040991012      *
179050930331     C*--- CALCOLO IL VOLUME -----------------------------------------*
179060930331     C     CALVOL        BEGSR
179070930331     C                   MLLZO     1             VIDNCL
179080930331     C                   MLLZO     1             VIDVOL
179090940825     C                   MLLZO     1             V2CPKG
179100930331     C*
179110930401     C                   Z-ADD     0             VARVOL
179120941230     C* SE DA DISK CLIENTI E' PASSATO IL VOLUME E NON E' STATO VARIATO
179130941230     C* PRENDO IL FLG VOLUME PASSATO SE C'E'
179140941230     C   12
179150941230    1CAN 15VIDVOL        IFNE      0
179160941230     C                   MOVEL     VIDVOL        VARVOL
179170941230     C*
179180941230     C     VIDVOL        IFEQ      §LPVLB
179190941230     C                   MOVEL     §LPFVB        VIDFVR
179200941230     C                   ELSE
179210941230     C                   MOVEL     'R'           VIDFVR
179220941230    1C                   END
179230941230    1C                   END
179240930331     C*
179250941230    1C  N12VIDVOL        IFNE      0
179260930331     C                   MOVEL     'R'           VIDFVR
179270930401     C                   MOVEL     VIDVOL        VARVOL
179280941108    1C                   END
179290930331     C*
179300941108     C   12
179310941108    1CANN15VIDVOL        IFNE      BLPVLB
179320941108    2C     VIDVOL        IFNE      0
179330930401     C                   MOVEL     VIDVOL        VARVOL
179340930331     C                   MOVEL     'R'           VIDFVR
179350941108    2C                   END
179360930331     C*
179370941108   X1C                   ELSE
179380930331     C*
179390941107     C* IN MANUTENZIONE SE NON E' GIA' VOLUME REALE, RICALCOLO
179400941108    2C     §7TRVL        IFEQ      'R'
179410941107     C                   MOVEL     VIDVOL        VARVOL
179420941108    2C                   END
179430941108    1C                   END
179440930331     C*
179450930331     C*  CALCOLO VOLUME AUTOMATICO SE A ZEROS
179460940923    1C     VARVOL        IFEQ      0
179470941025     C                   CLEAR                   DSLV18
179480941025     C                   MOVEL     §3ATB1        D18TBL
179490941025     C                   MOVEL     'P'           D18TBO
179500941025     C                   MOVEL     BLPDSP        D18AAS
179510941025     C                   MOVE      BLPDSP        D18MGS
179520941108     C                   MOVEL     V2CPKG        D18PKF
179530941025     C                   MOVEL     VIDNCL        D18NCL
179540050415     c* se previsti bancali passo il numero colli originali
179550050415     c                   if        %subst(vidgva:1:1)='O'
179560050415     c                   z-add     w03cor        d18ncl
179570050415     c                   endif
179580940923     C* SE NON C'E' TARIFFA CLIENTE USO TARIFFA CARTELLO
179590941108    2C     WTKS          IFEQ      ' '
179600160219     c                   clear                   trulc7ds
179610160224     c                   select
179620160224     c                   when      o27ntw='DPD'
179630160224     c                   eval      IC7tFIE = 'D'
179640160224     c                   when      o27ntw='FED'
179650160224     c                   eval      IC7tFIE = 'F'
179660160224     c                   when      o27ntw='EEX'
179670160224     c                   eval      IC7tFIE = 'E'
179680160224     c                   other
179690160224     c                   eval      IC7tFIE = 'I'
179700160224     c                   endsl
179710160219     c                   eval      IC7DTA  =  blpdsp
179720160219     c                   eval      IC7PKG  =  vidpkg
179730160219     c                   eval      IC7tip  =  i27tip
179740160219     c                   call      'TRULC7R'
179750160219     c                   parm                    trulc7ds
179760160219     C                   MOVEL     oc7KSCc       D18KSC
179770160219     C                   MOVEL     oc7PRGc       D18PRG
179780160219     C                   MOVEL     oc7CTRc       D18CTR
179790941025     C                   ELSE
179800941025     C                   MOVEL     WKSC          D18KSC
179810941025     C                   MOVEL     COMPRG        D18PRG
179820941025     C                   MOVEL     COMCTR        D18CTR
179830940923    2C                   ENDIF
179840020311     c     vidtsp        ifne      *blanks
179850020311     c                   movel     vidtsp        d18tsp
179860020311     c                   else
179870020311     c                   movel     comtsp        d18tsp
179880020311     c                   endif
179890020311     c     comlna        ifgt      *zeros
179900020311     c                   z-add     comlna        d18lna
179910020311     c                   else
179920020311     c                   movel     i27tln        d18tln
179930020311     c                   endif
179940020311     c                   z-add     vidlnp        d18lnp
179950020311     c
179960941025     C*
179970941025     C                   CALL      'FNLV18R'
179980941025     C                   PARM                    DSLV18
179990941025     C*
180000941108     C                   MOVEL     D18FVF        VIDFVR
180010941108     C                   MOVEL     D18VLF        VARVOL
180020930331     C                   END
180030941025     C*
180040941025     C* SE  VOLUME=0 IMPOSTO 0,001
180050930401     C     VARVOL        IFEQ      0
180060941024     C                   Z-ADD     0,001         VARVOL
180070930331     C                   END
180080930331     C                   ENDSR
180090940628     C*
180100940628     C* CALCOLO IL FLAG INOLTRO --------------------------------------*
180110940628     C     INOLTR        BEGSR
180120940628     C                   MOVEL     VIDFIN        WFIN
180130940628     C*
180140940628     C*   SE FERMO DEPOSITO E' SEMPRE ' '
180150940628    1C     VIDFFD        IFEQ      'S'
180160941110     C                   MOVEL     'C'           WFIN
180170940628     C*
180180940628   X1C                   ELSE
180190940628     C*
180200940628     C* CALCOLO  SE NON C'E' FORZATURA
180210940926    2C     WFIN          IFEQ      ' '
180220940919     C                   MOVEL     COMFIN        WFIN
180230940926    2C                   ENDIF
180240940926    1C                   ENDIF
180250940628     C                   ENDSR
180260000627     C*
180270000627     C* ASSEGNO NUMERO DI SEGNACOLLI ALLA BOLLA ----------------------*
180280000627     C     ASSSGN        BEGSR
180290000627     C* IN MANUTENZIONE  SE NUMERO COLLI < DIMINUISCO IL DAL
180300000627     C*  SE > RIASSEGNO I NUMERI
180310000627     C   12
180320000627     CANN15
180330000627    2CAN 25              DO
180340050428    3C     VIDNCL        IFLT      SAVNCL
180350000627     C     SAVNCL        SUB       VIDNCL        DIF               5 0
180360000627     C                   SUB       DIF           VIDNCA
180370000627     C* SE COLLO 1 AZZERO SEGNACOLLO AL
180380000627    4C     VIDNCA        IFEQ      VIDNCD
180390000627     C                   Z-ADD     0             VIDNCA
180400000627    4C                   END
180410000627    3C                   END
180420000627     C*
180430000627    3C     VIDNCL        IFGT      SAVNCL
180440000627    3C     SAVLNA        ORNE      VIDLNA
180450111026     c* Routine di memorizzazione vecchi segnacolli per scrittura R.A. prima
180460111026     c* di pulire VIDNCD e VIDNCA
180470111026     c                   exsr      sr_memRA
180480000627     C                   CLEAR                   VIDNCD
180490000627     C                   CLEAR                   VIDNCA
180500000627    3C                   END
180510000627    2C                   END
180520000627     C*
180530000627     C* SE SEGNACOLLI IMMESSI LI MEMORIZZO
180540000627     C*  SE DEVO STAMPARE SEGNACOLLO LI CALCOLO
180550000627    2C     VIDNCD        IFGT      0
180560000627     C                   MOVEL     VIDNCD        BLPNCD
180570000627     C                   MOVEL     VIDNCA        BLPNCA
180580000627   X2C                   ELSE
180590000627     C                   Z-ADD     0             BLPNCD
180600000627     C                   Z-ADD     0             BLPNCA
180610000627     C* PER CREAZIONE SEGNACOLLO
180620000627    3C     §1BFG8        IFEQ      'S'
180630000627    4C   25              DO
180640000627     C                   CLEAR                   AAS
180650000627     C                   Z-ADD     9             CNU
180660000627     C                   Z-ADD     VIDLNP        COMLIN
180670000627     C                   Z-ADD     COMLNA        LIV2
180680000627     C     KNUF2         CHAIN     FLNUF                              3031
180690000627     C*
180700000627     C   30              Z-ADD     0             BLPNCD
180710000627     C   30              Z-ADD     0             BLPNCA
180720000627     C*
180730000627     C     *IN31         IFEQ      *ON
180740000627     C                   SETON                                        90
180750000627     C                   MOVEL     ERR(42)       VIDMSG
180760000627     C                   MOVEL     '1'           WEMFOR
180770000627     C                   GOTO      ENDASS
180780000627     C                   ENDIF
180790000627     C*
180800000627    5C     *IN30         DOWEQ     *OFF
180810000627     C     NUFNUM        ADD       VIDNCL        BLPNCA
180820000627     C* SE SUPERO IL RANGE FINALE RICOMINCIO DA QUELLO INIZIALE
180830000627    6C     BLPNCA        IFGT      NUFRFI
180840000627     C                   Z-ADD     NUFRIN        NUFNUM
180850000627    6C                   END
180860000627     C*
180870000627     C     NUFNUM        ADD       1             COMSCD
180880000627     C     VIDNCL        ADD       NUFNUM        BLPNCA
180890000627     C*
180900000627     C* CONTROLLO SE ESISTONO GIA' SEGNACOLLI IN QUEL RANGE
180910000627     C*
180920000627    6C     COMSCD        DOWLE     BLPNCA
180930000627     C     COMSCD        ANDGT     0
180940120816     C***  KBLT          CHAIN     FNBLT27L                           30
180950120816     C***                if        not %found(fnblt27l)
180960120816     C     KBLT          CHAIN     FIART27L                           30
180970120816     C                   if        not %found(fIART27l)
180980080925     C     KBLT          CHAIN(N)  fiars01l                           30
180990120817     C**                 if        not %found(fiars01l)
181000120817     C**   KBLT          CHAIN     fnart27l                           30
181010120817     c**                 endif
181020080925     c                   endif
181030000627     C  N30              Z-ADD     COMSCD        NUFNUM
181040000627     C  N30              Z-ADD     BLPNCA        COMSCD
181050000627     C                   ADD       1             COMSCD
181060000627    6C                   END
181070000627     C*
181080000627     C   30NUFNUM        ADD       1             BLPNCD
181090000627     C   30              Z-ADD     BLPNCA        NUFNUM
181100000627     C   30              UPDATE    FLNUF
181110000627    5C                   END
181120000627     C*
181130000627     C* SE AL = DAL AZZERO IL CAMPO
181140000627    5C     BLPNCA        IFEQ      BLPNCD
181150000627     C                   Z-ADD     0             BLPNCA
181160000627    5C                   END
181170000627    4C                   END
181180000627     C*
181190000627   X3C                   ELSE
181200000627     C*
181210000627     C* PER BOLLE SENZA SEGNACOLLI
181220000627     C                   CLEAR                   BLPNCD
181230000627     C                   CLEAR                   BLPNCA
181240000627     C                   CLEAR                   BLPFLS
181250000627     C*
181260000627    3C                   END
181270000627    2C                   END
181280000627     C*
181290000627     C     ENDASS        ENDSR
181300000627     C*
181310000627     C* VEDO COME AGGIORNARE IL CAMPO AGGFST -------------------------*
181320000627     C     AGGFST        BEGSR
181330000627     C* ALLEGA BAM
181340000627     C** PER DISK CLIENTI VEDO SE DEVO STAMPARE LA BOLLA
181350000627     C                   EXSR      CTRSTA
181360000627     C**
181370000627     C*  S I    D D T
181380000627     C**
181390000627    1C     VIDBAM        IFEQ      'S'
181400000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
181410000627    2C     §1BFG3        IFEQ      'S'
181420000627     C                   MOVEL     'C'           BLPFST
181430000627     C                   ELSE
181440000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
181450000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
181460000627     C                   MOVEL     'S'           BLPFST
181470000627    2C                   ENDIF
181480000627     C*
181490000627   X1C                   ELSE
181500000627     C**
181510000627     C*  N O    D D T
181520000627     C**
181530000627     C                   SELECT
181540000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
181550000627    2C     §1BFG3        WHENEQ    'S'
181560000627     C                   MOVEL     'K'           BLPFST
181570000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
181580000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
181590000627    2C     §3ATB1        WHENEQ    'A3'
181600000627     C     WSTA          OREQ      ' '
181610000627     C     WSTA          OREQ      'S'
181620000627     C* SE BOLLA F3 FACCIO FINA CHE SIA STAMPATO MA IN REALTA' NON
181630000627     C*  LA STAMPO NEMMENO IN DIFFERITA PERCHE' NON SERVE
181640000627    2C     §3ATB1        OREQ      'F3'
181650000627     C                   MOVEL     'Y'           BLPFST
181660000627     C*
181670000627     C* SE E' BOLLA DPD IMPOSTO FLAG DI GIA' STAMPATO
181680140612     C***  A_§OGNTW      WHENEQ    'DPD'
181690000627     C* EXPORT NON DPD, GIA' STAMPATO
181700140612     c***  A_§ogntw      oreq      'EEX'
181710140612     c***  A_§ogntw      oreq      'EUP'
181720140612     c***  A_§ogntw      oreq      'FED'
181730000627     C* POSTE , GIA' STAMPATO
181740140612     c***  §ogntw        oreq      'PPT'
181750140612     c***  blpdsp        andlt     §vpoptl
181760140612     c                   when      A_§OGNTW='DPD'
181770160304     c****                         or (A_§ogntw='EEX'
181780160304     c****                         and (%lookup('999':sk_VPODIR)=0 and
181790160304     c****                             %lookup(%editc(blplnp:'X'):sk_VPODIR)=0))
181800000627     C                   MOVEL     'Y'           BLPFST
181810000627   X2C                   OTHER
181820000627     C*
181830000627     C* SE SONO IN VARIAZIONE BOLLA E NON HO MODIFICATO IL FLAG DDT
181840000627     C*  LASCIO QUELLO CHE C'ERA
181850000627     C                   MOVEL     'N'           BLPFST
181860000627    3C     *IN12         IFEQ      *ON
181870000627     C     *IN15         ANDEQ     *OFF
181880000627     C*
181890000627    4C     SAVBAM        IFEQ      'Y'
181900000627     C                   MOVEL     'Y'           BLPFST
181910000627    4C                   ENDIF
181920000627     C* SE ERA DPD E NON LO E' PIU', DEVO METTERE "N" PER FAR
181930000627     C*  STAMPARE LA BOLLA
181940020319    4C     SAVNTW        IFEQ      'DPD'
181950020319     C     A_§OGNTW      ANDNE     'DPD'
181960000627     C                   MOVEL     'N'           BLPFST
181970000627    4C                   ENDIF
181980000627     C* IN MANUTENZIONE DI UN PREPAGATO, IMPOSTO SEMPRE PER DDT NO,
181990000627     C*  DA STAMPARE
182000000627    4C     *IN22         IFEQ      *ON
182010000627     C                   MOVEL     'N'           BLPFST
182020000627    4C                   ENDIF
182030000627    3C                   ENDIF
182040000627     C**
182050000627    2C                   ENDSL
182060000627    1C                   ENDIF
182070000627     C                   ENDSR
182080900504     C*
182090900504     C*--- REGISTRAZIONE BOLLA ---------------------------------------*
182100090623     c     REGIS         begsr
182110940928     C* DPO LA PRIMA BOLLA MI POSIZIONO SEMPRE SUL MITTENTE
182120010222     C* SE ATTIVATA PROCEDURA ORM E SONO IN IMMISSIONE O MANUTENZIONE
182130010306     C* E NON SONO NEL GIRO DEI PREPAGATI MI POSIZIONO SEMPRE SUL N.ORM
182140010222     C     WORM          IFEQ      'S'
182150010222     C     PARTCH        ANDNE     'P'
182160010307     C     §LPFPR        ANDNE     'O'
182170010222     C     *IN12         ANDEQ     *OFF
182180010222     C     WORM          OREQ      'S'
182190010222     C     PARTCH        ANDNE     'P'
182200010307     C     §LPFPR        ANDNE     'O'
182210010222     C     *IN15         ANDEQ     *OFF
182220010222     C                   SETON                                        06
182230010222     C                   ELSE
182240940928     C                   SETON                                        07
182250010222     C                   ENDIF
182260010222     C*
182270950123     C                   CLEAR                   WRD2
182280900507     C* AZZERO CAMPI COMODO
182290940214     C                   CLEAR                   SAVFST
182300991014     C                   CLEAR                   DSLV04
182310991027     C                   CLEAR                   WSV1
182320991027     C                   CLEAR                   WVA1
182330991027     C                   CLEAR                   WSV2
182340991027     C                   CLEAR                   WVA2
182350991027     C                   CLEAR                   WSV3
182360991027     C                   CLEAR                   WVA3
182370001019     C                   CLEAR                   WSTSGN
182380070604     c                   clear                   wmsg_pda          1
182390070606     c                   clear                   w02pdr_p
182400111026     c                   clear                   RA_ncd
182410111026     c                   clear                   RA_nca
182420111026     c                   clear                   RA_ncl
182430111026     c                   clear                   RA_lna
182440941108     C*
182450930331     C*  VALORE POSITIVO DEI CAMPI NUMERI A VIDEO
182460920505     C                   MLLZO     1             VIDPOR
182470940926     C                   MLLZO     1             VIDNFT
182480940926     C                   MLLZO     1             VIDFIV
182490940926     C                   MLLZO     1             VIDRMN
182500940926     C                   MLLZO     1             VIDCAS
182510940825     C                   MLLZO     1             VIDIAS
182520940926     C                   MLLZO     1             VIDQFT
182530920505     C                   MLLZO     1             VIDNCD
182540920505     C                   MLLZO     1             VIDNCA
182550920505     C                   MLLZO     1             VIDHCR
182560940926     C                   MLLZO     1             VI2VA1
182570040116     c                   Mllzo     1             Vi2Va2
182580040116     c                   Mllzo     1             Vi2Va3
182590040116     c                   Mllzo     1             Vi2Va4
182600041217     c                   Mllzo     1             Vi2Va5
182610041217     c                   Mllzo     1             Vi2Va6
182620021218     c                   Mllzo     1             VidNba
182630021218     c                   Mllzo     1             VidNb2
182640060209     c* Le seguenti specifiche le ho spostate più sotto per permettere
182650060209     c* la storicizzazione delle variazioni dei prepagati, non potendo
182660060209     c* storicizzare ora dal momento che ci possono essere dei casi
182670060209     c* di uscita dalla routine senza registrare la bolla (v. goto
182680060209     c* endreg)
182690991006      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
182700991006      * IN FIAR700F
182710060209     C**   WAR7          IFEQ      'E'
182720060209     c**   war61         oreq      'E'
182730060209     c**   wkscsf1       andne     0000
182740060209     c**   wkscsf1       andne     9999
182750060209     C**                 MOVEL     '1'           WTRC
182760060209     C**   KBLP4         SETLL     FIAR7000
182770060209     C**   KBLP4         READE     FIAR7000                               30
182780991006      *
182790060209    2C**   *IN30         DOWEQ     *OFF
182800060209     C**                 DELETE    FIAR7000
182810060209     C**   KBLP4         READE     FIAR7000                               30
182820060209    2C**                 ENDDO
182830991006      *
182840060209     C**                 ENDIF
182850040116      * anche per la seconda bolla
182860060209if  1c****               If        War71 = 'E' or (war62 = 'E' and
182870060209     c****                         wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
182880060209     c****               Eval      Wtrc = '2'
182890060209     c**** Kblp4         Setll     Fiar7000
182900060209do  2c****               Do        *Hival
182910060209     c**** Kblp4         Reade     Fiar7000
182920060209     c****               If        %Eof(Fiar701l)
182930060209     c****               Leave
182940060209     c****               EndIf
182950060209     c****               Delete    Fiar7000
182960060209    2c****               EndDo
182970060209    1c****               EndIf
182980941115     C* PULISCO I FORMATI
182990060209     C***                CLEAR                   FIAR6000
183000060209     C***                CLEAR                   FIAR7000
183010051115     C                   CLEAR                   Fiar9000
183020900507     C*
183030900504     C                   Z-ADD     VIDLNP        BLPLNP
183040900504     C                   MOVEL     BLPDSP        BLPAAS
183050900504     C                   MOVE      VIDNRS        BLPNRS
183060940926     C                   MOVE      BLPDSP        BLPMGS
183070940926     C                   MOVEL     VIDCBO        BLPCBO
183080920410     C*
183090920410     C* DISK CLI: SE NON SI ASSEGNA NUMERAZ. SEGNAC. AZZERO SERIE
183100930628     C   12
183110930628    1CAN 15§1BFG2        IFEQ      'N'
183120980410     C     §1BFG6        ANDNE     'C'
183130910606     C                   Z-ADD     0             BLPNRS
183140950525     C* SE IL CTM ERA "%" --> IMPOSTO "§"
183150000214    2C     VIDSOP        IFEQ      '%'
183160950525     C                   MOVEL     '§'           VIDSOP
183170000214     C* SE E' DISK "C"    --> IMPOSTO ":"
183180050223     C     *IN79         IFEQ      *ON
183190050223    3C     WASDKC        ANDEQ     'S'
183200050223     C     §3CDKC        ANDEQ     'S'
183210000905     C     §1BF12        ORNE      'N'
183220001106     C     §1BF12        ANDNE     'E'
183230001106     C     §1BF12        OREQ      'E'
183240001106     C     WASDKC        ANDEQ     'S'
183250000214     C                   MOVEL     ':'           VIDSOP
183260000214    3C                   ENDIF
183270000214    2C                   ENDIF
183280950525    1C                   ENDIF
183290001013     C* SE VENGO DA CONFERMA DA DISCHETTO E NON È DISK B METTO SOP=: SE
183300001013     C* E' DISK C
183310001013     C   12
183320001013     CAN 15§1BFG1        IFNE      'S'
183330001013     C     WASDKC        ANDEQ     'S'
183340001013     C     §1BF12        ANDNE     'N'
183350001013     C                   MOVEL     ':'           VIDSOP
183360001013     C                   ENDIF
183370930624     C***
183380930624     C***   N U M E R O   S P E D I Z I O N E
183390920415     C                   SETOFF                                       30
183400921012     C* IN IMMISSIONE : SE NON E' BOLLA DI RECUPERO
183410990602    1C  N12PARTCH        IFEQ      'R'
183420921006     C                   Z-ADD     RECNSP        BLPNSP
183430930628   X1C                   ELSE
183440921006     C                   SETON                                        30
183450930628    1C                   END
183460921012     C*
183470921005     C* IN DISK CLI :  SE NON SI STAMPA LA BOLLA
183480921012     C*                O NON E' BOLLA DI RECUPERO
183490921012     C*                O NON MANTIENE NUM SPEDIZIONE
183500930628     C   12
183510930628    1CAN 15§1BFG3        IFNE      'S'
183520921005     C*
183530930628    2C     §3CFSP        IFEQ      'S'
183540921012     C     §1BFG2        ANDEQ     'S'
183550921012     C     §LPFPR        OREQ      'R'
183560971104     C**
183570971104    3C     VIDNSP        IFGT      0
183580921005     C                   Z-ADD     VIDNSP        BLPNSP
183590971104   X3C                   ELSE
183600971104     C** SE MANCA LO RIASSEGNO
183610971104     C** SE L'HO AZZERATO IN CARICAMENTO LO RIPRENDO DA DS
183620971104    4C     §LPNSP        IFGT      0
183630971104     C                   Z-ADD     §LPNSP        BLPNSP
183640971104     C                   ELSE
183650971104     C                   SETON                                        30
183660971104    4C                   ENDIF
183670971104    3C                   ENDIF
183680971104     C***
183690971104    3C     VIDNRS        IFEQ      0
183700971104     C                   Z-ADD     §LPNRS        BLPNRS
183710971104    3C                   ENDIF
183720971104     C**
183730930628   X2C                   ELSE
183740920415     C                   SETON                                        30
183750930628    2C                   END
183760921005     C*
183770930628   X1C                   ELSE
183780921005     C*
183790920421     C                   Z-ADD     VIDNSP        BLPNSP
183800930628    1C                   END
183810920415     C*
183820930628    1C     *IN30         IFEQ      *ON
183830951228     C                   MOVE      VIDDSP        AAS
183840910117     C                   Z-ADD     3             CNU
183850910117     C                   Z-ADD     VIDLNP        COMLIN
183860000509     C                   CLEAR                   WNUF2
183870000509     C* SE LNP POSTE METTO ANCHE LA SERIE ON CHIAVE
183880020319     C     §ogntw        IFEQ      'PPT'
183890000509     C                   Z-ADD     VIDNRS        WNUF2
183900000509     C                   ENDIF
183910921006     C* CHAIN FINO A QUANDO NON TROVO UN NUMERO LIBERO
183920930628    2C     *IN30         DOWEQ     '1'
183930000509     C     KNUFSP        CHAIN     FLNUF                              3031
183940951228     C* SE NON TROVATO IL NUMERATORE PROVO A CREARLO
183950000627     C*  NON LO FACCIO PER POSTE
183960020319     C     §ogntw        IFNE      'PPT'
183970000627     C     *IN30         ANDEQ     *ON
183980951228     C                   Z-ADD     CNU           PA4CNU
183990951228     C                   CALL      'FNLVCNR'
184000951228     C                   PARM                    PA4CNU
184010000509     C     KNUFSP        CHAIN     FLNUF                              3031
184020951228     C                   ENDIF
184030951228     C*
184040951228     C* SE ANCORA NON TROVATO ERRORE
184050940923     C   30              SETON                                        90
184060940923     C   30              MOVEL     ERR(39)       VIDMSG
184070020320     C* RECORD ALLOCATO
184080940923     C   31              SETON                                        90
184090940923     C   31              MOVEL     ERR(42)       VIDMSG
184100951228     C* PER ERRORE ESCO
184110950508     C   90              MOVEL     '1'           WEMFOR
184120921006     C   90              GOTO      ENDREG
184130921006     C*
184140900824     C                   ADD       1             NUFNUM
184150900824     C                   UPDATE    FLNUF
184160921006     C                   Z-ADD     NUFNUM        RECNSP
184170921006     C*
184180921006     C* 30 ON - SPED ESISTENTE FACCIO NUOVA CHAIN
184190940915     C     KNSP          SETLL     FNBLP01L                               30
184200040329      * devo controllare anche su titas che non ci sia già
184210040329      * una spedizione con lo stesso numero
184220040329     c                   If        Not *In30 and %Open(Titas30c)
184230040329     c     kNsp          Chain(n)  Titas30c
184240040329     c                   If        %Found(Titas30c)
184250040329     c                   Eval      *In30 = *On
184260040329     c                   EndIf
184270040329     c                   EndIf
184280040329
184290921006     C  N30              MOVEL     NUFNUM        BLPNSP
184300930628    2C                   ENDDO
184310040727   x1c                   Else
184320040727      * se bolla già presente su TITAS emetto errore bloccante
184330040727     c                   If        %Open(Titas30c)
184340040727     c                   Eval      recnsp = BlpNsp
184350040727     c     kNsp          Chain(n)  Titas30c
184360040727     c                   If        %Found(Titas30c)
184370040727     c                   Eval      VidMsg = Err(55)
184380040727     c                   Eval      *In90 = *On
184390040727     c                   Eval      wemfor = '1'
184400040727     c                   Goto      EndReg
184410040727     c                   EndIf
184420040727     c                   EndIf
184430930628    1C                   ENDIF
184440920410     C*
184450900827     C   12
184460900827     CANN15              MOVEL     VIDNSP        BLPNSP
184470940926     C*
184480940926     C* MEMORIZZO I CAMPI IMPOSTATI A VIDEO: SE BOLLA CON MAMMA
184490940926     C*  NON LI MEMORIZZO MA STAMPO SOLTANTO
184500051115     C                   MOVEL     VIDCAS        ar9CAS
184510011108     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO CONTRASSEGNO > 0
184520011108     C     VIDCAS        IFGT      *ZEROS
184530051115     C                   MOVEL     VIDVCA        ar9VCA
184540011113     C                   ELSE
184550051115     C                   CLEAR                   ar9VCA
184560011108     C                   ENDIF
184570050518     c* Se = *blanks, e forzabile da tabella TM --> forzo
184580051115     C                   MOVEL     VIDTIC        ar9TIC
184590091001     c                   clear                   w_ar5tic
184600111213     c                   if        vidcas>0
184610121022     c* per spedizioni export non valgono le seguenti forzature ma
184620121022     c* pilotano i tipi incasso abilitati come da tabella "1AX"
184630121022     c                             and a_§ogntw<>'DPD'
184640121022     c                             and a_§ogntw<>'EEX'
184650121022     c                             and a_§ogntw<>'FED'
184660071011     c                   select
184670071011     c                   when      vidtic=*blanks and §TMFTI<>*BLANKS
184680051115     C                   MOVEL     §TMfti        ar9tic
184690080625     C                   MOVEL     §TMfti        vidtic
184700090706     c* frozatura per destinatario particolare
184710111213     c                   when      vidtic=*blanks and
184720091002     c                             ot0err=*blanks and OT0X1TICF<>*blanks
184730090706     C                   MOVEL     OT0X1TICF     ar9tic
184740090706     C                   MOVEL     OT0X1TICF     vidtic
184750091001     c                   movel     ot0x1ticf     w_ar5tic
184760111213     c                   when      vidtic=*blanks
184770071008     c* Se = *blanks, e forzabile da tabella FSC --> forzo
184780090619     c* Se cliente abilitato da tabella CIC non devo forzare
184790090619     C                   CLEAR                   dsbs02
184800090619     C                   MOVEL     'C'           T02MOD
184810090619     C                   MOVEL     KNSIF         T02SIF
184820090619     C                   MOVEL     'CIC'         T02COD
184830090619     c                   if        vidflc=0
184840090622     c                   eval      t02ke1=%editc(vidlnp:'X')+%editc(vidccm:'X')
184850090619     c                   else
184860090619     c                   eval      t02ke1=%editc(vidflc:'X')+%editc(vidccm:'X')
184870090619     c                   endif
184880090619     C                   CALL      'TIBS02R'
184890090619     C                   PARM                    KPJBA
184900090619     C                   PARM                    dsbs02
184910090619      * Cliente non presente in tabella "CIC"
184920090619     c                   if        t02err<>*blanks
184930071008     C                   CLEAR                   dsbs02
184940071008     C                   MOVEL     'C'           T02MOD
184950071008     C                   MOVEL     KNSIF         T02SIF
184960071008     C                   MOVEL     'FSC'         T02COD
184970071008     c                   movel(P)  comlna        t02ke1
184980161229     c***                clear                   dfsc
184990071008     C                   CALL      'TIBS02R'
185000071008     C                   PARM                    KPJBA
185010071008     C                   PARM                    dsbs02
185020161229     c****               eval      dfsc=t02uni
185030071008    2C                   IF        T02ERR = *BLANKS and t02atb=*blanks
185040161229     c****               exsr      sr_impoDalAl
185050161229     c****               if        (wcadal=*zeros and wcaal=*zeros) or
185060161229     c****                         (ar9vca=§gedcn and vidcas >=wcadal and
185070161229     c*****                         vidcas<=wcaal)
185080071008     C                   movel     'SC'          ar9tic
185090080625     C                   movel     'SC'          vidtic
185100161229     c***                endif
185110071008    2C                   ENDIF
185120090619     c                   endif
185130071011     c                   endsl
185140111213     c                   endif
185150050518     c
185160941005     C***
185170941005     C***   N U M E R O   S E G N A C O L L I
185180941005     C                   MOVEL     WFLS          BLPFLS
185190971211     C                   MOVEL     COMLNA        VIDLNA
185200940926     C*
185210940926     C* MEMORIZZO SEGNACOLLI SE BOLLA SENZA MAMMA
185220940926    1C     §3ABCM        IFEQ      ' '
185230000627     C* ASSEGNO NUMERO DI SEGNACOLLI
185240000627     C                   EXSR      ASSSGN
185250000627     C     WEMFOR        IFEQ      '1'
185260000627     C                   GOTO      ENDREG
185270000627     C                   ENDIF
185280940926     C*
185290940926   X1C                   ELSE
185300940926     C* BOLLA CON MAMMA
185310950215     C                   CLEAR                   BLPFLS
185320940926     C                   CLEAR                   BLPNCD
185330940926     C                   CLEAR                   BLPNCA
185340051115     C                   CLEAR                   ar9TIC
185350051115     C                   CLEAR                   ar9CAS
185360051115     C                   CLEAR                   ar9VCA
185370940926    1C                   ENDIF
185380020320     c* Se bolla Export FedEx prelevo numeri AWB
185390020320     c     A_§ogntw      ifeq      'FED'
185400020320     c                   clear                   wawbini
185410020320     c* devo assegnare numeri awb fedex in immissione o conferma bolle
185420020320     c* SEMPRE oppure in manutenzione se è aumentato il numero dei colli
185430020320     c* oppure se è cambiata la linea di arrivo e la precedente era una
185440020320     c* linea non fedex
185450020320     c     *in12         ifeq      *off
185460020320     c     *in15         oreq      *on
185470020320     c     *in15         oreq      *off
185480020320     C     vidncl        andgt     savncl
185490020320     c     *in15         oreq      *off
185500020320     C     savntw        andne     'FED'
185510020320     c                   clear                   trul33ds
185520020320     c                   z-add     21            i33cnu
185530020320     c                   z-add     vidncl        i33num
185540020320     c                   movel     trul33ds      kpjbu
185550020320     c                   call      'TRUL33R'
185560020320     c                   PARM                    kpjba
185570020320     c                   movel     kpjbu         trul33ds
185580020320     c* se errore vado a fine routine
185590020320     c     o33err        ifgt      *zeros
185600020320     c                   seton                                        90
185610020320     c                   movel     '1'           wemfor
185620020320     c                   select
185630020320     c     o33err        wheneq    1
185640020320     c                   movel     err(250)      vidmsg
185650020320     c     o33err        wheneq    2
185660020320     c                   movel     err(251)      vidmsg
185670020320     c     o33err        wheneq    3
185680020320     c                   movel     err(252)      vidmsg
185690020320     c                   endsl
185700020320     c                   goto      endreg
185710020320     c                   endif
185720020320     c                   z-add     o33nri        wawbini
185730020320     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
185740051102     c* del ARS trk "F"
185750020320     c                   z-add     wawbini       wawb
185760020320     c                   endif
185770020320     c                   endif
185780010228     C* SE SONO IN IMMISSIONE DEI MIEI PREPAGATI RICHIAMO PGM DI IMM.
185790010227     C* ORM
185800010227     C     PARTCH        IFEQ      'P'
185810010227     C     VIDMAG        ANDNE     'S'
185820010307     C     WORM          ANDEQ     'S'
185830010713     C     §3ARBL        ANDNE     'R'
185840010227     C                   EXSR      RIEO05
185850010228     C                   CLEAR                   KPJBU
185860010227     C                   CALL      'FIOR05R'
185870010227     C                   PARM                    KPJBA
185880010228     C                   PARM                    DSOR05
185890010227     C* SE PREMUTO F3 VADO A FINE ROUTINE E RIEMETTO LA VIDEATA
185900010227     C     §RMERR        IFEQ      '3'
185910010227     C                   MOVEL     '1'           WEMFOR
185920010227     C                   GOTO      ENDREG
185930010227     C                   ENDIF
185940010227     C                   ENDIF
185950001024     C*
185960060215     C* SE ANNO SPEDIZIONE E ANNO DI VAD SONO <> SISTEMO Fiar4 E
185970970107     C*  EDRDE01L
185980060215     c* 15/02/2006: Non si deve più aggiornare ar4 perchè è stato
185990060215     c* sostituito dal vat. Bisogna però continuare ad aggiornare EDRDE
186000060215     c* per bolle import
186010060215     C*****              CLEAR                   WESRDE
186020970107     C   12
186030970107    1CAN 15§1BFG3        IFEQ      'S'
186040970107     C*
186050970107     C     §3CFSP        OREQ      'S'
186060970107     C     §1BFG2        ANDEQ     'S'
186070970107     C*
186080060216     C* SE NON C'E' IL VAD RICONTROLLO KAAS CON Fiar4
186090060216     c* non serve più: ora l'informazione viene passata col vat
186100970107     C*
186110970407    2C     §LPAAC        IFNE      §LPAAS
186120060215     C**   KBLC4         CHAIN     Fiar401L                           31
186130060215    3C**   *IN31         DOWEQ     *OFF
186140060215     C**                 Z-ADD     §LPAAS        ar4AAS
186150060215     C**                 UPDATE    Fiar4000
186160060215     C**                 MOVEL     'S'           WESRDE            1
186170060215     C***  KBLC4         READE     Fiar401L                               31
186180060215    3C**                 ENDDO
186190970107     C*
186200060215    3C**** WESRDE        IFEQ      'S'
186210060215    3c                   if        §ogntw = 'EEX' or §ogntw = 'FED' or
186220081008     c                             §ogntw = 'DPD'
186230970107     C**
186240970107    4C     WOPRDE        IFEQ      ' '
186250970107     C                   OPEN      EDRDE01L
186260970107     C                   MOVEL     'S'           WOPRDE            1
186270970107    4C                   ENDIF
186280970107     C**
186290970107     C     KBLC4         CHAIN     EDRDE01L                           31
186300970107    4C     *IN31         DOWEQ     *OFF
186310970107     C                   Z-ADD     §LPAAS        RDEAAS
186320970107     C                   UPDATE    EDRDE000
186330970107     C     KBLC4         READE     EDRDE01L                               31
186340970107    4C                   ENDDO
186350970107    3C                   ENDIF
186360970107    2C                   ENDIF
186370970107     C*
186380970107    1C                   ENDIF
186390060209     c*
186400060209     c* STORICIZZAZIONI PER PREPAGATI
186410060209     c* Se cvb <> *blanks significa che è stata richiesta una variazione
186420060209     c* da gestire
186430060209     c                   if        ilv85cvb <> *blanks
186440060209     c* -- Storicizzazione variazione --
186450060209     c                   if        §7lfsa = 'S'
186460060209     c* se variazione da storicizzare e si tratta di variazione di
186470060209     c* tassazione memorizzo fiar6 e fiar7 prima di cancellare
186480060209     c* La write verrà eseguita prima della write di fnblp
186490060209     c                   if        ilv85cvb = 'TR'
186500060209     c                   clear                   fiarbt00
186510060209     c                   movel     knmus         arbpru
186520060209     c                   z-add     dateu         arbdtv
186530060209     c                   time                    arborv
186540060209     c                   movel     ilv85cvb      arbcvb
186550060209     c                   movel     '1'           arbtrc
186560060209     c                   exsr      stoarb
186570060209     c                   endif
186580060209     c                   endif
186590060209     c* -- Storicizzazione motivo variazione --
186600060209     c                   if        §7lmtv = 'S'
186610070604     c*                  movel     'L'           ilv85tla
186620070604     c                   movel     ' '           ilv85tla
186630060209     c                   movel     'R'           ilv85tel
186640060209     c                   z-add     arbdtv        ilv85dac
186650060209     c                   z-add     arborv        ilv85orc
186660060209     c                   z-add     blpaas        ilv85aas
186670060209     c                   z-add     blplnp        ilv85lnp
186680060209     c                   z-add     blpnrs        ilv85nrs
186690060209     c                   z-add     blpnsp        ilv85nsp
186700060307     c                   movel     olv85mtv      ilv85mtv
186710060307     c                   movel     olv85nt1      ilv85nt1
186720060307     c                   movel     olv85nt2      ilv85nt2
186730060209     c                   movel     fnlv85ds      kpjbu
186740060209     c                   call      'FNLV85R'
186750060209     c                   parm                    kpjba
186760060210     c                   movel     kpjbu         fnlv85ds
186770060209     c                   endif
186780060209     c                   endif
186790060209      *
186800060209      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
186810060209      * IN FIAR700F
186820060209     C     WAR7          IFEQ      'E'
186830060209     c     war61         oreq      'E'
186840060209     c     wkscsf1       andne     0000
186850060209     c     wkscsf1       andne     9999
186860060209     C                   MOVEL     '1'           WTRC
186870060209     C     KBLP4         SETLL     FIAR7000
186880060209     C     KBLP4         READE     FIAR7000                               30
186890060209      *
186900060209    2C     *IN30         DOWEQ     *OFF
186910060209     C                   DELETE    FIAR7000
186920060209     C     KBLP4         READE     FIAR7000                               30
186930060209    2C                   ENDDO
186940060209      *
186950060209     C                   ENDIF
186960060209      * anche per la seconda bolla
186970060209if  1c                   If        War71 = 'E' or (war62 = 'E' and
186980060209     c                             wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
186990060209     c                   Eval      Wtrc = '2'
187000060209     c     Kblp4         Setll     Fiar7000
187010060209do  2c                   Do        *Hival
187020060209     c     Kblp4         Reade     Fiar7000
187030060209     c                   If        %Eof(Fiar701l)
187040060209     c                   Leave
187050060209     c                   EndIf
187060060209     c                   Delete    Fiar7000
187070060209    2c                   EndDo
187080060209    1c                   EndIf
187090060209     C* PULISCO I FORMATI
187100060209     C                   CLEAR                   FIAR6000
187110060209     C                   CLEAR                   FIAR7000
187120940926     C***
187130941108     C*
187140940926     C***  T O T A L E   F A T T U R A
187150940926    1C     VIDNFT        IFGT      0
187160990630     C     *IN34         OREQ      *ON
187170941108     C*
187180120109     c* Qui non viene impostato comdft prima di richiamare totfat
187190120109     c* In caso di immissione di un prepagato il comdft in questo
187200120109     c* momento è = 0 (viene azzerato all'uscita dal FNLV16R) e
187210120109     c* viene quindi passata data fattura=0 al pgm fnlv04r.
187220120109     c* Nei periodi a cavallo di cambio aliquota IVA non è comunque
187230120109     c* un problema visto che il pgm FNLV04R se riceve data fattura=0,
187240120109     c* sceglie l'aliquota iva per il calcolo in base alla data del giorno
187250990630     C                   EXSR      TOTFAT
187260941108     C*
187270941108     C* SE E' UN ASSEGNATO MEMORIZZO TUTTI I CAMPI DELLA TASSAZIONE
187280990629     C*  OPPURE SE E' UN PREPAGATO
187290941108     C     *IN04         IFEQ      *ON
187300990629     C     *IN34         OREQ      *ON
187310941108     C                   ADD       D04BOL        DB0ESE
187320941108     C                   Z-ADD     D04IFT        DB0IFT
187330990701     C                   Z-ADD     D04IVA        DB0IVA
187340990701     C                   Z-ADD     D04IMV        VIDIMV
187350991130     C                   Z-ADD     VIDIMV        DB0IMV
187360990630     C                   Z-ADD     D04POR        VIDPOR
187370991014     C                   Z-ADD     D04POR        MEMPOR
187380941108    2C                   ENDIF
187390990630     C**
187400990630     C* REPERISCO: PO IVA, NUMERO E DATA FATTURA
187410990630    2C     *IN34         IFEQ      *ON
187420990630     C     KNUM          CHAIN     CNNUM000                           30
187430990630    3C     *IN30         IFEQ      *OFF
187440990630     C                   ADD       1             NUMNUM
187450990630     C                   Z-ADD     NUMNUM        VIDNFT
187460990630     C                   MOVE      DATEU         NUMDTP
187470990630     C                   UPDATE    CNNUM000
187480990630   X3C                   ELSE
187490990630     C                   Z-ADD     0             VIDNFT
187500990630    3C                   ENDIF
187510990630     C                   Z-ADD     FIV           VIDFIV
187520171005     C****               Z-ADD     DATEU         COMDFT
187521171005     c                   eval      comdft=%dec(%date())
187530990630    2C                   ENDIF
187540941108    1C                   ENDIF
187550940926     C*
187560940926     C* SE ESISTE ALMENO UNA VARIA LEGGO IL SFL E GIA' CHE CI SONO
187570940926     C*  IMPOSTO GIA' I CAMPI DELLA TASSAZIONE
187580940926     C                   Z-ADD     1             NRR
187590941108     C                   Z-ADD     1             C
187600991014    1C     WESVAR        IFNE      ' '
187610940926     C*
187620941108    2C                   DO        20            NRR
187630940926     C     NRR           CHAIN     LS01S03                            30
187640991014      *
187650941108    3C     *IN30         IFEQ      *OFF
187660941108     C     V3CSV1        ANDNE     ' '
187670991014      * ESENTE: SOMMO AL TOTALE FATTURA SE E' DA IMPOSTARE
187680940926    4C     V3CEV1        IFNE      ' '
187690940926     C     VIDNFT        ANDGT     0
187700941108     C                   ADD       V3CVA1        DB0ESE
187710991130     C                   SUB       V3CVA1        DB0IMV
187720940926    4C                   ENDIF
187730991014      * SCRIVO VARIE
187740991014     C                   EXSR      WRTVAR
187750940926    3C                   ENDIF
187760940926    2C                   ENDDO
187770991014      *
187780940926    1C                   ENDIF
187790991014      *
187800991014      * SE IMPOSTATA L'IVA SCRIVO VARIA
187810991014     C     D04IVA        IFGT      *ZEROS
187820991014     C                   MOVEL     §$2IVA        V3CSV1
187830991014     C                   Z-ADD     D04IVA        V3CVA1
187840991014     C                   EXSR      WRTVAR
187850991014     C                   ENDIF
187860991014      * SE IMPOSTATO IL BOLLO SCRIVO VARIA, IN DB0ESE è GIA' STATA SOMMATA
187870991014     C     D04BOL        IFGT      *ZEROS
187880991014     C                   MOVEL     §$2BOL        V3CSV1
187890991014     C                   Z-ADD     D04BOL        V3CVA1
187900991014     C                   EXSR      WRTVAR
187910991014     C                   ENDIF
187920991027      *
187930991027      * SE PIENA UNA VARIA O ANTICIPATA O NUMERO FATTURA O PORTO
187940991027      *  O INOLTRO O DIRITTO FISSO O ESENZ.IVA  --> SCRIVO FIAR600F
187950991006      *
187960991006      * Se agganciata precedentemente riaggancio file tassazione per 1a bolla
187970991006     C     WAR61         IFEQ      'E'
187980991006     C                   MOVEL     '1'           WTRC
187990050331     c* se presente cod.Segue fattura significa che era stata tassata
188000050331     c* in arrivo --> DELETO la tassazione dell'arrivo
188010050331     c                   if        wKSCsf1 <> 0000 and wKSCsf1 <> 9999
188020050331     c     kblp4         delete    fiar6000
188030050331     c                   clear                   war61
188040050331     c                   else
188050991006     C     KBLP4         CHAIN     FIAR6000                           30
188060050331     c                   endif
188070991006     C                   ENDIF
188080991006      *
188090941108    1C     VIDDFT        IFGT      0
188100051116     C     wsv1          ORNE      ' '
188110051116     C     wsv2          ORNE      ' '
188120051116     C     wsv3          ORNE      ' '
188130051116     C     VIDCEI        ORNE      ' '
188140940926     C     VIDPOR        ORNE      0
188150991202     C*          VIDANT    ORNE 0
188160991006     C                   MOVEL     '1'           AR6TRC
188170991006     C                   Z-ADD     BLPAAS        AR6AAS
188180991006     C                   Z-ADD     BLPLNP        AR6LNP
188190991006     C                   Z-ADD     BLPNRS        AR6NRS
188200991006     C                   Z-ADD     BLPNSP        AR6NSP
188210991006     C                   Z-ADD     VIDPOR        AR6POR
188220991006     C                   Z-ADD     VIDIMV        AR6IMV
188230991006     C                   MOVEL     VIDCEI        AR6CEI
188240991027      *
188250991027     C                   MOVEL     WSV1          AR6SV1
188260991027     C                   Z-ADD     WVA1          AR6VA1
188270991027     C                   MOVEL     WSV2          AR6SV2
188280991027     C                   Z-ADD     WVA2          AR6VA2
188290991027     C                   MOVEL     WSV3          AR6SV3
188300991027     C                   Z-ADD     WVA3          AR6VA3
188310991027      *
188320120104      * L'aliquota iva la memorizzo solo se presente numero fattura
188330991006      * SE ESENZIONE NON MEMORIZZO L'ALIQUOTA
188340120104     c                   if        vidnft>0
188350941108    2C     VIDCEI        IFEQ      *BLANKS
188360120109     c                   if        comdft>§qtdsa
188370991006     C                   Z-ADD     §QTALI        AR6ALI
188380120104     c                   else
188390120104     C                   Z-ADD     §QTALO        AR6ALI
188400120104     c                   endif
188410941108   X2C                   ELSE
188420991006     C                   MOVEL     *ZEROS        AR6ALI
188430941108    2C                   ENDIF
188440120104     c                   endif
188450991006     C                   Z-ADD     D04IFT        AR6IFT
188460991006     C                   Z-ADD     VIDFIV        AR6FIV
188470991006     C                   Z-ADD     VIDNFT        AR6NFT
188480991006     C                   Z-ADD     COMDFT        AR6DFT
188490991015     C                   MOVEL     VIDDIV        AR6DIV
188500991015      * IMPOSTO FLAG DI TOTALE IMPONIBILE INSERITO IN PARTENZA
188510991015     C     AR6IMV        IFGT      *ZEROS
188520991015     C                   MOVEL     'P'           AR6FIM
188530991015     C                   ELSE
188540991015     C                   CLEAR                   AR6FIM
188550991015     C                   ENDIF
188560991015      * PER ASSEGNATI IMPOSTO CODICE DI FATTURAZIONE
188570991015     C                   CLEAR                   AR6CTR
188580991015     C     *IN04         IFEQ      *ON
188590991022     C                   MOVE      9999          AR6KSC
188600991022     C                   MOVEL     AR6LNP        AR6KSC
188610991015     C                   ELSE
188620991015     C                   CLEAR                   AR6KSC
188630991015     C                   ENDIF
188640991006      *
188650991015      *
188660991006     C     WAR61         IFEQ      'E'
188670991006     C                   UPDATE    FIAR6000
188680940926     C                   ELSE
188690991006     C                   WRITE     FIAR6000
188700940926     C                   ENDIF
188710941108     C*
188720941108     C* DATI PER STAMPA
188730990629     C* PER ASEGNATO O FRANCO PREPAGATO
188740941108     C     *IN04         IFEQ      *ON
188750990629     C     *IN34         OREQ      *ON
188760941108     C                   MOVEL     VIDCEI        DB0CEI
188770991014     C                   MOVEL     V3DCEI        DB0DCE
188780991014     C                   MOVEL     VIDDIV        DB0DIV
188790991014     C                   MOVEL     WFDC1         DB0FDC
188800941108     C                   Z-ADD     VIDIMV        DB0IMV
188810941108     C                   ENDIF
188820021209      * Per prepagato stampo sempre i dati della fattura
188830021209     c                   If        *In34
188840941108     C                   Z-ADD     VIDNFT        DB0NFT
188850941108     C                   Z-ADD     COMDFT        DB0DFT
188860941108     C                   ENDIF
188870940926     C*
188880940926   X1C                   ELSE
188890991006     C* SE NON DEVO SCRIVERE IL RECORD FIAR6 E C'ERA --> DELETO
188900991006    2C     WAR61         IFEQ      'E'
188910991006     C                   DELETE    FIAR6000
188920940926    2C                   ENDIF
188930940926    1C                   ENDIF
188940930624     C***
188950940919     C***  F L A G   I N O L T R O
188960940628     C                   EXSR      INOLTR
188970940628     C                   MOVEL     WFIN          BLPFIN
188980930624     C***
188990930624     C***  L I N E A   D I   A R R I V O
189000160829     c* In conferma bolle (no resi/dirottamenti) se bolla import dpd
189010160829     c* con numero parcel che inizia per 1251 viene forzata la linea
189020160829     c* di arrivo 172 a il fermo deposito='S'
189030160829     c***                if        *in12  and *in15 and §ogntw='DPD'
189040160829     c***                          and §vpofl1='S'
189050160829     c**                           and not *in44
189060160829     c**                           and %subst(v7cnpr:1:4)='1251'
189070160829     c***                z-add     172           comlna
189080160829     C* TERMINAL DI ARRIVO
189090160829     C***                CLEAR                   DSLV55
189100160829     C***                MOVEL     'A'           D55TPT
189110160829     C***                MOVEL     VIDLNP        D55LNP
189120160829     C***                MOVEL     comlna        D55LIN
189130160829     C***                MOVEL     BLPDSP        D55DRF
189140160829     C***                CALL      'FNLV55R'
189150160829     C***                PARM                    DSLV55
189160160829     C***  D55ERR        IFEQ      ' '
189170160829     C***                MOVEL     D55TFA        COMTFA
189180160829     C***                ENDIF
189190160829     C*
189200160829     c***                movel     'S'           vidffd
189210160829     c***                z-add     90            varznc
189220160829     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
189230160829
189240160829     C**                 MOVEL     ORGDE3        A_OG143
189250160829     C***                MOVEL     ORGDF0        A_OG150
189260160829     c***                endif
189270160829
189280940628     C                   MOVEL     COMLNA        BLPLNA
189290930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
189300941107     C* CAMPI PER LA STAMPA BOLLA
189310941107     C                   MOVEL     ORGFAG        DB0FAG
189320941107     C                   MOVEL     ORGDES        DB0DLA
189330941107     C                   MOVEL     ORGIND        DB0INL
189340941107     C                   MOVEL     ORGLOC        DB0LOL
189350941107     C                   MOVEL     ORGPRO        DB0PRL
189360941107     C                   MOVEL     ORGTEL        DB0TEL
189370160422     C                   MOVEL     ORGdd2        DB0FAX
189380100319     c* Mancava l'impostazione del CAP db0CAL ma lo lascio vuoto perchè
189390100319     c*  così capiamo che si tratta di LVD stampata in partenza che
189400100319     c*  non dovrebbe mai essere usata per la consegna
189410941107     C*
189420910426     C* DESCRIZIONE LINEA ARRIVO PER SEGNACOLLO
189430930628    1C     ORGDE5        IFNE      *BLANKS
189440000208     C                   MOVEL     ORGDE5        WDLA
189450910426     C                   ELSE
189460000208     C                   MOVEL     ORGDES        WDLA
189470930628    1C                   END
189480001024     C                   MOVE      COMTFA        BLPTFA
189490971202     C* BLPFEA: TERMINAL DI PARTENZA DELLA LINEA DI ARRIVO
189500971202     C                   CLEAR                   DSLV55
189510971202     C                   MOVEL     'P'           D55TPT
189520971202     C                   MOVEL     COMLNA        D55LIN
189530971202     C                   MOVEL     BLPDSP        D55DRF
189540971202     C                   CALL      'FNLV55R'
189550971202     C                   PARM                    DSLV55
189560971202     C     D55ERR        IFEQ      ' '
189570971202     C                   MOVEL     D55TFP        BLPFEA
189580971202     C                   ELSE
189590971202     C                   MOVEL     COMLNA        BLPFEA
189600971202     C                   ENDIF
189610910201     C*
189620971202     C* TERMINAL DI PARTENZA
189630960130     C                   MOVEL     COMTFP        BLPTFP
189640111128     C                   MOVEL     comtfp        BLPFLE
189650940919     C***
189660940919     C***  M I T T E N T E
189670940919     C* SE ASSEGNATO SCRIVO 9999 NEL CODICE SPEDIZIONE
189680940919     C*  E IL MITTENTE, SE CODIFICATO, IN BLPCCM
189690940919     C                   CLEAR                   BLPCCM
189700940919    1C     *IN04         IFEQ      *ON
189710940919     C                   Z-ADD     9999          BLPKSC
189720940919     C                   MOVEL     BLPLNP        BLPKSC
189730940919     C*
189740940919    2C     VIDCCM        IFNE      9999
189750940919     C                   Z-ADD     VIDCCM        BLPCCM
189760940919     C*
189770940927    3C     VIDFLC        IFEQ      0
189780940919     C                   MOVEL     VIDLNP        BLPCCM
189790940919     C                   ELSE
189800940919     C                   MOVEL     VIDFLC        BLPCCM
189810940927    3C                   ENDIF
189820940927    2C                   ENDIF
189830940919    1C                   ENDIF
189840940919     C*
189850940919     C* SE FRANCO CODICE SEMPRE IL BLPKSC
189860941103     C     *IN04         IFEQ      *OFF
189870940919     C                   Z-ADD     VIDCCM        BLPKSC
189880940919     C     VIDFLC        IFEQ      0
189890940919     C                   MOVEL     VIDLNP        BLPKSC
189900940919     C                   ELSE
189910940919     C                   MOVEL     VIDFLC        BLPKSC
189920940919     C                   ENDIF
189930940919     C                   ENDIF
189940940919     C*
189950900504     C                   MOVEL     VIDRSM        BLPRSM
189960900504     C                   MOVEL     VIDINM        BLPINM
189970900504     C                   MOVEL     VIDCAM        BLPCAM
189980900504     C                   MOVEL     VIDLOM        BLPLOM
189990900504     C                   MOVEL     VIDPRM        BLPPRM
190000930202     C                   MOVEL     *BLANKS       BLPCPI
190010940919     C                   MOVEL     VIDNZM        BLPNZM
190020050114     c* flag unificazione spedizioni impostato solo se provengo da
190030050114     c* conferma bolle da cliente
190040130301     c  n12              clear                   blpxco
190050050114     c                   if        *in12 and *in15
190060050114     c                   eval      blpxco = wxco
190070050114     c                   endif
190080941221     C* MERCE PORTATA A MAGAZZINO
190090990915     C     *IN34         IFEQ      *ON
190100990915     C     VIDPDR        ANDLE     *ZEROS
190110001024     C                   MOVEL     VIDMAG        BLPFDN
190120990915     C                   ELSE
190130941221     C                   MOVEL     APDFCM        BLPFDN
190140990915     C                   ENDIF
190150950626     C* P A R T I T A   I V A
190160950626     C*
190170950626     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
190180950626     C*     NELLA P.IVA
190190950626     C     VIDISM        IFEQ      '$$'
190200950626     C     VIDCPM        ANDEQ     *BLANKS
190210950626     C                   MOVEL     'PRIVATO'     VIDCPM
190220950626     C                   ENDIF
190230950626     C     VIDISD        IFEQ      '$$'
190240950626     C     VIDCPD        ANDEQ     *BLANKS
190250950626     C                   MOVEL     'PRIVATO'     VIDCPD
190260950626     C                   ENDIF
190270950626     C*
190280941103     C  N04VIDISM        IFEQ      *BLANKS
190290940927     C                   MOVEL     VIDCPM        BLPCPI
190300940927     C                   ELSE
190310940927     C                   MOVEL     VIDPIM        BLPCPI
190320940927     C                   ENDIF
190330940927     C   04VIDISD        IFEQ      *BLANKS
190340940927     C                   MOVEL     VIDCPD        BLPCPI
190350940927     C                   ELSE
190360940927     C                   MOVEL     VIDPID        BLPCPI
190370940927     C                   ENDIF
190380950303     C*
190390950303     C* SE BOLLA DIRETTA ALL'ESTERO SCRIVO LE P.IVA
190400950303    1C     WDESIE        IFEQ      'E'
190410100119     c* Se c'e' esenzione IVA seconda bolla, memorizzo la partita IVA
190420100119     c     vi2cei        orne      ' '
190430100119     c* In manutenzione la devo cancellare se non è estero e non c'e' esenz.IVA
190440971230     C     *IN12         OREQ      *ON
190450971230     C     *IN15         ANDEQ     *OFF
190460971230     C     WDESIE        ANDNE     'E'
190470100119     C     vi2cei        andeq     ' '
190480950303     c*
190490971222     C                   CLEAR                   D19NT1
190500950303     C     VIDISD        IFEQ      *BLANKS
190510950303     C                   MOVEL     VIDCPD        W016A
190520950303     C                   ELSE
190530950303     C                   MOVEL     VIDPID        W016A            16
190540950303     C                   ENDIF
190550950303     C*
190560950303     C                   MOVE      W016A         D19NT1
190570950303     C*
190580950303     C     VIDISM        IFEQ      *BLANKS
190590950303     C                   MOVEL     VIDCPM        W016A
190600950303     C                   ELSE
190610950303     C                   MOVEL     VIDPIM        W016A            16
190620950303     C                   ENDIF
190630950303     C*
190640971222     C                   MOVEL     W016A         D19NT1
190650100119     c
190660100119     c                   if        *in12 and not *in15
190670100119     c                             and WDESIE<>'E' and vi2cei=' '
190680100119     C**   12
190690100119     C**ANN15WDESIE        IFNE      'E'
190700971230     C                   CLEAR                   D19NT1
190710971230     C                   ENDIF
190720060216     C                   MOVEL     'T'           D19ftr
190730950303     C                   MOVEL     BLPAAS        D19AAS
190740950303     C                   MOVEL     BLPLNP        D19LNP
190750950303     C                   MOVEL     BLPNRS        D19NRS
190760950303     C                   MOVEL     BLPNSP        D19NSP
190770950303     C                   MOVEL     'P'           D19TRC
190780950303     C                   CLEAR                   D19NT2
190790950303     C                   CALL      'FNLV19R'
190800950303     C                   PARM                    DSLV19
190810950303     C                   ENDIF
190820061110     c* Codice Fiscale mittente se inserito per prepagati non codificati
190830061110     c                   if        (*in34 and vidcdf<>*blanks) or
190840061110     c                             (not *in34 and *in22)
190850061110     C                   CLEAR                   D19NT1
190860061110     c                   movel     vidcdf        d19nt1
190870061110     C                   MOVEL     'T'           D19ftr
190880061110     C                   MOVEL     BLPAAS        D19AAS
190890061110     C                   MOVEL     BLPLNP        D19LNP
190900061110     C                   MOVEL     BLPNRS        D19NRS
190910061110     C                   MOVEL     BLPNSP        D19NSP
190920061110     C                   MOVEL     'Q'           D19TRC
190930061110     C                   CLEAR                   D19NT2
190940061110     C                   CALL      'FNLV19R'
190950061110     C                   PARM                    DSLV19
190960061110     C                   ENDIF
190970940919     C***
190980940919     C***  D E S T I N A T A R I O
190990900504     C                   MOVEL     VIDRSD        BLPRSD
191000950123     C                   MOVE      VIDRSD        WRD2             35
191010941025     C*
191020940919     C* SE SCRITTA ANCHE 2 RAGIONE SOCIALE DESTINATARIO
191030940919     C*  SCRIVO IL FILE DI ESTENSIONE DESCRIZIONI SE SUPERA IL MINIMO
191040940919     C*  CARATTERI PREVISTI  (CAMPO §7KMNC)
191050941025     C*  IN MANUTENZIONE VADO SEMPRE, PER IL RESTO SOLO SE IMMESSA
191060941025     C     *IN12         IFEQ      *ON
191070941025     C     *IN15         ANDEQ     *OFF
191080950123    2C     WRD2          ORNE      *BLANKS
191090060216     C                   MOVEL     'T'           D19ftr
191100941025     C                   MOVEL     BLPAAS        D19AAS
191110941025     C                   MOVEL     BLPLNP        D19LNP
191120941025     C                   MOVEL     BLPNRS        D19NRS
191130941025     C                   MOVEL     BLPNSP        D19NSP
191140941025     C                   MOVEL     'D'           D19TRC
191150971219     C                   MOVEL(P)  WRD2          D19NT1
191160941025     C                   CLEAR                   D19NT2
191170941025     C                   CALL      'FNLV19R'
191180941025     C                   PARM                    DSLV19
191190941025     C                   ENDIF
191200900504     C                   MOVEL     VIDIND        BLPIND
191210900504     C                   MOVEL     VIDCAD        BLPCAD
191220060705     c* se spedizione export DPD diretta in Portogallo devo aggiungere al
191230060705     c* cap immesso tanti 0 a dx quanti ne servono per arrivare ad una
191240060705     c* lunghezza di cap di 7 byte
191250060705     c                   if        a_§ogntw='DPD' and vidnzd = 'P  '
191260060705     c     ' '           checkr(e) blpcad:7      NN                1 0
191270060705     c                   if        %found
191280060705     c                   eval      %subst(blpcad:nn+1:7-nn)=*all'0'
191290060705     c                   endif
191300060705     c                   endif
191310900504     C                   MOVEL     VIDLOD        BLPLOD
191320900504     C                   MOVEL     VIDPRD        BLPPRD
191330940919     C                   MOVEL     VIDNZD        BLPNZD
191340140612     c* se spedizione export e presente la provincia la tengo solo se
191350140612     c* è obbligatoria come da tabella nazione
191360140612     c                   if        blpnzd<>*blanks
191370140612     C                   MOVEL     '15'          COD
191380140612     C                   MOVEL(P)  BLPNZD        KEY
191390140612     C                   EXSR      CTABEL
191400140612     C   30              CLEAR                   DS15
191410140612     C  N30              MOVEL     TBLUNI        DS15
191420140612     c                   if        §15sto<>'S'
191430140612     c                   clear                   blpprd
191440140612     c                   endif
191450140612     c                   endif
191460940919     C*
191470900504     C                   MOVEL     VIDGC1        BLPGC1
191480900504     C                   MOVEL     VIDGC2        BLPGC2
191490900504     C                   MOVEL     VIDCTR        BLPCTR
191500900613     C                   MOVEL     SAVCTS        BLPCTS
191510911008     C                   MOVEL     VIDFBR        BLPFBR
191520000627     C*
191530000627     C* ALLEGA BAM
191540000627     C                   EXSR      AGGFST
191550950127     C*
191560960118     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
191570951009     C                   CLEAR                   BLPFTM
191580950127     C   04SAVFTM        IFEQ      'S'
191590950127     C     VIDFTM        OREQ      'S'
191600950127     C                   MOVEL     'S'           BLPFTM
191610950127     C                   ENDIF
191620950127     C*
191630941230     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
191640941230    2C     APDFCM        IFNE      ' '
191650941230     C                   MOVEL     'C'           BLPFAP
191660941230     C                   ELSE
191670941230     C                   MOVEL     COMFAP        BLPFAP
191680941230    2C                   END
191690940922     C* SE NON IMMESSO TIPO SERVIZIO
191700940922     C     VIDTSP        IFNE      *BLANKS
191710940919    1C                   MOVEL     VIDTSP        BLPTSP
191720940922     C                   ELSE
191730940922     C* LO PRENDO DA TARIFFA
191740940922     C                   MOVEL     COMTSP        BLPTSP
191750940922     C                   ENDIF
191760020725     C*
191770940919     C                   MOVEL     VIDIAS        BLPIAS
191780011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO ASSICURARE > 0
191790011113     C     VIDIAS        IFGT      *ZEROS
191800011113     C                   MOVEL     VIDVAS        BLPVAS
191810011113     C                   ELSE
191820011113     C                   CLEAR                   BLPVAS
191830011113     C                   ENDIF
191840940919     C                   MOVEL     VIDVMD        BLPVMD
191850011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE VALORE MERCE > 0
191860011113     C     VIDVMD        IFGT      *ZEROS
191870011113     C                   MOVEL     VIDVAD        BLPVAD
191880011113     C                   ELSE
191890011113     C                   CLEAR                   BLPVAD
191900011113     C                   ENDIF
191910940919     C                   MOVEL     VIDQFT        BLPQFT
191920900504     C                   MOVEL     VIDNAS        BLPNAS
191930941115     C                   MOVEL     V1CNCL        BLPNCL
191940150304     C                   MOVEL     V2CPKG_i      BLPPKB
191950150304     C                   MOVEL     V2CPKG_i      BLPPKF
191960940919     C                   MOVEL     VIDFVR        BLPFVB
191970150304     C                   MOVEL     VARVOL_i      BLPVLB
191980940919     C                   MOVEL     VIDFVR        BLPFVF
191990150304     C                   MOVEL     VARVOL_i      BLPVLF
192000150304     c* Le istruzioni seguenti sono già state eseguite prima del calcolo
192010150304     c* dell'instradamento:
192020030204      * Immissione bolla
192030150304     c****               If        (*In12 and *In15) or Not *In12
192040030204      * Se sono stati impostati i bancali devo sommare al peso e al volume
192050030204      * il peso e il volume dei bancali
192060030922      * no x particolarità varia 'O'
192070150304     c***                If        %subst(VidGva:1:1) <> 'O'
192080150304     c***                If        VidNba > *Zeros and §cliban=*blanks
192090150304     c***                Clear                   w0071
192100150304     c**                 Clear                   w0053
192110150304     c***  wTbaPkg1      Mult      VidNba        w0071
192120150304     c***                Add       w0071         BlpPkb
192130150304     c***                Add       w0071         BlpPkf
192140150304     c***  wTbaVol1      Mult      VidNba        w0053
192150150304     c***                Add       w0053         BlpVlb
192160150304     c****               Add       w0053         BlpVlf
192170150304     c****               EndIf
192180150304     c****               If        VidNb2 > *Zeros
192190150304     c****               Clear                   w0071
192200150304     c****               Clear                   w0053
192210150304     c**** wTbaPkg2      Mult      VidNb2        w0071
192220150304     c***                Add       w0071         BlpPkb
192230150304     c***                Add       w0071         BlpPkf
192240150304     c**** wTbaVol2      Mult      VidNb2        w0053
192250150304     c***                Add       w0053         BlpVlb
192260150304     c***                Add       w0053         BlpVlf
192270150304     c***                EndIf
192280150304     c****               EndIf
192290150304     c****               EndIf
192300010214     C     VIDFFD        IFEQ      'N'
192310010214     C                   MOVEL     *BLANKS       BLPFFD
192320010214     C                   ELSE
192330940919     C                   MOVEL     VIDFFD        BLPFFD
192340010214     C                   ENDIF
192350940919     C                   MOVEL     COMDRT        BLPDRT
192360000308     C                   CLEAR                   BLPPDR
192370990630     C  N34              MOVEL     VIDLNP        BLPPDR
192380990630     C  N34              MOVE      VIDPDR        BLPPDR
192390940919     C                   MOVEL     VIDFPP        BLPFPP
192400940928     C                   MOVEL     VIDNRT        BLPNRT
192410940919     C                   MOVEL     VIDTCR        BLPTCR
192420940919     C                   MOVEL     COMDCR        BLPDCR
192430940919     C                   MOVEL     VIDHCR        BLPHCR
192440940919     C                   MOVE      VIDMCR        BLPHCR
192450030326      * Data consegna richiesta - Forzata su richiesta del cliente
192460030326      * in immissione bolla
192470030410      * e se non già impostata la data consegna richiesta
192480100219     c                   If        ((*In12 and *In15) or Not *In12)
192490100219     c                               and BlpDcr = *Zeros
192500030326     c                   ExSr      SrDcr
192510100217     c                   EndIf
192520100217     c
192530000214     C* SE E' UN DISK "C" MA NUMERAZIONE AUTOMATICA DPD,
192540000214     C* TRATTO COME DISK "A"
192550940919     C                   MOVEL     VIDSOP        BLPSOP
192560940919     C                   MOVEL     VIDRMN        BLPRMN
192570940919     C                   MOVEL     VIDRMA        BLPRMA
192580940919     C                   MOVEL     VIDRMO        BLPRMO
192590941005     C*
192600941005     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
192610941005     C     VIDCMO        IFNE      *BLANKS
192620941005     C                   MOVEL     VIDCMO        BLPCAM
192630941005     C                   MOVEL     VIDNMO        BLPNZM
192640941005     C                   ENDIF
192650941005     C*
192660160331     c* Forzatura zona di consegna per "VEDI PACCO DPD"  se prevista
192670160331     c                   if        w_vediP='1' and §NSDZNC<>*blanks
192680160331     c                   movel     §NSDZNC       VARZNC
192690160331     c                   endif
192700160421     c* In manutenzione verifico se si può aggiornare anche la zona di consegna
192710160421     c                   if        *in12 and not *in15
192720160421     c                   clear                   w_VariaZnc
192730160421     c                   exsr      sr_VariaZnc
192740160421     c                   endif
192750160421     c                   if        not *in12 or
192760160421     c                             (*in12 and *in15) or
192770160421     c                             (*in12 and not *in15 and w_VariaZnc=' ')
192780940919     C                   MOVEL     VARZNC        BLPZNC
192790160422     c                   else
192800160422     c                   movel     blpznc        varznc
192810160421     c                   endif
192820950303     C     §3ACTM        IFNE      *BLANKS
192830950303     C                   MOVEL     §3ACTM        BLPCTM
192840950303     C                   ELSE
192850940919     C                   MOVEL     VIDCTM        BLPCTM
192860950303     C                   ENDIF
192870941005     C     BLPCTM        IFEQ      *BLANKS
192880941005     C                   MOVEL     WCTM          BLPCTM
192890941005     C                   ENDIF
192900940919     C                   MOVEL     VIDTC1        BLPTC1
192910940919     C                   MOVEL     VIDTC2        BLPTC2
192920001205     C* SE MANUTENZIONE DI BOLLA POSTE E AGGIUNTA O TOLTA TC1/2 "F"
192930060215     C* DEVO AGGIORNARE ar4 TIPO RECORD J
192940140122     C** 12
192950140122     C**ANN15§ogntw        IFEQ      'PPT'
192960140122     C**                 CLEAR                   WTCP
192970140122     C**                 CLEAR                   WSVTCP
192980140122     C**   VIDTC1        IFEQ      'F'
192990140122     C**   VIDTC2        OREQ      'F'
193000140122     C**                 MOVEL     'F'           WTCP
193010140122     C**                 ENDIF
193020140122     C**   SAVTC1        IFEQ      'F'
193030140122     C**   SAVTC2        OREQ      'F'
193040140122     C**                 MOVEL     'F'           WSVTCP
193050140122     C**                 ENDIF
193060140122     C**                 SELECT
193070001205     C* SE NON E' STATA NE' AGGIUNTA NE' TOLTA LA "F" NON FACCIO NIENTE
193080140122     C**   VIDTC1        WHENNE    'F'
193090140122     C**   VIDTC2        ANDNE     'F'
193100140122     C**   SAVTC1        ANDNE     'F'
193110140122     C**   SAVTC2        ANDNE     'F'
193120140122     C**   WTCP          OREQ      'F'
193130140122     C**   WSVTCP        ANDEQ     'F'
193140140122     C**                 OTHER
193150140122     C**                 MOVEL     'J'           WTRC
193160140122     C**   KBLP4         CHAIN(N)  Fiar401L                           30
193170140122    3C**   *IN30         IFEQ      *OFF
193180140122     C**                 MOVEL     ar4NOT        DSBL4J
193190001205     C* TOLTO LA 'F'
193200140122    4C**   WTCP          IFEQ      *BLANKS
193210140122     C**   WSVTCP        ANDEQ     'F'
193220140122     C**                 CLEAR                   §B4BAI
193230140122   X4C**                 ELSE
193240001205     C* AGGIUNTA 'F'
193250140122    5C**   WTCP          IFEQ      'F'
193260140122     C**   WSVTCP        ANDEQ     *BLANKS
193270140122     C**                 MOVEL     'S'           §B4BAI
193280140122    5C**                 ENDIF
193290140122    4C**                 ENDIF
193300140122     C**                 CLEAR                   DSLV19
193310140122     C**                 MOVEL     DSBL4J        D19NT1
193320140122     c**                 movel     'T'           d19ftr
193330140122     C**                 MOVEL     BLPAAS        D19AAS
193340140122     C**                 MOVEL     BLPLNP        D19LNP
193350140122     C**                 MOVEL     BLPNRS        D19NRS
193360140122     C**                 MOVEL     BLPNSP        D19NSP
193370140122     C**                 MOVEL     'J'           D19TRC
193380140122     C**                 CLEAR                   D19NT2
193390140122     C**                 CALL      'FNLV19R'
193400140122     C**                 PARM                    DSLV19
193410140122   X3C**                 ELSE
193420001205     C* AGGIUNTA 'F' --> CREO RECORD "J"
193430140122    4C**   WTCP          IFEQ      'F'
193440140122     C**   WSVTCP        ANDEQ     *BLANKS
193450140122     C**                 CLEAR                   DSLV19
193460140122     C**                 CLEAR                   DSBL4J
193470140122     c**                 movel     'T'           d19ftr
193480140122     C**                 MOVEL     'S'           §B4BAI
193490140122     C**                 MOVEL     DSBL4J        D19NT1
193500140122     C**                 MOVEL     BLPAAS        D19AAS
193510140122     C**                 MOVEL     BLPLNP        D19LNP
193520140122     C**                 MOVEL     BLPNRS        D19NRS
193530140122     C**                 MOVEL     BLPNSP        D19NSP
193540140122     C**                 MOVEL     'J'           D19TRC
193550140122     C***                CLEAR                   D19NT2
193560140122     C**                 CALL      'FNLV19R'
193570140122     C***                PARM                    DSLV19
193580140122    4C***                ENDIF
193590140122    3C***                ENDIF
193600140122     C***                ENDSL
193610140122     C***                ENDIF
193620141201     c* se spedizione export non memorizzo nè il pin code se presente e nemmeno
193630141201     c* la particolarità consegna se prevede il PIN CODE
193640141201     c                   if        a_§ogntw='DPD' or
193650141201     c                             a_§ogntw='EEX' or
193660141201     c                             a_§ogntw='FED'
193670141201     c                   clear                   wpincode
193680141201     c                   if        §7rpincode='S'
193690141201     c                   clear                   vidgma
193700141201     c                   endif
193710141201     c                   endif
193720141201
193730940919     C                   MOVEL     VIDGGA        BLPGGA
193740940919     C                   MOVEL     VIDGMA        BLPGMA
193750141201
193760940919     C                   MOVEL     VIDGVA        BLPGVA
193770960208     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
193780960208     C* DELLE PARTICOLARITA' VARIE
193790970707     C     W2LN          IFEQ      'S'
193800960208     C                   MOVE      'D'           BLPGVA
193810960208     C                   ELSE
193820960208     C                   MOVE      ' '           BLPGVA
193830960208     C                   ENDIF
193840141201
193850141201
193860940919     C* C/ASSEGNO
193870051115    1C     ar9CAS        IFGT      0
193880940919     C     VIDGCA        ORNE      *BLANKS
193890051115     C                   MOVEL     BLPAAS        ar9AAS
193900051115     C                   MOVEL     BLPLNP        ar9LNP
193910051115     C                   MOVEL     BLPNRS        ar9NRS
193920051115     C                   MOVEL     BLPNSP        ar9NSP
193930051115     C                   MOVEL     VIDGCA        ar9GCA
193940051115     C                   MOVEL     dateu         ar9duv
193950940919     C*
193960051115     C     War9          IFEQ      'E'
193970051115     C                   UPDATE    Fiar9000
193980940926     C                   ELSE
193990051115     C                   WRITE     Fiar9000
194000940926     C                   ENDIF
194010940926     C*
194020940926     C                   ELSE
194030940926     C* SE C'ERA E ORA NON PIU' DELETO
194040051115     C     War9          IFEQ      'E'
194050051115     C                   DELETE    Fiar9000
194060940919     C                   ENDIF
194070940926     C                   ENDIF
194080900828     C*
194090941025     C* SE NO A BORDERO' METTO 99999 IN DATA BORDERO' E NUM.F.VIAGG
194100930628    1C     §1BFG4        IFEQ      'N'
194110900829     C                   MOVEL     DATEU         BLPDBR
194120900828     C                   MOVEL     *ALL'9'       BLPNFV
194130930628   X1C                   ELSE
194140930628    2C     *IN12         IFEQ      *ON
194150930628     C     *IN15         ANDEQ     *ON
194160930628     C     *IN12         OREQ      *OFF
194170930628     C                   MOVEL     *ZEROS        BLPDBR
194180930628     C                   MOVEL     *ZEROS        BLPNFV
194190930628    2C                   END
194200930628    1C                   END
194210910805     C  N12              MOVEL     *BLANKS       BLPFNS
194220910805     C   12              MOVEL     VIDFNS        BLPFNS
194230971212     C**
194240971215     C** SE BOLLA EXP/IMP SDI CON NUMERO AWB SCRITTO, LO MEMORIZZO
194250020211     c** SE BOLLA EXPORT FEDEX ASSEGNO IL NUMERO AWB
194260971217     C   12
194270971217     CAN 15
194280971217     CORN12              CLEAR                   DSBL4E
194290020213     c     A_§ogntw      ifeq      'FED'
194300020320     c     wawbini       andgt     *zeros
194310020211     C                   CLEAR                   DSBL4E
194320020228     c                   movel     wawbini       w0012a           12
194330020228     c* calcolo check digit
194340020228     c                   exsr      chkdgf
194350020228     c                   movel     w0012a        §b4erp
194360020211     C                   MOVEL     'A'           §B4EMA
194370020211     C                   MOVEL     'P'           §B4EAT
194380020212     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
194390051102     c* del ARS trk "F"
194400020208     c                   endif
194410081008    1C**   V6CAWB        IFEQ      0
194420081008     c**   A_§ogntw      andeq     'EUP'
194430971212     C* VEDO SE C'E' IL CONTATORE 19 - NUMERO AWB
194440081008     C***                CLEAR                   AAS
194450081008     C**                 Z-ADD     19            CNU
194460081008     C**                 Z-ADD     BLPTFP        COMLIN
194470081008     C**   KNUF          CHAIN     FLNUF01L                           30
194480081008    2C**   *IN30         IFEQ      *OFF
194490081008     C**                 ADD       1             NUFNUM
194500980623     C* SE SUPERA RANGE FINALE, RIPARTO DA QUELLO INIZIALE
194510081008     C**   NUFNUM        IFGT      NUFRFI
194520081008     C**                 Z-ADD     NUFRIN        NUFNUM
194530081008    6C**                 END
194540081008     C**                 UPDATE    FLNUF
194550081008     C**                 Z-ADD     NUFNUM        W0090
194560081008     C**                 MOVEL     §3IFAW        W0090
194570081008     C**   W0090         DIV       7             RISUL
194580081008     C**                 MVR                     RESTO
194590081008     C**                 MOVEL     W0090         W010A
194600081008     C**                 MOVE      RESTO         W010A
194610971217     C*
194620081008     C**                 CLEAR                   DSBL4E
194630081008     C**                 MOVEL     W010A         §B4ERP
194640081008     C**                 MOVEL     'A'           §B4EMA
194650081008     C**                 MOVEL     'P'           §B4EAT
194660971216     C* SE LA STAMPO IN IMMEDIATO METTO SUBITO LA S DI STAMPATO
194670081008    3C**   §1BFG6        IFEQ      'I'
194680971217     C*
194690081008     C**   §1BFG6        OREQ      'C'
194700081008     C**   §1BFG0        ANDEQ     'I'
194710971217     C*
194720081008     C**   §1BFG6        OREQ      'C'
194730081008     C**   §1BFG0        ANDEQ     'C'
194740081008     C**   §1BF11        ANDEQ     'I'
194750081008     C**                 MOVEL     'S'           §B4EST
194760081008     C**                 ELSE
194770081008     C**                 MOVEL     'N'           §B4EST
194780081008    3C**                 ENDIF
194790081008    2C**                 ENDIF
194800971212     C**
194810081008   X1C**                 ELSE
194820971217     C* IN MANUTENZIONE SOLO SE HO MODIFICATO IL NUMERO
194830971217     C*  ALTRIMENTI LASCIO QUELLO CHE C'E'
194840081008    2C**   V6CAWB        IFGT      0
194850980310     C* SOLO SE EXPORT SDI
194860081008     c**   A_§ogntw      ifeq      'EUP'
194870081008    4C**   SAVAWB        IFNE      V6CAWB
194880081008     C**   §B4EMA        OREQ      ' '
194890081008     C**                 CLEAR                   DSBL4E
194900081008     C**                 MOVEL     V6CAWB        §B4ERP
194910081008     C**                 MOVEL     'M'           §B4EMA
194920081008     C**                 MOVEL     'P'           §B4EAT
194930081008     C**                 MOVEL     'S'           §B4EST
194940081008    4C**                 ENDIF
194950081008    3C**                 ENDIF
194960081008    2C***                ENDIF
194970081008    1C**                 ENDIF
194980971230     C* SE MODIFICATA LA LNA E DIVENTATE ENTRAMBE IN ITALIA
194990060215     C*    AZZERO NUMERO AWB E CANCELLO Fiar4
195000971230    2C     *IN12         IFEQ      *ON
195010971230     C     *IN15         ANDEQ     *OFF
195020120302     C* PER LA LINEA DI PARTENZA VALE SOLO PER BRT
195030020211     c     §ogntw        ifne      'EEX'
195040020211     c     §ogntw        andne     'FED'
195050081008     c***  §ogntw        andne     'EUP'
195060020213     c     A_§ogntw      andne     'FED'
195070081008     c***  A_§ogntw      andne     'EUP'
195080020211     C                   MOVEL     'E'           WTRC
195090060215     C     KBLP4         DELETE    Fiar4000                           30
195100020211     C                   CLEAR                   §B4ERP
195110020211     c                   endif
195120971230    2C                   ENDIF
195130060216     C* SE C'E' NUMERO AWB SCRIVO RECORD E IN ar4
195140971212    1C     §B4ERP        IFNE      *BLANKS
195150971216     C     SAVAWB        ORNE      0
195160081008     c***  A_§ogntw      ifeq      'EUP'
195170081008     c     A_§ogntw      ifeq      'FED'
195180060215     C                   MOVEL     'T'           D19ftr
195190971212     C                   MOVEL     BLPAAS        D19AAS
195200971212     C                   MOVEL     BLPLNP        D19LNP
195210971212     C                   MOVEL     BLPNRS        D19NRS
195220971212     C                   MOVEL     BLPNSP        D19NSP
195230971212     C                   MOVEL     'E'           D19TRC
195240971212     C                   CLEAR                   D19NT1
195250971212     C                   MOVEL     DSBL4E        D19NT1
195260971212     C                   CLEAR                   D19NT2
195270971212     C                   CALL      'FNLV19R'
195280971212     C                   PARM                    DSLV19
195290020211     c                   endif
195300971212    1C                   ENDIF
195310031219      * se ho caricato il riferimento partner estero da FIVAT rcd 'C'
195320060216      * scrivo il Fiar4 rcd 'E'
195330031219    1c                   If        *In12 and *In15
195340080128     c                             and A_§ogntw<>'FED'
195350060215     c                   MOVEL     'T'           D19ftr
195360031219     C                   MOVEL     BLPAAS        D19AAS
195370031219     C                   MOVEL     BLPLNP        D19LNP
195380031219     C                   MOVEL     BLPNRS        D19NRS
195390031219     C                   MOVEL     BLPNSP        D19NSP
195400031219     C                   MOVEL     'E'           D19TRC
195410031219     C                   CLEAR                   D19NT1
195420031219     C                   MOVEL     wrifp         D19NT1
195430031219     C                   CLEAR                   D19NT2
195440031219     C                   CALL      'FNLV19R'
195450031219     C                   PARM                    DSLV19
195460031219    1c                   EndIf
195470141031     c* Memorizzo Pin Code se presente
195480141031    1c                   If        *In12 and *In15 and wPinCode<>*blanks
195490141031     c                   MOVEL     'T'           D19ftr
195500141103
195510141103     c                   clear                   dsbl4y
195520141103     C                   MOVEL     wPinCode      §b4pcd
195530141103
195540141031     C                   MOVEL     BLPAAS        D19AAS
195550141031     C                   MOVEL     BLPLNP        D19LNP
195560141031     C                   MOVEL     BLPNRS        D19NRS
195570141031     C                   MOVEL     BLPNSP        D19NSP
195580141031     C                   MOVEL     'Y'           D19TRC
195590141031     C                   CLEAR                   D19NT1
195600141103     c                   movel     dsbl4y        d19nt1
195610141031     C                   CLEAR                   D19NT2
195620141031     C                   CALL      'FNLV19R'
195630141031     C                   PARM                    DSLV19
195640141031    1c                   endif
195650991203      **
195660060216      ** SE EXPORT DPD CON NUMERO PARCEL SCRITTO, LO MEMORIZZO IN Fiar4
195670060509     c                   if        (*in12 and *in15) or *in12 = '0'
195690060509     C                   CLEAR                   DSBL4I
195710060509     c                   endif
195720991203      *
195730020319    1C     A_§OGNTW      IFEQ      'DPD'
195740060620     c*
195750991203      *
195760060616    2C     V7CNPR        IFne      *blanks
195940170920     c* imposto dsbl4i
195950060509     c                   clear                   dsbl4i
195970060509     C                   MOVEL     V7CNPR        §B4IPN
195980060616     c* tolgo il check digit dal parcel number se n. parcel lungo 12
195990060620     c                   if        %subst(§b4ipn:14:1) = *blanks
196000060509     c                   eval      %subst(§b4ipn:12:1)=' '
196010060620     c                   eval      §b4icd=%subst(v7cnpr:12:1)
196020060616     c                   else
196030060616     c* se parcel lungo 14 calcolo il check digit
196040060616     c                   clear                   trul28ds4
196050060616     c                   eval      i284cod=§b4ipn
196060060616     c                   call      'TRUL28R5'
196070060616     c                   parm                    trul28ds4
196080060616     c                   movel     o284ckd       §b4icd
196090060616     c                   endif
196091170928     c                   if        w_dpe='DP4'
196210060616     c                   movel     osie3dsrt     §b4ids
196220060616     c                   movel     osie3bidp     §b4ibi
196230060616     c                   movel     osie3ddep     §b4ida
196240060616     c                   move      isie3srv      §b4isc
196250061010     c                   movel     osie3iatad    §b4iat
196260061010     c                   movel     osie3ptyg     §b4ipy
196261170928     c                   else
196262170928     c                   movel     osid4dsort    §b4ids
196263170928     c                   movel     osid4bcid     §b4ibi
196264170928     c                   movel     osid4dstr     §b4ida
196265170928     c                   move      isid4sorc     §b4isc
196266170928     c                   movel     osid4iata     §b4iat
196267170928     c* nel nuovo driver il priority group non viene più passato
196268170928     c                   endif
196280991203      *
196290991203    2C                   ENDIF
196300991203    1C                   ENDIF
196310050228     c*
196320050228    1C     *in79         IFEQ      *on
196330070605    1C     A_§OGNTW      andne     'DPD'
196340060616    2C     v7cnpr        IFne      *blanks
196400060510     c* imposto dsbl4i
196410060616     c                   movel     v7cnpr        §b4ipn
196420060621    3c                   if        %subst(§b4ipn:14:1) = *blanks
196430060616     c                   eval      %subst(§b4ipn:12:1)=' '
196440060619     c                   eval      §b4icd=%subst(v7cnpr:12:1)
196450060621   x3c                   else
196460060616     c* se parcel lungo 14 calcolo il check digit
196470060616     c                   clear                   trul28ds4
196480060616     c                   eval      i284cod=§b4ipn
196490060616     c                   call      'TRUL28R5'
196500060616     c                   parm                    trul28ds4
196510060616     c                   movel     o284ckd       §b4icd
196520060621    3c                   endif
196530060621     c* destination sort
196540060621     c                   move      §oghb1        §b4ids
196550060621     c                   move      a_§ogdp1      §b4ida
196560060621    3c                   select
196570060628     c* immissione o bolla di reso
196580060628     c                   when      *in12='0' or blpfbr = 'S'
196590060621     C                   CLEAR                   PTYPE             2
196600060621     c                   if        blppkb>§3ilmp
196610060621     c                   move      101           §b4isc
196620060621     c                   eval      ptype='01'
196630060621     c                   else
196640060621     c                   move      136           §b4isc
196650060928     c                   eval      ptype='02'
196660060621     c                   endif
196670060628     c                   if        blpfbr='S'
196680060628     c                   move      300           §b4isc
196690060628     c                   endif
196700060621     c                   move      '%'           §b4ibi
196750060628     c* conferma da disk
196760060628     c                   when      *in12='1' and *in15='1'
196770160617     c                   if        savfpr='D'
196780160617     c                   eval      dblp01=§lpflo
196790160617     c                   move      §lpscd        §B4ISC
196800160916     c                   move      '%'           §b4ibi
196810160617     c                   else
196820060628     c                   move      §VATESCD      §B4ISC
196830060628     c                   move      §VATEbid      §b4ibi
196870160617     c                   endif
196880060621    3c                   endsl
196890050228    2C                   ENDIF
196900160218     c* FLAG TRADUTTORE
196910160218     c                   select
196920150916     c* flag traduttore se in Conferma da disk
196930160218     c                   when      *in12 and *in15
196940150916     c                   eval      dblp01=§lpflo
196950160218     c* Metto quello che ricevo da chiamante
196960150916     c                   eval      §B4TRD=§LPTRD
196970160218     c* se non ho ricevuto nulla e sono richiamata da pgm giacenze per
196980160218     c* bolla di reso metto "R" si tratta di bolla di recupero:
196990160218     c                   if        §b4trd=*blanks and §3arbl<>'R' and *in44
197000160218     c                             and blpfbr='S'
197010160218     c                   eval      §b4trd='R'
197020160218     c                   endif
197030160218     c* Immissione bolle: metto "M"=Manuale se non è bolla di recupero
197040160218     c                   when      not *in12
197050160218     c                   if        §3arbl<>'R'
197060160218     c                   eval      §b4trd='M'
197070160218     c                   endif
197080160218     c
197090160218     c                   endsl
197100050228    1C                   ENDIF
197110991203      *
197120991203      * SE MODIFICATA LA LNA E NON È PIÙ DPD AZZERO IL NUMERO PARCEL
197130060215      *  E CANCELLO Fiar4
197140991203    2C     *IN12         IFEQ      *ON
197150991203     C     *IN15         ANDEQ     *OFF
197160020319     C     A_§OGNTW      ANDNE     'DPD'
197170050228     c     *in79         andne     *on
197220060510     C                   MOVEL     'I'           WTRC
197230060510     C     KBLP4         DELETE    Fiar4000                           30
197232170915     C     Kpnd          delete(e) Fipnd000
197240060626     C                   CLEAR                   dsbl4i
197280991203    2C                   ENDIF
197282170921     c* DATI DPD (FIPND):
197283171005     c                   clear                   dpnddp4
197284171005     c                   clear                   dpnddp5
197285171005     c                   clear                   dpndflo
197286170915    2c                   if        savnpr<>*blanks
197288170921     c
197289170920    3c                   if        v7cnpr<>*blanks
197290170915     c     kpnd          chain     fipnd01l
197291170921    4c                   if        %found(fipnd01l)
197292170921     c                   if        pnddpe='DI4'
197293170921     c                   eval      dpnddi4 = pndetiu
197294170921     c                   eval      dpndflo = pndflo
197299170921     c                   endif
197300170920     c                   exsr      sr_riePND
197301170918     c                   update    fipnd000
197302170915    4c                   endif
197303170915   x3c                   else
197304170915     c     kpnd          delete(e) fipnd000
197305170915    3c                   endif
197306170915   x2c                   else
197307170915     c* record fipnd non presente: scrivo record se ho il numero parcel
197308170921     c                   if        v7cnpr<>*blanks
197309170915     c                   clear                   fipnd000
197310170915     c                   eval      PNDAAS  = blpaas
197311170915     c                   eval      PNDLNP  = blplnp
197312170915     c                   eval      PNDNRS  = blpnrs
197313170915     c                   eval      PNDNSP  = blpnsp
197314170927     c* data immissione
197315170927     c                   eval      PNDDIM  = dateu
197319170920     c                   exsr      sr_riePND
197326170920
197327170915     c                   write     fipnd000
197328170915     c                   endif
197329170915    2c                   endif
197330991203      *
197331060620      * SE C'E' NUMERO PARCEL SCRIVO RECORD "I" IN ar4
197570060620     c* Tipo record I
197580060510    1C     §B4IPN        IFNE      *BLANKS
197590060616     C     SAVNPR        ORNE      *blanks
197600060510     c*
197610060510     C                   MOVEL     'T'           D19ftr
197620060510     C                   MOVEL     BLPAAS        D19AAS
197630060510     C                   MOVEL     BLPLNP        D19LNP
197640060510     C                   MOVEL     BLPNRS        D19NRS
197650060510     C                   MOVEL     BLPNSP        D19NSP
197660060510     C                   MOVEL     'I'           D19TRC
197670060510     C                   MOVEL(P)  DSBL4I        D19NT1
197680060510     C                   CLEAR                   D19NT2
197690060510     C                   CALL      'FNLV19R'
197700060510     C                   PARM                    DSLV19
197710061106     c* se sono in conferma bolle import dpd scrivo depot su DPPDC
197720061106     c* se manca
197730061107     c                   if        §b4ipn<>*blanks and *in79  and *in12
197740061107     c                             and *in15
197750061106     c                   clear                   truldepds
197760061106     c
197770061106     c                   if        %subst(§b4ipn:14:1) <> *blanks
197780061106     c                   movel     §b4ipn        idepdpc
197790061106     c                   else
197800061106     c                   eval      idepdpc='0'+%subst(§b4ipn:1:3)
197810150918     c                   endif
197820150918     c* Memorizzo il depot solo se numerico
197830150918     c* (E' capitato un depot AA00 che è poi stato utilizzato erroneamente
197840150918     c*  per un parcel number di una bolla export dpd e il collo è poi stato
197850150918     c*  smarrito)
197860150918     c                   if        %check(digits:idepdpc)=0
197870061106     c                   call      'TRULDEPR'
197880061106     c                   parm                    truldepds
197890061106     c                   if        odeperr='1'
197900151112     c     idepdpc       chain     dppdc01l
197910151112     c                   if        %found(dppdc01l)
197920151112     c                   z-add     20401231      pdcdsc
197930151112     c                   z-add     dateu         pdcdtv
197940151112     c                   time                    pdcorv
197950151112     c                   update    dppdc000
197960151112     c                   else
197970061106     c                   clear                   dppdc000
197980061106     c                   eval      pdcdpc=idepdpc
197990151112     c                   z-add     19900101      pdcdde
198000151112     c******             z-add     dateu         pdcdde
198010061106     c                   z-add     20391231      pdcdsc
198020061106     c                   z-add     dateu         pdcdtv
198030061107     c                   time                    pdcorv
198040061106     c                   movel     'FNLS01R'     pdcpru
198050061106     c                   write     dppdc000
198060151112     c                   endif
198070061106     c                   endif
198080150918     c                   endif
198090061106     c                   endif
198100991214     C**
198110991214     C* SCRIVO IL NUMERO DI PARCEL ANCHE NELLE NOTE
198120991214     C*
198130050405     c* se import dpd non lo devo fare lo faccio solo per export
198140060616     c                   clear                   dpdsta
198150060616     c                   clear                   dpdsta14         27
198160050405    2c     *in79         ifeq      *off
198170060626     c     §b4ipn        ifne      *blanks
198190060616     c                   if        %subst(§b4ipn:14:1)=*blanks
198200060510     c                   movel     §b4ipn        dpdpar
198210060510     c                   move      §b4icd        dpdpar
198220991214     C                   MOVEL     DPD1          DPDS1
198230991214     C                   MOVEL     DPD2          DPDS2
198240991214     C                   MOVEL     DPD3          DPDS3
198250991214     C                   MOVEL     CDPD          DPDCOS
198260060616     c                   else
198270060616     c                   eval      dpdsta14=cdpd+%subst(§b4ipn:1:4)+
198280060616     c                             ' '+%subst(§b4ipn:5:10)
198290060616     c                   endif
198300060626     c                   endif
198310991217     C* IN MANUTENZIONE CONTROLLO SE LE NOTE SONO QUELLE MESSE IN AUTOM
198320991217     C*  DEL PARCEL
198330991217     C     *IN12         IFEQ      *ON
198340991217     C     *IN15         ANDEQ     *OFF
198350991217     C                   MOVEL     VIDNT1        W012A            12
198360991217     C*
198370991217     C     W012A         IFEQ      CDPD
198380991217     C                   CLEAR                   VIDNT1
198390991217     C                   ENDIF
198400991217     C                   ENDIF
198410991217     C*
198420060626     c                   if        dpdsta<>*blanks or dpdsta14<>*blanks
198430060626    3C     VIDNT1        IFEQ      *BLANKS
198440060626    4c                   if        dpdsta<>*blanks
198450991214     C                   MOVEL(P)  DPDSTA        VIDNT1
198460060616     c                   else
198470060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
198480060626    4c                   endif
198490060626   x3C                   ELSE
198500991214     C                   MOVEL     VIDNT1        VIDNT2
198510060626    4c                   if        dpdsta<>*blanks
198520991214     C                   MOVEL(P)  DPDSTA        VIDNT1
198530060616     c                   else
198540060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
198550060626    4c                   endif
198560060626    3C                   ENDIF
198570060626     c                   endif
198580050405    2c                   endif
198590991203    1C                   ENDIF
198600991117      *
198610010502      * SE BOLLA CON LNP DPD E NUM. DISTINTA NON IMPOSTATO DEVO:
198620991130      *  - RICAVARE IL NUMERO DISTINTA E MEMORIZZARLO IN RMA
198630000218      *  - CREARE IL FILE EVENTI DPD TRANNE PER BOLLE DI RECUPERO
198640060619     C     *IN79         IFEQ      *ON
198650160908     C     §3ARBL        andne     'R'
198660080304     C***  BLPRMA        ANDEQ     *BLANKS
198670060619     c* solo per parcel number lungo 14 continuo a scrivere n.distinta
198680080304     c                   if        %subst(§b4ipn:14:1)=*blanks
198690080304     c                             and blprma=*blanks
198700060619     C                   EXSR      SPEDPD
198710060619     C                   MOVEL     DPDBRC        BLPRMA
198720060619     c                   endif
198730160908     C***  §3ARBL        IFNE      'R'
198740060619     C                   EXSR      EVEDPD
198750160908     C***                ENDIF
198760060619     C                   ENDIF
198770010502     C*
198780010924      * MEMORIZZO IL RIF. ORM NEL RIF. MITTENTE ALFANUMERICO
198790010924      *  - SEMPRE SE QUELLO IN BOLLA E' VUOTO
198800010924      *  - SE ENTRAMBI PIENI SOLO SE IMPOSTATO L'APPOSITO FLAG SULL'ORM
198810010924      *  - MAI SE BOLLA DPD
198820040226if  1c                   If        worm = 'S' and
198830040226     c                             (Not *In79 or wrifm = *Off)
198840010924      *  PREPAGATO
198850010502    2C     PARTCH        IFEQ      'P'
198860010924      *
198870010502    3C     VIDMAG        IFNE      'S'
198880010924     C     BLPRMA        ANDEQ     *BLANKS
198890010502     C                   MOVEL     §RMRFA        BLPRMA
198900010502    3C                   ENDIF
198910010924      *
198920010502   X2C                   ELSE
198930010924      *  NO PREPAGATO
198940010502    3C     FLGFIT        IFNE      'S'
198950010924    4C     BLPRMA        IFEQ      *BLANKS
198960010502     C                   MOVEL     ORMRFA        BLPRMA
198970010924   X4C                   ELSE
198980010924    5C     ORMRFA        IFNE      *BLANKS
198990010924     C     §ORMFR        ANDEQ     'S'
199000010924     C                   MOVEL     ORMRFA        BLPRMA
199010010924    5C                   ENDIF
199020010924    4C                   ENDIF
199030010924    3C                   ENDIF
199040010924      *
199050010502    2C                   ENDIF
199060010924      *
199070010502    1C                   ENDIF
199080991214     C***
199090991214     C***  N O T E
199100060216     C                   MOVEL     'T'           D19ftr
199110991214     C                   MOVEL     BLPAAS        D19AAS
199120991214     C                   MOVEL     BLPLNP        D19LNP
199130991214     C                   MOVEL     BLPNRS        D19NRS
199140991214     C                   MOVEL     BLPNSP        D19NSP
199150991214     C                   MOVEL     VIDNT1        D19NT1
199160991214     C                   MOVEL     VIDNT2        D19NT2
199170991214     C     VIDNT1        IFNE      *BLANKS
199180991214     C     VIDNT2        ORNE      *BLANKS
199190991214     C                   MOVEL     '8'           D19TRC
199200991214     C                   CALL      'FNLV19R'
199210991214     C                   PARM                    DSLV19
199220991214     C                   ENDIF
199230991214     C**
199240991214     C* REIMPOSTO LE NOTE IN MANUTENZIONE
199250991214     C   12
199260991214     CANN15              MOVEL     D19NT1        VIDNT1
199270991214     C   12
199280991214     CANN15              MOVEL     D19NT2        VIDNT2
199290991214     C**
199300991214     C* IN MANUTENZIONE SE IL PGM MI RESTITUISCE LA 2 RIGA VUOTA,
199310991214     C* LA DELETO PERCHE' POTEVA PRIMA ESISTERE
199320991214     C   12
199330991214    1CANN15D19ERR        IFEQ      *BLANKS
199340991214     C     D19NT1        ANDNE     *BLANKS
199350991214     C     D19NT2        ANDEQ     *BLANKS
199360991214     C                   MOVEL     '9'           D19TRC
199370991214     C                   CLEAR                   D19NT1
199380991214     C                   CLEAR                   D19NT2
199390991214     C                   CALL      'FNLV19R'
199400991214     C                   PARM                    DSLV19
199410991214    1C                   ENDIF
199420991214     C* SE TORNATO CODICE DI ERRORE RICHIAMO IL PGM 2 VOLTE
199430991214     C* UNA VOLTA PER NOTA
199440991214    2C     D19ERR        IFNE      *BLANKS
199450991214    1C     *IN12         OREQ      *ON
199460991214     C     *IN15         ANDEQ     *OFF
199470991214     C     VIDNT1        ANDEQ     *BLANKS
199480991214     C     VIDNT2        ANDEQ     *BLANKS
199490991214     C* NOTA 1
199500991214     C                   MOVEL     '8'           D19TRC
199510991214     C                   MOVEL     VIDNT1        D19NT1
199520991214     C                   CLEAR                   D19NT2
199530991214     C                   CALL      'FNLV19R'
199540991214     C                   PARM                    DSLV19
199550991214     C* NOTA 2
199560991214     C                   MOVEL     '9'           D19TRC
199570991214     C                   MOVEL     VIDNT2        D19NT1
199580991214     C                   CLEAR                   D19NT2
199590991214     C                   CALL      'FNLV19R'
199600991214     C                   PARM                    DSLV19
199610991214    1C                   ENDIF
199620000508     C* DATI POSTE SOLO IN CONFERMA
199630140122     C**   *IN12         IFEQ      *ON
199640140122     C***  *IN15         ANDEQ     *ON
199650140122     C***  §ogntw        ANDEQ     'PPT'
199660000509     C* SE CE' IAS O XCO
199670140122     C***  §B4IAS        IFGT      0
199680140122     C**   §B4XCO        ORNE      ' '
199690140122     C**   §B4DSC        ORNE      *BLANKS
199700140122     C**                 CLEAR                   DSLV19
199710140122     C**                 MOVEL     'T'           D19ftr
199720140122     C**                 MOVEL     BLPAAS        D19AAS
199730140122     C**                 MOVEL     BLPLNP        D19LNP
199740140122     C**                 MOVEL     BLPNRS        D19NRS
199750140122     C**                 MOVEL     BLPNSP        D19NSP
199760140122     C**                 MOVEL     DSBL4J        D19NT1
199770140122     C**                 MOVEL     'J'           D19TRC
199780140122     C**                 CALL      'FNLV19R'
199790140122     C**                 PARM                    DSLV19
199800140122     C***                ENDIF
199810140122     C***                ENDIF
199820000623     C*
199830000623     C* SE ESISTE TABELLA 3Q, CREO RECORD VUOTO W
199840060217     c* Se sono in manutenzione aggiorno (azzero la data) solo se cambi
199850060217     c* ato codice
199860000623    1C     WES3Q         IFEQ      'S'
199870060217     c
199880060217     c                   if        *in12 = *off or *in15 = *on or
199890060217     c                             wksc <> savmit
199900000623     C*
199910060217     C                   CLEAR                   DSBL4W
199920060223     C                   CLEAR                   DSLV19
199930000623     C**
199940060217     C                   MOVEL     DSBL4W        d19nt1
199950060217     C                   MOVEL     BLPAAS        d19AAS
199960060217     C                   MOVEL     BLPLNP        d19LNP
199970060217     C                   MOVEL     BLPNRS        d19NRS
199980060217     C                   MOVEL     BLPNSP        d19NSP
199990060217     C                   MOVEL     'W'           d19TRC
200000060223     c                   movel     'T'           d19ftr
200010060217     c                   clear                   d19nt2
200020060217     c* se sono in manutenzione richiamo fnlv19r solo se cambiato codice
200030060217     C                   CALL      'FNLV19R'
200040060217     C                   PARM                    DSLV19
200050060217     c                   endif
200060000623     C*
200070000623   X1C                   ELSE
200080000623     C* SE ESISTEVA MA ADESSO NON ESISTE PIU' DEVO CANCELLARE IL RECORD
200090000623    2C     WBL4W         IFEQ      'E'
200100060223     c                   clear                   dslv19
200110060217     C                   clear                   d19nt1
200120060217     C                   MOVEL     BLPAAS        d19AAS
200130060217     C                   MOVEL     BLPLNP        d19LNP
200140060217     C                   MOVEL     BLPNRS        d19NRS
200150060217     C                   MOVEL     BLPNSP        d19NSP
200160060217     C                   MOVEL     'W'           d19TRC
200170060223     c                   movel     'T'           d19ftr
200180060217     c                   clear                   d19nt2
200190060217     C                   CALL      'FNLV19R'
200200060217     C                   PARM                    DSLV19
200210000623    2C                   ENDIF
200220000623    1C                   ENDIF
200230090325     C* Impostazione campi cliente/tariffa per tassazione porti assegnati
200240090805     c                   clear                   w_ar5ass
200250090325     c                   if        *in04
200260090325     c                   exsr      riewdwcli
200270091027     c                   select
200280091027     c                   when      flgfit<>'S' and ormpag='O'
200290090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
200300090806     c                                 %editc(ormksc:'X')
200310090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
200320090806     c                                 %subst(%editc(ormcor:'X'):1:7)
200330090804     c                   eval      w_ar5ass='T'
200340091027     c                   when      *in12 and *in15 and §lpass='T'
200350091027     c                   eval      w_ar5ass='T'
200360091027     c                   endsl
200370090325     c                   endif
200380091214     c* impostazione campo codice benefeiciario contrassegno
200390091214     c                   clear                   w_ar5cdi
200400091214     c                   select
200410091214     c                   when      wcassel2='X' and wwdwcas='S'
200420091214     c                   eval      w_ar5cdi=wcascor
200430091214     c                   when      *in12 and *in15 and §lpcdi>0
200440091214     c                   eval      w_ar5cdi=§lpcdi
200450091214     c                   endsl
200460090325     c*
200470010215     C* SE ATTIVATA PROCEDURA O.R.M. E NUMERO O.R.M. NON FITTIZIO LO
200480060215     C* MEMORIZZO SU Fiar4 TIPO RECORD "M"
200490060215      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
200500010925      * TIPO RECORD "Z" PER RITORNO VAS
200510010925    1C     WORM          IFEQ      'S'
200520010220     C     PARTCH        ANDNE     'P'
200530010228     C     WORM          OREQ      'S'
200540010228     C     VIDMAG        ANDNE     'S'
200550010713     C     §3ARBL        ANDNE     'R'
200560010215     C                   CLEAR                   DSLV19
200570060215     C                   MOVEL     'T'           D19ftr
200580010215     C                   MOVEL     BLPAAS        D19AAS
200590010215     C                   MOVEL     BLPLNP        D19LNP
200600010215     C                   MOVEL     BLPNRS        D19NRS
200610010215     C                   MOVEL     BLPNSP        D19NSP
200620010925    2C     FLGFIT        IFNE      'S'
200630010228     C     PARTCH        OREQ      'P'
200640010215     C  N12
200650010215     COR 12
200660010215     CAN 15              CLEAR                   DSBL4M
200670010925    3C     PARTCH        IFEQ      'P'
200680010228     C                   Z-ADD     §RMPOO        §B4POE
200690010228     C                   Z-ADD     §RMNSO        §B4NSR
200700010228     C                   Z-ADD     §RMNOO        §B4NOR
200710010228     C                   Z-ADD     §RMNRO        §B4NRV
200720010925   X3C                   ELSE
200730010215     C                   Z-ADD     WOPOE         §B4POE
200740010222     C                   Z-ADD     WONSR         §B4NSR
200750010222     C                   Z-ADD     WONOR2        §B4NOR
200760010215     C                   Z-ADD     WONRV         §B4NRV
200770010925    3C                   ENDIF
200780090325     c*
200790090325     c                   if        *in04
200800090325     c                   eval      §b4clg=wclg
200810090325     c                   endif
200820151104     c* Se bolla abbinata ad orm manuale
200830151104     c* memorizzo che sarà da addebitare l'orm telefonico, l'addebito
200840151104     c* Se ad un ORM abbino più spedizioni SOLO su una bisogna
200850151104     c* memorizzare l'addebito
200860151104     c                   exsr      sr_b4ado
200870151117     c                   eval      §b4ado=w_§b4ado
200880010221     C*
200890010925     C                   MOVEL     'M'           D19TRC
200900010215     C                   MOVEL     DSBL4M        D19NT1
200910010215     C                   CALL      'FNLV19R'
200920010215     C                   PARM                    DSLV19
200930060216      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
200940010925      * TIPO RECORD "Z" PER RITORNO VAS
200950121123    3c                   if        not *in12 or *in15
200960121123    4C     §ORMKS        IFEQ      'S'
200970040319     C     ORMKSC        ANDGT     *ZEROS
200980010925     C                   MOVEL     'Z'           D19TRC
200990010925     C                   CLEAR                   D19NT1
201000010925     C                   CLEAR                   D19NT2
201010010925     C                   CLEAR                   D19ERR
201020010927     C                   CLEAR                   DSBL4Z
201030010925     C                   MOVEL     ORMKSC        §B4OKC
201040010925     C                   MOVEL     DSBL4Z        D19NT1
201050010925     C                   CALL      'FNLV19R'
201060010925     C                   PARM                    DSLV19
201070121123    4C                   ENDIF
201080121123   x3c                   else
201090121122     c* in manutenzione verifico se modificare cancellare o aggiungere ar4 trk Z
201100130219     c* . . . se situazione invariata non faccio nulla
201110130219     c                   clear                   wnoZ              1
201120130219    4c                   if        wesar4z='S' and §ormks='S'
201130130219     c                             and wkscz=ormksc
201140130219     c                   eval      wnoZ='N'
201150130219    4c                   endif
201160130219    4c                   if        wnoz=*blanks  and
201170130219     c                             (wesar4z='S' and wtrasmz='N' or
201180130219     c                             (§ormks='S' and ormksc>*zeros))
201190121123     C                   MOVEL     'Z'           D19TRC
201200121123     C                   CLEAR                   D19NT1
201210121123     C                   CLEAR                   D19NT2
201220121123     C                   CLEAR                   D19ERR
201230121123     C                   CLEAR                   DSBL4Z
201240121122
201250121123    5c                   select
201260121123     c* era presente tipo record "Z"  ma ora non più : cancella se non trasmesso
201270121123     c                   when      wesar4z='S' and §ormks<>'S'
201280121126     c* era presente tipo record "Z" prima e adesso ma cliente diverso: aggiorna
201290121126     c* a sflagga per la ritrasmissione
201300121123     c                   when      wesar4z='S' and §ormks='S' and ormksc>*zeros
201310121123     c                             and wkscz<>ormksc
201320121123     C                   MOVEL     ORMKSC        §B4OKC
201330121126     C                   clear                   §B4dtr
201340121123     C                   MOVEL     DSBL4Z        D19NT1
201350121123     c* non era presente tipo record "Z" e ora si: scrive nuovo "Z"
201360121123     c                   when      wesar4z<>'S'
201370121123     C                   MOVEL     ORMKSC        §B4OKC
201380121123     C                   MOVEL     DSBL4Z        D19NT1
201390121123    5c                   endsl
201400121123     C                   CALL      'FNLV19R'
201410121123     C                   PARM                    DSLV19
201420121123    4c                   endif
201430121123    3c                   endif
201440010925      *--
201450010925   X2C                   ELSE
201460010925      *--
201470010215     C* SE SONO IN MANUTENZIONE E N. O.R.M. FITTIZIO DEVO CANCELLARE
201480060215     C* ar4 CON TIPO RECORD "M" E "Z" SE PRESENTI
201490010925    3C     *IN12         IFEQ      *ON
201500010215     C     *IN15         ANDEQ     *OFF
201510010925     C                   MOVEL     'M'           D19TRC
201520010215     C                   CALL      'FNLV19R'
201530010215     C                   PARM                    DSLV19
201540121127     c* Record "Z" lo cancello solo se non trasmesso.
201550121127     c* Se invece era stato trasmesso non lo cancello per mantenere traccia di
201560121127     c* quello che era stato fatto
201570121127     c                   if        wesar4z='S' and wtrasmz='N'
201580010925     C                   MOVEL     'Z'           D19TRC
201590010925     C                   CALL      'FNLV19R'
201600010925     C                   PARM                    DSLV19
201610121127     c                   endif
201620040319      * cancello anche il record 'A'
201630040319      * ma solo se prima dell'ORM fittizio era impostato un ORM reale
201640040319      * e lo so testando il flag wmodorm impostato nella ctrorm
201650040319if  4c                   If        wmodorm = *On
201660040319     c                   Movel     'A'           d19trc
201670040319     c                   Call      'FNLV19R'
201680040319     c                   Parm                    dslv19
201690040319e   4c                   EndIf
201700010925    3C                   ENDIF
201710010925      *
201720010925    2C                   ENDIF
201730010925    1C                   ENDIF
201740090325     c*
201750090325     c* memorizzo ksc/ctr per p.assegnati
201760090325     c                   if        *in04
201770090325     c                   Clear                   dsbl4a
201780090325     c                   Clear                   dslv19
201790090325     C                   MOVEL     'T'           D19ftr
201800090325     C                   MOVEL     BLPAAS        D19AAS
201810090325     C                   MOVEL     BLPLNP        D19LNP
201820090325     C                   MOVEL     BLPNRS        D19NRS
201830090325     C                   MOVEL     BLPNSP        D19NSP
201840090325     c                   Movel     'A'           d19trc
201850090327     c                   if        wcliksc>0
201860090327     c                   z-add     wcliksc       §b4aks
201870090326     C                   IF        wclictr<>*blanks
201880090325     c                   move      wclictr       §b4act
201890090325     c                   endif
201900090325     c                   exsr      sr_fncls
201910090325     c                   move      wclsflo8      §b4af1
201920090325     c                   Movel     dsbl4a        d19nt1
201930090325     c                   Call      'FNLV19R'
201940090325     c                   Parm                    Dslv19
201950090325     c                   endif
201960090325     c                   endif
201970110706     c* memorizzo CUP/CIG se presenti
201980110706     c                   if        wcupcup<>*blanks or wcupcig<>*blanks
201990110706     c                   Clear                   dsbl44
202000110706     c                   Clear                   dslv19
202010110706     C                   MOVEL     'T'           D19ftr
202020110706     C                   MOVEL     BLPAAS        D19AAS
202030110706     C                   MOVEL     BLPLNP        D19LNP
202040110706     C                   MOVEL     BLPNRS        D19NRS
202050110706     C                   MOVEL     BLPNSP        D19NSP
202060110706     c                   Movel     '4'           d19trc
202070110706     c                   movel     wcupcup       §b44cup
202080110706     c                   movel     wcupcig       §b44cig
202090110706     c                   Movel     dsbl44        d19nt1
202100110706     c                   Call      'FNLV19R'
202110110706     c                   Parm                    Dslv19
202120110706     c                   else
202130110706     c                   if        *in12 and not *in15
202140110706     c                   Clear                   dslv19
202150110706     C                   MOVEL     'T'           D19ftr
202160110706     C                   MOVEL     BLPAAS        D19AAS
202170110706     C                   MOVEL     BLPLNP        D19LNP
202180110706     C                   MOVEL     BLPNRS        D19NRS
202190110706     C                   MOVEL     BLPNSP        D19NSP
202200110706     c                   Movel     '4'           d19trc
202210110706     c                   Call      'FNLV19R'
202220110706     c                   Parm                    Dslv19
202230110706     c                   endif
202240110706     c                   endif
202250150128
202260150128     c* Località normalizzata
202270150210     c                   if        blplod<>wLocNorm
202280150210     c                             or (*in12 and not *in15)
202290150128     c                   Clear                   dslv19
202300150128     C                   MOVEL     'T'           D19ftr
202310150128     C                   MOVEL     BLPAAS        D19AAS
202320150128     C                   MOVEL     BLPLNP        D19LNP
202330150128     C                   MOVEL     BLPNRS        D19NRS
202340150128     C                   MOVEL     BLPNSP        D19NSP
202350150128     c                   Movel     'X'           d19trc
202360150210     c                   if        blplod<>wlocnorm
202370150128     c                   movel     wLocNorm      d19nt1
202380150210     c                   else
202390150210     c                   clear                   d19nt1
202400150210     c                   endif
202410150128     c                   Call      'FNLV19R'
202420150128     c                   Parm                    Dslv19
202430150210     c                   endif
202440150128
202450130305     c* F I A R 8
202460130924     c                   eval      aggioAr8='S'
202470130924     c                   exsr      sr_gesar8
202480130305     c* F I A R 5
202490030805      * se bolla con bancali - part. varia "B"
202500021218      * scrivo o aggiorno il file estensione FIAR500F record "BAN"
202510030704     c                   If        %subst(VidGva:1:1) = 'B'
202520021218     c                   Clear                   DAr5Ban
202530030704     c                   Eval      Kar5Trd = 'BAN'
202540021218     c     KFiar5        Chain     Fiar501l
202550021218     c                   Move      Dateu         Ar5Dac
202560021218     c                   Movel     W0140         Ar5Orc
202570021218     c                   Movel     VidTba        §Ar5Tba
202580021218     c                   Eval      §Ar5Nba = VidNba
202590021218     c                   Movel     VidTb2        §Ar5Tb2
202600021218     c                   Eval      §Ar5Nb2 = VidNb2
202610021218     c                   Movel(p)  DAr5Ban       Ar5Uni
202620030704     c                   ExSr      Sr_wrtFiar5
202630021218     c                   EndIf
202640030805      * se bolla con bancali - part. varia "O"
202650030704      * scrivo o aggiorno il file estensione FIAR500F record "BNB"
202660030730      * se non richiamto da giacenze
202670031125     c                   If        %subst(VidGva:1:1) = 'O'
202680030704     c                   Clear                   DAr5Bnb
202690030704     c                   Eval      Kar5Trd = 'BNB'
202700030704     c     KFiar5        Chain     Fiar501l
202710030704     c                   Move      Dateu         Ar5Dac
202720030704     c                   Movel     W0140         Ar5Orc
202730030704     c                   Movel     VidTba        §Ar5bTba
202740030704     c                   Eval      §Ar5bNba = VidNba
202750030704     c                   Movel     VidTb2        §Ar5bTb2
202760030704     c                   Eval      §Ar5bNb2 = VidNb2
202770030704     c                   Eval      §Ar5bCor = w03cor
202780030704     c                   Eval      §Ar5bCsf = w03csf
202790030704     c                   Movel(p)  DAr5Bnb       Ar5Uni
202800030704     c                   ExSr      Sr_wrtFiar5
202810030704     c                   EndIf
202820030805      * se bolla con paricolarità consegna "RC"
202830030805      * scrivo o aggiorno il file estensione FIAR500F record "RCC"
202840030912      * solo se non sono richiamata da giacenze
202850100604     c**                 If        VidGma = 'RC' and
202860100604     c                   If        §7rRC  = 'S'  and
202870030912     c                             savfpr <> 'G' and savfpr <> 'P'
202880150302     c                             and savfpr <> 'B'
202890091124      * Aggiorno l'ORM se sono in immissione
202900091124     c                   If        Not *In12 or
202910091124     c                             (*In12 and *In15)
202920091221      * oppure aggiornamento ed inserito "RC"
202930100604     c                             or (*in12 and Not *in15 and w7rRC <> 'S')
202940091124     c                   Eval      wope = 'A'
202950091124     c                   ExSr      Sr_Ricorm
202960030805     c                   Clear                   DAr5Rcc
202970030805     c                   Eval      Kar5Trd = 'RCC'
202980030805     c     KFiar5        Chain     Fiar501l
202990030805     c                   Move      Dateu         Ar5Dac
203000030805     c                   Movel     W0140         Ar5Orc
203010030805     c                   Eval      §Ar5rPoe = savOrmPoe
203020030805     c                   Eval      §Ar5rNsr = savOrmNsr
203030030805     c                   Eval      §Ar5rNor = savOrmNor
203040030805     c                   Eval      §Ar5rNrv = savOrmNrv
203050030805     c                   Movel(p)  DAr5Rcc       Ar5Uni
203060030805     c                   ExSr      Sr_wrtFiar5
203070091221     c                   EndIf
203080030805     c                   EndIf
203090031113      * Se inseriti il referente o il n. di telefono devo memorizzarli
203100031113      * nel FIAR500F record "GEN"
203110040610      * Idem per tipo merce v-valore
203120090804      * Idem se bolla in assegnato con triangolazione
203130110527      * 27/05/11 Ci sarà sempre il record GEN, quindi chaino sempre e scrivo o
203140110527      *          aggiorno
203150110527if  1c****               If        VidRef <> *Blanks or VidTel <> *Blanks
203160110527     c****                         or vidbva <> *blanks  or w_ar5ass='T'
203170110527     c****                         or w_ar5tcp<>*blanks or w_ar5tic<>*blanks
203180110527     c****                         or ar9tic<>*blanks or
203190110527     c****                         w_ar5cdi>0 or not *in12 or *in15
203200031113     c                   Clear                   DAr5Gen
203210031113     c                   Eval      Kar5Trd = 'GEN'
203220031113     c     KFiar5        Chain     Fiar501l
203230031114if  2c                   If        Not %Found(Fiar501l)
203240160225     c***                Move      Dateu         Ar5Dac
203250160225     c***                Movel     W0140         Ar5Orc
203260160225     c                   eval      ar5dac=%dec(%date())
203270160225     c                   eval      ar5orc=%dec(%time())
203280110527     c                   eval      §ar5bpru=knmus
203290110527     c                   eval      §ar5bnmtd=knmtd
203300031114     c                   Eval      §Ar5Ref = VidRef
203310031114     c                   Eval      §Ar5Teld = VidTel
203320140416     c* se numero di telefono vuoto ma è presente l'sms, quest'ultimo lo copio
203330140416     c* anche in §arteld
203340150213     c***                if        §ar5teld=*blanks
203350150213     c***                eval      §Ar5Teld = wsms
203360150213     c***                endif
203370040610     c                   Eval      §Ar5bva = Vidbva
203380090804     c                   Eval      §Ar5ass = w_ar5ass
203390091001     c                   Eval      §Ar5tcp = w_ar5tcp
203400091001     c                   Eval      §Ar5tic = w_ar5tic
203410091104     c                   Eval      §Ar5tici =ar9tic
203420091214     c                   if        w_ar5cdi>0
203430091214     c                   Eval      §Ar5CDI  =%editc(w_ar5cdi:'X')
203440091119     c                   else
203450091119     c                   clear                   §ar5cdi
203460091118     c                   endif
203470130308     c                   eval      §ar5alx=w_allx
203480130408     c                   eval      §ar5alm=w_allm
203490130417     c                   eval      §ar5als=w_alls
203500140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
203510140407     c* nazione mittente italia
203520140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
203530140407     c                             blpnzm=*blanks
203540140403     c                   eval      §AR5PK2='S'
203550140403     c                   else
203560140403     c                   clear                   §AR5PK2
203570140403     c                   endif
203580160225     c                   if        w_aDpd='S'
203590160225     c                   eval      §ar5fdpd='S'
203600160225     c                   endif
203610031113     c                   Movel(p)  DAr5Gen       Ar5Uni
203620031113     c                   ExSr      Sr_wrtFiar5
203630031114   x2c                   Else
203640040610     c                   movel     ar5uni        DAr5Gen
203650031114     c                   Eval      §Ar5Ref = VidRef
203660031114     c                   Eval      §Ar5Teld = VidTel
203670040610     c                   eval      §ar5bva = vidbva
203680090804     c                   Eval      §Ar5ass = w_ar5ass
203690091001     c                   Eval      §Ar5tcp = w_ar5tcp
203700091001     c                   Eval      §Ar5tic = w_ar5tic
203710091104     c                   Eval      §Ar5tici =ar9tic
203720091214     c                   if        w_ar5cdi>0
203730091214     c                   Eval      §Ar5cdi  =%editc(w_ar5cdi:'X')
203740091119     c                   else
203750091119     c                   clear                   §ar5cdi
203760091118     c                   endif
203770140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
203780140407     c* nazione mittente italia
203790140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
203800140407     c                             blpnzm=*blanks
203810140403     c                   eval      §AR5PK2='S'
203820140403     c                   else
203830140403     c                   clear                   §AR5PK2
203840140403     c                   endif
203850031113     c                   Movel(p)  DAr5Gen       Ar5Uni
203860031113     c                   Update    Fiar5000
203870031114    2c                   EndIf
203880110527    1c****               EndIf
203890130918     c* Impostazione campo §ar5mmp - "S"=Invio mail per avviso merce partita
203900130923     c* In conferma bolle dipende da quello che ho ricevuto nel vat
203910130923    1c                   if        *in12 and *in15
203911170831     c* Se per il cliente è previsto il blocco totale non memorizzo i contatti
203912170831     c* ricevuti
203913170831     c                   if        §CliBlkAlr='T'
203914170831     c                   clear                   wsms
203915170831     c                   clear                   wemdest
203916170831     c                   endif
203920130918     c                   clear                   wmmp_ar5
203930130923    2c                   if        wemdest <> *blanks  and
203940170428     c                             (wmmp<>'N' or (§ar5alm='S' and
203950170428     c                                            a_§ogntw<>'DPD' and
203960170428     c                                            a_§ogntw<>'EEX' and
203970170428     c                                            a_§ogntw<>'FED' ))
203980170428
203990130918     c                   eval      wmmp_ar5='S'
204000130923    2c                   endif
204010130923   x1c                   else
204020130923     c* In manutenzione bolle se eliminato indirizzo email abblenco campo per
204030130923     c* invio mail per avviso merce partita
204040130923    2c                   if        *in12 and not *in15
204050130923     c                             and wemdest=*blanks
204060130923     c                   clear                   wmmp_ar5
204070130923    2c                   endif
204080130923    1c                   endif
204090140424     c* Pulizia fla invo sms merce partita se manca numero cell.
204100160126     c* oppure se già previsto invio della mail purchè non sia espressamente
204110160126     c* richiesto il doppio invio (mail+sms) come da tab.cli
204120140424     c                   if        wsms=*blanks
204130160126     c                             or (wmmp_ar5='S' and §cliemsms<>'S')
204140140424     c                   clear                   wsmp
204150140424     c                   endif
204160161220     c* Se presenti blocchi per l'avviso di affidamento spedizione
204170161220     c* clearo campi relativi
204180170428     c* lo faccio anche se sono in manutenzione perchè potrebbe essere cambiata
204190170428     c* la lna da non EEX a EEX e in questo caso devo ricontrollare perchè
204200170428     c* l'addebito in questo caso potrebbe essere bloccato
204210170428     c***                if        *in12 and *in15
204220170428     c                   if        *in12
204230161220     c                   if        wsmp<>*blanks
204240161220     c                             or wmmp_ar5<>*blanks
204250161220     c                   clear                   fnlv84ds
204260161220     c                   eval      ILV84LNP=blplnp
204270161220     c                   eval      ILV84LNA=blplna
204280161220     c                   eval      ILV84TFP=blptfp
204290161220     c                   eval      ILV84TFA=blptfa
204300161220     c                   eval      ILV84TSP=blptsp
204310161220     c                   eval      ilv84drf=blpdsp
204320161220     c                   call      'FNLV84R'
204330161220     c                   parm                    fnlv84ds
204340170830     c                   if        olv84esito='1'
204350161220     c                   clear                   wsmp
204360161220     c                   clear                   wmmp_ar5
204370170421     c                   endif
204371170830     c                   if        *in15 and §cliblkalr<>*blank
204375170830     c                   clear                   wsmp
204376170830     c                   clear                   wmmp_ar5
204377170830     c                   endif
204380161220     c                   endif
204390161220     c                   endif
204400110512      * Indirizzo email destinatario
204410110512      * scrivo o aggiorno il file estensione FIAR500F record "EMD"
204420130315     c                   If        wemdest <> *blanks  or wsms<>*blanks
204430110512     c                   Clear                   DAr5emd
204440110512     c                   Eval      Kar5Trd = 'EMD'
204450110512     c     KFiar5        Chain     Fiar501l
204460110613if  2c                   If        Not %Found(Fiar501l)
204470110512     c                   Move      Dateu         Ar5Dac
204480110512     c                   Movel     W0140         Ar5Orc
204490110512     c                   Movel     wemdest       §Ar5eml
204500130315     c                   movel     wsms          §ar5tel
204510130315     c                   movel     wsmp          §ar5smp
204520130918     c                   movel     wmmp_ar5      §ar5mmp
204530110512     c                   Movel(p)  DAr5emd       Ar5Uni
204540110512     c                   ExSr      Sr_wrtFiar5
204550110613     c                   else
204560110613     c                   movel     ar5uni        DAr5emd
204570110613     c                   Movel     wemdest       §Ar5eml
204580130315     c                   movel     wsms          §ar5tel
204590130315     c                   movel     wsmp          §ar5smp
204600130918     c                   movel     wmmp_ar5      §ar5mmp
204610111012     c                   Movel(p)  DAr5Emd       Ar5Uni
204620110613     c                   Update    Fiar5000
204630110613     c                   endif
204640110512     c                   EndIf
204650040610      * Se non sono inseriti il referente e il n. di telefono e v-valore
204660031114      * e sono in manutenzione cancello il FIAR500F record "GEN"
204670110527if  1c****               If        *In12 and Not *In15 and
204680110527     c*****                        VidRef = *Blanks and VidTel = *Blanks
204690110527     c*****                        and vidbva = *blanks
204700110527     c*****                        and w_ar5ass=*blanks
204710110527     c******                       and w_ar5tcp=*blanks
204720110527     c******                       and w_ar5tic=*blanks
204730110527     c******                       and ar9tic=*blanks
204740110527     c*****                        and w_ar5cdi=0
204750110527     c*****              Eval      Kar5Trd = 'GEN'
204760110527     c**** KFiar5        Chain     Fiar501l
204770110527     c****               If        %Found(Fiar501l)
204780110527     c****               Delete    Fiar5000
204790110527     c****               EndIf
204800110527    1c****               EndIf
204810030805      * se sono in manutenzione bolla e non c'è la particolarità
204820021218      * varie "B" controllo se c'è il record in FIAR500F record "BAN"
204830021218      * se c'è è da cancellare
204840030127     c                   If        *In12 and Not *In15 and
204850030704     c                             %Subst(BlpGva:1:1) <> 'B'
204860030704     c                   Eval      Kar5Trd = 'BAN'
204870021218     c     KFiar5        Chain     Fiar501l
204880021218     c                   If        %Found(Fiar501l)
204890021218     c                   Delete    Fiar5000
204900021218     c                   EndIf
204910021218     c                   EndIf
204920030805      * se sono in manutenzione bolla e non c'è la particolarità
204930030704      * varie "O" controllo se c'è il record in FIAR500F record "BNB"
204940030704      * se c'è è da cancellare
204950030704     c                   If        *In12 and Not *In15 and
204960030704     c                             %Subst(BlpGva:1:1) <> 'O'
204970030704     c                   Eval      Kar5Trd = 'BNB'
204980030704     c     KFiar5        Chain     Fiar501l
204990030704     c                   If        %Found(Fiar501l)
205000030704     c                   Delete    Fiar5000
205010030704     c                   EndIf
205020030704     c                   EndIf
205030030807      * se sono in manutenzione bolla e non c'è la particolarità
205040030807      * consegna "RC" controllo se c'è il record in FIAR500F record "RCC"
205050030807      * se c'è è da cancellare
205060030807     c                   If        *In12 and Not *In15 and
205070100604     c                             §7rRC  <> 'S'
205080100604     c***                          BlpGma <> 'RC'
205090030807     c                   Eval      Kar5Trd = 'RCC'
205100030807     c     KFiar5        Chain     Fiar501l
205110030807     c                   If        %Found(Fiar501l)
205120030807     c                   Delete    Fiar5000
205130030807     c                   EndIf
205140030807     c                   EndIf
205150110512      * In msanutenzine cancello fiar5 rcd EMD se è stato eliminato
205160150213if  1c*                  If        *In12 and Not *In15 and
205170150213     c*                            wemdest = *blanks  and atremd=*blanks
205180150213     c*                            and wsms=*blanks
205190150213     c*                  Eval      Kar5Trd = 'EMD'
205200150213     c*    KFiar5        Chain     Fiar501l
205210150213     c*                  If        %Found(Fiar501l)
205220150213     c*                  Delete    Fiar5000
205230150213     c*                  EndIf
205240150213    1c*                  EndIf
205250061213     c*
205260061213     C                   CLEAR                   WABLT
205270071221     C                   CLEAR                   WAgglna           1
205280071221    0c                   if        *in12 and not *in15
205290071221   0Ac                   if        §1bfg6='C' and savlna<>vidlna and
205300071221     c                             §clidkb='S'
205310071221     c                   eval      wagglna='S'
205320071221  x0Ac                   else
205330071221     C*  12
205340071221    1C*ANN15BLPFNS        IFEQ      ' '
205350071221    1c     blpfns        ifeq      ' '
205360061213     C     BLPNCD        ANDNE     0
205370061213     C     §1BFG8        ANDNE     'N'
205380061213     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
205390061213     C     §1BFG8        OREQ      'N'
205400061213     C**
205410061213     C* VEDO SE CANCELLARE LE SPUNTE ENTRATA:
205420061213     C* 1) SE FG8 = N SEMPRE
205430061213     C* 2) SE MODIFICATA LA LNA SEMPRE
205440061213     C* 3) SE AUMENTATO IL NUMERO DEI COLLI SOLO SE FG6 =D O I
205450061213     C* 4) SE DIMINUITO IL NUMERO DEI COLLI SOLO PER GLI ULTIMI
205460061213     C                   MOVEL     'S'           WDELBR            1
205470061213     C                   MOVEL     'S'           WABLT             1
205480061213    2C                   SELECT
205490061213     C     §1BFG8        WHENEQ    'N'
205500061213     C     SAVLNA        ORNE      VIDLNA
205510061213     C                   Z-ADD     99999         WCONTC            5 0
205520061213     C*
205530061213     C     SAVNCL        WHENLT    VIDNCL
205540061213     C     §1BFG6        ANDEQ     'D'
205550061213     C     SAVNCL        ORLT      VIDNCL
205560061213     C     §1BFG6        ANDEQ     'I'
205570061213     C                   Z-ADD     99999         WCONTC            5 0
205580061213     C*
205590061213     C     SAVNCL        WHENGT    VIDNCL
205600061213     C     §1BFG6        ANDEQ     'D'
205610061213     C     SAVNCL        ORGT      VIDNCL
205620061213     C     §1BFG6        ANDEQ     'I'
205630061213     C                   CLEAR                   WCONTC
205640061213     C     SAVNCD        WHENNE    BLPNCD
205650061213     C     SAVNCA        ORNE      BLPNCA
205660061213     C                   MOVEL     'N'           WDELBR            1
205670061213   X2C                   OTHER
205680061213     C                   MOVEL     'N'           WDELBR            1
205690061213     C                   MOVEL     'N'           WABLT
205700061213    2C                   ENDSL
205710061213    1c                   endif
205720071221   0Ac                   endif
205730071221    0c                   endif
205740061213     c* In manutenzione bolle , se riscrivo  fnblt devo clearare blpncr/ncp
205750061213    1c                   if        *in12 and not *in15
205760061213    2c                   if        wablt='S'
205770061213     c                   clear                   blpncr
205780061213     c                   clear                   blpncp
205790061213     c                   clear                   blpvlc
205800061213     c                   clear                   blppkc
205810061213   x2c                   else
205820061213     c* Se già calcolato volume cml devo reimpostarlo su VLF
205830061213    3c                   if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
205840061213     c                   clear                   dslv20
205850061213     C                   MOVEL     'P'           D20TBO
205860061213     C                   MOVEL     'C'           D20TVL
205870061213     c                   movel     'L'           d20tla
205880061213     C                   MOVEL     BLPvlc        D20vlu
205890061213     C                   MOVEL     BLPncr        D20ncr
205900061213     C                   MOVEL     BLPFVF        D20FVF
205910061213     C                   MOVEL     BLPVLF        D20VLF
205920061213     C                   MOVEL     BLPFVB        D20FVB
205930061213     C                   MOVEL     BLPVLB        D20VLB
205940061213     C                   MOVEL     BLPAAS        D20AAS
205950061213     C                   MOVEL     BLPLNP        D20LNP
205960061213     C                   MOVEL     BLPNRS        D20NRS
205970061213     C                   MOVEL     BLPNSP        D20NSP
205980061213     C                   MOVEL     BLPCBO        D20CBO
205990061213     C                   MOVEL     BLPNCL        D20NCL
206000061213    4C     BLPDBR        IFGT      *ZEROS
206010061213     C                   MOVE      BLPDBR        D20DTE
206020061213     C                   ELSE
206030061213     C                   MOVE      BLPMGS        D20DTE
206040061213     C                   MOVEL     BLPAAS        D20DTE
206050061213    4C                   END
206060061213     C                   MOVEL     DSLV20        KPJBU
206070061213     C*
206080061213     C                   CALL      'FNLV20R'
206090061213     C                   PARM                    KPJBA
206100061213     c                   parm      'N'           pwstor            1
206110061213     C*
206120061213     C                   MOVEL     KPJBU         DSLV20
206130061213     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
206140061213    4C     D20ERR        IFNE      '1'
206150061213     C                   MOVEL     D20FVF        BLPFVF
206160061213     C                   MOVEL     D20VLF        BLPVLF
206170061213E   4C                   ENDIF
206180061213    3c                   endif
206190061213    2c                   endif
206200061213    1c                   endif
206210070403     c*
206220070403     c                   exsr      sr_fiarg
206230070604     c*
206240070529     c* manutenzione di un prepagato ed è stato variato l'importo fattura
206250070529     c* eseguo operazioni per invio dati a PDA
206260070601    1c                   if        *in12 and *in15='0' and *in22
206270080213     c                             and vidimv<>savimvo and s_§ogpdaorm<>*blanks
206280070529     c                             and (ormfao=400 or ormfao=410)
206290070604     c                   exsr      sr_pda
206300070601    1c                   endif
206310111026     c* Richiamo pgm per scrittura R.A. in caso di manutenzione con
206320111026     c* riassegnazione segnacolli
206330111026     c                   if        RA_ncl>0
206340111026     c                   exsr      sr_wrtRA
206350111026     c                   endif
206360040601     c
206370151014     c* Se bolla tassata fino all'imponibile o eliminata precedente tassazione
206380151014     c* scrivo/aggiorno fiar5 record "FAT" in ambiente di sede
206390151014     c                   if        (vidimv>0 and vidimv<>savimv_fat) or
206400151014     c                             (vidimv=0 and war61='E')
206410151117     c                   if        %open(fiar531c)
206420151117     c                   exsr      regpesivol
206430151117     c                   endif
206440151015     c                   endif
206450151023     c* se bolla franco import DPD verifico cod. tariffa da utilizzare
206460151023     c                   if        not *in04 and §ogntw='DPD'
206470151023     c                   clear                   fieulpdds
206480151023     c                   eval      ILPDLNP   =blplnp
206490151023     c                   eval      ILPDLNA   =blplna
206500151023     c                   eval      ILPDPARCEL=§b4ipn
206510151023     c                   eval      ILPDHUBP  =§OGHB1
206520151023     c                   eval      ILPDDEPP  =§OGDP1
206530151023     c                   eval      ILPDHUBA  =a_§OGHB1
206540151023     c                   eval      ILPDDEPA  =a_§OGDP1
206550151023     c                   call      'FIEULPDR'
206560151023     c                   parm                    fieulpdds
206570151023     c                   eval      blpctr=OLPDTAR
206580151023
206590151023     c                   endif
206600950713     C**
206610950713     C* W R I T E   I N   F N B L P 0 0 F
206620950713     C   12
206630950713     CAN 15
206640950713     CORN12              WRITE     FNBLP000
206650950713     C* SE MANUTENZIONE AGGIORNO
206660950713     C   12
206670950713     CANN15              UPDATE    FNBLP000
206680081014     c                   if        *in12 and *in15 and §3cabd_s<>' '
206690081014     c                   clear                   trtc86drds
206700081020     c                   eval      i86mod='UV'
206710081020     c                   z-add     §fgs          i86fgsv
206720081020     c                   z-add     §lpaac        i86aasv
206730081014     c                   z-add     §lplnp        i86lnpv
206740081014     c                   z-add     §lpnrs        i86nrsv
206750081014     c                   z-add     §lpnsp        i86nspv
206760081014     c                   z-add     §lpccm        i86ccmv
206770081014     c                   z-add     §lprmn        i86rmnv
206780081014     c                   move      §lprma        i86rmav
206790081014     c                   z-add     blpaas        i86aasb
206800081014     c                   z-add     blplnp        i86lnpb
206810081014     c                   z-add     blpnrs        i86nrsb
206820081014     c                   z-add     blpnsp        i86nspb
206830081017     c                   if        blpccm>0
206840081014     c                   z-add     blpccm        i86ccmb
206850081017     c                   else
206860081017     c                   z-add     blpksc        i86ccmb
206870081017     c                   endif
206880081014     c                   z-add     blprmn        i86rmnb
206890081014     c                   move      blprma        i86rmab
206900081014     c                   call      'TRTC86DRR'
206910081014     c                   parm                    trtc86drds
206920081014     c                   endif
206930110902     c* Se valore di accorpamento spedizioni in consegna non valido invio
206940110902     c* email a CED
206950110902     c                   if        werrxco=*on
206960110902     c                   exsr      sr_mail
206970110902     c                   endif
206980971215     C**
206990971215     C** VERIFICO SE C'E' ETICHETTA ESTERA DA STAMPARE
207000081008     C**                 CLEAR                   WESTER
207010000204     C* ANCHE PER DPD
207020081008     C**   A_§OGNTW      IFEQ      'DPD'
207030040525     c* se ogsea = "S" significa che l'etichetta estera viene stampata in
207040040525     c* arrivo e quindi lascio wester = blanks
207050081008     c***  A_§ogsea      andne     'S'
207060081008     C***                MOVEL     'S'           WESTER
207070081008     C***                ENDIF
207080001024     C* MANUTENZIONE: SE MODIFICATA DATA SPEDIZIONE AGGIORNO LA DATA
207090001024     C*               ANCHE SU FISGN
207100001024     C   12
207110001024     CANN15BLPDSP        IFNE      WBDSP
207120001024     C     §3CDKC        IFEQ      'S'
207130001024     C     *IN79         ANDEQ     *ON
207140001024     C     §1BF12        ORNE      'N'
207150001106     C     §1BF12        ANDNE     'E'
207160001106     C     §1BF12        OREQ      'E'
207170001106     C     WASDKC        ANDEQ     'S'
207180001024     C     KBLP3         SETLL     FISGN05L
207190001024     C     KBLP3         READE     FISGN05L                               30
207200001024     C     *IN30         DOWEQ     *OFF
207210001024     C                   MOVE      BLPMGS        §LDMGS
207220010326     C                   Z-ADD     BLPTFA        §LDTNA
207230121213     c* Non serve più anzi crea problemi nel caso di fisgn duplicato su altro
207240121213     c* tfp.
207250121213     C***                Z-ADD     BLPTFP        SGNTNP
207260010116     C                   CLEAR                   SGNT6A
207270010116     C                   CLEAR                   SGNT6B
207280010116     C                   CLEAR                   SGNT6C
207290010116     C                   CLEAR                   SGNT6D
207300010116     C                   CLEAR                   SGNT6E
207310010116     C                   CLEAR                   SGNT6F
207320080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
207330001024     C                   UPDATE    FISGN005
207340001024     C     KBLP3         READE     FISGN05L                               30
207350001024     C                   ENDDO
207360001024     C                   ENDIF
207370001024     C                   ENDIF
207380000908     C*
207390000908     C* PER DISK C INSERITO CON DAL AL LO DEVO ESPLODERE
207400001009     C* (TEORICAMENTE DOVREI ESCLUDERE EXPORT DPD SE CHI SONO IMMESSO
207410001009     C* MANUALMENTE O DA RMN IN PRATICA ESCLUDO SEMPRE SE SI TRATTA
207420001009     C* DI EXPORT DPD DAL MOMENTO CHE LE SPEDIZIONI PER DPD SONO
207430001009     C* MONOCOLLO)
207440050224     c* per lo stesso motivo escludo anche le import dpd
207450000913    1C     §1BF12        IFNE      'N'
207460001011     C     WEXDPD        ANDNE     'S'
207470050223     c     *in79         andne     *on
207480000911     C     OZ1NCL        ANDGT     2
207490000908     C* I COD. CHI SONO CHE ESPLODO LI SCRIVO NEL SUBFILE IN AGGIUNTA
207500000908     C* PARTENDO DA NUMERO DI RECORD=NR8
207510000908     C* PRIMA DI CLEARARE LA DS MEMORIZZO IL DAL AL IMPOSTATI NEL
207520000908     C* RICHIAMO FATTO DURANTE I CONTROLLI
207530000911     C     OZ1MAX        IFEQ      '2'
207540000908     C                   MOVEL     IZ1CH1        CHIDAL
207550000908     C                   MOVEL     IZ1CH2        CHIAL
207560000911     C                   ELSE
207570000911     C                   MOVEL     IZ1CH2        CHIDAL
207580000911     C                   MOVEL     IZ1CH1        CHIAL
207590000911     C                   ENDIF
207600000908     C* FACCIO UN CICLO DI RICHIAMI A FNLSZ1R FINO AD ARRIVARE AL
207610000908     C* "CHI SONO" AL
207620000911     C                   MOVE      *ALL' '       WW               35
207630000911     C                   Z-ADD     1             IX
207640000911     C     WW            LOOKUP    CHI(IX)                                30
207650000908    2C     CHIDAL        DOWNE     CHIAL
207660000908     C                   CLEAR                   DSLSZ1
207670000908     C                   MOVEL     'E'           IZ1MOD
207680000908     C                   MOVEL     CHIDAL        IZ1CH1
207690000908     C                   Z-ADD     V8CKSC        IZ1CCM
207700000908     C                   MOVEL     BLPCTM        IZ1CTM
207710000908     C                   Z-ADD     BLPNRS        IZ1NRS
207720000908     C                   CALL      'FNLSZ1R'
207730010402     C                   PARM                    KPJBA
207740000908     C                   PARM                    DSLSZ1
207750000908     C                   PARM                    DS1B
207760000911     C     OZ1CHI        IFNE      CHIAL
207770000908     C                   MOVEL     OZ1CHI        V8CNOT
207780000908     C                   CLEAR                   V8CSCE
207790000908     C                   CLEAR                   V8HDKC
207800000908     C                   CLEAR                   V8HESG
207810000915     C                   CLEAR                   V8HST2
207820000915     C                   CLEAR                   V8HFLS
207830000915     C                   CLEAR                   V8HLNA
207840000915     C                   CLEAR                   V8HNRS
207850000915     C                   CLEAR                   V8HNSC
207860000921     C                   CLEAR                   V8HPRE
207870000911     C                   ADD       1             NR8
207880000911     C                   MOVEL     OZ1CHI        CHI(IX)
207890000911     C                   Z-ADD     NR8           POS(IX)
207900000918     C                   ADD       1             IX
207910000908     C                   WRITE     LS01S08
207920000911     C                   ENDIF
207930000908     C                   MOVEL     OZ1CHI        CHIDAL
207940000908    2C                   ENDDO
207950000908    1C                   ENDIF
207960070322     c* se sono in immissione/conferma bolla di sped export dpd
207970070322     c* con numero parcel lungo 12 carico vidnrd nel subfile
207980070322     c                   if        (*in12='0' or *in15='1') and
207990070322     c                             wexdpd='S' and wparcel='12'
208000070322     c                             and §1bf13<>'A'
208010070326     C* PULIZIA SFL
208020070326     C                   SETON                                        35
208030070326     C                   WRITE     LS01C08
208040070326     C                   SETOFF                                       357833
208050070326     c*
208060070322     c                   z-add     0             nr8
208070070322     C                   MOVEL     vidnrd        V8CNOT
208080070322     C                   MOVEL     *BLANKS       V8CSCE
208090070322     C                   MOVE      *BLANKS       V8HDKC
208100070322     C                   MOVE      *BLANKS       V8HESG
208110070322     C                   MOVE      *ZEROS        V8HST2
208120070322     C                   clear                   V8HFLS
208130070322     C                   clear                   V8HLNA
208140070322     C                   clear                   V8HNRS
208150070322     C                   clear                   V8HNSC
208160070322     C* SCRIVO SUBFILE
208170070322     C                   ADD       1             NR8
208180070322     C                   WRITE     LS01S08
208190070322     c                   endif
208200000204     C**
208210000204     C** PER SI DISK "C" --> CHAIN   F I S G N 0 0 F
208220000204    1C     §3CDKC        IFEQ      'S'
208230070323     c     *IN79         ANDEQ     *ON
208240000907     C     §1BF12        ORNE      'N'
208250001106     C     §1BF12        ANDNE     'E'
208260001106     C     §1BF12        OREQ      'E'
208270001106     C     WASDKC        ANDEQ     'S'
208280000204     C                   CLEAR                   WESSGN
208290000929     C                   CLEAR                   WSGNR
208300000208     C                   CLEAR                   FISGN000
208310000919     C                   MOVEL     'S'           WDKC              1
208320000204     C                   SELECT
208330000204     C* IMPORT DPD --> RIF.MITTENTE
208340060622     C     *IN79         WHENEQ    *ON
208350050301     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
208360050301     C                   CLEAR                   V8HCOL
208370060619    4C     savnpr        IFNE      v7cnpr
208380060623     c     savnpr        andne     *blanks
208390060622     C****               move      savnpr        W0120            12 0
208400060622     C****               MOVEL(P)  W0120         KWHO
208410060622     C     Kblp3         setll     FISGN05L
208420060622    5C                   do        *hival
208430060622     C     Kblp3         reade     FISGN05L
208440060622     c                   if        %eof(fisgn05l)
208450060622     c                   leave
208460060622     c                   endif
208470050301     C                   EXSR      ANNSGN
208480060622    5C                   ENDdo
208490050301     C                   ELSE
208500050301     C                   MOVE      *HIVAL        V8HCOL
208510050301    4C                   ENDIF
208520060621     c* Il chi sono per chainare fisgn lo compongo come segue:
208530060621     c* 1) se ho il barcode id -> barcodeId+CapDest+n.parcel+serv.code+iso N
208540060621     c* 2) se non ho il barcode id --> numero parcel lungo 11+1
208550060622    4c                   if        §b4ibi<>*blanks
208560060623     c* se sono in conferma bolle o in immissione o in manutenzione di
208570060623     c* bolla immessa a mano (no disk)
208580060623     c* compongo il chi sono con i dati che ho
208590060623    5c                   if        *in12='0' or *in15='1'
208600060623     c                             or  *in13='0'
208610090511    6c                   if        *in15='1'
208620090511    7c                   if        §lpcad<>*blanks
208630060622     c                   eval      §lpcad_w=§lpcad
208640090511   x7c                   else
208650060622     c                   eval      §lpcad_w=blpcad
208660090511    7c                   endif
208670090514     c                   else
208680090514     c                   eval      §lpcad_w=blpcad
208690090511    6c                   endif
208700060621     c                   clear                   outcapdpd
208710060621     c                   call      'XCAPDPD'
208720060622     c                   parm                    §lpcad_w
208730060621     c                   parm                    outcapdpd         7
208740060621     c                   eval      kwho=§b4ibi+outcapdpd
208750060621     c* se parcel lungo 12 lo trucco con 0 e 99
208760060622    6c                   if        %subst(§b4ipn:14:1)=*blanks
208770060621     c                   eval      kwho=%trim(kwho)+'0'
208780060621     c                             +%subst(§b4ipn:1:3)
208790060621     c                             +'99' + %subst(§b4ipn:4:8)
208800060622   x6c                   else
208810060621     c                   eval      kwho=%trim(kwho)+§b4ipn
208820060622    6c                   endif
208830060621     C                   MOVEL     '15'          COD
208840060621     C                   MOVEL(P)  BLPNZD        KEY
208850060621     C                   EXSR      CTABEL
208860060621     C   30              CLEAR                   DS15
208870060621     C  N30              MOVEL     TBLUNI        DS15
208880060621     c                   movel     §15cie        §15ciea           3
208890060621     c                   eval      kwho=%trim(kwho)+§b4isc+§15ciea
208900060622   x5c                   else
208910060623     c* altrimenti se sono in manutenzione di bolla ricevuta da cliente
208920060623     c* (DISK A) il chi sono lo reperisco chainando fisgn per key
208930060623     c* spedizione
208940060622     c     kblp3         chain(N)  fisgn05l
208950060622     c                   eval      kwho=sgnwho
208960060622    5c                   endif
208970060622   x4c                   else
208980060710     C                   clear                   kwho
208990060710     C                   movel     §b4ipn        kwho
209000060621     C                   eval      %subst(kwho:12:1)=§b4icd
209010060622    4c                   endif
209020000908     C                   EXSR      CTRSGN
209030050221     C* EXPORT DPD --> da vat O DIGITATO, DA CTM
209040001011    2C     WEXDPD        WHENEQ    'S'
209050140714     C     §1BF13        ANDNE     'A'
209060160225     c     w_aDpd        andne     'S'
209070070322     c     wparcel       andne     '12'
209080140715     c     §1bf12        andne     'B'
209090000204     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
209100001009     C                   CLEAR                   V8HCOL
209110001009    4C     SAVNPR        IFNE      V7CNPR
209120001009     C                   MOVEL(P)  SAVNPR        KWHO
209130010116     C     KSGN          CHAIN     FISGN01L                           30
209140001009    5C     *IN30         IFEQ      *OFF
209150001009     C                   EXSR      ANNSGN
209160001009    5C                   ENDIF
209170001009     C                   ELSE
209180001009     C                   MOVE      *HIVAL        V8HCOL
209190001009    4C                   ENDIF
209200000209     C*
209210001009     C                   MOVEL(P)  V7CNPR        KWHO
209220001009     C                   EXSR      CTRSGN
209230000915     C* DISK C NO DPD: RICHIAMO CTRSGN PER OGNI RECORD DEL SUBFILE
209240001002     C     §1BF12        WHENNE    'N'
209250000908     C                   Z-ADD     1             NR8
209260000908     C                   MOVE      *BLANKS       SAVDKC            1
209270000915     C                   MOVE      *ZEROS        JJ                3 0
209280000908     C     NR8           CHAIN     LS01S08                            30
209290000908    3C     *IN30         DOWEQ     *OFF
209300000908     C* Escludo record annullati
209310000908    4C     V8CSCE        IFEQ      *BLANKS
209320000908     C                   MOVEL(P)  V8CNOT        KWHO
209330000908     C                   CLEAR                   WESSGN
209340000908     C* Controllo file fisgn
209350000908     C                   EXSR      CTRSGN
209360000908     C                   MOVE      WDKC          V8HDKC
209370000919    5C     WESSGN        IFEQ      'S'
209380000908     C                   MOVEL     'S'           V8HESG
209390000915     C                   Z-ADD     SGNST2        V8HST2
209400000919   X5C                   ELSE
209410000920     C                   CLEAR                   V8HESG
209420000915     C                   CLEAR                   V8HST2
209430000919    5C                   ENDIF
209440000908     C                   UPDATE    LS01S08
209450000920     C* Tratto la spedizione come diskC (scrittura di fisgn) se almeno
209460000920     C* un collo lo tratto come DISK C
209470000919    5C     WDKC          IFEQ      'S'
209480000908     C                   MOVE      WDKC          SAVDKC
209490000919    5C                   ENDIF
209500000908     C                   MOVEL     'S'           WDKC
209510000919   X4C                   ELSE
209520051102     C* MEMORIZZO IN SCHIERA ANNULLATI SE LEGATO A ARS
209530000920    5C     V8HCOL        IFGT      *ZEROS
209540000915     C                   ADD       1             JJ
209550000915     C                   Z-ADD     V8HCOL        ANN(JJ)
209560000919     C* SE RECORD ANNULLATO ANNULLO FISGN
209570010116     C     KSGN8         CHAIN     FISGN01L                           30
209580000920    6C     *IN30         IFEQ      *OFF
209590000921     C* Se annullato con A non lo potrò più riattivare perchè ormai i
209600000921     C* dati memorizzati su fisgn non sono più aggiornati correttamente
209610000921     c* Se annullato con A e progressivo = 0 significa che non ci sono
209620000921     c* più bolle manutenzionabili con questo cod. chi sono e quindi
209630000921     c* annullo con *
209640000921     C                   EXSR      ANNSGN
209650000920    6C                   ENDIF
209660000920    5C                   ENDIF
209670000920    4C                   ENDIF
209680000911     C                   ADD       1             NR8
209690000908     C     NR8           CHAIN     LS01S08                            30
209700000908    3C                   ENDDO
209710000908     C     SAVDKC        IFEQ      'S'
209720000908     C                   MOVE      'S'           WDKC
209730000908     C                   ENDIF
209740000204     C                   OTHER
209750000204     C                   MOVEL     'N'           WDKC
209760000204    2C                   ENDSL
209770000204     C*
209780000929   X1C                   ELSE
209790010515     C* 15/05/01: FISGN NON DEVE PIU' ESSERE SCRITTO PER LA RISTAMPA
209800001106     C                   MOVEL     'N'           WDKC
209810000204    1C                   ENDIF
209820980409     C*
209830980409     C* ABBLENCO CAMPO DI COMODO USATO IN ROUTINE CRTBLD PER SAPERE
209840980409     C* SE RISTAMAPRE O MENO L'ETICHETTA SEGNACOLLO
209850980409     C* (WPRT = ' '--> SI RISTAMPA; WPRT= 'N' --> NO RISTAMPA)
209860980409     C                   MOVE      *BLANKS       WPRT              1
209870950713     C**
209880940914     C* F N V A D 0 0 F : DETTAGLIO SEGNACOLLI
209890910807     C** DISK CLI:  CONTROLLO SE SE SONO RECORD NON SEQUENZIALI
209900000919     C   12
209910000919     CAN 15§1BFG7        IFEQ      'S'
209920980410     C     §1BFG6        ANDEQ     'C'
209930980219     C                   SETOFF                                       3130
209940020917     C     KBLC          SETLL     FIVAD000
209950020917     C     KBLC          READE     FIVAD000                               30
209960001002     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
209970001002     C  N30WSGNR         IFEQ      'S'
209980081008     C***  WESTER        IFEQ      'S'
209990081008     C***                MOVEL     'ALL'         §DETST
210000081008     C***                ELSE
210010001106     C                   MOVEL     'ITA'         §DETST
210020040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
210030040506     c* etichetta Italia con dati esteri
210040040506     C     A_§ogntw      IFEQ      'EEX'
210050040506     C                   MOVEL     'EEX'         §DETSE
210060040506     c                   else
210070040506     c                   clear                   §detse
210080040506     C                   ENDIF
210090081008     C***                ENDIF
210100001005     C                   CLEAR                   WSTSEG
210110001002     C                   EXSR      RIESEG
210120001002     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
210130001002     C                   CLEAR                   DSBLD7
210140150202     C                   MOVE      BLPfls        §LCLNP
210150001002     C                   MOVE      BLPLNA        §LCLNA
210160001002     C                   MOVE      BLPNRS        §LCNRS
210170001002     C                   MOVE      BLPZNC        §LCZSC
210180001002     C                   MOVE      DSBLD         WWBLD
210190001002     C                   MOVE      DSBLDE        WWBLDE
210200001002     C                   ENDIF
210210930930     C*
210220930930     C* SE NON SEQUENZIALI MEMORIZZO IL PRIMO SEGNACOLLO
210230971215    2C  N30BLPFNS        IFEQ      'S'
210240941230     C                   MOVEL     BLDNCD        VIDNCD
210250951019     C                   Z-ADD     1             BLDNC1
210260971215    2C                   ENDIF
210270910802     C*
210280971215    2C     *IN30         DOWEQ     '0'
210290001002     C*
210300001002     C     WSGNR         IFEQ      'S'
210310001002     C                   MOVE      WWBLD         DSBLD
210320001002     C                   MOVE      WWBLDE        DSBLDE
210330001002     C                   ENDIF
210340001002     C*
210350980403     C                   MOVEL     BLDNCD        SV1NCD
210360980319     C*
210370980319    3C     BLDNCA        IFEQ      0
210380980319     C                   Z-ADD     BLDNCD        BLDNCA
210390980319    3C                   ENDIF
210400000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
210410051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
210420000915     C     §1BF12        IFNE      'N'
210430000915     C                   Z-ADD     1             NR8
210440000915     C                   ENDIF
210450000929     C*
210460000929     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
210470000929     C     WSGNR         IFEQ      'S'
210480000929     C                   MOVE      BLDCDP        §LDCDP
210490000929     C                   ENDIF
210500980319     C*
210510980319    3C     BLDNCD        DOWLE     BLDNCA
210520990318     C     BLDNCD        ANDGT     0
210530980319     C*
210540980319     C                   MOVEL     BLDNCD        WNSC
210550000929     C                   EXSR      CRTBLT
210560001003     C* No disk c: scrittura fisgn in ristampa
210570010404     C* N.B.: Scrittura fisgn per ristampa --> REGOLA: viene effettua
210580010404     C*       ta al momento della creazione del dettaglio colli (CRTBLT
210590010404     c*       ). Non viene fatta nell routine stasci o stascd come per
210600010404     c*       la scrittura di fisgn per §1bf12<>"N" o per import dpd
210610010404     c*       in quanto queste routine non vengono sempre richiamate
210620010404     c*       (per esempio in conferma bolle da disk quando fg6='S')
210630020917     c*       ECCEZIONE: Se cliente con fivad e fg6="D" l'fisgn viene
210640010404     C*       creato dentro stascd per non perdere il codice prodotto
210650010404     c*       Idem se sono in manutenzione
210660001002     C     WSGNR         IFEQ      'S'
210670000929     C                   ADD       1             §LDNC1
210680001002     C                   Z-ADD     WNSC          §LDNCD
210690001002     C                   Z-ADD     WNSC          §LCNCD
210700001002     C                   EXSR      M10
210710001002     C                   MOVEA     §CA           V8CNOT
210720010404     C                   EXSR      EUREXP
210730010306     C                   MOVEL     DSBLD         WSBLD
210740010306     C                   MOVEL     DSBLDE        WSBLDE
210750010306     C     KSGN8         CHAIN     FISGN01L                           30
210760010306     C                   MOVEL     WSBLD         DSBLD
210770010306     C                   MOVEL     WSBLDE        DSBLDE
210780010306     C   30              EXSR      WRTSGN
210790010306     C  N30              EXSR      UPDSGN
210800001002     C                   ENDIF
210810980319     C*
210820980319     C                   ADD       1             BLDNCD
210830980319    3C                   ENDDO
210840001002     C*
210850001002     C                   MOVE      DSBLD         WWBLD
210860001002     C                   MOVE      DSBLDE        WWBLDE
210870980319     C*
210880980403     C* REIMPOSTO NUMERO SEGNACOLLO CHE SI E' SPORCATO NEL CICLO
210890980403     C* DI CREAZIONE DEL BLT
210900980403     C                   Z-ADD     SV1NCD        BLDNCD
210910980403    3C     BLDNCA        IFEQ      BLDNCD
210920980319     C                   MOVE      *ZEROS        BLDNCA
210930980319    3C                   ENDIF
210940951019     C* CREO FNBLD PER SEGNACOLLI NON SEQUENZIALI
210950971215    3C     BLPFNS        IFEQ      'S'
210960971215     C**
210970971215    4C     §1BFG9        IFEQ      'S'
210980971217     C*
210990081008     C**   §1BFG0        OREQ      'D'
211000081008     C**   §1BFG6        ANDEQ     'C'
211010081008     C**   WESTER        ANDEQ     'S'
211020971217     C*
211030081008     C**   §1BF11        OREQ      'D'
211040081008     C**   §1BFG0        ANDEQ     'C'
211050081008     C**   WESTER        ANDEQ     'S'
211060951019     C                   Z-ADD     BLDNCD        COMSCD
211070951019     C                   Z-ADD     BLDNCL        VARNCL
211080971224     C                   MOVEL     BLDCDP        VARCDP
211090951019     C                   EXSR      ROTCDP
211100971215    4C                   ENDIF
211110971215     C**
211120971215     C** STAMPA LA SOLA ETICHETTA DELL'ESTERO IN IMMEDIATO
211130120302     C**  PER SDI SEMPRE, PER BRT SOLO SE IN IMMEDIATO
211140081008    4C**   WESTER        IFEQ      'S'
211150081008     C**   §1BFG9        ANDNE     'S'
211160971217     C*
211170081008    5C**   §1BFG0        IFEQ      'I'
211180081008     C**   §1BFG6        ANDEQ     'C'
211190971217     C*
211200081008     C**   §1BF11        OREQ      'I'
211210081008     C**   §1BFG0        ANDEQ     'C'
211220081008     C**                 MOVEL     'EST'         §DETST
211230971215     C**
211240971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
211250081008     C**                 Z-ADD     BLDNCD        CO2SCD
211260081008    6C**   BLDNCA        IFEQ      0
211270081008     C**                 Z-ADD     BLDNCD        STANCA
211280081008     C**                 ELSE
211290081008     C**                 Z-ADD     BLDNCA        STANCA
211300081008    6C**                 END
211310971215     C**
211320081008     C**                 EXSR      STASCI
211330081008    5C**                 ENDIF
211340081008    4C**                 ENDIF
211350971215    3C                   ENDIF
211360951019     C*
211370910802     C* CANCELLO FLBLD
211380020917     C                   DELETE    FIVAD000
211390910802     C* RILEGGO
211400020917     C     KBLC          READE     FIVAD000                               30
211410971215    2C                   ENDDO
211420971215    1C                   ENDIF
211430910802     C*
211440921006     C* CREO FLBLT SEQUENZIALE PER:
211450921006     C*         DISK CLI CON SEGNAC SEQUENZIALI
211460921006     C*         MANUTENZIONE BOLLE SE SEQUENZIALI
211470921006     C*         IMMISSIONE BOLLE
211480921016     C                   SETOFF                                       30
211490960404     C   12
211500960404    1CAN 15§3ABCM        IFEQ      ' '
211510941221     C* SE IL CTM PREVEDE SEGNACOLLI --> LI CREO
211520941221     C     §1BFG8        ANDEQ     'S'
211530960404    2C     §1BFG7        IFNE      'S'
211540980410     C     §1BFG6        ORNE      'C'
211550921006     C                   SETON                                            30
211560960404    2C                   END
211570960404    1C                   END
211580921006     C*
211590071221     c                   if        *in12 and not *in15
211600071221     c                   if        wagglna='S'
211610071221     c     kblp3         setll     fnblt01l
211620071221     c     kblp3         reade     fnblt01l
211630071221     c                   dow       not %eof(fnblt01l)
211640071221     c                   eval      bltlna=blplna
211650071221     c                   if        wsbord='S' and bltdfv=0
211660071221     c                   clear                   bltnfv
211670071221     c                   endif
211680071221     c                   update    fnblt000
211690071221     c     kblp3         reade     fnblt01l
211700071221     c                   enddo
211710120814     c* Ripeto lo stesso aggiornamento anche per fiart
211720120814     c     kblp3         setll     fiart01l
211730120814     c     kblp3         reade     fiart01l
211740120814     c                   dow       not %eof(fiart01l)
211750120814     c                   eval      artlna=blplna
211760120814     c                   if        wsbord='S' and bltdfv=0
211770120814     c                   clear                   artnfv
211780120814     c                   endif
211790120814     c                   update    fiart000
211800120814     c     kblp3         reade     fiart01l
211810120814     c                   enddo
211820071221     c                   else
211830071221     C** 12
211840071221    1C**ANN15BLPFNS        IFEQ      ' '
211850071221     c     blpfns        ifeq      ' '
211860921016     C     BLPNCD        ANDNE     0
211870921019     C     §1BFG8        ANDNE     'N'
211880950504     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
211890950504     C     §1BFG8        OREQ      'N'
211900960404     C*
211910980407   2AC     WABLT         IFEQ      'S'
211920960404     C                   MOVEL     5             KNPG
211930960404     C                   MOVEL     SIMFEL        KFLE
211940980320     C*
211950980320     C                   MOVE      *BLANKS       WCRT
211960960404     C*
211970940915     C     KBLP3         SETLL     FNBLT000
211980960404    2C     *IN30         DOWEQ     *OFF
211990051124     C     KBLP3         READE     FNBLT000                               30
212000960404     C*
212010980407    4C  N30WCONTC        IFNE      99999
212020960404     C                   ADD       1             WCONTC
212030960404    4C                   ENDIF
212040960404     C* CANCELLO LE SPUNTE ENTRATA SOLO SE C'E' 'S' E SE WCONTC
212050960404     C*  > DEL NUMERO DEI COLLI
212060980407    3C  N30WDELBR        IFEQ      'S'
212070980407     C     WCONTC        ANDGT     BLPNCL
212080070123     C     KBRV          CHAIN     FNBRV000                           31
212090960404    4C     *IN31         DOWEQ     *OFF
212100051124     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
212110051124     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
212120051124     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
212130051124     c* no anomalie da cancellare create a fronte della spunta entrata
212140051124     c**                 z-add     brvnfv        wrvnfv
212150051124     c**                 movel     param2        kpjbu
212160051124     C**                 CALL      'FNLSA8R'
212170051124     C**                 PARM                    KPJBA
212180070123     C                   DELETE    FNBRV000
212190070123     C     KBRV          READE     FNBRV000                               31
212200960404    4C                   ENDDO
212210040415     c*
212220040415    3C                   ENDIF
212230040415     c*
212240040415     c* cancello dalle spunte entrata il peso e volume se c'e' S e
212250040415     c*  se WCONT <= del numero dei colli
212260040415    3C  N30WDELBR        IFEQ      'S'
212270040415     C     WCONTC        ANDle     BLPNCL
212280070123     C     KBRV          CHAIN     FNBRV000                           31
212290040415    4C     *IN31         DOWEQ     *OFF
212300040415     c                   clear                   brvvuc
212310040415     c                   clear                   brvpuc
212320070123     C                   update    FNBRV000
212330070123     C     KBRV          READE     FNBRV000                               31
212340040415    4C                   ENDDO
212350960404     C*
212360960404    3C                   ENDIF
212370960404     C*
212380000915    3C     *IN30         IFEQ      *OFF
212390980320     C                   MOVE      'S'           WCRT              1
212400051124     C  N30              DELETE    FNBLT000
212410120814     c     kfiart        delete    fiart000                           31
212420980323     C                   MOVEL     'E'           WTRC
212430051102     C     KARS1         CHAIN     FIARS01L                           31
212440051102     C  N31              DELETE    FIARS000
212450020212     C                   MOVEL     'F'           WTRC
212460051102     C     KARS1         CHAIN     FIARS01L                           31
212470020212     c     *in31         ifeq      *off
212480020212     c* Se ho diminuito il numero dei colli oppure ho variato la linea di
212490020212     c* arrivo non devo riassegnare i numeri awb per il segnacollo fedex
212500051102     c* quindi memorizzo il primo numero awb prima di cancellare il ARS
212510020212     c* 'erchè mi servirà per ricrearlo
212520020212     c     wawbini       ifeq      *zeros
212530051102     c                   movel     ARSnot        wawbini
212540020212     c                   z-add     wawbini       wawb
212550020212     c                   endif
212560051102     C                   DELETE    FIARS000
212570020212     c                   endif
212580000915     C                   MOVEL     'C'           WTRC
212590051102     C     KARS1         CHAIN     FIARS01L                           31
212600000920    4C     *IN31         IFEQ      *OFF
212610000921     C* SE HO ELIMINATO SEGNACOLLI DOVREI ANNULLARE EVENTUALE FISGN
212620001003     C* MA NON LO FACCIO PERCHE' QUESTO CASO NON DOVREBBE MAI VERIFI-
212630000921     C* CARSI DAL MOMENTO CHE IN MANUTENZIONE BOLLE NON E' POSSIBILE
212640000921     C* CAMBIARE IL CODICE TRATTAMENTO MERCE
212650051102     C                   DELETE    FIARS000
212660000920    4C                   ENDIF
212670980320    3C                   ENDIF
212680960404    2C                   ENDDO
212690980320     C* SE HO CANCELLATO IL DETTAGLIO COLLI LO RICREO
212700980320     C     §1BFG8        IFEQ      'S'
212710980320     C     WCRT          ANDEQ     'S'
212720980320     C                   Z-ADD     BLPNCD        CO2SCD
212730980320     C     BLPNCA        IFEQ      0
212740980320     C                   Z-ADD     BLPNCD        BLPNCA
212750980320     C                   END
212760000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
212770051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
212780000915     C     §1BF12        IFNE      'N'
212790000915     C                   Z-ADD     1             NR8
212800000915     C                   ENDIF
212810980320     C*
212820980320     C     CO2SCD        DOWLE     BLPNCA
212830000915     C     CO2SCD        ANDGT     0
212840980320     C                   Z-ADD     CO2SCD        WNSC
212850980320     C                   EXSR      CRTBLT
212860980320     C                   ADD       1             CO2SCD
212870980320     C                   END
212880980320     C                   END
212890980408  X2AC                   ELSE
212900980408     C* SE HO SBORDERIZZATO LA BOLLA ELIMINO BLTNFV SU DETT. COLLI
212910980408    2C     WSBORD        IFEQ      'S'
212920980409     C                   EXSR      SBORD
212930980408    2C                   ENDIF
212940980320   2AC                   ENDIF
212950950713     C*
212960960404   X1C                   ELSE
212970950713     C* SE SEGNACOLLI NON SEQUENZIALI E HO SBORDERIZZATO IN AUTOMATICO
212980950713     C*  LA BOLLA --> ELIMINO BLTNFV SU DETT COLLI
212990960404    2C     BLPFNS        IFEQ      'S'
213000950713     C     WSBORD        ANDEQ     'S'
213010980409     C                   EXSR      SBORD
213020960404    2C                   ENDIF
213030950713     C*
213040960404    1C                   ENDIF
213050071221    1C                   endif
213060071221    1C                   endif
213070000915     C* SE SONO IN MANUTENZIONE E NON SONO AUMENTATI O DIMINUITI I
213080051102     C* COLLI E NON E' VARIATA LA LNA DEVO AGGIORNARE ARS PER
213090000915     C* EVENTUALI ANNULLAMENTI E AGGIUNTE SU SUBFILE COD CHI SONO
213100000915     C                   MOVEL     *BLANKS       WUPDSG            1
213110001009    1C     *IN12         IFEQ      *ON
213120001009     C     *IN15         ANDEQ     *OFF
213130001009     C     WABLT         ANDNE     'S'
213140071221     C     WAgglna       ANDNE     'S'
213150001009    2C                   SELECT
213160050228     c* IMPORT DPD                                                     cel
213170050228     c     *in79         wheneq    *on
213180050228     c     §1bf12        andne     'N'
213190060619     c     savnpr        andne     v7cnpr
213200050228     C                   MOVEL     'C'           WTRC
213210051102     C     KARS1P        CHAIN     FIARS01L                           31
213220060622     C**N31              move      v7cnpr        w0120
213230060622     C**N31              movel     w0120         ARSNOT
213240060622     c  n31              movel     v7cnpr        arsnot
213250051114     C  N31              movel     dateu         ARSduv
213260051102     C  N31              UPDATE    FIARS000
213270050228     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
213280050228     C  N31              MOVEL     'S'           WUPDSG
213290001009     C* EXPORT DPD
213300001009     C     §1BF12        WHENNE    'N'
213310001011     C     WEXDPD        ANDEQ     'S'
213320160225     c     w_aDpd        andne     'S'
213330140714     C     §1BF13        ANDNE     'A'
213340140715     c     §1bf12        andne     'B'
213350070323     c     wparcel       andne     '12'
213360001009     C     SAVNPR        ANDNE     V7CNPR
213370001009     C                   MOVEL     'C'           WTRC
213380051102     C     KARS1P        CHAIN     FIARS01L                           31
213390051102     C  N31              MOVEL     V7CNPR        ARSNOT
213400051114     C  N31              MOVEL     dateu         ARSduv
213410051102     C  N31              UPDATE    FIARS000
213420001009     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
213430001009     C  N31              MOVEL     'S'           WUPDSG
213440001009     C     §1BF12        WHENNE    'N'
213450050224     c     *in79         andeq     *off
213460000915     C     ANN(1)        ANDGT     *ZEROS
213470000915     C                   Z-ADD     1             NR8
213480000915     C                   Z-ADD     1             JJ
213490000915     C     NR8           CHAIN     LS01S08                            31
213500001009   2AC     *IN31         DOWEQ     *OFF
213510001003    3C     V8HCOL        IFEQ      *ZEROS
213520000915     C     V8CSCE        ANDEQ     *BLANKS
213530000915     C                   MOVE      ANN(JJ)       KANNUL
213540000915     C                   MOVEL     'C'           WTRC
213550051102     C     KARS1K        CHAIN     FIARS01L                           31
213560051102     C  N31              MOVEL     V8CNOT        ARSNOT
213570051114     C  N31              MOVEL     dateu         ARSduv
213580051102     C  N31              UPDATE    FIARS000
213590000915     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
213600000915     C  N31              MOVEL     'S'           WUPDSG
213610020212    4C     §ogntw        IFEQ      'EEX'
213620000915     C                   MOVEL     'E'           WTRC
213630051102     C     KARS1K        CHAIN     FIARS01L                           31
213640051102     C  N31              MOVEL     V8CNOT        ARSNOT
213650051114     C  N31              MOVEL     dateu         ARSduv
213660051102     C  N31              UPDATE    FIARS000
213670001003    4C                   ENDIF
213680000915     C                   ADD       1             JJ
213690001003    3C                   ENDIF
213700000915     C                   ADD       1             NR8
213710000915     C     NR8           CHAIN     LS01S08                            31
213720001009   2AC                   ENDDO
213730070323     C     §1BF12        WHENNE    'N'
213740070323     C     WEXDPD        ANDEQ     'S'
213750070323     c     v7cnpr        andne     savnpr
213760070323     C                   MOVEL     'S'           WUPDSG
213770001009    2C                   ENDSL
213780001009    1C                   ENDIF
213790921006     C*
213800921006     C  N12BLPNCD        IFGT      0
213810921006     C                   SETON                                        30
213820921006     C                   END
213830921006     C* CREO FLBLT
213840980320     C   12
213850980320     CAN 15
213860980320     CAN 30
213870980320     CORN12
213880980320     CAN 30              DO
213890910827     C                   Z-ADD     BLPNCD        CO2SCD
213900910826     C     BLPNCA        IFEQ      0
213910910826     C                   Z-ADD     BLPNCD        BLPNCA
213920910826     C                   END
213930000908     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
213940051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
213950000908     C     §1BF12        IFNE      'N'
213960000908     C                   Z-ADD     1             NR8
213970000908     C                   ENDIF
213980001003     C*
213990001003     C     WSGNR         IFEQ      'S'
214000001005     C     §1BFG6        ANDNE     'M'
214010001003     C     §1BFG6        IFNE      'D'
214020001003     C     §1BFG7        ORNE      'S'
214030081008     C**   WESTER        IFEQ      'S'
214040081008     C**                 MOVEL     'ALL'         §DETST
214050081008     C**                 ELSE
214060001003     C                   MOVEL     'ITA'         §DETST
214070040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
214080040506     c* etichetta Italia con dati esteri
214090040506     C     A_§ogntw      IFEQ      'EEX'
214100040506     C                   MOVEL     'EEX'         §DETSE
214110040506     c                   else
214120040506     c                   clear                   §detse
214130040506     C                   ENDIF
214140081008     C***                ENDIF
214150001005     C                   CLEAR                   WSTSEG
214160001003     C                   EXSR      RIESEG
214170001003     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
214180001003     C                   CLEAR                   DSBLD7
214190150202     C                   MOVE      BLPfls        §LCLNP
214200001003     C                   MOVE      BLPLNA        §LCLNA
214210001003     C                   MOVE      BLPNRS        §LCNRS
214220001003     C                   MOVE      BLPZNC        §LCZSC
214230001003     C                   ENDIF
214240001003     C                   ENDIF
214250000908     C*
214260910827     C     CO2SCD        DOWLE     BLPNCA
214270990318     C     CO2SCD        ANDGT     0
214280940926     C                   Z-ADD     CO2SCD        WNSC
214290910802     C                   EXSR      CRTBLT
214300001003     C* No disk c: scrittura fisgn in ristampa
214310001003     C* Se la stampa segnacolli è in differita e il cliente mi passa
214320020917     C* fivad non creo qui fisgn ma lo creo quando scrivo fnbld perchè
214330001003     C* in questo caso devo memorizzare su fisgn anche il codice prodot
214340001003     C     WSGNR         IFEQ      'S'
214350001005     C     §1BFG6        ANDNE     'M'
214360001003     C     §1BFG6        IFNE      'D'
214370001003     C     §1BFG7        ORNE      'S'
214380001003     C                   ADD       1             §LDNC1
214390001003     C                   Z-ADD     WNSC          §LDNCD
214400001003     C                   Z-ADD     WNSC          §LCNCD
214410001003     C                   EXSR      M10
214420001003     C                   MOVEA     §CA           V8CNOT
214430010404     C                   EXSR      EUREXP
214440010306     C                   MOVEL     DSBLD         WSBLD
214450010306     C                   MOVEL     DSBLDE        WSBLDE
214460010306     C     KSGN8         CHAIN     FISGN01L                           30
214470010306     C                   MOVEL     WSBLD         DSBLD
214480010306     C                   MOVEL     WSBLDE        DSBLDE
214490010306     C  N30              EXSR      UPDSGN
214500010306     C   30              EXSR      WRTSGN
214510001003     C                   ENDIF
214520001003     C                   ENDIF
214530910827     C                   ADD       1             CO2SCD
214540910805     C                   END
214550910802     C                   END
214560910802     C*
214570910826     C     BLPNCA        IFEQ      BLPNCD
214580910826     C                   Z-ADD     0             BLPNCA
214590910826     C                   END
214600950504     C* PER ELIMINAZIONE DEI SEGNACOLLI, CANCELLO ANCHE FNBLD
214610950504     C   12
214620950504     CANN15§1BFG8        IFEQ      'N'
214630950504     C     KBLP3         SETLL     FNBLD000                               30
214640950504     C     *IN30         IFEQ      *ON
214650950504     C*
214660950504     C     KBLP3         READE     FNBLD000                               30
214670950504     C     *IN30         DOWEQ     *OFF
214680950504     C                   DELETE    FNBLD000
214690950504     C     KBLP3         READE     FNBLD000                               30
214700950504     C                   ENDDO
214710950504     C                   ENDIF
214720950504     C                   ENDIF
214730980320     C*
214740980320     C* LE SEGUENTI ISTRUZIONI SI COLLOCAVANO, PER ANALOGIA, DOPO
214750980320     C* LA CREAZIONE DEL BLD PER I SEGNACOLLI NON SEQUENZIALI.
214760980320     C* SONO STATE SPOSTATE QUI AFFINCHE' IN OGNI CASO IL DETTAGLIO
214770980320     C* COLLI SIA GIA' STATO CREATO PER POTER PERMETTERE LA STAMPA
214780980320     C* DELLE ETICHETTE ESTERE
214790980320     C*
214800980320     C* SE FG9='S' CREO 1 RECORD IN FNBLD  SE SEGNACOLLI SEQUENZIALI
214810980320     C   12
214820980320    1CAN 15BLPFNS        IFEQ      ' '
214830980320     C*
214840980320    2C     §1BFG6        IFEQ      'C'
214850980320     C     §1BFG9        ANDEQ     'S'
214860980320     C*
214870081008     C**   §1BFG0        OREQ      'D'
214880081008    2C**   §1BFG6        ANDEQ     'C'
214890081008     C**   WESTER        ANDEQ     'S'
214900980320     C*
214910081008     C**   §1BF11        OREQ      'D'
214920081008     C**   §1BFG0        ANDEQ     'C'
214930081008     C**   WESTER        ANDEQ     'S'
214940980320     C                   Z-ADD     BLPNCD        BLDNCD
214950980320     C                   Z-ADD     BLPNCA        BLDNCA
214960980320     C                   Z-ADD     VIDNCL        BLDNCL
214970980320     C                   Z-ADD     1             BLDNC1
214980980320     C                   EXSR      CRTBLD
214990980320    2C                   ENDIF
215000980320     C** STAMPA ETICHETTA IN IMMEDIATO SE ESTERA LA LNA
215010081008    2C**   WESTER        IFEQ      'S'
215020081008     C**   §1BFG9        ANDNE     'S'
215030980320     C*
215040081008    3C**   §1BFG0        IFEQ      'I'
215050081008     C**   §1BFG6        ANDEQ     'C'
215060980320     C*
215070081008     C**   §1BF11        OREQ      'I'
215080081008     C**   §1BFG0        ANDEQ     'C'
215090081008     C**                 MOVEL     'EST'         §DETST
215100980320     C**
215110980320     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
215120081008     C**                 Z-ADD     BLPNCD        CO2SCD
215130081008    4C**   BLPNCA        IFEQ      0
215140081008     C**                 Z-ADD     BLPNCD        STANCA
215150081008     C**                 ELSE
215160081008     C**                 Z-ADD     BLPNCA        STANCA
215170081008    4C**                 END
215180980320     C**
215190081008     C**                 EXSR      STASCI
215200081008    3C**                 ENDIF
215210081008    2C**                 ENDIF
215220980320    1C                   ENDIF
215230910805     C*
215240910805     C* E S T E N S I O N E   B O L L A
215250991006      *
215260991006      * Se agganciata precedentemente riaggancio file tassazione per 2a bolla
215270991006     C     WAR62         IFEQ      'E'
215280991006     C                   MOVEL     '2'           WTRC
215290050331     c                   if        wKSCsf2 <> 0000 and wKSCsf2 <> 9999
215300050331     c     kblp4         delete    fiar6000
215310050331     c                   clear                   war62
215320050331     c                   else
215330991006     C     KBLP4         CHAIN     FIAR6000                           30
215340050331     c                   endif
215350991006     C                   ENDIF
215360991006      *
215370040116if  1c                   If        *In05 and
215380040116     c                             (wesvar1 <> *Blanks or Vi2Cei <> *Blanks)
215390040116      * Carico le varie
215400040116if  2c                   If        wesvar1 <> *Blanks
215410040116     c                   Clear                   wsv1
215420040116     c                   Clear                   wva1
215430040116     c                   Clear                   wsv2
215440040116     c                   Clear                   wva2
215450040116     c                   Clear                   wsv3
215460040116     c                   Clear                   wva3
215470040116     c                   Eval      ContaSv = 1
215480041217do  3c                   Do        6             c
215490040116     c                   If        w2sv(c) <> *Blanks
215500040116     c                   Exsr      Wrtvar1
215510040116     c                   EndIf
215520040116    3c                   EndDo
215530040116    2c                   EndIf
215540991006      *
215550991006     C                   CLEAR                   FIAR6000
215560991006      *
215570991006     C                   MOVEL     '2'           AR6TRC
215580991006     C                   MOVEL     BLPAAS        AR6AAS
215590991006     C                   MOVEL     BLPLNP        AR6LNP
215600991006     C                   MOVEL     BLPNRS        AR6NRS
215610991006     C                   MOVEL     BLPNSP        AR6NSP
215620991006     C                   MOVEL     VI2CEI        AR6CEI
215630040116     c                   Movel     wsv1          Ar6Sv1
215640040116     c                   Z-add     wva1          Ar6Va1
215650040116     c                   Movel     wsv2          Ar6Sv2
215660040116     c                   Z-add     wva2          Ar6Va2
215670040116     c                   Movel     wsv3          Ar6Sv3
215680040116     c                   Z-add     wva3          Ar6Va3
215690991015     C                   MOVEL     VI2DIV        AR6DIV
215700991022     C                   MOVE      9999          AR6KSC
215710991022     C                   MOVEL     AR6LNP        AR6KSC
215720040126     c                   Z-add     Vi2Imv        Ar6Imv
215730991022     C     AR6IMV        IFGT      *ZEROS
215740991022     C                   MOVEL     'P'           AR6FIM
215750991022     C                   ELSE
215760991022     C                   CLEAR                   AR6FIM
215770991022     C                   ENDIF
215780991014     C* DATI PER STAMPA SOLO SE NON è PREPAGATO
215790991014     C     *IN34         IFEQ      *OFF
215800040116     c                   Z-add     Ar6Imv        Db0Imv
215810941108     C                   MOVEL     VI2CEI        DB0CEI
215820991014     C                   MOVEL     V2DCEI        DB0DCE
215830991015     C                   MOVEL     VI2DIV        DB0DIV
215840991014     C                   MOVEL     WFDC2         DB0FDC
215850991014     C                   ENDIF
215860900507     C*
215870991006     C     WAR62         IFEQ      'E'
215880991006     C                   UPDATE    FIAR6000
215890940926     C                   ELSE
215900991006     C                   WRITE     FIAR6000
215910940926     C                   ENDIF
215920930624     C*
215930940920   X1C                   ELSE
215940940926     C*  C'ERA MA ELIMINATA LA ESTENSIONE BOLLA
215950991006    2C     WAR62         IFEQ      'E'
215960991006     C                   DELETE    FIAR6000
215970930624    2C                   ENDIF
215980930624    1C                   ENDIF
215990940926     C***
216000930331     C*** L E G A M E   B O L L A
216010930331     C   12
216020930331     CANN15VIDLNA        IFNE      SAVLNA
216030940915     C     KBLP3         CHAIN     FNLBL000                           30
216040930331     C  N30              Z-ADD     BLPLNA        LBLLAN
216050940928     C  N30              MOVEL     ' '           LBLFT1
216060940928     C  N30              MOVEL     ' '           LBLFT2
216070940915     C  N30              UPDATE    FNLBL000
216080930331     C                   END
216090910117     C***
216100910125     C* IMMISSIONE:
216110910411     C* NO STAMPA SEGNACOLLO IN  D I F F E R I T A:
216120910220     C     §1BFG6        IFNE      'D'
216130951019     C   12
216140951019     CAN 15              EXSR      DELVAD
216150910220     C                   ELSE
216160960805     C*    STAMPA SEGNACOLLO IN DIFFERITA: CREO FNBLD00F
216170910128     C  N12              DO
216180910128     C                   SETON                                        30
216190910128     C                   Z-ADD     BLPNCD        BLDNCD
216200910128     C                   Z-ADD     BLPNCA        BLDNCA
216210910506     C                   Z-ADD     VIDNCL        BLDNCL
216220910128     C                   EXSR      CRTBLD
216230910128     C                   END
216240910129     C* MANUTENZIONE / DISK CLIENTI:
216250910129     C   12              DO
216260910521     C*** DISK CLIENTI NO DETTAGLIO COLLI DA CLIENTE:
216270910411     C   15§1BFG7        IFNE      'S'
216280040618     c     §1bf12        oreq      'B'
216290910411     C                   Z-ADD     BLPNCD        BLDNCD
216300910411     C                   Z-ADD     BLPNCA        BLDNCA
216310910506     C                   Z-ADD     VIDNCL        BLDNCL
216320910521     C                   Z-ADD     1             BLDNC1
216330910411     C                   EXSR      CRTBLD
216340020917     C* DELETO FIVAD SE C'ERA
216350960805     C                   EXSR      DELVAD
216360910411     C*
216370910411     C                   ELSE
216380910411     C*
216390910521     C*** DISK CLIENTI SI DETTAGLIO COLLI DA CLIENTE:
216400020917     C     KBLC          SETLL     FIVAD000
216410020917     C     KBLC          READE     FIVAD000                               30
216420910411     C*
216430940214     C                   Z-ADD     BLPNCD        COMSCD
216440940214     C                   MOVEL     BLDCDP        VARCDP
216450910411     C                   Z-ADD     1             BLDNC1
216460940214     C                   CLEAR                   VARNCL
216470910411     C*
216480930628     C     *IN30         DOWEQ     *OFF
216490940214     C*
216500960805     C* CREO RECORD IN FNBLD00 PER ROTTURA COD PRODOTTO
216510940214     C     BLDCDP        IFNE      VARCDP
216520001018     C* SE DEVO SCRIVERE FISGN IN RISTAMPA IMPOSTO WSGNR = 'B' PER
216530001018     C* RICHIAMARE STASCD (SCRITTURA DI FISGN AL MOMENTO DELLA SCRITTU-
216540001018     C* DI FNBLD)
216550001018     C     WSGNR         IFEQ      'S'
216560010515     C                   MOVEL     'B'           WSGNR             1
216570001018     C                   ENDIF
216580940214     C                   EXSR      ROTCDP
216590940214     C                   ENDIF
216600940214     C*
216610940214     C* SE CODICE PRODOTTO NON MODIFICATO, SOMMO INSIEME I 2 RECORD
216620940214     C                   ADD       BLDNCL        VARNCL
216630940214     C*
216640910411     C* CANCELLO IL RECORD DAL FLBLD DI PASSAGGIO
216650020917     C                   DELETE    FIVAD000
216660910411     C*
216670020917     C     KBLC          READE     FIVAD000                               30
216680940214     C                   ENDDO
216690940214     C* ULTIMA ROTTURA
216700001018     C     WSGNR         IFEQ      'S'
216710001018     C                   MOVEL     'B'           WSGNR
216720001018     C                   ENDIF
216730940214     C                   EXSR      ROTCDP
216740940214     C*
216750910411     C                   END
216760910411     C*
216770910411     C*** MANUTENZIONE BOLLE:
216780910411     C  N15              DO
216790001003     C*
216800001003     C*
216810910201     C                   SETOFF                                       3132
216820910411     C     SAVLNA        COMP      VIDLNA                             3131
216830910411     C  N31VIDNCL        COMP      SAVNCL                             3132
216840910125     C*
216850940214     C*  L I N E A   A R R I V O   > <   O   N C L   A U M E N T A T O
216860910411     C   31              DO
216870000915     C     KBLP3         CHAIN     FNBLD000                           33
216880940214     C*
216890000915     C     *IN33         IFEQ      *OFF
216900940214     C                   Z-ADD     BLPNCD        COMSCD
216910940214     C                   MOVEL     BLDFST        SAVFST
216920940214     C*
216930940214     C     SAVNCL        IFNE      VIDNCL
216940940214     C                   Z-ADD     VIDNCL        BLDNCL
216950940214     C                   ENDIF
216960940214     C                   ENDIF
216970910128     C*
216980001019     C                   CLEAR                   WSTSGN
216990001019     C*
217000000915     C     *IN33         DOWEQ     '0'
217010001018     C     WSGNR         IFEQ      'S'
217020001018     C                   MOVEL     'B'           WSGNR
217030001018     C                   ENDIF
217040940224     C                   Z-ADD     BLDNCL        VARNCL
217050940224     C                   MOVEL     BLDCDP        VARCDP
217060940224     C*
217070940224     C                   EXSR      ROTCDP
217080940214     C*
217090960404     C* SE PUO' AVERE PIU' CODICI PRODOTTO (FLAG 7 = "S") RILEGGO
217100960404     C*  ALTRIMENTI ESCO DALLA LETTURA DI FNBLD00F, PERCHE' SE HO
217110940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
217120940907     C     §1BFG7        IFEQ      'S'
217130000915     C     KBLP3         READE     FNBLD000                               33
217140940907     C                   ELSE
217150000915     C                   SETON                                        33
217160940907     C                   END
217170940907     C*
217180940214     C                   ENDDO
217190910128     C*
217200910128     C                   END
217210910128     C*
217220910405     C** ALTRE MODIFICHE DELLA MANUTENZIONE BOLLE
217230910405     C*
217240940214     C* D I M I N U Z I O N E   N U M E R O   D E I   C O L L I
217250910411     C  N31*IN32         IFEQ      '1'
217260001019     C                   CLEAR                   WSTSGN
217270000915     C     KBLP3         CHAIN     FNBLD000                           33
217280910405     C*
217290910405     C                   Z-ADD     BLPNCD        BLDNCD
217300910405     C                   Z-ADD     BLPNCA        BLDNCA
217310910506     C                   Z-ADD     VIDNCL        BLDNCL
217320000915     C  N33              MOVEL     BLDFST        SAVFST
217330001018     C     WSGNR         IFEQ      'S'
217340001018     C                   MOVEL     'B'           WSGNR
217350001018     C                   ENDIF
217360910405     C                   EXSR      CRTBLD
217370910405     C*
217380910405     C                   ELSE
217390910405     C*
217400910405     C*                    MODIFICHE CON   AGGIORNAMENTO FLBLD
217410940214     C*
217420940921     C     SAVMIT        IFNE      WKSC
217430960926     C     SAVPDR        ORNE      VIDPDR
217440940214     C     SAVRSD        ORNE      VIDRSD
217450910411     C* CODICE PRODOTTO DA RIF ALFABETICO
217460940214     C     §1BFG7        ORNE      'S'
217470940922     C     SAVRMA        ANDNE     VIDRMA
217480940214     C                   SETON                                        31
217490980409     C* Memorizzo di non ristampare l'etichetta
217500050422     c* (solo se non ho variato campi per cui devo ristampare)
217510050422     C     SAVTSP        IFeq      BLPTSP
217520050422     C     SAVCAD        andeq     VIDCAD
217530050422     C     SAVZNC        andeq     VARZNC
217540050422     C     SAVbva        andeq     vidbva
217550980409     C                   MOVE      'N'           WPRT              1
217560050422     c                   endif
217570940214     C                   ENDIF
217580910411     C*
217590910405     C*                    MODIFICHE SENZA AGGIORNAMENTO FLBLD
217600980409     C  N31SAVTSP        IFNE      BLPTSP
217610940214     C     SAVCAD        ORNE      VIDCAD
217620940214     C     SAVZNC        ORNE      VARZNC
217630050421     C     SAVbva        ORNE      vidbva
217640910405     C                   SETON                                        3132
217650930402     C                   END
217660120302     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BRT
217670051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
217680980409     C     SAVCAD        IFNE      VIDCAD
217690051102     C                   EXSR      AGGARS
217700980409     C                   END
217710000915     C* SE HO VARIATO SOLO COD.CHI SONO DEVO ANDARE IN WRITE SU FISGN
217720000915     C     *IN31         IFEQ      *OFF
217730000915     C     *IN32         ANDEQ     *OFF
217740000915     C     WUPDSG        ANDEQ     'S'
217750000915     C                   SETON                                        3132
217760000915     C                   ENDIF
217770940214     C* --> VARIO FLBLD
217780971230     C     *IN31         IFEQ      *ON
217790001019     C                   CLEAR                   WSTSGN
217800000915     C     KBLP3         CHAIN     FNBLD000                           33
217810000915     C  N33              MOVEL     BLDFST        SAVFST
217820941108     C*
217830000915     C     *IN33         DOWEQ     *OFF
217840001018     C     WSGNR         IFEQ      'S'
217850001018     C                   MOVEL     'B'           WSGNR
217860001018     C                   ENDIF
217870980410     C* VARIAZIONE FLBLD00F E STAMPA
217880971230     C     *IN32         IFEQ      *OFF
217890940214     C                   EXSR      CRTBLD
217900971230     C                   ELSE
217910001005     C* RICHIAMO STASCD PER SCRITTURA FISGN IN RISTAMPA
217920001005     C     WSGNR         IFEQ      'B'
217930001005     C                   EXSR      STASCD
217940001005     C                   MOVEL     'S'           WSGNR
217950001005     C                   ENDIF
217960940214     C* SOLO STAMPA
217970971217     C*  NON VENGONO RISTAMPATI I SAGNACOLLI SE SONO SOLO ESTERO
217980971230     C     SAVFST        IFEQ      'S'
217990980319     C                   EXSR      STASCD
218000081008     C**   *IN12         IFEQ      *ON
218010081008     C**   *IN15         ANDEQ     *OFF
218020081008     c**   A_§ogntw      andeq     'EUP'
218030081008     C**                 MOVEL     'E'           WTRC
218040081008     C**   KBLP4         CHAIN     Fiar4000                           90
218050081008     C**   *IN90         IFEQ      *OFF
218060081008     C**                 MOVEL     ar4NOT        DSBL4E
218070081008     C**                 MOVEL     'S'           §B4EST
218080081008     C**                 MOVEL     DSBL4E        ar4NOT
218090081008     C**                 UPDATE    Fiar4000
218100081008     C**                 ENDIF
218110081008     C**                 SETOFF                                       90
218120081008     C**                 ENDIF
218130971230     C                   ENDIF
218140040603     c* disalloco record di fnbld
218150040603     c                   unlock    fnbld01l
218160971230     C                   ENDIF
218170940907     C*
218180940907     C* SE PUO' AVERE PIU' CODICI PORDOTTO (FLAG 7 = "S") RILEGGO
218190940907     C*  ALTRIMENTI ESCO DALLA LETTURA DI FLBLD50F, PERCHE' SE HO
218200940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
218210971230     C     §1BFG7        IFEQ      'S'
218220000915     C     KBLP3         READE     FNBLD000                               33
218230940907     C                   ELSE
218240000915     C                   SETON                                        33
218250971230     C                   END
218260940907     C*
218270940214     C                   ENDDO
218280940214     C                   ENDIF
218290910417     C                   END
218300910128     C*
218310910128     C                   END
218320910411     C                   END
218330910201     C                   END
218340910411     C*
218350910411     C* STAMPA SEGNACOLLO IN  I M M E D I A T O
218360910131     C     §1BFG6        IFEQ      'I'
218370910208     C* PER DISK CLIENTI O IMMISSIONE BOLLE STAMPO SUBITO
218380910208     C                   MOVEL     *BLANKS       §LDRST
218390081008     C**   WESTER        IFEQ      'S'
218400081008     C**                 MOVEL     'ALL'         §DETST
218410081008     C**                 ELSE
218420971215     C                   MOVEL     'ITA'         §DETST
218430040505     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
218440040505     c* etichetta Italia con dati esteri
218450040505     C     A_§ogntw      IFEQ      'EEX'
218460040505     C                   MOVEL     'EEX'         §DETSE
218470040506     c                   else
218480040506     c                   clear                   §detse
218490040505     C                   ENDIF
218500081008     C**                 ENDIF
218510971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
218520971215     C                   Z-ADD     BLPNCD        CO2SCD
218530971215     C     BLPNCA        IFEQ      0
218540971215     C                   Z-ADD     BLPNCD        STANCA
218550971215     C                   ELSE
218560971215     C                   Z-ADD     BLPNCA        STANCA
218570971215     C                   END
218580910131     C   12
218590910131     CAN 15
218600910201     CORN12              EXSR      STASCI
218610910131     C*
218620910405     C* IN MANUTENZIONE STAMPO SOLO SE CAMBIATI:
218630910131     C   12
218640910131     CANN15              DO
218650001005     C     WSGNR         IFEQ      'S'
218660001005     C                   MOVEL     'B'           WSGNR
218670001005     C                   ENDIF
218680980320     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BAR (MA NON LA LNA)
218690051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
218700980409     C     SAVCAD        IFNE      VIDCAD
218710051102     C                   EXSR      AGGARS
218720980409     C                   END
218730000922     C* SE DISK C DEVO RICHIAMARE STASCI ANCHE PER LE SEGUENTI VARIAZ.
218740050228     C***  §1BF12        IFNE      'N'
218750050228     C***  §1BF12        ANDNE     'E'
218760050228     C***  §1BF12        OREQ      'E'
218770050228     C***  WASDKC        ANDEQ     'S'
218780050228     C***  WSGNR         OREQ      'B'
218790050228     C***  SAVMIT        IFNE      WKSC
218800050228     C***  SAVPDR        ORNE      VIDPDR
218810050228     C***  SAVRSD        ORNE      VIDRSD
218820050228     C***  §1BFG7        ORNE      'S'
218830050228     C***  SAVRMA        ANDNE     VIDRMA
218840050228     C***                MOVEL     'S'           WUPDSG
218850050228     C***                ENDIF
218860050228     C***                ENDIF
218870980320     C*
218880001018     C                   CLEAR                   WNOPRT
218890940214     C     SAVLNA        IFNE      VIDLNA
218900940214     C     SAVNCL        ORNE      VIDNCL
218910940214     C     SAVCAD        ORNE      VIDCAD
218920930930     C     SAVZNC        ORNE      VIDZNC
218930941230     C     SAVTSP        ORNE      BLPTSP
218940050421     C     SAVbva        ORNE      vidbva
218950910405     C*
218960930930     C                   EXSR      STASCI
218970001018     C                   ELSE
218980050228     c     wdkc          ifeq      'S'
218990050228     c     wsgnr         oreq      'B'
219000050228     C     SAVMIT        IFNE      WKSC
219010050228     C     SAVPDR        ORNE      VIDPDR
219020050228     C     SAVRSD        ORNE      VIDRSD
219030050228     C     §1BFG7        ORNE      'S'
219040050228     C     SAVRMA        ANDNE     VIDRMA
219050050228     c     wupdsg        oreq      'S'
219060001018     C                   MOVEL     '1'           WNOPRT            1
219070001018     C                   EXSR      STASCI
219080001018     C                   ENDIF
219090050228     c                   endif
219100930930     C                   ENDIF
219110910131     C                   END
219120910117     C                   END
219130910312     C*
219140910129     C* PER DISK CLIENTI SE CAMBIATO CTM E PRIMA ERA "D" CANCELLO
219150020917     C*   IN FIVAD01L I RECORD
219160940222     C     *IN12         IFEQ      *ON
219170940222     C     *IN15         ANDEQ     *ON
219180970328     C* FLAG DI RISTAMPA BOLLA
219190970328     C                   MOVEL     WSTA          CMD8
219200940222     C                   ENDIF
219210161115     C* PER DISK CLIENTI: cancellazione file
219220980406     C     *IN12         IFEQ      *ON
219230980406     C     *IN15         ANDEQ     *ON
219240980406     C                   EXSR      DELVAT
219250040601     C                   EXSR      DELVAX
219260161115     c                   if        §ogntw='DPD' and wfbdp='S'
219270161115     C/EXEC SQL
219280161115     C+ DELETE FROM WFBDP00F WHERE BDPNPR=:v7cnpr
219290161115     C/END-EXEC
219300161115     c                   endif
219310980406     C                   END
219320940920     C***
219330940216     C* S T A M P A    B O L L A
219340940920     C***
219350020619     C* ESCLUDO SEMPRE BOLLE DI RECUPERO (TRANNE LE BOLLE FO-ASSEGNATO
219360020619     c* RECUPERO BOLLE firmate perchè in questo caso la bolla firmata
219370020619     c* deve partire con allegata la bolla di recupero)
219380040701     C* ESCLUDO SEMPRE BOLLE EXPORT DPD, BOLLE POSTE (solo se data
219390040701     c* spedizione < data in tabella "VPO" trk "PPT"
219400000121     C*
219410940920     C* 1) SE FLG STAMPA BOLLA CLIENTE NON E' "S" (STAMPATA DAL CLIENT)
219420940920     C*                              E NON E' "B" (DA STAMPARE COL PGM
219430940920     C*                                            DI RISTAMPA BOLLA)
219440940920     C*                                MA  E' "N" (DA STAMPARE IN IMMIS
219450940920     C*                                            SIONE BOLLE)
219460940920     C* IN MANUTENZIONE SI PUO' RISTAMPARE SEMPRE
219470970407     C* 2) SE IN MANUT. SE PREMUTO CMD8  (CMD8= 1)
219480941230     C* 3) SE DA DISK CLIENTI SOLO SE LNP >< DA LNA   PER "G"
219490960321     C* 4) SE DA DISK CLIENTI MAI                     PER "P"
219500970407     C* 5) SE IN MANUT. SE ERA NO DDT E DIVENTA SI DDT STAMPO SUBITO
219510000121     C* 6) SE IN MANUT. SE ERA SI DDT DPD E DIVENTA SI DDT NON DPD
219520000121     C*                                                STAMPO SUBITO
219530940216     C*
219540000121     C* 7) RESI E DIROTTAMENTI SEMPRE SUBITO
219550000121     C* 8) SE BOLLA A3 NON SI PUO' MAI STAMPARE
219560000121     C* 9) SE BOLLA F3 NON SI PUO' STAMPARE IN IMMISSIONE
219570000509     C*10) SE MANUTENZIONE DI PREPAGATO, RISTAMPO SEMPRE SE E' DDT SI
219580000121     C*11) SE IMMISSIONE   DI PREPAGATO, STAMPO SEMPRE
219590960321    0C     §3ATB1        IFNE      'A3'
219600020319     C     A_§OGNTW      ANDNE     'DPD'
219610020319     C     §ogntw        ANDNE     'PPT'
219620020619     c     §3atb1        oreq      'A3'
219630020619     c     blpcbo        andeq     'FO'
219640020319     C     §ogntw        OREQ      'PPT'
219650000713     C     BLPNRS        ANDEQ     0
219660040701     c     §ogntw        oreq      'PPT'
219670040729     c     blpdsp        andge     §vpoptl
219680000218     C* PER I PREPAGATI STAMPO LA BOLLA CHE E'LA FATTURA
219690000218     C     *IN34         OREQ      *ON
219700960321     C*
219710941110    1C     *IN12         IFEQ      *OFF
219720970128     C     BLPFST        ANDEQ     'S'
219730940216     C*
219740940216     C     *IN12         OREQ      *ON
219750940216     C     CMD8          ANDEQ     '1'
219760970404     C     BLPFST        ANDNE     'N'
219770970404     C*
219780970404     C     *IN12         OREQ      *ON
219790970404     C     *IN15         ANDEQ     *OFF
219800970404     C     SAVBAM        ANDNE     'S'
219810970404     C     SAVBAM        ANDNE     'C'
219820970404     C     BLPFST        ANDEQ     'S'
219830970407     C*
219840970407     C     *IN12         OREQ      *ON
219850970407     C     *IN15         ANDEQ     *ON
219860970407     C     CMD8          ANDEQ     'S'
219870990630     C*
219880990630     C     *IN12         OREQ      *ON
219890990701     C     *IN15         ANDEQ     *OFF
219900990630     C     BLPFST        ANDEQ     'S'
219910990701     C     *IN22         ANDEQ     *ON
219920990701     C     *IN12         OREQ      *OFF
219930990701     C     *IN34         ANDEQ     *ON
219940000121     C*
219950000121     C     *IN12         OREQ      *ON
219960000121     C     *IN15         ANDEQ     *OFF
219970020319     C     SAVNTW        ANDEQ     'DPD'
219980020319     C     A_§OGNTW      ANDNE     'DPD'
219990000121     C     BLPFST        ANDEQ     'S'
220000900514     C                   EXSR      STAMPA
220010940216    1C                   END
220020960321    0C                   END
220030911031     C*
220040911031     C* PASSO IL NUMERO DI SPEDIZIONE AL PGM RICHIAMATO
220050911031     C   12              Z-ADD     BLPNSP        §LPNSP
220060921006     C* SE RECUPERO ADDIZIONO 1 AL NUMERO
220070921006     C  N12
220080921006     CAN 98              ADD       1             RECNSP
220090900504     C*
220100040415     c* In manutenzione bolle , se riscritto fnblt devo clearare blpncr/ncp
220110061213    1c*                  if        *in12 and not *in15
220120061213    2c*                  if        wablt='S'
220130061213     c*    blpnrr        chain     fnblp000                           90
220140061213     c*                  clear                   blpncr
220150061213     c*                  clear                   blpncp
220160061213     c*                  clear                   blpvlc
220170061213     c*                  clear                   blppkc
220180061213     c* n90              update    fnblp000
220190061213   x2c*                  else
220200050502     c* Se già calcolato volume cml devo reimpostarlo su VLF
220210061213    3c*                  if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
220220061213     c*    blpnrr        chain     fnblp000                           90
220230061213     c*                  clear                   dslv20
220240061213     C*                  MOVEL     'P'           D20TBO
220250061213     C*                  MOVEL     'C'           D20TVL
220260061213     c*                  movel     'L'           d20tla
220270061213     C*                  MOVEL     BLPvlc        D20vlu
220280061213     C*                  MOVEL     BLPncr        D20ncr
220290061213     C*                  MOVEL     BLPFVF        D20FVF
220300061213     C*                  MOVEL     BLPVLF        D20VLF
220310061213     C*                  MOVEL     BLPFVB        D20FVB
220320061213     C*                  MOVEL     BLPVLB        D20VLB
220330061213     C*                  MOVEL     BLPAAS        D20AAS
220340061213     C*                  MOVEL     BLPLNP        D20LNP
220350061213     C*                  MOVEL     BLPNRS        D20NRS
220360061213     C*                  MOVEL     BLPNSP        D20NSP
220370061213     C*                  MOVEL     BLPCBO        D20CBO
220380061213     C*                  MOVEL     BLPNCL        D20NCL
220390061213    4C*    BLPDBR        IFGT      *ZEROS
220400061213     C*                  MOVE      BLPDBR        D20DTE
220410061213     C*                  ELSE
220420061213     C*                  MOVE      BLPMGS        D20DTE
220430061213     C*                  MOVEL     BLPAAS        D20DTE
220440061213    4C*                  END
220450061213     C*                  MOVEL     DSLV20        KPJBU
220460050502     C*
220470061213     C*                  CALL      'FNLV20R'
220480061213     C*                  PARM                    KPJBA
220490061213     c*                  parm      'N'           pwstor            1
220500050502     C*
220510061213     C*                  MOVEL     KPJBU         DSLV20
220520050502     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
220530061213    4C*    D20ERR        IFNE      '1'
220540061213     C*                  MOVEL     D20FVF        BLPFVF
220550061213     C*                  MOVEL     D20VLF        BLPVLF
220560061213E   4C*                  ENDIF
220570061213     c*                  update    fnblp000
220580061213    3c*                  endif
220590061213    2c*                  endif
220600061213    1c*                  endif
220610070601     c                   if        wmsg_pda='S'
220620070606     c* decodifico l'aut.
220630070606     C                   move      w02pdr_p      kpdpdr
220640070606     C                   move      'A'           kpdtip
220650070606     c                   clear                   w02rsc_p
220660070606     c     kfapd         chain     fiapd01l
220670070606     c                   if        %found(fiapd01l)
220680070606     c                   movel     apdrsc        w02rsc_p
220690070606     c                   endif
220700070601     c                   exfmt     ls01w02pda
220710070601     c                   endif
220720040408     c
220730080603     c* disalloco fisgn01l: Se manutneziono bolla export dpd senza
220740080603     c* modificare nulla, nella routine CTRSGN viene allocato fisgn
220750080603     c* e non viene poi pèiù disallocato
220760080603     c                   unlock    fisgn01l
220770081111     c* in manutenzione se cambiata data ritiro verifico se rielaborare
220780081121     c* statistica partito e a terra
220790090330     c* devo rielaborare anche in immissione se la data ritiro è inferiore
220800090330     c* a udate
220810090330    1c                   if        (*in12 and not *in15 and blpdrt<>s_drtblpi)
220820090330     c                             or ((*in12='0' or *in15) and blpdrt>0)
220830090330     c                   z-add     blpncl        st2ncl
220840090330    2c                   If        blpdrt <= §SdfParU
220850081111     C                   MOVE      blpdrt        SA2DTS            8 0
220860081111     C                   MOVE      'P'           SA2TRC            1
220870090330     C                   exsr      sr_callsa2r3
220880090330    2c                   endif
220890090330    2c                   If        s_drtblpi <= §SdfParU
220900081121     c                             and s_drtblpi > 0
220910081111     C                   MOVE      s_drtblpi     SA2DTS            8 0
220920081111     C                   MOVE      'P'           SA2TRC            1
220930090330     C                   exsr      sr_callsa2r3
220940090330    2c                   endif
220950090330    2c                   If        blpdrt <= §SdfterU
220960081121     C                   MOVE      blpdrt        SA2DTS            8 0
220970081121     C                   MOVE      'T'           SA2TRC            1
220980090330     C                   exsr      sr_callsa2r3
220990090330    2c                   endif
221000090330    2c                   If        s_drtblpi <= §SdfTerU
221010081121     c                             and s_drtblpi > 0
221020081121     C                   MOVE      s_drtblpi     SA2DTS            8 0
221030081121     C                   MOVE      'T'           SA2TRC            1
221040090330     C                   exsr      sr_callsa2r3
221050090330    2c                   endif
221060090330    1c                   endif
221070130308     c* invio messagio a ced se cliente fornisce pdf senza abilitazione
221080130313     c* e nel caso in cui la bolla sia stata confermata senza (hanno
221090130313     c* cambiato il CTM a video)
221100130313     c                   if        wvatpe='S' and §1bf16<>'S'
221110130308     c                   exsr      ced_alert
221120130308     c                   endif
221130080603
221140040408     C     ENDREG        ENDSR
221141170920      *--------------------------------------------------------------*
221142170920      * Valorizzaz. campi di FIPND00F
221143170920      *--------------------------------------------------------------*
221144170920     c     sr_riePND     BegSr
221149170921
221150170921      *?Impostazione ds per campi PNDETIU e PNDFLO
221163170929     c*?EXPORT
221164170921    1c                   if        a_§ogntw = 'DPD'
221165170929     c*?Per "DP4"                                                    ?
221166170928   1ac                   if        w_dpe='DP4'
221167171002     c                   clear                   dpnddp4
221170170921     c* check digit del parcel number
221171170921     c*   tolgo il check digit dal parcel number se n. parcel lungo 12
221172170921    2c                   if        %subst(v7cnpr:14:1) = *blanks
221173170921     c                   eval      %subst(v7cnpr:12:1)=' '
221174170921     c                   eval      dp4_§b4icd=%subst(v7cnpr:12:1)
221175170921   x2c                   else
221176170921     c*   se parcel lungo 14 calcolo il check digit
221177170921     c                   clear                   trul28ds4
221178170921     c                   eval      i284cod=v7cnpr
221179170921     c                   call      'TRUL28R5'
221180170921     c                   parm                    trul28ds4
221181170921     c                   movel     o284ckd       dp4_§b4icd
221182170921    2c                   endif
221183170921     c* destination sort
221184170921     c                   movel     osie3dsrt     dp4_§b4ids
221185170921     c* barcode id
221186170921     c                   movel     osie3bidp     dp4_§b4ibi
221187170921     c* depot di arrivo
221188170921     c                   movel     osie3ddep     dp4_§b4ida
221189170921     c* iata code
221190170921     c                   movel     osie3iatad    dp4_§b4iat
221191170921     c* priority group
221192170921     c                   movel     osie3ptyg     dp4_§b4ipy
221193170928  x1ac                   else
221194170929     c*?Per "DP5"                                                    ?
221195171002     c                   clear                   dpnddp5
221196170928     c* check digit del parcel number
221197170928     c*   tolgo il check digit dal parcel number se n. parcel lungo 12
221198170928    2c                   if        %subst(v7cnpr:14:1) = *blanks
221199170928     c                   eval      %subst(v7cnpr:12:1)=' '
221200170928     c                   eval      §pndicd=%subst(v7cnpr:12:1)
221201170928   x2c                   else
221202170928     c*   se parcel lungo 14 calcolo il check digit
221203170928     c                   clear                   trul28ds4
221204170928     c                   eval      i284cod=v7cnpr
221205170928     c                   call      'TRUL28R5'
221206170928     c                   parm                    trul28ds4
221207170928     c                   movel     o284ckd       §pndicd
221208170928    2c                   endif
221209170929     c* DESTINATION DEPOT STRING
221210170928     c                   eval      §PNDIDAST  = OSID4DSTR
221211170929     c* DESTINATION BU STRING
221212170928     c                   eval      §PNDBUCA   = OSID4DBUCA
221213170929     c* D-SORT
221214170928     c                   eval      §PNDDSORT  = OSID4DSORT
221215170929     c* SERVICE TEXT
221216170928     c                   eval      §PNDDSRVX  = OSID4SRVX
221217170929     c* SERVICE MARK
221218170928     c                   eval      §PNDDSRVM  = OSID4SRVM
221219170929     c* BARCODE ID
221220170928     c                   eval      §PNDIBI    = OSID4BCID
221221170929     c* DESTINATION DEPOT COUNTRY
221222170928     c                   eval      §PNDDDPTC  = OSID4DDPTC
221223170929     c* DESTINATION COUNTRY (§15cod di NZD)
221224170929     c                   eval      §PNDISO2   = descod
221225170929     c* DESTINATION NETWORK CODE
221226170928     c                   eval      §PNDNTWC   = OSID4DNTWC
221227170929     c* S-SORT
221228170928     c                   eval      §PNDSSORT  = OSID4SSORT
221229170929     c* O-SORT
221230170928     c                   eval      §PNDOSORT  = OSID4OSORT
221231170929     c* C-SORT
221232170929     c                   eval      §PNDCSORT  = OSID4CSORT
221233170929     c* CAP AD USO SEGNACOLLO
221234170929     c                   eval      §PNDCADP   = OSID4CADP
221235170929     C* VERSIONE DPD
221236170929     c                   eval      §PNDVERD   = OSID4VERD
221237170929     c* CHECK DIGIT BARCODE DPD
221238170929     c                   eval      i284cod=OSID4CADP + v7cnpr +
221239171005     c                             %editc(isid4sorc:'X') + OSID4DNTWC
221240170929     c                   call      'TRUL28R5'
221241170929     c                   parm                    trul28ds4
221242170929     c                   eval      §PNDICBCD  = o284ckd
221243170929     c* REFERENTE CONSEGNA
221244170929     c                   eval      §PNDREF    =  vidref
221245170929     c* TELEFONO DESTINATARIO
221246170929     c                   eval      §PNDTELD   =  vidtel
221247170929     c* Delivery special instruction: note spedizione evitando quelle da tariffa
221248171002     c                   eval      §PNDDSI    = §lpnot + %trim(§lpnt2)
221249170928   1ac                   endif
221250170921   x1c                   else
221251170929     c*?IMPORT
221252170921     c* check digit del parcel number
221253170921     c*   tolgo il check digit dal parcel number se n. parcel lungo 12
221254170921    2c                   if        %subst(v7cnpr:14:1) = *blanks
221255170921     c                   eval      %subst(v7cnpr:12:1)=' '
221256170921     c                   eval      di4_§b4icd=%subst(v7cnpr:12:1)
221257170921   x2c                   else
221258170921     c*   se parcel lungo 14 calcolo il check digit
221259170921     c                   clear                   trul28ds4
221260170921     c                   eval      i284cod=v7cnpr
221261170921     c                   call      'TRUL28R5'
221262170921     c                   parm                    trul28ds4
221263170921     c                   movel     o284ckd       di4_§b4icd
221264170921    2c                   endif
221265170921     c* destination sort
221266170921     c                   move      §oghb1        di4_§b4ids
221267170921     c* barcode id
221268170921    3c                   select
221269170921     c* immissione o bolla di reso
221270170921     c                   when      *in12='0' or blpfbr = 'S'
221271170921     c                   move      '%'           di4_§b4ibi
221272170921     c* conferma da disk
221273170921     c                   when      *in12='1' and *in15='1'
221274170921     c                   if        savfpr='D'
221275170921     c                   move      '%'           di4_§b4ibi
221276170921     c                   else
221277170921     c                   move      §VATEbid      di4_§b4ibi
221278170921     c                   endif
221279170921    3c                   endsl
221280170921     c* FLAG TRADUTTORE per ds dpndflo
221281170921     c                   select
221282170921     c* flag traduttore se in Conferma da disk
221283170921     c                   when      *in12 and *in15
221284170921     c                   eval      dblp01=§lpflo
221285170921     c* Metto quello che ricevo da chiamante
221286170921     c                   eval      §pndTRD=§LPTRD
221287170921     c* se non ho ricevuto nulla e sono richiamata da pgm giacenze per
221288170921     c* bolla di reso metto "R" si tratta di bolla di recupero:
221289170921     c                   if        §pndtrd=*blanks and §3arbl<>'R' and *in44
221290170921     c                             and blpfbr='S'
221291170921     c                   eval      §pndtrd='R'
221292170921     c                   endif
221293170921     c* Immissione bolle: metto "M"=Manuale se non è bolla di recupero
221294170921     c                   when      not *in12
221295170921     c                   if        §3arbl<>'R'
221296170921     c                   eval      §pndtrd='M'
221297170921     c                   endif
221298170921     c
221299170921     c                   endsl
221300170921    1c                   endif
221301170921      *?Impostazione campi DI FIPND
221302170921     c* Numer parcel
221303170920     c                   eval      PNDIPN  = v7cnpr
221304170929     c*?EXPORT
221305170921     c                   if        a_§ogntw='DPD'
221306170929     c*?Per "DP4"                                                    ?
221307170928     c                   if        w_dpe='DP4'
221308170921     c* Service code
221309170921     c                   move      isie3srv      PNDisc
221310170921     c* tipo etichetta
221311170921     c                   eval      PNDDPE  = 'DP4'
221312170921     c* dati etichetta
221313170921     c                   eval      pndetiu = Dpnddp4
221314170929     c* Origin BU CODE
221315170925     c                   eval      PNDBUCNP= §3ibucn
221316170929     c* Origin Depot
221317170925     c                   movel     §3ibucn       PNDIDP7
221318170925     c                   move      §ogdp1        PNDIDP7
221319170928     c                   else
221320170929     c*?Per "DP5"                                                    ?
221321170929     c* Service code
221322170929     c                   move      isid4sorc     PNDisc
221323170929     c* tipo etichetta
221324170929     c                   eval      PNDDPE  = 'DP5'
221325170929     c* dati etichetta
221326170929     c                   eval      pndetiu = Dpnddp5
221327170929     c* Origin BU CODE
221328170929     c                   eval      PNDBUCNP= OSID4OBUCN
221329170929     c* Origin Depot
221330170929     c                   eval      PNDIDP7 = OSID4ODPT
221331170929     c* Destination BU CODE
221332170929     c                   eval      PNDBUCNA= OSID4DBUCN
221333170929     c* Destination Depot
221334170929     c                   eval      PNDIDA7 = OSID4DDPT
221335170928     c                   endif
221336170921     c                   else
221337170929     c*?IMPORT
221338170921    3c                   select
221339170921     c* immissione o bolla di reso
221340170921     c                   when      *in12='0' or blpfbr = 'S'
221341170921     C                   CLEAR                   PTYPE             2
221342170921     c                   if        blppkb>§3ilmp
221343170921     c                   move      101           PNDisc
221344170921     c                   eval      ptype='01'
221345170921     c                   else
221346170921     c                   move      136           PNDisc
221347170921     c                   eval      ptype='02'
221348170921     c                   endif
221349170921     c                   if        blpfbr='S'
221350170921     c                   move      300           PNDisc
221351170921     c                   endif
221352171009     c                   eval      PNDBUCNP= 0
221353171009     c                   eval      PNDIDP7 = '       '
221354170921     c* conferma da disk
221355170921     c                   when      *in12='1' and *in15='1'
221356170921     c                   if        savfpr='D'
221357170921     c                   eval      dblp01=§lpflo
221358170921     c                   move      §lpscd        PNDISC
221359170921     c                   else
221360170921     c                   move      §VATESCD      PNDISC
221361170921     c                   endif
221362171009     c                   if        %check(digits:(%subst(§vatesdep:1:3)))=0
221363171009     c                   movel     §vatesdep     PNDBUCNP
221365171009     c                   endif
221366171009     c                   eval      PNDIDP7 = §vatesdep
221367170921    3c                   endsl
221368170921     c* tipo etichetta
221369170921     c                   eval      PNDDPE  = 'DI4'
221370170921     c* dati etichetta
221371170921     c                   eval      pndetiu = Dpnddi4
221374171009     c****               eval      PNDBUCNP= 0
221376171009     c*****              eval      PNDIDP7 = '       '
221377170921     c                   eval      PNDBUCNA= §3ibucn
221378170921     c                   movel     §3ibucn       PNDIDA7
221379170921     c                   move      a_§ogdp1      PNDIDA7
221380170921     c                   endif
221381170921     c* flag operativi
221382170920     c                   eval      PNDFLO  = dpndflo
221383170920     C                   ENDSR
221384160727      *--------------------------------------------------------------*
221385160727      * Valorizzaz. campi di work limiti C/A dal/al come da tabella "FSC"
221386160727      *--------------------------------------------------------------*
221387161229     c***  sr_impoDalAl  BegSr
221388161229     c***                monitor
221389161229     c***                eval      wcadal=§fscdal
221390161229     c***                on-error
221391161229     c***                clear                   wcadal
221392161229     c***                endmon
221393161229     c***                monitor
221394161229     c***                eval      wcaal =§fscal
221395161229     c***                on-error
221396161229     c***                clear                   wcaal
221397161229     c***                endmon
221398161229     c***                endsr
221399090330      *--------------------------------------------------------------*
221400090330      * Richiamo pgm per rielaborazione statistiche partito e a terra
221401090330      *--------------------------------------------------------------*
221402090330     c     sr_callsa2r3  BegSr
221403090330     C                   CALL      'FNLSA2R3'
221404090330     C                   PARM                    SA2TLA            1
221405090330     C                   PARM                    SA2TRC
221406090330     C                   PARM                    SA2DTS
221407090330     C                   PARM                    WWLNA             3 0
221408090330     C                   PARM                    st2ncl            5 0
221409090330     c                   endsr
221410160421      *--------------------------------------------------------------*
221420160422      * Verifica se aggiornare la zona di consegna su blp
221430160421      *--------------------------------------------------------------*
221440160421     c     sr_VariaZnc   BegSr
221450160422     c* Se già presente una spunta reale, allo scarico spunte
221460160422     c* è stata aggiornata la zona su blp con la zona della spunta se <>
221470160422     c* In questi casi questo pgm non deve più modificare la zona di consegna
221480160422     c* della bolla
221490160421     c                   if        blplna=lna_sav   and
221500160422     c                             blpncl<=savncl
221510160422     C     Kblt1         SETLL     fiart01l
221520160422     C     kblt1         READE(n)  fiart01l
221530160421    2C                   DOW       not %eof(fiart01l)
221540160421     C*
221550160421     c                   exsr      sr_zona
221560160421     c                   if        wokzona='1'
221570160421     c* verifico se presente una spunta
221580160421     c                   eval      w_VariaZnc='N'
221590160421     c                   leavesr
221600160421     c                   endif
221610160422     C     kblt1         READE(n)  fiart01l
221620160421     c                   enddo
221630160422     c                   endif
221640160421     c                   endsr
221650060209      *--------------------------------------------------------------*
221660060209      * Storicizzazione variazione di tassazione prepagato
221670060209      *--------------------------------------------------------------*
221680060209     c     Stoarb        BegSr
221690060209     c*
221700060209     c                   open      fiarbt0f
221710060209     c                   open      fiarbu0f
221720060209     c*
221730060209     c                   movel     '1'           wtrc
221740060209     C     KBLP4         CHAIN     FIAR6000
221750060209     c*
221760060209     c                   z-add     blpaas        arbaas
221770060209     c                   z-add     blplnp        arblnp
221780060209     c                   z-add     blpnrs        arbnrs
221790060209     c                   z-add     blpnsp        arbnsp
221800060209     C                   MOVEL     AR6DIV        ARBDIV
221810060209     C                   MOVEL     AR6POR        ARBPOR
221820060209     C                   MOVEL     AR6SV1        ARBSV1
221830060209     C                   MOVEL     AR6VA1        ARBVA1
221840060209     C                   MOVEL     AR6SV2        ARBSV2
221850060209     C                   MOVEL     AR6VA2        ARBVA2
221860060209     C                   MOVEL     AR6SV3        ARBSV3
221870060209     C                   MOVEL     AR6VA3        ARBVA3
221880060209     C                   MOVEL     AR6IMV        ARBIMV
221890060209     C                   MOVEL     AR6ALI        ARBALI
221900060209     C                   MOVEL     AR6CEI        ARBCEI
221910060209     C                   MOVEL     AR6IFT        ARBIFT
221920060209     C                   MOVEL     AR6DFT        ARBDFT
221930060209     C                   MOVEL     AR6NFT        ARBNFT
221940060209     C                   MOVEL     AR6FIV        ARBFIV
221950060209     C                   MOVEL     AR6FIM        ARBFIM
221960060209     c                   z-add     blpksc        arbksc
221970060209     c                   z-add     blpctr        arbctr
221980060209     c                   move      blpcbo        arbcbo
221990060209      *
222000060209      * Metto nell'ultimo byte del campo arbpru che la bolla aggiornata
222010060209      * è in partenza 'P'
222020060209     C                   MOVE      'P'           ARBPRU
222030060209      *
222040060209     C                   WRITE     FIARBT00
222050060209     C*
222060060209     C* SE HO DELLE ATRE VARIE LE STORICIZZO NEL FILE FIARBU0F
222070060209    1C     WAR7          IFEQ      'E'
222080060209     C     Kblp4         SETLL     FIAR7000
222090060209     C     Kblp4         READE     FIAR7000                               30
222100060209     C*
222110060209    2C     *IN30         DOWEQ     *OFF
222120060209     C                   MOVEL     AR7SVN        ARBSVN
222130060209     C                   MOVEL     AR7VAN        ARBVAN
222140060209     C                   WRITE     FIARBU00
222150060209     C*
222160060209     C     Kblp4         READE(N)  FIAR7000                               30
222170060209    2C                   ENDDO
222180060209     C                   ENDIF
222190060209     C*
222200060209     c                   close     fiarbt0f
222210060209     c                   close     fiarbu0f
222220060209     C*
222230060209     c                   endsr
222240060209
222250050209      *--------------------------------------------------------------*
222260050209      * Chaino fncls per codice ass. per impostazione §b4af1
222270050209      *--------------------------------------------------------------*
222280050209     c     Sr_fncls      BegSr
222290050209     c                   clear                   WCLSflo8
222300050209     c     §b4aks        chain     fncls01l
222310050209     c                   if        %found(fncls01l)
222320050209     c                   eval      wclsflo8 = %SUBST(clsflo:8:1)
222330050209     c                   endif
222340050209     c                   endsr
222350030704
222360030704      *--------------------------------------------------------------*
222370030704      * Scrivo/Aggiorno Fiar5
222380030704      *--------------------------------------------------------------*
222390030704     c     Sr_wrtFiar5   BegSr
222400030704
222410030704     c                   If        %Found(Fiar501l)
222420030704     c                   Update    Fiar5000
222430030704     c                   Else
222440030704     c                   Eval      Ar5Aas = BlpAas
222450030704     c                   Eval      Ar5Lnp = BlpLnp
222460030704     c                   Eval      Ar5Nrs = BlpNrs
222470030704     c                   Eval      Ar5Nsp = BlpNsp
222480030704     c                   Eval      Ar5Trd = KAr5Trd
222490030704     c                   Eval      Ar5Ft1 = 'T'
222500030704     c                   Eval      Ar5Dt1 = *All'9'
222510030704     c                   Eval      Ar5Ft2 = 'T'
222520030704     c                   Eval      Ar5Dt2 = *All'9'
222530030704     c                   Write     Fiar5000
222540030704     c                   EndIf
222550030704
222560030704     c                   EndSr
222570030326
222580030326      *--------------------------------------------------------------*
222590030326      * Forzo la data consegna richiesta
222600030326      *--------------------------------------------------------------*
222610030326     c     SrDcr         BegSr
222620111206     c* questa DS mi serve per controllare la data calcolata con i giorni
222630111206     c*  di chiusura, solo in caso di partciolarità di attesa
222640111206     c*  richiamerò non il TRUL13 ma il TRUL13R1
222650111206     c                   clear                   trul13ds1
222660100218     c
222670100218    1c                   select
222680030409      * Se non ho le ore da aggiungere alla delivery
222690100218If  1c                   when      VidOre > *Zeros
222700100218     c
222710100218     c                   Eval      wwtcr = 'P'
222720100218     c                   Eval      wore = VidOre
222730100218     c                   if        blptsp='C' or blptsp='E'
222740100218     c                   eval      wore=wore+24
222750100218     c                   endif
222760100218     c                   if        blptsp<>'H'
222770100218     c                   Exsr      CalDcr
222780100218     c                   endif
222790100218     c
222800100218     c* Se ho la particolarità, cerco con particolarità
222810100218    1c                   when      vidgma<>'  ' and §7ratt='S'
222820100218     c                   Clear                   dDcr
222830100218     c                   Clear                   dsbs02
222840100218     c                   Eval      T02Mod = 'C'
222850100218     c                   Eval      T02Sif = Knsif
222860100218     c                   Eval      T02Cod = 'DCR'
222870100218     c                   Movel     wksc          T02Ke1
222880100218     c                   Movel     'TTR'         t02ke2
222890100218     c                   Call      'TIBS02R'
222900100218     c                   Parm                    Kpjba
222910100218     c                   Parm                    Dsbs02
222920100218     c
222930100218      * se il cliente è codificato in tabella calcolo la nuova data
222940100218      * consegna richiesta
222950100218If  2c                   If        T02Err = *Blanks
222960100218     c                   Movel     T02Uni        dDcr
222970100218     c                   Eval      wore = §DcrOre
222980100218     c                   Eval      wwtcr = §DcrTcr
222990111206     c* Imposto i giorni di chiusura
223000111206     c                   eval      i13gc1=vidgc1
223010111206     c                   eval      i13gc2=vidgc2
223020111206     c                   eval      i13tcr=wwtcr
223030100218     c                   Exsr      CalDcr
223040100218     c                   endif
223050100218     c
223060100218   x1c                   other
223070100218      * Forzo la data consegna richiesta con tabella DCR se:
223080100218      * 1) non è una bolla di recupero o un conto servizi
223090100218      * 2) non è un tipo serivizio "H"=Consegna ore 10:30
223100100218      * 3) non è un tipo serivizio "E"=priority
223110100218      *  se trovo la tabella DCR con cliente/tariffa o solo cliente
223120100218     c
223130100218If  2c                   If        §3arbl = 'N' and blptsp<>'H'
223140100217     c                             and blptsp<>'E'
223150100215
223160030326     c                   Clear                   dDcr
223170030326     c                   Clear                   dsbs02
223180030326     c                   Eval      T02Mod = 'C'
223190030326     c                   Eval      T02Sif = Knsif
223200030326     c                   Eval      T02Cod = 'DCR'
223210100215     c                   Movel     wksc          T02Ke1
223220100218     c                   Movel     VidCtr        t02ke2
223230030326     c                   Call      'TIBS02R'
223240030326     c                   Parm                    Kpjba
223250030326     c                   Parm                    Dsbs02
223260030326      * se il cliente è codificato in tabella calcolo la nuova data
223270030326      * consegna richiesta
223280100218If  3c                   If        T02Err <>*Blanks
223290100218     c                   Eval      T02Mod = 'C'
223300100218     c                   Eval      T02Sif = Knsif
223310100218     c                   Eval      T02Cod = 'DCR'
223320100218     c                   Movel     wksc          T02Ke1
223330100218     c                   clear                   t02ke2
223340100218     c                   Call      'TIBS02R'
223350100218     c                   Parm                    Kpjba
223360100218     c                   Parm                    Dsbs02
223370100218    3c                   endif
223380100218     c
223390100218If  3c                   If        T02Err = *Blanks
223400030326     c                   Movel     T02Uni        dDcr
223410030409     c                   Eval      wore = §DcrOre
223420030409     c                   Eval      wwtcr = §DcrTcr
223430030409     c                   Exsr      CalDcr
223440100218    3c                   EndIf
223450100218    2c                   EndIf
223460100218    1c                   Endsl
223470030326
223480030326     c                   EndSr
223490030409
223500030409      *--------------------------------------------------------------*
223510030409      * Calcolo le ore da aggiungere alla delivery
223520030409      *--------------------------------------------------------------*
223530030409     c     CalDcr        BegSr
223540100222     c* Se 24 ore per IL o  48 per PRIMA DDEL
223550100219     c*   devo aggiungere alla delivery anche i tempi
223560100219     c*   del C/ass altrimenti non servono (48 ore le ho comunque)
223570100222     c                   if        (wwTCR= ' ' and  wore>24)
223580100222     c                             or (wwTCR='P' and wore>48)
223590100222     c                             or wwTCR='D'
223600100219     c                   eval      UsaCass='N'
223610100219     c                   endif
223620100219     c
223630030409      * CALL AL TNSD99 x calcolare la data consegna teorica
223640030409     c                   ExSr      CLSE98
223650100219     c
223660100219      * Richiamo pgm che calcola la prima data lavorativa disponibile
223670030409     c                   Clear                   Trul13ds
223680030409     c                   Eval      tI13Tla = 'L'
223690030409     c                   Eval      I13Mod = 'A'
223700030409     c                   Eval      I13Fil = BlpLna
223710030409     c                   Eval      I13Din = d98dce
223720030409     c                   Eval      I13Hin = d98hce
223730030409     c                   Eval      I13Ore = wore
223740111206     c
223750111206     c* se impostati i giorni di chiusura, richiamo trul13r1
223760111206     c                   if        i13gc1<>*blanks or i13gc2<>*blanks
223770111206     c                   Call      'TRUL13R1'
223780111206     c                   Parm                    Trul13ds
223790111206     c                   Parm                    Trul13ds1
223800111206     c                   else
223810030409     c                   Call      'TRUL13R'
223820030409     c                   Parm                    Trul13ds
223830111206     c                   endif
223840111206     c
223850111206     c                   If        tO13Err = *Blanks and o13dfi>0
223860030409     c                   Eval      BlpTcr = wwtcr
223870030409     c                   Eval      BlpDcr = O13Dfi
223880030409     c                   EndIf
223890030409
223900030409     c                   EndSr
223910000209     C*
223920000209     C* CONTROLLO FILE FISGN00F -------------------------------------*
223930000209     C     CTRSGN        BEGSR
223940010116     C     KSGN          CHAIN     FISGN01L                           30
223950000209    3C     *IN30         IFEQ      *OFF
223960000209     C* SE NON E' LA STESSA SPEDIZIONE, ANNULLO
223970000209    4C     §LDAAS        IFNE      BLPAAS
223980000209     C     SGNLNP        ORNE      BLPLNP
223990000209     C     §LDNRS        ORNE      BLPNRS
224000000209     C     SGNNSP        ORNE      BLPNSP
224010000919    5C     SGNATB        IFNE      '*'
224020000920     C* Se il chi sono non è di nuova immissione non devo incrementare
224030000920     C* il progressivo ed in generale non è necessario updatare fisgn
224040000920     C* perchè in questo caso risulta già annullato
224050000920    6C     V8HCOL        IFEQ      *ZEROS
224060000209     C                   MOVEL     'A'           SGNATB
224070010116     C                   CLEAR                   SGNT6A
224080010116     C                   CLEAR                   SGNT6B
224090010116     C                   CLEAR                   SGNT6C
224100010116     C                   CLEAR                   SGNT6D
224110010116     C                   CLEAR                   SGNT6E
224120010116     C                   CLEAR                   SGNT6F
224130080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
224140000920    7C     SGNFL1        IFEQ      *BLANKS
224150000920     C                   MOVE      *ZEROS        WSGPRG            1 0
224160000920     C                   ELSE
224170000920     C                   MOVE      SGNFL1        WSGPRG
224180000920    7C                   ENDIF
224190000920     C                   ADD       1             WSGPRG
224200000920     C                   MOVE      WSGPRG        SGNFL1
224210000209     C                   UPDATE    FISGN000
224220150701     c                   exsr      sr_CalSgn
224230000921   X6C                   ELSE
224240001009     C     *IN79         IFEQ      *OFF
224250001011     C     WEXDPD        ANDNE     'S'
224260160225     c     w_adpd        andne     'S'
224270001009     C                   UNLOCK    FISGN01L
224280001009     C                   ENDIF
224290000920    6C                   ENDIF
224300000209     C                   MOVEL     'N'           WDKC
224310000919   x5C                   ELSE
224320000919     C* altra spedizione ma sgnatb='*' --> posso andare in update
224330000919     C                   MOVEL     'S'           WESSGN            1
224340000921     C                   CLEAR                   SGNST2
224350000920     C     *IN79         IFEQ      *OFF
224360001011     C     WEXDPD        ANDNE     'S'
224370160225     c     w_adpd        andne     'S'
224380000919     C                   UNLOCK    FISGN01L
224390000919    5C                   ENDIF
224400000920    5C                   ENDIF
224410000209   X4C                   ELSE
224420000209     C*
224430000921     C* MEMORIZZO CHE ESISTE FISGN --> VADO IN UPDATE
224440000921     C* SE PERO' E' ANNULLATO IL COLLO NON DEVO TRATTARLO COME DISK C
224450000921     C     SGNATB        IFEQ      'A'
224460000921     C                   MOVEL     'N'           WDKC
224470000921     C                   ELSE
224480000209     C                   MOVEL     'S'           WESSGN            1
224490000921     C                   ENDIF
224500000918     C     *IN79         IFEQ      *OFF
224510001011     C     WEXDPD        ANDNE     'S'
224520160225     c     w_adpd        andne     'S'
224530000918     C                   UNLOCK    FISGN01L
224540000918     C                   ENDIF
224550000209    4C                   ENDIF
224560000209     C*
224570000209   X3C                   ELSE
224580000209     C* IMMISSIONE
224590000919     C                   CLEAR                   SGNATB
224600000209     C                   MOVEL(P)  KWHO          SGNWHO
224610000211     C                   Z-ADD     §3ISEA        SGNSEA
224620000209     C                   MOVEL     'S'           SGNST1
224630000921     C                   CLEAR                   SGNST2
224640000921     C                   MOVE      '0'           SGNFL1
224650000211     C     BLPCCM        IFGT      0
224660000211     C                   MOVEL     BLPCCM        SGNKSC
224670000211     C                   ELSE
224680000211     C                   MOVEL     BLPKSC        SGNKSC
224690000908    4C                   ENDIF
224700000921     C                   MOVEL     BLPLNP        SGNLNP
224710000921     C                   MOVEL     BLPNSP        SGNNSP
224720010116     C                   CLEAR                   SGNT6A
224730010116     C                   CLEAR                   SGNT6B
224740010116     C                   CLEAR                   SGNT6C
224750010116     C                   CLEAR                   SGNT6D
224760010116     C                   CLEAR                   SGNT6E
224770010116     C                   CLEAR                   SGNT6F
224780080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
224790000922     C                   CLEAR                   SGNRST
224800000211    3C                   ENDIF
224810000211     C**
224820000209     C                   ENDSR
224830000921     C* ANNULLO FILE FISGN00F -------------------------------------*
224840000921     C     ANNSGN        BEGSR
224850000921    1C     SGNATB        IFEQ      'A'
224860000921    2C     SGNFL1        IFEQ      *BLANKS
224870000921     C                   MOVE      *ZEROS        WSGPRG
224880000921   X2C                   ELSE
224890000921     C                   MOVE      SGNFL1        WSGPRG
224900000921    2C                   ENDIF
224910000921    2C     WSGPRG        IFEQ      0
224920000921     C                   MOVE      '*'           SGNATB
224930000921   X2C                   ELSE
224940000921     C                   SUB       1             WSGPRG
224950000921     C                   MOVE      WSGPRG        SGNFL1
224960000921    2C                   ENDIF
224970000921   X1C                   ELSE
224980000921    2C     SGNATB        IFEQ      *BLANKS
224990000921     C                   MOVEL     '*'           SGNATB
225000000921    2C                   ENDIF
225010000921    1C                   ENDIF
225020010116     C                   CLEAR                   SGNT6A
225030010116     C                   CLEAR                   SGNT6B
225040010116     C                   CLEAR                   SGNT6C
225050010116     C                   CLEAR                   SGNT6D
225060010116     C                   CLEAR                   SGNT6E
225070010116     C                   CLEAR                   SGNT6F
225080080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
225090001005     C     WSGNR         IFEQ      'B'
225100060622     c     *in79         oreq      *on
225110001005     C                   UPDATE    FISGN005
225120001005     C                   ELSE
225130000921     C                   UPDATE    FISGN000
225140150701     c                   exsr      sr_CalSgn
225150001005     C                   ENDIF
225160000921     C                   ENDSR
225170991014      *
225180991014      * AGGIORNO VARIE IN FNBLP E IN FIAR7 -------------------------*
225190991014     C     WRTVAR        BEGSR
225200991014      *
225210991014     C                   SELECT
225220991026    4C     C             WHENGT    3
225230991014     C                   Z-ADD     BLPAAS        AR7AAS
225240991014     C                   Z-ADD     BLPLNP        AR7LNP
225250991014     C                   Z-ADD     BLPNRS        AR7NRS
225260991014     C                   Z-ADD     BLPNSP        AR7NSP
225270991014     C                   MOVEL     '1'           AR7TRC
225280991014     C                   MOVEL     V3CSV1        AR7SVN
225290991014     C                   Z-ADD     V3CVA1        AR7VAN
225300991014     C                   WRITE     FIAR7000
225310991014    4 *
225320991014    4C     C             WHENEQ    3
225330991027     C                   MOVEL     V3CSV1        WSV3
225340991027     C                   Z-ADD     V3CVA1        WVA3
225350991014     C                   ADD       1             C
225360991014    4 *
225370991014    4C     C             WHENEQ    2
225380991027     C                   MOVEL     V3CSV1        WSV2
225390991027     C                   Z-ADD     V3CVA1        WVA2
225400991014     C                   ADD       1             C
225410991014    4 *
225420991014    4C     C             WHENEQ    1
225430991027     C                   MOVEL     V3CSV1        WSV1
225440991027     C                   Z-ADD     V3CVA1        WVA1
225450991014     C                   ADD       1             C
225460991014    4C                   ENDSL
225470991014      *
225480991014     C                   ENDSR
225490040116      *
225500040116      *-------------------------------------------------------------*
225510040116      * Aggiorno le varie della seconda bolla
225520040116      *-------------------------------------------------------------*
225530040116     c     WrtVar1       BegSr
225540040116
225550040116s   1c                   Select
225560040116     c                   When      ContaSv > 3
225570040116     c                   Eval      Ar7Aas = BlpAas
225580040116     c                   Eval      Ar7Lnp = BlpLnp
225590040116     c                   Eval      Ar7Nrs = BlpNrs
225600040116     c                   Eval      Ar7Nsp = BlpNsp
225610040116     c                   Eval      Ar7Trc = '2'
225620040116     c                   Eval      Ar7Svn = w2sv(c)
225630040116     c                   Eval      Ar7Van = w2va(c)
225640040116     c                   Write     Fiar7000
225650040116
225660040116     c                   When      ContaSv = 3
225670040116     c                   Movel     w2sv(c)       wsv3
225680040116     c                   Z-add     w2va(c)       wva3
225690040116     c                   Add       1             ContaSv
225700040116
225710040116     c                   When      ContaSv = 2
225720040116     c                   Movel     w2sv(c)       wsv2
225730040116     c                   Z-add     w2va(c)       wva2
225740040116     c                   Add       1             ContaSv
225750040116
225760040116     c                   When      ContaSv = 1
225770040116     c                   Movel     w2sv(c)       wsv1
225780040116     c                   Z-add     w2va(c)       wva1
225790040116     c                   Add       1             ContaSv
225800040116    1c                   EndSl
225810040116
225820040116     c                   EndSr
225830991014     C*
225840991014     C* CONTROLLO SE BOLLA DA STAMPARE O MNEO ----------------------*
225850991014     C     CTRSTA        BEGSR
225860970328     C                   MOVEL     '1'           WSTA
225870970328     C* SOLO PER RICHIAMO DA CONFERMA BOLLA
225880970328     C*  SE NON E' DA STAMPARE FACCIO FINTA CHE SIA STAMPA STAMPATA
225890970328     C     *IN12         IFEQ      *ON
225900970328     C     *IN15         ANDEQ     *ON
225910970328     C*
225920970407     C                   SELECT
225930970407     C     WFPR          WHENEQ    'G'
225940970328     C     BLPLNP        ANDEQ     BLPLNA
225950970328     C                   MOVEL     ' '           WSTA
225960970328     C* SE NON E' DA STAMPARE, NON STAMPO
225970970407     C     §1BFG3        WHENNE    'N'
225980970328     C                   MOVEL     ' '           WSTA
225990970328     C* SE FLAG "P" NON STAMPO MAI
226000970407     C     WFPR          WHENEQ    'P'
226010970328     C                   MOVEL     ' '           WSTA              1
226020970407     C**
226030970407     C* SE NON VENGO DA CONFERMA BOLLE STAMPO SEMPRE SUBITO
226040140612     C***  §LPRIC        WHENNE    'C'
226050160304     c***                when      §lpric<>'C'
226060160304     c***                          and (%lookup('999':sk_VPODIR)=0 and
226070160304     c***                               %lookup(%editc(blplnp:'X'):sk_VPODIR)=0)
226080160304     C***                MOVEL     'S'           WSTA
226090970407     C                   ENDSL
226100970328     C*
226110970328     C                   ENDIF
226120970328     C                   ENDSR
226130970328     C*
226140020917     C*--- CANCELLO RECORD FIVAD00F ----------------------------------*
226150951019     C     DELVAD        BEGSR
226160020917     C     KBLC          SETLL     FIVAD000                               30
226170910220     C   30              DO        *HIVAL
226180020917     C     KBLC          READE     FIVAD000                               30
226190020917     C  N30              DELETE    FIVAD000
226200910220     C  N30              END
226210910220     C*
226220910220     C                   ENDSR
226230020917     C*--- CANCELLO RECORD FIVAT00F ----------------------------------*
226240980406     C     DELVAT        BEGSR
226250020917     C     KBLC          SETLL     FIVAT000                               30
226260980406     C   30              DO        *HIVAL
226270020917     C     KBLC          READE     FIVAT000                               30
226280020917     C  N30              DELETE    FIVAT000
226290980406     C  N30              END
226300980406     C*
226310980406     C                   ENDSR
226320040601     c*
226330040601     C*--- CANCELLO RECORD FIVAX00F ----------------------------------*
226340040601     C     DELVAX        BEGSR
226350040601     C     KBLC          SETLL     FIVAX000                               30
226360040601     C   30              DO        *HIVAL
226370040601     C     KBLC          READE     FIVAX000                               30
226380040601     C  N30              DELETE    FIVAX000
226390040601     C  N30              END
226400040601     C*
226410040601     C                   ENDSR
226420940214     C*
226430940214     C* ROTTURA CODICE PRODOTT DA DETTAGLIO COLLI CLIENTE -----------*
226440940214     C     ROTCDP        BEGSR
226450940214     C*
226460940214     C                   Z-ADD     COMSCD        BLDNCD
226470940214     C     BLDNCD        ADD       VARNCL        BLDNCA
226480940214     C                   SUB       1             BLDNCA
226490940214     C                   ADD       VARNCL        COMSCD
226500940214     C     BLDNCA        IFEQ      BLDNCD
226510940214     C                   Z-ADD     0             BLDNCA
226520940214     C                   END
226530000426     C                   MOVEL     BLDNCL        SA2NCL
226540000426     C                   MOVE      BLDCDP        SA2CDP
226550000426     C                   MOVEL     VARNCL        BLDNCL
226560000426     C                   MOVE      VARCDP        BLDCDP
226570940224     C* CREA O AGGIORNA SEGNACOLLI
226580940214     C                   EXSR      CRTBLD
226590001002     C*
226600000426     C                   MOVEL     SA2NCL        BLDNCL
226610000426     C                   MOVE      SA2CDP        BLDCDP
226620940214     C                   ADD       VARNCL        BLDNC1
226630940214     C                   MOVEL     BLDCDP        VARCDP
226640940214     C                   CLEAR                   VARNCL
226650940214     C                   ENDSR
226660991117     C*
226670991117     C*--- IMPOSTO NUMERO DISTINTA PER SPED DPD ----------------------*
226680991117     C     SPEDPD        BEGSR
226690991117      *
226700991117     C                   CLEAR                   DPDBRC
226710991117      *
226720060510     C                   MOVE      §OGDP1        DPDLNP
226730991117      *
226740991117     C                   MOVEL     BLPMGS        W0020
226750991117     C                   MOVE      W0020         DPDGMS
226760991117     C                   MOVE      BLPMGS        W0020
226770991117     C                   MOVEL     W0020         DPDGMS
226780991117      * Aggancio numeratore 190 per progressivo distinta
226790991117     C                   CLEAR                   NUFNUM
226800991117     C                   EXSR      DPDNUM
226810991117     C                   Z-ADD     NUFNUM        DPDNDS
226820991117      * Calcolo CHECK DIGIT
226830991117     C                   EXSR      M1031
226840991117      *
226850991117     C                   ENDSR
226860991117      *
226870991117      ** CALCOLA CHECK DIGIT -----------------------------
226880991117     C     M1031         BEGSR
226890991117      *
226900991117     C                   MOVE      *ZERO         §TT2              3 0
226910991117     C                   CLEAR                   W0030
226920991117     C                   CLEAR                   W0010
226930991117      *
226940991117      * TOTALIZZO I VALORI, QUELLI NELLE POSIZIONI DISPARI PER 3
226950991117     C                   DO        11            XX                2 0
226960991117      *
226970991117     C     XX            DIV       2             §CTR              3 0
226980991117     C                   MVR                     §RST              3 030
226990991117      *
227000991117     C     *IN30         IFEQ      '1'
227010991117     C     §11(XX)       MULT      3             §CTR
227020991117     C                   ELSE
227030991117     C                   Z-ADD     §11(XX)       §CTR
227040991117     C                   ENDIF
227050991117      *
227060991117     C                   ADD       §CTR          W0030
227070991117     C                   ENDDO
227080991117      *
227090991117     C     W0030         ADD       9             §TT2
227100991117     C                   MOVE      0             §TT2
227110991117     C     §TT2          SUB       W0030         DPDCHD
227120991117      *
227130991117     C                   ENDSR
227140991117      *
227150991117      *--- NUMERO DISTINTA DPD ---------------------------------------*
227160991117     C     DPDNUM        BEGSR
227170991117      *
227180991117     C                   Z-ADD     BLPMGS        DATA6
227190991117     C                   MOVE      BLPAAS        W0020
227200991117     C                   MOVEL     W0020         DATA6
227210991117     C                   Z-ADD     190           CNU
227220991117      *
227230991118     C     KNUF3         CHAIN     FLNUF2                             30
227240991117      * SE NON TROVATO IL NUMERATORE PROVO A CREARLO
227250991117     C     *IN30         IFEQ      *ON
227260991117     C                   CLEAR                   FLNUF2
227270991117     C                   Z-ADD     CNU           NUFCNU
227280991117     C                   Z-ADD     DATA6         NUFDAT
227290991117     C                   WRITE     FLNUF2
227300991118     C     KNUF3         CHAIN     FLNUF2                             30
227310991118     C                   ENDIF
227320991117      *
227330991117     C     *IN30         IFEQ      *OFF
227340991117     C                   ADD       1             NUFNUM
227350991117     C                   UPDATE    FLNUF2
227360991117     C                   ENDIF
227370991117      *
227380991117     C                   ENDSR
227390991130      *
227400991130      *--- EVENTI DPD ------------------------------------------------*
227410991130     C     EVEDPD        BEGSR
227420991130      *
227430060619     C                   MOVE      'S'           WEU12             1
227440991130      *
227450060619     C                   CLEAR                   fieu12ds
227460060619     C                   Z-ADD     BLPAAS        i12AAS
227470060619     C                   Z-ADD     BLPLNP        i12LNP
227480060619     C                   Z-ADD     BLPNRS        i12NRS
227490060619     C                   Z-ADD     BLPNSP        i12NSP
227500060619     C                   Z-ADD     BLPLNA        i12LNA
227510060619     C                   movel     v7cnpr        i12parcel
227520060619     c                   movel     'I'           i12ie
227530991130      *
227540060619     C                   CALL      'FIEU12R'
227550991130     C                   PARM                    KPJBA
227560060619     C                   PARM                    fieu12ds
227570991130      *
227580991130     C                   ENDSR
227590991117      *
227600991117      *--- STAMPA BOLLE ----------------------------------------------*
227610900508     C     STAMPA        BEGSR
227620941107     C*
227630941107     C                   MOVEL     'P'           DB0TBO
227640110323     C                   MOVEL     'B'           DB0GES
227650990610     C* STAMPO DI UN FRANCO PREPAGATO
227660990610     C     PARTCH        IFEQ      'P'
227670010307     C     §LPFPR        OREQ      'O'
227680990610     C                   MOVEL     '8'           DB0TBO
227690110323     c* Per la stampa di un prepagato
227700110323     c* non va più bene richiamare con "B" perchè non c'è la possibilità
227710110323     c* di passare l'importo del bollo (bisognerebbe modificare la fnlsb5ds
227720110323     c* ma per il momento non è il caso mentre non va bene il campo db0ese pechè
227730110323     c* è stato pensato per contenere la somma degli importi esenti..)
227740110323     c* Quindi richiamo con DB0GES=' ': in questo modo il pgm di stampa
227750110323     c* reperisce autonomamente i dati della bolla incluso il bollo se presente
227760110323     C                   MOVEL     ' '           DB0GES
227770990610     C                   ENDIF
227780941108     C*
227790941108     C* SE SONO IN MANUTENZIONE SI TRATTA DI RISTAMPA
227800941108    1C     *IN12         IFEQ      *ON
227810941108     C     *IN15         ANDEQ     *OFF
227820941108     C                   MOVEL     'R'           DB0RIS
227830941108    1C                   ENDIF
227840941107     C*
227850941107     C                   MOVEL     BLPCBO        DB0CBO
227860941107     C                   MOVEL     §3ATB1        DB0TB1
227870941107     C                   MOVEL     §3ATB2        DB0TB2
227880990610     C* DE NON E' PREPAGATO STAMPO LA DECODIFICA DEL TIPO BOLLA
227890990628     C     PARTCH        IFNE      'P'
227900010307     C     §LPFPR        ANDNE     'O'
227910990610     C                   MOVEL(P)  §3ADES        DB0DCB
227920990610     C                   ELSE
227930990610     C                   MOVEL(P)  CPREPA        DB0DCB
227940990610     C                   ENDIF
227950990610     C**
227960941107     C                   MOVEL     BLPTSP        DB0TSP
227970941107     C                   Z-ADD     1             C
227980941107     C     BLPTSP        LOOKUP    TSP(C)                                 30
227990941107     C   30              MOVEL     DTS(C)        DB0DTS
228000941115     C   30              MOVEL     STS(C)        DB0FST
228010941107     C*
228020941107     C                   MOVEL     BLPAAS        DB0AAS
228030941107     C                   MOVEL     BLPMGS        DB0MGS
228040941107     C                   MOVEL     BLPLNP        DB0LNP
228050941107     C                   MOVEL     BLPNRS        DB0NRS
228060941107     C                   MOVEL     BLPNSP        DB0NSP
228070941107     C                   MOVEL     BLPTC1        DB0TC1
228080941107     C                   MOVEL     BLPTC2        DB0TC2
228090941107     C                   MOVEL     BLPFNS        DB0FNS
228100941107     C                   MOVEL     BLPRMN        DB0RMN
228110941107     C                   MOVEL     BLPRMA        DB0RMA
228120941107     C                   MOVEL     BLPIAS        DB0IAS
228130941107     C                   MOVEL     BLPVAS        DB0VAS
228140941107     C                   MOVEL     BLPVMD        DB0VMD
228150941107     C                   MOVEL     BLPVAD        DB0VAD
228160961007     C     TAMFVD        IFNE      '4'
228170941107     C                   MOVEL     BLPQFT        DB0QFT
228180961007     C                   ENDIF
228190941107     C                   MOVEL     VIDTIC        DB0TIC
228200980806     C* SE L'IMPORTO DEL C/A E' OLTRE IL LIMITE PRENDO DESCRIZIONE OLTR
228210980806     C                   MOVEL     §1ADES        DB0DTI
228220980806     C**
228230980806     C     §1ADEO        IFNE      *BLANKS
228240980806     C** DESCRIZIONE OLTRE LIMITE
228250011212     C     FCASAV        IFNE      *BLANKS
228260980806     C                   MOVEL     §1ADEO        DB0DTI
228270980806     C                   ENDIF
228280980806     C                   ENDIF
228290980806     C**
228300950208     C                   MOVEL     §1AUCM        DB0UCM
228310950208     C                   MOVEL     §1ASTE        DB0STE
228320941107     C                   MOVEL     VIDCAS        DB0CAS
228330941107     C                   MOVEL     VIDVCA        DB0VCA
228340941107     C                   MOVEL     VIDGCA        DB0GCA
228350941107     C                   MOVEL     BLPLNA        DB0LNA
228360941107     C                   MOVEL     BLPZNC        DB0ZNC
228370941107     C* CODICE MITENTE PIENO
228380941108    1C     BLPCCM        IFGT      0
228390941107     C                   Z-ADD     BLPCCM        DB0CCM
228400941108   X1C                   ELSE
228410941107     C* SE NON E' ASSEGNO LO IMPOSTO DA KSC
228420941108    2C     *IN04         IFEQ      *OFF
228430941107     C                   MOVEL     BLPKSC        DB0CCM
228440950125     C* SOLO SE BOLLA FRANCO PASSO LA P.IVA
228450061110     C***                MOVEL     BLPCPI        DB0CPI
228460061110     c* Adesso nel campo della partita iva ci passo il codice fiscale per
228470061110     c*  la stampa
228480061110     c                   movel     vidcdf        db0cpi
228490941108    2C                   ENDIF
228500941108    1C                   ENDIF
228510941107     C*
228520941107     C* ASSEGNATO O 2 BOLLA: CODICE DESTINATARIO LNA9999
228530941108    1C     §3ATB2        IFNE      *BLANKS
228540941108     C     *IN04         OREQ      *ON
228550941107     C                   Z-ADD     9999          DB0CCD
228560941107     C                   MOVEL     BLPLNA        DB0CCD
228570941108    1C                   ENDIF
228580941107     C                   MOVEL     BLPRSM        DB0RSM
228590941107     C                   MOVEL     BLPINM        DB0INM
228600941107     C                   MOVEL     BLPLOM        DB0LOM
228610941107     C                   MOVEL     BLPCAM        DB0CAM
228620941107     C                   MOVEL     BLPFAP        DB0FAP
228630941107     C                   MOVEL     BLPNZM        DB0NZM
228640941107     C                   MOVEL     BLPPRM        DB0PRM
228650941107     C*
228660941107     C                   MOVEL     BLPRSD        DB0RSD
228670950123     C                   MOVE      WRD2          DB0RD2
228680941107     C                   MOVEL     BLPIND        DB0IND
228690941107     C                   MOVEL     BLPLOD        DB0LOD
228700941107     C                   MOVEL     BLPCAD        DB0CAD
228710941107     C                   MOVEL     BLPFIN        DB0FIN
228720941107     C                   MOVEL     BLPNZD        DB0NZD
228730941107     C                   MOVEL     BLPPRD        DB0PRD
228740941107     C                   MOVEL     BLPRMO        DB0RMO
228750941107     C                   MOVEL     BLPGC1        DB0GC1
228760941107     C                   MOVEL     BLPGC2        DB0GC2
228770941107     C                   MOVEL     BLPNAS        DB0NAS
228780941107     C                   MOVEL     BLPNCL        DB0NCL
228790941107     C                   MOVEL     BLPPKF        DB0PKF
228800941107     C                   MOVEL     BLPVLF        DB0VLF
228810941115     C                   MOVEL     BLPFVF        DB0FVF
228820941107     C                   MOVEL     BLPFLS        DB0FLS
228830941107     C                   MOVEL     BLPNCD        DB0NCD
228840941107     C                   MOVEL     BLPNCA        DB0NCA
228850941107     C                   MOVEL     BLPXCO        DB0XCO
228860941107     C                   MOVEL     VIDNT1        DB0NT1
228870941107     C                   MOVEL     VIDNT2        DB0NT2
228880941107     C                   MOVEL     BLPFFD        DB0FFD
228890941107     C                   MOVEL     BLPDCR        DB0DCR
228900941107     C                   MOVEL     BLPTCR        DB0TCR
228910941107     C                   MOVEL     BLPHCR        DB0HCR
228920941107     C                   MOVEL     BLPFBR        DB0FBR
228930941107     C                   MOVEL     BLPGGA        DB0GGA
228940941107     C                   MOVEL     BLPGMA        DB0GMA
228950960208     C                   MOVEL     VIDGVA        DB0GVA
228960950125     C                   MOVEL     BLPSOP        DB0SOP
228970950626     C                   MOVEL     BLPCTR        DB0CTR
228980990628     C                   MOVEL     BLPDRT        DB0DRT
228990990628     C                   MOVEL     BLPNRT        DB0NRT
229000990628     C                   MOVEL     BLPPDR        DB0PDR
229010990628     C                   MOVEL     BLPFPP        DB0FPP
229020950102     C   12
229030950102     CANN15              MOVEL     'V'           DB0RIS
229040970206     C*
229050970206     C* ALLEGA BAM
229060970206     C     BLPFST        IFEQ      'S'
229070970206     C     BLPFST        OREQ      'C'
229080970206     C                   MOVEL     'S'           DB0BAM
229090970206     C                   ENDIF
229100970206     C*
229110030611     C                   CALL      WD90PSL
229120030626     C                   PARM                    fnlsb5DS
229130130318     c                   parm                    FNLSB6ds1
229140941108     C*
229150941108     C                   Z-ADD     1             I100
229160941107     C**
229170900508     C                   ENDSR
229180900511     C*
229190990701     C*--- CARICO RECORD DI MANUTENZIONE -----------------------------*
229200010215     C     CARBLP        BEGSR
229210990630     C                   SETOFF                                       22
229220990701     C                   CLEAR                   SAVNFT
229230070918     c                   clear                   s_drt
229240950206     C                   Z-ADD     KCI           CCC
229250011025      *
229260011025     C                   CLEAR                   FLGVRN
229270030204     c                   Clear                   wPkg
229280030204     c                   Clear                   wNba
229290070322     c                   clear                   wparcel
229300091221     c                   clear                   wvidgma
229310100604     c                   clear                   w7rRC
229320011025      *
229330900511     C* CHAIN
229340061212     C     KBLP3         CHAIN     FNBLP01l
229350061212     c                   if        %found(fnblp01l)
229360061218     c                   z-add     blpnrr        savnrr
229370061212     c     blpnrr        chain     fnblp00f                           90
229380950102     C     *IN90         IFEQ      *OFF
229390940927     C*
229400940927     C* DATA SPEDIZIONE
229410930414     C                   Z-ADD     BLPMGS        BLPDSP
229420930414     C                   MOVEL     BLPAAS        BLPDSP
229430000104     C                   Z-ADD     BLPMGS        WBDSP             8 0
229440000104     C                   MOVEL     BLPAAS        WBDSP
229450940927     C* DATA RITIRO MERCE
229460940927     C                   Z-ADD     BLPDRT        VIDDRT
229470081111     C                   Z-ADD     BLPDRT        s_drtblpi
229480940927     C* DATA CONSEGNA RICHIESTA
229490940927     C                   Z-ADD     BLPDCR        VIDDCR
229500940927     C*
229510960926     C* AUTOTRASPORTATORE
229520950126     C                   MOVE      BLPPDR        SAVPDR
229530990915     C                   MOVE      BLPPDR        SAVPD4
229540940928     C                   MOVE      BLPPDR        VIDPDR
229550010220     C                   MOVE      BLPPDR        PREPDR
229560990915     C                   MOVE      BLPFPP        VIDFPP
229570010220     C                   MOVE      BLPFPP        PREFPP
229580991001     C* SE ERA PREPAGATO, FACCIO ALMENO VEDERE SE MERCE PORTATA A MAG
229590991001     C                   MOVEL     BLPFDN        VIDMAG
229600900511     C*
229610900516     C                   MOVE      BLPNSP        VIDNSP
229620900511     C                   MOVEL     BLPNRS        VIDNRS
229630900511     C                   MOVEL     BLPLNP        VIDLNP
229640910805     C                   MOVEL     BLPFNS        VIDFNS            1
229650040506
229660040506      * Imposto la ds di comodo del n. spedizione
229670040506     c                   Z-add     BlpNsp        WidNsp
229680040506     c                   Z-add     BlpNrs        WidNrs
229690040506     c                   Z-add     BlpLnp        WidLnp
229700040506
229710970128     C* ALLEGA BAM
229720970128     C     BLPFST        IFEQ      'S'
229730970128     C     BLPFST        OREQ      'C'
229740970128     C                   MOVEL     'S'           VIDBAM
229750970128     C                   ELSE
229760970128     C                   MOVEL     'N'           VIDBAM
229770970128     C                   ENDIF
229780970404     C                   MOVEL     BLPFST        SAVBAM
229790940920     C* CODICE BOLLA
229800940920     C                   MOVEL     BLPCBO        VIDCBO
229810081023     C                   MOVEL     BLPCBO        cbo_blp
229820940920     C* SIGLA OPERATORE
229830940920     C                   MOVEL     BLPSOP        VIDSOP
229840900511     C* LINEA ARRIVO E DECODIFICA
229850900511     C                   MOVEL     BLPLNA        VIDLNA
229860070404     C                   MOVEL     BLPLNA        lna_sav
229870960926     C* PUNTO OPERATIVO CLIENTE
229880940927     C     BLPCCM        IFGT      0
229890940927     C                   MOVEL     BLPCCM        W0030
229900940927     C                   MOVE      BLPCCM        VIDCCM
229910940927     C                   MOVEL     BLPCCM        WKSC
229920940927     C                   ELSE
229930940927     C                   MOVEL     BLPKSC        W0030
229940940927     C                   MOVE      BLPKSC        VIDCCM
229950940927     C                   MOVEL     BLPKSC        WKSC
229960940927     C                   ENDIF
229970940927     C* SALVO IL CODICE MITTENTE
229980060515     C                   MOVEL     WKSC          bolksc
229990060515     C                   MOVEL     WKSC          SAVMIT
230000941115     C                   MOVEL     VIDCCM        WCCMS
230010940927     C* PARTITA IVA
230020940927     C                   MOVEL     BLPCPI        WPIVA
230030940929     C*
230040940929     C* VEDO SE C'E' TASSAZIONE
230050991006     C                   MOVEL     '1'           WTRC
230060991006     C     KBLP4         CHAIN     FIAR6000                           30
230070940929    1C     *IN30         IFEQ      *OFF
230080050331     c                   move      ar6ksc        wKSCsf1
230090991006     C                   MOVEL     'E'           WAR61             1
230100050331     c* se c'è cod. S.F. significa che bolla tassata in arrivo:NON DEVO
230110050331     c* CARICARLA
230120050331   1ac                   if        wKSCsf1 = 0000 or wKSCsf1 = 9999
230130940929     C*
230140991012     C                   MOVEL     AR6POR        VIDPOR
230150991012     C                   MOVEL     AR6POR        MEMPOR
230160991006     C                   MOVEL     AR6IMV        VIDIMV
230170991006     C                   MOVEL     AR6IMV        SAVIMV
230180060208     C                   MOVEL     AR6IMV        SAVIMVO
230190151014     C                   MOVEL     AR6IMV        SAVIMV_fat
230200991006     C                   MOVEL     AR6CEI        VIDCEI
230210991008     C                   MOVEL     AR6DIV        VIDDIV
230220991011     C                   MOVEL     AR6DIV        WDIV1
230230940929     C*
230240991006     C                   MOVEL     AR6NFT        SAVNFT
230250991006     C                   MOVEL     AR6NFT        VIDNFT
230260991006     C                   MOVEL     AR6FIV        VIDFIV
230270991006     C                   MOVEL     AR6DFT        VIDDFT
230280060208     C                   MOVEL     AR6DFT        DFTar6
230290991006     C     AR6NFT        IFGT      0
230300991006     C     AR6NFT        ANDLT     §QTNFT
230310990630     C                   SETON                                        22
230320991006     C                   Z-ADD     AR6IFT        VIDIFT
230330990630     C                   ENDIF
230340991027      *
230350940929     C                   Z-ADD     0             NRR
230360011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
230370011025     C     BLPFBR        IFEQ      'S'
230380011025     C                   SELECT
230390011025     C     AR6SV1        WHENEQ    'N'
230400011025     C     AR6VA1        ANDEQ     88888888
230410011025     C                   MOVEL     '1'           FLGVRN            1
230420011025     C     AR6SV2        WHENEQ    'N'
230430011025     C     AR6VA2        ANDEQ     88888888
230440011025     C                   MOVEL     '1'           FLGVRN
230450011025     C     AR6SV3        WHENEQ    'N'
230460011025     C     AR6VA3        ANDEQ     88888888
230470011025     C                   MOVEL     '1'           FLGVRN
230480011025     C                   ENDSL
230490011025     C                   ENDIF
230500991027      *
230510991027     C                   MOVEL     AR6SV1        WSVN
230520991027     C                   Z-ADD     AR6VA1        WVAN
230530940929     C                   EXSR      CARVAR
230540991027      *
230550991027     C                   MOVEL     AR6SV2        WSVN
230560991027     C                   Z-ADD     AR6VA2        WVAN
230570940929     C                   EXSR      CARVAR
230580991027      *
230590991006    2C     AR6SV3        IFNE      ' '
230600991027     C                   MOVEL     AR6SV3        WSVN
230610991027     C                   Z-ADD     AR6VA3        WVAN
230620940929     C                   EXSR      CARVAR
230630941021     C*
230640940929     C* VISTO CHE C'E' LA 3 VARIA VEDO SE CE NE SONO ANCORA
230650991006     C                   MOVEL     '1'           WTRC
230660991006     C     KBLP4         SETLL     FIAR7000
230670991006     C     KBLP4         READE     FIAR7000                               30
230680940929    3C     *IN30         DOWEQ     *OFF
230690011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
230700011025     C     BLPFBR        IFEQ      'S'
230710011025     C     FLGVRN        ANDNE     '1'
230720011025     C     AR7SVN        ANDEQ     'N'
230730011025     C     AR7VAN        ANDEQ     88888888
230740011025     C                   MOVEL     '1'           FLGVRN
230750011025     C                   ENDIF
230760011025      *
230770991006     C                   MOVEL     'E'           WAR7              1
230780991027     C                   MOVEL     AR7SVN        WSVN
230790991027     C                   MOVEL     AR7VAN        WVAN
230800940929     C                   EXSR      CARVAR
230810991006     C     KBLP4         READE     FIAR7000                               30
230820940929    3C                   ENDDO
230830940929    2C                   ENDIF
230840940929     C*
230850941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
230860941020     C     VIDPOR        IFNE      0
230870941020     C     NRR           ORNE      0
230880941020     C     VIDCEI        ORNE      ' '
230890941020     C                   MOVEL     'S'           WEMD03            1
230900941020     C                   ENDIF
230910991006      *
230920991006     C                   CLEAR                   FIAR6000
230930050331   1ac                   endif
230940940929    1C                   ENDIF
230950941107     C* TIPO SERVIZIO
230960941107     C                   MOVEL     BLPTSP        VIDTSP
230970941107     C                   MOVEL     BLPTSP        SAVTSP
230980941115     C                   MOVEL     BLPTSP        VARTSP
230990941115     C* CONSEGNE PARTICOLARI
231000941115     C                   MOVEL     BLPTC1        VIDTC1
231010941115     C                   MOVEL     BLPTC2        VIDTC2
231020091001     c                   movel     blptc1        sav_tc1
231030091001     c                   movel     blptc2        sav_tc2
231040001205     C                   MOVEL     BLPTC1        SAVTC1
231050001205     C                   MOVEL     BLPTC2        SAVTC2
231060140122     C****               MOVEL     BLPTC1        WSVTCP
231070140122     C****               MOVEL     BLPTC1        WTCP
231080940929     C*
231090940929     C* D E C O D I F I C H E
231100940927     C                   EXSR      DECBOL
231101170831     c
231102170831     c                   if        §lpfpr='N'
231103170831     c                   clear                   vidlna
231104170831     c                   endif
231110120926     c* se cod.bolla franco recupero e bolla presente su giacenze in part
231120120926     c* per il recupero delle spese devo disabilitare F16=Annullamento
231130120926     c* Se non voglio più addebitare le spese devono stornare la bolla
231140120926     c* dalla manutenzione bolle di sede
231150120926     c                   if        savrbl='R' and  savtb1='F'
231160120926     C/exec sql
231170120927     c+ Select gcpagc into :wagc
231180120926     c+   from tigcp00f
231190120926     c+   where GCPLPW = :BLPLNP AND GCPASW=:BLPAAS AND GCPNSW=:BLPNRS
231200120927     c+     and GCPNBW = :BLPNSP AND GCPSEDE=' '
231210120926     C/end-exec
231220120926     c                   if        SqlCOD < 0 or sqlCOD = 100
231230120926     c                   else
231240120926      * se qui : ha trovato la giacenza E DISATTIVO QUINDI F16
231250120927     c                   movel     nodi          atrann
231260120926     c                   end
231270120926     c                   endif
231280990702     C* E MANCA LA DATA RITIRO O COD PADR, MI POSIZIONO SULLA DATA
231290990702     C*  RITIRO
231300990702     C     BLPPDR        IFEQ      0
231310990702     C     BLPDRT        OREQ      0
231320990702     C                   SETOFF                                       07
231330040909     c                   z-add     09            h1riga
231340040909     c                   z-add     20            h1colo
231350990702     C                   ENDIF
231360940929     C*
231370950125     C* SALVO LA DECODIFICA DEL TIPO SPEDIZIONE
231380950125     C                   MOVEL     V1DTSP        WDETSP           10
231390940928     C* VEDO SE CARICARE IL MITTENTE O NO
231400941005     C                   MOVEL     *BLANKS       VIDFAP
231410941005    1C     VIDCCM        IFEQ      8888
231420940928     C     VIDCCM        OREQ      9999
231430940928     C                   MOVEL     BLPRSM        VIDRSM
231440940928     C                   MOVEL     BLPINM        VIDINM
231450940928     C                   MOVEL     BLPLOM        VIDLOM
231460940928     C                   MOVEL     BLPCAM        VIDCAM
231470940928     C                   MOVEL     BLPPRM        VIDPRM
231480940928     C                   MOVEL     BLPNZM        VIDNZM
231490941005     C*
231500941005   X1C                   ELSE
231510941005     C*
231520941005     C* CHAIN SU CNACO PER VEDERE SE CAP E NAZIONE DIVERSI
231530941005     C     KACO          CHAIN     CNIND000                           30
231540941005     C*
231550941005    2C     *IN30         IFEQ      *OFF
231560941005    3C     INDCAE        IFNE      BLPCAM
231570941005     C     INDSTA        ORNE      BLPNZM
231580941005     C                   MOVEL     BLPCAM        VIDCMO
231590941005     C                   MOVEL     BLPNZM        VIDNMO
231600941005    3C                   ENDIF
231610941005    2C                   ENDIF
231620941005    1C                   ENDIF
231630910429     C*
231640941005     C* CHAIN PER VEDERE SE ESISTE LA 2 DESCRIZIONE DESTINATARIO
231641170830     c                   clear                   savrsd
231650940927     C                   MOVEL     'D'           WTRC
231660060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
231670940927     C* TROVATA
231680940927     C     *IN30         IFEQ      *OFF
231690060215     C                   MOVE      ar4NOT        VIDRSD
231700060215     C                   MOVE      ar4NOT        SAVRSD
231710940927     C                   ENDIF
231720900511     C                   MOVEL     BLPRSD        VIDRSD
231730910405     C                   MOVEL     BLPRSD        SAVRSD
231740900511     C                   MOVEL     BLPIND        VIDIND
231750070404     C                   MOVEL     BLPIND        savIND
231760900511     C                   MOVEL     BLPPRD        VIDPRD
231770070404     C                   MOVEL     BLPPRD        savPRD
231780910405     C                   MOVEL     BLPCAD        SAVCAD
231790910405     C                   MOVEL     BLPCAD        VIDCAD
231800940930     C                   MOVEL     BLPCAD        VARCAD
231810900511     C                   MOVEL     BLPLOD        VIDLOD
231820070404     C                   MOVEL     BLPLOD        savLOD
231830940927     C                   MOVEL     BLPNZD        VIDNZD
231840020122     C                   MOVEL     BLPNZD        NZDINI
231850911031     C                   MOVEL     BLPCTS        SAVCTS
231860941107     C* CONTROLLO SE IL CLIENTE E' ITALIA O ESTERO
231870941107     C                   MOVEL     BLPNZD        WNAR
231880941107     C                   EXSR      CTRNAR
231890941107     C* NAZIONE CORRETTA
231900941107     C     WEMFOR        IFNE      '1'
231910941107     C     §15ITA        IFEQ      'I'
231920941108     C                   MOVEL     'I'           WDESIE
231930941107     C                   ELSE
231940941108     C                   MOVEL     'E'           WDESIE
231950941107     C                   ENDIF
231960941107     C*
231970941107     C* NAZIONE ERRATA: IMPOSTO SEMPRE "I"
231980941107     C                   ELSE
231990941108     C                   MOVEL     'I'           WDESIE
232000941107     C                   ENDIF
232010941107     C*
232020941107     C* VEDO SE BOLLA ITALIANA O ESTERA
232030971216     C     BLPLNP        CHAIN     AZORG01L      UNIORG               30
232040991203     C                   MOVEL     ORGDE3        OG143
232050000121     C* MEMORIZZO TELEFONO E FAX
232060000121     C                   MOVEL     ORGTEL        LNPTEL           15
232070000121     C                   MOVEL     ORGFAX        LNPFAX           15
232080971210     C**
232090160302     c****               clear                   trul27ds1
232100160302     c****               z-add     BlpPkf        I27Pkg
232110160302     c****               move      BlpCtr        I27Ctb
232120160302     c****               exsr      riccar
232130160302     c****               movel     o27fie        savfie
232140160302     c***                movel     o27ntw        s_27ntw
232150970407     C* MI SERVE PER IL CONFRONTO PER CARICARE I CODICI TARIFFA
232160970407     C     VIDCCM        IFNE      9999
232170940927     C                   MOVEL     WKSC          SAVCCM
232180970407     C                   ELSE
232190970407     C                   CLEAR                   SAVCCM
232200970407     C                   ENDIF
232210940927     C*
232220900607     C                   MOVEL     BLPCTR        VIDCTR
232230060515     C                   MOVEL     BLPCTR        BolCTR
232240150427     C                   MOVEL     blpctr        SAVCTR
232250971210     C* VEDO SE ESISTE NUMERO AWB SOLO PER IMPORTO SDI O EXPORT SDI
232260081008    1c**   §ogntw        ifeq      'EUP'
232270081008     c**   A_§ogntw      oreq      'EUP'
232280081008     C**                 MOVEL     'E'           WTRC
232290081008     C**   KBLP4         CHAIN(N)  Fiar4000                           30
232300081008    2C**   *IN30         IFEQ      *OFF
232310081008     C**                 MOVEL     ar4NOT        DSBL4E
232320081008     C**                 MOVEL     §B4ERP        W010A            10
232330971210     C**
232340081008    3C**   W010A         IFGT      *ZEROS
232350081008     C**                 MOVEL     §B4ERP        V6CAWB
232360081008     C**                 MOVEL     §B4ERP        SAVAWB
232370081008    3C**                 ENDIF
232380971210     C** INSERIMENTO MANUALE
232390081008     C**   §B4EMA        IFEQ      'M'
232400081008     C**                 MOVEL     'MANUALE'     V6CINS
232410081008     C**                 ENDIF
232420971210     C** INSERIMENTO AUTOMATICO
232430081008     C**   §B4EMA        IFEQ      'A'
232440081008     C**                 MOVEL     'AUTOMATI'    V6CINS
232450081008     C**                 MOVE      'CO'          V6CINS
232460081008     C**                 ENDIF
232470971210     C* STAMPATO S/N
232480081008     C**   §B4EST        IFEQ      'S'
232490081008     C**                 MOVEL     'SI'          V6CSTA
232500081008     C**                 ENDIF
232510081008    3C**   §B4EST        IFEQ      'N'
232520081008     C**                 MOVEL     'NO'          V6CSTA
232530081008    3C**                 ENDIF
232540081008    2C**                 ENDIF
232550971210     C**
232560081008    1C**                 ENDIF
232570991203      *
232580060620      * VEDO SE ESISTE NUMERO PARCEL PER IMPORT/EXPORT DPD
232590160323     c                   clear                   w_vediP
232600020319    1C     A_§OGNTW      IFEQ      'DPD'
232610060619    1C     §ogntw        oreq      'DPD'
232620060620     c*
232770060605     C                   MOVEL     'I'           WTRC
232780060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232790991203      *
232800991203    2C     *IN30         IFEQ      *OFF
232810060605     C                   MOVEL     ar4NOT        DSBL4I
232811170927     c                   endif
232820991203      *
232830170927     c***                if        §b4ipn<>*blanks
232840170927     C***                MOVEL     §B4ipn        V7CNPR
232850060619     c* se parcel number lungo 11 aggiungo a video anche il check digit
232860170927     c***                if        %subst(§b4ipn:14:1)=*blanks
232870170927     c***                eval      %subst(v7cnpr:12:1)=§b4icd
232880170927     c***                endif
232890170927     C***                MOVEL     v7cnpr        SAVNPR
232900170927    3C***                ENDIF
232910170927     c***                if        §b4trd='1'
232920170927     c***                eval      w_vediP='1'
232930170927     c***                endif
232931170927     c****               else
232932170921     c     kpnd          chain(n)  fipnd01l
232933170921    3c                   if        %found(fipnd01l)
232934170921    4c                   if        pndipn<>*blanks
232935170921     c                   eval      v7cnpr=pndipn
232936170921     C                   MOVEL     v7cnpr        SAVNPR
232937170921    4c                   endif
232938170921     c                   eval      dpndflo=pndflo
232939170921    4c                   if        §pndtrd='1'
232940170921     c                   eval      w_vediP='1'
232941170921    4c                   endif
232942170921    3c                   endif
232943991203      *
232950170927    2C*****              ENDIF
232960991203    1C                   ENDIF
232970941115     C*
232980941115     C* CARICO LE NOTE
232990941115     C                   MOVEL     '8'           WTRC
233000060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
233010941115     C* TROVATA
233020941115     C     *IN30         IFEQ      *OFF
233030060215     C                   MOVEL     ar4NOT        VIDNT1
233040941115     C*
233050941115     C                   MOVEL     '9'           WTRC
233060060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
233070941115     C* TROVATA
233080941115     C     *IN30         IFEQ      *OFF
233090060215     C                   MOVEL     ar4NOT        VIDNT2
233100941115     C                   ENDIF
233110000124     C                   ENDIF
233120000124     C**
233130000124     C* SE LA PRIMA NOTA E' MESSA IN AUTOMATICO, LA CLEARO
233140000124     C                   MOVEL     VIDNT1        W012A            12
233150000124     C*
233160000124     C     W012A         IFEQ      CDPD
233170000124     C                   CLEAR                   VIDNT1
233180000124     C     VIDNT2        IFNE      *BLANKS
233190000124     C                   MOVEL     VIDNT2        VIDNT1
233200000124     C                   CLEAR                   VIDNT2
233210000124     C                   ENDIF
233220000124     C                   ENDIF
233230000623     C***
233240060216     C* VEDO SE CE' RECORD ar4 W
233250000623     C                   MOVEL     'W'           WTRC
233260060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
233270000623     C  N30              MOVEL     'E'           WBL4W             1
233280121123     C***
233290121123     C* VEDO SE CE' RECORD ar4 Z
233300121123     c                   clear                   wesar4z
233310121123     c                   clear                   wtrasmz
233320121123     c                   clear                   wkscz
233330121123     C                   MOVEL     'Z'           WTRC
233340121123     C     KBLP4         CHAIN(N)  Fiar4000                           30
233350121123     c                   if        not *in30
233360121123     C                   MOVEL     'S'           Wesar4z           1
233370121123     C                   MOVEL     AR4NOT        DSBL4Z
233380121123     c                   if        §B4DTR=0
233390121123     C                   EVAL      WTRASMz='N'
233400121123     C                   ENDIF
233410121123     c                   move      §b4okc        wkscz
233420121123     c                   endif
233430061110     c*
233440061110     C* CARICO il codice fiscale se presente
233450061110     C                   MOVEL     'Q'           WTRC
233460061110     C     KBLP4         CHAIN(N)  Fiar4000                           30
233470061110     C     *IN30         IFEQ      *OFF
233480061110     c                   movel     ar4not        vidcdf
233490061110     c                   endif
233500141201
233510141201     C* CARICO il PIN CODE se presente
233520141201     C                   MOVEL     'Y'           WTRC
233530141201     C     KBLP4         CHAIN(N)  Fiar4000                           30
233540141201     C     *IN30         IFEQ      *OFF
233550141201     c                   movel     ar4not        dsbl4y
233560141201     c                   eval      wpincode=§B4PCD
233570141201     c                   endif
233580950410     c*
233590950410     C* CARICO LE P.IVA MITTENTE E DESTINATARIO
233600950410     C                   MOVEL     'P'           WTRC
233610060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
233620950410     C     *IN30         IFEQ      *OFF
233630950410     C*
233640060215     C                   MOVEL     ar4NOT        WPIVA
233650050921     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
233660050921     c                   select
233670050921     c* solo numeri
233680050921     c* "PRIVATO senza iso
233690050921     c     *in30         wheneq    *off
233700050921     c     wiso          andge     *zeros
233710050921     c     *in30         oreq      *on
233720050921     c     posiz         andlt     3
233730050921     c                   movel     wpiva         vidcpm
233740050921     c* iso + numeri
233750050921     c* iso + "PRIVATO"
233760050921     c     *in30         wheneq    *off
233770050921     c     posiz         orgt      2
233780050921     c                   movel     wpiva         vidpim
233790050921     c                   endsl
233800050921     c
233810950410     C*
233820060215     C                   MOVE      ar4NOT        WPIVA
233830050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
233840050921     c                   select
233850050921     c* solo numeri
233860050921     c* "PRIVATO senza iso
233870050921     c     *in30         wheneq    *off
233880050921     c     wiso          andge     *zeros
233890050921     c     *in30         oreq      *on
233900050921     c     posiz         andlt     3
233910050921     c                   movel     wpiva         vidcpd
233920050921     c* iso + numeri
233930050921     c* iso + "PRIVATO"
233940050921     c     *in30         wheneq    *off
233950050921     c     posiz         orgt      2
233960050921     c                   movel     wpiva         vidpid
233970050921     c                   endsl
233980950410     C*
233990950410     C                   ENDIF
234000900607     C*
234010900604     C* FLAG INOLTRO PULISCO SE NON E' UNA ISOLA
234020900604     C                   MOVEL     ' '           VIDFIN
234030941115     C                   MOVEL     BLPFBR        VIDFBR
234040941115     C                   MOVEL     BLPGC1        VIDGC1
234050900511     C                   MOVEL     BLPGC2        VIDGC2
234060900511     C                   MOVEL     BLPFTM        VIDFTM
234070940927     C                   MOVEL     BLPIAS        VIDIAS
234080940927     C                   MOVEL     BLPVAS        VIDVAS
234090950410     C                   MOVEL     BLPVAS        VARVAS
234100940927     C                   MOVEL     BLPVMD        VIDVMD
234110940927     C                   MOVEL     BLPVAD        VIDVAD
234120950410     C                   MOVEL     BLPVAD        VARVAD
234130940927     C                   MOVEL     BLPQFT        VIDQFT
234140940928     C                   MOVEL     BLPGGA        VIDGGA
234150940928     C                   MOVEL     BLPGMA        VIDGMA
234160091221     c                   eval      wvidgma = blpgma
234170100604     c* Verifico se c'e' ritiro contestuale alla consegna
234180100604     c                   clear                   ds7r
234190100604     C                   MOVEL     '7R'          COD
234200100604     C                   MOVEL(P)  blpGMA        KEY
234210100604     C                   EXSR      CTABEL
234220100604     C  n30              MOVEL     TBLUNI        DS7R
234230100604     c                   eval      w7rRC = §7rRC
234240100604     c
234250960208     C                   CLEAR                   VIDGVA
234260960208     C                   MOVEL     BLPGVA        W001A
234270960208     C                   MOVEL     W001A         VIDGVA
234280900511     C                   MOVEL     BLPNAS        VIDNAS
234290900511     C                   MOVEL     BLPNCL        VIDNCL
234300940819     C                   MOVEL     BLPNCL        V1CNCL
234310930331     C                   MOVEL     BLPNCL        SAVNCL
234320980408     C                   MOVE      BLPNCD        SAVNCD
234330980408     C                   MOVE      BLPNCA        SAVNCA
234340940927     C                   MOVEL     BLPPKB        VIDPKG
234350940927     C                   MOVEL     BLPPKB        V2CPKG
234360980402     C                   MOVEL     BLPPKB        SAVPKG
234370940927     C                   MOVEL     BLPVLB        VIDVOL
234380980402     C                   MOVEL     BLPVLB        SAVVOL
234390090609     c                   movel     blppkb        wpes_pre
234400090609     c                   movel     blpvlb        wvol_pre
234410090609     C                   MOVEL     BLPNCL        wncl_pre
234420930512     C* VEDO RAGGRUPPAMENTO DEL VOLUME
234430940928     C                   MOVEL     BLPFVB        VIDFVR            1
234440930512     C                   MOVEL     '7T'          COD
234450940928     C                   MOVEL(P)  BLPFVB        KEY
234460930708     C                   EXSR      CTABEL
234470930512     C  N30              MOVEL     TBLUNI        DS7T
234480930708     C   30              CLEAR                   DS7T
234490910125     C*
234500900511     C                   MOVEL     BLPRMN        VIDRMN
234510060619     C******             MOVEL     BLPRMN        savrmn
234520940825     C                   MOVEL     BLPRMA        VIDRMA
234530940922     C                   MOVEL     BLPRMA        SAVRMA
234540900511     C                   MOVEL     BLPRMO        VIDRMO
234550900511     C                   MOVEL     BLPNCD        VIDNCD
234560900511     C                   MOVEL     BLPNCA        VIDNCA
234570960808     C                   MOVEL     BLPNCD        WNSNCD
234580960808     C                   MOVEL     BLPNCA        WNSNCA
234590900511     C                   MOVEL     BLPZNC        VIDZNC
234600930401     C                   MOVEL     BLPZNC        VARZNC
234610930402     C                   MOVEL     BLPZNC        SAVZNC
234620900511     C                   MOVEL     BLPCTM        VIDCTM
234630900511     C                   MOVEL     BLPFFD        VIDFFD
234640930401     C                   MOVEL     BLPFFD        VARFFD
234650010214     C     BLPFFD        IFEQ      *BLANKS
234660010214     C                   MOVEL     'N'           VIDFFD
234670010214     C                   MOVEL     'N'           VARFFD
234680010214     C                   ENDIF
234690910114     C*
234700900516     C                   MOVEL     BLPNFV        VIDNFV
234710910114     C                   MOVEL     BLPTCR        VIDTCR
234720940927     C                   MOVEL     BLPHCR        VIDHCR
234730940927     C                   MOVE      BLPHCR        VIDMCR
234740900516     C* GIRO DATA BORDERO
234750940927     C                   CLEAR                   WLBDAT
234760950107     C                   MOVEL     '3'           G02ERR
234770940927     C                   Z-ADD     BLPDBR        G02INV
234780940927     C                   CALL      'XSRDA8'
234790940927     C                   PARM                    WLBDAT
234800940927     C                   Z-ADD     G02DAT        VIDDBR
234810940928     C* VEDO SE ESISTE C/A
234820940928     C     §3AFCA        IFNE      0
234830051115     C     KBLP3         CHAIN     Fiar9000                           30
234840940928     C     *IN30         IFEQ      *OFF
234850051115     C                   MOVEL     'E'           War9              1
234860051115     C                   Z-ADD     ar9CAS        VIDCAS
234870051115     C                   MOVEL     ar9TIC        VIDTIC
234880051115     C                   MOVEL     ar9GCA        VIDGCA
234890051115     C                   MOVEL     ar9VCA        VIDVCA
234900051115     C                   MOVEL     ar9VCA        VARVCA
234910940928     C                   ENDIF
234920940928     C                   ENDIF
234930940928     C*
234940900517     C* SE ESISTE AGGANCIO 2° BOLLA
234950991006     C                   MOVEL     '2'           WTRC
234960991006     C     KBLP4         CHAIN     FIAR6000                           30
234970940927    1C     *IN30         IFEQ      *OFF
234980050331     c                   move      ar6ksc        wKSCsf2
234990991006     C                   MOVEL     'E'           WAR62             1
235000040114
235010050331   1ac                   if        wKSCsf2 = 0000 or wKSCsf2 = 9999
235020040114     c                   Z-add     Ar6Va1        Vi2Va1
235030040116     c                   Z-add     Ar6Va1        Va2va1
235040991006     C                   MOVEL     AR6SV1        VI2SV1
235050040114     c                   Z-add     Ar6Va2        Vi2Va2
235060040114     c                   Z-add     Ar6Va2        Va2Va2
235070040114     c                   Movel     Ar6Sv2        Vi2Sv2
235080040114     c                   Z-add     Ar6Va3        Vi2Va3
235090040114     c                   Z-add     Ar6Va3        Va2Va3
235100040114     c                   Movel     Ar6Sv3        Vi2Sv3
235110040126     c                   Z-add     Ar6Imv        Vi2Imv
235120040114      * Vedo se ci sono altre varie su FIAR7
235130040114     c                   Eval      wtrc = '2'
235140041217     c                   clear                   contasv
235150040114     c     Kblp4         Setll     Fiar7000
235160040114     c                   Do        *Hival
235170040114     c     Kblp4         Reade     Fiar7000
235180040114     c                   If        %Eof(Fiar701l)
235190040114     c                   Leave
235200040114     c                   EndIf
235210040114     c                   Eval      war71 = 'E'
235220041217     c                   select
235230041217     c                   when      contasv = 0
235240040114     c                   Movel     Ar7Svn        Vi2Sv4
235250040114     c                   Z-add     Ar7Van        Vi2Va4
235260040114     c                   Z-add     Ar7Van        Va2Va4
235270041217     c                   add       1             contasv
235280041217     c                   when      contasv = 1
235290041217     c                   Movel     Ar7Svn        Vi2Sv5
235300041217     c                   Z-add     Ar7Van        Vi2Va5
235310041217     c                   Z-add     Ar7Van        Va2Va5
235320041217     c                   add       1             contasv
235330041217     c                   when      contasv = 2
235340041217     c                   Movel     Ar7Svn        Vi2Sv6
235350041217     c                   Z-add     Ar7Van        Vi2Va6
235360041217     c                   Z-add     Ar7Van        Va2Va6
235370040114     c                   Leave
235380041217     c                   endsl
235390040114     c                   EndDo
235400040114
235410991006     C                   MOVEL     AR6CEI        VI2CEI
235420991008     C                   MOVEL     AR6DIV        VI2DIV
235430991011     C                   MOVEL     AR6DIV        WDIV2
235440940927     C* SE ESISTE ESENZIONE IVA DECODIFICO
235450991006    2C     VI2CEI        IFNE      *BLANKS
235460940927     C                   MOVEL     'EI'          COD
235470940927     C                   MOVEL(P)  VI2CEI        KEY
235480940927     C                   EXSR      CTABEL
235490940927     C  N30              MOVEL     TBLUNI        V2DCEI
235500940927    2C                   ENDIF
235510980120     C**
235520050407     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
235530050407     C     VI2imv        IFNE      0
235540050407     C     vi2va1        ORNE      0
235550050407     C     vi2va2        ORNE      0
235560050407     C     vi2va3        ORNE      0
235570050407     C     vi2va4        ORNE      0
235580050407     C     vi2va5        ORNE      0
235590050407     C     vi2va6        ORNE      0
235600050407     C     VI2CEI        ORNE      ' '
235610050407     C                   MOVEL     'S'           WEMD03            1
235620050407     C                   ENDIF
235630050407     c*
235640991006     C                   CLEAR                   FIAR6000
235650050331   1ac                   endif
235660940927    1C                   ENDIF
235670941011     C*
235680941011     C* METTO IL NUMERO DI SPEDIZIONE IN 1 VIDEATA
235690941011     C                   Z-ADD     BLPNRS        PRENRS
235700941011     C                   Z-ADD     BLPNSP        PRENSP
235710941011     C                   MOVEL     BLPLNA        PRELNA
235720941011     C                   Z-ADD     BLPRMN        PRERMN
235730941011     C                   Z-ADD     BLPZNC        PREZNC
235740160225
235750160225      * Aggancio file estensione Fiar500f record "GEN" per recuperare
235760160225      * il referente e il telefono e v-valore
235770160225     c                   Clear                   DAr5Gen
235780160225     c                   clear                   w_ar5tcp
235790160225     c                   clear                   w_ar5als
235800160225     c                   clear                   w_ar5alx
235810160225     c                   clear                   w_aDpd
235820160225     c                   Eval      kAr5Trd = 'GEN'
235830160225     c     KFiar5        Chain(n)  Fiar501l
235840160225     c                   If        %Found(Fiar501l)
235850160225     c                   Movel     Ar5Uni        DAr5Gen
235860160225     c                   EndIf
235870160225     c                   Eval      VidRef = §Ar5Ref
235880160225     c                   Eval      VidTel = §Ar5Teld
235890160225     c                   Eval      Vidbva = §Ar5bva
235900160225     c                   eval      savbva = §ar5bva
235910160225     c                   eval      w_ar5tcp=§ar5tcp
235920160225     c                   eval      w_ar5als=§ar5als
235930160225     c                   eval      w_ar5alx=§ar5alx
235940160301     c                   eval      w_aDpd=§ar5fDpd
235950000913     C*
235960000913     C* SE DISK C CARICO COD.CHI SONO NEL SUBFILE
235970000913     C                   SETOFF                                       96
235980000918     C* PRENDO CTM
235990000918     C                   MOVE      '1B'          COD
236000000918     C                   MOVEL(P)  VIDCTM        KEY
236010000918     C                   EXSR      CTABEL
236020000918     C  N30              MOVEL     TBLUNI        DS1B
236030000918     C   30              CLEAR                   DS1B
236040000918     C*
236050160302     c                   clear                   wtip
236060160226     c* Disk "C" no DPD
236070160226     c                   if        (§1bf12<>'N' and
236080160226     c                              A_§OGNTW<>'DPD' and §ogntw<>'DPD' )
236090160226     c                             or
236100160226     c* Disk C export dpd con numero parce automatico (da f13 o forzatura instra
236110160226     c* damento)
236120160226     c                             (§1BF12<>'N' and A_§OGNTW='DPD' and
236130160226     c                              (§1bf13='A' or w_adpd='S'))
236140160226     c                             or
236150160226     c                             (§1bf12='B' and A_§OGNTW='DPD')
236160000913     C* Attivo F22=Manutenzione cod."Chi Sono"
236170000913     C                   SETON                                        96
236180000913     C                   MOVEL     'C'           WTRC
236190000913     C                   Z-ADD     0             NR8
236200120817     C**   KBLT1         SETLL     FNBLT01L
236210120817     C**   KBLT1         READE(N)  FNBLT01L                               30
236220120817     C     KBLT1         SETLL     FIART01L
236230120817     C     KBLT1         READE(N)  FIART01L                               30
236240000913    3C     *IN30         DOWEQ     *OFF
236250120817     C***  KARS1         CHAIN(N)  FIARS01L                           30
236260120817     C     KARS1A        CHAIN(N)  FIARS01L                           30
236270051102     C  N30              EXSR      CARARS
236280120817     C**   KBLT1         READE(N)  FNBLT01L                               30
236290120817     C     KBLT1         READE(N)  FIART01L                               30
236300000913    3C                   ENDDO
236310000913     C     NR8           IFGT      0
236320000913     C                   SETON                                        78
236330000913     C                   ENDIF
236340000918     C                   Z-ADD     NR8           SAVNR8
236350000913    2C                   ENDIF
236360070322     c* se bolla export dpd con numero parcel non automatico verifico
236370070322     c* se chi sono diverso dal numero parcel ed in questo caso memoriz
236380070323     c* zo nel subfile ma non abilito l'f22
236390070322     C     §1BF12        ifNE      'N'
236400070322     C     A_§OGNTW      ANDEQ     'DPD'
236410070322     C     §1BF13        ANDne     'A'
236420140715     C     §1BF12        ANDne     'B'
236430160225     c     w_aDpd        andne     'S'
236440070322     C                   Z-ADD     0             NR8
236450070322     C                   MOVEL     'C'           WTRC
236460120817     C***  KBLT1         chain(N)  FNBLT01L
236470120817     c***                if        %found(fnblt01l)
236480120817     C***  KARS1         CHAIN(N)  FIARS01L
236490120817     C     KBLT1         chain(N)  FIART01L
236500120817     c                   if        %found(fiart01l)
236510120817     C     KARS1A        CHAIN(N)  FIARS01L
236520070322     c                   if        %found(fiars01l)
236530070322     c                             and arsnot<>v7cnpr
236540070322     c                   exsr      carars
236550070322     c                   eval      wparcel='12'
236560070322     C                   SETON                                        78
236570070322     c                   endif
236580070322     c                   endif
236590070322     C                   Z-ADD     NR8           SAVNR8
236600070322     c                   endif
236610160302     c* Determino il fie
236620160302     c                   clear                   trul27ds1
236630160302     c                   z-add     BlpPkf        I27Pkg
236640160302     c                   movel     vidtsp        i27tsp
236650160302     c                   z-add     vidlnp        i27lnp
236660160302     c                   z-add     comlna        i27lna
236670160302     c                   z-add     savmit        i27cli
236680160302     c* tipo tariffa per export FED
236690160302     c                   if        wtip='FM' or wtip='FD'
236700160302     c                   move      wtip          i27tip
236710160302     c                   endif
236720160302     c                   call      'TRUL27R1'
236730160302     c                   parm                    trul27ds1
236740160302     c                   movel     o27fie        savfie
236750160302     c                   movel     o27ntw        s_27ntw
236760010209     C* PRENDO NUMERO ORM SE PRESENTE
236770010209     C                   MOVEL     'M'           WTRC
236780060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
236790060215     C  N30              MOVEL     ar4NOT        DSBL4M
236800010209     C   30              CLEAR                   DSBL4M
236810061122     c                   movel     dsbl4m        S_dsbl4m
236820010209     C                   Z-ADD     §B4POE        VIDPOE
236830010222     C                   MOVEL     §B4NSR        VIDNOR
236840010222     C                   MOVE      §B4NOR        VIDNOR
236850010209     C                   Z-ADD     §B4NRV        VIDNRV
236860010215     C                   MOVEL     VIDORM        W01ORM
236870011126     C                   MOVEL     '1'           WOVUO
236880070427     C                   MOVEL     '1'           WOVUO1
236890011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
236900011126     C                   Z-ADD     VIDPOE        WOPOE
236910011126     C                   Z-ADD     VIDNOR        WONOR
236920011126     C                   Z-ADD     VIDNRV        WONRV
236930091008
236940011126     C                   CLEAR                   DORM01
236950090327     c                   clear                   s_ormksc
236960090327     c                   clear                   s_ormctr
236970011126     C     KORM          CHAIN     FNORM01L                           30
236980011126     C  N30              MOVEL     ORMFLO        DORM01
236990090327     c  n30              z-add     ormksc        s_ormksc
237000090327     c  n30              move      ormctr        s_ormctr
237010011126     C     §ORMFD        IFEQ      'S'
237020011126     C                   MOVEL     PROT          ATRDES
237030011126     C                   ELSE
237040011126     C                   CLEAR                   ATRDES
237050011126     C                   ENDIF
237060021218      * Aggancio file estensione Fiar500f record "BAN" per recuperare i
237070021218      * bancali
237080030704     c                   If        %subst(VidGva:1:1) = 'B'
237090021218     c                   Clear                   DAr5Ban
237100030704     c                   Eval      kAr5Trd = 'BAN'
237110021218     c     KFiar5        Chain(n)  Fiar501l
237120021218     c                   If        %Found(Fiar501l)
237130021218     c                   Movel     Ar5Uni        DAr5Ban
237140021218     c                   EndIf
237150021220     c                   If        §Ar5Tba > *Zeros
237160021218     c                   Movel     §Ar5Tba       VidTba
237170021220     c                   EndIf
237180021218     c                   Eval      VidNba = §Ar5Nba
237190030204     c                   Eval      SavNba = §Ar5Nba
237200021220     c                   If        §Ar5Tb2 > *Zeros
237210021220     c                   Movel     §Ar5Tb2       VidTb2
237220021220     c                   EndIf
237230021218     c                   Eval      VidNb2 = §Ar5Nb2
237240030204     c                   Eval      SavNb2 = §Ar5Nb2
237250030704     c                   EndIf
237260030704
237270030704      * Aggancio file estensione Fiar500f record "BNB" per recuperare i
237280030704      * bancali e i colli originali
237290030704     c                   If        %subst(VidGva:1:1) = 'O'
237300030704     c                   Clear                   DAr5Bnb
237310030704     c                   Eval      kAr5Trd = 'BNB'
237320030704     c     KFiar5        Chain(n)  Fiar501l
237330030704     c                   If        %Found(Fiar501l)
237340030704     c                   Movel     Ar5Uni        DAr5Bnb
237350030704     c                   EndIf
237360030704     c                   If        §Ar5bTba > *Zeros
237370030704     c                   Movel     §Ar5bTba      VidTba
237380030704     c                   EndIf
237390030704     c                   Eval      VidNba = §Ar5bNba
237400030704     c                   Eval      SavNba = §Ar5bNba
237410030704     c                   If        §Ar5bTb2 > *Zeros
237420030704     c                   Movel     §Ar5bTb2      VidTb2
237430030704     c                   EndIf
237440030704     c                   Eval      VidNb2 = §Ar5bNb2
237450030704     c                   Eval      SavNb2 = §Ar5bNb2
237460030704     c                   Eval      w03cor = §Ar5bCor
237470030704     c                   Eval      w03csf = §Ar5bCsf
237480030708     c                   Eval      savw03cor = §Ar5bCor
237490030708     c                   Eval      savw03csf = §Ar5bCsf
237500030704     c                   EndIf
237510031113      * Aggancio file estensione Fiar500f record "GEN" per recuperare
237520040610      * il referente e il telefono e v-valore
237530160225     c* Spostate prima delle considerazioni Disk C perchè mi serviva
237540160225     c* flag FORZATURA INSTRADAMENTO DA EEX A DPD §ar5fdpd
237550160225     c*                  Clear                   DAr5Gen
237560160225     c*                  clear                   w_ar5tcp
237570160225     c*                  clear                   w_ar5als
237580160225     c*                  clear                   w_ar5alx
237590160225     c*                  clear                   w_aDpd
237600160225     c*                  Eval      kAr5Trd = 'GEN'
237610160225     c*    KFiar5        Chain(n)  Fiar501l
237620160225     c*                  If        %Found(Fiar501l)
237630160225     c*                  Movel     Ar5Uni        DAr5Gen
237640160225     c*                  EndIf
237650160225     c*                  Eval      VidRef = §Ar5Ref
237660160225     c*                  Eval      VidTel = §Ar5Teld
237670160225     c*                  Eval      Vidbva = §Ar5bva
237680160225     c*                  eval      savbva = §ar5bva
237690160225     c*                  eval      w_ar5tcp=§ar5tcp
237700160225     c*                  eval      w_ar5als=§ar5als
237710160225     c*                  eval      w_ar5alx=§ar5alx
237720160225     c*                  eval      §ar5fDpd=w_aDpd
237730091211     c                   eval      nochkticC=*off
237740091112     c* window scelta beneficiario contrassegno: se presente codice su
237750091112     c* fiar5 rek gen imposto opportunamente campo scelta beneficiario C/A
237760091118     c                   if        dateu>=§vpocas
237770091119     c                   if        §ar5cdi<>*blanks
237780091112     c                   eval      wcassel2='X'
237790091211     c                   eval      nochkticC=*on
237800091112     c                   else
237810091127     C                   CLEAR                   DS1a
237820091127     c                   if        vidtic<>*blanks
237830091127     C                   MOVEL     '1A'          COD
237840091127     C                   MOVEL(P)  vidtic        KEY
237850091127     C                   EXSR      CTABEL
237860091127     C  N30              MOVEL     TBLUNI        DS1a
237870091127     c                   endif
237880091112     c                   if        §3afca<>0 and *in04 and widor1>0
237890091112     c                             and ormpag='O'
237900091204     c                             and §1amro<>'S'
237910091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
237920091112     c                                 %editc(ormksc:'X')
237930091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
237940091112     c                                 %subst(%editc(ormcor:'X'):1:7)
237950091112     c                   eval      wcassel1='X'
237960091211     c                   eval      nochkticC=*on
237970091112     c                   endif
237980091112     c                   endif
237990091118     c                   endif
238000110512      * Aggancio file estensione Fiar500f record "EMD" per recuperare indirizzo
238010130315      * email destinatario e numero di telefono per sms
238020110512     c                   Clear                   DAr5emd
238030110512     c                   Eval      kAr5Trd = 'EMD'
238040110512     c     KFiar5        Chain(n)  Fiar501l
238050110512     c                   If        %Found(Fiar501l)
238060110512     c                   Movel     Ar5Uni        DAr5Emd
238070110512     c                   Eval      wemdest = §Ar5eml
238080160511     c                   Eval      sav_wemdest = §Ar5eml
238090130918     c* Per il momento e fino ache non ci sarà la storicicazione di
238100130918     c* varizioni di email destinatario impedisco la variazione se
238110130918     c* già inviata email
238120150213     c***                if        wemdest<>*blanks and §ar5dto=*blanks
238130150213     c***                clear                   atremd
238140150213     c***                clear                   atrwemd
238150150213     c***                endif
238160130315     c                   Eval      wsms    = §Ar5tel
238170160511     c                   Eval      sav_wsms    = §Ar5tel
238180140423     c* Per il momento e fino ache non ci sarà la storicicazione di
238190140423     c* varizioni di tel destinatario impedisco la variazione se
238200140423     c* già inviato sms
238210150213     c***                if        wsms   <>*blanks and §ar5dos=*blanks
238220150213     c***                clear                   atremd
238230150213     c***                clear                   atrwtel
238240150213     c****               endif
238250130315     c                   Eval      wsmp    = §Ar5smp
238260130923     c                   Eval      wmmp_ar5= §Ar5mmp
238270110512     c                   EndIf
238280110706     C* Aggancio fiar4 record "4" perr recuperare codici cup e cig
238290110706     C                   MOVEL     '4'           WTRC
238300110706     C     KBLP4         CHAIN(N)  Fiar4000                           30
238310110706     C  N30              MOVEL     ar4NOT        DSBL44
238320110706     C   30              CLEAR                   DSBL44
238330110706     c                   if        §b44cup<> *blanks or §b44cig<>*blanks
238340110706     c                   movel     §b44cup       wcupcup
238350110706     c                   movel     §b44cig       wcupcig
238360110706     c                   endif
238370090326     C* Manutenzione bolle: se sono in manutenzione bolle devo eventualmente
238380090326     c* completare la videata prendendo ksc/ctr memorizzati su data base
238390090326     c* se bolla avente sigla operatore presente in tabella 3M proteggo sempre
238400090326     c* perchè potebbe trattarsi di codici inseriti in automatico in fase di
238410090326     c* bolettazione in quanto passati da chiamante
238420090326     c                   if        *in04
238430090326     c                   exsr      sr_daar4a
238440130918     c                   endif
238450091112     c
238460160126     c* Verifico se presenti disposizioni per la consegna (variazioni o R.A.)
238470160126     c* da segnalare
238480160120     c                   clear                   wf10
238490160126     c                   eval      at0fva=nodi
238500160126     c                   clear                   wf16
238510160126     c                   eval      at0fra=nodi
238520160120     C     Kblp3         SETLL     FiARBF2C
238530160120     c                   if        %equal(fiarbf2c)
238540160126     c* Presenti variazioni --> attivo F10 e verifico se presente R.A.
238550160126     c                   clear                   at0fva
238560160120     c                   eval      wf10='S'
238570160126     c                   eval      wdna2lnp = §lplnp
238580160126     c                   eval      wdna2nrs = §lpnrs
238590160126     c                   eval      wdna2nsp = §lpnsp
238600160126     c                   eval      wdna2aas = §lpaas
238610160126     c                   eval      TGDtor  = 'S'
238620160126     c                   eval      TGDogg  = ds_OggSped
238630160126     c     K02TGD02      setll     FITGD000
238640160303     c                   if        %equal(fitgd32l)
238650160126     c                   clear                   at0fra
238660160126     c                   eval      wf16='S'
238670160126     c                   endif
238680160126     c                   else
238690160126     c* non sono presenti variazioni: verifico se presenti dispo di
238700160126     c* consegna --> se richiesto dirottamento c'è R.A. senza variazioni
238710160126     c* N.B.: non si può attivare l'F16=R.A. a prescindere dalla presenza o
238720160203     c* meno di variazioni/dispo di consegna in quanto le
238730160126     c* R.A. si possono generare anche in partenza a fronte di variazione
238740160126     c* colli o lna  (v.di routine sr_wrtRA ) e queste non sono da considerare
238750160126     c* disposizioni per la consegna
238760160126     c     kblp3         setll     tiidc01l
238770160203     c     kblp3         reade     tiidc01l
238780160203     c                   dow       not %eof(tiidc01l)  and wf16=' '
238790160203     c* solo se dispo aperta chaino relativa r.a. e solo se aperta anche
238800160203     c* quest'ultima attivo f16
238810160203     c                   if        idceladata=0
238820160203     c     ktgd01        chain     fitgd01l
238830160203     c                   if        %found(fitgd01l) and TGDDCD=0
238840160126     c                   clear                   at0fra
238850160126     c                   eval      wf16='S'
238860160203     c                   endif
238870160203     c                   endif
238880160203     c     kblp3         reade     tiidc01l
238890160203     c                   enddo
238900160120     c                   endif
238910000913     C*
238920950102     C                   ENDIF
238930061212     C                   ENDIF
238940900511     C                   ENDSR
238950011025     C*
238960011025      *--- TASSAZIONE VARIA 'N' --------------------------------------*
238970011025     C     TASSAN        BEGSR
238980011025      *
238990011025     C                   CLEAR                   DTAS
239000011025     C                   CLEAR                   DTASV
239010011025     C                   Z-ADD     BLPKSC        TASKSC
239020011025     C                   Z-ADD     BLPCTR        TASCTR
239030011025     C                   Z-ADD     BLPPKF        TASPKF
239040160530     C                   Z-ADD     BLPPKb        TASPKb
239050011025     C                   MOVEL     BLPLNP        TASLNP
239060011025     C                   MOVEL     BLPCTS        TASCTS
239070011025     C                   MOVEL     BLPDSP        TASDSP
239080011025     C                   MOVEL     BLPDSP        TASDCT
239090011025     C                   MOVEL     BLPVLF        TASVLF
239100160530     C                   MOVEL     BLPfvF        TASfvF
239110011025     C                   MOVEL     BLPTSP        TASTSP
239120011025     C     WBOL          IFEQ      '1'
239130011025     C                   MOVEL     §3ATB1        TASTBL
239140011025     C                   ELSE
239150011025     C                   MOVEL     §3ATB2        TASTBL
239160011025     C                   ENDIF
239170011025     C                   MOVEL     BLPLNA        TASLNA
239180011025     C                   MOVEL     BLPNCL        TASNCL
239190160530     C                   MOVEL     BLPNCL        TASNCLb
239200011025     C                   MOVEL     BLPQFT        TASQFT
239210011025     C     WBOL          IFEQ      '1'
239220011025     C     §3AFCA        ANDEQ     1
239230011025     C     WBOL          OREQ      '2'
239240011025     C     §3AFCA        ANDEQ     2
239250051115     C                   MOVEL     ar9CAS        TASCAS
239260051115     C                   MOVEL     ar9VCA        TASVCA
239270051115     C                   MOVEL     ar9TIC        TASTIC
239280011025     C                   ENDIF
239290011025     C                   MOVEL     BLPIAS        TASIAS
239300011025     C                   MOVEL     BLPVAS        TASVAS
239310011025     C                   MOVEL     BLPCAD        TASCAD
239320011025     C                   MOVEL     BLPNZD        TASNZD
239330011025     C                   MOVEL     BLPFIN        TASFIN
239340011025     C                   MOVEL     BLPCAM        TASCAM
239350011025     C                   MOVEL     BLPNZM        TASNZM
239360011025     C                   MOVEL     BLPFAP        TASFAP
239370011025     C                   MOVEL     BLPTC1        TASTC1
239380011025     C                   MOVEL     BLPTC2        TASTC2
239390011025     C     BLPFST        IFEQ      'S'
239400011025     C     BLPFST        OREQ      'C'
239410011025     C                   MOVEL     'S'           TASDDT
239420011025     C                   ELSE
239430011025     C                   MOVEL     'N'           TASDDT
239440011025     C                   ENDIF
239450061002     c*****              movel     blpfbr        §tasflo
239460061002     c* Passo nella DTAS01 il blpfbr
239470061002     c                   clear                   dtas01
239480061002     c                   movel     blpfbr        §asfbr
239490061002     c                   movel(P)  dtas01        §tasflo
239500011025      **
239510011025      * SE BOLLA EXPORT--> NON PASSO MAI IL FLAG CONSEGNA A MAGAZZINO
239520011025      *                    IN MODO CHE TASSI SEMPRE LA VARIA 'U'
239530020219     C     A_§ogntw      ifeq      'COR'
239540020219     c     A_§ogntw      oreq      'MES'
239550020219     c     A_§ogntw      oreq      'PPT'
239560011025     C                   MOVEL     BLPFDN        TASFDN
239570011025     C                   ENDIF
239580011025      **
239590011025      * CHAIN SU CAPPARIO PER PRENDERE COD TASSAZIONE MITTENTE
239600011025     C                   CLEAR                   DSSI95
239610011025     C                   MOVEL     BLPLOM        I95LOC
239620011025     C                   MOVEL     BLPCAM        I95CAP
239630011025     C                   MOVEL     BLPNZM        I95NAR
239640011025     C                   MOVEL     '3'           I95TCN
239650011025     C                   MOVEL     BLPDSP        I95DAT
239660011025     C     §3AFCA        IFNE      0
239670011025     C                   MOVEL     'S'           I95FCA
239680011025     C                   ENDIF
239690011025     C                   MOVEL     §3ATB1        I95TPO
239700020305     c* se network fedex passo flag apposito per dire di prendere i dati
239710020305     c* dalla tabella della nazione
239720020305     c     §ogntw        ifeq      'FED'
239730020305     c                   movel     'S'           i95fi1
239740020305     c                   endif
239750011025     C                   CALL      'TISI95R'
239760011025     C                   PARM                    DSSI95
239770011025     C     O95ERR        IFEQ      *BLANKS
239780011025     C                   MOVEL     O95CTS        TASMCT
239790011025     C                   ENDIF
239800011025     C                   MOVEL     'S'           WCAL13            1
239810020218      * ELABORO E CHIUDO CON RT IL PGM
239820011025     C                   MOVEL     ' '           TASTLA
239830011212     C* DATA TASSAZIONE = 0    : SE STO TASSANDO LA VARIA "N" NON E'
239840011121     C*                          POSSIBILE CHE LA BOLLA SIA GIA' FATTU-
239850011121     C*                          RATA
239860021002     c* imposto peso vdl e colli rilevati
239870030204     c                   z-add     blpncp        Tasncp
239880030204     c                   z-add     blppkc        Taspkc
239890030204      * Bancali
239900030205If  1c                   If        %Subst(VidGva:1:1) ='B'
239910030204     c                   Eval      TasBan = VidNba + VidNb2
239920030205     c                   EndIf
239930030728      * Colli originali
239940030728If  1c                   If        %Subst(VidGva:1:1) ='O'
239950030728     c                   Eval      TasNcl = W03Cor
239960030728     c                   EndIf
239970011025      *
239980011025     C                   CALL      'TNSF20R'
239990011025     C                   PARM                    KPJBA
240000011025     C                   PARM                    DTAS
240010011025     C                   PARM                    DTASV
240020011025      *
240030011025      * Tassazione andata buon fine
240040011025     C     TASERR        IFEQ      *BLANKS
240050011025      *
240060011025      * Controllo la divisa della tassazione con la divisa del video
240070011025      * se non corrispondono devo convertire la varia 'N' nella divisa
240080011025      * del video
240090011025     C     TASDIV        IFNE      VIDDIV
240100011025      * aggancio la tabella CV per sicurezza
240110011025     C                   CLEAR                   DSCV
240120011025     C                   MOVEL     'CV'          COD
240130011025     C                   MOVEL(P)  VIDDIV        KEY
240140011025     C                   EXSR      CTABEL
240150011025     C  N30              MOVEL     TBLUNI        DSCV
240160011025      *
240170011025     C                   CLEAR                   DSYEUR
240180011025     C                   MOVEL     TASDIV        YECDVI
240190011025     C                   MOVEL     VIDDIV        YECDVO
240200011025     C                   Z-ADD     TASIMV        YECIMI
240210011025     C     §CVFDC        IFEQ      'S'
240220011025     C                   MOVE      '3'           YECDCO
240230011025     C                   ELSE
240240011025     C                   MOVE      '0'           YECDCO
240250011025     C                   ENDIF
240260011025     C                   CALL      'YEURCO'
240270011025     C                   PARM                    DSYEUR
240280011025     C     YECESI        IFEQ      ' '
240290011025     C                   Z-ADD     YECIMO        TASIMV
240300011025     C                   ELSE
240310011025     C                   Z-ADD     88888888      TASIMV
240320011025     C                   ENDIF
240330011025     C                   ENDIF
240340011025      *
240350011025     C                   Z-ADD     TASIMV        V3CVA1
240360011025     C                   ENDIF
240370011025      *
240380011025     C                   ENDSR
240390901031     C*
240400901031     C*--- TASSAZIONE BOLLA ------------------------------------------*
240410901031     C     TASSAZ        BEGSR
240420991012      *
240430991007     C                   CLEAR                   DTAS
240440020503     C                   CLEAR                   WTASSA            1
240450030623     C                   CLEAR                   WTASSAD           1
240460030623     C                   CLEAR                   ITASSA           11 3
240470941219     C*
240480941219     C                   MOVEL     VIDCTR        TASCTR
240490990701     C* SE E' FRANCO CODIFICATO SEMPRE CODICE CLIENTE
240500941219    1C     *IN04         IFEQ      *OFF
240510941219     C                   MOVEL     WKSC          TASKSC
240520990701     C* PER 8888 IMPOSTO LA TARIFFA DI TASSAZIONE DEI PREPAGATI
240530990701   1AC     VIDCCM        IFEQ      8888
240540990610     C*
240550990610     C* PER PREPAGATI CERCO LA TARIFFA GIUSTA
240560020117      *
240570020117      * Non più, prendere sempre la tariffa di cartello
240580990610     C**
240590160219     c***                z-add     o27ksc        tasksc
240600160219     c***                z-add     o27ctr        tasctr
240610160322     c***                z-add     oc7kscc       tasksc
240620160322     c***                z-add     oc7ctrc       tasctr
240630990610     C**
240640990701   1AC                   ENDIF
240650990701    1C                   ENDIF
240660941219     C*
240670941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
240680941219    1C     *IN04         IFEQ      *ON
240690991007      *
240700941219    2C     SAVFTM        IFEQ      'S'
240710941219     C     VIDFTM        OREQ      'S'
240720941219     C                   MOVE      WKSC          TASKSC
240730941219   X2C                   ELSE
240740941219     C*
240750941219     C* SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
240760941219     C                   MOVEL     COMLNA        TASKSC
240770941219     C                   MOVE      9999          TASKSC
240780941219     C                   Z-ADD     0             TASCTR
240790941219    2C                   END
240800941219    1C                   END
240810941219     C                   MOVEL     VIDCAM        TASCAM
240820991014     C                   MOVEL     VIDNZM        TASNZM
240830990610    1C     APDFCM        IFNE      ' '
240840941230     C                   MOVEL     'C'           TASFAP
240850941230     C                   ELSE
240860941230     C                   MOVEL     COMFAP        TASFAP
240870990610    1C                   END
240880941219     C*
240890941219     C* FLAG INOLTRO
240900990610     C*
240910941219     C                   EXSR      INOLTR
240920941219     C                   MOVEL     WFIN          TASFIN
240930941219     C                   MOVEL     VIDCAD        TASCAD
240940991014     C                   MOVEL     VIDNZD        TASNZD
240950941219     C*
240960160530     C                   movel     vidfvr        tasfvf
240970160530     C                   Z-ADD     V2CPKG_i      TASPKF
240980160530     C                   Z-ADD     V2CPKG_i      TASPKb
240990941219     C                   MOVEL     VIDLNP        TASLNP
241000941219     C                   MOVEL     SAVCTS        TASCTS
241010941219     C*
241020941219     C                   MOVEL     BLPDSP        TASDSP
241030970414     C                   MOVEL     BLPDSP        TASDCT
241040941219     C                   MOVEL     VARVOL        TASVLF
241050941219     C     VIDTSP        IFNE      *BLANKS
241060941219    1C                   MOVEL     VIDTSP        TASTSP
241070941219     C                   ELSE
241080941219     C* LO PRENDO DA TARIFFA
241090941219     C                   MOVEL     COMTSP        TASTSP
241100941219    1C                   ENDIF
241110941219     C* SE E' ANCORA VUOTO, IMPOSTO "C"
241120941219    1C     TASTSP        IFEQ      ' '
241130941219     C                   MOVEL     'C'           TASTSP
241140941219    1C                   ENDIF
241150980512     C     WBOL          IFEQ      '1'
241160980512     C                   MOVEL     §3ATB1        TASTBL
241170980512     C                   ELSE
241180980512     C                   MOVEL     §3ATB2        TASTBL
241190020503    1C                   ENDIF
241200941219     C*
241210950116     C* SOLO SE C/A SULLA 1 BOLLA
241220020503    1C     WBOL          IFEQ      '1'
241230980506     C     §3AFCA        ANDEQ     1
241240980506     C     WBOL          OREQ      '2'
241250980506     C     §3AFCA        ANDEQ     2
241260941219     C                   MOVEL     VIDCAS        TASCAS
241270941219     C                   MOVEL     VIDVCA        TASVCA
241280941219     C                   MOVEL     VIDTIC        TASTIC
241290020503    1C                   ENDIF
241300941219     C*
241310941219     C                   MOVEL     COMLNA        TASLNA
241320941219     C                   MOVEL     VIDNCL        TASNCL
241330160530     C                   MOVEL     VIDNCL        TASNCLB
241340040127      * passo il porto se sto tassando la prima bolla
241350040127     c                   If        wbol = '1'
241360941219     C                   MOVEL     VIDPOR        TASPOR
241370040127     c                   EndIf
241380941219     C                   MOVEL     VIDIAS        TASIAS
241390941219     C                   MOVEL     VIDVAS        TASVAS
241400941219     C                   MOVEL     VIDTC1        TASTC1
241410941219     C                   MOVEL     VIDTC2        TASTC2
241420941219     C                   MOVEL     VIDQFT        TASQFT
241430020503    1C     VIDBAM        IFEQ      'S'
241440970411     C                   MOVEL     'S'           TASDDT
241450020503    1C                   ENDIF
241460061002     c*vidfbr            movel     vidfbr        §tasflo
241470061002     c* Passo nella DTAS01 il blpfbr
241480061002     c                   clear                   dtas01
241490061002     c                   movel     vidfbr        §asfbr
241500130926     c***                if        wemdest<>*blanks
241510130926     c***                movel     'S'           §asemd
241520130926     c***                endif
241530130926     c                   clear                   w_emd
241540140424     c                   clear                   w_smp
241550130926     c* verifico presenza richiesta avviso mail merce partita
241560130926     c                   select
241570130926     c* manutenzione
241580130926     c                   when      *in12 and not *in15
241590130926     c                             and wmmp_ar5='S' and wemdest<>*blanks
241600130926     c                   eval      w_emd = 'S'
241610130926     c* conferma bolle da cliente
241620130926     c                   when      *in12 and *in15
241630130930     c                   if        wmmp='N'
241640130926     c                   eval      aggioAr8=' '
241650130926     c                   exsr      sr_gesar8
241660130926     c                   endif
241670130926     c                   if        wemdest<>*blanks  and
241680170428     c                             (wmmp<>'N' or (w_allm='S' and
241690170428     c                                            a_§ogntw<>'DPD' and
241700170428     c                                            a_§ogntw<>'EEX' and
241710170428     c                                            a_§ogntw<>'FED' ))
241720130926     c                   eval      w_emd = 'S'
241730130926     c                   endif
241740130926     c                   endsl
241750140424     c                   if        wsms<>*blanks and wsmp='S'
241751170831     c                   if        w_emd=' ' or §cliemsms='S'
241760140424     c                   eval      w_smp='S'
241761170831     c                   endif
241770140424     c                   endif
241780140424     c
241790170428     c* se W_emd/w_smp= 'S' devo anche verificare che non siano presenti blocchi
241800170428     c* (per es non tutte le lna EEX fanno il servizio di invio mail/sms
241810170428     c* oppure potrebbero esserci blocchi su richiesta della Guardia di Finanza)
241820170428     c                   if        *in12
241830170428     c                   if        w_emd='S' or W_smp='S'
241840170428     c                   clear                   fnlv84ds
241850170428     c                   eval      ILV84LNP=vidlnp
241860170428     c                   eval      ILV84LNA=comlna
241870170428     c                   eval      ILV84TSP=tastsp
241880170428     c                   eval      ilv84drf=tasdsp
241890170428     c                   call      'FNLV84R'
241900170428     c                   parm                    fnlv84ds
241910170428     c                   if        olv84esito='1'
241920170428     c                   clear                   w_smp
241930170428     c                   clear                   w_emd
241940170428     c                   endif
241941170831     c* verifico anche blocchi da tabella cli
241942170830     c                   if        *in15 and §cliblkalr<>*blank
241943170830     c                   clear                   w_smp
241944170830     c                   clear                   w_emd
241945170830     c                   endif
241950170428     c                   endif
241960170428     c                   endif
241970130926
241980130926     c                   select
241990170831     c                   when      w_emd='S' and w_smp=' '
242000170831     c****               when      w_emd='S'
242010130926     c                   eval      §asemd='S'
242020140424     c                   when      w_emd='S' and w_smp='S'
242030130926     c                   eval      §asemd='E'
242040140424     c                   when      w_smp='S'
242050130926     c                   eval      §asemd='X'
242060130926     c                   endsl
242070150107     c* PIN CODE
242080150107     c                   if        wpincode<>*blanks
242090150107     c                   eval      §aspin='S'
242100150107     c                   endif
242110130926     c
242120061002     c                   movel(P)  dtas01        §tasflo
242130151127
242140151127     c* Packing list e orm telefonici solo per la prima bolla in quanto la secon
242150151127     c* è solo per tassare una specifica varia
242160151127     c                   if        wbol='1'
242170151117     c* PACKING LIST
242180151117     c                   select
242190151117     c* manutenzione
242200151117     c                   when      *in12 and not *in15
242210151117     c                   if        w_ar5alx='S' or w_ar5als='S'
242220151117     c                   eval      tasspl='S'
242230151117     c                   endif
242240151117     c* conferma bolle
242250151117     c* in questa fase non so ancora se packing list pdf  in quanto
242260151117     c* lo so solo dopo il trattamento del pdf che viene eseguito da
242270151117     c* altro pgm. quindi qui gestisco solo il packing list da fivax
242280151117     c                   when      *in12 and *in15
242290151117     c                   if        wvax='S'
242300151117     c                   eval      tasspl='S'
242310151117     c                   endif
242320151117     c                   endsl
242330151117     c* ADDEBITO ORM TELEFONICI (diritto di chiamata)
242340151117     c                   exsr      sr_b4ado
242350151117     c                   if        w_§b4ado='S'
242360151117     c                   movel     'S'           tasprt
242370151117     c                   endif
242380151127     c                   endif
242390941219     C* LEGGO IL SFL PER PRENDERE LE VARIE
242400980506     C* SOLO PER 1 BOLLA ESISTE TASSAZIONE COMPLETA
242410991007     C                   CLEAR                   DTASV
242420980506    1C     WBOL          IFEQ      '1'
242430941219     C                   Z-ADD     1             NRR
242440941219     C                   Z-ADD     1             C
242450941219     C*
242460980506    2C                   DO        20            NRR
242470941219     C     NRR           CHAIN     LS01S03                            30
242480941219     C*
242490980506    3C     *IN30         IFEQ      *OFF
242500020503     c* se devo tassare una specifica varia(da tabella 3A) e c'e' gia'
242510020503     c*  non richiamo la tassazione
242520020503     c                   if        §3asva<>*blanks and v3csv1=§3asva
242530020503     c                   eval      wtassa='N'
242540030623      * mi salvo l'importo della varia
242550030623     c                   eval      itassa=v3cva1
242560020503     c                   endif
242570030623     c* se esiste già la varia "D" non la ricalcolo
242580030623     c*
242590030623     c                   if        v3csv1='D'
242600030623     c                   eval      wtassad='N'
242610030623     c                   endif
242620030624      * SE ESISTE LA VARIA "&" CON TUTTI 8888888 NON LA PASSO AL TNSF20R
242630030624      * MA PASSO UN FLAG  DI RICHIESTA CALCOLO VARIA "&"
242640030624     C                   IF        V3CSV1 = '&' AND V3CVA1 = 88888888
242650030624     C                   EVAL      TASFCAA = 'S'
242660030624     C                   ELSE
242670941219     C                   MOVEL     V3CSV1        VSV(C)
242680991007     C                   Z-ADD     V3CVA1        VVA(C)
242690030624     c                   ENDIF
242700941219     C                   ADD       1             C
242710980506    3C                   ENDIF
242720980506    2C                   ENDDO
242730980506     C**
242740991019     C                   MOVEL     VIDDIV        TASDIV
242750991019     C**
242760980506     C** 2 BOLLA: IMPOSTO LA VARIA "G"
242770980506   X1C                   ELSE
242780991019     C                   MOVEL     VI2DIV        TASDIV
242790980608     C     VI2VA1        IFGT      0
242800980608     C                   MOVEL     VI2SV1        VSV(1)
242810991007     C                   Z-ADD     VI2VA1        VVA(1)
242820040121     c                   Movel     Vi2Es1        Ves(1)
242830980608     C                   ENDIF
242840040115     c                   If        Vi2Va2 > *Zeros
242850040115     c                   Movel     Vi2Sv2        Vsv(2)
242860040115     c                   Z-add     Vi2Va2        Vva(2)
242870040121     c                   Movel     Vi2Es2        Ves(2)
242880040115     c                   EndIf
242890040115     c                   If        Vi2Va3 > *Zeros
242900040115     c                   Movel     Vi2Sv3        Vsv(3)
242910040115     c                   Z-add     Vi2Va3        Vva(3)
242920040121     c                   Movel     Vi2Es3        Ves(3)
242930040115     c                   EndIf
242940040115     c                   If        Vi2Va4 > *Zeros
242950040115     c                   Movel     Vi2Sv4        Vsv(4)
242960040115     c                   Z-add     Vi2Va4        Vva(4)
242970040121     c                   Movel     Vi2Es4        Ves(4)
242980040115     c                   EndIf
242990041217     c                   If        Vi2Va5 > *Zeros
243000041217     c                   Movel     Vi2Sv5        Vsv(5)
243010041217     c                   Z-add     Vi2Va5        Vva(5)
243020041217     c                   Movel     Vi2Es5        Ves(5)
243030041217     c                   EndIf
243040041217     c                   If        Vi2Va6 > *Zeros
243050041217     c                   Movel     Vi2Sv6        Vsv(6)
243060041217     c                   Z-add     Vi2Va6        Vva(6)
243070041217     c                   Movel     Vi2Es6        Ves(6)
243080041217     c                   EndIf
243090980608     C                   MOVEL     'G'           TASSVA
243100040115     c                   Eval      TascVag = 'S'
243110980506    1C                   ENDIF
243120990915     C* MERCE PORTATA A MAGAZZINO DAL COD.AUTOTRASPORTATORE
243130990915     C*  PER I PREPAGATI LA RICHIESTA VIENE FATTA A VIDEO
243140990915     C     VIDPDR        IFLE      *ZEROS
243150990915     C     *IN22         ANDEQ     *ON
243160001024     C                   MOVEL     VIDMAG        TASFDN
243170990915     C                   ELSE
243180990915     C                   MOVEL     APDFCM        TASFDN
243190990915     C                   ENDIF
243200020220     c* se bolla in assegnato export faccio sempre pagare la varia U
243210020220     c     *in04         ifeq      *on
243220020220     c     A_§ogntw      ifeq      'EEX'
243230081008     c***  A_§ogntw      oreq      'EUP'
243240020220     c     A_§ogntw      oreq      'DPD'
243250020220     c     A_§ogntw      oreq      'FED'
243260020220     c                   clear                   tasfdn
243270020220     c                   endif
243280020220     c                   endif
243290941219     C*
243300970708     C                   MOVEL     MITCTS        TASMCT
243310021002     c**
243320030204
243330030204      * Bancali
243340030205If  1c                   If        %Subst(VidGva:1:1) ='B'
243350030204     c                   Eval      TasBan = VidNba + VidNb2
243360030205     c                   EndIf
243370030728      * Colli originali
243380030728If  1c                   If        %Subst(VidGva:1:1) ='O'
243390030728     c                   Eval      TasNcl = W03Cor
243400030728     c                   EndIf
243410030204
243420020503     c                   if        wtassa=' '
243430020503     c* se devo tassare solo una varia, da tipo bolla, la imposto
243440020503     c                   if        §3asva<>*blanks
243450020503     c                   eval      tassva=§3asva
243460020503     c                   endif
243470030623      *
243480030623     c                   endif
243490030623      * per prepagato passo al TNSF20R la varia  "D" e l'importo del dir.fat.
243500030623      * da sommare che prendo CNIND (INDSIN)
243510030623      *
243520030623     c                   if        *in34  or *in22
243530030623      * recupero le spese incasso
243540030623     c     kaco          chain     cnind00f
243550030623     c                   if        %found(cnind00f)
243560031007      * se diritto di fatturazione a zero con calcolo la varia D
243570031007     c                   if        indsin = 0
243580031007     c                   eval      wtassad='N'
243590031007      *
243600031007     c                   else
243610030623     c                   move      indsin        tasivdf
243620030623     c                   eval      tassvdf = 'D'
243630031007     c                   endif
243640031007      *
243650030623     c                   endif
243660030623      *
243670030623     c                   if        wtassa='N' and wtassad = ' '
243680030623     c* se ho già tassata la singola varia devo sommare il solo diritto di fattu
243690030623     c* maggiore di zero oppure se imponibile a zero ho la singola varia valoriz
243700030623     c                   if        tasimv > 0  or (tasimv = 0 and itassa > 0)
243710030623     c                   eval      tassva='D'
243720030623     c                   else
243730030623     c                   eval      wtassad = 'N'
243740030623     c                   endif
243750030623     c                   endif
243760030623     c**
243770030623     c                   if        wtassa = 'N' and wtassad = 'N'
243780030623     c                   goto      endtas
243790030623     c                   endif
243800040115      * no prepagato
243810040115     c                   Else
243820040115     c                   if        wtassa = 'N'
243830040115     c                   goto      endtas
243840040115     c                   endif
243850040115     c                   endif
243860030623     c*
243870990701     C                   CLEAR                   WFIAS
243880990701     C                   MOVEL     PARAMF        KPJBU
243890991014      *
243900941219     C                   CALL      'TNSF20R'
243910941221     C                   PARM                    KPJBA
243920991007     C                   PARM                    DTAS
243930991007     C                   PARM                    DTASV
243940941219     C*
243950941219     C                   Z-ADD     0             NRR
243960941219     C                   Z-ADD     1             C
243970991014      *
243980991014      * PRIMA BOLLA
243990980506    1C     WBOL          IFEQ      '1'
244000991014     C* IMPOSTO LE VARIE
244010941219    2C                   DO        20            C
244020991027     C                   MOVEL     VSV(C)        WSVN
244030991027     C                   Z-ADD     VVA(C)        WVAN
244040941219     C                   MOVEL     VES(C)        WEV1
244050941219     C                   EXSR      CARVAR
244060941219    2C                   ENDDO
244070991025     C*
244080991025     C                   ADD       1             NRR
244090991025     C     NRR           DO        20            NRR
244100991025     C     NRR           CHAIN     LS01S03                            30
244110991025     C                   CLEAR                   V3CSV1
244120991025     C                   CLEAR                   V3CVA1
244130991025     C                   CLEAR                   V3HVA1
244140991025     C                   CLEAR                   V3CEV1
244150991025     C   30              WRITE     LS01S03
244160991025     C  N30              UPDATE    LS01S03
244170991025     C                   ENDDO
244180930415     C*
244190980506    2C     TASERR        IFEQ      *BLANKS
244200901031     C                   MOVEL     TASPOR        VIDPOR
244210991015     C                   MOVEL     TASPOR        MEMPOR
244220950220     C                   Z-ADD     TASQFT        VIDQFT
244230991014     C                   MOVEL     TASIMV        VIDIMV
244240991015     C                   MOVEL     TASDIV        VIDDIV
244250991015     C                   MOVEL     TASDIV        WDIV1
244260991015      *
244270991015   X2C                   ELSE
244280991015     C     TASMSG        IFEQ      *BLANKS
244290991015     C                   MOVEL     ERR(104)      VIDMSG
244300991015     C                   ELSE
244310991015     C                   MOVEL(P)  TASMSG        VIDMSG
244320991015     C                   ENDIF
244330991015     C                   SETON                                        9052
244340991015    2C                   ENDIF
244350991014      *
244360991014      * 2 BOLLA
244370980506   X1C                   ELSE
244380040115     c                   Clear                   ContaSv
244390040115      * carico le varie
244400040115Do  2c                   Do        20            c
244410040115If  3c                   If        Vsv(c) <> §$2Iva and
244420040115     c                             Vsv(c) <> §$2Bol
244430040115     c                   Add       1             ContaSv
244440040115S   4c                   Select
244450040115     c                   When      ContaSv = 1
244460040115     c                   Movel     Vsv(c)        Vi2Sv1
244470040115     c                   Z-add     Vva(c)        Vi2Va1
244480040121     c                   Movel     Ves(c)        Vi2Es1
244490040115     c                   When      ContaSv = 2
244500040115     c                   Movel     Vsv(c)        Vi2Sv2
244510040115     c                   Z-add     Vva(c)        Vi2Va2
244520040121     c                   Movel     Ves(c)        Vi2Es2
244530040115     c                   When      ContaSv = 3
244540040115     c                   Movel     Vsv(c)        Vi2Sv3
244550040115     c                   Z-add     Vva(c)        Vi2Va3
244560040121     c                   Movel     Ves(c)        Vi2Es3
244570040115     c                   When      ContaSv = 4
244580040115     c                   Movel     Vsv(c)        Vi2Sv4
244590040115     c                   Z-add     Vva(c)        Vi2Va4
244600040121     c                   Movel     Ves(c)        Vi2Es4
244610041217     c                   When      ContaSv = 5
244620041217     c                   Movel     Vsv(c)        Vi2Sv5
244630041217     c                   Z-add     Vva(c)        Vi2Va5
244640041217     c                   Movel     Ves(c)        Vi2Es5
244650041217     c                   When      ContaSv = 6
244660041217     c                   Movel     Vsv(c)        Vi2Sv6
244670041217     c                   Z-add     Vva(c)        Vi2Va6
244680041217     c                   Movel     Ves(c)        Vi2Es6
244690040115    4c                   EndSl
244700040115    3c                   EndIf
244710040115    2c                   EndDo
244720991014      *
2447309806080   2C     TASERR        IFEQ      ' '
244740040115     C                   MOVEL     TASDIV        VI2DIV
244750040115     C                   MOVEL     TASDIV        WDIV2
244760040126     c                   Movel     TasImv        Vi2Imv
244770980506     C**
244780980506   X2C                   ELSE
244790980506     C* MANCA TARIFFA
244800980608     C     TASMSG        IFEQ      *BLANKS
244810980506     C                   MOVEL     ERR(104)      VIDMSG
244820980608     C                   ELSE
244830980608     C                   MOVEL(P)  TASMSG        VIDMSG
244840980608     C                   ENDIF
244850980506     C                   SETON                                        9041
244860980506    2C                   ENDIF
244870980506    1C                   ENDIF
244880940923     C*
244890940919     C     ENDTAS        ENDSR
244900990630     C*
244910990630     C* CALCOLO IL TOTALE FATTURA ------------------------------------*
244920990630     C     TOTFAT        BEGSR
244930991014      *
244940991015      *  RECUPERO L'ARROTONDAMENTO
244950991102     C                   CLEAR                   DSBS02
244960991102     C                   MOVEL     'C'           T02MOD
244970991102     C                   MOVEL     KNSIF         T02SIF
244980991102     C                   MOVEL     'GEI'         T02COD
244990991102     C                   MOVEL     VIDDIV        T02KE1
245000991102      *
245010991102     C                   CALL      'TIBS02R'
245020991102     C                   PARM                    KPJBA
245030991102     C                   PARM                    DSBS02
245040991102      *
245050991102     C     T02ERR        IFEQ      *BLANKS
245060991102     C                   MOVEL     T02UNI        DGEI
245070991102     C                   ELSE
245080991102     C                   CLEAR                   DGEI
245090991102     C                   ENDIF
245100991015      *
245110990630     C     VIDIMV        IFGT      0
245120991014     C                   CLEAR                   DSLV04
245130990630     C                   Z-ADD     COMDFT        D04DFT
245140991014     C                   Z-ADD     VIDIMV        D04IMV
245150991014     C                   MOVEL     VIDDIV        D04DIV
245160990630     C                   MOVEL     VIDCEI        D04CEI
245170991014     C                   MOVEL     VIDTIC        D04TIC
245180990630     C                   Z-ADD     VIDCAS        D04CAS
245190990630     C                   MOVEL     VIDVCA        D04VCA
245200990630     C                   Z-ADD     VIDPOR        D04POR
245210990701     C     *IN22         IFEQ      *ON
245220991015     C                   MOVEL     §GEAED        D04AED
245230991015     C                   Z-ADD     §GEAVL        D04VAR
245240990701     C                   ENDIF
245250991014     C     *IN04         IFEQ      *ON
245260991014     C                   MOVEL     '1'           D04SPE
245270991014     C                   ELSE
245280991014     C                   MOVEL     '8'           D04SPE
245290991014     C                   ENDIF
245300991014     C                   MOVEL     §3ATB1        D04TBL
245310991014      *
245320991014     C                   CALL      'FNLV04R'
245330991014     C                   PARM                    DSLV04
245340991007     C                   PARM                    DTASV
245350990630     C                   ENDIF
245360991014      *
245370990630     C                   ENDSR
245380930915     C*
245390930915     C* ANNULLAMENTO BOLLA -------------------------------------------*
245400930915     C     ANNULL        BEGSR
245410930915     C                   SETOFF                                       90
245420060307     C                   clear                   wf12              1
245430970408     C* NON POSSO ANNULLARE MAI UNA BOLLA LEGATA
245440940915     C     KBLP3         CHAIN     FNLBL01L                           30
245450930915     C*
245460930915    1C     *IN30         IFEQ      *OFF
245470941020     C                   MOVEL     ERR(65)       VIDMSG
245480941020     C                   SETON                                        90
245490970408    1C                   ENDIF
245500040614     c* Non posso annullare mai una bolla £ se lnp=lna
245510040611     C  N90BLPCBO        ifeq      '£ '
245520040611     C     BLPLNP        ANDeq     BLPLNA
245530040611     C                   MOVEL     ERR(282)      VIDMSG
245540040611     C                   SETON                                        90
245550040611     c                   endif
245560061127     c* Non posso annullare bolla con C.A.
245570141202     c                   if        not *in90
245580061127     c                   clear                   fidn12ds
245590061127     c                   eval      dn_i12aas = §LPAAS
245600061127     c                   eval      dn_i12lnp = §LPLNP
245610061127     c                   eval      dn_i12nrs = §LPNRS
245620061127     c                   eval      dn_i12nsp = §LPNSP
245630061127     c                   eval      dn_i12fel = 'E'
245640061127     c                   eval      dn_i12fan = 'E'
245650061127     c                   call      'FIDN12R'
245660061127     c                   parm                    fidn12ds
245670061127     c* se numero di CA trovate maggiore di zero
245680061127     c                   if        dn_o12nca > 0
245690061127     C                   MOVEL     ERR(310)      VIDMSG
245700061127     C                   SETON                                        90
245710061127     c                   endif
245720141202     c                   endif
245730110321     c* avviso se sono presenti spunte entrata
245740141202     c                   if        not *in90
245750110321     c                   if        wforzbrv=*off
245760110321     c                   eval      wcheck=*on
245770110321     c                   exsr      sr_gesbranm
245780110321     c                   if        *in90
245790110321     C                   MOVEL     ERR(336)      VIDMSG
245800110321     c                   endif
245810110321     c                   eval      wforzbrv=*on
245820110321     c                   endif
245830141202     c                   endif
245840060210     c* ANNULLAMENTO DI UN PREPAGATO
245850060210     c* verifico se in caso di annullamento prepagati devo richiedere
245860060210     c* la motivazione
245870060308     c                   movel     'KM'          wcvb
245880060308     c                   exsr      cls_lv85
245890060210     c                   clear                   ilv85cvb
245900070514     c**n90              if        *in22 = *ON and dateu >= §vpogpp
245910070514     c  n90              if        *in22 = *ON
245920060213     c*  Prima di tutto controllo che il prepagato non sia già stato incassa
245930060213     c*  to
245940060213     c                   exsr      sr_callycow
245950060213     c                   if        prmesito <> 0
245960060213     C                   MOVEL     ERR(297)      VIDMSG
245970060213     C                   SETON                                        90
245980060213     c                   else
245990110419     c*  Poi controllo che l'ORM non sia in distinta
246000110419     c                   if        ormndc>0
246010110419     c                   seton                                        90
246020110419     c*        errore: ORM già ritirato
246030110419     c                   if        ormfao=600
246040110419     C                   MOVEL     ERR(337)      VIDMSG
246050110419     c                   else
246060110419     c*        errore: per annullare togliere l'orm dalla distinta
246070110419     C                   MOVEL     ERR(338)      VIDMSG
246080110419     c                   endif
246090110419     c                   else
246100060227     c                   movel     '7L'          cod
246110060227     C                   MOVEL(P)  'KM'          KEY
246120060227     C                   EXSR      CTABEL
246130060227     C                   MOVEL     TBLUNI        DS7L
246140060227     c                   if        §7lmtv = 'S'
246150060210     c                   clear                   fnlv85ds
246160060210     c                   eval      ilv85cvb = 'KM'
246170060210     c                   eval      ilv85tel = 'V'
246180060309     c                   z-add     5             ilv85row
246190060210     c                   movel     fnlv85ds      kpjbu
246200060210     c                   call      'FNLV85R'
246210060210     c                   parm                    kpjba
246220060227     c*****              parm                    ds7l
246230060210     c                   movel     kpjbu         fnlv85ds
246240060210     c* F12=Ritorno --> riemetto formato 01
246250060210     c                   if        olv85f12 = '1'
246260060307     c                   eval      wf12   = '1'
246270060307     c                   goto      fannull
246280060210     c                   endif
246290060227     c                   endif
246300060213     c                   endif
246310060210     c                   endif
246320110419     c                   endif
246330060125
246340060125      * Richiamo il pgm per annullare l'ORM legato alla bolla RC
246350100604     c***                If        blpgma = 'RC'
246360110321     c  n90              If        w7rRC  = 'S'
246370060125     c                   Clear                   fnls25ds
246380060125     c                   If        blpccm > *Zeros
246390060125     c                   Eval      i25Ksc = blpccm
246400060125     c                   Else
246410060125     c                   Eval      i25ksc = blpksc
246420060125     c                   EndIf
246430060125     c                   Move      blpaas        i25aas
246440060125     c                   Eval      i25spe = %editc(blplnp:'X') +
246450060125     c                                      %editc(blpnrs:'X') +
246460060125     c                                      %editc(blpnsp:'X')
246470060125     c                   Call      'FNLS25R'
246480060125     c                   Parm                    Fnls25ds
246490060125     c                   EndIf
246500061122     c* se annullamento di un prepagato richiamo il seguente pgm per
246510061122     c* chiudere l'orm. No considero eventuali errori ricevuti dal
246520061122     c* pgm in quanto ininfluenti per questa operazione
246530070627     c  n90              if        *in22=*on and S_§b4fit<>*all'9'
246540061122     c                   clear                   fior51ds
246550061122     c                   z-add     s_§b4poe      i51poe
246560061122     c                   z-add     s_§b4nsr      I51NSR
246570061122     c                   z-add     s_§b4nor      I51NOR
246580061122     c                   z-add     s_§b4nrv      I51NRV
246590061122     c                   z-add     999           i51far
246600061122     c                   movel     '80'          i51car
246610061122     c                   call      'FIOR51R'
246620061122     c                   parm                    fior51ds
246630061122     c                   endif
246640060125
246650970408     C****
246660930915     C* CANCELLAZIONE FISICA FILES
246670930915     C  N90              EXSR      DELBLP
246680941020     C* PASSO NEL FALG PROVENIENZA '1' PER INDICARE CHE LA BOLLA E'
246690941011     C*  STATA ANNULLATA
246700941020     C                   MOVEL     '1'           §LPFPR
246710930915     C*
246720060307     C     fannull       ENDSR
246730901031     C*
246740930915     C*--- CANCELLAZIONE FISICA BOLLA IN TUTTI I SUOI FILES ----------*
246750930915     C     DELBLP        BEGSR
246760950410     C*
246770930915     C* SCRIVO RECORD IN FLBLA
246780070514     c***                if        *in22 = *off or dateu < §vpogpp
246790070514     c                   if        *in22 = *off
246800900511     C                   MOVEL     BLPLNP        BLALNP
246810900511     C                   MOVEL     BLPAAS        BLAAAS
246820900511     C                   MOVEL     BLPMGS        BLAMGS
246830900511     C                   MOVEL     BLPNRS        BLANRS
246840900511     C                   MOVEL     BLPNSP        BLANSP
246850900511     C                   MOVEL     BLPLNA        BLALNA
246860080904     C                   MOVEL     §3atb1        BLATBL
246870900511     C                   MOVEL     DATEU         BLADAN
246880170214     C                   MOVEL     simfel_s      BLAfle
246890110411     C                   MOVEL     blpcbo        BLAcbo
246900110411     c                   time                    blaoan
246910110411     c                   movel     knmus         blapru
246920110411     c                   movel     knmtd         blamtd
246930110411     c                   if        blpccm>0
246940110411     c                   z-add     blpccm        blaccm
246950110411     c                   else
246960110411     c                   if        not *in04
246970110411     c                   z-add     blpksc        blaccm
246980110411     c                   endif
246990110411     c                   endif
247000110411     c                   z-add     blprmn        blarmn
247010110411     c                   movel     blprma        blarma
247020110411     c                   movel     blprsm        blarsm
247030110411     c                   movel     blpinm        blainm
247040110411     c                   movel     blpcam        blacam
247050110411     c                   movel     blplom        blalom
247060110411     c                   movel     blpprm        blaprm
247070110411     c                   movel     blpnzm        blanzm
247080110411     c                   movel     blprsd        blarsd
247090110411     c                   movel     blpcad        blacad
247100110411     c                   movel     blplod        blalod
247110110411     c                   movel     blpprd        blaprd
247120110411     c                   movel     blpnzd        blanzd
247130110411     c                   movel     blpctm        blactm
247140110411     c                   z-add     blpncl        blancl
247150110411     c                   z-add     blppkb        blapkb
247160110411     c                   z-add     blpfls        blafls
247170110411     c                   z-add     blpncd        blancd
247180110411     c                   z-add     blpnca        blanca
247190080904     C                   WRITE     TNBLA000
247200060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
247210060210     c* anomalie
247220110321     c                   eval      wcheck=*off
247230060210     c                   exsr      sr_gesbranm
247240060210     c                   endif
247250060210     C* DISALLOCAZIONE FILES
247260001130      *
247270061212     C                   UNLOCK    FNBLP00F
247280051115     C                   UNLOCK    Fiar901L
247290001211     C                   UNLOCK    FIAR601L
247300001211     C                   UNLOCK    FIAR701L
247310060215     C                   UNLOCK    Fiar401L
247320001211     C                   UNLOCK    FNBLT01L
247330051102     C                   UNLOCK    FIARS01L
247340120814     C                   UNLOCK    FIART01L
247350060210     c*
247360070514     c* OPERAZIONI PER PREPAGATI
247370070514     c****               if        *in22 = *on and dateu >= §vpogpp
247380070514     c                   if        *in22 = *on
247390060210     c* richiamo fnlr48r per storicizzare la variazione
247400060210     c* ed effettuare altri eventuali aggiornamenti su file contrassegni
247410060210     c* e tassazione seconda bolla. L'aggiornamento della testata bolla
247420060210     c* viene effettuato in questo pgm al compimento di tutti gli aggiornam.
247430060303     c                   clear                   fnlr48ds
247440060210     C                   MOVEL     'L'           D48TLA
247450060210     C                   z-add     blplnp        D48FGS
247460060210     C                   z-add     blpaas        D48AAS
247470060210     C                   MOVE      blpLNP        D48LNP
247480060210     C                   MOVE      blpNRS        D48NRS
247490060210     C                   MOVE      blpNSP        D48NSP
247500060210     C                   MOVE      blpcbo        D48CBO
247510060210     C                   MOVEL     'KM'          D48CVB
247520060210     C                   MOVEL     'K'           D48TRC
247530060210     C                   MOVEL     'E'           D48FFR
247540060210     C                   MOVEL     ' '           D48ERR
247550060210     C                   MOVEL     *BLANK        D48MSG
247560060210     C                   MOVEL     'P'           D48TBO
247570060303     c                   movel     'N'           d48mct
247580060307     c                   eval      d48mtv = olv85mtv
247590060307     c                   movel     olv85nt1      d48not
247600060307     c                   move      olv85nt2      d48not
247610060210     c                   clear                   dsarbk
247620060210     C                   MOVEL     'M'           §BKcbn
247630060210     C                   MOVEL     fnlr48ds      KPJBU
247640060210     C                   CALL      'FNLR48R'
247650060210     C                   PARM                    KPJBA
247660060210     C                   PARM                    DSARBD
247670060210     C                   PARM                    DSARBK
247680060210     C                   PARM                    DARBT
247690060210     C                   PARM                    DSARBG
247700060210     C                   PARM                    trul90ds
247710060210     C                   MOVEL     KPJBU         fnlr48ds
247720060210     C     D48ERR        IFne      *BLANK
247730060210     c                   seton                                        90
247740060213     c                   movel     D48msg        vidmsg
247750060210     c                   goto      e_del
247760060210     C                   END
247770060210     c* rialloco fnblp
247780061218     C     savnrr        CHAIN     FNBLP000                           90
247790060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
247800060210     c* anomalie
247810110321     c                   eval      wcheck=*off
247820060210     c                   exsr      sr_gesbranm
247830060210     c                   endif
247840001211     C*
247850160202     c* Chiudo Dispo per la consegna e R.A. se presenti
247860160202     c                   exsr      sr_chiuDispoRa
247870060210     C* RICHIAMO PROGRAMMA DI CANCELLAZIONE
247880060210     C*
247890001130     C                   MOVE      KPJBU         WA256           256
247900001130     C                   CLEAR                   DSLS63
247910060213     c* se è un prepagato lo richiamo in modalità "P" per cancellare solo
247920060213     c* il dettaglio colli e suoi file legati
247930070514     c****               if        *in22 = *on and dateu >= §vpogpp
247940070514     c                   if        *in22 = *on
247950060210     c                   movel     'P'           i63mod
247960060210     c                   endif
247970001130     C                   MOVE      BLPAAS        I63AAS
247980001130     C                   MOVE      BLPLNP        I63LNP
247990001130     C                   MOVE      BLPNRS        I63NRS
248000001130     C                   MOVE      BLPNSP        I63NSP
248010001130     C                   MOVEL     DSLS63        KPJBU
248020001130     C                   CALL      'FNLS63R'
248030001130     C                   PARM                    KPJBA
248040001130     C                   MOVE      WA256         KPJBU
248050081020     c                   clear                   trtc86drds
248060081020     c* richiamo pgm per cancellare eventuali record su firab
248070081020     c                   eval      i86mod='DC'
248080081020     c                   z-add     blpaas        i86aasb
248090081020     c                   z-add     blplnp        i86lnpb
248100081020     c                   z-add     blpnrs        i86nrsb
248110081020     c                   z-add     blpnsp        i86nspb
248120081020     c                   call      'TRTC86DRR'
248130081020     c                   parm                    trtc86drds
248140060210     c*
248150070514     c* OPERAZIONI PER PREPAGATI
248160070514     c****               if        *in22 = *on and dateu >= §vpogpp
248170070514     c                   if        *in22 = *on
248180060210     C                   exsr      sr_aggblp
248190060210     c                   endif
248200910807     C*
248210060210     C     e_del         ENDSR
248220060210     C*--- Operazioni su spunte e anomalie a fronte di f16=Annullam --*
248230060210     C     sr_gesbranm   BEGSR
248240060210     C* LEGGO FNBLT SE ESISTE
248250060210     C                   MOVEL     5             KNPG
248260060210     C                   MOVEL     SIMFEL        KFLE
248270060210     C*
248280120817     C***  KBLP3         SETLL     FNBLT000                               30
248290120817     C     KBLP3         SETLL     FIART000                               30
248300060210    1C     *IN30         IFEQ      *ON
248310120817     C***  KBLP3         READE(N)  FNBLT000                               30
248320120817     C     KBLP3         READE(N)  FIART000                               30
248330060210    2C     *IN30         DOWEQ     *OFF
248340110321   2ac                   if        wcheck=*on
248350120817     C***  KBRV          setll     FNBRV000
248360120817     C     KBRVA         setll     FNBRV000
248370110321     c                   if        %equal(fnbrv09l)
248380110321     c                   seton                                        90
248390110321     c                   leavesr
248400110321     c                   endif
248410110321  x2ac                   else
248420060210     C* SPUNTE ENTRATA
248430120817     C***  KBRV          CHAIN     FNBRV000                           31
248440120817     C     KBRVA         CHAIN     FNBRV000                           31
248450060210    3C     *IN31         DOWEQ     *OFF
248460060210     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
248470060210     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
248480060210     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
248490060210     c* no anomalie da cancellare create a fronte della spunta entrata
248500060210     c**                 z-add     brvnfv        wrvnfv
248510060210     c**                 movel     param2        kpjbu
248520060210     C**                 CALL      'FNLSA8R'
248530060210     C**                 PARM                    KPJBA
248540070123     C                   DELETE    FNBRV000
248550120817     C***  KBRV          READE     FNBRV000                               31
248560120817     C     KBRVA         READE     FNBRV000                               31
248570060210    3C                   ENDDO
248580060210     c* se presenti anomalie con key segnacollo aventi anche la spedizione
248590060210     C* le aggiorno togliendo i dati della spedizione se invece si tratta
248600060210     c* di anomalie  con key spedizione aventi anche il segnacollo le deleto
248610060210     c     kanm2         setll     fnanm02l
248620060210    3c                   do        *hival
248630060210     c     kanm2         reade     fnanm02l
248640060210    4c                   if        %eof(fnanm02l)
248650060210     c                   leave
248660060210    4c                   endif
248670060210     c                   movel     '7C'          cod
248680060210     c                   movel(p)  anmcaa        key
248690060210     C                   EXSR      CTABEL
248700060210     C                   MOVEL     TBLUNI        DS7C
248710060210    4c                   if        §7ckey = 'S'
248720060210     c                   clear                   anmaas
248730060210     c                   clear                   anmlnp
248740060210     c                   clear                   anmnsp
248750060210     c                   update    fnanm000
248760060210   x4c                   else
248770060210     c                   delete    fnanm000
248780060210    4c                   endif
248790060210    3c                   enddo
248800060210     C*
248810110321   2ac                   endif
248820110321     c*
248830120817     C***  KBLP3         READE(N)  FNBLT000                               30
248840120817     C     KBLP3         READE(N)  FIART000                               30
248850060210    2C                   ENDDO
248860060210    1C                   ENDIF
248870060210     c* leggo eventuali anomalie rimaste con key spedizione e se ce ne sono
248880060210     c* le deleto
248890110321     c                   if        wcheck=*off
248900060210     c     kanm1         setll     fnanm01l
248910060210    1c                   do        *hival
248920060210     c     kanm1         reade     fnanm01l
248930060210     c                   if        %eof(fnanm01l)
248940060210     c                   leave
248950060210     c                   endif
248960060210     c                   delete    fnanm01
248970060210    1c                   enddo
248980110321     c                   endif
248990060210     c                   endsr
249000060210     C*--- Operazioni aggiornamento fnblp  a fronte di f16 su prepagato
249010060210     C     sr_aggblp     BEGSR
249020060210     c                   z-add     dateu         blpdrt
249030060210     c                   z-add     999           blppdr
249040060210     C                   eval      BLPFPP = 'P'
249050060214     c                   movel     'N'           blpft1
249060060214     c                   movel     'N'           blpft2
249070060210     C                   MOVEL     *ALL'9'       BLPNFV
249080060210     C                   MOVEL     '4 '          BLPctm
249090060210     c                   movel     'M '          blpcbo
249100060303     c* azzero importo da assicurare altrimenti in ricezione bolle in sede
249110060303     c* scrive fiar4 trk "c" e fiarbt0e
249120060303     c                   clear                   blpias
249130060303     c                   clear                   blpvas
249140060210     c                   update    fnblp000
249150060210     c                   endsr
249160900824     C*
249170900824     C*--- CARICO RECORD BOLEL DA DISK CLIENTI -----------------------*
249180900824     C     CARBLC        BEGSR
249190100319     c                   clear                   WesORE            1
249200100319     c                   clear                   DoreGEN
249210140122     C***                CLEAR                   DSBL4J
249220980115     C                   MOVEL     CMAIUS        MA               26
249230980115     C                   MOVEL     CMINUS        MI               26
249240000124     C* SPIEGO IL SIGNIFICATO DEL FLAG §LPFPR:
249250950419     C* - SE "V" - VISUALIZZO SEMPRE LA BOLLA CHE CONFERMO
249260950419     C* - SE "X" - VISUALIZZO SOLO SE C'E' ERRORE
249270950419     C* - SE "W" - NON VISUALIZZO MAI MA PASSO CODICE DI ERRORE
249280950419     C*
249290930630     C                   MOVEL     *OFF          *INKL
249300930630     C                   MOVEL     *OFF          *INKC
249310930630     C                   MOVEL     *OFF          *INKI
249320930630     C                   MOVEL     *OFF          *INKF
249330940927     C*
249340940921     C                   Z-ADD     0             WKSC
249350091221     c                   clear                   wvidgma
249360100604     c                   clear                   w7rRC
249370141202     c                   clear                   w7rPC
249380160225     c                   clear                   w_adpd
249390940927     C* D A T E
249400910702     C* DATA SPEDIZIONE
249410940926     C                   Z-ADD     §LPMGS        BLPDSP
249420940926     C                   MOVEL     §LPAAS        BLPDSP
249430970512     C*
249440970512     C* LA LINEA DI PARTENZA E' QUELLA DEL CODICE AUTOTRASP.
249450970512     C                   MOVEL     §LPPDR        VIDLNP
249460971216     C     VIDLNP        IFNE      BLCLNP
249470971216     C                   Z-ADD     VIDLNP        W0030
249480971216     C     W0030         CHAIN     AZORG01L      UNIORG               30
249490000508     C                   MOVEL     ORGDE3        OG143
249500971216     C                   MOVEL     VIDLNP        BLCLNP
249510971216     C                   ENDIF
249520941011     C*
249530940927     C* DATA CONSEGNA RICHIESTA
249540940927     C                   Z-ADD     §LPDCR        VIDDCR
249550941011     C* SIGLA OPERATORE VIDEO
249560941011     C                   MOVEL     §LPSOP        VIDSOP
249570960926     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
249580941011     C                   Z-ADD     §LPDRT        VIDDRT
249590940927     C                   MOVEL     §LPNRT        VIDNRT
249600940927     C                   MOVEL     §LPFPP        VIDFPP
249610010220     C                   MOVEL     §LPFPP        PREFPP
249620900824     C*
249630941011     C                   MOVEL     §LPPDR        W0030
249640960927     C     W0030         IFNE      VIDLNP
249650941011     C                   CLEAR                   VIDPDR
249660010220     C                   CLEAR                   PREPDR
249670941011     C                   ELSE
249680941011     C                   MOVE      §LPPDR        VIDPDR
249690010220     C                   MOVE      §LPPDR        PREPDR
249700941011     C                   ENDIF
249710010212     C* NUMERO O.R.M.
249720010220     C* SE RICHIAMATO DA PGM GIACENZE IMPOSTO NUMERO ORM FITTIZIO
249730020522     c* idem se richiamato da pgm ritiri annullati
249740150302     c* idem se richiamato da Gestione Bancali
249750010220     C     §LPFPR        IFEQ      'G'
249760010220     C     §LPFPR        OREQ      'I'
249770010220     C     §LPFPR        OREQ      'P'
249780020522     C     §LPFPR        OREQ      'T'
249790150302     C     §LPFPR        OREQ      'B'
249800010220     C                   MOVEL     §LPPDR        W0030             3 0
249810010220     C     W0030         CHAIN     AZORG01L      UNIORG               30
249820010220     C  N30              MOVEL     ORGDE8        OG148
249830010220     C   30              CLEAR                   OG148
249840060926     c* faccio finta che abbia sempre la procedura ORM attiva
249850060926     c                   eval      §ogorm='S'
249860060926     c
249870010220     C     §OGORM        IFEQ      'S'
249880010220     C                   MOVEL     §LPPDR        VIDPOE
249890010220     C                   MOVE      *ALL'9'       VIDNOR
249900010220     C                   MOVE      *ALL'9'       VIDNRV
249910010220     C                   ELSE
249920010220     C                   MOVE      *ZEROS        VIDPOE
249930010220     C                   MOVE      *ZEROS        VIDNOR
249940010220     C                   MOVE      *ZEROS        VIDNRV
249950010220     C                   ENDIF
249960011126     C                   CLEAR                   ATRDES
249970150303     c*
249980150303     c                   if        §lpfpr='B'
249990150303     c                   movel     prot          atrdes
250000150303     c                   endif
250010010220     C                   ELSE
250020010212     C                   Z-ADD     §LPPOE        VIDPOE
250030010222     C                   MOVEL     §LPNSR        VIDNOR
250040010222     C                   MOVE      §LPNOR        VIDNOR
250050010212     C                   Z-ADD     §LPNRV        VIDNRV
250060011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
250070011126     C                   Z-ADD     VIDPOE        WOPOE
250080011126     C                   Z-ADD     VIDNOR        WONOR
250090011126     C                   Z-ADD     VIDNRV        WONRV
250100011126     C                   Z-ADD     VIDLNP        WOLNP
250110011126     C                   CLEAR                   DORM01
250120011126     C     KORM          CHAIN     FNORM01L                           30
250130011126     C  N30              MOVEL     ORMFLO        DORM01
250140011126     C     §ORMFD        IFEQ      'S'
250150011126     C                   MOVEL     PROT          ATRDES
250160011126     C                   ELSE
250170011126     C                   CLEAR                   ATRDES
250180011126     C                   ENDIF
250190111209     c* se sull'orm sono presenti le note le visualizzo subito
250200111209     c                   if        not *in30 and
250210111209     c                             (ormno1<> *blanks or ormno2<>*blanks)
250220111209     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
250230120127     c                   movel     ormno1        vidno1
250240120127     c                   movel     ormno2        vidno2
250250120127     c                   movel     'NoteOrm'     viddno
250260111209     c                   endif
250270010220     C                   ENDIF
250280100319     c
250290010212     C                   MOVEL     VIDORM        W01ORM
250300940927     C* CODICE BOLLA
250310940926     C                   MOVEL     §LPCBO        VIDCBO
250320940929     C* PARTITA IVA
250330940929     C                   MOVEL     §LPCPI        WPIVA
250340011206     C*
250350011206     C* IMPOSTO IL CODICE CLIENTE MITTENTE
250360011206     C                   MOVE      §LPCCN        WKSC
250370011206     C                   MOVE      §LPCCN        VIDCCM
250380011206     C                   MOVE      §LPCCN        WCCMS
250390011206     C                   MOVEL     §LPCCN        W0030
250400011206     C* CODICE TRATTAMENTO MERCE
250410011206     C                   MOVEL     §LPCTM        VIDCTM
250420011206     C                   MOVEL     VIDCTM        WCTM
250430011206     C                   EXSR      CTRCTM
250440011206     C* SE TROVATO ERRORE DOPO LO FACCIO RICONTROLLARE
250450011206     C     *IN90         IFEQ      *ON
250460120903     c     vidctm        oreq      *blanks
250470011206     C                   SETOFF                                       90
250480011206     C                   CLEAR                   SAVCTM
250490011206     C                   CLEAR                   DS1B
250500011206     C                   ENDIF
250510940927     C* LINEA ARRIVO
250520020621     C     §1BFG1        IFeq      'S'
250530140506     C     §1BF12        andne     'B'
250540020320     c     §1bf14        oreq      'S'
250550140506     C     §1BF12        andne     'B'
250560980126     C     §LPFPR        OREQ      'G'
250570980126     C     §LPFPR        OREQ      'P'
250580980126     C     §LPFPR        OREQ      'I'
250590150302     C     §LPFPR        OREQ      'B'
250600011206     C* SE DISK "C" EX DISK "B" LNA E ZNC DEVONO RIMANERE = 0
250610140506     C***  §1BF12        IFNE      'B'
250620911031     C                   MOVEL     §LPLNA        VIDLNA
250630980126     C                   MOVEL     §LPZNC        VIDZNC
250640140506     C***                ENDIF
250650980126     C                   ENDIF
250660970512     C*
250670970512     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
250680970512     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
250690970512     C     W0030         IFNE      VIDLNP
250700970512     C                   SETON                                        1438
250710970512     C                   MOVEL     W0030         VIDFLC
250720970512     C                   ENDIF
250730940929     C* DATI FATTURA
250740940929     C                   MOVEL     §LPCEI        VIDCEI
250750940929     C                   MOVEL     §LPNFT        VIDNFT
250760940929     C                   MOVEL     §LPFIV        VIDFIV
250770940929     C                   Z-ADD     §LPDFT        VIDDFT
250780080327     C* TIPO SERVIZIO: lo carichiamo solo se inseribile dal bollettista/clie
250790080327     C                   MOVEL     §LPTSP        VIDTSP
250800080327     C                   Z-ADD     1             C
250810080327     C     vidtsp        LOOKUP    TSP(C)                                 30
250820080327     c                   if        not *in30 or uts(C)<>'S'
250830080327     c                   clear                   vidtsp
250840080327     c                   endif
250850080327     c
250860941115     C* CONSEGNE PARTICOLARI
250870941115     C                   MOVEL     §LPTC1        VIDTC1
250880941115     C                   MOVEL     §LPTC2        VIDTC2
250890091001     C                   MOVEL     §LPTC1        sav_tc1
250900091001     C                   MOVEL     §LPTC2        sav_tc2
250910091001     c                   clear                   w_ar5tcp
250920940929     C*
250930940929     C* D E C O D I F I C H E   BOLLA
250940940927     C                   EXSR      DECBOL
250950030303
250960030303      * Controllo se proteggere o meno il campo del rif. mitt. alf.
250970080331      * Bolla non manutenzionabile proteggo (solo se rma <> blanks)
250980080331     c                   If        §3aucb = 'N'
250990080331     c                   if        §lprma<>*blanks
251000030304     c                   Movel     Prot1         AtrRma
251010030304     c                   Eval      wrma = 's'
251020080331     c                   endif
251030030303     c                   Else
251040030303      * Provengo da giacenze e il p.o. del cliente è DPD proteggo
251050030303     c                   If        (§lpfpr = 'P' or §lpfpr = 'G')
251060060627     C                   MOVEL     OG143         SAV143
251070030303     c                   Clear                   og143
251080060627     c     w0030         Chain     Azorg01l      uniorg
251090030303     c                   If        %Found(Azorg01l)
251100030303     c                   Movel     orgde3        og143
251110030303     c                   Endif
251120030303     c                   If        §Ogntw = 'DPD'
251130030304     c                   Movel     Prot1         AtrRma
251140030304     c                   Eval      wrma = 's'
251150030303     c                   EndIf
251160060627     C                   MOVEL     SAV143        OG143
251170030303     c                   Endif
251180030303     c                   Endif
251190081014     C** Memorizzo se per il cliente del vab si gestisce il raggruppamento
251200081014     c** bolle
251210081014     C                   CLEAR                   DS3C
251220081014     C                   MOVEL     '3C'          COD
251230081014     C                   MOVEL(P)  §lpccm        KEY
251240081014     C                   EXSR      CTABEL
251250081014     C  N30              MOVEL     TBLUNI        DS3C
251260081014     c                   eval      §3cabd_s=§3cabd
251270980310     C* CARICO LA DS3C DEL CLIENTE PER VEDERE SE MANTIENE IL NUMERO
251280060216     C*  DI SPEDIZIONE PER VEDERE SE CHAINARE RECORD E DI ar4
251290980310     C                   CLEAR                   DS3C
251300980310     C                   MOVEL     '3C'          COD
251310980310     C                   MOVEL(P)  WKSC          KEY
251320980310     C*
251330980310     C                   EXSR      CTABEL
251340980310     C  N30              MOVEL     TBLUNI        DS3C
251350971222     C* VEDO SE ESISTE NUMERO AWB SEMPRE PERCHE' POTREBBE ESSERE SBAGLI
251360971222     C*  ATA LA LNA SULLA BOLLA
251370980310     C     §3CFSP        IFEQ      'S'
251380060216     C     KBLC4         CHAIN(N)  Fiar4000                           30
251390971216     C     *IN30         IFEQ      *OFF
251400060216     C                   MOVEL     ar4NOT        DSBL4E
251410971216     C                   MOVEL     §B4ERP        W010A            10
251420971216     C**
251430971216     C     W010A         IFGT      *ZEROS
251440020208     C                   MOVEL     §B4ERP        v6cawb
251450971216     C                   MOVEL     §B4ERP        SAVAWB
251460971216     C                   ENDIF
251470971222     C                   ENDIF
251480980310     C                   ENDIF
251490110818     c* FLAG ACCORPAMENTO SPEDIZIONI in consegna
251500110818     c* Se cliente abilitato al passaggio del flag accorpamento sped.
251510110818     c* verifico in tabella XCO se flag valido:
251520110818     c* - memorizzo errore, se flag non valido
251530110818     c* - memorizzo il dato nel campo wxco, se flag valido
251540110901     c* - memorizzo se si devee inviare messaggio al ced
251550050114     c                   clear                   wxco
251560110818     c                   eval      werrxco=*off
251570050114    1c                   if        §lpxco <> *blanks
251580050114    2c                   if        §3caus = 'S'
251590050114     C                   CLEAR                   dsbs02
251600110818     c                   clear                   dxco
251610050114     C                   MOVEL     'C'           T02MOD
251620050114     C                   MOVEL     KNSIF         T02SIF
251630110818     C                   MOVEL     'XCO'         T02COD
251640110818     c                   movel(P)  'XCO'         t02ke1
251650050114     c                   call      'TIBS02R'
251660050114     C                   PARM                    KPJBA
251670050114     C                   PARM                    dsbs02
251680050114    3C                   IF        T02ERR = *BLANKS
251690110818     C                   MOVEL     T02uni        dxco
251700050114    3C                   ENDIF
251710110901     c* Se valore non presente in tabella:
251720110901     c* memorizzo che devo inviare email a CED
251730110818    3c                   if        %lookup(§lpxco:vaa)=0
251740160108     c****               eval      werrxco=*on
251750110901     c* e se il valore è numerico>0 lo mantengo comunque
251760110901     c                   if        §lpxco>'0'
251770160108     c****               eval      wxco = §lpxco
251780110901     c                   endif
251790110818     c                   else
251800110901     c* Se valore presente in tabella  ---> tutto ok
251810110818     c                   eval      wxco = §lpxco
251820110818    3c                   endif
251830050114    2c                   endif
251840050114    1c                   endif
251850050114     c*
251860000214     C* VEDO SE DISK 'C'
251870911031     C*
251880940926     C* MITTENTE
251890020507     C* SE 8888 O 9999
251900941010    1C     VIDCCM        IFEQ      8888
251910940926     C     VIDCCM        OREQ      9999
251920980115     C                   MOVEL     §LPRSM        VIDRSM
251930911031     C                   MOVEL     §LPINM        VIDINM
251940911031     C                   MOVEL     §LPLOM        VIDLOM
251950911031     C                   MOVEL     §LPCAM        VIDCAM
251960920130     C                   MOVEL     §LPPRM        VIDPRM
251970940926     C                   MOVEL     §LPNZM        VIDNZM
251980941010     C*
251990941010   X1C                   ELSE
252000941010     C*
252010941010     C* SE CODIFICATO E §LPCAM E §LPNZM SONO PIENI, CONTROLLO CON CNIND
252020941010    2C     §LPCAM        IFNE      *BLANKS
252030941010     C     §LPNZM        ORNE      *BLANKS
252040950529     C                   Z-ADD     KCI           CCC
252050941010     C     KACO          CHAIN     CNIND000                           30
252060941010     C*
252070941010    3C     *IN30         IFEQ      *OFF
252080941010    4C     INDCAE        IFNE      §LPCAM
252090941010     C     INDSTA        ORNE      §LPNZM
252100941010     C                   MOVEL     §LPCAM        VIDCMO
252110941010     C                   MOVEL     §LPNZM        VIDNMO
252120941010    4C                   ENDIF
252130941010    3C                   ENDIF
252140941010    2C                   ENDIF
252150941010     C*
252160941010    1C                   ENDIF
252170941010     C*
252180940926     C                   MOVEL     *BLANKS       VIDFAP
252190940927     C                   MOVEL     *BLANKS       VIDFIN
252200911031     C*
252210980115     C                   MOVEL     §LPRSD        VIDRSD
252220980115     C                   MOVE      §LPRD2        VIDRSD
252230980115     C     MI:MA         XLATE     VIDRSD        VIDRSD
252240980115     C     MI:MA         XLATE     §LPIND        VIDIND
252250980115     C     MI:MA         XLATE     §LPPRD        VIDPRD
252260980115     C     MI:MA         XLATE     §LPCAD        VIDCAD
252270980115     C     MI:MA         XLATE     §LPLOD        VIDLOD
252280980115     C     MI:MA         XLATE     §LPNZD        VIDNZD
252290160112     c* eseguo routine per eliminare caratteri non ammessi come da tabella "CSP"
252300160112     c* nella località
252310140211     c                   eval      wtxt=vidlod
252320160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
252330160112     c                   eval      ElencoChar=charnook
252340160112     c                   eval      TipoElenco='1'
252350160112     c                   clear                   UpperCase
252360160112     c                   exsr      sr_chk
252370160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
252380160112     c* alla  fine
252390140211     c                   exsr      chkstringa
252400140211     c                   movel     wtxt          vidlod
252410070404     c                   movel     vidrsd        savrsd
252420070404     c                   movel     vidind        savind
252430070404     c                   movel     vidprd        savprd
252440070404     c                   movel     vidcad        savcad
252450070404     c                   movel     vidlod        savlod
252460070404     c                   movel     vidnzd        nzdini
252470910204     C*
252480940927     C                   MOVEL     §LPCCN        SAVMIT
252490900824     C*
252500980115     C     MI:MA         XLATE     §LPGC1        VIDGC1
252510980115     C     MI:MA         XLATE     §LPGC2        VIDGC2
252520911031     C                   MOVEL     §LPFTM        VIDFTM
252530940927     C                   MOVEL     §LPQFT        VIDQFT
252540940927     C                   MOVEL     §LPIAS        VIDIAS
252550940926     C                   MOVEL     §LPVAS        VIDVAS
252560950517     C                   MOVEL     §LPVAS        VARVAS
252570940926     C                   MOVEL     §LPVMD        VIDVMD
252580940926     C                   MOVEL     §LPVAD        VIDVAD
252590950517     C                   MOVEL     §LPVAD        VARVAD
252600911031     C                   MOVEL     §LPNAS        VIDNAS
252610040610     C                   MOVEL     §LPbva        VIDbva
252620940819     C                   MOVEL     §LPNCL        V1CNCL
252630930401     C                   MOVEL     §LPNCL        SAVNCL
252640930401     C                   MOVEL     §LPNCL        VIDNCL
252650940926     C                   Z-ADD     §LPPKB        VIDPKG
252660940926     C                   Z-ADD     §LPPKB        V2CPKG
252670980402     C                   Z-ADD     0             SAVPKG
252680940926     C                   Z-ADD     §LPVLB        VIDVOL
252690980402     C                   Z-ADD     0             SAVVOL
252700940926     C                   MOVEL     §LPCAS        VIDCAS
252710110519     C     mi:ma         xlate     §LPVCA        VIDVCA
252720110519     C     mi:ma         xlate     §LPVCA        VARVCA
252730911031     C                   MOVEL     §LPTIC        VIDTIC
252740900824     C*
252750911031     C                   MOVEL     §LPRMN        VIDRMN
252760940926     C                   MOVEL     §LPRMA        VIDRMA
252770911031     C                   MOVEL     §LPRMO        VIDRMO
252780091008     C                   MOVEL     '1'           WOVUO1
252790060627     c* se lnp dpd metto rmn in nrd
252800060628     c                   if        §ogntw='DPD' and §3arbl <> 'R'
252810060628     c                   movel     §lpnpr        vidnrd
252820060628     c                   endif
252830900824     C* CONTROLLO SE POSIZIONARMI SU SEGNACOLLO O SU VOLUME
252840911031     C     §LPNCD        IFEQ      0
252850931123     C                   SETOFF                                       36
252860900824     C                   ELSE
252870900827     C                   SETON                                        36
252880900824     C                   END
252890940926     C                   MOVEL     §LPNOT        VIDNT1
252900940926     C                   MOVEL     §LPNT2        VIDNT2
252910910129     C* CODICE TRATTAMENTO MERCE
252920011206     C* QUESTE SPECIFICHE LE HO SPOSTATE PRIMA DELL'IMPOSTAZIONE DI VID
252930011206     C* LNA PERCHE' MI SERVIVA IL CONTENUTO DI §1BF12
252940950504     C*
252950910805     C                   MOVEL     *ZEROS        VIDNCD
252960910805     C                   MOVEL     *ZEROS        VIDNCA
252970921005     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
252980920203     C     §LPFPR        IFEQ      'G'
252990941230     C                   MOVEL     §LPFPR        WFPR              1
253000920203     C                   MOVEL     §LPNCD        VIDNCD
253010920203     C                   MOVEL     §LPNCA        VIDNCA
253020920203     C                   MOVEL     'V'           §LPFPR
253030950420     C                   SETON                                        8744
253040011029     C                   MOVEL     PROT          ATRFTM
253050970328     C     §LPBAM        IFEQ      ' '
253060970328     C                   MOVEL     'S'           §LPBAM
253070920203     C                   END
253080970328     C                   END
253090941230     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
253100941230     C* IN QUESTO CASO NON MI FERMO SULLA BOLLA E NON LA STAMPO
253110941230     C     §LPFPR        IFEQ      'P'
253120941230     C                   MOVEL     §LPFPR        WFPR              1
253130941230     C                   MOVEL     §LPNCD        VIDNCD
253140941230     C                   MOVEL     §LPNCA        VIDNCA
253150941230     C                   MOVEL     'X'           §LPFPR
253160950420     C                   SETON                                        8744
253170011029     C                   MOVEL     PROT          ATRFTM
253180970328     C     §LPBAM        IFEQ      ' '
253190970328     C                   MOVEL     'S'           §LPBAM
253200970328     C                   END
253210941230     C                   END
253220921029     C* CREO BOLLA PER INVIO DISPOSIZIONI MITTENTE AI CLIENTI
253230921029     C     §LPFPR        IFEQ      'I'
253240921029     C                   MOVEL     'X'           §LPFPR
253250940222     C                   MOVEL     'I'           WFPR
253260011029     C                   SETON                                        87
253270011029     C                   MOVEL     PROT          ATRFTM
253280921029     C                   END
253290020522     C     §LPFPR        IFEQ      'T'
253300030609      * se sto creando una bolla "FT" x ORM commissionati
253310030609      * devo impostare §lpfpr = 'X' e proteggere la lna
253320030609    2c                   If        §lpCbo = 'FT'
253330030609     c                   Eval      §lpFpr = 'X'
253340030609     c                   Movel     Prot1         AtrLna
253350030609    xc                   Else
253360020522     C                   MOVEL     'V'           §LPFPR
253370030609    2c                   EndIf
253380020522     c                   endif
253390150302     C* SE PROGRAMMA VIENE DA Gest.Bancali
253400150302     C     §LPFPR        IFEQ      'B'
253410150302     C                   SETON                                        44
253420150302     C                   MOVEL     PROT          ATRFTM
253430150302     C                   MOVEL     PROT          ATRnt1
253440150302     C                   MOVEL     PROT          ATRnt2
253450150302     C                   MOVEL     PROT          ATRncl
253460150302     C                   MOVEL     PROT          ATRpkg
253470150302     C                   MOVEL     PROT          ATRncl2
253480150302     C                   MOVEL     PROT          ATRpkg2
253490150302     C                   MOVEL     'V'           §LPFPR
253500150302     C                   END
253510160613     C* SE PROGRAMMA VIENE DA creazione in Batch "VEDI PACCO DPD"
253520160613     C     §LPFPR        IFEQ      'D'
253530160613     C                   MOVEL     'W'           §LPFPR
253540160613     C                   END
253550910208     C* SOLO CON FLAG6=C PRENDO I SEGNACOLLI SE NO COMUNQUE LI AZZERO
253560910208     C     §1BFG6        IFEQ      'C'
253570911031     C                   MOVEL     §LPNCD        VIDNCD
253580911031     C                   MOVEL     §LPNCA        VIDNCA
253590920204     C                   END
253600910805     C* SE FLAG7=S ABILITO TASTO PER GESTIONE DETT. STAMPA SEGNACOLLI
253610910805     C     §1BFG7        IFEQ      'S'
253620020917     C* Se DISKC non devo abilitare l'F21 di manutenzione fivad
253630001016     C     §1BF12        IFEQ      'N'
253640001106     C     §1BF12        OREQ      'E'
253650001106     C     WASDKC        ANDNE     'S'
253660910805     C                   SETON                                        94
253670001016     C                   ENDIF
253680910805     C* SE VI3FNS=S -> C'E' SEGNACOLLO E NON CODICE PRODOTTO
253690020917     C     KBLC          SETLL     FIVAD000
253700020917     C     KBLC          READE(N)  FIVAD000                               31
253710910805     C  N31BLDNCD        IFGT      0
253720920204     C     BLDCDP        ANDEQ     *BLANKS
253730910805     C                   MOVEL     'S'           VI3FNS
253740910805     C                   END
253750910805     C                   END
253760910220     C*
253770120903     C***  §1BFG2        IFNE      'N'
253780120903     C***  §LPFPR        OREQ      'R'
253790120903     C     §1BFG2        IFeq      'S'
253800921005     C                   MOVEL     §LPNSP        VIDNSP
253810921005     C                   MOVEL     §LPNRS        VIDNRS
253820921005     C                   ELSE
253830910129     C                   Z-ADD     0             VIDNSP
253840910129     C                   Z-ADD     0             VIDNRS
253850000829     C                   END
253860050222     C* SE NAZIONE DESTINATARIO ESTERA,
253870050222     C* CONTROLLO IL COD.TARIFFA PER SAPERE SE E' TRAFFICO DPD
253880050222     C                   MOVEL     '15'          COD
253890050222     C                   MOVEL(P)  VIDNZD        KEY
253900050222     C                   EXSR      CTABEL
253910050222     C   30              CLEAR                   DS15
253920050222     C  N30              MOVEL     TBLUNI        DS15
253930050222     C*
253940050222    1C     §15ITA        IFNE      'I'
253950050222     C                   MOVE      WKSC          W0040
253960050222     C*
253970050222     C* SE CLIENTE CODIFICATO, FACCIO COME ADESSO
253980050222     C* SE CLIENTE NON CODIFICATO MA COD.TRATTAMENTO MERCE PER DPD,
253990050222     C*   E LNA DPD, CONSIDERO LO STESSO IL RIF.MITTENTE
254000050222   1AC     W0040         IFEQ      8888
254010050222     C     W0040         OREQ      9999
254020050222     C     VIDLNA        IFGT      *ZEROS
254030050222     C     A_§OGNTW      ANDEQ     'DPD'
254040050222     C                   MOVEL     'D'           VIDDPD
254050050222     C*
254060050222     c                   select
254070050222    5C     §1BF13        wheneq    'R'
254080060628     c                   movel     §lpnpr        vidnrd
254090050222    5C     §1BF13        wheneq    *blanks
254100050222     c                   exsr      sr_vatdpd
254110060612     c                   movel     w014a         vidnrd
254120050222     C                   ENDsl
254130050222     c                   else
254140050222     c     vidlna        ifgt      *zeros
254150050222     c     A_§ogntw      andeq     'FED'
254160050222     c                   movel     'F'           viddpd
254170050222     c                   endif
254180050222     C                   ENDIF
254190050222     C*
254200050222  X1AC                   ELSE
254210050222     C*
254220050921     c                   clear                   fnlv59ds
254230050921     C                   MOVEL     'P'           ilv59tbo
254240050222      * se bolla monovaria pulisco il tipo bolla
254250050222     C                   IF        §3ASVA <> *BLANK
254260050921     C                   CLEAR                   ilv59tbo
254270050921     C                   movel     'P'           ilv59prp
254280050222     C                   ENDIF
254290050222
254300050921     C                   MOVEL     WKSC          ilv59KSC
254310050921     C                   MOVEL     KCI           ilv59KCI
254320050921     C                   MOVEL     BLPDSP        ilv59DSP
254330050921     C                   MOVEL     VIDTSP        ilv59TSP
254340050921     C                   MOVEL     §LPCTR        ilv59CTR
254350050921     C                   MOVEL     'S'           ilv59RIC
254360050921     C                   MOVEL     'S'           ilv59CON
254370050222     C* CONTROLLO TRA LE TARIFFE ESTERE E ITALIADPD
254380050921     C                   MOVEL     'S'           ilv59FIE
254390150415
254400150415     c                   if        savfpr<>' '
254410150415     C                   EVAL      ILV59blo='S'
254420150415     c                   endif
254430150415
254440050921     C                   CALL      'FNLV59R'
254450050921     C                   PARM                    fnlv59ds
254460050222     C*
254470050222     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDOPRG
254480050921    2C     olv59err      IFEQ      ' '
254490050921     C     olv59tks      ANDEQ     'S'
254500050921     C                   MOVEL     olv59prg      COMPRG
254510050222     C                   MOVEL     §LPCTR        COMCTR
254520050222     C     KTAM2         CHAIN     TNTAM000                           30
254530050222     C* TARIFFA VALIDA
254540050222    3C     *IN30         IFEQ      *OFF
254550050222     C     TAMATB        ANDEQ     ' '
254560050222     C                   MOVEL     TAMFLO        DSTA01
254570050222     C* TARIFFA DPD
254580050222    4C     §TADPD        IFEQ      'S'
254590170228     c                   if        comlna=0 or a_§ogntw='DPD'
254600050222     C                   MOVEL     'D'           VIDDPD
254610050222     c                   select
254620050222    5C     §1BF13        wheneq    'R'
254630060628     c                   movel     §lpnpr        vidnrd
254640050222    5C     §1BF13        wheneq    *blanks
254650050222     c                   exsr      sr_vatdpd
254660060612     c                   movel     w014a         vidnrd
254670050222    5C                   endsl
254680170228     c                   endif
254690050222     c                   else
254700050222     c* tariffa fedex
254710050222     c     §tafed        ifeq      'S'
254720050222     c                   movel     'F'           viddpd
254730050222     c                   endif
254740050222    4C                   ENDIF
254750050222    3C                   ENDIF
254760050222    2C                   ENDIF
254770050222   1AC                   ENDIF
254780050222    1C                   ENDIF
254790000831     C* PER NO DISK "B" CONTROLLO SE DISK "C"
254800000904     C* Spengo indicatore per attivazione tasto funzionale di gestione
254810000904     c* cod. CHI SONO
254820000901     C                   SETOFF                                       96
254830000901    1C     §1BFG1        IFNE      'S'
254840000831     C     WASDKC        ANDEQ     'S'
254850000831     C* SE IMPORT DPD O COD.TRATTAMENTO MERCE CHE PREVEDE IL DISK C
254860000901    2C     §1BF12        IFNE      'N'
254870001013     C     §1BF12        ANDNE     ' '
254880020319     C     §OGNTW        OREQ      'DPD'
254890000919     C     §3CDKC        ANDEQ     'S'
254900000214     C                   MOVEL     ':'           VIDSOP
254910000901     C* Carico subfile prendendo il chi sono dal VAT oppure dal VAB/VAD
254920000901     C* in base al tipo di DISKC
254930050222     c* Non devo caricare il subfile se:
254940050222     c* 1) spedizione export dpd e numero parcel dpd = codice chi sono
254950050222     c* 2) spedizione import dpd
254960050222     c* in questi due casi infatti il cod.chi sono coincide col numero
254970050222     c* parcel dpd che viene già inserito in altro modo
254980051102     c* Sarà il pgm a tenerne conto per la scrittura di fisgn e FIARS
254990000901    3C     §1BF12        IFEQ      'E'
255000050222     c     viddpd        andne     'D'
255010050222     c     §ogntw        andne     'DPD'
255020050222     c     §1bf12        oreq      'E'
255030050222     c     viddpd        andeq     'D'
255040050222     c     §1bf13        andne     *blanks
255050030321      * se non ho superato i 500 colli
255060050222     c     V1cNcl        ifle      500
255070000829     C                   EXSR      CARVAT
255080000901     C                   SETON                                        96
255090000911     C     NR8           IFGT      0
255100000911     C                   SETON                                        78
255110000911     C                   ENDIF
255120050222     c                   endif
255130000901   X3C                   ELSE
255140000901    4C     §1BF12        IFEQ      'B'
255150030321      * se non ho superato i 500 colli
255160030321     c     V1cNcl        andle     500
255170140506     c* se vengo da dirottamenti carico da FIART altrimenti dal VAB
255180140506     c                   if        §lpnspm>0
255190140506     c                   exsr      CARART
255200140506     c                   else
255210000901     C                   EXSR      CARVAB
255220140506     c                   endif
255230000911     C     NR8           IFGT      0
255240000911     C                   SETON                                        78
255250000911     C                   ENDIF
255260000901     C                   SETON                                        96
255270050222     c                   else
255280050222     c* se import dpd e numero parcel nel fivat lo metto nel rmn
255290050222     c     §1bf12        ifeq      'E'
255300050222     c     §ogntw        andeq     'DPD'
255310050222     c                   exsr      sr_vatdpd
255320060612     c                   movel     w014a         vidnrd
255330060616     c                   seton                                        79
255340050222     c                   endif
255350000901    4C                   ENDIF
255360000901    3C                   ENDIF
255370000901    2C                   ENDIF
255380000901    1C                   ENDIF
255390001106     C*
255400001106     C* SE FLAG 12 = 'E' MA AS400 NON ABILITATO A DISK C CARICO LO
255410020917     C* STESSO SUBFILE PRENDENDO I DATI DA FIVAT
255420001106    1C     §1BFG1        IFNE      'S'
255430001106     C     WASDKC        ANDNE     'S'
255440001106     C     §1BF12        ANDEQ     'E'
255450030321      * se non ho superato i 500 colli
255460030321     c     V1cNcl        andle     500
255470050222     c     viddpd        ifne      'D'
255480050222     c     §ogntw        andne     'DPD'
255490050222     c     viddpd        oreq      'D'
255500050222     c     §1bf13        andne     *blanks
255510001106     C                   EXSR      CARVAT
255520001106     C                   SETON                                        96
255530001106     C     NR8           IFGT      0
255540001106     C                   SETON                                        78
255550001106     C                   ENDIF
255560050222     c                   endif
255570001106     C                   ENDIF
255580000831     C*
255590911031     C                   MOVEL     §LPFFD        VIDFFD
255600010214     C     §LPFFD        IFEQ      *BLANKS
255610010214     C                   MOVEL     'N'           VIDFFD
255620010214     C                   ENDIF
255630911031     C                   MOVEL     §LPTCR        VIDTCR
255640940927     C                   MOVEL     §LPHCR        VIDHCR
255650940927     C                   MOVE      §LPHCR        VIDMCR
255660150202     c* non tengo l'ora consegna richiesta del cliente
255670150202     c* se < 8:00 o > 20:00
255680150203     c* se h 10:30 se < 0800 o > 1030
255690150202     c                   if        §lphcr<0800 or
255700150203     c                             (vidtsp='H' and §lphcr>1030) or
255710150202     c                             §lphcr>2000
255720150202     c                   clear                   vidhcr
255730150202     c                   clear                   vidmcr
255740150202     c                   endif
255750150203     c
255760940927     C* MI SERVONO PER IL CONFRONTO PER SAPERE SE CAMBIARE O NO I CAMPI
255770940927     C   04              Z-ADD     §LPCCN        SAVCCM
255780941103     C  N04              Z-ADD     1             SAVCCM
255790920123     C*
255800920123     C                   MOVEL     §LPFBR        VIDFBR
255810031029     c                   Clear                   VidGca
255820940927     C                   MOVEL     §LPGGA        VIDGGA
255830940927     C                   MOVEL     §LPGMA        VIDGMA
255840091221     c                   eval      wvidgma = §lpgma
255850100604     c* Verifico se c'e' ritiro contestuale alla consegna
255860100604     c                   clear                   ds7r
255870100604     C                   MOVEL     '7R'          COD
255880100604     C                   MOVEL(P)  §lpGMA        KEY
255890100604     C                   EXSR      CTABEL
255900100604     C  n30              MOVEL     TBLUNI        DS7R
255910100604     c                   eval      w7rRC = §7rRC
255920141202     c                   eval      w7rPC = §7rpincode
255930100604     c
255940940927     C                   MOVEL     §LPGVA        VIDGVA
255950031029     c                   move      ' '           VidGva
255960920123     C                   MOVEL     §LPPOR        VIDPOR
255970940927     C                   MOVEL     §LPIMV        VIDIMV
255980991026     C                   MOVEL     §LPDIV        VIDDIV
255990970326     C* FLAG DDT S/N
256000970326     C     §LPBAM        IFNE      ' '
256010970328     C     §LPBAM        IFEQ      'S'
256020970328     C     §LPBAM        OREQ      'C'
256030060609     C     §LPBAM        OREQ      'P'
256040060609     C     §LPBAM        OREQ      'Q'
256050991007     C                   MOVEL     'S'           VIDBAM
256060970328     C                   ELSE
256070970328     C                   MOVEL     'N'           VIDBAM
256080970326     C                   ENDIF
256090970328     C                   ENDIF
256100020102     C* SE SONO RICHIAMATA DA PGM DELLE GIACENZE E HO DEGLI IMPORTI DI
256110020102     C* TASSAZIONE SENZA NUMERO FATTURA E LA DIVISA E' DIVERSA DA GE
256120020102     C* DCN MEMORIZZO CHE DEVO CARICARE LA VIDEATA CON GLI IMPORTI CON-
256130020102     C* VERTITI NELLA DIVISA DI CONTO DAL MOMENTO CHE PER §LPFPR = "G",
256140020102     C* "I" O "P" I DATI DI TASSAZIONE SONO PROTETTI ED IN CASO DI
256150020102     C* ERRORE DI DIVISA SCADUTA L'YENTE NON PUO' IN ALCUN MODO INTERVE
256160020102     C* NIRE PER CAMBIARE LA DIVISA
256170020102     C                   CLEAR                   WCONV
256180020102     C     WFPR          IFEQ      'G'
256190020102     C     WFPR          OREQ      'I'
256200020102     C     WFPR          OREQ      'P'
256210020102     C     VIDNFT        IFEQ      0
256220020102     C     VIDDIV        ANDNE     *BLANKS
256230020102     C     VIDDIV        ANDNE     §GEDCN
256240020102     C                   MOVEL     '1'           WCONV             1
256250020102     C                   ENDIF
256260020102     C                   ENDIF
256270940927     C* CARICO LE VARIE
256280940927     C                   Z-ADD     0             NRR
256290941108     C                   DO        20            C
256300991027     C                   MOVEL     VSV(C)        WSVN
256310991027     C                   Z-ADD     VVA(C)        WVAN
256320940927     C                   EXSR      CARVAR
256330020102      * CARICO SCHIERA VARIE X RICALCOLO TOT.IMPONIBILE
256340020102     C     WCONV         IFEQ      '1'
256350020102     C     VIDIMV        ANDGT     *ZEROS
256360020102     C                   MOVEL     V3CSV1        VSV(C)
256370020102     C                   Z-ADD     V3CVA1        VVA(C)
256380020102     C                   MOVEL     V3CEV1        VES(C)
256390020102     C                   ENDIF
256400941108     C                   ENDDO
256410020102     C* CONVERTO ANCHE PORTO E RICALCOLO EVENTUALMENTE IL TOTALE IMPO-
256420020102     C* NIBILE
256430020102    1C     WCONV         IFEQ      '1'
256440020102     C* PORTO
256450020102    2C     VIDPOR        IFGT      *ZEROS
256460020102     C                   CLEAR                   DSYEUR
256470020102     C                   MOVEL     VIDDIV        YECDVI
256480020102     C                   Z-ADD     VIDPOR        YECIMI
256490020102     C                   MOVEL     §GEDCN        YECDVO
256500020102     C     COMFDC        IFEQ      'S'
256510020102     C                   MOVEL     '3'           YECDCO
256520020102     C                   ELSE
256530020102     C                   MOVEL     '0'           YECDCO
256540020102     C                   ENDIF
256550020102     C                   CALL      'YEURCO'
256560020102     C                   PARM                    DSYEUR
256570020102    3C     YECESI        IFEQ      ' '
256580020102     C                   Z-ADD     YECIMO        VIDPOR
256590020102    3C                   ENDIF
256600020102    2C                   ENDIF
256610020102     C* TOTALE IMPONIBILE
256620020102    2C     VIDIMV        IFGT      *ZEROS
256630020102     C                   CLEAR                   DSLV16
256640020102     C                   MOVEL     'T'           D17FIM
256650020102     C                   Z-ADD     VIDPOR        D17POR
256660020102     C                   CALL      'FNLV16R'
256670020102     C                   PARM                    DSLV16
256680020102     C                   PARM                    DTASV
256690020102     C                   Z-ADD     O17IMV        VIDIMV
256700151014     C                   Z-ADD     O17IMV        savIMV_fat
256710020102    2C                   ENDIF
256720020102     C* DIVISA
256730020102     C                   MOVE      §GEDCN        VIDDIV
256740020102    1C                   ENDIF
256750020102     C                   CLEAR                   WCONV
256760940927     C*
256770940927     C* NUM TENTATIVI PER SUPERARE CONTROLLI FORZATI
256780940927     C     §LPFPR        IFNE      'V'
256781170831     C     §LPFPR        oreq      'N'
256790941021     C                   Z-ADD     1             NUMFOR
256800940927     C                   ELSE
256810940927     C                   Z-ADD     1             NUMFOR
256820940927     C                   ENDIF
256830941020     C*
256840941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
256850941020     C     VIDPOR        IFNE      0
256860941020     C     NRR           ORNE      0
256870941020     C     VIDCEI        ORNE      ' '
256880941020     C     VI2SV1        ORNE      ' '
256890040114     c     Vi2Sv2        orne      *Blanks
256900040114     c     Vi2Sv3        orne      *Blanks
256910040114     c     Vi2Sv4        orne      *Blanks
256920941020     C     VI2CEI        ORNE      ' '
256930941020     C                   MOVEL     'S'           WEMD03            1
256940941020    1C                   ENDIF
256950941011     C*
256960941011     C* VISUALIZZO IL NUMERO DI SPEDIZIONE CHE STO CONFERMANDO
256970941011     C                   Z-ADD     §LPNRS        PRENRS
256980941011     C                   Z-ADD     §LPNSP        PRENSP
256990941011     C                   MOVEL     §LPLNA        PRELNA
257000941011     C                   Z-ADD     §LPRMN        PRERMN
257010941011     C                   Z-ADD     §LPZNC        PREZNC
257020040506
257030040506      * Imposto la ds di comodo del n. spedizione
257040060222     c****               Z-add     VidLnp        WidLnp
257050060222     c                   Z-add     §lplnp        WidLnp
257060040506     c                   Z-add     §lpNrs        WidNrs
257070040506     c                   Z-add     §lpNsp        WidNsp
257080000124     C*
257090000508     C*
257100050114     C* SE LNP POSTE, MEMORIZZO A PARTE IAS, PER
257110060216     C*  MEMORIZZARLO NEL ar4 RECORD "J"
257120140122     C**   §ogntw        IFEQ      'PPT'
257130140122     C**                 Z-ADD     VIDIAS        §B4IAS
257140140122     C**                 MOVEL     VIDVAS        §B4VAS
257150140122     C**                 MOVEL     §LPDSK        §B4DSC
257160140122     c**                 clear                   §b4xco
257170140122     C**                 CLEAR                   VIDIAS
257180140122     C**                 CLEAR                   VIDVAS
257190140122     C**                 ENDIF
257200031125
257210021218      * Carico i dati relativi ai bancali
257220021220     c                   If        §LpTba > *Zeros
257230021218     c                   Movel     §LpTba        VidTba
257240021220     c                   EndIf
257250021218     c                   Eval      VidNba = §LpNba
257260030704     c                   Eval      SavNba = §LpNba
257270030224     c                   If        §LpTb2 > *Zeros
257280021218     c                   Movel     §LpTb2        VidTb2
257290021220     c                   EndIf
257300021218     c                   Eval      VidNb2 = §LpNb2
257310030704     c                   Eval      SavNba = §LpNb2
257320031125      * più quelli relativi ai colli sfusi e originali
257330031125     c                   Eval      w03Cor = §LpCor
257340031125     c                   Eval      w03Csf = §LpCsf
257350030409
257360030409      * Ore da sommare alla delivery
257370030409     c                   Move      §ore          VidOre
257380031125
257390031125      * carico i dati del telefono e del referente
257400031125     c                   Eval      VidRef = §LpRef
257410031125     c                   Eval      VidTel = §LpTel
257420031125
257430031125      * Imposto i campi dal FIVAT no record 'E'
257440031125     c                   ExSr      Sr_CarVat
257450031125      * Controllo quali dati dei bancali devo tenere
257460031126      * se non sono richiamta da giacenze
257470031126     c                   If        (savfpr <> 'P' and savfpr <> 'G')
257480031125     c                   ExSr      Sr_CtrBancali
257490031126     c                   EndIf
257500160323     c* Se spedizione import DPD memorizzo se si tratta di "VEDI PACCO"
257510160323     c                   clear                   w_vediP           1
257520160323     c                   if        §ogntw='DPD'
257530160323     c                   eval      dblp01=§lpflo
257540160323     c                   if        §lptrd='1'
257550160323     c                   eval      w_vediP='1'
257560160323     c                   endif
257570160323     c                   endif
257580021218
257590900824     C                   ENDSR
257600010301     C*
257610010301     C*--- CARICO RECORD BOLLE DA CONFERMA ORM PREPAGATI -------------*
257620010301     C     CARBLO        BEGSR
257630010301     C                   Z-ADD     §LPPOE        VIDPOE
257640010301     C                   MOVEL     §LPNSR        VIDNOR
257650010301     C                   MOVE      §LPNOR        VIDNOR
257660010301     C                   Z-ADD     §LPNRV        VIDNRV
257670010301     C                   Z-ADD     VIDORM        WIDORM
257680010924     C                   CLEAR                   DORM01
257690010301     C     KORM          CHAIN     FNORM01L                           30
257700010301     C                   Z-ADD     ORMPOR        VIDLNP
257710010301     C                   MOVEL     '1'           VIDCBO
257720010924     C                   MOVEL     ORMFLO        DORM01
257730011121     C* Proteggo i campi a video relativi il destinatario se devo forza
257740011121     C* re il destinatario da orm
257750011121     C     §ORMFD        IFEQ      'S'
257760011121     C                   MOVEL     PROT          ATRDES
257770011121     C                   ELSE
257780011121     C                   CLEAR                   ATRDES
257790011121     C                   ENDIF
257800010301     C                   EXSR      PRPOR1
257810010307     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
257820010307     C* ANDRO' A PROPORRE NELLE NOTE
257830010307     C     'TEL.:'       CAT       ORMTER        W021A            21
257840010307     C     W021A         CAT(P)    ORMRER:1      WTELRF           70
257850010307     C                   MOVE      WTELRF        WTELR2           35
257860010301     C                   ENDSR
257870000627     C*
257880000627     C*--- RISCRIVO AGGIORNATA LA DBLP -------------------------------*
257890000627     C     AGDBLP        BEGSR
257900000627     C* DATA SPEDIZIONE
257910000627     C                   Z-ADD     BLPDSP        §LPMGS
257920000627     C                   MOVEL     BLPDSP        §LPAAS
257930000627     C* DATA CONSEGNA RICHIESTA
257940000627     C                   Z-ADD     COMDCR        §LPDCR
257950000627     C                   MOVEL     VIDSOP        §LPSOP
257960000627     C                   MOVEL     VIDRMN        §LPRMN
257970000627     C                   MOVEL     VIDRMA        §LPRMA
257980000627     C                   MOVEL     VIDRMO        §LPRMO
257990000627     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
258000000627     C                   Z-ADD     COMDRT        §LPDRT
258010000627     C                   MOVEL     VIDNRT        §LPNRT
258020000627     C                   MOVEL     VIDFPP        §LPFPP
258030000627     C                   MOVEL     VIDLNP        §LPPDR
258040000627     C                   MOVE      VIDPDR        §LPPDR
258050000627     C*
258060000627     C* CODICE BOLLA
258070000627     C                   MOVEL     VIDCBO        §LPCBO
258080000627     C                   Z-ADD     VIDCAS        §LPCAS
258090011113     C     VIDCAS        IFGT      *ZEROS
258100011113     C                   MOVEL     VIDVCA        §LPVCA
258110011113     C                   ELSE
258120011113     C                   CLEAR                   §LPVCA
258130011113     C                   ENDIF
258140000627     C                   MOVEL     VIDTIC        §LPTIC
258150000627     C                   MOVEL     VIDGCA        §LPGCA
258160011113     C                   CLEAR                   §LPCMB
258170000627     C* SEGNACOLLI
258180000627    1C     §3ABCM        IFEQ      ' '
258190000627     C                   EXSR      ASSSGN
258200000627     C     WEMFOR        IFEQ      ' '
258210000627     C                   MOVEL     BLPNCD        §LPNCD
258220000627     C                   MOVEL     BLPNCA        §LPNCA
258230000627     C                   ENDIF
258240000627     C                   ELSE
258250000627     C                   CLEAR                   §LPNCD
258260000627     C                   CLEAR                   §LPNCA
258270000627     C                   ENDIF
258280000627     C* TASSAZIONE
258290000627     C                   Z-ADD     VIDPOR        §LPPOR
258300000627     C                   Z-ADD     VIDIMV        §LPIMV
258310000627     C                   MOVEL     VIDCEI        §LPCEI
258320000627     C                   MOVEL     VIDDIV        §LPDIV
258330000627     C* MANCANO LE VARIE E DATI FATTURA !!
258340000627     C**
258350000627     C                   MOVEL     COMLNA        §LPLNA
258360000627     C                   MOVEL     VIDRSM        §LPRSM
258370000627     C                   MOVEL     VIDINM        §LPINM
258380000627     C                   MOVEL     VIDCAM        §LPCAM
258390000627     C                   MOVEL     VIDLOM        §LPLOM
258400000627     C                   MOVEL     VIDPRM        §LPPRM
258410000627     C                   MOVEL     VIDNZM        §LPNZM
258420000627     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
258430000627     C     VIDCMO        IFNE      *BLANKS
258440000627     C                   MOVEL     VIDCMO        §LPCAM
258450000627     C                   MOVEL     VIDNMO        §LPNZM
258460000627     C                   ENDIF
258470000627     C*
258480000627     C                   MOVEL     VARZNC        §LPZNC
258490000627     C     §3ACTM        IFNE      *BLANKS
258500000627     C                   MOVEL     §3ACTM        §LPCTM
258510000627     C                   ELSE
258520000627     C                   MOVEL     VIDCTM        §LPCTM
258530000627     C                   ENDIF
258540000627     C     BLPCTM        IFEQ      *BLANKS
258550000627     C                   MOVEL     WCTM          §LPCTM
258560000627     C                   ENDIF
258570000627     C                   MOVEL     VIDTC1        §LPTC1
258580000627     C                   MOVEL     VIDTC2        §LPTC2
258590000627     C                   MOVEL     VIDGGA        §LPGGA
258600000627     C                   MOVEL     VIDGMA        §LPGMA
258610000627     C                   MOVEL     VIDGVA        §LPGVA
258620000627     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
258630000627     C* DELLE PARTICOLARITA' VARIE
258640000627     C     W2LN          IFEQ      'S'
258650000627     C                   MOVE      'D'           §LPGVA
258660000627     C                   ELSE
258670000627     C                   MOVE      ' '           §LPGVA
258680000627     C                   ENDIF
258690000627     C* P A R T I T A   I V A
258700000627     C*
258710000627     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
258720000627     C*     NELLA P.IVA
258730000627     C     VIDISM        IFEQ      '$$'
258740000627     C     VIDCPM        ANDEQ     *BLANKS
258750000627     C                   MOVEL     'PRIVATO'     VIDCPM
258760000627     C                   ENDIF
258770000627     C     VIDISD        IFEQ      '$$'
258780000627     C     VIDCPD        ANDEQ     *BLANKS
258790000627     C                   MOVEL     'PRIVATO'     VIDCPD
258800000627     C                   ENDIF
258810000627     C*
258820000627     C  N04VIDISM        IFEQ      *BLANKS
258830000627     C                   MOVEL     VIDCPM        §LPCPI
258840000627     C                   ELSE
258850000627     C                   MOVEL     VIDPIM        §LPCPI
258860000627     C                   ENDIF
258870000627     C   04VIDISD        IFEQ      *BLANKS
258880000627     C                   MOVEL     VIDCPD        §LPCPI
258890000627     C                   ELSE
258900000627     C                   MOVEL     VIDPID        §LPCPI
258910000627     C                   ENDIF
258920000627     C**
258930000627     C                   MOVEL     VIDRSD        §LPRSD
258940000627     C                   MOVE      VIDRSD        §LPRD2
258950000627     C                   MOVEL     VIDIND        §LPIND
258960000627     C                   MOVEL     VIDCAD        §LPCAD
258970000627     C                   MOVEL     VIDLOD        §LPLOD
258980000627     C                   MOVEL     VIDPRD        §LPPRD
258990000627     C                   MOVEL     VIDNZD        §LPNZD
259000000627     C                   MOVEL     VIDGC1        §LPGC1
259010000627     C                   MOVEL     VIDGC2        §LPGC2
259020000627     C                   MOVEL     VIDCTR        §LPCTR
259030000627     C                   MOVEL     SAVCTS        §LPCTS
259040000627     C                   MOVEL     VIDFBR        §LPFBR
259050000627     C* ALLEGA BAM
259060000627     C                   EXSR      AGGFST
259070000627     C                   MOVEL     BLPFST        §LPBAM
259080000627     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
259090000627     C                   CLEAR                   §LPFTM
259100000627     C   04SAVFTM        IFEQ      'S'
259110000627     C     VIDFTM        OREQ      'S'
259120000627     C                   MOVEL     'S'           §LPFTM
259130000627     C                   ENDIF
259140000627     C* SE NON IMMESSO TIPO SERVIZIO
259150000627     C     VIDTSP        IFNE      *BLANKS
259160000627    1C                   MOVEL     VIDTSP        §LPTSP
259170000627     C                   ELSE
259180000627     C* LO PRENDO DA TARIFFA
259190000627     C                   MOVEL     COMTSP        §LPTSP
259200000627     C                   ENDIF
259210000627     C                   MOVEL     VIDIAS        §LPIAS
259220011113     C     VIDIAS        IFGT      *ZEROS
259230011113     C                   MOVEL     VIDVAS        §LPVAS
259240011113     C                   ELSE
259250011113     C                   CLEAR                   §LPVAS
259260011113     C                   ENDIF
259270000627     C                   MOVEL     VIDVMD        §LPVMD
259280011113     C     VIDVMD        IFGT      *ZEROS
259290011113     C                   MOVEL     VIDVAD        §LPVAD
259300011113     C                   ELSE
259310011113     C                   CLEAR                   §LPVAD
259320011113     C                   ENDIF
259330000627     C                   MOVEL     VIDQFT        §LPQFT
259340000627     C                   MOVEL     VIDNAS        §LPNAS
259350000627     C                   MOVEL     V1CNCL        §LPNCL
259360000627     C                   MOVEL     V2CPKG        §LPPKB
259370000627     C                   MOVEL     VIDFVR        §LPFVB
259380000627     C                   MOVEL     VARVOL        §LPVLB
259390000627     C                   MOVEL     VIDFFD        §LPFFD
259400010214     C     VIDFFD        IFEQ      'N'
259410010214     C                   MOVE      *BLANKS       §LPFFD
259420010214     C                   ENDIF
259430000627     C                   MOVEL     VIDTCR        §LPTCR
259440000627     C                   MOVEL     COMDCR        §LPDCR
259450000627     C                   MOVEL     VIDHCR        §LPHCR
259460000627     C                   MOVE      VIDMCR        §LPHCR
259470000627     C*
259480000627     C                   MOVEL     VIDNT1        §LPNOT
259490000627     C                   MOVEL     VIDNT2        §LPNT2
259500000627     C***
259510000627     C***  F L A G   I N O L T R O
259520000627     C                   EXSR      INOLTR
259530000627     C                   MOVEL     WFIN          §LPFIN
259540000627     C*
259550000627     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
259560000627    2C     APDFCM        IFNE      ' '
259570000627     C                   MOVEL     'C'           §LPFAP
259580000627     C                   ELSE
259590000627     C                   MOVEL     COMFAP        §LPFAP
259600000627    2C                   END
259610050114     c* flag unificazione spedizioni
259620050114     c                   if        *in12 and *in15
259630050114     c                   eval      §lpxco = wxco
259640050114     c                   endif
259650000627     C**
259660000627     C                   ENDSR
259670940927     C*
259680940927     C* CARICAMENTO BOLLE: DECODIFICHE -------------------------------*
259690940927     C     DECBOL        BEGSR
259700961007     C                   SETOFF                                       0413
259710950410     C                   SETOFF                                       131487
259720940927     C                   SETOFF                                       364494
259730940928     C*
259740940928     C* SE EMETTO 1 VIDEATA MI POSIZIONO SEMPRE SUL MITTENTE
259750010222     C* O SUL NUMERO ORM SE ATTIVATA PROCEDURA E SONO IM MANUTENZIONE
259760961007     C                   SETON                                        0730
259770940927     C*
259780940927     C* M I T T E N T E
259790960926     C* LNP CODICE <> LNP BOLLA: IMPOSTO P.O. CLIENTE
259800950103     C     W0030         IFNE      VIDLNP
259810950103     C                   MOVEL     W0030         VIDFLC
259820950103     C                   SETON                                        14
259830940927     C                   ENDIF
259840950103     C*
259850940927     C* C O D I C E   B O L L A
259860940927     C                   MOVEL     '3A'          COD
259870940927     C                   MOVEL(P)  VIDCBO        KEY
259880940927     C                   EXSR      CTABEL
259890940927     C  N30              MOVEL     TBLUNI        DS3A
259900940927     C  N30              MOVEL     §3ATB1        FLGTB1
259910940927     C   30              MOVEL     'F'           FLGTB1
259920070427     c                   move      flgtb1        savtb1
259930120926     c   30              clear                   savrbl
259940120926     c  n30              movel     §3arbl        savrbl
259950940927     C*
259960940927     C     FLGTB1        IFEQ      'A'
259970940927     C                   SETON                                        04
259980940927     C                   END
259990940927     C*
260000940927     C* CODICE BOLLA NON MANUTENZIONABILE
260010940927     C     §3AUCB        IFEQ      'N'
260020940927     C                   SETON                                        44
260030940927     C                   END
260040051123     c* Proteggo il codice bolla se in manutenzione o conferma bolle
260050051123     c* e bolla monovaria
260060051123     c                   if        *in12 = *on and §3asva <> *blanks
260070051123     c                   Movel     Prot1         AtrCbo
260080051123     c                   endif
260090940927     C* P A R T I T A   I V A
260100050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
260110050921     c                   select
260120050921     c* solo numeri
260130070427     c* "PRIVATO senza iso
260140050921     c     *in30         wheneq    *off
260150050921     c     wiso          andge     *zeros
260160050921     c     *in30         oreq      *on
260170050921     c     posiz         andlt     3
260180050921     c  n04              movel     wpiva         vidcpm
260190050921     c   04              movel     wpiva         vidcpd
260200050921     c* iso + numeri
260210050921     c* iso + "PRIVATO"
260220050921     c     *in30         wheneq    *off
260230050921     c     posiz         orgt      2
260240050921     c  n04              movel     wpiva         vidpim
260250050921     c   04              movel     wpiva         vidpid
260260050921     c                   endsl
260270050921     C***  *IN30         IFEQ      *ON
260280050921     C***  WISO          ORGE      *ZEROS
260290050921     C**N04              MOVEL     WPIVA         VIDCPM
260300050921     C** 04              MOVEL     WPIVA         VIDCPD
260310050921     C**                 ELSE
260320050921     C**N04              MOVEL     WPIVA         VIDPIM
260330050921     C** 04              MOVEL     WPIVA         VIDPID
260340050921     C**                 ENDIF
260350940927     C*
260360940927     C* L I N E A   D I   A R R I V O
260370941011     C                   MOVEL     VIDLNA        SAVLNA
260380940927     C     VIDLNA        IFGT      *ZEROS
260390941011     C                   MOVEL     VIDLNA        COMLNA
260400940927     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
260410940927     C  N30              MOVEL     ORGDES        V1DLNA
260420940927     C   30              MOVEL     *BLANKS       V1DLNA
260430020213     C                   MOVEL     ORGDE3        A_OG143
260440060707     C                   MOVEL     a_§ogntw      savaogntw
260450040525     C                   MOVEL     ORGDF0        A_OG150
260460020215     c                   movel     A_§ogntw      savntw
260470940927     C                   ENDIF
260480940927     C*
260490941011     C* C O D I C E   P A D R O N C I N O
260500990702     C                   CLEAR                   V1DPDR
260510941011     C     VIDPDR        IFGT      *ZEROS
260520941011     C                   MOVEL     VIDLNP        W0070
260530941011     C                   MOVE      VIDPDR        W0070
260540021204     C                   move      w0070         kpdpdr
260550021203     C                   move      'A'           kpdtip
260560021203     C     kfapd         chain     fiapd01l                           30
260570941011     C  N30              MOVEL     APDRSC        V1DPDR
260580940927     C   30              CLEAR                   V1DPDR
260590941011     C                   ENDIF
260600941107     C*
260610941107     C* T I P O   S E R V I Z I O
260620941107     C     VIDTSP        IFNE      ' '
260630941107     C                   Z-ADD     1             C
260640941107     C     VIDTSP        LOOKUP    TSP(C)                                 30
260650090604     C**!30              MOVEL     DTS(C)        V1DTSP
260660090604     C   30              MOVEL     DTS08(C)      V1DTSP
260670941107     C                   ENDIF
260680941115     C*
260690941115     C* C O N S E G N E   P A R T I C O L A R I
260700941115     C                   MOVEL     '1P'          COD
260710941115     C     VIDTC1        IFNE      *BLANKS
260720941115     C                   MOVEL(P)  VIDTC1        KEY
260730941115     C                   EXSR      CTABEL
260740941115     C  N30              MOVEL     TBLUNI        V2DTC1
260750941115     C                   ENDIF
260760941115     C     VIDTC2        IFNE      *BLANKS
260770941115     C                   MOVEL(P)  VIDTC2        KEY
260780941115     C                   EXSR      CTABEL
260790941115     C  N30              MOVEL     TBLUNI        V2DTC2
260800941115     C                   ENDIF
260810940927     C*
260820940927     C* S I G L A   O P E R A T O R E
260830940927     C* SE E' IN TABELLA  3M  SIGNIFICA CHE NON SI PUO' MANUTENZIONARE
260840940927     C                   MOVEL     '3M'          COD
260850940927     C                   MOVEL(P)  VIDSOP        KEY
260860940927     C                   EXSR      CTABEL
260870940927     C* SE TROVATA IN TABELLA --> PROTEGGO IL CAMPO
260880940927     C     *IN30         IFEQ      *OFF
260890940927     C                   SETON                                        13
260900940927     C                   END
260910940929     C* E S E N Z I O N E   I V A
260920940929     C     VIDCEI        IFNE      ' '
260930940929     C                   MOVEL     'EI'          COD
260940940929     C                   MOVEL(P)  VIDCEI        KEY
260950940929     C                   EXSR      CTABEL
260960940929     C  N30              MOVEL     TBLUNI        V3DCEI
260970940929     C                   ENDIF
260980940927     C* G I R O   D A T E
260990940927     C                   CLEAR                   WLBDAT
261000940927     C                   MOVE      BLPDSP        G02INV
261010940927     C                   MOVEL     '3'           G02ERR
261020940927     C                   CALL      'XSRDA8'
261030940927     C                   PARM                    WLBDAT
261040940927     C                   MOVEL     G02DAT        VIDDSP
261050940927     C* LA CONTROLLO SEMPRE LA DATA RITIRO
261060940927     C                   CLEAR                   SAVDRT
261070940927     C*
261080940927     C                   CLEAR                   WLBDAT
261090940927     C                   Z-ADD     VIDDRT        G02INV
261100940927     C                   MOVEL     '3'           G02ERR
261110940927     C                   CALL      'XSRDA8'
261120940927     C                   PARM                    WLBDAT
261130940927     C                   MOVEL     G02DAT        VIDDRT
261140010221     C                   Z-ADD     VIDDRT        PREDRT
261150070829     C                   Z-ADD     VIDDRT        s_drtblp
261160940927     C*
261170940927     C                   CLEAR                   WLBDAT
261180940927     C                   Z-ADD     VIDDCR        G02INV
261190940927     C                   MOVEL     '3'           G02ERR
261200940927     C                   CALL      'XSRDA8'
261210940927     C                   PARM                    WLBDAT
261220940927     C                   MOVEL     G02DAT        VIDDCR
261230940929     C*
261240940929     C                   CLEAR                   WLBDAT
261250940929     C                   Z-ADD     VIDDFT        G02INV
261260941115     C                   MOVEL     '3'           G02ERR
261270940929     C                   CALL      'XSRDA8'
261280940929     C                   PARM                    WLBDAT
261290940929     C                   Z-ADD     G02DAT        VIDDFT
261300940927     C                   ENDSR
261310910117     C*
261320910117     C*--- CREO RECORD PER STAMPA BOLLA ------------------------------*
261330910117     C     CRTBLD        BEGSR
261340910129     C  N12              MOVEL     *BLANKS       BLDATB
261350910201     C                   MOVEL     BLPLNP        BLDLNP
261360910117     C                   MOVEL     BLPAAS        BLDAAS
261370910117     C                   MOVEL     BLPNSP        BLDNSP
261380910117     C                   MOVEL     BLPNRS        BLDNRS
261390940214     C*
261400991201     C* RIFERIMENTO MITTENTE ALFABETICO, SE LNP DPD SCRIVO NUMERICO
261410910411     C     §1BFG7        IFNE      'S'
261420020319     C     §OGNTW        IFNE      'DPD'
261421171012     C     a_§OGNTW      andne     'DPD'
261430940825     C                   MOVEL     BLPRMA        BLDCDP
261440991201     C                   ELSE
261450060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
261460060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
261470060622     c* in ogni caso non lo prendo più dal rmn
261480060622     c                   if        %subst(§b4ipn:14:1)=*blanks
261490060622     C                   eval      bldcdp=%subst(§b4ipn:1:3) + ' ' +
261500060622     c                             %subst(§b4ipn:4:8) + ' ' +
261510060622     c                             §b4icd
261520060622     c                   else
261530060622     c                   eval      bldcdp=§b4ipn
261540060622     c                   endif
261550991201     C                   ENDIF
261560940214     C                   ENDIF
261570940214     C*
261580910201     C  N12              MOVEL     *BLANKS       BLDFST
261590910220     C  N12              Z-ADD     1             BLDNC1
261600971215     C   12
261610971215     CAN 15              SELECT
261620971215     C* DEVO RISTAMPARE ENTRAMBE LE ETICHETTE
261630971215     C     §1BFG9        WHENEQ    'S'
261640951019     C     §1BFG6        ANDEQ     'C'
261650951019     C                   MOVEL     'S'           BLDFST
261660971215     C* DEVO STAMPARE SOLO ETICHETTA ESTERA
261670971215     C     §1BFG0        WHENEQ    'D'
261680971215     C     §1BFG6        ANDEQ     'C'
261690971215     C                   MOVEL     'E'           BLDFST
261700971217     C     §1BFG0        WHENEQ    'C'
261710971217     C     §1BFG6        ANDEQ     'C'
261720971217     C     §1BF11        ANDEQ     'D'
261730971217     C                   MOVEL     'E'           BLDFST
261740971215     C                   OTHER
261750951019     C                   MOVEL     ' '           BLDFST
261760971215     C                   ENDSL
261770971215     C*
261780971215     C                   MOVEL     BLPPDR        BLDPDR
261790910205     C                   MOVEL     BLPLNA        BLDLNA
261800910205     C                   MOVEL     BLPTFA        BLDTFA
261810910405     C                   MOVEL     BLPRSD        BLDRSD
261820910412     C                   MOVEL     BLPRSM        BLDRSM
261830910117     C     BLPCCM        IFGT      0
261840910117     C                   MOVEL     BLPCCM        BLDCCM
261850910117     C                   ELSE
261860910117     C                   MOVEL     BLPKSC        BLDCCM
261870910117     C                   END
261880000204     C**
261890000204     C* SE DEVO CREARE IL FILE METTO LA "S" DI STAMPATO
261900000204     C     WDKC          IFEQ      'S'
261910001003     C     WSGNR         OREQ      'B'
261920000211     C                   EXSR      STASCD
261930001005     C* Reimposto a "S" flag per scrittura fisgn in ristampa perchè
261940001005     C* se viene richiamato deve essere lanciato il pgm di stampa e non
261950001005     C* deve più scrivere fisgn
261960001005     C     WSGNR         IFEQ      'B'
261970001005     C                   MOVEL     'S'           WSGNR
261980001005     C                   ENDIF
261990000914     C                   ENDIF
262000000211     C*
262010000914     C* SE DISK C FLAGGO COME STAMPATO BLDFST
262020020917     C* SE FLAG 12 = E (DISK A CON FIVAT) FLAGGO SOLO SE AS400 ABILITA-
262030001106     C* TO AL DISK C
262040000914     C     *IN79         IFEQ      *ON
262050000925     C     §3CDKC        ANDEQ     'S'
262060000914     C     §1BF12        ORNE      'N'
262070001106     C     §1BF12        ANDNE     'E'
262080001106     C     §1BF12        OREQ      'E'
262090001106     C     WASDKC        ANDEQ     'S'
262100000204     C                   MOVEL     'S'           BLDFST
262110000211     C                   ENDIF
262120910117     C*
262130910204     C   15
262140000911     CORN12
262150000915     COR 12
262160000915     CANN15
262170000915     CAN 33              WRITE     FNBLD000
262180000915     C   12
262190000915     CANN15
262200000915     CANN33              UPDATE    FNBLD000
262210940214     C*
262220940214     C* SE LI AVEVO GIA' STAMPATI LI RISTAMPO SUBITO
262230971217     C*  NON VENGONO RISTAMPATI SE SONO SOLO ESTERO
262240980409     C*  NON RISTAMPO ANCHE SE E' UNA SOLUZIONE A E NON HANNO VARIATO
262250980409     C*  NESSUNO DEI CAMPI CHE INTERESSANO (N.COLLI,LNA,ZONA,CAP DEST.,
262260980409     C*  TSP.) --> WPRT = "N"
262270971217     C     SAVFST        IFEQ      'S'
262280980409     C     WPRT          ANDEQ     ' '
262290001003     C* PER DISK C STASCD L'HO GIA' RICHIAMATA
262300000915     C     WDKC          IFNE      'S'
262310940214     C                   EXSR      STASCD
262320000915     C                   ENDIF
262330060216     C* SE C'E' Fiar4 PER LNA ESTERO SDI AGGIORNO IL FLAG DI STAMPA
262340081008     C**   *IN12         IFEQ      *ON
262350081008     C**   *IN15         ANDEQ     *OFF
262360081008     c**   A_§ogntw      andeq     'EUP'
262370081008     C**                 MOVEL     'E'           WTRC
262380081008     C**   KBLP4         CHAIN     Fiar4000                           90
262390081008    2C**   *IN90         IFEQ      *OFF
262400081008     C**                 MOVEL     ar4NOT        DSBL4E
262410081008     C**                 MOVEL     'S'           §B4EST
262420081008     C**                 MOVEL     DSBL4E        ar4NOT
262430081008     C**                 UPDATE    Fiar4000
262440081008     C**                 ENDIF
262450081008     C**                 SETOFF                                       90
262460081008     C**                 ENDIF
262470971230     C                   ENDIF
262480910117     C*
262490910117     C                   ENDSR
262500940927     C*
262510940927     C* CARICO LA VARIA IN SFL ---------------------------------------*
262520940927     C     CARVAR        BEGSR
262530991012      *
262540991027     C     WSVN          IFNE      ' '
262550950418     C     *IN87         OREQ      *ON
262560991027      *
262570991027     C     WSVN          IFNE      §$2IVA
262580991027     C     WSVN          ANDNE     §$2BOL
262590991027      *
262600940927     C                   ADD       1             NRR
262610940927     C     NRR           CHAIN     LS01S03                            30
262620991027     C                   MOVEL     WSVN          V3CSV1
262630991027     C                   Z-ADD     WVAN          V3CVA1
262640991027     C                   Z-ADD     WVAN          V3HVA1
262650020102    3C     WCONV         IFEQ      '1'
262660020102     C     WVAN          ANDGT     0
262670020102    4C     VIDIMV        IFGT      *ZEROS
262680020102     C     WSVN          ORNE      'N'
262690020102     C     WVAN          ORNE      88888888
262700020102     C                   CLEAR                   DSYEUR
262710020102     C                   MOVEL     VIDDIV        YECDVI
262720020102     C                   MOVEL     §GEDCN        YECDVO
262730020102     C                   Z-ADD     WVAN          YECIMI
262740020102     C     COMFDC        IFEQ      'S'
262750020102     C                   MOVEL     '3'           YECDCO
262760020102     C                   ELSE
262770020102     C                   MOVEL     '0'           YECDCO
262780020102     C                   ENDIF
262790020102     C                   CALL      'YEURCO'
262800020102     C                   PARM                    DSYEUR
262810020102    5C     YECESI        IFEQ      ' '
262820020102     C                   Z-ADD     YECIMO        V3CVA1
262830020102     C                   Z-ADD     YECIMO        V3HVA1
262840020102    5C                   ENDIF
262850020102    4C                   ENDIF
262860020102    3C                   ENDIF
262870941021     C                   MOVEL     WEV1          V3CEV1
262880940927     C   30              WRITE     LS01S03
262890940927     C  N30              UPDATE    LS01S03
262900991027      *
262910940927     C                   ENDIF
262920991027     C                   ENDIF
262930991012      *
262940940927     C                   ENDSR
262950910117     C*
262960971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO ----------------------------*
262970910201     C     STASCI        BEGSR
262980000121     C                   MOVEL     'I'           WSTSEG            1
262990000121     C                   EXSR      RIESEG
263000971215     C**
263010971215     C**  SOLO SE DEVO STAMPARE QUALCHE COSA
263020971215     C     §DETST        IFNE      *BLANKS
263030001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
263040001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
263050001005     C   12
263060001005     CANN15WSGNR         IFEQ      'B'
263070001005     C     KBLP3         SETLL     FISGN05L
263080001005     C                   ENDIF
263090971215     C     CO2SCD        DOWLE     STANCA
263100990318     C     CO2SCD        ANDGT     0
263110980320     C* Routine per segnacolli euroexpress: imposta §DEEUR e §LDCDP
263120980320     C                   EXSR      EUREXP
263130980319     C*
263140910208     C                   ADD       1             §LDNC1
263150911119     C                   Z-ADD     CO2SCD        §LDNCD
263160910201     C*
263170000914     C* SE DISK C NON STAMPO MAI IN IMMEDIATO
263180001018     C* ANCHE SE SCRIVO FISGN SOLO PER RISTAMPA E HO VBARIATO CAMPI
263190001018     C* PER I QUALI NON È NECESSARIO RISTAMPARE IMMEDIATAMENTE L'ETICH.
263200050302     C     *IN79         IFEQ      *OFF
263210050302     C     §1BF12        ANDEQ     'N'
263220050302     C     WNOPRT        ANDNE     '1'
263230001107     C*
263240050302     C     §1BF12        oreq      'E'
263250050302     C     WASDKC        ANDNE     'S'
263260050302     C     WNOPRT        ANDNE     '1'
263270001107     C*
263280050302     C     §1BF12        OREQ      'N'
263290050302     C     *IN79         ANDEQ     *ON
263300050302     C     §3CDKC        ANDNE     'S'
263310050302     C     WNOPRT        ANDNE     '1'
263320001107     C*
263330030611     C                   CALL      WD90pss
263340910201     C                   PARM                    DSBLD
263350971216     C                   PARM                    DSBLDE
263360001005     C                   ENDIF
263370001107     C* SCRITTURA/AGGIORNAMENTO FISGN00F: PER DISKC O PER SOLA RISTAMP
263380050302     C     §1BF12        IFNE      'N'
263390050302     C     §1BF12        ANDNE     'E'
263400050302     C     §1BF12        OREQ      'E'
263410050302     C     WASDKC        ANDEQ     'S'
263420050302     C     *IN79         OREQ      *ON
263430050302     C     §3CDKC        ANDEQ     'S'
263440001005     C     WSGNR         OREQ      'B'
263450000225     C*
263460000225     C* PULISCO PERCHE' HO AGGIORNATO
263470000913    3C                   SELECT
263480050225     c* import dpd (ctm disk c)
263490050225     c     §1bf12        whenne    'N'
263500050225     c     *in79         andeq     *on
263510050302     c     wdkc          ifeq      'S'
263520050225     C     WESSGN        IFEQ      'S'
263530050225     C                   EXSR      UPDSGN
263540050225     C                   ELSE
263550050225     C                   Z-ADD     COMTFP        SGNTNP
263560050225     C                   WRITE     FISGN000
263570050225     C                   ENDIF
263580060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
263590060622     c* anche fisgn con key composta dal solo numero parcel
263600060622     c                   if        §b4ibi<>*blanks
263610060622     c                             and %subst(§b4ipn:14:1)=*blanks
263620060622     c                   clear                   kwho
263630060622     C                   movel     §b4ipn        kwho
263640060622     C                   eval      %subst(kwho:12:1)=§b4icd
263650060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
263660060623     c* serviranno per la seconda scrittura
263670060623     C                   MOVEL     DSBLD         WSBLD
263680060623     C                   MOVEL     DSBLDE        WSBLDE
263690060622     C                   CLEAR                   WESSGN
263700060622     C                   CLEAR                   WSGNR
263710060622     C                   CLEAR                   FISGN000
263720060622     C                   MOVEL     'S'           WDKC              1
263730060622     C                   EXSR      CTRSGN
263740060622     C     WDKC          IFEQ      'S'
263750060623     C                   MOVEL     WSBLD         dsbld
263760060623     C                   MOVEL     WSBLDE        dsblde
263770060622     C     WESSGN        IFEQ      'S'
263780060622     C                   EXSR      UPDSGN
263790060622     C                   ELSE
263800060622     C                   Z-ADD     COMTFP        SGNTNP
263810060622     C                   WRITE     FISGN000
263820060622     C                   ENDIF
263830060622     C                   ENDIF
263840060622     c                   endif
263850050302     C                   ENDIF
263860050221     C* EXPORT DPD DA VAT O MANUALE
263870001009     C     §1BF12        WHENNE    'N'
263880001011     C     WEXDPD        ANDEQ     'S'
263890160225     c     w_aDpd        andne     'S'
263900140714     C     §1BF13        ANDNE     'A'
263910140715     c     §1bf12        andne     'B'
263920070323     c     wparcel       andne     '12'
263930050302     C     WDKC          IFEQ      'S'
263940001009     C     WESSGN        IFEQ      'S'
263950001009     C                   EXSR      UPDSGN
263960001009     C                   ELSE
263970010116     C                   Z-ADD     COMTFP        SGNTNP
263980001009     C                   WRITE     FISGN000
263990001009     C                   ENDIF
264000050302     C                   ENDIF
264010000912     C     §1BF12        WHENNE    'N'
264020000911     C                   Z-ADD     CO2SCD        WO2SCD
264030000911     C                   MOVEL     'C'           WTRC
264040051102     C     KARS01        CHAIN(N)  FIARS01L                           30
264050000913    4C     *IN30         IFEQ      *OFF
264060000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
264070000911     C                   Z-ADD     1             IX
264080051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
264090000911     C     POS(IX)       CHAIN     LS01S08                            30
264100000204     C*
264110000204     C* SCRITTURA DEL FILE  PER DISK "C"
264120000913    5C     V8HDKC        IFEQ      'S'
264130000913    6C     V8HESG        IFEQ      'S'
264140000919     C                   MOVEL     DSBLD         WSBLD
264150000919     C                   MOVEL     DSBLDE        WSBLDE
264160010116     C     KSGN8         CHAIN     FISGN01L                           30
264170000919     C                   MOVEL     WSBLD         DSBLD
264180000919     C                   MOVEL     WSBLDE        DSBLDE
264190000921     C                   EXSR      UPDSGN
264200000913   X6C                   ELSE
264210000929     C                   EXSR      WRTSGN
264220000913    6C                   ENDIF
264230000913    5C                   ENDIF
264240000913    4C                   ENDIF
264250050225     C* IMPORT DPD (ctm no diskc)
264260000912     C     *IN79         WHENEQ    *ON
264270000912     C     WESSGN        IFEQ      'S'
264280000921     C                   EXSR      UPDSGN
264290000912     C                   ELSE
264300010116     C                   Z-ADD     COMTFP        SGNTNP
264310000912     C                   WRITE     FISGN000
264320000912     C                   ENDIF
264330001005     C* SCRIVO O UPDATO FISGN PER RISTAMPA
264340001005     C     WSGNR         WHENEQ    'B'
264350001005     C                   MOVEL     DSBLD         WSBLD
264360001005     C                   MOVEL     DSBLDE        WSBLDE
264370001005     C     KBLP3         READE     FISGN05L                               30
264380001013     C                   MOVE      *IN30         WIN30
264390001005     C                   MOVEL     WSBLD         DSBLD
264400001005     C                   MOVEL     WSBLDE        DSBLDE
264410001013     C                   CLEAR                   DSBLD7
264420001013     C                   MOVE      §LDLNP        §LCLNP
264430001013     C                   MOVE      §LDLNA        §LCLNA
264440001013     C                   MOVE      §LDNRS        §LCNRS
264450001013     C                   MOVE      §LDZSC        §LCZSC
264460001013     C                   MOVE      §LDNCD        §LCNCD
264470001013     C                   EXSR      M10
264480001013     C                   MOVEA     §CA           SGNWHO
264490001013     C                   MOVEA     §CA           V8CNOT
264500001013     C                   MOVE      WIN30         *IN30
264510001005     C     *IN30         IFEQ      *OFF
264520001005     C                   EXSR      UPDSGN
264530001005     C                   ELSE
264540001005     C                   EXSR      WRTSGN
264550001005     C                   ENDIF
264560000913    3C                   ENDSL
264570000204     C                   ENDIF
264580910201     C*
264590910827     C                   ADD       1             CO2SCD
264600910201     C*
264610971215     C                   ENDDO
264620001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
264630001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
264640001005     C   12
264650001005     CANN15WSGNR         IFEQ      'B'
264660001005     C     VIDNCL        ANDLT     SAVNCL
264670001005     C     KBLP3         READE     FISGN05L                               30
264680001005     C     *IN30         DOWEQ     *OFF
264690001005     C                   EXSR      ANNSGN
264700001005     C     KBLP3         READE     FISGN05L                               30
264710001005     C                   ENDDO
264720001005     C                   ENDIF
264730971215     C                   ENDIF
264740910404     C*
264750910117     C                   ENDSR
264760000121     C*
264770000121     C* RIEMPO DS PER STAMPA SEGNACOLLI ------------------------------*
264780000121     C     RIESEG        BEGSR
264790000124     C                   CLEAR                   §DEEUR
264800000124     C                   CLEAR                   §DEAWB
264810000124     C                   CLEAR                   §DEFCA
264820040506     C                   CLEAR                   §DEISA
264830000124     C                   CLEAR                   §DESIA
264840000201     C                   CLEAR                   §DESSE
264850171012     C***                CLEAR                   SAVCDP
264860000124     C*
264870000121     C     WSTSEG        IFEQ      'I'
264880000929     C* WSGNR = 'S' --> Scrivo fisgn per eventuale ristampa
264890001107     C* (Se provengo da manutenzione non devo azzerare nc1 prechè in
264900001107     C*  questo caso devo richiamare pgm di stampa e non scrittura di
264910001107     C*  fisgn. Se azzerassi, la stampa del progressivo sull'etichetta
264920001107     C*  partirebbe da 0 anzichè da 1)
264930000929     C     WSGNR         OREQ      'S'
264940001107     C     *IN12         ANDEQ     *OFF
264950001107     C     WSGNR         OREQ      'S'
264960001107     C     *IN15         ANDEQ     *ON
264970000121     C                   Z-ADD     0             §LDNC1
264980000121     C                   ELSE
264990000121     C                   Z-ADD     BLDNC1        §LDNC1
265000000121     C                   ENDIF
265010000208     C*
265020000208     C                   MOVEL     WDLA          §LDDLA
265030000208     C                   MOVEL     BLPFLS        §LDLNP
265040000121     C     BLPFLS        CHAIN     AZORG01L      UNIORG               30
265050000121     C  N30              MOVEL     ORGDES        §LDDLP
265060000121     C   30              MOVEL     *BLANKS       §LDDLP
265070000121     C     WSTSEG        IFEQ      'D'
265080000121     C                   MOVEL     BLDCDP        §LDCDP
265090000121     C                   ELSE
265100000121      * RIFERIMENTO MITTENTE ALFABETICO
265110000121     C                   MOVEL     BLPRMA        §LDCDP
265120000121     C                   ENDIF
265130000121      *
265140000121      * SE LNP DPD SCRIVO NUMERICO
265150020319     C     §OGNTW        IFEQ      'DPD'
265160060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
265170060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
265180060622     c* in ogni caso non lo prendo più dal rmn
265190060622     c                   if        %subst(§b4ipn:14:1)=*blanks
265200060622     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
265210060622     c                             %subst(§b4ipn:4:8) + ' ' +
265220060622     c                             §b4icd
265230060622     c                   else
265240060622     c                   eval      §ldcdp=§b4ipn
265250060622     c                   endif
265260000121     C                   ENDIF
265270000121      *
265280000121      * PER EXPORT DPD SCRIVO NUMERO PARCEL
265290020319    1C     A_§OGNTW      IFEQ      'DPD'
265300060510    2C     §B4ipn        ANDNE     *BLANKS
265310010302     C* Se RMA diverso da blanks lo devo stampare, allineato a dx,
265320120302     C* nella prima riga di stampa dell'etichetta brt andando
265330010302     C* a coprire in parte la ragione sociale del mittente
265340010302     C* In questo punto mi salvo quindi il rma che andrò a muovere
265350010302     c* nela campo della ragione sociale se <> da blank (v.sotto)
265360060510     c* ATTENZIONE: per numero parcel lungo 14 continuiamo a stamparlo
265370120302     c* sull'etichetta brt ma non più distanziato in quanto
265380060510     c* §ldcdp non è abbastanza lungo
265390171012     C***                MOVE      §LDCDP        SAVCDP
265400060626     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
265410060626     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
265420060626     c                   if        %subst(§b4ipn:14:1)=*blanks
265430060626     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
265440060626     c                             %subst(§b4ipn:4:8) + ' ' +
265450060626     c                             §b4icd
265460060626     c                   else
265470060626     c                   eval      §ldcdp=§b4ipn
265480060626     c                   endif
265490000121    2C                   ENDIF
265500020211     c*
265510020211      * PER EXPORT FEDEX SCRIVO AWB
265520020213    1C     A_§ogntw      IFEQ      'FED'
265530020211     C                   MOVEL     §B4ERP        §LDCDP
265540020211    1C                   ENDIF
265550000201     C*
265560000201     C* ALTRI DATI ETICHETTA ESTERA
265570000201     C                   EXSR      ETIEST
265580000121     C*
265590000121     C                   MOVEL     BLPNRS        §LDNRS
265600000121     C                   MOVEL     BLPLNA        §LDLNA
265610000121     C                   MOVEL     BLPTFA        §LDTNA
265620000121     C                   MOVE      BLPPDR        §LDCPD
265630000121     C                   MOVEL     BLPTSP        §LDTSP
265640000121     C                   MOVEL     BLPZNC        §LDZSC
265650000121     C                   MOVE      BLPNCL        §LDNC2
265660000121     C                   MOVEL     BLPRSM        §LDRSM
265670010302     C* SOLO PER SEGNACOLLI EXPORT DPD:
265680010302     C* MUOVO ALLINEATO, A SX DELLA RSM, IL RMA SE <> DA BLANKS
265690010302     C* E LO COMPATTO PERDENDO CIOÈ I BLANK NON SIGNIFICATIVI
265700171012     C***  SAVCDP        IFNE      *BLANKS
265710171012     C***                CLEAR                   W35
265720171012     C***                MOVEA     SAVCDP        W35
265730171012     C***  ' '           CHECKR    SAVCDP        §Z                2 0
265740171012     C***                ADD       2             §Z
265750171012     C***                MOVEA     BLPRSM        W35(§Z)
265760171012     C***                MOVEA     W35           §LDRSM
265770171012     C***                ENDIF
265780000121     C                   MOVEL     BLPPRM        §LDPRM
265790000121     C                   MOVEL     BLPRSD        §LDRSD
265800000121     C                   MOVEL     BLPCAD        §LDCAD
265810000121     C                   MOVEL     BLPLOD        §LDLOD
265820000121     C                   MOVEL     BLPIND        §LDIND
265830000121     C                   MOVE      BLPPRD        §LDPRD
265840000121     C                   MOVEL     *ZEROS        §LDNCP
265850000121     C                   MOVEL     *ZEROS        §LDNCU
265860000121     C                   MOVEL     BLPFVF        §LDFVR
265870000121     C                   MOVEL     BLPVLF        §LDVOL
265880000121     C                   MOVEL     BLPPKF        §LDPKG
265890000121     C                   MOVEL     BLPAAS        §LDAAS
265900000121     C                   MOVEL     BLPMGS        §LDMGS
265910050422     c                   clear                   §ldrst
265920050422     c* in conferma o in immissione imposto "V" di valore se collo
265930050422     c* di valore
265940050422     c                   if        (*in12 = *off or *in15 = *on) and
265950050422     c                             vidbva <> *blanks
265960050422     c                   eval      §ldrst = 'V'
265970050422     c                   endif
265980050422     c* in manutenzione metto "M" se modificato no collo di valore
265990050422     c*                 metto "W" se modificato    collo di valore
266000050422     C     *IN12         IFEQ      *ON
266010050422     C     *IN15         ANDEQ     *OFF
266020050422     c     vidbva        ifeq      *blanks
266030050422     c* Se è un disk c non ha senso stampare l'etichetta con la "M" in
266040050422     c* quanto questa esce solo quando il collo passa sull'impianto
266050050422     c     wdkc          ifne      'S'
266060050422     c     wsgnr         andne     'B'
266070050422     C                   MOVEL     'M'           §LDRST
266080050422     c                   endif
266090050422     c                   else
266100050422     c     wdkc          ifne      'S'
266110050422     c     wsgnr         andne     'B'
266120050422     c                   movel     'W'           §ldrst
266130050422     c                   else
266140050422     c                   movel     'V'           §ldrst
266150050422     c                   endif
266160050422     c                   endif
266170050422     c                   endif
266180000121     C                   ENDSR
266190000929     C*
266200971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO COME RISTAMPA DEL "D" ------*
266210910201     C     STASCD        BEGSR
266220910201     C* RICHIAMO DIRETTAMENTE IL PROGRAMMA DI STAMPA SEGNACOLLO
266230910827     C                   Z-ADD     BLDNCD        CO2SCD
266240910201     C     BLDNCA        IFEQ      0
266250910201     C                   Z-ADD     BLDNCD        BLDNCA
266260910201     C                   END
266270040506     C* IMPOSTO DSBLDE
266280081008     C**   WESTER        IFEQ      'S'
266290081008     C**                 MOVEL     'ALL'         §DETST
266300081008     C**                 ELSE
266310040506     C                   MOVEL     'ITA'         §DETST
266320040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
266330040506     c* etichetta Italia con dati esteri
266340040506     C     A_§ogntw      IFEQ      'EEX'
266350040506     C                   MOVEL     'EEX'         §DETSE
266360040506     c                   else
266370040506     c                   clear                   §detse
266380040506     C                   ENDIF
266390081008     C***                ENDIF
266400000121     C* RIEMPO LE DS
266410060622     C                   MOVEL     'D'           WSTSEG
266420000121     C                   EXSR      RIESEG
266430000211     C**
266440000919     C*
266450001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
266460001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
266470001005     C   12
266480001005     CANN15WSGNR         IFEQ      'B'
266490001019     C     WSTSGN        ANDEQ     *BLANKS
266500001005     C     KBLP3         SETLL     FISGN05L
266510001019     C                   MOVE      '1'           WSTSGN            1
266520001005     C                   ENDIF
266530980320     C*
266540000908     C     CO2SCD        DOWLE     BLDNCA
266550990318     C     CO2SCD        ANDGT     0
266560980320     C* Routine per impostazione campi segnacollo euroexpress di dsblde
266570980320     C                   EXSR      EUREXP
266580911122     C                   Z-ADD     CO2SCD        §LDNCD
266590910201     C*
266600000204     C     WDKC          IFNE      'S'
266610001003     C     WSGNR         ANDNE     'B'
266620030611     C                   CALL      WD90pss
266630910201     C                   PARM                    DSBLD
266640971216     C                   PARM                    DSBLDE
266650000913     C                   ELSE
266660000225     C*
266670000225     C* PULISCO PERCHE' HO AGGIORNATO
266680000912    3C                   SELECT
266690050224     C* IMPORT DPD
266700050224     c     §1bf12        whenne    'N'
266710050224     C     *IN79         andeq     *ON
266720050224     C     WDKC          IFEQ      'S'
266730050224     C     WESSGN        IFEQ      'S'
266740050224     C                   EXSR      UPDSGN
266750050224     C                   ELSE
266760050224     C                   Z-ADD     COMTFP        SGNTNP
266770050224     C                   WRITE     FISGN000
266780050224     C                   ENDIF
266790050224     C                   ENDIF
266800060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
266810060622     c* anche fisgn con key composta dal solo numero parcel
266820060622     c                   if        §b4ibi<>*blanks
266830060622     c                             and %subst(§b4ipn:14:1)=*blanks
266840060622     c                   clear                   kwho
266850060622     C                   movel     §b4ipn        kwho
266860060622     C                   eval      %subst(kwho:12:1)=§b4icd
266870060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
266880060623     c* serviranno per la seconda scrittura
266890060623     C                   MOVEL     DSBLD         WSBLD
266900060623     C                   MOVEL     DSBLDE        WSBLDE
266910060622     C                   CLEAR                   WESSGN
266920060622     C                   CLEAR                   WSGNR
266930060622     C                   CLEAR                   FISGN000
266940060622     C                   MOVEL     'S'           WDKC              1
266950060622     C                   EXSR      CTRSGN
266960060622     C     WDKC          IFEQ      'S'
266970060623     C                   MOVEL     WSBLD         dsbld
266980060623     C                   MOVEL     WSBLDE        dsblde
266990060622     C     WESSGN        IFEQ      'S'
267000060622     C                   EXSR      UPDSGN
267010060622     C                   ELSE
267020060622     C                   Z-ADD     COMTFP        SGNTNP
267030060622     C                   WRITE     FISGN000
267040060622     C                   ENDIF
267050060622     C                   ENDIF
267060060622     c                   endif
267070050221     C* DISK C EXPORT DPD DA vat O MANUALE
267080001009     C     §1BF12        WHENNE    'N'
267090001011     C     WEXDPD        ANDEQ     'S'
267100160225     c     w_aDpd        andne     'S'
267110140714     C     §1BF13        ANDNE     'A'
267120140715     c     §1bf12        andne     'B'
267130070323     C     wparcel       ANDNE     '12'
267140001009     C     WDKC          IFEQ      'S'
267150001009     C     WESSGN        IFEQ      'S'
267160001009     C                   EXSR      UPDSGN
267170001009     C                   ELSE
267180010116     C                   Z-ADD     COMTFP        SGNTNP
267190001009     C                   WRITE     FISGN000
267200001009     C                   ENDIF
267210001009     C                   ENDIF
267220000912     C     §1BF12        WHENNE    'N'
267230000911     C                   Z-ADD     CO2SCD        WO2SCD
267240000911     C                   MOVEL     'C'           WTRC
267250051102     C     KARS01        CHAIN(N)  FIARS01L                           30
267260000912    4C     *IN30         IFEQ      *OFF
267270000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
267280000911     C                   Z-ADD     1             IX
267290051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
267300000911     C     POS(IX)       CHAIN     LS01S08                            30
267310000204     C*
267320000204     C* SCRITTURA DEL FILE  PER DISK "C"
267330000912    5C     V8HDKC        IFEQ      'S'
267340000912    6C     V8HESG        IFEQ      'S'
267350000919     c* prima di chainare fisgn mi salvo la ds
267360000919     C                   MOVEL     DSBLD         WSBLD
267370000919     C                   MOVEL     DSBLDE        WSBLDE
267380010116     C     KSGN8         CHAIN     FISGN01L                           30
267390000919     C                   MOVEL     WSBLD         DSBLD
267400000919     C                   MOVEL     WSBLDE        DSBLDE
267410000912     C                   EXSR      UPDSGN
267420000912   X6C                   ELSE
267430000929     C                   EXSR      WRTSGN
267440000912    6C                   ENDIF
267450000912    5C                   ENDIF
267460000912    4C                   ENDIF
267470050224     C* IMPORT DPD (ctm no disk c)
267480000912     C     *IN79         WHENEQ    *ON
267490000912     C     WESSGN        IFEQ      'S'
267500000912     C                   EXSR      UPDSGN
267510000912     C                   ELSE
267520010116     C                   Z-ADD     COMTFP        SGNTNP
267530000912     C                   WRITE     FISGN000
267540000912     C                   ENDIF
267550001003     C* FISGN IN RISTAMPA
267560001003     C     WSGNR         WHENEQ    'B'
267570001005     c* prima di leggere fisgn mi salvo la ds
267580001005     C                   MOVEL     DSBLD         WSBLD
267590001005     C                   MOVEL     DSBLDE        WSBLDE
267600001005     C     KBLP3         READE     FISGN05L                               30
267610001013     C                   MOVE      *IN30         WIN30             1
267620001005     C                   MOVEL     WSBLD         DSBLD
267630001005     C                   MOVEL     WSBLDE        DSBLDE
267640001013     C                   CLEAR                   DSBLD7
267650001013     C                   MOVE      §LDLNP        §LCLNP
267660001013     C                   MOVE      §LDLNA        §LCLNA
267670001013     C                   MOVE      §LDNRS        §LCNRS
267680001013     C                   MOVE      §LDZSC        §LCZSC
267690001013     C                   MOVE      §LDNCD        §LCNCD
267700001013     C                   EXSR      M10
267710001013     C                   MOVEA     §CA           SGNWHO
267720001013     C                   MOVEA     §CA           V8CNOT
267730001013     C                   MOVE      WIN30         *IN30
267740001005     C     *IN30         IFEQ      *OFF
267750001005     C                   EXSR      UPDSGN
267760001005     C                   ELSE
267770001003     C                   EXSR      WRTSGN
267780001005     C                   ENDIF
267790000912    3C                   ENDSL
267800000911     C                   ENDIF
267810910201     C*
267820910827     C                   ADD       1             CO2SCD
267830910313     C                   ADD       1             §LDNC1
267840910201     C*
267850910201     C                   END
267860001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
267870001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
267880001005     C   12
267890001005     CANN15WSGNR         IFEQ      'B'
267900001005     C     VIDNCL        ANDLT     SAVNCL
267910001005     C     KBLP3         READE     FISGN05L                               30
267920001005     C     *IN30         DOWEQ     *OFF
267930001005     C                   EXSR      ANNSGN
267940001005     C     KBLP3         READE     FISGN05L                               30
267950001005     C                   ENDDO
267960001005     C                   ENDIF
267970910201     C                   ENDSR
267980910805     C*
267990910805     C*--- CREO FLBLT00F ---------------------------------------------*
268000910805     C     CRTBLT        BEGSR
268010940926     C                   CLEAR                   FNBLT000
268020910805     C                   MOVEL     BLPAAS        BLTAAS
268030940926     C                   MOVEL     BLPLNP        BLTLNP
268040910805     C                   MOVEL     BLPNRS        BLTNRS
268050000921     C                   MOVEL     BLPNSP        BLTNSP
268060910828     C                   MOVEL     BLPLNA        BLTLNA
268070910828     C                   MOVEL     BLPFLS        BLTFLS
268080060622     C                   MOVEL     BLPNFV        BLTNFV
268090920910     C                   MOVEL     BLPFLP        BLTFLP
268100940926     C                   MOVEL     WNSC          BLTNSC
268110940915     C                   WRITE     FNBLT000
268120120817     c* richiamo creazione dettaglio colli unico
268130120817     c                   exsr      crtFIART
268140980318     C*
268150000908     C* RICHIAMO CREAZIONE ESTENSIONE DETTAGLIO SEGNACOLLO
268160000908     C* PER MEMORIZZAZIONE COD. "CHI SONO"
268170051102     C                   EXSR      CRTARS
268180910805     C*
268190910805     C                   ENDSR
268200120814     C*--- CREO FIART00F ---------------------------------------------*
268210120814     C     crtFIART      BEGSR
268220120814     C                   CLEAR                   FIART000
268230120814     C                   MOVEL     BLPAAS        ARTAAS
268240120814     C                   MOVEL     BLPLNP        ARTLNP
268250120814     C                   MOVEL     BLPNRS        ARTNRS
268260120814     C                   MOVEL     BLPNSP        ARTNSP
268270120814     C                   MOVEL     BLPLNA        ARTLNA
268280120814     C                   MOVEL     BLPFLS        ARTFLS
268290120814     C                   MOVEL     BLPNFV        ARTNFV
268300120814     C                   MOVEL     BLPFLP        ARTFLP
268310120814     C                   MOVEL     WNSC          ARTNSC
268320120814     C                   WRITE     FIART000
268330120814     c                   endsr
268340051102     C*--- CREO FIARS00F ---------------------------------------------*
268350051102     C     CRTARS        BEGSR
268360001009     C*
268370001013    1C                   SELECT
268380050221     C* DISK C EXPORT DPD DA vat O MANUALE
268390001011     C     WEXDPD        WHENEQ    'S'
268400140714     C     §1BF13        ANDNE     'A'
268410160225     C     w_aDpd        ANDNE     'S'
268420001009     C     §1BF12        ANDNE     'N'
268430140715     C     §1BF12        ANDNE     'B'
268440070322     c     wparcel       andne     '12'
268450051102     C                   CLEAR                   FIARS000
268460120817     C***                MOVE      BLTFLS        ARSFLS
268470120817     C***                MOVE      BLTLNA        ARSLNA
268480120817     C***                MOVE      BLTNRS        ARSNRS
268490120817     C***                MOVE      BLTNSC        ARSNSC
268500120817     C                   MOVE      ARTFLS        ARSFLS
268510120817     C                   MOVE      ARTLNA        ARSLNA
268520120817     C                   MOVE      ARTNRS        ARSNRS
268530120817     C                   MOVE      ARTNSC        ARSNSC
268540051102     C                   MOVEL     'C'           ARSTRC
268550051102     C                   MOVEL     V7CNPR        ARSNOT
268560051114     C                   MOVEL     dateu         ARSduv
268570051102     C                   WRITE     FIARS000
268580050224     c* Disk C import DPD
268590050224     c     *in79         wheneq    *on
268600050224     c     §1bf12        andne     'N'
268610051102     C                   CLEAR                   FIARS000
268620120817     C***                MOVE      BLTFLS        ARSFLS
268630120817     C***                MOVE      BLTLNA        ARSLNA
268640120817     C***                MOVE      BLTNRS        ARSNRS
268650120817     C***                MOVE      BLTNSC        ARSNSC
268660120817     C                   MOVE      ARTFLS        ARSFLS
268670120817     C                   MOVE      ARTLNA        ARSLNA
268680120817     C                   MOVE      ARTNRS        ARSNRS
268690120817     C                   MOVE      ARTNSC        ARSNSC
268700051102     C                   MOVEL     'C'           ARSTRC
268710060622     c***                z-add     blprmn        w0120
268720060622     C***                MOVEL     w0120         ARSNOT
268730060622     c                   movel     v7cnpr        arsnot
268740051114     C                   MOVEL     dateu         ARSduv
268750051102     C                   WRITE     FIARS000
268760980318     C*
268770000908     C* DISK C
268780000608     C*
268790000908     C     §1BF12        WHENNE    'N'
268800000908     C     NR8           CHAIN     LS01S08                            30
268810000908     C     *IN30         DOWEQ     *OFF
268820000908     C     V8CSCE        ANDEQ     'A'
268830000908     C                   ADD       1             NR8
268840000908     C     NR8           CHAIN     LS01S08                            30
268850000908     C                   ENDDO
268860000908     C     *IN30         IFEQ      *OFF
268870051102     C                   CLEAR                   FIARS000
268880120817     C***                MOVE      BLTFLS        ARSFLS
268890120817     C***                MOVE      BLTLNA        ARSLNA
268900120817     C***                MOVE      BLTNRS        ARSNRS
268910120817     C***                MOVE      BLTNSC        ARSNSC
268920120817     C                   MOVE      ARTFLS        ARSFLS
268930120817     C                   MOVE      ARTLNA        ARSLNA
268940120817     C                   MOVE      ARTNRS        ARSNRS
268950120817     C                   MOVE      ARTNSC        ARSNSC
268960051102     C                   MOVEL     'C'           ARSTRC
268970051102     C                   MOVEL     V8CNOT        ARSNOT
268980051114     C                   MOVEL     dateu         ARSduv
268990051102     C                   WRITE     FIARS000
269000000911     C                   ADD       1             NR8
269010000908     C                   ENDIF
269020120302     C* SE IMPORT BRT DEVO MEMORIZZARE SEMPRE SU ARS ANCHE
269030000911     C* RECORD TIPO 'E' PER SEGNACOLLO EUROEXPRESS
269040020211     c     §ogntw        ifeq      'EEX'
269050000911     C     §1BF12        ANDEQ     'E'
269060051102     C                   CLEAR                   FIARS000
269070120817     C***                MOVE      BLTFLS        ARSFLS
269080120817     C***                MOVE      BLTLNA        ARSLNA
269090120817     C***                MOVE      BLTNRS        ARSNRS
269100120817     C***                MOVE      BLTNSC        ARSNSC
269110120817     C                   MOVE      ARTFLS        ARSFLS
269120120817     C                   MOVE      ARTLNA        ARSLNA
269130120817     C                   MOVE      ARTNRS        ARSNRS
269140120817     C                   MOVE      ARTNSC        ARSNSC
269150051102     C                   MOVEL     'E'           ARSTRC
269160051102     C                   MOVEL     V8CNOT        ARSNOT
269170051114     C                   MOVEL     dateu         ARSduv
269180051102     C                   WRITE     FIARS000
269190000911     C                   ENDIF
269200000908    1C                   ENDSL
269210051020     c*
269220051020     c                   select
269230120302     C* EXPORT BRT
269240051020     c     A_§ogntw      wheneq    'EEX'
269250051102     C                   CLEAR                   FIARS000
269260120817     C***                MOVE      BLTFLS        ARSFLS
269270120817     C***                MOVE      BLTLNA        ARSLNA
269280120817     C***                MOVE      BLTNRS        ARSNRS
269290120817     C***                MOVE      BLTNSC        ARSNSC
269300120817     C                   MOVE      ARTFLS        ARSFLS
269310120817     C                   MOVE      ARTLNA        ARSLNA
269320120817     C                   MOVE      ARTNRS        ARSNRS
269330120817     C                   MOVE      ARTNSC        ARSNSC
269340051102     C                   MOVEL     'E'           ARSTRC
269350051020     c                   clear                   dsbld7
269360120817     c***                eval      §lclnp=bltfls
269370120817     c***                eval      §lclna=bltlna
269380120817     c***                eval      §lcnrs=bltnrs
269390120817     c***                eval      §lcncd=bltnsc
269400120817     c                   eval      §lclnp=artfls
269410120817     c                   eval      §lclna=artlna
269420120817     c                   eval      §lcnrs=artnrs
269430120817     c                   eval      §lcncd=artnsc
269440051020     c                   eval      §lczsc=blpznc
269450051020     c                   exsr      m10
269460051102     C                   MOVEA     §CA           ARSnot
269470051114     C                   MOVEL     dateu         ARSduv
269480051020     C*
269490051102     C                   WRITE     FIARS000                             30
269500051020     C* EXPORT FEDEX
269510051020     c     A_§ogntw      wheneq    'FED'
269520051102     C                   CLEAR                   FIARS000
269530120817     C***                MOVE      BLTFLS        ARSFLS
269540120817     C***                MOVE      BLTLNA        ARSLNA
269550120817     C***                MOVE      BLTNRS        ARSNRS
269560120817     C***                MOVE      BLTNSC        ARSNSC
269570120817     C                   MOVE      ARTFLS        ARSFLS
269580120817     C                   MOVE      ARTLNA        ARSLNA
269590120817     C                   MOVE      ARTNRS        ARSNRS
269600120817     C                   MOVE      ARTNSC        ARSNSC
269610051102     C                   MOVEL     'F'           ARSTRC
269620051020     c                   movel     wawb          w0012a           12
269630051020     c* calcolo check digit
269640051020     c                   exsr      chkdgf
269650051102     c                   movel     w0012a        ARSnot
269660051114     C                   MOVEL     dateu         ARSduv
269670051020     C*
269680051102     C                   WRITE     FIARS000
269690051020     c                   add       1             wawb
269700051020     C                   ENDsl
269710980318     C                   ENDSR
269720980320     C*--- COMPATTO IL CAP TOGLIENDO TUTTI I BLANK -------------------*
269730980320     C     WRKCAP        BEGSR
269740011120     C     WNO55L        IFEQ      *BLANKS
269750980320     C* Compongo il segnacollo Euroexpress
269760980320     C                   MOVE      *ZEROS        §Y                2 0
269770980320     C                   MOVE      *BLANKS       §S9
269780980320     C                   MOVE      *BLANK        §O9
269790980320     C                   MOVEA     WRKCAD        §S9
269800980320     C* Compatto il cap togliendo tutti i blank
269810980320    2C                   DO        9             §X1               2 0
269820980320    3C     §S9(§X1)      IFNE      *BLANKS
269830980320     C                   ADD       1             §Y
269840980320     C                   MOVE      §S9(§X1)      §O9(§Y)
269850980320    3C                   END
269860980320    2C                   END
269870011120     C                   ENDIF
269880980320     C* Prendo codice iso della nazione
269890980320     C                   MOVEL     '15'          COD
269900980320     C                   MOVEL(P)  BLPNZD        KEY
269910980320     C                   EXSR      CTABEL
269920980320     C   30              CLEAR                   DS15
269930980320     C  N30              MOVEL     TBLUNI        DS15
269940980320     C* Unisco il cap compattato alla nazione
269950980320     C                   MOVEL     §15COD        W15COD            2
269960980320     C                   ENDSR
269970051102     C*--- AGGIORNO FIARS00F -----------------------------------------*
269980051102     C     AGGARS        BEGSR
269990040514     c                   clear                   jf                2 0
270000980320     C                   MOVEL     'E'           WTRC
270010020213    1C     A_§ogntw      IFEQ      'EEX'
270020120817     C***  KBLT1         SETLL     FNBLT01L
270030120817     C***  KBLT1         READE(N)  FNBLT01L                               30
270040120817     C     KBLT1         SETLL     FIART01L
270050120817     C     KBLT1         READE(N)  FIART01L                               30
270060980320    2C     *IN30         DOWEQ     *OFF
270070120817     C***  KARS1         CHAIN     FIARS01L                           30
270080120817     C     KARS1A        CHAIN     FIARS01L                           30
270090980320    3C     *IN30         IFEQ      *OFF
270100051102     c                   eval      jf=%scan(wjut:ARSnot)
270110040514    4c     jf            ifgt      *zeros
270120051102     C                   MOVEL     ARSNOT        DSEEX
270130980320     C* Compatto il cap nuovo e prendo cod.iso
270140980320     C                   MOVEL     VIDCAD        WRKCAD
270150980320     C                   EXSR      WRKCAP
270160011120     C     WNO55L        IFEQ      *BLANKS
270170980320     C                   MOVEA     §O9           WCAD
270180980320     C* Unisco il cap compattato alla nazione salvata
270190980408     C                   CLEAR                   WCADN
270200980320     C     WCAD          CAT       W15COD:0      WCADN
270210011107     C                   ELSE
270220011107     C                   CLEAR                   WCADN
270230011126     C                   CLEAR                   W55L
270240011120     C                   MOVEL     W15COD        W15C
270250011107     C                   ENDIF
270260980320     C*
270270051102     C                   MOVEL     DSEEX         ARSNOT
270280051114     C                   MOVEL     dateu         ARSduv
270290051102     C                   UPDATE    FIARS000
270300040514    4c                   endif
270310980320    3C                   END
270320040514     c     jf            ifgt      *zeros
270330120817     C**** KBLT1         READE(N)  FNBLT01L                               30
270340120817     C     KBLT1         READE(N)  FIART01L                               30
270350040514     c                   else
270360040514     c                   seton                                        30
270370040514     c                   endif
270380980320    2C                   ENDDO
270390980320    1C                   END
270400980320     C                   ENDSR
270410980320     C*--- IMPOSTO CAMPI SEGNAC.EUROEX DA PASSARE A PGM DI STAMPA ----*
270420980320     C     EUREXP        BEGSR
270430040505     C     §ogntw        ifeq      'EEX'
270440980320     C                   MOVEL     'E'           WTRC
270450980320     C                   Z-ADD     CO2SCD        WO2SCD            7 0
270460051102     C     KARS01        CHAIN(N)  FIARS01L                           30
270470980320    2C     *IN30         IFEQ      *OFF
270480980320     C* PASSO AL PGM DI STAMPA ETICHETTE IL N. SEGNACOLLO EUROEXPRESS
270490051102     C                   MOVEL     ARSNOT        §DEEUR
270500120302     C* SE IMPORT BRT METTO NEL CODICE PRODOTTO DELL'ETICHETTA
270510980320     C* ITALIA IL N.SEGNACOLLO EUROEXPRESS
270520000209     C*
270530051102     C                   MOVEA     ARSNOT        W35
270540980330     C                   Z-ADD     1             BB                2 0
270550980330     C     ' '           LOOKUP    W35(BB)                                30
270560980330     C   30              MOVEA     *BLANKS       W35(BB)
270570980330     C                   MOVEA     W35(6)        §LDCDP
270580980320    2C                   ENDIF
270590980320    1C                   ENDIF
270600020212     c* EXPORT FEDEX
270610020213    1C     A_§ogntw      IFEQ      'FED'
270620020212     C                   MOVEL     'F'           WTRC
270630020212     C                   Z-ADD     CO2SCD        WO2SCD            7 0
270640051102     C     KARS01        CHAIN(N)  FIARS01L                           30
270650020212    2C     *IN30         IFEQ      *OFF
270660020212     C* METTO NEL CODICE PRODOTTO DELL'ETICHETTA ITALIA il n.segnac. FEDEX
270670051102     C                   MOVEL     ARSNOT        §ldcdp
270680020212    2C                   ENDIF
270690020212    1C                   ENDIF
270700980320     C                   ENDSR
270710980409     C*
270720980409     C*--- SBORDERIZZAZIONE ------------------------------------------*
270730980409     C     SBORD         BEGSR
270740981020     C                   SETOFF                                       30
270750980409     C     KBLP3         SETLL     FNBLT000
270760980409    1C     *IN30         DOWEQ     *OFF
270770980409     C     KBLP3         READE     FNBLT000                               30
270780980409     C* SOLO SE NON C'E' GIA' LA DATA DI PARTENZA
270790980409    2C  N30BLTDFV        IFEQ      0
270800980409     C                   CLEAR                   BLTNFV
270810980409     C                   UPDATE    FNBLT000
270820120814     c     kfiart        chain     fiart01l
270830120814     c                   if        %found(fiart01l)
270840120814     C                   CLEAR                   ARTNFV
270850120814     C                   UPDATE    FIART000
270860120814     c                   endif
270870980409    2C                   ENDIF
270880980409    1C                   ENDDO
270890980409     C                   ENDSR
270900940916     C*
270910930708     C*--- CHAIN TABEL00F --------------------------------------------*
270920930708     C     CTABEL        BEGSR
270930930708     C     KTAB2         CHAIN     TABEL                              30
270940930708     C  N30TBLFLG        IFNE      ' '
270950930708     C                   SETON                                        30
270960930708     C                   END
270970930708     C                   ENDSR
270980930708     C*
270990930708     C*--- READ  TABEL00F --------------------------------------------*
271000930708     C     RTABEL        BEGSR
271010930708     C     KTAB3         READE     TABEL                                  30
271020930708     C                   ENDSR
271030940214     C*
271040940214     C*--- PASSO DATI PER CALCOLARE CONSEGNA TEORICA -----------------*
271050940214     C     CLSE98        BEGSR
271060970925     C                   CLEAR                   DSSD99
271070940214     C*
271080941230     C     VIDTSP        IFNE      *BLANKS
271090940214     C                   MOVEL     VIDTSP        D98TSP
271100941230     C                   ELSE
271110941230     C                   MOVEL     COMTSP        D98TSP
271120941230     C                   ENDIF
271130940214     C                   MOVEL     VIDCAD        D98CAD
271140970925     C                   MOVEL     VIDLOD        D98LOD
271150950102     C                   MOVEL     VIDNZD        D98NZD
271160940628     C* CALCOLO FLAG INOLTRO
271170940628     C                   EXSR      INOLTR
271180940628     C                   MOVEL     WFIN          D98FIN
271190940214     C*
271200001031     C* TERMINAL DI PARTENZA
271210960130     C                   MOVEL     COMTFP        D98TFP
271220940214     C*
271230001031     C* TERMINAL DI ARRIVO
271240970925     C                   CLEAR                   DSLV55
271250970925     C                   MOVEL     'A'           D55TPT
271260001031     C                   MOVEL     VIDLNP        D55LNP
271270001031     C*
271280970925     C                   MOVEL     COMLNA        D55LIN
271290970925     C                   MOVEL     BLPDSP        D55DRF
271300970925     C                   CALL      'FNLV55R'
271310970925     C                   PARM                    DSLV55
271320970925     C*
271330001031    1C     D55ERR        IFEQ      ' '
271340970925     C                   MOVEL     D55TFA        D98TFA
271350970925     C                   ELSE
271360970925     C                   MOVEL     COMLNA        D98TFA
271370001031    1C                   ENDIF
271380960927     C*
271390970925     C                   MOVEL     VIDLNP        D98LNP
271400970925     C                   MOVEL     COMLNA        D98LNA
271410940214     C                   MOVEL     BLPDSP        D98DSP
271420950102     C                   MOVE      BLPDSP        D98MGS
271430160315     c                   if        vidgc1<>' P' and vidgc1<>' M'
271440940214     C                   MOVEL     VIDGC1        D98GC1
271450160315     c                   endif
271460160315     c                   if        vidgc2<>' P' and vidgc2<>' M'
271470940214     C                   MOVEL     VIDGC2        D98GC2
271480160315     c                   endif
271490950102     C                   MOVEL     §3ATB1        D98TBL
271500950102     C                   MOVEL     WKSC          D98KSC
271510130826     c                   if        %subst(%editc(wksc:'X'):4:4)='9999'
271520130826     c                   move      8888          d98ksc
271530130826     c                   endif
271540100219     c* In alcuni casi, per la delivery, non devo tenere conto dei tempi
271550100219     c*  del C/Ass e fermo deposito
271560100219     c                   if        UsaCass=' '
271570010823     C                   Z-ADD     VIDCAS        D98CAS
271580010823     C                   MOVEL     VIDVCA        D98VCA
271590940214     C                   MOVEL     VIDTIC        D98TIC
271600940214     C                   MOVEL     VIDFFD        D98FFD
271610010214     C     D98FFD        IFEQ      'N'
271620010214     C                   MOVE      *BLANKS       D98FFD
271630010214     C                   ENDIF
271640100219     C                   ENDIF
271650950102     C*
271660970925     C                   CALL      'TNSD99R'
271670970925     C                   PARM                    DSSD99
271680940214     C* FLAG CHE TENGO MEMORIZZATO PER POI CHIUDERE I FILES
271690940214     C                   MOVEL     '1'           WCL98             1
271700940214     C*
271710100219     c                   clear                   UsaCass
271720900427     C                   ENDSR
271730950126     C*
271740950126     C* SPENGO INDICATORI DELLA 1 VIDEATA ---------------------------*
271750950126     C     OFFD01        BEGSR
271760950126     C                   SETOFF                                       404142
271770000313     C                   SETOFF                                       614356
271780950126     C                   SETOFF                                       455150
271790950126     C                   SETOFF                                       626346
271800950126     C                   SETOFF                                       474849
271810950126     C                   SETOFF                                       646566
271820950126     C                   SETOFF                                       676869
271830950126     C                   SETOFF                                       701090
271840950303     C                   SETOFF                                       553871
271850000120     C                   SETOFF                                       5257
271860010222     C                   CLEAR                   H1RIGA
271870010222     C                   CLEAR                   H1COLO
271880010214     C                   CLEAR                   H0RIGA
271890010214     C                   CLEAR                   H0COLO
271900071107     c****               if        dateu<§vpodrt
271910071107     C****               CLEAR                   ATRDRT
271920071107     c****               endif
271930010214     C                   CLEAR                   ATRPDR
271940010214     C                   CLEAR                   ATRCCM
271950010214     C                   CLEAR                   ATRFFD
271960010214     C                   CLEAR                   ATRFPP
271970010220     C                   CLEAR                   ATRLNA
271980010305     C                   CLEAR                   ATRNCL
271990010305     C                   CLEAR                   ATRPKG
272000100319     C                   CLEAR                   ATRTSP
272010950126     C                   ENDSR
272020950126     C*
272030950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE -------------*
272040950126     C     OFFD02        BEGSR
272050950126     C                   SETOFF                                       929399
272060950126     C                   SETOFF                                       414243
272070961111     C                   SETOFF                                       454686
272080950126     C                   SETOFF                                       474849
272090950126     C                   SETOFF                                       505152
272100950126     C                   SETOFF                                       535455
272110950126     C                   SETOFF                                       565759
272120950126     C                   SETOFF                                       606162
272130950126     C                   SETOFF                                       636465
272140950410     C                   SETOFF                                       586667
272150950410     C                   SETOFF                                       686970
272160950126     C                   SETOFF                                       717273
272170950126     C                   SETOFF                                       109040
272180950126     C                   SETOFF                                       808182
272190950126     C                   SETOFF                                       839784
272200961111     C                   SETOFF                                       747586
272210991117     C                   SETOFF                                       77
272220040610     c     atrbva        ifne      prri
272230040610     c                   movel     hiul          atrbva
272240040610     c                   endif
272250040216
272260040301     c                   Eval      wkk = *Off
272270021217
272280021218     c                   Clear                   H2riga
272290021218     c                   Clear                   H2colo
272300021217
272310950126     C                   ENDSR
272320950126     C*
272330950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE 3 VIDEATA-----*
272340950126     C     OFFD03        BEGSR
272350991025     C                   SETOFF                                       404142
272360991025     C                   SETOFF                                       434546
272370991025     C                   SETOFF                                       474849
272380991025     C                   SETOFF                                       505152
272390991025     C                   SETOFF                                       5390
272400040116     c                   Clear                   Atrsv2
272410040116     c                   Clear                   Atrsv3
272420040116     c                   Clear                   Atrsv4
272430041217     c                   Clear                   Atrsv5
272440041217     c                   Clear                   Atrsv6
272450950126     C                   ENDSR
272460950126     C*
272470950126     C* SE DISK CLIENTI CON "X" ESCO DAL PGM ED EMETTO NUOVA BOLLA----*
272480091111     C     ESCIER        BEGSR
272490950126     C*
272500161202     c                   if        §lpfpr<>'6'
272510161202     c*
272520091111     c* devo entrare se presente errore (90 on) oppure se devo per forza
272530091111     c* emettere una videata
272540020123     c     *in90         ifeq      *on
272550091111     c     wvidobb       oreq      '1'
272551170831
272560020123     C     §LPFPR        IFEQ      'V'
272570950419     C     §LPFPR        OREQ      'X'
272580950126     C     *IN12         OREQ      *OFF
272590950126     C     *IN15         OREQ      *OFF
272591170831     c     §lpfpr        andne     'N'
272592170831
272600010305     C     §LPFPR        IFNE      'O'
272610950126     C  N12
272620950126     COR 12
272630950126     CANN15              CLEAR                   §LPFPR
272640070307     C                   ENDIF
272650950126     C*
272660950126     C                   ELSE
272670950126     C*
272680950126     C                   MOVEL     '5'           §LPFPR
272690950126     C                   ENDIF
272700020123     C                   ENDIF
272710161202     c
272720161202     c                   endif
272730161202     c
272740950126     C                   ENDSR
272750161202     c* ----------------------------------------------------------------------
272760950127     C* SE E' STATA BATTUTA UNA CHIAVE RICERCA
272770950127     C*          E NON E STATO IMMESSO CODICE-01 ON ABILITATA LA RICERC
272780950127     C     RICALF        BEGSR
272790950127    1C   01WCCM          IFEQ      0
272800950127     C     PAXDMT        ANDNE     *BLANKS
272810950127     C* DESCRIZIONE AZIENDA
272820950127     C                   MOVEL     VIDDSA        PAXDUT           30
272830950127     C* PAXSTA=9 ESCLUDO ANNULLATI
272840950127     C                   Z-ADD     9             PAXSTA
272850950127     C* CAPOCONTO CLIENTI
272860950127     C                   Z-ADD     KCI           PAXCCC
272870950127     C* CODICE DA RICERCARE: SE IMMESSA LNP CERCO SOLO AL SUO INTERNO
272880000207     C                   MOVEL(P)  WFLC          PAXFLR
272890980929     C                   CLEAR                   PAXDIT
272900000121     C                   Z-ADD     1             PAXNUM
272910950127     C*
272920000121     C                   CALL      'XALFA3BR'
272930950127     C                   PARM                    PAXDUT
272940950127     C                   PARM                    CODUT
272950950127     C                   PARM                    PAXDMT
272960950127     C                   PARM                    PAXCCC
272970950127     C                   PARM                    PAXSTA            1 0
272980961016     C                   PARM                    PAXFLR           90
272990980701     C                   PARM                    PAXDIT            3
273000000121     C                   PARM                    PAXNUM            2 0
273010000121     C                   PARM                    PAXKCM           80
273020000121     C                   PARM                    PAXKSM          140
273030000121     C                   PARM                    PAXKDM           60
273040950127     C*
273050950127     C                   MOVEL     '1'           WEMFOR
273060950127     C* NON TROVATO O PREMUTO CMD12
273070950127    2C     PAXSTA        IFGT      -1
273080950127     C* CODICE SELEZIONATO: IMPOSTO A VIDEO
273090000127     C                   MOVEL     PAXKSM        W0070             7 0
273100000127     C                   MOVE      W0070         WCCM
273110000127     C                   MOVEL     W0070         W0030
273120950127     C                   SETON                                        50
273130950127     C*
273140950127     C* SE LA LINEA DEL CODICE NON CORRISPONDE ALLA LINEA PARTENZA
273150960926     C*  IMPOSTO ANCHE IL PUNTO OPEATIVO CLIENTE
273160950127     C     W0030         IFNE      WLNP
273170950127     C                   MOVEL     W0030         WFLC
273180950127     C                   SETON                                        14
273190950127     C                   ENDIF
273200950127    2C                   ENDIF
273210950127    1C                   ENDIF
273220950127     C                   ENDSR
273230950104     C**************************************************************************
273240950104     C*  ABBLANCA ZERO NON SIGNIFICATIVI
273250950104     C**************************************************************************
273260950104     C     ABBL          BEGSR
273270950104     C*
273280950104     C     SKI(I)        DOWEQ     '0'
273290950717     C     I             ANDLT     15
273300950104     C                   MOVEL     ' '           SKI(I)
273310950104     C                   ADD       1             I
273320950717     C                   ENDDO
273330950104     C*
273340950104     C                   ENDSR
273350950717     C**************************************************************************
273360950717     C*  CONTROLLO SEGNACOLLO DOPPIO ALL'INTERNO DELLA STESSA BOLLA
273370950717     C**************************************************************************
273380950717     C     VADDOP        BEGSR
273390020917     C     KBLC          SETLL     FIVAD000
273400020917     C     KBLC          READE(N)  FIVAD000                               30
273410950717     C                   CLEAR                   WNCD
273420950717     C*
273430950717     C     *IN30         DOWEQ     *OFF
273440950717     C*
273450950717     C     WNCD          IFNE      BLDNCD
273460950717     C                   MOVEL     BLDNCD        WNCD
273470020917     C     KBLC          READE(N)  FIVAD000                               30
273480950717     C                   ELSE
273490950717     C                   SETON                                        629030
273500950717     C                   ENDIF
273510950717     C*
273520950717     C                   ENDDO
273530950717     C* PREPARO MESSAGGIO
273540950717     C     *IN90         IFEQ      *ON
273550950717     C                   MOVEA     ERR(120)      K78
273560950717     C                   MOVEL     WNCD          W007A
273570950717     C                   MOVEA     W007A         SKI(9)
273580950717     C                   Z-ADD     9             I                 3 0
273590950717     C                   EXSR      ABBL
273600950717     C                   MOVEA     SKI(9)        K78(37)
273610950717     C                   MOVEA     K78           VIDMSG
273620950717     C                   ENDIF
273630950717     C*
273640950717     C                   ENDSR
273650001031     C**
273660120302     C* STAMPA ETICHETTA ESTERA SDI O BRT ----------------------------*
273670971215     C     ETIEST        BEGSR
273680971215     C*
273690040506     c* entro in questa routine anche per la stampa dell'etichetta Ita
273700040506     c* lia se segnacollo export Euroexpress per impostare la nazione
273710040506     c* §defca viene impostato ma per il momento non utilizzato nel
273720040506     c* pgm di stampa
273730040506     c*
273740081008    1C***  WESTER        IFEQ      'S'
273750081008     c     §detse        ifeq      'EEX'
273760971215     C                   MOVEL     DESCOD        §DEISA
273770971215     C**
273780971215    3C                   SELECT
273790971215     C     FLGTB1        WHENEQ    'A'
273800971215     C     §3AFCA        ANDEQ     0
273810971215     C                   MOVEL     'A'           §DEFCA
273820971215     C     FLGTB1        WHENEQ    'A'
273830971215     C     §3AFCA        ANDNE     0
273840971215     C                   MOVEL     'X'           §DEFCA
273850971215     C     §3AFCA        WHENNE    0
273860971215     C                   MOVEL     'S'           §DEFCA
273870971215    3C                   ENDSL
273880971215    1C                   ENDIF
273890971215     C**
273900971215     C                   ENDSR
273910000901     C*****************************************************
273920000901     C* CALCOLA CIFRA DI CONTROLLO SECONDO IL MODULO 10 IBM
273930000901     C*****************************************************
273940000901     C     M10           BEGSR
273950000901     C                   MOVE      *ZERO         §TT               3 0
273960000906     C                   MOVE      *ZERO         §TT2              3 0
273970000901     C                   MOVE      *ZERO         §1                1 0
273980000901     C                   Z-ADD     18            §S                2 0
273990000901     C                   DO        17            §N                2 0
274000000901     C                   SUB       1             §S
274010000901     C* INTANTO SPOSTO DA UNA SCHIERA AL CAMPO COD.BARRE
274020000901     C                   MOVE      §C(§N)        §CB(§N)
274030000901     C     §N            DIV       2             §CTR              3 0
274040000901     C                   MVR                     §RST              3 030
274050000901     C     *IN(30)       IFEQ      '1'
274060000901     C     §C(§S)        MULT      2             §N2               2 0
274070000901     C                   MOVE      §N2           §A2               2
274080000901     C                   MOVEA     §A2           §2A
274090000901     C                   XFOOT     §2            §CTR
274100000901     C                   ELSE
274110000901     C                   Z-ADD     §C(§S)        §CTR
274120000901     C                   END
274130000901     C                   ADD       §CTR          §TT
274140000901     C                   END
274150000901     C*
274160000901     C     §TT           ADD       9             §TT2
274170000901     C                   MOVE      0             §TT2
274180000901     C     §TT2          SUB       §TT           §1
274190000901     C*
274200000901     C                   MOVE      §1            §CB(18)
274210000901     C                   ENDSR
274220000901     C**************************************************************************
274230020917     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIVAT
274240000901     C**************************************************************************
274250000901     C     CARVAT        BEGSR
274260000905     C* CAMPI SFL CONTROL
274270000912     C                   MOVE      §LPCCN        V8CKSC
274280000905     C                   Z-ADD     KCI           CCC
274290000905     C     KACO          CHAIN     CNACO000                           30
274300000905     C  N30              MOVEL     ACORAG        V8DKSC
274310000905     C   30              MOVEL     *BLANKS       V8DKSC
274320000905     C*
274330000901     C                   Z-ADD     0             NR8
274340000901     C                   MOVEL     'E'           WTRC
274350020917     C     KVAT          SETLL     FIVAT000
274360061010     C     KVAT          READE(N)  FIVAT000                               30
274370000901     C     *IN30         DOWEQ     *OFF
274380000901     C                   MOVEL     *BLANKS       V8CSCE
274390040302     c                   Eval      wtxt = VatNot
274400041117     c                   eval      uppercase = '1'
274410141202     c                   clear                   ElencoChar
274420160112     c                   clear                   TipoElenco
274430040302     c                   ExSr      Sr_Chk
274440040302     c                   Movel     wtxt          V8cNot
274450000908     C                   MOVE      *BLANKS       V8HDKC
274460000908     C                   MOVE      *BLANKS       V8HESG
274470000915     C                   MOVE      *ZEROS        V8HST2
274480000915     C                   CLEAR                   V8HFLS
274490000915     C                   CLEAR                   V8HLNA
274500000915     C                   CLEAR                   V8HNRS
274510000915     C                   CLEAR                   V8HNSC
274520000921     C                   CLEAR                   V8HPRE
274530000901     C* SCRIVO SUBFILE
274540040617     c* potrebbe succcedere che il cliente ci passi più di 500 record
274550040617     c* di vat ma sul vab il numero colli è inferiore a 500
274560040617     c* In questo caso ne carico al max 500
274570040617     c     nr8           ifeq      500
274580040617     c                   seton                                        30
274590040617     c                   else
274600000901     C                   ADD       1             NR8
274610000901     C                   WRITE     LS01S08
274620061010     C     KVAT          READE(N)  FIVAT000                               30
274630040617     c                   endif
274640000901     C                   ENDDO
274650000918     C                   Z-ADD     NR8           SAVNR8
274660000901     C*
274670000901     C                   ENDSR
274680050221     C**************************************************************************
274690050221     C*  CARICAMENTO numero parcel dpd
274700050221     C**************************************************************************
274710050221     C     sr_vatdpd     BEGSR
274720050221     C                   MOVEL     'E'           WTRC
274730050221     c                   clear                   werrvat           1
274740060612     c                   clear                   w014a
274750050221     C     KVAT          SETLL     FIVAT000
274760061010     C     KVAT          READE(N)  FIVAT000                               30
274770050221     C     *IN30         DOWEQ     *OFF
274780050221     c     werrvat       andeq     *blanks
274790060612     c     w014a         ifeq      *blanks
274800060612     c                   if        §ogntw = 'DPD'
274810060612     c                   movel     vatnot        dvate
274820060612     c                   movel     §VATEPRN      w014a
274830060612     c                   else
274840060612     c                   movel     vatnot        w014a
274850060612     c                   endif
274860050221     c                   else
274870050221     c                   eval      werrvat = '1'
274880050221     c                   endif
274890061010     C     KVAT          READE(N)  FIVAT000                               30
274900050221     c                   enddo
274910050221     c                   endsr
274920000901     C**************************************************************************
274930020917     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIVAB O FIVAD
274940000901     C**************************************************************************
274950000901     C     CARVAB        BEGSR
274960000901     C                   Z-ADD     0             NR8
274970000905     C* CAMPI SFL CONTROL
274980000912     C                   MOVE      §LPCCN        V8CKSC
274990000905     C                   Z-ADD     KCI           CCC
275000000905     C     KACO          CHAIN     CNACO000                           30
275010000905     C  N30              MOVEL     ACORAG        V8DKSC
275020000905     C   30              MOVEL     *BLANKS       V8DKSC
275030000901     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
275040000901     C                   CLEAR                   DSBLD7
275050000901     C                   MOVE      §LPLNP        §LCLNP
275060000901     C                   MOVE      §LPLNA        §LCLNA
275070000901     C                   MOVE      §LPNRS        §LCNRS
275080000901     C                   MOVE      §LPZNC        §LCZSC
275090020917     C* SEGNACOLLI SEQUENZIALI: CARICO CHI SONO DA FIVAB
275100000901    1C     §1BFG7        IFNE      'S'
275110000901     C                   MOVE      §LPNCD        §LCNCD
275120000901     C* Calcolo il check digit
275130000901     C                   EXSR      M10
275140000911     C                   MOVEA     §CA           V8CNOT
275150000901     C                   MOVEL     *BLANKS       V8CSCE
275160000908     C                   MOVE      *BLANKS       V8HDKC
275170000908     C                   MOVE      *BLANKS       V8HESG
275180000915     C                   MOVE      *ZEROS        V8HST2
275190000915     C                   CLEAR                   V8HFLS
275200000915     C                   CLEAR                   V8HLNA
275210000915     C                   CLEAR                   V8HNRS
275220000915     C                   CLEAR                   V8HNSC
275230000921     C                   CLEAR                   V8HPRE
275240000901     C                   ADD       1             NR8
275250000901     C                   WRITE     LS01S08
275260101217     c                   movel     v8cnot        chidal
275270000901    2C     §LPNCA        IFGT      *ZEROS
275280001016     C     §LPNCA        ANDNE     §LPNCD
275290101217     C                   MOVE      §LPNCA        §LCNCD
275300101217     C* Calcolo il check digit
275310101217     C                   EXSR      M10
275320101217     C                   MOVEA     §CA           V8CNOT
275330101217     C                   MOVEL     *BLANKS       V8CSCE
275340101217     C                   ADD       1             NR8
275350101217     C                   WRITE     LS01S08
275360101217     c                   movel     v8cnot        chial
275370101217     c     chidal        downe     chial
275380101216     C                   CLEAR                   DSLSZ1
275390101216     C                   MOVEL     'E'           IZ1MOD
275400101216     C                   MOVEL     CHIDAL        IZ1CH1
275410101216     C                   Z-ADD     V8CKSC        IZ1CCM
275420101216     C                   MOVEL     wctm          IZ1CTM
275430101216     C                   Z-ADD     §lpnrs        IZ1NRS
275440101216     C                   CALL      'FNLSZ1R'
275450101216     C                   PARM                    KPJBA
275460101216     C                   PARM                    DSLSZ1
275470101216     C                   PARM                    DS1B
275480101217     c     oz1chi        ifne      chial
275490101216     C                   MOVEL     OZ1CHI        V8CNOT
275500000901     C                   MOVEL     *BLANKS       V8CSCE
275510000901     C                   ADD       1             NR8
275520000901     C                   WRITE     LS01S08
275530000901    2C                   ENDIF
275540101217     c                   eval      chidal=oz1chi
275550101217     c                   enddo
275560101217     c                   endif
275570000918     C                   Z-ADD     NR8           SAVNR8
275580000901   X1C                   ELSE
275590020917     C* ALTRIMENTI LI CARICO DA FIVAD
275600020917     C     KBLC          SETLL     FIVAD000
275610020917     C     KBLC          READE     FIVAD000                               30
275620000904    2C     *IN30         DOWEQ     *OFF
275630000904    3C     BLDNCA        IFEQ      0
275640000904     C                   Z-ADD     BLDNCD        BLDNCA
275650000904    3C                   ENDIF
275660000904     C*
275670000904    3C     BLDNCD        DOWLE     BLDNCA
275680000904     C     BLDNCD        ANDGT     0
275690000904     C                   MOVE      BLDNCD        §LCNCD
275700000904     C* Calcolo il check digit
275710000904     C                   EXSR      M10
275720000911     C                   MOVEA     §CA           V8CNOT
275730000901     C                   MOVEL     *BLANKS       V8CSCE
275740000908     C                   MOVE      *BLANKS       V8HDKC
275750000908     C                   MOVE      *BLANKS       V8HESG
275760000915     C                   MOVE      *ZEROS        V8HST2
275770000915     C                   CLEAR                   V8HFLS
275780000915     C                   CLEAR                   V8HLNA
275790000915     C                   CLEAR                   V8HNRS
275800000915     C                   CLEAR                   V8HNSC
275810000921     C                   CLEAR                   V8HPRE
275820000901     C* SCRIVO SUBFILE
275830000901     C                   ADD       1             NR8
275840000901     C                   WRITE     LS01S08
275850000904     C                   ADD       1             BLDNCD
275860000904    3C                   ENDDO
275870020917     C     KBLC          READE     FIVAD000                               30
275880000904    2C                   ENDDO
275890000918     C                   Z-ADD     NR8           SAVNR8
275900000904     C*
275910000904    1C                   ENDIF
275920000901     C*
275930000901     C                   ENDSR
275940140506     C**************************************************************************
275950140506     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIART (dirottamenti)
275960140506     C**************************************************************************
275970140506     C     CARART        BEGSR
275980140506     C                   Z-ADD     0             NR8
275990140506     C* CAMPI SFL CONTROL
276000140506     C                   MOVE      §LPCCN        V8CKSC
276010140506     C                   Z-ADD     KCI           CCC
276020140506     C     KACO          CHAIN     CNACO000                           30
276030140506     C  N30              MOVEL     ACORAG        V8DKSC
276040140506     C   30              MOVEL     *BLANKS       V8DKSC
276050140506     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
276060140506     C                   CLEAR                   DSBLD7
276070140506     c     kbolm         chain     fnarb01l
276080140506     c                   if        %found(fnarb01l)
276090140710     C                   MOVE      arbfls        §LCLNP
276100140506     C                   MOVE      arbnrs        §LCNRS
276110140716     C                   MOVE      arbZNC        §LCZSC
276120140506     C                   MOVE      arbLNA        §LCLNA
276130140506     c                   endif
276140140506     C*
276150140506     C     Kbolm         SETLL     fiart01l
276160140506     C     kbolm         READE(n)  fiart01l
276170140506    2C                   DOW       not %eof(fiart01l)
276180140506     C*
276190140506     C                   MOVE      artnsc        §LCNCD
276200140716     c* Prendo zona dall'ultima spunta fatta. Se non trovo spunte
276210140716     c* tengo la zona della bolla
276220140716     c                   exsr      sr_zona
276230140716     c                   if        wokzona='1'
276240140716     C                   MOVE      wznbrv        §LCZSC
276250140716     c                   else
276260140716     C                   MOVE      arbZNC        §LCZSC
276270140716     c                   endif
276280140506     C* Calcolo il check digit
276290140506     C                   EXSR      M10
276300140506     C                   MOVEA     §CA           V8CNOT
276310140506     C                   MOVEL     *BLANKS       V8CSCE
276320140506     C                   MOVE      *BLANKS       V8HDKC
276330140506     C                   MOVE      *BLANKS       V8HESG
276340140506     C                   MOVE      *ZEROS        V8HST2
276350140506     C                   CLEAR                   V8HFLS
276360140506     C                   CLEAR                   V8HLNA
276370140506     C                   CLEAR                   V8HNRS
276380140506     C                   CLEAR                   V8HNSC
276390140506     C                   CLEAR                   V8HPRE
276400140506     C* SCRIVO SUBFILE
276410140506     C                   ADD       1             NR8
276420140506     C                   WRITE     LS01S08
276430140506     C     kbolm         READE(n)  fiart01l
276440140506    2C                   ENDDO
276450140506     C                   Z-ADD     NR8           SAVNR8
276460140506     C*
276470140506     C*
276480140506     C                   ENDSR
276490140716     C**************************************************************************
276500140716     C*  determinazinoe zona segnacollo da spunta
276510140716     C**************************************************************************
276520140716     C     sr_zona       BEGSR
276530140716     c
276540140716     c                   clear                   wznbrv
276550140716     c                   clear                   wokzona
276560140716     c     kbrv7z        setll     fnbrv07l
276570140716     c     kbrv7z        reade     fnbrv07l
276580140716     c                   dow       not %eof(fnbrv07l)
276590140716     c* scarto se categoria 8 o manca la data caricamento (spunta autogenerata)
276600140716     c                   if        brvnpg<>8 and brvdcs>0
276610140716     c                   if        wokzona=*blanks or
276620140716     c                             brvdfs>wdfs or
276630140716     c                             (brvdfs=wdfs and brvhms>whms)
276640140716     c                   z-add     brvznc        wznbrv
276650140716     c                   eval      wokzona='1'
276660140716     c                   z-add     brvdfs        wdfs
276670140716     c                   z-add     brvhms        whms
276680140716     c                   endif
276690140716     c                   endif
276700140716     c     kbrv7z        reade     fnbrv07l
276710140716     c                   enddo
276720140716     c                   endsr
276730000913     C**************************************************************************
276740051102     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIARS
276750000913     C**************************************************************************
276760051102     C     CARARS        BEGSR
276770000913     C* CAMPI SFL CONTROL
276780000913     C                   MOVE      WKSC          V8CKSC
276790000913     C                   Z-ADD     KCI           CCC
276800000913     C     KACO          CHAIN     CNACO000                           30
276810000913     C  N30              MOVEL     ACORAG        V8DKSC
276820000913     C   30              MOVEL     *BLANKS       V8DKSC
276830000913     C*
276840000913     C                   MOVEL     *BLANKS       V8CSCE
276850051102     C                   MOVEL     ARSNOT        V8CNOT
276860000913     C                   MOVE      *BLANKS       V8HDKC
276870000913     C                   MOVE      *BLANKS       V8HESG
276880000915     C                   MOVE      *ZEROS        V8HST2
276890051102     C                   Z-ADD     ARSFLS        V8HFLS
276900051102     C                   Z-ADD     ARSLNA        V8HLNA
276910051102     C                   Z-ADD     ARSNRS        V8HNRS
276920051102     C                   Z-ADD     ARSNSC        V8HNSC
276930000913     C* SCRIVO SUBFILE
276940000913     C                   ADD       1             NR8
276950000913     C                   WRITE     LS01S08
276960160302
276970160302     c                   if        a_§ogntw='FED'
276980160302     c                   eval      wtip=%subst(arsnot:1:2)
276990160302     c                   endif
277000000913     C*
277010000913     C                   ENDSR
277020031114      *------------------------------------------------------------------------*
277030031114      *  CARICAMENTO DATI DA FIVAT00F
277040031114      *------------------------------------------------------------------------*
277050031114     c     Sr_CarVat     BegSr
277060110818     c**
277070110818     c** N.B: l'elenco dei tipi record del fivat e le relative descrizioni
277080110818     c**      sono interrogabili sulla tabella "VAT"
277090110818     c**
277100031125     c                   Clear                   dVato
277110161019     c                   clear                   w_unoI
277120161019     c                   clear                   w_unoJ
277130031125
277140031114      * Leggo FIVAT00f
277150031114     c     kVat1         Setll     Fivat01l
277160031114     c                   Do        *Hival
277170061010     c     kVat1         Reade(N)  Fivat01l
277180031114     c                   If        %Eof(Fivat01l)
277190031114     c                   Leave
277200031114     c                   EndIf
277210031114      * Escludo i record "E"
277220031114     c                   If        VatTrc = 'E'
277230031114     c                   Iter
277240031114     c                   EndIf
277250040302
277260040302      * Controllo i dati inviati dal cliente, tranne il rcd 'O' xchè è tutto
277270040302      * numerico
277280141202      * per tipo record "Y"  - PIN CODE i controlli non li devo fare in
277290141202      * questo momento
277300141202     c                   If        VatTrc <> 'O' and
277310141202     c                             VatTrc <>'Y'
277320040302     c                   Eval      wtxt = VatNot
277330131003     c                   clear                   uppercase
277340141202     c                   clear                   ElencoChar
277350160112     c                   clear                   TipoElenco
277360040302     c                   ExSr      Sr_Chk
277370040302     c                   Movel     wtxt          VatNot
277380040302     c                   EndIf
277390031114      * Imposto i campi in base al tipo record
277400031114     c                   Select
277410031114      * Referente
277420031114     c                   When      VatTrc = 'A'
277430031114     c                   Eval      VidRef = VatNot
277440031114      * Telefono
277450031114     c                   When      VatTrc = 'B'
277460031114     c                   Eval      VidTel = VatNot
277470031125      * Bancali x particolarità varia 'O'
277480031125     c                   When      VatTrc = 'O'
277490031125     c                   Movel     VatNot        dVato
277500031219      * Riferimento partener estero
277510031219     c                   When      VatTrc = 'C'
277520031219     c                   Movel     VatNot        wrifp
277530110510      * E-mail al destinatario - indirizzo
277540161019     c                   When      VatTrc = 'I' and w_unoI=' '
277550161019     c                   eval      w_unoI='1'
277560150213     c*                  Clear                   atremd
277570150213     c*                  Clear                   atrwemd
277580110510     c                   Movel     VatNot        wemdest
277590161019     c                   When      VatTrc = 'J' and W_unoJ=' '
277600161019     c                   eval      w_unoJ='1'
277610150213     c*                  Clear                   atremd
277620150213     c*                  Clear                   atrwemd
277630110512     c                   if        wemdest<>*blanks
277640110512     c                   eval      wemdest=%trimr(wemdest) + vatnot
277650110512     c                   else
277660110512     c                   Movel     VatNot        wemdest
277670110512     c                   endif
277680110704      * codici CUP e CIG per tracciabilità flussi finanziari
277690110704     c                   when      VatTrc='4'
277700110704     c                   movel     vatnot        dvat4
277710120606     c                   exsr      impocupcig
277720120606     c***                eval      Wcupcup=§vat4cup
277730120606     c***                eval      Wcupcig=§vat4cig
277740130315     c* numero di telefono per invio sms
277750130918     c* flag per negare l'invio di mail per merce partita
277760130315     c                   when      VatTrc='S'
277770130315     c                   Movel     VatNot        dVats
277780130403     c                   eval      wsms=§vatstel
277790150213     c*                  if        wsms<>*blanks
277800150213     c*                  clear                   atremd
277810150213     c*                  clear                   atrwtel
277820150213     c*                  endif
277830130930     c                   clear                   wsmp
277840130930     c                   if        wsms<>*blanks and §vatssmp<>'N'
277850130930     c                   eval      wsmp='S'
277860130930     c                   endif
277870130918     c                   eval      wmmp=§vatsmmp
277880141031      * PIN CODE
277890141031     c                   when      VatTrc='Y'
277900141031     c                   Movel     VatNot        wPinCode
277910141202     c* memorizzo la lunghezza del PIN ricevuto dal cliente
277920141202     c                   eval      lenPC=%checkr(' ':vatnot)
277930031219      * Altri record non li carico
277940031219     c                   Other
277950031219     c                   Iter
277960031114
277970031114     c                   EndSl
277980031114
277990031114     c                   EndDo
278000150213
278010161102     c* se ho il numero di cell., se errato lo clearo
278020161102     c                   if        wsms<>*blanks
278030150216      /free
278040150216       pInCell = %trim(wsms);
278050161102       pInCellOpz = '2';
278060150216       pOutErr = *blanks;
278070161102      // Il numero deve essere normalizzato conservando eventuale "+"
278080161102      // davanti al prefisso
278090161102       if UBCHKCEL_Check(pInCell:pOutCell:pOutErr:pInCellOpz)
278100161102                                   < 0 OR pOutErr= 'E';
278110150216           // Numero di cellulare KO
278120150216           clear wsms;
278130150216       else;
278140161102           wsms=pOutCell;
278150150216       endif;
278160150216      /end-free
278170161102     c                   endif
278180161102     c* Se ho il numero di cellulare lo metto anche nel Tel.Dest. se manca
278190161102     c                   if        wsms<>*blanks and vidtel=*blanks
278200161102     c                   eval      vidtel=wsms
278210150213     c                   endif
278220160510     c* se ho l'indirizzo e-mail, se errato lo clearo
278230160510     c                   if        wemdest<>*blanks
278240160510     c                   exsr      sr_chkemd
278250160510      * Errore
278260161019if  3c                   If        §emlerro <> '0' and §EMLINDO=*blanks
278270160510     c                   clear                   wemdest
278280160510     c                   else
278290160510     c                   Eval      wemdest = §emlindo
278300160510     c                   endif
278310160510     c                   endif
278320160511     c                   eval      sav_wemdest=wemdest
278330160511     c                   eval      sav_wsms   =wsms
278340031114
278350031114     c                   EndSr
278360040302      *---------------------------------------------------------
278370040302      * Controllo i caratteri dei campi alfanumerici
278380040302      *---------------------------------------------------------
278390040302     c     Sr_Chk        BegSr
278400040302
278410040302     c                   Eval      TxtInOut = wtxt
278420040302     c                   Call      'XCHKCHAR'
278430040302     c                   Parm                    TxtInOut
278440040302     c                   Parm                    ElencoChar
278450040302     c                   Parm                    TipoElenco
278460040302     c                   Parm                    CharSost
278470040302     c                   Parm                    UpperCase
278480040302     c                   Parm                    ChkNull
278490040302     c                   Parm                    CharNull
278500040302     c                   Parm                    Esito
278510040302     c                   If        Esito = '1'
278520040302     c                   Move      TxtInOut      wtxt
278530040302     c                   EndIf
278540040302
278550040302     c                   EndSr
278560140110      *---------------------------------------------------------
278570140110      * Controllo caratteri di punteggiatura precedenti e seguenti
278580140110      *---------------------------------------------------------
278590140110     c     chkstringa    BegSr
278600140110
278610140110     c* trovo la prima posizione "buona" da utilizzare
278620160112     c                   eval      posl=%check(charnooki:wtxt)
278630140207     c* trovo l'ultima posizione "buona" da utilizzare (escludo il ".")
278640140207     c                   eval      posr=%checkr(charnookf:wtxt)
278650140207     c                   if        posl=0
278660140207     c                   clear                   wtxt
278670140207     c                   else
278680140110     c* determino la lunghezza della stringa "buona"
278690140110     c                   eval      lung=(posr-posl)+1
278700140207     c                   eval      wtxt=%subst(wtxt:posl:lung)
278710140110     c                   endif
278720140110
278730140110     c                   EndSr
278740120606      *---------------------------------------------------------
278750120606      * Verifica e impostazione CUP e  CIG ricevuti dal cliente
278760120606      *---------------------------------------------------------
278770120606     c     impocupcig    BegSr
278780120606     c                   clear                   wstringa
278790120606     c     '0':' '       xlate     §vat4cup      wstringa
278800120606     c                   if        wstringa<>*blanks
278810120606     c                   eval      Wcupcup=§vat4cup
278820120606     c                   endif
278830120606     c                   clear                   wstringa
278840120606     c     '0':' '       xlate     §vat4cig      wstringa
278850120606     c                   if        wstringa<>*blanks
278860120606     c                   eval      Wcupcig=§vat4cig
278870120606     c                   endif
278880120606     c                   EndSr
278890110512      *---------------------------------------------------------
278900110512      * Controllo indirizzo email destinatario
278910110512      *---------------------------------------------------------
278920110512     c     Sr_Chkemd     BegSr
278930110512     c                   Clear                   dsemail
278940110512     c                   Eval      §emlindi = wemdest
278950110512     c                   Call      'XEMAIL'
278960110512     c                   Parm                    dsemail
278970110512     c                   EndSr
278980031125      *------------------------------------------------------------------------*
278990031125      *  CONTROLLO CHE DATI TENERE PER I BANCALI
279000031125      *------------------------------------------------------------------------*
279010031125     c     Sr_CtrBancali BegSr
279020031125
279030031125     c                   Clear                   wgva
279040031125
279050031126     c                   Select
279060031126      * particolarità varia 'O'
279070031126w   1c                   When      %subst(VidGva:1:1) = 'O'
279080031126      * dati trovati in FIVAT rcd 'O'
279090031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
279100031126      * carico i dati del FIVAT
279110031126     c                   Clear                   VidTba
279120031126     c                   If        §VatoTba > *Zeros
279130031126     c                   Movel     §VatoTba      VidTba
279140031126     c                   EndIf
279150031126     c                   Eval      VidNba = §VatoNba
279160031126     c                   Eval      SavNba = §VatoNba
279170031126     c                   Clear                   VidTb2
279180031126     c                   If        §VatoTb2 > *Zeros
279190031126     c                   Movel     §VatoTb2      VidTb2
279200031126     c                   EndIf
279210031126     c                   Eval      VidNb2 = §VatoNb2
279220031126     c                   Eval      SavNba = §VatoNb2
279230031126     c                   Eval      w03Cor = §VatoCor
279240031126     c                   Eval      w03Csf = §VatoCsf
279250031126      * dati non trovati in FIVAT rcd 'O'
279260031126   x2c                   Else
279270031126      * pulisco i campi del video
279280031126     c                   Clear                   VidTba
279290031126     c                   Clear                   VidNba
279300031126     c                   Clear                   SavNba
279310031126     c                   Clear                   VidTb2
279320031126     c                   Clear                   VidNb2
279330031126     c                   Clear                   SavNba
279340031126    2c                   EndIf
279350031126
279360031126      * particolarità varia 'B'
279370031126w   1c                   When      %subst(VidGva:1:1) = 'B'
279380031126      * dati trovati in FIVAT rcd 'O'
279390031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
279400031126      * pulisco i dati del FIVAT
279410031126     c                   Clear                   dVato
279420031126    2c                   EndIf
279430031126
279440031126      * particolarità varia = ' '
279450031126w   1c                   When      %subst(VidGva:1:1) = ' '
279460031126      * dati trovati in FIVAT rcd 'O'
279470031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
279480031126      * carico i dati del FIVAT
279490031126     c                   Clear                   VidTba
279500031126     c                   If        §VatoTba > *Zeros
279510031126     c                   Movel     §VatoTba      VidTba
279520031126     c                   EndIf
279530031126     c                   Eval      VidNba = §VatoNba
279540031126     c                   Eval      SavNba = §VatoNba
279550031126     c                   Clear                   VidTb2
279560031126     c                   If        §VatoTb2 > *Zeros
279570031126     c                   Movel     §VatoTb2      VidTb2
279580031126     c                   EndIf
279590031126     c                   Eval      VidNb2 = §VatoNb2
279600031126     c                   Eval      SavNba = §VatoNb2
279610031126     c                   Eval      w03Cor = §VatoCor
279620031126     c                   Eval      w03Csf = §VatoCsf
279630031126      * imposto un flag per emettere un msg mirato in seconda videata
279640031126     c                   Eval      wgva = 'O'
279650031126      * dati non trovati in FIVAT rcd 'O'
279660031126   x2c                   Else
279670031126      * se ho i bancali
279680031126if  3c                   If        §LpNba > *Zeros or §LpNb2 > *Zeros
279690031126      * imposto un flag per emettere un msg mirato in seconda videata
279700031126     c                   Eval      wgva = 'B'
279710031126    3c                   EndIf
279720031126    2c                   EndIf
279730031126
279740031126   o1c                   other
279750031126      * dati trovati in FIVAT rcd 'O'
279760031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
279770031126      * pulisco i dati del FIVAT
279780031126     c                   Clear                   dVato
279790031126      * dati non trovati in FIVAT rcd 'O'
279800031126   x2c                   Else
279810031126      * pulisco i campi del video
279820031126     c                   Clear                   VidTba
279830031126     c                   Clear                   VidNba
279840031126     c                   Clear                   SavNba
279850031126     c                   Clear                   VidTb2
279860031126     c                   Clear                   VidNb2
279870031126     c                   Clear                   SavNba
279880031126    2c                   EndIf
279890031126
279900031126    1c                   EndSl
279910031125
279920031125     c                   EndSr
279930000904     C**************************************************************************
279940000904     C*  GESTIONE VIDEATA MANUTENZIONE COD. CHI SONO
279950000904     C**************************************************************************
279960000904     C     GESD08        BEGSR
279970000905     C  N90              Z-ADD     1             V8CNBR
279980000904     C                   CLEAR                   V8ZMSG
279990000905     C   90              MOVEL     W08MSG        V8ZMSG
280000000928     C* SE DSIK C EX DISK BI ACCENDO 33 PER DISABILITARE F9-AGGIUNTA
280010000928     C     §1BF12        IFEQ      'B'
280020000928     C                   SETON                                        33
280030000928     C                   ENDIF
280040000904     C* EMISSIONE VIDEATA
280050000904     C     EMD08         TAG
280060000904     C                   WRITE     LS01Z08
280070161129     c                   if        *in12 and not *in15
280080161129     C                   write     LS01C08
280090161129     C                   read(E)   fnls01d
280100161129     c                   else
280110161129     C                   EXFMT     LS01C08
280120161129     c                   endif
280130161129     c
280140000911     C                   SETOFF                                       6190
280150000904     C                   CLEAR                   V8ZMSG
280160161129     c
280170161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
280180161129     c                   if        %error
280190161129     C                   MOVEL     '6'           §LPFPR
280200161129     c                   leavesr
280210161129     c                   endif
280220161129     c
280230000904     C     *INKL         CABEQ     *ON           ENDD08
280240010504     C* CONTROLLO EVENTUALI RECORD ANNULLATI E LI TOLGO DALLA SCHIERA
280250010504     C* DI WORK
280260010504     C                   EXSR      CTRS8A
280270000904     C* F9=AGGIUNTA CODICI
280280000904     C     *INKI         IFEQ      *ON
280290000904     C                   EXSR      GESD09
280300161202     c
280310161202     c                   if        §lpfpr='6'
280320161202     c                   goto      endd08
280330161202     c                   endif
280340161202     c
280350000914     C     *INKL         CABEQ     *ON           ENDD08
280360000904     C                   ENDIF
280370010504     C* CONTROLLO DATI
280380010504     C                   EXSR      CTRS08
280390010504     C   90              MOVEL     W08MSG        V8ZMSG
280400010504     C  NKF
280410010504     COR 90              GOTO      EMD08
280420000904     C     ENDD08        ENDSR
280430000830     C**************************************************************************
280440000830     C*  GESTIONE VIDEATA INSERIMENTO COD. CHI SONO
280450000830     C**************************************************************************
280460000904     C     GESD09        BEGSR
280470000905     C* QUESTA ROUTINE POTREBBE ESSERE RICHIAMATA DURANTE LA MANUTENZIO
280480000905     C* NE DEL SUBFILE: IN QUESTO CASO DEVO MANTENERE IL POSIZIONAMENTO
280490000905     C* NEL SUBFILE CHE C'È GIA'
280500000904     C     V8CNBR        IFEQ      0
280510000830     C                   Z-ADD     1             V8CNBR
280520000904     C                   ENDIF
280530000918     C                   Z-ADD     SAVNR8        NR8
280540051121     c                   write     ls01d08
280550000904     C     EMD09         TAG
280560000830     C                   WRITE     LS01C08
280570000830     C                   EXFMT     LS01D09
280580161202     c
280590000904     C                   SETOFF                                       61
280600000921     C* SCRIVO SUBFILE (SE CHI SONO GIA' IMMESSO NON LO RICARICO E NON
280610000921     C* DO ERRORE)
280620000830     C     V9CNOT        IFNE      *BLANKS
280630000921     C     V9CNOT        LOOKUP    CH2                                    31
280640000921     C     *IN31         IFEQ      *OFF
280650000830     C                   ADD       1             NR8
280660000830     C                   Z-ADD     NR8           V8CNBR
280670000911     C                   MOVEL     V9CNOT        V8CNOT
280680000830     C                   CLEAR                   V8CSCE
280690000908     C                   CLEAR                   V8HDKC
280700000908     C                   CLEAR                   V8HESG
280710000915     C                   CLEAR                   V8HST2
280720000915     C                   CLEAR                   V8HFLS
280730000915     C                   CLEAR                   V8HLNA
280740000915     C                   CLEAR                   V8HNRS
280750000915     C                   CLEAR                   V8HNSC
280760000921     C                   CLEAR                   V8HPRE
280770000830     C                   WRITE     LS01S08
280780000921     C                   SETON                                        78
280790000921     C                   ADD       1             I2                3 0
280800000921     C                   MOVE      V9CNOT        CH2(I2)
280810000921     C                   ENDIF
280820000911     C                   CLEAR                   V9CNOT
280830000830     C                   ENDIF
280840000918     C                   Z-ADD     NR8           SAVNR8
280850000905     C* PER F6 ESCO DALLA VIDEATA DI IMMISSIONE "CHI SONO"
280860000914     C     *INKF         IFEQ      *OFF
280870000914     C     *INKL         ANDEQ     *OFF
280880000914     C                   GOTO      EMD09
280890000914     C                   ENDIF
280900000830     C                   ENDSR
280910000830     C**************************************************************************
280920000830     C*   CONTROLLO SUBFILE CHI SONO
280930000905     C**************************************************************************
280940000830     C     CTRS08        BEGSR
280950000830     C                   CLEAR                   CHI
280960000907     C                   CLEAR                   POS
280970021119     c                   Clear                   Prefisso
280980000830     C                   CLEAR                   W08MSG
280990000830     C                   Z-ADD     0             IX                4 0
281000000911    0C     *IN78         IFEQ      *ON
281010000830     C                   Z-ADD     1             NR8
281020000921     C                   SETOFF                                       9061
281030000830     C     NR8           CHAIN     LS01S08                            31
281040000831    1C     *IN31         DOWEQ     *OFF
281050000904     C* IGNORO CODICE SE ANNULLATO
281060000904   1AC     V8CSCE        IFEQ      ' '
281070000904     C* IL CODICE CHI SONO NON DEVE ESSERE RIPETUTO ALL'INTERNO
281080000904     C* DEL SUBFILE
281090000830     C     V8CNOT        LOOKUP    CHI                                    31
281100000831    2C     *IN31         IFEQ      *ON
281110000830     C* SE IL CODICE È DOPPIO ERRORE - ESCO DAL CICLO MEMORIZZANDO IL
281120000830     C* NRR IN ERRORE
281130000905     C                   Z-ADD     NR8           V8CNBR
281140000905     C                   SETON                                        9061
281150000911     C     WC01FG        IFEQ      'C'
281160000831     C                   MOVEL     ERR(205)      W08MSG
281170000911     C                   ELSE
281180000911     C                   MOVEA     ERR(205)      K78
281190000911     C                   MOVEA     *BLANKS       K78(44)
281200000911     C                   MOVEA     K78           W08MSG
281210000911     C                   ENDIF
281220000905     C                   UPDATE    LS01S08
281230000831     C                   GOTO      ENDS08
281240000831    2C                   ENDIF
281250021119      * Controllo prefisso chi sono
281260021119     c                   Movel     V8cNot        Wpre
281270080307     c     digits        check     v8cnot:3      wy
281280021119      * prefisso "FD" o "FM possibile solo per bolle FedEx
281290080307      * (se è seguito da 12 cifre)
281300021119     c                   If        (Wpre = 'FD' or Wpre = 'FM')
281310021119     c                              and A_§OgNtw <> 'FED' and
281320021119     c                                   VidDpd <> 'F'
281330080307     c                              and wy=15
281340021119     c                   Z-Add     Nr8           V8cNbr
281350021119     c                   Eval      *In90 = *On
281360021119     c                   Eval      *In61 = *On
281370021119     c                   Movel     Err(261)      W08Msg
281380021119     c                   Update    Ls01s08
281390021119     c                   GoTo      EndS08
281400021119     c                   EndIf
281410021119      * solo per bolle FedEx
281420021119If  2c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED')
281430021119     c                              and ix > 1
281440021119      * immesso prefisso "FM" o "FD"
281450021119      * tutti i segnacolli devono avere lo stesso prefisso
281460021119If  3c                   If        (Wpre = 'FD' or Wpre = 'FM')
281470021119     c     Wpre          Lookup    Prefisso                               30
281480021119      * Deve essere lo stesso prefisso già inserito
281490021119If  4c                   If        Not *In30
281500021119     c                   Z-Add     Nr8           V8cNbr
281510021119     c                   Eval      *In90 = *On
281520021119     c                   Eval      *In61 = *On
281530021119     c                   Movel     Err(260)      W08Msg
281540021119     c                   Update    Ls01s08
281550021119     c                   GoTo      EndS08
281560021119    4c                   EndIf
281570021119   x3c                   Else
281580021119      * immesso altro prefisso
281590021119      * non devono essere stati inseriti prefissi "FD" o "FM"
281600021119     c     'FD'          Lookup    Prefisso                               30
281610021119If  4c                   If        *In30
281620021119     c                   Z-Add     Nr8           V8cNbr
281630021119     c                   Eval      *In90 = *On
281640021119     c                   Eval      *In61 = *On
281650021119     c                   Movel     Err(260)      W08Msg
281660021119     c                   Update    Ls01s08
281670021119     c                   GoTo      EndS08
281680021119    4c                   EndIf
281690021119     c     'FM'          Lookup    Prefisso                               30
281700021119If  4c                   If        *In30
281710021119     c                   Z-Add     Nr8           V8cNbr
281720021119     c                   Eval      *In90 = *On
281730021119     c                   Eval      *In61 = *On
281740021119     c                   Movel     Err(260)      W08Msg
281750021119     c                   Update    Ls01s08
281760021119     c                   GoTo      EndS08
281770021119    4c                   EndIf
281780021119    3c                   EndIf
281790021119    2c                   EndIf
281800020308     c* Richiamo routine per controllare che cod. chi sono non sia
281810020308     c* doppio su fisgn e su blp (se segnacollo euroexpress)
281820020308     c                   eval      w8hcol = v8hcol
281830020308     c                   eval      w8cnot = v8cnot
281840020308     c                   eval      wnopos = ' '
281850020308     c                   exsr      ctrchidop
281860020308     c   90              goto      ends08
281870020308     C* SE NON C'È ERRORE MEMORIZZO IN SCHIERA
281880020308     C                   ADD       1             IX
281890020308     C                   MOVE      V8CNOT        CHI(IX)
281900020308     C                   Z-ADD     NR8           POS(IX)
281910021119      * Mi carico un Sk con solo il prefisso dei chi sono
281920021119     c                   Movel     Chi(ix)       Prefisso(ix)
281930000904   1AC                   ENDIF
281940000921     C                   UPDATE    LS01S08
281950000830     C                   ADD       1             NR8
281960000830     C  N90NR8           CHAIN     LS01S08                            31
281970000831    1C                   ENDDO
281980000911     C   31              SUB       1             NR8
281990000911    0C                   ENDIF
282000000907     C     IX            IFEQ      *ZEROS
282010000905     C                   SETON                                        90
282020000911     C     WC01FG        IFEQ      'C'
282030000905     C                   MOVEL     ERR(152)      W08MSG
282040000911     C                   ELSE
282050000911     C                   MOVEA     ERR(152)      K78
282060000911     C                   MOVEA     *BLANKS       K78(27)
282070000911     C                   MOVEA     K78           W08MSG
282080000911     C                   ENDIF
282090000911     C                   GOTO      ENDS08
282100000905     C                   ENDIF
282110000907     C* Richiamo pgm controllo Cod."CHI SONO"
282120010306     C* Se inseriti solo 2 codici E NUMERO COLLI A VIDEO > DI 2
282130000918     C* si potrebbe trattare di un dal/al
282140000907     C* e quindi richiamo pgm una volta sola passando entrambi i codici
282150000907    1C     IX            IFEQ      2
282160010306     C     V1CNCL        ANDGT     2
282170000907     C                   CLEAR                   DSLSZ1
282180000907     C                   MOVEL     'C'           IZ1MOD
282190000911     C                   MOVEL     WCTM          IZ1CTM
282200000907     C                   Z-ADD     V8CKSC        IZ1CCM
282210000907     C     §1BF12        IFEQ      'B'
282220000907     C                   Z-ADD     §LPNRS        IZ1NRS
282230000907     C                   ENDIF
282240000907     C                   MOVEL     CHI(1)        IZ1CH1
282250000907     C                   MOVEL     CHI(2)        IZ1CH2
282260000907     C                   CALL      'FNLSZ1R'
282270010402     C                   PARM                    KPJBA
282280000907     C                   PARM                    DSLSZ1
282290000907     C                   PARM                    DS1B
282300000907    2C     OZ1ERR        IFNE      ' '
282310000907    3C     OZ1ECH        IFEQ      '1'
282320000907     C                   Z-ADD     POS(1)        V8CNBR
282330000907   X3C                   ELSE
282340000907     C                   Z-ADD     POS(2)        V8CNBR
282350000907    3C                   ENDIF
282360000918     C     V8CNBR        CHAIN     LS01S08                            31
282370000907     C                   SETON                                        9061
282380000911     C     WC01FG        IFEQ      'C'
282390000907     C                   MOVEL     ERR(208)      W08MSG
282400000911     C                   ELSE
282410000911     C                   MOVEA     ERR(208)      K78
282420000911     C                   MOVEA     *BLANKS       K78(45)
282430000911     C                   MOVEA     K78           W08MSG
282440000911     C                   ENDIF
282450000907     C                   UPDATE    LS01S08
282460000911     C                   GOTO      ENDS08
282470000908     C                   ELSE
282480000908     C* SE NO ERRORE MEMORIZZO IL NUMERO DEI COLLI
282490000908     C                   Z-ADD     OZ1NCL        IX
282500020308    3c     oz1ncl        ifgt      2
282510020308     c                   movel     dslsz1        sav_dslsz1
282520020308     c* se numero dei colli > 2 si tratta di un dal/al
282530020308     c* devo quindi esplodere i codici per controllare che anche
282540020308     c* quelli all'interno del range non siano già presenti su fisgn
282550020308    4C     OZ1MAX        IFEQ      '2'
282560020308     C                   MOVEL     IZ1CH1        CHIDAL
282570020308     C                   MOVEL     IZ1CH2        CHIAL
282580020308   x4C                   ELSE
282590020308     C                   MOVEL     IZ1CH2        CHIDAL
282600020308     C                   MOVEL     IZ1CH1        CHIAL
282610020308    4C                   ENDIF
282620030214      * Prima di esplodere (per evitare giri inutili) controllo che il
282630030214      * n. dei cod. CHI SONO coincida con il n. dei colli immesso in
282640030214      * prima videata
282650030214If  4c                   If        Ix <> V1cNcl
282660030214     c                   Eval      *In90 = *On
282670030214If  5c                   If        Wc01Fg = 'C'
282680030214     c                   Eval      w08msg = Err(154)
282690030214   x5c                   Else
282700030214     c                   Movea     Err(154)      K78
282710030214     c                   Movea     *Blanks       K78(54)
282720030214     c                   Movea     K78           w08msg
282730030214    5c                   EndIf
282740030214     c                   GoTo      EndS08
282750030214    4c                   EndIf
282760020308    4C     CHIDAL        DOWNE     CHIAL
282770020308     C                   CLEAR                   DSLSZ1
282780020308     C                   MOVEL     'E'           IZ1MOD
282790020308     C                   MOVEL     CHIDAL        IZ1CH1
282800020308     C                   Z-ADD     V8CKSC        IZ1CCM
282810020308     C                   MOVEL     WCTM          IZ1CTM
282820020308     C     §1BF12        IFEQ      'B'
282830020308     C                   Z-ADD     §LPNRS        IZ1NRS
282840020308     C                   ENDIF
282850020308     C                   CALL      'FNLSZ1R'
282860020308     C                   PARM                    KPJBA
282870020308     C                   PARM                    DSLSZ1
282880020308     C                   PARM                    DS1B
282890020308    5C     OZ1CHI        IFNE      CHIAL
282900020308     c                   clear                   w8hcol
282910020308     c                   movel     '1'           wnopos
282920020308     c                   eval      w8cnot = oz1chi
282930020308     c                   exsr      ctrchidop
282940020308     c   90              movel     sav_dslsz1    dslsz1
282950020308     c   90              goto      ends08
282960020308    5c                   endif
282970020308     C                   MOVEL     OZ1CHI        CHIDAL
282980020308    4C                   ENDDO
282990020308     c                   movel     sav_dslsz1    dslsz1
283000020308    3c                   endif
283010000907    2C                   ENDIF
283020000907   X1C                   ELSE
283030010306     C* Se codici inseriti diverso da 2 O NUMERO COLLI <= 2
283040000918     C* li controllo una alla volta
283050001031     C                   Z-ADD     1             II                4 0
283060000907    2C     II            DOWLE     IX
283070000907     C                   CLEAR                   DSLSZ1
283080000907     C                   MOVEL     'C'           IZ1MOD
283090000911     C                   MOVEL     WCTM          IZ1CTM
283100000907     C                   Z-ADD     V8CKSC        IZ1CCM
283110000907     C     §1BF12        IFEQ      'B'
283120000907     C                   Z-ADD     §LPNRS        IZ1NRS
283130000907     C                   ENDIF
283140000907     C                   MOVEL     CHI(II)       IZ1CH1
283150000907     C                   CALL      'FNLSZ1R'
283160010402     C                   PARM                    KPJBA
283170000907     C                   PARM                    DSLSZ1
283180000907     C                   PARM                    DS1B
283190000907    3C     OZ1ERR        IFNE      ' '
283200000907     C                   Z-ADD     POS(II)       V8CNBR
283210000918     C     V8CNBR        CHAIN     LS01S08                            31
283220000907     C                   SETON                                        9061
283230000911     C     WC01FG        IFEQ      'C'
283240000907     C                   MOVEL     ERR(208)      W08MSG
283250000911     C                   ELSE
283260000911     C                   MOVEA     ERR(208)      K78
283270000911     C                   MOVEA     *BLANKS       K78(45)
283280000911     C                   MOVEA     K78           W08MSG
283290000911     C                   ENDIF
283300000907     C                   UPDATE    LS01S08
283310000911     C                   GOTO      ENDS08
283320000907    3C                   ENDIF
283330000911     C                   ADD       1             II
283340000907    2C                   ENDDO
283350000907    1C                   ENDIF
283360000908     c* Controllo che numero cod.chi sono corrisponda con numero colli
283370000908     c* in prima videata
283380000908     C     IX            IFNE      V1CNCL
283390000908     C                   SETON                                        90
283400000911     C     WC01FG        IFEQ      'C'
283410000908     C                   MOVEL     ERR(154)      W08MSG
283420000911     C                   ELSE
283430000911     C                   MOVEA     ERR(154)      K78
283440000911     C                   MOVEA     *BLANKS       K78(54)
283450000911     C                   MOVEA     K78           W08MSG
283460000911     C                   ENDIF
283470000908     C                   ENDIF
283480000911     C     ENDS08        TAG
283490000911     C                   MOVE      *BLANKS       WC01FG
283500000911     C                   ENDSR
283510020308     C**************************************************************************
283520020308     C*   Controllo se cod. chi sono già esistente
283530020308     C**************************************************************************
283540020308     C     CTRCHIDOP     BEGSR
283550020308     C* Se segnac. EUROEX controllo che non sia doppio in altra bolla
283560040505    1c     §ogntw        ifeq      'EEX'
283570020308     C     W8HCOL        ANDEQ     *ZEROS
283580020308     C                   MOVEL     'E'           WTRC
283590170131     C     KARS2         SETLL     FIARS03L                               31
283600020308    2C     *IN31         IFEQ      *ON
283610020308    3c     wnopos        ifeq      *blanks
283620020308     C                   Z-ADD     NR8           V8CNBR
283630020308     c                   seton                                        61
283640020308    3c                   endif
283650020308     C                   SETON                                        90
283660020308     C                   MOVEA     ERR(155)      K78
283670020308     C                   MOVEL     w8CNOT        W030A            30
283680020308     C                   MOVEA     W030A         K78(18)
283690020308     C                   MOVEA     K78           W08MSG
283700020308    3c     wnopos        ifeq      *blanks
283710020308     C                   UPDATE    LS01S08
283720020308    3c                   endif
283730020308     C                   GOTO      ENDCDOP
283740020308    2C                   ENDIF
283750020308    1C                   ENDIF
283760020308     C* MSG FORZABILE SE CHI SONO GIA' PRESENTE SU FISGN
283770020308     C* (SOLO SE RECORD E' DI NUOVA IMMISSIONE)
283780020308     C* 02/05/01: RENDO ERRORE BLOCCANTE SU RICHIESTA DELLA LORENA
283790020308    1C     W8HCOL        IFEQ      *ZEROS
283800020308     C     KSGN88        CHAIN(N)  FISGN01L                           31
283810020308    2C     *IN31         IFEQ      *OFF
283820020308     C     SGNATB        ANDNE     '*'
283830020308    3c     wnopos        ifeq      *blanks
283840020308     C                   Z-ADD     NR8           V8CNBR
283850020308     c                   seton                                        61
283860020308    3c                   endif
283870020308     C                   SETON                                        90
283880020308     c                   eval      w08msg = %trim(err(209)) + ' '
283890020308     c                             + %trim(w8cnot)
283900020308     c                             + ' presente in altra bolla'
283910020308    3c     wnopos        ifeq      *blanks
283920020308     C                   UPDATE    LS01S08
283930020308    3c                   endif
283940020308     C                   GOTO      ENDCDOP
283950020308    2C                   ENDIF
283960020308    1C                   ENDIF
283970020308     c     ENDCDOP       endsr
283980010504     C**************************************************************************
283990010504     C*   ELIMINAZIONE CHI SONO ANNULLATI DA SUBFILE
284000010504     C**************************************************************************
284010010504     C     CTRS8A        BEGSR
284020010504    0C     *IN78         IFEQ      *ON
284030010504     C                   Z-ADD     1             NR8
284040010504     C     NR8           CHAIN     LS01S08                            31
284050010504    1C     *IN31         DOWEQ     *OFF
284060010504     C* SE RECORD ANNULLATO DEVO TOGLIERLO DA CH2
284070010504     C     V8CSCE        IFEQ      'A'
284080010504     C                   Z-ADD     1             WK                3 0
284090010504     C     V8CNOT        LOOKUP    CH2(WK)                                31
284100010504     C   31              MOVE      *BLANKS       CH2(WK)
284110010504     C                   UPDATE    LS01S08
284120010504     C                   ENDIF
284130010504     C                   ADD       1             NR8
284140010504     C  N90NR8           CHAIN     LS01S08                            31
284150010504    1C                   ENDDO
284160010504     C   31              SUB       1             NR8
284170010504    0C                   ENDIF
284180010504     C                   ENDSR
284190000912     C**************************************************************************
284200000912     C*   AGGIORNAMENTO FILE FISGN00F
284210000912     C**************************************************************************
284220000912     C     UPDSGN        BEGSR
284230000921     C* QUESTO CAMPO NON CREDO CHE SIA UTILIZZATO ADOGNI MODI MI SEMBRA
284240000921     C* GIUSTO IN QUESTO CASO ABBLENCARLO
284250000921     C     SGNATB        IFEQ      '*'
284260000921     C                   CLEAR                   SGNSQU
284270000921     C                   ENDIF
284280000921     C*
284290000919     C                   CLEAR                   SGNATB
284300000921     C                   Z-ADD     §3ISEA        SGNSEA
284310000921     C                   MOVEL     'S'           SGNST1
284320160226     c* disk "C" no dpd
284330160226     c                   if        (§1bf12<>'N' and wexdpd<>'S' and *in79=*off)
284340160226     c                             or
284350160226     c* disk "C" export dpd con numero parcel automatico (da §1bf13 o instradame
284360160226     c* nto forzato a dpd oppure numero parcel lungo 12 che uso come disk "C" ma
284370160226     c* assegno parcel dpd automatico
284380160226     c                             (§1bf12<>'N' and wexdpd='S' and
284390160226     c                              (§1bf13='A' or w_adpd='S' or wparcel='12'))
284400160226     c                             or
284410160226     c* Disk "B" che diventa "C" export DPD anche se parcel non automatico
284420160226     c                             (§1bf12='B' and wexdpd='S')
284430090624      *
284440000925     C                   Z-ADD     V8HST2        SGNST2
284450000925     C                   ENDIF
284460000921     C                   MOVE      '0'           SGNFL1
284470000912     C     BLPCCM        IFGT      0
284480000912     C                   MOVEL     BLPCCM        SGNKSC
284490000912     C                   ELSE
284500000912     C                   MOVEL     BLPKSC        SGNKSC
284510000912     C                   ENDIF
284520000921     C                   Z-ADD     BLPLNP        SGNLNP
284530000921     C                   Z-ADD     BLPNSP        SGNNSP
284540010116     C                   CLEAR                   SGNT6A
284550010116     C                   CLEAR                   SGNT6B
284560010116     C                   CLEAR                   SGNT6C
284570010116     C                   CLEAR                   SGNT6D
284580010116     C                   CLEAR                   SGNT6E
284590010116     C                   CLEAR                   SGNT6F
284600080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
284610000922     C                   CLEAR                   SGNRST
284620001005     C     WSGNR         IFEQ      'B'
284630001005     C                   UPDATE    FISGN005
284640001005     C                   ELSE
284650000912     C                   UPDATE    FISGN000
284660150701     c                   exsr      sr_CalSgn
284670001005     C                   ENDIF
284680000912     C                   ENDSR
284690000929     C**************************************************************************
284700000929     C*   SCRITTURA     FILE FISGN00F
284710000929     C**************************************************************************
284720000929     C     WRTSGN        BEGSR
284730000929     C                   CLEAR                   SGNATB
284740000929     C                   MOVEL(P)  V8CNOT        SGNWHO
284750000929     C                   Z-ADD     §3ISEA        SGNSEA
284760000929     C                   MOVEL     'S'           SGNST1
284770001002     C     WSGNR         IFEQ      *BLANKS
284780000929     C                   CLEAR                   SGNST2
284790001002     C                   ELSE
284800001002     C                   Z-ADD     1             SGNST2
284810010405     C* SGNFL2 = N SIGNIFICA CHE SI TRATTA DI FISGN SCRITTO PER SOLA
284820010405     C* RISTAMPA --> NON E' UN REALE DISK C
284830010405     C                   MOVEL     'N'           SGNFL2
284840001002     C                   ENDIF
284850000929     C                   MOVE      '0'           SGNFL1
284860000929     C                   MOVEL     BLPLNP        SGNLNP
284870000929     C                   MOVEL     BLPNSP        SGNNSP
284880000929     C     BLPCCM        IFGT      0
284890000929     C                   MOVEL     BLPCCM        SGNKSC
284900000929     C                   ELSE
284910000929     C                   MOVEL     BLPKSC        SGNKSC
284920000929    4C                   ENDIF
284930010116     C                   CLEAR                   SGNT6A
284940010116     C                   CLEAR                   SGNT6B
284950010116     C                   CLEAR                   SGNT6C
284960010116     C                   CLEAR                   SGNT6D
284970010116     C                   CLEAR                   SGNT6E
284980010116     C                   CLEAR                   SGNT6F
284990080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
285000000929     C                   CLEAR                   SGNRST
285010010116     C                   Z-ADD     COMTFP        SGNTNP
285020001005     C     WSGNR         IFEQ      'B'
285030001005     C                   WRITE     FISGN005
285040001005     C                   ELSE
285050001005     C                   WRITE     FISGN000
285060001005     C                   ENDIF
285070001005     C*
285080000929     C                   ENDSR
285090010209     C**************************************************************************
285100010209     C*   VERIFICO SE ATTIVATA PROCEDURA O.R.M.
285110011121     C**************************************************************************
285120010209     C     ATTORM        BEGSR
285130010209     C                   MOVE      *BLANKS       WORM              1
285140010220     C   12
285150010220     CAN 15VIDPOE        IFGT      *ZEROS
285160010209     C                   MOVEL     'S'           WORM
285170010209     C                   ENDIF
285180010305     C     §LPFPR        IFNE      'O'
285190010215     C     *IN12         IFEQ      *OFF
285200010215     C     *IN15         OREQ      *OFF
285210010219     C                   MOVE      WLNPO         W0030
285220010215     C     W0030         CHAIN     AZORG01L      UNIORG               30
285230010209     C  N30              MOVEL     ORGDE8        OG148
285240010209     C   30              CLEAR                   OG148
285250060926     c                   eval      §ogorm='S'
285260010209     C     §OGORM        IFEQ      'S'
285270010209     C                   MOVEL     'S'           WORM
285280010209     C                   ENDIF
285290010215     C                   ENDIF
285300010305     C                   ELSE
285310010301     C                   MOVEL     'S'           WORM
285320010301     C                   ENDIF
285330010209     C* IMPOSTO INDICATORI PER NON VISUALIZZARE KEY ORM SE P.O. NON
285340010209     C* ABILITATO
285350010209     C     WORM          IFEQ      *BLANKS
285360010223     C                   SETOFF                                       37
285370010209     C                   MOVEL     NDPR          ATRPOE
285380010215     C                   MOVEL     NDPR          ATRORM
285390010219     C                   MOVEL     NODI          ATRDOR
285400010209     C                   CLEAR                   VIDPOE
285410010209     C                   CLEAR                   VIDNOR
285420010209     C                   CLEAR                   VIDNRV
285430010209     C* Campi della videata di personalizzazione
285440010209     C                   MOVEL     NDPR          AT0POE
285450010215     C                   MOVEL     NDPR          AT0ORM
285460010219     C                   MOVEL     NODI          AT0DOR
285470010209     C                   CLEAR                   V0CPOE
285480010209     C                   CLEAR                   V0CNOR
285490010209     C                   CLEAR                   V0CNRV
285500010222     C* Questa routine viene richiamata anche in immissione bolle
285510010222     C* tutte le volte che variano la linea di partenza.
285520010222     C* Se si passa da lnp attivata a proc. ORM ad una NON attivata
285530010222     C* bisogna spegnere indicatore 06 di posiz. cursore su N. ORM
285540010222     C* se è acceso e al suo posto bisogna accendere lo 07
285550010222     C  N12*IN06         IFEQ      *ON
285560010222     C                   SETOFF                                       06
285570010222     C                   SETON                                        07
285580010222     C                   ENDIF
285590010209     C                   ELSE
285600010209     C* PROCEDURA ORM ATTIVA
285610010409     C* Chaino tabella DFT per prendere il massimo peso in KG per la
285620010409     C* richiesta note obbligatoria
285630010409     C* Provo prima con key = p.o. ritiro
285640010409     c* Se record non trovato chaino record 999
285650010409     C                   CLEAR                   WTRDFT
285660010409     C                   CLEAR                   DSBS02
285670010409     C                   MOVEL     'C'           T02MOD
285680010409     C                   MOVEL     KNSIF         T02SIF
285690010409     C                   MOVEL     'DFT'         T02COD
285700010409     C                   MOVEL(P)  WLNPO         T02KE1
285710010409     C     WTRDFT        DOWEQ     *BLANKS
285720010409      *
285730010409     C                   CALL      'TIBS02R'
285740010409     C                   PARM                    KPJBA
285750010409     C                   PARM                    DSBS02
285760010409      *
285770010409     C     T02ERR        IFEQ      *BLANKS
285780010409     C     T02KE1        OREQ      '999'
285790010409     C                   MOVEL     '1'           WTRDFT            1
285800010409     C     T02ERR        IFEQ      *BLANKS
285810010409     C                   MOVEL     T02UNI        DDFT
285820010409     C                   ELSE
285830010409     C                   CLEAR                   DDFT
285840010409     C                   ENDIF
285850010409     C                   ELSE
285860010409     C                   MOVEL     '999'         T02KE1
285870010409     C                   CLEAR                   T02ERR
285880010409     C                   ENDIF
285890010409     C                   ENDDO
285900010409     C*
285910010209     C                   CLEAR                   ATRPOE
285920010215     C                   CLEAR                   ATRORM
285930010219     C                   CLEAR                   ATRDOR
285940010209     C* Campi della videata di personalizzazione
285950010209     C                   CLEAR                   AT0POE
285960010215     C                   CLEAR                   AT0ORM
285970010219     C                   CLEAR                   AT0DOR
285980010209     C* IN IMMISSIONE PREPAGATI  MIEI KEY ORM = ND + PR
285990010220     C     PARTCH        IFEQ      'P'
286000010220     C                   MOVEL     NDPR          ATRPOE
286010010220     C                   MOVEL     NDPR          ATRORM
286020010220     C                   MOVEL     NODI          ATRDOR
286030010220     C                   MOVEL     NDPR          AT0POE
286040010220     C                   MOVEL     NDPR          AT0ORM
286050010220     C                   MOVEL     NODI          AT0DOR
286060010220     C                   ENDIF
286070010209     C* IN IMMISSIONE PREPAG.NON MIEI KEY ORM =      PR
286080010301     C     §LPFPR        IFEQ      'O'
286090010209     C* IN CONFERMA                   KEY ORM =      PR
286100010301     C     *IN12         OREQ      *ON
286110010301     C     *IN15         ANDEQ     *ON
286120010301     C                   MOVEL     PROT          ATRPOE
286130010301     C                   MOVEL     PROT          ATRORM
286140010301     C                   ENDIF
286150010213     C*
286160010213     C* INIZIALIZZO ANCHE CAMPI DI CMODO CHE MI SERVONO NELLA ROUTINE
286170010213     C* DEI CONTROLLI SE PROCEDURA ORM ATTIVATA
286180010220     C     *IN12         IFEQ      *OFF
286190010301     C     §LPFPR        ANDNE     'O'
286200010213     C                   CLEAR                   PREDRT
286210010214     C                   CLEAR                   PREPDR
286220010214     C                   CLEAR                   PREFPP
286230010214     C                   CLEAR                   PRECCM
286240010214     C                   CLEAR                   PREFFD
286250010222     C* Questa routine viene richiamata anche in immissione bolle
286260010222     C* tutte le volte che variano la linea di partenza.
286270010222     C* Se si passa da lnp non attivata a proc. ORM ad una attivata
286280010222     C* bisogna spegnere indicatore 07 di posiz. cursore su cod mitt
286290010222     C* se è acceso e al suo posto bisogna accendere lo 06
286300010222     C     *IN07         IFEQ      *ON
286310010222     C                   SETOFF                                       07
286320010222     C                   SETON                                        06
286330010222     C                   ENDIF
286340010220     C                   ENDIF
286350010215     C                   CLEAR                   WORMMD
286360010220     C                   CLEAR                   WPRIMV
286370040319     c                   Eval      wmodorm = *Off
286380010222     C* SE SONO IN MANUTENZIONE DEVO POSIZIONARE IL CURSORE SUL
286390010222     C* NUMERO ORM
286400010222     C     *IN12         IFEQ      *ON
286410010222     C     *IN15         ANDEQ     *OFF
286420040323      * ma se bolla di recupero o bolla 'FW' devo proteggere il n. ORM
286430040323if  3c                   If        §3arbl = 'R' or vidcbo = 'FW'
286440040323     c                   Movel     prot          atrpoe
286450040323     c                   Movel     prot          atrorm
286460040324     c                   Eval      *In06 = *Off
286470040323     c                   GoTo      Endattorm
286480040323e   3c                   EndIf
286490040323      * o se bolla legata devo proteggere il n. ORM
286500040323     c     kBlp3         Setll     Fnlbl01l
286510040323if  3c                   If        %Equal(Fnlbl01l)
286520040323     c                   Movel     prot          atrpoe
286530040323     c                   Movel     prot          atrorm
286540040324     c                   Eval      *In06 = *Off
286550040323     c                   GoTo      Endattorm
286560040323    3c                   EndIf
286570010222     C                   SETOFF                                       07
286580010222     C                   SETON                                        06
286590010222     C                   ENDIF
286600010209     C                   ENDIF
286610011121     C*
286620040323     C     endattorm     ENDSR
286630010228     C**************************************************************************
286640010228     C*   RIEMPIMENTO CAMPI DI PASSAGGIO A PGM FIOR05R
286650010228     C**************************************************************************
286660010228     C     RIEO05        BEGSR
286670010228     C                   CLEAR                   DSOR05
286680010228     C*
286690010228     C                   MOVEL     '2'           §RMTLA
286700010228     C                   MOVEL     'B'           §RMFPR
286710010228     C                   Z-ADD     VIDLNP        §RMPOE
286720010228     C                   Z-ADD     VIDLNP        §RMPOR
286730010228     C                   MOVEL     'P'           §RMTOR
286740010228     C                   MOVEL     'P'           §RMTCO
286750010305     C                   Z-ADD     VIDCCM        W0070             7 0
286760010228     C     VIDFLC        IFEQ      0
286770010228     C                   MOVEL     VIDLNP        W0070
286780010228     C                   ELSE
286790010228     C                   MOVEL     VIDFLC        W0070
286800010228     C                   ENDIF
286810010228     C                   CLEAR                   §RMCRA
286820010228     C     VIDCCM        IFNE      8888
286830010228     C                   MOVEL     W0070         §RMCRA
286840010228     C                   ENDIF
286850010228     C                   MOVEL     VIDRSM        §RMRSR
286860010228     C                   MOVEL     VIDINM        §RMINR
286870010228     C                   MOVEL     VIDCAM        §RMCAR
286880010228     C                   MOVEL     VIDLOM        §RMLOR
286890010228     C                   MOVEL     VIDPRM        §RMPRR
286900010228     C                   MOVEL     VIDNZM        §RMNAR
286910010228     C                   MOVEL     VIDRSD        §RMRSC
286920010228     C                   MOVEL     VIDIND        §RMINC
286930010228     C                   MOVEL     VIDCAD        §RMCAC
286940010228     C                   MOVEL     VIDLOD        §RMLOC
286950010228     C                   MOVEL     VIDPRD        §RMPRC
286960010228     C                   MOVEL     VIDNZD        §RMNAC
286970010228     C     VIDFFD        IFEQ      'N'
286980010228     C                   MOVEL     *BLANKS       §RMFFD
286990010228     C                   ELSE
287000010228     C                   MOVEL     VIDFFD        §RMFFD
287010010228     C                   ENDIF
287020010228     C                   MOVEL     VIDNAS        §RMNAM
287030010228     C                   Z-ADD     VIDNCL        §RMNCL
287040010228     C                   Z-ADD     VIDPKG        §RMPKG
287050010228     C                   Z-ADD     VIDVOL        §RMVLM
287060010228     C                   MOVEL     'M'           §RMPAG
287070010228     C                   MOVEL     VIDNT1        §RMNO1
287080010228     C                   MOVEL     VIDNT2        §RMNO2
287090010228     C                   MOVEL     VIDRMA        §RMRFA
287100160216     C                   z-add     comlna        §RMPOC
287110010228     C                   ENDSR
287120011212     C**************************************************************************
287130011212     C*   RICHIAMO PGM DI UTILITA' PER EDITARE CAMPO NUMERICO
287140011212     C**************************************************************************
287150011212     C     CALLXE        BEGSR
287160011212     C                   CLEAR                   DSEDIT
287170011212     C                   CLEAR                   W014A
287180011212     C                   MOVE      WNUMED        IEDNUM
287190011212     C                   Z-ADD     3             IEDNRD
287200011212     C                   MOVE      '4'           IEDEDT
287210011212     C                   Z-ADD     14            IEDLEN
287220011212     C                   CALL      'XEDIT'
287230011212     C                   PARM                    DSEDIT
287240011212     C     OEDFLG        IFEQ      *OFF
287250011212     C                   MOVEL     OEDNUM        W014A            14
287260011212     C                   ENDIF
287270011212     C                   ENDSR
287280020212     C**************************************************************************
287290020212     C*   Calcolo check digit AWB FEDEX
287300020212     C**************************************************************************
287310020212     C     CHKDGF        BEGSR
287320020212      * Il check digit del codice a barre di FedEx va colcolato moltiplicando
287330020212      * il numero del codice a barre (partendo dall'undicesimo e andando a
287340020212      * a ritroso) per un valore alternato (1 - 3 - 7) e sommati tra loro, il
287350020212      * totale va diviso per 11 e il resto è i check digit
287360020212      * se il resto è 10 o 0 il check digit deve essere 0
287370020212      * Esempio:
287380020212      * codice a barre 0 1  2 3 4  5  6 7  8  9 8
287390020212      * valore         3 1  7 3 1  7  3 1  7  3 1
287400020212      * totale         0 1 14 9 4 35 18 7 56 27 8 = 179
287410020212      * check digit    179 / 11 = 16 resto 3
287420020212     c                   move      w0012a        fedexbrc
287430020214     c                   clear                   totale
287440020212
287450020212      * Carico 1 - 3 - 7 in una schiera di comodo 'base'
287460020212
287470020212     c                   eval      base(1) = 1
287480020212     c                   eval      base(2) = 3
287490020212     c                   eval      base(3) = 7
287500020212
287510020212     c                   eval      zw = 0
287520020212
287530020212      * parto dall'undicesimo numero
287540020212     c     11            do        11            xw
287550020212      * andando all'indietro il contatore arriva a 0 e devo uscire dal ciclo
287560020212     c                   if        xw = 0
287570020212     c                   leave
287580020212     c                   endif
287590020212     c                   eval      zw = zw + 1
287600020212     c                   eval      totale = totale + (fbrc(xw) * base(zw))
287610020212
287620020212     c                   if        zw = 3
287630020212     c                   eval      zw = 0
287640020212     c                   endif
287650020212      * torno indietro
287660020212     c                   enddo     -1
287670020212
287680020212     c     totale        div       11            intero
287690020212     c                   mvr                     restof
287700020212
287710020212     c                   if        restof = 0 or restof = 10
287720020212     c                   move      '0'           fchd
287730020212     c                   else
287740020212     c                   move      restof        fchd
287750020212     c                   endif
287760020212
287770020212     c                   move      fedexbrc      w0012a
287780020212     c                   ENDSR
287790040601     C**************************************************************************
287800040601     C*   Scrittura fiar8
287810040601     C**************************************************************************
287820040601     C     SR_fiar8      BEGSR
287830040601     c     kblc          setll     fivax01l
287840040601     c                   do        *hival
287850061010     c     kblc          reade(N)  fivax01l
287860040601     c                   if        %eof(fivax01l)
287870040601     c                   leave
287880040601     C                   endif
287890040601     c                   clear                   fiar8000
287900040601     c                   Eval      Ar8Aas = BlpAas
287910040601     c                   Eval      Ar8Lnp = BlpLnp
287920040601     c                   Eval      Ar8Nrs = BlpNrs
287930040601     c                   Eval      Ar8Nsp = BlpNsp
287940040601     c                   eval      ar8tmd = vaxtmd
287950040601     c                   eval      ar8prr = vaxprr
287960040601     c                   eval      ar8trk = vaxtrk
287970050913     c                   eval      ar8uni = %trimr(vaxdtt)
287980130924     c                   if        aggioAr8='S'
287990040601     c                   write     fiar8000
288000130924     c                   endif
288010130308     c                   eval      w_allx='S'
288020040601     c                   enddo
288030040601     c                   endsr
288040130304     C**************************************************************************
288050130304     C*   Scrittura fiar8 da fivat tipo record "P"
288060130304     C**************************************************************************
288070130304     C     SR_fiar8_vatp BEGSR
288080130304     c                   clear                   w_prr
288090130304     c                   clear                   w_pdfn
288100130304     C                   MOVEL     'P'           WTRC
288110130304     c     kvat          setll     fivat01l
288120130305    1c                   do        *hival
288130130304     c     kvat          reade(N)  fivat01l
288140130305    2c                   if        %eof(fivat01l)
288150130304     c                   leave
288160130305    2C                   endif
288170130304     c                   movel(P)  vatnot        dvatp
288180130305    2c                   if        §vatppdfn=*blanks
288190130304     c                             or §vatppdfn=w_pdfn
288200130304     C                   iter
288210130305    2c                   endif
288220130304     c                   movel     §vatppdfn     w_pdfn
288230130304     c                   eval      w_prr+=1
288240130304     c                   clear                   fiar8000
288250130304     c                   Eval      Ar8Aas = BlpAas
288260130304     c                   Eval      Ar8Lnp = BlpLnp
288270130304     c                   Eval      Ar8Nrs = BlpNrs
288280130304     c                   Eval      Ar8Nsp = BlpNsp
288290130304     c                   eval      ar8tmd = '§PDF'
288300130304     c                   eval      ar8prr = w_prr
288310130304     c                   clear                   dar8§pdf
288320130304     c                   eval      §AR8PIDZ=§VATPIDZ
288330130306     c                   eval      §AR8PPDFP=§clipdfp
288340130306     c                   eval      §AR8PPDFn=§VATPPDFN
288350130311     c* se non prevista la stampa imposto a "N" il flag per il trattamento
288360130311     c* dell'allegato (su richiesta di FG)
288370130315     c                   if        %subst(§ar8pidz:1:1)<>'1'
288380130311     c                   eval      §ar8ptrt='N'
288390130315     c                   endif
288400130408     c* se non prevista la mail   imposto a "N" il flag per invio email
288410130408     c                   if        %subst(§ar8pidz:2:1)<>'1'
288420130408     c                   eval      §ar8peml='N'
288430130408     c                   else
288440130408     c                   eval      w_allm='S'
288450130408     c                   endif
288460130304     c                   eval      ar8uni = %trimr(dar8§pdf)
288470130924     c                   if        aggioAr8='S'
288480130304     c                   write     fiar8000
288490130924     c                   endif
288500130305    1c                   enddo
288510130304     c                   endsr
288520060308     C**************************************************************************
288530060308     C*   Richiamo lv85r per chiusura in LR
288540060308     C**************************************************************************
288550060308     C     CLS_lv85      BEGSR
288560060308     c*   ATTENZIONE: Il pgm fnlv85r serve per gestire richiesta, controllo
288570060308     c*               registrazione su data base del motivo variazione
288580060308     c*
288590060308     c*               Per ora il pgm di bollettazione richiama l'lv85
288600060308     c*               in due casi diversi di variazione bolla:
288610060308     c*               1)variazione totale imponibile di un prepagato (cvb TR
288620060308     c*               2)annullamento di un prepagato (cvb KM)
288630060308     c*
288640060308     c*               Quando fnlv85r viene richiamato in modalità "V"
288650060308     c*               (richiesta e controllo della motivazione)
288660060308     c*               viene passato tipo lancio (ilv85tla) = blanks
288670060308     c*               per chiudere in return.
288680060308     c*               In questo modo la window di richiesta motivazione
288690060308     c*               non viene pulita ed in caso di F12=Ritorno e successi-
288700060308     c*               va riconferma della variazione la window viene ripropo
288710060308     c*               sta con i dati precedentemente immessi.
288720060308     c*               Il pgm deve però essere chiuso con LR se la window
288730060308     c*               precedente era stata emessa a fronte di una causale
288740060308     c*               diversa dalla quale si era usciti con f12 anzichè
288750060308     c*               con f6=Conferma. Questa routine serve proprio per
288760060308     c*               chiudere con LR se cambiata la causale variazione
288770060308     c*               al fine di emettere la window pulita.
288780060308     c*
288790060308     c                   if        ilv85cvb <> *blanks and ilv85cvb <> wcvb
288800060308     c                   clear                   fnlv85ds
288810060308     c                   eval      ilv85tla = 'C'
288820060308     c                   movel     fnlv85ds      kpjbu
288830060308     c                   call      'FNLV85R'
288840060308     c                   parm                    kpjba
288850060308     c                   endif
288860060308     c                   endsr
288870060427     C**************************************************************************
288880060427     C*   Forzature per orm esteri con triangolazione
288890060427     C**************************************************************************
288900060427     C     sr_FOrmEst    BEGSR
288910060427      * Forzo che deve essere un porto franco
288920060427     c                   Eval      §OrPfb = 'F'
288930060427      * Flag di appoggio per portare l'ordinante nel mittente
288940060427      * e il mittente orm nel mittente originale
288950060427     c                   Eval      wforpf = '1'
288960060427if 1ac                   if        wnoccm = '1'
288970130212     c                   clear                   wnoccm
288980060427      * Ksc da ORM
288990060427if  2c                   If        OrmKsc > *Zeros
289000060427      * propongo il ksc dell'ORM
289010060427     c                   Move      OrmKsc        vidccm
289020060427     c                   Movel     OrmKsc        w0030
289030130212     c                   Z-add     w0030         vidflc
289040060427      * SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
289050060427      *  BOLLA --> ABILITA LA FILIALE CLIENTE
289060060427if  3C                   If        w0030 <> vidlnp
289070130212     c****               Z-add     w0030         vidflc
289080060427     c                   Seton                                        14
289090060427    3c                   EndIf
289100060427      * no Ksc da ORM
289110060427   x2c                   Else
289120060427      * propongo la ragione sociale dell'ordinante nella ricerca alfabetica
289130060427     c                   Movel     OrmRso        viddmt
289140060427     c                   clear                   vidccm
289150060427if  3c                   If        viddmt <> *Blanks
289160060427     c***                Seton                                        0138
289170060427     c                   Seton                                        01
289180060427    3c                   EndIf
289190060427    2c                   EndIf
289200060427   1ac                   endif
289210060427     c                   endsr
289220070403     C**************************************************************************
289230070403     C*   Aggiornamento/scrittura numero giro
289240070403     C**************************************************************************
289250070403     C     sr_FIARG      BEGSR
289260070404     c                   clear                   wupd              1
289270100323     c                   clear                   wFGI              1
289280100323     c                   clear                   wAggioARG
289290100323     c* Verifico se per il cliente mittente è presente una forzatura GIRO
289300100323     c*  nel file azfgi
289310100323     c                   eval      kksc=wksc
289320100323     c                   eval      klnp=blplnp
289330100323     c                   eval      klna=blplna
289340100323     c                   exsr      LeggiFGI
289350100323     c
289360100323    1c                   if        wfgi=*blanks
289370100323     c                   eval      klnp=999
289380100323     c                   exsr      LeggiFGI
289390100323    1c                   endif
289400100323     c
289410100323    1c                   select
289420070405     c* conferma bolla di reso
289430070405     c                   when      *in12='1' and *in15='1' and
289440070405     c                             vidfbr='S' and *in44='1'
289450070705     c*                  if        §lpcgi<>*blanks and
289460070705     c*                            vidrsd=savrsd and
289470070705     c*                            vidind=savind and
289480070705     c*                            vidprd=savprd and
289490070705     c*                            vidcad=savcad and
289500070705     c*                            vidlod=savlod and
289510070705     c*                            vidnzd=nzdini
289520100323    2c                   if        §lpcgi<>*blanks
289530070405     c                   eval      w_cgi=§lpcgi
289540070405     c                   exsr      ges_arg
289550100323    2c                   endif
289560100323
289570100323     c* Immissione oppure conferma bolla NON di reso
289580100323    1c                   when      *in12='0' or *in15='1'
289590160323     c*  Se Vedi pacco dpd imposto il giro forzato come da tabella
289600160323     c                   if        w_vediP='1'
289610160323     c                   eval      w_cgi=§NSDCGI
289620160323     c                   exsr      ges_arg
289630160323     c                   else
289640100323     c*  Se c'e' AZFGI --> vince sui destinatari
289650100323    2c                   if        wfgi='S'
289660100323     c                   eval      w_cgi=fgicgi
289670100323     c                   exsr      ges_arg
289680100323   x2c                   else
289690100323    3c                   if        ot0err=*blanks and ot0x1cgi<>*blanks
289700070924     c                             and comlna=ot0x1pog
289710070924     c                   eval      w_cgi=ot0x1cgi
289720070404     c                   exsr      ges_arg
289730160323     c                   endif
289740100323    3c                   endif
289750100323    2c                   endif
289760100323     c* Manutenzione bolla
289770160323     c*  Solo se non si tratta di VEDI PACCO
289780160324    1c                   when      *in12='1' and *in15='0' and W_vediP<>'1'
289790100323     c* Se modificato il mittente ed il nuovo ha il giro forzato --> vince
289800100323    2c                   if        wksc<>savmit  or
289810100323     c                             blplna<>lna_sav
289820100323     c                   clear                   wupd              1
289830100323     c     kblp3         chain     fiarg01l
289840100323    3c                   if        %found(fiarg01l)
289850100323     c                   eval      wupd='1'
289860100323    3c                   endif
289870100323     c
289880100323    3c                   if        wFGI='S'
289890160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
289900160129     c* la linea di arrivo
289910160129     c                   if        wupd=' '
289920160129     c                             or argcgi<>'DIR'
289930160129     c                             or blplna<>lna_sav
289940160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
289950160129    7c                   if        wupd='1' and argcgi='DIR'
289960160129     c                   exsr      sr_chiuDispoRA
289970160129    7c                   endif
289980100323     c                   eval      w_cgi=fgicgi
289990100323     c                   exsr      ges_arg
290000160129     c                   else
290010160129     c                   if        wupd='1'
290020160129     c                   unlock    fiarg01l
290030160129     c                   endif
290040160129     c                   endif
290050100323   x3c                   else
290060100323     c
290070100323     c* Se non ha il giro ed il vecchio ce lo aveva, cancello FIARG
290080100323     c*  e poi proseguo con gli altri controlli
290090100323     c
290100100323    4c                   if        %found(fiarg01l)
290110100323     c                   eval      klna=lna_sav
290120100323     c                   eval      kksc=savmit
290130100323     c                   eval      klnp=blplnp
290140100323     c                   exsr      LeggiFGI
290150100323     c
290160100323    5c                   if        wfgi=*blanks
290170100323     c                   eval      klnp=999
290180100323     c                   exsr      LeggiFGI
290190100323    5c                   endif
290200100323     c
290210100323    5c                   if        wfgi='S' and fgicgi=argcgi
290220100323     c                   delete    fiarg000
290230100323    5c                   endif
290240100323    4c                   endif
290250100323    3c                   endif
290260100323    2c                   endif
290270100323     c
290280100323    2c                   if        vidrsd<>savrsd or
290290070404     c                             blpind<>savind or
290300070404     c                             blpprd<>savprd or
290310070404     c                             blpcad<>savcad or
290320070404     c                             blplod<>savlod or
290330070404     c                             blpnzd<>savnzd or
290340100323     c                             blplna<>lna_sav or
290350100323     c                             wksc<>savmit
290360100323     c
290370100323     c* non Faccio nulla se ho già aggiornato FIARG col nuovo mittente o
290380100323     c*  nuova linea di arrivo
290390100323    3c                   if        WaggioARG=' '
290400100323     c
290410100323    4c                   if        ot0err=*blanks and
290420071010     c                             ot0x1cgi<>*blanks and comlna=ot0x1pog
290430070924     c                   eval      w_cgi=ot0x1cgi
290440100323     c                   clear                   wupd              1
290450070404     c     kblp3         chain     fiarg01l
290460100323    5c                   if        %found(fiarg01l)
290470070404     c                   eval      wupd='1'
290480100323    5c                   endif
290490160129
290500160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
290510160129     c* la linea di arrivo
290520160129     c                   if        wupd=' '
290530160129     c                             or argcgi<>'DIR'
290540160129     c                             or blplna<>lna_sav
290550160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
290560160129    7c                   if        wupd='1' and argcgi='DIR'
290570160129     c                   exsr      sr_chiuDispoRA
290580160129    7c                   endif
290590070404     c                   exsr      ges_arg
290600160129     c                   else
290610160129     c                   if        wupd='1'
290620160129     c                   unlock    fiarg01l
290630160129     c                   endif
290640160129     c                   endif
290650100323   x4c                   else
290660160129     c* Non posso cancellare a prescindere.
290670160129     c* Cancello solo se il giro non è "DIR" oppure se è cambiata la
290680160129     c* linea di arrivo
290690160129     c***  kblp3         delete(e) fiarg01l
290700160129     c     kblp3         chain     fiarg01l
290710160129    5c                   if        %found(fiarg01l)
290720160129    6c                   if        argcgi<>'DIR' or blplna<>lna_sav
290730160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
290740160129    7c                   if        argcgi='DIR'
290750160129     c                   exsr      sr_chiuDispoRA
290760160129    7c                   endif
290770160129     c                   delete    fiarg000
290780160129   x6c                   else
290790160129     c                   unlock    fiarg01l
290800160129    6c                   endif
290810160129    5c                   endif
290820100323    4c                   endif
290830100323    3c                   endif
290840100323    2c                   endif
290850100323    1c                   endsl
290860070403     c
290870070403     c                   endsr
290880070404     C**************************************************************************
290890070404     C*   Aggiornamento/scrittura numero giro
290900070404     C**************************************************************************
290910070404     C     ges_arg       BEGSR
290920100323     c                   clear                   WaggioARG         1
290930070404     c                   if        wupd=*blanks
290940070404     c                   clear                   fiarg000
290950070404     c                   z-add     blpaas        argaas
290960070404     c                   z-add     blplnp        arglnp
290970070404     c                   z-add     blpnrs        argnrs
290980070404     c                   z-add     blpnsp        argnsp
290990070404     c                   endif
291000070404     c                   z-add     blplna        arglna
291010070404     c* p.o. di consegna capofila della £6 del p.o. di arrivo
291020070404     c                   clear                   dslv55
291030070404     c                   eval      d55tpt = '6'
291040070404     c                   z-add     blplna        d55lin
291050070404     c                   z-add     blpdsp        d55drf
291060070404     c                   call      'FNLV55R'
291070070404     c                   parm                    dslv55
291080070404     c                   z-add     d55tfa        argpoc
291090070404     c                   movel     'M'           argtgi
291100070404     c                   movel     w_cgi         argcgi
291110070404     c                   if        wupd=*blanks
291120070404     c                   write     fiarg000
291130070404     c                   else
291140070404     c                   update    fiarg000
291150070404     c                   endif
291160100323     c
291170100323     c                   eval      wAggioARG='S'
291180070404     c                   endsr
291190100323     C**************************************************************************
291200100323     c* Lettura file forzatura giro di consegna
291210100323     C**************************************************************************
291220100323     c     LeggiFGI      BEGSR
291230100323     c     kfgi          setll     azfgi01l
291240100323     c     kfgi          reade     azfgi01l
291250100323     c
291260100323     c                   dow       not %eof(azfgi01l)
291270100323     c                   if        blpdsp>=fgidde and blpdsp<=fgidsc
291280100323     c                             and fgiatb=' '  and klna = fgipog
291290100323     c                   eval      wfgi='S'
291300100323     c                   leave
291310100323     c                   endif
291320100323     c
291330100323     c     kfgi          reade     azfgi01l
291340100323     c                   enddo
291350100323
291360100323     c                   ENDSR
291370160129     C**************************************************************************
291380160201     C*   Chiusura dispo di Dirottamento/Reso e R.A. relativa
291390160129     C**************************************************************************
291400160129     C     sr_chiuDispoRABEGSR
291410160201     c                   clear                   wfine
291420160201     c     kblp3         setll     tiidc01l
291430160201     c     kblp3         reade     tiidc01l
291440160129     c                   dow       not  %eof(tiidc01l) and Wfine=*blanks
291450160201     c                   if        idcfla<>' '
291460160129     c*  CHIUSURA NOTE R.A.
291470160129     c                   exsr      sr_noteRa
291480160129     c*  Aggiorno il record TIIDC
291490160129     c                   eval      IDCELAUTE=KNMUS
291500160201     c*****              eval      IDCELADATA=%int( %subst( %char( %dec( +
291510160201     c*****                        %timestamp() ) ) :1 :14 ) )
291520160201      /free
291530160201              IDCELADATA=%int( %subst( %char( %dec( %timestamp() ) )
291540160201                                 :1 :14 ) );
291550160201      /end-free
291560160129     c                   update    tiidc000
291570160129     c                   eval      wfine='1'
291580160129     c                   endif
291590160201     c     kblp3         reade     tiidc01l
291600160129     c                   enddo
291610160129     c                   endsr
291620160129     c**********************************************************************
291630160129     c* CHIUSURA  Note R.A.
291640160129     c**********************************************************************
291650160129     C     sr_noteRa     BEGSR
291660160129     c                   clear                   fidna7ds
291670160129     C                   EVAL      IDNA7ANT=IDCANT
291680160129     C                   EVAL      IDNA7NUT=IDCNUT
291690160129     C                   EVAL      IDNA7PDT=IDCPDT
291700160201     C                   EVAL      IDNA7PCT=simPOU
291710160129     C                   EVAL      IDNA7utc=knmus
291720160129     c***????            eval      IDNA7NOT=wnot
291730160129     c                   call      'FIDNA7R'
291740160129     c                   parm                    fidna7ds
291750160129     c
291760160129     C                   ENDSR
291770070604     C**************************************************************************
291780070604     C*   Aggiornamento dati per PDA
291790070604     C**************************************************************************
291800070604     C     Sr_pda        BEGSR
291810070604     c* verifico se già estratti orm per pda
291820080111     C****               CLEAR                   dsbs02
291830080111     c****               clear                   dpdo
291840080111     C****               MOVEL     'C'           T02MOD
291850080111     C****               MOVEL     KNSIF         T02SIF
291860080111     C****               MOVEL     'PDO'         T02COD
291870080111     c****               movel(P)  g_ormpor      t02ke1
291880080111     C****               CALL      'TIBS02R'
291890080111     C****               PARM                    KPJBA
291900080111     C****               PARM                    dsbs02
291910080111    2C****               IF        T02ERR = *BLANKS
291920080111     C****               MOVEL     T02uni        dpdo
291930080111    2C****               ENDIF
291940080111     c****               clear                   aggpda            1
291950080111    1c****               if        d§pdodata>0
291960080111    2c****               if        ormddc<> d§pdodata
291970070604     c     kfnorf        chain     fnorf01l
291980070604    3c                   if        %found(fnorf01l)
291990080221     c**!!!kfipdo        chain     fipdo01t
292000080111    4c****               if        not %found(fipdo01t)
292010080221    4c**!!!              if        %found(fipdo01t)
292020080111     c****               eval      aggpda='N'
292030080111    4c****               endif
292040080111    3c****               endif
292050080111    2c****               endif
292060080111    2c****               if        aggpda=' '
292070070604     c                   clear                   fior56ds
292080070604     c                   eval      or56tla = 'O'
292090070604     c                   eval      or56poe = ormpoe
292100070604     c                   eval      or56nsr = ormnsr
292110070604     c                   eval      or56nor = ormnor
292120070604     c                   eval      or56nrv = ormnrv
292130080111     c                   eval      or56fgs = orffgs
292140080111     c                   eval      or56ndcd = orfndc
292150080111     c                   eval      or56ndca = orfndc
292160080111     c                   eval      or56ddc = orfddc
292170140121     c                   eval      or56cmd  = 'V'
292180140121     c                   eval      or56var = 'I'
292190070604     c                   call      'FIOR56R'
292200070604     c                   parm                    kpjbu
292210070604     c                   parm                    fior56ds
292220070604     c* se effettuato scarico memorizzo di avvisare dell'avvenuto sca-
292230070604     c* rico a PDA
292240070604    3c                   if        or56err=*blanks
292250070604     c                   eval      wmsg_pda='S'
292260070606     c                   exsr      sr_dst
292270070606     c                   move      dstpdr        w02pdr_p
292280070604    3c                   endif
292290080221    2c**!!!              endif
292300070604    1c                   endif
292310070604     c                   endsr
292320071023     C**************************************************************************
292330071023     C*   Impostazione campo partita iva mittente
292340071023     C**************************************************************************
292350071023     C     Sr_wpiva      BEGSR
292360071023     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
292370071023     c                   select
292380071023     c* solo numeri
292390071023     c* "PRIVATO senza iso
292400071023     c     *in30         wheneq    *off
292410071023     c     wiso          andge     *zeros
292420071023     c     *in30         oreq      *on
292430071023     c     posiz         andlt     3
292440071023     c                   movel     wpiva         vidcpm
292450071023     c* iso + numeri
292460071023     c* iso + "PRIVATO"
292470071023     c     *in30         wheneq    *off
292480071023     c     posiz         orgt      2
292490071023     c                   movel     wpiva         vidpim
292500071023     c                   endsl
292510071023     c                   endsr
292520071218     C**************************************************************************
292530071218     C*   Reperimento dati tabella cli
292540071218     C**************************************************************************
292550071218     C     Sr_dcli       BEGSR
292560071218     C                   CLEAR                   dsbs02
292570071218     c                   clear                   dcli
292580071218     C                   MOVEL     'C'           T02MOD
292590071218     C                   MOVEL     KNSIF         T02SIF
292600071218     C                   MOVEL     'CLI'         T02COD
292610071221     c                   movel(P)  wksc          t02ke1
292620071218     C                   CALL      'TIBS02R'
292630071218     C                   PARM                    KPJBA
292640071218     C                   PARM                    dsbs02
292650071218    2C                   IF        T02ERR = *BLANKS
292660071218     C                   MOVEL     T02uni        dcli
292670071218    2C                   ENDIF
292680131003     c* Personalizzazione instradamento merce:
292690131003     c* se pieni, sposto peso e volume medio in campi numerici
292700131003     c                   clear                   n_§clipsm
292710131003     c                   clear                   n_§clivlm
292720131003     c                   testn                   §clipsm              30
292730131003     c                   if        *in30 and %subst(§clipsm:7:1)>='0'
292740131003     c                   move      §clipsm       n_§clipsm
292750131003     c                   endif
292760131003     c                   testn                   §clivlm              30
292770131003     c                   if        *in30 and %subst(§clivlm:5:1)>='0'
292780131003     c                   move      §clivlm       n_§clivlm
292790131003     c                   endif
292800131003     c
292810071218     c                   endsr
292820071220     C**************************************************************************
292830071220     C*   Controlli per abilitazione modifica lna di sped. disk B
292840071220     C**************************************************************************
292850071220     C     Sr_chkabilna  BEGSR
292860120817     c***  kblt1         setll     fnblt01l
292870120817     c***  kblt1         reade(N)  fnblt01l
292880120817     c***                dow       not %eof(fnblt01l)
292890120817     c     kblt1         setll     fiart01l
292900120817     c     kblt1         reade(N)  fiart01l
292910120817     c                   dow       not %eof(fiart01l)
292920120817     c     kanm2         setll     fnbrv07l
292930071220     c* - presenti spunte dei segnacolli con la vecchia lna
292940071220     c                   if        %equal(fnbrv07l)
292950071220     c                   seton                                        4790
292960071221     c                   movel     err(315)      vidmsg
292970071220     c                   goto      f_chkabilna
292980071220     c                   endif
292990071220     c* - non presenti spunte dei segnacolli con la nuova lna
293000071221     c     kbrv7         setll     fnbrv07l
293010071220     c                   if        not %equal(fnbrv07l)
293020071220     c                   seton                                        4790
293030071221     c                   movel     err(316)      vidmsg
293040071220     c                   goto      f_chkabilna
293050071220     c                   endif
293060071220     c* - segnacolli doppi sulla nuova lna
293070120829     c* - Non controlla presenza su fiars perchè in questa situazione ars non c'
293080120829     c*   è
293090120817     c**   kbrv7         setll     fnblt27l
293100120817     c**                 if        %equal(fnblt27l)
293110120817     c**   kbrv7         chain     fnblt27l
293120120817     c     kbrv7         setll     fiart27l
293130120817     c                   if        %equal(fiart27l)
293140120817     c     kbrv7         chain     fiart27l
293150071221     c                   seton                                        4790
293160071221     c                   clear                   vidmsg
293170080103     c                   eval      vidmsg='SEGNACOLLO'
293180071221     c                   eval      vidmsg=%trim(vidmsg) + ' ' +
293190120817     c                             %char(artnsc)
293200071221     c                   eval      vidmsg=%trim(vidmsg)+
293210080103     c                             ' DOPPIO: presente su spedizione '
293220120817     c                             + %char(artlnp)
293230120817     c                   eval      vidmsg=%trim(vidmsg)+ ' ' + %char(artnrs)
293240080103     c                             + '-'
293250080103     c                   eval      vidmsg=%trim(vidmsg) +
293260120817     c                             %char(artnsp) +' ' + %char(artaas)
293270071221     c                   goto      f_chkabilna
293280071221     c                   endif
293290120817     c***  kblt1         reade(N)  fnblt01l
293300120817     c     kblt1         reade(N)  fiart01l
293310071220     c                   enddo
293320071220     c* - nuova lna è estera
293330100210     c                   if        a_§ogntw<>'COR' and a_§ogntw<>'MES'
293340100210     c                   seton                                        4790
293350100210     c                   movel     err(317)      vidmsg
293360100210     c                   goto      f_chkabilna
293370100210     c                   endif
293380071220     c     f_chkabilna   endsr
293390080313     C**************************************************************************
293400080313     C*   Verifica se cliente con serie parziale
293410080313     C**************************************************************************
293420100517     C**   Sr_parz       BEGSR
293430100517     c**                 clear                   wparz
293440100517     c**                 clear                   wparz_d
293450100517     c**                 clear                   wparz_a
293460100517    1c**                 if        vidnrs>0
293470100517     c**                 eval      k_tbecod = '3CP'
293480100517     c**                 movel(p)  wksc          k_tbeke1
293490100517     c**   ktbe1         setll     tntbe01l
293500100517    2c**                 do        *hival
293510100517     c**   ktbe1         reade(N)  tntbe01l
293520100517    3c**                 if        %eof(tntbe01l)
293530100517     c**                 leave
293540100517    3c**                 endif
293550100517    3c**                 if        tbeatb='A'
293560100517     c**                 iter
293570100517    3c**                 endif
293580100517     c**                 movel     tbeuni        d3cp
293590100517     c**                 clear                   w007a             7
293600100517     c**                 eval      w007a  = %subst(tbeke2: 3: 7)
293610100517     c**                 move      w007a         wparz_d
293620100517     c**                 z-add     §3cpal        wparz_a
293630100517     c**                 eval      wparz = 'S'
293640100517    2c**                 enddo
293650100517    1c**                 endif
293660100517     c**                 endsr
293670090327     C**************************************************************************
293680090327     C*    PULIZIA CAMPI window cliente/tariffa tassazione porti assegnati
293690090327     C**************************************************************************
293700090327     C     sr_inzwdwcli  BEGSR
293710090327     c                   clear                   wcliksc
293720090327     c                   clear                   wclidks
293730090327     c                   clear                   wclictr
293740090327     c                   clear                   atrwksc
293750090327     c                   clear                   atrwctr
293760090327     c                   endsr
293770090323     C**************************************************************************
293780090323     C*   Gestione window per immissione/modifica cli/tariffa per tassaz. p.a.
293790090323     C**************************************************************************
293800090323     C     geswdw_clitar BEGSR
293810090323     c                   exsr      riewdwcli
293820090325     c                   clear                   hcliriga
293830090325     c                   clear                   hclicolo
293840090327     c                   eval      s_wcliksc=wcliksc
293850090326     c                   eval      s_wclictr=wclictr
293860090324     c                   eval      $fine='0'
293870090323     c*
293880090323     c                   dow       $fine='0'
293890161202
293900161202     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
293910161202     c                   if        *in12 and not *in15
293920161202     c                   write     ls01wcli
293930161202     C                   read(E)   fnls01d
293940161202     c                   else
293950161202     c                   exfmt     ls01wcli
293960161202     c                   endif
293970161202
293980161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
293990161202     c                   if        %error
294000161202     C                   MOVEL     '6'           §LPFPR
294010161202     c                   leave
294020161202     c                   endif
294030161202     c
294040090325     c                   eval      *in90='0'
294050090325     c                   clear                   hcliriga
294060090325     c                   clear                   hclicolo
294070090323     c                   select
294080090323     c* f12=Ritorno
294090090323     c                   when      *inkl='1'
294100090323     c                   eval      $fine='1'
294110090327     c                   eval      wcliksc=s_wcliksc
294120090326     c                   eval      wclictr=s_wclictr
294130090323     c                   other
294140090323     c* f6=conferma o enter
294150090323     c                   exsr      ctrwdwcli
294160090323     c                   if        *inkf and not *in90
294170090326     c                   eval      $fine='1'
294180090323     c                   endif
294190090323     c                   endsl
294200090323     c                   enddo
294210090323     c*
294220090323     c                   endsr
294230090324     C**************************************************************************
294240090324     C* Riempimento campi window cliente/tariffa per tassazione porti assegnati
294250090324     C**************************************************************************
294260090325     C     riewdwcli     BEGSR
294270090324
294280090324     c                   select
294290090324     c* DA ORM
294300090324     c                   when      partch<>'P' and flgfit<>'S'
294310090325     c                   exsr      sr_clearing
294320090324      * Se ORM richiede la bolla in porto assegnato e bolla in porto assegnato
294330090324      * memorizzo il codice cliente che servirà in arrivo in tassazione
294340090324      * porti assegnati. Memorizzo il codice cliente anche nel caso
294350090324      * di bolla in p.a. che fa parte del clearing dpd
294360090324if  2c                   If         ((§OrPfb = 'A' or wforpf = '1') and *In04
294370090324     c                              and Ormksc > *Zeros) or *in04 and wclg='S'
294380090324    3c                   if        wclg=' '
294390090327     c                   Z-add     OrmKsc        wcliksc
294400090325     c                   eval      atrwksc=prot
294410090327     c                   if        ormctr<>*blanks
294420090324     c                   Move      OrmCtr        wclictr
294430090325     c                   eval      atrwctr=prot
294440090324     c                   endif
294450090324   x3c                   else
294460090324     c* se spedizione che va nel clearing il codice cliente è da
294470090324     c* reperire su EDTAB tab 'PU'
294480090324     c                   eval      kedcod='PU'
294490090324     c                   clear                   kedkey
294500090324     c                   move      wopoe         com003a           3
294510090324     c                   eval      kedkey='DPD'+com003a
294520090324     c     kedtab        chain     edtab01l
294530090324    4c                   if        %found(edtab01l)
294540090324     c                   movel     tabuni        edidspu
294550090324     c                   if        §puormaksc>*zeros
294560090327     c                   move      §PUORMAKSC    wcliksc
294570090325     c                   eval      atrwksc=prot
294580090324     c                   endif
294590090327     c                   if        §puormactr<>*blanks
294600090324     c                   move      §PUORMACTR    wclictr
294610090325     c                   eval      atrwctr=prot
294620090324     c                   endif
294630090324    4c                   endif
294640090324    3c                   endif
294650090324e   2c                   EndIf
294660090324     c* DA PGM CHIAMANTE
294670090327     c                   when      *in12 and *in15 and *in04 and vidcbo<>'FW'
294680090325    1c                   if        §lpksca>*zeros
294690090325     c                   eval      w_§lpksca=§lpksca
294700090325     c                   eval      w_§lpctra=§lpctra
294710090325   x1c                   else
294720090325    2c                   if        savfpr='T' or savfpr='P'
294730090325     c                   z-add     §lpccm        w0040
294740090325     c                   if        w0040<> 9999
294750090325     c                   move      §lpccm        w_§lpksca
294760090325     c                   if        §lpctr<>999
294770090325     c                   move      §lpctr        w_§lpctra
294780090325     c                   endif
294790090325     c                   endif
294800090325    2c                   endif
294810090325    1c                   endif
294820090325    1c                   if        w_§lpksca>*zeros
294830090327     c                   movel     w_§lpksca     wcliksc
294840090324     c                   eval      atrwksc=prot
294850090327    2c                   if        w_§lpctra<>*blanks
294860090325     c                   move      w_§lpctra     wclictr
294870090324     c                   eval      atrwctr=prot
294880090325    2c                   endif
294890090325    1c                   endif
294900090324     c* DA CONFERMA BOLLE PER BOLLE "FW"
294910090324     c                   when      *in12 and *in15 and vidcbo='FW'
294920090324     c                             and (%Subst(§lpNot:1:18) = wnotfw
294930090324     c                             or   %Subst(§lpNt2:1:18) = wnotfw)
294940090324     c                   Clear                   w007a
294950090324     c                   If        %Subst(§lpNot:1:18) = wnotfw
294960090324     c                   Eval      w007a = %Subst(§lpNot:20:7)
294970090324     c                   Else
294980090324     c                   Eval      w007a = %Subst(§lpNt2:20:7)
294990090324     c                   EndIf
295000090324      * verifico che siano tutti numeri
295010090324     c                   if        %check(digits:w007a)=0
295020090327     c                   Move      w007a         wcliksc
295030090324     c                   eval      atrwksc=prot
295040090324     c                   EndIf
295050090325     c                   endsl
295060090326     c*
295070090327     c                   if        wcliksc>0
295080090326     C                   clear                   TIBS69DS
295090090327     C                   z-add     wcliksc       I69kac
295100090326     C                   call      'TIBS69R'
295110090326     C                   parm                    tibs69DS
295120090326     C                   parm                    ds_cnaco
295130090326     C                   parm                    ds_cnind
295140090326     C                   parm                    ds_cnclp
295150090326     C                   parm                    ds_fncls
295160090515     c                   eval      wclidks=BS_acorag
295170090326     c                   endif
295180090324     c
295190090324     c                   endsr
295200090325     C**************************************************************************
295210090325     C* Controllo window cliente/tariffa per tassazione porti assegnati
295220090325     C**************************************************************************
295230090325     C     ctrwdwcli     BEGSR
295240090327     c                   if        wcliksc=0
295250090326     c                   clear                   wclidks
295260090326     c                   endif
295270090325     c* codice cliente
295280090326     c                   if        atrwksc=*blanks
295290090327     c                   if        wcliksc>0
295300090326     c                   clear                   wclidks
295310090325     C                   clear                   TIBS69DS
295320090327     C                   z-add     wcliksc       I69kac
295330090327     C                   z-add     wcliksc       I69kin
295340090325     C                   call      'TIBS69R'
295350090325     C                   parm                    tibs69DS
295360090325     C                   parm                    ds_cnaco
295370090325     C                   parm                    ds_cnind
295380090325     C                   parm                    ds_cnclp
295390090325     C                   parm                    ds_fncls
295400090515     c                   eval      wclidks=BS_acorag
295410090325     C* ERRORE
295420090325     c     O69Err        Ifeq      '1'
295430090515     c     BS_acoflg     Orne      *Blanks
295440090325     C     wcliksc       OREQ      8888
295450090325     c                   eval      *in90=*on
295460090325     C                   MOVEL     err(319)      wclimsg
295470090325     c                   z-add     04            Hcliriga
295480090325     c                   z-add     18            Hclicolo
295490090325     c                   goto      endwcli
295500090325    2C                   ENDIF
295510130312    2C***  BS_Acoabl     IFEQ      '8'
295520130312    2C***  BS_acoabl     OREQ      '*'
295530130312    2C     BS_Acoabl     IFne      *blanks
295540090325     c                   eval      *in90=*on
295550090325     C                   MOVEL     err(320)      wclimsg
295560090325     c                   z-add     04            Hcliriga
295570090325     c                   z-add     18            Hclicolo
295580090325     c                   goto      endwcli
295590090325    2C                   END
295600090325     c                   endif
295610090325     c                   endif
295620090325     c* codice tariffa
295630090326     c                   if        atrwctr=*blanks and wclictr<>*blanks
295640090325     c* errore se manca il codice cliente
295650090327     c                   if        wcliksc=*zeros
295660090325     c                   eval      *in90=*on
295670090325     C                   MOVEL     err(319)      wclimsg
295680090325     c                   z-add     04            Hcliriga
295690090325     c                   z-add     18            Hclicolo
295700090325     c                   goto      endwcli
295710090325     c                   endif
295720090325     c*
295730090325     c                   eval      s_fnlv59ds=fnlv59ds
295740090325     C                   CLEAR                   fnlv59ds
295750090325     C                   MOVEL     'A'           ilv59tbo
295760090325      * Se bolla monovaria carico tutte le tariffe ma propongo la partenza
295770090325     C                   IF        §3ASVA <> *BLANK
295780090325     C                   movel     ' '           ilv59tbo
295790090325     C                   movel     'P'           ilv59prp
295800090325     C                   ENDIF
295810090325      *
295820090327     C                   MOVEL     wcliksc       ilv59KSC
295830090325     C                   MOVEL     KCI           ilv59KCI
295840090325     C                   MOVEL     WFIE          ilv59FIE
295850090325     C                   MOVEL     blpdsp        ilv59DSP
295860090325     C                   MOVEL     vidtsp        ilv59TSP
295870090325     C                   MOVEL     'S'           ilv59RIC
295880090325     c                   move      wclictr       ilv59ctr
295890090325     C*
295900090325     C                   CALL      'FNLV59R'
295910090325     C                   PARM                    fnlv59ds
295920090325     C* ERRORE
295930090325     C     olv59msg      IFNE      *BLANKS
295940090325     C                   MOVEL     olv59msg      wclimsg
295950090325     C                   eval      *in90='1'
295960090325     c                   z-add     05            Hcliriga
295970090325     c                   z-add     18            Hclicolo
295980090325     c                   eval      fnlv59ds=s_fnlv59ds
295990090325     C                   GOTO      endwcli
296000090325     C                   ENDIF
296010090325     c*
296020090325     c                   eval      fnlv59ds=s_fnlv59ds
296030090325     c                   endif
296040090325     c     endwcli       endsr
296050090324     C**************************************************************************
296060090324     C* Verifica se spedizione che va nel clearing
296070090324     C**************************************************************************
296080090324     C     sr_clearing   BEGSR
296090090324     c                   clear                   wclg
296100090324    1c                   if        *in12 and *in15='0' and
296110090324     c                             s_§b4poe=wopoe and
296120090324     c                             s_§b4nsr=wonsr and
296130090324     c                             s_§b4nor=wonor2 and
296140090324     c                             s_§b4nrv=wonrv
296150090324     c                   eval      wclg=§b4clg
296160090324   x1c                   else
296170090324     c* se spedizione commissionata da dpd con orm automatico
296180090324     c* verifico se
296190090324     c* sono presenti altre bolle aventi lo stesso orm per l'impostazione
296200090324     c* del flag §b4clg
296210090324     C
296220090324    2c                   if        ormrfa<>*blanks and %subst(ormrfa:1:
296230090324     c                             3)='DPD'
296240090324     c                   eval      kdpodep=%subst(ormrfa:4:4)
296250090324     c                   eval      w006a=%subst(ormrfa:8:6)
296260090324     c                   move      w006a         kdpoord
296270090324     c     kdpo          setll     fidpo03l
296280090324    3c                   if        %equal(fidpo03l)
296290090324     c                   eval      wclg='S'
296300090324     c                   movel     'M'           kar4trc
296310090324     c                   movel     widorm        kar4n14
296320160209     c     kar403        setll     fiar405l
296330090324    4c                   do        *hival
296340160209     c     kar403        reade     fiar405l
296350090324     c* fine file
296360160209    5c                   if        %eof(fiar405l)
296370090324     c                   leave
296380090324    5c                   endif
296390090324     c*
296400090324     c                   eval      wclg=' '
296410090324    4c                   enddo
296420090324    3c                   endif
296430090324    2c                   endif
296440090324    1c                   endif
296450090324     c                   endsr
296460090326     C**************************************************************************
296470090326     C* Carico cliente/tariffa per tassazione p.a. da fiar4 trk 'A'
296480090326     C**************************************************************************
296490090326     C     sr_daar4a     BEGSR
296500090326     C                   MOVEL     'A'           WTRC
296510090326     c     kblp4         chain(N)  fiar401l
296520090326     c                   if        %found(fiar401l)
296530090326     c                   movel     ar4not        dsbl4a
296540090326     C                   MOVEL     '3M'          COD
296550090326     C                   MOVEL(P)  Vidsop        KEY
296560090326     C                   EXSR      CTABEL
296570090327     c                   if        §b4aks>0
296580090327     c                   z-add     §b4aks        wcliksc
296590090327     c                   if        s_ormksc>0  or not *in30
296600090326     c                   eval      atrwksc=prot
296610090326     c                   endif
296620090327     c                   if        §b4act<>*blanks
296630090326     c                   move      §b4act        wclictr
296640090327     c                   if        (s_ormksc>0 and s_ormctr<>*blanks)
296650090327     c                             or (not *in30 and s_ormksc=0)
296660090326     c                   eval      atrwctr=prot
296670090326     c                   endif
296680090327     c                   else
296690090327     c* se cod.tariffa non presente ma bolla non da orm proteggo comunque se
296700090327     c* ksc impostato altrimenti poi se fosse sprotetto non avrebbero più
296710090327     c* la possibiltà di correggerlo in caso di errore
296720090327     c                   if        not *in30 and wcliksc>0 and s_ormksc=0
296730090327     c                   eval      atrwctr=prot
296740090327     c                   endif
296750090326     c                   endif
296760090326     c                   endif
296770090326     c                   endif
296780090326     c                   endsr
296790110512     C**************************************************************************
296800110512     C*   Gestione window per manutenzione indirizzo email destinatario
296810110512     C**************************************************************************
296820150213     C*    sr_geswdwemd  BEGSR
296830150213     c*                  clear                   hemdriga
296840150213     c*                  clear                   hemdcolo
296850150213     c*                  eval      $fine='0'
296860150213     c*                  eval      s_wemdest=wemdest
296870150213     c*                  eval      s_wsms   =wsms
296880110512     c*
296890150213     c*                  dow       $fine='0'
296900150213     c*                  exfmt     ls01wemd
296910150213     c*                  eval      *in90='0'
296920150213     c*                  clear                   hemdriga
296930150213     c*                  clear                   hemdcolo
296940150213     c*                  clear                   wemdmsg
296950150213     c*                  select
296960110512     c* f12=Ritorno
296970150213     c*                  when      *inkl='1'
296980150213     c*                  eval      $fine='1'
296990150213     c*                  eval      wemdest=s_wemdest
297000150213     c*                  eval      wsms=s_wsms
297010150213     c*                  other
297020110512     c* f6=conferma o enter
297030150213     c*                  if        wemdest<>*blanks
297040150213     c*                  if        wdesie='E'
297050150213     c*                  Eval      *In90 = *On
297060150213     c*                  Eval      wemdmsg = err(342)
297070150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
297080150213     c*                            ':eliminare Indir.'
297090150213     c*                  eval      hemdriga=3
297100150213     c*                  eval      hemdcolo=7
297110150213     c*                  else
297120150213     c*                  exsr      Sr_Chkemd
297130110512      * Errore
297140150213if  3c*                  If        §emlerro <> '0'
297150150213     c*                  Eval      *In90 = *On
297160150213     c*                  Eval      wemdmsg = err(340)
297170150213     c*                  eval      hemdriga=3
297180150213     c*                  eval      hemdcolo=7
297190150213   x3c*                  else
297200150213     c*                  Eval      wemdest = §emlindo
297210150213    3c*                  EndIf
297220150213     c*                  EndIf
297230150213     c*                  endif
297240150213     c*                  if        wsms<>*blanks
297250150213     c*                  if        wdesie='E'
297260150213     c*                  Eval      *In90 = *On
297270150213     c*                  Eval      wemdmsg = err(342)
297280150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
297290150213     c*                            ':eliminare Cell.'
297300150213     c*                  eval      hemdriga=5
297310150213     c*                  eval      hemdcolo=7
297320150213     c*                  else
297330140423      /free
297340150216       //pinCell = %trim(wsms);
297350150216       //pOutErr = *blanks;
297360150213       //if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
297370140423
297380140423           // Numero di cellulare KO
297390150213       //   *In90 = *On;
297400150213       //   wemdmsg = err(351);
297410150213       //   hemdriga=5;
297420150213       //   hemdcolo=7;
297430150213    3  //EndIf;
297440140423      /end-free
297450150213     c*                  EndIf
297460150213     c*                  endif
297470150213     c*                  if        *inkf and not *in90
297480150213     c*                  eval      $fine='1'
297490150213     c*                  endif
297500150213     c*                  endsl
297510150213     c*                  enddo
297520110512     c*
297530150213     c*                  endsr
297540110705     C**************************************************************************
297550110705     C*   Gestione window per codici CUP e CIG
297560110705     C**************************************************************************
297570110705     C     sr_geswdwcup  BEGSR
297580110705     c                   eval      $fine='0'
297590110705     c                   eval      s_wcupcup=wcupcup
297600110705     c                   eval      s_wcupcig=wcupcig
297610110705     c*
297620110705     c                   dow       $fine='0'
297630110705     c                   exfmt     ls01wcup
297640110705     c                   eval      *in90='0'
297650110705     c                   select
297660110705     c* f12=Ritorno
297670110705     c                   when      *inkl='1'
297680110705     c                   eval      $fine='1'
297690110705     c                   eval      wcupcup=s_wcupcup
297700110705     c                   eval      wcupcig=s_wcupcig
297710110705     c                   other
297720110705     c* f6=conferma
297730110705     c                   if        *inkf
297740110705     c                   eval      $fine='1'
297750110705     c                   endif
297760110705     c                   endsl
297770110705     c                   enddo
297780110705     c*
297790110705     c                   endsr
297800090608     C**************************************************************************
297810090608     C* Carico limiti (peso/colli/volume) per tipo servizio
297820090608     C**************************************************************************
297830090608     C     sr_limtsp     BEGSR
297840090609     c                   clear                   wmsgtsp
297850090608     c                   clear                   trul73ds
297860090608     c                   if        vidtsp<>*blanks
297870090608     c                   eval      i73tsp=vidtsp
297880090608     c                   else
297890090608     c                   eval      i73tsp=comtsp
297900090608     c                   endif
297910111026     c* campi per la forzatura del messaggio di errore --> pulizia a cambio di
297920111026     c* tipo servizio
297930111026     c                   if        i73tsp<>savtsp73
297940111026     c                   clear                   wncl_pre
297950111026     c                   clear                   wpes_pre
297960111026     c                   clear                   wvol_pre
297970111026     c                   eval      savtsp73=i73tsp
297980111026     c                   endif
297990090619     c* Esco dalla routine senza effettuare il controllo se non ho il tipo
298000090619     c* servizio e provengo da controlli della prima videata:
298010090619     c* è successo che abbiano fatto un dirottamento ma il codice tariffa
298020090619     c* della bolla mamma utilizzato non è uno dei codici presenti per il
298030090619     c* cliente della bolla di dirottamento e quindi il tipo serivizio in
298040090619     c* questi casi è vuoto. In seconda videata poi saranno costretti a
298050090619     c* modificare il codice tariffa e di conseguenza i controlli limiti per
298060090619     c* tipo servizio verranno eseguiti correttamente
298070090619     c                   if        wvid='1' and i73tsp=*blanks
298080090619     c                   leavesr
298090090619     c                   endif
298100090609     c                   z-add     1             c
298110090609     c     i73tsp        lookup    tsp(c)                                 30
298120090609     c                   eval      i73psk=wpes
298130090608     c                   eval      i73vmc=wvol
298140090608     c                   eval      i73ncl=wncl
298150090608     c                   call      'TRUL73R'
298160090608     c                   parm                    trul73ds
298170090608     c                   select
298180090608     c                   when      o73err='E'
298190090608     c                   seton                                        90
298200090609     c                   eval      wmsgtsp=err(324)
298210090609     c                   eval      %subst(wmsgtsp: 40: 8)=dts08(c)
298220090609     c* colli bloccante
298230090608     c                   when      o73fclm='1'
298240090608     c                   seton                                        90
298250090609     c                   if        wvid='1'
298260090609     c                   seton                                        62
298270090609     c                   else
298280090609     c                   seton                                        41
298290090609     c                   endif
298300090609     c                   eval      wmsgtsp=err(325)
298310090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298320090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclm:'4')
298330090609     c* peso kg bloccante
298340090608     c                   when      O73FKGM='1'
298350090608     c                   seton                                        90
298360090609     c                   if        wvid='1'
298370090609     c                   seton                                        63
298380090609     c                   else
298390090609     c                   seton                                        42
298400090609     c                   endif
298410090609     c                   eval      wmsgtsp=err(326)
298420090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298430090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgm:'4')
298440090609     c*volume mc bloccante
298450090608     c                   when      O73FMCM='1'
298460090609     c                   seton                                        9047
298470090609     c                   eval      wmsgtsp=err(327)
298480090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298490090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcm:'4')
298500090609     c* colli forzabile
298510090608     c                   when      O73FCLF='1' and wncl<>wncl_pre
298520090608     c                   seton                                        90
298530090609     c                   if        wvid='1'
298540090609     c                   seton                                        62
298550090609     c                   else
298560090609     c                   seton                                        41
298570090609     c                   endif
298580090609     c                   eval      wmsgtsp=err(325)
298590090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298600090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclf:'4')
298610090610     c                   eval      wmsgtsp=%trim(wmsgtsp)+ '. ENTER per forzare'
298620090609     c                   eval      wncl_pre=wncl
298630090609     c* peso kg forzabile
298640090609     c                   when      O73Fkgf='1' and wpes<>wpes_pre
298650090608     c                   seton                                        90
298660090609     c                   if        wvid='1'
298670090609     c                   seton                                        63
298680090609     c                   else
298690090609     c                   seton                                        42
298700090609     c                   endif
298710090609     c                   eval      wmsgtsp=err(326)
298720090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298730090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgf:'4')
298740090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
298750090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
298760090609     c                   eval      wpes_pre=wpes
298770090609     c* volume mc forzabile
298780090608     c                   when      O73FmcF='1' and wvol<>wvol_pre
298790090609     c                   seton                                        9047
298800090609     c                   eval      wmsgtsp=err(327)
298810090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
298820090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcf:'4')
298830090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
298840090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
298850090609     c                   eval      wvol_pre=wvol
298860090608     c                   endsl
298870090608     c                   endsr
298880091111     C**************************************************************************
298890091111     C*   Gestione window per scelta beneficiario contrassegno
298900091111     C**************************************************************************
298910091111     C     geswdw_cas    BEGSR
298920091111     c                   exsr      riewdwcas
298930091111     c                   clear                   hcasriga
298940091111     c                   clear                   hcascolo
298950091111     c                   eval      $fine='0'
298960091111     c*
298970091111     c                   dow       $fine='0'
298980091111     c                   exfmt     ls01wcas
298990091111     c                   eval      *in90='0'
299000091111     c                   clear                   hcasriga
299010091111     c                   clear                   hcascolo
299020091111     c                   select
299030091111     c* f12=Ritorno
299040091111     c                   when      *inkl='1'
299050091111     c                   eval      $fine='1'
299060091111     c                   other
299070091111     c* f6=conferma o enter
299080091111     c                   exsr      ctrwdwcas
299090091111     c                   if        *inkf and not *in90
299100091111     c                   eval      $fine='1'
299110091111     c                   endif
299120091111     c                   endsl
299130091111     c                   enddo
299140091111     c*
299150091111     c                   endsr
299160091111     C**************************************************************************
299170091111     C* Riempimento campi window scelta beneficiario contrassegno
299180091111     C**************************************************************************
299190091111     C     riewdwcas     BEGSR
299200091111     c* mittente spedizione
299210091111     c                   eval      wcasmit=vidrsm
299220091111     c* ordinante O.R.M.
299230091117     c                   eval      wcascor=ormksc
299240091112     c* ..ragione sociale da cnaco
299250091112     C                   clear                   TIBS69DS
299260091112     C                   z-add     ormksc        I69kac
299270091112     C                   call      'TIBS69R'
299280091112     C                   parm                    tibs69DS
299290091112     C                   parm                    ds_cnaco
299300091112     C                   parm                    ds_cnind
299310091112     C                   parm                    ds_cnclp
299320091112     C                   parm                    ds_fncls
299330091112     c                   eval      wcasord=BS_acorag
299340091112     c*
299350091111     c* destinatario spedizione
299360091111     c                   eval      wcasdest=v2crsd
299370091111     c                   endsr
299380091111     C**************************************************************************
299390091111     C* Controllo window scelta beneficiario contrassegno
299400091111     C**************************************************************************
299410091111     C     ctrwdwcas     BEGSR
299420091111     c                   select
299430091111     c* Effettuare alemno una selazione
299440091111     c                   when      wcassel1=*blanks and wcassel2=*blanks
299450091111     c                   z-add     15            Hcasriga
299460091111     c                   z-add     36            Hcascolo
299470091112     C                   MOVEL     err(329)      wcasmsg
299480091112     c                   seton                                        90
299490091111     c* Selezionare o mittente o ordinante
299500091111     c                   when      wcassel1='X' and wcassel2='X'
299510091111     c                   z-add     15            Hcasriga
299520091111     c                   z-add     36            Hcascolo
299530091112     C                   MOVEL     err(330)      wcasmsg
299540091112     c                   seton                                        90
299550091211     c* ricontrollo il tipo incasso in base alla scelta effettuata
299560091211     c                   other
299570091211     c                   exsr      sr_trultic
299580091211     c                   if        oticerr='T' or  oticerr='C'
299590091211     C                   MOVEL     err(331)      wcasmsg
299600091214     c* eccendo anche indicatore per posizionamento su tic in seconda videata
299610091214     c                   seton                                        9049
299620091211     c                   endif
299630091111     c                   endsl
299640091111     c                   endsr
299650091119     C**************************************************************************
299660091119     C* Inizializzazione campi window scelta beneficiario D/A
299670091127     C**************************************************************************
299680091119     C     inzwdwcas     BEGSR
299690091119     c                   clear                   wcasmit
299700091119     c                   clear                   wcascor
299710091119     c                   clear                   wcasord
299720091119     c                   clear                   wcasdest
299730091119     c                   clear                   wcassel1
299740091119     c                   clear                   wcassel2
299750091211     c                   eval      nochkticC=*off
299760091119     c                   endsr
299770110516     C**************************************************************************
299780110516     C* Window per richiesta conferma annullamento
299790110516     C**************************************************************************
299800110516     C     sr_geswdwconf BEGSR
299810110516     c                   clear                   wvann
299820110516     c                   eval      $fine='0'
299830110516     c*
299840110516     c                   dow       $fine='0'
299850161202
299860161215     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
299870161215     c                   if        *in12 and not *in15
299880161202     c                   write     ls01wann
299890161202     c                   read(e)   fnls01d
299900161215     c                   else
299910161215     c                   exfmt     ls01wann
299920161215     c                   endif
299930161202     c
299940161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
299950161202     c                   if        %error
299960161202     C                   MOVEL     '6'           §LPFPR
299970161202     c                   leave
299980161202     c                   endif
299990161202
300000110516     c                   if        *inkf
300010110516     c                   eval      $fine='1'
300020110516     c                   endif
300030110516     c                   enddo
300040110516     c                   endsr
300050110519     C**************************************************************************
300060110519     C* Controllo presenza bolle da confermare
300070110519     C**************************************************************************
300080110519     C     sr_chkvab     BEGSR
300090110519    4c                   if        s_wksc<>wksc
300100110519     c                   eval      wfvab=*off
300110110519    4c                   endif
300111170912     c                   clear                   wFiva             1
300112170912     c                   eval       SQLCOD = 0
300113170912     C/EXEC SQL
300114170912     C+ SELECT  'S' into :wFiva
300115170912     C+   FROM  fivab00F   WHERE  vabccm = :wksc  and vabatb<>'A'
300116170912     C+    fetch first row only
300117170912     C/END-EXEC
300121170913
300122170912     c                   clear                   wEdiv             1
300123170912     c                   eval       SQLCOD = 0
300124170912     C/EXEC SQL
300125170912     C+ SELECT  'S' into :wEdiv
300126170912     C+   FROM  edivab0F   WHERE  vabccm = :wksc  and vabatb<>'A'
300127170912     C+    fetch first row only
300128170912     C/END-EXEC
300132170912     c**   wksc          setll     fivab01l
300133170912     c***  wksc          setll     edivab1l
300140170912    4c***                if        (%equal(fivab01l) or %equal(edivab1l) )
300141170913     c                   if        (wFiva='S' or wEdiv='S')
300150110519     c                             and (s_wksc<>wksc or wfvab=*off)
300160110519     c                   movel     '1'           wemfor
300170110519     c                   eval      wms1=err(341)
300180110519     c                   eval      wfvab=*on
300190110519    5c*                  select
300200110519     c*                  when      %equal(fivab01l) and
300210110519     c*                            %equal(edivab1l)
300220110519     c*                  eval      wms1=err(341)
300230110519     c*                  eval      wfvab=*on
300240110519     c*                  when      %equal(fivab01l)
300250110519     c*                  eval      wms1=err(341)
300260110519     c*                  eval      wfvab=*on
300270110519     c*                  when      %equal(edivab1l)
300280110519     c*                  eval      wfvab=*on
300290110519     c*                  eval      wms1=err(341)
300300110519    5c*                  endsl
300310110519     c                   eval      $fine='0'
300320110519     c                   dow       $fine='0'
300330110519     c                   exfmt     ls01wvab
300340110519     c* f12=Ritorno
300350110519     c                   if        *inkl='1'
300360110519     c                   eval      $fine='1'
300370110519     c                   endif
300380110519     c                   enddo
300390110519     c*
300400110519    4c                   endif
300410110519     c                   eval      s_wksc=wksc
300420110519     c                   endsr
300430110902     C**************************************************************************
300440110902     C* Invio email a CED per errore valore accorpamento spedizioni in consegna
300450110902     C**************************************************************************
300460110902     C     sr_mail       BEGSR
300470110902     C* Inizializzo variabili
300480110902     C                   movel     *blanks       wrkEmlTo        253
300490110902     C                   movel     *blanks       wrkEmlCc        253
300500110902     C                   movel     *blanks       wrkMsg         5000
300510110902     C                   movel     *blanks       wrkOgg           44
300520110902     C                   movel     *blanks       wrkesito          1
300530120302     C* Valorizzo i campi della @-mail
300540120302     C                   eval      wrkEmlTo='ced@brt.it'
300550110902     c                   eval      wrkEmlCc = *blank
300560110902     C                   eval      wrkOgg='PERFECT ORDER WURTH'
300570110902     C                   eval      wrkMsg='Valore di accorpamento "'   +
300580110902     c                             §lpxco                              +
300590110902     C                             '" non presente in tabella "XCO"'   +':/N'+
300600110902     C                             ' '                                 +':/N'+
300610110902     C                             'SPEDIZIONE: ' +%editc(blplnp:'X')  +
300620110902     c                             ' ' +%editc(blpnrs:'Z') + ' '       +
300630110902     c                             %editc(blpnsp:'Z') +' '             +
300640110902     c                             %editc(blpaas:'X')                  +':/N'+
300650110902     C                             'RMN: '+%editc(blprmn:'Z')          +':/N'+
300660110902     C                             'RMA: '+blprma                      +':/N'+
300670110902     c                             ' '                                 +':/N'+
300680110902     c                             ' '
300690110902     C*
300700110902     C                   call(e)   'TIS701C1'
300710110902     C                   parm                    wrkEmlto
300720110902     C                   parm                    wrkEmlCc
300730110902     C                   parm                    wrkOgg
300740110902     C                   parm                    wrkMsg
300750110902     C                   parm                    wrkesito
300760110902     c                   endsr
300770111026     C**************************************************************************
300780111026     C* Memorizzazione dati vecchi colli per scrittura R.A.
300790111026     C**************************************************************************
300800111026     C     sr_memRA      BEGSR
300810111026     c* devo memorizzare il numero dei colli e il range dal/al prima della
300820111026     c* riassegnazione per poi poterli memorizzare nel file delle R.A.
300830111026     c* Devo memorizzare anche se si tratta di variazione di lna o di
300840111026     c* aumento colli
300850111026     c                   eval      RA_ncd=vidncd
300860111026     c                   eval      RA_nca=vidnca
300870111026     c                   eval      RA_ncl=savncl
300880111026     c                   eval      RA_lna=savlna
300890111026     c
300900111026     c                   endsr
300910111026     C**************************************************************************
300920111026     C* Richiamo pgm di scrittura R.A. per bolla modificata con riass.segnacolli
300930111026     C**************************************************************************
300940111026     C     sr_wrtRA      BEGSR
300950140507     c                   clear                   fidna6ds
300960140507     c                   eval      ida06mad=' 30'
300970140507     c                   eval      ida06tor='S'
300980140507     c                   eval      ida06ogg=%editc(blplnp:'X') +
300990140507     c                             %editc(blpnrs:'X')+
301000111026     c                             %editc(blpnsp:'X')+%editc(blpaas:'X')
301010111026     c                   move      RA_lna        wRA_lna
301020111026     c                   if        wRa_lna<>blplna
301030140507     c                   eval      ida06no2='Ex LNA'
301040140507     c                   eval      ida06no2=%trim(ida06no2)+' '+RA_lna
301050140507     c                   eval      ida06no2=%trim(ida06no2)+' colli'
301060111026     c                   else
301070140507     c                   eval      ida06no2='Ex Nr. colli'
301080111026     c                   endif
301090140507     c                   eval      ida06no2=%trim(ida06no2)+
301100140507     c                             ' '+%editc(RA_ncl:'Z')
301110140507     c                   eval      %subst(ida06no2:36:13)='Segnacolli da'
301120140507     c                   eval      ida06no2=%trim(ida06no2)+
301130140507     c                             ' '+%editc(RA_ncd:'2')
301140111026     c                   if        RA_nca>0
301150140507     c                   eval      ida06no2=%trim(ida06no2)+
301160140507     c                             ' a '+%editc(RA_nca:'2')
301170111026     c                   endif
301180140507     c                   eval      ida06ute=knmus
301190140507     c                   eval      ida06fil=simpou
301200140507     c                   call      'FIDNA6R'
301210140507     c*****              parm                    kpjba
301220140507     c                   parm                    fidna6ds
301230111026     c                   endsr
301240130304     C* CONTROLLO SE nome file PDF doppio ---------------------------*
301250130304     C     pdfdop        BEGSR
301260130307     c                   movel     dsblp0        savblp
301270130304     c     kvat          reade(N)  fivat01l
301280130304    1c                   dow       not  %eof(fivat01l)
301290130304     c                   movel     vatnot        dvatp
301300130304    2c                   if        §vatppdfn<>*blanks
301310130306     c     kar8§pdf      setll     fiar802l
301320130306     c     kar8§pdf      reade     fiar802l
301330130304    3c                   dow       not %eof(fiar802l)
301340130304     c     kblpar8       chain     fnblp01l
301350130304    4c                   if        %found(fnblp01l)
301360130304     C                   Z-ADD     BLPMGS        WDSP
301370130304     C                   MOVEL     BLPAAS        WDSP
301380130305    5C     WDSP          IFGE      datapdf
301390130304     c     blpcca        andne     '7'
301400130304     C                   MOVEL     ERR(348)      VIDMSG
301410130304     C                   SETON                                        90
301420130307     C                   MOVEL     SAVBLP        DSBLP0
301430130304     c                   leavesr
301440130304     c                   endif
301450130304     c                   endif
301460130306     c     kar8§pdf      reade     fiar802l
301470130304    3c                   enddo
301480130304    2c                   endif
301490130304     c     kvat          reade(n)  fivat01l
301500130304    1c                   enddo
301510130307     C                   MOVEL     SAVBLP        DSBLP0
301520130304     c*
301530130304     C                   ENDSR
301540130308     C* Invio messagio a Ced se cliente fornisce pdf ma non abilitato*
301550130308     C     ced_alert     BEGSR
301560130311     c                   eval      wrkEmlTo = 'CedAlert@brt.it'
301570130308     c                   eval      wrkEmlcc = *blank
301580130312     c                   eval      wrkOgg = 'PDF del cliente ' +
301590130312     c                                      %editc(§lpccn:'X') +
301600130313     c                                      ' NON ELABORATO'
301610130313     C                   eval      wrkMsg = 'Il cliente ha trasmesso FIVAT' +
301620130313     c                                      ' Tipo Rek "P" ma non è abilitato.'
301630130308     c
301640130308     C                   CALL      'TIS701C1'
301650130308     C                   PARM                    wrkEmlTo        253
301660130308     C                   PARM                    wrkEmlCc        253
301670130308     C                   PARM                    wrkOgg           44
301680130308     C                   PARM                    wrkMsg         5000
301690130308     C                   PARM                    wrkesito          1
301700130308     c                   endsr
301710130924
301720130924     C* Scrittura Fiar8 + impostazione campi per fiar5 record GEN  --*
301730130924     c     sr_gesar8     begsr
301740130924     c* Se sono in conferma bolle da dischetto e ctm che prevede fivax
301750130924     c* scrivo fiar8
301760130924     c                   clear                   w_allx
301770130924     c                   clear                   w_allm
301780130924     c                   clear                   w_alls
301790130924     c                   If        *In12 and *In15
301800130924     c                             and §1bf16 = 'S'
301810130924     c                   if        wvax='S'
301820130924     c                   exsr      sr_fiar8
301830130924     c                   endif
301840130924     c                   if        wvatp='S'
301850130924     c                   exsr      sr_fiar8_vatp
301860130924     c                   endif
301870130924     c                   endif
301880130924     c* se richiamato da pgm "Wanda" vedo se creare fiar8 oer la nuova
301890130924     c* bolla copiando i dati dal fiar8 della bolla mamma
301900130924     c   12
301910130924    1can 15savfpr        ifeq      'G'
301920130924     c     savfpr        oreq      'P'
301930130924    2c     §lpar8        ifeq      'S'
301940130924     c     kbolm         setll     fiar801l
301950130924    3c                   do        *hival
301960150929     c     kbolm         reade     fiar801l
301970130924    4c                   if        %eof(fiar801l)
301980130924     c                   leave
301990130924    4c                   endif
302000130924     c                   Eval      Ar8Aas = BlpAas
302010130924     c                   Eval      Ar8Lnp = BlpLnp
302020130924     c                   Eval      Ar8Nrs = BlpNrs
302030130924     c                   Eval      Ar8Nsp = BlpNsp
302040130924     c                   if        aggioAr8='S'
302050130924     c                   write     fiar8000
302060130924     c                   endif
302070130924    4c                   if        ar8tmd<>'§PDF'
302080130924     c                   eval      w_allx='S'
302090130924     c                   else
302100130924     c                   eval      dar8§pdf=ar8uni
302110130924     c* il secondo byte è per la mail  ('1'=invia mail)
302120130924    5c                   if        %subst(§ar8pidz:2:1)='1'
302130130924     c                   eval      w_allm='S'
302140130924    5c                   endif
302150130924     c*
302160130924    5c                   if        %subst(§ar8pidz:1:1)='1' and
302170130924    5c                             (§ar8ptrt='S' or §ar8ptrt='X')
302180130924     c                   eval      w_alls='S'
302190130924    5c                   endif
302200130924     c*
302210130924    4c                   endif
302220130924    3c                   enddo
302230130924    2c                   endif
302240130924    1c                   endif
302250130924     c                   endsr
302260150701     C**************************************************************************
302270150701     C* Richiamo pgm di aggiornamento record fisgn duplicati su altro terminal
302280150701     C**************************************************************************
302290150701     C     sr_CalSgn     BEGSR
302300150701     c* Lo faccio solo per manutenzione perchè in immissione/conferma
302310150701     c* bolle, se updato fisgn perchè lo riutilizzo (se aveva  atb= "*" )
302320150701     c* è il  gufo che gestisce la cancellazione e la duplica per eventuale
302330150701     C* altro terminal di partenza
302340150701     c                   if        *in12 and not *in15
302350150701     c                   clear                   fnlssgnds
302360150701     c                   eval      isgntnp=sgntnp
302370150701     c                   eval      isgnwho=sgnwho
302380150701     c                   call      'FNLSSGNR1'
302390150701     c                   parm                    fnlssgnds
302400150701     c                   endif
302410150701     c                   endsr
302420151014     C*--- Registro peso e volume usati perfatturaz. in FIAR5 --------*
302430151014     C     REGPesivol    BEGSR
302440151014     c                   clear                   dar5fat
302450151014     c                   Eval      kar5trd='FAT'
302460151014     c     kfiar5        Chain     Fiar531c
302470151014     c                   If        %Found(Fiar531c)
302480151014     c                   Movel     ar5uni        dar5fat
302490151014     c                   endif
302500151014     c* Se tassata
302510151014    1c                   if        vidimv>0
302520151014     c* Volume
302530151014     c                   movel     blpvlf        §ar5vltas
302540151014     c                   movel     blpfvf        §ar5fvtas
302550151014     c* Peso
302560151014     c                   movel     blppkf        §ar5pktas
302570151014     c                   movel     'R'           §ar5fptas
302580151014     c
302590151016     c* NON Gestisco lA possibilità di memorizzare il peso vdl
302600151016     c* in quanto al tnsf20r non viene mai passato il taspkc
302610151014     c                   eval      §AR5DATAS=%dec(%date())
302620151014     c                   eval      §AR5HMTAS=%dec(%time())
302630151014     c                   eval      §AR5PRTAS=knmus
302640151014     c                   eval      §AR5NJTAS=knmtd
302650151014     c*
302660151014    1c                   endif
302670151014     c
302680151014      * aggiorno Fiar5 record "FAT"
302690151014if  1c                   If        %Found(Fiar531c)
302700151014     c* Se ho eliminato la tassazione  deleto
302710151014     c                   if        vidimv=0
302720151014     c                   delete    fiar500s
302730151014     c                   else
302740151014     c                   Movel(p)  dar5fat       Ar5uni
302750151014     c                   eval      ar5dac=%dec(%date())
302760151014     c                   eval      ar5orc=%dec(%time())
302770151014     c                   Update    Fiar500s
302780151014     c                   endif
302790151014      * scrivo   Fiar5 record "FAT"
302800151014   x1c                   Else
302810151014    2c                   if        vidimv>0
302820151014     c                   Clear                   Fiar500s
302830151014     c                   Eval      Ar5Aas = blpAas
302840151014     c                   Eval      Ar5Lnp = blpLnp
302850151014     c                   Eval      Ar5Nrs = blpNrs
302860151014     c                   Eval      Ar5Nsp = blpNsp
302870151014     c                   Eval      Ar5Trd = 'FAT'
302880151014     c                   Movel(p)  dar5fat       Ar5uni
302890151014     c                   eval      ar5dac=%dec(%date())
302900151014     c                   eval      ar5orc=%dec(%time())
302910151014     c                   Eval      AR5FT1='T'
302920151014     c                   Eval      AR5DT1=99999999
302930151014     c                   Eval      AR5FT2='T'
302940151014     c                   Eval      AR5DT2=99999999
302950151014     c                   Eval      AR5FT3='T'
302960151014     c                   Eval      AR5DT3=99999999
302970151014     c                   Write     Fiar500s
302980151014    2c                   EndIf
302990151014    1c                   EndIf
303000151014     c
303010151014     c                   ENDSR
303020151104     C*--- Memorizzazione flag per addebito ORM telefonico -----------*
303030151104     C     sr_b4ado      BEGSR
303040151117     c                   clear                   w_§b4ado
303050160210     C* ** Solo se:  non è un prepagato
303060160210     C*              orm non è fittizio **
303070160210     c*              no import
303080160210    1C                   if        not *in22      and
303090160210     c                             flgfit<>'S'    and
303100160210     c                             §ogntw<>'DPD' and §ogntw<>'EEX' and
303110160210     c                             §ogntw<>'FED'
303120160210
303130151104     c* Se Orm telefonico, di default imposto flag = 'S'
303140160210    2c                   if        (ORMTCO='M' or ormtco='E')
303150160209     c                             and (not *in04 or ormpag='O')
303160151117     c                   eval      w_§b4ado='S'
303170151104     c* Pulisco il flag se:
303180151104     c* già presente altra bolla abbinata allo stesso ORM che prevede
303190151104     c* l'addebito
303200151104     c                   movel     'M'           kar4trc
303210151104     c                   movel     widorm        kar4n14
303220160209     c     kar403        setll     fiar405l
303230160209     c     kar403        reade     fiar405l
303240160210    3c                   dow       not %eof(fiar405l) and w_§b4ado='S'
303250151104     c*
303260160209     c                   eval      a_dsbl4m=ar4not
303270160210    4c                   if        a_§b4ado='S' and
303280160210     c                             ((not *in12 or *in15) or
303290160210     c                              (§lpaas<>ar4aas or §lplnp<>ar4lnp or
303300160210     c                               §lpnrs<>ar4nrs or §lpnsp<>ar4nsp) )
303310151117     c                   clear                   w_§b4ado
303320160210    4c                   endif
303330160209     c     kar403        reade     fiar405l
303340160210    3c                   enddo
303350160210    2c                   endif
303360160210    1c                   endif
303370151104     c                   endsr
303380161202     c
303390160120     C*--- Gestione window per interrogazione variaizoni fatte da arrivo
303400160120     C     sr_WdwF10     BEGSR
303410160120     c****               write     ls01d01
303420160120     c                   dow       $finef10='0'
303430160120     c                   write     ls01d01
303440160120     c                   exfmt     ls01wf10
303450160120     c                   select
303460160120     c* F10 = Visualizza variazioni
303470160120     c                   when      *inkj=*on
303480160120     C                   MOVEL     'P'           PA1TBO
303490160120     c                   eval      PA1AAS=§LPAAS
303500160120     c                   eval      PA1LNP=§LPLNP
303510160120     c                   eval      PA1NRS=§LPnrs
303520160120     c                   eval      PA1NSP=§LPNsp
303530160120     C                   MOVEL     PARAM1        KPJBU
303540160120     C                   CALL      'FNLR75R'
303550160120     C                   PARM                    KPJBA
303560160125     c* F16 = Visualizza R.A.
303570160125     c                   when      *inkq=*on
303580160126     c                   eval      wdna2lnp  = §lplnp
303590160126     c                   eval      wdna2nrs  = §lpnrs
303600160126     c                   eval      wdna2nsp  = §lpnsp
303610160126     c                   eval      wdna2aas = §lpaas
303620160125     c                   reset                   FIDNA2ds
303630160125     c                   eval      IA2ogg  = ds_OggSped
303640160125     c                   call      'FIDNA2R'
303650160125     c                   parm                    KPJBA
303660160125     c                   parm                    FIDNA2ds
303670160120     c* F12 = Ritorno
303680160120     c                   when      *inkl=*on
303690160120     c                   eval      $finef10='1'
303700160120     c                   endsl
303710160120     c                   enddo
303720160120     c                   endsr
303730160215     C*--- Verifica requisiti bolla export per instradare in DPD
303740160215     C     sr_InstrADPD  BEGSR
303750160406     c*
303760160224     c                   eval      w_aDpd='S'
303770160310     c
303780160310     c                   if        %lookup('999':sk_VPODPD)=0 and
303790160310     c                             %lookup(%editc(vidlnp:'X'):sk_VPODPD)=0
303800160310     c                   eval      w_aDpd='N'
303810160310     c                   leavesr
303820160310     c                   endif
303830160226     c* Peso bolla
303840160226    1c                   if        not*in12
303850160226     c                   z-add     vidpkg        pkgbolla
303860160226     c                   else
303870160226     c                   z-add     v2cpkg        pkgbolla
303880160226    1c                   endif
303890160226     c*
303900160226    1c                   if        deslad<=0 or
303910160226     c                             v1cncl<>1 or
303920160226     c                             pkgbolla>§3ipkd
303930160226     c                   eval      w_aDpd='N'
303940160226     c                   leavesr
303950160226    1c                   endif
303960160226
303970160406     c* recupero eventuale limite di peso e volume per nazione su tabella "16"
303980160226     C                   MOVEL     '16'          COD
303990160226     C                   MOVEL(P)  VIDNZD        KEY
304000160226     c                   clear                   ds16
304010160226     C                   EXSR      CTABEL
304020160226     C  n30              MOVEL     TBLUNI        DS16
304030160226     C   30              z-add     *hival        §16pkd
304040160406     C   30              z-add     *hival        §16vld
304050160226     c
304060160406     c* N.B: Il controllo di limite del volume verrà eseguito anche dopo
304070160406     c*      il calcolo del volume automatico (dopo l'esecuzione della routine
304080160406     c*      CALVOL)
304090160406     c                   if        pkgbolla > §16pkd  or
304100160406     c                             vidvol   > §16vld
304110160226     c                   eval      w_aDpd='N'
304120160226     c                   leavesr
304130160226     c                   endif
304140160226
304150160226     c* verifico eventuali blocchi per instradare a dpd  - TAB "IED"
304160160226     c                   clear                   fnlvdpds
304170160226     c                   eval      idplna=o95lna
304180160226     c                   eval      idpnaz=vidnzd
304190160226     c                   eval      idpccm=wksc
304200160226     c                   movel     fnlvdpds      kpjbu
304210160226     c                   call      'FNLVDPR'
304220160226     c                   parm                    kpjba
304230160226     c                   movel     kpjbu         fnlvdpds
304240160226     c                   if        odpesito='0'
304250160226     c                   eval      w_aDpd='N'
304260160226     c                   leavesr
304270160226     c                   endif
304280160226     c
304290160223     c* verifico eventuali blocchi cappario utilizzi particolari
304300160223     c                   eval      d_i97ntw='DPD'
304310160223     c                   call      'TISI97R'
304320160223     c                   parm                    dssi95
304330160223     c                   parm                    d_tisi97ds
304340160226    1c                   select
304350160224     c                   when      d_o97err<>*blanks
304360160224     c                   eval      w_aDpd='N'
304370160224     c                   leavesr
304380160224     c                   when      d_o97uti='N'
304390160224     c                   movel     d_o97flo      dcppflo
304400160226    2c                   if        §cppall='S'  or
304410160223     c                             (§cppcas='S' and i95fca='S') or
304420160223     c                             (§cpppas='S' and i95tpo='A') or
304430160223     c                             (§cpppas='O' and i95tpo='A' and
304440160223     c                              (flgfit='S' or i97ntw<>poentw))
304450160224     c                   eval      w_aDpd='N'
304460160224     c                   leavesr
304470160226    2c                   endif
304480160226    1c                   endsl
304490160222     c
304500160215     c                   endsr
304510170214     C*------------------------------------------------------------
304520170214     C*--- Impostazione SIMFEL
304530170214     C*------------------------------------------------------------
304540170214     C     sr_Simfel     BEGSR
304550170214     c* Ricevuta una LNP per cui bollettare
304560170214    1c                   if        %parms>=5 and ParLnpB>0
304570170214     c* eseguo le operazioni a cambio di LnpB
304580170214     c                   if        Parlnpb<>s_ParLnpB
304590170214     c                   eval      s_ParLnpB=ParLnpB
304600170214     c* determino il terminal di partenza che verrà assunto come SIMFEL
304610170214     C                   clear                   dslv55
304620170214     c                   eval      d55tpt='P'
304630170214     C                   move      ParLnpB       d55lin
304640170214     C                   move      dateu         d55drf
304650170214     C                   call      'FNLV55R'
304660170214     C                   parm                    dslv55
304670170214     c                   eval      simfel=d55tfp
304680170214     c                   eval      simpou=ParLnpB
304690170214     c                   if        simfel<>simpou
304700170214     c                   eval      simtpp='2'
304710170214     c                   else
304720170214     c                   eval      simtpp='1'
304730170214     c                   endif
304740170214     c                   exsr      sr_xSimfel
304750170214     c                   endif
304760170214     c                   eval      wCarSimfel='S'
304770170214   x1c                   else
304780170214     c* Non ricevuta nessuna LNP per cui bollettare
304790170214     c                   if        wCarSimfel='S'
304800170214     c                   clear                   wCarSimfel
304810170214     c                   eval      simfel=simfel_s
304820170214     c                   eval      simpou=simpou_s
304830170214     c                   eval      simtpp=simtpp_s
304840170214     c                   exsr      sr_xSimfel
304850170214     c                   endif
304860170214    1c                   endif
304870170214     c                   endsr
304880170214     C*------------------------------------------------------------
304890170214     C*--- Caricamento campi legati a SIMFEL
304900170214     C*------------------------------------------------------------
304910170214     C     sr_xSimfel    BEGSR
304920170214     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
304930170214     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
304940170214     C* PER I PREPAGATI
304950170214     C                   Z-ADD     1             X
304960170215     c                   z-add     salvatgi      g02tgi
304970170214    1C     X             DOWLE     §3IGGS
304980170214     C     PARTCH        ANDNE     'P'
304990170214     C     §LPFPR        ANDNE     'O'
305000170214    1C     X             ORLE      §3IGGP
305010170214     C     PARTCH        ANDEQ     'P'
305020170214    1C     X             ORLE      §3IGGP
305030170214     C     §LPFPR        ANDEQ     'O'
305040170214     C*
305050170214     C                   MOVEL     'F'           WFEST             1
305060170214     C*
305070170214    2C     WFEST         DOWNE     ' '
305080170214     C     G02TGI        ADD       1             GIOTGI
305090170214     C                   ADD       1             G02TGI
305100170214     C                   CALL      'XSRGI8'
305110170214     C                   PARM                    WGIDAT
305120170214     C*
305130170214     C                   Z-ADD     GIOINV        DATAPA            8 0
305140170214     C                   MOVEL     GIODAT        DATAPG            8
305150170214     C*
305160170214     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
305170170214     C                   Z-ADD     GIOINV        WDATA
305180170214     C                   CLEAR                   W0030
305190170214     C* CHAIN SUL CALENDARIO BRT
305200170214     C     KCLN          CHAIN     AZCLN01L                           30
305210170214     C   30              CLEAR                   CLNPOM
305220170214     C                   MOVEA     CLNPOM        K31
305230170214     C                   MOVEL     K31(WGG)      WFEST
305240170214     c* Se non è festivo pulisco il campo WFEST
305250170214     c     wfest         lookup    S1Y                                    30
305260170214     c                   if        not *in30
305270170214     c                   clear                   wfest
305280170214     c                   endif
305290170214     c
305300170214    2C                   ENDDO
305310170214     C*
305320170214     C                   ADD       1             X
305330170214    1C                   ENDDO
305340170214     c* trovo primo giorno lavorativo minore di oggi per bollettare in
305350170214     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
305360170214     C                   TIME                    orapgm            6 0
305370170214    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
305380170214     C                   MOVEL     'F'           WFEST             1
305390170214     c                   z-add     salvatgi      giotgi
305400170214     C*
305410170214    1C     WFEST         DOWNE     ' '
305420170214     C     salvatgi      sub       1             GIOTGI
305430170214     C                   sub       1             salvatgi
305440170214     C                   CALL      'XSRGI8'
305450170214     C                   PARM                    WGIDAT
305460170214     C*
305470170214     C                   Z-ADD     GIOINV        DATAmeno1         8 0
305480170214     C                   MOVEL     GIODAT        DATgmeno1         8 0
305490170214     C*
305500170214     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
305510170214     C                   Z-ADD     GIOINV        WDATA
305520170214     C                   CLEAR                   W0030
305530170214     C* CHAIN SUL CALENDARIO BRT
305540170214     C     KCLN          CHAIN     AZCLN01L                           30
305550170214     C   30              CLEAR                   CLNPOM
305560170214     C                   MOVEA     CLNPOM        K31
305570170214     C                   MOVEL     K31(WGG)      WFEST
305580170214     c* Se non è festivo pulisco il campo WFEST
305590170214     c     wfest         lookup    S1Y                                    30
305600170214     c                   if        not *in30
305610170214     c                   clear                   wfest
305620170214    2C                   ENDif
305630170214     c
305640170214    1C                   ENDDO
305650170214   x0c                   else
305660170214     C*
305670170214     C                   Z-ADD     dateu         DATAmeno1
305680170214     C                   MOVEL     wdtgio        DATgmeno1
305690170214    0c                   endif
305700170214     C***
305710170214     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
305720170214     C***
305730170214     C                   CLEAR                   DSUL06
305740170214     C                   MOVE      '£1'          D06COD
305750170214     C                   MOVEL     SIMFEL        D06KEY
305760170214     C                   MOVEL     'L'           D06TLA
305770170214     C                   MOVEL     DSUL06        KPJBU
305780170214     C*
305790170214     C                   CALL      'TRUL06R'
305800170214     C                   PARM                    KPJBA
305810170214     C                   MOVEL     KPJBU         DSUL06
305820170214     C                   MOVEA     LIN           L1
305830170214     C***
305840170214     C* CARICO £6
305850170214     C***
305860170214     C                   CLEAR                   DSUL06
305870170214     C                   MOVE      '£6'          D06COD
305880170214     C                   movel     SImpou        D06KEY
305890170214     C                   MOVEL     'L'           D06TLA
305900170214     C                   MOVEL     DSUL06        KPJBU
305910170214     C*
305920170214     C                   CALL      'TRUL06R'
305930170214     C                   PARM                    KPJBA
305940170214     C                   MOVEL     KPJBU         DSUL06
305950170214     C                   MOVEA     LIN           L6
305960170214      * Recupero le date delle statistiche
305970170214     c                   Clear                   dsbs02
305980170214     c                   Clear                   dSdf
305990170214     c                   Eval      T02Mod = 'C'
306000170214     c                   Eval      T02Sif = Knsif
306010170214     c                   Eval      T02Cod = 'SDF'
306020170214     c                   Movel(p)  Simfel        T02Ke1
306030170214     c                   Call      'TIBS02R'
306040170214     c                   Parm                    Kpjba
306050170214     c                   Parm                    dsbs02
306060170214     c                   If        T02Err = *Blanks
306070170214     c                   Movel     T02Uni        dSdf
306080170214     c                   EndIf
306090170214
306100170214     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
306110170214     C                   Z-ADD     SIMFEL        W0030
306120170214     C     W0030         CHAIN     AZORG01L      UNIORG               30
306130170214     C                   MOVEL     ORGFEL        WASFEL            3 0
306140170214     C                   MOVEL     ORGDF0        OG150
306150170214     C                   MOVEL     §OGDKC        WASDKC            1
306160170214     C*
306170170214     C***
306180170214     C* VEDO SE SONO SIMFEL O REMOTO
306190170214     C***
306200170214     C                   MOVEL     SIMFEL        CDU               3 0
306210170214     C*
306220170214     c     simtpp        ifeq      '2'
306230170214     c     simtpp        oreq      *blanks
306240170214     c                   movel     simpou        cdu
306250170214     C                   END
306260170214     C* LINEA DI PARTENZA --> IMPOSTO
306270170214     C  N12              MOVEL     CDU           VIDLNP
306280170214     c                   if        not *in12 or *in15
306290170214     C                   MOVEL     CDU           BLPFLB
306300170214     c                   endif
306310170214     C* VEDO SE IN L1 PRESENTE P.O. DPD
306320170214     C                   CLEAR                   WSIDPD
306330170214     C                   Z-ADD     1             II
306340170214     C     II            DOWLE     30
306350170214     C     WSIDPD        ANDEQ     *BLANKS
306360170214     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
306370170214     C  N30              MOVEL     ORGDE3        OG143
306380170214     C   30              CLEAR                   OG143
306390170214     C     §OGntw        IFEQ      'DPD'
306400170214     C                   MOVEL     'S'           WSIDPD            1
306410170214     C                   ENDIF
306420170214     C                   ADD       1             II
306430170214     C                   ENDDO
306440170214     c                   endsr
306450941221     OFNLV22P   T    LRNLR
306460011212**   GGG
3064709006111234567
306480900511**   VAR
306490941011 ** IMMISSIONE  BOLLE  PARTENZE **
306500941011 ** MANUTENZIONE BOLLE PARTENZE **
306510941011 ** CONFERMA  BOLLE  DA CLIENTI **
306520941011 ** RECUPERO  IMMISSIONE  BOLLE **
306530941011 ** RECUPERO   CONFERMA   BOLLE **
306540990602 **   IMMISSIONE   PREPAGATI    **
306550030409** RigW  Max lung.67                                             67
306560030409              Spedizione da affidare a network FedEx
306570030409         Spedizione relativa ad ORM Commissionato da FedEx
306580030409- Indicare la NATURA DELLA MERCE in lingua inglese
306590030409- Indicare PESO e VOLUME reali
306600030409- Allegare COPIA della fattura alla lettera di vettura (DDT=SI)
306610030520- Allegare ai colli gli altri documenti ritirati dal cliente
306620030409- Indicare AWB FedEx nel Riferimento mittente numerico
306630030520- Allegare alla LDV TUTTI i documenti ritirati dal cliente (DDT=SI)
306640060110       Destinatario con obbligo del DDT in fase di consegna
306650060110Allegare alla LDV l'originale del documento di trasporto (DDT=SI)
306660151015        ATTENZIONE: Spedizione con Attraversamento Doganale.
306670151015Verificare che la NATURA MERCE sia conforme alla merce riportata
306680151015sul DDT
306690040329** cmdt
306700040329OVRDBF FILE(TITAS30C) TOFILE(
306710151014OVRDBF FILE(FIAR531C) TOFILE(
306720030409** ERR
306730030417Data cons. richiesta superiore a 1 mese dalla data odierna. ENTER x forzare   01
306740950920Data Spedizione formalmente errata  o  superiore a data sospensione xx/xx/xx
306750941020L'anno di spedizione non si puo' variare
306760941020Per le bolle di RECUPERO la Data Spedizione non puo' essere minore di 3 Giorni
306770061221Data Spedizione -per Spedizioni non di Recupero- non minore del xx/xx/xxxx
306780941020Data Ritiro Merce Errata
306790960926Data Ritiro Merce Errata:già confermati i conteggi autotrasp. in questa data
306800941020Linea di PARTENZA Errata
306810941021Immessa Varia "R" per 8888 o 9999 :obbligatorio l'imp.Assicur.Se 0 da tariffa 09
306820941020Codice Bolla Errato o non utilizzabile                                        10
306830941020Discordanza tra codice bolla e codice cliente mittente
306840110217Linea di Arrivo errata o annullata o bloccata                                 12
306850941020Non si puo' variare la linea di arrivo se bolla da cliente
306860941020Immettere la linea di arrivo
306870941110Tipo Servizio Errato o non inseribile dal bollettista                         15
306880941102Codice Trattamento Merce errato
306890950125ATTENZIONE!! TIPO SERVIZIO da x-xxxxxxxx   diventa  x-xxxxxxxx
306900030415Immettere il codice cliente se immessi i dati della Consegna Richiesta        18
306910941020Data Consegna Richiesta Errata
306920150202Ora Consegna richiesta Errata o non gestibile                                 20
306930960926Codice Autotrasportatore errato
306940941020Cliente Errato o Annullato
306950941020Codice inutilizzabile: cliente che non spedisce
306960941020Se immessa"Tassazione con Tariffa Mittente" inserire anche codice cliente mitt
306970941021Se immessa la Descrizione del Mittente indicare anche il codice: 8888 o 9999  25
306980980623ATTENZIONE! Spedizione di volume > xx,xxx mc. Avvisare ROM. ENTER per forzare 26
306990030728ATTENZIONE! Il numero colli è inferiore ai bancali inseriti                   27
307000940822Nazione Errata
307010950713Sigla Operatore non utilizzabile o non immessa
307020030905L'ORM richiede la bolla in Porto xxxxxxxxx                                    30
307030031029Non immettere la particolarità C/Assegno                                      31
307040031125Immettere la particolarità varia "O" per spedizione con bancali               32
307050941020Numero Spedizione gia' esistente o non immesso
307060941020Manca Numero COLLI
307070031125Immettere la particolarità varia "B" per spedizione con bancali               35
307080040216Referente e Telefono obbligatori per bolla Export con C/A. ENTER X FORZARE    36
307090941020Manca Dettaglio colli: inserirlo con F21 !!!
307100941021PESO Errato o diverso da precedente videata
307110941020MANCA NUMERATORE BOLLE: telefonare in Sede !!!!!!!
307120941020CONTO SERVIZIO : F6  per l'Immissione !!!                                     40
307130941020MANCA NUMERATORE PER STAMPA SEGNACOLLI: Telefonare in Sede !!!!!!
307140991117NUMERATORE BOLLE/SEGNACOLLI non disponibile: RITENTARE  NUOVAMENTE !!!
307150941102Se immesso tipo immettere anche la data o l'ora Consegna Richiesta
307160941020Inoltro Forzato:  F6  per Confermare l'Immissione
307170941102Numero Colli errato o diverso dalla prima videata                             45
307180980402Immettere il peso
307190941020Manca Riferimento Mittente Numerico
307200030805Serie ORM xx non gestita - AVVISARE IL CED                                    48
307210941020Serie incongruente con codice trattamento Merce
307220941020Numero Spedizione indicato in prima videata gia' esistente
307230941020Segnacollo Errato
307240980623ATTENZIONE! Spedizione di peso > xxxxxx,x kg. Avvisare ROM. ENTER per forzare 52
307250941020Manca natura merce
307260040216Referente e Tel. obbligatori per bolla EXPORT in P.Assegnato. ENTER X FORZARE 54
307270040727Spedizione già esistente!!!! Non è possibile confermare la bolla.             55
307280040213Bolla Export FedEx inserire il Telefono del destinatario. ENTER X FORZARE     56
307290090901T.Servizio "H" non ammesso per i tempi di trazione della bolla:F12 x corregg. 57
307300040216Spedizione con consegna a PRIVATI ins. il Telefono del dest.                  58
307310941110T A S S A Z I O N E   C O N   T A R I F F A   M I T T E N T E !!!!            59
307320090901Consegna richiesta non ammessa per tipo servizio "H"                          60
307330941020Zona digitata inesistente per la linea di arrivo della bolla
307340051007Consegna richiesta MINORE della data consegna teorica.
307350941020Giorno Chiusura Errato
307360030411§§Consegna particolare errata                                                 64
307370970408Impossibile annullare bolla LEGATA                                            65
307380030411§§dice Tariffa immesso ha TIPO SERVIZIO x-xxxxxxxx, diverso da quello in bolla66
307390100517Spedizione da cliente,impossibile modificare cod.Cliente Mittente:SERIE DIVERS67
307400030411§§Importo obbligatorio se immessa la sigla varia                              68
307410050429Non si puo' variare: bolla da disk clienti
307420030411§§Per bolla con C/Assegno e' obbligatoria la varia "G"                        70
307430100319ORM non inseribile: Tipo Servizio personalizzato o da disk"B" diverso dall'ORM71
307440100208Cod.Trattam.Merce "xx" non utilizzabile:forzato da"ConfermaBolle"in 1°videata 72
307450100319ORM non inseribile: linea Arrivo personalizzata o da disk"B" diversa dall'ORM
307460100319Forzata linea di arrivo e tipo servizio come da O.R.M.                        74
307470100319Forzato Tipo Servizio come da O.R.M.                                          75
307480100319Tipo Servizio diverso da quello definito sull'O.R.M.                          76
307490030411§§bligatorio dichiarare VALORE MERCE se destinat.estero con attraversam.dogana77
307500950410Non ammessi importi con decimali per la divisa indicata
307510950410Divisa errata                                                                 79
307520100210CAP Destin.Incongruente con L.Arrivo/PESO/VOLM:correggere T.Servizio"H" in "E"80
307530960926Codice non ammesso se cliente di altro punto operativo
307540941110Impossibile usare tariffa cliente per calcolare varia "G":tariffa inesistente
307550970724Bolla legata: impossibile impostare linea di arrivo uguale a linea di partenza83
307560950208Il cliente non presenta tariffe per la bolla ITALIA o ESTERO:ENTER per forzare84
307570950220La bolla presenta un numero segnacollo = 0 : verificare con F21               85
307580940909La serie non e' quella del cliente
307590940909Totale colli del dettaglio segnacolli non corrisponde
307600160303P.IVA obbligatoria se bolla Export con attraversam. dogana                    88
307610980310Non e' possibile inserire il numero AWB                                       89
307620970415CAP Destin.Incongruente con L.Arrivo/PESO/VOLM: ENTR x forzare; F12 x corregg.90
307630030904§§CAP Destinatario incongruente con Linea Arrivo:x spediz.in F.DEP. non si forza
307640941011SEGNACOLLO DOPPIO xxxxxxx  presente su  spedizione xxxx xxx xx xxxxxxx per xxx
307650940916Importo da Assicurare = 0 : ENTER per prendere il massimo importo da Tariffa
307660940916Importo da Assicurare obbligatorio, come indicato nella tariffa del cliente
307670011211Importo da Assicurare da non immettere, come indicato nella tariffa del clien.
307680011211Importo da Ass. > DEL LIMITE IMPOSTO XXXXXXXXXX,XXX EUR:TEL.IN SEDE X AUTORIZ.96
307690940916Importo da Assicurare superiore al mandato esposto in tariffa:ENTER x Forzare
307700940919Importo C/Assegno Errato
307710941110Tipo Incasso C/Assegno inesistente o non e' da indicare
307720110217Se immesso CAP o Nazione Mit.Originale immettere tutti 3 i campi:CAP NAZ e MIT
307730090921Fermo Deposito non ammesso per tipo servizio "H"                              01
307740940919Consegna Particolare inesistente o non utilizzabile
307750940919Particolarita' C/A errata,non ammessa o non utilizzabile x il cliente indicato
307760941219Errori in Tassazione                                                           4
307770001106Se modificata la divisa, ridigitare il relativo importo
307780950102Q.ta'da fatturare = 0 per tariffa a valore:ENTER per prendere importo da assic 6
307790950103Inserire la quantita' fatturare  per tariffa a valore
307800950102Q.ta'da fatturare non inseribile per tariffa a valore:assunto importo da assic 8
307810950103Q.ta'da fatturare = 0 per tariffa a quantita'
307820950525Riferimento mitt.alfabetico obbligatorio se destin.estero con attravers.dogana
307830950410Se Imp.Assicurare e Val.Merce uguali, devono anche avere la stessa divisa     11
307840950410Se stessa divisa, importo da Assicurare e Valore Merce devono essere uguali
307850030411§§IMPOSSIBILE ANNULLARE BOLLA: gia' consegnata                                13
307860030411§§IMPOSSIBILE ANNULLARE BOLLA: bolla in consegna                              14
307870950421Zona arrivo xx da bolla cliente diversa da zona xx risultante dal Cappario    15
307880950421Data fattura prepagato deve essere dello stesso mese della data spedizione    16
307890950525Impossibile forzare LINEA ARRIVO ITALIA se destinatario estero                17
307900950525Impossibile forzare LINEA ARRIVO ESTERA se destinatario italiano              18
307910950717"Tassazione con Tariffa Mittente"ammessa solo per assegnati con mittente codif19
307920951027Bolla non confermabile: segnacollo  xxxxxxx  presente piu' volte in bolla     20
307930951027Le consegne particolari non possono essere uguali                             21
307940050714Attenzione!! Verificare Importo da Assicurare e Valore Merce. ENTER X FORZARE 22
307950960213Fermo Deposito errato                                                         23
307960960319Spedizione legata a bolla precedente: non si puo' modificare il codice bolla
307970960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio: F12 x corregg
307980960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio
307990960805Bolla cliente con dettaglio colli: impossibile modificare il numero segnacolli27
308000970704Manca provincia del Mittente in anagrafica: INSERIRLA!!!!                     28
308010961111Se "FRANCO FRONTIERA" tassare la spedizione fino a Milano indicando il PORTO  29
308020080327Tipo Servizio immesso DIVERSO da tariffa e non forzabile                      30
308030011211Importo C/Assegno SUPERIORE al limite imposto XXXXXXXXXX,XXX EUR              31
308040030411§§Per porti assegnati EXPORT, impossibile inserire l'importo da assicurare    32
308050030411§§Per bolle IMPORT, impossibile inserire l'importo da assicurare              33
308060961204Per bolle di RESO  impossibile inserire il C/Assegno
308070970115Dicitura "                non ammessa nella natura merce per bolla ESTERO     35
308080970115Dicitura "                non ammessa nella natura merce per bolla ITALIA     36
308090970128Impossibile ristampare bolla non ancora stampata                              37
308100970328Bolle di recupero devono avere per forza  NO   D D T                          38
308110011212Il CAP prevede obbligatoriamente il documento di trasporto ( SI DDT )         39
308120970408Bolle dirette a nazione con attraversamento dogana devono avere   SI   D D T
308130970414Impossibile modificare linea di arrivo: bolla legata e legame gia' inviato
308140100118Non possono esserci bolle export con servizio XXXXXXXXXX                      42
308150970528Codice bolla non utilizzabile per bolle export                                43
308160030411§§Tassazione non ammessa per P.A. export. Accettata solo la varia N           44
308170971211Non e' possibile togliere il numero A.W.B.                                    45
308180980311Numero A.W.B. obbligatorio per questo codice mittente : F18 per inserirlo     46
308190971211Ultima cifra (CHECK DIGIT) del numero A.W.B. errata: deve essere x            47
308200030805Utilizzare codice bolla xx - ritiro contestuale a consegna.                   48
308210090921T.Servizio "H" non ammesso per C/Assegno da abilitare:F12 x correggere        49
308220030808Ritiro contestuale alla consegna: non trovato ORM abbinato. AVVISARE CED.     50
308230030411§§Impossibile variare il numero colli per bolle import etichettate EUROEXPRESS51
308240000904Codici "CHI SONO" mancanti: F22 per immetterli                                52
308250030411§§lla non confermabile:presenti in bolla segn.Euroexpress doppi.F22 X corregg.53
308260000904Il nr. colli non corrisponde al tot. cod."CHI SONO". F22 X CORREGGERE         54
308270980403Segn.EuroExpress XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX già presente in altra bolla   55
308280030411§§Impossibile selezionare cliente di altro Circuito                           56
308290060921Nazione destinatario valida per DPD soltanto per bolle di RESO!!              57
308300060922CAP inutilizzabile per il network xxx                                         58
308310990610Prepagato: Immettere nelle note il TELEFONO e REFERENTE del RITIRO            59
308320990610Prepagato: premere F14 per tassare o inserire tassazione fino all'imponibile
308330030411§§Non trovata tariffa per tassare i prepagati !!                              61
308340030411§§Per i prepagati i dati della fattura sono obbligatori                       62
308350990628Immettere la prestazione ritiro: mattina o pomeriggio                         63
308360990630MANCA NUMERATORE fatture Prepagati:impossibile confermare.Inserirlo in contab 64
308370060221Importo da assicurare INFERIORE a quanto previsto dalla legge                 65
308380030411§§Per i Prepagati, Numero fattura deve essere maggiore di XXXXXX              66
308390990830Data fattura modificata perche' gia' bloccata per contabilizzazione           67
308400990915Cod.Autotrasport.incongruente con indicazione di merce a magazzino.ENTR forza 68
308410991011E' obbligatorio indicare la divisa                                            69
308420030411§§Prepagati: cliente non codificato o senza tariffa obbligatoria la divisa xxx70
308430991026Numero di decimali errato per la divisa immessa                               71
308440030411§§Prepagati: utilizzare la divisa della tariffa del cliente, xxx              72
308450991026Codice bolla non valido per prepagati                                         73
308460991130Rif.Mittente numerico contiene PARCEL DPD non valido                          74
308470991203Numero PARCEL obbligatorio per EXPORT DPD : F18 per inserirlo                 75
308480991203Non e' possibile togliere il numero PARCEL DPD                                76
308490991203Il numero PARCEL DPD inserito non è corretto                                  77
308500991206Se linea di partenza DPD la spedizione deve essere di 1 collo                 78
308510991206Se linea di arrivo DPD la spedizione deve essere di 1 collo                   79
308520991213Spedizione D.P.D. : non ammesso un peso superiore a xxxxxx,x kg.              80
308530991214Numero  PARCEL D.P.D.  gia' presente                                          81
308540000113Data fattura errata perche'gia'contabilizzata ma impossibile il cambio d'anno!82
308550020214Linea di arrivo errata: non e' una linea prevista per il network              83
308560020214Numero DPD inseribile soltanto se richiesto il network DPD per l'estero       84
308570000120Numero DPD non inseribile: attribuito in modo automatico                      85
308580060612Manca il numero DPD. Inserirlo!!                                              86
308590061030Per network xxxxxx non ammesse spedizioni con C/Assegno per la nazione indicat
308600020214Non trovate tariffe DPD per il cliente: IMPOSSIBILE utilizzare il network DPD 88
308610061011CAP no trovato su cappario D.P.D:F12 x attivazione automatica int.Cappario DPD
308620000124Numero  PARCEL D.P.D.inserito in prima videata, gia' presente !!              90
308630060109Non si posso fare bolle export DPD per clienti soluzioni "B"
308640020214Per la nazione del destinatario non è previsto il network DPD                 92
308650000508Per corretta contabilizzazione,impossibile bollettare la fattura in SOSPENSION93
308660020201Tipo servizio non ammesso per la linea di partenza indicata                   94
308670000509Se linea di partenza POSTE la spedizione deve essere di 1 collo               95
308680000509Spedizione POSTE : peso superiore a xxxxxx,x kg.  Enter per forzare!          96
308690101022Data consegna richiesta immessa errata: cade in giorno festivo                97
308700000509Consegna particolare non ammessa per spedizione POSTE                         98
308710000509Sono ammesse solo spedizioni in  FRANCO  per le  POSTE
308720000509Ammessi soltanto clienti POSTE per spedizioni POSTE                           00
308730000622CAP o localita' inutilizzabili perche' obsoleti                               01
308740000622In conferma di bolle autogenerate POSTE non si puo'cambiare la linea di arrivo
308750000627Impossibile stampare la bolla:dati in controllo e non in aggiornamento!       03
308760000725Bolle poste: utilizzabili solo cod.trattamento merce soluzioni "B"            04
308770000830Presenti in bolla codici "CHI SONO" doppi. F22 PER CORREGGERE                 05
308780000904Terminal di partenza non abilitato all'uso del DISK C                         06
308790030904§§Cliente non abilitato all'uso del DISK C                                    07
308800000918Presenti in bolla codici "CHI SONO" errati. F22 PER CORREGGERE                08
308810020308ATTENZIONE:cod."CHI SONO"                                                     09
308820161215Immettere un autotrasportatore esistente per interrogare l'O.R.M.             10
308830001024Non trovato terminal di partenza della linea di partenza. TELEFONARE IN SEDE  11
308840001024Non trovato terminal di arrivo della linea di arrivo.     TELEFONARE IN SEDE  12
308850110217
308860001220SEGNAC.DOPPIO: presente su spedizione xxxx xxx xx xxxxxxx per xxx.ENTR x FORZ.
308870150929Cliente DPD: la linea di partenza deve corrispondere ad un p.o. DPD
308880010212Immettere il numero O.R.M.                                                    16
308890010212O.R.M. inesistente                                                            17
308900010220Immettere un  O.R.M. avente p.o. ritiro uguale alla linea di partenza bolla
308910010212O.R.M. in fase non bollettabile. ENTER PER FORZARE
308920010213Forzata linea di arrivo come da O.R.M.                                        20
308930010221Dati diversi rispetto a quelli definiti sull'O.R.M. ENTER PER FORZARE         21
308940010214Il numero O.R.M. non deve essere un prepagato                                 22
308950010214Il numero O.R.M. deve essere un prepagato                                     23
308960010215Codice tariffa diverso da quello definito sull'O.R.M.                         24
308970100319Linea di arrivo diversa da quella definita sull'O.R.M.                        25
308980100319ATTENZIONE:MODIFICATO O.R.M. - Alcuni dati potrebbero aver subito variazioni  26
308990010313La bolla presenta,nel dettaglio colli,un tot.colli errato: verificare con F21 27
309000010409O.R.M. annullato
309010020207Bolla Export       in p.ass.: immettere O.R.M. reale commiss. da p.o.         29
309020010504O.R.M. utilizzabile solo in "Conferma bolle da clienti". F20 PER FORZARE
309030090921Per tipo servizio "H" non ammesse consegne per APPUNTAMENTO o SUPERMERCATI    31
309040011112Divisa scaduta                                                                32
309050011114Manca la varia 'N'                                                            33
309060011211Importo da assicurare non ammesso                                             34
309070011212Importo da assicurare > di XXXXXXXXXX,XXX EUR: VERIFICARE. ENTER PER FORZARE  35
309080011212Importo C/Assegno INFERIORE a xxxxxxxxxx,xxx EUR                              36
309090011212Importo C/Assegno > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE       37
309100011212Valore merce dichiarato obbligatorio                                          38
309110011212Valore merce dichiarato INFERIORE a xxxxxxxxxx,xxx EUR                        39
309120011212Valore merce dichiarato SUPERIORE al limite imposto xxxxxxxxxx,xxx EUR        40
309130011212Valore merce dichiarato > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE 41
309140011212Gli importi inseriti SUPERANO il limite fatturabile, xxxxxxxxxx,xxx xxx       42
309150040116§§ orto varia SUPERA il limite fatturabile, xxxxxxxxxx,xxx xxx                43
309160020214Per la nazione del destinatario non è previsto il network FedEx               44
309170030221Bolla export FedEx: non ammesse spedizioni in C/Servizio                      45
309180020214Non trovate tariffe FedEx x il cliente:IMPOSSIBILE utilizzare il network FedEx46
309190020228Per la nazione del destinatario non è previsto il network Euroexpress         47
309200020319Non trovato il progressivo della tariffa di cartello: TELEFONARE IN SEDE      48
309210020320Linea di arrivo non manutenzionabile                                          49
309220020320Manca il numeratore per l'assegnazione dell'AWB FedEx:TELEFONARE IN SEDE      50
309230020320Numeratore AWB FedEx non disponibile: RITENTARE NUOVAMENTE !!!                51
309240020320Numeratore AWB FedEx oltre il massimo del range previsto: TELEFONARE IN SEDE  52
309250020417Non ammesso cliente mittente non codificato per P.A. Euroexpress              53
309260020507Bolle di recupero per bolle firmate devono avere  per forza  SI   D D T       54
309270040608Destinatario                 :immettere la relativa consegna particolare      55
309280020611C/servizio non ammesso per un prepagato                                       56
309290020731Non è possibile indicare contemporaneamente consegne particolari 'S' e 'X'    57
309300021111Spedizione xxxx xxx xx xxxxxxx per xxx già consegnata                         58
309310021118Valore merce dichiarato obbligatorio per territori Extra CEE                  59
309320021119Se immesso prefisso "FD" o "FM" tutti i segnacolli devo avere lo stesso pref. 60
309330021119Prefisso segnacollo valido solo per bolle FedEx                               61
309340021120Immettere codice tariffa della relativa cartello FedEx                        62
309350030904§§Non ammessa tariffa FedEx Documenti: peso superiore a Kg. xxxxxx,x          63
309360021120Peso incongruente con Bolla FedEx tipo Documenti                              64
309370030904§§Peso incongruente con Bolla FedEx tipo Merci                                65
309380021209Immettere il rif.mittente alfabetico, bolla con cons.particolare Supermercati 66
309390040213Spedizione con APPUNTAMENTO inserire il Telefono del destin.                  67
309400030114Immettere il n. bancali                                                       68
309410021218Tipo bancale errato                                                           69
309420021218Non ammesso stesso tipo bancale                                               70
309430030805Immettere il tipo e il n. bancali x particolarità varie "B" o "O"             71
309440030204Spedizione con bancali, verificare peso e volume                              72
309450030204Modificato il numero dei bancali, verificare peso e volume                    73
309460030805Immettere la particolarità varie "B" o "O" per spedizione con bancali         74
309470030321Bolla con più di 500 colli non è possibile bollettare "DISK C"                75
309480030411Immettere o i dati della consegna richiesta o il numero delle ore             76
309490051215Data consegna richiesta non ammessa: oltre                                    77
309500030415Le ore da aggiungere alla delivery devono essere:  24 - 48 - 72               78
309510130312Mancano dati per la gestione del Packing List/PDF del cliente                 79
309520040603Presenti progressivi riga duplicati nei dati per stampa DDT del cliente
309530040610Bolla senza colli: tipo merce V=valore non ammesso                            81
309540040614Impossibile annullare questa bolla "£ " --> già presente anche in arrivo      82
309550040917Attenzione: inserito mittente estero, VERIFICARE. Enter per continuare        83
309560040930Codice cliente non utilizzabile                                               84
309570041012Particolarità Varie='U':consegna per Appuntamento o a Supermercati non ammessa85
309580041013Per l'O.R.M. immesso già presenti altre bolle con diverso autotrasportatore   86
309590041110Spedizione che prevede la stampa del DDT nella LdV: obbligatorio NO DDT       87
309600041126Codice particolarità varie non utilizzabile per questa linea di partenza bolla88
309610041117ATTENZIONE! Il numero parcel DPD non inizia per 84. ENTER per FORZARE         89
309620041210ATTENZIONE! Manca il logo                                                     90
309630050221Presenti numeri parcel dpd da cliente ripetuti o in numero maggiore di 1      91
309640050309ATTENZIONE: manca il codice bolla. Telefonare IMMEDIATAMENTE in sede          92
309650050914Volume obbligatorio                                                           93
309660051214Consegna richiesta supera di                                                  94
309670060103Bolla in P.Assegnato diretta a destinatario che richiede il SI DDT.ENTER x FOR95
309680060109Bolla export DPD "Disk B":codice trattamento merce errato."Chi Sono" non Autom96
309690060208Prepagato già incassato: impossibile variare totale imponibile                97
309700060324Consegna part. per Appuntamento non valida: presente data consegna "Tassativa"98
309710060612Numero Parcel DPD non valido
309720060613Manca il numeratore per l'assegnazione del Parcel DPD:TELEFONARE IN SEDE      00
309730060613Numeratore Parcel DPD non disponibile: RITENTARE NUOVAMENTE !!!               01
309740060613Numeratore Parcel DPD oltre il massimo del range previsto: TELEFONARE IN SEDE 02
309750060621ATTENZIONE! Il numero parcel DPD non inizia per 084. ENTER per FORZARE        03
309760060707Per il Tipo Incasso C/Assegno richiesto immettere anche il Mittente Originale 04
309770060707Non è possibile variare Linea Arr. passando da network NON DPD a network DPD  05
309780061109Parcel DPD errato:i caratteri iniziali non corrispondono a un Depot esistente 06
309790090827Località non servita per il tipo servizio indicato                            07
309800061109Codice Fiscale obbligatorio per Prepagato non codificato: ENTER per forzare
309810061121O.R.M. commissionato da DPD: selezionare network "DPD"                        09
309820061127Presente C.A.: impossibile annullare                                          10
309830070307Linea di Arrivo     non ammessa per un prepagato di mitt. non codificato      11
309840070620Preapagato: numero O.R.M. non modificabile
309850070806Completare l'indirizzo del destinatario                                       13
309860071023P.Iva/Cd.Fiscale obbligatori per Prepagato non codificato: ENTER per forzare  14
309870071221Linea di arrivo non modificabile:presenti spunte sulla vecchia linea di arrivo15
309880071221Per la linea di arrivo richiesta mancano le spunte: modifica non ammessa      16
309890071221Linea di arrivo estera: non utilizzabile per manutenzione bolla cliente diskB 17
309900081110Codice bolla non valido per un codice trattamento merce di recupero           18
309910090325Codice cliente errato o inesistente                                           19
309920090325Codice cliente non utilizzabile: bloccato in Piano dei Conti                  20
309930090326Attenzione:cambiando l'ORM potrebbe cambiare il cliente/tariffa per tassazione21
309940090326Tasto funzionale non abilitato                                                22
309950090429ORM commissionato da DPD: la spedizione deve essere di 1 collo                23
309960090609Manca tabella Limiti per Tipo Servizio          - TELEFONARE IN SEDE          24
309970090901ATTENZIONE! Sped."   " di n.colli > xxxxx  non ammessa                        25
309980090901ATTENZIONE! Sped."   " di peso > xxxxxx,x Kg. non ammessa                     26
309990090901ATTENZIONE! Sped."   " di volume > xx,xxx mc. non ammessa                     27
310000091008Dato obbligatorio per Porto Assegnato Import                                  28
310010091112Effettuare almeno una selezione                                               29
310020091211Selezionare il mitt. OPPURE l'ordinante ORM                                   30
310030091211Tp.incasso C/A errato --> F12 x correggere                                    31
310040100215Particolarità CONSEGNA incongruente con tipo servizio della bolla             32
310050100217Particolarità CONSEGNA non ammessa se presente consegna richiesta             33
310060100217Particolarità CONSEGNA non ammessa per bolle di recupero o in C/servizio      34
310070101105Bolle dirette a  FEDEX  devono avere   SI   D D T                             35
310080110321ATTENZIONE! Presenti spunte entrata: F16 per forzare                          36
310090110419IMPOSSIBILE ANNULLARE IL PREPAGATO: O.R.M. già ritirato                       37
310100110419O.R.M. ASSEGNATO: disassegnare l'ORM per poter annullare il prepagato         38
310110110422ATTENZIONE: inserita data ritiro più vecchia di xx gg lavorativi.ENTERxFORZARE39
310120110516Presenti errori nell'indirizzo Email Destinatario                             40
310130110519Presenti bolle da VAS non confermate per il cliente mittente: VERIFICARE      41
310140110613Avviso al destinatario non previsto per bolla export                          42
310150130131Inserire la P.Iva o il Codice Fiscale.                                        43
310160151109P.Iva obbligatoria                                                            44
310170120508P.Iva "$$" non ammessa per prepagato                                          45
310180120515Bolla con attraversamento dogana: inserire la P.Iva o Cod.Fiscale se privato  46
310190120926Non si può trasformare un franco recupero in una bolla non di recupero        47
310200130312Nome PDF per gestione DDT del cliente già presente in altra bolla.Avvisare CED48
310210130313Cliente non abilitato al PDF.                                                 49
310220140114Presenti caratteri di punteggiatura all'Inizio e/o alla Fine della Località   50
310230140417Presenti errori nel numero di cellulare del destinatario                      51
310240141203Particolarità CONSEGNA con PIN CODE non gestita per Export:non sarà registrata52
310250141201Spedizione con PIN CODE: inserire una particolarità CONSEGNA con PIN CODE     53
310260141201Particolarità CONSEGNA con PIN CODE non valida per spedizione senza PIN CODE  54
310270141202Presente PIN CODE più lungo del massimo previsto: impossibile confermare      55
310280141202Presente PIN CODE con caratteri non ammessi: impossibile confermare           56
310290141203Non è possibile modificare la Particolarità Consegna: presente PIN CODE       57
310300150226Tipo Bancale non utilizzabile per particolarità varia "                       58
310310150226Cliente non abilitato all'utilizzo del tipo bancale per particolarità varia B 59
310320150413Spedizione per EXPO: non ammesso il Contrassegno                              60
310330150414Spedizione per EXPO possibile solo per bolle Franco                           61
310340150414Spedizione per EXPO non ammessa per la linea di arrivo                        62
310350151014Particolarità CONSEGNA "  " non ammessa per spedizioni export                 63
310360151106Codice Fiscale obbligatorio.                                                  64
310370160513O.R.M. commissionato da "EEX": la spedizione deve essere instradata a "EEX"   65
310380170113Bolla disk "B" non confermabile:manca Fil.Segnac. Verificare i dati ricevuti  66
310400170615Data Consegna Richiesta non ammessa per contrassegno da abilitare             67
310500170615Data Consegna Richiesta non ammessa per spedizione in Fermo Deposito          67
