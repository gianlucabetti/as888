000100120302     /*PRM dbgview(*source)
000110120302     /*CMD ovrdbf file(TITAS30C) tofile(GAITRAGRPS/TITAS30C) +
000120120302     /*CMD        ovrscope(*calllvl)
000130120302     /*CMD ovrdbf file(TNBLA00F) tofile(GAITRAGRPS/TNBLA00F) +
000140120302     /*CMD        ovrscope(*calllvl)
000150120302     /*END dltovr file(TITAS30C TNBLA00F) lvl(*)
000160120302     /*END
000170120302      *
000180000920     H DECEDIT('0,') DATEDIT(*DMY.)
000190940819     F* FNLS01R *-----------------------------------------------------*
000200900427     F*       IMMISSIONE BOLLE
000210040329      *
000220040329      * COMPILARE CON
000230040329      *               OVRDBF FILE(TITAS30C) TOFILE(GAITRAGRPS/TITAS30C)
000240050407      *
000250050407      * Annotazioni:
000260050407     c* La gest.del richiamo a fnls01r con §lpfpr='R'(recupero bolle DskCli)
000270050407     c* è rimasta nel pgm ma non viene più utilizzata. Non è stata tolta
000280050407     c* solo per comodità visto che è presente in più punti del pgm
000290000000     F*---------------------------------------------------------------*
000300001002     FFNLS01D   CF   E             WORKSTN
000310940923     F                                     SFILE(LS01S03:NRR)
000320000829     F                                     SFILE(LS01S08:NR8)
000330021203     FFIAPD01L  IF   E           K DISK
000340950920     FAZCLN01L  IF   E           K DISK
000350990630     FCNNUM00F  UF   E           K DISK    USROPN
000360940822     FCNACO00F  IF   E           K DISK
000370900427     FCNIND00F  IF   E           K DISK
000380050209     Ffncls01l  IF   E           K DISK
000390080904     FTNBLA00F  O  A E           K DISK    USROPN extfile(WTNBLA)
000400930120     FFLNUF01L  UF   E           K DISK
000410991117     FFLNUF02L  UF A E           K DISK
000420991117     F                                     RENAME(FLNUF:FLNUF2)
000430940822     FTNTAM01L  IF   E           K DISK
000440990818     FTITPT01L  IF   E           K DISK
000450930629     FAZORG01L  IF   F 5000     2PIDISK    KEYLOC(4)
000460991117     FTABEL00F  IF   E           K DISK
000470941110     FFNBLD01L  UF A E           K DISK
000480020917     FFIVAD02L  UF   E           K DISK    USROPN
000490020917     FFIVAT01L  UF   E           K DISK    USROPN
000500040601     FFIVAX01L  UF   E           K DISK    USROPN
000510110518     FFIVAb01L  UF   E           K DISK    USROPN
000520110518     Fedivab1L  UF   E           K DISK    USROPN
000530940825     F*
000540061212     FFNBLP01L  IF   E           K DISK
000550061212     F                                     INFDS(FNBLP1)
000560061212     F                                     RENAME(FNBLP000:FNBLP001)
000570061212     FFNBLP00F  UF A E             DISK
000580940825     F*
000590040601     FFIAR801L  UF A E           K DISK
000600130304     FFIAR802L  iF   E           K DISK    rename(fiar8000:fiar802)
000610940825     F* ESTENSIONE DESCRIZIONI
000620060216     FFiar401L  UF A E           K DISK
000630060215     FFiar403L  IF   E           K DISK
000640060215     F                                     RENAME(Fiar4000:Fiar4003)
000650060215     FFiar404l  IF   E           K DISK
000660060215     F                                     RENAME(fiar4000:Fiar4004)
000670021218     fFiar501l  uf a e           k Disk
000680940825     F*
000690991006     F* TASSAZIONE
000700991006     FFIAR701L  UF A E           K DISK
000710991006     FFIAR601L  UF A E           K DISK
000720940825     F*
000730940825     F* C/ASSEGNO
000740051115     FFiar901L  UF A E           K DISK
000750040603     F*
000760940825     F* DETTAGLIO COLLI
000770940825     FFNBLT01L  UF A E           K DISK
000780120814     FFIART01L  UF A E           K DISK
000790120817     FFIART27L  IF   E           K DISK
000800120817     F                                     RENAME(FIART000:FIART027)
000810120828     FFNBLT27L  IF   E           K DISK
000820120828     F                                     RENAME(FNBLT000:FNBLT027)
000830120816     F***FNBLT29L  IF   E           K DISK
000840120816     F***                                  RENAME(FNBLT000:FNBLT029)
000850120828     FFNART27L  IF   E           K DISK    prefix(BLT:3)
000860051102     FFIARS01L  UF A E           K DISK
000870051102     FFIARS02L  IF   E           K DISK
000880051102     F                                     RENAME(FIARS000:FIARS2)
000890940825     F*
000900940825     FFNLBL01L  UF   E           K DISK    USROPN
000910011126     FFIFTT02L  IF   E           K DISK
000920011126     FFIFST02L  IF   E           K DISK
000930011126     F                                     RENAME(FIFTT000:FIFST000)
000940070123     FFNBRV09L  UF   E           K DISK    USROPN
000950071221     FFNBRV07L  iF   E           K DISK    USROPN
000960071221     F                                     RENAME(Fnbrv000:Fnbrv007)
000970080313     F*TNTBE02L  UF A E           K DISK
000980080313     FTNTBE01L  IF   E           K DISK
000990970107     F* FILE DI EDI
001000970107     FEDRDE01L  UF   E           K DISK    USROPN
001010000204     FFISGN01L  UF A E           K DISK
001020001005     FFISGN05L  UF A E           K DISK
001030001005     F                                     RENAME(FISGN000:FISGN005)
001040010212     F*
001050010212     FFNORM01L  IF   E           K DISK
001060100319     FFNORE01L  IF   E           K DISK
001070120611     FFIDST01L  IF   E           K DISK
001080010214     FFNFVV01L  IF   E           K DISK
001090051123     FFNANM02L  UF   E           K DISK
001100051124     FFNANM01L  UF   E           K DISK
001110051124     F                                     RENAME(FNANM000:FNANM01)
001120061107     Fdppdc00f  O    E             DISK
001130040329      * Bolle sede
001140040329     fTitas30c  if   e           k Disk    UsrOpn
001150060209      * STORICIZZAZIONE VARIAZIONI
001160060209     FFIARBT0F  O  A E             DISK    usropn
001170060209     FFIARBU0F  O  A E             DISK    usropn
001180070404     FFIARG01L  UF A E           K DISK
001190070530     F*
001200080221     f**!!!fipdo01t  if   e           k disk
001210070601     ffnorf01l  if   e           k disk
001220070612     FEDTAB01L  IF   E           K DISK
001230070626     ffidpo03l  if   e           k disk
001240100323     fazfgi01l  if   e           k disk
001250970107     F*
001260941221     FFNLV22P   O    F  132        PRINTER
001270960926     D L1              S              3  0 DIM(30)
001280070807     D L6              S              3  0 DIM(30)
001290970925     D*
001300940922     D CPA             S              2    DIM(30)
001310970115     D*
001320970115     D TBO             S              1    DIM(30)
001330970115     D LDC             S              2    DIM(30)
001340941108     D*
001350941107     D TSP             S              1    DIM(10)
001360941107     D UTS             S              1    DIM(10)
001370941115     D STS             S              1    DIM(10)
001380941107     D DTS             S             15    DIM(10)
001390000509     D USO             S              1    DIM(10)
001400090604     D DTS08           S              8    DIM(10)
001410090609     D DTS03           S              3    DIM(10)
001420090827     D TSttc           S              5    DIM(10)
001430960209     D*
001440960209     D TBL             S              2    DIM(20)
001450101022     D S1Y             S              1    DIM(20)
001460940916     D*
001470940923     D K07             S              1    DIM(7)
001480940923     D K09             S              1    DIM(9)
001490940919     D K35             S              1    DIM(35)
001500950920     D K31             S              1    DIM(31)
001510940919     D K78             S              1    DIM(78)
001520970115     D K89             S              1    DIM(89)
001530950104     D SKI             S              1    DIM(15)
001540011211     D SKII            S              1    DIM(14)
001550001214     D KOL             S             10    DIM(20)
001560971211     D*
001570971211     D KSS             S              7    DIM(12)
001580940922     D*
001590900611     D GGG             S              1    DIM(8) CTDATA PERRCD(8)
001600990602     D DES             S             34    DIM(6) CTDATA PERRCD(1)
001610060110     d rigw            s             67    Dim(10) Ctdata Perrcd(1)
001620040329     d cmdt            s             60    dim(01) ctdata perrcd(1)
001630130313     D ERR             S             78    DIM(349) CTDATA PERRCD(1)
001640930611     D*
001650980318     D*  SCHIERE PER COMPORRE SEGNACOLLO EUROEXPRESS
001660980318     D §S9             S              1    DIM(9)
001670980318     D §O9             S              1    DIM(9)
001680980330     D W35             S              1    DIM(35)
001690991201      *  SCHIERA PER COMPORRE BARCODE SU LETTERA VETTURA DPD IMPORT
001700991201      *  SCHIERA PER COMPORRE RMN IN STAMPA SEGNACOLLO DPD IMPORT
001710991201     D W15             S              1    DIM(15)
001720991026      *
001730000830     D* COD. CHI SONO PER CONTROLLI DI RECORD DOPPIO
001740021104     D CHI             S             35    DIM(500)
001750021104     D POS             S              4  0 DIM(500)
001760021104     D ANN             S             15  0 DIM(500)
001770021104     D CH2             S             35    DIM(500)
001780021119     d Prefisso        s              2    Dim(500)
001790930629     D UNIORG        E DS          5000    EXTNAME(AZORG00F)
001800040116      * sk x gestire le varie della seconda bolla
001810041217     d w2sv            s              1    Dim(6)
001820041217     d w2va            s             11  3 DIm(6)
001830061011     d
001840061011     D CAP             S              1    DIM(9)
001850061011     D CAF             S              1    DIM(9)
001860020212     D*
001870130117
001880130117      // - Sk per Tabella OSR
001890130117     d skCLIosr        s              7  0 dim(900)
001900130117     d skLNPNRSosr     s              5    dim(900)
001910130117
001920130117      // - Indici di schiera
001930130117     d osrxx           s              3  0 inz
001940130117
001950130117      // - Campo di comodo per Ordinante ORM lungo 7
001960130117     d wORMcor         s              7s 0 inz
001970130117
001980090827     d Wttc            s              5
001990090827     d WttcCAP         s              5
002000100319     d KoreTrc         s                   like(oretrc) inz('G')
002010100319     d KAr5Trd         s                   like(Ar5Trd)
002020060515     d Bolksc          s                   Like(blpksc)
002030060515     d Bolctr          s                   Like(vidctr)
002040110304     d savnot          s                   Like(tamnot)
002050020212     D wawb            s             11  0
002060020212     D wawbini         s             11  0
002070021119     d Wpre            s              2
002080030204     d wPkg            s              1
002090030204     d wNba            s              1
002100030204     d w0071           s              7  1
002110030204     d w0053           s              5  3
002120050119     d wsolo_prp       s              1
002130030204     d wTbaPkg1        s                   Like(§TbaPkg)
002140030204     d wTbaVol1        s                   Like(§TbaVol)
002150030204     d wTbaPkg2        s                   Like(§TbaPkg)
002160030204     d wTbaVol2        s                   Like(§TbaVol)
002170030204     d SavNba          s                   Like(§Ar5Nba)
002180030204     d SavNb2          s                   Like(§Ar5Nb2)
002190090804     d w_ar5ass        s                   Like(§Ar5ass)
002200091001     d w_ar5tcp        s                   Like(§Ar5tcp)
002210091001     d w_ar5tic        s                   Like(§Ar5tic)
002220091214     d w_ar5cdi        s                   Like(§lpcdi)
002230091001     d sav_tc1         s                   like(vidtc1)
002240091001     d sav_tc2         s                   like(vidtc1)
002250030304     d wrma            s              1    Inz
002260030409     d Dataiso         s               d   datfmt(*iso)
002270030415     d woggi5          s              8  0
002280051214     d*woggi1m         s              8  0
002290051214     d woggidcgm1      s              8  0
002300051214     d woggidcgm2      s              8  0
002310051214     d s_woggidcg      s                   like(woggidcgm1)
002320051214     d s_vpodcg        s                   like(§vpodcgm1)
002330080603     d datam40         s              8  0
002340130305     d datapdf         s              8  0
002350030409     d wwtcr           s              1
002360030409     d wflagore        s              1
002370030409     d wore            s              3  0
002380030409     d §ore            s              2  0
002390030417     d fordcr          s              1    Inz
002400060103     d savddt          s                   like(vidbam)
002410030520     d wnonum          s              1    Inz
002420030704     d wforw03         s              1    Inz
002430030704     d wtotncl         s              6  0
002440030708     d savw03cor       s                   Like(§Ar5bCor)
002450030708     d savw03csf       s                   Like(§Ar5bCsf)
002460030718     d savinkh         s              1
002470030718     d savinki         s              1
002480030728     d wfornba         s              1    Inz
002490030728     d wtotnba         s              3  0
002500031125     d wgva            s              1
002510030805     d wkosr           s              5  0
002520030805     d w012a           s             12
002530040608     d w016ad          s             16
002540031001     d wfortbo         s              1    Inz
002550031201     d wnoccm          s              1    Inz
002560031201     d wforpf          s              1    inz
002570091006     d wope            s                        Like(I28Ope)
002580031219     d wrifp           s                        Like(VatNot)
002590040114     d va2va2          s                        Like(Vi2Va2)
002600040114     d va2va3          s                        Like(Vi2Va3)
002610040114     d va2va4          s                        Like(Vi2Va4)
002620041217     d va2va5          s                        Like(Vi2Va5)
002630041217     d va2va6          s                        Like(Vi2Va6)
002640040603     d s_vaxprr        s                        Like(vaxprr)
002650050119     d s_vidorm        s                        Like(vidorm)
002660050315     d s_ormpers       s              1
002670040114     d war71           s              1
002680040116     d ContaSv         s              2  0
002690121123     d wesvar1         s              1
002700040216     d wforza1         s              1    inz(*off)
002710040216     d wforza2         s              1    inz(*off)
002720110321     d wforzbrv        s              1    inz(*off)
002730110422     d wforzadrt       s              1    inz(*off)
002740110321     d wcheck          s              1    inz(*off)
002750040226     d p26vol          s              8  3
002760040226     d wrifm           s              1    Inz(*Off)
002770040301     d wkk             s              1    Inz(*Off)
002780040319     d wmodorm         s              1    Inz(*Off)
002790040329     d LnpOgAs         s                   Like(§OgAs)
002800070529     d s_§ogpdaorm     s                   Like(§Ogpdaorm)
002810080111     d*g_ormpor        s                   Like(ormpor)
002820040329     d wlib            s             10
002830040329     d comman          s             80
002840040329     d lenght          s             15  5 inz(80)
002850040302
002860040302     d wtxt            S           2048
002870040302     d TxtInOut        S           2048
002880040302     d ElencoChar      S            256
002890040302     d TipoElenco      S              1
002900100219     d UsaCAss         S              1
002910040302     d CharSost        S              1
002920040302     d UpperCase       S              1
002930040302     d ChkNull         S              1    Inz('1')
002940040302     d CharNull        S              1
002950040302     d Esito           S              1
002960050209     D wclsflo8        S              1
002970081008     D w005a           S              5
002980050331     d wKSCsf1         s              4  0
002990050331     d wKSCsf2         s              4  0
003000051214     d s_d98dce        s                   like(d98dce)
003010061011     d savcapDPD       s                   like(vidcad)
003020061109     d savrsm          s                   like(vidrsm)
003030070827     d W_vidind        s                   like(vidind)
003040061109     d wcdf            s                   like(vidcdf)
003050071022     d wiva            s                   like(vidpim)
003060061221     d salvatgi        s                   like(g02tgi)
003070081014     d §3cabd_s        s                   like(§3cabd)
003080081023     d cbo_blp         s                   like(vidcbo)
003090061011     d Cappariodpd     S              1
003100120611     d w0050           S              5  0
003110080904     d WTNBLA          s             21    inz('GAITRAGRU /TNBLA00F')
003120091221     d wvidgma         s                   like(vidgma)
003130100604     d w7rRC           s                   like(§7rRC)
003140100319     d Wofit           s             11  0 inz(99999999999)
003150100323     d kksc            s                   like(acoksc)
003160100323     d klnp            s                   like(blplnp)
003170100323     d klna            s                   like(blplnp)
003180110518     d s_wksc          s                   like(wksc) inz(0)
003190111122     d prelnp          s                   like(vidlnp)
003200111123     d pr0lnp          s                   like(v0clnp)
003210130308     d w_allx          s              1
003220130408     d w_allm          s              1
003230130417     d w_alls          s              1
003240130308     d wvatpe          s              1
003250130308     d wvatp           s              1
003260130306     d wvax            s              1
003270130403     d w_prr           s                   like(ar8prr)
003280130306     d w_pdfn          s              1
003290020212     D*
003300940930     D* PASSO A GESTIONE DETTAGLIO COLLI DA DISK CLIENTI-FNLS78R -
003310900511     D PARAM           DS
003320950321     D  PARCCM               101    107  0
003330941221     D  PARAAS               108    111  0
003340941221     D  PARLNP               112    114  0
003350941221     D  PARNRS               115    116  0
003360941221     D  PARNSP               117    123  0
003370941221     D  PARLNA               124    126  0
003380941221     D  VI3FNS               127    127
003390941221     D  KCI                  128    131  0
003400020917     D  PARFGS               132    134  0
003410021203      * Ds esterna per ricerca codice padroncino
003420021203     D FNLV24DS      E DS
003430991008     D* STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO/PREPAGATI DA KPJBU
003440950118     D PARAM3          DS
003450950118     D  WPGMSS               246    255
003460990602     D  PARTCH               256    256
003470951228     D* PASSO A CREAZIONE NUMERATORI                   - FNLVCNR -
003480951228     D PARAM4          DS
003490951228     D  PA4CNU                 1      3  0
003500990701     D* PASSO A TASSAZIONE BOLLE                       - TNSF20R -
003510990701     D PARAMF          DS
003520990701     D  WFIAS                256    256
003530940822     D V0DMIT          DS
003540940822     D  V0CRSM                 1     35
003550940907     D  V0CINM                36     70
003560940907     D  V0CLOM                71    105
003570940907     D  V0CCAM               106    114
003580940907     D  V0CPRM               115    116
003590940907     D  V0CNZM               117    119
003600940825     D VIDMIT          DS
003610940825     D  VIDRSM                 1     35
003620940907     D  VIDINM                36     70
003630940907     D  VIDLOM                71    105
003640940907     D  VIDCAM               106    114
003650940907     D  VIDPRM               115    116
003660940907     D  VIDNZM               117    119
003670940824     D*
003680940824     D                 DS
003690940927     D  V0CISM                 1      2
003700940927     D  V0CCPM                 3     16
003710940927     D  V0CPIM                 1     16
003720940824     D                 DS
003730940927     D  VIDISM                 1      2
003740940927     D  VIDCPM                 3     16
003750940927     D  VIDPIM                 1     16
003760940824     D                 DS
003770940927     D  VIDISD                 1      2
003780940927     D  VIDCPD                 3     16
003790940927     D  VIDPID                 1     16
003800940824     D                 DS
003810940927     D  WISO                   1      2
003820940927     D  WCPI                   3     16
003830940927     D  WPIVA                  1     16
003840900427     D TCUDS           DS
003850000000     D  F1                     1      1
003860000000     D  F3                     3      3
003870000000     D  F2                     2      2
003880000000     D  F4                     4      4
003890000000     D  F56                    5      6
003900900514     D                 DS
003910900514     D  VIDLNP                 1      3  0
003920900514     D  VIDNRS                 4      5  0
003930900514     D  VIDNSP                 6     12  0
003940900514     D  VIDSPE                 1     12  0
003950040506     d                 DS
003960040506     d  widlnp                 1      3  0
003970040506     d  widnrs                 4      5  0
003980040506     d  widnsp                 6     12  0
003990040506     d  widspe                 1     12  0
004000900514     D                 DS
004010120828     D  BLTLNP                 1      3  0
004020120828     D  BLTNRS                 4      5  0
004030120828     D  BLTNSP                 6     12  0
004040120828     D**ARTLNP                 1      3  0
004050120828     D**ARTNRS                 4      5  0
004060120828     D**ARTNSP                 6     12  0
004070910829     D  BLPSPE                 1     12  0
004080940214     D                 DS
004090940214     D  VARNCL                 1      5  0
004100940214     D  VARCDP                 6     20
004110940214     D  VARCN                  1     20
004120950921     D                 DS
004130950921     D  WAA                    1      4  0
004140950921     D  WMM                    5      6  0
004150950921     D  WGG                    7      8  0
004160950921     D  WDATA                  1      8  0
004170991201      * PER SEGNACOLLO DPD
004180991214     D                 DS
004190991214     D  DPDSTA                 1     26
004200991214     D  DPDCOS                 1     12
004210991214     D  DPDSTP                13     26
004220991214     D  DPDS1                 13     15
004230991214     D  DPDV1                 16     16    INZ
004240991214     D  DPDS2                 17     24
004250991214     D  DPDV2                 25     25    INZ
004260991214     D  DPDS3                 26     26
004270991214     D                 DS
004280991214     D  DPDPAR                 1     12
004290991214     D  DPD1                   1      3
004300991214     D  DPD2                   4     11
004310991214     D  DPD3                  12     12
004320940819     D***
004330940819     D* PARAMETRI PER CONTROLLO DATA E TRASFORM IN GIORNI - XSRDA8 -
004340940819     D***
004350940819     D WLBDAT          DS                  INZ
004360940819     D  G02DAT                 1      8  0
004370940819     D  G02INV                 9     16  0
004380940819     D  G02ERR                17     17
004390940819     D  G02TGI                18     22  0
004400940819     D***
004410940819     D* PARAMETRI PER TRASFORM GIORNI IN DATA             - XSRDGI -
004420940819     D***
004430940819     D WGIDAT          DS                  INZ
004440940819     D  GIODAT                 1      8  0
004450940819     D  GIOINV                 9     16  0
004460940819     D  GIOTGI                17     21  0
004470000000     D KPJBA         E DS
004480991117      * CALCOLO DEL CHCK DIGIT PER BARCODE DPD
004490991117     D                 DS
004500991117     D  DPDLNP                 1      3  0
004510991117     D  DPDGMS                 4      7  0
004520010222     D  DPDNDS                 8     11  0
004530991117     D  §11                    1     11  0
004540991201     D                                     DIM(11)
004550991117     D  DPDCHD                12     12  0
004560991117     D  DPDBRC                 1     12  0
004570000915     D                 DS
004580000915     D  V8HFLS                 1      3  0
004590000915     D  V8HLNA                 4      6  0
004600000915     D  V8HNRS                 7      8  0
004610000915     D  V8HNSC                 9     15  0
004620000915     D  V8HCOL                 1     15  0
004630000915     D                 DS
004640000915     D  KFLSAN                 1      3  0
004650000915     D  KLNAAN                 4      6  0
004660000915     D  KNRSAN                 7      8  0
004670000915     D  KNSCAN                 9     15  0
004680000915     D  KANNUL                 1     15  0
004690010212     D                 DS
004700010213     D  WOPOE                  1      3  0
004710010222     D  WONSR                  4      5  0
004720010222     D  WONOR2                 6     12  0
004730010222     D  WONOR                  4     12  0
004740010213     D  WONRV                 13     14  0
004750010222     D  WIDOR1                 4     14  0
004760010215     D  WIDORM                 1     14  0
004770010215     D                 DS
004780010215     D  VIDPOE                 1      3  0
004790010222     D  VIDNOR                 4     12  0
004800010215     D  VIDNRV                13     14  0
004810010215     D  VIDORM                 1     14  0
004820010219     D                 DS
004830010219     D  V0CPOE                 1      3  0
004840010222     D  V0CNOR                 4     12  0
004850010219     D  V0CNRV                13     14  0
004860041220     D  V0CORM1                4     14  0
004870010219     D  V0CORM                 1     14  0
004880041220     D                 DS
004890041220     D  s_v0cpoe               1      3  0
004900041220     D  s_v0cnor               4     12  0
004910041220     D  s_v0cnrv              13     14  0
004920041220     D  s_v0corm               1     14  0
004930030805     d                 ds
004940030805     d  savOrmPoe              1      3  0
004950030805     d  savOrmNsr              4      5  0
004960030805     d  savOrmNor              6     12  0
004970030805     d  savOrmNrv             13     14  0
004980030805     d  savkeyorm              1     14  0
004990040227
005000040227     d  OrmRfa         ds
005010040227     d  wrmbolla               1      1
005020040227     d  wrmaas                 2      3
005030040227     d  wrmlnp                 4      6
005040040227     d  wrmnrs                 7      8
005050040227     d  wrmnsp                 9     15
005060030805
005070000901     D DSBLD7        E DS
005080000901     D  §C                     1     17  0
005090000901     D                                     DIM(17)
005100001012     D                 DS
005110000911     D  §CB                    1     18  0
005120000901     D                                     DIM(18)
005130000911     D  §CA                    1     18
005140000911     D                                     DIM(18)
005150001012     D                 DS
005160001012     D  §2                     1      2  0
005170000901     D                                     DIM(2)
005180001012     D  §2A                    1      2
005190000901     D                                     DIM(2)
005200991011     D* DS PER YEURCO - EURO CONVERTITORE
005210991011     D DSYEUR        E DS                  EXTNAME(YEURCODS)
005220061109     d
005230061109     d* Controllo codice fiscale
005240061109     d xcfivads      e ds
005250061109     d
005260061110     D* DS PER YCO601R - RICERCA codice fiscale
005270061109     D YCO600DS      E DS
005280940819     D*
005290991007     D DS$2          E DS
005300991007     D OG148         E DS
005310000204     D OG150         E DS
005320000204     D OG143         E DS
005330020213     D A_og143       E DS                  EXTNAME(OG143)
005340020213     D                                     prefix(A_)
005350040525     D A_og150       E DS                  EXTNAME(OG150)
005360040525     D                                     prefix(A_)
005370080623     D edidspu       E DS
005380000623     D DSBL4W        E DS
005390000623     D DSBL4J        E DS
005400010212     D DSBL4M        E DS
005410110706     D DSBL44        E DS
005420061122     D S_dsbl4m      E DS                  EXTNAME(dsbl4m)
005430061122     D                                     prefix(S_)
005440070620     D  s_§b4orm               1     14  0
005450070627     D  s_§b4fit               4     14  0
005460070620
005470020523     D DSBL4A        E DS
005480010925     D DSBL4Z        E DS
005490061003     D*DSBL4F        E DS
005500060509     D DSBL4I        E DS
005510060509     D DSBL4K        E DS
005520991203     D DSBL4E        E DS
005530971215     D DSBLDE        E DS
005540971215     D DSBLD         E DS
005550000627     D DBLP          E DS
005560991007     D DTAS          E DS
005570040329     d  §tasflo      e                     extfld(tasflo)
005580991007     D DTASV         E DS
005590941108     D  VSV                    1     20
005600941108     D                                     DIM(20)
005610991008     D  VVA                   21    140P 3
005620991007     D                                     DIM(20)
005630991007     D  VES                  141    160
005640941108     D                                     DIM(20)
005650971216     D DS1A          E DS
005660900529     D DS1B          E DS
005670940928     D DS1P          E DS
005680061030     d
005690940928     D DS15          E DS
005700080414     D*ds15x         E DS                  EXTNAME(ds15)
005710080414     d**                                   prefix(X_)
005720061030     d
005730101022     D DS1Y          E DS
005740101022     D DS3A          E DS
005750921217     D DS3C          E DS
005760100517     D** D3cp          E DS
005770940825     D DS3I          E DS
005780991213     D DS3IDP        E DS
005790000509     D DS3IPT        E DS
005800941102     D DS5E          E DS
005810980806     D DS7T          E DS
005820041126     D DS7S          E DS
005830051124     D DS7c          E DS
005840100217     D DS7R          E DS
005850921217     D DSCC          E DS
005860921217     D DSCT          E DS
005870940826     D DSCV          E DS
005880011108     D DSCW          E DS
005890020725     D DYIV          E DS
005900000124     D DSTA01        E DS
005910061002     d* campo §tasflo della DTAS
005920061002     D DTAS01        E DS
005930000124     D DSTB          E DS
005940940914     D DSQT1         E DS
005950921217     D DSTM          E DS
005960060208     D DS7L          E DS
005970991008     D DGED          E DS
005980991008     D DGEI          E DS
005990010924     D DORM01        E DS
006000010409     D DDFT          E DS
006010010409     D  §DFORA       E                     EXTFLD(D§DFTORA)
006020010409     D  §DFORR       E                     EXTFLD(D§DFTORR)
006030010409     D  §DFTOR       E                     EXTFLD(D§DFTTOR)
006040010409     D  §DFTCO       E                     EXTFLD(D§DFTTCO)
006050010409     D  §DFDDT       E                     EXTFLD(D§DFTDDT)
006060010409     D  §DFPAG       E                     EXTFLD(D§DFTPAG)
006070010409     D  §DFPKG       E                     EXTFLD(D§DFTPKG)
006080010409     D  §DFBNC       E                     EXTFLD(D§DFTBNC)
006090010409     D  §DFMAX       E                     EXTFLD(D§DFTMAXKG)
006100000120     D DCHI          E DS
006110010212     D DFAR          E DS
006120010215     D  §FARDS       E                     EXTFLD(D§FARDES)
006130010215     D  §FARFB       E                     EXTFLD(D§FARFFB)
006140010309     D  §FARNF       E                     EXTFLD(D§FARNONF)
006150010319     D  §FARMN       E                     EXTFLD(D§FARMAN)
006160010319     D  §FARST       E                     EXTFLD(D§FARSTP)
006170010319     D  §FARAF       E                     EXTFLD(D§FARAFVV)
006180010319     D  §FARCF       E                     EXTFLD(D§FARCFVV)
006190011025     D  §FAROO       E                     EXTFLD(D§FARNOO)
006200011025     D  §FARUV       E                     EXTFLD(D§FARUVA)
006210011025     D  §FARDV       E                     EXTFLD(D§FARDVA)
006220060103     d ddstflo       e ds
006230021120     D DDFE          E DS
006240021218     d Dar5Ban       e Ds
006250030704     d Dar5Bnb       e Ds
006260130306     d Dar8§pdf      e Ds
006270030204     d dTba          e ds
006280030326     d dDcr          e ds
006290030805     d dAr5Rcc       e Ds
006300030805     d dOsr          e Ds
006310031113     d Dar5Gen       e Ds
006320100319     d DoreGen       e Ds
006330110512     d Dar5Emd       e Ds
006340031125     d dVato         e ds
006350110704     d dVat4         e ds
006360130306     d dVatP         e ds
006370130315     d dVats         e ds
006380040701     d dVpoppt       e ds
006390041217     d dVpo          e ds
006400060207     d dVpodeco      e ds
006410121017     d ddgd          e ds
006420081111      * Ds date statistiche
006430081111     d dSdf          e ds
006440110818     d*** dVUS          e ds
006450110818     d dxco          e ds
006460110818     D  vaa                    1     10    dim(10)
006470060612     d dVate         e ds
006480070529     d dPdo          e ds
006490071220     d dcli          e ds
006500090625     d trulticds     E DS
006510100517     d trulNRSds     E DS
006520061106     D TRULdepds     E DS
006530030610      * DS - PARAMETRI PER STAMPA BOLLE ED ETICHETTE
006540030610     D TRUL90DS      E DS
006550030611     D WTRUL90DS     E DS                  extname(TRUL90DS) prefix(W)
006560060619      * DS PER FIEU12R - CREAZIONE EVENTI FISSI DPD
006570060619     D fieu12ds      E DS
006580941005     D* DS PER TRTB69R - TRTB70R - TRTB72R - TRTB73R - INT E GEST PARTI
006590941005     D DS7PQR        E DS                  EXTNAME(DS7PQRS)
006600940919     D* DS PER TRUL06R - CARICAMENTO £X
006610940919     D DSUL06        E DS                  EXTNAME(TRUL06DS)
006620940919     D  LIN                    1     90  0
006630960926     D                                     DIM(30)
006640011211     D* DS PER TRUL21R - CONTROLLO LIMITI IMPORTO DA C/ASSEGNO
006650011211     D DSUL21        E DS                  EXTNAME(TRUL21DS)
006660011211     D* DS PER TRUL22R - CONTROLLO LIMITI IMPORTO DA ASSICURARE
006670011211     D DSUL22        E DS                  EXTNAME(TRUL22DS)
006680011211     D  I22TLS       E                     EXTFLD(I22TLA)
006690011211     D  I22LNS       E                     EXTFLD(I22LNA)
006700011212     D  I22LPS       E                     EXTFLD(I22LNP)
006710011212     D* DS PER TRUL23R - CONTROLLO LIMITI VALORE MERCE
006720011212     D DSUL23        E DS                  EXTNAME(TRUL23DS)
006730090608     D* DS PER TRUL73R - CONTROLLO LIMITI per tipo servizio
006740090608     D trul73ds      E DS
006750020320     D* DS PER TRUL33R - REPERIMENTO/AGGIORNAMENTO NUMERATORI SU AZNUM
006760020320     D TRUL33DS      E DS
006770991102     D* DS PER TIBS02R - GESTIONE TNTBE00F
006780991102     D DSBS02        E DS                  EXTNAME(TIBS02DS)
006790050502     D* DS PER FNLV20R - DS DEI CAMPI PER CALCOLO VOLUME DA FATTURARE
006800050502     D DSLV20        E DS                  EXTNAME(FNLV20DS)
006810030626     D* DS PER STAMPA BOLLA
006820030626     D fnlsb5DS      E DS
006830130315     d FNLSB6ds1     e ds                  inz
006840130419     d   DB6pdf      e                     inz('X')
006850991014     D* DS PER FNLV04R - CALCOLO TOTALE FATTURA SE IMMESSO NUMERO E DAT
006860991014     D DSLV04        E DS                  EXTNAME(FNLV04DS)
006870970707     D* DS PER FNLV13R - CONTROLLO DI UN CAP
006880970707     D DSLV13        E DS                  EXTNAME(FNLV13DS)
006890970707     D* DS PER FNLV14R - CONTROLLO DI INDIRIZZO COMPLETO  SENZA CAP
006900970707     D DSLV14        E DS                  EXTNAME(FNLV14DS)
006910970702     D* DS PER TISI95R - CONTROLLO DI CAP
006920970702     D DSSI95        E DS                  EXTNAME(TISI95DS)
006930060922     D TISI97DS      E DS
006940060619     D* DS PER TISIE3R - CAPPARIO DPD  - NUOVO
006950060619     D TISIe3ds      E DS
006960061011     D* DS PER TISIE8R - interrogazione CAPPARIO DPD  - NUOVO
006970061011     D TISIe8ds      E DS
006980991008     D* DS PER FNLV16R - CONTROLLO TASSAZIONE
006990991008     D DSLV16        E DS                  EXTNAME(FNLV16DS)
007000040115     D DLV1601       E DS
007010941025     D* DS PER FNLV18R - CALCOLO DI UN VOLUME AUTOMATICO
007020941025     D DSLV18        E DS                  EXTNAME(FNLV18DS)
007030060215     D* DS PER FNLV19R - PER SCRITTURA Fiar400F
007040941028     D DSLV19        E DS                  EXTNAME(FNLV19DS)
007050050920     D* DS PER FNLV59R - CARICAMENTO E CONTROLLO TARIFFE DI 1 CLIENTE
007060050920     D fnlv59ds      E DS
007070970925     D* DS PER FNLV55R - RICERCA TERMINAL DI PARTENZA/ARRIVO
007080970925     D DSLV55        E DS                  EXTNAME(FNLV55DS)
007090970925     D* DS PER TNSD99R - CALCOLO  DELLA CONSEGNA TEORICA BOLLA
007100970925     D DSSD99        E DS                  EXTNAME(TNSD99DS)
007110000907     D* DS PER FNLSZ1R - CONTROLLO COD. "CHI SONO"
007120000907     D DSLSZ1        E DS                  EXTNAME(FNLSZ1DS)
007130020213     D* DS PER TRUL27R - Ricerca tarfiffa di cartello
007140020213     D trul27ds      E DS
007150051206     D* DS PER tntb51R - controllo se dati EDI trasferiti
007160051206     D tntb50ds      E DS
007170061122     D fior51ds      E DS
007180070604     D fior56ds      E DS
007190081014     D trtc86drds    E DS
007200030326     d Trul13ds      e ds
007210030326     D  tI13Tla      e                     EXTFLD(I13Tla)
007220030326     D  tO13Err      e                     EXTFLD(O13Err)
007230030326     D  tO13Msg      e                     EXTFLD(O13Msg)
007240111206     d
007250111206     d Trul13ds1     e ds
007260090325
007270090325     D TIBS69DS      E DS
007280090515     D ds_cnaco      E DS                  extname(CNACO00F) prefix(BS_)
007290090515     D ds_cnind      E DS                  extname(CNIND00F) prefix(BS_)
007300090515     D ds_cnclp      E DS                  extname(CNCLP00F) prefix(BS_)
007310090515     D ds_fncls      E DS                  extname(FNCLS00F) prefix(BS_)
007320090325
007330980108     D CNCR80        E DS
007340900427     D UT§DSE        E DS                  EXTNAME(UT§DSE0F)
007350000000     D  TCU                  398    697
007360000000     D                                     DIM(50)
007370000000     D  KCU                  698    847P 0
007380000000     D                                     DIM(50)
007390000000     D                                     PACKEVEN
007400000000     D  DTU                  848    895P 0
007410000000     D                                     DIM(12)
007420000000     D                                     PACKEVEN
007430991214     D* DS DI BLP
007440000211     D DSBLP0        E DS                  EXTNAME(FNBLP00F)
007450000211     D DSBLD0        E DS                  EXTNAME(FNBLD00F)
007460000211     D DSSGN0        E DS                  EXTNAME(FISGN00F)
007470041019     D SAVBLP        E DS                  EXTNAME(FNBLP00F)
007480041019     D                                     prefix(x_)
007490001130     D* DS RICHIAMO PROGRAMMA CANCELLAZIONE BOLLA SINGOLA
007500001130     D DSLS63        E DS                  EXTNAME(FNLS63DS)
007510010216     D* DS RICHIAMO PROGRAMMA RICERCA O.R.M.
007520010216     D DSOR04        E DS                  EXTNAME(FIOR04DS)
007530110419     D fior58ds      E DS
007540010228     D* DS RICHIAMO PROGRAMMA IMMISSIONE ORM PREPAGATO
007550010228     D DSOR05        E DS                  EXTNAME(FIOR05DS)
007560010228     D  §RMPOO       E                     EXTFLD(§RMPOEO)
007570010228     D  §RMNSO       E                     EXTFLD(§RMNSRO)
007580010228     D  §RMNOO       E                     EXTFLD(§RMNORO)
007590010228     D  §RMNRO       E                     EXTFLD(§RMNRVO)
007600980318     D* DS PER COMPOSIZIONE SEGNACOLLO EUROEXPRESS
007610980318     D                 DS
007620980318     D  WJUT                   1      3    INZ('JUT')
007630980318     D  WIT                    4      5    INZ('IT')
007640051102     D  ARSFLS                 6      8  0
007650051102     D  ARSNRS                 9     10  0
007660051102     D  ARSNSC                11     17  0
007670011120     D  W15C                  18     19
007680011107     D  W55L                  18     21
007690980408     D  WCADN                 22     32
007700980408     D  DSEEX                  1     32
007710010216     D*
007720010216     D* DS PER RICHIAMO FIOR07R PER VISUALIZZAZIONE ORM
007730010216     D FIOR07          DS
007740010216     D  D07POE                 1      3  0
007750010216     D  D07NOR                 4     10  0
007760010216     D  D07NSR                11     12  0
007770010216     D  D07NRV                13     14  0
007780010216     D  D07SCE                15     15
007790010216     D  D07FGS                16     18  0
007800010216     D  D07POR                19     21  0
007810010216     D  D07DTR                22     29  0
007820010216     D  D07MDB                30     39
007830010216     D  D07PRB                40     49
007840010216     D  D07DTS                50     57  0
007850010216     D  D07RMP                58     58
007860010216     D  D07BRC                59     59
007870010216     D  D07REF                60     61
007880010216     D  D07MIO                62     62
007890011108     D DSEDIT        E DS                  EXTNAME(XEDITDS)
007900011108     D  IEDNUM       E                     EXTFLD(IEDNUMERO)
007910011108     D  IEDNRD       E                     EXTFLD(IEDNRDEC)
007920011108     D  IEDEDT       E                     EXTFLD(IEDEDTCOD)
007930011108     D  IEDLEN       E                     EXTFLD(IEDLENFLD)
007940011108     D  OEDNUM       E                     EXTFLD(OEDNUMAN)
007950011108     D  OEDFLG       E                     EXTFLD(OEDFLGERR)
007960011108     D  OEDCOD       E                     EXTFLD(OEDCODERR)
007970020530     D*
007980060213     D DSARBD        E DS
007990060213     D DSARBG        E DS
008000060213     D DARBT         E DS
008010060213     D DSARBK        E DS
008020060213     D fnlr48ds      E DS
008030020530     D tisit0ds      E DS
008040070924     D tisit0x1ds    E DS
008050091006      * ds x richiamo pgm FNLS28R
008060091006     d Fnls28ds      e ds
008070040227      * ds x richiamo pgm FNLS26R
008080040227     d Fnls26ds      e ds
008090060125      * ds x richiamo pgm FNLS25R
008100060125     d Fnls25ds      e ds
008110060207      * ds x richiamo pgm FNLv85R
008120060207     d Fnlv85ds      e ds
008130060616     d trul28ds4     e ds
008140061127     d fidn12ds      e ds                  prefix(dn_)
008150110512     d dsemail       e ds
008160110517     d Fnls80ds      e ds
008170110517     d  dPog                   1     90  0 Dim(30)
008180111026     d fidna3ds      e ds
008190060208     D cndizion      E DS
008200060208     D                                     BASED(nullPtr)
008210060208     D                                     PREFIX(diz)
008220120615     d trulflbds     e ds
008230080109      * - Aggiunta/Sottrazione di n giorni lavorativi ad una data
008240080109     d TRUL52ds      e ds
008250051123     d* Ds per richiamo fnlsa8r
008260051124     D*PARAM2          DS
008270051123     D* PARAM2: PASSAGGIO AD ANNULLAMENTO ANOMALIE E DATE
008280051124     D**wrvnfv                 2      6  0
008290051124     D**BRVNPG                 7      7  0
008300051124     D**BRVLNP                 8     10  0
008310051124     D**BRVLNA                11     13  0
008320051124     D**BRVNRS                14     15  0
008330051124     D**BRVNSC                16     22  0
008340051124     D**BRVCAN                23     23
008350051124     D**BRVVUC                24     30  6
008360051124     D**PARFLG                31     31
008370051124     D**PARFEL                92     94  0
008380051124     D**BRVNPS                95     96  0
008390051124     D**BRVFGS                97     99  0
008400051124     D**BRVFLE               100    102  0
008410051124     D**BRVpes               103    105  0
008420080410     D dcppflo       e ds
008430080410     D dntw          e ds
008440061212     d*
008450061212     D FNBLP1          DS
008460061212     D  BLPNRR               397    400B 0
008470020212     d*
008480020212     d xw              s              2  0
008490020212     d zw              s              2  0
008500020212     d totale          s              3  0
008510020212     d intero          s              2  0
008520020212     d restof          s              2  0
008530021120     d Ksc8888         s              4  0
008540021120     d DueCtr          s              2  0
008550021120     d Wctr            s                   Like(VidCtr)
008560020212     d*
008570020212     d fedexbrc        ds
008580020212     d  fbrc                   1     11  0 dim(11)
008590020212     d  fchd                  12     12  0
008600020212     d*
008610020212     d base            s              1  0 dim(3)
008620020308     d*
008630020308     d sav_dslsz1      s                   like(dslsz1)
008640021118     d SavGdd          s                   Like(O95Gdd)
008650020308     d w8hcol          s                   like(v8hcol)
008660020308     d w8cnot          s                   like(v8cnot)
008670020308     d wnopos          s              1
008680020319     d clintw          s                   like(§ogntw)
008690081215     d ntwpor          s                   like(§ogntw)
008700020530     d wdisag          s                   like(ot0dos)
008710030305     d savdisag        s                   like(ot0dos)
008720070924     d savpart         s                   like(ot0dos)
008730080307     D WY              s              2  0
008740021203
008750021203     D kpdpdr          S                   LIKE(APDpdr)
008760021203     D kpdtip          S                   LIKE(APDtip)
008770060109     d d_o95lna        s                   like(o95lna)
008780060109     d d_o95znc        s                   like(o95znc)
008790060109     d d_o952ln        s                   like(o952ln)
008800060308     d wcvb            s                   like(ilv85cvb)
008810060522     d kfgs            s                   like(dstfgs)
008820060522     d w_pogest        s                   like(dstfgs)
008830060622     d §lpcad_w        s                   like(§lpcad)
008840060707     d savaogntw       s                   like(§ogntw)
008850061121     d poentw          s                   like(§ogntw)
008860061012     d wdpc            s                   like(pdcdpc)
008870060613     d wsolo_num       s              1
008880060614     d comnrd          s             14  0
008890061218     d savnrr          s                   like(blpnrr)
008900070322     d wparcel         s              2
008910070404     d w_cgi           s                   like(§lpcgi)
008920070404     d lna_sav         s                   like(blplna)
008930070427     d savtb1          s                   like(flgtb1)
008940120926     d savrbl          s                   like(§3arbl)
008950120927     d wagc            s                   like(blpaas)
008960070612     d kedcod          s                   like(tabcod)
008970070612     d kedkey          s                   like(tabkey)
008980070626     d kdpodep         s                   like(dpodep)
008990070626     d kdpoord         s                   like(dpoord)
009000070829     d s_drt           s                   like(viddrt)
009010070829     d s_drtblp        s                   like(viddrt)
009020081111     d s_drtblpi       s                   like(blpdrt)
009030071023     d w_callyco       s              1
009040080313     d k_tbecod        S                   LIKE(tbecod)
009050080313     d k_tbeke1        S                   LIKE(tbeke1)
009060100517     d** wparz           s              1
009070100517     d** wparz_d         s                   like(vidncd)
009080100517     d** wparz_a         s                   like(vidnca)
009090080314     d w_bldncd        s                   like(bldncd)
009100080314     d w_bldnca        s                   like(bldnca)
009110100517     d** no_range        s              1
009120080314     d f_range         s              1
009130090429     d wemznc          s              2  0
009140090429     d wmsgzo          s              1
009150090609     d wmsgtsp         s             78
009160090609     d wvid            s              1
009170090609     d wncl            s                   like(v1cncl)
009180090609     d wpes            s                   like(vidpkg)
009190090609     d wvol            s                   like(vidvol)
009200090609     d wncl_pre        s                   like(v1cncl)
009210090609     d wpes_pre        s                   like(vidpkg)
009220090609     d wvol_pre        s                   like(vidvol)
009230060208     d*
009240060208     D nullPtr         S               *
009250060208     D prmAas          S
009260060208     D                                     LIKE(diz$Aas)
009270060208     D prmLnp          S
009280060208     D                                     LIKE(diz$Lnp)
009290060208     D prmNrs          S
009300060208     D                                     LIKE(diz$Nrs)
009310060208     D prmNsp          S
009320060208     D                                     LIKE(diz$Nsp)
009330060208     D prmFiv          S
009340060208     D                                     LIKE(diz$Fiv)
009350060208     D prmDft          S
009360060208     D                                     LIKE(diz$Dft)
009370060208     D prmNft          S
009380060208     D                                     LIKE(diz$Nft)
009390060208     D prmEsito        S             10I 0
009400020212     d*
009410090325     d $Fine           s               n   inz(*off)
009420090326     d wclg            s                   like(§b4clg)
009430090326     d w_§lpksca       s                   like(§lpksca)
009440090326     d w_§lpctra       s                   like(§lpctra)
009450090326     d s_fnlv59ds      s                   like(fnlv59ds)
009460090326
009470090327     d s_wcliksc       s                   like(wcliksc)
009480090326     d s_wclictr       s                   like(wclictr)
009490090327     d s_ormksc        s                   like(ormksc)
009500090327     d s_ormctr        s                   like(ormctr)
009510110516     d s_wemdest       s                   like(wemdest)
009520130315     d wsms            s                   like(§vatstel)
009530130315     d wsmp            s                   like(§vatssmp)
009540110705     d s_wcupcup       s                   like(wcupcup)
009550110705     d s_wcupcig       s                   like(wcupcig)
009560110705
009570091211     d nochkticC       s               n   inz(*off)
009580110518     d wfvab           s               n   inz(*off)
009590110818     d werrxco         s               n   inz(*off)
009600111026     d RA_ncd          s                   like(vidncd)
009610111026     d RA_nca          s                   like(vidnca)
009620111026     d RA_ncl          s                   like(savncl)
009630111026     d RA_lna          s                   like(savlna)
009640111026     d wRA_lna         s                   like(blplna)
009650111026     d savtsp73        s                   like(i73tsp)
009660120606     d wstringa        s                   like(§VAT4CUP)
009670121123     d wesar4z         s              1
009680121123     d wtrasmz         s              1
009690121123     d wkscz           s                   like(§b4okc)
009700130219     d wnoZ            s              1
009710011211     D                SDS
009720011211     D  NOMPGM                 1     10
009730930629     D*
009740930629     D* DEFINIZIONE COSTANTI
009750930629     D*
009760990610     D CPREPA          C                   CONST('FRANCO PREPAGATO')
009770990610     D CNOSEQ          C                   CONST('NON SEQUENZIALI')
009780941011     D CULTSP          C                   CONST('ULTIMA SPEDIZIONE: ')
009790941011     D CVARIA          C                   CONST('S P E D I Z I O N E')
009800941011     D CCONFE          C                   CONST('BOLLA DA CONFERMARE')
009810941231     D CPDC            C                   CONST('su Piano dei Conti')
009820950303     D CPIVA           C                   CONST('Partita IVA:')
009830050427     D CAUT            C                   CONST('(AUT.       ) ENTER x FORZ.')
009840980115     D CMAIUS          C                   CONST('ABCDEFGHIJKLMNOPQRS-
009850980115     D                                     TUVWYXZ')
009860980115     D CMINUS          C                   CONST('abcdefghijklmnopqrs-
009870980115     D                                     tuvwyxz')
009880991214     D CDPD            C                   CONST('PARCEL DPD: ')
009890020726      * - Società chiave per tabella "YIV"
009900020725     D C_Soc           c                   const('201')
009910010209     D*
009920010209     D* CAMPO PER DSPATR "REVERSE IMAGE"        DEI CAMPI A VIDEO
009930010209     D RIMM            C                   CONST(X'21')
009940040610     D* CAMPO PER DSPATR "HI" + "UL"            DEI CAMPI A VIDEO
009950040610     D HIUL            C                   CONST(X'26')
009960040610     D* CAMPO PER DSPATR "RI" + "UL"            DEI CAMPI A VIDEO
009970040610     D RIUL            C                   CONST(X'25')
009980010209     D* CAMPO PER DSPATR "NO DISPLAY"+"PROTECT" DEI CAMPI A VIDEO
009990010209     D NDPR            C                   CONST(X'A7')
010000011122     D* CAMPO PER DSPATR "PROTECT" + "HI"       DEI CAMPI A VIDEO
010010011122     D PROT            C                   CONST(X'A2')
010020040609     D* CAMPO PER DSPATR "PROTECT" + "RI"       DEI CAMPI A VIDEO
010030040609     D PRRI            C                   CONST(X'A1')
010040010219     D* CAMPO PER DSPATR "NO DISPLAY"
010050010219     D NODI            C                   CONST(X'27')
010060070801     D* CAMPO PER DSPATR "Blinking"
010070111206     D*BLNK            C                   CONST(X'28')
010080111206     D BLNK            C                   CONST(X'2E')
010090061110     D* CAMPO PER DSPATR "UL"
010100061110     D ul              C                   CONST(X'24')
010110030304     D* CAMPO PER DSPATR "PROTECT"+ HI + UL     DEI CAMPI A VIDEO
010120030304     D PROT1           C                   CONST(X'A6')
010130030627      * testo x cliente tassazione bolle FW
010140030627     d wnotfw          c                   Const('cliente tassazione')
010150130117
010160130117      // - Tabella OSR
010170130117     d c_tabosr        c                   const('OSR')
010180080307
010190080307     D digits          c                   '0123456789'
010200130117
010210130117      // - Reperimento tabella
010220130117     d tibs02r         pr                  extpgm('TIBS02R')
010230130117     d  kpjba                              likeds(kpjba)    const
010240130117     d  dsbs02                             likeds(dsbs02)
010250130117
010260020917     IFIVAD000
010270020917     I              VADATB                      BLDATB
010280941230     I              VADCCM                      BLDCCM
010290941230     I              VADLNP                      BLDLNP
010300941230     I              VADAAS                      BLDAAS
010310941230     I              VADNRS                      BLDNRS
010320941230     I              VADNSP                      BLDNSP
010330941230     I              VADCDP                      BLDCDP
010340941230     I              VADNCL                      BLDNCL
010350941230     I              VADNCD                      BLDNCD
010360941230     I              VADNCA                      BLDNCA
010370000208     IFISGN000
010380000204     I              SGNFLS                      §LDLNP
010390000204     I              SGNDLP                      §LDDLP
010400000204     I              SGNCDP                      §LDCDP
010410000204     I              SGNNRS                      §LDNRS
010420000208     I              SGNNCD                      §LDNCD
010430000204     I              SGNLNA                      §LDLNA
010440000204     I              SGNDLA                      §LDDLA
010450000204     I              SGNTNA                      §LDTNA
010460000204     I              SGNTSP                      §LDTSP
010470000207     I              SGNZSC                      §LDZSC
010480000204     I              SGNNC1                      §LDNC1
010490000204     I              SGNNC2                      §LDNC2
010500000204     I              SGNRSM                      §LDRSM
010510000204     I              SGNPRM                      §LDPRM
010520000204     I              SGNRSD                      §LDRSD
010530000204     I              SGNCAD                      §LDCAD
010540000204     I              SGNIND                      §LDIND
010550000204     I              SGNLOD                      §LDLOD
010560000204     I              SGNPRD                      §LDPRD
010570000204     I              SGNCPD                      §LDCPD
010580000204     I              SGNNCP                      §LDNCP
010590000204     I              SGNNCU                      §LDNCU
010600050421     I              SGNRST                      §LDRST
010610000204     I              SGNVOL                      §LDVOL
010620000204     I              SGNPKG                      §LDPKG
010630000204     I              SGNFVR                      §LDFVR
010640000204     I              SGNAAS                      §LDAAS
010650000204     I              SGNMGS                      §LDMGS
010660000208     I              SGNTST                      §DETST
010670000208     I              SGNTSE                      §DETSE
010680000208     I              SGNSSE                      §DESSE
010690000208     I              SGNSIP                      §DESIP
010700000208     I              SGNSIA                      §DESIA
010710000208     I              SGNAWB                      §DEAWB
010720000208     I              SGNISA                      §DEISA
010730000208     I              SGNFCA                      §DEFCA
010740000208     I              SGNEUR                      §DEEUR
010750000208     I              SGNXX1                      §DEXX1
010760000208     I              SGNXX2                      §DEXX2
010770001005     IFISGN005
010780001005     I              SGNFLS                      §LDLNP
010790001005     I              SGNDLP                      §LDDLP
010800001005     I              SGNCDP                      §LDCDP
010810001005     I              SGNNRS                      §LDNRS
010820001005     I              SGNNCD                      §LDNCD
010830001005     I              SGNLNA                      §LDLNA
010840001005     I              SGNDLA                      §LDDLA
010850001005     I              SGNTNA                      §LDTNA
010860001005     I              SGNTSP                      §LDTSP
010870001005     I              SGNZSC                      §LDZSC
010880001005     I              SGNNC1                      §LDNC1
010890001005     I              SGNNC2                      §LDNC2
010900001005     I              SGNRSM                      §LDRSM
010910001005     I              SGNPRM                      §LDPRM
010920001005     I              SGNRSD                      §LDRSD
010930001005     I              SGNCAD                      §LDCAD
010940001005     I              SGNIND                      §LDIND
010950001005     I              SGNLOD                      §LDLOD
010960001005     I              SGNPRD                      §LDPRD
010970001005     I              SGNCPD                      §LDCPD
010980001005     I              SGNNCP                      §LDNCP
010990001005     I              SGNNCU                      §LDNCU
011000001005     I              SGNVOL                      §LDVOL
011010001005     I              SGNPKG                      §LDPKG
011020001005     I              SGNFVR                      §LDFVR
011030001005     I              SGNAAS                      §LDAAS
011040001005     I              SGNMGS                      §LDMGS
011050001005     I              SGNTST                      §DETST
011060001005     I              SGNTSE                      §DETSE
011070001005     I              SGNSSE                      §DESSE
011080001005     I              SGNSIP                      §DESIP
011090001005     I              SGNSIA                      §DESIA
011100001005     I              SGNAWB                      §DEAWB
011110001005     I              SGNISA                      §DEISA
011120001005     I              SGNFCA                      §DEFCA
011130001005     I              SGNEUR                      §DEEUR
011140001005     I              SGNXX1                      §DEXX1
011150001005     I              SGNXX2                      §DEXX2
011160930611     IAZORG01L  AA
011170000000     I/SPACE 3
011180900504     C****************************************************************
011190900504     C*  RIEPILOGO INDICATORI
011200011115     C* N.B.: IL 92,93 E 99 SONO RIUTILIZZABILI DOPO AVERLI TOLTI ANCHE
011210011115     C*       DAL FORMATO VIDEO
011220900504     C***************************************************************
011230990628     C* 01    - ON-RICERCA ANAGRAFICA ATTIVATA
011240940825     C* 02    - PROTEGGO MITTENTE IN 2 VIDEATA
011250941103     C* 03    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE ORIGINALE
011260900504     C* 04    - BOLLA ASSEGNATO
011270940920     C* 05    - ESISTE 2 BOLLA E NON E' TASSATO DESTINO
011280010222     C* 06    - POSIZIONAMENTO CURSORE SU NUMERO ORM DAL SECONDO GIRO
011290040915     C*         IN POI SE ATTIVATA PRCEDURA ORM
011300960926     C* 07    - IL PRIMO GIRO SI POSIZIONA SUL COD AUTOTRASPORTATORE
011310940928     C*         DAL 2 IN POI SUL MITTENTE
011320900507     C* 08    - TASSATO DESTINO
011330940922     C* 09    - EMETTO IL TIPO SERVIZIO IN "RI" SE DA TARIFFA
011340941004     C* 10    - EVIDENZIO IL CODICE ISO DELLA P.IVA SE IMPOSTATO DA NAZ
011350941219     C* 11    - CHANGE SU C/ASSEGNO
011360941219     C* 12    - PROVENGO DA MANUTENZIONE
011370940920     C* 13    - PROTEGGO IL CODICE OPERATORE QUANDO NON MODIFICABILE
011380991130     C*          E SE LNP DPD, *IN79=*ON, PROTEGGO RMN
011390940913     C* 14    - SPROTEGGO LA LNP CLIENTE E MI POSIZIONO
011400900824     C* 15    - PROVENGO DA CARICAMENTO BOLLE DA DISK CLIENTI
011410940825     C* 16    - IMMISS.  BOLLE - PERSONALIZ.DATA CONSEGNA RICHIESTA
011420940825     C* 17    - IMMISS.  BOLLE - PERSONALIZ.TIPO CONSEGNA RICHIESTA
011430930329     C* 18    - IMMISS.  BOLLE - PERSONALIZ.ESPRESSO
011440940825     C* 19    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE
011450930329     C* 20    - IMMISS.  BOLLE - PERSONALIZ.LINEA ARRIVO
011460930329     C* 21    - IMMISS.  BOLLE - PERSONALIZ.CODICE BOLLA
011470990630     C* 22    - PROTEZIONE DATI FATTURA E VISUAL.TOT.FATTURA PER PREPAG
011480940920     C* 23    - IMMISS.  BOLLE - PERSONALIZ.ORA  CONSEGNA RICHIESTA
011490930329     C* 24    - IMMISS.  BOLLE - PERSONALIZ.DATA SPEDIZIONE
011500940826     C* 25    - CTM PER CREAZIONE SEGNACOLLI
011510930329     C* 26    - IMMISS.  BOLLE - PERSONALIZ.COD TRATTAM MERCE
011520940825     C* 27    - IMMISS.  BOLLE - PERSONALIZ. DELLA NATURA MERCE
011530930329     C* 28    - IMMISS.  BOLLE - PERSONALIZ.COD TARIFFA MITTENTE
011540930329     C* 29    - IMMISS.  BOLLE - PERSONALIZ.IL CODICE TARIFFA
011550900508     C* 30/32 - DI COMOD RIUTILIZZABILI
011560980219     C* 33    - PROTEGGO LA DIVISA DEL C/A
011570000928     C*         IN MANUTENZIONE MI SERVE PER AGGIORNAMENTO FNBLD
011580000928     C*         IN CONFERMA DISK (DISK C EX DISK B) LO ACCENDO PER
011590000928     C*         DISABILITARE AGGIUNTA COD.CHI SONO
011600990610     C* 34    - ELABORAZIONE PER PREPAGATI
011610940926     C* 35    - SFLDSP
011620940825     C* 36    - BOLLE DISK CLI - ON -POSIZIONAMENTO CURSORE SU VOLUME
011630931123     C*       - BOLLE DISK CLI - OFF-POSIZIONAMENTO CURSORE SU SEGNACOL
011640010222     C* 37    - IMMISS.  BOLLE - PERSONALIZ.NUMERO ORM
011650941020     C* 38    - POSIZIONAMENTO CURSORE STD SE SPENTO.
011660941020     C*         SE ACCESO SIGNIFICA CHE E' STATO ATTIVATO UN ALTRO POSZ
011670960319     C* 39    - PROTEGGO LA P.IVA DEL MITTENTE
011680960319     C* 40/84 - ERRORE
011690940826     C* 44    - BOLLE DISK CLI - SE DA GIACENZE O CAMBIO PORTO
011700930330     C*          E MANUT BOLLE -   NO VARIAZIONE DEL TIPO BOLLA
011710960319     C* 71/73 - ERRORE SU CAP/NAZIONE/RAGIONE SOCIAL MITTENTE ORIGINALE
011720980219     C* 76    - PROTEZIONE DEI CAMPI TIPO INCASSO C/A SE EXPORT
011730000905     C* 77    - ERRORE SU FLAG DDT
011740000830     C* 78    - INDICATORE SFLDSP PER SFL COD."CHI SONO"
011750991130     C* 79    - PROTEZIONE DEL RIF.ALFABETICO PER BOLLE DPD E SE CODICE
011760991130     C*          OPERATORE NON MODIFICABILE, *IN13=*ON, PROTEGGO RMN
011770950303     C* 85    - IMMISS.  BOLLE - PERSONALIZ.SOLO COD CLIENTE
011780961111     C* 86    - ERRORE SULLE NOTE
011790961111     C* 87    - PROTEZIONE DELLA TASSAZIONE SE PGM RICHIAMO DA GIACENZE
011800950410     C* 88    - change su VALORE MERCE DICHIARATO
011810941219     C* 89    - change su importo da assicurare
011820941219     C* 90    - SEGNALA LA PRESENZA DI ERRORI
011830960319     C* 91    - IMMISS.  BOLLE - PERSONALIZ.I GIORNI DI CHIUSURA
011840011115     C* 92    - EVIDENZIO DIVISA IMP ASSIC SE DA MITTENTE(E NON E' IT)
011850011115     C* 93    - EVIDENZIO DIVISA C/A       SE DA DESTINAT(E NON E' IT)
011860930414     C* 94    - BOLLE DISK CLI - ABILITO CM21 X GEST. DETT.STAMPA SEGN
011870940922     C* 95    - ABILITA INSERIM.SERIE PER BOLLETTAZIONE
011880940922     C*         CLIENTI CON SERIE CHE DANNO SOLO ETICH
011890980324     C* 96    - BOLLE DISK CLI - ABILITO F22 X GEST.ESTENS. DETT.COLLI
011900940922     C* 97    - EMETTO I CAMPI RIPRESI DA TARIFFA IN "RI"
011910940922     C* 98    - BOLLE DI RECUPERO
011920011115     C* 99    - EVIDENZIO DIVISA VAL MERCE SE DA MITTENTE(E NON E' IT)
011930900504     C*****************************************************************
011940930611     C     *ENTRY        PLIST
011950930611     C                   PARM                    KPJBA
011960991007     C                   PARM                    DBLP
011970991007     C                   PARM                    DTASV
011980030610     C                   PARM                    trul90ds
011990030610      *
012000030610      * Il numero dei parametri ricevuti è testato, in caso di modifica
012010030610      *  ricercare la stringa "%PARMS"
012020020917      *
012030021002      * Controllo se p.o. gestione numerico
012040021002     C                   IF        %subst(§lpfgs:1:1) < '0' or
012050021002     C                             %subst(§lpfgs:2:1) < '0' or
012060021002     C                             %subst(§lpfgs:3:1) < '0'
012070021002     C                   clear                   §fgs              3 0
012080021002     C                   ELSE
012090021002     C                   movel     §lpfgs        §FGS
012100021002     C                   ENDIF
012110030409      * controllo le ore
012120030409     c                   IF        %subst(§lpore:1:1) < '0' or
012130030409     c                             %subst(§lpore:2:1) < '0'
012140030409     c                   Clear                   §ore
012150030409     c                   Else
012160030409     c                   Move      §lpOre        §ore
012170030409     c                   EndIf
012180001219     C*
012190000000     C*----------------------------------------------------*
012200930628     C* §LPFPR = 'M' VENGO DA MANUTENZIONE   : CHIUDO IN RETRN
012210930628     C* §LPFPR = 'X' VENGO DA DISK CLI       : CHIUDO IN RETRN
012220930628     C* §LPFPR = 'V' VENGO DA DISK CLI       : CHIUDO IN RETRN
012230950419     C* §LPFPR = 'W' VENGO DA DISK CLI       : CHIUDO IN RETRN
012240050407     C* §LPFPR = 'R' VENGO DA REC BOL DSK CLI: CHIUDO IN RETRN --> OBSOLETO
012250010213     C* §LPFPR = 'O' VENGO DA CONFERMA O.R.M.: CHIUDO IN RETRN
012260990602     C* §LPFPR = 'G' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
012270941230     C* §LPFPR = 'P' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
012280941230     C*              NON DEVO STAMPARE LA BOLLA
012290930628     C* §LPFPR = 'I' VENGO DA INVIO DISPOSIZ : CHIUDO CON LR
012300020522     C* §LPFPR = 'T' VENGO DA RITIRI ANNULLATI:CHIUDO CON LR
012310030609      *                  o da ORM commissionati
012320930707     C* §LPFPR = 'C'                           CHIUDO CON LR
012330900511     C*
012340941020     C* CODICI DI RITORNO:
012350941020     C* §LPFPR = '1'                           BOLLA ANNULLATA
012360111007     C* §LPFPR = '2'                           Richiesto annullamento VAB...
012370000517     C* §LPFPR = '3'                           CMD03
012380941020     C* §LPFPR = '4'                           CMD12
012390941020     C* §LPFPR = '5'                           TROVATI ERRORI IN CONFER
012400000627     C*
012410000627     C* §LPFLG = 'C' - EFFETTUARE SOLO CONTROLLI RESTITUENDO DBLP
012420000627     C*                AGGIORNATA
012430930707    1C     §LPFPR        IFEQ      'C'
012440930628     C     §LPFPR        OREQ      'G'
012450930628     C     §LPFPR        OREQ      'I'
012460950102     C     §LPFPR        OREQ      'P'
012470020522     C     §LPFPR        OREQ      'T'
012480930628     C                   SETON                                        LR
012490010103   X1C                   ENDIF
012500010103     C*
012510010103     C     *LIKE         DEFINE    §LPFPR        SAVFPR
012520010103     C                   CLEAR                   SAVFPR
012530010103    1C     §LPFPR        IFEQ      'G'
012540010103     C     §LPFPR        OREQ      'P'
012550020522     C     §LPFPR        OREQ      'T'
012560010103     C                   MOVEL     §LPFPR        SAVFPR
012570010103     C                   ENDIF
012580011029      * PULISCO CAMPO DI ATTRIBUTI VISUALIZZAZIONE X 'FLAG TARIFFA MITTENTE'
012590011029     C                   CLEAR                   ATRFTM
012600030911      * pulisco ds di work del numero ORM
012610030911     c                   Clear                   widorm
012620040506      * pulisco ds di work del numero bolla da dsblp
012630040506     c                   Clear                   widspe
012640091221      * pulisco campo appoggio per particolarità consegna
012650091221     c                   clear                   wvidgma
012660100604     c                   clear                   w7rRC
012670111007     C* Attributo di visualizzazione F16=Annull:
012680111007     c* in conferma     è da visualizzare solo se richiamata con "X" o "V"
012690111007     c* in manutenzione sempre
012700111007     c                   clear                   atrann
012710111007     c                   if        *in15 and §lpfpr<> 'V' and §lpfpr <>'X'
012720111007     c                   movel     nodi          atrann
012730111007     c                   endif
012740900509     C* PULISCO CAMPI FOR02 E FOR03
012750941115    1C     §LPFPR        IFNE      'C'
012760000829     C                   EXSR      INZ08
012770991203     C                   EXSR      INZ07
012780991203     C                   EXSR      INZ06
012790971210     C                   EXSR      INZ03
012800941011     C                   EXSR      INZ02
012810940819     C                   EXSR      INZ01
012820930628     C*  MANUTENZIONE
012830950102     C   12
012840950102     CANN15              DO
012850950102     C                   EXSR      CARBLP
012860950102     C   90              GOTO      FINE
012870950102     C                   ENDDO
012880950126     C*
012890930628     C*  CARICAMENTO BOLLE DA DISK CLI
012900900824     C   12
012910900824     CAN 15              EXSR      CARBLC
012920010301     C*  CARICAMENTO DA CONFERMA ORM PREPAGATI
012930010301     C     §LPFPR        IFEQ      'O'
012940010301     C                   EXSR      CARBLO
012950010301     C                   ENDIF
012960010209     C*
012970010209     C*  HO CARICATO LA VIDEATA: VERIFICO SE ATTIVATA PROC. O.R.M.
012980010209     C*  SE PGM RICHIAMATO DA GIACENZE O CONFERMA BOLLE LA PROCED. ORM
012990010209     C*  NON E' ATTIVATA SE P.O. EMITTENTE = 0
013000010219     C                   Z-ADD     VIDLNP        WLNPO
013010010209     C*  NEGLI ALTRI CASI FACCIO CHAIN SU ORGANIGRAMMA
013020010209     C                   EXSR      ATTORM
013030010219     C* SE SONO IN MANUTENZIONE E ORM FITTIZIO IMPOSTO NUMERO ORM A VI-
013040010219     C* DEO
013050010219     C     WORM          IFEQ      'S'
013060010219     C     *IN12         ANDEQ     *ON
013070010219     C     *IN15         ANDEQ     *OFF
013080010219     C     VIDPOE        ANDEQ     *ZEROS
013090010219     C                   Z-ADD     VIDLNP        VIDPOE
013100010219     C                   MOVE      *ALL'9'       VIDNOR
013110010219     C                   MOVE      *ALL'9'       VIDNRV
013120010219     C                   MOVEL     VIDORM        W01ORM
013130070627     C                   MOVEL     VIDORM        s_dsbl4m
013140010219     C                   ENDIF
013150010502     C* IN IMMISSIONE E NO PREPAGATO E PROCEDURA ORM ATTIVA IL FLAG
013160010502     C* MATTINO/POMERIGGIO LO LASCIO VUOTO
013170010502     C     WORM          IFEQ      'S'
013180010502     C     *IN12         ANDEQ     *OFF
013190010502     C     PARTCH        ANDNE     'P'
013200010502     C     §LPFPR        ANDNE     'O'
013210010502     C                   CLEAR                   VIDFPP
013220010502     C                   ENDIF
013230010209     C*
013240910108     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
013250910108     C*    AI CONTROLLI
013260940214     C   12
013270940214    2CAN 15§LPFPR        IFNE      'V'
013280910108     C                   GOTO      CT1TAG
013290940214    2C                   END
013300900427     C*
013310900427     C     FOR01         TAG
013320121017      * Se la data del giorno è compresa nel range dal/al per blocco immiss.
013330121017      * prepagati (tabella DGD) --> ERRORE
013340041217     c                   If        (Partch = 'P' or §LpFpr = 'O') and
013350121017     c                              dateu>= §dgdbpd and dateu<=§dgdbpa
013360121017     c****                          Dateu = §vpodip
013370041217     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
013380041217     c                             spedizioni in Porto Prepagato'
013390041217     c                   Eval      *In90 = *On
013400041217     c                   EndIf
013410940825     C* V I D E O   1
013420050119     c                   z-add     VIDORM        S_VIDORM
013430940819     C                   EXFMT     LS01D01
013440941003     C*
013450941003     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
013460950126     C                   EXSR      OFFD01
013470900427     C* CMD3 - FINE LAVORO
013480920713     C   KL
013490920713     CAN 12
013500920713     CAN 15              MOVEL     '4'           §LPFPR
013510000518     C   KC
013520000518     CAN 12
013530000518     CAN 15              MOVEL     '3'           §LPFPR
013540010308     C* IDEM SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI (IN QUESTO
013550010308     C* CASO *IN12 = OFF
013560010308     C     §LPFPR        IFEQ      'O'
013570010308     C   KL              MOVEL     '4'           §LPFPR
013580010308     C   KC              MOVEL     '3'           §LPFPR
013590010308     C   KC
013600010308     COR KL              GOTO      FINE
013610010308     C                   ENDIF
013620940825     C   KC
013630940825     COR KL
013640940825     CAN 12              GOTO      FINE
013650121017      * Se la data del giorno è nel range dal/al per blocco immissione
013660121017      * prepagati (tabella DGD) ---> ERRORE
013670050215     c                   If        (Partch = 'P' or §LpFpr = 'O') and
013680121017     c                              dateu>=§dgdbpd and dateu<=§dgdbpa
013690121017     c****                          Dateu = §vpodip
013700050215     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
013710050215     c                             spedizioni in Porto Prepagato'
013720050215     c                   Eval      *In90 = *On
013730050215     c                   goto      for01
013740050215     c                   EndIf
013750940819     C*
013760900427     C* CMD13 - PERSONALIZZAZIONE CAMPI
013770940819     C     *INKM         IFEQ      *ON
013780940819    2C                   EXSR      GESD00
013790010305     C   KC§LPFPR        IFEQ      'O'
013800010305     C                   MOVEL     '3'           §LPFPR
013810010305     C                   ENDIF
013820940819     C   KC              GOTO      FINE
013830040908     c* se personalizzato n. orm prima di riemettere la videata di
013840040908     c* bollettazione devo effettuare i controlli per poporre eventuali
013850040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
013860040908     c* porti allo stesso modo di quando dalla prima videata viene
013870040908     c* immesso il numero orm con la pistola (enter automatico)
013880041221     c***37              exsr      ctrd01
013890041221     c                   if        *in37 = *on
013900050119     c***                if        flgfit <> 'S' and s_v0corm <> V0corm
013910050119     c                   if        flgfit <> 'S'
013920050119     c* passo flag a ctrd01 per dire di riemettere la videata dopo aver
013930050119     c* elaborato eventuali proposte a prescindere dal fatto che vi siano
013940050119     c* dati da proporre o meno (serve per non dare errore sul n.colli blocc
013950050119     c* ando così la tastiera)
013960050119     c                   eval      wsolo_prp = '1'
013970041221     c                   exsr      ctrd01
013980041221     c                   else
013990041221     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
014000041221     c* (per uniformità: fa così anche per orm reale)
014010050117     c* Idem se orm non fittizio ma rimasto invariato
014020041221     c  n38              z-add     13            h1riga
014030041221     c  n38              z-add     20            h1colo
014040041221     c                   endif
014050041221     c                   endif
014060940825     C                   GOTO      FOR01
014070940819     C                   ENDIF
014080930330     C**
014090051207     C* F16 - ANNULLAMENTO
014100111007    2C     *INKQ         IFEQ      *ON
014110111007    3c     atrann        ifeq      *blanks
014120110516     c* window per richiesta conferma
014130110516     c                   exsr      sr_geswdwconf
014140111007    4c                   select
014150111007   whc                   when      wvann='N'
014160110516     c                   goto      for01
014170111007   whc                   when      wvann='S'
014180111007     c* f16 in manutenzione --> cancello bolla da blp e file collegati
014190111007    5c                   if        *in15=*off
014200930915     C                   EXSR      ANNULL
014210111007    6C                   if        wf12 = '1' or *in90 = '1'
014220060307     c                   goto      for01
014230111007    6c                   endif
014240930915     C                   GOTO      FINE
014250111007   x5c                   else
014260111007     c* f16 in conferma --> ritorno al chiamante codice '2' per far cancellare
014270111007     c* vab e suoi collegati
014280111007     c                   eval      §lpfpr='2'
014290111007     C                   GOTO      FINE
014300111007    5c                   endif
014310111007    4c                   endsl
014320111007   x3c                   else
014330111007     c* se premuto f16 ma non è abilitato riemetto la videata
014340111007     c                   goto      for01
014350111007    3c                   endif
014360940214    2C                   END
014370010216     C**
014380051207     C* F8 - INTERROGAZIONE O.R.M.
014390010223     C     *INKH         IFEQ      *ON
014400010219     C     WORM          ANDEQ     'S'
014410010227     C     PARTCH        ANDNE     'P'
014420010220     C     VIDNOR        ANDEQ     *ZEROS
014430111122     c* se lnp import continuo a richiamare FIOR04R
014440111122     c*****              if        %lookup(vidlnp:fio)=0
014450111122     c****                         and %lookup(999:fio)=0
014460111122     c                   if        vidlnp<>prelnp
014470111122     c                   clear                   og143
014480111122     C     vidlnp        CHAIN     AZORG01L      UNIORG
014490111122     c                   if        %found(azorg01l)
014500111122     C                   MOVEL     ORGDE3        OG143
014510111122     c                   endif
014520111122     c                   eval      prelnp=vidlnp
014530111122     c                   endif
014540111122     c                   if        §ogntw='DPD' or §ogntw='EEX' or
014550111122     c                             §ogntw='FED'
014560010216     C                   CLEAR                   DSOR04
014570010216     C                   MOVEL     '1'           I04RIC
014580051207     C                   Z-ADD     VIDLNP        I04POR
014590051207     c
014600051207     c* Richiamo tnsb51r per vedere che p.o. ritiro passare
014610051207     c                   if        *in12 and not *in15 and vidccm>0
014620051212     c                   clear                   tntb50ds
014630051207     C                   move      VIDCCM        b50ke2
014640051207     C*
014650051207    3C     VIDFLC        IFEQ      0
014660051207     C                   MOVEL     VIDLNP        b50ke2
014670051207     C                   ELSE
014680051207     C                   MOVEL     VIDFLC        b50ke2
014690051207    3C                   ENDIF
014700051207     c
014710051207     c                   movel     b50ke2        b50ke1
014720051207     c* controllo linea
014730051207     c                   movel     'C'           b50opz
014740051207     c                   movel     vidlnp        b50poa
014750051207     c                   call      'TNTB51R'
014760051207     c                   parm                    kpjba
014770051207     c                   parm                    tntb50ds
014780051207     c
014790051214     c                   if        b50err=' ' and b50ormreso>*zeros
014800051207     c                   movel     b50ormreso    i04por
014810051207     c                   endif
014820051207     c                   endif
014830051207     c
014840010216     C                   CALL      'FIOR04R'
014850010216     C                   PARM                    KPJBA
014860010216     C                   PARM                    DSOR04
014870010216     C     O04CM3        IFEQ      *BLANKS
014880010216     C                   Z-ADD     O04POE        VIDPOE
014890010222     C                   MOVEL     O04NSR        VIDNOR
014900010222     C                   MOVE      O04NOR        VIDNOR
014910010216     C                   Z-ADD     O04NRV        VIDNRV
014920050117     c                   eval      *inkh = '0'
014930050117     c                   else
014940010216     C                   GOTO      FOR01
014950050117     c                   endif
014960110419     c                   else
014970110419     c                   if        vidpdr<=*zeros
014980110419     c                   eval      *in90='1'
014990110419     c                   eval      *in56='1'
015000110419     c                   eval      vidmsg=err(210)
015010110419     c                   goto      for01
015020110419     c                   else
015030110419     c                   clear                   fior58ds
015040110419     c                   movel     vidlnp        ior58pdr
015050110419     c                   move      vidpdr        IOR58PDR
015060110419     C                   CALL      'FIOR58R'
015070110419     C                   PARM                    KPJBA
015080110419     C                   PARM                    fior58ds
015090110419     C     OOR58F03      IFEQ      *BLANKS
015100110419     C                   Z-ADD     OOR58POE      VIDPOE
015110110419     C                   MOVEL     OOR58NSR      VIDNOR
015120110419     C                   MOVE      OOR58NOR      VIDNOR
015130110419     C                   Z-ADD     OOR58NRV      VIDNRV
015140110419     c                   eval      *inkh = '0'
015150110419     c                   else
015160110419     C                   GOTO      FOR01
015170110419     c                   endif
015180110419     c                   endif
015190110419     c                   endif
015200010216     C                   ENDIF
015210010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
015220010227     C* SE NON SEMPRE VISUALIZZATO. SE NON ATTIVATA PROCEDURA ORM
015230010227     C* O SONO NEL GIRO DEI PREPAGATI MIEI RIEMETTO VIDEATA
015240010227     C   KHWORM          IFNE      'S'
015250010227     C     PARTCH        OREQ      'P'
015260010227     C                   GOTO      FOR01
015270010227     C                   ENDIF
015280930915     C*
015290910219     C* CMD21 - GESTIONE DETTAGLIO SEGNACOLLI (SOLO IN DISK CLI)
015300940214    2C   KV              DO
015310950321     C                   MOVEL     §LPCCM        PARCCM
015320991116     C                   MOVEL     §LPAAC        PARAAS
015330920204     C                   MOVEL     §LPNRS        PARNRS
015340911031     C                   MOVEL     §LPLNP        PARLNP
015350911031     C                   MOVEL     §LPLNA        PARLNA
015360911031     C                   MOVEL     §LPNSP        PARNSP
015370020917      * P.O DI GESTIONE
015380021002     C                   MOVEL     §FGS          PARFGS
015390910219     C                   MOVEL     PARAM         KPJBU
015400941230     C                   CALL      'FNLS78R'
015410910219     C                   PARM                    KPJBA
015420910219     C                   GOTO      FOR01
015430940214    2C                   END
015440990701     C* F22 - GESTIONE ESTENSIONE DETT. SEGNACOLLI (SOLO IN DISK CLI)
015450980325    2C   KW              DO
015460000904     C                   EXSR      GESD08
015470980325     C                   GOTO      FOR01
015480980325    2C                   END
015490110512     c* F17-Indirizzo Email destinatario
015500110512     c                   if        *inkr=*on
015510110512     c                   if        atremd=*blanks
015520110512     c                   exsr      sr_geswdwemd
015530110512     c                   endif
015540110512     C                   GOTO      FOR01
015550110512     c                   endif
015560110705     c* F5-Riepilogo bolle da confermare
015570110519     c                   if        *inke=*on
015580110517     c                   Clear                   Fnls80ds
015590110517     c                   Movea     l1            dpog
015600110517     c                   z-add     99            d80Nsr
015610110517     c                   if        vidccm>0
015620110517     C                   MOVE      VIDCCM        d80ccm
015630110517     C     VIDFLC        IFNE      0
015640110517     C                   movel     VIDFLC        d80ccm
015650110517     C                   ELSE
015660110517     C                   movel     VIDLNP        d80ccm
015670110517     C                   ENDIF
015680110517     c                   endif
015690110517     c                   if        vidlna>*zeros
015700110517     c                   Movel     Vidlna        d80lna
015710110517     c                   else
015720110517     c                   z-add     999           d80lna
015730110517     c                   endif
015740110517     c                   call      'FNLS80R'
015750110517     c                   parm                    kpjba
015760110517     c                   parm                    fnls80ds
015770110517     C                   GOTO      FOR01
015780110517     c                   endif
015790110705     c* F19-codici CUP/CIG per tacciabilità flussi finanziari
015800110705     c                   if        *inkt=*on
015810110705     c                   if        atrcup=*blanks
015820110705     c                   exsr      sr_geswdwcup
015830110705     c                   endif
015840110705     C                   GOTO      FOR01
015850110705     c                   endif
015860940825     C*
015870971211     C* F7  - ABILITO CAMPO PER RICERCA ALFABETICA
015880941021     C   KG              SETON                                        0138
015890900427     C   KG              GOTO      FOR01
015900971211     C* F10 - ABILITO CAMPO PUNTO OPERATIVO CLIENTE
015910941020     C   KJ              SETON                                        1438
015920940921     C   KJ              GOTO      FOR01
015930900427     C* CONTROLLI FORMATO1
015940900824     C     CT1TAG        TAG
015950050119     c* imposto flag per dire se fare solo eventuali proposte da orm
015960050119     c* e poi riemettere sempre la videata o se dopo le proposte even
015970050119     c* tuali continuare coi controlli
015980050119     c* Serve perchè se sono stati personalizzati tutti i campi proponi
015990050119     c* bili il pgm emetterebbe messaggio di errore su n.colli bloccand
016000050119     c* la tastiera senza aver dato il tempo al bollettista di inserire
016010050119     c* i dati mancanti
016020050209     c* lo faccio solo se sono in immissione bolle non lo faccio in
016030050209     c* conferma bolle e in manutenzione
016040050209     c                   eval      wsolo_prp = ' '
016050050209     c                   if        s_vidorm = *zeros and *in12 = *off
016060050119     c                   eval      wsolo_prp = '1'
016070050119     c                   endif
016080010216     C                   EXSR      CTRD01
016090950126     C*
016100950126     C* CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
016110950126     C* DI ERRORE
016120950126     C     WEMFOR        IFEQ      '1'
016130010816     C                   EXSR      ESCIER
016140950126     C     §LPFPR        IFNE      '5'
016150950127     C                   GOTO      FOR01
016160950127     C                   ELSE
016170950127     C                   GOTO      FINE
016180950126     C                   ENDIF
016190950126     C                   ENDIF
016200010215     C* RIEMETTO LA VIDEATA PER VISUALIZZARE CAMPI VIDEO DA ORM
016210010215     C     WEFORM        IFEQ      '1'
016220010215     C                   GOTO      FOR01
016230010215     C                   ENDIF
016240010214     C* ESEGUO CONTROLLI DI INCONGRUENZA CON CAMPI DELL'ORM
016250010214     C     WORM          IFEQ      'S'
016260010214     C                   EXSR      CNFOR1
016270010214     C     WEMFOR        IFEQ      '1'
016280010214     C                   EXSR      ESCIER
016290010214     C     §LPFPR        IFNE      '5'
016300010214     C                   GOTO      FOR01
016310010214     C                   ELSE
016320010214     C                   GOTO      FINE
016330010214     C                   ENDIF
016340010214     C                   ENDIF
016350010214     C                   ENDIF
016360020122     C* SE IMMESSA LA NAZIONE EMETTO WINDOW  PER RICHIESTA CONFERMA
016370020131     c* (Se si tratta di nazione per cui è richiesta forzatura (§15FFN="S"))
016380020122     C* IN MANUTENZIONE LA EMETTO SOLO SE È DIVERSA DA QUELLA CHE C'ERA
016390020122    2C     VIDNZD        IFNE      *BLANKS
016400020131     c     DESFFN        ANDEQ     'S'
016410030707      * e se non è una bolla di recupero
016420030707     c     §3arbl        andne     'R'
016430020123     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
016440020123     c* se devo emettere la window o ritornare al chiamante con errore
016450091111     c                   move      '1'           wvidobb           1
016460020123     c                   exsr      escier
016470091111     c                   move      ' '           wvidobb
016480020123    3c     §lpfpr        ifne      '5'
016490020122     C* Manutenzione
016500020123    4C     *IN12         IFEQ      *ON
016510020122     C     *IN15         ANDEQ     *OFF
016520020122     C     VIDNZD        ANDNE     NZDINI
016530020122     C* Immissione
016540020122     C     *IN12         OREQ      *OFF
016550020122     c* Conferma bolle
016560020122     C     *IN15         OREQ      *ON
016570020122     C                   MOVEL     '15'          COD
016580020122     C                   MOVEL(P)  VIDNZD        KEY
016590020122     C                   EXSR      CTABEL
016600020122     C                   MOVEL     TBLUNI        DS15
016610020123     c                   eval      w01nzd = %trim(vidnzd) + '-' + §15des
016620020123     c     §lpfpr        ifne      'V'
016630020123     c                   write     ls01d01
016640020123     c                   endif
016650020124     c     forw01        tag
016660020122     C                   EXFMT     LS01W01
016670020122     C* Se premuto F12 riemetto prima videata.
016680020123     C* Se pgm richiamato con "W" anzichè riemettere la prima videata ritorn
016690020123     c* l'errore al chiamante
016700020123     C   KL              goto      for01
016710020124     c  NKF              goto      forw01
016720020123    4C                   ENDIF
016730020123   x3c                   else
016740020123     c                   goto      fine
016750020123    3c                   endif
016760020122    2C                   ENDIF
016770900926     C*
016780000831     C* DISK C
016790000830     C* Emetto videata per inserimento del cod. CHI SONO" se DISK C
016800020917     C* in bollettazione o se diska senza fivat
016810050223     c* Escludo:
016820050223     C* 1) Bolle export dpd disk c se chi sono non automatico perchè in
016830050223     c*    questo caso il chi sono non viene immesso da sfl
016840050223     c* 2) Bolle import dpd sempre perchè anche in questo caso il chi sono
016850050223     c*    non viene immesso da sfl
016860000913     C  N12
016870000913     COR 12
016880000913     CAN 15§1BF12        IFEQ      'S'
016890001011     C     WEXDPD        ANDNE     'S'
016900050223     c     *in79         andeq     *off
016910001009     C     §1BF12        OREQ      'S'
016920001011     C     WEXDPD        ANDEQ     'S'
016930001009     C     §1BF13        ANDEQ     'A'
016940030321      * se non ho superato i 500 colli
016950030321If  2c                   If        v1cncl <= 500
016960000911     C     FOR09         TAG
016970010816     C* IMPOSTO CAMPI SUBFILE CONTROL
016980010816     C                   MOVE      WKSC          V8CKSC
016990010816     C                   MOVEL     VIDDMT        V8DKSC
017000000904     C                   EXSR      GESD09
017010000914     C     *INKL         CABEQ     *ON           FOR01
017020000830     C* Controllo i dati immessi
017030000830     C                   EXSR      CTRS08
017040000830     C     *IN90         IFEQ      *ON
017050000830     C                   EXSR      ESCIER
017060000830     C     §LPFPR        IFNE      '5'
017070000904     c* Se errore riemetto videata subfile cod.chi sono per poterla
017080000904     c* manutenzionare
017090000904     C                   EXSR      GESD08
017100000904     C   KL              GOTO      FOR01
017110000830     C                   ELSE
017120000830     C                   GOTO      FINE
017130000830     C                   ENDIF
017140000830     C                   ENDIF
017150030321   x2c                   Else
017160030321     c                   Eval      VidMsg = Err(275)
017170030321     c                   Eval      *In90 = *On
017180030321     c                   Eval      *In62 = *On
017190030321     C                   EXSR      ESCIER
017200030321     C     §LPFPR        IFNE      '5'
017210030321     C                   GOTO      FOR01
017220030321     C                   ELSE
017230030321     C                   GOTO      FINE
017240030321     C                   ENDIF
017250030321    2c                   EndIf
017260000830     C                   ENDIF
017270021120
017280021120      * Solo x FedEx richiamo di nuovo il trul27 xchè in questo momento ho anche
017290021120      * il prefisso del segnacollo che mi serve per ricerare la cartello
017300021120      * FedEx giusta
017310021120     c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED') and
017320021120     c                             (Prefisso(1) = 'FD' or Prefisso(1) = 'FM')
017330021120     c                   Clear                   Trul27Ds
017340021120     c                   Movel     Prefisso(1)   I27Tip
017350021120     c                   Exsr      TarCar
017360021120     c                   If        Not *In12
017370021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
017380021120      * a quanto indicato in tabella "DFE"
017390021120     c                   If        O27Fie = 'N' and VidPkg > §DfePkgD
017400021120     c                   Movel     Err(264)      VidMsg
017410021120     c                   Eval      *In90 = *On
017420021120     c                   Eval      *In63 = *On
017430021120     c                   EndIf
017440021120     c                   EndIf
017450021120      * Errori
017460021120     c                   If        *In90
017470021120      * CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
017480021120      * DI ERRORE
017490021120     C                   EXSR      ESCIER
017500021120     C     §LPFPR        IFNE      '5'
017510021120     C                   GOTO      FOR01
017520021120     C                   ELSE
017530021120     C                   GOTO      FINE
017540021120     C                   ENDIF
017550021120     c                   EndIf
017560021120     c                   EndIf
017570021120
017580011107     C* SE ATTIVATA PRCEDURA ORM E NUMERO ORM NON FITTIZIO DEVO
017590010215     C* PROPORRE I CAMPI DELLA SECONDA VIDEATA PRIMA DI EMETTERLA
017600010215     C* LO FACCIO SOLO SE NON SONO IN CONFERMA BOLLE DA DISCHETTO
017610010215     C     WORM          IFEQ      'S'
017620010215     C     FLGFIT        ANDNE     'S'
017630010215     C     PARTCH        ANDNE     'P'
017640070427     C     *IN12         IFEQ      *OFF
017650070427     C     *IN15         OREQ      *OFF
017660010215     C* in manutenzione propongo solo se variato il numero ORM
017670070427     C     WORMMD        ANDEQ     '1'
017680010215     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
017690010215     c* fine dell'immissione
017700010215     C                   EXSR      PRPOR2
017710010220     C* SE SONO IN MANUTENZIONE SEGNALO CHE POTREBBERO ESSERE VARIATI
017720010220     C* DEI DATI PRENDENDOLI DAL NUOVO N.ORM
017730010220     C   12
017740010220     CANN15WPRIMV        IFEQ      *BLANKS
017750010220     C                   SETON                                        90
017760010220     C                   MOVEL     ERR(226)      VIDMSG
017770010220     C                   MOVEL     '1'           WPRIMV            1
017780010220     C                   ENDIF
017790010215     C                   ENDIF
017800091008     c* se bolla import     porto assegnato abbinata ad orm devo proporre
017810070427     c* il mittente dell'orm nel mittente originale
017820091008     c***                if        *in79 and flgtb1='A'
017830091008     c                   if        flgtb1='A' and (§ogntw='EEX' or
017840091008     c                             §ogntw='FED' or §ogntw='DPD')
017850070427     c                   if        *in12='0' or *in15 or
017860070427     c                             (*in15='0' and (wormmd='1' or
017870070427     c                             (flgtb1='A' and flgtb1<>savtb1)))
017880070427     c                   exsr      prpor2_rmo
017890070427     c                   endif
017900070427     c                   endif
017910010215     C                   ENDIF
017920001020     C*
017930001020     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
017940001020     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
017950060113     C** 12
017960060113    2C**AN 15§LPFPR        IFNE      'V'
017970060113     C***                   GOTO      TAG02
017980060113    2C**                   END
017990040226
018000040227      * Salto il prossimo controllo se bolla con Lnp o Lna DPD
018010040227S   1c                   Select
018020040227     c                   When      *In79
018030040227     c                   When      VidDpd = 'D' or a_§OgNtw = 'DPD'
018040040227     c                   Other
018050040226      * se orm con serie devo recuperare i riferimenti del mittente
018060040226      * immessi nella bolla originale legata al ritiro contestuale
018070040226      * se previsto da tabella 'OSR'
018080040227      * non forzo se bolla con Lna o Lnp DPD
018090040227if  2c                   If        wonsr > *Zeros and flgfit <> 'S' and
018100040227     c                             (d§OsrRmn = 'S' or d§OsrRma = 'S')
018110040226      * richiamo pgm x recupero dei riferimenti
018120040226     c                   Clear                   Fnls26ds
018130040227     c                   Move      wrmaas        I26Aas
018140040227     c                   Move      wrmlnp        I26Lnp
018150040227     c                   Move      wrmnrs        I26Nrs
018160040227     c                   Move      wrmnsp        I26Nsp
018170040226     c                   Call      'FNLS26R'
018180040226     c                   Parm                    Fnls26ds
018190040227if  3c                   If        O26Err = *Zeros
018200040227if  4c                   If        d§OsrRmn = 'S'
018210040227     c                   Eval      VidRmn = O26Rmn
018220040226      * proteggo il campo
018230040226     c                   Movel     Prot1         AtrRmn
018240040226     c                   Eval      wrifm = *On
018250040227    4c                   EndIf
018260040227if  4c                   If        d§OsrRma = 'S'
018270040226     c                   Eval      VidRma = O26Rma
018280040226      * proteggo il campo
018290040226     c                   Movel     Prot1         AtrRma
018300040226     c                   Eval      wrifm = *On
018310040227    4c                   EndIf
018320040227    3c                   EndIf
018330040227    2c                   EndIf
018340040227    1c                   EndSl
018350030409
018360030409      * Prima di procedere con la seconda videata devo emettere una finestra
018370030409      * se spedizione con lna FedEx o se spedizione relative ad ORM
018380030409      * commissionati da FedEx
018390030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
018400091111     c                   move      '1'           wvidobb           1
018410060113     c                   exsr      escier
018420091111     c                   move      ' '           wvidobb
018430060113    3c     §lpfpr        ifne      '5'
018440060113     c     §lpfpr        ifne      'V'
018450060113     c                   write     ls01d01
018460060113     c                   endif
018470091112     c                   eval      $fine='0'
018480091112     c                   Dow       $fine='0'
018490060110     c                   clear                   w02tes1
018500030409     c                   Eval      w02Tes = Rigw(1)
018510030409     c                   Eval      w02Rig1 = Rigw(3)
018520030409     c                   Eval      w02Rig2 = Rigw(4)
018530030409     c                   Eval      w02Rig3 = Rigw(5)
018540030409     c                   Eval      w02Rig4 = Rigw(6)
018550030409     c                   Exfmt     ls01w02
018560030409     c                   If        *InKl = *On
018570091112     c                   eval      $fine='1'
018580110309     c                   eval      *inkl=*off
018590030409     c                   EndIf
018600030409     c                   EndDo
018610060113   x3c                   else
018620060113     c                   goto      fine
018630060113    3c                   endif
018640030409     c                   EndIf
018650060113     c*
018660030409     c                   If        §orMic = 'F'
018670091111     c                   move      '1'           wvidobb           1
018680060113     c                   exsr      escier
018690091111     c                   move      ' '           wvidobb
018700060113    3c     §lpfpr        ifne      '5'
018710060113     c     §lpfpr        ifne      'V'
018720060113     c                   write     ls01d01
018730060113     c                   endif
018740091112     c                   eval      $fine='0'
018750091112     c                   Dow       $fine='0'
018760060110     c                   clear                   w02tes1
018770030409     c                   Eval      w02Tes = Rigw(2)
018780030409     c                   Eval      w02Rig1 = Rigw(7)
018790030409     c                   Eval      w02Rig2 = Rigw(4)
018800030409     c                   Eval      w02Rig3 = Rigw(8)
018810030409     c                   Clear                   w02Rig4
018820030409     c                   Exfmt     ls01w02
018830030409     c                   If        *InKl = *On
018840091112     c                   eval      $fine='1'
018850110309     c                   eval      *inkl=*off
018860030409     c                   EndIf
018870030409     c                   EndDo
018880060113   x3c                   else
018890060113     c                   goto      fine
018900060113    3c                   endif
018910030409     c                   EndIf
018920060113      * Prima di procedere con la seconda videata devo emettere una finestra
018930060113      * se spedizione in porto assegnato con destinatario con obbligo ddt in
018940060113      * fase di consegna (DDT=SI)
018950060113    2c                   If        Vidbam = 'S' and §dstddt = 'S' and
018960060113     c                             §3arbl <> 'R' and §1bf16 <> 'S' and
018970060113     c                             flgtb1 = 'A'
018980060113     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
018990060113     c* se devo emettere la window o ritornare al chiamante con errore
019000091111     c                   move      '1'           wvidobb           1
019010060113     c                   exsr      escier
019020091111     c                   move      ' '           wvidobb
019030060113    3c     §lpfpr        ifne      '5'
019040060113     c     §lpfpr        ifne      'V'
019050060113     c                   write     ls01d01
019060060113     c                   endif
019070091112     c                   eval      $fine='0'
019080091112    4c                   Dow       $fine='0'
019090060113     c                   clear                   w02tes
019100060113     c                   Eval      w02Tes1 = Rigw(9)
019110060113     c                   Eval      w02Rig2 = Rigw(10)
019120060113     c                   clear                   w02Rig1
019130060113     c                   clear                   w02Rig3
019140060113     c                   clear                   w02Rig4
019150060113     c                   Exfmt     ls01w02
019160060113     c                   If        *InKl = *On
019170091112     c                   eval      $fine='1'
019180110309     c                   eval      *inkl=*off
019190060113     c                   EndIf
019200060113    4c                   EndDo
019210060113   x3c                   else
019220060113     c                   goto      fine
019230060113    3c                   endif
019240060113    2c                   EndIf
019250090323     c
019260090323     c* tasto funzionale f15=cli/tar per tassazione porto assegnato
019270090323     c* Se la bolla non è in porto assegnato non è da visualizzare
019280090323     c                   if        flgtb1<>'A'
019290090323     c                   eval      atrf15=nodi
019300090323     c                   else
019310090323     c                   clear                   atrf15
019320090323     c                   endif
019330060113     c*
019340060113     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
019350060113     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
019360060113     C   12
019370060113    2CAN 15§LPFPR        IFNE      'V'
019380060113     C                   GOTO      TAG02
019390060113    2C                   END
019400941020     C*
019410941020     C* SE TUTTO OK EMETTO FORMATO2
019420941020     C     FOR02         TAG
019430940825     C* V I D E O   2
019440940819     C                   EXFMT     LS01D02
019450941003     C*
019460900926     C     TAG02         TAG
019470950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
019480950126     C                   EXSR      OFFD02
019490900926     C*
019500000905     C* CMD12 - RITORNO VIDEATA PRECEDENTE
019510000905     C     *INKL         IFEQ      *ON
019520000914     C* PER DISK C MANUTENZIONE RITORNO ALLA PRIMA VIDIEATA
019530000914     C* (IN QUESTO CASO INFATTI LA VIDEATA DI MANUTENZIONE COD CHI SONO
019540000914     C* DEVE ESSERE RICHIESTA CON F22 IN PRIMA VIDEATA)
019550000905     C     §1BF12        IFEQ      'S'
019560001011     C     WEXDPD        ANDNE     'S'
019570050223     c     *in79         andeq     *off
019580000914     C     *IN12         ANDEQ     *OFF
019590001009     C*
019600001009     C     §1BF12        OREQ      'S'
019610001011     C     WEXDPD        ANDEQ     'S'
019620001009     C     §1BF13        ANDEQ     'A'
019630001009     C     *IN12         ANDEQ     *OFF
019640001009     C*
019650000914     C     §1BF12        OREQ      'S'
019660001011     C     WEXDPD        ANDNE     'S'
019670050223     c     *in79         andeq     *off
019680000914     C     *IN15         ANDEQ     *ON
019690001009     C*
019700001009     C     §1BF12        OREQ      'S'
019710001011     C     WEXDPD        ANDEQ     'S'
019720001009     C     §1BF13        ANDEQ     'A'
019730001009     C     *IN15         ANDEQ     *ON
019740000905     C                   GOTO      FOR09
019750000905     C                   ELSE
019760000905     C                   GOTO      FOR01
019770000905     C                   ENDIF
019780000905     C                   ENDIF
019790010215     C* PRIMA DI FARE I CONTROLLI DELLA VIDEATA, SE ATTIATA PROC.ORM,
019800010215     C* E ORM NON FITTIZIO, PROPONGO EVENTUALI CAMPI SE A VIDEO SONO
019810010215     C* VUOTI
019820010215     C     WORM          IFEQ      'S'
019830010215     C     FLGFIT        ANDNE     'S'
019840010215     C     PARTCH        ANDNE     'P'
019850010215     C     *IN12         IFEQ      *OFF
019860010226     C     *IN15         OREQ      *OFF
019870010215     C                   EXSR      PRPOR2
019880010215     c* Se ho proposto dei campi non continuo i controlli ma devo
019890010215     c* riemettere videata per visualizzare i dati aggiunti
019900010215     C     WEFORM        IFEQ      '1'
019910010215     C                   GOTO      FOR02
019920010215     C                   ENDIF
019930010215     C                   ENDIF
019940091008     c****               if        *in79 and flgtb1='A'
019950091008     c                   if        flgtb1='A'  and (§ogntw='DPD' or
019960091008     c                             §ogntw='FED' or §ogntw='EEX')
019970070427     c                   exsr      prpor2_rmo
019980070427     C     weform        ifeq      '1'
019990070427     C                   goto      for02
020000070427     C                   endif
020010070427     c                   endif
020020010215     C                   ENDIF
020030040226
020040040226      * F11 - Calcolo volume
020050040226     c                   If        *Inkk = *On
020060040226     c                   Clear                   p26vol
020070040226     c                   Call      'TRUL36R'
020080040226     c                   Parm                    p26vol
020090040226     c                   Add       p26vol        VidVol
020100040226      * imposto wemfor per riemettere la videata
020110040301     c                   Eval      wkk = *On
020120040226     c                   EndIf
020130040226
020140900427     C* CONTROLLI
020150940825     C                   EXSR      CTRD02
020160040301
020170040301      * Se ho richiamato il calcolo del volume riemetto la videata
020180040301      * in modo da far vedere il volume calcolato in automatico
020190040301     c                   If        wkk = *On
020200040301     c                   Eval      wemfor = '1'
020210040301     c                   EndIf
020220940826     C* RIEMETTO FORMATO
020230950127     C     WEMFOR        IFEQ      '1'
020240950127     C                   EXSR      ESCIER
020250950127     C     §LPFPR        IFNE      '5'
020260950127     C                   GOTO      FOR02
020270950127     C                   ELSE
020280950127     C                   GOTO      FINE
020290950127     C                   ENDIF
020300950127     C                   ENDIF
020310010215     C* RICHIAMO ROUTINE DI CONTROLLO INCONGRUENZA COD.TARIFFA CON
020320010306     C* O.R.M.
020330010215     C     WORM          IFEQ      'S'
020340010215     C     FLGFIT        ANDNE     'S'
020350010215     C     PARTCH        ANDNE     'P'
020360010215     C     *IN12         IFEQ      *OFF
020370010301     C     *IN15         OREQ      *OFF
020380010215     C                   EXSR      CNFOR2
020390010215     C* RIEMETTO FORMATO
020400010215     C     WEMFOR        IFEQ      '1'
020410010215     C                   EXSR      ESCIER
020420010215     C     §LPFPR        IFNE      '5'
020430010215     C                   GOTO      FOR02
020440010215     C                   ELSE
020450010215     C                   GOTO      FINE
020460010215     C                   ENDIF
020470010215     C                   ENDIF
020480010215     C                   ENDIF
020490010215     C                   ENDIF
020500090323     c***
020510090323     C* F15=Cli/tariffa per tassazione porti assegnati
020520090323     c***
020530090323     c* emetto window solo se tasto di funzione è abilitato
020540090326     c                   if        *inkp='1'
020550090326     c                   if        atrf15=*blanks
020560090323     c                   exsr      geswdw_clitar
020570090326     c                   else
020580090326     c                   movel     err(322)      vidmsg
020590090326     c                   seton                                        90
020600090326     c                   endif
020610090323     c                   goto      for02
020620090326     c                   endif
020630941115     C***
020640941115     C* CMD8 - RISTAMPA BOLLA
020650941115     C***
020660000627     C* NON POSSO FARE RISTAMPA SE SONO SOLO NEI CONTROLLI
020670000627     C     §LPFLG        IFEQ      'C'
020680000627     C     *INKH         ANDEQ     *ON
020690000627     C                   MOVEL     ERR(203)      VIDMSG
020700000627     C                   SETON                                        90
020710000627     C                   GOTO      FOR02
020720000627     C                   ENDIF
020730000627     C**
020740970128     C* POSSO RISTAMPARE SOLTANTO SE ALLEGA BAM E' S
020750970128     C*  O NO MA LA BOLLA E' GIA' STATA STAMPATA
020760000112     C  N22*INKH         IFEQ      *ON
020770970128     C     VIDBAM        IFEQ      'N'
020780970128     C     BLPFST        IFEQ      'N'
020790970128     C     BLPFST        OREQ      'S'
020800970128     C* ERRORE
020810000627     C                   MOVEL     ERR(137)      VIDMSG
020820970128     C                   SETON                                        90
020830970128     C                   GOTO      FOR02
020840970128     C                   ENDIF
020850970128     C                   ENDIF
020860970128     C*
020870970128     C                   MOVEL     '1'           CMD8              1
020880970128     C                   ENDIF
020890091111
020900091111     c*** Gestione window per scelta Beneficiario Contrassegno
020910091124     c*** per spedizione con contrassegno legata ad orm che paga ordinante
020920091124     C*** (spedizione in assegnato con triangolazione)
020930091123     c                   clear                   wwdwcas           1
020940091211     c                   if        nochkticC=*on
020950091111     c                   eval      wvidobb='1'
020960091111     c                   exsr      escier
020970091111     c                   eval      wvidobb=' '
020980091111    2c                   if        §lpfpr<>'5'
020990091111    3c                   if        *in12 and *in15 and §lpfpr<>'V'
021000091111     c                   write     ls01d02
021010091111    3c                   endif
021020091111     c                   exsr      geswdw_cas
021030091123     c                   eval      wwdwcas='S'
021040091111     c   kl              goto      for02
021050091111   x2c                   else
021060091111     c                   goto      fine
021070091111    2c                   endif
021080091119     c                   endif
021090940920     C***
021100990610     C* F9  - ESTENSIONE BOLLA
021110940920     C***       VISUALIZZA LA 2 BOLLA SE ESISTE E LA TASSAZIONE
021120940923     C* SE TASSAZIONE CON TARIFFA MITTENTE CI VADO OBBLIGATORIAMENTE
021130940923     C* SE INSERITO ALMENO UN CAMPO E POI CMD12 CI RITORNO OBBLIGATOR
021140940826    2C     *INKI         IFEQ      *ON
021150940923     C     SAVFTM        ORNE      ' '
021160950125     C     *IN04         ANDEQ     *ON
021170940923     C     VIDFTM        ORNE      ' '
021180950125     C     *IN04         ANDEQ     *ON
021190961111     C* SE FRANCO FRONTIERA DEVO OBBLIGATORIAMENTE INDICARE IL PORTO
021200961111     C     VIDFBR        OREQ      'F'
021210940923     C     WEMD03        ORNE      ' '
021220990610     C* SE PREPAGATO CI VADO OBBLIGATORIAMENTE
021230990610     C     PARTCH        OREQ      'P'
021240010305     C     §LPFPR        OREQ      'O'
021250000112     C     *IN22         OREQ      *ON
021260940826     C                   EXSR      GESD03
021270940826     C   KL              GOTO      FOR02
021280941020     C*
021290950419     C* SE E' ERRORE E PGM DA DISK CLIENTI CHIAMATO CON "W" --> ESCO
021300950127     C     §LPFPR        IFEQ      '5'
021310950127     C                   GOTO      FINE
021320950127     C                   ENDIF
021330940923     C*
021340940923   X2C                   ELSE
021350940923     C*
021360101104     C* SE CONTO SERVIZIO IMMISSIONE PER F6   o F8
021370101104     c                   if        not *inkf and not *inkh
021380101104    3C     WFPR          IFNE      'I'
021390940923     C     §3ARBL        ANDEQ     'C'
021400950407     C*
021410950407     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
021420950410    4C     VIDLNP        IFNE      102
021430950407     C     *IN12         OREQ      *OFF
021440950407     C     *IN15         OREQ      *OFF
021450940923     C                   MOVEL     ERR(40)       VIDMSG
021460940923     C                   SETON                                        90
021470940923     C                   GOTO      FOR02
021480950410    4C                   ENDIF
021490950410    3C                   ENDIF
021500101104     c                   endif
021510960318     C**
021520960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
021530960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
021540960805     C* NON LO FACCIO PER LE SPEDIZIONI DI RECUPERO
021550960805     C  NKF§3ARBL        IFNE      'R'
021560030704     c     wforw03       andeq     *Blanks
021570121003     C                   EXSR      CTRCRG
021580121003     c   41              GoTo      For02
021590960805     C                   ENDIF
021600940923     C*
021610940923    2C                   ENDIF
021620940920     C***
021630900608     C* CMD8 - RISTAMPA BOLLA
021640940920     C***
021650970128     C     *INKH         IFEQ      *ON
021660970128     C     VIDBAM        IFEQ      'N'
021670970128     C     BLPFST        IFEQ      'N'
021680970128     C     BLPFST        OREQ      'N'
021690970128     C* ERRORE
021700970128     C                   MOVEL     ERR(137)      VIDMSG
021710970128     C                   SETON                                        90
021720970128     C                   GOTO      FOR02
021730970128     C                   ENDIF
021740970128     C                   ENDIF
021750970128     C*
021760970128     C                   MOVEL     '1'           CMD8              1
021770970128     C                   ENDIF
021780940920     C***
021790930930     C* SE VARIATA LIN.ARRIVO O DATA SPEDIZIONE DI UNA BOLLA BORDERIZZ.
021800930930     C* EMETTO IL MESSAGGIO E LA SBORDERIZZO (SONO ESCLUSI I RECUPERI)
021810940214     C   12
021820940214    2CANN15§1BFG4        IFEQ      'S'
021830940920     C     BLPDBR        ANDGT     0
021840940920     C*
021850940920    3C     COMLNA        IFNE      BLPLNA
021860940920     C     BLPDSP        ORGT      BLPDBR
021870930331     C* DECODIFICA LNA
021880930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
021890940928     C  N30              MOVEL     ORGDES        V1DLNA
021900930331     C*
021910940920     C                   EXFMT     LS01D05
021920940920     C                   CLEAR                   BLPNFV
021930940920     C                   CLEAR                   BLPDBR
021940940920     C                   CLEAR                   BLPFLP
021950950126     C* MEMORIZZO CHE HO SBORDERIZZATO LA BOLLA PER CANCELLARE ANCHE
021960950126     C* SUL DETTAGLIO COLLI IL NUMERO DI FOGLIO VIAGGIO
021970950126     C                   MOVEL     'S'           WSBORD            1
021980940920    3C                   ENDIF
021990940920    2C                   ENDIF
022000940920     C***
022010000627     C* SE SOLO CONTROLLI AGGIORNO LA DBLP CHE RESTITUISCO AL CHIAMANTE
022020940920     C***
022030000627     C     §LPFLG        IFEQ      'C'
022040000627     C                   EXSR      AGDBLP
022050000627     C                   ELSE
022060000627     C***
022070000627     C* REGISTRO BOLLA E STAMPO
022080000627     C***
022090900504     C                   EXSR      REGIS
022100000627     C                   ENDIF
022110000313     C*
022120000313     C* SE PGM RICHIAMATO PASSO INDIETRO IL FLAG DDT, CHE SERVE
022130000313     C* QUANDO SONO RICHIAMATO DA GIACENZE PER POI DECIDERE SE RISTAMPA
022140000313     C*  RE O MENO LA BOLLA
022150000627     C   12
022160000627     CAN 15§LPFLG        IFNE      'C'
022170000627     C                   MOVEL     VIDBAM        §LPBAM
022180000627     C                   ENDIF
022190950127     C* RIEMETTO FORMATO
022200950127     C     WEMFOR        IFEQ      '1'
022210950127     C                   EXSR      ESCIER
022220950127     C     §LPFPR        IFNE      '5'
022230950127     C                   GOTO      FOR02
022240950127     C                   ELSE
022250950127     C                   GOTO      FINE
022260950127     C                   ENDIF
022270950127     C                   ENDIF
022280900504     C*
022290900508     C* PULISCO CAMPI FOR01 E FOR02
022300940214    2C     *IN12         IFEQ      *OFF
022310010307     C     §LPFPR        ANDNE     'O'
022320940819     C                   EXSR      INZ01
022330940819     C                   EXSR      INZ02
022340941011     C                   EXSR      INZ03
022350971210     C                   EXSR      INZ06
022360991203     C                   EXSR      INZ07
022370000911     C                   EXSR      INZ08
022380040908     c* se personalizzato n. orm prima di riemettere la videata di
022390040908     c* bollettazione devo effettuare i controlli per poporre eventuali
022400040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
022410040908     c* porti allo stesso modo di quando dalla prima videata viene
022420040908     c* immesso il numero orm con la pistola (enter automatico)
022430041217     c* Non lo faccio se ORM fittizio in quanto non c'è nulla da proporre
022440041220     c                   if        *in37 = *on
022450041220     c                   if        flgfit <> 'S'
022460050119     c                   eval      wsolo_prp = '1'
022470041217     c                   exsr      ctrd01
022480041220     c                   else
022490041220     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
022500041220     c* (per uniformità: fa così anche per orm reale)
022510041220     c                   z-add     13            h1riga
022520041220     c                   z-add     20            h1colo
022530041220     c                   endif
022540041217     c                   endif
022550930628     C                   GOTO      FOR01
022560940214    2C                   END
022570930628     C*
022580000000     C     FINE          TAG
022590940214     C*
022600930628     C  N12              SETON                                        LR
022610060308     c* Chiudo con LR pgm gestione motivazione variazione ad ogni bolla per
022620060308     c* pulire la videata
022630060308     c                   clear                   fnlv85ds
022640060308     c                   eval      ilv85tla = 'C'
022650060308     c                   movel     fnlv85ds      kpjbu
022660060308     c                   call      'FNLV85R'
022670060308     c                   parm                    kpjba
022680060222     c*
022690130419     c  nlr              return
022700940214    1C                   ENDIF
022710940214     C* CHIUDO FILES
022720941108     C     *INLR         IFEQ      *ON
022730941108     C*
022740941108     C     WCL98         IFEQ      '1'
022750940214     C                   MOVEL     'C'           D98TLA
022760970925     C                   CALL      'TNSD99R'
022770970925     C                   PARM                    DSSD99
022780940214    1C                   ENDIF
022790970722     C**
022800991102     C                   CLEAR                   DSBS02
022810991102     C                   MOVEL     'C'           T02TLA
022820991102     C                   CALL      'TIBS02R'
022830991102     C                   PARM                    KPJBA
022840991102     C                   PARM                    DSBS02
022850991102     C**
022860970722     C                   MOVEL     'C'           I13TLA
022870970722     C                   CALL      'FNLV13R'
022880970722     C                   PARM                    KPJBA
022890970722     C                   PARM                    DSLV13
022900970722     C                   PARM                    DSSI95
022910061109     C**
022920061109     C                   MOVEL     'C'           ISIE3TLA
022930061109     C                   CALL      'TISIE3R'
022940061109     C                   PARM                    TISIE3DS
022950061109     c
022960061109     C                   MOVEL     'C'           XCFIVADS
022970061109     C                   CALL      'XCFIVAR'
022980061109     C                   PARM                    XCFIVAds
022990991130     C**
023000060619    2C     WEU12         IFEQ      'S'
023010060619     C                   MOVEL     'C'           i12TLA
023020060619     C                   CALL      'FIEU12R'
023030991130     C                   PARM                    KPJBA
023040060619     C                   PARM                    fieu12ds
023050991130    3C                   ENDIF
023060011212     C*
023070011212     C                   CLEAR                   DSUL21
023080011212     C                   MOVEL     'C'           I21TLA
023090011212     C                   CALL      'TRUL21R'
023100011212     C                   PARM                    DSUL21
023110011212     C*
023120011212     C                   CLEAR                   DSUL22
023130011212     C                   MOVEL     'C'           I22TLS
023140011212     C                   CALL      'TRUL22R'
023150011212     C                   PARM                    DSUL22
023160011212     C*
023170011212     C                   CLEAR                   DSUL23
023180011212     C                   MOVEL     'C'           I23TLA
023190011212     C                   CALL      'TRUL23R'
023200011212     C                   PARM                    DSUL23
023210941108     C*
023220941108    2C     *IN12         IFEQ      *OFF
023230941108     C     *IN15         OREQ      *ON
023240941108     C*
023250941108    3C     I100          IFEQ      1
023260941108     C                   MOVEL     '*'           DB0GES
023270941108    3C                   ENDIF
023280941108    2C                   ENDIF
023290941108     C*
023300941108     C                   MOVEL     'C'           DB0TLA
023310030611     C                   CALL      WD90PSL
023320030626     C                   PARM                    fnlsb5DS
023330970925     C*
023340970925     C                   CLEAR                   DSLV55
023350970925     C                   MOVEL     'C'           D55TLA
023360970925     C                   CALL      'FNLV55R'
023370970925     C                   PARM                    DSLV55
023380000918     C*
023390000918     C                   CLEAR                   DSLSZ1
023400000918     C                   MOVEL     'C'           IZ1TLA
023410000918     C                   CALL      'FNLSZ1R'
023420010402     C                   PARM                    KPJBA
023430000918     C                   PARM                    DSLSZ1
023440000918     C                   PARM                    DS1B
023450020213     c*
023460020213     C                   CLEAR                   trul27ds
023470020213     C                   MOVEL     'C'           I27TLA
023480020213     C                   CALL      'TRUL27R'
023490020213     C                   PARM                    TRUL27DS
023500020218     c*
023510020218     c                   movel     'C'           tastla
023520020218     C                   CALL      'TNSF20R'
023530020218     C                   PARM                    KPJBA
023540020218     C                   PARM                    DTAS
023550020218     C                   PARM                    DTASV
023560020320     c*
023570020320     c                   clear                   trul33ds
023580020320     c                   movel     'C'           i33tla
023590020320     c                   movel     trul33ds      kpjbu
023600020320     C                   CALL      'TRUL33R'
023610020320     C                   PARM                    KPJBA
023620020531     c*
023630020531     c                   clear                   tisit0ds
023640071010     c                   clear                   tisit0x1ds
023650020531     c                   movel     'C'           it0tla
023660020531     C                   CALL      'TISIT5R'
023670020531     C                   PARM                    tisit0ds
023680071010     C                   PARM                    tisit0x1ds
023690031217
023700091006     c                   Clear                   Fnls28ds
023710091006     c                   Eval      I28Tla = 'C'
023720091006     c                   Call      'FNLS28R'
023730091006     c                   Parm                    kpjba
023740091006     c                   Parm                    Fnls28ds
023750040227
023760040227     c                   Clear                   Fnls26ds
023770040227     c                   Eval      I26Tla = 'C'
023780040227     c                   Call      'FNLS26R'
023790040227     c                   Parm                    Fnls26ds
023800061107     c*
023810061107     c                   Eval      Ideptla = 'C'
023820061107     c                   call      'TRULDEPR'
023830061107     c                   parm                    truldepds
023840061127     c* Richiamo il *pgm d utilità FIDN12R in modalità "solo chiusura"
023850061127     c                   clear                   fidn12ds
023860061127     c                   eval      dn_i12tla = 'C'
023870061127     c                   call      'FIDN12R'
023880061127     c                   parm                    fidn12ds
023890081111
023900081111     C                   MOVEL     'C'           SA2TLA
023910081111     C                   CALL      'FNLSA2R3'
023920081111     C                   PARM                    SA2TLA
023930081111     C                   PARM                    SA2TRC
023940081111     C                   PARM                    SA2DTS
023950081111     C                   PARM                    WWLNA             3 0
023960090626     c*
023970090626     c                   clear                   trulticds
023980090626     c                   eval      itictla='C'
023990090626     c                   call      'TRULTICR'
024000090626     c                   parm                    TRULTICDS
024010090626     c                   parm                    ds1a
024020120615     c*
024030120615     c                   clear                   trulflbds
024040120615     c                   eval      iflbtla='C'
024050120615     c                   call      'TRULFLBR'
024060120615     c                   parm                    TRULFLBDS
024070061107     c*
024080040329      * Chiudo Titas30c
024090040329     c                   If        %Open(Titas30c)
024100040329     c                   Close     Titas30c
024110040329     c                   EndIf
024120941108     C*
024130941108    1C                   ENDIF
024140991008      *----------------------------------------------------------------
024150991008      *--  OPERAZIONI INIZIALI   -------------------------------------*
024160991008      *----------------------------------------------------------------
024170940819     C     *INZSR        BEGSR
024180011114     C* N.B.: QUANDO NON SI VORRÀ PIÙ STAMPARE BLANK+55L+CAP DESTINO:
024190011114     C*       ASTERISCARE    "MOVE *BLANKS   WNO55L"
024200011114     C*       DISASTERISCARE "MOVE '1'       WNO55L"
024210020725     C***                MOVE      *BLANKS       WNO55L            1
024220011126     C                   MOVE      '1'           WNO55L            1
024230030610      * MEMORIZZO STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO
024240950118     C                   MOVEL     KPJBU         PARAM3
024250030610      *
024260030610      * SE RICEVO TRUL90DS TENGO BUONO I PGM DELLA DS, in caso contrario
024270030610      *  quello della KPJBU + FNLSB0R
024280030610      * ....... modifica da togliere dopo aver eliminato TRUL01R
024290030610     C                   IF        %PARMS < 4
024300030611     C                   movel(P)  Wpgmss        WD90PSS
024310030611     C                   movel(P)  'FNLSB0R'     WD90PSL
024320030611     C                   ELSE
024330030611     C                   movel(P)  D90PSS        WD90PSS
024340030611     C                   movel(P)  D90PSL        WD90PSL
024350030610     c                   ENDIF
024360030610      *
024370011107     C     WNO55L        IFEQ      *BLANKS
024380011107     C                   MOVEL     ' 55L'        W55L
024390011107     C                   ELSE
024400011107     C                   CLEAR                   W55L
024410011107     C                   ENDIF
024420040329
024430040329      * Se sono in ambiente buono - GAITRAGRU
024440040329     c                   If        knsif = 'FILTRA201 '
024450040329     c                   Eval      wlib = 'GAITRAGRU '
024460040329      *  Se sono in ambiente di prova - GAITRAGRPS
024470040329     c                   Else
024480040329     c                   Eval      wlib = 'GAITRAGRPS'
024490040329     c                   EndIf
024500940819     C***
024510940819     C* KLIST
024520940819     C***
024530940819     C* ACCESSO   CNACO
024540940819     C     KACO          KLIST
024550940819     C                   KFLD                    CODUT
024560940819     C                   KFLD                    CCC
024570940909     C                   KFLD                    WKSC
024580990630     C     KNUM          KLIST
024590990630     C                   KFLD                    DATAAS            2 0
024600990630     C                   KFLD                    RGS               1 0
024610990630     C                   KFLD                    FIV               3 0
024620990630     C**
024630990630     C                   Z-ADD     2             RGS
024640990630     C**
024650950920     C* ACCESSO   AZCLN
024660950920     C     KCLN          KLIST
024670950920     C                   KFLD                    SIMFEL
024680950920     C                   KFLD                    W0030
024690950920     C                   KFLD                    WAA               4 0
024700950920     C                   KFLD                    WMM               2 0
024710101022     C     KCLNA         KLIST
024720101022     C                   KFLD                    w0030
024730101022     C                   KFLD                    comlna
024740101022     C                   KFLD                    WAA               4 0
024750101022     C                   KFLD                    WMM               2 0
024760940819     C* ACCESSO   TFTAM SENZA PROGRESSIVO
024770940819     C     KTAM2         KLIST
024780940909     C                   KFLD                    WKSC
024790940819     C                   KFLD                    COMCTR            3 0
024800940819     C                   KFLD                    COMPRG            3 0
024810940819     C* ACCESSO   TFTPT SENZA PROGRESSIVO
024820940819     C     KTPT          KLIST
024830940909     C                   KFLD                    WKSC
024840940819     C                   KFLD                    COMCTR            3 0
024850940819     C                   KFLD                    COMPRG            3 0
024860990818     C                   KFLD                    FTC               2
024870940819     C* ACCESSO   TFTAM TARIFFA DI CARTELLO
024880020208     c*
024890940819     C     KCAR2         KLIST
024900940819     C                   KFLD                    TARKSC
024910940819     C                   KFLD                    TARCTR            3 0
024920940819     C                   KFLD                    TARPRG            3 0
024930940819     C* ACCESSO   TABEL
024940940819     C     KTAB2         KLIST
024950940819     C                   KFLD                    CODUT
024960940819     C                   KFLD                    COD               2
024970940819     C                   KFLD                    KEY               8
024980940819     C* ACCESSO   TABEL
024990940819     C     KTAB3         KLIST
025000940819     C                   KFLD                    CODUT
025010940819     C                   KFLD                    COD               2
025020000120     C     KTBE          KLIST
025030000120     C                   KFLD                    KTCOD
025040000120     C                   KFLD                    KTLIN
025050000120     C                   KFLD                    KTSIF
025060000120     C                   KFLD                    KTKE1
025070000120     C                   KFLD                    KTKE2
025080070612     C* ACCESSO   EDTAB
025090070612     C     KEDTAB        KLIST
025100070612     C                   KFLD                    Kedcod
025110070612     C                   KFLD                    kedkey
025120940819     C* ACCESSO   FILE DISCHETTO CLIENTI
025130940819     C     KBLC          KLIST
025140020917     C                   KFLD                    §FGS
025150020917     C                   KFLD                    §LPCCM
025160970407     C                   KFLD                    §LPAAC
025170940819     C                   KFLD                    §LPLNP
025180940819     C                   KFLD                    §LPNRS
025190940819     C                   KFLD                    §LPNSP
025200970107     C     KBLC4         KLIST
025210970407     C                   KFLD                    §LPAAC
025220970107     C                   KFLD                    §LPLNP
025230970107     C                   KFLD                    §LPNRS
025240970107     C                   KFLD                    §LPNSP
025250940819     C* ACCESSO   FILE BOLLE VISTA LOGICA 1
025260940819     C     KBLP3         KLIST
025270940819     C                   KFLD                    §LPAAS
025280940819     C                   KFLD                    §LPLNP
025290940819     C                   KFLD                    §LPNRS
025300940819     C                   KFLD                    §LPNSP
025310051124     C**   KBLP33        KLIST
025320051124     C**                 KFLD                    §LPAAS
025330051124     C**                 KFLD                    §LPLNP
025340051124     C**                 KFLD                    §LPNRS
025350051124     C**                 KFLD                    §LPNSP
025360051124     C**                 KFLD                    bltnsc
025370940926     C     KBLP4         KLIST
025380940926     C                   KFLD                    §LPAAS
025390940926     C                   KFLD                    §LPLNP
025400940926     C                   KFLD                    §LPNRS
025410940926     C                   KFLD                    §LPNSP
025420940926     C                   KFLD                    WTRC
025430041013     C     KBLP4M        KLIST
025440060215     c                   kfld                    ar4aas
025450060215     c                   kfld                    ar4lnp
025460060215     c                   kfld                    ar4nrs
025470060215     c                   kfld                    ar4nsp
025480001212     C* Usata per controllo segnacolli doppi bolle poste
025490120817     C***  KBLP1         KLIST
025500120817     C***                KFLD                    BLTAAS
025510120817     C***                KFLD                    BLTLNP
025520120817     C***                KFLD                    BLTNRS
025530120817     C***                KFLD                    BLTNSP
025540120814     C     Kfiart        KLIST
025550120814     C                   KFLD                    BLTAAS
025560120814     C                   KFLD                    BLTLNP
025570120814     C                   KFLD                    BLTNRS
025580120814     C                   KFLD                    BLTNSP
025590120814     C                   KFLD                    BLTNSC
025600120817     C***  KBLP4P        KLIST
025610120817     C***                KFLD                    BLTAAS
025620120817     C***                KFLD                    BLTLNP
025630120817     C***                KFLD                    BLTNRS
025640120817     C***                KFLD                    BLTNSP
025650120817     C***                KFLD                    WTRC
025660940819     C* KEY PER SEGNACOLLI DOPPI IN FLBLT
025670940819     C     KBLT          KLIST
025680940916     C                   KFLD                    WFLS
025690940819     C                   KFLD                    COMLNA
025700940819     C                   KFLD                    VIDNRS
025710940819     C                   KFLD                    COMSCD
025720120816     C***  KBLT29        KLIST
025730120816     C***                KFLD                    WFLS
025740120816     C***                KFLD                    VIDNRS
025750120816     C***                KFLD                    COMSCD
025760980320     C     KBLT1         KLIST
025770980320     C                   KFLD                    BLPAAS
025780980320     C                   KFLD                    BLPLNP
025790980320     C                   KFLD                    BLPNRS
025800980320     C                   KFLD                    BLPNSP
025810080103     C     KBRV          KLIST
025820960404     C                   KFLD                    KNPG
025830960404     C                   KFLD                    BLTFLS
025840960404     C                   KFLD                    BLTLNA
025850960404     C                   KFLD                    BLTNRS
025860960404     C                   KFLD                    BLTNSC
025870960404     C                   KFLD                    KFLE
025880120817     C     KBRVA         KLIST
025890120817     C                   KFLD                    KNPG
025900120817     C                   KFLD                    ARTFLS
025910120817     C                   KFLD                    ARTLNA
025920120817     C                   KFLD                    ARTNRS
025930120817     C                   KFLD                    ARTNSC
025940120817     C                   KFLD                    KFLE
025950940819     C* ACCESSO   FILE NUMERATORE
025960940819     C     KNUF          KLIST
025970940819     C                   KFLD                    AAS               2 0
025980940819     C                   KFLD                    CNU               3 0
025990940819     C                   KFLD                    COMLIN            3 0
026000940819     C     KNUF2         KLIST
026010940819     C                   KFLD                    AAS               2 0
026020940819     C                   KFLD                    CNU
026030940819     C                   KFLD                    COMLIN
026040940819     C                   KFLD                    LIV2              3 0
026050991117     C     KNUF3         KLIST
026060991117     C                   KFLD                    CNU
026070991118     C                   KFLD                    DATA6             6 0
026080000509     C     KNUFSP        KLIST
026090000509     C                   KFLD                    AAS               2 0
026100000509     C                   KFLD                    CNU               3 0
026110000509     C                   KFLD                    COMLIN            3 0
026120000509     C                   KFLD                    WNUF2             3 0
026130940819     C* PER CONTROLLO NUM DI SPEDIZIONE
026140940819     C     KNSP          KLIST
026150940916     C                   KFLD                    WAAS
026160940819     C                   KFLD                    VIDLNP
026170940819     C                   KFLD                    VIDNRS
026180940819     C                   KFLD                    RECNSP
026190940819     C     KFTT          KLIST
026200940819     C                   KFLD                    W01PDR
026210940819     C                   KFLD                    W01FVL
026220940819     C                   KFLD                    COMDRT
026230940819     C                   KFLD                    W01TSR
026240980318     C     KVAT          KLIST
026250020917     C                   KFLD                    §FGS
026260020917     C                   KFLD                    §LPCCM
026270980318     C                   KFLD                    §LPAAC
026280980318     C                   KFLD                    §LPLNP
026290980318     C                   KFLD                    §LPNRS
026300980318     C                   KFLD                    §LPNSP
026310980318     C                   KFLD                    WTRC
026320031114
026330031114     c     kVat1         Klist
026340031114     C                   Kfld                    §Fgs
026350031114     C                   Kfld                    §LpCcm
026360031114     C                   Kfld                    §LpAac
026370031114     C                   Kfld                    §LpLnp
026380031114     C                   Kfld                    §LpNrs
026390031114     C                   Kfld                    §LpNsp
026400031114
026410980320     C*
026420051102     C     KARS1         KLIST
026430980320     C                   KFLD                    BLTFLS
026440980320     C                   KFLD                    BLTLNA
026450980320     C                   KFLD                    BLTNRS
026460980320     C                   KFLD                    BLTNSC
026470980320     C                   KFLD                    WTRC
026480120817     C     KARS1A        KLIST
026490120817     C                   KFLD                    ARTFLS
026500120817     C                   KFLD                    ARTLNA
026510120817     C                   KFLD                    ARTNRS
026520120817     C                   KFLD                    ARTNSC
026530120817     C                   KFLD                    WTRC
026540051102     C     KARS1P        KLIST
026550050211     C                   KFLD                    BLpFLS
026560050211     C                   KFLD                    BLpLNA
026570050211     C                   KFLD                    BLpNRS
026580050211     C                   KFLD                    BLpNcd
026590050211     C                   KFLD                    WTRC
026600120817     C***  KARSD         KLIST
026610120817     C***                KFLD                    BLTFLS
026620120817     C***                KFLD                    BLTLNA
026630120817     C***                KFLD                    BLTNRS
026640120817     C***                KFLD                    BLTNSC
026650051102     C     KARS1K        KLIST
026660000915     C                   KFLD                    KFLSAN
026670000915     C                   KFLD                    KLNAAN
026680000915     C                   KFLD                    KNRSAN
026690000915     C                   KFLD                    KNSCAN
026700000915     C                   KFLD                    WTRC
026710051102     C     KARS01        KLIST
026720980320     C                   KFLD                    BLPFLS
026730980320     C                   KFLD                    BLPLNA
026740980320     C                   KFLD                    BLPNRS
026750980320     C                   KFLD                    WO2SCD
026760980320     C                   KFLD                    WTRC
026770051102     C     KARS2         KLIST
026780020308     C                   KFLD                    W8CNOT
026790980325     C                   KFLD                    WTRC
026800060215     C     Kar4F         KLIST
026810991217     C                   KFLD                    WTRC
026820991217     C                   KFLD                    W030A
026830060215     C     Kar4B         KLIST
026840060215     C                   KFLD                    ar4AAS
026850060215     C                   KFLD                    ar4LNP
026860060215     C                   KFLD                    ar4NRS
026870060215     C                   KFLD                    ar4NSP
026880060215     C     Kar403        KLIST
026890060215     C                   KFLD                    kar4trc
026900060215     C                   KFLD                    kar4n14
026910010116     C     KSGN          KLIST
026920010116     C                   KFLD                    COMTFP
026930010116     C                   KFLD                    KWHO
026940010116     C     KSGN8         KLIST
026950010116     C                   KFLD                    COMTFP
026960010116     C                   KFLD                    V8CNOT
026970020308     C     KSGN88        KLIST
026980020308     C                   KFLD                    COMTFP
026990020308     C                   KFLD                    W8CNOT
027000010212     C     KORM          KLIST
027010010212     C                   KFLD                    WOPOE
027020010212     C                   KFLD                    WONSR
027030010222     C                   KFLD                    WONOR2
027040010212     C                   KFLD                    WONRV
027050100319     C     KORME         KLIST
027060100319     C                   KFLD                    WOPOE
027070100319     C                   KFLD                    WONSR
027080100319     C                   KFLD                    WONOR2
027090100319     C                   KFLD                    WONRV
027100100319     C                   KFLD                    koretrc
027110010212     C     KDST          KLIST
027120120611     C                   KFLD                    ormnpg
027130120611     C                   KFLD                    ormndc
027140060522     C                   KFLD                    kfgs
027150010214     C     KFVV          KLIST
027160010214     C                   KFLD                    ORMNPG
027170010215     C                   KFLD                    W0050
027180060522     C                   KFLD                    kfgs
027190021203     C     Kfapd         klist
027200021203     C                   kfld                    kpdtip
027210021203     C                   kfld                    kpdpdr
027220021218     c     KFiar5        Klist
027230021218     c                   Kfld                    BlpAas
027240021218     c                   Kfld                    BlpLnp
027250021218     c                   Kfld                    BlpNrs
027260021218     c                   Kfld                    BlpNsp
027270021218     c                   Kfld                    KAr5Trd
027280040601     c     Kbolm         Klist
027290040601     c                   Kfld                    §lpaasm
027300040601     c                   Kfld                    §lplnpm
027310040601     c                   Kfld                    §lpNrsm
027320040601     c                   Kfld                    §lpNspm
027330130305     c     Kbolm5        Klist
027340130305     c                   Kfld                    §lpaasm
027350130305     c                   Kfld                    §lplnpm
027360130305     c                   Kfld                    §lpNrsm
027370130305     c                   Kfld                    §lpNspm
027380130305     c                   Kfld                    KAr5Trd
027390051123     c     Kanm2         Klist
027400120817     c***                Kfld                    bltfls
027410120817     c***                Kfld                    bltlna
027420120817     c***                Kfld                    bltnrs
027430120817     c***                Kfld                    bltnsc
027440120817     c                   Kfld                    artfls
027450120817     c                   Kfld                    artlna
027460120817     c                   Kfld                    artnrs
027470120817     c                   Kfld                    artnsc
027480051124     c     Kanm1         Klist
027490051125     C                   KFLD                    §LPAAS
027500051125     C                   KFLD                    §LPLNP
027510051125     C                   KFLD                    §LPNRS
027520051125     C                   KFLD                    §LPNSP
027530070601     c*
027540070601     c     kfnorf        klist
027550070601     c                   kfld                    ormpoe
027560070601     c                   kfld                    ormnsr
027570070601     c                   kfld                    ormnor
027580070601     c                   kfld                    ormnrv
027590070601     c                   kfld                    ormdfo
027600070601     c                   kfld                    ormofo
027610070601     c                   kfld                    ormfao
027620080221     c**!!!kfipdo        klist
027630080221     c**!!!              kfld                    orffgs
027640080221     c**!!!              kfld                    orfndc
027650080221     c**!!!              kfld                    orfpoe
027660080221     c**!!!              kfld                    orfnsr
027670080221     c**!!!              kfld                    orfnor
027680080221     c**!!!              kfld                    orfnrv
027690070613     c     kdpo          klist
027700070626     c                   kfld                    kdpodep
027710070626     c                   kfld                    kdpoord
027720071221
027730071221     c     Kbrv7         Klist
027740120817     c***                Kfld                    bltfls
027750120817     c***                Kfld                    comlna
027760120817     c***                Kfld                    bltnrs
027770120817     c***                Kfld                    bltnsc
027780120817     c                   Kfld                    artfls
027790120817     c                   Kfld                    comlna
027800120817     c                   Kfld                    artnrs
027810120817     c                   Kfld                    artnsc
027820080313
027830080313     C     KTbe1         KLIST
027840080313     C                   KFLD                    k_tbecod
027850080313     C                   KFLD                    k_tbeke1
027860100323     C     Kfgi          KLIST
027870100323     C                   KFLD                    kksc
027880100323     C                   KFLD                    klnp
027890130304     C     Kblpar8       KLIST
027900130304     C                   KFLD                    ar8AAS
027910130304     C                   KFLD                    ar8LNP
027920130304     C                   KFLD                    ar8NRS
027930130304     C                   KFLD                    ar8NSP
027940130306     C     Kar8§pdf      KLIST
027950130306     C                   KFLD                    §clipdfp
027960130306     C                   KFLD                    §VATPPDFN
027970940819     C***
027980940819     C* DEFINIZIONE CAMPI
027990940819     C***
028000001031     C     *LIKE         DEFINE    BLPTFA        COMTFA
028010000508     C     *LIKE         DEFINE    DSBLD         WSBLD
028020000211     C     *LIKE         DEFINE    DSBLDE        WSBLDE
028030001002     C     *LIKE         DEFINE    DSBLD         WWBLD
028040001002     C     *LIKE         DEFINE    DSBLDE        WWBLDE
028050000211     C     *LIKE         DEFINE    DSBLD0        SAVBLD
028060000211     C     *LIKE         DEFINE    §LDDLA        WDLA
028070000208     C     *LIKE         DEFINE    SGNWHO        KWHO
028080000204     C     *LIKE         DEFINE    OG143         SAV143
028090000201     C     *LIKE         DEFINE    V7CNPR        WNPR
028100041116     C     *LIKE         DEFINE    V7CNPR        WNPRpre
028110051124     c     *LIKE         DEFINE    O14LAD        DESLAD
028120060920     c     *LIKE         DEFINE    O14red        DESred
028130080414     c**   *LIKE         DEFINE    §15cex        DEScaeex
028140080414     c**   *LIKE         DEFINE    §15cdp        DEScadpd
028150080414     c**   *LIKE         DEFINE    §15cfe        DEScafed
028160060613     C**** *LIKE         DEFINE    VIDNRD        COMNRD
028170000120     C     *LIKE         DEFINE    TBECOD        KTCOD
028180000120     C     *LIKE         DEFINE    TBELIN        KTLIN
028190000120     C     *LIKE         DEFINE    TBESIF        KTSIF
028200000120     C     *LIKE         DEFINE    TBEKE1        KTKE1
028210000120     C     *LIKE         DEFINE    TBEKE2        KTKE2
028220000120     C     *LIKE         DEFINE    BLPDSP        WDSP
028230020102     C     *LIKE         DEFINE    §CVFDC        COMFDC
028240011113     C     *LIKE         DEFINE    §CVDEC        COMDEC
028250991028     C     *LIKE         DEFINE    O17FDC        WFDC1
028260991015     C     *LIKE         DEFINE    O17FDC        WFDC2
028270991014     C     *LIKE         DEFINE    VIDPOR        MEMPOR
028280991012     C     *LIKE         DEFINE    VI2VA1        VA2VA1
028290991011     C     *LIKE         DEFINE    AR6DIV        WDIV1
028300991011     C     *LIKE         DEFINE    AR6DIV        WDIV2
028310990701     C     *LIKE         DEFINE    VIDNFT        SAVNFT
028320990701     C     *LIKE         DEFINE    VIDIMV        SAVIMV
028330060208     C     *LIKE         DEFINE    VIDIMV        SAVIMVO
028340990630     C     *LIKE         DEFINE    O95CZC        WCZC
028350980211     C     *LIKE         DEFINE    O95CZO        WCZO
028360980211     C     *LIKE         DEFINE    VIDLNP        BLCLNP
028370971216     C     *LIKE         DEFINE    BLPNCA        STANCA
028380971215     C     *LIKE         DEFINE    V6CAWB        SAVAWB
028390050228     C     *LIKE         DEFINE    V7CNPR        SAVNPR
028400061003     C***  *LIKE         DEFINE    §b4fnp        SAVfnp
028410060620     C     *LIKE         DEFINE    §b4krt        SAVkrt
028420060619     C***  *LIKE         DEFINE    vidrmn        savrmn
028430941104     C*  MI IMPOSTO IL FLAG I/E DELLE TARIFFE DA CARICARE
028440941104     C     *LIKE         DEFINE    TAMFIE        WFIE
028450941107     C* FLAG SALVATO DA MANUTENZIONE BOLLE
028460941117     C     *LIKE         DEFINE    TAMFIE        SAVFIE
028470020122     C     *LIKE         DEFINE    BLPNZD        NZDINI
028480061124     C     *LIKE         DEFINE    BLPNZD        savnzd
028490941107     C* =S CLIENTE CON TARIFFE VALIDE
028500050921     C     *LIKE         DEFINE    olv59tks      WTKS
028510980701     C* CAMPI DELLA PARAM PER RICERCA ALFABETICA
028520940928     C     *LIKE         DEFINE    ACOKCC        PAXCCC
028530940928     C     *LIKE         DEFINE    ACORAG        PAXDMT
028540940928     C     *LIKE         DEFINE    ACOKCC        CCC
028550940928     C* SALVO IL MITTENTE PER IL QUALE HO CARICATO LE TARIFFE: SE MODIF
028560940928     C*  RICARICO LE TARIFFE
028570940928     C     *LIKE         DEFINE    BLPKSC        SAVCCM
028580940928     C* SE MODIFICATO IL CODICE TARIFFA EMETTO I CAMPI PRESI DA TARIFFA
028590940928     C*  IN "RI"
028600940928     C     *LIKE         DEFINE    VIDCTR        SAVCTR
028610950504     C     *LIKE         DEFINE    VIDCTM        SAVCTM
028620941219     C     *LIKE         DEFINE    VIDVCA        VARVCA
028630941219     C     *LIKE         DEFINE    VIDVAS        VARVAS
028640941219     C     *LIKE         DEFINE    VIDVAD        VARVAD
028650970702     C     *LIKE         DEFINE    VIDLOD        VARLOD
028660970704     C     *LIKE         DEFINE    VIDLOM        VARLOM
028670940928     C*
028680940928     C     *LIKE         DEFINE    §15VLT        MITVLT
028690940922     C     *LIKE         DEFINE    §15VLT        DESVLT
028700940928     C     *LIKE         DEFINE    §15EFT        DESEFT
028710000321     C     *LIKE         DEFINE    §15EFD        DESEFD
028720020130     C     *LIKE         DEFINE    §15EFD        DESEFf
028730020131     C     *LIKE         DEFINE    §15ffn        DESffn
028740971215     C     *LIKE         DEFINE    §15COD        DESCOD
028750940922     C     *LIKE         DEFINE    BLDFST        SAVFST
028760950717     C     *LIKE         DEFINE    BLDNCD        WNCD
028770950321     C     *LIKE         DEFINE    BLPCCM        SAVMIT
028780000426     C     *LIKE         DEFINE    VARNCL        SA2NCL
028790000426     C     *LIKE         DEFINE    VARCDP        SA2CDP
028800940819     C     *LIKE         DEFINE    TBLKUT        §KUT
028810940819     C     *LIKE         DEFINE    TBLCOD        §COD
028820940819     C     *LIKE         DEFINE    TBLKEY        §KEY
028830940819     C     *LIKE         DEFINE    VIDINM        VI2INM
028840940819     C     *LIKE         DEFINE    VIDCAM        VI2CAM
028850940819     C     *LIKE         DEFINE    VIDPIM        VI2PIM
028860120817     C     *LIKE         DEFINE    ARTNSC        WNSC
028870940926     C     *LIKE         DEFINE    BLPAAS        WAAS
028880940926     C     *LIKE         DEFINE    BLPFIN        WFIN
028890940916     C     *LIKE         DEFINE    BLPFLS        WFLS
028900060216     C     *LIKE         DEFINE    ar4TRC        WTRC
028910060215     C     *LIKE         DEFINE    ar4TRC        kar4trc
028920060215     C     *LIKE         DEFINE    ar4n14        kar4n14
028930991006     C     *LIKE         DEFINE    AR6SV1        WSV1
028940991027     C     *LIKE         DEFINE    AR6VA1        WVA1
028950991027     C     *LIKE         DEFINE    AR6SV1        WSV2
028960991027     C     *LIKE         DEFINE    AR6VA1        WVA2
028970991027     C     *LIKE         DEFINE    AR6SV1        WSV3
028980991027     C     *LIKE         DEFINE    AR6VA1        WVA3
028990991027     C     *LIKE         DEFINE    AR6SV1        WSVN
029000991027     C     *LIKE         DEFINE    AR6VA1        WVAN
029010941021     C     *LIKE         DEFINE    §CCCEI        WEV1
029020950123     C     *LIKE         DEFINE    VIDRSD        SAVRSD
029030070404     C     *LIKE         DEFINE    VIDind        SAVind
029040070404     C     *LIKE         DEFINE    VIDprd        SAVprd
029050070404     C     *LIKE         DEFINE    VIDlod        SAVlod
029060010302     C     *LIKE         DEFINE    §LDCDP        SAVCDP
029070940930     C* CONTROLLO SE MODIFICATO CAP MITT E DESTIN PER RICONTROLLARE
029080940930     C     *LIKE         DEFINE    BLPCAD        VARCAD
029090940930     C     *LIKE         DEFINE    BLPCAM        VARCAM
029100940930     C     *LIKE         DEFINE    BLPCAM        VARCMO
029110950102     C     *LIKE         DEFINE    BLPQFT        VARQFT
029120940922     C* SALVO DA TARIFFA PER VEDERE COSA MEMORIZZARE SU COLLO
029130940922     C     *LIKE         DEFINE    BLPTSP        COMTSP
029140940922     C* SALVATO IN MANUTENZIONE PER VEDERE SE RISTAMPARE SEGNACOLLO
029150100209     C     *LIKE         DEFINE    BLPTSP        SA2TSP
029160100209     C     *LIKE         DEFINE    BLPTSP        SAVTSP
029170940819     C     *LIKE         DEFINE    BLPCAD        SAVCAD
029180050421     C     *LIKE         DEFINE    vidbva        SAVbva
029190940922     C     *LIKE         DEFINE    BLPRMA        SAVRMA
029200940819     C     *LIKE         DEFINE    BLPFTM        SAVFTM
029210961111     C     *LIKE         DEFINE    BLPFBR        SAVFBR
029220961122     C     *LIKE         DEFINE    BLPCBO        SAVCBO
029230970404     C     *LIKE         DEFINE    VIDBAM        SAVBAM
029240940922     C* CAMPI USATI NELLE ROUTINE DI CONTROLLO, UNICHE PER
029250960319     C*  VIDEATA PERSONALIZZAZIONE E 1 VIDEATA
029260960319     C     *LIKE         DEFINE    VIDGC1        WGC1
029270960319     C     *LIKE         DEFINE    VIDGC2        WGC2
029280960319     C     *LIKE         DEFINE    VIDTSP        WTSP
029290940928     C     *LIKE         DEFINE    VIDNZM        WNAR
029300941103     C     *LIKE         DEFINE    VIDCMO        WCMO
029310941103     C     *LIKE         DEFINE    VIDRMO        WRMO
029320940824     C     *LIKE         DEFINE    VIDLNA        WLNA
029330940824     C     *LIKE         DEFINE    VIDPDR        WPDR
029340940824     C     *LIKE         DEFINE    VIDCBO        WCBO
029350940824     C     *LIKE         DEFINE    VIDLNP        WLNP
029360940825     C     *LIKE         DEFINE    VIDFTM        WFTM
029370940825     C     *LIKE         DEFINE    VIDCCM        WCCM
029380940928     C     *LIKE         DEFINE    VIDCCM        WCCMS
029390940921     C     *LIKE         DEFINE    VIDFLC        WFLC
029400940922     C     *LIKE         DEFINE    COD           WCOD
029410940922     C     *LIKE         DEFINE    VIDVAS        WVLT
029420940928     C     *LIKE         DEFINE    VIDCTM        WCTM
029430940923     C     *LIKE         DEFINE    VIDIMV        COMIMV
029440940921     C     *LIKE         DEFINE    VIDCCM        SAVFLC
029450940928     C     *LIKE         DEFINE    VIDPDR        SAVPDR
029460990915     C     *LIKE         DEFINE    VIDPDR        SAVPD4
029470940819     C     *LIKE         DEFINE    VIDNCL        SAVNCL
029480940819     C     *LIKE         DEFINE    VIDFFD        VARFFD
029490010214     C     *LIKE         DEFINE    VIDFFD        COMFFD
029500011211     C     *LIKE         DEFINE    VIDIAS        VARIAS
029510011211     C     *LIKE         DEFINE    VIDIAS        WARIAS
029520011212     C     *LIKE         DEFINE    VIDCAS        WARCAS
029530011212     C     *LIKE         DEFINE    VIDVMD        WARVMD
029540940819     C     *LIKE         DEFINE    VIDVOL        VARVOL
029550980402     C     *LIKE         DEFINE    VIDVOL        SAVVOL
029560940819     C     *LIKE         DEFINE    VIDVOL        VA2VOL
029570940819     C     *LIKE         DEFINE    VIDPKG        VARPKG
029580980402     C     *LIKE         DEFINE    VIDPKG        SAVPKG
029590020531     C     *LIKE         DEFINE    VIDtc1        VARtc1
029600020531     C     *LIKE         DEFINE    VIDtc2        VARtc2
029610060110     C     *LIKE         DEFINE    VIDrsd        D_VARrsd
029620060110     C     *LIKE         DEFINE    VIDind        D_VARind
029630060110     C     *LIKE         DEFINE    VIDlod        D_VARlod
029640060110     C     *LIKE         DEFINE    VIDprd        D_VARprd
029650060110     C     *LIKE         DEFINE    VIDnzd        D_VARnzd
029660940819     C     *LIKE         DEFINE    VIDZNC        VARZNC
029670940819     C     *LIKE         DEFINE    VIDZNC        SAVZNC
029680940819     C     *LIKE         DEFINE    VIDPRD        VARPRD
029690940819     C     *LIKE         DEFINE    VIDDSP        SAVDSP
029700940819     C     *LIKE         DEFINE    VIDFAP        COMFAP
029710940919     C     *LIKE         DEFINE    VIDFIN        COMFIN
029720940819     C     *LIKE         DEFINE    VIDDRT        SAVDRT
029730940928     C     *LIKE         DEFINE    VIDDCR        WDCR
029740940913     C     *LIKE         DEFINE    VIDHCR        WHCR
029750940913     C     *LIKE         DEFINE    VIDMCR        WMCR
029760940913     C     *LIKE         DEFINE    VIDTCR        WTCR
029770941011     C     *LIKE         DEFINE    VIDLNA        SAVLNA
029780941011     C     *LIKE         DEFINE    BLPLNP        SAVLNP
029790940824     C     *LIKE         DEFINE    BLPLNA        COMLNA
029800940824     C     *LIKE         DEFINE    BLPLNA        CO2LNA
029810940819     C     *LIKE         DEFINE    BLPCTM        COMCTM
029820940819     C     *LIKE         DEFINE    BLPDRT        COMDRT
029830991006     C     *LIKE         DEFINE    AR6DFT        COMDFT
029840060208     C     *LIKE         DEFINE    AR6DFT        dftar6
029850940819     C     *LIKE         DEFINE    FTTPDR        W01PDR
029860940819     C     *LIKE         DEFINE    FTTTSR        W01TSR
029870940819     C     *LIKE         DEFINE    FTTFVL        W01FVL
029880941005     C* CAMPI DI CONFRONTO PER RICARICARE IL CODICE TARIFFA MITTENTE
029890941005     C     *LIKE         DEFINE    VIDTSP        VARTSP
029900960404     C     *LIKE         DEFINE    BRVFLE        KFLE
029910960404     C     *LIKE         DEFINE    BRVNPG        KNPG
029920960805     C* CAMPI che non devono essere modificati
029930960805     C     *LIKE         DEFINE    VIDNCD        WNSNCD
029940960805     C     *LIKE         DEFINE    VIDNCA        WNSNCA
029950960927     C*
029960980318     C     *LIKE         DEFINE    BLPCAD        WCAD
029970980320     C     *LIKE         DEFINE    BLPCAD        WRKCAD
029980980320     C     *LIKE         DEFINE    BLPNCA        SAVNCA
029990980320     C     *LIKE         DEFINE    BLPNCD        SAVNCD
030000980403     C     *LIKE         DEFINE    BLPNCD        SV1NCD
030010000830     C     *LIKE         DEFINE    V8CNBR        WNBR
030020000908     C     *LIKE         DEFINE    IZ1CH1        CHIDAL
030030000908     C     *LIKE         DEFINE    IZ1CH2        CHIAL
030040000911     C     *LIKE         DEFINE    V8CNBR        NR8
030050000911     C     *LIKE         DEFINE    V8ZMSG        W08MSG
030060000918     C     *LIKE         DEFINE    NR8           SAVNR8
030070001205     C     *LIKE         DEFINE    BLPTC1        SAVTC1
030080001205     C     *LIKE         DEFINE    BLPTC2        SAVTC2
030090001205     C     *LIKE         DEFINE    BLPTC1        WTCP
030100001205     C     *LIKE         DEFINE    BLPTC1        WSVTCP
030110010215     C* CAMPI PER O.R.M.
030120010215     C     *LIKE         DEFINE    VIDPDR        PREPDR
030130010215     C     *LIKE         DEFINE    VIDPDR        WDPDR
030140010215     C     *LIKE         DEFINE    VIDDRT        PREDRT
030150010215     C     *LIKE         DEFINE    VIDFPP        PREFPP
030160010215     C     *LIKE         DEFINE    ORMKSC        PRECCM
030170010215     C     *LIKE         DEFINE    VIDCTR        PRECTR
030180010215     C     *LIKE         DEFINE    VIDFFD        PREFFD
030190010305     C     *LIKE         DEFINE    V1CNCL        PRENCL
030200010305     C     *LIKE         DEFINE    VIDPKG        PREPKG
030210010215     C     *LIKE         DEFINE    VIDORM        W01ORM
030220010215     C     *LIKE         DEFINE    V0CLNP        WOLNP
030230010215     C     *LIKE         DEFINE    ORMKSC        WOCCM
030240010219     C     *LIKE         DEFINE    WLNP          WLNPO
030250010220     C     *LIKE         DEFINE    ORMFAO        PREFAO
030260010313     C     *LIKE         DEFINE    BLDNCD        WNCOL
030270010313     C     *LIKE         DEFINE    BLDNCD        WNCOA
030280011108     C*
030290011212     C     *LIKE         DEFINE    §CVDEC        DECCN
030300011212     C     *LIKE         DEFINE    O21FCA        FCASAV
030310011212     C     *LIKE         DEFINE    §GEIMF        IMFGEI
030320011205     C     *LIKE         DEFINE    §ORMFD        SORMFD
030330011212     C     *LIKE         DEFINE    IEDNUM        WNUMED
030340020211     C     *LIKE         DEFINE    tamksc        tarksc
030350020215     C     *LIKE         DEFINE    §ogntw        savntw
030360050114     C     *LIKE         DEFINE    §lpxco        wxco
030370940819     C***
030380940819     C* CAMPI CHE INIZIALIZZO SOLO ALL'ENTRATA DEL PROGRAMMA E BASTA
030390940819     C***
030400940819     C                   CLEAR                   VIDSOP
030410940819     C                   CLEAR                   VIDDRT
030420000104     C                   CLEAR                   WBDSP
030430990603     C* PER TIPO CHIAMATA PREPAGATO, NON IMPOSTO IL PADORNCINO
030440010301     C* NON LO IMPOSTO NEMMENO PER CHIAMATA DA CONFERMA ORM PREPAGATI
030450010301     C* DI ALTRO P.O.
030460990603     C     PARTCH        IFNE      'P'
030470010301     C     §LPFPR        ANDNE     'O'
030480941021     C                   MOVEL     '?   '        VIDPDR
030490990628     C                   MOVEL     'P'           VIDFPP
030500990603     C                   ENDIF
030510940819     C                   CLEAR                   VIDNRT
030520940819     C                   CLEAR                   VIDLNP
030530961016     C                   CLEAR                   PAXFLR
030540010212     C                   CLEAR                   VIDPOE
030550010212     C                   CLEAR                   VIDNOR
030560010212     C                   CLEAR                   VIDNRV
030570010212     C                   CLEAR                   W01ORM
030580941107     C**
030590930628     C                   Z-ADD     1             CODUT
030600930628     C                   CALL      'X§PARUT'
030610930628     C                   PARM                    UT§DSE
030620940819     C                   MOVEL     RAGUT         VIDDSA
030630930628     C                   MOVEL     REC80         CNCR80
030640930628     C*--- RICERCA CAPOCONTI
030650930628     C                   DO        50            X                 2 0
030660930628     C                   MOVE      TCU(X)        TCUDS
030670930628     C     F56           CABNE     'CG'          END1
030680930628     C     F4            COMP      '1'                                    21
030690930628     C     F4            COMP      '2'                                    22
030700930628     C     F4            COMP      '3'                                    23
030710930628     C     F4            COMP      '6'                                    27
030720930628     C** 1 CLIENTI   21
030730930628     C** 2 FORNITORI 22
030740930628     C** 3 AGENTI    23
030750930628     C     F3            COMP      '0'                                242425
030760930628     C     F3            COMP      'I'                                    26
030770930628     C** 0 ITALIA   25
030780930628     C** 1 ESTERO   24
030790930628     ** I CAPO CONTO IVA
030800930628     C   21
030810930628     CAN 24              Z-ADD     KCU(X)        KCE               4 0
030820930628     C   21
030830930628     CAN 25              Z-ADD     KCU(X)        KCI               4 0
030840930628     C   22
030850930628     CAN 24              Z-ADD     KCU(X)        KFE               4 0
030860930628     C   22
030870930628     CAN 25              Z-ADD     KCU(X)        KFI               4 0
030880930628     C   23
030890930628     CAN 24              Z-ADD     KCU(X)        KAE               4 0
030900930628     C   23
030910930628     CAN 25              Z-ADD     KCU(X)        KAI               4 0
030920930628     C   26              Z-ADD     KCU(X)        KIVA              4 0
030930930628     C   27              Z-ADD     KCU(X)        KBNA              4 0
030940930628     C     END1          TAG
030950930628     C                   END
030960940614     C                   SETOFF                                       212223
030970940614     C                   SETOFF                                       242526
030980940614     C                   SETOFF                                       27
030990991214     C                   CLEAR                   DSBLP0
031000950920     C***
031010950920     C* CARICO DATI VARIABILI PARTENZE
031020950920     C***
031030950920     C                   MOVEL     '3I'          COD
031040950920     C                   MOVEL     '1       '    KEY
031050950920     C                   EXSR      CTABEL
031060950920     C  N30              MOVEL     TBLUNI        DS3I
031070950920     C   30              CLEAR                   DS3I
031080991213     C***
031090991213     C* CARICO TABELLA DPD
031100991213     C***
031110991213     C                   MOVEL     '3I'          COD
031120991213     C                   MOVEL(P)  'DPD'         KEY
031130991213     C*
031140991213     C                   EXSR      CTABEL
031150991213     C  N30              MOVEL     TBLUNI        DS3IDP
031160991213     C   30              CLEAR                   DS3IDP
031170000509     C***
031180000509     C* CARICO TABELLA POSTE
031190000509     C***
031200000509     C                   MOVEL     '3I'          COD
031210000509     C                   MOVEL(P)  'POSTE'       KEY
031220000509     C*
031230000509     C                   EXSR      CTABEL
031240000509     C  N30              MOVEL     TBLUNI        DS3IPT
031250000509     C   30              CLEAR                   DS3IPT
031260971211     C***
031270971211     C* CARICO CODICI CLIENTI SDI PER I QUALI INSERISCO OBBLIGATORIAM
031280971211     C*  NUMERO AWB CON CONTROLLO CHECK DIGIT
031290971211     C***
031300971211     C                   MOVEL     '3I'          COD
031310971211     C                   MOVEL     'E       '    KEY
031320971211     C                   EXSR      CTABEL
031330971211     C  N30              MOVEA     TBLUNI        KSS
031340971212     C* 2 CIFRE INIZIALI FISSE PER NUMERO AWB
031350971212     C  N30              MOVE      TBLUNI        §3IFAW            2 0
031360971211     C   30              CLEAR                   KSS
031370971212     C   30              CLEAR                   §3IFAW
031380950920     C**
031390930401     C* CODICE PER ASSICURAZIONE PER CONTO
031400950920     C**
031410990818     C                   MOVEL     'C '          FTC
031420041217     c**
031430041217      * Aggancio tabella "VPO" per reperimento giorni per calcolo
031440041217      * max data consegna richiesta
031450041217     C                   CLEAR                   dsbs02
031460041217     c                   clear                   dvpo
031470041217     C                   MOVEL     'C'           T02MOD
031480041217     C                   MOVEL     KNSIF         T02SIF
031490041217     C                   MOVEL     'VPO'         T02COD
031500041217     c                   movel(P)  'VPO'         t02ke1
031510041217     C                   CALL      'TIBS02R'
031520041217     C                   PARM                    KPJBA
031530041217     C                   PARM                    dsbs02
031540041217    2C                   IF        T02ERR = *BLANKS
031550041217     C                   MOVEL     T02uni        dvpo
031560041217    2C                   ENDIF
031570121017      * Aggancio tabella "VPODECO"
031580060207     C                   CLEAR                   dsbs02
031590060207     c                   clear                   dvpodeco
031600060207     C                   MOVEL     'C'           T02MOD
031610060207     C                   MOVEL     KNSIF         T02SIF
031620060207     C                   MOVEL     'VPO'         T02COD
031630060207     c                   movel(P)  'DECO'        t02ke1
031640060207     C                   CALL      'TIBS02R'
031650060207     C                   PARM                    KPJBA
031660060207     C                   PARM                    dsbs02
031670060207    2C                   IF        T02ERR = *BLANKS
031680060207     C                   MOVEL     T02uni        dvpodeco
031690060207    2C                   ENDIF
031700121017      * Aggancio tabella "DGD"
031710121017     C                   CLEAR                   dsbs02
031720121017     c                   clear                   dvpodeco
031730121017     C                   MOVEL     'C'           T02MOD
031740121017     C                   MOVEL     KNSIF         T02SIF
031750121017     C                   MOVEL     'DGD'         T02COD
031760121017     c                   movel(P)  '1'           t02ke1
031770121017     C                   CALL      'TIBS02R'
031780121017     C                   PARM                    KPJBA
031790121017     C                   PARM                    dsbs02
031800121017    2C                   IF        T02ERR = *BLANKS
031810121017     C                   MOVEL     T02uni        ddgd
031820121017    2C                   ENDIF
031830111130     c
031840101022     C***
031850101022     C* CARICO TABELLA SIMBOLI CALENDARIO FESTIVI
031860101022     C***
031870101022     C                   MOVEL     '1Y'          COD
031880101022     C                   Z-ADD     1             C
031890101022     C     KTAB3         SETLL     TABEL
031900101022     C                   EXSR      RTABEL
031910101022     C*
031920101022     C     *IN30         DOWEQ     '0'
031930101022     C     TBLFLG        IFEQ      ' '
031940101022     C                   MOVEL     TBLUNI        DS1Y
031950101022     C     §1Yfec        IFEQ      'S'
031960101022     C                   MOVEL     TBLKEY        s1Y(C)
031970101022     C                   ADD       1             C
031980101022     C                   ENDIF
031990101022     C                   ENDIF
032000101022     C*
032010101022     C                   EXSR      RTABEL
032020101022     C                   ENDDO
032030930401     C*
032040950920     C* DATA BOLLETTAZIONE:  TRA UDATE E DATA GIORNO + §3IGGS
032050950920     C*  SOLO PER LE SPEDIZ.DI RECUPERO E' TRA DATA G. - 3  E  + §3IGGS
032060940920     C                   TIME                    W0140            14 0
032070940920     C* UDATE IN GGMMAAAA
032080940920     C                   MOVE      W0140         WDTGIO            8 0
032090990630     C                   MOVE      WDTGIO        DATAAS
032100940819     C*
032110940920     C* UDATE IN AAAAMMGG
032120940920     C                   Z-ADD     WDTGIO        G02DAT
032130910208     C                   MOVEL     *BLANK        G02ERR
032140940819     C                   CALL      'XSRDA8'
032150910208     C                   PARM                    WLBDAT
032160940819     C                   MOVEL     G02INV        DATEU             8 0
032170030409
032180030415      * Calcolo oggi + 5 gg.
032190051215     c****               Move      Dateu         Dataiso
032200051215     c****               Adddur    §vpodcg:*d    Dataiso
032210051215     c****               Move      Dataiso       woggi5
032220051215     c*
032230051215     c                   Move      Dateu         Dataiso
032240051215     c                   Adddur    §vpodcgm1:*d  Dataiso
032250051215     c                   Move      Dataiso       woggidcgm1
032260051215     c*
032270051215     c                   Move      Dateu         Dataiso
032280051215     c                   Adddur    §vpodcgm2:*d  Dataiso
032290051215     c                   Move      Dataiso       woggidcgm2
032300030416
032310051214      **Calcolo oggi + 1 mm.
032320051214     c**                 Move      Dateu         Dataiso
032330051214     c**                 Adddur    1:*m          Dataiso
032340051214     c**                 Move      Dataiso       woggi1m
032350030409
032360950921     C* SE NON FOSSE PERMESSO BOLLETTARE IN SOSPENSIONE
032370950921     C*  SI PUO' BOLLETTARE SOLO FINO A OGGI
032380950921     C                   Z-ADD     G02INV        DATAPA            8 0
032390950921     C                   MOVEL     G02DAT        DATAPG            8
032400950919     C* SOTTRAGGO  3
032410950919     C     G02TGI        SUB       3             GIOTGI
032420950919     C*
032430950919     C                   CALL      'XSRGI8'
032440950919     C                   PARM                    WGIDAT
032450950919     C*
032460950919     C                   Z-ADD     GIOINV        DATAM             8 0
032470080109     C* SOTTRAGGO  giorni per ottenere data minima per data ritiro
032480080109     c                   clear                   TRUL52ds
032490080109     c                   eval      d52gio=§3iggb
032500080109     c                   eval      d52sgn='-'
032510080109     c                   z-add     dateu         D52din
032520080109     c                   call      'TRUL52R'
032530080109     c                   parm                    TRUL52ds
032540080109     C*
032550080109     C                   Z-ADD     d52dfi        DATAmin           8 0
032560080603     c* sottraggo 40 gg. per otternere data minima per data ritiro per
032570080603     c* prepagati
032580080603     c                   move      dateu         dataiso
032590080603     c                   subdur    40:*d         dataiso
032600080603     c                   move      dataiso       datam40
032610080603     c
032620061220     c                   z-add     g02tgi        salvatgi
032630991214     C*
032640991214     C* SOTTRAGGO  I GIORNI PER LA DATA CONTROLLO OPPIO PARCEL DPD
032650991214     C     G02TGI        SUB       §3IGGU        GIOTGI
032660991214     C*
032670991214     C                   CALL      'XSRGI8'
032680991214     C                   PARM                    WGIDAT
032690991214     C*
032700991214     C                   Z-ADD     GIOINV        DPDDSP            8 0
032710130305     c* sottraggo i giorni per controllo pdf cliente doppio
032720130305     c                   move      dateu         dataiso
032730130305     c                   subdur    §vpogpdf:*d   dataiso
032740130305     c                   move      dataiso       datapdf
032750950919     C*
032760950919     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
032770990602     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
032780990602     C* PER I PREPAGATI
032790950920     C                   Z-ADD     1             X
032800950920    1C     X             DOWLE     §3IGGS
032810990602     C     PARTCH        ANDNE     'P'
032820010301     C     §LPFPR        ANDNE     'O'
032830990602    1C     X             ORLE      §3IGGP
032840990602     C     PARTCH        ANDEQ     'P'
032850010301    1C     X             ORLE      §3IGGP
032860010301     C     §LPFPR        ANDEQ     'O'
032870950920     C*
032880950921     C                   MOVEL     'F'           WFEST             1
032890950920     C*
032900950920    2C     WFEST         DOWNE     ' '
032910950919     C     G02TGI        ADD       1             GIOTGI
032920950919     C                   ADD       1             G02TGI
032930940819     C                   CALL      'XSRGI8'
032940910208     C                   PARM                    WGIDAT
032950910221     C*
032960950920     C                   Z-ADD     GIOINV        DATAPA            8 0
032970950920     C                   MOVEL     GIODAT        DATAPG            8
032980950920     C*
032990950920     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
033000950921     C                   Z-ADD     GIOINV        WDATA
033010950920     C                   CLEAR                   W0030
033020120302     C* CHAIN SUL CALENDARIO BRT
033030950920     C     KCLN          CHAIN     AZCLN01L                           30
033040950920     C   30              CLEAR                   CLNPOM
033050950921     C                   MOVEA     CLNPOM        K31
033060950920     C                   MOVEL     K31(WGG)      WFEST
033070101022     c* Se non è festivo pulisco il campo WFEST
033080101022     c     wfest         lookup    S1Y                                    30
033090101022     c                   if        not *in30
033100101022     c                   clear                   wfest
033110101022     c                   endif
033120101022     c
033130950920    2C                   ENDDO
033140950920     C*
033150950920     C                   ADD       1             X
033160990602    1C                   ENDDO
033170061220     c
033180061220     c* trovo primo giorno lavorativo minore di oggi per bollettare in
033190061220     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
033200061220     C                   TIME                    orapgm            6 0
033210061221    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
033220061220     C                   MOVEL     'F'           WFEST             1
033230061220     c                   z-add     salvatgi      giotgi
033240061220     C*
033250061220    1C     WFEST         DOWNE     ' '
033260061221     C     salvatgi      sub       1             GIOTGI
033270061221     C                   sub       1             salvatgi
033280061220     C                   CALL      'XSRGI8'
033290061220     C                   PARM                    WGIDAT
033300061220     C*
033310061220     C                   Z-ADD     GIOINV        DATAmeno1         8 0
033320061221     C                   MOVEL     GIODAT        DATgmeno1         8 0
033330061220     C*
033340061220     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
033350061220     C                   Z-ADD     GIOINV        WDATA
033360061220     C                   CLEAR                   W0030
033370120302     C* CHAIN SUL CALENDARIO BRT
033380061220     C     KCLN          CHAIN     AZCLN01L                           30
033390061220     C   30              CLEAR                   CLNPOM
033400061220     C                   MOVEA     CLNPOM        K31
033410061220     C                   MOVEL     K31(WGG)      WFEST
033420101022     c* Se non è festivo pulisco il campo WFEST
033430101022     c     wfest         lookup    S1Y                                    30
033440101022     c                   if        not *in30
033450101022     c                   clear                   wfest
033460101022    2C                   ENDif
033470101022     c
033480061220    1C                   ENDDO
033490061220   x0c                   else
033500061220     C*
033510061221     C                   Z-ADD     dateu         DATAmeno1
033520061221     C                   MOVEL     wdtgio        DATgmeno1
033530061220    0c                   endif
033540941109     C***
033550941109     C* CARICO CAMPI FISSI PER TASSAZIONE/BOLLETTAZIONE
033560941109     C***
033570941109     C                   MOVEL     'QT'          COD
033580941109     C                   MOVEL     '1       '    KEY
033590941109     C                   EXSR      CTABEL
033600941109     C  N30              MOVEL     TBLUNI        DSQT1
033610941109     C   30              CLEAR                   DSQT1
033620930601     C*
033630920427     C* NUMERO PER FORZARE GLI ERRORI: 1 PER IMM E MANUT.BOLLE
033640920427     C*                                2 PER DISK CLI
033650920427     C                   Z-ADD     1             NUMFOR            1 0
033660940923     C***
033670940923     C* DTU,10 LA PORTO A 8 PER I CONTROLLO
033680940923     C***
033690940923     C                   CLEAR                   WLBDAT
033700940923     C                   Z-ADD     DTU(10)       G02INV
033710940923     C                   MOVEL     '3'           G02ERR
033720940923     C                   CALL      'XSRDA8'
033730940923     C                   PARM                    WLBDAT
033740940923     C                   MOVEL     G02INV        WDTU10            8 0
033750990830     C* ADDIZIONO  3
033760990830     C     G02TGI        ADD       1             GIOTGI
033770990830     C*
033780990830     C                   CALL      'XSRGI8'
033790990830     C                   PARM                    WGIDAT
033800990830     C*
033810990830     C                   Z-ADD     GIODAT        WDTUPI            8 0
033820000113     C                   MOVE      GIODAT        WAAUPI            4 0
033830990830     C*
033840941107     C***
033850960926     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
033860941107     C***
033870941107     C                   CLEAR                   DSUL06
033880941107     C                   MOVE      '£1'          D06COD
033890941107     C                   MOVEL     SIMFEL        D06KEY
033900961003     C                   MOVEL     'L'           D06TLA
033910941107     C                   MOVEL     DSUL06        KPJBU
033920941107     C*
033930941107     C                   CALL      'TRUL06R'
033940941107     C                   PARM                    KPJBA
033950941107     C                   MOVEL     KPJBU         DSUL06
033960941107     C                   MOVEA     LIN           L1
033970070807     C***
033980070807     C* CARICO £6
033990070807     C***
034000070807     C                   CLEAR                   DSUL06
034010070807     C                   MOVE      '£6'          D06COD
034020070807     C                   movel     SImpou        D06KEY
034030070807     C                   MOVEL     'L'           D06TLA
034040070807     C                   MOVEL     DSUL06        KPJBU
034050070807     C*
034060070807     C                   CALL      'TRUL06R'
034070070807     C                   PARM                    KPJBA
034080070807     C                   MOVEL     KPJBU         DSUL06
034090070807     C                   MOVEA     LIN           L6
034100941107     C***
034110941107     C* CARICO TABELLA 5E : TIPI SERVIZIO
034120941107     C***
034130941107     C                   MOVEL     '5E'          COD
034140941107     C                   Z-ADD     1             C
034150941107     C     KTAB3         SETLL     TABEL
034160941107     C                   EXSR      RTABEL
034170941107     C*
034180941107     C     *IN30         DOWEQ     '0'
034190941107     C     TBLFLG        IFEQ      ' '
034200941107     C                   MOVEL     TBLKEY        TSP(C)
034210941108     C                   MOVEL     TBLUNI        DS5E
034220941107     C                   MOVEL     §5EDES        DTS(C)
034230941107     C                   MOVEL     §5EFUB        UTS(C)
034240941115     C                   MOVEL     §5EFST        STS(C)
034250000509     C                   MOVEL     §5EUSO        USO(C)
034260090604     c                   eval      dts08(c) = §5ed08
034270090609     c                   eval      dts03(c) = §5ed03
034280090827     c                   eval      tsTTC(c) = §5ettc
034290941107     C                   ADD       1             C
034300941107     C                   ENDIF
034310941107     C*
034320941107     C                   EXSR      RTABEL
034330941107     C                   ENDDO
034340960209     C***
034350960209     C* CARICO TABELLA TIPI BOLLA CHE PREVEDONO L'ASSICURAZIONE
034360960209     C***
034370960209     C                   MOVEL     'TB'          COD
034380960209     C                   Z-ADD     1             C
034390960209     C     KTAB3         SETLL     TABEL
034400960209     C                   EXSR      RTABEL
034410960209     C*
034420960209     C     *IN30         DOWEQ     '0'
034430960209     C     TBLFLG        IFEQ      ' '
034440960209     C                   MOVEL     TBLUNI        DSTB
034450960209     C     §TBFAS        IFEQ      '1'
034460960209     C                   MOVEL     TBLKEY        TBL(C)
034470960209     C                   ADD       1             C
034480960209     C                   ENDIF
034490960209     C                   ENDIF
034500960209     C*
034510960209     C                   EXSR      RTABEL
034520960209     C                   ENDDO
034530970115     C***
034540970115     C* CARICO TABELLA 3F : DICITURE NON AMMESSE NELLA NATURA MERCE
034550970115     C***
034560970115     C                   MOVEL     '3F'          COD
034570970115     C                   Z-ADD     1             C
034580970115     C     KTAB3         SETLL     TABEL
034590970115     C                   EXSR      RTABEL
034600970115     C*
034610970115     C     *IN30         DOWEQ     *OFF
034620970115     C     TBLFLG        IFEQ      ' '
034630970115     C                   MOVEL     TBLKEY        W003A
034640970115     C                   MOVEL     W003A         TBO(C)
034650970115     C                   MOVE      W003A         LDC(C)
034660970115     C                   ADD       1             C
034670970115     C                   ENDIF
034680970115     C*
034690970115     C                   EXSR      RTABEL
034700970115     C                   ENDDO
034710991007     c***
034720991007     c* CARICO TABELLA CODICI VARIE
034730991007     c***
034740991007     C                   MOVEL     '$2'          COD
034750991007     C                   MOVEL     *BLANKS       KEY
034760991007     C                   MOVEL     '1'           KEY
034770991007     C     KTAB2         CHAIN     TABEL                              30
034780991007     C     *IN30         IFEQ      *OFF
034790991007     C                   MOVEL     TBLUNI        DS$2
034800991007     C                   ELSE
034810991007     C                   CLEAR                   DS$2
034820991007     C                   ENDIF
034830991008      *
034840991102      * AGGANCIO TABELLA GED PER DIVISA DELLA MONETA DI CONTO
034850991102     C                   CLEAR                   DSBS02
034860000124     C                   MOVEL     'C'           T02MOD
034870991102     C                   MOVEL     KNSIF         T02SIF
034880991102     C                   MOVEL     'GED'         T02COD
034890991102     C                   MOVEL     '1'           T02KE1
034900991102      *
034910991102     C                   CALL      'TIBS02R'
034920991102     C                   PARM                    KPJBA
034930991102     C                   PARM                    DSBS02
034940991102      *
034950991102     C     T02ERR        IFEQ      *BLANKS
034960991102     C                   MOVEL     T02UNI        DGED
034970991008     C                   ELSE
034980991008     C                   CLEAR                   DGED
034990991008     C                   ENDIF
035000011108     c*
035010011108      * Tabella CV della moneta di conto
035020011212     C                   CLEAR                   DSCV
035030011212     C                   CLEAR                   DECCN
035040020102     C                   CLEAR                   COMFDC
035050011212     C                   MOVEL     'CV'          COD
035060011212     C                   MOVEL(P)  §GEDCN        KEY
035070011212     C                   EXSR      CTABEL
035080011212     C     *IN30         IFEQ      *OFF
035090011212     C                   MOVEL     TBLUNI        DSCV
035100011212     C                   MOVEL     §CVDEC        DECCN
035110020102     C                   MOVEL     §CVFDC        COMFDC
035120011212     C                   ENDIF
035130011108     C*
035140011212      * AGGANCIO TABELLA GEI PER LIMITE FATTURABILE
035150011212     C                   CLEAR                   DSBS02
035160011212     C                   MOVEL     'C'           T02MOD
035170011212     C                   MOVEL     KNSIF         T02SIF
035180011212     C                   MOVEL     'GEI'         T02COD
035190011212     C                   MOVEL     §GEDCN        T02KE1
035200011108      *
035210011212     C                   CALL      'TIBS02R'
035220011212     C                   PARM                    KPJBA
035230011212     C                   PARM                    DSBS02
035240011108      *
035250011212     C     T02ERR        IFEQ      *BLANKS
035260011212     C                   MOVEL     T02UNI        DGEI
035270011212     C                   ELSE
035280011212     C                   CLEAR                   DGEI
035290011212     C                   ENDIF
035300011212     C                   Z-ADD     §GEIMF        IMFGEI
035310000124      *
035320000124      * AGGANCIO TABELLA "CHI" PER TEL E FAX PER EXPORT DPD
035330040525     C***                CLEAR                   DSBS02
035340040525     C***                MOVEL     'C'           T02MOD
035350040525     C***                MOVEL     KNSIF         T02SIF
035360040525     C***                MOVEL     'CHI'         T02COD
035370040525     C***                MOVEL     'TELFAX'      T02KE1
035380000124      *
035390040525     C***                CALL      'TIBS02R'
035400040525     C***                PARM                    KPJBA
035410040525     C***                PARM                    DSBS02
035420000124      *
035430040525     C***  T02ERR        IFEQ      *BLANKS
035440040525     C***                MOVEL     T02UNI        TELFAX
035450040525     C***                ELSE
035460040525     C***                MOVEL     *ALL'?'       TELFAX
035470040525     C***                ENDIF
035480021120
035490021120      * Aggancio tabella default tariffe fedex
035500021120     c                   Clear                   Dsbs02
035510021120     c                   Movel     'C'           T02Mod
035520021120     c                   Movel     KNSIF         T02Sif
035530021120     c                   Movel     'DFE'         T02Cod
035540021120     c                   Movel     'FED'         T02Ke1
035550021120     c                   Call      'TIBS02R'
035560021120     c                   Parm                    Kpjba
035570021120     c                   Parm                    Dsbs02
035580021120     c                   If        T02Err = *Blanks
035590021120     c                   Movel     T02Uni        DDfe
035600021120     c                   Else
035610021120     c                   Clear                   DDfe
035620021120     c                   EndIf
035630040701      * Aggancio tabella "VPO" per reperimento data ultima fase poste
035640040701     C                   CLEAR                   dsbs02
035650040701     c                   clear                   dvpoppt
035660040701     C                   MOVEL     'C'           T02MOD
035670040701     C                   MOVEL     KNSIF         T02SIF
035680040701     C                   MOVEL     'VPO'         T02COD
035690040701     c                   movel(P)  'PPT'         t02ke1
035700040701     C                   CALL      'TIBS02R'
035710040701     C                   PARM                    KPJBA
035720040701     C                   PARM                    dsbs02
035730040701    2C                   IF        T02ERR = *BLANKS
035740040701     C                   MOVEL     T02uni        dvpoppt
035750040701    2C                   ENDIF
035760081111      * Recupero le date delle statistiche
035770081111     c                   Clear                   dsbs02
035780081111     c                   Clear                   dSdf
035790081111     c                   Eval      T02Mod = 'C'
035800081111     c                   Eval      T02Sif = Knsif
035810081111     c                   Eval      T02Cod = 'SDF'
035820081111     c                   Movel(p)  Simfel        T02Ke1
035830081111     c                   Call      'TIBS02R'
035840081111     c                   Parm                    Kpjba
035850081111     c                   Parm                    dsbs02
035860081111     c                   If        T02Err = *Blanks
035870081111     c                   Movel     T02Uni        dSdf
035880081111     c                   EndIf
035890021120
035900000202     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
035910000202     C                   Z-ADD     SIMFEL        W0030
035920000202     C     W0030         CHAIN     AZORG01L      UNIORG               30
035930000202     C                   MOVEL     ORGFEL        WASFEL            3 0
035940000204     C                   MOVEL     ORGDF0        OG150
035950000204     C                   MOVEL     §OGDKC        WASDKC            1
035960001017     C                   MOVEL     §OGPES        WVDLMN            6
035970040329     c                   Eval      Og143 = Orgde3
035980040329     c                   Eval      LnpOgAs = §OgAs
035990991008     C*
036000930628     C***
036010930628     C* VEDO SE SONO SIMFEL O REMOTO
036020930628     C***
036030930628     C                   MOVEL     SIMFEL        CDU               3 0
036040930628     C*
036050020513     c     simtpp        ifeq      '2'
036060020513     c     simtpp        oreq      *blanks
036070020513     c                   movel     simpou        cdu
036080930628     C                   END
036090941115     C**
036100941115     C* VEDO IL RICHIAMO
036110941115     C**
036120941115    1C     §LPFPR        IFNE      'C'
036130941115     C     §LPFPR        ANDNE     'G'
036140941115     C     §LPFPR        ANDNE     'I'
036150941115     C*
036160990602     C                   SELECT
036170990602     C* RECUPERO BOLLE
036180990602    2C     PARTCH        WHENEQ    'R'
036190941115     C                   MOVE      DES(4)        VIDTES
036200941115     C                   SETON                                        98
036210990602     C* PROCEDURA PREPAGATI
036220990602    2C     PARTCH        WHENEQ    'P'
036230010301     C     §LPFPR        OREQ      'O'
036240990602     C                   MOVE      DES(6)        VIDTES
036250990602   X2C                   OTHER
036260941115     C                   MOVE      DES(1)        VIDTES
036270990602    2C                   ENDSL
036280941115    1C                   ENDIF
036290941115     C*
036300941115     C* SE IMMISSIONE VISUALIZZO: ULTIMA SPEDIZIONE
036310941115     C                   MOVEL     CULTSP        PREDSS
036320941115     C*
036330941115    1C     §LPFPR        IFNE      'C'
036340941115     C* ESEGUO SOLO UNA VOLTA
036350941115    2C     RIC           IFEQ      ' '
036360941115    3C     §LPFPR        IFNE      ' '
036370010301     C     §LPFPR        ANDNE     'O'
036380941115     C*
036390941115     C* PROVENGO DA MANUTENZIONE
036400941115    4C     §LPFPR        IFEQ      'M'
036410941115     C                   SETON                                        12
036420941115     C                   MOVE      DES(2)        VIDTES
036430941115     C                   MOVEL     CVARIA        PREDSS
036440941115     C                   OPEN      FNLBL01L
036450070123     C                   OPEN      FNBRV09L
036460071221     C                   OPEN      FNBRV07L
036470080904     C                   OPEN(e)   TNBLA00F
036480080904     c
036490080904     c                   if        not %open(tnbla00f)
036500080904     c                   eval      %subst(WTNBLA:7:4)='GRPS'
036510080904     C                   OPEN      TNBLA00F
036520080904     c                   endif
036530941115     C*
036540941115   X4C                   ELSE
036550941115     C* PROVENGO DA CARICAMENTO BOLLE DA DISK
036560941115     C                   SETON                                        1215
036570941115     C                   MOVEL     CCONFE        PREDSS
036580020917     C                   OPEN      FIVAD02L
036590020917     C                   OPEN      FIVAT01L
036600040601     C                   OPEN      FIVAX01L
036610941115     C     *IN98         IFEQ      *OFF
036620941115     C                   MOVE      DES(3)        VIDTES
036630941115     C                   ELSE
036640941115     C                   MOVE      DES(5)        VIDTES
036650941115     C                   ENDIF
036660941115     C*
036670941115    4C                   END
036680941115    3C                   END
036690941115    2C                   END
036700941115    1C                   END
036710110518     c*
036720110518     c                   if        not *in12
036730110518     c                   open      fivab01l
036740110518     c                   open      edivab1l
036750110518     c                   endif
036760940819     C*
036770940915     C* QUESTI 2 CAMPI UNA VOLTA IMPOSTATI NON LI TOCCO PIU':
036780070828     c* Non più: la data ritiro a nuova bolla la reimposterò sempre a udate
036790940915     C*
036800960926     C* LINEA DI PARTENZA --> IMPOSTO
036810940915     C  N12              MOVEL     CDU           VIDLNP
036820940915     C* DATA RITIRO       --> IMPOSTO DATA DEL GIORNO
036830990628     C  N12PARTCH        IFNE      'P'
036840010301     C     §LPFPR        ANDNE     'O'
036850070828     C                   MOVEL     WDTGIO        VIDDRT
036860990630     C                   ELSE
036870990630     C                   OPEN      CNNUM00F
036880990628     C                   ENDIF
036890940915     C*
036900930628     C* CAMPI CHE INIZIALIZZO SOLO IN IMMISSIONE BOLLE
036910930628     C*   E PER DISK CLIENTI
036920930628     C   12
036930930628     CAN 15
036940930628     CORN12              DO
036950930628     C                   MOVEL     *ZEROS        RECNSP
036960930628     C                   MOVEL     *ZEROS        VIDDBR
036970930628     C                   MOVEL     *ZEROS        VIDNFV
036980930628     C                   MOVEL     *ZEROS        VIDNSP
036990930628     C                   MOVE      *BLANKS       BLPATB
037000940915     C                   MOVEL     CDU           BLPFLB
037010111128     C****               MOVEL     SIMFEL        BLPFLE
037020940915     C                   MOVEL     *ZEROS        BLPDPC
037030940915     C                   MOVEL     *ZEROS        BLPDUC
037040940819     C                   MOVEL     *ZEROS        BLPFLP
037050930628     C                   MOVEL     *ZEROS        BLPDAM
037060930628     C                   MOVEL     *ZEROS        BLPDCM
037070930628     C                   MOVEL     *ZEROS        BLPHMC
037080930628     C                   MOVEL     *ZEROS        BLPDUT
037090930628     C                   MOVEL     *ZEROS        BLPDET
037100930628     C                   MOVEL     *ZEROS        BLPDSE
037110940915     C                   MOVEL     *ZEROS        BLPVLC
037120930628     C                   MOVEL     *ZEROS        BLPNCR
037130940915     C                   MOVEL     *ZEROS        BLPDT1
037140940915     C                   MOVEL     *ZEROS        BLPDT2
037150940915     C                   MOVEL     *ZEROS        BLPDT3
037160940915     C                   MOVEL     *BLANKS       BLPFT1
037170940915     C                   MOVEL     *BLANKS       BLPFT2
037180940915     C                   MOVEL     *BLANKS       BLPFT3
037190940915     C                   Z-ADD     DATEU         BLPDIM
037200940915     C                   CLEAR                   BLPFDN
037210940915     C                   CLEAR                   BLPNCP
037220940915     C                   CLEAR                   BLPPKC
037230940915     C                   CLEAR                   BLPDTI
037240940915     C                   CLEAR                   BLPHTI
037250940915     C                   CLEAR                   BLPDCE
037260940915     C                   CLEAR                   BLPNPI
037270940915     C                   CLEAR                   BLPNCI
037280940915     C                   CLEAR                   BLPNCR
037290940915     C                   CLEAR                   BLPNDC
037300940915     C                   CLEAR                   BLPDDC
037310940915     C                   CLEAR                   BLPDCP
037320940915     C                   CLEAR                   BLPCCA
037330940915     C                   CLEAR                   BLPTMC
037340040901     c                   clear                   blpscl
037350040329      * per immissione bolle o per conferma bolle da clienti
037360040329      * Se il p.o. è già su AS unico apro TITAS
037370040329     c                   If        LnpOgAs = 946
037380040329     c                             and Not %Open(Titas30c)
037390040329     c                   Clear                   comman
037400040329     c                   Movel(p)  cmdt(1)       comman
037410040329     c                   Eval      %Subst(comman:30:10) = wlib
037420040329     c                   Eval      comman =
037430040329     c                             %trim(comman) + '/TITAS30C)'
037440040329     c                   Call      'QCMDEXC'                            99
037450040329     c                   Parm                    comman
037460040329     c                   Parm                    lenght
037470040329     c  n99              Open      Titas30c
037480040329     c                   EndIf
037490940928     C                   ENDDO
037500930611     C*
037510930611     C* STAMPA DEI 3 ASTERISCHI ALLA FINE SE><0
037520930611     C                   Z-ADD     0             I100              1 0
037530930628     C*
037540930628     C                   MOVEL     'C'           RIC               1
037550940920     C* SIGLA OPERATORE:
037560940920     C* IN IMMISSIONE SEMPRE SPROTETTA
037570940920     C     *IN12         IFEQ      *OFF
037580940920     C                   SETOFF                                       13
037590940920     C                   ENDIF
037600940920     C*
037610940920     C* IN DISK CLIENTI SEMPRE PROTETTA
037620940920     C     *IN12         IFEQ      *ON
037630940920     C     *IN15         ANDEQ     *ON
037640940920     C                   SETON                                        13
037650940920     C                   ENDIF
037660940920     C* IN MANUTENZIONE SOLO SE E' UNA SIGNA NON UTILIZABILE:
037670940920     C* LO CONTROLLO BOLLA PER BOLLA QUINDI IN CARBLP LO FACCIO
037680941117     C                   CLEAR                   SAVFIE
037690971215     C* IMPOSTO LA DS ESTERA PER I CAMPI FISSI
037700971215     C                   CLEAR                   DSBLD
037710971215     C                   CLEAR                   DSBLDE
037720000120     C*
037730000120     C                   MOVEL     'CHI'         KTCOD
037740000202     C                   MOVEL     WASFEL        KTKE1
037750000120     C                   CLEAR                   KTLIN
037760000120     C                   CLEAR                   KTSIF
037770000120     C                   CLEAR                   KTKE2
037780010319     C* VEDO SE IN L1 PRESENTE P.O. DPD
037790010319     C                   CLEAR                   WSIDPD
037800010319     C                   Z-ADD     1             II
037810010319     C     II            DOWLE     30
037820010319     C     WSIDPD        ANDEQ     *BLANKS
037830010319     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
037840010319     C  N30              MOVEL     ORGDE3        OG143
037850010319     C   30              CLEAR                   OG143
037860020319     C     §OGntw        IFEQ      'DPD'
037870010319     C                   MOVEL     'S'           WSIDPD            1
037880010319     C                   ENDIF
037890010319     C                   ADD       1             II
037900010319     C                   ENDDO
037910051124     c* imposto campi fissi da passare a fnlsa8r
037920051124     c**                 z-add     simfel        parfel
037930051124     c**                 movel     '1'           parflg
037940130117
037950130117      * Carico la tabella OSR
037960130117     c                   exsr      carosr
037970130117
037980920220     C                   ENDSR
037990130117
038000130117      /free
038010130117       // ----------------------------------------------------------------------
038020130117       //?Carico tabella OSR.
038030130117       // ----------------------------------------------------------------------
038040130117       begsr carosr;
038050130117
038060130117         clear osrxx;
038070130117
038080130117       //?carico tutta la tabella OSR delle LNP/NRS ORM
038090130117         setll    c_tabosr tntbe01l;
038100130117         reade(n) c_tabosr tntbe01l;
038110130117
038120130117         dow not %eof(tntbe01l);
038130130122           IF  TBEatb = *blanks;
038140130117           dosr = tbeuni;
038150130117       //?carico in sk tutti i clienti che trovo
038160130117       //?skCLIosr = cliente
038170130117       //?skLNPNRSosr = LNP + serie (TBEke1)
038180130117           IF d§osrcli <> 0;
038190130117             osrxx = %lookup(d§OSRcli:skCLIosr);
038200130117             IF  osrxx = 0;
038210130117               osrxx = %lookup(*zeros:skCLIosr);
038220130117               IF  osrxx > 0;
038230130117                 skCLIosr(osrxx) = d§OSRcli;
038240130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038250130117               ENDIF;
038260130117             ENDIF;
038270130117           ENDIF;
038280130117
038290130117           IF d§osrcl2 <> 0;
038300130117             osrxx = %lookup(d§OSRcl2:skCLIosr);
038310130117             IF  osrxx = 0;
038320130118               osrxx = %lookup(*zeros:skCLIosr);
038330130117               IF  osrxx > 0;
038340130117                 skCLIosr(osrxx) = d§OSRcl2;
038350130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038360130117               ENDIF;
038370130117             ENDIF;
038380130117           ENDIF;
038390130117
038400130117           IF d§osrcl3 <> 0;
038410130117             osrxx = %lookup(d§OSRcl3:skCLIosr);
038420130117             IF  osrxx = 0;
038430130117               osrxx = %lookup(*zeros:skCLIosr);
038440130117               IF  osrxx > 0;
038450130117                 skCLIosr(osrxx) = d§OSRcl3;
038460130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038470130117               ENDIF;
038480130117             ENDIF;
038490130117           ENDIF;
038500130117
038510130117           IF d§osrcl4 <> 0;
038520130117             osrxx = %lookup(d§OSRcl4:skCLIosr);
038530130117             IF  osrxx = 0;
038540130117               osrxx = %lookup(*zeros:skCLIosr);
038550130117               IF  osrxx > 0;
038560130117                 skCLIosr(osrxx) = d§OSRcl4;
038570130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038580130117               ENDIF;
038590130117             ENDIF;
038600130117           ENDIF;
038610130117
038620130117           IF d§osrcl5 <> 0;
038630130117             osrxx = %lookup(d§OSRcl5:skCLIosr);
038640130117             IF  osrxx = 0;
038650130117               osrxx = %lookup(*zeros:skCLIosr);
038660130117               IF  osrxx > 0;
038670130117                 skCLIosr(osrxx) = d§OSRcl5;
038680130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038690130117               ENDIF;
038700130117             ENDIF;
038710130117           ENDIF;
038720130117
038730130117           IF d§osrcl6 <> 0;
038740130117             osrxx = %lookup(d§OSRcl6:skCLIosr);
038750130117             IF  osrxx = 0;
038760130117               osrxx = %lookup(*zeros:skCLIosr);
038770130117               IF  osrxx > 0;
038780130117                 skCLIosr(osrxx) = d§OSRcl6;
038790130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038800130117               ENDIF;
038810130117             ENDIF;
038820130117           ENDIF;
038830130117
038840130117           IF d§osrcl7 <> 0;
038850130117             osrxx = %lookup(d§OSRcl7:skCLIosr);
038860130117             IF  osrxx = 0;
038870130117               osrxx = %lookup(*zeros:skCLIosr);
038880130117               IF  osrxx > 0;
038890130117                 skCLIosr(osrxx) = d§OSRcl7;
038900130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
038910130117               ENDIF;
038920130117             ENDIF;
038930130117           ENDIF;
038940130117
038950130117           IF d§osrcl8 <> 0;
038960130117             osrxx = %lookup(d§OSRcl8:skCLIosr);
038970130117             IF  osrxx = 0;
038980130117               osrxx = %lookup(*zeros:skCLIosr);
038990130117               IF  osrxx > 0;
039000130117                 skCLIosr(osrxx) = d§OSRcl8;
039010130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039020130117               ENDIF;
039030130117             ENDIF;
039040130117           ENDIF;
039050130117
039060130117           IF d§osrcl9 <> 0;
039070130117             osrxx = %lookup(d§OSRcl9:skCLIosr);
039080130117             IF  osrxx = 0;
039090130117               osrxx = %lookup(*zeros:skCLIosr);
039100130117               IF  osrxx > 0;
039110130117                 skCLIosr(osrxx) = d§OSRcl9;
039120130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039130130117               ENDIF;
039140130117             ENDIF;
039150130117           ENDIF;
039160130117
039170130117           IF d§osrcl10 <> 0;
039180130117             osrxx = %lookup(d§OSRcl10:skCLIosr);
039190130117             IF  osrxx = 0;
039200130117               osrxx = %lookup(*zeros:skCLIosr);
039210130117               IF  osrxx > 0;
039220130117                 skCLIosr(osrxx) = d§OSRcl10;
039230130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039240130117               ENDIF;
039250130117             ENDIF;
039260130117           ENDIF;
039270130117
039280130117           IF d§osrcl11 <> 0;
039290130117             osrxx = %lookup(d§OSRcl11:skCLIosr);
039300130117             IF  osrxx = 0;
039310130117               osrxx = %lookup(*zeros:skCLIosr);
039320130117               IF  osrxx > 0;
039330130117                 skCLIosr(osrxx) = d§OSRcl11;
039340130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039350130117               ENDIF;
039360130117             ENDIF;
039370130117           ENDIF;
039380130117
039390130117           IF d§osrcl12 <> 0;
039400130117             osrxx = %lookup(d§OSRcl12:skCLIosr);
039410130117             IF  osrxx = 0;
039420130117               osrxx = %lookup(*zeros:skCLIosr);
039430130117               IF  osrxx > 0;
039440130117                 skCLIosr(osrxx) = d§OSRcl12;
039450130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039460130117               ENDIF;
039470130117             ENDIF;
039480130117           ENDIF;
039490130117
039500130117           IF d§osrcl13 <> 0;
039510130117             osrxx = %lookup(d§OSRcl13:skCLIosr);
039520130117             IF  osrxx = 0;
039530130117               osrxx = %lookup(*zeros:skCLIosr);
039540130117               IF  osrxx > 0;
039550130117                 skCLIosr(osrxx) = d§OSRcl13;
039560130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039570130117               ENDIF;
039580130117             ENDIF;
039590130117           ENDIF;
039600130117
039610130117           IF d§osrcl14 <> 0;
039620130117             osrxx = %lookup(d§OSRcl14:skCLIosr);
039630130117             IF  osrxx = 0;
039640130117               osrxx = %lookup(*zeros:skCLIosr);
039650130117               IF  osrxx > 0;
039660130117                 skCLIosr(osrxx) = d§OSRcl14;
039670130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039680130117               ENDIF;
039690130117             ENDIF;
039700130117           ENDIF;
039710130117
039720130117           IF d§osrcl15 <> 0;
039730130117             osrxx = %lookup(d§OSRcl15:skCLIosr);
039740130117             IF  osrxx = 0;
039750130117               osrxx = %lookup(*zeros:skCLIosr);
039760130117               IF  osrxx > 0;
039770130117                 skCLIosr(osrxx) = d§OSRcl15;
039780130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039790130117               ENDIF;
039800130117             ENDIF;
039810130117           ENDIF;
039820130117
039830130117           IF d§osrcl16 <> 0;
039840130117             osrxx = %lookup(d§OSRcl16:skCLIosr);
039850130117             IF  osrxx = 0;
039860130117               osrxx = %lookup(*zeros:skCLIosr);
039870130117               IF  osrxx > 0;
039880130117                 skCLIosr(osrxx) = d§OSRcl16;
039890130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
039900130117               ENDIF;
039910130117             ENDIF;
039920130117           ENDIF;
039930130122
039940130122           ENDIF;
039950130117
039960130117           reade(n) c_tabosr tntbe01l;
039970130117         enddo;
039980130117
039990130117       endsr;
040000130117      /end-free
040010900427     C*
040020900427     C*--- PULIZIA CAMPI FORMATO1 ------------------------------------*
040030940819     C     INZ01         BEGSR
040040950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
040050950126     C                   EXSR      OFFD01
040060900427     C*
040070991014     C                   CLEAR                   DSLV04
040080940222     C                   MOVE      ' '           UNO               1
040090940930     C                   MOVE      0             DUE               1 0
040100940930     C                   MOVE      0             TRE               1 0
040110920427     C                   MOVE      0             QUA               1 0
040120100209     C                   MOVE      0             QUAH              1 0
040130940930     C                   MOVE      0             CIN               1 0
040140940930     C                   MOVE      0             SEI               1 0
040150941020     C                   MOVE      0             SET               1 0
040160940930     C                   MOVE      0             OTT               1 0
040170910801     C                   MOVEL     ' '           NOV               1
040180940930     C                   MOVEL     0             DIE               1 0
040190950102     C                   MOVEL     0             UND               1 0
040200950410     C                   MOVEL     0             DOD               1 0
040210950410     C                   MOVEL     0             QUI               1 0
040220961111     C                   MOVEL     0             SED               1 0
040230040213     C**!!!              MOVEL     0             DIC               1 0
040240040213     C**!!!              MOVEL     0             VEN               1 0
040250990610     C                   MOVEL     0             SES               1 0
040260970702     C                   MOVEL     0             AAA               1 0
040270970702     C                   MOVEL     0             AAB               1 0
040280990915     C                   MOVEL     0             AAC               1 0
040290991213     C                   MOVEL     0             AAD               1 0
040300970704     C                   MOVEL     0             MMA               1 0
040310970704     C                   MOVEL     0             MMB               1 0
040320000622     C                   MOVEL     0             MMD               1 0
040330970704     C                   MOVEL     0             COMA              1 0
040340970704     C                   MOVEL     0             COMB              1 0
040350990915     C                   MOVEL     ' '           WFPR              1
040360000509     C                   MOVEL     ' '           WPT1              1
040370001025     C                   MOVEL     ' '           VIDMAG
040380010504     C                   MOVE      ' '           WFORZO
040390990915     C                   CLEAR                   SAVPD4
040400030417     c                   Clear                   fordcr
040410030704     c                   Clear                   wforw03
040420030728     c                   Clear                   wfornba
040430031001     c                   Clear                   wfortbo
040440031201     c                   Clear                   wnoccm
040450060515     c                   clear                   bolksc
040460060515     c                   clear                   bolctr
040470040216     c                   Eval      wforza1 = *Off
040480040216     c                   Eval      wforza2 = *Off
040490110321     c                   Eval      wforzbrv = *Off
040500110422     c                   Eval      wforzadrt = *Off
040510041116     c                   clear                   wnprpre
040520060104     C                   MOVEL     *ZEROS        VARZNC
040530941107     C* PULISCO LA DS DI STAMPA
040540991007     C  N12              CLEAR                   DTAS
040550991007     C  N12              CLEAR                   DTASV
040560030626     C                   CLEAR                   fnlsb5DS
040570941115     C                   CLEAR                   WESVAR
040580950209     C                   CLEAR                   DS1A
040590950120     C                   CLEAR                   WIN11
040600950120     C                   CLEAR                   WIN88
040610940926     C*
040620940926     C* CAMPI CHE MI INDICATO SE E' PRESENTE UNA ESTENSIONE BOLLA
040630991006     C                   CLEAR                   WAR62
040640991006     C                   CLEAR                   WAR61
040650050331     C                   CLEAR                   WKSCsf1
040660050331     C                   CLEAR                   WKSCsf2
040670991006     C                   CLEAR                   WAR7
040680040114     c                   Clear                   war71
040690051115     C                   CLEAR                   War9
040700000623     C                   CLEAR                   WES3Q
040710000623     C                   CLEAR                   WBL4W
040720040116     c                   Clear                   wesvar1
040730940926     C*
040740950126     C                   CLEAR                   WSBORD
040750940930     C                   CLEAR                   VARCAD
040760940930     C                   CLEAR                   VARCAM
040770940926     C                   CLEAR                   SAVFTM
040780940921     C                   CLEAR                   SAVFLC
040790940922     C                   CLEAR                   SAVCTR
040800961111     C                   CLEAR                   SAVFBR
040810961122     C                   CLEAR                   SAVCBO
040820000211     C                   CLEAR                   WESSGN
040830100209     C                   CLEAR                   Sa2TSP
040840941005     C* CANCELLO I CAMPI DI CONFRONTO PER RICARICARE COD TARIFFA
040850941005     C                   CLEAR                   VARTSP
040860941107     C                   CLEAR                   WFIE
040870990610     C                   CLEAR                   WCOCCM
040880050926     c* pulizia campo per errore forzabile su volume in base alla tarif
040890050926     c* fa
040900050926     c                   clear                   fvol
040910941231     C**
040920941231     C* IL CAMPO SAVCCM MI SERVE PER IL CONFRONTO DEL CODICE CLI
040930941231     C*  PER CARICARE LE TARIFFE RELATIVE
040940941231     C                   Z-ADD     1             SAVCCM
040950940922     C* SPENGO INDICATORI DI ABILITAZIONE RICERCA MITTENTE E FIL CLIENT
040960941020     C                   SETOFF                                       0138
040970940922     C* INDICATORI DI "RI" PER CAMPI PRESI DA TARIFFA
040980941107     C                   SETOFF                                       97
040990040610     c     atrbva        ifne      prri
041000040610     c                   movel     hiul          atrbva
041010040610     c                   endif
041020990630     C* INDICATORI DI PTOTEZIONE DATI FATTURA E VISUL.TOT IMPONIBILE
041030990630     C                   SETOFF                                       22
041040000915     C* INDICATORE ABILITAZIONE TASTO F22-MANTUENZIONE COD.CHI SONO
041050000915     C                   SETOFF                                       96
041060051123     c* Protezione codice bolla
041070051123     C                   CLEAR                   ATRcbo
041080070801     c* imposto no display l'attributo della costante video:"Da ORM" che
041090070801     c* deve essere visualizzata quando la data ritiro viene modificata
041100070801     c* proponendola da ORM
041110070801     c                   movel     nodi          atrdaorm
041120070918     c                   clear                   s_drt
041130070831     c* data ritiro
041140070831     c                   exsr      inzdrt
041150111124     c*
041160111124     c                   clear                   vidno1
041170111124     c                   clear                   vidno2
041180111128     c                   clear                   viddno
041190940922     C*
041200940819     C* 24 ON - DATA SPEDIZIONE PERSONALIZZATA
041210940819     C     *IN24         IFEQ      *OFF
041220940819     C                   Z-ADD     WDTGIO        VIDDSP
041230940819     C                   ENDIF
041240010222     C* 37 ON - NUMERO O.R.M. PERSONALIZZATO
041250010222     C     *IN37         IFEQ      *OFF
041260040909     c                   clear                   vidpoe
041270010222     C                   CLEAR                   VIDNOR
041280010222     C                   CLEAR                   VIDNRV
041290011126     C                   CLEAR                   ATRDES
041300011205     C                   CLEAR                   SORMFD
041310010222     C                   ENDIF
041320940819     C* 21 ON - CODICE BOLLA   PERSONALIZZATO
041330940819     C     *IN21         IFEQ      *OFF
041340940819     C                   MOVEL     *BLANKS       VIDCBO
041350940819     C                   ENDIF
041360940819     C* 20 ON - LINEA DI ARRIVO PERSONALIZZATO
041370940819     C     *IN20         IFEQ      *OFF
041380950208     C                   Z-ADD     0             CO2LNA
041390950208     C                   Z-ADD     0             COMLNA
041400020213     C                   CLEAR                   A_OG143
041410040525     C                   CLEAR                   A_OG150
041420940819     C                   MOVEL     *BLANKS       VIDLNA
041430940920     C                   MOVEL     *BLANKS       V1DLNA
041440940819     C                   ENDIF
041450940819     C* 18 ON - TIPO SERVIZIO PERSONALIZZATO
041460940819     C     *IN18         IFEQ      *OFF
041470940819     C                   MOVEL     *BLANKS       VIDTSP
041480941005     C                   MOVEL     *BLANKS       V1DTSP
041490950303     C                   CLEAR                   V2DTSP
041500940819     C                   ENDIF
041510940819     C* 26 ON - CODICE TRATTAMENTO MERCE PERSONALIZZATO
041520940819     C     *IN26         IFEQ      *OFF
041530940819     C                   MOVEL     *BLANKS       VIDCTM
041540940920     C                   MOVEL     *BLANKS       V1DCTM
041550940819     C                   ENDIF
041560940920     C* 28 ON - TASSAZ TARIFFA MITTENTE PERSONALIZZATO
041570940819     C     *IN28         IFEQ      *OFF
041580940819     C                   MOVEL     *BLANKS       VIDFTM
041590940819     C                   ENDIF
041600940921     C* 19 ON - MITTENTE PERSONALIZZATO
041610950303     C* 85 ON - COD.MITTENTE PERSONALIZZATO
041620940921     C     *IN19         IFEQ      *OFF
041630950303     C*
041640950303     C     *IN85         IFEQ      *OFF
041650950123     C                   CLEAR                   WCCMS
041660941005     C                   CLEAR                   VIDFLC
041670941005     C                   CLEAR                   VIDCCM
041680950303     C                   CLEAR                   VIDDMT
041690950303     C                   ENDIF
041700950303     C                   CLEAR                   V2DTEL
041710940921     C                   CLEAR                   VIDRSM
041720940921     C                   CLEAR                   VIDINM
041730940921     C                   CLEAR                   VIDCAM
041740940921     C                   CLEAR                   VIDPRM
041750950303     C                   CLEAR                   VIDLOM
041760940921     C                   CLEAR                   VIDPIM
041770061109     C                   CLEAR                   VIDcdf
041780061109     c                   movel     hiul          atrcdf
041790080804     c                   clear                   forzcdf           1
041800120504     c                   clear                   forzcdf1          1
041810061109     c                   clear                   savrsm
041820940921     C                   CLEAR                   VIDNZM
041830940921     C                   CLEAR                   VIDFAP
041840941020     C                   SETOFF                                       14
041850940921     C                   ENDIF
041860940825     C* DESTINATARIO
041870940819     C                   MOVEL     *BLANKS       VIDRSD
041880940819     C                   MOVEL     *BLANKS       VIDIND
041890940819     C                   MOVEL     *BLANKS       VIDLOD
041900940819     C                   MOVEL     *BLANKS       VIDPRD
041910940819     C                   MOVEL     *BLANKS       VARPRD
041920940819     C                   MOVEL     *BLANKS       VIDNZD
041930940819     C                   CLEAR                   VIDCAD
041940940928     C                   CLEAR                   VIDPID
041950940819     C                   MOVEL     *BLANKS       VIDFIN
041960030305     c                   Clear                   savdisag
041970070924     c                   Clear                   savpart
041980050214     c                   Clear                   wdesie
041990940819     C*
042000940915     C* ULTIMA SPEDIZIONE        SE IMMISSIONE BOLLA (12 OFF)
042010940819     C     *IN12         IFEQ      *OFF
042020010301     C     §LPFPR        ANDNE     'O'
042030900427     C                   Z-ADD     BLPNRS        PRENRS
042040900427     C                   Z-ADD     BLPNSP        PRENSP
042050941011     C                   MOVEL     BLPLNA        PRELNA
042060900427     C                   Z-ADD     BLPRMN        PRERMN
042070910128     C                   Z-ADD     BLPZNC        PREZNC
042080940819     C                   ENDIF
042090940819     C*
042100900427     C                   Z-ADD     0             VIDPKG
042110980402     C                   Z-ADD     0             SAVPKG
042120940819     C                   Z-ADD     0             V1CNCL
042130090609     c                   clear                   wncl_pre
042140090609     c                   clear                   wpes_pre
042150111026     c                   clear                   savtsp73
042160971222     C* PULISCO I CAMPI DELL'EXPORT SDI
042170971222     C                   CLEAR                   DSBL4E
042180900502     C* PULISCO ALCUNI CAMPI DEL FOR02
042190900517     C                   Z-ADD     0             VIDZNC
042200930628     C     *IN12         IFEQ      *ON
042210930628     C                   CLEAR                   VIDTCR
042220930628     C                   CLEAR                   VIDDCR
042230930628     C                   CLEAR                   VIDHCR
042240030409     c                   Clear                   VidOre
042250930628     C                   CLEAR                   VIDMCR
042260930628     C                   CLEAR                   VIDCTR
042270930628     C                   CLEAR                   DEFCTR
042280930628     C                   CLEAR                   VIDNAS
042290040610     c                   clear                   vidbva
042300960319     C                   CLEAR                   VIDGC1
042310960319     C                   CLEAR                   VIDGC2
042320930628     C                   ELSE
042330940920     C  N17              MOVEL     ' '           VIDTCR
042340930628     C  N16              MOVEL     *ZEROS        VIDDCR
042350940920     C  N23              MOVEL     *ZEROS        VIDHCR
042360940920     C  N23              MOVEL     *ZEROS        VIDMCR
042370030409     c                   If        wflagore = *Blanks
042380030409     c                   Clear                   VidOre
042390030409     c                   EndIf
042400930628     C  N29              CLEAR                   VIDCTR
042410930628     C  N29              CLEAR                   DEFCTR
042420940825     C  N27              CLEAR                   VIDNAS
042430040610     c     atrbva        ifne      prri
042440040610     c                   clear                   vidbva
042450040610     c                   endif
042460960319     C  N91              CLEAR                   VIDGC1
042470960319     C  N91              CLEAR                   VIDGC2
042480960319     C                   ENDIF
042490990630     C* MEMORIZZO E PROTEGGO LA DATA PER I PREPAGATI
042500990630     C     PARTCH        IFEQ      'P'
042510010301     C     §LPFPR        OREQ      'O'
042520990630     C                   Z-ADD     WDTGIO        VIDDSP
042530990701     C                   SETON                                        2426
042540990630     C                   SETON                                        3422
042550990630     C* IMPOSTO FISSO IL CTM
042560990630     C                   MOVEL     §3ICTP        VIDCTM
042570990630     C* IMPOSTO IL COD MITTENTE --> 8888
042580990720     C* SOLO SE NON PERSONALIZZATO
042590010307     C     PARTCH        IFEQ      'P'
042600990720     C  N19
042610990720     CANN85              Z-ADD     8888          VIDCCM
042620010307     C                   ENDIF
042630990630     C                   ENDIF
042640050126     c* autotrasportatore
042650050426     c***  atrpdr        ifne      prri
042660050426     c***                clear                   vidpdr
042670050426     c***                clear                   v1dpdr
042680050426     c**n34              movel     '?'           vidpdr
042690050426     c***                endif
042700050126     c* flag mattino pomeriggio
042710050426     c***  atrfpp        ifne      prri
042720050426     c***                clear                   vidfpp
042730050426     c***                endif
042740031113     c                   Clear                   VidRef
042750031113     c                   Clear                   VidTel
042760031219     c                   Clear                   wrifp
042770000120     C*
042780000120     C                   CLEAR                   VIDDPD
042790000120     C                   CLEAR                   VIDNRD
042800000120     C                   CLEAR                   COMNRD
042810050315     C                   MOVE      *BLANKS       VIDFFD
042820010223     C                   CLEAR                   WOVUO
042830070427     C                   CLEAR                   WOVUO1
042840010226     C                   CLEAR                   CHGORM
042850090327     C                   CLEAR                   CHGORM1
042860091120     C                   CLEAR                   CHGORM2
042870090327     C                   CLEAR                   w_fcli
042880110512     c* imposto no display l'attributo della costante video:"F17=ind.mail dest
042890110512     c* che deve essere visualizzata solo quando ricevo il dato da VAT
042900110512     c                   movel     nodi          atremd
042910110512     c                   clear                   wemdest
042920130315     c                   clear                   wsms
042930130315     c                   clear                   wsmp
042940110705     c* visualizzazione f19=CUP/CIG solo da data attivazione
042950110705     C                   IF        DATEU < §VPOTFF
042960110705     c                   movel     nodi          atrCUP
042970110705     C                   ELSE
042980110705     c                   clear                   atrCUP
042990110705     C                   ENDIF
043000110706     c                   clear                   wcupcup
043010110706     c                   clear                   wcupcig
043020130311
043030130311     c                   clear                   wvatpe
043040900427     C                   ENDSR
043050070831     C*
043060070831     C* inizializzazione campo data ritiro --------------------------*
043070070831     C     inzdrt        BEGSR
043080070831     c* data ritiro=udate se data ritiro non personalizzata
043090070831     C  N12PARTCH        IFNE      'P'
043100070831     C     §LPFPR        ANDNE     'O'
043110071107     c***  dateu         andge     §vpodrt
043120070831     c                   if        atrdrt<>prri or viddrt=0
043130070831     C                   MOVEL     WDTGIO        VIDDRT
043140070831     c                   endif
043150070831     c                   endif
043160070831     c                   endsr
043170940819     C*
043180940819     C* GESTIONE VIDEATA DI PERSONALIZZAZIONE -----------------------*
043190050118     C     GESD00        BEGSR
043200940824     C                   MOVEL     'P'           WPERSO            1
043210940819     C*
043220941230     C                   CLEAR                   V0CRSM
043230941230     C                   CLEAR                   V0CINM
043240941230     C                   CLEAR                   V0CCAM
043250941230     C                   CLEAR                   V0CLOM
043260941230     C                   CLEAR                   V0CPRM
043270941230     C                   CLEAR                   V0CNZM
043280941230     C                   CLEAR                   V0CPIM
043290061109     C                   CLEAR                   V0Ccdf
043300061109     c                   movel     hiul          atrcdf
043310941230     C                   CLEAR                   V0CFAP
043320941230     C                   CLEAR                   V0CLNA
043330941230     C                   CLEAR                   V0CCBO
043340941230     C                   CLEAR                   V0CTSP
043350941230     C                   CLEAR                   V0CCTM
043360941230     C                   CLEAR                   V0CCCM
043370941230     C                   CLEAR                   V0CFLC
043380941230     C                   CLEAR                   V0CCTR
043390941230     C                   CLEAR                   V0CNAS
043400040610     C                   CLEAR                   V0Cbva
043410941230     C                   CLEAR                   V0CTCR
043420941230     C                   CLEAR                   V0CDCR
043430941230     C                   CLEAR                   V0CHCR
043440941230     C                   CLEAR                   V0CMCR
043450941230     C                   CLEAR                   V0CRMO
043460941230     C                   CLEAR                   V0CNMO
043470941230     C                   CLEAR                   V0CCMO
043480960319     C                   CLEAR                   V0CGC1
043490960319     C                   CLEAR                   V0CGC2
043500010209     C                   CLEAR                   V0CNOR
043510010209     C                   CLEAR                   V0CNRV
043520030409     c                   Clear                   V0cOre
043530050426     c***                clear                   v0cpdr
043540050426     c***                clear                   v0cfpp
043550940819     C* MUOVO TUTTI I CAMPI DAL VIDEO 1 PER LA PERSONALIZZAIZONE
043560941230     C* SOLO SE LI AVEVO PERSONALI<ZZATI E QUELLI CHE RIMANGONO
043570941230     C*  SEMPRE IMPOSTATI
043580941230     C                   MOVEL     VIDSOP        V0CSOP
043590010502     C* NON IMPOSTO, NELLA VIDEATA DI PERSONALIZZAZIONE LA RICERCA ALFA
043600010502     C* BETICA SU PADRONCINO SE ATTIVATA PROCEDURA ORM
043610050426     c***  atrpdr        ifeq      prri
043620050426     C     WORM          IFNE      'S'
043630050426     C     VIDPDR        ORNE      '?   '
043640940819     C                   MOVEL     VIDPDR        V0CPDR
043650050426     c***                clear                   vidpdr
043660010502     C                   ENDIF
043670050426     c***  atrfpp        ifeq      prri
043680050126     C                   MOVEL     VIDFPP        V0CFPP
043690050426     c***                clear                   vidfpp
043700050426     c***                endif
043710940819     C                   MOVEL     VIDNRT        V0CNRT
043720940819     C                   MOVEL     VIDLNP        V0CLNP
043730010222     C                   Z-ADD     VIDPOE        V0CPOE
043740010222     C   37              Z-ADD     VIDNOR        V0CNOR
043750041108     C   37              Z-ADD     VIDNRV        V0CNRV
043760070828     c***37              movel     atrdaorm      at0daorm
043770070828     c                   movel     nodi          at0daorm
043780071107     c***                if        dateu>=§vpodrt
043790070828     c                   clear                   viddrt
043800071107     c***                endif
043810041220     c                   z-add     vidpoe        s_v0cpoe
043820041220     c                   z-add     vidnor        s_v0cnor
043830041220     c                   z-add     vidnrv        s_v0cnrv
043840050315     C   37              MOVE      'P'           s_ormpers
043850050315     C  N37              MOVE      ' '           s_ormpers
043860010222     C   37              CLEAR                   VIDPOE
043870010222     C   37              CLEAR                   VIDNOR
043880010222     C   37              CLEAR                   VIDNRV
043890941230     C   20              MOVEL     VIDLNA        V0CLNA
043900941231     C   20              CLEAR                   VIDLNA
043910941230     C   21              MOVEL     VIDCBO        V0CCBO
043920941231     C   21              CLEAR                   VIDCBO
043930941230     C   18              MOVEL     VIDTSP        V0CTSP
043940941231     C   18              CLEAR                   VIDTSP
043950941230     C   26              MOVEL     VIDCTM        V0CCTM
043960941231     C   26              CLEAR                   VIDCTM
043970950125     C     *IN19         IFEQ      *ON
043980950303     C     *IN85         OREQ      *ON
043990950125     C                   MOVEL     VIDCCM        V0CCCM
044000950125     C                   CLEAR                   VIDCCM
044010050120     c***                clear                   viddmt
044020950125     C                   MOVEL     VIDFLC        V0CFLC
044030950125     C                   CLEAR                   VIDFLC
044040950303     C                   ENDIF
044050941221     C* SE NON E' UN CODIFICATO, IMPOSTO IL MITTENTE COSI' COME E'
044060950303     C     *IN19         IFEQ      *ON
044070020507     C     V0CCCM        ifeQ      8888
044080950125     C     V0CCCM        OREQ      9999
044090940819     C                   MOVEL     VIDRSM        V0CRSM
044100940819     C                   MOVEL     VIDINM        V0CINM
044110940819     C                   MOVEL     VIDLOM        V0CLOM
044120940819     C                   MOVEL     VIDCAM        V0CCAM
044130940819     C                   MOVEL     VIDPRM        V0CPRM
044140940819     C                   MOVEL     VIDNZM        V0CNZM
044150940819     C                   MOVEL     VIDFAP        V0CFAP
044160940819     C                   MOVEL     VIDPIM        V0CPIM
044170061109     C                   MOVEL     VIDcdf        V0Ccdf
044180950125     C                   ENDIF
044190941231     C                   CLEAR                   VIDRSM
044200941231     C                   CLEAR                   VIDINM
044210941231     C                   CLEAR                   VIDLOM
044220941231     C                   CLEAR                   VIDCAM
044230941231     C                   CLEAR                   VIDPRM
044240941231     C                   CLEAR                   VIDNZM
044250941231     C                   CLEAR                   VIDFAP
044260941231     C                   CLEAR                   VIDPIM
044270061109     C                   CLEAR                   VIDcdf
044280941230     C                   ENDIF
044290941230     C   28              MOVEL     VIDFTM        V0CFTM
044300941231     C   28              CLEAR                   VIDFTM
044310941230     C   27              MOVEL     VIDNAS        V0CNAS
044320941231     C   27              CLEAR                   VIDNAS
044330040610     c     atrbva        ifeq      prri
044340040610     C                   MOVEL     VIDbva        V0Cbva
044350040610     C                   CLEAR                   VIDbva
044360040610     c                   endif
044370941230     C   17              MOVEL     VIDTCR        V0CTCR
044380941231     C   17              CLEAR                   VIDTCR
044390941230     C   16              MOVEL     VIDDCR        V0CDCR
044400941231     C   16              CLEAR                   VIDDCR
044410941230     C   23              MOVEL     VIDHCR        V0CHCR
044420941230     C   23              MOVEL     VIDMCR        V0CMCR
044430941231     C   23              CLEAR                   VIDHCR
044440941231     C   23              CLEAR                   VIDMCR
044450030409     c                   If        wflagore = '1'
044460030409     c                   Eval      V0cOre = VidOre
044470030409     c                   Clear                   VidOre
044480030409     c                   EndIf
044490941230     C   03              MOVEL     VIDRMO        V0CRMO
044500941230     C   03              MOVEL     VIDNMO        V0CNMO
044510941231     C   03              CLEAR                   VIDRMO
044520941231     C   03              CLEAR                   VIDNMO
044530941230     C   03              MOVEL     VIDCMO        V0CCMO
044540941231     C   03              CLEAR                   VIDCMO
044550950206     C   29              MOVEL     VIDCTR        V0CCTR
044560950206     C   29              CLEAR                   VIDCTR
044570960319     C     *IN91         IFEQ      *ON
044580960319     C                   MOVEL     VIDGC1        V0CGC1
044590960319     C                   CLEAR                   VIDGC1
044600960319     C                   MOVEL     VIDGC2        V0CGC2
044610960319     C                   CLEAR                   VIDGC2
044620960319     C                   ENDIF
044630050119     C                   MOVEL     *BLANKS       VIDDMT
044640940819     C*
044650990720     C* SPENGO GLI INDICATORI DI PROTEZIONE DELLA VIDEATA DELLE PERSON
044660990719     C*  CHE SERVONO PER LA PROCEDURA PREPAGATI
044670990719     C     PARTCH        IFNE      'P'
044680010307     C     §LPFPR        ANDNE     'O'
044690990720     C                   SETOFF                                       2426
044700990719     C                   ENDIF
044710990720     C                   SETOFF                                       19
044720041214     C* ABILITA LA RICERCA ALFABETICA
044730041214     C                   SETON                                        01
044740041214     C                   SETOFF                                       1438
044750990719     C**
044760940819     C     FORD00        TAG
044770041109     c****               z-add     v0cnrv        v0cnrvv
044780071107     c****               if        dateu>=§vpodrt
044790070828     c                   clear                   atrdrt
044800071107     c****               endif
044810940819     C                   EXFMT     LS01D00
044820041109     c****               z-add     v0cnrvv       v0cnrv
044830940819     C* CMD3 - FINE LAVORO
044840940819     C   KC              GOTO      ENDG00
044850010219     C* CMD14 - INTERROGAZIONE O.R.M.
044860010223     C     *INKH         IFEQ      *ON
044870010226     C     WORM          ANDEQ     'S'
044880010227     C     PARTCH        ANDNE     'P'
044890010220     C     V0CNOR        ANDEQ     *ZEROS
044900111123     c* se lnp import continuo a richiamare FIOR04R
044910111123     c****               if        %lookup(v0clnp:fio)=0
044920111123     c*****                        and %lookup(999:fio)=0
044930111123     c                   if        v0clnp>pr0lnp
044940111123     c                   clear                   og143
044950111123     C     v0clnp        CHAIN     AZORG01L      UNIORG
044960111123     c                   if        %found(azorg01l)
044970111123     C                   MOVEL     ORGDE3        OG143
044980111123     c                   endif
044990111123     c                   eval      pr0lnp=v0clnp
045000111123     c                   endif
045010111123     c                   if        §ogntw='DPD' or §ogntw='EEX' or
045020111123     c                             §ogntw='FED'
045030010219     C                   CLEAR                   DSOR04
045040010219     C                   MOVEL     '1'           I04RIC
045050010219     C                   Z-ADD     V0CLNP        I04POR
045060051207     c
045070010219     C                   CALL      'FIOR04R'
045080010219     C                   PARM                    KPJBA
045090010219     C                   PARM                    DSOR04
045100010219     C     O04CM3        IFEQ      *BLANKS
045110010219     C                   Z-ADD     O04POE        V0CPOE
045120010222     C                   MOVEL     O04NSR        V0CNOR
045130010222     C                   MOVE      O04NOR        V0CNOR
045140010219     C                   Z-ADD     O04NRV        V0CNRV
045150050117     c                   eval      *inkh = '0'
045160050117     c                   else
045170010226     C                   GOTO      FORD00
045180050117     c                   endif
045190110419     c                   else
045200110419     c                   if        v0cpdr<=*zeros
045210110419     c                   eval      *in90='1'
045220110419     c                   eval      *in56='1'
045230110419     c                   eval      vidmsg=err(210)
045240110419     c                   goto      ford00
045250110419     c                   else
045260110419     c                   clear                   fior58ds
045270110419     c                   movel     v0clnp        ior58pdr
045280110419     c                   move      v0cpdr        IOR58PDR
045290110419     C                   CALL      'FIOR58R'
045300110419     C                   PARM                    KPJBA
045310110419     C                   PARM                    fior58ds
045320110419     C     OOR58F03      IFEQ      *BLANKS
045330110419     C                   Z-ADD     OOR58POE      V0cPOE
045340110419     C                   MOVEL     OOR58NSR      V0cNOR
045350110419     C                   MOVE      OOR58NOR      V0cNOR
045360110419     C                   Z-ADD     OOR58NRV      V0cNRV
045370110419     c                   eval      *inkh = '0'
045380110419     c                   else
045390110419     C                   GOTO      FORd00
045400110419     c                   endif
045410110419     c                   endif
045420110419     c                   endif
045430010226     C                   ENDIF
045440010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
045450010227     C* SE NON SEMPRE VISUALIZZATO. PER CMD8 E PROCEDURA NON ATTIVATA
045460010227     C* O SONO NEL GIRO DEI MIEI PREPAGATI RIEMETTO SEMPRE LA VIDEATA
045470010227     C   KHWORM          IFNE      'S'
045480010227     C     PARTCH        OREQ      'P'
045490010227     C                   GOTO      FORD00
045500010227     C                   ENDIF
045510940819     C*
045520940819     C* CONTROLLO CAMPI PERSONALIZZATI
045530940819     C                   EXSR      CTRD00
045540940929     C     WEMFOR        IFEQ      '1'
045550040908     c* Se no Errori ma non premuto F6 riemetto la videata
045560040908     c     *inkf         oreq      *off
045570940929     C                   GOTO      FORD00
045580940929     C                   ENDIF
045590041220     c* SOLO SE CAMBIATO ORM:
045600041220     c* pulisco la prima videata per essere sicura che
045610041220     c* non rimangano impostati campi del precedente orm ma non giusti per i
045620041220     c* l nuovo ORM
045630050315     c                   if        s_v0corm <> v0corm and (v0corm1 > 0 or
045640050315     c                             s_ormpers='P')
045650041220     c                   exsr      inz01
045660041220     c                   endif
045670070831     c
045680070831     c* Se non è cambiato l'ORM ma la data ritiro è = 0 forzo comunque
045690070831     c* data ritiro=udate
045700070831     c                   if        viddrt=0
045710070831     c                   exsr      inzdrt
045720070831     c                   endif
045730070831     c
045740940819     C*
045750940819     C* MUOVO TUTTI I CAMPI CHE HO PERSONALIZZATO
045760041129     c*
045770940819     C                   MOVEL     V0CSOP        VIDSOP
045780050426     c***  atrpdr        ifeq      prri
045790940819     C                   MOVEL     V0CPDR        VIDPDR
045800050426     c***                endif
045810070806     c                   movel     at0daorm      atrdaorm
045820011122     C* SE SONO IN IMMISSIONE PREPAGATI NON DEVO METTERE "?" IN QUANTO
045830011122     C* IN QUESTO CASO IL CODICE AUTOTRASPORTATORE NON E' DA IMMETTERE
045840011122     C  N34V0CPDR        IFEQ      *BLANKS
045850010502     C     WORM          ANDEQ     'S'
045860010502     C                   MOVEL     '?   '        VIDPDR
045870050128     c                   clear                   v1dpdr
045880010502     C                   ENDIF
045890960926     C* SE HO GIA' INSERITO IL AUTOTRASPORTATORE MI POSIZIONO SOTTO
045900950206     C     V0CPDR        IFGT      *ZEROS
045910010222     C     WORM          IFEQ      'S'
045920010222     C     PARTCH        ANDNE     'P'
045930010307     C     §LPFPR        ANDNE     'O'
045940010222     C                   SETON                                        06
045950010222     C                   ELSE
045960950206     C                   SETON                                        07
045970010222     C                   ENDIF
045980950206     C                   ENDIF
045990940819     C                   MOVEL     V0CNRT        VIDNRT
046000050426     c***  atrfpp        ifeq      prri
046010940819     C                   MOVEL     V0CFPP        VIDFPP
046020050426     c***                endif
046030940819     C                   MOVEL     V0CLNP        VIDLNP
046040010222     C                   Z-ADD     V0CPOE        VIDPOE
046050010222     C   37              Z-ADD     V0CNOR        VIDNOR
046060010222     C   37              Z-ADD     V0CNRV        VIDNRV
046070941230     C   20              MOVEL     V0CLNA        VIDLNA
046080941230     C   21              MOVEL     V0CCBO        VIDCBO
046090941230     C   18              MOVEL     V0CTSP        VIDTSP
046100941230     C   26              MOVEL     V0CCTM        VIDCTM
046110941230     C*
046120941230     C     *IN19         IFEQ      *ON
046130950303     C     *IN85         OREQ      *ON
046140941230     C                   MOVEL     V0CCCM        VIDCCM
046150941230     C                   MOVEL     V0CFLC        VIDFLC
046160941011     C     V0CFLC        IFNE      0
046170941020     C                   SETON                                        14
046180941011     C                   ENDIF
046190950303     C                   ENDIF
046200940825     C*
046210940825     C* IMPOSTO I CAMPI DEL MITTENTE SE PERSONALIZZATO
046220061109    1C     *IN19         IFEQ      *ON
046230061109    2C     V0CINM        IFEQ      *BLANKS
046240940825     C                   MOVEL     ACORAG        VIDRSM
046250940825     C                   MOVEL     ACORAG        VIDDMT
046260940825     C                   MOVEL     INDVIA        VIDINM
046270941005     C                   MOVEL     INDCAE        VIDCAM
046280940825     C                   MOVEL     INDCIT        VIDLOM
046290940825     C                   MOVEL     INDPRV        VIDPRM
046300940825     C                   MOVEL     INDSTA        VIDNZM
046310940825     C                   MOVEL     INDIVA        WISO
046320950125     C     WISO          IFGE      '00'
046330940825     C                   MOVEL     INDIVA        VIDCPM
046340120504     C                   clear                   VIDism
046350940825     C                   ELSE
046360940825     C                   MOVEL     INDIVA        VIDPIM
046370940825     C                   ENDIF
046380120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
046390120508     c* in contabilità crea problemi
046400120508     c                   if        *in22 and wiso='$$'
046410120508     c                   clear                   vidpim
046420120508     c                   endif
046430061110     c   22              movel     indcdf        vidcdf
046440941230     C*
046450061109   x2C                   ELSE
046460941230     C*
046470941230     C                   MOVEL     V0CRSM        VIDRSM
046480941230     C                   MOVEL     V0CINM        VIDINM
046490941230     C                   MOVEL     V0CLOM        VIDLOM
046500941230     C                   MOVEL     V0CCAM        VIDCAM
046510941230     C                   MOVEL     V0CPRM        VIDPRM
046520941230     C                   MOVEL     V0CNZM        VIDNZM
046530941230     C                   MOVEL     V0CFAP        VIDFAP
046540941230     C                   MOVEL     V0CPIM        VIDPIM
046550061109     C                   CLEAR                   VIDcdf
046560071023     c                   eval      w_callyco=' '
046570071023     c* Codice fiscale: se non c'e' effettuo la ricerca
046580061110    3c   22              if        v0ccdf<>*BLANKS
046590061109     C                   MOVEL     V0Ccdf        VIDcdf
046600061109   x3C                   ELSE
046610061109    4c                   if        vidnzm=*blanks
046620061110     c* richiamo pgm di richiesta
046630071023     c****               EXSR      CAlLyco
046640071023     c                   eval      w_callyco='1'
046650061109     c
046660061109    4C                   endif
046670061109    3C                   endif
046680071023     c* Partita Iva: se non c'e' effettuo la ricerca
046690071023    3c   22              if        vidpim=*BLANKS and vidnzm=*blanks
046700071023     c* memorizzo di richiamare pgm di richiesta
046710071023     c                   eval      w_callyco='1'
046720071023    3C                   endif
046730071023
046740120503     c                   if        w_callyco='1'
046750120503     c                   exsr      CALLyco
046760120503     c                   endif
046770061109     c
046780061109    2C                   ENDIF
046790061109     c* proteggo il campo del codice fiscale
046800061109     c                   movel     riul          atrcdf
046810061109    1C                   ENDIF
046820941230     C* IMPOSTO SOLO QUELLI PESONALIZZATI, GLI ALTRI LI LASCIO
046830941230     C*  COME SONO
046840950206     C   29              MOVEL     V0CCTR        VIDCTR
046850950206     C   28              MOVEL     V0CFTM        VIDFTM
046860941230     C   27              MOVEL     V0CNAS        VIDNAS
046870040610     c     atrbva        ifeq      prri
046880040610     c                   movel     v0cbva        vidbva
046890040610     c                   endif
046900941230     C   17              MOVEL     V0CTCR        VIDTCR
046910941230     C   16              MOVEL     V0CDCR        VIDDCR
046920941230     C   23              MOVEL     V0CHCR        VIDHCR
046930941230     C   23              MOVEL     V0CMCR        VIDMCR
046940030409     c                   If        wflagore = '1'
046950030409     c                   Eval      VidOre = V0cOre
046960030409     c                   EndIf
046970941230     C   03              MOVEL     V0CRMO        VIDRMO
046980941230     C   03              MOVEL     V0CNMO        VIDNMO
046990941230     C   03              MOVEL     V0CCMO        VIDCMO
047000960319     C   91              MOVEL     V0CGC1        VIDGC1
047010960319     C   91              MOVEL     V0CGC2        VIDGC2
047020940824     C* FINE PERSONALIZZAZIONE
047030940921     C                   SETOFF                                       01
047040940824     C                   MOVEL     ' '           WPERSO            1
047050940819    2C     ENDG00        ENDSR
047060061110     c*
047070061110     c* RICHIAMO PGM DI RICERCA COD FISCALE X 8888 O 9999-----------------*
047080061110     c     CALLYCO       BEGSR
047090061110     c                   eval      i600ela='R'
047100071023     c                   if        vidcdf=*blanks
047110061110     c                   eval      i600aCF='SI'
047120071023     c                   endif
047130071023     c                   if        vidpim=*blanks
047140071023     c                   eval      i600api='SI'
047150071023     c                   endif
047160061110     c     *iso          movel     20000101      i600dti
047170061110     c     *iso          movel     29991231      i600dtf
047180061110     c                   eval      i600rsc=vidrsm
047190061110     c                   eval      i600ind=vidinm
047200061110     c                   eval      i600cap=vidcam
047210061110     c                   eval      i600loc=vidlom
047220061110     c                   eval      i600prv=vidprm
047230061110     c                   movel     yco600ds      kpjbu
047240061110     c                   call      'YCO601R'
047250061110     c                   parm                    kpjba
047260061110     c
047270061110     c                   movel     kpjbu         yco600ds
047280061110    5c                   if        o600err=*blanks
047290071023     c                   if        vidcdf=*blanks
047300061110     c                   movel     o600cdfi      vidcdf
047310071023     c                   endif
047320071023     c                   if        vidpim=*blanks
047330071023     c                   movel     o600piva      wpiva
047340071023     c                   exsr      sr_wpiva
047350120508     c* Se partita iva $$ la puilisco: crea problemi in contabilità
047360120508     c                   if        vidism='$$'
047370120508     c                   clear                   vidpim
047380120508     c                   endif
047390071023     c                   endif
047400061110    5c                   endif
047410061110     c                   ENDSR
047420900427     C*
047430900427     C*--- CONTROLLO CAMPI PERSONALIZZAZIONE -------------------------*
047440940819     C     CTRD00        BEGSR
047450941115     C                   CLEAR                   VIDMSG
047460941103     C                   CLEAR                   WCMO
047470941103     C                   CLEAR                   WNAR
047480940824     C                   CLEAR                   WCBO
047490940824     C                   CLEAR                   WLNP
047500940824     C                   CLEAR                   WPDR
047510940824     C                   CLEAR                   WLNA
047520940824     C                   CLEAR                   WCTM
047530940824     C                   CLEAR                   WCCM
047540940825     C                   CLEAR                   WFTM
047550940824     C                   CLEAR                   WTSP
047560960319     C                   CLEAR                   WGC1
047570960319     C                   CLEAR                   WGC2
047580940929     C                   SETOFF                                       90
047590941003     C* SPENGO GLI INDICATORI DI PERSONALIZZAZIONE
047600941004     C                   SETOFF                                       161710
047610941103     C                   SETOFF                                       181903
047620990720     C                   SETOFF                                       202123
047630941003     C                   SETOFF                                       272829
047640990720     C                   SETOFF                                       859119
047650010222     C                   SETOFF                                       37
047660030409     c                   Clear                   wflagore
047670040610     c                   movel     hiul          atrbva
047680050426     c****               clear                   atrpdr
047690050426     c****               clear                   atrfpp
047700070829     c                   clear                   atrdrt
047710990602     C* GLI INDICATORI DELLA DATA E CTM LI SPENGO SOLO SE
047720990602     C*  NON PROVENGO DA PREPAGATI
047730990602     C     PARTCH        IFNE      'P'
047740010307     C     §LPFPR        ANDNE     'O'
047750990720     C                   SETOFF                                       2426
047760990602     C                   ENDIF
047770940929     C* SPENGO GLI INDICATORI DI POSIZONAMENTO CURSORE
047780940929     C                   SETOFF                                       404142
047790940929     C                   SETOFF                                       435645
047800940929     C                   SETOFF                                       464748
047810940929     C                   SETOFF                                       495051
047820940929     C                   SETOFF                                       525354
047830940929     C                   SETOFF                                       556870
047840940929     C                   SETOFF                                       585960
047850960319     C                   SETOFF                                       616274
047860040611     c                   clear                   h0riga
047870040611     c                   clear                   h0colo
047880030411     c                   Clear                   At0Tcr
047890030415     c                   Clear                   At0Ore
047900940929     C                   CLEAR                   WEMFOR
047910950504     C                   CLEAR                   DS3A
047920950209     C***
047930950209     C*** RICERCA ALFABETICA
047940950209     C                   MOVEL     V0CLNP        WLNP
047950950209     C                   Z-ADD     V0CCCM        WCCM
047960950209    2C     V0CFLC        IFNE      0
047970950209     C                   Z-ADD     V0CFLC        WFLC
047980950209     C                   ELSE
047990950209     C                   Z-ADD     V0CLNP        WFLC
048000950209    2C                   ENDIF
048010950209     C                   MOVEL(P)  V0CRSM        PAXDMT
048020050119     C                   CLEAR                   VIDDMT
048030950209     C* ESEGUO RICERCA ALFABETICA
048040950209     C                   EXSR      RICALF
048050950209     C                   MOVE      WCCM          V0CCCM
048060950209     C     *IN14         IFEQ      *ON
048070950209     C                   MOVEL     WFLC          V0CFLC
048080950209     C                   ENDIF
048090940822     C***
048100910208     C*** DATA SPEDIZIONE ***
048110930708     C                   EXSR      CTRDSP
048120001031     C   90              GOTO      ENDC00
048130940920     C***
048140940920     C*** SIGLA OPERATORE ***
048150940920     C* CONTROLLO SOLO SE NON E' PROTETTO
048160940928    1C     *IN13         IFEQ      *OFF
048170940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
048180940920     C                   MOVEL     '3M'          COD
048190940920     C                   MOVEL(P)  V0CSOP        KEY
048200940920     C                   EXSR      CTABEL
048210940928    2C     *IN30         IFEQ      *OFF
048220950713     C     V0CSOP        OREQ      ' '
048230940920     C                   MOVEL     ERR(29)       VIDMSG
048240940920     C                   SETON                                        4290
048250940920     C                   GOTO      ENDC00
048260940928    2C                   ENDIF
048270940928    1C                   ENDIF
048280940822     C***
048290940824     C*** DATA RITIRO MERCE ***
048300070806     C***                EXSR      CTRDRT
048310070806     C***90              GOTO      ENDC00
048320940822     C***
048330940819     C*** LINEA PARTENZA ***
048340940928     C                   MOVEL     V0CLNP        WLNP
048350940824     C                   EXSR      CTRLNP
048360940824     C   90              GOTO      ENDC00
048370010213     C***
048380010213     C*** NUMERO O.R.M.
048390010213     C*
048400010213     C* Controllo solo se attivata procedura O.R.M.
048410010213     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
048420010213     c* fine dell'immissione
048430010213     C     WORM          IFEQ      'S'
048440010213     C     PARTCH        ANDNE     'P'
048450010213     C                   Z-ADD     V0CPOE        WOPOE
048460010213     C                   Z-ADD     V0CNOR        WONOR
048470010213     C                   Z-ADD     V0CNRV        WONRV
048480010213     C                   Z-ADD     V0CLNP        WOLNP
048490010222     C     WIDOR1        IFGT      *ZEROS
048500010213     C                   EXSR      CTRORM
048510010213     C   90              GOTO      ENDC00
048520010216     C     WEMFOR        IFEQ      '1'
048530010216     C                   GOTO      ENDC00
048540010216     C                   ENDIF
048550010222     C                   ENDIF
048560010213     C                   ENDIF
048570010227     C* SE PREMUTO F8 E SONO NEL GIRO DEI PREPAGATI DEVO RIEMETTERE LA
048580010227     C* VIDEATA
048590010227     C   KH              GOTO      ENDC00
048600070806     c***
048610070806     C*** DATA RITIRO MERCE ***
048620070806     c* se orm non fittizio forzo data ritiro prendendola da ORM
048630070806     c                   if        flgfit <> 'S' and widor1>*zeros
048640071107     c*****                        and dateu>=§vpodrt
048650070828     c                   clear                   weform
048660070806     c                   exsr      fordrt
048670070831     c                   if        weform='1'
048680070831     c                   eval      wemfor='1'
048690070828     c                   goto      endc00
048700070828     c                   endif
048710070806     c                   endif
048720070828     c* se orm fittizio non controllo la data ritiro se non immessa
048730070905     c***                if        flgfit='S' and widor1>*zeros and viddrt=0
048740070905     c***                          and dateu>=§vpodrt
048750070905     c***                else
048760070806     C                   EXSR      CTRDRT
048770070806     C   90              GOTO      ENDC00
048780070905     c***                endif
048790070831     c* se immesso orm  proteggo la data ritiro
048800070831     c                   if        widor1>*zeros and viddrt>0
048810071107     c****                         and dateu>=§vpodrt
048820070828     c                   eval      atrdrt=prri
048830070828     c                   endif
048840940822     c***
048850960926     C*** CODICE AUTOTRASPORTATORE ***
048860940928    1C     V0CPDR        IFNE      *BLANKS
048870940824     C     V0CPDR        ANDNE     *ZEROS
048880940824     C*
048890940928     C                   MOVE      V0CPDR        WPDR
048900940824     C                   EXSR      CTRPDR
048910940915     C                   MOVE      WPDR          V0CPDR
048920940928    2C     WEMFOR        IFEQ      '1'
048930940824     C                   GOTO      ENDC00
048940940928    2C                   ENDIF
048950050126     c*
048960050426     c***                movel     prri          atrpdr
048970940824     C*
048980940928    1C                   ENDIF
048990050126     c*** FLAG MATTINO/POMERIGGIO  ***
049000050426     c***  v0cfpp        ifne      *blanks
049010050426     c***                movel     prri          atrfpp
049020050426     c***                endif
049030940822     C***
049040940822     C*** CODICE BOLLA ***
049050940928    1C     V0CCBO        IFNE      *BLANKS
049060940824     C*
049070940824     C                   MOVEL     V0CCBO        WCBO
049080940824     C                   EXSR      CTRCBO
049090940824     C                   MOVEL     WCBO          V0CCBO
049100940928    2C     WEMFOR        IFEQ      '1'
049110940824     C                   GOTO      ENDC00
049120940928    2C                   ENDIF
049130940824     C*
049140940928    1C                   ENDIF
049150940822     C***
049160940822     C*** LINEA ARRIVO ***
049170940824     C                   MOVEL     V0CLNA        WLNA
049180110217     C                   EXSR      CTRLNA_vid
049190940824     C                   MOVEL     WLNA          V0CLNA
049200940928    1C     WEMFOR        IFEQ      '1'
049210940824     C                   GOTO      ENDC00
049220940928    1C                   ENDIF
049230940824     C***
049240940822     C*** TIPO SERVIZIO ***
049250940824     C                   MOVEL     V0CTSP        WTSP
049260940824     C                   EXSR      CTRTSP
049270940824     C                   MOVEL     WTSP          V0CTSP
049280940928    1C     WEMFOR        IFEQ      '1'
049290940824     C                   GOTO      ENDC00
049300940928    1C                   ENDIF
049310940824     C***
049320940822     C*** CODICE TRATTAMENTO MERCE ***
049330940928     C* CONTROLLO SOLO SE IMMESSO
049340950504    1C     V0CCTM        IFNE      *BLANKS
049350940824     C                   MOVEL     V0CCTM        WCTM
049360940824     C                   EXSR      CTRCTM
049370940824     C                   MOVEL     WCTM          V0CCTM
049380950504    2C     WEMFOR        IFEQ      '1'
049390940824     C                   GOTO      ENDC00
049400950504    2C                   ENDIF
049410040611     c                   ENDIF
049420040611     c*** TIPO MERCE V-VALORE
049430040611     c     v0cbva        ifne      *blanks
049440040611     c     v0cctm        ifne      *blanks
049450040611     c     §1bfg8        andeq     'N'
049460040611     c                   Eval      *In90 = *On
049470040611     c                   Eval      VidMsg = Err(281)
049480040611     c                   z-add     21            H0riga
049490040611     c                   z-add     73            H0colo
049500040611     c                   GoTo      EndC00
049510040611     c                   endif
049520040611     c                   movel     prri          atrbva
049530040611     c                   endif
049540040611     C* PERSONALIZZAZIONE CTM
049550040611    1C     V0CCTM        IFNE      *BLANKS
049560950504     C                   SETON                                        26
049570950504     C                   MOVEL     TBLUNI        V1DCTM
049580940928    1C                   ENDIF
049590940822     C*
049600940822     C*** CODICE CLIENTE ***
049610940928    1C     V0CCCM        IFNE      0
049620940824     C     V0CRSM        ORNE      *BLANKS
049630940824     C*
049640940825     C                   MOVEL     V0CFTM        WFTM
049650940915     C                   Z-ADD     V0CCCM        WCCM
049660940928    2C     V0CFLC        IFNE      0
049670940915     C                   Z-ADD     V0CFLC        WFLC
049680940921     C                   ELSE
049690940921     C                   Z-ADD     V0CLNP        WFLC
049700940928    2C                   ENDIF
049710940920     C                   MOVEL(P)  V0CRSM        PAXDMT
049720050120     C                   CLEAR                   VIDDMT
049730950127     C*
049740940824     C                   EXSR      CTRCCM
049750950127     C*
049760940915     C                   MOVE      WCCM          V0CCCM
049770941011     C     *IN14         IFEQ      *ON
049780941011     C                   MOVEL     WFLC          V0CFLC
049790941011     C                   ENDIF
049800941011     C*
049810940928    2C     WEMFOR        IFEQ      '1'
049820940824     C                   GOTO      ENDC00
049830940928    2C                   ENDIF
049840950303     C*
049850950303   X1C                   ELSE
049860940825     C*
049870940825     C* SE CLIENTE A 0 NON IMMETTERE NEMMENO IL MITTENTE PER ESTESO
049880940928    2C     V0DMIT        IFNE      *BLANKS
049890940825     C                   MOVEL     ERR(25)       VIDMSG
049900940920     C                   SETON                                        5090
049910940825     C                   GOTO      ENDC00
049920940928    2C                   ENDIF
049930940928    1C                   ENDIF
049940940825     C***
049950940822     C*** CODICE TARIFFA MITTENTE ***
049960940825     C     V0CFTM        IFEQ      'S'
049970940822     C* SE IMMESSO DEVE ESISTERE IL CODICE MITTENTE
049980940822     C     V0CCCM        IFEQ      *ZEROS
049990940822     C                   MOVEL     ERR(24)       VIDMSG
050000940920     C                   SETON                                        5090
050010940822     C                   GOTO      ENDC00
050020940822     C                   END
050030940822     C* PERSONALIZZAZIONE
050040940822     C                   SETON                                        28
050050940822     C                   END
050060940825     C***
050070940825     C*** MITTENTE ****
050080940822     C* SOLO SE 8888 O 9999 O NON IMMESSO CLIENTE POSSO INDICARE IL MIT
050090950303    0C     V0DMIT        IFNE      *BLANKS
050100950303     C*
050110940909    1C     WCCM          IFEQ      8888
050120940909     C     WCCM          OREQ      9999
050130950303     C*
050140970703     C                   MOVEL     V0CRSM        I14RSC
050150970703     C                   CLEAR                   I14RS2
050160970703     C                   MOVEL     V0CINM        I14IND
050170970703     C                   MOVEL     V0CLOM        E14LOC
050180970703     C                   MOVEL     V0CPIM        E14PIP
050190970703     C                   MOVEL     V0CPRM        E14PRV
050200970703     C                   MOVEL     V0CNZM        E14NAR
050210970703     C                   MOVEL     V0CCAM        E14CAP
050220970704     C                   MOVEL     'M'           WCLI
050230061109     C                   MOVEL     v0ccdf        Wcdf
050240071022     C                   MOVEL     v0cpim        Wiva
050250970704     C                   EXSR      CTRIND
050260941020     C*
050270941020     C* CAMPI CHE POSSO AVER IMPOSTATO
050280970703     C                   MOVEL     E14LOC        V0CLOM
050290970703     C                   MOVEL     E14PIP        V0CPIM
050300970703     C                   MOVEL     E14PRV        V0CPRM
050310970703     C                   MOVEL     E14NAR        V0CNZM
050320970703     C                   MOVEL     E14CAP        V0CCAM
050330970704     C*
050340061109     c* Se errore sulla partita iva , visualizzo messaggio
050350061109     c                   if        xcfivaflg < *zeros
050360120503     c*****              if        wiva=*blanks and dateu>=§vpopiv
050370120504     c                   if        wcdf=*blanks or %subst(wcdf:12:1)=' '
050380071023     c                   z-add     16            H0riga
050390071022     c                   else
050400071023     c                   z-add     17            H0riga
050410071022     c                   endif
050420061109     c                   z-add     64            H0colo
050430061109     c                   endif
050440061109     c
050450970704     C     WEMFOR        IFEQ      '1'
050460970704     C     *IN90         OREQ      *ON
050470970704     C                   GOTO      ENDC00
050480970704     C                   ENDIF
050490040917     c* Segnalazione se inserito mittente estero
050500040917     c     wmitie        ifeq      'E'
050510040917     c     wcontmit      andeq     *blanks
050520040917     c                   movel     '1'           wcontmit
050530040917     c                   seton                                        90
050540040917     c                   z-add     16            h0riga
050550040917     c                   z-add     49            h0colo
050560040917     c                   movel     ERR(283)      vidmsg
050570040917     c                   goto      endc00
050580040917     c                   endif
050590941020     C**
050600950303     C                   SETON                                        1902
050610941110     C                   MOVEL     V0CRSM        VIDDMT
050620940930     C*
050630940930     C                   ELSE
050640940930     C*
050650940930     C* SE NON IMNMESSO CLIENTE O E' UN CODIFICATO PULISCO IL CAMPO
050660940930     C*  DEL CONTROLLO CAP VARIATO
050670940930     C                   CLEAR                   VARCAM
050680940930     C                   CLEAR                   OTT
050690940930    1C                   ENDIF
050700950303    0C                   ENDIF
050710930329     C*
050720930329     C**** CODICE TARIFFA ****
050730941107    1C     V0CCTR        IFNE      *BLANKS
050740050920     C                   CLEAR                   fnlv59ds
050750050920     C                   MOVEL     'S'           ilv59cfo
050760050920     C                   MOVEL     V0CCTR        ilv59ctr
050770050920     C                   CALL      'FNLV59R'
050780050920     C                   PARM                    fnlv59ds
050790941107     C* ERRORE
050800050920    2C     olv59msg      IFNE      *BLANKS
050810050920     C                   MOVEL     olv59msg      VIDMSG
050820941107     C                   SETON                                        9058
050830941107     C                   MOVEL     '1'           WEMFOR
050840941107     C                   GOTO      ENDC00
050850941107    2C                   ENDIF
050860940819     C*
050870050921     C                   MOVEL     olv59dfs      DEFCTR
050880930329     C                   SETON                                        29
050890941107    1C                   ENDIF
050900941103     C*
050910941103     C*** MITTENTE ORIGINALE ***
050920941110     C     V0CRMO        IFNE      *BLANKS
050930941110     C     V0CCMO        ORNE      *BLANKS
050940941103     C                   MOVEL     V0CRMO        WRMO
050950941103     C                   MOVEL     V0CCMO        WCMO
050960941103     C                   MOVEL     V0CNMO        WNAR
050970941103     C                   EXSR      CTRMO
050980941103     C                   MOVEL     WNAR          V0CNMO
050990941103     C     WEMFOR        IFEQ      '1'
051000941103     C                   GOTO      ENDC00
051010941103     C                   ENDIF
051020941110     C                   ENDIF
051030030415      * I dati relativi alla consegna richiesta
051040030411      * possono essere immessi solo se è stato inserito il codice cliente
051050030411      * mittente (no 8888/9999)
051060030411     c                   If        (V0cCcm = *Zeros or
051070030411     c                              V0cCcm = 8888   or  V0cCcm = 9999)   and
051080030411     c                             (V0cTcr <> *Blanks or V0cDcr > *Zeros or
051090030411     c                              V0cHcr >  *Zeros  or V0cMcr > *Zeros or
051100030411     c                              V0cOre >  *Zeros)
051110030411     c                   Eval      *In50 = *On
051120030411     c                   Eval      *In90 = *On
051130030411     c                   Eval      VidMsg = Err(18)
051140030416     c                   GoTo      EndC00
051150030411     c                   EndIf
051160960319     C***
051170930329     C*** CONSEGNA RICHIESTA ***
051180940913     C                   MOVEL     V0CDCR        WDCR
051190940913     C                   MOVEL     V0CHCR        WHCR
051200940913     C                   MOVEL     V0CMCR        WMCR
051210940913     C                   MOVEL     V0CTCR        WTCR
051220940913     C                   EXSR      CTRCR
051230940916     C                   MOVEL     WDCR          V0CDCR
051240940913     C   90              GOTO      ENDC00
051250030410      * o data consegna richiesta o n. ore
051260030409     c                   If        V0cOre > *Zeros
051270030411     c                   If        V0cTcr <> *Blanks
051280030411     c                   Movel     Rimm          At0Tcr
051290030411     c                   Eval      *In90 = *On
051300030411     c                   Eval      VidMsg = Err(276)
051310030411     c                   z-add     21            H0riga
051320030411     c                   z-add     14            H0colo
051330030411     c                   GoTo      EndC00
051340030411     c                   EndIf
051350030409     c                   If        V0cDcr > *Zeros
051360030409     c                   Eval      *In59 = *On
051370030409     c                   Eval      *In90 = *On
051380030409     c                   Eval      VidMsg = Err(276)
051390030409     c                   GoTo      EndC00
051400030409     c                   EndIf
051410030411     c                   If        V0cHcr > *Zeros or V0cMcr > *Zeros
051420030411     c                   Eval      *In60 = *On
051430030411     c                   Eval      *In90 = *On
051440030411     c                   Eval      VidMsg = Err(276)
051450030411     c                   GoTo      EndC00
051460030411     c                   EndIf
051470030415      * Si possono immettere solo 24 48 72 ore
051480030415     c                   If        V0cOre <> 24 and V0cOre <> 48 and
051490030415     c                             V0cOre <> 72
051500030415     c                   Movel     Rimm          At0Ore
051510030415     c                   Eval      *In90 = *On
051520030415     c                   Eval      VidMsg = Err(278)
051530030415     c                   z-add     23            H0riga
051540030415     c                   z-add     31            H0colo
051550030415     c                   GoTo      EndC00
051560030415     c                   EndIf
051570030409     c                   Eval      wflagore = '1'
051580030411     c                   Eval      *In17 = *On
051590030411     c                   Eval      *In16 = *On
051600030411     c                   Eval      *In23 = *On
051610030409     c                   EndIf
051620960319     C***
051630960319     C*** GIORNI DI CHIUSURA ***
051640960319     C                   MOVEL     V0CGC1        WGC1
051650960319     C                   MOVEL     V0CGC2        WGC2
051660960319     C                   EXSR      CTRGCH
051670960319     C   90              GOTO      ENDC00
051680930413     C*** NATURA MERCE ***
051690950112     C     V0CNAS        IFNE      *BLANKS
051700940825     C                   SETON                                        27
051710930329     C                   END
051720940824     C*
051730940824     C     ENDC00        TAG
051740940824     C   90              MOVEL     '1'           WEMFOR
051750940824     C                   ENDSR
051760940922     C*
051770940922     C* CALL AL PGM DI RICERCA TABELLE X§TABER -----------------------*
051780940922     C     CX§TAB        BEGSR
051790990915     C                   CLEAR                   §KEY
051800940922     C                   CALL      'X§TABER'
051810940922     C                   PARM                    CODUT
051820940922     C                   PARM                    COD
051830940922     C                   PARM                    §KEY
051840940922     C                   PARM                    §DES             25
051850940922     C                   MOVEL     '1'           WEMFOR
051860940922     C                   ENDSR
051870940916     C*
051880940916     C* CONTROLLO DATA SPEDIZIONE ------------------------------------*
051890940916     C     CTRDSP        BEGSR
051900940916     C*
051910940916     C                   Z-ADD     VIDDSP        G02DAT
051920940916     C                   MOVEL     *BLANK        G02ERR
051930940916     C                   CALL      'XSRDA8'
051940940916     C                   PARM                    WLBDAT
051950940916     C* ERRATA
051960940916    1C     G02ERR        IFEQ      '1'
051970940920     C                   SETON                                        41  90
051980950920     C* PREPARO L'ERRORE
051990950920     C                   MOVEA     ERR(2)        K78
052000950920     C     2             SUBST     DATAPG:1      W002A
052010950920     C                   MOVEA     W002A         K78(69)
052020950920     C                   MOVEL     '/'           K78(71)
052030950920     C     2             SUBST     DATAPG:3      W002A
052040950920     C                   MOVEA     W002A         K78(72)
052050950920     C                   MOVEL     '/'           K78(74)
052060950920     C     2             SUBST     DATAPG:7      W002A
052070950920     C                   MOVEA     W002A         K78(75)
052080950920     C                   MOVEA     K78           VIDMSG
052090940916    1C                   ENDIF
052100940916     C*
052110940916     C* REIMPOSTO LA DATA SPEDIZIONEGGMMAA PRENDENDO L'ANNO A 4 SE NON
052120940916     C*  IMMESSO DA VIDEO
052130940916    1C     *IN90         IFEQ      *OFF
052140940928     C                   Z-ADD     G02DAT        VIDDSP
052150940916     C*
052160940916     C* IM MANUT O DISK NON SI PUO' CAMBIARE L'ANNO DI SPEDIZIONE
052170940916     C                   MOVE      VIDDSP        WAAS
052180940916    2C   12WAAS          IFNE      §LPAAS
052190940920     C                   SETON                                        4190
052200940916     C                   MOVEL     ERR(3)        VIDMSG
052210940916    2C                   ENDIF
052220940916    1C                   ENDIF
052230001121      *
052240001124      * SE SONO IN MANUTENZIONE DI UN PREPAGATO NON POSSO METTERE IN
052250001124      * SOSPENSIONE LA BOLLA SE CAMBIO MESE
052260001121    1C   22*IN90         IFEQ      *OFF
052270001124     C     PARTCH        ANDNE     'P'
052280010307     C     §LPFPR        ANDNE     'O'
052290001121     C                   MOVEL     BLPAAS        W0080             8 0
052300001121     C                   MOVE      BLPMGS        W0080
052310001121     C                   MOVEL     W0080         W0060             6 0
052320001121     C                   MOVEL     G02INV        W0060S            6 0
052330001121     C     W0060         IFLT      W0060S
052340001121     C                   SETON                                        4190
052350001121     C                   MOVEL     ERR(193)      VIDMSG
052360001121     C                   ENDIF
052370121017     c* Errore se data compresa nel range dal/al per blocco immissione
052380121017     c* prepagati (tabella "DGD")
052390121017     c***                if        *in90 = '0' and g02inv = §vpodip
052400121017     c                   if        *in90 = '0' and
052410121017     c                             g02inv>=§dgdbpd and g02inv<=§dgdbpa
052420050215     c                   Eval      VidMsg = 'Data non ammessa per spedizioni +
052430050215     c                             in Porto Prepagato'
052440050215     c                   seton                                        4190
052450050215     c                   endif
052460001121     C                   ENDIF
052470940916     C*
052480940916    1C     *IN90         IFEQ      *OFF
052490940916     C                   Z-ADD     G02INV        BLPDSP            8 0
052500950920     C* DATE SPEDIZIONE NO > DATA MAX DI SOSPENSIONE
052510950920    2C     BLPDSP        IFGT      DATAPA
052520940920     C                   SETON                                        4190
052530950920     C                   MOVEA     ERR(2)        K78
052540950920     C     2             SUBST     DATAPG:1      W002A
052550950920     C                   MOVEA     W002A         K78(69)
052560950920     C                   MOVEL     '/'           K78(71)
052570950920     C     2             SUBST     DATAPG:3      W002A
052580950920     C                   MOVEA     W002A         K78(72)
052590950920     C                   MOVEL     '/'           K78(74)
052600950921     C     2             SUBST     DATAPG:7      W002A
052610950920     C                   MOVEA     W002A         K78(75)
052620950920     C                   MOVEA     K78           VIDMSG
052630940916    2C                   ENDIF
052640940916    1C                   ENDIF
052650940916     C* PERSONALIZZAZIONE
052660940916    1C  N90WPERSO        IFEQ      'P'
052670940928     C     BLPDSP        ANDNE     DATEU
052680940916     C                   SETON                                        24
052690940916    1C                   ENDIF
052700940916     C*
052710940916     C                   ENDSR
052720940916     C*
052730970704     C* CONTROLLO INDIRIZZO COMPLETO MITT/DESTIN ---------------------*
052740970704     C     CTRIND        BEGSR
052750970710     C* LE DS SONO DA CLEARARE PRIMA ALTRIMENTI DANNO PROBLEMI IN CTRER
052760970710     C                   CLEAR                   DSLV13
052770970710     C                   CLEAR                   DSSI95
052780060922     C                   CLEAR                   tisi97ds
052790061109     c                   clear                   xcfivads
052800970710     C*
052810970704     C                   CLEAR                   I14ISO
052820970714     C                   MOVEL     BLPDSP        I14DRI
052830020205     c                   movel     'S'           i14cnz
052840100115     c                   movel     'S'           i14forzait
052850080414     c***                clear                   ds15x
052860970704     C                   CALL      'FNLV14R'
052870970707     C                   PARM                    KPJBA
052880970707     C                   PARM                    DSLV14
052890080414     C***                PARM                    ds15x
052900970707     C*
052910970707     C                   MOVEL     O14ERR        WERR              1
052920970707     C                   MOVEL     O14MSG        VIDMSG
052930970707     C                   EXSR      CTRERR
052940970707     C**
052950970707     C     WEMFOR        IFEQ      '1'
052960970707     C                   GOTO      ENDIND
052970970707     C                   ENDIF
052980061109     c
052990061109     c* Se immesso controllo il codice fiscale
053000061109     c                   if        wcdf<>*blanks
053010061109     c                   clear                   xcfivamod
053020061109     c                   eval      xcfivapar = wcdf
053030061109     c                   eval      xcfivanar = e14nar
053040061109     c                   eval      xcfivaprv = e14prv
053050061109     c                   call      'XCFIVAR'
053060061109     c                   parm                    xcfivads
053070080904     c                   parm                    forzaIta          1
053080080904     c                   parm                    wiva
053090061109     c*
053100061109     c                   if        xcfivaflg < *zeros
053110080904     c                   movel     xcfivamsg     vidmsg
053120061109     c                   seton                                        2890
053130061109     C                   GOTO      ENDIND
053140061109     c                   endif
053150061109     c                   endif
053160061109     c
053170061109     c* MITTENTE: COD FISCALE OBBLIGATORIO FORZABILE, SE prepagato 8888
053180071022     c*  22              if        Wcli='M' and wccm=8888  and
053190071022     c*                            wcdf=*blanks  and e14nar=*blanks
053200120503     c*  22              if        Wcli='M' and wccm=8888
053210120503     c*                            and e14nar=*blanks and (wcdf=*blanks
053220120503     c*                            or (wiva=*blanks and dateu>=§vpopiv))
053230120508     c* MITTENTE: PREPAGATO
053240120508    1c   22              if        Wcli='M' and e14nar=*blanks
053250120508     c* P.iva $$ sempre errore
053260120508    2c                   if        %scan('$$':wiva) >0
053270120508     c                   movel     err(345)      vidmsg
053280120508     c                   seton                                        702890
053290120508     C                   GOTO      ENDIND
053300120508    2c                   endif
053310120508     c* Prepagato 8888
053320120508   1ac                   if        wccm=8888
053330120503     c* errore forzabile: Codice fiscale o Partita iva
053340120504    2c                   if        wcdf=*blanks   and wiva=*blanks
053350120503     c* errore forzabile: se inserito codice fiscale lungo 11 inserire anche la
053360120503     c*                   P.IVA
053370120503     c                             or (wcdf<>*blanks and %subst(wcdf:12:1)=' '
053380120503     c                                 and wiva=*blanks)
053390061109     c* Se cambiato mittente ricontrollo
053400120504    3c                   if        i14rsc<>savrsm
053410120503     c                   clear                   forzcdf           1
053420120504     c                   clear                   forzcdf1          1
053430120503     c                   movel     i14rsc        savrsm
053440120504    3c                   endif
053450061109     c*
053460130131     c* 31/01/2013: Errori non più forzabili ma sempre bloccanti
053470120504    3c                   select
053480130131     c****               when      forzcdf=' ' and wcdf=*blanks
053490130131     c                   when      wcdf=*blanks
053500120503     c                   movel     err(343)      vidmsg
053510120504     c                   movel     '1'           forzcdf
053520120504     c                   z-add     -1            xcfivaflg
053530120504     c                   seton                                        2890
053540120504     C                   GOTO      ENDIND
053550130131     c****               when      forzcdf1=' ' and wcdf<>*blanks
053560130131     c                   when      wcdf<>*blanks
053570120503     c                   movel     err(344)      vidmsg
053580120504     c                   movel     '1'           forzcdf1
053590120503     c                   z-add     -1            xcfivaflg
053600120503     c                   seton                                        2890
053610120503     C                   GOTO      ENDIND
053620120504    3c                   endsl
053630120504    2c                   endif
053640120508   1ac                   endif
053650120504    1c                   endif
053660061109     c
053670020207     c* DESTINATARIO
053680020207     c     WCLI          ifeq      'D'
053690020207     C* SE IMMESSA LINEA DI ARRIVO PER DPD DEVE ESSERE UNA LINEA
053700020207     C* DPD    -   STESSA COSA PER FED-EX
053710020207     C     VIDDPD        IFEQ      'D'
053720051028     C**   O14IE         ANDEQ     'E'
053730020207     C     COMLNA        andgt     0
053740020207     C     COMLNA        ANDNE     O14LAD
053750020319     C     A_§OGNTW      ANDNE     'DPD'
053760020207     C     VIDDPD        oreq      'F'
053770051028     C**   O14IE         ANDEQ     'E'
053780020207     C     COMLNA        andgt     0
053790020207     C     COMLNA        ANDNE     O14LAF
053800020213     C     A_§OGNTW      ANDNE     'FED'
053810020207     C*
053820020207     C                   MOVEa     ERR(183)      k78
053830020207     C                   SETON                                        4790
053840020207     c     viddpd        ifeq      'D'
053850020207     c                   eval      w005a = 'DPD  '
053860020207     c                   else
053870020207     c                   eval      w005a = 'FedEx'
053880020207     c                   endif
053890020214     c                   movea     w005a         k78(66)
053900020207     C                   MOVEA     K78           VIDMSG
053910020211     C                   GOTO      ENDind
053920020207     c*
053930020207     C                   ENDIF
053940020207     c*
053950020207     c                   select
053960020207     C* SE LNA DPD =000 NON C'E' IL SERVIZIO
053970020207     c     viddpd        wheneq    'D'
053980020207     C     o14lad        andle     *ZEROS
053990020213     c     comlna        andeq     *zeros
054000020319     c     A_§ogNTW      oreq      'DPD'
054010020207     c     o14lad        andle     *zeros
054020060921     c* se però c'e' reso non do errore
054030060921     c                   if        o14red=' ' or
054040060921     c                             (o14red='S' and vidfbr<>'S')
054050020207     C                   MOVEL     ERR(192)      VIDMSG
054060020207     C                   SETON                                        90
054070020207     c     viddpd        ifeq      'D'
054080020207     c                   z-add     21            h1riga
054090020207     c                   z-add     10            h1colo
054100020207     c                   else
054110020207     C                   SETON                                        47
054120020207     c                   endif
054130020207     C                   GOTO      ENDind
054140060921     c                   endif
054150060921     c
054160020207     C* SE LNA FEDEX=000 NON C'E' IL SERVIZIO
054170020207     c     viddpd        wheneq    'F'
054180020207     C     o14laf        andle     *ZEROS
054190020213     c     comlna        andeq     *zeros
054200020213     c     A_§ogntw      oreq      'FED'
054210020207     C     o14laf        andle     *ZEROS
054220020207     C                   MOVEL     ERR(244)      VIDMSG
054230020207     C                   SETON                                          90
054240020207     c     viddpd        ifeq      'F'
054250020207     c                   z-add     21            h1riga
054260020207     c                   z-add     10            h1colo
054270020207     c                   else
054280020207     c                   seton                                        47
054290020207     c                   endif
054300020207     C                   GOTO      ENDind
054310020207     c* se flag EuroExpress = blank non c'è il servizio
054320020207     c     viddpd        wheneq    ' '
054330020207     c     o14ie         andeq     'E'
054340020207     c     o14eex        andeq     *blanks
054350020213     c     comlna        andeq     *zeros
054360020213     c     A_§ogntw      oreq      'EEX'
054370020207     c     o14eex        andeq     *blanks
054380020214     C                   MOVEL     ERR(247)      VIDMSG
054390020207     C                   SETON                                          90
054400020213     c     A_§ogntw      ifeq      'EEX'
054410020212     c     *in12         oreq      *on
054420020212     c     *in15         andeq     *off
054430020207     c                   seton                                        47
054440020207     c                   else
054450020207     c                   z-add     21            h1riga
054460020207     c                   z-add     10            h1colo
054470020207     c                   endif
054480020207     C                   GOTO      ENDind
054490020207     c                   endsl
054500020207     c                   endif
054510970707     C*************
054520020214     C* CONTROLLO CAP -
054530970707     C                   MOVEL     '7'           I95TCN
054540970707     C                   MOVEL     E14CAP        I95CAP
054550970707     C                   MOVEL     E14LOC        I95LOC
054560970707     C                   MOVEL     E14PRV        I95PRV
054570970707     C                   MOVEL     E14NAR        I95NAR
054580970714     C                   MOVEL     BLPDSP        I95DAT
054590971201     C     §3AFCA        IFNE      0
054600971201     C                   MOVEL     'S'           I95FCA
054610971201     C                   ENDIF
054620971201     C                   MOVEL     FLGTB1        I95TPO
054630970707     C                   MOVEL     'S'           I13AF0
054640061122     c* per disk "B" non deve controllare la congruenza della località
054650061122     c* con il cap anche quando quest'ultimo ha eccezioni
054660061122     c                   if        wcli='D' and §1bfg6='C'
054670061122     c                             and §1bfg2='S'
054680061122     C                   clear                   I13AF1
054690061122     c                   else
054700970707     C                   MOVEL     'S'           I13AF1
054710061122     c                   endif
054720061122     c
054730970707     C                   MOVEL     'S'           I13SZ2
054740000704     C* CAP CON VIARIO: NON CONTROLLO PER DISK B POSTE
054750000704     C     §1BFG6        IFNE      'C'
054760000704     C     §1BFG2        ORNE      'S'
054770020319     C     §ogntw        ORNE      'PPT'
054780970707     C                   MOVEL     'S'           I13CNV
054790000704     C                   ENDIF
054800970707     C                   MOVEL     'S'           I13SZV
054810991213     C* PER LNP DPD, CONTROLLO CONGRUENZA LOCALITA' CAP E PROVINCIA
054820000314     C*  E NON SOLO CAP E PROVINCIA
054830020319     C     §OGNTW        IFEQ      'DPD'
054840000622     C* CONTROLLO PER TUTTI TRANNE CHE PER DSK "B"
054850000622     C     §1BFG6        ORNE      'C'
054860000622     C     §1BFG2        ORNE      'S'
054870000314      * TESTIAMO CONTROLLO SU SPEDIZIONI DI VERONA 15/03/00
054880000322      * TESTIAMO CONTROLLO SU SPEDIZIONI DI TREVISO 22/03/00
0548909912139/12 C                   MOVEL     'S'           I13LA3
0549009912139/12 C                   MOVEL     'S'           I13SZ3
054910991213     C                   ENDIF
054920130605     c                   if        §lpccm=0435730 and
054930130605     c                             %subst(knsif: 7: 1)='P'
054940130605     C                   MOVEL     ' '           I13CNV
054950130605     C                   MOVEL     ' '           I13la3
054960130605     C                   ENDIF
054970970707     C**
054980970708     C**  M I T T E N T E
054990970707    1C     WCLI          IFEQ      'M'
055000970707     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO : ERRORE FORZABILE
055010970707    2C     E14CAP        IFNE      VARCAM
055020970707     C                   CLEAR                   OTT
055030970707     C                   CLEAR                   MMA
055040970707     C                   CLEAR                   MMB
055050000622     C                   CLEAR                   MMD
055060970707     C                   MOVEL     E14CAP        VARCAM
055070970707    2C                   ENDIF
055080970707     C** MODIFICA LOCALITA'
055090970707    2C     E14LOC        IFNE      VARLOM
055100970707     C                   MOVEL     E14LOC        VARLOM
055110970707     C                   CLEAR                   MMA
055120970707     C                   CLEAR                   MMB
055130000622     C                   CLEAR                   MMD
055140970707    2C                   ENDIF
055150970708     C**
055160970707     C                   MOVEL     OTT           E13FZV
055170970707     C                   MOVEL     MMA           E13FZ1
055180970707     C                   MOVEL     MMB           E13FZ2
055190000622     C                   MOVEL     MMD           E13FZ3
055200020218     c* se network fedex passo flag apposito per dire di prendere i dati
055210020218     c* dalla tabella della nazione
055220020218     c     §ogntw        ifeq      'FED'
055230020218     c                   movel     'S'           i95fi1
055240020218     c                   endif
055250970708     C**
055260970708     C                   ELSE
055270970708     C**
055280970708     C**  D E S T I N A T A R I O
055290970708     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO
055300970708    2C     E14CAP        IFNE      VARCAD
055310970708     C                   CLEAR                   DIE
055320970708     C                   CLEAR                   SET
055330970708     C                   CLEAR                   AAA
055340970708     C                   CLEAR                   AAB
055350991213     C                   CLEAR                   AAD
055360970708     C*
055370970708     C* SE CAMBIATO MA IN MANUTENZIONE RIMESSO QUELLO DELLA BOLLA  -->
055380970708     C*  COME SE NON FOSSE CAMBIATO NULLA
055390970708    3C     *IN12         IFEQ      *ON
055400970708     C     *IN15         ANDEQ     *OFF
055410970708     C     E14CAP        ANDEQ     BLPCAD
055420970708     C                   CLEAR                   NOV
055430970708     C                   ELSE
055440970708     C                   CLEAR                   QUA
055450100209     C                   CLEAR                   QUAH
055460970708     C                   MOVEL     '1'           NOV
055470970708    3C                   ENDIF
055480970708     C* MEMORIZZO NUOVO CAP
055490970708     C                   MOVEL     E14CAP        VARCAD
055500970708    2C                   ENDIF
055510970708     C* MODIFICA LA LOCALITA'
055520970708    2C     E14LOC        IFNE      VARLOD
055530970708     C                   MOVEL     E14LOC        VARLOD
055540970708     C                   CLEAR                   AAA
055550970708     C                   CLEAR                   AAB
055560991213     C                   CLEAR                   AAD
055570970708    2C                   ENDIF
055580970708     C**
055590970708     C                   MOVEL     SET           E13FZV
055600970708     C                   MOVEL     AAA           E13FZ1
055610970708     C                   MOVEL     AAB           E13FZ2
055620991213     C                   MOVEL     AAD           E13FZ3
055630020212     c* se network fedex passo flag apposito per dire di prendere i dati
055640020212     c* dalla tabella della nazione
055650020213     c     A_§ogntw      ifeq      'FED'
055660020212     c     viddpd        oreq      'F'
055670020218     c     o14ie         andeq     'E'
055680020212     c                   movel     'S'           i95fi1
055690060922     c                   movel     'FED'         i97ntw
055700020212     c                   endif
055710060922     c*
055720060922     c     A_§ogntw      ifeq      'DPD'
055730060922     c     viddpd        oreq      'D'
055740060922     c     o14ie         andeq     'E'
055750060922     c                   movel     'DPD'         i97ntw
055760060922     c                   endif
055770060922     c* se non ancora impostato ed è estero, è euroexpress
055780060922     c                   if        (i97ntw=*blanks and o14ie='E') or
055790060922     c                             (i97ntw=*blanks and A_§ogntw='EEX')
055800060922     c                   movel     'EEX'         i97ntw
055810060922     c                   endif
055820970707    1C                   ENDIF
055830970722     C**
055840970722     C* SE RICHIAMO DALLA CONFERMA BOLLE SENZA FERMARSI SULLA BOLLA
055850970722     C*  IN CASO DI ERRORE NON DO L'INTERROGAZIONE LOCALITA' IN CASO
055860970722     C*  DI RESTITUZIONE AFFIDABILITA'=1
055870970722     C   12
055880970722     CAN 15§LPFPR        IFNE      'V'
055890970722     C     §LPFPR        ANDNE     'X'
055900970722     C                   MOVEL     1             E13FZ1
055910970722     C                   ENDIF
055920970707     C**
055930970707     C** CALL
055940120105     c                   if        §3arbl<>'R'
055950970707     C                   CALL      'FNLV13R'
055960970707     C                   PARM                    KPJBA
055970970707     C                   PARM                    DSLV13
055980970707     C                   PARM                    DSSI95
055990060922     C                   PARM      ' '           flgbac            1
056000060922     C                   PARM                    tisi97ds
056010120105     c                   else
056020120105     C                   CALL      'FNLV13R'
056030120105     C                   PARM                    KPJBA
056040120105     C                   PARM                    DSLV13
056050120105     C                   PARM                    DSSI95
056060120105     C                   PARM      ' '           flgbac            1
056070120105     c                   endif
056080970707     C*
056090970707     C                   MOVEL     O13ERR        WERR              1
056100970707     C                   MOVEL     O13MSG        VIDMSG
056110970707     C                   EXSR      CTRERR
056120970708     C**
056130970707     C* REIMPOSTO LE FORZATURE
056140970708     C     WCLI          IFEQ      'M'
056150970707     C                   MOVEL     E13FZV        OTT
056160970707     C                   MOVEL     E13FZ1        MMA
056170970707     C                   MOVEL     E13FZ2        MMB
056180000622     C                   MOVEL     E13FZ3        MMD
056190970708     C                   ELSE
056200970708     C                   MOVEL     E13FZV        SET
056210970708     C                   MOVEL     E13FZ1        AAA
056220970708     C                   MOVEL     E13FZ2        AAB
056230991213     C                   MOVEL     E13FZ3        AAD
056240970707     C                   ENDIF
056250970708     C**
056260970708     C     WEMFOR        IFEQ      '1'
056270970708     C                   GOTO      ENDIND
056280970708     C                   ENDIF
056290080410     c* PORTI ASSEGNATI
056300080410     c* Se porto assegnato effettuabile solo a fronte di orm commissionato
056310080410     c* da p.o. del network verifico che il p.o. emittente sia quello del
056320080410     c* network
056330080410     c                   clear                   wnocont
056340080411    1c                   if        o97uti='N' and wcli='D'
056350080410     c* Se provengo da manutenzione di bolla di reso lo memorizzo
056360080410     c* per non effettuare il controllo seguente
056370080411    2c     *in12         ifeq      *on
056380080410     c     *in15         andeq     *off
056390080410     c     vidfbr        andeq     'S'
056400080410     c                   move      'N'           wnocont           1
056410080411    2c                   endif
056420080410     c                   movel     o97flo        dcppflo
056430080410     c* ricavo p.o. emittente
056440080411    2c                   if            §cpppas='O' and wnocont=*blanks
056450080410     c                             and i95tpo='A'
056460080410     c* non richiamato da giacenze o ritiri annullati
056470080410     c                             and savfpr<>'P' and savfpr<>'G'
056480080410     c                             and savfpr<>'T'
056490080410     c* orm fittizio oppure orm non commissionato da po del network
056500080411    3c                   if        flgfit='S' or i97ntw<>poentw
056510080411    4c                   if        wperso='P'
056520080410     C                   Z-ADD     05            H0RIGA
056530080410     C                   Z-ADD     20            H0COLO
056540080410     c                   else
056550080410     C                   Z-ADD     06            H1RIGA
056560080410     C                   Z-ADD     20            H1COLO
056570080411    4c                   endif
056580080410     c                   seton                                        90
056590080410     c* preparo il testo del messaggio
056600080410     c                   movel     err(229)      vidmsg
056610080411     C                   CLEAR                   dsbs02
056620080411     c                   clear                   dntw
056630080411     C                   MOVEL     'C'           T02MOD
056640080411     C                   MOVEL     KNSIF         T02SIF
056650080411     C                   MOVEL     'NTW'         T02COD
056660080411     c                   movel(P)  i97ntw        t02ke1
056670080411     C                   CALL      'TIBS02R'
056680080411     C                   PARM                    KPJBA
056690080411     C                   PARM                    dsbs02
056700080411    4C                   IF        T02ERR = *BLANKS
056710080411     C                   MOVEL     T02uni        dntw
056720080411    4C                   ENDIF
056730080411     c                   eval      %subst(vidmsg:14:5)=%subst(§ntwdes:1:5)
056740080411     c                   eval      %subst(vidmsg:71:5)=%subst(§ntwdes:1:5)
056750080410     C                   GOTO      ENDIND
056760080411    3c                   endif
056770080411    2c                   endif
056780080411    1c                   endif
056790090827     c*
056800090921     c* Per destinatario vedo se il tipo servizio prevede un codice tempo
056810090827     c*  consegna obbligato, anche parziale
056820100322     c* Se esiste FNORE --> dico che si può utilizzare
056830100322     c                   if        Wcli='D' and WesORE='N'
056840100322     c                   movel     'S'           wesore
056850100322     c                   endif
056860100322     c
056870100125    1c                   if        vidtsp<>' ' and wcli='D'
056880100322
056890090827     C                   Z-ADD     1             C
056900090827     C     vidtsp        LOOKUP    TSP(C)                                 30
056910090827    2C                   IF        *in30  and TSttc(c)<>*blanks
056920090827     c* controllo posizione per posizione escudendo le "x"
056930090827     c                   eval      Wttc=TSttc(c)
056940090827     c                   eval      WttcCAP=%editc(o95ttc:'X')
056950090827     c                   z-add     1             c
056960090921    3c                   do        5             c
056970090827     c                   if        %subst(wttc:c:1)<>'x'
056980090827     c                             and
056990090827     c                             %subst(wttc:c:1)<>%subst(wttcCAP:c:1)
057000090827     C                   MOVEL     ERR(307)      VIDMSG
057010090827     c                   seton                                        9048
057020090827     C                   MOVEL     '1'           WEMFOR
057030100319     c* Se vengo da ORM --> memorizzo di non considerare FNORE
057040100319     c*  perchè incongruente col CAP
057050100319     c                   if        wesORE='S'
057060100319     c                   movel     'N'           wesore
057070100319     c                   endif
057080100319
057090100319     C                   GOTO      ENDIND
057100090827     c                   endif
057110090921    3c                   enddo
057120090827     c
057130090921    2c                   endif
057140090921     c
057150090921     c* Se fermo deposito non accetto tipo servizio H
057160090921    2c                   if        vidtsp='H'  and vidffd='S'
057170090921     C                   MOVEL     ERR(101)      VIDMSG
057180090921     c                   seton                                        9048
057190090921     C                   MOVEL     '1'           WEMFOR
057200090921     C                   GOTO      ENDIND
057210090921    2c                   endif
057220090921    1c                   endif
057230080410     c
057240000622     C**
057250000622     C* SE SI TATTA DI CAP OBSOLETO, ERRORE NO FORZABILE
057260061010     C***  §1BFG6        IFNE      'C'
057270061010     C***  §1BFG2        ORNE      'S'
057280061010     C***  O95CF1        IFEQ      'O '
057290061010     C***  WCLI          IFEQ      'M'
057300061010     C***                SETON                                        5390
057310061010     C***                ELSE
057320061010     C***                SETON                                        6590
057330061010     C***                ENDIF
057340061010     C***                MOVEL     ERR(201)      VIDMSG
057350061010     C***                MOVEL     '1'           WEMFOR
057360061010     C***                GOTO      ENDIND
057370061010     C***                ENDIF
057380061010     C***                ENDIF
057390970704     C**
057400970704     C* M I T T E N T E
057410970704    1C     WCLI          IFEQ      'M'
057420970704     C                   MOVEL     O14IE         WMITIE            1
057430970704     C                   MOVEL     O14VLT        MITVLT
057440970704     C                   MOVEL     O95ISO        COMFAP
057450970708     C                   MOVEL     O95CTS        MITCTS            2
057460970704     C**
057470970704   X1C                   ELSE
057480970704     C*
057490970704     C                   MOVEL     O14IE         WDESIE            1
057500970704     C                   MOVEL     O14VLT        DESVLT
057510970704     C                   MOVEL     O14EFT        DESEFT
057520000321     C                   MOVEL     O14EFD        DESEFD
057530971215     C                   MOVEL     O14COD        DESCOD
057540000120     C                   MOVEL     O14LAD        DESLAD
057550060920     C                   MOVEL     O14red        DESred
057560020130     C                   MOVEL     O14eff        DESeff
057570020131     C                   MOVEL     O14ffn        DESffn
057580080414     c***                movel     x_§15cex      descaeex
057590080414     c***                movel     x_§15cdp      descadpd
057600080414     c***                movel     x_§15cfe      descafed
057610970704     C                   MOVEL     O95ISO        COMFIN
057620970704     C                   MOVEL     O95GDD        DESGDD            1
057630021118      * Se spedizione export il DDT va sempre impostato a 'N'
057640021118     c                   If        O14ie = 'E'
057650021118     c                   Eval      DesGdd = 'N'
057660021118     c                   EndIf
057670021118      * Mi salvo flag ddt
057680021118     c                   Eval      SavGdd = O95Gdd
057690970704     C   12
057700970704     CAN 15
057710970704     CORN12              MOVEL     O95CTS        SAVCTS            2
057720970704     C*
057730970704     C* MANUTENZIONE RICALCOLO COD TASSAZIONE SOLO SE CAMBIATA PROV
057740990629     C*  NAZIONE E CAP
057750970704     C   12
057760970704     CANN15BLPPRD        IFNE      E14PRV
057770990629     C     BLPNZD        ORNE      E14NAR
057780990629     C     BLPCAD        ORNE      E14CAP
057790030320     c     blpnzd        orne      *Blanks
057800030320     c     e14nar        orne      *Blanks
057810970704     C                   MOVEL     O95CTS        SAVCTS
057820970704     C                   ENDIF
057830970704     C**
057840970704    1C                   ENDIF
057850970704     C*
057860970704     C     ENDIND        ENDSR
057870970707     C*
057880970707     C* CONTROLLO SE C'E' ERRORE-------------------------------------*
057890970707     C     CTRERR        BEGSR
057900970708     C* IMPOSTO CAMPI PASSATI
057910970708     C     O13RON        IFEQ      'S'
057920970708     C                   MOVEL     O95NAR        E14NAR
057930970708     C                   ENDIF
057940970708     C     O13ROC        IFEQ      'S'
057950970708     C                   MOVEL     O95CAP        E14CAP
057960970708     C                   ENDIF
057970970708     C     O13ROP        IFEQ      'S'
057980970708     C                   MOVEL     O95PRV        E14PRV
057990970708     C                   ENDIF
058000970708     C     O13ROL        IFEQ      'S'
058010970708     C                   MOVEL     O95LOC        E14LOC
058020970708     C                   ENDIF
058030970708     C**
058040970707     C* ERRORE O RICERCA CAMPO
058050130606     c                   if        §lpccm=0435730 and
058060130606     c                             %subst(knsif: 7: 1)='P'
058070130606     C                   MOVEL     ' '           werr
058080130606     C                   ENDIF
058090130606     c
058100970707    1C     WERR          IFNE      ' '
058110970707     C*
058120970707    2C     VIDMSG        IFNE      *BLANKS
058130970707     C                   SETON                                        90
058140970707    2C                   ENDIF
058150970707     C* POSIZIONAMENTO CURSORE
058160970707    2C                   SELECT
058170970707    2C     WERR          WHENEQ    '1'
058180970707     C     WERR          OREQ      '2'
058190970707    3C     WCLI          IFEQ      'M'
058200970707     C                   SETON                                        52
058210970707     C                   ELSE
058220970707     C                   SETON                                        64
058230970707    3C                   ENDIF
058240970707    2C     WERR          WHENEQ    '3'
058250970707    3C     WCLI          IFEQ      'M'
058260970707     C                   SETON                                        54
058270970707     C                   ELSE
058280970707     C                   SETON                                        66
058290970707    3C                   ENDIF
058300970707    2C     WERR          WHENEQ    '4'
058310970707    3C     WCLI          IFEQ      'M'
058320970707     C                   SETON                                        55
058330970707     C                   ELSE
058340970707     C                   SETON                                        71
058350970707    3C                   ENDIF
058360970707    2C     WERR          WHENEQ    '5'
058370970707    3C     WCLI          IFEQ      'M'
058380970707     C                   SETON                                        53
058390970707     C                   ELSE
058400970707     C                   SETON                                        65
058410970707    3C                   ENDIF
058420970707    2C     WERR          WHENEQ    '6'
058430970707     C                   SETON                                        68
058440970707    2C     WERR          WHENEQ    '7'
058450970707     C                   SETON                                        70
058460970707    2C     WERR          WHENEQ    '8'
058470970707     C                   SETON                                        10
058480020204     c     werr          wheneq    '0'
058490020204    3C     WCLI          IFEQ      'M'
058500020204     C                   SETON                                        55
058510020204     C                   ELSE
058520020204     C                   SETON                                        71
058530020204    3C                   ENDIF
058540970707    2C                   ENDSL
058550970707     C*
058560970707     C                   MOVEL     '1'           WEMFOR
058570970707    1C                   ENDIF
058580970707    1C                   ENDSR
058590970704     C*
058600940916     C* CONTROLLO DATA RITIRO MERCE ----------------------------------*
058610940916     C     CTRDRT        BEGSR
058620940916     C*
058630940916     C* CONTROLLO SOLO QUANDO VIENE MODIFICATA
058640990610   0AC     PARTCH        IFEQ      'P'
058650990610     C     VIDDRT        ANDGT     0
058660010307     C     §LPFPR        OREQ      'O'
058670010307     C     VIDDRT        ANDGT     0
058680990610     C     PARTCH        ORNE      'P'
058690010307     C     §LPFPR        ANDNE     'O'
058700940916    0C     VIDDRT        IFNE      SAVDRT
058710950215     C     VIDDRT        OREQ      0
058720070808     C* Se O.R.M. fittizio imposto a no display la scritta "DA O.R.M."
058730070808     c                   if        flgfit='S'
058740070808     c                   if        wperso='P'
058750070808     c                   movel     nodi          at0daorm
058760070808     c                   else
058770070808     c                   movel     nodi          atrdaorm
058780070808     c                   endif
058790070808     c                   endif
058800070808     c*
058810070831     c
058820940920     C                   Z-ADD     VIDDRT        G02DAT
058830940916     C                   CLEAR                   G02ERR
058840940916     C                   CALL      'XSRDA8'
058850940916     C                   PARM                    WLBDAT
058860940916     C*
058870070831     c* se in personalizzazione e non immessa data ritiro non è obbligatoria
058880070905     c* se l'orm è fittizio
058890070905     c* non è obbligatoria anche se non immessa la data e non immesso l'ORM
058900071107     c****               if        wperso='P' and dateu>=§vpodrt and
058910071107     c                   if        wperso='P' and
058920070905     c                             viddrt=0 and
058930070905     c                             ((flgfit='S' and widor1>*zeros) or
058940070905     c                             widor1=*zeros)
058950070831     c                   else
058960940916     C* SE ERRATA O MAGGIORE DI WDTGIO ERRORE
058970080109     C* NO < DI xx GIORNI DA OGGI (come da tabella "3I")
058980070904    1C*    G02ERR        IFEQ      '1'
058990070904     C*    G02INV        ORGT      DATEU
059000070904     C*    PARTCH        ANDNE     'P'
059010070904     C*    §LPFPR        ANDNE     'O'
059020070904     C*    G02INV        ORLT      DATAM
059030070904     c                   if        g02err='1' or (g02inv>dateu and
059040070904     c                             partch<>'P' and §lpfpr<>'O')
059050110420     c                             or (g02inv<datamin and not *in22)
059060110420     c                             or (g02inv<datam40 and     *in22)
059070071107     c***                          or (g02inv<datam and (dateu<§vpodrt or
059080080109     c***                          or (g02inv<datamin and (
059090080109     c***                          flgfit='S' or s_drt<>viddrt))
059100940916     C                   MOVEL     ERR(6)        VIDMSG
059110940920     C                   SETON                                        4390
059120080109     c* se errore data ritiro in quanto viene forzata data orm aggiungo
059130080109     c* nel messaggio di verificare l'orm
059140080128     c                   if        g02inv<datamin and flgfit<>'S' and not *in22
059150080109     c                   eval      vidmsg=%trim(vidmsg)
059160080109     c                             + ': verificare l''O.R.M.'
059170080109     c                   endif
059180940916    1C                   ENDIF
059190110422     c* Se prepagato e immessa data più vecchia di datamin
059200110422     c* errore forzabile
059210110422     c                   if        g02inv<datamin and *in22 and wforzadrt=*off
059220110422     C                   MOVEL     ERR(339)      VIDMSG
059230110422     c                   eval      %subst(vidmsg:49:2)=%char(§3iggb)
059240110422     C                   SETON                                        4390
059250110422     c                   eval      wforzadrt=*on
059260110422     c                   endif
059270070831     c                   endif
059280940916     C* OK
059290940916     C  N90              MOVE      G02INV        COMDRT
059300940916     C  N90              MOVE      G02DAT        VIDDRT
059310940916     C*
059320950215     C  N90              MOVEL     VIDDRT        SAVDRT
059330070829     C  N90              MOVEL     VIDDRT        S_DRT
059340940916    0C                   ENDIF
059350990610   0AC                   ENDIF
059360990610     C*
059370990610     C     VIDDRT        IFEQ      0
059380990610     C                   CLEAR                   COMDRT
059390990610     C                   CLEAR                   SAVDRT
059400990610     C                   ENDIF
059410990628     C* PRESTAZIONE MATTINO POMERIGGIO
059420040909     C  N90PARTCH        IFNE      'P'
059430010307     C     §LPFPR        ANDNE     'O'
059440990628     C     VIDFPP        ANDEQ     ' '
059450010503     C     WPERSO        ANDNE     'P'
059460990628     C                   MOVEL     ERR(163)      VIDMSG
059470990628     C                   SETON                                        4090
059480990628    1C                   ENDIF
059490940916     C                   ENDSR
059500940824     C*
059510940824     C* CONTROLLO NAZIONE E P.IVA ------------------------------------*
059520940907     C     CTRNAR        BEGSR
059530940824     C*
059540020211     C                   MOVEL     '15'          COD
059550020211     C                   MOVEL     '15'          CODTAB
059560940824     C* RICERCA
059570940824     C     '?'           SCAN      WNAR                                   30
059580941003    1C     *IN30         IFEQ      *ON
059590020213     c                   call      'TRUL19R'
059600020130     c                   parm                    codtab            2
059610020305     c                   parm      '1'           ordina            1
059620020130     c                   parm                    keytab            8
059630020130     c                   parm                    cmd               1
059640020130     C                   MOVEL     keytab        WNAR
059650940824     C                   GOTO      ENDCNA
059660941003    1C                   ENDIF
059670940824     C* CONTROLLO
059680940920     C                   MOVEL(P)  WNAR          KEY
059690940824     C*
059700940824     C                   EXSR      CTABEL
059710940824     C*
059720941003    1C     *IN30         IFEQ      *ON
059730940824     C                   MOVEL     ERR(28)       VIDMSG
059740940920     C                   SETON                                        6890
059750940824     C                   GOTO      ENDCNA
059760941003    1C                   ENDIF
059770941003     C*
059780941003     C                   MOVEL     TBLUNI        DS15
059790940907     C*
059800940825     C     ENDCNA        TAG
059810940825     C   90              MOVEL     '1'           WEMFOR
059820940825     C                   ENDSR
059830940824     C*
059840940824     C* CONTROLLO LINEA DI PARTENZA ---------------------------------*
059850940824     C     CTRLNP        BEGSR
059860940824     C*
059870940824    1C     SAVLNP        IFNE      WLNP
059880981007     C     BLPDSP        ORNE      SAVDSP
059890000518     C* RICNTROLLO SE BOLLA IMPORT DPD MA INDICATORE RELATIVO SPENTO
059900020319     C     §OGNTW        OREQ      'DPD'
059910000518     C     *IN79         ANDEQ     *OFF
059920940824     C* CONTROLLO CHE SIA GESTIBILE
059930070807     c                   if        simtpp='2' or simtpp=*blanks
059940070807     C     WLNP          LOOKUP    L6                                     30
059950070807     c                   else
059960940824     C     WLNP          LOOKUP    L1                                     30
059970070807     c                   endif
059980940928    2C     *IN30         IFEQ      *OFF
059990940824     C                   MOVEL     ERR(8)        VIDMSG
060000940920     C                   SETON                                        9045
060010940824     C                   GOTO      ENDCLP
060020940928    2C                   ENDIF
060030941230     C*
060040940824     C                   Z-ADD     WLNP          W0030             3 0
060050940824     C     W0030         CHAIN     AZORG01L      UNIORG               30
060060940928    2C     *IN30         IFEQ      *ON
060070940921     C     *IN30         OREQ      *OFF
060080940921     C     ORGFVA        ANDNE     *BLANKS
060090940824     C                   MOVEL     ERR(8)        VIDMSG
060100940920     C                   SETON                                        9045
060110940824     C                   GOTO      ENDCLP
060120940928    2C                   ENDIF
060130971211     C**
060140971211     C* MEMORIZZO IL CAPO SDI E SE E' ESTERO
060150000121     C*
060160991130      * DATI DPD: SE LNP DPD PROTEGGO SEMPRE RMA E SE LA SIGLA OPERATORE
060170991130      *           È UNA DI QUELLE PROTETTE, *IN13 = *ON, ANCHE RMN
060180991117     C                   MOVEL     ORGDE3        OG143
060190020319     C     §OGNTW        COMP      'DPD'                                  79
060200940824     C*
060210940824     C* PRENDO TERMINAL PARTENZA LINEA DI PARTENZA
060220970925     C                   CLEAR                   DSLV55
060230970925     C                   MOVEL     'P'           D55TPT
060240970925     C                   MOVEL     W0030         D55LIN
060250970925     C                   MOVEL     BLPDSP        D55DRF
060260970925     C                   CALL      'FNLV55R'
060270970925     C                   PARM                    DSLV55
060280970925     C     D55ERR        IFEQ      ' '
060290970925     C                   MOVEL     D55TFP        COMTFP            3 0
060300970925     C                   ELSE
060310001024     C                   MOVEL     ERR(211)      VIDMSG
060320001024     C                   SETON                                        9045
060330001024     C                   GOTO      ENDCLP
060340970925     C                   ENDIF
060350940824     C*
060360940824     C* PRENDO COD TRATTAMENTO MERCE DI DFT DELLA LINEA DI PARTENZA
060370940824     C                   MOVEL     '3G'          COD
060380940920     C                   MOVEL(P)  WLNP          KEY
060390940824     C*
060400940824     C                   EXSR      CTABEL
060410940824     C  N30              MOVEL     TBLUNI        COMCTM
060420940824     C   30              MOVEL     '  '          COMCTM
060430940824     C*
060440990610     C* CAMBIATA LNP: CONTROLLO IL CLIENTE ANCHE SE PERSONALIZZATO
060450990610     C                   MOVEL     'S'           WCOCCM            1
060460010219     C* RICHIAMO ROUTINE CHE DETERMINA SE LINEA CON PROC. ORM ATTIVATA
060470010219     C     SAVLNP        IFNE      WLNP
060480010219     C                   Z-ADD     WLNP          WLNPO
060490010219     C                   EXSR      ATTORM
060500011122     C* Se cambiata lnp devo ricordarmi di eseguire il controllo O.R.M.
060510011122     C* anche se è stato personalizzato
060520011122     C     WORM          IFEQ      'S'
060530011122     C                   MOVEL     '1'           WCKORM            1
060540011122     C                   ENDIF
060550010219     C                   ENDIF
060560010219     C                   MOVEL     WLNP          SAVLNP
060570010219     C                   MOVEL     BLPDSP        SAVDSP
060580990610     C                   ENDIF
060590940824     C     ENDCLP        ENDSR
060600940824     C*
060610010212     C* CONTROLLO NUMERO O.R.M. -------------------------------------*
060620010212     C     CTRORM        BEGSR
060630010305     C     §LPFPR        IFEQ      'O'
060640010305     C                   CLEAR                   FLGFIT
060650010305     C                   ENDIF
060660011122     C* SOLO SE NON È STATO PERSONALIZZATO
060670011122     C* DEVO PERO' RICONTROLARE SEMPRE IN CASO DI VARIAZIONE DELLA LINE
060680011122     C* DI PARTENZA
060690010222    0C     *IN37         IFEQ      *OFF
060700010305     C     §LPFPR        ANDNE     'O'
060710011122     C     WCKORM        OREQ      '1'
060720010212     C                   CLEAR                   FLGFIT
060730060522     C                   CLEAR                   w_pogest
060740061124     c                   clear                   wforpf
060750010212     C* ERRORE SE NUMERO ORM = 0
060760010223    1C     WIDOR1        IFEQ      *ZEROS
060770010212     C                   MOVEL     ERR(216)      VIDMSG
060780010212     C                   SETON                                        90
060790010215    2C     WPERSO        IFEQ      'P'
060800040901     C                   Z-ADD     05            H0RIGA
060810040909     C                   Z-ADD     20            H0COLO
060820010213     C                   ELSE
060830040901     C                   Z-ADD     06            H1RIGA
060840040909     C                   Z-ADD     20            H1COLO
060850010215    2C                   ENDIF
060860010212     C                   GOTO      ENDORM
060870010212    1C                   ENDIF
060880010212     C*
060890070620     c* in manutenzione di un prepagato non si può variare il n.orm
060900070620     c                   if        *in12='1' and *in15='0' and *in22
060910070620     c                             and widorm<>s_§b4orm
060920070620     C                   SETON                                        90
060930070620     C                   MOVEL     ERR(312)      VIDMSG
060940070620     C                   SETON                                        90
060950070620    3C     WPERSO        IFEQ      'P'
060960070620     C                   Z-ADD     05            H0RIGA
060970070620     C                   Z-ADD     20            H0COLO
060980070620     C                   ELSE
060990070620     C                   Z-ADD     06            H1RIGA
061000070620     C                   Z-ADD     20            H1COLO
061010070620    3C                   ENDIF
061020070620     C                   GOTO      ENDORM
061030070620     c                   endif
061040040322      * ORM reale
061050040322if  1c                   If        widor1 <> wofit
061060010924     C                   CLEAR                   DORM01
061070010212     C     KORM          CHAIN     FNORM01L                           30
061080010924     C  N30              MOVEL     ORMFLO        DORM01
061090040322     c* se non trovato errore
061100040322    2C     *IN30         IFEQ      *ON
061110010212     C                   MOVEL     ERR(217)      VIDMSG
061120010212     C                   SETON                                        90
061130010215    3C     WPERSO        IFEQ      'P'
061140040901     C                   Z-ADD     05            H0RIGA
061150040909     C                   Z-ADD     20            H0COLO
061160010213     C                   ELSE
061170040901     C                   Z-ADD     06            H1RIGA
061180040909     C                   Z-ADD     20            H1COLO
061190010215    3C                   ENDIF
061200010212     C                   GOTO      ENDORM
061210040322    2C                   ENDIF
061220100319     c
061230100319     c* Verifico se esiste FNORE
061240100319     c*  sempre se cambiato ORM oppure se non c'è la N di IGNORARE
061250100319    2C     WIDORM        IFNE      W01ORM
061260100319     c     wesore        orne      'N'
061270100319     c                   clear                   wesore
061280100319     c                   clear                   DoreGEN
061290100319     C     KORME         CHAIN     FNORE01L                           30
061300100319     c                   if        %found(fnore01l)
061310100319     C                   MOVEL     OReDati       DOReGEN
061320100319     C                   Z-ADD     1             C
061330100319     C     §oretsp       LOOKUP    TSP(C)                                 30
061340100319    4c                   if        *in30 and uts(c)='S'
061350100319     c                   eval      WEsORE='S'
061360100319     c                   endif
061370100319     c                   endif
061380100319     c                   endif
061390040322      * ORM fittizzio
061400040322   x1c                   Else
061410100322     c                   clear                   wesore
061420100322     c                   clear                   DoreGEN
061430040322      * memorizzo
061440010212     C                   MOVEL     'S'           FLGFIT            1
061450011121     C                   CLEAR                   ATRDES
061460100319     C* devo anche pulire i campi del destinatario solo se il
061470011205     C* precedente orm prevedeva la forzatura del destinatario
061480011205     C     SORMFD        IFEQ      'S'
061490011205     C                   CLEAR                   VIDRSD
061500011205     C                   CLEAR                   VIDIND
061510011205     C                   CLEAR                   VIDCAD
061520011205     C                   CLEAR                   VIDLOD
061530011205     C                   CLEAR                   VIDPRD
061540011205     C                   CLEAR                   VIDNZD
061550011205     C                   CLEAR                   SORMFD
061560011205     C                   ENDIF
061570010212    1C                   ENDIF
061580051207     c
061590051207     c                   clear                   vidmsg
061600010212     C* eseguo i seguenti controlli solo se orm non fittizio
061610010215    1C     FLGFIT        IFEQ      *BLANKS
061620010409     C* ERRORE SE O.R.M. ANNULLATO
061630010409    2C     ORMATB        IFNE      *BLANKS
061640010409     C                   MOVEL     ERR(228)      VIDMSG
061650010409   X2C                   ELSE
061660010212     C* ERRORE SE P.O. RITIRO DIVERSO DA LINEA DI PARTENZA BOLLA
061670010409    3C     ORMPOR        IFNE      WOLNP
061680060522     c* verifico se p.o. ritiro gestito dalla lnp bolla
061690060522     c* perchè in tal caso non devo dare errore se p.o. ritiro <> da
061700060522     c* lnp bolla
061710060522     c                   clear                   dslv55
061720060522     c                   eval      d55tpt = '6'
061730060522     c                   z-add     ormpor        d55lin
061740060522     c                   z-add     blpdsp        d55drf
061750060522     c                   call      'FNLV55R'
061760060522     c                   parm                    dslv55
061770060522     c                   if        d55err <> *blanks or d55tfa <> wolnp
061780051207     c* Verifico se si tratta di dati edi trasferiti: in questo caso
061790051206     c*  non do errore
061800051206     c                   clear                   tntb50ds
061810051206     C                   move      VIDCCM        b50ke2
061820051206     C*
061830051206    3C     VIDFLC        IFEQ      0
061840051206     C                   MOVEL     VIDLNP        b50ke2
061850051206     C                   ELSE
061860051206     C                   MOVEL     VIDFLC        b50ke2
061870051206    3C                   ENDIF
061880051206     c
061890051206     c                   movel     b50ke2        b50ke1
061900051207     c* controllo linea e p.o. orm
061910051207     c                   movel     'O'           b50opz
061920051207     c                   movel     ormpor        b50ormreso
061930051206     c                   movel     wolnp         b50poa
061940051206     c                   call      'TNTB51R'
061950051206     c                   parm                    kpjba
061960051206     c                   parm                    tntb50ds
061970051206     c
061980051206     c                   if        b50err<>' '
061990081215     c* po ritiro orm diverso da lnp vanno bene per dpd purchè entrambi
062000081215     c* i network siano dpd
062010081215     c                   clear                   ntwpor
062020081215     c                   if        §ogntw='DPD'
062030081215     C     ORMPOr        CHAIN     AZORG01L      UNIORG
062040081215     C                   MOVEL     OG143         SAV143
062050081215     C                   MOVEL     ORGDE3        OG143
062060081215     c                   movel     §ogntw        ntwpor
062070081215     C                   MOVEL     SAV143        OG143
062080081215     c                   endif
062090081215     c                   if        §ogntw<>'DPD' or ntwpor<>'DPD'
062100010212     C                   MOVEL     ERR(218)      VIDMSG
062110081215     c                   endif
062120010409    3C                   ENDIF
062130060522     c                   else
062140060522     c*se p.o. ritiro gestito da lnp bolla memorizzo
062150060522     c                   z-add     d55tfa        w_pogest
062160060522    3C                   ENDIF
062170051206    3C                   ENDIF
062180070529     c* verifico se p.o. ritiro abilitato allo scarico dei PDA
062190070606     c* cerco la capofila del p.o. ritiro
062200070606     c                   clear                   dslv55
062210070606     c                   z-add     ormpor        d55lin
062220070606     c                   movel     '6'           d55tpt
062230070606     c                   z-add     ormddc        d55drf
062240070606     c                   call      'FNLV55R'
062250070606     c                   parm                    dslv55
062260070606     c     d55tfa        chain     azorg01l      uniorg
062270070529     c                   if        %found(azorg01l)
062280070529     C                   MOVEL     ORGDE8        OG148
062290070529     c                   else
062300070529     c                   clear                   og148
062310070529     c                   endif
062320070529     c                   movel     §ogpdaorm     s_§ogpdaorm
062330070606     c* memorizzo il p.o. gestore del p.o. ritiro per eventuali ricerche su
062340070606     c* tab "PDO"
062350080111     c****               z-add     d55tfa        g_ormpor
062360010409    2C                   ENDIF
062370051206     c
062380051207    2C**   ORMATB        IFNE      *BLANKS
062390051207     C**   ORMPOR        ORNE      WOLNP
062400051207     c* Visto che in un caso p.o. ritiro <> da linea bolla va bene, tes
062410051207     c*  to il campo messaggio
062420051207     c                   if        vidmsg<>*blanks
062430010212     C                   SETON                                        90
062440010215    3C     WPERSO        IFEQ      'P'
062450040901     C                   Z-ADD     05            H0RIGA
062460040909     C                   Z-ADD     20            H0COLO
062470010213     C                   ELSE
062480040901     C                   Z-ADD     06            H1RIGA
062490040909     C                   Z-ADD     20            H1COLO
062500010215    3C                   ENDIF
062510010212     C                   GOTO      ENDORM
062520010215    2C                   ENDIF
062530010216     C* CMD14 - VISUALIZZA ORM
062540010223     C     *INKH         IFEQ      *ON
062550010216     C                   CLEAR                   FIOR07
062560010216     C                   Z-ADD     WOPOE         D07POE
062570010222     C                   Z-ADD     WONSR         D07NSR
062580010222     C                   Z-ADD     WONOR2        D07NOR
062590010216     C                   Z-ADD     WONRV         D07NRV
062600020513     c     simtpp        ifeq      '2'
062610020513     c     simtpp        oreq      *blanks
062620020513     c                   move      simpou        d07fgs
062630010216     C                   ELSE
062640010216     C                   Z-ADD     SIMFEL        D07FGS
062650010216     C                   ENDIF
062660010216     C                   MOVEL     FIOR07        KPJBU
062670010216     C                   CALL      'FIOR07R'
062680010216     C                   PARM                    KPJBA
062690010227     C                   MOVEL     '1'           WEMFOR
062700010216     C                   GOTO      ENDORM
062710010216     C                   ENDIF
062720010214     C* SE NON SONO NEL GIRO DEI PREPAGATI ORMTOR DEVE ESSERE DIVERSO
062730010214     C* DA "P"
062740010215    2C     *IN22         IFEQ      *OFF
062750010214     C     ORMTOR        ANDEQ     'P'
062760010214     C                   MOVEL     ERR(222)      VIDMSG
062770010214     C                   SETON                                        90
062780010215    3C     WPERSO        IFEQ      'P'
062790040901     C                   Z-ADD     05            H0RIGA
062800040909     C                   Z-ADD     20            H0COLO
062810010214     C                   ELSE
062820040901     C                   Z-ADD     06            H1RIGA
062830040909     C                   Z-ADD     20            H1COLO
062840010215    3C                   ENDIF
062850010503     C                   GOTO      ENDORM
062860010215    2C                   ENDIF
062870010214     C* VICEVERSA DEVE ESSERE = "P"
062880010215    2C     *IN22         IFEQ      *ON
062890010214     C     ORMTOR        ANDNE     'P'
062900010214     C                   MOVEL     ERR(223)      VIDMSG
062910010214     C                   SETON                                        90
062920010215    3C     WPERSO        IFEQ      'P'
062930040901     C                   Z-ADD     05            H0RIGA
062940040909     C                   Z-ADD     20            H0COLO
062950010214     C                   ELSE
062960040901     C                   Z-ADD     06            H1RIGA
062970040909     C                   Z-ADD     20            H1COLO
062980010215    3C                   ENDIF
062990010503     C                   GOTO      ENDORM
063000010215    2C                   ENDIF
063010100319     c
063020100319     c* Se presente LINEA DI ARRIVO personalizzata e  <> dall'ORM
063030100319     c*  oppure disk B --> erore bloccante
063040100319    2c                   if         not *in12 or not *in15
063050100319    3c                   if         ormpoc>0
063060100319     c
063070100319    4c                   if        (vidlna>*zeros  and *in20 )
063080100319     c                             or (*in12 and not *in15 and §1bfg6='C')
063090100319     c                   movel     vidlna        w0030
063100100319    5c                   if        w0030<>ormpoc
063110100319     C                   MOVEL     ERR(73)       VIDMSG
063120100319     C                   SETON                                        90
063130100319    6C     WPERSO        IFEQ      'P'
063140100319     C                   Z-ADD     05            H0RIGA
063150100319     C                   Z-ADD     20            H0COLO
063160100319     C                   ELSE
063170100319     C                   Z-ADD     06            H1RIGA
063180100319     C                   Z-ADD     20            H1COLO
063190100319    6C                   ENDIF
063200100319     C                   GOTO      ENDORM
063210100319    5C                   ENDIF
063220100319    4C                   ENDIF
063230100319    3C                   ENDIF
063240100319     c
063250100319     c* Se presente FNORE e TSP personalizzato <> dall'ORM
063260100319     c*  errore bloccante
063270100319    3c                   if        wesORE='S'
063280100319    4c                   if        (vidtsp<>' '    and *in18) or
063290100319     c                             (*in12 and not *in15 and §1bfg6='C')
063300100319
063310100319    5c                   if        vidtsp<>§oretsp
063320100319     C                   MOVEL     ERR(71)       VIDMSG
063330100319     C                   SETON                                        90
063340100319    6C     WPERSO        IFEQ      'P'
063350100319     C                   Z-ADD     05            H0RIGA
063360100319     C                   Z-ADD     20            H0COLO
063370100319     C                   ELSE
063380100319     C                   Z-ADD     06            H1RIGA
063390100319     C                   Z-ADD     20            H1COLO
063400100319    6C                   ENDIF
063410100319     C                   GOTO      ENDORM
063420100319    5C                   ENDIF
063430100319    4C                   ENDIF
063440100319    3C                   ENDIF
063450100319    2C                   ENDIF
063460100319     c
063470030805      * controllo la serie dell'ORM, se inserita deve esistere la key
063480030805      * poe + nrs in tab. 'OSR'
063490130116      * dal 16/01/2013 non è più così
063500130116      * la tabella OSR la leggo per cliente ORDINANTE dell'ORM
063510130116      * controllare solo la serie dell'ORM immessa è inutile
063520130116      * l'importante è che esista l'ORM
063530130117If  2c                   If        wonsr > *Zeros
063540130117      /free
063550130117       //?Non faccio controlli se OK orm RC, l'orm è stato controllato
063560130117       //?prima e se è un ORM con serie i controlli sono già stati fatti
063570130117       //?all'immissione dell'ORM
063580130117       //?qua devo solo recuperare i dati dalla tabella OSR
063590130117       //?la tabella la devo agganciare per cliente ordinante dell'ORM
063600130117       //?(solo i primi 7 caratteri del campo ORMCOR)
063610130117         clear dOSR;
063620130117         wORMcor = %dec(%subst(%editc(ORMcor:'X'):1:7):7:0);
063630130117         osrxx = %lookup(wORMcor:skCLIosr);
063640130117         IF  osrxx > 0;
063650130117         //?aggancio tabella OSR per recupero dati x ORM da tabella
063660130117           clear dsbs02;
063670130117           T02mod = 'C';
063680130117           T02cod = 'OSR';
063690130117           T02ke1 = skLNPNRSosr(osrxx);
063700130117           tibs02r(kpjba:dsbs02);
063710130117           IF  T02err = *blank;
063720130117             dOSR = T02uni;
063730130117           ENDIF;
063740130117         ENDIF;
063750130117      /end-free
063760130117
063770130116     c**!!!              Clear                   dOsr
063780130116     c**!!!              Clear                   dsbs02
063790130116     c**!!!              Clear                   wkosr
063800130116     c**!!!              Eval      T02Mod = 'C'
063810130116     c**!!!              Eval      T02Sif = Knsif
063820130116     c**!!!              Eval      T02Cod = 'OSR'
063830130116     c**!!!              Movel     wopoe         wkosr
063840130116     c**!!!              Move      wonsr         wkosr
063850130116     c**!!!              Movel(p)  wkosr         T02Ke1
063860130116     c**!!!              Call      'TIBS02R'
063870130116     c**!!!              Parm                    Kpjba
063880130116     c**!!!              Parm                    Dsbs02
063890130116If  3c**!!!              If        T02Err <> *Blanks
063900130116If  4C**!!!              If        wperso = 'P'
063910130116     c**!!!              Z-Add     05            H0riga
063920130116     c**!!!              Z-Add     20            H0colo
063930130116   x4c**!!!              Else
063940130116     c**!!!              Z-Add     06            H1riga
063950130116     c**!!!              Z-Add     20            H1colo
063960130116    4c**!!!              EndIf
063970130116     c**!!!              Eval      VidMsg = Err(48)
063980130116     c**!!!              Move      wonsr         w002a
063990130116     c**!!!              Eval      %subst(VidMsg:11:2) = w002a
064000130116     c**!!!              Eval      *In90 = *On
064010130116     c**!!!              GoTo      EndOrm
064020130116    3c**!!!              EndIf
064030130116     c**!!!              Movel     T02Uni        dOsr
064040030805      * se non inserito dall'utente imposto il codice bolla
064050030805If  3C                   If        wperso = 'P'
064060030805If  4c                   If        V0cCbo = *Blanks
064070030805     c                   Eval      V0cCbo = d§OsrCbo
064080030805    4c                   EndIf
064090030805   x3c                   Else
064100030805If  4c                   If        VidCbo = *Blanks
064110030805     c                   Eval      VidCbo = d§OsrCbo
064120030805    4c                   EndIf
064130030805    3c                   EndIf
064140030805    2c                   EndIf
064150010404     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
064160010404     C* ANDRO' A PROPORRE NELLE NOTE
064170050211     C***  ORMPOE        IFNE      ORMPOR
064180050211     C***  'TEL.:'       CAT       ORMTER        W021A            21
064190050211     C***  W021A         CAT(P)    ORMRER:1      WTELRF           70
064200050211     C***                MOVE      WTELRF        WTELR2           35
064210050211     C***                ENDIF
064220010212     C* L'ORM DEVE ESSERE IN UNA FASE BOLLETTABILE
064230010212     c* Errore forzabile
064240010220    2C     ORMFAO        IFNE      PREFAO
064250010220     C                   MOVE      ORMFAO        PREFAO
064260010220     C                   CLEAR                   DSBS02
064270010220     C                   MOVEL     'C'           T02MOD
064280010220     C                   MOVEL     KNSIF         T02SIF
064290010220     C                   MOVEL     'FAR'         T02COD
064300010220     C                   MOVEL     ORMFAO        T02KE1
064310010220      *
064320010220     C                   CALL      'TIBS02R'
064330010220     C                   PARM                    KPJBA
064340010220     C                   PARM                    DSBS02
064350010220    3C     T02ERR        IFEQ      *BLANKS
064360010220     C                   MOVEL     T02UNI        DFAR
064370010220     C                   ELSE
064380010220     C                   CLEAR                   DFAR
064390010220    3C                   ENDIF
064400010220    2C                   ENDIF
064410010620     C* Se fase 999: errore bloccante
064420010620     C     §FARFB        IFEQ      'N'
064430050504     c     §lpfpr        andne     'O'
064440010620     C                   MOVEL     ERR(219)      VIDMSG
064450010620     C                   MOVE      *BLANKS       BLANK            45
064460010620     C                   MOVE      BLANK         VIDMSG
064470010620     C                   SETON                                        90
064480010620    4C     WPERSO        IFEQ      'P'
064490040901     C                   Z-ADD     05            H0RIGA
064500040909     C                   Z-ADD     20            H0COLO
064510010620     C                   ELSE
064520040901     C                   Z-ADD     06            H1RIGA
064530040909     C                   Z-ADD     20            H1COLO
064540010620    4C                   ENDIF
064550010620     C                   GOTO      ENDORM
064560010620     C                   ENDIF
064570010220     C*
064580010215    2C     WIDORM        IFNE      W01ORM
064590010223     C                   CLEAR                   WOVUO
064600070427     C                   CLEAR                   WOVUO1
064610070918     C                   CLEAR                   savdrt
064620010226     C                   MOVEL     'S'           CHGORM            1
064630090327     C                   MOVEL     'S'           CHGORM1           1
064640091120     C                   MOVEL     'S'           CHGORM2           1
064650090327     c                   clear                   w_fcli            1
064660031001     c                   Clear                   wfortbo
064670010215     C* Se sono in manutenzione memorizzo che è cambiato il numero
064680010215     C* O.R.M. (Mi serve nelle routine che propongono i campi da orm
064690010215     C* che se in manutenzione devo proporre solo se modificato n. orm)
064700010215    3C     *IN12         IFEQ      *ON
064710010215     C     *IN15         ANDEQ     *OFF
064720010215     C                   MOVEL     '1'           WORMMD            1
064730010215    3C                   ENDIF
064740010214     C* Quando cambia il numero O.R.M. devo pulire i campi per la forza
064750010214     C* tura usati nella routine di controllo congruenza con campi dell
064760010214     c* O.R.M.
064770090326     C                   CLEAR                   PREDRT
064780010214     C                   CLEAR                   PREPDR
064790010214     C                   CLEAR                   PREFPP
064800010214     C                   CLEAR                   PRECCM
064810010214     C                   CLEAR                   PREFFD
064820010214     C                   CLEAR                   PRECTR
064830010504     C* Pulisco anche campo per forzatura su n. O.R.M.
064840010504     C                   CLEAR                   WFORZO
064850070905     c                   clear                   s_drt
064860070905     c                   if        wperso='P'
064870070905     c                   movel     nodi          at0daorm
064880070905     c                   else
064890070905     c                   movel     nodi          atrdaorm
064900070905     c                   endif
064910011122     C* A cambio numero O.R.M. devo anche reimpostare la lna + FLAG DPD
064920111124     c* e clearo i campi note da orm
064930011122    3C     *IN12         IFEQ      *OFF
064940011122     C     *IN15         OREQ      *OFF
064950111124     c                   clear                   vidno1
064960111124     c                   clear                   vidno2
064970111128     c                   clear                   viddno
064980011122     C                   CLEAR                   VIDDPD
064990070214     c* in manutenzione e lna dpd o fedex non la clearo altrimenti non
065000070214     c* è possibile reinstradarla a dpd/fedex
065010070214    4C     ORMPOC        IFEQ      *ZEROS
065020070214     c                   if        *in12='0' or (savntw<>'DPD' and savntw<>
065030070214     c                             'FED')
065040011122     C                   CLEAR                   VIDLNA
065050070214     c                   endif
065060011122     C* SE LNA PERSONALIZZATA DEVO IMPOSTARE QUESTA
065070011122    5C     *IN20         IFEQ      *ON
065080011122     C                   MOVE      V0CLNA        VIDLNA
065090011122    5C                   ENDIF
065100011122    4C                   ENDIF
065110011122     C* Sempre a cmabio di O.R.M. devo anche pulire i campi del desti-
065120011205     C* natario solo se il precedente orm prevedeva la forzatura del
065130011205     C* destinatario
065140011205     C     SORMFD        IFEQ      'S'
065150011122     C                   CLEAR                   VIDRSD
065160011122     C                   CLEAR                   VIDIND
065170011122     C                   CLEAR                   VIDCAD
065180011122     C                   CLEAR                   VIDLOD
065190011122     C                   CLEAR                   VIDPRD
065200011122     C                   CLEAR                   VIDNZD
065210011205     C                   CLEAR                   SORMFD
065220011205     C                   ENDIF
065230011122    3C                   ENDIF
065240010214     C*
065250011122     C                   MOVE      WIDORM        W01ORM
065260010215    3C     §FARFB        IFNE      'S'
065270050504     c     §lpfpr        andne     'O'
065280010212     C                   MOVEL     ERR(219)      VIDMSG
065290010212     C                   SETON                                        90
065300010215    4C     WPERSO        IFEQ      'P'
065310040901     C                   Z-ADD     05            H0RIGA
065320040909     C                   Z-ADD     20            H0COLO
065330010213     C                   ELSE
065340040901     C                   Z-ADD     06            H1RIGA
065350040909     C                   Z-ADD     20            H1COLO
065360010215    4C                   ENDIF
065370010212     C                   GOTO      ENDORM
065380010215    3C                   ENDIF
065390010212     C*
065400010215    2C                   ENDIF
065410010504     C* IN IMMISSIONE NON E' POSSIILE UTILIZZARE UN O.R.M. LE CUI BOLLE
065420010504     C* VENGONO TRASMESSE CON DISK
065430010504     C* ERRORE FORZABILE CON F20
065440010504    2C     *IN12         IFEQ      *OFF
065450010504     C* MEMORIZZO SE PREMUTO COMANDO PER FORZATURA
065460010504     C     *INKU         IFEQ      *ON
065470010504     C                   MOVEL     '1'           WFORZO            1
065480010504     C                   ENDIF
065490010924    3C     §ORMCB        IFEQ      'S'
065500010504     C     WFORZO        ANDEQ     *BLANKS
065510010504     C                   SETON                                        90
065520010504     C                   MOVEL     ERR(230)      VIDMSG
065530010504    4C     WPERSO        IFEQ      'P'
065540040901     C                   Z-ADD     05            H0RIGA
065550040909     C                   Z-ADD     20            H0COLO
065560010504     C                   ELSE
065570040901     C                   Z-ADD     06            H1RIGA
065580040909     C                   Z-ADD     20            H1COLO
065590010504    4C                   ENDIF
065600010504     C                   GOTO      ENDORM
065610010504    3C                   ENDIF
065620010504    2C                   ENDIF
065630011122     C* Proteggo i campi a video relativi il destinatario se devo forza
065640011122     C* re il destinatario da orm
065650011122     C     §ORMFD        IFEQ      'S'
065660011122     C                   MOVEL     PROT          ATRDES
065670011122     C                   ELSE
065680011122     C                   CLEAR                   ATRDES
065690011122     C                   ENDIF
065700090429
065710090429     c                   clear                   poentw
065720090429     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
065730090429     C                   MOVEL     OG143         SAV143
065740090429     C  N30              MOVEL     ORGDE3        OG143
065750090429     C   30              CLEAR                   OG143
065760090429     c                   eval      poentw=§ogntw
065770090429     C                   MOVEL     SAV143        OG143
065780090429
065790010227     C* SE ORM FITTIZIO E PREMUTO F8 DEVO RIEMETTERE LA VIDEATA
065800010227   X1C                   ELSE
065810040319      * imposto flag se sono in manutenzione ed ho modificato il n. ORM
065820040319if  2c                   If        *In12 and Not *In15 and
065830040319     c                             widorm <> w01orm
065840040319     C                   Eval      wmodorm = *On
065850040319e   2c                   EndIf
065860070829     c* a cambio numero orm devo mettere in ND la scritta
065870070829     c* eventuale "DA O.R.M."
065880070829     c                   if        widorm <> w01orm
065890090327     C                   MOVE      WIDORM        W01ORM
065900090327     C                   MOVEL     'S'           CHGORM1           1
065910091120     C                   MOVEL     'S'           CHGORM2           1
065920090327     c                   clear                   w_fcli
065930070918     c                   clear                   savdrt
065940070829     c                   if        wperso='P'
065950070829     c                   eval      at0daorm=nodi
065960070829     c                   else
065970070829     c                   eval      atrdaorm=nodi
065980070829     c                   endif
065990111124     c                   clear                   vidno1
066000111124     c                   clear                   vidno2
066010111128     c                   clear                   viddno
066020070829     c* solo in immissione: reimposto la data ritiro a udate se l'utente non
066030070829     c* l'ha variata
066040070829     c                   if        *in12='0' and viddrt<>wdtgio and viddrt>0
066050071107     c****                         and viddrt=s_drt  and dateu>=§vpodrt
066060071107     c                             and viddrt=s_drt
066070070831     c                   if        wperso='P'
066080070831     c                   clear                   viddrt
066090070831     c                   eval      s_drt=viddrt
066100070831     c                   else
066110070829     c                   eval      viddrt=wdtgio
066120070829     c                   eval      s_drt=wdtgio
066130070831     c                   endif
066140070829     c                   movel     '1'           wemfor
066150070829     c                   goto      endorm
066160070829     c                   endif
066170070904     c* Per ora non faccio il seguente controllo: se passo da un reale a un
066180070904     c* fittizio l'utente deve stare attento alla data ritiro.
066190070829     c* in manutenzione: se orm sulla bolla 999999 e data ritiro video<>da
066200070829     c* data ritiro bolla rimetto data ritiro bolla
066210070904     c*                  if        *in12 and *in15='0' and viddrt<>s_drtblp
066220070904     c*                  eval      viddrt=s_drtblp
066230070904     c*                  movel     '1'           wemfor
066240070904     c*                  goto      endorm
066250070904     c*                  endif
066260070829     c                   endif
066270040319
066280010227     C   KH              MOVEL     '1'           WEMFOR
066290010227     C   KH              GOTO      ENDORM
066300010215    1C                   ENDIF
066310010222     C* PERSONALIZZAZIONE
066320010222     C     WPERSO        IFEQ      'P'
066330010222     C                   SETON                                        37
066340010222     C                   ENDIF
066350011122     C  N90              CLEAR                   WCKORM
066360011205     C* Mi salvo il contenuto §ormfd per sapere se a cambio di O.R.M.
066370011205     C* devo pulire i dati del destinatario
066380090429     c                   clear                   sormfd
066390090429     c                   if        flgfit<>'S'
066400011205     C                   MOVE      §ORMFD        SORMFD
066410090429     c                   endif
066420010222   X0C                   ELSE
066430010226     C* SE PERSONALIZZATO GESTISCO EVENTUALE CMD08
066440010227     C* CMD8 - VISUALIZZA ORM
066450010223     C     *INKH         IFEQ      *ON
066460010227     C     FLGFIT        IFNE      'S'
066470010222     C                   CLEAR                   FIOR07
066480010222     C                   Z-ADD     WOPOE         D07POE
066490010222     C                   Z-ADD     WONSR         D07NSR
066500010222     C                   Z-ADD     WONOR2        D07NOR
066510010222     C                   Z-ADD     WONRV         D07NRV
066520070627     c     simtpp        ifeq      '2'
066530020513     c     simtpp        oreq      *blanks
066540020513     c                   move      simpou        d07fgs
066550010222     C                   ELSE
066560010222     C                   Z-ADD     SIMFEL        D07FGS
066570010222     C                   ENDIF
066580010222     C                   MOVEL     FIOR07        KPJBU
066590010222     C                   CALL      'FIOR07R'
066600010222     C                   PARM                    KPJBA
066610010226     C                   ENDIF
066620010227     C                   MOVEL     '1'           WEMFOR
066630010222     C                   GOTO      ENDORM
066640010222     C                   ENDIF
066650010222    0C                   ENDIF
066660090327     c* Se era stato impostato cliente/tariffa per tassazione porti assegnati
066670090327     c* verifico se emettere messaggio per avvisare che cambiando l'orm
066680090327     c* i dati verranno automaticamente modificati
066690091120    1c                   if        chgorm1='S' and *in04
066700090327    2c***                if        flgfit<>'S' and ormksc>0
066710090327    2c****                         and wcliksc>0 and atrwksc=*blanks
066720090327    3c***                if        w_fcli=' '
066730090327     c***                movel     '1'           w_fcli
066740090327     C***                MOVEL     ERR(321)      VIDMSG
066750090327     C***                SETON                                        90
066760090327     C***                GOTO      ENDORM
066770090327    3c***                endif
066780090327    2c****               endif
066790090327    2c                   if        (flgfit<>'S' and ormksc>0)
066800090327     c                             or atrwksc<>*blanks
066810090327     c                   exsr      sr_inzwdwcli
066820090327    2c                   endif
066830090327     c                   clear                   chgorm1
066840090327    1c                   endif
066850091120     c* a cambio di orm inzializzo window per scelta beneficiario c/a
066860091120    1c                   if        chgorm2='S'
066870091120     c                   exsr      inzwdwcas
066880091123     c                   clear                   chgorm2
066890091120     c                   endif
066900010212     C     ENDORM        ENDSR
066910010215     C*
066920010214     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA I° VIDEATA) -----------*
066930010215     C     PRPOR1        BEGSR
066940010212     C                   CLEAR                   WEFORM
066950070806     C*
066960070905     C* DATA RITIRO (SOLO SE ORM E' IN UNA FASE valida ai fini della da
066970070905     c* ta ritiro)
066980070905    2C     §LPFPR        ifne      'O'
066990070905     c                   exsr      fordrt
067000070905    2C                   ENDIF
067010111124     c* NOTE in visualizzazione
067020111124     c                   if        (ormno1<> *blanks or ormno2<>*blanks)
067030111124     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
067040120127     c                   movel     ormno1        vidno1
067050120127     c                   movel     ormno2        vidno2
067060120127     c                   movel     'NoteOrm'     viddno
067070120127     C                   MOVEL     '1'           WEFORM
067080111124     c                   endif
067090070806     c*
067100010215    1C     *IN12         IFEQ      *OFF
067110010220     C* In manutenzione propongo solo se variato il numero ORM
067120010215     C     *IN15         OREQ      *OFF
067130010220     C     WORMMD        ANDEQ     '1'
067140010215     C     *IN15         OREQ      *ON
067150010212     C*
067160040901     c*
067170050426     c*****              exsr      PRPOR1bis
067180010215     C*
067190010212     C* ATTENZIONE! SE SONO IN CONFERMA BOLLE DA DISCHETTO I SEGUENTI
067200010212     C* DATI NON LI DEVO PRENDERE DALL'ORM:
067210011121     C* (FANNO ECCEZIONE LE PROPOSTE DEL DESTINATARIO SE §ORMFD='S')
067220010212     C*
067230010212     C* CLIENTE MITTENTE
067240010215    2C     *IN12         IFEQ      *OFF
067250010212     C     *IN15         OREQ      *OFF
067260010215    3C     VIDCCM        IFEQ      *ZEROS
067270031201     c                   Eval      wnoccm = '1'
067280010215    4C     ORMKSC        IFGT      *ZEROS
067290010213     C                   MOVEL     '1'           WEFORM
067300030905      * Propongo il ksc dell'orm se l'ORM preve la bolla in porto franco
067310091020    5c     §OrPfb        Ifne      'A'
067320010212     C                   MOVE      ORMKSC        VIDCCM
067330010212     C                   MOVEL     ORMKSC        W0030             3 0
067340130212     C                   Z-ADD     W0030         VIDFLC
067350010215    6C     W0030         IFNE      VIDLNP
067360130212     C****               Z-ADD     W0030         VIDFLC
067370010302     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
067380010302     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
067390041129     C                   SETON                                        14
067400010215    6C                   ENDIF
067410010215   X5C                   ELSE
067420030905      * Propongo 9999 se l'orm prevede la bolla in porto assegnato
067430010212     C                   Z-ADD     9999          VIDCCM
067440010215    5C                   ENDIF
067450010214     C                   MOVE      VIDCCM        PRECCM
067460010214     C                   MOVEL     VIDFLC        PRECCM
067470010215    5C     VIDFLC        IFEQ      0
067480010214     C                   MOVEL     VIDLNP        PRECCM
067490010215    5C                   ENDIF
067500010215   X4C                   ELSE
067510030905      * se Ksc vuoto e l'orm prevede la bolla in porto franco propongo la
067520010214     C* RAGIONE SOCIALE NEL CAMPO DELLA RICERCA ALFABETICA
067530030905    5c     §OrPfb        Ifne      'A'
067540010215    6C     VIDDMT        IFEQ      *BLANKS
067550010215     C                   MOVEL     ORMRSR        VIDDMT
067560041129     C                   MOVEL     '1'           WEFORM
067570041129     C     VIDDMT        IFNE      *BLANKS
067580041129     C***                SETON                                        0138
067590041129     C                   SETON                                        01
067600041129     C                   ENDIF
067610010215    6C                   ENDIF
067620010328   X5C                   ELSE
067630030905      * se ksc vuoto e l'orm prevede la bolla in porto assegnato
067640030905      * PROPONGO 9999 IN CCM
067650010328     C                   Z-ADD     9999          VIDCCM
067660010328     C                   MOVEL     '1'           WEFORM
067670010215    5C                   ENDIF
067680010215    4C                   ENDIF
067690010215    3C                   ENDIF
067700011121    2C                   ENDIF
067710010212     C* DESTINATARIO (RAG SOC,INDIR....)
067720011121    2C     *IN12         IFEQ      *OFF
067730011121     C     *IN15         OREQ      *OFF
067740011121     C     *IN15         OREQ      *ON
067750011121     C     §ORMFD        ANDEQ     'S'
067760011121     C*
067770010215    3C     ORMTOR        IFEQ      'S'
067780010301     C     §LPFPR        OREQ      'O'
067790010215    4C     VIDRSD        IFEQ      *BLANKS
067800011122     C     ORMRSC        ANDNE     *BLANKS
067810011121     C     §ORMFD        OREQ      'S'
067820011122     C     ORMRSC        ANDNE     VIDRSD
067830010214     C                   MOVEL     '1'           WEFORM
067840010212     C                   MOVEL     ORMRSC        VIDRSD
067850010215    4C                   ENDIF
067860010215    4C     VIDIND        IFEQ      *BLANKS
067870011122     C     ORMINC        ANDNE     *BLANKS
067880011121     C     §ORMFD        OREQ      'S'
067890011122     C     ORMINC        ANDNE     VIDIND
067900010213     C                   MOVEL     '1'           WEFORM
067910010212     C                   MOVEL     ORMINC        VIDIND
067920010215    4C                   ENDIF
067930010215    4C     VIDCAD        IFEQ      *BLANKS
067940011122     C     ORMCAC        ANDNE     *BLANKS
067950011121     C     §ORMFD        OREQ      'S'
067960011122     C     ORMCAC        ANDNE     VIDCAD
067970010213     C                   MOVEL     '1'           WEFORM
067980010212     C                   MOVEL     ORMCAC        VIDCAD
067990010215    4C                   ENDIF
068000010215    4C     VIDLOD        IFEQ      *BLANKS
068010011122     C     ORMLOC        ANDNE     *BLANKS
068020011121     C     §ORMFD        OREQ      'S'
068030011122     C     ORMLOC        ANDNE     VIDLOD
068040010213     C                   MOVEL     '1'           WEFORM
068050010215     C                   MOVEL     ORMLOC        VIDLOD
068060010215    4C                   ENDIF
068070010216    4C     VIDPRD        IFEQ      *BLANKS
068080010216     C     ORMPRC        ANDNE     *BLANKS
068090010216     C     VIDCAD        ANDEQ     ORMCAC
068100010216     C     VIDCAD        ANDNE     *BLANKS
068110011121     C     §ORMFD        OREQ      'S'
068120011122     C     ORMPRC        ANDNE     VIDPRD
068130010216     C                   MOVEL     '1'           WEFORM
068140010216     C                   MOVEL     ORMPRC        VIDPRD
068150010216    4C                   ENDIF
068160010216    4C     VIDNZD        IFEQ      *BLANKS
068170010216     C     ORMNAC        ANDNE     *BLANKS
068180010216     C     VIDCAD        ANDEQ     ORMCAC
068190010216     C     VIDCAD        ANDNE     *BLANKS
068200011121     C     §ORMFD        OREQ      'S'
068210011122     C     ORMNAC        ANDNE     VIDNZD
068220010216     C                   MOVEL     '1'           WEFORM
068230010216     C                   MOVEL     ORMNAC        VIDNZD
068240010216    4C                   ENDIF
068250010215    3C                   ENDIF
068260011121    2C                   ENDIF
068270011121     C*
068280011121    2C     *IN12         IFEQ      *OFF
068290011121     C     *IN15         OREQ      *OFF
068300010212     C* LINEA DI ARRIVO
068310010214     C* La linea di arrivo se presente sull'orm deve sempre essere
068320010214     C* uguale a video quindi, se diversa, la forzo
068330010228     C* Il messaggio di errore lo emetto solo se lna a video > 0 e <> DA ORM
068340010215    3C     ORMPOC        IFGT      *ZEROS
068350010215    4C     VIDLNA        IFGT      *ZEROS
068360010215     C                   MOVE      VIDLNA        W0030
068370010215    5C     W0030         IFNE      ORMPOC
068380010213     C                   MOVEL     RIMM          ATRLNA
068390010213     C                   MOVEL     ERR(220)      VIDMSG
068400010216     C                   MOVEL     '1'           WEFORM
068410010216     C                   MOVE      ORMPOC        VIDLNA
068420010216     C                   SETON                                        9047
068430010215    5C                   ENDIF
068440010216   X4C                   ELSE
068450010216     C                   MOVEL     '1'           WEFORM
068460010216     C                   MOVE      ORMPOC        VIDLNA
068470010216    4C                   ENDIF
068480020204     C* SE LNA DPD DEVO IMPOSTARE 'D' NEL network
068490020207     C* SE LNA FEDEX DEVO IMPOSTARE 'F' NEL network
068500010214     C* SE SONO IM MANUTENZIONE NON LO DEVO FARE PERCHE' IN QUESTO
068510010214     C* CASO NON C'E' IL CAMPO VIDDPD
068520010215    4C     *IN12         IFEQ      *OFF
068530010215     C     ORMPOC        CHAIN     AZORG01L      UNIORG               30
068540010214     C                   MOVEL     OG143         SAV143
068550010214     C                   MOVEL     ORGDE3        OG143
068560020319    5C     §OGNTW        IFEQ      'DPD'
068570020204     C                   MOVEL     'D'           VIDDPD
068580020204     c                   else
068590020204     c     §ogntw        ifeq      'FED'
068600020204     c                   movel     'F'           viddpd
068610020204     c                   endif
068620010215    5C                   ENDIF
068630010214     C                   MOVEL     SAV143        OG143
068640010215    4C                   ENDIF
068650010215    3C                   ENDIF
068660010314     C* FERMO DEPOSITO  - RIEMETTO LA VIDEATA SOLO SE SU ORM E' = 'S'
068670010215    3C     VIDFFD        IFEQ      *BLANKS
068680010215    4C     ORMFFD        IFEQ      'S'
068690010213     C                   MOVE      'S'           VIDFFD
068700010314     C                   MOVEL     '1'           WEFORM
068710010213     C                   ELSE
068720010213     C                   MOVE      'N'           VIDFFD
068730010215    4C                   ENDIF
068740010214     C                   MOVE      VIDFFD        PREFFD
068750010215    3C                   ENDIF
068760100319     c*
068770100319     c* TIPO SERVIZIO da FNORE
068780100319     c*  come per la linea di arrivo, se diversa la cambio emettendo MSG
068790100319   3ac                   if        Wesore<>'N'
068800100319     c                   clear                   WesORE
068810100319     c                   clear                   DoreGEN
068820100319     c     korme         chain     fnore01l
068830100319    3c                   if        %found(fnore01l)
068840100319     c                   movel     oredati       doreGEN
068850100319     c                   eval      wesore='S'
068860100319     C                   Z-ADD     1             C
068870100319     C     §oretsp       LOOKUP    TSP(C)                                 30
068880100319    4c                   if        *in30 and uts(c)='S'
068890100319    5c                   if        vidtsp<>*blanks and
068900100319     c                             vidtsp<>§oretsp
068910100319     C                   MOVEL     RIMM          ATRtsp
068920100319     c* Se già impostato per la linea di arrivo --> uni msg
068930100319    6c                   if        vidmsg=err(220)
068940100319     C                   MOVEL     ERR(74)       VIDMSG
068950100319     c                   else
068960100319     C                   MOVEL     ERR(75)       VIDMSG
068970100319    6c                   endif
068980100319     c
068990100319     C                   MOVEL     '1'           WEFORM
069000100319     C                   SETON                                        9048
069010100319    5C                   ENDIF
069020100319     c
069030100319     c* Riemetto video anche se TSP vuoto
069040100319     c                   if        vidtsp=' '
069050100319     C                   MOVEL     '1'           WEFORM
069060100319     c                   endif
069070100319     C                   MOVE      §oretsp       VIDtsp
069080100319    4c                   endif
069090100319    3c                   endif
069100100319   3ac                   endif
069110100319     c
069120010215    2C                   ENDIF
069130010301     C* SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI DEVO PROPORRE
069140010301     C* ANCHE COLLI E PESO
069150010301     C     §LPFPR        IFEQ      'O'
069160010301     C     V1CNCL        IFEQ      *ZEROS
069170010301     C                   Z-ADD     ORMNCL        V1CNCL
069180010301     C                   MOVEL     '1'           WEFORM
069190010305     C                   Z-ADD     ORMNCL        PRENCL
069200010301     C                   ENDIF
069210010301     C     VIDPKG        IFEQ      *ZEROS
069220010301     C                   Z-ADD     ORMPKG        VIDPKG
069230010305     C                   Z-ADD     ORMPKG        PREPKG
069240010301     C                   MOVEL     '1'           WEFORM
069250010301     C                   ENDIF
069260010301     C                   ENDIF
069270061124     c*
069280061124     c                   if        wforpf='1'
069290061124     c                   eval      §orpfb='A'
069300061124     c                   clear                   wforpf
069310061124     c                   endif
069320031201
069330031201      * se non sono in conferma bolle da clienti
069340060428if  1c                   If        (Not *In12 or Not *In15) and
069350031201      * e l'ORM prevede:
069360031201      *               --> la bolla in porto Assegnato
069370031201      *               --> paga ordinante orm
069380031201      *               --> destinatario orm estero
069390031201      *               --> ordinante orm italia
069400060428      * n.b.:per sapere se destinatario estero nei casi in cui sull'orm
069410060428      *      non è indicato ma è indicato a video devo testare il contenuto
069420060428      *      di vidnzd (wdesie infatti è disponibile solo dopo che il pgm
069430060428      *      ha fatto i controlli del destinatario che vengono fatti dopo
069440060428      *      questo controllo). Anche se non è corretto testare vidnzd
069450060428      *      per sapere se nazione estera (è il flag §15ita che me lo dice)
069460060428      *      era l'unico modo per gestire la videata in maniera chiara
069470060428      *      per il bollettista effettuando la forzatura nel momento
069480060428      *      giusto anzichè dare altre segnalazioni di errore che con-
069490060428      *      fonderebbero sicuramente.
069500031201     c                             (§OrPfb = 'A' and OrmPag = 'O' and
069510060914     c                             (OrmNac<>*Blanks or vidnzd<>*blanks))
069520060914     c*
069530060914    2c                   if        ormnao <> *blanks
069540060914     c                   movel     ormcor        po_cor            3 0
069550060914     c                   clear                   w_ordntw          1
069560060914     c     po_cor        chain     azorg01l      uniorg
069570060914    3c                   if        %found(azorg01l)
069580060914     C                   MOVEL     OG143         SAV143
069590060914     c                   movel     orgde3        og143
069600060914    4c                   if        §ogntw = 'EEX' or §ogntw='DPD'
069610060914     c                             or  §ogntw='FED'
069620060914     c                   movel     'E'           w_ordntw
069630060914    4c                   endif
069640060914     C                   MOVEL     SAV143        OG143
069650060914    3c                   endif
069660060914    2c                   endif
069670060914    2c                   if        ormnao = *blanks or w_ordntw<>'E'
069680050622      **non era impostato vidccm
069690050622     c***                          wnoccm = '1'
069700060427     c                   exsr      sr_FOrmEst
069710060914    2c                   endif
069720031201    1c                   EndIf
069730031201
069740010301     C*
069750010213     C   90              MOVEL     '1'           WEMFOR
069760010215    2C  N90WEFORM        IFEQ      '1'
069770010213     C* SE SONO IN CONFERMA RICHIAMATA CON X O W NON DEVO RIEMETTERE
069780010213     C* LA VIDEATA PER VISUALIZZARE CAMPI DA ORM QUINDI PULISCO FLAG
069790010215    3C     §LPFPR        IFEQ      'V'
069800010213     C     *IN12         OREQ      *OFF
069810010213     C     *IN15         OREQ      *OFF
069820010213     C                   ELSE
069830010213     C                   CLEAR                   WEFORM
069840010215    3C                   ENDIF
069850010215    2C                   ENDIF
069860010215    1C                   ENDIF
069870040901     C                   ENDSR
069880070806     c***
069890070806     c* Forzatura data ritiro da orm ---------------------------------*
069900070806     c***
069910070806     c     fordrt        begsr
069920070905     c*
069930070806     C                   CLEAR                   WLBDAT
069940070806     C                   MOVEL     '3'           G02ERR
069950070806     c* se fase utilizzabile propongo la data della fase
069960070806    3C     d§fardar      ifeq      'S'
069970071112     c                   if        ormfao=400
069980071112     c                   z-add     ormddc        g02inv
069990071112     c                   else
070000070806     C                   Z-ADD     ORMDFO        G02INV
070010071112     c                   endif
070020070806   x3c                   else
070030070806     c* se l'orm non è in una fase utilizzabile per la data ritiro prendo
070040070806     c* la data ritiro presente sull'orm
070050070806     C                   Z-ADD     ORMDAR        G02INV
070060070806    3c                   endif
070070070806     c* se la data ritiro da proporre è maggiore della data odierna non
070080070905     c* propongo nulla. Non propongo la data anche se bolla import
070090070905    3c                   if        g02inv<=dateu and
070100081008     c                              §ogntw<>'EEX' and §ogntw<>'FED'
070110081008     c                              and §ogntw<>'DPD'
070120071107    4c***                if        viddrt= *zeros  or
070130071107     c****                          dateu>=§vpodrt
070140081008     c*                            (§ogntw<>'EEX' and §ogntw<>'FED'
070150081008     c*                             and §ogntw<>'DPD' and
070160070905     c*                             dateu>=§vpodrt)
070170070806     C                   CALL      'XSRDA8'
070180070806     C                   PARM                    WLBDAT
070190070905    5c                   if        g02dat<>viddrt
070200070806     c* se modificata data avviso con dicitura "DA ORM" blinking
070210070806    6c                   if        viddrt>0
070220070806     c                   if        wperso='P'
070230070806     c                   movel     blnk          at0daorm
070240070806     c                   else
070250070806     c                   movel     blnk          atrdaorm
070260070806     c                   endif
070270070806    6c                   endif
070280070905     C                   MOVEL     '1'           WEFORM            1
070290070806     C                   Z-ADD     G02DAT        VIDDRT
070300070806     C                   Z-ADD     VIDDRT        PREDRT
070310070806    5c                   endif
070320070918     C                   Z-ADD     G02DAT        s_drt
070330071107    4C****               ENDIF
070340070905   x3c                   else
070350070905     c* se non propongo la data perchè > data giorno o bolla import
070360070905     c* propongo udate
070370070918     c                   if        *in12='0'
070380070918     c                   if        viddrt=*zeros or
070390071107     c                             s_drt=0
070400071107     c****                         (dateu>=§vpodrt and s_drt=0)
070410070918     c****               if        s_drt=0 or (Dateu<§vpodrt and viddrt=0)
070420070918     c                   if        viddrt<>wdtgio
070430070918     C                   MOVEL     '1'           WEFORM            1
070440070918     c                   endif
070450070905     c                   z-add     wdtgio        viddrt
070460070905     c                   z-add     wdtgio        s_drt
070470070905     C                   Z-ADD     VIDDRT        PREDRT
070480070905     c                   endif
070490070918     c                   endif
070500070806    3C                   ENDIF
070510070806    cc                   endsr
070520040901     C*
070530040901     C* Proposta dati da orm - bis - Campi della prima videata ------*
070540060522     c* ATTENZIONE! Questa routine è al momento inutilizzata. Se diveni
070550060522     c* sse necessario riattivarla occorre rivederla in quanto non
070560060522     c* è sufficiete cercare la distinta con ormpor in quanto ormpor
070570060522     c* potrebbe essere un p.o. gestito ed in questo caso bisogna
070580060522     c* cercare la distinta della lnp bolla
070590120611     C**** PRPOR1bis     BEGSR
070600040901     C*
070610040901     C* PADRONCINO - LO DETERMINO DALLA DISTINTA
070620040901     C* IDEM FLAG MATTINO/POMERIGGIO
070630040901     C* Propongo il flag mattino/pomeriggio solo se non immesso e se il
070640040901     c* padroncino a video è uguale a quello della distinta
070650040901     C* Non propongo mai se richiamata da conferma prepagati
070660120611     C**** §LPFPR        IFNE      'O'
070670120611    2C**** ORMNDC        IFGT      *ZEROS
070680120611     C**** VIDPDR        ANDEQ     *ZEROS
070690120611     C**** *IN22         ANDEQ     *OFF
070700120611    2C**** ORMNDC        ORGT      *ZEROS
070710120611     C**** VIDPDR        ANDEQ     *BLANKS
070720120611     C**** *IN22         ANDEQ     *OFF
070730120611     C**** ORMNDC        ORGT      *ZEROS
070740120611     C**** VIDPDR        ANDEQ     '?   '
070750120611     C**** *IN22         ANDEQ     *OFF
070760120611     C**** ORMNDC        ORGT      *ZEROS
070770120611     C**** VIDFPP        ANDEQ     *BLANKS
070780120611     C**** *IN22         ANDEQ     *OFF
070790120611     c****
070800120611     C****               MOVE      ORMNDC        W0050             5 0
070810120611     C**** KDST          CHAIN     FIDST01L                           30
070820120611    3C**** *IN30         IFEQ      *OFF
070830120611    4C**** VIDPDR        IFEQ      *ZEROS
070840120611    4C**** VIDPDR        OREQ      *BLANKS
070850120611    4C**** VIDPDR        OREQ      '?   '
070860120611     C****               MOVE      DSTPDR        VIDPDR
070870120611     c****               clear                   v1dpdr
070880120611     C****               MOVE      DSTPDR        PREPDR
070890120611     C****               MOVEL     '1'           WEFORM
070900120611    4C****               ENDIF
070910120611     C****               MOVE      DSTPDR        WDPDR
070920120611    4C**** VIDPDR        IFEQ      WDPDR
070930120611     C**** VIDFPP        ANDEQ     *BLANKS
070940120611     C****               MOVE      ORMNDC        W0050
070950120611     C**** KFVV          CHAIN     FNFVV01L                           30
070960120611     C****               MOVE      FVVFPP        VIDFPP
070970120611     C****               MOVEL     FVVFPP        PREFPP
070980120611     C****               MOVEL     '1'           WEFORM
070990120611    4C****               ENDIF
071000120611    3C****               ENDIF
071010120611    2C****               ENDIF
071020120611     C****               ENDIF
071030120611     c****               ENDSR
071040010214     C*
071050010214     C* CONTROLLI DI CONGRUENZA CAMPI I°VIDEATA CON CAMPI DELL'ORM --*
071060010214     C     CNFOR1        BEGSR
071070050427     c                   clear                   wcaut            27
071080010214     C*
071090010214     C* I seguenti errori sono tutti forzabili e vengono effettuati
071100010214     C* solo se numero ORM non fittizio e se non sono in immissione
071110010214     C* dei miei prepagati perchè in questo caso l'ORM viene crato
071120010214     C* dopo l'immissione del prepagato
071130010214     C*
071140010215    1C     FLGFIT        IFNE      'S'
071150010214     C     PARTCH        ANDNE     'P'
071160010214     C*
071170010214     C*** DATA RITIRO ***
071180010214     C*
071190071107     c****               if        dateu<§vpodrt
071200071107    2C**** VIDDRT        IFGT      *ZEROS
071210071107     C**** §LPFPR        ANDNE     'O'
071220071107     C**** d§fardar      ANDEQ     'S'
071230071107     C**** VIDDRT        ANDNE     PREDRT
071240071107     C**** ORMDFO        ANDNE     COMDRT
071250071107     C****               MOVEL     RIMM          ATRDRT
071260071107     C****               Z-ADD     VIDDRT        PREDRT
071270071107     C****               SETON                                        90
071280071107    2C****               ENDIF
071290071107     c****               endif
071300040902     c                   exsr      CNFOR1bis
071310010214     C* I SEGUENTI CONTROLLI VENGONO FATTI SOLO SE NON SONO IN CONFERMA
071320010214     C* BOLLE DA DISCHETTO
071330010215    2C     *IN12         IFEQ      *OFF
071340010214     C     *IN15         OREQ      *OFF
071350010214     C*
071360010214     C** CODICE CLIENTE MITTENTE
071370010214     C*
071380010215    3C     VIDCCM        IFGT      *ZEROS
071390010214     C     ORMKSC        ANDGT     *ZEROS
071400010214     C                   MOVE      VIDCCM        WOCCM
071410010214     C                   MOVEL     VIDFLC        WOCCM
071420010215    4C     WOCCM         IFNE      PRECCM
071430010214     C                   Z-ADD     WOCCM         PRECCM
071440010215    5C     VIDFLC        IFEQ      *ZEROS
071450010214     C                   MOVEL     VIDLNP        WOCCM
071460010215    5C                   ENDIF
071470010215    5C     WOCCM         IFNE      ORMKSC
071480030905    6c                   If        §OrPfb <> 'A'
071490010214     C                   MOVEL     RIMM          ATRCCM
071500010214     C                   SETON                                        90
071510010215   X6C                   ELSE
071520030905    7c                   If        Vidccm <> 9999
071530010214     C                   MOVEL     RIMM          ATRCCM
071540010214     C                   SETON                                        90
071550010215    7C                   ENDIF
071560010215    6C                   ENDIF
071570010215    5C                   ENDIF
071580010215    4C                   ENDIF
071590010215    3C                   ENDIF
071600010214     C*
071610010214     C** FERMO DEPOSITO
071620010214     C*
071630010215     C     ORMFFD        IFEQ      ' '
071640010215     C                   MOVE      'N'           W001A             1
071650010215     C                   ELSE
071660010215     C                   MOVE      ORMFFD        W001A
071670010215     C                   ENDIF
071680010215    3C     VIDFFD        IFNE      W001A
071690010214     C     VIDFFD        ANDNE     PREFFD
071700010220     C                   MOVE      VIDFFD        PREFFD
071710010214     C                   MOVEL     RIMM          ATRFFD
071720010214     C                   SETON                                        90
071730010215    3C                   ENDIF
071740010305     C*
071750010305     C** COLLI E PESO ** SE SONO IN CONFERMA PREPAGATI DI ALTRI P.O.
071760010305     C*
071770010305    3C     §LPFPR        IFEQ      'O'
071780010305    4C     V1CNCL        IFNE      ORMNCL
071790010305     C     V1CNCL        ANDNE     PRENCL
071800010305     C                   Z-ADD     V1CNCL        PRENCL
071810010305     C                   MOVEL     RIMM          ATRNCL
071820010305     C                   SETON                                        90
071830010305    4C                   ENDIF
071840010305    4C     VIDPKG        IFNE      ORMPKG
071850010305     C     VIDPKG        ANDNE     PREPKG
071860010305     C                   Z-ADD     VIDPKG        PREPKG
071870010305     C                   MOVEL     RIMM          ATRPKG
071880010305     C                   SETON                                        90
071890010305    4C                   ENDIF
071900010305    3C                   ENDIF
071910010215    2C                   ENDIF
071920010214     C*
071930010214     C   90              MOVEL     ERR(221)      VIDMSG
071940010214     C   90              MOVEL     '1'           WEMFOR
071950050427     c   90              if        wcaut <> *blanks
071960050427     c                   move      wcaut         vidmsg
071970050427     c                   endif
071980010215    1C                   ENDIF
071990010214     C                   ENDSR
072000040902     C*
072010040902     C* CONTROLLI DI CONGRUENZA CAMPI PDR e FPP CON CAMPI DELL'ORM --*
072020040902     C     CNFOR1bis     BEGSR
072030040902     C*
072040040902     C**
072050040902     C* CODICE PADRONCINO + FLAG MATTINO/POMERIGGIO
072060040902     C**
072070040902    2C     ORMNDC        IFGT      *ZEROS
072080040902     C     VIDPDR        ANDGT     *ZEROS
072090040902     C     VIDPDR        ANDNE     PREPDR
072100070606     c                   exsr      sr_dst
072110040902     C                   MOVE      DSTPDR        WDPDR
072120040902    3C     WDPDR         IFNE      VIDPDR
072130050426     c**   atrpdr        ifne      prri
072140040902     C                   MOVEL     RIMM          ATRPDR
072150050426     c**                 endif
072160040902     C                   MOVE      VIDPDR        PREPDR
072170040902     C                   SETON                                        90
072180050427     c                   move      dstpdr        wadpdr            7
072190050427     c                   eval      wcaut = caut
072200050427     c                   eval      %subst(wcaut: 6: 7) = wadpdr
072210040902    3C                   ENDIF
072220040902    2C                   ENDIF
072230040902     C* Il flag mattino/pomeriggio lo controllo solo se il PDR è =
072240040902    2C     ORMNDC        IFGT      *ZEROS
072250040902     C     VIDPDR        ANDEQ     WDPDR
072260040902     C     VIDFPP        ANDNE     *BLANKS
072270040902     C     VIDFPP        ANDNE     PREFPP
072280040902     C                   MOVE      ORMNDC        W0050
072290060522     c                   if        w_pogest = *zeros
072300060522     c                   z-add     ormpor        kfgs
072310060522     c                   else
072320060522     c                   z-add     w_pogest      kfgs
072330060522     c                   endif
072340040902     C     KFVV          CHAIN     FNFVV01L                           30
072350040902    3C     FVVFPP        IFNE      VIDFPP
072360050426     c***  atrfpp        ifne      prri
072370040902     C                   MOVEL     RIMM          ATRFPP
072380050426     c***                endif
072390040902     C                   MOVE      VIDFPP        PREFPP
072400040902     C                   SETON                                        90
072410040902    3C                   ENDIF
072420040902    2C                   ENDIF
072430040902     c                   ENDSR
072440120611     c
072450120611     C* Ricerca codice autotrasportatore che ha eseguito l'orm ----------------
072460070606     C     sr_dst        BEGSR
072470120611     c
072480120611     C                   MOVE      ORMNDC        W0050
072490070606     c                   if        w_pogest = *zeros
072500070606     C                   z-add     ORMpor        kfgs
072510070606     c                   else
072520070606     c                   z-add     w_pogest      kfgs
072530070606     c                   endif
072540120611     C     KDST          CHAIN     FIDST01L                           30
072550070606     C   30              CLEAR                   DSTPDR
072560070606     c                   endsr
072570010215     C*
072580010215     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA II° VIDEATA) ----------*
072590010215     C     PRPOR2        BEGSR
072600010215     C                   CLEAR                   WEFORM
072610010215     C*
072620010215     C** MITTENTE (RAG.SOC.,INDIRIZZO...)
072630030912      * da mittente ORM se l'ORM prevede la bolla in porto assegnato
072640030912      * o se conferma ORM prepagati
072650010215     C*
072660030912    1c                   If        Not *In02 and
072670030923     c                             (VidCcm = 9999 or
072680030923     c                             (§LpFpr = 'O' and VidCcm = 8888))
072690010215    3C     WOVUO         IFEQ      *BLANKS
072700010215     C     VIDRSM        OREQ      *BLANKS
072710010215     C                   MOVEL     ORMRSR        VIDRSM
072720010215     C                   MOVEL     '1'           WEFORM
072730010215    3C                   ENDIF
072740010215    3C     WOVUO         IFEQ      *BLANKS
072750010215     C     VIDINM        OREQ      *BLANKS
072760010215     C                   MOVEL     ORMINR        VIDINM
072770010215     C                   MOVEL     '1'           WEFORM
072780010215    3C                   ENDIF
072790010215    3C     WOVUO         IFEQ      *BLANKS
072800010215     C     VIDCAM        OREQ      *BLANKS
072810010215     C                   MOVEL     ORMCAR        VIDCAM
072820010215     C                   MOVEL     '1'           WEFORM
072830010215    3C                   ENDIF
072840010215    3C     WOVUO         IFEQ      *BLANKS
072850010215     C     VIDLOM        OREQ      *BLANKS
072860010215     C                   MOVEL     ORMLOR        VIDLOM
072870010215     C                   MOVEL     '1'           WEFORM
072880010215    3C                   ENDIF
072890010215    3C     WOVUO         IFEQ      *BLANKS
072900010329     C     VIDPRM        OREQ      *BLANKS
072910010329     C     ORMPRR        ANDNE     *BLANKS
072920010329     C     VIDCAM        ANDEQ     ORMCAR
072930010329     C     ORMCAR        ANDNE     *BLANKS
072940010215     C                   MOVEL     ORMPRR        VIDPRM
072950010215     C                   MOVEL     '1'           WEFORM
072960010215    3C                   ENDIF
072970010216    3C     WOVUO         IFEQ      *BLANKS
072980010329     C     VIDNZM        OREQ      *BLANKS
072990010329     C     ORMNAR        ANDNE     *BLANKS
073000010329     C     VIDCAM        ANDEQ     ORMCAR
073010010329     C     ORMCAR        ANDNE     *BLANKS
073020010216     C                   MOVEL     ORMNAR        VIDNZM
073030010216     C                   MOVEL     '1'           WEFORM
073040010216    3C                   ENDIF
073050061113     c*
073060061113     c                   if        *in22 and ormtco='I' and ormcor=0
073070061113     c                   move      ormino        vidcdf
073080061113     c                   endif
073090031201    1C                   ENDIF
073100031201      * se ho forzato il porto franco
073110031201if  1c                   If        wforpf = '1'
073120031201if  2c                   If        Not *In02
073130031201      * imposto l'ordinante dell'orm nel mittente bolla
073140031201    3C     WOVUO         IFEQ      *BLANKS
073150031201     C     VIDRSM        OREQ      *BLANKS
073160031201     C                   MOVEL     ORMRSO        VIDRSM
073170031201     C                   MOVEL     '1'           WEFORM
073180031201    3C                   ENDIF
073190031201    3C     WOVUO         IFEQ      *BLANKS
073200031201     C     VIDINM        OREQ      *BLANKS
073210031201     C                   MOVEL     ORMINO        VIDINM
073220031201     C                   MOVEL     '1'           WEFORM
073230031201    3C                   ENDIF
073240031201    3C     WOVUO         IFEQ      *BLANKS
073250031201     C     VIDCAM        OREQ      *BLANKS
073260031201     C                   MOVEL     ORMCAO        VIDCAM
073270031201     C                   MOVEL     '1'           WEFORM
073280031201    3C                   ENDIF
073290031201    3C     WOVUO         IFEQ      *BLANKS
073300031201     C     VIDLOM        OREQ      *BLANKS
073310031201     C                   MOVEL     ORMLOO        VIDLOM
073320031201     C                   MOVEL     '1'           WEFORM
073330031201    3C                   ENDIF
073340031201    3C     WOVUO         IFEQ      *BLANKS
073350031201     C     VIDPRM        OREQ      *BLANKS
073360031201     C     ORMPRO        ANDNE     *BLANKS
073370031201     C     VIDCAM        ANDEQ     ORMCAO
073380031201     C     ORMCAO        ANDNE     *BLANKS
073390031201     C                   MOVEL     ORMPRO        VIDPRM
073400031201     C                   MOVEL     '1'           WEFORM
073410031201    3C                   ENDIF
073420031201    3C     WOVUO         IFEQ      *BLANKS
073430031201     C     VIDNZM        OREQ      *BLANKS
073440031201     C     ORMNAO        ANDNE     *BLANKS
073450031201     C     VIDCAM        ANDEQ     ORMCAO
073460031201     C     ORMCAO        ANDNE     *BLANKS
073470031201     C                   MOVEL     ORMNAO        VIDNZM
073480031201     C                   MOVEL     '1'           WEFORM
073490031201    3C                   ENDIF
073500031201    2c                   EndIf
073510031201      * imposto il mittente dell'orm nel mittente originale bolla
073520031201    2c                   If        wovuo = *Blanks or vidrmo = *Blanks
073530031201     c                   Movel     OrmRsr        vidrmo
073540031201     c                   Eval      wemfor = '1'
073550031201    2c                   EndIf
073560031201    2c                   If        wovuo = *Blanks or vidcmo = *Blanks
073570031201     c                   Movel     OrmCar        vidcmo
073580031201     c                   Eval      wemfor = '1'
073590031201    2c                   EndIf
073600031201    2c                   If        wovuo = *Blanks or  vidnmo = *Blanks
073610031201     c                   Movel     OrmNar        vidnmo
073620031201     c                   Eval      wemfor = '1'
073630031201    2c                   EndIf
073640031201    1c                   EndIf
073650010306     C*
073660010306     C* VOLUME - SOLO SE RICHIAMATA DA CONFERMA PREPAGATI DI ALTRO P.O.
073670010306     C*
073680010306    1C     §LPFPR        IFEQ      'O'
073690010306     C     ORMVLM        ANDGT     *ZEROS
073700010306     C* Metto il test su campo wovuo anche per volume per uniformità
073710010306     C* anche se in questo caso forse non serve perchè il volume
073720010306     c* non viene mai impostato diverso da 0 in ctrd01
073730010306     C     WOVUO         IFEQ      *BLANKS
073740010306     C     VIDVOL        OREQ      *ZEROS
073750010306     C                   Z-ADD     ORMVLM        VIDVOL
073760010306     C                   MOVEL     '1'           WEFORM
073770010306     C                   ENDIF
073780010306    1C                   ENDIF
073790010215     C*
073800010215     C* CODICE TARIFFA
073810010215     C*
073820031201     c                   If        Not *In29 and §OrPfb <> 'A'
073830010215     C                   MOVE      VIDCCM        W0070             7 0
073840010215    2C     VIDFLC        IFEQ      *ZEROS
073850010215     C                   MOVEL     VIDLNP        W0070
073860010215     C                   ELSE
073870010215     C                   MOVEL     VIDFLC        W0070
073880010215    2C                   ENDIF
073890010226     C* Propongo il codice tariffa da orm solo se:
073900010226     C* Stesso codice cliente mittente
073910010215    2C     W0070         IFEQ      ORMKSC
073920010226     C* immesso codice tariffa su orm
073930010215     C     ORMCTR        ANDNE     *BLANKS
073940010226     C* codice tariffa a video = blanks
073950010226     C     VIDCTR        ANDEQ     *BLANKS
073960010215     C                   MOVE      ORMCTR        VIDCTR
073970010215     C                   MOVE      ORMCTR        PRECTR
073980010215     C                   MOVEL     '1'           WEFORM
073990010215    2C                   ENDIF
074000010215    1C                   ENDIF
074010010215     C*
074020010215     C* NATURA MERCE
074030010215     C*
074040011221    1C  N27              DO
074050011221     C                   MOVEL     ORMNAM        W015A
074060011221    2C     W015A         IFNE      *BLANKS
074070010226     C     VIDNAS        ANDEQ     *BLANKS
074080010215     C                   MOVEL     ORMNAM        VIDNAS
074090010215     C                   MOVEL     '1'           WEFORM
074100011221    2C                   ENDIF
074110011221    1C                   ENDDO
074120010215     C*
074130010404     C* NOTE: SE PESO > 50 Q.LI
074140010404     C*       SE O.R.M. COMMISSIONATI DA ALTRO P.O. NELLE NOTE METTO
074150010404     C*       SEMPRE E SOLO IL REFERENTE E NUMERO DI TELEFONO
074160010307    1C                   SELECT
074170010307     C     §LPFPR        WHENEQ    'O'
074180050211     C***  ORMPOE        ORNE      ORMPOR
074190010307     C     VIDNT1        IFEQ      *BLANKS
074200010307     C                   MOVEL     WTELRF        VIDNT1
074210010307     C                   MOVEL     '1'           WEFORM
074220010307     C                   ENDIF
074230010307     C     WTELR2        IFNE      *BLANKS
074240010307     C     VIDNT2        IFEQ      *BLANKS
074250010307     C     WOVUO         OREQ      *BLANKS
074260010307     C                   MOVE      WTELR2        VIDNT2
074270010307     C                   MOVEL     '1'           WEFORM
074280010307     C                   ENDIF
074290010307     C                   ENDIF
074300010409     C     VIDPKG        WHENGE    §DFMAX
074310010215    2C     ORMNO1        IFNE      *BLANKS
074320010226     C     VIDNT1        ANDEQ     *BLANKS
074330010215     C                   MOVEL     ORMNO1        VIDNT1
074340010215     C                   MOVEL     '1'           WEFORM
074350010215    2C                   ENDIF
074360010215    2C     ORMNO2        IFNE      *BLANKS
074370010226     C     VIDNT2        IFEQ      *BLANKS
074380010226     C     WOVUO         OREQ      *BLANKS
074390010215     C                   MOVEL     ORMNO2        VIDNT2
074400010215     C                   MOVEL     '1'           WEFORM
074410010226     C                   ENDIF
074420010215    2C                   ENDIF
074430010307    1C                   ENDSL
074440010223     C                   MOVE      '1'           WOVUO             1
074450010215     C                   ENDSR
074460010215     C*
074470010215     C* CONTROLLI DI CONGRUENZA COD.TARIFFA CON CAMPO DELL'ORM ------*
074480010215     C     CNFOR2        BEGSR
074490010215     C*
074500010215     C*** CODICE TAR. ***
074510010215     C*
074520010223     C                   MOVE      VIDCCM        W0070
074530010223     C     VIDFLC        IFEQ      *ZEROS
074540010223     C                   MOVEL     VIDLNP        W0070
074550010223     C                   ELSE
074560010223     C                   MOVEL     VIDFLC        W0070
074570010223     C                   ENDIF
074580030905     C* ORM NON PAGATO DA DESTINATARIO
074590030905      * L'orm prevede la bolla in porto franco
074600030905     c     §OrPfb        Ifne      'A'
074610010223     C* PRESENTE CODICE CLIENTE SU ORM
074620010223     C     ORMKSC        ANDGT     *ZEROS
074630010223     C     ORMKSC        ANDEQ     W0070
074640010215     C     VIDCTR        IFNE      *BLANKS
074650010215     C     VIDCTR        ANDNE     PRECTR
074660010215     C     ORMCTR        ANDNE     VIDCTR
074670010215     C     ORMCTR        ANDNE     *BLANKS
074680010215     C                   MOVEL     RIMM          ATRCTR
074690010215     C                   MOVEL     VIDCTR        PRECTR
074700010215     C                   SETON                                        90
074710010215     C                   ENDIF
074720010223     C                   ENDIF
074730010215     C*
074740010215     C   90              MOVEL     ERR(224)      VIDMSG
074750010215     C   90              MOVEL     '1'           WEMFOR
074760010215     C                   ENDSR
074770070427     C*
074780070427     C* PROPOSTA mittente originale da orm per import dpd in porto assegnato
074790070427     C     PRPOR2_rmo    BEGSR
074800091008     c****               if        dateu>=§vpormo and §vpormo>0
074810070427     C                   CLEAR                   WEFORM
074820070427    2c                   If        wovuo1= *Blanks or vidrmo = *Blanks
074830070427     c                   Movel     OrmRsr        vidrmo
074840070430     c                   Eval      weform = '1'
074850070427    2c                   endif
074860070427    2c                   If        wovuo1= *Blanks or vidcmo = *Blanks
074870070427     c                   Movel     OrmCar        vidcmo
074880070430     c                   Eval      weform = '1'
074890070427    2c                   endif
074900070427    2c                   If        wovuo1= *Blanks or vidnmo = *Blanks
074910070427     c                   Movel     OrmNar        vidnmo
074920070430     c                   Eval      weform = '1'
074930070427    2c                   endif
074940070427     c                   movel     '1'           wovuo1            1
074950091008     c****               endif
074960070427     c                   endsr
074970091008     c*
074980960926     C* CONTROLLO CODICE AUTOTRASPORTATORE --------------------------*
074990940824     C     CTRPDR        BEGSR
075000940824     C*
075010940930     C                   CLEAR                   V1DPDR
075020990614     C                   CLEAR                   APDRSC
075030990614     C                   CLEAR                   APDFCM
075040990614     C                   CLEAR                   APDATB
075050940929     C*
075060940824     C     '?'           SCAN      WPDR                                   30
075070940824     C*
075080990915    1C     *IN30         IFEQ      *ON
075090021203      *
075100021203      * imposto i campi della ds esterna fnlv24ds
075110021203     C                   clear                   fnlv24ds
075120021203     C                   eval      d24fil   = wlnp
075130021203     C                   eval      d24tip   = 'A'
075140021203     C                   eval      d24flg   = 'R'
075150021203     C                   movel     fnlv24ds      kpjbu
075160940824     C                   CALL      'FNLV24R'
075170940824     C                   PARM                    KPJBA
075180021203      *
075190021203      * valorizzo i campi a video
075200021203     C                   movel     kpjbu         fnlv24ds
075210021203     C                   if        d24pdr   <> *zeros
075220021203     C                   move      d24pdr        wpdr
075230021203     C                   movel     d24rsc        v1dpdr
075240021203     C                   endif
075250021203     C                   MOVEL     '1'           WEMFOR
075260941011     C                   SETON                                        56
075270940824     C                   GOTO      ENDCPD
075280990915    1C                   END
075290940928     C* ESEGUO TESTN
075300990915    1C     PARTCH        IFNE      'P'
075310010307     C     §LPFPR        ANDNE     'O'
075320990610     C* PER PREPAGATI SOLO SE IL CAMPO E' PIENO
075330990610     C     PARTCH        OREQ      'P'
075340990610     C     WPDR          ANDNE     *BLANKS
075350990610     C     WPDR          ANDNE     *ZEROS
075360010307     C     §LPFPR        OREQ      'O'
075370010307     C     WPDR          ANDNE     *BLANKS
075380010307     C     WPDR          ANDNE     *ZEROS
075390990610     C*
075400940928     C                   TESTN                   WPDR                 30
075410940928     C                   MOVE      WPDR          W001A
075420990915    2C     *IN30         IFEQ      *OFF
075430940928     C     W001A         ORLT      '0'
075440940928     C                   MOVEL     ERR(21)       VIDMSG
075450940928     C                   SETON                                        5690
075460940928     C                   GOTO      ENDCPD
075470990915    2C                   ENDIF
075480940824     C*
075490940928     C                   MOVEL     WLNP          W0070             7 0
075500940928     C                   MOVE      WPDR          W0070
075510021204     C                   move      w0070         kpdpdr
075520021203     C                   move      'A'           kpdtip
075530021203     C     kfapd         chain     fiapd01l                           30
075540990915    2C     *IN30         IFEQ      *ON
075550940824     C     *IN30         OREQ      *OFF
075560940824     C     APDATB        ANDNE     *BLANKS
075570940824     C                   MOVEL     ERR(21)       VIDMSG
075580940920     C                   SETON                                        5690
075590940824     C                   GOTO      ENDCPD
075600990915    2C                   ENDIF
075610940824     C*
075620940824     C* NON POSSO INSERIRE UNA DATA RITIRO SE ESISTE LA CONFERMA DEI
075630960926     C*  CONTEGGI AUTOTRASPORTATORI PER QUEL GIORNO
075640950116     C                   MOVE      W0070         W01PDR
075650940824     C                   MOVEL     ' '           W01TSR
075660940824     C                   MOVEL     'C'           W01FVL
075670011126     C     KFTT          SETLL     FIFTT000                               90
075680011126     C  N90KFTT          SETLL     FIFST000                               90
075690940824     C*
075700990915    2C     *IN90         IFEQ      *ON
075710940824     C                   MOVEL     ERR(7)        VIDMSG
075720940920     C                   SETON                                        56
075730940824     C                   GOTO      ENDCPD
075740990915    2C                   ENDIF
075750990915     C*
075760990915     C* SE SI TRATTA DELLA CONFERMA DI UN PREPAGATO, DO MSG SE FLAG
075770990915     C*  MERCE A MAGAZZINO DIVERSO DAL COD AUTOTRASPORTATORE
075780990915     C     VIDPDR        IFNE      SAVPD4
075790990915     C                   CLEAR                   AAC
075800990915     C                   MOVEL     VIDPDR        SAVPD4
075810990915     C                   ENDIF
075820991001     C*
075830991001     C* CONTROLLO PER IL MOMENTO SOSPESO: QUANDO ATTIVEREMO PER I
075840991001     C*  PREPAGATI LA VARIA "U" SI DEVE RIMETTERE
075850001024     C* RIATTIVATO IL 24/10/00
075860990915     C*
075870001024     C     *IN22         IFEQ      *ON
075880990915     C     *IN12         ANDEQ     *ON
075890990915     C     *IN15         ANDEQ     *OFF
075900990915     C     AAC           ANDEQ     0
075910990915     C     BLPPDR        ANDEQ     0
075920990915     C     VIDMAG        IFNE      APDFCM
075930990915     C                   MOVEL     1             AAC
075940990915     C                   MOVEL     ERR(168)      VIDMSG
075950990915     C                   SETON                                        5690
075960990915     C                   GOTO      ENDCPD
075970990915     C                   ENDIF
075980990915     C                   ENDIF
075990940824     C*
076000940824     C                   MOVEL     APDRSC        V1DPDR
076010041013     c* se orm reale controllo che non esistano altre bolle associate
076020041013     c* allo stesso orm ma abbinate ad altro autotrasportatore.
076030041013     c* Se presenti --> errore bloccante
076040041013     C     WORM          IFEQ      'S'
076050041013     C     FLGFIT        ANDNE     'S'
076060041013     c                   exsr      SR_CtrOrmPdr
076070041013     C   90              GOTO      ENDCPD
076080041013     c                   endif
076090990915    1C                   ENDIF
076100940824     C*
076110940824     C     ENDCPD        TAG
076120940824     C   90              MOVEL     '1'           WEMFOR
076130940824     C                   ENDSR
076140041013     C**************************************************************************
076150041013     C*   Controllo esistenza altre bolle associate all'orm immesso
076160041013     C**************************************************************************
076170041013     C     SR_CtrOrmPdr  BEGSR
076180041013     C                   MOVEL     DSBLP0        SAVBLP
076190041019     c     *in12         ifeq      *on
076200041019     c     *in15         andeq     *off
076210041019     c                   movel     *blanks       savbol           16
076220041019     c                   eval      savbol = %EDITW(BLPAAS:'    ')     +
076230041019     C                                      %editw(BLPLNP:'   ')      +
076240041019     C                                      %editw(BLPNRS:'  ')       +
076250041019     C                                      %editw(BLPNSP:'       ')
076260041019     c                   endif
076270041019     c
076280060215     c                   movel     'M'           kar4trc
076290060215     c                   movel     widorm        kar4n14
076300060215     c     kar403        setll     fiar404l
076310041013     c                   do        *hival
076320060215     c     kar403        reade     fiar404l
076330041013     c* fine file
076340060215     c                   if        %eof(fiar404l)
076350041013     c                   leave
076360041013     c                   endif
076370061212     c     kblp4m        chain     fnblp01l
076380041019     c
076390041019     c     *in12         ifeq      *on
076400041019     c     *in15         andeq     *off
076410041019     c                   movel     *blanks       blpbol           16
076420041019     C                   eval      blpbol = %editw(BLPAAS:'    ')   +
076430041019     C                                      %editw(BLPLNP:'   ')    +
076440041019     C                                      %editw(BLPNRS:'  ')     +
076450041019     C                                      %editw(BLPNSP:'       ')
076460041019     c                   endif
076470041013     c* trovata bolla con aut diverso errore --> esco dal ciclo
076480041013     c                   if        %found(fnblp01l) and
076490041019     c                             blppdr <> w01pdr and
076500041019     c                             blppdr > 0
076510041019     c* se sono in manutenzione e ho letto la bolla che sto manutenzion
076520041019     c* ando ignoro
076530041019     c     *in12         ifeq      *on
076540041019     c     *in15         andeq     *off
076550041019     c     blpbol        andne     savbol
076560041019     c     *in12         oreq      *off
076570041019     c     *in15         oreq      *on
076580041019     c
076590041013     C                   MOVEL     ERR(286)      VIDMSG
076600041013     C                   SETON                                        5690
076610041013     C                   leave
076620041019     c                   endif
076630041013     c                   endif
076640041013     c
076650041013     c                   enddo
076660041013     c
076670041013     C                   MOVEL     SAVBLP        DSBLP0
076680041013     c                   endsr
076690940824     C*
076700940824     C* CONTROLLO CODICE BOLLA ---------------------------------------*
076710940824     C     CTRCBO        BEGSR
076720940824     C* NO PERSONALIZZAZIONE
076730940824    0C     *IN21         IFEQ      *OFF
076740941103     C                   SETOFF                                       040508
076750940824     C* RICERCA
076760940922     C                   MOVEL     '3A'          COD
076770940824     C     '?'           SCAN      WCBO                                   30
076780940824    1C     *IN30         IFEQ      *ON
076790940922     C                   EXSR      CX§TAB
076800940824     C                   MOVEL     §KEY          WCBO
076810941011     C                   SETON                                        46
076820940824     C                   GOTO      ENDCCB
076830940824    1C                   ENDIF
076840940824     C*
076850940920     C                   MOVEL(P)  WCBO          KEY
076860940824     C*
076870940824     C                   EXSR      CTABEL
076880940824    1C     *IN30         IFEQ      *ON
076890940824     C                   MOVEL     ERR(10)       VIDMSG
076900940920     C                   SETON                                        4690
076910940824     C                   GOTO      ENDCCB
076920940824    1C                   ENDIF
076930940824     C*
076940940824     C                   MOVEL     TBLUNI        DS3A
076950940824     C                   MOVEL     §3ATB1        FLGTB1            1
076960940824     C                   MOVEL     §3ADES        V2DCBO
076970940824     C* VEDO SE CAUSALE UTILIZZABILE
076980940824     C  N12
076990940824     CORN44
077000940824    1CAN 12§3AUCB        IFEQ      'N'
077010940824     C                   MOVEL     ERR(10)       VIDMSG
077020940920     C                   SETON                                        4690
077030940824     C                   GOTO      ENDCCB
077040940824    1C                   END
077050000509     C*
077060000509     C* PER BOLLE POSTE AMMESSO SOLO FRANCO
077070020319     C     §ogntw        IFEQ      'PPT'
077080000906     C     FLGTB1        IFNE      'F'
077090000906     C     §3ATB2        ORNE      '  '
077100000509     C                   MOVEL     ERR(199)      VIDMSG
077110000509     C                   SETON                                        4690
077120000509     C                   GOTO      ENDCCB
077130000509     C                   ENDIF
077140000911     C                   ENDIF
077150940824     C*
077160991026     C     FLGTB1        COMP      'A'                                    04
077170941103     C*
077180940929     C* 08 ON - TASSATO DESTINO
077190940826     C     §3AFTD        IFEQ      1
077200940826     C                   SETON                                        08
077210940920     C                   ENDIF
077220940920     C* 05 ON - 2 BOLLA E NON E' TASSATO DESTINO
077230940920     C  N08§3ATB2        IFNE      *BLANKS
077240940920     C                   SETON                                        05
077250940920     C                   ENDIF
077260991026      *
077270991026      * SE SONO NELLA PROCEDURA PREPAGATI DEVO SELEZIONARE UN PORTO FRANCO
077280991026     C     *IN04         IFEQ      *ON
077290991026     C     PARTCH        ANDEQ     'P'
077300010307     C     *IN04         OREQ      *ON
077310010307     C     §LPFPR        ANDEQ     'O'
077320991026     C                   MOVEL     ERR(173)      VIDMSG
077330991026     C                   SETON                                        4690
077340991026     C                   GOTO      ENDCCB
077350991026     C                   ENDIF
077360020611     c* X prepagati non posso bollettare come C/servizio
077370020611     c     *in22         ifeq      *on
077380020611     c     §3arbl        andeq     'C'
077390020611     c                   movel     err(256)      vidmsg
077400020611     C                   SETON                                        4690
077410020611     C                   GOTO      ENDCCB
077420020611     c                   endif
077430030805      * se ORM con serie il codice bolla non può essere diverso da quello
077440030805      * indicato in tabella 'OSR'
077450030805If  1c                   If        wonsr > *Zeros and flgfit <> 'S' and
077460030808     c                             wCbo <> d§OsrCbo and d§OsrCbo <> *Blanks
077470030805     c                   Eval      VidMsg = Err(148)
077480030805     c                   Eval      %subst(VidMsg:25:2) = d§OsrCbo
077490030805     c                   Eval      *In46 = *On
077500030805     c                   Eval      *In90 = *On
077510030805     c                   GoTo      EndCcb
077520030805    1c                   EndIf
077530040122
077540040122      * Il codice bolla '2R' è ammesso solo se ho inserito un ORM con la serie
077550040203     c                   If        wcbo = '2R' and
077560040203     c                             (flgfit = 'S' or wonsr = *Zeros)
077570040122     c                   Eval      VidMsg = Err(10)
077580040122     c                   Eval      *In46 = *On
077590040122     c                   Eval      *In90 = *On
077600040122     c                   GoTo      EndCcb
077610040122     c                   EndIf
077620991026     C*
077630940824    0C                   ENDIF
077640940824     C*
077650940824     C* SE BOLLA DI RECUPERO NO DATA SPEDIZIONE < DATA GIORNO -3
077660940824     C* ALTRIMENTI NO < DATA GIORNO
077670940824    0C     §3ARBL        IFEQ      'R'
077680940824     C*
077690000113    1C     *IN12         IFEQ      *OFF
077700000113     C     *IN15         OREQ      *ON
077710000113     C     BLPDSP        ORNE      WBDSP
077720000113    2C     BLPDSP        IFLT      DATAM
077730940824     C                   MOVEL     ERR(4)        VIDMSG
077740940929     C                   SETON                                        4190
077750000113    2C                   ENDIF
077760000113    1C                   ENDIF
077770940824     C*
077780940824   X0C                   ELSE
077790940824     C*
077800000104     C* IMMISSIONE O CONFERMA
077810000104    1C     *IN12         IFEQ      *OFF
077820000104     C     *IN15         OREQ      *ON
077830000104     C     BLPDSP        ORNE      WBDSP
077840061221     c
077850000104     C* MANUTENZIONE : SOLO SE LA DATA SPEDIZIONE E' STATA CAMBIATA
077860061221    2C***  BLPDSP        IFLT      DATEU
077870061221    2C     BLPDSP        IFLT      datameno1
077880940824     C                   MOVEL     ERR(5)        VIDMSG
077890061221     c                   eval      %subst(vidmsg:65:10) =
077900061221     c                             %editw(datgmeno1: '  /  /    ')
077910940929     C                   SETON                                        4190
077920000104    2C                   ENDIF
077930000104    1C                   ENDIF
077940940824    0C                   ENDIF
077950000104     C   90              GOTO      ENDCCB
077960960319     C* IN MANUTENZIONE NON POSSO MODIFICARE IL TIPO BOLLA SE BOLLA
077970960319     C*  FIGLIA
077980960319     C   12
077990960319     CANN15BLPCBO        IFNE      WCBO
078000960319     C     KBLP3         SETLL     FNLBL01L                               90
078010960319     C     *IN90         IFEQ      *ON
078020960319     C                   MOVEL     ERR(124)      VIDMSG
078030960319     C                   SETON                                        46
078040960319     C                   GOTO      ENDCCB
078050120926     c*
078060120926     c                   else
078070120926     c                   if        savrbl='R' and savtb1='F' and
078080120926     c                             §3arbl<>'R'
078090120926     C                   MOVEL     ERR(347)      VIDMSG
078100120926     C                   SETON                                        4690
078110120926     C                   GOTO      ENDCCB
078120120926     c                   endif
078130960319     C                   ENDIF
078140960319     C                   ENDIF
078150961122     C*
078160990518     C* SE MODIFICATO TIPO BOLLA, PULISCO CAMPO DIC/VEN
078170961122     C     WCBO          IFNE      SAVCBO
078180040213     C**!!!              CLEAR                   DIC
078190040213     C**!!!              CLEAR                   VEN
078200961122     C                   MOVEL     WCBO          SAVCBO
078210961122     C                   ENDIF
078220070427     c* In manutenzione
078230070427     c* se modificato porto da franco ad assegnato pulisco campo per
078240070427     c* controlli proposte mittente originale
078250070427     c                   if        *in12='1' and *in15='0' and
078260070427     C                             flgtb1<>savtb1 and flgtb1='A'
078270070427     c                   clear                   wovuo1
078280070427     c                   endif
078290940824     C* personalizzazione
078300940824     C     WPERSO        IFEQ      'P'
078310940824     C                   SETON                                        21
078320940824     C                   ENDIF
078330940824     C*
078340940928     C     ENDCCB        TAG
078350940824     C   90              MOVEL     '1'           WEMFOR
078360940824     C                   ENDSR
078370050214     C* CONTROLLO codice bolla --------------------------------------*
078380050214     C     CTRCBO_orm    BEGSR
078390060918    1C     *IN12         IFEQ      *OFF
078400091019    1C     *IN15         oreq      *On
078410091019     c     flgfit        andne     'S'
078420091019     c     §orpfb        andeq     'A'
078430060918     C* In manutenzione controllo solo se variato il numero ORM
078440060918     C     *IN15         OREQ      *OFF
078450060918     C     WORMMD        ANDEQ     '1'
078460081023     c* se bolla export dpd controllo anche se variato il codice bolla
078470081023     c     *in15         oreq      *off
078480081023     c     A_§ogntw      andeq     'DPD'
078490081023     c     vidcbo        andne     cbo_blp
078500050214      * Controllo il tipo bolla con quanto memorizzato sull'ORM
078510050214     c                   If        §OrPfb <> *Blanks and Flgtb1 <> §OrPfb
078520050214     c                             and flgfit <> 'S'
078530050214     c                   If        §OrPfb = 'F'
078540061124     c                             and wfortbo = *Blanks
078550061124     c                   Eval      VidMsg = Err(30)
078560050214     c                   Eval      %subst(VidMsg:34:9) = 'Franco   '
078570050214     c                   Eval      %subst(VidMsg:45:15) = 'ENTER X FORZARE'
078580061124     c                   Eval      *In46 = *On
078590061124     c                   Eval      *In90 = *On
078600050214     c                   Eval      WforTbo = '1'
078610050214     c                   EndIf
078620050214     c                   If        §OrPfb = 'A'
078630061124     c                   Eval      VidMsg = Err(30)
078640050214     c                   Eval      %subst(VidMsg:34:9) = 'Assegnato'
078650061124     c                   Eval      *In46 = *On
078660061124     c                   Eval      *In90 = *On
078670050214     c                   EndIf
078680050214     c                   EndIf
078690060918     c                   endif
078700050214     c                   endsr
078710081107     C* CONTROLLO codice bolla con cod. trattamento merce -----------*
078720081107     C     CTRCBO_ctm    BEGSR
078730081107     c* se cd. trattamento merce di recupero non posso usarlo con cod.
078740081107     c* bolla non di recupero a meno che non sia un codice bolla abili-
078750081107     c* tato
078760081107     c                   if        §1bfg8='N' and §3arbl<>'R'
078770081107     c                              and §3aurc=' '
078780081107     C                   MOVEL     ERR(318)      VIDMSG
078790081107     C                   SETON                                        4690
078800081107     c                   endif
078810081107     c                   endsr
078820940824     C*
078830940824     C* CONTROLLO LINEA DI ARRIVO -----------------------------------*
078840110217     C     CTRLNA_vid    BEGSR
078850110217     c
078860940824     C* NON E' STATA PERSONALIZZATA
078870940824    0C     *IN20         IFEQ      *OFF
078880940824     C*
078890940928     C                   CLEAR                   V1DLNA
078900940824     C* SOLO SE INSERITA, ALTRIMENTI LA CALCOLO IN AUTOMATICO
078910940824    1C     WLNA          IFNE      *BLANKS
078920940824     C     WLNA          ANDNE     *ZEROS
078930940824     C*
078940940824     C     '?'           SCAN      WLNA                                   30
078950940824     C*
078960940824    2C     *IN30         IFEQ      *ON
078970940824     C                   MOVE      *BLANKS       §COD1
078980940824     C                   MOVE      *BLANKS       WLNA
078990941230     C                   CALL      'TNSD19R'
079000940824     C                   PARM                    §COD1             3
079010940824     C                   PARM                    §TIP              1
079020940928     C                   PARM                    §DES
079030940824     C                   MOVEL     §COD1         WLNA
079040940928     C                   MOVEL     §DES          V1DLNA
079050940824     C                   MOVEL     '1'           WEMFOR
079060941011     C                   SETON                                        47
079070940824     C                   GOTO      ENDCLA
079080940824    2C                   ENDIF
079090110217     c
079100110217     c                   exsr      Ctrlna_Base
079110110217     c
079120110217     c* Se errore accendo indicatore di posizionamento cursore
079130110217     c                   if        *in90
079140110217     c                   seton                                        47
079150110217     C                   GOTO      ENDCLA
079160110217     c                   endif
079170940824     C*
079180991202     C* SE CAMBIATA
079190940824    2C     CO2LNA        IFNE      COMLNA
079200940824     C                   MOVEL     0             QUA
079210100209     C                   MOVEL     0             QUAH
079220040213     C**!!!              MOVEL     0             DIC
079230040213     C**!!!              MOVEL     0             VEN
079240940920     C                   MOVEL     COMLNA        CO2LNA
079250940824    2C                   END
079260940824     C* DESCRIZIONE
079270940824     C                   MOVEL     ORGDES        V1DLNA
079280940824     C* PERSONALIZZAZIONE
079290940824    2C     WPERSO        IFEQ      'P'
079300940824     C                   SETON                                        20
079310940824    2C                   ENDIF
079320940824     C*
079330940824   X1C                   ELSE
079340940824     C* LINEA NON IMMESSA
079350940824     C                   MOVEL     *BLANKS       V1DLNA
079360940824     C                   Z-ADD     0             COMLNA
079370020213     C                   CLEAR                   A_OG143
079380040525     C                   CLEAR                   A_OG150
079390940824     C* RICONTROLLO SEMPRE IL CAP
079400940824     C                   MOVEL     0             QUA
079410100209     C                   MOVEL     0             QUAH
079420940824    1C                   END
079430010220     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
079440010220     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
079450010220     C     WPERSO        IFEQ      'P'
079460010220     C     WORM          ANDEQ     'S'
079470010220     C     PARTCH        ANDNE     'P'
079480010220     C     FLGFIT        ANDNE     'S'
079490010220     C     WLNA          ANDGT     *ZEROS
079500010220     C                   MOVE      WLNA          W0030             3 0
079510010220     C     W0030         IFNE      ORMPOC
079520010220     C     ORMPOC        ANDGT     *ZEROS
079530010220     C                   SETON                                        9047
079540010220     C                   MOVEL     ERR(225)      VIDMSG
079550010220     C                   GOTO      ENDCLA
079560010220     C                   ENDIF
079570010220     C                   ENDIF
079580940928    0C                   END
079590940824     C*
079600940824     C     ENDCLA        TAG
079610940824     C   90              MOVEL     '1'           WEMFOR
079620940824     C                   ENDSR
079630110217     C*
079640110217     C* CONTROLLI di base 1° e 2° videata della linea di arrivo ------*
079650110217     c     CTRLNA_Base   BEGSR
079660110217     c
079670110217     C                   TESTN                   WLNA                 30
079680110217     C                   MOVE      WLNA          W001A             1
079690110217    2C     *IN30         IFEQ      *OFF
079700110217     C     W001A         ORLT      '0'
079710110217     C                   MOVEL     ERR(12)       VIDMSG
079720110217     C                   SETON                                        90
079730110217     C                   leavesr
079740110217    2C                   ENDIF
079750110217     c
079760110217     c* Se in immissione prepagati e lna Portogallo o Spagna errore
079770110217     c                   if        (partch='P' or §lpfpr='O') and
079780120608     c                             (wlna='340' or wlna='345' or wlna='341')
079790120608     c                             and (wccm=8888 or wccm=0)
079800110217     C                   SETON                                        90
079810110217     C                   MOVEA     ERR(311)      K78
079820110217     C                   MOVE      wlna          W003A             3
079830110217     C                   MOVEA     W003A         K78(17)
079840110217     C                   MOVEA     K78           VIDMSG
079850110217     C                   leavesr
079860110217     c                   endif
079870110217     C*
079880110217    2C     WLNA          IFGT      *ZEROS
079890110217     C                   MOVEL     WLNA          COMLNA
079900110217     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
079910110217     C                   ELSE
079920110217     C                   SETON                                        30
079930110217    2C                   END
079940110217     C*
079950110217     C* CONTROLLO SE ANNULLATO
079960110217     C* CONSIDERO SOLO I TIPI "F" E "A"
079970110217    2C  N30ORGFVA        IFNE      *BLANKS
079980110217    2C     ORGFAG        ORNE      'F'
079990110217     C     ORGFAG        ANDNE     'A'
080000110217     C                   SETON                                        30
080010110217    2C                   END
080020110217     C* CONTROLLO CHE NON SIA UNA LINEA BLOCCATA
080030110217     C                   MOVEL     ORGDE8        OG148
080040110217     C     §OGLBL        IFEQ      'N'
080050110217     C                   SETON                                        30
080060110217    2C                   END
080070110217     C*
080080110217    2C     *IN30         IFEQ      *ON
080090110217     C                   MOVEL     ERR(12)       VIDMSG
080100110217     C                   SETON                                        90
080110110217     C                   leavesr
080120110217    2C                   ENDIF
080130110217     c
080140110217     C* TERMINAL DI ARRIVO
080150110217     C                   CLEAR                   DSLV55
080160110217     C                   MOVEL     'A'           D55TPT
080170110217     C** PER POSTE DEVO PASARE LA LINEA E NON IL TERMINAL
080180110217     C                   MOVEL     VIDLNP        D55LNP
080190110217     C**
080200110217     C                   MOVEL     COMLNA        D55LIN
080210110217     C                   MOVEL     BLPDSP        D55DRF
080220110217     C                   CALL      'FNLV55R'
080230110217     C                   PARM                    DSLV55
080240110217     C     D55ERR        IFEQ      ' '
080250110217     C                   MOVEL     D55TFA        COMTFA
080260110217     C                   ELSE
080270110217     C                   SETON                                        90
080280110217     C                   MOVEL     ERR(212)      VIDMSG
080290110217     C                   leavesr
080300110217     C                   ENDIF
080310110217     C*
080320110217     C                   MOVEL     ORGDE3        A_OG143
080330110217     C                   MOVEL     ORGDF0        A_OG150
080340110217     c                   ENDSR
080350940824     C*
080360940824     C* CONTROLLO TIPO SERVIZIO --------------------------------------*
080370940824     C     CTRTSP        BEGSR
080380940824     C* SOLO SE NON PERSONALIZZATO
080390941107    0C     *IN18         IFEQ      *OFF
080400941107     C                   SETOFF                                       09
080410940824     C                   CLEAR                   V1DTSP
080420940824     C*
080430080327     c                   clear                   NOutiTSP          1
080440940824    1C     WTSP          IFNE      *BLANKS
080450940922     C                   MOVEL     '5E'          COD
080460940922     C* RICERCA
080470940824    2C     WTSP          IFEQ      '?'
080480940922     C                   EXSR      CX§TAB
080490940824     C                   MOVEL     §KEY          WTSP
080500090604     C**!!!              MOVEL     §DES          V1DTSP
080510090604     C                   Z-ADD     1             C
080520090604     C     WTSP          LOOKUP    TSP(C)                                 30
080530090604    2C                   IF        *in30
080540090604     C                   MOVEL     DTS08(C)      V1DTSP
080550090604     c                   else
080560090604     c                   clear                   v1dtsp
080570090604     c                   endif
080580941011     C                   SETON                                        48
080590940824     C                   GOTO      ENDCSP
080600940824    2C                   END
080610940922     C* CONTROLLO
080620941107     C                   Z-ADD     1             C
080630941107     C     WTSP          LOOKUP    TSP(C)                                 30
080640940922     C* ERRORE
080650941107    2C     *IN30         IFEQ      *OFF
080660940824     C                   MOVEL     ERR(15)       VIDMSG
080670940929     C                   SETON                                        4890
080680940824     C                   MOVEL     '1'           WEMFOR
080690940824     C                   GOTO      ENDCSP
080700940824    2C                   ENDIF
080710940824     C*
080720090604     C**!!!              MOVEL     DTS(C)        V1DTSP
080730090604     C**!!!              MOVEL     DTS(C)        V2DTSP
080740090604     C                   MOVEL     DTS08(C)      V1DTSP
080750090604     C                   MOVEL     DTS08(C)      V2DTSP
080760941102     C*
080770941102     C* DEVE ESSERE UTILIZZABILE IN BOLLETTAZIONE
080780080327     c                   clear                   NOutiTSP          1
080790941107    2C     UTS(C)        IFNE      'S'
080800080327     C* IN IMMISSIONE  SEMPRE ERRORE
080810941108   3 C     *IN12         IFEQ      *OFF
080820080327     c* per  disk clienti se non utilizzabile do errore solo se
080830080327     c*    diverso da tariffa e  quindi posticipo il controllo
080840080326     C**** *IN12         OREQ      *OFF
080850080327     C**** *IN15         ANDEQ     *ON
080860941107     C* IN MANUTENZ SOLO SE E' CAMBIATO
080870941107     C     *IN12         OREQ      *ON
080880941107     C     *IN15         ANDEQ     *OFF
080890941107     C     WTSP          ANDNE     BLPTSP
080900941107     C*
080910941102     C                   MOVEL     ERR(15)       VIDMSG
080920941102     C                   SETON                                        4890
080930941102     C                   MOVEL     '1'           WEMFOR
080940941102     C                   GOTO      ENDCSP
080950941108    3C                   ENDIF
080960080327     c
080970080327     c                   if        *in12 and *in15
080980080327     c                   eval      NOutiTSP='N'
080990080327     c                   endif
081000080327     c
081010941108    2C                   ENDIF
081020080327     c
081030120302     C* VEDO SE VALIDO PER POSTE, BRT/SDI
081040000509     C     USO(C)        IFEQ      'P'
081050020319     C     §ogntw        ANDNE     'PPT'
081060000509     C                   MOVEL     ERR(194)      VIDMSG
081070000509     C                   SETON                                        4890
081080000509     C                   MOVEL     '1'           WEMFOR
081090000509     C                   GOTO      ENDCSP
081100000509    3C                   ENDIF
081110000509     C     USO(C)        IFEQ      'E'
081120020319     C     §ogntw        ANDEQ     'PPT'
081130000509     C                   MOVEL     ERR(194)      VIDMSG
081140000509     C                   SETON                                        4890
081150000509     C                   MOVEL     '1'           WEMFOR
081160000509     C                   GOTO      ENDCSP
081170000509    3C                   ENDIF
081180100209     c
081190100209     c* Se modifico pulisco i flag di controllo linea di arrivo
081200100209     c                   if        wtsp<>sa2tsp
081210100209     c                   clear                   qua
081220100209     c                   clear                   quaH
081230100209     c                   eval      sa2tsp=wtsp
081240100209     c                   endif
081250100319     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
081260100319     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
081270100319     C     WPERSO        IFEQ      'P'
081280100319     C     WORM          ANDEQ     'S'
081290100319     C     PARTCH        ANDNE     'P'
081300100319     C     FLGFIT        ANDNE     'S'
081310100319     C     WesORE        ANDeq     'S'
081320100319     C     Wtsp          ANDne     ' '
081330100319     C     wtsp          andne     §oretsp
081340100319     C                   SETON                                        9048
081350100319     C                   MOVEL     ERR(76)       VIDMSG
081360100319     C                   GOTO      ENDCSP
081370100319     C                   ENDIF
081380000509     C*
081390940824     C* PERSONALIZZAZIONE
081400940824    2C     WPERSO        IFEQ      'P'
081410940922     C                   SETON                                        18
081420940824    2C                   ENDIF
081430940824     C*
081440941107   X1C                   ELSE
081450941107     C                   SETON                                        09
081460940824    1C                   ENDIF
081470941107    0C                   ENDIF
081480940824     C*
081490940824     C     ENDCSP        ENDSR
081500940824     C*
081510940824     C* CONTROLLO CODICE TRATTAMENTO MERCE --------------------------*
081520940824     C     CTRCTM        BEGSR
081530950504     C* NON E' CAMBIATO IL CTM
081540950504     C     WCTM          IFNE      SAVCTM
081550940824     C                   CLEAR                   V1DCTM
081560940824     C* RICERCA
081570940922     C                   MOVE      '1B'          COD
081580940824     C     '?'           SCAN      WCTM                                   30
081590940922     C* RICERCA
081600940824    1C     *IN30         IFEQ      *ON
081610940922     C                   EXSR      CX§TAB
081620940824     C                   MOVEL     §KEY          WCTM
081630941011     C                   SETON                                        49
081640940824     C                   GOTO      ENDCTM
081650940824    1C                   END
081660940922     C* COTROLLO
081670940920     C                   MOVEL(P)  WCTM          KEY
081680940824     C                   EXSR      CTABEL
081690940922     C* ERRORE
081700940824    1C     *IN30         IFEQ      *ON
081710940824     C                   MOVEL     ERR(16)       VIDMSG
081720940920     C                   SETON                                        4990
081730940824     C                   GOTO      ENDCTM
081740940824    1C                   ENDIF
081750940824     C*
081760940824     C                   MOVEL     TBLUNI        DS1B
081770940824     C*
081780940824     C* FLAG2 >< "S" (NUM SPEDIZIONE DAL CLIENTE) IN IMMISSIONE
081790940824    1C  N12§1BFG2        IFEQ      'S'
081800100208     C                   MOVEL     ERR(16)       VIDMSG
081810940920     C                   SETON                                        4990
081820940824     C                   GOTO      ENDCTM
081830940824    1C                   END
081840940824     C*
081850940824     C* IN RECUPERO SOLO CTM DA MAGAZZINO
081860990602    1C  N12PARTCH        IFEQ      'R'
081870940824     C     §1BFG6        ANDNE     'M'
081880940824     C                   MOVEL     ERR(16)       VIDMSG
081890940920     C                   SETON                                        4990
081900940824     C                   GOTO      ENDCTM
081910940824    1C                   END
081920940824     C* IM IMMISSIONE NON POSSO USARE CTM CON FLG7=S
081930940824    1C  N12§1BFG7        IFEQ      'S'
081940940824     C                   MOVEL     ERR(16)       VIDMSG
081950940920     C                   SETON                                        4990
081960940824     C                   GOTO      ENDCTM
081970940824    1C                   END
081980000911     C*
081990000919     C* POSSO USARE CTM DISK C SOLO SE TERMINAL ABILITATO
082000001106     C* NON FACCIO QUESTO CONTROLLO SE FLAG 12 = 'E'. IN QUESTO CASO
082010001106     C* INFATTI DEVE ESSERE POSSIBILE BOLLETTARE SEMPRE E SE TERMINAL
082020001106     C* NON AIBLITATO NON LO CONSIDERERO' UN DISK C
082030000904     C     §1BF12        IFNE      'N'
082040001106     C     §1BF12        ANDNE     'E'
082050000904     C     WASDKC        ANDNE     'S'
082060000904     C                   MOVEL     ERR(206)      VIDMSG
082070000904     C                   SETON                                        4990
082080000904     C                   GOTO      ENDCTM
082090000904     C                   ENDIF
082100000911     C*
082110000919     C                   MOVEL     '3C'          COD
082120000919     C                   MOVEL(P)  WKSC          KEY
082130000919     C                   CLEAR                   DS3C
082140000919     C                   EXSR      CTABEL
082150000919     C  N30              MOVEL     TBLUNI        DS3C
082160000911     C*
082170940824     C* CONTROLLO SE PREVEDE L'ASSEGNAZIONE DEI SEGNACOLLI IN AUTOMATIC
082180980424     C                   SETOFF                                       25
082190940824    1C     §1BFG6        IFEQ      'D'
082200940824     C     §1BFG6        OREQ      'I'
082210940824     C     §1BFG6        OREQ      'N'
082220940824     C                   SETON                                        25
082230940824    1C                   END
082240950504     C* SALVO IL CTM
082250950504     C                   MOVEL     WCTM          SAVCTM
082260940824     C*
082270940824     C     ENDCTM        TAG
082280940824     C   90              MOVEL     '1'           WEMFOR
082290950504     C   90              CLEAR                   SAVCTM
082300940824    0C                   ENDIF
082310940824     C                   ENDSR
082320940824     C*
082330940824     C* CONTROLLO CODICE CLIENTE -------------------------------------*
082340940824     C     CTRCCM        BEGSR
082350000201     C*
082360940825    0C     *IN19         IFEQ      *OFF
082370990610     C     WCOCCM        OREQ      'S'
082380950303     C                   SETOFF                                       02
082390020319     c                   clear                   clintw
082400940922     C                   CLEAR                   MITVLT
082410940920     C* 19 ON - MITTENTE PERSONALIZZATO
082420950209     C     WFLC          IFEQ      WLNP
082430950209     C                   SETOFF                                       14
082440020319     C                   MOVEL     §ogntw        CLIntw
082450950209     C                   ELSE
082460950209     C                   SETON                                        14
082470000201     C**
082480020306     c     wccm          ifeq      8888
082490020507     c     wccm          oreq      9999
082500020306     C                   SETON                                        9050
082510020306     C                   MOVEL     ERR(81)       VIDMSG
082520020306     C                   GOTO      ENDCCM
082530020306     c                   endif
082540051207     C* Imposto campo del codice
082550051207     C                   MOVEL     WFLC          WKSC
082560051207     C                   MOVE      WCCM          WKSC
082570051207     C*
082580000201     C* CONTROLLO SE CLIENTE DPD
082590000201     C     WFLC          CHAIN     AZORG01L      UNIORG               30
082600000201     C                   MOVEL     OG143         SAV143
082610000201     C                   MOVEL     ORGDE3        OG143
082620020319     C     §OGNTW        IFEQ      'DPD'
082630010103     C     SAVFPR        IFNE      'P'
082640010103     C     SAVFPR        ANDNE     'G'
082650010319     C     WSIDPD        ANDEQ     'S'
082660051207     c* Possibile linea diversa solo se prevista da tabella 3TR
082670051207     c                   clear                   tntb50ds
082680051207     C                   movel     wksc          b50ke2
082690051207     C*
082700051207     c                   movel     b50ke2        b50ke1
082710051207     c                   movel     'C'           b50opz
082720051207     c                   movel     wlnp          b50poa
082730051207     c                   call      'TNTB51R'
082740051207     c                   parm                    kpjba
082750051207     c                   parm                    tntb50ds
082760051207     c
082770051207     c                   if        b50err<>' '
082780001212     C                   SETON                                        9045
082790001212     C                   MOVEL     ERR(215)      VIDMSG
082800001212     C                   GOTO      ENDCCM
082810010103     C                   ENDIF
082820051207     c
082830051207     C                   ENDIF
082840000201     C                   ENDIF
082850020319     C                   MOVEL     §OGntw        CLINTW
082860040930     c* errore se network cliente è logistica o sede
082870040930     c     clintw        ifeq      'LOG'
082880040930     c     clintw        oreq      'XXX'
082890040930     C                   SETON                                        9051
082900040930     C                   MOVEL     ERR(284)      VIDMSG
082910040930     C                   GOTO      ENDCCM
082920040930     c                   endif
082930000201     C                   MOVEL     SAV143        OG143
082940950209     C                   ENDIF
082950051207     C* Imposto campo del codice
082960051207     C                   MOVEL     WFLC          WKSC
082970051207     C                   MOVE      WCCM          WKSC
082980940928     C                   Z-ADD     KCI           CCC
082990940824     C     KACO          CHAIN     CNACO000                           30
083000940824     C* ANNULLATO
083010940921    2C  N30ACOFLG        IFEQ      '*'
083020940824     C                   SETON                                        30
083030940921    2C                   END
083040940824     C*
083050940921    2C     *IN30         IFEQ      *ON
083060940824     C                   MOVEL     ERR(22)       VIDMSG
083070940922     C                   SETON                                        9050
083080940824     C                   GOTO      ENDCCM
083090940921    2C                   ENDIF
083100940824     C* FLAG=8 NON SPEDISCE - NO BOLLE
083110130312    2C***  ACOABL        IFEQ      '8'
083120130312    2C***  ACOABL        OREQ      '*'
083130130312    2C     ACOABL        IFne      *blanks
083140940824     C                   MOVEL     ERR(23)       VIDMSG
083150940922     C                   SETON                                        9050
083160940824     C                   GOTO      ENDCCM
083170940921    2C                   END
083180941011     C*
083190941011     C                   MOVEL     ACORAG        VIDDMT
083200940824     C*
083210940921    2C     WCCM          IFNE      8888
083220940909     C     WCCM          ANDNE     9999
083230940824     C     KACO          CHAIN     CNIND000                           30
083240940921    3C     *IN30         IFEQ      *ON
083250940824     C                   MOVEL     ERR(22)       VIDMSG
083260940922     C                   SETON                                        9050
083270940921    3C                   ENDIF
083280000509     C* PER BOLLA LNP POSTE, AMMESSI SOLO CLIENTI POSTE E VICEVERSA
083290020319     c     §ogntw        ifeq      'PPT'
083300020319     c     clintw        oreq      'PPT'
083310020319     C     §ogntw        IFNE      clintw
083320000509     C                   MOVEL     ERR(200)      VIDMSG
083330000509     C                   SETON                                        9050
083340020319     c                   endif
083350000509    3C                   ENDIF
083360000509     C*
083370970703     C* CONTROLLO LA NAZIONE
083380970703     C* VISTO CHE E' UN CODIFICATO PRENDO LA DIVISA CHE MI PUO' SERVIRE
083390970703     C*  PER L'IMPORTO DA ASSICURARE O VALORE MERCE DICHIARATO
083400970703     C                   MOVEL     '15'          COD
083410970703     C                   MOVEL(P)  INDSTA        KEY
083420970703     C                   EXSR      CTABEL
083430970703     C* NAZIONE ERRATA
083440970703    3C     *IN30         IFEQ      *ON
083450970703     C                   MOVEL     ERR(28)       VIDMSG
083460970703     C                   SETON                                        9050
083470970703   X3C                   ELSE
083480970703     C                   MOVEL     TBLUNI        DS15
083490970703     C                   MOVEL     §15VLT        MITVLT
083500970703    4C     §15ITA        IFNE      'I'
083510970703     C                   MOVEL     'E'           WMITIE            1
083520970703     C                   ELSE
083530970703     C                   MOVEL     'I'           WMITIE
083540970703    4C                   ENDIF
083550970703    3C                   ENDIF
083560970704     C*
083570970704     C* controllo se esiste in anagrafica la provincia
083580970704     C* SOLO SE NAZIONE ITALIA CIOE' ='   '
083590970704     C     INDSTA        IFEQ      *BLANKS
083600970704    3C     INDPRV        ANDEQ     *BLANKS
083610970704     C                   MOVEL     ERR(128)      VIDMSG
083620970704     C                   SETON                                        9050
083630970704     C                   GOTO      ENDCCM
083640100120    3C                   ENDIF
083650970703     C*
083660970703     C* CAP OBBLIGATORIO : CONTROLLO
083670970703     C                   CLEAR                   DSSI95
083680970708     C                   CLEAR                   DSLV13
083690970703     C                   MOVEL     '3'           I95TCN
083700970703     C                   MOVEL     INDCAE        I95CAP
083710970703     C                   MOVEL     INDSTA        I95NAR
083720970703     C                   MOVEL     INDPRV        I95PRV
083730970703     C                   MOVEL     INDCIT        I95LOC
083740970714     C                   MOVEL     BLPDSP        I95DAT
083750971201     C     §3AFCA        IFNE      0
083760971201     C                   MOVEL     'S'           I95FCA
083770971201     C                   ENDIF
083780971201     C                   MOVEL     FLGTB1        I95TPO
083790970708     C* ERRORE AFFIDABILITA = 0
083800970708     C                   MOVEL     'S'           I13AF0
083810970708     C* CONTROLLO CONGRUENZA CAP PROVINCIA
083820970708     C                   MOVEL     'S'           I13CNG
083830970708     C* CONTROLLO NON FORZABILE CITTA' CON VIARIO
083840100120     C*******            MOVEL     'S'           I13CNV
083850020212     c*
083860020212     c* mittente fedex passo flag apposito per dire di prendere i dati i
083870020212     c* dalla tabella della nazione
083880020212     c     §ogntw        ifeq      'FED'
083890020212     c                   movel     'S'           i95fi1
083900020212     c                   endif
083910970703     C                   CALL      'FNLV13R'
083920970708     C                   PARM                    KPJBA
083930970708     C                   PARM                    DSLV13
083940970708     C                   PARM                    DSSI95
083950941230     C* ERRORE
083960970708     C     O13ERR        IFNE      *BLANKS
083970970708     C                   MOVEL     O13MSG        W077A            77
083980970703     C* IMPOSTO IL MESSAGGIO METTENDO VICIVO LA SCRITTA:
083990970703     C*   "SUL PIANO DEI CONTI"
084000970703     C                   CLEAR                   K78
084010970703     C                   MOVEA     W077A         K78
084020970703     C     ' '           CHECKR    W077A         WP                2 0
084030970703     C                   ADD       2             WP
084040970703     C     WP            IFLT      61
084050970703     C                   MOVEA     CPDC          K78(WP)
084060970703     C                   MOVEA     K78           VIDMSG
084070970703     C                   ELSE
084080970703     C                   MOVEL     O95MSG        VIDMSG
084090970703     C                   MOVE      CPDC          VIDMSG
084100970703     C                   ENDIF
084110940922     C                   SETON                                        9050
084120941231     C                   GOTO      ENDCCM
084130941231    3C                   ENDIF
084140941230     C* SALVO IL FLAG ANTEPORTO
084150970703     C                   MOVEL     O95ISO        COMFAP
084160970708     C                   MOVEL     O95ISO        VIDFAP
084170970708     C                   MOVEL     O95CTS        MITCTS
084180940922     C*
084190940921    2C                   ENDIF
084200940824     C*
084210940824     C   90              GOTO      ENDCCM
084220940824     C*
084230940921     C* PER MANUTENZIONE O DISK CLI OBBLIGATORIO IL COD.CLI ORIGINALE
084240960805     C* OPPURE UN CODICE CLIENTE CON LA STESSA SERIE
084250980410    1C   12§1BFG6        IFEQ      'C'
084260940824     C     §1BFG7        OREQ      'S'
084270940909    2C     WKSC          IFNE      SAVMIT
084280100517     c
084290960805     C*
084300100517     C**                 MOVEL     '3C'          COD
084310100517     C**                 MOVEL(P)  WKSC          KEY
084320960805     C*
084330100517     C**                 EXSR      CTABEL
084340100517     C**N30              MOVEL     TBLUNI        DS3C
084350960805     C*
084360100517    3C**   *IN30         IFEQ      *ON
084370100517     C**   §3CNRS        ORNE      VIDNRS
084380980805     C* E' VALIDA LA 3C SOLO SE HA L'ASTERISCO
084390100517     C**   §3COKD        ORNE      '*'
084400100517     C**                 MOVEL     ERR(67)       VIDMSG
084410100517     C**                 SETON                                        5090
084420100517    3C**                 ENDIF
084430100517     c
084440100517     c                   clear                   trulnrsds
084450100517     c                   movel     wksc          inrsCCM
084460100517     c                   movel     vidnrs        inrsNRS
084470100517     c                   movel     wfls          inrsFLS
084480100517     c
084490100517     c                   call      'TRULNRSR'
084500100517     c                   parm                    trulnrsds
084510100517     c                   if        onrserr<>' '
084520100517     C                   MOVEL     ERR(67)       VIDMSG
084530100517     C                   SETON                                        5090
084540100517    3C                   endif
084550100517     c
084560960805    2C                   END
084570940825    1C                   END
084580940825     C*
084590940825     C   90              GOTO      ENDCCM
084600940825    0C                   ENDIF
084610940824     C*
084620940824     C* CONTROLLI CODICE BOLLA CON CODICE CLIENTE
084630940825    0C     WCBO          IFNE      *BLANKS
084640941103    1C  N04WCCM          IFEQ      9999
084650940824     C                   MOVEL     ERR(11)       VIDMSG
084660940922     C                   SETON                                        5090
084670940825    1C                   END
084680940824     C* SE ASSEGNATO
084690940909    1C   04WCCM          IFEQ      8888
084700940824     C                   MOVEL     ERR(11)       VIDMSG
084710940922     C                   SETON                                        5090
084720940825    1C                   ENDIF
084730940824     C*
084740940824     C   90              GOTO      ENDCCM
084750940825    0C                   ENDIF
084760950125     C*
084770950125     C* SE E' FRANCO NON  SI PUO' TASSARE CON TARIFFA MITTENTE
084780990720    0C  N04WCBO          IFNE      *BLANKS
084790990720     C     WFTM          ANDEQ     'S'
084800950717     C                   MOVEL     ERR(119)      VIDMSG
084810950125     C                   SETON                                        5090
084820950125     C                   GOTO      ENDCCM
084830990720    0C                   ENDIF
084840940825     C*
084850020507     C* SE 8888 O 9999
084860940909    0C     WCCM          IFEQ      8888
084870940909     C     WCCM          OREQ      9999
084880940825     C*
084890950125     C* NON E' POSSIBILE IMMETTERE TASSAZIONE CON TAR MIT
084900940825    1C     WFTM          IFEQ      'S'
084910950717     C                   MOVEL     ERR(119)      VIDMSG
084920940922     C                   SETON                                        5090
084930940825     C                   GOTO      ENDCCM
084940940825    1C                   ENDIF
084950940921     C*
084960940921     C* SE PRIMA ERA CODIFICAT E ADESSO NO PULISCO I CAMPI DEL MITTENTE
084970990720    1C     WCCM          IFNE      WCCMS
084980950125     C                   CLEAR                   V2DTEL
084990940921     C*
085000940921     C* NON PULISCO SE CAMBIATO CODICE DA 8888 A 9999 O VICEVERSA
085010020507     C     WCCMS         ifNE      9999
085020940921     C     WCCMS         ANDNE     8888
085030010213     C*
085040940921     C                   CLEAR                   VIDRSM
085050940921     C                   CLEAR                   VIDLOM
085060940921     C                   CLEAR                   VIDINM
085070940921     C                   CLEAR                   VIDCAM
085080940921     C                   CLEAR                   VIDPRM
085090940921     C                   CLEAR                   VIDNZM
085100940921     C                   CLEAR                   VIDPIM
085110940921     C                   CLEAR                   VIDFAP
085120061110     C                   CLEAR                   VIDcdf
085130020507     c
085140990720    2C                   ENDIF
085150940921     C                   MOVEL     WCCM          WCCMS
085160990720    1C                   ENDIF
085170020507     c* se richiesta bolla firmata i dati del mittente sono quelli del
085180020507     c* p.o. mittente
085190020513     c     vidcbo        ifeq      'FO'
085200020507     c     wflc          chain     azorg01l      uniorg               30
085210020507     c                   movel     orgdes        vidrsm
085220020507     c                   movel     orgind        vidinm
085230020507     c                   movel     orgcpf        vidcam
085240020507     c                   movel     orgloc        vidlom
085250020507     c                   movel     orgpro        vidprm
085260020507     c                   endif
085270000113     C* SE E' IN PERSONALIZZAZIONE, RIPROTEGGO, E PROTETTO
085280000113     C   19              SETON                                        02
085290940825     C*
085300940825   X0C                   ELSE
085310110519     c* in immissione controllo se per il cliente mittente sono
085320110519     c* presenti bolle da confermare
085330110519     c* Se ce ne sono: messaggio forzabile
085340110519    3c                   if        not *in12
085350110519     c                   exsr      sr_chkvab
085360110519     c                   if        wemfor='1'
085370110519     c                   goto      endccm
085380110519     c                   endif
085390110519    3c                   endif
085400960926     C* SE TUTTO OK E NON E' 8888 O 9999 E CLIENTE DI ALTRO P.O.
085410940921     C* PROTEGGO IL MITTENTE E MEMORIZZO I CAMPI
085420940909     C*
085430940825     C                   SETON                                        02
085440990720    1C     WPERSO        IFEQ      'P'
085450950303     C                   SETON                                        19
085460990720    1C                   END
085470940909     C                   MOVEL     ACORAG        VIDRSM
085480940909     C                   MOVEL     INDCIT        VIDLOM
085490940909     C                   MOVEL     INDVIA        VIDINM
085500941005     C                   MOVEL     INDCAE        VIDCAM
085510940909     C                   MOVEL     INDPRV        VIDPRM
085520940909     C                   MOVEL     INDSTA        VIDNZM
085530940909     C                   MOVEL     INDIVA        WISO
085540990720    1C     WISO          IFGE      '00'
085550940909     C                   MOVEL     INDIVA        VIDCPM
085560120504     C                   clear                   VIDism
085570940909     C                   ELSE
085580940909     C                   MOVEL     INDIVA        VIDPIM
085590990720    1C                   END
085600120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
085610120508     c* in contabilità crea problemi
085620120508     c                   if        *in22 and wiso='$$'
085630120508     c                   clear                   vidpim
085640120508     c                   endif
085650061110     c   22              movel     indcdf        vidcdf
085660950123     C*
085670950123     C                   MOVE      INDTEL        V2DTEL
085680950123     C                   MOVEL     'Tel.'        V2DTEL
085690940825    0C                   ENDIF
085700940824     C* OK
085710940825    0C     WPERSO        IFEQ      'P'
085720950303     C                   SETON                                        85
085730940825    0C                   END
085740990720     C                   CLEAR                   WCOCCM
085750110921     c* accedo a tabella "CLI" del cliente mittente
085760080104     c                   clear                   dcli
085770110921     c****               if        *in12 and not *in15 and
085780110921     c*****                        vidnrs>0
085790071218     c                   exsr      sr_dcli
085800110922     c****               endif
085810061110     c
085820061110     c* se no prepagato solo sottolineato il campo del codice fiscale
085830061110     c  n22              movel     ul            atrcdf
085840940824     C*
085850940824     C     ENDCCM        TAG
085860940824     C   90              MOVEL     '1'           WEMFOR
085870940824     C                   ENDSR
085880941103     C*
085890941103     C* CONTROLLO IL MITTENTE ORIGINALE ------------------------------*
085900941103     C     CTRMO         BEGSR
085910941103     C*
085920941103    0C     *IN03         IFEQ      *OFF
085930941103     C*
085940941103     C* SE IMMESSO CAP O NAZIONE IMMETTERE TUTTI E 3
085950941103    1C     WCMO          IFNE      *BLANKS
085960950206     C     WRMO          ANDEQ     *BLANKS
085970941103     C                   MOVEL     ERR(100)      VIDMSG
085980941103     C                   SETON                                        7190
085990941103     C                   GOTO      ENDCMO
086000941103    1C                   ENDIF
086010941103     C*
086020941103    1C     WNAR          IFNE      *BLANKS
086030941103    2C     WCMO          IFEQ      *BLANKS
086040941103     C     WRMO          OREQ      *BLANKS
086050941103     C                   MOVEL     ERR(100)      VIDMSG
086060941103     C                   SETON                                        7190
086070941103     C                   GOTO      ENDCMO
086080941103    2C                   ENDIF
086090941103    1C                   ENDIF
086100941103     C*
086110941103     C* CONTROLLO NAZIONE MITTENTE ORIGINALE
086120941103    1C     WNAR          IFNE      *BLANKS
086130941103     C                   EXSR      CTRNAR
086140941103    2C     WEMFOR        IFEQ      '1'
086150941103     C                   SETOFF                                       68
086160941103     C                   SETON                                        73
086170941103     C                   GOTO      ENDCMO
086180941103    2C                   END
086190950215    1C                   END
086200941103     C*
086210941103     C* CONTROLLO ESISTENZA CAP MITTENTE ORIGINALE
086220950215    1C     WCMO          IFNE      *BLANKS
086230970708     C**
086240970708     C* CAP CON VIARIO --> ERRORE FORZABILE
086250970708    2C     WCMO          IFNE      VARCMO
086260970708     C                   CLEAR                   DUE
086270970708     C                   MOVEL     WCMO          VARCMO
086280970708    2C                   ENDIF
086290970708     C**
086300970704     C                   CLEAR                   DSSI95
086310970708     C                   CLEAR                   DSLV13
086320970704     C                   MOVEL     WNAR          I95NAR
086330970704     C                   MOVEL     WCMO          I95CAP
086340970704     C                   MOVEL     '3'           I95TCN
086350970708     C* NON POSSO DARE ERRORE PER AFFIDABILITA=0 PERCHE' NON HO LA
086360970708     C*  PROVINCIA
086370970708     C                   MOVEL     'S'           I13CNV
086380970708     C                   MOVEL     'S'           I13SZV
086390970708     C                   MOVEL     DUE           E13FZV
086400970704     C                   CALL      'FNLV13R'
086410970708     C                   PARM                    KPJBA
086420970708     C                   PARM                    DSLV13
086430970708     C                   PARM                    DSSI95
086440970708     C* FLAG FORZATURA
086450970708     C                   MOVEL     E13FZV        DUE
086460941103     C*
086470941103     C* SE CAP NON TROVATO  ERRORE
086480970708    2C     O13ERR        IFNE      *BLANKS
086490970708     C                   MOVEL     O13MSG        VIDMSG
086500941103     C                   SETON                                        7290
086510941103     C                   GOTO      ENDCMO
086520970704    2C                   ENDIF
086530941103     C*
086540941103    1C                   ENDIF
086550941103     C*
086560941103     C     WPERSO        IFEQ      'P'
086570941103     C                   SETON                                        03
086580941103     C                   ENDIF
086590941103     C*
086600941103     C     ENDCMO        TAG
086610941103     C   90              MOVEL     '1'           WEMFOR
086620941103    0C                   ENDIF
086630941103     C*
086640941103     C                   ENDSR
086650940913     C*
086660940913     C* CONTROLLO CONSEGNA RICHIESTA ---------------------------------*
086670940913     C     CTRCR         BEGSR
086680940913     C*
086690940913    1C     *IN16         IFEQ      *OFF
086700971007    2C     WDCR          IFEQ      0
086710940913     C                   Z-ADD     0             COMDCR
086720940913     C* DATA
086730971007   X2C                   ELSE
086740940913     C                   Z-ADD     WDCR          G02DAT
086750940913     C                   MOVEL     *BLANKS       G02ERR
086760940913     C                   CALL      'XSRDA8'
086770941115     C                   PARM                    WLBDAT
086780941115     C* ERRORE
086790940913    3C     G02ERR        IFEQ      '1'
086800940913     C                   MOVEL     ERR(19)       VIDMSG
086810941102     C                   SETON                                        5990
086820940913     C                   GOTO      ENDCR
086830940913    3C                   END
086840940913     C*  SE CAMBIATA LA DATA CONSEGNA RICHIESTA PULISCO LA FORZATURA
086850940913    3C     G02INV        IFNE      COMDCR
086860940913     C                   MOVEL     ' '           UNO
086870030417     c                   Clear                   fordcr
086880940913    3C                   ENDIF
086890940916     C*
086900940913     C                   MOVE      G02INV        COMDCR            8 0
086910940916     C                   MOVE      G02DAT        WDCR
086920940913     C*
086930940913     C* SE < ALLA DATA SPEDIZIONE: ERRORE
086940940913    3C     COMDCR        IFLT      BLPDSP
086950940916     C                   MOVEL     ERR(19)       VIDMSG
086960941102     C                   SETON                                        5990
086970940913     C                   GOTO      ENDCR
086980940913    3C                   ENDIF
086990101022     c* Verifico che non cada in giorno festivo per "IL"
087000101022     c* In personalizzazione lo posso fare solo col calendario partenza
087010101022     c                   if        WPERSO='P' and   wtcr=' '
087020101022     c                   movel     comdcr        wdata
087030101022     C                   CLEAR                   W0030
087040101022     C     KCLN          CHAIN     AZCLN01L                           30
087050101022     C   30              CLEAR                   CLNPOM
087060101022     C                   MOVEA     CLNPOM        K31
087070101022     C                   MOVEL     K31(WGG)      WFEST
087080101022     c     wfest         lookup    S1Y                                    30
087090101022     c
087100101022    4c                   if        *in30 and wfest<>' '
087110101022     C                   MOVEL     ERR(197)      VIDMSG
087120101022     C                   SETON                                        5990
087130101022     C                   GOTO      ENDCR
087140101022    4c                   endif
087150101022    3c                   endif
087160940913     C*
087170940913     C* 16 ON - PERSONALIZZAZIONE
087180940913    3C     WPERSO        IFEQ      'P'
087190940913     C                   SETON                                        16
087200940913    3C                   ENDIF
087210940913    2C                   ENDIF
087220940913    1C                   ENDIF
087230030409
087240051214      **Se sono in personalizzazione controllo che la data consegna
087250051214      **richiesta non sia superiore a oggi + i giorni previsti in §vpodcg
087260051214     c***                If        Wperso = 'P' and ComDcr > woggi5
087270051214     c***                Eval      *In59 = *On
087280051214     c***                Eval      *In90 = *On
087290051214     c***                Eval      VidMsg = Err(277)
087300051214     c***                Eval      VidMsg = %trim(vidmsg) + ' ' +
087310051214     c***                          %trim(%editc(§vpodcg:'Z'))  +
087320051214     c***                          ' giorni dalla data odierna'
087330051214     c***                GoTo      EndCr
087340051214     c***                EndIf
087350051214     c* controllo che la data consegna richiesta non sia superiore a oggi +
087360051214     c* i giorni previsti in tabella VPO
087370051214     c                   if        wtcr = 'P'
087380051214     c                   z-add     woggidcgm1    s_woggidcg
087390051214     c                   z-add     §vpodcgm1     s_vpodcg
087400051214     c                   else
087410051214     c                   z-add     woggidcgm2    s_woggidcg
087420051214     c                   z-add     §vpodcgm2     s_vpodcg
087430051214     c                   endif
087440051214     c*
087450051214     c                   if        comdcr > s_woggidcg
087460051214     c                   Eval      *In59 = *On
087470051214     c                   Eval      *In90 = *On
087480051214     c                   Eval      VidMsg = Err(277)
087490051214     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
087500051214     c                             %trim(%editc(s_vpodcg:'Z'))  +
087510051215     c                             ' giorni dalla data odierna.'
087520051214     c                   GoTo      EndCr
087530051214     c                   endif
087540030416
087550030416      * Controllo che la data consegna richiesta non sia superiore a oggi + 1 mm
087560051214     c*                  If        ComDcr > woggi1m
087570051214     c*                            and fordcr = *Blanks
087580051214     c*                  Eval      *In59 = *On
087590051214     c*                  Eval      *In90 = *On
087600051214     c*                  Eval      VidMsg = Err(1)
087610051214     c*                  Eval      fordcr = '1'
087620051214     c*                  GoTo      EndCr
087630051214     c*                  EndIf
087640030409
087650940913     C* ORA
087660940920    1C     *IN23         IFEQ      *OFF
087670940913     C*
087680940913    2C     WHCR          IFLT      0
087690940913     C     WHCR          ORGT      24
087700940913     C                   MOVEL     ERR(20)       VIDMSG
087710960319     C                   SETON                                        6090
087720940913     C                   GOTO      ENDCR
087730940913    2C                   ENDIF
087740940913     C*
087750940913    2C     WMCR          IFLT      0
087760940913     C     WMCR          ORGT      59
087770940913     C                   MOVEL     ERR(20)       VIDMSG
087780960319     C                   SETON                                        6090
087790940913     C                   GOTO      ENDCR
087800940913    2C                   ENDIF
087810940916     C* PERSONALIZZAZIONE
087820940913    2C     WPERSO        IFEQ      'P'
087830941102    3C     WHCR          IFNE      0
087840941102     C     WMCR          ORNE      0
087850940920     C                   SETON                                        23
087860940913    3C                   ENDIF
087870940913    2C                   ENDIF
087880940913     C*
087890941102     C* SE IMMESSO TIPO DEVO IMMETTERE ANCHE ORA O DATA
087900941005    2C     WTCR          IFNE      ' '
087910941102     C*
087920941102    3C     WDCR          IFEQ      0
087930941102     C     WHCR          ANDEQ     0
087940941102     C     WMCR          ANDEQ     0
087950941102     C                   MOVEL     ERR(43)       VIDMSG
087960941102     C                   SETON                                        5990
087970941102     C                   GOTO      ENDCR
087980941102    3C                   ENDIF
087990941102     C*
088000941102    3C     WPERSO        IFEQ      'P'
088010940913     C                   SETON                                        17
088020941102    3C                   ENDIF
088030941005    2C                   ENDIF
088040941005    1C                   ENDIF
088050940913     C*
088060940916     C     ENDCR         ENDSR
088070900427     C*
088080900427     C* CONTROLLO DATI FORMATO1 --------------------------------------
088090020531     C     CTRD01        BEGSR
088100961111     C                   SETOFF                                       953976
088110000915     C                   SETOFF                                       33
088120941003     C                   CLEAR                   WEMFOR
088130010412     C                   CLEAR                   WEFORM
088140941115     C                   CLEAR                   VIDMSG
088150070323     c                   if        *in12='0' or *in15='1'
088160070322     c                   clear                   wparcel
088170070323     c                   endif
088180950127     C***
088190950127     C*** ESEGUO RICERCA ALFABETICA
088200950127     C                   MOVEL     VIDCCM        WCCM
088210950209     C                   MOVEL     VIDLNP        WLNP
088220950127     C     VIDFLC        IFNE      0
088230950127     C                   Z-ADD     VIDFLC        WFLC
088240950127     C                   ELSE
088250950127     C                   Z-ADD     VIDLNP        WFLC
088260950127     C                   ENDIF
088270950127     C                   MOVEL(P)  VIDDMT        PAXDMT
088280950127     C                   EXSR      RICALF
088290950127     C                   MOVEL     WCCM          VIDCCM
088300050215     C                   MOVEL(p)  PAXDMT        VIDDMT
088310950127     C     *IN14         IFEQ      *ON
088320950127     C                   MOVEL     WFLC          VIDFLC
088330950127     C                   ENDIF
088340010216     C     WEMFOR        IFEQ      '1'
088350010216     C                   GOTO      ENDC01
088360010216     C                   ENDIF
088370970925     C***
088380970925     C*** DATA SPEDIZIONE ***
088390970925     C                   EXSR      CTRDSP
088400970925     C   90              GOTO      ENDC01
088410950208     C***
088420950208     C*** LINEA PARTENZA ***
088430950208     C                   MOVEL     VIDLNP        WLNP
088440950208     C                   EXSR      CTRLNP
088450950208     C   90              GOTO      ENDC01
088460991206      *
088470991206      * PER LNP DPD OBBLIGATORIO 1 COLLO
088480020319     C     §OGNTW        IFEQ      'DPD'
088490000509     C     V1CNCL        ANDNE     1
088500991206     C                   SETON                                        6290
088510991206     C                   MOVEL     ERR(178)      VIDMSG
088520991206     C                   GOTO      ENDC01
088530000509     C                   ENDIF
088540010212     C***
088550010212     C*** NUMERO O.R.M.
088560010212     C*
088570010212     C* Controllo solo se attivata procedura O.R.M.
088580010212     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
088590010212     c* fine dell'immissione
088600010212     C     WORM          IFEQ      'S'
088610010212     C     PARTCH        ANDNE     'P'
088620010213     C                   Z-ADD     VIDPOE        WOPOE
088630010213     C                   Z-ADD     VIDNOR        WONOR
088640010213     C                   Z-ADD     VIDNRV        WONRV
088650010213     C                   Z-ADD     VIDLNP        WOLNP
088660010212     C                   EXSR      CTRORM
088670010212     C   90              GOTO      ENDC01
088680010216     C     WEMFOR        IFEQ      '1'
088690010216     C                   GOTO      ENDC01
088700010216     C                   ENDIF
088710010212     C* Propongo campi da O.R.M. se non immessi da utente
088720010212     C* ** Solo se orm non è fittizio **
088730010212     C     FLGFIT        IFEQ      *BLANKS
088740010215     C                   EXSR      PRPOR1
088750010213     C   90              GOTO      ENDC01
088760010212     c* Se ho proposto dei campi non continuo i controlli ma devo
088770010212     c* riemettere videata per visualizzare i dati aggiunti
088780050119     c* idem se richiesto espressamente di non continuare i controlli
088790010212     C     WEFORM        IFEQ      '1'
088800050119     c     wsolo_prp     oreq      '1'
088810040915     c* posizionamento cursore su cod mittente dopo proposte campi da orm
088820040915     c* se però cod.mittente personalizzato mi posiziono su n.ro colli
088830041108     c**** *in19         ifeq      *off
088840041108     c**** *in85         andeq     *off
088850041108     c**** *in38         andeq     *off
088860041108     c****               z-add     12            h1riga
088870041108     c****               z-add     24            h1colo
088880041108     c****               else
088890041129     c     *in38         ifeq      *off
088900041108     c**** *in19         ifeq      *on
088910041108     c**** *in85         oreq      *on
088920040915     c                   z-add     13            h1riga
088930040915     c                   z-add     20            h1colo
088940040915     c                   endif
088950041108     c*****              endif
088960041108     c*****              endif
088970050321     c                   eval      weform = '1'
088980010212     C                   GOTO      ENDC01
088990010212     C                   ENDIF
089000010212     C                   ENDIF
089010010212     C                   ENDIF
089020010227     C* SE PREMUTO F8 MA PROC.ORM NON ATTIVATA RIEMETTO LA VIDEATA
089030010227     C   KH              MOVEL     '1'           WEMFOR
089040010227     C   KH              GOTO      ENDC01
089050940920     C***
089060940920     C*** SIGLA OPERATORE ***
089070940920     C* CONTROLLO SOLO SE NON E' PROTETTO
089080941011     C     *IN13         IFEQ      *OFF
089090940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
089100940920     C                   MOVEL     '3M'          COD
089110940920     C                   MOVEL(P)  VIDSOP        KEY
089120940920     C                   EXSR      CTABEL
089130940920     C     *IN30         IFEQ      *OFF
089140950713     C     VIDSOP        OREQ      ' '
089150940920     C                   MOVEL     ERR(29)       VIDMSG
089160940923     C                   SETON                                        4290
089170940920     C                   GOTO      ENDC01
089180940920     C                   ENDIF
089190940920     C                   ENDIF
089200940823     C***
089210990628     C*** DATA RITIRO MERCE E PRESTAZIONE M/P ***
089220020131     C                   EXSR      CTRDRT
089230940920     C   90              GOTO      ENDC01
089240940823     C***
089250960926     C*** CODICE AUTOTRASPORTATORE ***
089260940824     C                   MOVEL     VIDPDR        WPDR
089270940824     C                   EXSR      CTRPDR
089280940824     C                   MOVEL     WPDR          VIDPDR
089290940824     C     WEMFOR        IFEQ      '1'
089300940920     C                   GOTO      ENDC01
089310940824     C                   ENDIF
089320940823     C***
089330921006     C*** NUMERO SPEDIZIONE ***
089340990602     C  N12PARTCH        IFEQ      'R'
089350921006     C     RECNSP        ANDEQ     0
089360940823     C                   MOVEL     ERR(33)       VIDMSG
089370940923     C                   SETON                                        6190
089380940920     C                   GOTO      ENDC01
089390921006     C                   END
089400950127     C***
089410950127     C*** NUMERO COLLI ***
089420950127     C     V1CNCL        IFEQ      0
089430950127     C                   MOVEL     ERR(34)       VIDMSG
089440950127     C                   SETON                                        6290
089450950127     C                   GOTO      ENDC01
089460950127     C                   END
089470950127     C***
089480950127     C*** PESO   ***
089490950127     C* LO CONTROLLO SOLO IN SECONDA VIDEATA SE CARICAMENTO DISK  CLI
089500950127     C* >< DA 0
089510980402     C*
089520980402     C* OBBLIGATORIO
089530950127     C  N12VIDPKG        IFEQ      0
089540950127     C                   MOVEL     ERR(46)       VIDMSG
089550950127     C                   SETON                                        6390
089560950127     C                   GOTO      ENDC01
089570950127     C                   ENDIF
089580980402     C*
089590980402     C* NON MAGGIORE DEL LIMITE POSTO (forzabile)
089600090609     C* N12VIDPKG        IFGT      §QTPKB
089610090609     C*    VIDPKG        ANDNE     SAVPKG
089620090609     C*                  MOVE      VIDPKG        SAVPKG
089630090609     C*                  CLEAR                   WPT1
089640980623     C* PREPARO MSG
089650090609     C*                  MOVEA     ERR(52)       K78
089660090609     C*                  MOVEL     §QTPKB        W006A             6
089670090609     C*                  MOVEA     W006A         SKI(10)
089680090609     C*                  Z-ADD     10            I                 3 0
089690090609     C*                  EXSR      ABBL
089700090609     C*                  MOVEA     SKI(10)       K78(34)
089710090609     C*                  MOVE      §QTPKB        W001A
089720090609     C*                  MOVEL     W001A         K78(41)
089730090609     C*                  MOVEA     K78           VIDMSG
089740090609     C*                  SETON                                        6390
089750090609     C*                  GOTO      ENDC01
089760090609     C*                  ENDIF
089770940823     C***
089780940823     C*** CODICE BOLLA ***
089790940824     C                   MOVEL     VIDCBO        WCBO
089800940824     C                   EXSR      CTRCBO
089810940824     C                   MOVEL     WCBO          VIDCBO
089820940824     C     WEMFOR        IFEQ      '1'
089830940920     C                   GOTO      ENDC01
089840940824     C                   ENDIF
089850940929     C***
089860940929     C*** CODICE MITTENTE ***
089870940929     C                   MOVEL     VIDFTM        WFTM
089880940929     C                   MOVEL     VIDCCM        WCCM
089890940929     C     VIDFLC        IFNE      0
089900940929     C                   Z-ADD     VIDFLC        WFLC
089910940929     C                   ELSE
089920940929     C                   Z-ADD     VIDLNP        WFLC
089930941108     C                   ENDIF
089940940929     C                   EXSR      CTRCCM
089950941011     C                   MOVEL     WCCM          VIDCCM
089960941011     C     *IN14         IFEQ      *ON
089970941011     C                   MOVEL     WFLC          VIDFLC
089980941011     C                   ENDIF
089990941011     C*
090000940929     C     WEMFOR        IFEQ      '1'
090010940929     C                   GOTO      ENDC01
090020940929     C                   ENDIF
090030940823     C***
090040940823     C*** TIPO SERVIZIO ***
090050940824     C                   MOVEL     VIDTSP        WTSP
090060940929     C                   EXSR      CTRTSP
090070940929     C                   MOVEL     WTSP          VIDTSP
090080940824     C     WEMFOR        IFEQ      '1'
090090940920     C                   GOTO      ENDC01
090100940824     C                   ENDIF
090110940823     C***
090120940823     C*** CODICE TRATTAMENTO MERCE ***
090130940824     C*
090140940824     C* SE CODICE BOLLA PREVEDE IL CODICE TRATTAMENTO MERCE QUESTO
090150940824     C* PREVALE SUL CODICE DELL'ANAGRAFICA E SU QUELLO DIGITATO
090160940824     C     §3ACTM        IFNE      *BLANKS
090170940929     C                   MOVEL     §3ACTM        WCTM
090180940824     C                   ELSE
090190940824     C* SE NON IMMESSO PRENDO VALORE DI DEFAULT
090200940824     C     VIDCTM        IFEQ      *BLANKS
090210940929     C                   MOVEL     COMCTM        WCTM
090220940929     C                   ELSE
090230940929     C                   MOVEL     VIDCTM        WCTM
090240940824     C                   ENDIF
090250940824     C                   ENDIF
090260940824     C*
090270940824     C* CONTROLLO
090280950504     C                   CLEAR                   W003A
090290940929     C                   MOVEL     WCTM          W003A
090300940824     C                   EXSR      CTRCTM
090310940929     C* SCRIVO IL CTM SOLO SE AVEVO DIGITATO UN '?'
090320941005     C* SE IMPOSTO QUELLO DI DFT NON LO FACCIO VEDERE A VIDEO
090330940929     C     '?'           SCAN      W003A                                  30
090340940929     C     *IN30         IFEQ      *ON
090350940824     C                   MOVEL     WCTM          VIDCTM
090360940929     C                   ENDIF
090370940824     C     WEMFOR        IFEQ      '1'
090380940920     C                   GOTO      ENDC01
090390940824     C                   ENDIF
090400121106
090410121106     c* Non posso utilizzare un CTM che mantiene in numero di spedizione
090420121106     c*  se = 0
090430121106     C   12
090440121106    1Can 15§1BFG3        IFEQ      'S'
090450121106     c     vidnsp        andeq     0
090460121106     C                   MOVEL     ERR(72)       VIDMSG
090470121106     c                   eval      %subst(vidmsg:20:2)=vidctm
090480121106     C                   SETON                                        4990
090490121106     C                   GOTO      ENDC01
090500121106    1C                   END
090510940824     C*
090520910828     C* SE FLAG6=M O C  OBBLIGATORIA LA LINEA DI ARRIVO
090530910828     C     §1BFG6        IFEQ      'M'
090540910828     C     §1BFG6        OREQ      'C'
090550921019     C     §1BFG8        ANDNE     'N'
090560940823     C*
090570910828     C     VIDLNA        IFEQ      *BLANKS
090580910828     C     VIDLNA        OREQ      *ZEROS
090590940823     C                   MOVEL     ERR(14)       VIDMSG
090600940923     C                   SETON                                        4790
090610940920     C                   GOTO      ENDC01
090620910828     C                   END
090630910828     C                   END
090640081107     c* controllo la congruenza fra codice bolla e il codice trattamento merce
090650081107     c                   exsr      ctrcbo_ctm
090660081107     C     *in90         IFEQ      '1'
090670081107     C                   GOTO      ENDC01
090680081107     C                   ENDIF
090690910828     C*
090700910828     C* PER DISK CLI CONTROLLO ESISTENZA DETTAGLIO SEGNACOLLI X FLG7=S
090710950718     C   15
090720950718     CAN 12§1BFG7        IFEQ      'S'
090730020917     C     KBLC          SETLL     FIVAD000                               30
090740940823     C     *IN30         IFEQ      *OFF
090750940823     C                   MOVEL     ERR(37)       VIDMSG
090760940923     C                   SETON                                        6290
090770940920     C                   GOTO      ENDC01
090780970107     C                   ENDIF
090790950717     C* SE SEGNACOLLI DA CLIENTE, CONTROLLO CHE NON CI SIANO SEGNACOLLI
090800950717     C*  RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
090810950719     C     §1BFG6        IFEQ      'C'
090820980325     C                   EXSR      VADDOP
090830950717     C   90              GOTO      ENDC01
090840940823     C                   ENDIF
090850950719     C                   ENDIF
090860040601     C* PER DISK CLI CONTROLLO ESISTENZA estensione stmpa ddt x FLG16=S
090870040601     C   15
090880040603    1CAN 12§1BF16        IFEQ      'S'
090890130301     c                   clear                   wvax
090900130301     c                   clear                   wvatp
090910130301     C     KBLC          SETLL     FIVAX000
090920130301    2c                   if        %equal(fivax01l)
090930130301     c                   eval      wvax='S'
090940130301    2c                   endif
090950130301     C                   MOVEL     'P'           WTRC
090960130301     C     Kvat          SETLL     FIVAt000
090970130301    2C                   if        %equal(fivat01l)
090980130313     c* cliente abilitato al pdf: memkorizzo presenza pdf
090990130313     c                   eval      wvatp='S'
091000130313     c* cliente non abilitato alla gestione del PDF:
091010130313     c* memorizzo per l'invio mail di alert
091020130313     c                   if        §clipdfp=*blanks
091030130313     c                   eval      wvatpe='S'
091040130313     c                   endif
091050130301    2c                   endif
091060130301    2c                   if        wvax=*blanks and wvatp=*blanks
091070040601     C                   MOVEL     ERR(279)      VIDMSG
091080040601     C                   SETON                                        6290
091090040601     C                   GOTO      ENDC01
091100130313     c                   else
091110130313     c* cliente non abilitato al PDF
091120130313     c                   if        wvatp='S' and §clipdfp=*blanks
091130130313     C                   MOVEL     ERR(349)      VIDMSG
091140130313     C                   SETON                                        4990
091150130313     C                   GOTO      ENDC01
091160130313     c                   endif
091170040603    2C                   ENDIF
091180130301   2ac                   if        wvax='S'
091190040603     c                   clear                   s_vaxprr
091200040603    2c                   do        *hival
091210061010     c     kblc          reade(N)  fivax000
091220040603    3c                   if        %eof(fivax01l)
091230040603     c                   leave
091240040603    3c                   endif
091250040603    3c                   if        vaxprr = s_vaxprr
091260040603     C                   MOVEL     ERR(280)      VIDMSG
091270040603     c                   seton                                        6290
091280040603     C                   GOTO      ENDC01
091290040603   x3c                   else
091300040603     c                   eval      s_vaxprr=vaxprr
091310040603    3c                   endif
091320040603    2c                   enddo
091330041210     c* controllo esistenza logo su tabella ar8
091340041210     C                   CLEAR                   DSBS02
091350041210     C                   MOVEL     'C'           T02MOD
091360041210     C                   MOVEL     KNSIF         T02SIF
091370041210     C                   MOVEL     'AR8'         T02COD
091380041210     C                   MOVEL(P)  vaxtmd        T02KE1
091390041210      *
091400041210     C                   CALL      'TIBS02R'
091410041210     C                   PARM                    KPJBA
091420041210     C                   PARM                    DSBS02
091430041210      *
091440041210     C     T02ERR        IFne      *BLANKS
091450041210     C                   MOVEL     ERR(290)      VIDMSG
091460041210     c                   eval      vidmsg = %trim(vidmsg) + ' "' + vaxtmd + '" '
091470041210     c                             + 'per stampa Lettera di vettura.AVVISARE IL'
091480041210     c                             + ' CED'
091490041210     c                   seton                                        90
091500041210     C                   GOTO      ENDC01
091510041210     c                   endif
091520130301   2ac                   endif
091530130305     c* controlli pdf: verifico che non sia doppio negli ultimi 30gg
091540130304     c                   if        wvatp='S'
091550130304     c                   exsr      pdfdop
091560130304     c                   if        *in90
091570130304     C                   goto      ENDC01
091580130304     c                   endif
091590130301     c                   endif
091600040603    1C                   ENDIF
091610050221     c
091620970904     C**
091630970904     C* IN MANUTENZIONE NON SI PUO' VARIARE COLLI PER DISK CLIENTI B
091640050429     C   12
091650050429     CANN15V1CNCL        IFNE      SAVNCL
091660050429     C     §1BFG6        andeq     'C'
091670050429     C     §1BFG2        ANDEQ     'S'
091680050429     C                   MOVEL     ERR(69)       VIDMSG
091690050429     C                   SETON                                        6290
091700050429     C                   GOTO      ENDC01
091710050429     C                   ENDIF
091720940823     C***
091730940823     C*** LINEA ARRIVO ***
091740910805     C* IN MANUTENZIONE NON POSSO VARIARE LA LINEA PER DISK CLIENTI B
091750100210     c*  ES 10/02/10 parlando con Luciano ci sembrava non corretto far
091760100210     c*     modificare la data anche in conferma. Per evitare errori
091770100210     c*     anche dovuti al fatto che per servizio  H non ci può essere incongru
091780100210     c*     enza, metto il messaggio anche per la conferma
091790100210     c
091800100210     C*  12
091810100210     C*NN15§1BFG6        IFEQ      'C'
091820100210
091830100210     C   12§1BFG6        IFEQ      'C'
091840940928     C     SAVLNA        ANDNE     VIDLNA
091850071220     c     §clidkb       andne     'S'
091860100210     c     savlna        andgt     *zeros
091870940823     C                   MOVEL     ERR(13)       VIDMSG
091880940923     C                   SETON                                        4790
091890940920     C                   GOTO      ENDC01
091900910805     C                   END
091910020320     c* Non posso variare la linea di arrivo anche in base a §1bf14
091920020320     c   12
091930020320     cANN15§1bf14        ifeq      'S'
091940020320     C     SAVLNA        ANDNE     VIDLNA
091950020320     C                   MOVEL     ERR(249)      VIDMSG
091960020320     C                   SETON                                        4790
091970020320     C                   GOTO      ENDC01
091980020320     C                   END
091990970414     C* SE BOLLA DIROTTATA POSSO VARIARLA SOLO SE NON HO TRASMESSO
092000970414     C*  il LEGAME BOLLA
092010970414     C   12
092020970414     CANN15SAVLNA        IFNE      VIDLNA
092030970414     C     KBLP3         CHAIN(N)  FNLBL000                           32
092040970724     C  N32LBLFT1        IFNE      ' '
092050970414     C     LBLFT2        ORNE      ' '
092060970414     C                   MOVEL     ERR(141)      VIDMSG
092070970414     C                   SETON                                        4790
092080970414     C                   GOTO      ENDC01
092090970414     C                   END
092100970724     C* SE C'E' LEGAME BOLLA NON POSSO METTERE  L.ARRIVO=L.PARTENZA
092110970724     C  N32              MOVEL     VIDLNP        W003A
092120970724     C  N32W003A         IFEQ      VIDLNA
092130970724     C                   MOVEL     ERR(83)       VIDMSG
092140970724     C                   SETON                                        4790
092150970724     C                   GOTO      ENDC01
092160970724     C                   END
092170970414     C                   END
092180940824     C*
092190940824     C                   MOVEL     VIDLNA        WLNA
092200110217     C                   EXSR      CTRLNA_vid
092210940824     C                   MOVEL     WLNA          VIDLNA
092220940824     C     WEMFOR        IFEQ      '1'
092230940920     C                   GOTO      ENDC01
092240940824     C                   ENDIF
092250060707     c*
092260060707     c* Non posso variare la lna passando da lna non dpd a lna dpd
092270060707     c   12
092280060707     cann15savlna        ifne      vidlna
092290060707     c     savaogntw     andne     A_§ogntw
092300060707     c     A_§ogntw      andeq     'DPD'
092310060707     C                   MOVEL     ERR(305)      VIDMSG
092320060707     C                   SETON                                        4790
092330060707     C                   GOTO      ENDC01
092340060707     c                   endif
092350071220     c* Disk "B" - non posso variare la linea se:
092360071220     c                   if        *in12 and not *in15  and
092370071220     c                             §1bfg6='C' and savlna<>vidlna
092380071220     c                   exsr      sr_chkabilna
092390071221     c                   if        *in90
092400071221     c                   goto      endc01
092410071221     c                   endif
092420061124     c*
092430071220     c                   endif
092440061124     C* PER DISK A CON VAT OPPURE PER DISK C EX DISK B  CONTROLLO
092450061124     C* ESISTENZA CODICI CHI SONO
092460061124     C* IDEM SE SONO IN MANTUENZIONE
092470061124     C     A_§OGNTW      IFEQ      'DPD'
092480061124     C     VIDDPD        OREQ      'D'
092490061124     C                   MOVEL     'S'           WEXDPD            1
092500061124     C                   ELSE
092510061124     C                   CLEAR                   WEXDPD
092520061124     C                   ENDIF
092530061124     C*
092540061124     C     §1BF12        IFEQ      'E'
092550061124     c     wexdpd        andne     'S'
092560061124     c     *in79         andeq     *off
092570061124     c*
092580061124     c     §1bf12        oreq      'E'
092590061124     c     wexdpd        andeq     'S'
092600061124     c     §1bf13        andeq     'A'
092610061124     C*
092620061124     C     §1BF12        OREQ      'B'
092630061124     C*
092640061124     C     *IN12         OREQ      *ON
092650061124     C     *IN15         ANDEQ     *OFF
092660061124     C     §1BF12        ANDNE     'N'
092670061124     C     WEXDPD        ANDNE     'S'
092680061124     c     *in79         andeq     *off
092690061124     C*
092700061124     C     *IN12         OREQ      *ON
092710061124     C     *IN15         ANDEQ     *OFF
092720061124     C     §1BF12        ANDNE     'N'
092730061124     C     WEXDPD        ANDEQ     'S'
092740061124     C     §1BF13        ANDEQ     'A'
092750070323     c*  Per bolla export dpd con parcel  lungo 12 bypasso questo con-
092760070323     c*  trollo che non funzionerebbe
092770061124      * se non ho superato i 500 colli
092780061124If  2c                   If        v1cncl <= 500
092790061124     C* CONTROLLO CHE NON CI SIANO SEGNACOLLI
092800061124     C*                         RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
092810061124     C* CONTEGGIO ANCHE N° RECORD "CHI SONO" PERCHE' DEVE ESSERE = AL
092820061124     C* NUMERO DEI COLLI
092830061124     C* PASSO A ROUTINE UN FLAG PER SEGNALARE CHE E' RICHIAM.DA CTRD01
092840061124     C                   MOVEL     'C'           WC01FG            1
092850061124     C                   EXSR      CTRS08
092860061124     C   90              MOVEL     W08MSG        VIDMSG
092870061124     C   90              SETON                                        62
092880061124     C   90              GOTO      ENDC01
092890061124   x2c                   Else
092900061124     c                   Eval      VidMsg = Err(275)
092910061124     c                   Eval      *In90 = *On
092920061124     c                   Eval      *In62 = *On
092930061124     c                   GoTo      EndC01
092940061124    2c                   EndIf
092950061124     C                   ENDIF
092960061124     c* se sono in conferma bolle da disk di bolla dpd errore se
092970061124     c* il cliente mi ha passato più di un VAT
092980061124     c                   if        *in12 and *in15 and §1bf12 = 'E'
092990061124     c                             and werrvat = '1'  and
093000061124     c                             ((§1bf13 = *blanks and wexdpd = 'S')
093010061124     c                              or (*in79 = *on))
093020061124     c                   Eval      VidMsg = Err(291)
093030061124     c                   Eval      *In90 = *On
093040061124     c                   Eval      *In62 = *On
093050061124     c                   GoTo      EndC01
093060061124     c                   endif
093070960320     C*
093080960320     C* PER LNA 102 OBBLIGATORIO IL C/S
093090960320     C     COMLNA        IFEQ      102
093100960320     C     §3ARBL        ANDNE     'C'
093110960320     C                   SETON                                        4690
093120960320     C                   MOVEL     ERR(126)      VIDMSG
093130960320     C                   GOTO      ENDC01
093140960320    3C                   ENDIF
093150000609     C**
093160060109     C* PER BOLLA EXPORT DPD, NON POSSO ACCETTARE SOLUZIONI "B" se ctm
093170060109     c* che non prevede l'assegnazione automatica del "chi sono DPD"
093180000609     C   15
093190000609     CAN 12§1BFG6        IFEQ      'C'
093200000609     C     §1BFG2        ANDEQ     'S'
093210060109     c     §1bf13        andne     'A'
093220020319     C     A_§OGNTW      IFEQ      'DPD'
093230020204     C     VIDDPD        OREQ      'D'
093240060109     C                   MOVEL     ERR(296)      VIDMSG
093250000609     C                   SETON                                        6290
093260000609     C                   GOTO      ENDC01
093270000609     C                   ENDIF
093280000609     C                   ENDIF
093290061121     c*
093300080411     c* 11/04/2008: Asterisco i seguenti controlli perchè li ho spostat
093310080411     c* dentro la CTRIND
093320061121     C* VERIFICO SE P.O. EMITTENTE DPD o fed-ex
093330080411     c***                clear                   poentw
093340080411    2C***  FLGFIT        IFNE      'S'
093350080411     C***  ORMPOE        CHAIN     AZORG01L      UNIORG               30
093360080411     C***                MOVEL     OG143         SAV143
093370080411     C**N30              MOVEL     ORGDE3        OG143
093380080411     C** 30              CLEAR                   OG143
093390080411     c**                 eval      poentw=§ogntw
093400080411     C**                 MOVEL     SAV143        OG143
093410080411    2C***                ENDIF
093420010503     C* SE BOLLA EXPORT DPD IN PORTO ASSEGNATO DEVE ESSERE ASSOCIATA AD
093430010503     C* UN ORM REALE COMMISSIONATO DA UN P.O. DPD
093440020207     c* IDEM PER BOLLA FEDEX
093450010508     C* NON FACCIO QUESTO CONTROLLO SE PGM RICHIAMATO DA PGM GIACENZE
093460020527     c* o da ritiri annullati (savfpr="T")
093470080411    0c***  *in04         ifeq      *on
093480080411     c***                clear                   pofed             1
093490080411     c***                clear                   podpd             1
093500080411     C***                MOVEA     ERR(229)      K78
093510080411    1C***  A_§OGNTW      IFEQ      'DPD'
093520080411     C***  VIDDPD        OREQ      'D'
093530080411     c***                movel     '1'           podpd
093540080411     C***                MOVE      'DPD  '       W005A             5
093550080411     C***                MOVEA     W005A         K78(14)
093560080411     C***                MOVEA     W005A         K78(71)
093570080411     c***                endif
093580080411     c***  A_§ogntw      ifeq      'FED'
093590080411     c***  viddpd        oreq      'F'
093600080411     c***                movel     '1'           pofed
093610080411     C***                MOVE      'FedEx'       W005A             5
093620080411     C***                MOVEA     W005A         K78(14)
093630080411     C***                MOVEA     W005A         K78(71)
093640080411     c***                endif
093650040907     c*
093660080411     c***                clear                   wnocont
093670040907     c* Se provengo da manutenzione di bolla di reso lo memorizzo
093680040907     c* per non effettuare il controllo seguente
093690080411     c***  *in12         ifeq      *on
093700080411     c***  *in15         andeq     *off
093710080411     c***  vidfbr        andeq     'S'
093720080411     c***                move      'N'           wnocont           1
093730080411     c***                endif
093740020131     c
093750080411    1C**   podpd         IFEQ      '1'
093760080411     c**   pofed         oreq      '1'
093770080411   1AC**   SAVFPR        IFNE      'P'
093780080411     C*    SAVFPR        ANDNE     'G'
093790080411     C*    SAVFPR        ANDNE     'T'
093800080411     c*    wnocont       andeq     *blanks
093810080411    2C*    FLGFIT        IFEQ      'S'
093820080411     C*    poentw        ORNE      'DPD'
093830080411     c*    podpd         andeq     '1'
093840080411     C*    poentw        ORNE      'FED'
093850080411     c*    pofed         andeq     '1'
093860080411     C*                  MOVEA     K78           VIDMSG
093870080411     C*                  SETON                                        90
093880080411    3C*    WPERSO        IFEQ      'P'
093890080411     C*                  Z-ADD     05            H0RIGA
093900080411     C*                  Z-ADD     20            H0COLO
093910080411     C*                  ELSE
093920080411     C*                  Z-ADD     06            H1RIGA
093930080411     C*                  Z-ADD     20            H1COLO
093940080411    3C*                  ENDIF
093950080411     C*                  GOTO      ENDC01
093960080411    2C*                  ENDIF
093970080411   1AC*                  ENDIF
093980080411    1C*                  ENDIF
093990080411    0c*                  endif
094000940823     C***
094010940823     C*** DESTINATARIO  ***
094020001121      ***
094030001121      * ALLINEO A SX LA LOCALITA'
094040001121     C     VIDLOD        IFNE      *BLANKS
094050001121     C                   MOVEL     VIDLOD        W001A
094060001121     C     W001A         IFEQ      *BLANKS
094070001121     C                   MOVEA     VIDLOD        K35
094080001121     C     ' '           CHECK     VIDLOD        XX
094090001121     C                   CLEAR                   VIDLOD
094100001121     C                   MOVEA     K35(XX)       VIDLOD
094110001121     C                   ENDIF
094120001121     C                   ENDIF
094130001121      *
094140970701     C                   MOVEL     VIDRSD        I14RSC
094150970701     C                   MOVE      VIDRSD        I14RS2
094160970701     C                   MOVEL     VIDIND        I14IND
094170970701     C                   MOVEL     VIDLOD        E14LOC
094180970701     C                   MOVEL     VIDPID        E14PIP
094190970701     C                   MOVEL     VIDPRD        E14PRV
094200970701     C                   MOVEL     VIDNZD        E14NAR
094210970701     C                   MOVEL     VIDCAD        E14CAP
094220970704     C                   MOVEL     'D'           WCLI              1
094230061121     c                   clear                   wcdf
094240970704     C                   EXSR      CTRIND
094250970702     C*
094260970702     C* IMPOSTO I CAMPI DI UNA EVENTUALE RICERCA
094270970704     C                   MOVEL     E14LOC        VIDLOD
094280970704     C                   MOVEL     E14CAP        VIDCAD
094290970704     C                   MOVEL     E14NAR        VIDNZD
094300970704     C                   MOVEL     E14PRV        VIDPRD
094310970702     C                   MOVEL     E14PIP        VIDPID
094320970704     C* ERRORE
094330970704     C     WEMFOR        IFEQ      '1'
094340970704     C     *IN90         OREQ      *ON
094350970704     C                   GOTO      ENDC01
094360970704     C                   ENDIF
094370070808     c* Per TELLUS --> Indirizzo: deve essere di almeno 6 caratteri
094380090202     c* Ignoro l'errore se destinatario estero protetto
094390070808     c                   eval      w_vidind=%trim(vidind)
094400070827     c     ' '           checkr    w_vidind      num               2 0
094410090202     c                   if        num<6 and (wdesie<>'E' or atrdes<>prot)
094420070808     C                   SETON                                        90
094430070808     C                   Z-ADD     18            H1RIGA
094440070808     C                   Z-ADD     02            H1COLO
094450070808     C                   MOVEL     ERR(313)      VIDMSG
094460070808     C                   GOTO      ENDC01
094470070808     c                   endif
094480061121     c* Se destinatario estero e orm avente p.o. emittente DPD errore se
094490061121     c* il network non è dpd
094500061121     c                   if        wdesie='E' and flgfit<>'S'
094510061121     c                             and poentw='DPD' and viddpd<>'D'
094520061121     c                             and A_§ogntw<>'DPD'
094530061121     c                   seton                                        90
094540061121     c                   Eval      VidMsg = Err(309)
094550061121     c                   z-add     21            H1riga
094560061121     c                   z-add     10            H1colo
094570061121     c                   GoTo      EndC01
094580061121     c                   endif
094590110512     c* Se presente indirizzo email del destinatario lo controllo
094600110512     c                   if        wemdest<>*blanks
094610110613     c                   if        wdesie='E'
094620110613     c                   Eval      *In90 = *On
094630110613     c                   Eval      vidmsg=err(342)
094640110613     c                   Eval      vidmsg=%trimr(vidmsg) +
094650110613     c                             ':F17 x eliminare Ind.Email'
094660110613     c                   goto      endc01
094670110613     c                   else
094680110512     c                   exsr      sr_chkemd
094690110512      * Errore
094700110512if  3c                   If        §emlerro <> '0'
094710110512     c                   Eval      *In90 = *On
094720110512     c                   Eval      vidmsg = err(340)
094730110516     c                   eval      vidmsg=%trimr(vidmsg)+': F17 per correggere'
094740110512     c                   goto      endc01
094750110512   x3c                   else
094760110512     c                   Eval      wemdest = §emlindo
094770110512    3c                   EndIf
094780110613     c                   endif
094790110512     c                   endif
094800050214     c*
094810050214     c* SE DESTINATARIO ESTERO vedo se devo forzare il porto franco
094820050214     C* (si tratta delle stesse operazioni effettuate anche routine prp
094830050214     c* or1 che devono essere effettuate anche in questo momento
094840050214     c* se l'orm è multiplo per cui deve prima essere controllato il
094850060427     c* destinatario per sapere se è estero- Idem se orm singolo ma non è
094860060427     c* specificato il destinatario ORM)
094870060428if  1c****               If        (Not *In12 or Not *In15) and
094880060428     c****                         (ormtor = 'M' or ormrsc=*blanks  )  and
094890050214      * e l'ORM prevede:
094900060428      *****           --> la bolla in porto Assegnato
094910060428      *****           --> paga ordinante orm
094920060428      *****           --> destinatario estero
094930060428      *****           --> ordinante orm italia
094940060428     c*****                        (§OrPfb = 'A' and OrmPag = 'O' and
094950060428     c****                          wdesie = 'E' and OrmNao = *Blanks)
094960060428     c****               exsr      sr_FOrmEst
094970060428    1c****               EndIf
094980061124     c                   if        vidnzd<>savnzd
094990061124     c                   clear                   wfortbo
095000061124     c                   move      vidnzd        savnzd
095010061124     c                   endif
095020050214     c* Controllo codice bolla con  quanto memorizzato sull'orm
095030050214     c                   exsr      CTRCBO_orm
095040050214     C     *in90         IFEQ      '1'
095050050214     c                   eval      wemfor = '1'
095060050214     C                   GOTO      ENDC01
095070050214     C                   ENDIF
095080061011     c
095090061011     c* Per bolla dpd con CAP errato richiamo in automatico int cappar
095100061011     c*  DPD
095110061011    1c                   if        CapparioDPD='S' or *inkb
095120061011     c* Se non è + dpd tolgo il flag
095130061011    2C     A_§OGNTW      IFEQ      'DPD'
095140061011     C     VIDDPD        OREQ      'D'
095150061011     C     WDESIE        ANDEQ     'E'
095160061011     c* Se modificato il CAP vado avanti senza l'interrogazione
095170061011    3c                   if        vidcad=savcapdpd   or *inkb
095180061011     c* Per l'interrogazione passo solo il cap fittizio
095190061011     C                   MOVEL     '15'          COD
095200061011     C                   MOVEL(P)  VIDNZD        KEY
095210061011     C                   EXSR      CTABEL
095220061011     C                   MOVEL     TBLUNI        DS15
095230061011     c                   movea     vidcad        cap
095240061011     C                   CLEAR                   CAF
095250061011     C                   MOVEA     CAP(§15pcf)   CAF(§15pcf)
095260061011     c     §15ecf        add       §15pcf        finefit           2 0
095270061011     c                   movea     *blanks       caf(finefit)
095280061011     c
095290061011     C                   CLEAR                   tisie8ds
095300061011     c                   z-add     blpdsp        isie8dri
095310061011     c                   movel     'D01'         isie8op0
095320061011     C                   MOVEL     vidnzd        isie8nar
095330061011     C                   MOVEa     caf           isie8cap
095340061011     C                   CALL      'TISIE8R'
095350061011     C                   PARM                    kpjba
095360061011     C                   PARM                    tisie8ds
095370061011     c*
095380061011     c* Se errore lo emetto
095390061011     c                   if        osie8err<>' '
095400061011     C                   MOVEL     osie8msg      VIDMSG
095410061011     C                   SETON                                        6590
095420061011     C                   GOTO      ENDC01
095430061011     c                   endif
095440061011     c
095450061011    4c                   if        osie8capb<>*blanks
095460061011     c                   movel     osie8capb     vidcad
095470061011     c                   clear                   cappariodpd
095480061011     c
095490061011     c* In manutenzione se cambiato CAP riemetto videata
095500061011     c* In immissione/conferma no tanto devo confermare la videata
095510061011     c*    x nazione estera
095520061011     c                   if        *in12 and not *in15
095530061011     c                   eval      wemfor='1'
095540061011    4c                   endif
095550061011     c
095560061011     c                   else
095570061011     c* se non selezionato riemetto videata
095580061011     c                   eval      wemfor='1'
095590061011    4c                   endif
095600061011    3c                   endif
095610061011     c
095620061011   x2c                   else
095630061011     c                   clear                   cappariodpd
095640061011    2c                   endif
095650061011    1c                   endif
095660020530     c*
095670941020     C**
095680950303     C* SE DESTINATARIO ESTERO --> P.IVA OBBLIGATORIA
095690950525     C* SOLO SE PAESE EFTA
095700050427     c* e non è bolla di recupero
095710000905     C     WDESIE        IFEQ      'E'
095720950616     C     VIDPID        ANDEQ     *BLANKS
095730050427     c     §3arbl        andne     'R'
095740000321     C*
095750020319    2C     A_§OGNTW      IFEQ      'DPD'
095760000321     C     DESEFD        ANDNE     *BLANKS
095770000321     C*
095780020204     C     VIDDPD        OREQ      'D'
095790000321     C     DESEFD        ANDNE     *BLANKS
095800020131     c*
095810020213    2C     A_§OGntw      oreq      'FED'
095820020131     C     DESEFf        ANDNE     *BLANKS
095830020131     C*
095840020131     C     VIDDPD        OREQ      'F'
095850020131     C     DESEFf        ANDNE     *BLANKS
095860000321     C*
095870020319     C     A_§OGNTW      ORNE      'DPD'
095880020213     c     A_§ogntw      andne     'FED'
095890000321     C     VIDDPD        ANDEQ     ' '
095900000321     C     O14EFT        ANDNE     *BLANKS
095910950303     C                   MOVEL     '1'           WEMFOR
095920950303     C                   SETON                                        387090
095930950303     C                   MOVEL     ERR(88)       VIDMSG
095940950303     C                   GOTO      ENDC01
095950000321    2C                   ENDIF
095960000321    1C                   ENDIF
095970970528     C* NON POSSO USARE L'ESPRESSO PER BOLLE IMPORT/EXPORT
095980970528     C     VIDTSP        IFEQ      'E'
095990970528     C     WDESIE        IFEQ      'E'
096000100118     c**   §ogntw        oreq      'EEX'
096010100118     c**   §ogntw        oreq      'FED'
096020100118     c**   §ogntw        oreq      'DPD'
096030970528     C                   MOVEL     '1'           WEMFOR
096040970528     C                   SETON                                        487090
096050970528     C                   MOVEL     ERR(142)      VIDMSG
096060100118     c                   eval      %subst(vidmsg:47:10) = v1dtsp
096070090604     c                   eval      vidmsg = %trim(vidmsg) + '!!'
096080970528     C                   GOTO      ENDC01
096090970528    1C                   ENDIF
096100970528    1C                   ENDIF
096110020415     c* NON POSSO USARE CLIENTE 9999 PER PORTI ASSEGNATI EUROEXPRESS
096120020416     c* Lo posso usare solo se bolla associata a orm reale commissionato da
096130020416     c* un p.o. EEX
096140020416     C     SAVFPR        IFNE      'P'
096150020416     C     SAVFPR        ANDNE     'G'
096160020527     C     SAVFPR        ANDNE     'T'
096170020416     c     vidccm        andeq     9999
096180020415     c     wdesie        ifeq      'E'
096190020415     c     viddpd        andeq     *blanks
096200020415     c     comlna        andeq     *zeros
096210020415     c     A_§ogntw      oreq      'EEX'
096220020416     c                   clear                   wokccm            1
096230020416     C* Verifico se P.O. emittente "EEX"
096240020416    2C     FLGFIT        IFNE      'S'
096250020416     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
096260020416     C                   MOVEL     OG143         SAV143
096270020416     C  N30              MOVEL     ORGDE3        OG143
096280020416     C   30              CLEAR                   OG143
096290020416     c     §ogntw        ifeq      'EEX'
096300020416     c                   movel     'S'           wokccm
096310020416     c                   endif
096320020416     C                   MOVEL     sav143        og143
096330020416    2C                   ENDIF
096340020416     c     flgfit        ifeq      'S'
096350020416     c     wokccm        oreq      *blanks
096360020415     C                   MOVEL     ERR(253)      VIDMSG
096370020415     C                   SETON                                        9050
096380020415     c   90              goto      endc01
096390020416     c                   endif
096400020415     c                   endif
096410020415     c                   endif
096420970528     C* NON POSSO USARE TIPO BOLLA 5
096430970528     C     WDESIE        IFEQ      'E'
096440970528     C     VIDCBO        ANDEQ     '5 '
096450970528     C                   MOVEL     '1'           WEMFOR
096460970528     C                   SETON                                        467090
096470970528     C                   MOVEL     ERR(143)      VIDMSG
096480970528     C                   GOTO      ENDC01
096490970528    1C                   ENDIF
096500030707
096510030707      * Se non sto facendo una bolla di recupero
096520030707If  1c                   If        §3aRbl <> 'R'
096530991206      **
096540991206      * SE CAP ESTERO--> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ITALIA
096550020319      ***                TRANNE SE LINEA DPD
096560950525     C     WDESIE        IFEQ      'E'
096570950525     C     COMLNA        ANDGT     0
096580020319     c     A_§ogntw      ifeq      'COR'
096590020319     c     A_§ogntw      oreq      'MES'
096600020319     c     A_§ogntw      oreq      'PPT'
096610950525     C                   MOVEL     ERR(117)      VIDMSG
096620950525     C                   SETON                                        4790
096630950525     C                   GOTO      ENDC01
096640020319     c                   endif
096650950525     C                   ENDIF
096660950525     C*
096670991206      * SE CAP ITALIA -> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ESTERO
096680020319     C***NEMMENO DPD
096690950525     C     WDESIE        IFEQ      'I'
096700971211     C     COMLNA        ANDGT     0
096710020319     c     A_§ogntw      ifeq      'EEX'
096720020319     c     A_§ogntw      oreq      'FED'
096730020319     c     A_§ogntw      oreq      'DPD'
096740950525     C                   MOVEL     ERR(118)      VIDMSG
096750950525     C                   SETON                                        4790
096760950525     C                   GOTO      ENDC01
096770950525     C                   ENDIF
096780000121     C                   ENDIF
096790030707    1c                   EndIf
096800000121      *
096810000121      * PER LNA DPD OBBLIGATORIO 1 COLLO
096820020319     C     A_§OGNTW      IFEQ      'DPD'
096830020204     C     VIDDPD        OREQ      'D'
096840000121     C     WDESIE        ANDEQ     'E'
096850000121     C     V1CNCL        IFNE      1
096860000121     C                   SETON                                        6290
096870000121     C                   MOVEL     ERR(179)      VIDMSG
096880000121     C                   GOTO      ENDC01
096890000121     C                   ENDIF
096900000121     C                   ENDIF
096910090429      * OBBLIGATORIETA' DI un collo anche per orm commissionato da dpd
096920090429     c                   if        poentw='DPD' and v1cncl<>1
096930090429     C                   SETON                                        6290
096940090429     C                   MOVEL     ERR(323)      VIDMSG
096950090429     C                   GOTO      ENDC01
096960090429     c                   endif
096970000121      * PER LNA O LNP DPD Massimo peso inseribile da tabella
096980020319     C  N12A_§OGNTW      IFEQ      'DPD'
096990020319     C     §OGNTW        OREQ      'DPD'
097000020204     C     VIDDPD        OREQ      'D'
097010000121     C     WDESIE        ANDEQ     'E'
097020000121     C     VIDPKG        IFGT      §3IPKD
097030000121     C                   SETON                                        6390
097040000121     C                   MOVEA     ERR(180)      K78
097050000121     C                   MOVEL     §3IPKD        W006A             6
097060000121     C                   MOVEA     W006A         SKI(10)
097070000121     C                   Z-ADD     10            I                 3 0
097080000121     C                   EXSR      ABBL
097090000121     C                   MOVEA     SKI(10)       K78(53)
097100000121     C                   MOVE      §3IPKD        W001A
097110000121     C                   MOVEL     W001A         K78(60)
097120000121     C                   MOVEA     K78           VIDMSG
097130000121     C                   GOTO      ENDC01
097140000121     C                   ENDIF
097150000121     C                   ENDIF
097160020201     c* per servizio dpd non accettato tipo bolla con C/A  - IDEM per FED-EX
097170080414     c*    viddpd        ifeq      'D'
097180080414     c*    A_§ogntw      oreq      'DPD'
097190080414     c*                  eval      w006a = 'DPD   '
097200080414     c*                  else
097210080414     c*    viddpd        ifeq      'F'
097220080414     c*    A_§ogntw      oreq      'FED'
097230080414     c*                  eval      w006a = 'FedEx '
097240080414     c*                  else
097250080414     c*                  if        wdesie='E'
097260080414     c*                  eval      w006a = 'EUROEX'
097270080414     c*                  endif
097280080414     c*                  endif
097290080414     c*                  endif
097300061030     c
097310061030     c* Controllo se ammesso C/A per estero in base ai vari network
097320080414     c****               setoff                                       90
097330080414     c*****              select
097340080414     C***  VIDDPD        wheneq    'D'
097350080414     C**** WDESIE        ANDEQ     'E'
097360061030     c*
097370080414     C***  A_§OGNTW      OREQ      'DPD'
097380080414     c***                if        descadpd=' '  and §3afca<>0
097390080414     c****               seton                                        90
097400080414     c****               endif
097410061030     c
097420080414     C***  VIDDPD        wheneq    'F'
097430080414     C***  WDESIE        ANDEQ     'E'
097440061030     c
097450080414     C***  A_§OGntw      OREQ      'FED'
097460080414     c****               if        descafed=' '  and §3afca<>0
097470080414     c***                seton                                        90
097480080414     c****               endif
097490080414     c***                other
097500080414     c****               if        wdesie='E' and
097510080414     c****                         descaeex=' '  and §3afca<>0
097520080414     c****               seton                                        90
097530080414     c****               endif
097540080414     c***                endsl
097550061030     c
097560080414     C***                IF        *in90
097570080414     c***                movea     err(187)      k78
097580080414     c***                movea     w006a         k78(13)
097590080414     C***                MOVEa     k78           VIDMSG
097600080414     C***                SETON                                        4690
097610080414     C***                GOTO      ENDC01
097620080414     C***                ENDIF
097630061030     c*
097640030221     c* Per bolle export fedex non è ammesso l'inserimento di C/Servizio
097650030221     c     viddpd        ifeq      'F'
097660030221     c     A_§ogntw      oreq      'FED'
097670030221     c     §3arbl        ifeq      'C'
097680020228     C                   MOVEL     ERR(245)      VIDMSG
097690020228     C                   SETON                                        4690
097700020228     C                   GOTO      ENDC01
097710030221     c                   endif
097720020228     c                   endif
097730060613     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
097740060613     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
097750060613     C     *IN79         IFEQ      *ON
097760060613     C     VIDDPD        ANDne     'D'
097770060613     C     A_§OGNTW      ANDNE     'DPD'
097780060613     C     WDESIE        ANDEQ     'E'
097790060613     C                   SETOFF                                       79
097800060613     C                   ENDIF
097810000120     c* Numero dpd
097820000120     c*  INSERIBILE SOLTANTO SE RICHIESTO IL SERVIZIO O LNA ESTERA DPD
097830060612     c*  o se import dpd
097840000120     C  N12
097850060612    1COR 15VIDNRD        IFne      *blanks
097860060613   1ac     *in79         ifeq      *off
097870000120    2C     COMLNA        IFEQ      0
097880000120     C     VIDDPD        ANDEQ     ' '
097890020201    2C     COMLNA        oreq      0
097900020201     C     VIDDPD        andeq     'F'
097910000121    2C     COMLNA        ORGT      0
097920020319     C     A_§OGNTW      ANDNE     'DPD'
097930060921     c
097940000120     C     DESLAD        OREQ      0
097950060921     c     desred        andeq     ' '
097960060921     c
097970060921     C     DESLAD        OREQ      0
097980060921     c     desred        andeq     'S'
097990060921     c     vidfbr        andne     'S'
098000000120     C                   MOVEL     ERR(184)      VIDMSG
098010000120     C                   SETON                                        4790
098020000120     C                   GOTO      ENDC01
098030000120    2C                   ENDIF
098040060612     c
098050000120     C* NON INSERIBILE SE NON ACCETTATTO DAL CTM
098060000120    2C     §1BF13        IFEQ      'A'
098070000120     C                   MOVEL     ERR(185)      VIDMSG
098080000120     C                   SETON                                        5790
098090000120     C                   GOTO      ENDC01
098100000120    2C                   ENDIF
098110060612   1aC                   ENDIF
098120000120     C* SE INSERITO, e no bolla reupero,  CONTROLLO IL CHK DIGITS
098130000308    2C     §3ARBL        IFNE      'R'
098140060612     C                   movel     VIDNRD        WNPR
098150000124     C                   EXSR      DPDVAL
098160000124     C   90              SETON                                        57
098170000124     C   90              GOTO      ENDC01
098180060613     c* per import effettuo subito il controllo per parcel doppio
098190060613     c                   if        *in79='1' and §1bfg8='S'
098200060613     c                   exsr      dpddop_imp
098210060613     C   90              SETON                                        57
098220060613     C   90              GOTO      ENDC01
098230060613     c                   endif
098240070326     c* per export imposto campo wparcel
098250070326     c                   if        *in79='0' and %subst(wnpr:14:1)=*blanks
098260070326     c                             and vidfbr<>'S'
098270070326     c                   eval      wparcel='12'
098280080612     c* in questo caso devo anche controllare che il chi sono inserito non
098290080612     c* sia doppio su fisgn
098300080612     c                   clear                   w8hcol
098310080612     c                   movel     wnpr          w8cnot
098320080612     c                   clear                   w08msg
098330080612     c                   eval      wnopos='1'
098340080612     c                   exsr      ctrchidop
098350080612     C                   MOVEL     w08msg        VIDMSG
098360080612     C   90              SETON                                        57
098370080612     C   90              GOTO      ENDC01
098380070326     c                   endif
098390060613     c
098400000120    2C                   ENDIF
098410000120     C*
098420000120   X1C                   ELSE
098430000120     C*
098440060613     c     *in79         ifeq      *on
098450060612     C     §3ARBL        ANDNE     'R'
098460060612     C                   MOVEL     ERR(186)      VIDMSG
098470060612     C                   SETON                                        5790
098480060612     C                   GOTO      ENDC01
098490060612     c                   endif
098500060612    2C     §1BF13        ifne      'A'
098510000308     C     §3ARBL        ANDNE     'R'
098520000121     C     WDESIE        ANDEQ     'E'
098530020204    3C     VIDDPD        IFEQ      'D'
098540020319     C     A_§OGNTW      OREQ      'DPD'
098550000120     C                   MOVEL     ERR(186)      VIDMSG
098560000120     C                   SETON                                        5790
098570000120     C                   GOTO      ENDC01
098580000120    3C                   ENDIF
098590000120    2C                   ENDIF
098600000120    1C                   ENDIF
098610960213     C***
098620960213     C*** FERMO DEPOSITO ERRATO
098630960213     C     VIDFFD        IFNE      'S'
098640010214     C     VIDFFD        ANDNE     'N'
098650010220     C     VIDFFD        ANDNE     ' '
098660960213     C                   MOVEL     ERR(123)      VIDMSG
098670960213     C                   SETON                                        5290
098680960213     C                   GOTO      ENDC01
098690960213     C                   ENDIF
098700940916     C***
098710940916     C*** FLAG INOLTRO: SE IMPOSTATO FORZARE CON CMD6
098720940909     C  NKF
098730940909     CANN15
098740940909     CAN 12
098750940909     CORNKF
098760940909     CANN12VIDFIN        IFNE      ' '
098770940907     C                   MOVEL     ERR(44)       VIDMSG
098780940923     C                   SETON                                        6990
098790940920     C                   GOTO      ENDC01
098800940909     C                   ENDIF
098810110818     c***
098820110901     c*** valore per accorpamento spedizioni in consegna:
098830110818     c*** errore bloccante se il cliente ha passato un valore non previsto
098840110818     c*   in tabella "xco"
098850110901     c***                if        *in12 and *in15 and werrxco=*on
098860110901     C***                SETON                                        90
098870110901     c***                eval      vidmsg=err(343)
098880110901     C***                GOTO      ENDC01
098890110901     c***                endif
098900110818     c*
098910031121      * Obbligatori se spedizione per supermercato
098920040213if  1c**!!!              If        wdisag = 'S'
098930040213if  2c**!!!              If        VidRef = *Blanks
098940040213     c**!!!              Eval      VidMsg = Err(267)
098950040213     c**!!!              z-add     20            H1riga
098960040213     c**!!!              z-add     21            H1colo
098970040213     c**!!!              Eval      *In90 = *On
098980040213     c**!!!              Eval      wemfor = '1'
098990040213     c**!!!              GoTo      EndC01
099000040213    2c**!!!              EndIf
099010040213if  2c**!!!              If        VidTel = *Blanks
099020040213     c**!!!              Eval      VidMsg = Err(267)
099030040213     c**!!!              z-add     20            H1riga
099040040213     c**!!!              z-add     64            H1colo
099050040213     c**!!!              Eval      *In90 = *On
099060040213     c**!!!              Eval      wemfor = '1'
099070040213     c**!!!              GoTo      EndC01
099080040213    2c**!!!              EndIf
099090040213    1c**!!!              EndIf
099100941003     C*
099110941003     C* IMPOSTO LA LOCALITA' DEL DESTINATARIO IN 2 VIDEATA
099120941003     C                   MOVEL     VIDLOD        V2CLOD
099130950123     C                   MOVEL     VIDRSD        V2CRSD
099140910125     C****
099150020917     C* CONTO QUANTI COLLI E QUANTI RECORD HO IN Fivad:
099160040618    1C***12§1BFG7        IFEQ      'S'
099170040618     c* in conferma
099180040618    1c                   if        (*in12 = *on and *in15 = *on
099190040618     c                             and §1bfg7 = 'S' and §1bf12 <> 'B')
099200040618     c* in manutenzione
099210040618     c                             or (*in12 = *on and *in15 = *off
099220040618     c                             and §1bfg7 = 'S')
099230940909     C  N15KBLP3         SETLL     FNBLD000
099240020917     C   15KBLC          SETLL     FIVAD000
099250940908     C* CONT  = NUMERO RECORD
099260910125     C                   Z-ADD     0             CONT
099270940908     C* CONT2 = NUMERO COLLI
099280910128     C                   Z-ADD     0             CONT2
099290940908     C*
099300940909     C  N15KBLP3         READE(N)  FNBLD000                               31
099310020917     C   15KBLC          READE(N)  FIVAD000                               31
099320950220     C*
099330950220    2C     *IN31         DOWEQ     *OFF
099340950220     C                   ADD       1             CONT              3 0
099350950220     C                   ADD       BLDNCL        CONT2             6 0
099360950220     C*
099370950220     C* SE E' DA DISK CLIENTI VEDO SE IL COLLO E' > 0
099380950220     C     *IN15         IFEQ      *ON
099390980410     C     §1BFG6        ANDEQ     'C'
099400950220     C     BLDNCD        ANDEQ     0
099410950220     C                   MOVEL     ERR(85)       VIDMSG
099420950220     C                   SETON                                        629031
099430950220    3C                   ENDIF
099440010313     C* SE E' DA DISK CLIENTI CONTROLLO CHE IL NUMERO COLLI SIA
099450010313     C* CORRETTO RISPETTO AL RANGE DAL/AL PASSATO
099460010313    3C     *IN15         IFEQ      *ON
099470010313     C     §1BFG6        ANDEQ     'C'
099480010313     C* CONTO IL NUMERO COLLI NEL RANGE DAL/AL
099490010313    4C     BLDNCA        IFEQ      *ZEROS
099500010313     C     BLDNCA        OREQ      BLDNCD
099510010313     C                   Z-ADD     1             WNCOL
099520010313   X4C                   ELSE
099530010313     C                   Z-ADD     BLDNCD        WNCOA
099540010313     C                   CLEAR                   WNCOL
099550010313    5C     WNCOA         DOWLE     BLDNCA
099560010313     C                   ADD       1             WNCOL
099570010313     C                   ADD       1             WNCOA
099580010313    5C                   ENDDO
099590010313    4C                   ENDIF
099600010313    4C     WNCOL         IFNE      BLDNCL
099610010313     C                   MOVEL     ERR(227)      VIDMSG
099620010313     C                   SETON                                        629031
099630010313    4C                   ENDIF
099640010313    3C                   ENDIF
099650950220     C*
099660950220     C  N15
099670950220     CANN31KBLP3         READE(N)  FNBLD000                               31
099680950220     C   15
099690020917     CANN31KBLC          READE(N)  FIVAD000                               31
099700940909    2C                   ENDDO
099710950220     C*
099720950220     C   90              GOTO      ENDC01
099730940908     C*
099740910225     C* SE NUMERO SEGNACOLLI DEL DETTAGLIO BOLLE NON E' UGUALE
099750910225     C*   AL NUMERO INDICATO SULLA BOLLA
099760050113     C     CONT2         ifne      V1CNCL
099770940908     C*
099780910225     C* IN DISK CLIENTI SEMPRE ERRORE
099790940909    3C     *IN15         IFEQ      *ON
099800940908     C* IN MANUTENZIONE BOLLE SOLO SE + DI UN RECORD
099810940908     C     *IN15         OREQ      *OFF
099820940908     C     CONT          ANDGT     1
099830940908     C                   MOVEL     ERR(87)       VIDMSG
099840940923     C                   SETON                                        6290
099850940920     C                   GOTO      ENDC01
099860940909    3C                   ENDIF
099870910225     C*
099880940909    2C                   ENDIF
099890910128     C*
099900940909    1C                   END
099910000413     C**
099920000413     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
099930000413     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
099940060613     c*  13/06/06 - Sposto questi controlli prima dei controlli su vidnrd
099950060613     C**   *IN79         IFEQ      *ON
099960060613     C**   VIDDPD        ANDne     'D'
099970060613     C***  A_§OGNTW      ANDNE     'DPD'
099980060613     C***  WDESIE        ANDEQ     'E'
099990060613     C***                SETOFF                                       79
100000060613     C***                ENDIF
100010940909     C*
100020050920     c* richiamo trul27r per sapere che cosa devo passare in FIE a fnlv59r
100030020213     C* ricerco in questo modo anche la tariffa di cartello
100040021120     c                   Clear                   Trul27Ds
100050021120     c                   Exsr      TarCar
100060021120     c                   If        *In90
100070021120     c                   GoTo      EndC01
100080021120     c                   EndIf
100090080327     c
100100080327     c* Se tipo servizio tariffa <> da fnvab in conferma bolle, errore
100110080327     c*   se non utilizzabile in bollettazione
100120080327     c                   if        *in12 and *in15 and NOutiTSP='N'
100130080327     c                             and tamtsp<>vidtsp
100140080327     C                   MOVEL     ERR(130)      VIDMSG
100150080327     C                   SETON                                        4890
100160080327     C                   GOTO      ENDC01
100170080327     c                   endif
100180090609     c* controllo i limiti di colli e peso
100190090609     c
100200090609     c                   z-add     v1cncl        wncl
100210090609     c  n12              z-add     vidpkg        wpes
100220090609     c   12              clear                   wpes
100230090609     c                   clear                   wvol
100240090609     c                   eval      wvid='1'
100250090609     c                   exsr      sr_limtsp
100260090609     c                   if        *in90
100270090609     C                   MOVEL     wmsgtsp       VIDMSG
100280090609     C                   GOTO      ENDC01
100290090609     c                   endif
100300041011     c*
100310041011     c* Verifico se destinatario disagiato
100320041011     c* Per bolle poste non faccio niente
100330091210     c                   clear                   wdisag
100340091210     c  n12              clear                   w_ar5tcp
100350091210     c                   clear                   ddstflo
100360041012    1c     §ogntw        ifne      'PPT'
100370091210     c
100380091210     c                   clear                   tisit0ds
100390091210     c                   clear                   tisit0x1ds
100400091210     c                   movel     'E'           it0tla
100410091210     c                   movel     vidnzd        it0naz
100420091210     c                   movel     vidprd        it0prv
100430091210     c                   movel     vidcad        it0cap
100440091210     c                   movel     vidlod        it0loc
100450091210     c                   movel     vidind        it0ind
100460091210     c                   movel     vidrsd        it0rag
100470091210     c                   call      'TISIT5R'
100480091210     c                   parm                    tisit0ds
100490091210     c                   parm                    tisit0x1ds
100500041012    2c     ot0err        ifeq      *blanks
100510060113     c                   movel     ot0flo        ddstflo
100520060102   2ac                   if        ot0dos = 'A' or ot0dos = 'D' or
100530060102     c                             ot0dos = 'S'
100540041011     c                   movel     ot0dos        wdisag
100550041012    3c     wdisag        ifeq      'D'
100560041011     c                   movel     'X'           wdisag
100570041012    3c                   endif
100580060102   2ac                   endif
100590041011     c                   Eval      savdisag = wdisag
100600070924     c                   Eval      savpart = 'S'
100610041012   x2c                   else
100620041011     c                   clear                   wdisag
100630041012    2c                   endif
100640041012     c                   exsr      sr_imptc12
100650070924     c* propongo eventuali gg. di chiusura se previsti nei dest.particolari
100660070924     c                   exsr      sr_impgc12
100670041012    1c                   endif
100680040608     c*
100690040608      * --> Referente e Telefono del destinatario
100700040608      *     (messaggio forzabile)
100710040608      * Da indicare se
100720091209      * - Spedizione FedEx
100730040608      * - Spedizione a Privati
100740040608      * - Spedizione con Appuntamento
100750040608      * - Spedizione Export in c/assegno o in porto assegnato
100760040608      * -> Referente solo sped. Export
100770040608if  1c                   If        VidRef = *Blanks and wforza1 = *Off and
100780040608     c                             ((comlna > *Zeros and
100790040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
100800040608     c                             (comlna = *Zeros and wdesie = 'E'))
100810040608if  2c                   If        §3aFca > *Zeros
100820040608     c                   Eval      VidMsg = Err(36)
100830040608     c                   Eval      *In90 = *On
100840040608    2c                   EndIf
100850040608if  2c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
100860040608     c                   Eval      VidMsg = Err(54)
100870040608     c                   Eval      *In90 = *On
100880040608    2c                   EndIf
100890040608if  2c                   If        *In90
100900040608     c                   z-add     20            H1riga
100910040608     c                   z-add     21            H1colo
100920040608     c                   Eval      wforza1 = *On
100930040608     c                   GoTo      EndC01
100940040608    2c                   EndIf
100950040608    1c                   EndIf
100960040608      * -> Telefono
100970040608if  1c                   If        VidTel = *Blanks and wforza1 = *Off
100980040608s   2c                   Select
100990040608     c                   When      a_§OgNtw = 'FED' or viddpd = 'F'
101000040608     c                   Eval      VidMsg = Err(56)
101010040608     c                   Eval      *In90 = *On
101020040608     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
101030040608     c                   Eval      VidMsg = Err(267)
101040040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
101050040608     c                   Eval      *In90 = *On
101060040608     c                   When      %subst(VidGva:1:1) = 'P'
101070040608     c                   Eval      VidMsg = Err(58)
101080040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
101090040608     c                   Eval      *In90 = *On
101100040608     c                   When      (comlna > *Zeros and
101110040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
101120040608     c                             (comlna = *Zeros and wdesie = 'E')
101130040608if  3c                   If        §3aFca > *Zeros
101140040608     c                   Eval      VidMsg = Err(36)
101150040608     c                   Eval      *In90 = *On
101160040608    3c                   EndIf
101170040608if  3c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
101180040608     c                   Eval      VidMsg = Err(54)
101190040608     c                   Eval      *In90 = *On
101200040608    3c                   EndIf
101210040608    2c                   EndSl
101220040608if  2c                   If        *In90
101230040608     c                   z-add     20            H1riga
101240040608     c                   z-add     64            H1colo
101250040608     c                   Eval      wforza1 = *On
101260040608     c                   GoTo      EndC01
101270040608    2c                   EndIf
101280040608    1c                   EndIf
101290910220     C*
101300910220     C* VEDO SE SPROTEGGERE LA SERIE
101310950103     C*
101320950103     C     *IN12         IFEQ      *OFF
101330950103     C                   CLEAR                   VIDNRS
101340950103     C                   ENDIF
101350930624     C* PER DISK CLIENTI
101360940930    1C     *IN12         IFEQ      *ON
101370930624     C     *IN15         ANDEQ     *ON
101380930624     C* PER SPEDIZIONI DI RECUPERO
101390930624     C     *IN12         OREQ      *OFF
101400930624     C     *IN98         ANDEQ     *ON
101410930624     C* PER SPEDIZIONI DI CLIENTI CHE SI ASSEGNANO SOLO I NUMERI SEGNAC
101420930624     C     *IN12         OREQ      *OFF
101430980410     C     §1BFG6        ANDEQ     'C'
101440930624     C     §1BFG2        ANDEQ     'N'
101450930803     C* PER CLIENTI CON SERIE
101460930803     C     *IN12         OREQ      *ON
101470930803     C     *IN15         ANDEQ     *OFF
101480930803     C     VIDNRS        ANDGT     0
101490000225     C* PER CLIENTI DISK "C"
101500000225     C     *IN12         OREQ      *ON
101510000225     C     *IN15         ANDEQ     *OFF
101520000225     C     VIDSOP        ANDEQ     ':'
101530930624     C*
101540000911     C                   CLEAR                   DS3C
101550910311     C                   MOVEL     'N'           §3CFG1
101560921012     C                   MOVEL     ' '           §3CFSP
101570910220     C                   MOVEL     '3C'          COD
101580940921     C                   MOVEL(P)  WKSC          KEY
101590910220     C*
101600930708     C                   EXSR      CTABEL
101610910301     C  N30              MOVEL     TBLUNI        DS3C
101620100517     C* SE IL TERMINAL NON HA ANCHILOSATO, NON LO HA NEMMENO IL CLIENT
101630000204     C     WASDKC        IFNE      'S'
101640000204     C                   CLEAR                   §3CDKC
101650000204     C                   ENDIF
101660921006     C*
101670980805   1AC     *IN30         IFEQ      *OFF
101680980805     C     §3COKD        ANDEQ     '*'
101690980805    2C     *IN12         IFEQ      *OFF
101700921006     C     *IN98         ANDEQ     '1'
101710921006     C                   SETON                                        95
101720921006     C                   MOVEL     §3CNRS        VIDNRS
101730921006     C*
101740940930   X2C                   ELSE
101750921006     C*
101760940930    3C     §3CFG1        IFEQ      'S'
101770910220     C                   SETON                                        95
101780910426     C* SE FLAG6 DEL CLIENTE PROPONGO GIA' LA SERIE
101790940930    4C     §1BFG6        IFEQ      'C'
101800921006     C     VIDNRS        ANDEQ     0
101810910426     C                   MOVEL     §3CNRS        VIDNRS
101820940930    4C                   END
101830910426     C*
101840940930    3C                   END
101850940930    2C                   END
101860980805   1AC                   END
101870980805    1C                   END
101880940930     C*
101890080313      * verifico se cliente ha serie parziale
101900100517     c******             exsr      sr_parz
101910940930     C* PER DISK CLI TENGO QUELLO PASSATO SOLO SE :
101920940930     C*  ABILITATO DA DS DEL CLIENTE
101930940930     C*  ABILITATO IL COD TASSAZIONE ALLA FORZATURA
101940120712     c* ES 12/07/12 --> tolto non più usata da tempo questa forzatura
101950120712     C** 12
101960120712     C*N 15§3CFCT        IFEQ      'S'
101970120712     C**                 MOVEL     'CT'          COD
101980120712     C**                 MOVEL(P)  §LPCTS        KEY
101990940930     C*
102000120712     C**                 EXSR      CTABEL
102010120712     C**N30              MOVEL     TBLUNI        DSCT
102020120712     C**N30§CTFDK        IFEQ      'S'
102030120712     C**                 MOVEL     §LPCTS        SAVCTS
102040120712     C**                 ENDIF
102050120712     C**                 ENDIF
102060910805     C*
102070910805     C* PER DISK CLI SE FLAG 6 NON E' "C" AZZERO LA SERIE
102080910805     C   12
102090910805     CAN 15§1BFG6        IFNE      'C'
102100921019     C     §1BFG8        ANDNE     'N'
102110910805     C                   Z-ADD     0             VIDNRS
102120910805     C                   END
102130940930     C*
102140910410     C* PULIZIA CAMPI NUMERO SEGNACOLLI SE IMMISSIONE E STAMPA SEGNAC
102150910410     C* NELL'ORGANIZZAZIONE
102160910410     C  N12
102170910410     CAN 25              Z-ADD     0             VIDNCD
102180910410     C  N12
102190910410     CAN 25              Z-ADD     0             VIDNCA
102200910606     C* PER DISK CLI AZZERO SOLO SE NON SI ASSEGNA I NUMERI SEGNACOLLI
102210980410     C   12
102220980410     CAN 25
102230980410     CAN 15§1BFG6        IFNE      'C'
102240910606     C                   Z-ADD     0             VIDNCD
102250910606     C                   Z-ADD     0             VIDNCA
102260910607     C                   END
102270910808     C  N12
102280910808     COR 12
102290910808     CAN 15              MOVEL     *BLANKS       VIDFNS
102300910805     C* CONTROLLO SE NON SEQUENZIALI
102310960805     C   12
102320960805    1CAN 15§1BFG7        IFEQ      'S'
102330980410     C     §1BFG6        ANDEQ     'C'
102340920917     C*
102350020917     C     KBLC          SETLL     FIVAD000
102360020917     C     KBLC          READE(N)  FIVAD000                               30
102370960805    3C  N30BLDNCA        IFNE      0
102380941230     C                   Z-ADD     BLDNCA        COMSCD
102390920917     C                   ELSE
102400941230     C                   Z-ADD     BLDNCD        COMSCD
102410960805    3C                   ENDIF
102420941230     C                   Z-ADD     BLDNCD        VIDNCD
102430941230     C                   SUB       BLDNCL        COMSCD
102440910805     C*
102450960805    3C     *IN30         DOWEQ     *OFF
102460941230     C                   ADD       BLDNCL        COMSCD
102470960805    4C     BLDNCA        IFNE      0
102480960805    5C     COMSCD        IFNE      BLDNCA
102490920917     C                   SETON                                        30
102500960805    5C                   ENDIF
102510920917     C*
102520960805   X4C                   ELSE
102530920917     C*
102540960805    5C     COMSCD        IFNE      BLDNCD
102550910805     C                   SETON                                        30
102560960805    5C                   ENDIF
102570960805    4C                   ENDIF
102580920917     C*
102590920917     C   30              MOVEL     'S'           VIDFNS
102600020917     C  N30KBLC          READE(N)  FIVAD000                               30
102610960805    3C                   ENDDO
102620920917     C* NON SEQ.: AZZERO
102630960805    3C     VIDFNS        IFEQ      'S'
102640910805     C                   Z-ADD     0             VIDNCD
102650910805     C                   Z-ADD     0             VIDNCA
102660920917     C*
102670960805   X3C                   ELSE
102680920917     C* SEQ : IMPOSTO SEGNACOLLO AL
102690960805    4C     V1CNCL        IFGT      1
102700960805    5C     BLDNCA        IFNE      0
102710941230     C                   Z-ADD     BLDNCA        VIDNCA
102720960805   X5C                   ELSE
102730941230     C                   Z-ADD     BLDNCD        VIDNCA
102740960805    5C                   ENDIF
102750960805    4C                   ENDIF
102760960805    3C                   ENDIF
102770960805     C* MI SALVO I SEGNACOLLI DAL / AL CHE NON POSSONO ESSERE MODIFICAT
102780960805     C                   Z-ADD     VIDNCD        WNSNCD
102790960805     C                   Z-ADD     VIDNCA        WNSNCA
102800910805     C*
102810960805    1C                   ENDIF
102820961111     C***
102830961111     C*** SE BOLLA EXPORT CON C/A PROTEGGO TIPO INCASSO E DIVISA
102840961111     C***
102850121022     C     COMLNA        IFEQ      0
102860121022     C     WDESIE        ANDEQ     'E'
102870121022     C     COMLNA        ORGT      0
102880121022     c     A_§ogntw      andeq     'EEX'
102890121022     C     COMLNA        ORGT      0
102900121022     c     A_§ogntw      andeq     'FED'
102910121022     C     COMLNA        ORGT      0
102920121022     c     A_§ogntw      andeq     'DPD'
102930020319     c
102940121022     C     §3AFCA        IFGT      0
102950121022     C***                SETON                                        76
102960121022     C***                MOVEL     'BM'          VIDTIC
102970011108     C**         VIDVCA    IFEQ *BLANKS
102980011108     C* Con l'euro la divisa non sarà mai più a blank, quindi propongo
102990011108     C* la divisa della nazione del destinatario solo se importo C/A=0
103000050504     c* 04/05/05: Se divisa della nazione diversa da "EUR" o "USD"
103010050504     c* non propongo niente. Questo per evitare errori da parte del
103020050504     c* bollettista di indicazione della divisa sbagliata in particolar
103030050504     c* per le spedizioni dirette a paesi europei che hanno conservato
103040050504     c* la loro divisa (Svizzera, Danimarca...)
103050121022     C     VIDCAS        IFEQ      *ZEROS
103060121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
103070121022     C                   MOVEL     DESVLT        VIDVCA
103080121022     C                   MOVEL     DESVLT        VARVCA
103090121022     c                   else
103100121022     C                   clear                   VIDVCA
103110121022     C                   clear                   VARVCA
103120121022     c                   endif
103130121022     C                   ENDIF
103140980219     C**
103150121022     C                   ELSE
103160121022     C                   CLEAR                   VIDTIC
103170121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
103180121022     C                   MOVEL     DESVLT        VIDVCA
103190121022     C                   MOVEL     DESVLT        VARVCA
103200121022     c                   else
103210121022     C                   clear                   VIDVCA
103220121022     C                   clear                   VARVCA
103230121022     c                   endif
103240121022     C                   ENDIF
103250011108     C                   ELSE
103260011108     C* SE DESTINATARIO NON È EXPORT E IMPORTO CONTRASSEGNO = 0
103270011108     C* PROPONGO GEDCN
103280011108     C     VIDCAS        IFEQ      *ZEROS
103290011108     C                   MOVEL     §GEDCN        VIDVCA
103300011108     C                   MOVEL     §GEDCN        VARVCA
103310011108     C                   ENDIF
103320961111     C                   ENDIF
103330091210     c***
103340091210     C*** Richiamo routine per impostare eventuali forzature flag DDT
103350091210     c***
103360091210     c                   exsr      SR_FRZBAM
103370070326     c***
103380070326     C* IMPOSTO LNA DPD SE NON 'C'E'
103390070326    1C     VIDDPD        IFEQ      'D'
103400070326     C     WDESIE        ANDEQ     'E'
103410070326     C     A_§OGNTW      OREQ      'DPD'
103420070326    2C     VIDLNA        IFLE      *ZEROS
103430070326     C     DESLAD        ANDGT     0
103440070326     C                   Z-ADD     DESLAD        COMLNA
103450070326    2C                   ENDIF
103460070326    1C                   ENDIF
103470070326     C* SE NUMERO AUTOMATICO, LO PRELEVO
103480070326     c* 22/03/07: Prelevo quello automatico anche nel caso di inserimen
103490070326     c* to numero parcel lungo 12 in quanto dal 01/04/07 non saranno
103500070326     c* più gestiti da DPD
103510070326     C  N12
103520070326    1COR 15VIDDPD        IFEQ      'D'
103530070326     C     WDESIE        ANDEQ     'E'
103540070326     C     A_§OGNTW      OREQ      'DPD'
103550070326    2c                   if        Comnrd=0 and (§1bf13='A' or
103560070326     c                             wparcel='12')
103570070515    3c****               if        dateu >= §vpodpd
103580070326     c                   clear                   trul33ds
103590070326     c                   z-add     25            i33cnu
103600070326     c                   z-add     1             i33num
103610070326     c                   movel     trul33ds      kpjbu
103620070326     c                   call      'TRUL33R'
103630070326     c                   PARM                    kpjba
103640070326     c                   movel     kpjbu         trul33ds
103650070326    4c     o33err        ifgt      *zeros
103660070326     c                   seton                                        90
103670070326    5c                   select
103680070326     c     o33err        wheneq    1
103690070326     c                   movel     err(300)      vidmsg
103700070326     c     o33err        wheneq    2
103710070326     c                   movel     err(301)      vidmsg
103720070326     c     o33err        wheneq    3
103730070326     c                   movel     err(302)      vidmsg
103740070326    5c                   endsl
103750070326     c                   goto      endc01
103760070326    4c                   endif
103770070326     c                   z-add     o33nri        comnrd
103780070515   x3c****               else
103790070515     C**** KTBE          CHAIN     TNTBE02L                           30
103800070326     C* E NON C'E' LO CREO
103810070515     C***30              CLEAR                   TNTBE000
103820070515     C***30              CLEAR                   DCHI
103830070515     C**N30              MOVEL     TBEUNI        DCHI
103840070515     C***                ADD       1             §CHINM
103850070515     C***                MOVEL     DCHI          TBEUNI
103860070515    3C***  *IN30         IFEQ      *OFF
103870070515     C***                UPDATE    TNTBE000
103880070515     C***                ELSE
103890070515     C***                MOVEL     KTCOD         TBECOD
103900070515     C***                MOVEL     KTLIN         TBELIN
103910070515     C***                MOVEL     KTSIF         TBESIF
103920070515     C***                MOVEL     KTKE1         TBEKE1
103930070515     C***                MOVEL     KTKE2         TBEKE2
103940070515     C***                MOVEL     'DP'          TBEKE2
103950070515     C***                WRITE     TNTBE000
103960070515    3C***                ENDIF
103970070515     C***                CLEAR                   DPDBRC
103980070515     C***                MOVEL     §CHINM        DPDBRC
103990070515     C***                CLEAR                   DPDCHD
104000070515     C***                EXSR      M1031
104010070515     C***                z-add     DPDBRC        COMNRD
104020070515    3c***                endif
104030070326    2c                   endif
104040070326    1c                   endif
104050070326     c* Impostazione numero parcel dpd: se attribuzione automatica o
104060070326     c* numero parcel lungo 12 coincide con numero preso da numeratore
104070070326     c* altrimenti è quello immesso a video
104080070326    1c                   if        (*in12='0' or *in15=*on) and
104090070326     c                             ((viddpd='D' and wdesie='E') or
104100070326     c                             A_§ogntw='DPD')
104110070326     c                             and (§1bf13='A' or wparcel='12')
104120070515    2c***                if        dateu >= §vpodpd
104130070326     c                   move      comnrd        v7cnpr
104140070515   x2c***                else
104150070326     c** parcel lungo 12
104160070515     c***                z-add     comnrd        w0120            12 0
104170070515     C***                movel     w0120         V7CNPR
104180070515    2c***                endif
104190070326     c* se sono in bollettazione (no conferma bolle) non propongo più
104200070326     c* numero parcel dpd nel RMN
104210070326    2C   15VIDRMN        IFEQ      0
104220070326     C                   z-add     COMNRD        VIDRMN
104230070326    2C                   ENDIF
104240070326   x1c                   else
104250070326    2c                   if        (*in12='0' or *in15=*on) and
104260070326     c                             vidnrd<>*blanks
104270070326     c* se numero dpd numerico lo propongo nel rif.mittente come segue:
104280070326     c* - Se spedizione export --> solo in conferma bolle da cliente
104290070326     c* - Se spedizione import --> sempre
104300070326     c* se numero dpd alfanumerico e spedizione import imposto 1 in rmn
104310070326     c* Numero parcel dpd numerico
104320070326    3c                   if        wsolo_num=*blanks
104330070326     c* export
104340070326    4c                   if        (*in15=*on and *in79=*off
104350070326     c                             and vidrmn=0)
104360070326     c* import
104370070326     c                             or (*in79='1')
104380070326     c                   clear                   vidrmn
104390070326    5c                   if        %subst(vidnrd:14:1) <> *blanks
104400070326     C                   move      VIDNRD        VIDRMN
104410070326     c                   else
104420070326     c                   eval      w012a=%subst(vidnrd:1:12)
104430070326     c                   move      w012A         vidrmn
104440070326    5c                   endif
104450070326    4C                   ENDIF
104460070326   x3c                   else
104470070326     c* Numero parcel dpd alfanumerico
104480070326    4c                   if        *in79='1'
104490070326     c                   z-add     1             vidrmn
104500070326    4c                   endif
104510070326    3c                   endif
104520070326     C                   movel     VIDNRD        V7CNPR
104530070326    2c                   endif
104540070326    1c                   endif
104550000623     C***
104560000623     C* CONTROLLO SE ESISTE LA DS3Q PER IL CIENE MITTENTE
104570970326     C***
104580000623     C                   CLEAR                   WES3Q
104590000623     C                   MOVEL     '3Q'          COD
104600000623     C                   MOVEL(P)  WKSC          KEY
104610000623     C*
104620000623     C                   EXSR      CTABEL
104630000623     C  N30              MOVEL     'S'           WES3Q             1
104640000623     C   30              MOVEL     ' '           WES3Q             1
104650011112     C***
104660011112     C* DIVISA IMPORTO DA ASSICURARE: PROPONGO DIVISA NAZIONE MITTENTE
104670011112     C*        SE ESTERO ALTIMENTI PROPONGO §GEDCN
104680011112     C***
104690011112     C     VIDIAS        IFEQ      *ZEROS
104700011112     C     MITVLT        IFNE      *BLANKS
104710011112     C     WMITIE        ANDEQ     'E'
104720011112     C                   MOVEL     MITVLT        VIDVAS
104730011112     C                   MOVEL     MITVLT        VARVAS
104740011112     C                   ELSE
104750011112     C                   MOVEL     §GEDCN        VIDVAS
104760011112     C                   MOVEL     §GEDCN        VARVAS
104770011112     C                   ENDIF
104780011112     C                   ENDIF
104790011113     C***
104800011113     C* DIVISA VALORE MERCE DICHIAR.: PROPONGO DIVISA NAZIONE MITTENTE
104810011113     C*        SE ESTERO, ALTIMENTI PROPONGO §GEDCN
104820011113     C***
104830011113     C     VIDVMD        IFEQ      *ZEROS
104840011115     C     MITVLT        IFNE      *BLANKS
104850011113     C     WMITIE        ANDEQ     'E'
104860011113     C                   MOVEL     MITVLT        VIDVAD
104870011113     C                   MOVEL     MITVLT        VARVAD
104880011113     C                   ELSE
104890011113     C                   MOVEL     §GEDCN        VIDVAD
104900011113     C                   MOVEL     §GEDCN        VARVAD
104910011113     C                   ENDIF
104920011115     C                   ENDIF
104930000120     C***
104940940920     C     ENDC01        TAG
104950940909     C   90              MOVEL     '1'           WEMFOR
104960940909     C                   ENDSR
104970940224     C*
104980940921     C* RICERCA E CARICAMENTO A VIDEO TARIFFE ------------------------*
104990940224     C     RICTAR        BEGSR
105000940921     C                   SETOFF                                       30
105010941221     C                   CLEAR                   WTACAR
105020941221     C                   CLEAR                   WTKS
105030991026     C                   CLEAR                   COMDIV
105040940921     C*
105050940921     C* PER DISK CLI PRENDO SEMPRE LA TARIFFA DEL CLIENTE
105060940921    1C     *IN12         IFEQ      *ON
105070940921     C     *IN15         ANDEQ     *ON
105080940921     C                   MOVEL     §LPCTR        VIDCTR
105090050921     C                   MOVEL     §LPCTR        ilv59ctr
105100050921     C                   MOVEL     'S'           ilv59ric
105110940921     C*
105120940921   X1C                   ELSE
105130010223     C*
105140130404     c* 1) caso IMISSIONE
105150130404     c* 2) caso manutenzione con ricaricamento tariffe
105160010223    2C  N29WORM          IFEQ      'S'
105170010223     C     FLGFIT        ANDNE     'S'
105180010223     C     PARTCH        ANDNE     'P'
105190050921     C     ilv59ric      ANDEQ     'S'
105200010223    3C     *IN12         IFEQ      *OFF
105210010223     C     *IN15         OREQ      *OFF
105220010223     C     WORMMD        ANDEQ     '1'
105230030905    4c                   If        §OrPfb <> 'A'
105240010223     C                   MOVE      VIDCCM        W0070             7 0
105250010223    5C     VIDFLC        IFEQ      *ZEROS
105260010223     C                   MOVEL     VIDLNP        W0070
105270010223     C                   ELSE
105280010223     C                   MOVEL     VIDFLC        W0070
105290010223    5C                   ENDIF
105300010223    5C     W0070         IFEQ      ORMKSC
105310010223     C     ORMCTR        ANDNE     *BLANKS
105320010223     C                   MOVE      ORMCTR        VIDCTR
105330010223     C                   MOVE      ORMCTR        PRECTR
105340050921     C                   MOVE      ORMCTR        ilv59ctr
105350010223    5C                   ENDIF
105360010223    4C                   ENDIF
105370010223    3C                   ENDIF
105380010223    2C                   ENDIF
105390130404     c*
105400130404     c* 3) caso manutenzione solo con  cambio ORM
105410130404    2C  N29WORM          IFEQ      'S'
105420130404     C     FLGFIT        ANDNE     'S'
105430130404     C     PARTCH        ANDNE     'P'
105440130404     C     ilv59ric      ANDEQ     ' '
105450130404     C     *IN12         andeq     *On
105460130404     C     *IN15         andeq     *OFF
105470130404     C     WORMMD        ANDEQ     '1'
105480130404     C     ORMCTR        ANDNE     *BLANKS
105490130404    4c                   If        §OrPfb <> 'A'
105500130404     C                   MOVE      VIDCCM        W0070             7 0
105510130404    5C     VIDFLC        IFEQ      *ZEROS
105520130404     C                   MOVEL     VIDLNP        W0070
105530130404     C                   ELSE
105540130404     C                   MOVEL     VIDFLC        W0070
105550130404    5C                   ENDIF
105560130404    5C     W0070         IFEQ      ORMKSC
105570130404     c                   if        ormctr<>vidctr
105580130404     c                   eval      CambiaCTR='S'
105590130404     c                   endif
105600130404     C                   MOVE      ORMCTR        VIDCTR
105610130404     C                   MOVE      ORMCTR        PRECTR
105620130404     C                   MOVE      ORMCTR        ilv59ctr
105630130404    5C                   ENDIF
105640130404    4C                   ENDIF
105650130404    2C                   ENDIF
105660940921     C*
105670940224     C* PER : IMMISSIONE (SE NON PERSONALIZZATO IL COD TARIFFA)
105680940921     C*       E MANUTENZIONE BOLLE
105690941107    2C     *IN29         IFEQ      *ON
105700941231     C* SE NON LO DEVO RICARICARE, IMPOSTO IL CODICE TARIFFA
105710050921     C     ilv59ric      ORNE      'S'
105720050921     C                   MOVEL     VIDCTR        ilv59ctr
105730941107    2C                   ENDIF
105740941107    1C                   ENDIF
105750950525     C* SE VIDCTR = '   ' E' COME SE LO DOVESSI RICARICARE
105760950525     C     VIDCTR        IFEQ      *BLANKS
105770050921     C                   MOVEL     'S'           ilv59ric
105780950525     C                   ENDIF
105790941107     C*
105800941107     C* SE ESISTONO TARIFFE PER IL CLIENTE CERCO
105810050921     C                   MOVEL     'P'           ilv59tbo
105820040512      * se bolla monovaria pulisco il tipo bolla
105830040512     C                   IF        §3ASVA <> *BLANK
105840050921     C                   CLEAR                   ilv59tbo
105850050921     c                   movel     'P'           ilv59prp
105860040512     C                   ENDIF
105870040512
105880050921     C                   MOVEL     WKSC          ilv59ksc
105890050921     C                   MOVEL     KCI           ilv59kci
105900050921     C                   MOVEL     BLPDSP        ilv59dsp
105910050921     C                   MOVEL     VIDTSP        ilv59tsp
105920050921     C                   MOVEL     WFIE          ilv59fie
105930050921     C                   CALL      'FNLV59R'
105940050921     C                   PARM                    fnlv59ds
105950900528     C*
105960050922     c* se avevo richiamato con CON e RIC vuoti il cod.tariffa non
105970050922     c* viene impostato. Quindi in questo caso non imposto vidctr
105980050922     c* Avrei potuto condizionare il richiamo di fnlv59r da con e/o ric
105990050922     c* pieni ma in questo caso mi si poneva il problema dell'impostazi
106000050922     c* one di wtacar, wtks e comdiv in caso di manutenzione.
106010050922     c                   if        ilv59ric <> ' ' or ilv59con <> ' '
106020080403     c*
106030080326     c                   if        olv59ctr<>vidctr
106040080326     c                   eval      CambiaCTR='S'
106050080326     c                   endif
106060080326     c
106070050921     C                   MOVEL     olv59ctr      VIDCTR
106080050921     C                   MOVEL     olv59dfs      DEFCTR
106090050922     c                   endif
106100941221     C*
106110941221     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDO SEMPRE DATI DAL
106120941221     C* LA TARIFFA DI CARTELLO
106130050921     C     olv59tks      IFEQ      ' '
106140941221     C                   MOVEL     'S'           WTACAR            1
106150950410     C                   CLEAR                   UND
106160950410     C* SOLO SE LA DEVO RICARICARE LA AZZERO
106170050921     C  N29ilv59ric      IFEQ      'S'
106180941221     C                   MOVEL     *ZEROS        VIDCTR
106190021120      * Per bolla FedEx imposto il codice tariffa della cartello FedEx
106200021120     c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
106210021120     c                   Movel     O27Ctr        VidCtr
106220021120     c                   EndIf
106230950410     C                   ENDIF
106240941221     C                   ENDIF
106250950410     C*
106260050921     C                   MOVEL     olv59tks      WTKS
106270941231     C* SE HO RICERCATO LA TARIFFA RICARICO IL PRG ALTRIMENTI
106280941231     C*  LO PULISCO
106290050921     C     ilv59ric      IFEQ      'S'
106300050921     C     olv59err      ANDEQ     ' '
106310050921     C     olv59tks      ANDEQ     'S'
106320050921     C                   MOVEL     olv59prg      COMPRG
106330941231     C                   ENDIF
106340950103     C*
106350050921     C     olv59err      IFNE      ' '
106360050921     C     olv59tks      ORNE      'S'
106370941231     C                   Z-ADD     0             COMPRG
106380941231     C                   ENDIF
106390940921     C*
106400940921     C* SE LA TARIFFA E' FRA QUELLE TROVATE, CARICO GLI ALTRI DATI DEL
106410941110     C* ALTRIMENTI LI PRENDO SEMPRE DALLA TARIFFA DI CARTELLO
106420050921     C     ilv59ric      IFEQ      'S'
106430940922     C                   EXSR      CTNTAM
106440010223     C*
106450950103     C                   ENDIF
106460941107     C*
106470941107     C* IMPOSTO I CAMPI DEI CODICI TARIFFA A VIDEO
106480050921     C                   MOVEL     olv59ct2      VIDCT2
106490050921     C                   MOVEL     olv59ct3      VIDCT3
106500050921     C                   MOVEL     olv59ct4      VIDCT4
106510050921     C                   MOVEL     olv59ct5      VIDCT5
106520050921     C                   MOVEL     olv59es2      VIDES2
106530050921     C                   MOVEL     olv59es3      VIDES3
106540050921     C                   MOVEL     olv59es4      VIDES4
106550050921     C                   MOVEL     olv59es5      VIDES5
106560940921     C*
106570940922     C* OGNI VOLTA CHE MODIFICATO IL COD MITTENTE, PER CUI RICARICO
106580940922     C*  LE TARIFFE, IMPOSTO "SAVCTR" CON QUELLO PROPOSTO
106590940922     C*  IN QUANTO I CAMPI LI HO PROPOSTI A VIDEO
106600940922     C                   MOVEL     VIDCTR        SAVCTR
106610930803     C                   SETOFF                                       30
106620900504     C                   ENDSR
106630940922     C*
106640940922     C* CHAIN SU TNTAM00F PER PRENDERE I CAMPI DA PROPORRE -----------*
106650940922     C     CTNTAM        BEGSR
106660941221     C                   SETOFF                                       30
106670010226     C                   CLEAR                   WNNTAR
106680010226     C                   CLEAR                   WN1TAR
106690050926     C                   CLEAR                   fvol              1
106700941231     C*
106710941231    1C     WTACAR        IFEQ      ' '
106720941231     C* ERRORE: NON TROVATA PROGRESSIVO COL CODICE TARIFFA
106730941231     C* IMPOSTATO
106740050921    2C     olv59err      IFNE      ' '
106750941221     C                   SETON                                        30
106760941221     C                   ELSE
106770941231     C                   MOVEL     VIDCTR        COMCTR
106780941231     C**
106790940922     C     KTAM2         CHAIN     TNTAM000                           30
106800110304     c
106810941231    2C                   ENDIF
106820941221     C*
106830941231   X1C                   ELSE
106840941221     C* TARIFFA DI CARTELLO
106850941107     C     KCAR2         CHAIN     TNTAM000                           30
106860941231    1C                   ENDIF
106870941221     C  N30              MOVEL     TAMDCV        DEVCTR
106880040610     C  N30              MOVEL     TAMflo        dsta01
106890961203     C* PRENDO TASSAZIONE TARIFFA MITT SOLO SE NON PROVENGO DA
106900961203     C*  GIACENZE PERCHE' IN DIROTTAMENTO NON HO PIU' LE TARIFFE
106910961203     C*  ORIGINALI
106920961203     C  N30
106930961203     CANN87              MOVEL     TAMFTM        SAVFTM
106940941221     C   30              CLEAR                   DEVCTR
106950941221     C   30              CLEAR                   SAVFTM
106960940922     C*
106970940922     C* PER DISK CLIENTI
106980940922     C* I CAMPI LI PRENDO SOLO SE SONO VUOTI
106990940922     C* PER IL RESTO       SEMPRE
107000941231    1C     *IN12         IFEQ      *ON
107010940922     C     *IN15         ANDEQ     *ON
107020970328     C*
107030970328     C  N30§LPBAM        IFEQ      ' '
107040970328     C                   MOVEL     TAMBAM        VIDBAM
107050970328     C                   ENDIF
107060940922     C*
107070941231    2C     §LPNAS        IFEQ      *BLANKS
107080941221     C  N30              MOVEL     TAMNAS        VIDNAS
107090030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
107100030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
107110030409     c                             and Not *In30
107120030409     c                   Clear                   VidNas
107130030409     c                   EndIf
107140941221     C   30              CLEAR                   VIDNAS
107150941231    2C                   ENDIF
107160040610     c* Tipo merce: V-Valore
107170040610     C  N30§lpbva        IFEQ      ' '
107180040610     c     §1bfg8        andne     'N'
107190040610     C                   MOVEL     §tabva        VIDbva
107200040610     C                   ENDIF
107210040610     c*
107220941231    2C     §LPNOT        IFEQ      *BLANKS
107230941221     C  N30              MOVEL     TAMNOT        VIDNT1
107240941221     C   30              CLEAR                   VIDNT1
107250941231   X2C                   ELSE
107260941231    3C     §LPNT2        IFEQ      *BLANKS
107270941221     C  N30              MOVEL     TAMNOT        VIDNT2
107280941221     C   30              CLEAR                   VIDNT2
107290941231    3C                   ENDIF
107300941231    2C                   ENDIF
107310940922     C*§
107320940922     C* GESTIONE PARTIC.C/A SOLO SE BOLLA CON C/A
107330941231    2C     §3AFCA        IFNE      0
107340940922     C     §LPGCA        ANDEQ     *BLANKS
107350940922     C     §3AFCA        ANDNE     0
107360941221     C  N30              MOVEL     TAMGCA        VIDGCA
107370941221     C   30              CLEAR                   VIDGCA
107380941231    2C                   ENDIF
107390941231    2C     §LPGGA        IFEQ      *BLANKS
107400941221     C  N30              MOVEL     TAMGGA        VIDGGA
107410941221     C   30              CLEAR                   VIDGGA
107420941231    2C                   ENDIF
107430941231    2C     §LPGMA        IFEQ      *BLANKS
107440100215     C  N30              MOVEL     TAMGMA        VIDGMA
107450941221     C   30              CLEAR                   VIDGMA
107460941231    2C                   ENDIF
107470941231    2C     §LPGVA        IFEQ      *BLANKS
107480941221     C  N30              MOVEL     TAMGVA        VIDGVA
107490941221     C   30              CLEAR                   VIDGVA
107500941231    2C                   ENDIF
107510940922     C*
107520941231   X1C                   ELSE
107530010226     C*
107540010226     C* NATURA MERCE
107550010226     C* SE NON E' STATA PERSONALIZZATA ED E' ATTIVATA PROCEDURA ORM
107560010226     C* DEVO PROPORRE LA NATURA MERCE DELL'ORM SE PRESENTE E NON
107570010226     C* QUELLA DA TARIFFA.
107580010226     C* IDEM PER LE NOTE
107590011221     C                   MOVEL     ORMNAM        W015A
107600010226    3C     WORM          IFEQ      'S'
107610010226     C     FLGFIT        ANDNE     'S'
107620010226     C     PARTCH        ANDNE     'P'
107630050921     C     ilv59ric      ANDEQ     'S'
107640010226     C     *IN27         IFEQ      *OFF
107650011221     C     W015A         ANDNE     *BLANKS
107660010226     C                   MOVEL     ORMNAM        VIDNAS
107670010226     C                   MOVEL     '1'           WNNTAR            1
107680010226     C                   ENDIF
107690010404     C* NOTE SE PESO > 50 Q.LI  O SE O.R.M COMMISSIONATO
107700010307    4C                   SELECT
107710010307     C     §LPFPR        WHENEQ    'O'
107720050211     C***  ORMPOE        ORNE      ORMPOR
107730080326     c                   if        vidnt1=*blanks
107740010307     C                   MOVEL     WTELRF        VIDNT1
107750080326     c                   else
107760080326     c                   if        vidnt2=*blanks
107770080326     C                   MOVEL     WTELRF        VIDNT2
107780080326     c                   endif
107790080326     c                   endif
107800080326     c
107810010307     C                   MOVEL     '1'           WN1TAR
107820010409     C     VIDPKG        WHENGE    §DFMAX
107830010226    5C     ORMNO1        IFNE      *BLANKS
107840080326     c                   if        vidnt1=*blanks
107850010226     C                   MOVEL     ORMNO1        VIDNT1
107860080326     c                   else
107870080326     c                   if        vidnt2=*blanks
107880080326     C                   MOVEL     ORMNO1        VIDNT2
107890080326     c                   endif
107900080326     c                   endif
107910010226     C                   MOVEL     '1'           WN1TAR            1
107920010226    5C                   ENDIF
107930010307    4C                   ENDSL
107940010226    3C                   ENDIF
107950941231     C*
107960941231    3C     *IN30         IFEQ      *OFF
107970080326   3ac                   if        CambiaCTR='S'
107980080326     c
107990080326    4C     WNNTAR        IFEQ      *BLANKS
108000080326     c* solo se ho modificato la tariffa
108010941231     C  N27              MOVEL     TAMNAS        VIDNAS
108020030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
108030080326    5c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
108040030409     c                             and Not *In27
108050030409     c                   Clear                   VidNas
108060080326    5c                   EndIf
108070080326    4C                   ENDIF
108080080326    4C     WN1TAR        IFEQ      *BLANKS
108090080326     c* In manutenzione solo se sono vuote
108100080326    5c     vidnt1        ifeq      *blanks
108110110304     c     vidnt1        oreq      savnot
108120940922     C                   MOVEL     TAMNOT        VIDNT1
108130110304     c                   movel     tamnot        savnot
108140080326     c                   else
108150080326    6c     vidnt2        ifeq      *blanks
108160110304     c     vidnt2        oreq      savnot
108170080326     C                   MOVEL     TAMNOT        VIDNT2
108180110304     c                   movel     tamnot        savnot
108190080326    6c                   endif
108200080326    5c                   endif
108210080326     c
108220080326    4C                   ENDIF
108230080326     c
108240080326    4c     atrbva        ifne      prri
108250040610     c     §1bfg8        andne     'N'
108260040610     c                   movel     §tabva        vidbva
108270080326    4c                   endif
108280941231    4C     §3AFCA        IFNE      0
108290940922     C                   MOVEL     TAMGCA        VIDGCA
108300941231    4C                   ENDIF
108310940922     C                   MOVEL     TAMGGA        VIDGGA
108320940922     C                   MOVEL     TAMGMA        VIDGMA
108330940922     C                   MOVEL     TAMGVA        VIDGVA
108340970128     C                   MOVEL     TAMBAM        VIDBAM
108350080326   3ac                   endif
108360080326     c
108370941231   X3C                   ELSE
108380941221     C*
108390941221     C* PULISCO I CAMPI CHE PRENDO DA TARIFFA
108400010226     C     WNNTAR        IFEQ      *BLANKS
108410941221     C  N27              CLEAR                   VIDNAS
108420010226     C                   ENDIF
108430080326   3ac                   if        CambiaCTR='S'
108440080326     C**   WN1TAR        IFEQ      *BLANKS
108450080326     C**                 CLEAR                   VIDNT1
108460080326     C**                 ENDIF
108470040610     c                   clear                   vidbva
108480941221     C                   CLEAR                   VIDGCA
108490941221     C                   CLEAR                   VIDGGA
108500941221     C                   CLEAR                   VIDGMA
108510941221     C                   CLEAR                   VIDGVA
108520970128     C                   MOVEL     'N'           VIDBAM
108530080326   3aC                   ENDIF
108540080326    3C                   ENDIF
108550010226     C*
108560941231    1C                   ENDIF
108570940922     C*
108580950125     C* IN MANUTENZIONE SE CAMBIANO CLIENTE, CAMBIO SEMPRE
108590950125     C*     IL TIPO SERVIZIO a meno che non sia stato inserito
108600950125     C*
108610950125     C* IN IMMISSIONE TIPO SERVIZIO LO PRENDO SOLO SE NON IMMESSO
108620950103    1C     VIDTSP        IFEQ      ' '
108630950125     C*
108640950125     C     *IN12         OREQ      *ON
108650950125     C     *IN15         ANDEQ     *OFF
108660950125     C     VIDTSP        ANDEQ     BLPTSP
108670950125     C     TAMTSP        ANDNE     BLPTSP
108680050921     C     ilv59ric      ANDEQ     'S'
108690950410     C     DOD           ANDEQ     0
108700100330     c     wesore        andne     'S'
108710100330     c
108720100330     c     wesore        andne     'S'
108730100330     c
108740941110     C* DECODIFICO
108750941110     C                   Z-ADD     1             C                 3 0
108760941110     C     TAMTSP        LOOKUP    TSP(C)                                 30
108770090604     C**!30              MOVEL     DTS(C)        V2DTSP
108780090604     C   30              MOVEL     DTS08(C)      V2DTSP
108790941110     C  N30              CLEAR                   V2DTSP
108800941110     C* SALVO
108810941110     C                   MOVEL     TAMTSP        COMTSP
108820941107     c*
108830950410     C* EMETTO IL MESSAGGIO SOLO SE CIO' CHE C'E' IN BOLLA E' DIVERSO
108840950103    2C     *IN12         IFEQ      *ON
108850941110     C     *IN15         ANDEQ     *OFF
108860941107     C                   MOVEA     ERR(17)       K78
108870941107     C*
108880950125     C                   MOVEA     BLPTSP        K78(31)
108890950125     C                   MOVEL     WDETSP        W008A             8
108900950125     C                   MOVEA     W008A         K78(33)
108910941107     C*
108920950125     C                   MOVEA     TAMTSP        K78(53)
108930090604     C**!!!              MOVEL     DTS(C)        W008A             8
108940090604     C                   MOVEL     DTS08(C)      W008A             8
108950950125     C                   MOVEA     W008A         K78(55)
108960941107     C                   MOVEA     K78           VIDMSG
108970950125     C                   CLEAR                   VIDTSP
108980950125     C                   CLEAR                   V1DTSP
108990950125     C                   CLEAR                   VARTSP
109000950410     C                   MOVEL     1             DOD
109010950410     C                   SETON                                        9048
109020950103    2C                   ENDIF
109030950103    1C                   ENDIF
109040941107     C*
109050940922     C                   ENDSR
109060021120      *---------------------------------------------------------------*
109070021120      * Ricerco e carico tariffe
109080021120      *---------------------------------------------------------------*
109090021120     c     TarCar        BegSr
109100021120
109110021120     c                   exsr      riccar
109120021120     c   90              goto      endTar
109130021120     c                   movel     o27fie        wfie
109140021120
109150021120     c* protezione p.iva del mittente
109160021120     c     *in04         ifeq      *on
109170021120     c                   select
109180021120     c     o27ntw        wheneq    'DPD'
109190021120     c     desefd        andeq     *blanks
109200021120     c     wdesie        andeq     'E'
109210021120     c                   seton                                        39
109220021120     c     o27ntw        wheneq    'FED'
109230021120     c     deseff        andeq     *blanks
109240021120     c     wdesie        andeq     'E'
109250021120     c                   seton                                        39
109260021120     c     o27ntw        wheneq    'EEX'
109270021120     c     deseft        andeq     *blanks
109280021120     c     wdesie        andeq     'E'
109290021120     c                   seton                                        39
109300021120     c     o27ntw        wheneq    'PPT'
109310021120     c     o27ntw        oreq      'COR'
109320021120     C                   SETON                                        39
109330021120     c                   endsl
109340021120     c                   endif
109350021120     C***
109360021120     C*** CARICAMENTO DEI CODICI TARIFFA ***
109370050921     C                   CLEAR                   fnlv59ds
109380080403     c                   clear                   CambiaCTR         1
109390080403     c*
109400080403     c                   if        *in29 and vidctr<>savctr
109410080403     C                   MOVEL     'S'           ilv59ric
109420080403     c                   MOVEL     'S'           CambiaCTR
109430080403     c                   endif
109440021120     C*
109450021120     C* SE MODIFICATO IL FLAG ITALIA ESTERO --> SEMPRE
109460021120     C     WFIE          IFNE      SAVFIE
109470050921     C                   MOVEL     'S'           ilv59ric
109480021120     C                   MOVEL     WFIE          SAVFIE
109490021120     C                   ENDIF
109500021120     C* IL TIPO SERVIZIO
109510021120     C     VIDTSP        IFNE      VARTSP
109520050921     C                   MOVEL     'S'           ilv59ric
109530021120     C                   MOVEL     VIDTSP        VARTSP
109540021120     C                   ENDIF
109550021120     C*
109560021120     C*  IL CODICE MITTENTE PER MANUTENZIONE
109570021120    1C     *IN12         IFEQ      *OFF
109580021120     C     *IN15         OREQ      *OFF
109590021120     C*
109600021120     C* DA ASSEGNATO CODIFICATO AD ASSEGNATO NON CODIFICATO --> PULISCO
109610021120     C*  I CAMPI PRESI DA TARIFFA
109620021120    2C     VIDCCM        IFEQ      9999
109630021120     C     SAVCCM        IFNE      0
109640021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
109650021120     C                   MOVEL     *ZEROS        SAVCCM
109660021120     C                   CLEAR                   TRE
109670021120     C                   CLEAR                   DOD
109680021120     C*
109690021120     C* VADO IN CARICAMENTO TARIFFA SOLO PER PULIRE LE SKIERE
109700050921     C                   MOVEL     'S'           ilv59ric
109710080403     C                   MOVEL     'S'           CambiaCTR
109720080403     c
109730021120     C                   ENDIF
109740021120     C*
109750021120   X2C                   ELSE
109760021120     C* ASSEGNATO CON MITTENTE CODIFICATO
109770021120     C*
109780021120     C* MITTENTE MODIFICATO
109790021120    3C     WKSC          IFNE      SAVCCM
109800050921     C                   MOVEL     'S'           ilv59ric
109810080403     C                   MOVEL     'S'           CambiaCTR
109820021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
109830021120     C                   MOVEL     WKSC          SAVCCM
109840021120     C                   CLEAR                   TRE
109850021120     C                   CLEAR                   DOD
109860021120    3C                   ENDIF
109870021120    2C                   ENDIF
109880021120     C* VARIATO NUMERO ORM
109890021120     C     CHGORM        IFEQ      'S'
109900021120     C                   CLEAR                   CHGORM
109910130404     C******             MOVEL     'S'           ilv59ric
109920021120     C                   ENDIF
109930021120     C*
109940021120    1C                   ENDIF
109950021120     C*
109960021120     C* CARICO TARIFFE DEL CLIENTE
109970021120     C*
109980021120     C* IMPOSTO CODICE TARIFFA A VIDEO
109990021120     C* IN MANUTENZIONE LE TARIFFE VENGONO RICARICATE SOLO SE MODIFICAT
110000021120     C                   EXSR      RICTAR
110010021120     C* SE IL CLIENTE NON HA TARIFFA--> ERRORE FORZABILE
110020021120     C* SE IL CLIENTE NON HA TARIFFA DPD --> ERRORE NON FORZABILE
110030021120     C     WTKS          IFEQ      ' '
110040021120     C     VIDCCM        ANDNE     8888
110050021120     C     VIDCCM        ANDNE     9999
110060021120     C     WFIE          IFNE      'D'
110070021120     c     wfie          andne     'F'
110080021120     c     wfie          andne     'N'
110090021120     c     wfie          andne     'M'
110100021120     C     TRE           IFEQ      0
110110021120     C                   MOVEL     ERR(84)       VIDMSG
110120021120     C                   SETON                                        9050
110130021120     C                   MOVEL     1             TRE
110140021120     C                   GOTO      ENDTar
110150021120     C                   ENDIF
110160021120     C                   ELSE
110170021120     c     wfie          ifeq      'D'
110180021120     C                   MOVEL     ERR(188)      VIDMSG
110190021120     c                   else
110200021120     C                   MOVEL     ERR(246)      VIDMSG
110210021120     c                   endif
110220021120     C                   SETON                                        9050
110230021120     C                   GOTO      ENDTar
110240021120     C                   ENDIF
110250021120     C                   ENDIF
110260021120
110270021120     c     EndTar        EndSr
110280020207     C*
110290020207     C* RICERCA TARIFFA DI CARTELLO ----------------------------------*
110300020207     C     RICCAR        BEGSR
110310020213     c*
110320021120     c                   Z-Add     VidPkg        I27Pkg
110330020213     c                   movel     vidtsp        i27tsp
110340020213     c                   z-add     vidlnp        i27lnp
110350020213     c     comlna        ifgt      *zeros
110360020213     c                   z-add     comlna        i27lna
110370020213     c                   else
110380020213     c                   select
110390020213     c     viddpd        wheneq    'D'
110400020213     c     wdesie        andeq     'E'
110410020213     c                   movel     'D'           i27tln
110420020213     c     viddpd        wheneq    'F'
110430020213     c     wdesie        andeq     'E'
110440020213     c                   movel     'F'           i27tln
110450020213     c     viddpd        wheneq    ' '
110460020213     c     wdesie        andeq     'E'
110470020213     c                   movel     'E'           i27tln
110480020213     c                   other
110490020213     c                   movel     'I'           i27tln
110500020213     c                   endsl
110510020213     c                   endif
110520020213     c     vidflc        ifgt      *zeros
110530020213     c                   movel     vidflc        i27cli
110540020213     c                   else
110550020213     c                   movel     vidlnp        i27cli
110560020213     c                   endif
110570020213     c                   move      vidccm        i27cli
110580020319     c                   z-add     blpdsp        i27dta
110590020213     c*
110600020213     c                   call      'TRUL27R'
110610020213     c                   parm                    trul27ds
110620020213     c                   z-add     o27ksc        tarksc
110630020213     c                   z-add     o27ctr        tarctr
110640020319     c* errore bloccante se non trovato il progressivo
110650020320     c     o27prg        ifge      *zeros
110660020213     c                   move      o27prg        tarprg
110670020213     c                   else
110680020319     C                   SETON                                        90
110690020319     C                   MOVEL     ERR(248)      VIDMSG
110700020213     c                   endif
110710020213     c*
110720020207     c                   ENDSR
110730091210     C*--- IMPOSTAZIONE FORZATURE FLAG DDT ------------------------
110740091210     C     SR_FRZBAM     BEGSR
110750091210     C***
110760091210     C* SE BOLLA CON OBBLIGO DDT  RIMANE IMPOSTATO "S"
110770091210     C***
110780091210     C                   SELECT
110790101104     c* Se spedizione diretta a FEDEX sempre DDT SI
110800101104     c                   when      VidDpd = 'F' or a_§OgNtw = 'FED'
110810101104     C                   MOVEL     'S'           VIDBAM
110820091210     C* SE PAESE CON ATTRAVERSAMENTO DOGANA --> OBBLIGATORIA SI DDT
110830091210     C     DESEFT        WHENNE    ' '
110840091210     C     A_§OGNTW      ANDNE     'DPD'
110850091210     C     VIDDPD        ANDEQ     ' '
110860091210     c     A_§ogntw      andne     'FED'
110870091210     C                   MOVEL     'S'           VIDBAM
110880091210     c* Se richiesta bolla firmata --> Forzo si ddt
110890091210     c     vidcbo        wheneq    'FO'
110900091210     C                   MOVEL     'S'           VIDBAM
110910091210     C* SE BOLLA DI RECUPERO --> FORZI NO DDT
110920091210     C     §3ARBL        WHENEQ    'R'
110930091210     c**** vidcbo        andne     'FO'
110940091210     C                   MOVEL     'N'           VIDBAM
110950091210     C* SE OBBLIGO DDT DA CAPPARIO FORZO SI DDT
110960091210     C     DESGDD        WHENEQ    'S'
110970091210     c     savfpr        andne     'G'
110980091210     c     savfpr        andne     'P'
110990091210     C                   MOVEL     'S'           VIDBAM
111000091210     c* se bolla con estensione ddt cliente (FIVAX) forzo NO DDT
111010091210     c     §1bf16        wheneq    'S'
111020091210     c                   movel     'N'           VIDBAM
111030091210     c     §dstddt       wheneq    'S'
111040091210     c     flgtb1        andeq     'A'
111050091210     c     vidcbo        andne     'FW'
111060091210     c     vidfbr        andne     'S'
111070091210     c     savfpr        andne     'G'
111080091210     c     savfpr        andne     'P'
111090091210     c                   movel     'S'           vidbam
111100091210     C                   ENDSL
111110091210     c                   eval      savddt = vidbam
111120091210     c                   endsr
111130041012     C*
111140041012     C*--- IMPOSTAZIONE CONSEGNE PARTICOLARI Per destinatario disagiat*
111150041012     C     SR_IMPtc12    BEGSR
111160041012     C*
111170041012     c* Referente e numero di telefono: se campi a video con '#'
111180041012     c* sono quelli automatici (dal tisit5) e quindi li pulisco
111190041012    2c                   if        %subst(Vidref:1:1) = '#'
111200041012     c                   clear                   vidref
111210041012    2c                   endif
111220041012    2c                   if        %subst(Vidtel:1:1) = '#'
111230041012     c                   clear                   vidtel
111240041012    2c                   endif
111250041012     c*
111260060324    2c                   if        (wdisag = 'X') OR
111270060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
111280060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
111290060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
111300041012     c                   select
111310041012     c     vidtc1        wheneq    *blanks
111320041012     c                   movel     wdisag        vidtc1
111330041012     c     vidtc2        wheneq    *blanks
111340041012     c                   movel     wdisag        vidtc2
111350041012     c                   endsl
111360041012    3c     vidtc1        ifeq      vidtc2
111370041012     c                   clear                   vidtc2
111380041012    3c                   endif
111390041012    3c                   if        vidref = *blanks
111400041012     c                   movel     ot0ref        vidref
111410041012    3c                   endif
111420041012    3c                   if        vidtel = *blanks
111430041012     c                   movel     ot0tel        vidtel
111440041012    3c                   endif
111450041012   x2c                   else
111460041012     c* se destinatario non disagiato e sono in immissione pulisco tc1 e tc2
111470041012     c* entro qui anche se destinatario supermercato/appuntamento ma previst
111480041012     c* ta consegna ad uffici
111490041012    3c                   if        *in12 = '0'
111500041012      * e se era stato precedentemente impostato da programma
111510041012     c                             and savdisag <> *Blanks
111520041012     c                   Eval      savdisag = wdisag
111530041012    4c     vidtc1        ifeq      'X'
111540091001     c     vidtc1        oreq      'S'
111550041012     c     vidtc1        oreq      'A'
111560041012     c                   clear                   vidtc1
111570041012     c                   Clear                   v2dtc1
111580041012    4c                   endif
111590041012    4c     vidtc2        ifeq      'X'
111600041012     c     vidtc2        oreq      'S'
111610041012     c     vidtc2        oreq      'A'
111620041012     c                   clear                   vidtc2
111630041012     c                   Clear                   v2dtc2
111640041012    4c                   endif
111650041012    3c                   endif
111660041012     c
111670041012    2c                   endif
111680091001     c* Memorizzo forzatura consegna particolare da destinatari particolari
111690091001     c                   if        wdisag<>*blanks and
111700091001     c                             (wdisag=vidtc1 or wdisag=vidtc2)
111710091001     c                   if        *in12=*off or
111720091001     c                             (wdisag<>sav_tc1 and wdisag<>sav_tc2)
111730091001     c                   eval      w_ar5tcp=wdisag
111740091001     c                   endif
111750091001     c                   endif
111760041012     c                   endsr
111770070924     C*--- IMPOSTAZIONE giorni di chiusura per destinatario particolar*
111780070924     C     SR_IMPgc12    BEGSR
111790070924     c*
111800070924    2c                   if        ot0err=*blanks
111810070924     c* propongo solo se a video non è stato specificato nulla.
111820070924     c* In manutenzione solo se cambiato il destinatario
111830070924     c                   if        vidgc1=*blanks and vidgc2=*blanks
111840070924     c                             and (*in12='0' or *in15='1' or
111850070924     c                             vidrsd<>savrsd or vidind<>savind or
111860070924     c                             vidprd<>savprd or vidcad<>savcad or
111870070924     c                             vidlod<>savlod or vidnzd<>savnzd)
111880070924     c                   eval      vidgc1=OT0X1GC1
111890070924     c                   eval      vidgc2=OT0X1GC2
111900070924     c                   endif
111910070924   x2c                   else
111920070924     c* se destinatario non presente e sono in immissione pulisco gc1 e gc2
111930070924    3c                   if        *in12 = '0'
111940070924      * e se era stato precedentemente impostato da programma
111950070924     c                             and savpart <> *Blanks
111960070924     c                   Eval      savpart = *blanks
111970070924     c                   clear                   vidgc1
111980070924     c                   Clear                   vidgc2
111990070924    3c                   endif
112000070924     c
112010070924    2c                   endif
112020070924     c                   endsr
112030900502     C*
112040900502     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
112050940819     C     INZ02         BEGSR
112060950126     C*
112070950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
112080971210     C                   EXSR      OFFD02
112090900502     C*
112100940923     C* SPENGO INDICATORI CHE EVIDENZIANO LE VALUTE
112110940923     C                   SETOFF                                       929399
112120940825     C                   MOVEL     *ZEROS        VIDRMN
112130060619     C***                MOVEL     *ZEROS        savRMN
112140940825     C                   MOVEL     *BLANKS       VIDRMA
112150941103     C* 03 ON - PERSONALIZZAIZONE MITTENTE ORIGINALE
112160941103     C     *IN03         IFEQ      *OFF
112170900502     C                   MOVEL     *BLANKS       VIDRMO
112180940930     C                   MOVEL     *BLANKS       VIDCMO
112190940930     C                   MOVEL     *BLANKS       VIDNMO
112200941103     C                   ENDIF
112210050315     C****               MOVE      *BLANKS       VIDFFD
112220940825     C                   MOVEL     *BLANKS       VIDFBR
112230900503     C                   MOVEL     *BLANKS       DEVCTR
112240940825     C                   MOVEL     *BLANKS       VIDTC1
112250940825     C                   MOVEL     *BLANKS       V2DTC1
112260940825     C                   MOVEL     *BLANKS       VIDTC2
112270940825     C                   MOVEL     *BLANKS       V2DTC2
112280900502     C                   MOVEL     *ZEROS        VIDNCL
112290930414     C                   MOVEL     *ZEROS        VARNCL
112300940825     C                   MOVEL     *ZEROS        V2CPKG
112310980402     C                   MOVEL     *ZEROS        SAVPKG
112320900502     C                   MOVEL     *ZEROS        VIDNRS
112330900502     C                   MOVEL     *ZEROS        VIDNCD
112340900502     C                   MOVEL     *ZEROS        VIDNCA
112350940825     C                   MOVEL     *BLANKS       VIDFVR
112360900502     C                   MOVEL     *ZEROS        VIDVOL
112370980402     C                   MOVEL     *ZEROS        SAVVOL
112380090609     c                   clear                   wvol_pre
112390940825     C                   MOVEL     *ZEROS        VIDCAS
112400011107     C                   MOVEL     §GEDCN        VIDVCA
112410011107     C                   MOVEL     §GEDCN        VARVCA
112420940825     C                   MOVEL     *BLANKS       VIDTIC
112430940825     C                   MOVEL     *ZEROS        VIDVMD
112440011113     C                   MOVEL     §GEDCN        VIDVAD
112450940825     C                   MOVEL     *ZEROS        VIDIAS
112460011211     C                   MOVEL     *ZEROS        VARIAS
112470011211     C                   MOVEL     *ZEROS        WARIAS
112480011212     C                   MOVEL     *ZEROS        WARCAS
112490011212     C                   MOVEL     *ZEROS        WARVMD
112500011112     C                   MOVEL     §GEDCN        VIDVAS
112510011112     C                   MOVEL     §GEDCN        VARVAS
112520940825     C                   MOVEL     *ZEROS        VIDQFT
112530950102     C                   MOVEL     *ZEROS        VARQFT
112540910912     C                   MOVEL     *ZEROS        BLPSPE
112550940825     C                   MOVEL     *BLANKS       VIDGGA
112560940825     C                   MOVEL     *BLANKS       VIDGCA
112570940825     C                   MOVEL     *BLANKS       VIDGMA
112580940825     C                   MOVEL     *BLANKS       VIDGVA
112590940922     C                   MOVEL     *BLANKS       VIDGGR
112600940922     C                   MOVEL     *BLANKS       VIDGCR
112610940922     C                   MOVEL     *BLANKS       VIDGMR
112620940922     C                   MOVEL     *BLANKS       VIDGVR
112630940825     C                   MOVEL     *BLANKS       VIDNT1
112640940825     C                   MOVEL     *BLANKS       VIDNT2
112650110304     c                   clear                   savnot
112660010220     C                   MOVEL     *BLANKS       VARFFD
112670930401     C                   MOVEL     *ZEROS        VA2VOL
112680930401     C                   MOVEL     *ZEROS        VARPKG
112690020531     C                   MOVEL     *ZEROS        VARtc1
112700020531     C                   MOVEL     *ZEROS        VARtc2
112710060110     C                   MOVEL     *ZEROS        D_VARrsd
112720060110     C                   MOVEL     *ZEROS        D_VARind
112730060110     C                   MOVEL     *ZEROS        D_VARlod
112740060110     C                   MOVEL     *ZEROS        D_VARprd
112750060110     C                   MOVEL     *ZEROS        D_VARnzd
112760060104     c* visto che in un caso questo campo lo andrò ad impostare anche
112770060104     c* nella routine ctrd01 sposto la pulizia nella inz01
112780060104     C****               MOVEL     *ZEROS        VARZNC
112790970128     C                   MOVEL     'N'           VIDBAM
112800021217     c                   Clear                   VidTba
112810021217     c                   Clear                   VidNba
112820030808     c                   Clear                   SavNba
112830021217     c                   Clear                   VidTb2
112840021217     c                   Clear                   VidNb2
112850030808     c                   Clear                   SavNb2
112860001214     C                   CLEAR                   KOL
112870001214     C                   Z-ADD     0             XY                2 0
112880040917     c* pulisco campo per forzatura mittente
112890040917     c                   clear                   wcontmit          1
112900030731
112910030731      * pulisco i campi di attributi visualizzazione e flag di work per
112920030731      * rif.mittente alfabetico, bancali, part.consegna varie
112930040226      * rif.mittente numerico
112940030731     c                   Clear                   AtrRma
112950030731     c                   Clear                   wrma
112960030731     c                   Clear                   AtrTba
112970030731     c                   Clear                   AtrNba
112980030731     c                   Clear                   AtrTb2
112990030731     c                   Clear                   AtrNb2
113000030731     c                   Clear                   AtrGva
113010040226     c                   Clear                   AtrRmn
113020040226     c                   Eval      wrifm = *Off
113030030708      * pulisco i campi della window x i colli originali + sfusi
113040030708     c                   Clear                   w03rig1
113050030708     c                   Clear                   w03rig2
113060030708     c                   Clear                   w03cor
113070030708     c                   Clear                   w03csf
113080030708     c                   Clear                   At3c01
113090030708     c                   Clear                   At3cor
113100030708     c                   Clear                   At3c02
113110030708     c                   Clear                   At3csf
113120030708     c                   Clear                   At3f12
113130030708     c                   Clear                   H3riga
113140030708     c                   Clear                   H3colo
113150030708     c                   Clear                   wtotncl
113160030708     c                   Clear                   savw03cor
113170030708     c                   Clear                   savw03csf
113180030805
113190030805     c                   Clear                   savkeyorm
113200080314     c* pulisco campo per forzatura serie parziale
113210080314     c                   clear                   f_range
113220090323     c* Campo per visualizzazione taso funzionale f15=cli/tar per tassaz.
113230090323     c* porti assegnati
113240090323     c                   clear                   atrf15
113250090327     c                   exsr      sr_inzwdwcli
113260091119     c*
113270091119     c                   exsr      inzwdwcas
113280940825     C                   ENDSR
113290940825     C*
113300940825     C*--- PULIZIA CAMPI FORMATO3 ------------------------------------*
113310940825     C     INZ03         BEGSR
113320950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
113330971210     C                   EXSR      OFFD03
113340950126     C*
113350940923     C* CAMPO CHE INDICA SE DEVO OBBLIGATORIAMENTE EMETTERE IL FORMATO3
113360940923     C                   CLEAR                   WEMD03
113370940923     C* TASSAZIONE
113380971211     C                   CLEAR                   V3CLNA
113390971211     C                   CLEAR                   V3DLNA
113400991008     C                   CLEAR                   VIDDIV
113410991011     C                   CLEAR                   WDIV1
113420940826     C                   MOVEL     *ZEROS        VIDPOR
113430991012     C                   MOVEL     *ZEROS        MEMPOR
113440940825     C                   MOVEL     *ZEROS        VIDIMV
113450940825     C                   MOVEL     *ZEROS        VIDFIV
113460991029     C                   MOVEL     *ZEROS        VA2VA1
113470040130     C                   MOVEL     *ZEROS        VA2VA2
113480040130     C                   MOVEL     *ZEROS        VA2VA3
113490040130     C                   MOVEL     *ZEROS        VA2VA4
113500041217     C                   MOVEL     *ZEROS        VA2VA5
113510041217     C                   MOVEL     *ZEROS        VA2VA6
113520940825     C                   MOVEL     *ZEROS        VIDNFT
113530940825     C                   MOVEL     *ZEROS        VIDDFT
113540940923     C                   MOVEL     ' '           VIDCEI
113550940826     C                   MOVEL     *BLANKS       V3DCEI
113560940929     C                   MOVEL     *BLANKS       V2DCEI
113570940923     C* PULIZIA SFL
113580940923     C                   SETON                                        35
113590941011     C                   WRITE     LS01C03
113600940923     C                   SETOFF                                       35
113610940923     C*
113620940923     C                   CLEAR                   V3CSV1
113630940923     C                   CLEAR                   V3CVA1
113640940923     C                   CLEAR                   V3CEV1
113650991008     C                   CLEAR                   V3HVA1
113660940923     C*
113670941021     C                   DO        20            NRR               5 0
113680940923     C                   WRITE     LS01S03
113690940923     C                   ENDDO
113700940923     C* ESTENSIONE BOLLA
113710940923     C                   MOVEL     ' '           VI2SV1
113720940923     C                   MOVEL     *ZEROS        VI2VA1
113730040114     c                   Clear                   Vi2Sv2
113740040114     c                   Clear                   Vi2Va2
113750040114     c                   Clear                   Vi2Sv3
113760040114     c                   Clear                   Vi2Va3
113770040114     c                   Clear                   Vi2Sv4
113780040114     c                   Clear                   Vi2Va4
113790041217     c                   Clear                   Vi2Sv5
113800041217     c                   Clear                   Vi2Va5
113810041217     c                   Clear                   Vi2Sv6
113820041217     c                   Clear                   Vi2Va6
113830930628     C                   MOVEL     ' '           VI2CEI
113840940923     C                   MOVEL     *BLANKS       V2DCEI
113850040121     c                   Clear                   Vi2Es1
113860040121     c                   Clear                   Vi2Es2
113870040121     c                   Clear                   Vi2Es3
113880040121     c                   Clear                   Vi2Es4
113890041217     c                   Clear                   Vi2Es5
113900041217     c                   Clear                   Vi2Es6
113910040126     c                   Clear                   Vi2Imv
113920991011     C                   CLEAR                   WDIV2
113930991011     C                   CLEAR                   VI2DIV
113940990701     C                   CLEAR                   VIDIFT
113950990701     C                   CLEAR                   SAVIMV
113960060208     C                   CLEAR                   SAVIMVO
113970991008      *
113980900502     C                   ENDSR
113990971210     C**
114000971210     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
114010971210     C     INZ06         BEGSR
114020081008     C**                 CLEAR                   V6CINS
114030081008     C**                 CLEAR                   V6CSTA
114040971210     C                   CLEAR                   V6CAWB
114050971211     C                   CLEAR                   SAVAWB
114060081008     C**                 CLEAR                   V6CLNA
114070081008     C**                 CLEAR                   V6DLNA
114080971210     C                   ENDSR
114090900502     C*
114100991203     C**
114110991203     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
114120991203     C     INZ07         BEGSR
114130991203     C                   CLEAR                   V7CNPR
114140991203     C                   CLEAR                   SAVNPR
114150991203     C                   CLEAR                   V7CLNA
114160991203     C                   CLEAR                   V7DLNA
114170061003     C***                CLEAR                   savfnp
114180060620     C                   CLEAR                   savkrt
114190991203     C                   ENDSR
114200000829     C*
114210000829     C*--- PULIZIA CAMPI FORMATO8 ------------------------------------*
114220000829     C     INZ08         BEGSR
114230000829     C*
114240000829     C                   CLEAR                   V8CKSC
114250000829     C                   CLEAR                   V8DKSC
114260000829     C* PULIZIA SFL
114270000829     C                   SETON                                        35
114280000829     C                   WRITE     LS01C08
114290000928     C                   SETOFF                                       357833
114300000829     C                   MOVE      *ZEROS        V8CNBR
114310000829     C                   MOVE      *ZEROS        NR8
114320000918     C                   MOVE      *ZEROS        SAVNR8
114330000829     C*
114340000829     C                   CLEAR                   V8CSCE
114350000829     C                   CLEAR                   V8CNOT
114360000908     C                   CLEAR                   V8HDKC
114370000908     C                   CLEAR                   V8HESG
114380000915     C                   CLEAR                   V8HST2
114390000915     C                   CLEAR                   V8HFLS
114400000915     C                   CLEAR                   V8HLNA
114410000915     C                   CLEAR                   V8HNRS
114420000915     C                   CLEAR                   V8HNSC
114430000921     C                   CLEAR                   V8HPRE
114440000830     C*
114450000830     C* PULISCO ANCHE CAMPO FORMATO 9
114460000830     C                   CLEAR                   V9CNOT
114470000921     C                   CLEAR                   CH2
114480000921     C                   CLEAR                   I2
114490000829      *
114500000829     C                   ENDSR
114510960404     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
114520940825     C     CTRD02        BEGSR
114530940929     C                   CLEAR                   WEMFOR
114540941115     C                   CLEAR                   VIDMSG
114550930414     C                   Z-ADD     0             COMCTR
114560940216     C                   CLEAR                   CMD8
114570000321     C                   CLEAR                   WEFT
114580000321     C* SE DPD PAESE EFTA DA DPD
114590020319     C     A_§OGNTW      IFEQ      'DPD'
114600020204     C     VIDDPD        OREQ      'D'
114610000321     C                   MOVEL     DESEFD        WEFT
114620000321     C                   ELSE
114630020213     c     A_§ogntw      ifeq      'FED'
114640020201     c     viddpd        oreq      'F'
114650020130     c                   movel     deseff        weft
114660020130     c                   else
114670000321     C                   MOVEL     DESEFT        WEFT              1
114680000321     C                   ENDIF
114690020130     C                   ENDIF
114700000321     C**
114710980219     C* SE VARIATO IMPORTO C/A LO SALVO
114720980219     C     *IN11         IFEQ      *ON
114730980219     C                   MOVEL     '1'           WIN11             1
114740980219     C                   ENDIF
114750980219     C* SE VARIATO IMPORTO ME LO SALVO
114760980219     C     *IN88         IFEQ      *ON
114770980219     C                   MOVEL     '1'           WIN88             1
114780980219     C                   ENDIF
114790940825     C***
114800940825     C*** MITTENTE ***
114810940825    1C     *IN02         IFEQ      *OFF
114820970703     C                   MOVEL     VIDRSM        I14RSC
114830970703     C                   CLEAR                   I14RS2
114840970703     C                   MOVEL     VIDINM        I14IND
114850970703     C                   MOVEL     VIDLOM        E14LOC
114860970703     C                   MOVEL     VIDPIM        E14PIP
114870970703     C                   MOVEL     VIDPRM        E14PRV
114880970703     C                   MOVEL     VIDNZM        E14NAR
114890970703     C                   MOVEL     VIDCAM        E14CAP
114900970704     C                   MOVEL     'M'           WCLI
114910061110     c   22              movel     vidcdf        wcdf
114920071023     c   22              movel     vidpim        wiva
114930970704     C                   EXSR      CTRIND
114940941020     C*
114950941020     C* CAMPI CHE POSSO AVER IMPOSTATO
114960970703     C                   MOVEL     E14LOC        VIDLOM
114970970703     C                   MOVEL     E14PIP        VIDPIM
114980970703     C                   MOVEL     E14PRV        VIDPRM
114990970703     C                   MOVEL     E14NAR        VIDNZM
115000970703     C                   MOVEL     E14CAP        VIDCAM
115010061109     C*
115020061109     c* Se errore sulla partita iva , visualizzo messaggio
115030061109     c                   if        xcfivaflg < *zeros
115040120504     c                   if        wcdf=*blanks OR %subst(wcdf:12:1)=' '
115050071023     c                   z-add     07            h2riga
115060071022     c                   else
115070071023     c                   z-add     08            H2riga
115080071022     c                   endif
115090061109     c                   z-add     64            H2colo
115100061109     c                   endif
115110970704     C*
115120970704     C     WEMFOR        IFEQ      '1'
115130970704     C     *IN90         OREQ      *ON
115140970704     C                   GOTO      ENDC02
115150970704     C                   ENDIF
115160040917     c* Segnalazione se inserito mittente estero
115170040917     c     wmitie        ifeq      'E'
115180040917     c     wcontmit      andeq     *blanks
115190040917     c                   movel     '1'           wcontmit
115200040917     c                   seton                                        90
115210040917     c                   z-add     7             h2riga
115220040917     c                   z-add     49            h2colo
115230040917     c                   movel     ERR(283)      vidmsg
115240040917     c                   goto      endc02
115250040917     c                   endif
115260061110     C
115270061110     C** SE PREPAGATO 8888, CERCO IL CODICE FISCALE SE NON INSERITO
115280120503     C   22              IF        VIDCCM=8888 AND VIDNZM=*BLANKS AND
115290120504     C                             (VIDCDF=*BLANKS or vidpim=*blanks)
115300120503     C                   EXSR      CALLYCO
115310120503     C                   ENDIF
115320970704     C**
115330950303     C* SE BOLLA DIRETTA ALL'ESTERO --> P.IVA OBBLIGATORIA
115340120515     c* oppure obbligatorio il codice fiscale lungo 16
115350970704    2C     WDESIE        IFEQ      'E'
115360000321     C     WEFT          ANDNE     *BLANKS
115370050427     c     §3arbl        andne     'R'
115380120515     C***  VIDPIM        ANDEQ     *BLANKS
115390120515     c                   if        vidpim=*blanks and
115400120515     c                             (vidcdf=*blank or %subst(vidcdf:12:1)=' ')
115410950303     C                   MOVEL     '1'           WEMFOR
115420950303     C                   SETON                                        7090
115430120515     C                   MOVEL     ERR(346)      VIDMSG
115440950303     C                   GOTO      ENDC02
115450120515     c                   endif
115460000120    2C                   ENDIF
115470970704    1C                   ENDIF
115480930331     C***
115490930331     C*** NUMERO COLLI     ***
115500940928    1C     VIDNCL        IFNE      V1CNCL
115510940825     C                   MOVEL     ERR(45)       VIDMSG
115520940922     C                   SETON                                        4190
115530940920     C                   GOTO      ENDC02
115540940928    1C                   ENDIF
115550930331     C***
115560930331     C*** PESO ***
115570940928    1C   12V2CPKG        IFEQ      0
115580941110     C                   MOVEL     ERR(46)       VIDMSG
115590940922     C                   SETON                                        4290
115600940920     C                   GOTO      ENDC02
115610940928    1C                   END
115620030204      * Manutenzione di bolla con bancali
115630030204      * Se viene modificato il peso o il volume
115640030204      * emetto un msg info
115650030204     c                   If        *In12 and Not *In15                      and
115660030204     c                             (VidNba > *Zeros or VidNb2 > *Zeros)     and
115670030204     c                             (V2cPkg <> SavPkg or Vidvol <> SavVol)   and
115680110921     c                             wPkg = *Blanks                           and
115690110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
115700030204     c                   Eval      wPkg = '1'
115710030204     c                   Eval      VidMsg = Err(272)
115720030204     c                   If        V2cPkg <> SavPkg
115730030204     c                   Eval      *In42 = *On
115740030204     c                   EndIf
115750030204     c                   If        Vidvol <> SavVol
115760030204     c                   Eval      *In47 = *On
115770030204     c                   EndIf
115780030204     c                   Eval      *In90 = *On
115790030204     c                   GoTo      EndC02
115800030204     c                   EndIf
115810980402     C*
115820090609    1C** 12V2CPKG        IFGT      §QTPKB
115830090609     C**   V2CPKG        ANDNE     SAVPKG
115840090609     C**                 MOVE      V2CPKG        SAVPKG
115850090609     C***                CLEAR                   WPT1
115860980623     C* PREPARO MSG
115870090609     C***                MOVEA     ERR(52)       K78
115880090609     C***                MOVEL     §QTPKB        W006A             6
115890090609     C***                MOVEA     W006A         SKI(10)
115900090609     C***                Z-ADD     10            I                 3 0
115910090609     C***                EXSR      ABBL
115920090609     C***                MOVEA     SKI(10)       K78(34)
115930090609     C***                MOVE      §QTPKB        W001A
115940090609     C***                MOVEL     W001A         K78(41)
115950090609     C***                MOVEA     K78           VIDMSG
115960090609     C***                SETON                                        4290
115970090609     C***                GOTO      ENDC02
115980090609    1C**                 END
115990000509     C*
116000000509     C     V2CPKG        IFNE      SAVPKG
116010000509     C                   CLEAR                   WPT1
116020000509     C                   MOVE      V2CPKG        SAVPKG
116030000509     C                   ENDIF
116040000509     C*
116050930331     C* NON CONTROLLO SE SONO IN MANUTENZIONE PERCHE' NON ESISTE DISCOR
116060940928    1C  N12VIDPKG        IFNE      V2CPKG
116070940825     C                   MOVEL     ERR(38)       VIDMSG
116080940922     C                   SETON                                        4290
116090940920     C                   GOTO      ENDC02
116100940928    1C                   END
116110000509      * PER LNP POSTE Massimo peso inseribile da tabella
116120000509      *  solo per soluzioni B
116130101022     C**   §ogntw        IFEQ      'PPT'
116140101022     C**   §1BFG6        ANDEQ     'C'
116150101022     C**   WPT1          ANDEQ     ' '
116160101022     C**   V2CPKG        IFGT      §3IPKP
116170101022     C**                 SETON                                        4290
116180101022     C**                 MOVEA     ERR(196)      K78
116190101022     C**                 MOVEL     §3IPKP        W006A             6
116200101022     C**                 MOVEA     W006A         SKI(10)
116210101022     C**                 Z-ADD     10            I                 3 0
116220101022     C**                 EXSR      ABBL
116230101022     C**                 MOVEA     SKI(10)       K78(37)
116240101022     C**                 MOVE      §3IPKP        W001A
116250101022     C**                 MOVEL     W001A         K78(44)
116260101022     C**                 MOVEA     K78           VIDMSG
116270101022     C**                 MOVEL     '1'           WPT1
116280101022     C**                 GOTO      ENDC02
116290101022     C**                 ENDIF
116300101022     C**                 ENDIF
116310021120
116320021120     c                   If        *In12
116330021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
116340021120      * a quanto indicato in tabella "DFE"
116350021121     c                   If        O27Fie = 'N' and V2cPkg > §DfePkgD
116360021120     c                   Movel     Err(264)      VidMsg
116370021120     c                   Eval      *In90 = *On
116380021120     c                   Eval      *In42 = *On
116390021120     c                   GoTo      EndC02
116400021120     c                   EndIf
116410021120     c                   EndIf
116420930331     C***
116430941107     C*** CODICE TARIFFA ***
116440050921     C                   CLEAR                   fnlv59ds
116450050921     C                   MOVEL     'S'           ilv59con
116460050921     C                   MOVEL     'P'           ilv59tbo
116470040512      * se bolla monovaria pulisco il tipo bolla
116480040512     C                   IF        §3ASVA <> *BLANK
116490050921     C                   CLEAR                   ilv59tbo
116500050921     C                   movel     'P'           ilv59prp
116510040512     C                   ENDIF
116520040512
116530050921     C                   MOVEL     WKSC          ilv59ksc
116540050921     C                   MOVEL     KCI           ilv59kci
116550050921     C                   MOVEL     WFIE          ilv59fie
116560050921     C                   MOVEL     VIDCTR        ilv59ctr
116570050921     C                   MOVEL     BLPDSP        ilv59dsp
116580050921     C                   MOVEL     VIDTSP        ilv59tsp
116590060515     c* Se non  cambiato il cod tariffa nè il cod cliente e
116600060515     c*  sono in manutenzione, non controllo in assenza di tariffe
116610060515     c*  se tariffa bloccata o usata per altri network
116620060515     c                   if        wksc=bolksc and vidctr=bolctr
116630060515     C                             AND *IN12 AND NOT *IN15
116640060515     C                   EVAL      ILV59TA2='B'
116650060515     C                   ENDIF
116660941107     C*
116670050921     C                   CALL      'FNLV59R'
116680050921     C                   PARM                    fnlv59ds
116690050921     C                   MOVEL     olv59dfs      DEFCTR
116700941107     C*
116710941107     C* ATTIVATA LA RICERCA
116720050921     C     olv59err      IFEQ      'R'
116730050921     C                   MOVEL     olv59ctr      VIDCTR
116740941231     C                   SETON                                        83
116750941107     C                   MOVEL     '1'           WEMFOR
116760941107     C                   GOTO      ENDC02
116770941107     C                   ENDIF
116780941107     C* ERRORE
116790050921     C     olv59msg      IFNE      *BLANKS
116800050921     C                   MOVEL     olv59msg      VIDMSG
116810941231     C                   SETON                                        9083
116820941107     C                   GOTO      ENDC02
116830941107     C                   ENDIF
116840021120
116850021120      * Per bolla FedEx
116860021120If  1c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
116870021120     c                   Movel     O27Ctr        Wctr
116880021120      * --> Se non ho trovato tariffe
116890021121      *     Naturalmente questo può capitare solo per i clienti non codificati
116900021121      *     il pezzo che riguarda i clienti codificati lo lascio ma lo asterisco
116910021120If  2c                   If        Wtks <> 'S'
116920021121      * ---> se ho richiamato il trul27r con i27tip = "FM" o "FD"
116930021121If  3c                   If        I27Tip = 'FM' or I27Tip = 'FD'
116940021121      * ---> oppure ho O27Fie = 'M'
116950021122     c                             or WFie = 'M'
116960021120      * la tariffa in bolla deve essere quella della cartello
116970021120If  4c                   If        VidCtr <> WCtr
116980021120     c                   Eval      *In83 = *On
116990021120     c                   Eval      *In90 = *On
117000021120     c                   Movel     Err(262)      VidMsg
117010021120     c                   Goto      EndC02
117020021120    4c                   EndIf
117030021120    3c                   EndIf
117040021121      * ---> se ho richiamato il trul27r con i27tip <> "FM" e "FD"
117050021121If  3c                   If        I27Tip <> 'FM' and I27Tip <> 'FD'
117060021121      * ---> e O27Fie non è = 'M'
117070021122     c                             and WFie <> 'M'
117080021121     c                   Move      Wksc          Ksc8888
117090021120      * ----> cliente non codificato
117100021120If  4c                   If        Ksc8888 = 8888
117110021120      * richiamo il trul27r xchè la tariffa in bolla deve essere una delle
117120021120      * 2 cartello FedEx
117130021120     c                   clear                   trul27ds
117140021120     c                   Z-Add     VidPkg        I27Pkg
117150021120     c                   Movel     Vidctr        I27Ctb
117160021120     c                   ExSr      RicCar
117170021120     c   90              GoTo      EndC02
117180021121     c                   Movel     O27Ctr        Wctr
117190021120If  5c                   If        VidCtr <> WCtr
117200021120     c                   Eval      *In83 = *On
117210021120     c                   Eval      *In90 = *On
117220021120     c                   Movel     Err(262)      VidMsg
117230021120     c                   Goto      EndC02
117240021120    5c                   EndIf
117250021120    4c                   EndIf
117260021120    3c                   EndIf
117270021120    2c                   EndIf
117280021120    1c                   EndIf
117290940922     C*
117300950103     C* MEMORIZZO SEMPRE IL CODICE TARIFFE E PROGRESSIVO
117310941107     C     WTKS          IFEQ      'S'
117320050921     C                   MOVEL     olv59prg      COMPRG
117330050921     C                   MOVEL     olv59ctr      COMCTR
117340050921     C                   MOVEL     olv59div      COMDIV            3
117350991028     C*
117360991028     C                   MOVEL     'CV'          COD
117370991028     C                   MOVEL(P)  COMDIV        KEY
117380991028     C                   EXSR      CTABEL
117390991028     C                   MOVEL     TBLUNI        DSCV
117400011113     C                   MOVEL     §CVDEC        COMDEC
117410950103     C*
117420950102     C* PER MANUTENZIONE CHAIN SULLA TARIFFA
117430950102     C   12
117440950102     CANN15KTAM2         CHAIN     TNTAM000                           30
117450950102     C   12
117460950102     CANN15*IN30         IFEQ      *ON
117470950102     C                   CLEAR                   WTKS
117480050914     c                   else
117490050914     C                   MOVEL     TAMflo        dsta01
117500950102     C                   ENDIF
117510950102     C*
117520950103     C* SE HO CAMBIATO IL CODICE TARIFFA, DEVO RIPROPORRE I CAMPI MODIF
117530940928    2C     VIDCTR        IFNE      SAVCTR
117540940922     C                   SETON                                        97
117550040610     c     atrbva        ifne      prri
117560040610     c                   movel     riul          atrbva
117570040610     c                   endif
117580950102     C* E' COME SE AVESSI MODIFICATO IL MITTENTE: RICARICO I DATI
117590080326     c                   eval      CambiaCTR='S'
117600050921     C                   MOVEL     'S'           ilv59ric
117610940922     C                   EXSR      CTNTAM
117620091210     c* verifico se impostare eventuali forzature flag DDT
117630091210     c                   EXSR      SR_FRZBAM
117640950102     C*
117650940922     C                   MOVEL     VIDCTR        SAVCTR
117660941231     C                   MOVEL     '1'           WEMFOR
117670950102     C                   CLEAR                   UND
117680041012     c* se destinatario supermercato/appuntamento ed in base a vidgva
117690041012     c* devo eventualmente aggiungere o togliere telefono,referente,tc1
117700041012     c* e tc2
117710041012     c     §ogntw        ifne      'PPT'
117720041012     c                   exsr      SR_IMPtc12
117730041012     c                   endif
117740940922     C                   GOTO      ENDC02
117750940928    2C                   ENDIF
117760930331     C*
117770940922    1C                   ENDIF
117780930331     C***
117790930331     C*** VOLUME ***
117800940928    1C     VIDVOL        IFGT      §QTVLB
117810980402    1C     VIDVOL        ANDNE     SAVVOL
117820980402     C                   MOVE      VIDVOL        SAVVOL
117830980623     C* PREPARO MSG
117840090609     C***                MOVEA     ERR(26)       K78
117850090609     C***                MOVEL     §QTVLB        W002A             2
117860090609     C***                MOVEA     W002A         SKI(14)
117870090609     C***                Z-ADD     2             I                 3 0
117880090609     C***                EXSR      ABBL
117890090609     C***                MOVEA     SKI(14)       K78(36)
117900090609     C***                MOVE      §QTVLB        W003A
117910090609     C***                MOVEA     W003A         K78(39)
117920090609     C***                MOVEA     K78           VIDMSG
117930090609     C***                SETON                                        4790
117940090609     C***                GOTO      ENDC02
117950940928    1C                   ENDIF
117960090609     c*
117970930331     C* CALCOLO VOLUME
117980050415     c* prima però se bancali 'O' devo controllare i bancali per avere
117990050415     c* il n.colli originali per calcolare correttamente il volume auto
118000050415     c* matico
118010050415     c                   if        %subst(vidgva:1:1)='O'
118020050415     c                   exsr      sr_CntPVBan
118030050415     c     wemfor        ifeq      '1'
118040050415     c                   goto      endc02
118050050415     c                   endif
118060050415     c                   endif
118070050913     c* Se previsto da tariffa richiedo obbligatorio l'inserimento del volum
118080050926     c                   select
118090050926     c* §taovb='M' --> obbligatorio l'inserimento del volume --> no calcolo
118100050926     c*                automatico
118110050926     c                   when      vidvol=0 and §taovb = 'M'
118120050913     C                   MOVEL     ERR(293)      VIDMSG
118130050913     C                   SETON                                        4790
118140050913     c                   goto      endc02
118150050926     c* §taovb='O' --> se volume non immesso errore forzabile --> calcolo
118160050926     c*                opzionale del volume automatico
118170050926     c                   when      vidvol=0 and §taovb = 'O' and fvol = ' '
118180050926     C                   MOVEL     ERR(293)      VIDMSG
118190050926     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
118200050926     C                   SETON                                        4790
118210050926     c                   eval      fvol = '1'
118220050926     c                   goto      endc02
118230050926     c                   endsl
118240050913     c*
118250930331     C                   EXSR      CALVOL
118260100607     c* controllo i limiti di colli peso e volume
118270100607     c
118280100607     c                   z-add     vidncl        wncl
118290100607     c                   z-add     v2cpkg        wpes
118300100607     c                   z-add     vidvol        wvol
118310100607     c                   if        vidvol=0
118320100607     c                   z-add     varvol        wvol
118330100607     c                   endif
118340100607     c                   eval      wvid='2'
118350100607     c                   exsr      sr_limtsp
118360100607     c                   if        *in90
118370100607     C                   MOVEL     wmsgtsp       VIDMSG
118380100607     C                   GOTO      ENDC02
118390100607     c                   endif
118400020531     C***
118410020531     C*** CONSEGNE PARTICOLARI ***
118420020531     c* N.B.: Ho spostato il controllo delle consegne particolari prima del
118430020531     c*       del richiamo all'fnlv13r perchè con la gestione dei supermerca
118440020531     c*       ti le devo passare a lv13 affinchè il tisi95r mi ritorni la
118450020531     c*       giusta lna e zona. Prima il controllo veniva fatto dopo il
118460020531     c*       controllo dei giorni di chiusura
118470020531     C                   MOVEL     *BLANKS       DB0DC1
118480020531     C                   MOVEL     *BLANKS       V2DTC1
118490020531    1C     VIDTC1        IFNE      ' '
118500020531     C                   MOVEL     '1P'          COD
118510020531     C* RICERCA
118520020531    2C     VIDTC1        IFEQ      '?'
118530020531     C                   EXSR      CX§TAB
118540020531     C                   MOVEL     §KEY          VIDTC1
118550020531     C                   MOVEL     §DES          V2DTC1
118560020531     C                   GOTO      ENDC02
118570020531    2C                   END
118580020531     C* CONTROLLO
118590020531     C                   MOVEL(P)  VIDTC1        KEY
118600020531     C                   EXSR      CTABEL
118610020531     C  N30              MOVEL     TBLUNI        DS1P
118620020531     C* ERRORE: INESISTENTE
118630020531    2C     *IN30         IFEQ      *ON
118640020531     C*         NON UTILIZZABILE IN PARTENZA
118650020531     C     §1PUPR        ORNE      'S'
118660020531     C     §ogntw        ANDNE     'PPT'
118670020531     C                   MOVEL     ERR(102)      VIDMSG
118680020531     C                   SETON                                        6390
118690020531     C                   GOTO      ENDC02
118700020531    2C                   ENDIF
118710020531     C*
118720020531     C                   MOVEL     §1PDES        DB0DC1
118730020531     C                   MOVEL     §1PDES        V2DTC1
118740120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
118750020531    2C     §ogntw        IFEQ      'PPT'
118760020531    3C     §1PFPC        IFNE      'E'
118770020531     C     §1PFPC        ANDNE     'P'
118780020531     C                   MOVEL     ERR(198)      VIDMSG
118790020531     C                   SETON                                        6390
118800020531     C                   GOTO      ENDC02
118810020531    3C                   ENDIF
118820020531    2C                   ENDIF
118830020531    1C                   ENDIF
118840020531     C***
118850020531     C                   MOVEL     *BLANKS       DB0DC2
118860020531     C                   MOVEL     *BLANKS       V2DTC2
118870020531    1C     VIDTC2        IFNE      ' '
118880020531     C                   MOVEL     '1P'          COD
118890020531     C* RICERCA
118900020531    2C     VIDTC2        IFEQ      '?'
118910020531     C                   EXSR      CX§TAB
118920020531     C                   MOVEL     §KEY          VIDTC2
118930020531     C                   MOVEL     §DES          V2DTC2
118940020531     C                   GOTO      ENDC02
118950020531    2C                   END
118960020531     C* CONTROLLO
118970020531     C                   MOVEL(P)  VIDTC2        KEY
118980020531     C                   EXSR      CTABEL
118990020531     C  N30              MOVEL     TBLUNI        DS1P
119000020531     C* ERRORE: INESISTENTE
119010020531    2C     *IN30         IFEQ      *ON
119020020531     C*         NON UTILIZZABILE IN PARTENZA
119030020531     C     §1PUPR        ORNE      'S'
119040020531     C     §ogntw        ANDNE     'PPT'
119050020531     C                   MOVEL     ERR(102)      VIDMSG
119060020531     C                   SETON                                        6490
119070020531     C                   GOTO      ENDC02
119080020531    2C                   ENDIF
119090120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
119100020531    2C     §ogntw        IFEQ      'PPT'
119110020531    3C     §1PFPC        IFNE      'E'
119120020531     C     §1PFPC        ANDNE     'P'
119130020531     C                   MOVEL     ERR(198)      VIDMSG
119140020531     C                   SETON                                        6490
119150020531     C                   GOTO      ENDC02
119160020531    3C                   ENDIF
119170020531    2C                   ENDIF
119180020531     C* NON POSSONO ESSERE UGUALI
119190020531     C     VIDTC1        IFEQ      VIDTC2
119200020531     C                   MOVEL     ERR(121)      VIDMSG
119210020531     C                   SETON                                        6490
119220020531     C                   GOTO      ENDC02
119230020531    2C                   ENDIF
119240020731     C* Non è possibile indicare contemporaneamente consegne particolari
119250051121     C*  'S' ed 'X' / 'S' ed 'A' / "S" e "P" / "X" e "P"
119260020731    2C                   IF           (VIDTC1 = 'X'  and  VIDTC2 = 'S')
119270020731     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'X')
119280050915     C                             or (VIDTC1 = 'A'  and  VIDTC2 = 'S')
119290050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'A')
119300050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'P')
119310050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'S')
119320051121     C*                            or (VIDTC1 = 'X'  and  VIDTC2 = 'A')
119330051121     C*                            or (VIDTC1 = 'A'  and  VIDTC2 = 'X')
119340050915     C                             or (VIDTC1 = 'X'  and  VIDTC2 = 'P')
119350050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'X')
119360020731     C                   movel     ERR(257)      VIDmsg
119370050915     c                   eval      %subst(vidmsg:67:1) = vidtc1
119380050915     c                   eval      %subst(vidmsg:73:1) = vidtc2
119390020731     C                   seton                                        6490
119400020731     C                   goto      ENDC02
119410020731    2C                   ENDIF
119420020531     C*
119430020531     C                   MOVEL     §1PDES        DB0DC2
119440020531     C                   MOVEL     §1PDES        V2DTC2
119450020531    1C                   ENDIF
119460020531     c* Se destinatario disagiato o supermercato errore se non indicato
119470020531     c* in nessuno dei due campi di consegna particolare
119480040608     c* idem se destinatario con appuntamento
119490041012     c*
119500041012     c* Se particolarità varia="U" --> consegna ad uffici devo invece
119510041012     c* dare errore se immesso supermercato o appuntamento
119520041012     c                   if        %subst(vidgva:1:1)='U'
119530041013     c                             and (vidtc1='S' or vidtc1='A' or vidtc2='S'
119540041013     c                             or vidtc2='A')
119550041012     C                   MOVEl     ERR(285)      vidmsg
119560041012     C                   SETON                                        636490
119570041012     C                   GOTO      ENDC02
119580041012     c                   endif
119590060324     c* Se immesso appuntamento e richiesta data consegna tassativa
119600060324     c* ---> errore
119610060324     c                   if        vidtcr = *blanks and viddcr > *zeros  and
119620060324     c                             (vidtc1='A' or vidtc2='A')
119630060324     C                   MOVEl     ERR(298)      vidmsg
119640060324     C                   SETON                                        636490
119650060324     C                   GOTO      ENDC02
119660060324     c                   endif
119670041012     c*
119680041012     C***  wdisag        ifne      *blanks
119690060324     c                   if        (wdisag = 'X') OR
119700060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
119710060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
119720060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
119730041012     c     wdisag        ifne      vidtc1
119740020531     c     wdisag        andne     vidtc2
119750020531     C                   MOVEa     ERR(255)      k78
119760020531     c                   select
119770020531     c     wdisag        wheneq    'X'
119780040608     c                   eval      w016ad = 'Disagiato     '
119790020531     c     wdisag        wheneq    'S'
119800040608     c                   eval      w016ad = '"Supermercato"  '
119810040608     c     wdisag        wheneq    'A'
119820040608     c                   eval      w016ad = 'con Appuntamento'
119830020531     c                   endsl
119840040608     C                   MOVEa     w016ad        k78(14)
119850020531     C                   MOVEA     K78           VIDMSG
119860020531     C                   SETON                                        636490
119870020531     C                   GOTO      ENDC02
119880041012     c                   endif
119890020531     c                   endif
119900090921     c
119910090921     c* Per tipo servizio "H" non accetto S o A
119920090921     c                   if        vidtc1='A' or vidtc1='S' or
119930090921     c                             vidtc2='A' or vidtc2='S'
119940090921     c                   if        vidtsp='H'
119950090921     C                   MOVEl     err(231)      VIDMSG
119960090921     C                   SETON                                        6390
119970090921     C                   GOTO      ENDC02
119980090921     c                   endif
119990090921     c                   endif
120000940922     C***
120010070223     C*** CONTROLLO CAP
120020911008      *
120030020531     C* SE CAMBIATO F.D. O PESO O VOLUME  o consegne particolari RICONTROLLO
120040940916    2C     VARFFD        IFNE      VIDFFD
120050940825     C     VARPKG        ORNE      V2CPKG
120060930409     C     VA2VOL        ORNE      VARVOL
120070020531     C     VArtc1        ORNE      vidtc1
120080020531     C     VArtc2        ORNE      Vidtc2
120090060110     c     D_varrsd      andeq     vidrsd
120100060110     c     D_varind      andeq     vidind
120110060110     c     D_varlod      andeq     vidlod
120120060110     c     D_varprd      andeq     vidprd
120130060110     c     D_varnzd      andeq     vidnzd
120140010214     C                   MOVE      VIDFFD        COMFFD
120150010214     C     COMFFD        IFEQ      'N'
120160010214     C                   MOVE      *BLANKS       COMFFD
120170010214     C                   ENDIF
120180930414     C                   MOVEL     0             DIE
120190940916     C*
120200930402     C* IN MANUTENZIONE SE SONO TORNATI COME IN BOLLA NON FACCIO NIENTE
120210940916    3C     *IN12         IFEQ      '1'
120220930402     C     *IN15         ANDEQ     '0'
120230940916     C*
120240940916     C* IN MANUTENZ.SE NOV =" " SIGNIFICA CHE IL CAP E' DI NUOVO UGUALE
120250940916     C*  A QUELLO DELLA BOLLA
120260940916     C     NOV           ANDEQ     ' '
120270010214     C     COMFFD        ANDEQ     BLPFFD
120280940928     C     V2CPKG        ANDEQ     BLPPKB
120290940928     C     VARVOL        ANDEQ     BLPVLB
120300020531     C     vidtc1        ANDEQ     BLPtc1
120310020531     C     vidtc2        ANDEQ     BLPtc2
120320060110     c     vidrsd        andeq     blprsd
120330060110     c     vidind        andeq     blpind
120340060110     c     vidlod        andeq     blplod
120350060110     c     vidprd        andeq     blpprd
120360060110     c     vidnzd        andeq     blpnzd
120370930402     C                   MOVEL     BLPZNC        VARZNC
120380940916   X3C                   ELSE
120390920427     C                   MOVEL     0             QUA
120400100209     C                   MOVEL     0             QUAH
120410930406     C                   MOVEL     '1'           NOV
120420940916    3C                   END
120430940916    2C                   END
120440930402     C*
120450910129     C* CONTROLLO IN PAESARIO LA LNA
120460940916    2C     QUA           IFNE      NUMFOR
120470910801     C*
120480930401     C                   MOVEL     VIDFFD        VARFFD
120490940825     C                   MOVEL     V2CPKG        VARPKG
120500930401     C                   MOVEL     VARVOL        VA2VOL
120510020531     C                   MOVEL     Vidtc1        VArtc1
120520020531     C                   MOVEL     Vidtc2        VArtc2
120530060110     C                   MOVEL     Vidrsd        D_VArrsd
120540060110     C                   MOVEL     Vidind        D_VArind
120550060110     C                   MOVEL     Vidlod        D_VArlod
120560060110     C                   MOVEL     Vidprd        D_VArprd
120570060110     C                   MOVEL     Vidnzd        D_VArnzd
120580940919     C*
120590970704     C                   CLEAR                   DSSI95
120600970708     C                   CLEAR                   DSLV13
120610970707     C                   CLEAR                   W2LN
120620970704     C                   MOVEL     VIDNZD        I95NAR
120630970704     C                   MOVEL     VIDCAD        I95CAP
120640970704     C                   MOVEL     VIDLOD        I95LOC
120650970704     C                   MOVEL     VIDPRD        I95PRV
120660970704     C                   MOVEL     VIDFFD        I95FFD
120670010214     C     VIDFFD        IFEQ      'N'
120680010214     C                   MOVE      *BLANKS       I95FFD
120690010214     C                   ENDIF
120700970704     C                   Z-ADD     V2CPKG        I95LKG
120710980219     C* PASSO IL VOLUME AL CALCOLO DELLA LNA SOLO SE NON E' CLIENTE B
120720980219     C*  O E' CLIENTE B CON VOLUME REALE
120730980219     C     VIDNRS        IFEQ      0
120740980219     C     VIDFVR        OREQ      'R'
120750970704     C                   Z-ADD     VARVOL        I95LMC
120760980219     C                   ENDIF
120770000623     C** SE BOLLA POSTA DEVO PASSARE LNP AL POSTO DI TFP
120780020319     C     §ogntw        IFEQ      'PPT'
120790000623     C                   Z-ADD     VIDLNP        I95TFP
120800000623     C                   ELSE
120810000623     C                   Z-ADD     COMTFP        I95TFP
120820000623     C                   ENDIF
120830000623     C*
120840970704     C     VIDTSP        IFNE      *BLANKS
120850970704    1C                   MOVEL     VIDTSP        I95TSP
120860970704     C                   ELSE
120870970704     C* LO PRENDO DA TARIFFA
120880970704     C                   MOVEL     COMTSP        I95TSP
120890970704     C                   ENDIF
120900971201     C     §3AFCA        IFNE      0
120910971201     C                   MOVEL     'S'           I95FCA
120920971201     C                   ENDIF
120930971201     C                   MOVEL     FLGTB1        I95TPO
120940970704     C                   MOVEL     '7'           I95TCN
120950970714     C                   MOVEL     BLPDSP        I95DAT
120960980602     C                   MOVEL     'S'           I95FRE
120970020212     c* se network fedex passo flag apposito per dire di prendere i dati
120980020212     c* dalla tabella della nazione
120990020213     c     A_§ogntw      ifeq      'FED'
121000020212     c     viddpd        oreq      'F'
121010020212     c     wdesie        andeq     'E'
121020020212     c                   movel     'S'           i95fi1
121030020212     c                   endif
121040020531     c*
121050020531     c                   movel     vidtc1        i95fi2
121060020531     c                   move      vidtc2        i95fi2
121070970704     C*
121080970704     C                   CALL      'FNLV13R'
121090970708     C                   PARM                    KPJBA
121100970708     C                   PARM                    DSLV13
121110970708     C                   PARM                    DSSI95
121120060105     c*
121130060105     c                   move      o95lna        d_o95lna
121140060105     c                   move      o95znc        d_o95znc
121150060105     c                   move      o952ln        d_o952ln
121160111201     c* EVENTUALE FORZATURA LINEA DI ARRIVO: non valida per i disk B e
121170111201     c* le bolle di reso
121180111201     c                   if        §1bfg6<>'C' and
121190111201     c                             (vidfbr <> 'S' or *in44 = *off)
121200111201     c* .... Forzatura da archivio destinatari particolari
121210111201     c                   if        §dstlna > *zeros
121220060105     c                   movel     §dstlna       d_o95lna
121230060105     c                   clear                   d_o95znc
121240060105     c                   clear                   d_o952ln
121250060105     c                   if        §dstznc >= *zeros
121260060105     c                   movel     §dstznc       d_o95znc
121270060105     c                   endif
121280060105     c                   endif
121290120615     c* .... Forzatura da tabella "FLB/FLA"
121300120615     c* Forzatura linea di arrivo per codice cliente mittente o per linea di p.
121310120615     c                   clear                   trulflbds
121320120615     c                   movel     d_o95lna      iflblna
121330120615     c                   move      vidlnp        Iflblnp
121340120615    2c                   if        vidccm<>9999 and vidccm<>8888
121350120614     c                   move      vidccm        iflbccm
121360120615    3C     VIDFLC        IFEQ      0
121370120614     C                   MOVEL     VIDLNP        iflbccm
121380120614     C                   ELSE
121390120614     C                   MOVEL     VIDFLC        iflbccm
121400120614    3C                   ENDIF
121410120615    2c                   endif
121420120614     c                   call      'TRULFLBR'
121430120614     c                   parm                    trulflbds
121440120615    2c                   if        Oflblfz>*zeros
121450120615     c                   move      OflbLFZ       d_o95lna
121460120615    2c                   endif
121470111201     c                   endif
121480930409     C*
121490110217     C* L I N E A    D I    A R R I V O    N O N    I M M E S S A
121500110217     c*     I T A L I A    O    E U R O E X P R E S S
121510110217     C
121520940916     C*  LA PRENDO DA CAPPARIO
121530000121    3C     VIDLNA        IFLE      *ZEROS
121540000121     C     VIDDPD        ANDEQ     ' '
121550000121    3C     VIDLNA        ORLE      *ZEROS
121560000121     C     WDESIE        ANDEQ     'I'
121570970711     C                   CLEAR                   WMSGLN
121580970711     C                   CLEAR                   WMSGZO
121590970711     C**
121600060105     C                   MOVEL     d_o95lna      COMLNA
121610060105     C                   MOVEL     d_o952ln      W2LN
121620110217     c
121630111123     c* Controlli di base della linea di arrivo
121640110217     c                   movel     comlna        wlna
121650110217     c                   exsr      CTRLNA_Base
121660110217     c
121670110217     c                   if        *in90
121680110217     C                   GOTO      ENDC02
121690110217     c                   seton                                        40
121700110217     c                   endif
121710940916     C* Z O N A:
121720940916     C* 1) IMMISSIONE E DISK CLIENTI--> PRENDO SEMPRE
121730910801     C  N12
121740970704     COR 12
121750060105     C****AN 15              MOVEL     O95ZNC        VARZNC
121760060105     CAN 15              MOVEL     d_o95znc      VARZNC
121770940916     C* 2) MANUTENZIONE --> SE CAMBIATO CAP O FD O ZONA=0 RIPRENDO
121780940916     C   12
121790940916    4CANN15NOV           IFEQ      '1'
121800930402     C     VIDZNC        OREQ      0
121810060105     C                   MOVEL     d_o95znc      VARZNC
121820940916    4C                   END
121830910129     C*
121840940916   X3C                   ELSE
121850970711     C                   CLEAR                   WMSGLN
121860970711     C                   CLEAR                   WMSGZO
121870930401     C*
121880940916     C* L I N E A   D I   A R R I V O           I M M E S S A
121890110217     C*   N O N   C O N G R U E N T E  CON QUELLA DEL CAPPARIO ITALIA O EUROEXPR
121900110217     C*  OPPURE LINEA DI ARRIVO   D P D
121910110217     C*  OPPURE LINEA DI ARRIVO   F E D E X
121920110217     C
121930060105    4C     d_o95lna      IFNE      COMLNA
121940020204    5C     VIDDPD        OREQ      'D'
121950000222     C     WDESIE        ANDEQ     'E'
121960020319     C     A_§OGNTW      OREQ      'DPD'
121970020201    5C     VIDDPD        OREQ      'F'
121980020201     C     WDESIE        ANDEQ     'E'
121990020213     C     A_§OGntw      OREQ      'FED'
122000030516      * se linea di partenza 102 da conferma bolla clienti non devo
122010030516      * dare incongruenza
122020030516  5aac                   If        (vidlnp <> 102 and *in12 and *in15)
122030030516     c                             or not *in12 or not *in15
122040000222     C**
122050000120     C* SE FORZATA LNA DPD, NON DEVO DARE INCONGRUENZA
122060020204    5C     VIDDPD        IFEQ      'D'
122070000121     C     WDESIE        ANDEQ     'E'
122080020319     C     A_§OGNTW      OREQ      'DPD'
122090020201     C     VIDDPD        oreq      'F'
122100020201     C     WDESIE        ANDEQ     'E'
122110020213     C     A_§OGntw      OREQ      'FED'
122120000218     C**
122130020204    6C     VIDDPD        IFEQ      'D'
122140020201     C     WDESIE        ANDEQ     'E'
122150020319     C     A_§OGNTW      OREQ      'DPD'
122160000229     C* PER DPD IMPOSTO ZONA 00 PER RESI ZONA 80
122170000218     C     VIDFBR        IFEQ      'S'
122180000229     C                   MOVEL     80            VARZNC
122190000218     C                   ELSE
122200000218     C                   MOVEL     00            VARZNC
122210000218     C                   ENDIF
122220060615     c                   clear                   tisie3ds
122230060615     c                   eval      isie3tla='E'
122240060615     c                   z-add     blpdsp        isie3dri
122250060615     C                   z-add     BLPDSP        Isie3dsp
122260060615     c                   time                    isie3hsp
122270060615     C                   MOVEL     VIDNZD        isie3nzd
122280060615     C                   MOVEL     VIDCAD        Isie3cad
122290060615     c                   movel     vidlod        isie3cty
122300060615     c                   z-add     vidlnp        isie3lnp
122310060615     C     VIDFBR        IFEQ      'S'
122320060615     c                   z-add     300           isie3srv
122330060615     c                   else
122340060615     c                   if        v2cpkg>§3ilmp
122350060615     c                   z-add     101           isie3srv
122360060615     c                   else
122370060615     c                   z-add     136           isie3srv
122380060615     c                   endif
122390060615     c                   endif
122400060615     c                   movel     'N'           isie3exc
122410060615     C                   CALL      'TISIE3R'
122420060615     C                   PARM                    tisie3ds
122430060703     c*SE ERRORE DA CAPPARIO DPD, verificare
122440060615     C     Osie3err      IFNE      ' '
122450060615     C                   MOVEL     ERR(189)      VIDMSG
122460061011     C                   EVAL      CAPPARIODPD='S'
122470061011     c                   movel     vidcad        savcapdpd
122480060615     C                   SETON                                        4090
122490060615     C                   ENDIF
122500070515     c*****              endif
122510020201   x6c                   else
122520060105     c                   movel     D_o95lna      comlna
122530060105     c                   movel     d_o95znc      varznc
122540020201    6c                   endif
122550110217     c
122560110217     c* Controlli di base della linea di arrivo
122570110217     c                   movel     comlna        wlna
122580110217     c                   exsr      CTRLNA_Base
122590110217     c
122600110217     c                   if        *in90
122610110217     C                   GOTO      ENDC02
122620110217     c                   seton                                        40
122630110217     c                   endif
122640110217     c
122650000120  X 5C                   ELSE
122660970711     C**
122670940916     C* NON E' FERMO DEPOSITO
122680010214    6C     VIDFFD        IFEQ      'N'
122690010220     C     VIDFFD        OREQ      ' '
122700000704     C* NON CONTROLLO PER BOLLE POSTE DISK B
122710020319   6Ac     §ogntw        IFNE      'PPT'
122720000704     C     §1BFG6        ORNE      'C'
122730000704     C     §1BFG2        ORNE      'S'
122740940916     C* NON SEGNALO ERRORE SE BOLLA DA DISP MITTENTE
122750000120    7C     WFPR          IFNE      'I'
122760970711     C     WMSGLN        ANDEQ     ' '
122770030627      * non segnalo errore se bolle di recupero
122780100209      * non segnalo errore se prima lo avevo dato per tipo servizio H
122790100209If  8c                   If        §3arbl <> 'R'  and (vidtsp='H' or
122800100209     c                             quah=0)
122810100208     c
122820100208     c* Messaggio diverso per tipo servizio "H"
122830100210     c                   if        vidtsp='H'  and  §1bfg6='C'
122840100210     C                   MOVEL     ERR(80)       VIDMSG
122850100210     C                   sub       1             QUA
122860100210     C                   add       1             QUAH
122870100210     c                   else
122880100208     C                   MOVEL     ERR(90)       VIDMSG
122890100210    8c                   EndIf
122900100208
122910940916     C                   SETON                                        4090
122920030627    8c                   EndIf
122930000120    7C                   END
122940920427     C                   ADD       1             QUA
122950000704   6AC                   END
122960930409     C*
122970000120    6C                   END
122980910801     C* AZZERO LA ZONA
122990910801     C  N12
123000930401     COR 12
123010930401     CAN 15              Z-ADD     0             VARZNC
123020060829     c                   if        wfpr = 'G'
123030060829     c                   z-add     vidznc        varznc
123040060829     c                   endif
123050940916     C* IN MANUTENZIONE: se HO variato i dati --> AZZERO LA ZONA
123060000120     C   12
123070000120    6CANN15NOV           IFEQ      '1'
123080930401     C                   Z-ADD     0             VARZNC
123090940916     C*
123100000120   x6C                   ELSE
123110940916     C* SE CAMBIATA SOLO LA LINEA             --> AZZERO LA ZONA
123120000120    7C     SAVLNA        IFNE      VIDLNA
123130930401     C                   Z-ADD     0             VARZNC
123140910801     C                   MOVEL     '1'           NOV
123150940916     C*
123160000120   X7C                   ELSE
123170940916     C* SE NON HO CAMBIATO NULLA             -->LASCIO QUELLA CHE C'ERA
123180930402     C                   Z-ADD     BLPZNC        VARZNC
123190930402     C                   MOVEL     ' '           NOV
123200000120    7C                   ENDIF
123210910801     C*
123220000120    6C                   ENDIF
123230980806     C**
123240980806     C* SE LNA ESTERA ANCHE SE FORZO LA LINEA INCONGRUENTE COL CAP
123250980806     C*  PRENDO LA ZONA
123260020319     c     A_§ogntw      ifeq      'EEX'
123270980806     C  N12
123280980806     COR 12
123290060105     CAN 15              Z-ADD     d_o95znc      VARZNC
123300980806     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
123310000120     C   12
123320000120    7CANN15NOV           IFEQ      '1'
123330980806     C     VIDZNC        OREQ      0
123340060105     C                   Z-ADD     d_o95znc      VARZNC
123350000120    7C                   END
123360000120    6C                   ENDIF
123370000120    5C                   ENDIF
123380970711     C* PER ERRORE ESCO
123390970711     C   90              GOTO      ENDC02
123400030516
123410030516  5aac                   endif
123420921029     C*
123430940928   X4C                   ELSE
123440940916     C*
123450110217     C* L I N E A   D I   A R R I V O           I M M E S S A
123460110217     c*     I T A L I A    O    E U R O E X P R E S S
123470940916     C*  LINEA     CONGRUENTE CON QUELLA DEL CAPPARIO --> PRENDO ZONA
123480960208     C* LINEA ORIGINALE SE SECONDA LINEA DISTRIBUZIONE
123490060105     C                   MOVEL     d_o952ln      W2LN              1
123500060829     C  N12
123510060829     COR 12
123520060829     CAN 15              Z-ADD     d_o95znc      VARZNC
123530060829     c                   if        *in12='1' and *in15='1' and
123540060829     c                                 wfpr='G' and vidznc>0
123550060829     C                   Z-ADD     vidznc        VARZNC
123560060829     c                   endif
123570930402     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
123580940916     C   12
123590940916    5CANN15NOV           IFEQ      '1'
123600930402     C     VIDZNC        OREQ      0
123610060105     C                   Z-ADD     d_o95znc      VARZNC
123620940916    5C                   END
123630970711     C* DISK CLI
123640970711     C                   MOVEL     'N'           WMSGLN            1
123650970714     C                   MOVEL     O95ZNC        WEMZNC
123660910801     C*
123670940916    4C                   ENDIF
123680940916    3C                   ENDIF
123690970618    2C                   ENDIF
123700940916     C*
123710020917     C* PER DISK CLI CON SERIE PRENDO ZONA DA FIVAB
123720950410     C* --> SEGNALO PERO' SE E' DISCORDANTE CON QUELLA CALCOLATA
123730950421     C*     SEMPRE SE NON SI TRATTA DI UNA ZONA PRESA DALL'OLTRE O FD
123740970618     C   12
123750970618    2CAN 15VIDNRS        IFNE      0
123760950410     C*
123770970711    3C     §LPZNC        IFNE      WEMZNC
123780020319     C     §ogntw        ANDNE     'PPT'
123790950410     C     QUI           ANDEQ     0
123800970711     C     WMSGLN        ANDEQ     'N'
123810970711     C     WMSGZO        ANDEQ     ' '
123820030515      * non controllo per linea di partenza 102
123830030515     c     §lplnp        Andne     102
123840950410     C                   MOVEA     ERR(115)      K78
123850970711     C                   MOVEL     WEMZNC        W002A             2
123860950410     C                   MOVEA     W002A         K78(49)
123870950410     C                   MOVEL     §LPZNC        W002A             2
123880950410     C                   MOVEA     W002A         K78(13)
123890950410     C                   MOVEA     K78           VIDMSG
123900950410     C                   SETON                                        5790
123910950410     C                   MOVEL     1             QUI
123920950410     C                   GOTO      ENDC02
123930970618    3C                   ENDIF
123940950410     C*
123950930401     C                   Z-ADD     §LPZNC        VARZNC
123960970618    2C                   ENDIF
123970980410     C*
123980980410     C   12
123990980410    2CANN15§1BFG6        IFEQ      'C'
124000980410     C     §1BFG2        ANDEQ     'S'
124010980410     C     NOV           ANDEQ     '1'
124020980410     C*
124030980410    3C     BLPZNC        IFNE      WEMZNC
124040020319     C     §ogntw        ANDNE     'PPT'
124050980410     C     QUI           ANDEQ     0
124060980410     C     WMSGLN        ANDEQ     'N'
124070980410     C     WMSGZO        ANDEQ     ' '
124080980410     C                   MOVEA     ERR(115)      K78
124090980410     C                   MOVEL     WEMZNC        W002A             2
124100980410     C                   MOVEA     W002A         K78(49)
124110980410     C                   MOVEL     BLPZNC        W002A             2
124120980410     C                   MOVEA     W002A         K78(13)
124130980410     C                   MOVEA     K78           VIDMSG
124140980410     C                   SETON                                        5790
124150980410     C                   MOVEL     1             QUI
124160980410     C                   GOTO      ENDC02
124170980410    3C                   ENDIF
124180980410     C*
124190980410     C                   Z-ADD     BLPZNC        VARZNC
124200980410    2C                   ENDIF
124210930402     C***
124220930402     C*** CONTROLLO ZONA IN MANUTENZIONE ***
124230930409     C* SE MODIFICATA E SE NON RICALCOLATA DEVE ESISTERE NELLA TAB. 03
124240940916     C   12
124250940916    2CANN15NOV           IFNE      '1'
124260930409     C     BLPZNC        ANDNE     VIDZNC
124270930409     C     VIDZNC        ANDGT     0
124280930402     C                   MOVEL     VIDZNC        VARZNC
124290930406     C*
124300930409     C                   MOVEL     '03'          COD
124310930409     C                   MOVEL     COMLNA        ALF5              5
124320930409     C                   MOVE      VIDZNC        ALF5
124330940919     C                   MOVEL(P)  ALF5          KEY
124340930409     C*
124350930708     C                   EXSR      CTABEL
124360940928    3C     *IN30         IFEQ      *ON
124370940916     C                   MOVEL     ERR(61)       VIDMSG
124380940922     C                   SETON                                        5790
124390940920     C                   GOTO      ENDC02
124400940916    3C                   ENDIF
124410940916    2C                   ENDIF
124420930406     C*
124430960320     C***
124440960320     C*** PER LNA 102 OBBLIGATORIO IL C/S
124450000706    1C     COMLNA        IFEQ      102
124460960320     C     §3ARBL        ANDNE     'C'
124470960320     C                   SETON                                        4090
124480960320     C                   MOVEL     ERR(125)      VIDMSG
124490960320     C                   GOTO      ENDC02
124500000706    1C                   ENDIF
124510991206      **
124520110217      ** Aggancio AZORG di LNA per prednere dati
124530110217      ** Es: lo tolgo perchè lo fa già sopra avenfo unificato i controllo
124540110217      **     con la CTRLNA_Base non serrve più
124550110217      **
124560110217    1C**   VIDLNA        IFLE      *ZEROS
124570110217     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
124580110217     C**                 MOVEL     ORGDE3        A_OG143
124590110217     C**                 MOVEL     ORGDF0        A_OG150
124600110217    1C**                 ENDIF
124610991206      *
124620991206      * PER LNA DPD OBBLIGATORIO 1 COLLO
124630020319     C     A_§OGNTW      IFEQ      'DPD'
124640000120     C     VIDNCL        IFNE      1
124650991206     C                   SETON                                        4190
124660991206     C                   MOVEL     ERR(179)      VIDMSG
124670991206     C                   GOTO      ENDC02
124680991206     C                   ENDIF
124690000124     c* controllo numero parcel dpd doppio
124700000308     C*  NON LO CONTROLLO SE DA CTM NON HA SEGNACOLLI (PER BOLLA
124710000308     C*  RECUPERO O PER BOLLA LEGATA I CUI SEGNACOLLI SONO SULLA MAMMA)
124720000203     C     §1BFG8        IFEQ      'S'
124730060615     C                   move      V7CNPR        WNPR
124740000124     C                   EXSR      DPDDOP
124750000124     C     *IN90         IFEQ      *ON
124760000124     C                   SETON                                        41
124770000124     C                   MOVEL     ERR(190)      VIDMSG
124780000124     C                   GOTO      ENDC02
124790000124     C                   ENDIF
124800000203     C                   ENDIF
124810000120     C                   ENDIF
124820991213      * PER LNA O LNP DPD Massimo peso inseribile da tabella
124830020319     C     A_§OGNTW      IFEQ      'DPD'
124840020319     C     §OGNTW        OREQ      'DPD'
124850991214     C     V2CPKG        IFGT      §3IPKD
124860991213     C                   SETON                                        4290
124870991213     C                   MOVEA     ERR(180)      K78
124880991213     C                   MOVEL     §3IPKD        W006A             6
124890991213     C                   MOVEA     W006A         SKI(10)
124900991213     C                   Z-ADD     10            I                 3 0
124910991213     C                   EXSR      ABBL
124920991213     C                   MOVEA     SKI(10)       K78(53)
124930991213     C                   MOVE      §3IPKD        W001A
124940991213     C                   MOVEL     W001A         K78(60)
124950991213     C                   MOVEA     K78           VIDMSG
124960991213     C                   GOTO      ENDC02
124970991213     C                   ENDIF
124980991213     C                   ENDIF
124990991206      **
125000991203     C                   SETOFF                                       30
125010991203      *
125020991203     C                   SELECT
125030991203      *
125040060629      * IMPORT/EXPORT DPD  (import solo se in manutenzione e solo per
125050060629      * la visualizzazione)
125060991203      *  Premuto F18
125070020319     C     A_§OGNTW      WHENEQ    'DPD'
125080991203     C     *INKS         ANDEQ     *ON
125090060616     c     *in79         oreq      *on
125100060616     C     *INKS         ANDEQ     *ON
125110060616     c     *in12         andeq     *on
125120060616     c     *in15         andeq     *off
125130991203     C                   EXSR      GESD07
125140991203     C                   SETON                                        41
125150991203     C                   MOVEL     '1'           WEMFOR
125160991203     C                   GOTO      ENDC02
125170991203      *
125180991203      * EXPORT DPD
125190000307      *  Non premuto F18 e PARCEL non inserito. ESCLUDO I RECUPERI
125200020319     C     A_§OGNTW      WHENEQ    'DPD'
125210991203     C     *INKS         ANDEQ     *OFF
125220991203     C     V7CNPR        ANDEQ     *ZEROS
125230000308     C     §3ARBL        ANDNE     'R'
125240991203     C                   SETON                                        4190
125250991203     C                   MOVEL     ERR(175)      VIDMSG
125260991203     C                   GOTO      ENDC02
125270991203      *
125280991203      * SPEDIZIONE non ESTERO SDI E MITTENTE CON OBBLIGO AWB e non DPD
125290991203      * Premuto F18
125300991203     C     *INKS         WHENEQ    *ON
125310991203     C                   MOVEL     ERR(89)       VIDMSG
125320991203     C                   SETON                                        4190
125330991203     C                   GOTO      ENDC02
125340991203      *
125350991203     C                   ENDSL
125360940825     C***
125370910829     C*** RIFERIMENTO MITTENTE NUMERICO ***
125380940916    1C     VIDRMN        IFEQ      0
125390940825     C                   MOVEL     ERR(47)       VIDMSG
125400940922     C                   SETON                                        4390
125410940920     C                   GOTO      ENDC02
125420991130    1C                   ENDIF
125430970328     C***
125440970328     C*** FLAG D D T     ******
125450970408     C* PAESE CON ATTRAVERSAMENTO DOGANA: OBBLIGATORIO SI DDT
125460970408    1C     VIDBAM        IFEQ      'N'
125470000321     C     WEFT          ANDNE     ' '
125480970408     C                   MOVEL     ERR(140)      VIDMSG
125490970408     C                   SETON                                        7790
125500970408     C                   GOTO      ENDC02
125510970408     C                   ENDIF
125520101105     C* per Fedex : obbligatorio SI DDT
125530120523     c                   if        vidbam='N' and  §3arbl <>'R' and
125540101108     c                             (VidDpd = 'F' or a_§OgNtw = 'FED' )
125550101105     C                   MOVEL     ERR(335)      VIDMSG
125560101105     C                   SETON                                        7790
125570101105     C                   GOTO      ENDC02
125580101105     C                   ENDIF
125590970408     C* SE BOLLA DI RECUPERO, OBBLIGATORIO NO BAM
125600970408    1C     VIDBAM        IFEQ      'S'
125610970408     C     §3ARBL        ANDEQ     'R'
125620000321     C     WEFT          ANDEQ     ' '
125630020513     c     vidcbo        andne     'FO'
125640970408     C                   MOVEL     ERR(138)      VIDMSG
125650970408     C                   SETON                                        7790
125660970408     C                   GOTO      ENDC02
125670970408     C                   ENDIF
125680020507     C* SE BOLLA DI RECUPERO per bolle firmate, obbligatorio SI DDT
125690020507    1C     VIDBAM        IFEQ      'N'
125700020513     c     vidcbo        andeq     'FO'
125710020507     C                   MOVEL     ERR(254)      VIDMSG
125720020507     C                   SETON                                        7790
125730020507     C                   GOTO      ENDC02
125740020507     C                   ENDIF
125750970703     C* bolle CON OBBLIGO DDT DA CAPPARIO: SE NON E' RECUPERO ERRORE
125760970703     C*  SE IMMESSO NODDT
125770970408    1C     VIDBAM        IFEQ      'N'
125780970703     C     DESGDD        ANDEQ     'S'
125790970408     C     §3ARBL        ANDNE     'R'
125800081127     c     savfpr        andne     'G'
125810081127     c     savfpr        andne     'P'
125820970328     C                   MOVEL     ERR(139)      VIDMSG
125830970328     C                   SETON                                        7790
125840970328     C                   GOTO      ENDC02
125850970408    1C                   ENDIF
125860041109     c* bolla con vax (con estensione ddt del cliente) errore se SI DDT
125870050211     c* solo se nazione e/o cap non prevedono l'obbligo del ddt si
125880050211     c                   if        §1bf16 = 'S' and vidbam = 'S' and
125890050211     c                             weft = *blanks and desgdd <> 'S'
125900041109     C                   MOVEL     ERR(287)      VIDMSG
125910041109     C                   SETON                                        7790
125920041109     C                   GOTO      ENDC02
125930041109     c                   endif
125940950303     C***
125950950303     C*** RIFERIMENTO MITTENTE ALFABETICO ***
125960950303     C* SE DESTINATARIO ESTERO -->  OBBLIGATORIO
125970950303     C     WDESIE        IFEQ      'E'
125980000321     C     WEFT          ANDNE     *BLANKS
125990950303     C     VIDRMA        ANDEQ     *BLANKS
126000950303     C                   MOVEL     '1'           WEMFOR
126010950303     C                   SETON                                          5890
126020950303     C                   MOVEL     ERR(110)      VIDMSG
126030950303     C                   GOTO      ENDC02
126040950303    1C                   ENDIF
126050021209      * Obbligatorio se è una bolla con consegna supermercato
126060030303      * ma non se è DPD
126070021209     c                   If        (VidTc1 = 'S' or VidTc2 = 'S')
126080021209     c                              and VidRma = *Blanks
126090030304     c                              and Not *In79 and wrma = *Blanks
126100021209     c                   Eval      Wemfor = '1'
126110021209     c                   Movel     Err(266)      VidMsg
126120021209     c                   Eval      *In58 = *On
126130021209     c                   Eval      *In90 = *On
126140021209     c                   GoTo      EndC02
126150021209     c                   EndIf
126160961111     C***
126170961111     C*** FLAG BOLLA RIENTRO
126180961111     C***
126190060920     c* se linea di arrivo dpd valida solo per resi ci deve essere
126200060920     c*  il flag
126210060921     c     viddpd        ifeq      'D'
126220060921     c     comlna        andeq     *zeros
126230060921     c     A_§ogNTW      oreq      'DPD'
126240060921     c* se però c'e' reso non do errore
126250060921     c                   if        o14lad<=*zeros and desred='S' and vidfbr<>'S'
126260060920     C                   SETON                                            90
126270060920     c                   z-add     20            h2riga
126280060920     c                   z-add     67            h2colo
126290060920     C                   MOVEL     ERR(157)      VIDMSG
126300060920     C                   GOTO      ENDC02
126310060920     c                   endif
126320060921     c                   endif
126330060920     c
126340961111     C     VIDFBR        IFNE      SAVFBR
126350961111     C                   MOVEL     VIDFBR        SAVFBR
126360961111     C                   CLEAR                   SED
126370961111     C                   ENDIF
126380090901     c*
126390090921     c* controllo se tipo servizio H accettabile x  linea di arrivo della bolla
126400090901     c*   tenendo conto dei tempi di trazione
126410090901     c                   if        vidtsp='H'
126420090901     c
126430100219     c                   clear                   UsaCass
126440090901     c                   exsr      ClsE98
126450090901     c
126460090922     c                   if        d98tcc<>10
126470100119     C                   SETON                                            90
126480090901     C                   MOVEL     ERR(57)       VIDMSG
126490100319     c* Se vengo da ORRM --> cancello il tipo servizio
126500100319     c                   if        wesORE='S'
126510100319     c                   movel     'N'           wesore
126520100319     c                   endif
126530090901     C                   GOTO      ENDC02
126540090901     c                   endif
126550100322     c* Se eiste FNORE --> dico che si può utilizzare
126560100322     c                   else
126570100322     c                   if        WesORE='N'
126580100322     c                   movel     'S'           wesore
126590100322     c                   endif
126600090901     c                   endif
126610060920     c*
126620900604     C*
126630900621     C*** CONTROLLO SEGNACOLLI DAL - AL ***
126640910118     C* SE FLAG STAMPA BOLLA E' "D" O "I" E PER BOLLE DI RECUPERO
126650910118     C*  OBBLIGATORIA LA NON IMMISSIONE
126660910117     C*
126670910118     C                   SETOFF                                       30
126680940825     C                   CLEAR                   WNOSEG
126690921019     C* NO SEGNACOLLO
126700930402     C* SE VENGO DA DISK CLIENTI SOLO SE E' BOLLA SENZA MAMMA
126710930402     C*  NEGLI ALTRI CASI SEMPRE
126720940825    1C     §1BFG8        IFEQ      'N'
126730930402     C*
126740940825    2C     *IN12         IFEQ      '1'
126750930402     C     *IN15         ANDEQ     '1'
126760940825     C*
126770940825    3C     §3ABCM        IFEQ      ' '
126780940825     C                   MOVEL     '1'           WNOSEG            1
126790940825    3C                   END
126800940825     C*
126810940825   X2C                   ELSE
126820940825     C                   MOVEL     '1'           WNOSEG            1
126830940825    2C                   END
126840940825    1C                   END
126850910805     C* NON SEQUENZIALI
126860940825    1C   12VIDFNS        IFEQ      'S'
126870940825     C                   MOVEL     '1'           WNOSEG            1
126880940825    1C                   END
126890910118     C*
126900940825    1C     WNOSEG        IFEQ      '1'
126910940825    2C     VIDNCD        IFGT      0
126920940825     C                   MOVEL     ERR(51)       VIDMSG
126930940922     C                   SETON                                        4590
126940940920     C                   GOTO      ENDC02
126950940825    2C                   END
126960910118     C*
126970940825    2C     VIDNCA        IFGT      0
126980940825     C                   MOVEL     ERR(51)       VIDMSG
126990940922     C                   SETON                                        4690
127000940920     C                   GOTO      ENDC02
127010940825    2C                   END
127020940825    1C                   END
127030960805     C* SE C'E' IL DETTAGLIO COLLI NON LI POSSO MODIFICARE
127040960805    1C     §1BFG7        IFEQ      'S'
127050980410     C     §1BFG6        ANDEQ     'C'
127060960805    2C     VIDNCD        IFNE      WNSNCD
127070960805     C     VIDNCA        ORNE      WNSNCA
127080960805     C                   MOVEL     ERR(127)      VIDMSG
127090960805     C                   SETON                                        4590
127100960805     C                   GOTO      ENDC02
127110960805    2C                   ENDIF
127120960805     C*
127130960805    1C                   ENDIF
127140910118     C*
127150940216     C*CAMBIO PORTO DIROTTAMENTO --> NON DO QUESTO ERRORE
127160940825     C* (44 ON )                     PERCHE' SEGNACOLLI SULLA MAMMA
127170940825     C  N44
127180940825    1CANN25WNOSEG        IFEQ      ' '
127190940825     C*
127200940825    2C     VIDNCD        IFEQ      0
127210940825     C                   MOVEL     ERR(51)       VIDMSG
127220940922     C                   SETON                                        4590
127230940920     C                   GOTO      ENDC02
127240940825    2C                   END
127250940916     C***
127260910117     C*
127270940825    3C     VIDNCA        IFNE      0
127280020315     C     VIDNCA        SUB       VIDNCD        COMNCL            8 0
127290900502     C                   ADD       1             COMNCL
127300900508     C                   ELSE
127310900508     C                   Z-ADD     1             COMNCL
127320940825    3C                   END
127330940825     C*
127340940825     C* CONTROLLO DIFFERENZA SEGNACOLLO DAL-AL CON NUMERO COLLI
127350940825    3C     COMNCL        IFNE      VIDNCL
127360940825     C                   MOVEL     ERR(45)       VIDMSG
127370940922     C                   SETON                                        4190
127380940920     C                   GOTO      ENDC02
127390940825    3C                   END
127400910117     C*
127410940825    1C                   END
127420910208     C*
127430940825     C* SE DEVO ATTRIBUIRE I SEGNACOLLI CONTROLLO CHE CI SIA LA NUMERAZ
127440991209     C                   CLEAR                   AAS
127450910208     C                   Z-ADD     9             CNU
127460930120     C                   MOVE      VIDLNP        COMLIN
127470930120     C                   MOVE      COMLNA        LIV2
127480930629     C     KNUF2         CHAIN(N)  FLNUF                              30
127490910508     C*
127500940916    1C     *IN30         IFEQ      *ON
127510940916    2C     *IN25         IFEQ      *ON
127520940825     C                   MOVEL     ERR(41)       VIDMSG
127530940922     C                   SETON                                        4590
127540940920     C                   GOTO      ENDC02
127550940916    2C                   ENDIF
127560940825     C                   Z-ADD     0             NUFRIN
127570940825     C                   Z-ADD     0             NUFRFI
127580940916    1C                   ENDIF
127590910208     C*
127600910208     C                   SETOFF                                       30
127610941021     C*
127620960926     C* LINEA SEGNACOLLO:
127630950525     C* PER DISK CLIENTI KA LNP E SEMPRE QUELLA DEL DISK
127640950525     C* SOLO PERO' SE IL CTM E' DI UNA SOLUZIONE "B"
127650950525     C   12
127660950525     CAN 15§1BFG6        IFEQ      'C'
127670950525     C                   MOVEL     §LPLNP        WFLS
127680950525     C                   ELSE
127690950525     C                   MOVEL     VIDLNP        WFLS
127700950525     C                   ENDIF
127710941021     C* PER IMMISSIONE E' LA LINEA DI PARTENZA
127720941021     C  N12              MOVEL     VIDLNP        WFLS
127730941021     C* PER MANUTENZIONE E' QUELLA GIA' MEMORIZZATA
127740941021     C   12
127750941021     CANN15              MOVEL     BLPFLS        WFLS
127760940825     C*
127770921006     C* SE SEGNACOLLI COMPRESI NEL RANGE DI QUELLI ASSEGNATI IN
127780921006     C*  AUTOMATICO  ERRORE
127790920203     C* NON CONTROLLO SE TIPO BOLLA CON MAMMA (§3ABCM=S)
127800950713    1C     §3ABCM        IFNE      'S'
127810950713    2C     VIDNCD        IFNE      0
127820921006     C*
127830921006     C* NON CONTROLLO IL RANGE SE SONO IN RECUPERO
127840950713     C   12
127850950713    3CAN 15§LPFPR        IFEQ      'R'
127860921006     C                   SETON                                        30
127870950713    3C                   END
127880921006     C*
127890990602    3C  N12PARTCH        IFEQ      'R'
127900921006     C                   SETON                                        30
127910950713    3C                   END
127920921006     C*
127930950713     C  N30
127940950713    3CANN25VIDNRS        IFEQ      0
127950910208     C*
127960950713    4C     VIDNCD        IFLT      NUFRIN
127970950713    5C     VIDNCA        IFGT      NUFRIN
127980940825     C                   MOVEL     ERR(51)       VIDMSG
127990940922     C                   SETON                                        4690
128000940920     C                   GOTO      ENDC02
128010950713    5C                   END
128020950713   X4C                   ELSE
128030950713    5C     VIDNCD        IFLE      NUFRFI
128040940825     C                   MOVEL     ERR(51)       VIDMSG
128050940922     C                   SETON                                        4590
128060940920     C                   GOTO      ENDC02
128070950713    5C                   END
128080950713    4C                   END
128090910208     C*
128100950713    3C                   END
128110950713    2C                   END
128120910208     C*
128130910208     C* S E G N A C O L L I   D O P P I
128140910117     C*
128150910208     C* IN MANUTENZIONE/DISK CLIENTI CONTROLLO SE NON CAMBIATA LNA
128160921006     C                   SETOFF                                       30
128170971211     C                   MOVEL     COMLNA        W003A
128180971211     C   12
128190971211    2CAN 25SAVLNA        IFNE      W003A
128200910208     C                   SETON                                        30
128210950713    2C                   ENDIF
128220950713     C*
128230910208     C*  E SE NON AUMENTATI SEGNACOLLI
128240940916     C   12
128250050113    2Can 25SAVNCL        iflt      V1CNCL
128260910208     C                   SETON                                        30
128270950713    3C                   ENDIF
128280950713     C*
128290950713     C* NON CONTROLLO SE DEVO ASSEGNARE IL PGM I SEGNACOLLI
128300950713    2C     §1BFG6        IFEQ      'D'
128310950713     C     §1BFG6        OREQ      'I'
128320950713     C     §1BFG6        OREQ      'N'
128330950713     C                   SETON                                        30
128340950713    2C                   ENDIF
128350000627     C* NON CONTROLLO IN CASO DI CHIAMATA PER CONTROLLO DI BOLLA
128360000627     C*  AUTOGENERATA  POSTE
128370000627     C     §LPFLG        IFEQ      'C'
128380000627     C     VIDSOP        ANDEQ     '&'
128390020319     c     §ogntw        andeq     'PPT'
128400000627     C                   SETON                                        30
128410000627    2C                   ENDIF
128420940916     C*
128430910826     C*
128440920123     C* PER DISK CLI  SE NON SONO SEQUENZIALI
128450080313     c                   z-add     *hival        w_bldncd
128460080313     c                   clear                   w_bldnca
128470940916     C   12
128480940916     CAN 15
128490940916    2CANN30VIDFNS        IFEQ      'S'
128500920123     C*
128510020917     C     KBLC          SETLL     FIVAD000
128520020917     C     KBLC          READE(N)  FIVAD000                               31
128530910826     C*
128540940916    3C     *IN31         DOWEQ     *OFF
128550941230     C                   Z-ADD     BLDNCD        COMSCD
128560080313     c* mi memorizzo in campi di comodo il numero più basso e quello più
128570080313     c* alto di segnacollo che mi servirà per il controllo range se
128580080313     c* cliente con serie parziale
128590080313    4c                   if        bldncd<w_bldncd
128600080313     C                   Z-ADD     BLDNCD        W_bldncd
128610080313    4c                   endif
128620080313    4c                   if        bldnca>0
128630080313    5c                   if        bldnca>W_bldnca
128640080313     C                   Z-ADD     BLDNCA        W_bldnca
128650080313    5c                   endif
128660080313   x4c                   else
128670080313    5c                   if        bldncd>w_bldnca
128680080313     C                   Z-ADD     BLDNCD        W_bldnca
128690080313    5c                   endif
128700080313    4c                   endif
128710120828     C     KBLT          CHAIN     FNBLT27L                           32
128720051102    4c                   if        *in32
128730120828     C     KBLT          CHAIN(N)  Fiars01L                           32
128740120828    5c                   if        not *in32
128750120828     c     kblt          chain     fnart27l                           32
128760051102     c* Se non trovato ART record presente x errore: lo cancello
128770120828     c   32kblt          delete    fiars01l
128780120828    5c                   endif
128790051102    4c                   endif
128800960319     C  N32              SETON                                        3190
128810020917     C   32KBLC          READE(N)  FIVAD000                               31
128820940916    3C                   ENDDO
128830940916     C*
128840940916    3C     *IN90         IFEQ      *ON
128850940916     C                   EXSR      PRPMSG
128860940920     C                   GOTO      ENDC02
128870940916    3C                   ENDIF
128880940916     C                   SETON                                        30
128890940916    2C                   ENDIF
128900910826     C*
128910920124     C* PER GLI ALTRI CASI
128920940916    2C  N30VIDFNS        IFEQ      ' '
128930910118     C                   Z-ADD     VIDNCD        CO2SCD            8 0
128940910118     C                   Z-ADD     VIDNCD        COMSCD            7 0
128950940916    3C     VIDNCA        IFEQ      0
128960900503     C                   Z-ADD     VIDNCD        COMSCA
128970900502     C                   ELSE
128980910118     C                   Z-ADD     VIDNCA        COMSCA            8 0
128990940916    3C                   END
129000900502     C*
129010940916    3C     CO2SCD        DOWLE     COMSCA
129020990318     C     CO2SCD        ANDGT     0
129030920124     C*
129040920124     C* PER IMMISSIONE  / DISK CLIENTI SEQUENZIALI
129050920124     C   12
129060920124     CAN 15
129070940916    4CORN12              DO
129080120828     C     KBLT          CHAIN     FNBLT27L                           32
129090051102     c
129100051102    5C   32§ogntw        IFne      'PPT'
129110120828     C     KBLT          CHAIN(N)  Fiars01L                           32
129120120828    6c                   if        not *in32
129130120828     c     kblt          chain     fnart27l                           32
129140051102     c* Se non trovato ART record presente x errore: lo cancello
129150120828     c   32kblt          delete    fiars01l
129160120828    6c                   endif
129170051102    5c                   endif
129180051102     c
129190051102     C  N32              SETON                                        90
129200940916     C*
129210001212     C* PREPARA MESSAGGIO DI ERRORE
129220100517     c
129230100517     C   90              EXSR      PRPMSG
129240100517    4C                   END
129250920124     C*
129260920124     C* PER MANUTENZIONE CONTROLLO ANCHE DI NON ESSERE ME STESSA
129270940916     C   12
129280940916    4CANN15              DO
129290120828     C     KBLT          SETLL     FNBLT27L
129300120828     C     KBLT          READE     FNBLT27L                               32
129310920124     C*
129320940916    5C     *IN32         DOWEQ     *OFF
129330940916    6C     VIDSPE        IFNE      BLPSPE
129340940916     C                   SETON                                        9032
129350920124     C                   ELSE
129360120828     C     KBLT          READE     FNBLT27L                               32
129370940916    6C                   ENDIF
129380940916    5C                   ENDDO
129390940916    4C                   ENDDO
129400940916     C* SEGNACOLLO DOPPIO --> PREPARA MESSAGGIO DI ERRORE
129410940916    4C     *IN90         IFEQ      *ON
129420940916     C                   EXSR      PRPMSG
129430940920     C                   GOTO      ENDC02
129440940916    4C                   ENDIF
129450920124     C*
129460910826     C* CONTROLLO ALTRO NUMERO
129470910826     C                   ADD       1             CO2SCD
129480910826     C                   ADD       1             COMSCD
129490940916    3C                   END
129500940916    2C                   END
129510920124     C*
129520940916    1C                   END
129530910220     C*
129540910220     C*** NUMERO SERIE ***
129550940826     C*
129560100517    2C     VIDNRS        IFNE      0
129570100517     c
129580940922     C*
129590940922     C* SE SERIE <> DA 0 E FLAG6 DEL CTM NON E' "C" ERRORE
129600940916    3C     §1BFG6        IFNE      'C'
129610940916     C                   MOVEL     ERR(49)       VIDMSG
129620940922     C                   SETON                                        5690
129630940920     C                   GOTO      ENDC02
129640940916    3C                   END
129650100517     c
129660100517     c                   clear                   trulnrsds
129670100517     c                   movel     wksc          inrsCCM
129680100517     c                   movel     vidnrs        inrsNRS
129690100517     c                   movel     wfls          inrsFLS
129700100517    3c                   if        vidfns='S'
129710100517     c                   movel     w_bldncd      inrsNCD
129720100517     c                   movel     w_bldnca      inrsNCA
129730100517     c                   else
129740100517     c                   movel     vidncd        inrsNCD
129750100517     c                   movel     vidnca        inrsNCA
129760100517    3c                   endif
129770100517     c
129780100517     c                   call      'TRULNRSR'
129790100517     c                   parm                    trulnrsds
129800100517     c
129810110902    3c****               select
129820110902    3c****               when      onrserr<>' ' and
129830110902     c****                         onrserr<>'N'
129840110902    3c                   if        onrserr<>' '
129850100517     C                   MOVEL     onrsmsg       VIDMSG
129860100517     C                   SETON                                        9056
129870100517     C                   GOTO      ENDC02
129880110902     c                   endif
129890100517     c
129900110902    3c*********          when      onrserr= 'N' and f_range=' '
129910080313      *
129920110902     c
129930110902     c******             eval      f_range='1'
129940110902     c*******            seton                                        90
129950110902     c******             exsr      escier
129960110902    4C**** §lpfpr        IFNE      '5'
129970080314     C* gestione window con errore forzabile
129980110902     c*****              setoff                                       90
129990100517     c* riempi i campi col messaggio
130000110902     c*****              eval      w3cpfl1=%subst(onrsmsg:1:24)
130010110902     c*****              eval      w3cpfl2=%subst(onrsmsg:25:38)
130020110902     c*****              eval      w3cpfl3=%subst(onrsmsg:63:16)
130030100517     c
130040110902    5c****               if        §lpfpr<>'V'
130050110902     c****               write     ls01d02
130060110902    5c****               endif
130070110902    5c****               dou       *inkf
130080110902     c****               exfmt     ls01w3cp
130090110902    5c****               enddo
130100110902     c****               eval      wemfor='1'
130110110902     c****               goto      endc02
130120110902   x4C***+               ELSE
130130110902     c***                seton                                        90
130140110902     C****               GOTO      ENDC02
130150110902    4C****               ENDIF
130160110902    3c******             ENDSL
130170910308     C*
130180940916   X2C                   ELSE
130190910308     C* SERIE =0 FLAG6 DEL CTM = "C" ERRORE
130200940916    3C     §1BFG6        IFEQ      'C'
130210940916     C                   MOVEL     ERR(49)       VIDMSG
130220940922     C                   SETON                                        5690
130230940920     C                   GOTO      ENDC02
130240940916    3C                   END
130250940916    2C                   END
130260921006     C*
130270940916     C* SE RECUPERO CONTROLLO NUM SPEDIZIONE DOPPIO
130280990602    1C  N12PARTCH        IFEQ      'R'
130290940915     C     KNSP          SETLL     FNBLP01L                               30
130300940928    2C     *IN30         IFEQ      *ON
130310940916     C                   MOVEL     ERR(50)       VIDMSG
130320940922     C                   SETON                                        5690
130330940920     C                   GOTO      ENDC02
130340940928    2C                   END
130350940928    1C                   END
130360940916     C***
130370900502     C*** NATURA MERCE ***
130380940928    1C  N27VIDNAS        IFEQ      *BLANKS
130390940928     C                   MOVEL     ERR(53)       VIDMSG
130400940922     C                   SETON                                        4890
130410940920     C                   GOTO      ENDC02
130420940928    1C                   END
130430970115     C*
130440970115     C* CONTROLLO QUALI DICITURE NON SONO AMMESSE E PER QULI BOLLE
130450970115     C                   Z-ADD     1             C
130460970115    1C     LDC(C)        DOWNE     *BLANKS
130470970115     C*
130480970115     C                   CLEAR                   WRICER
130490970115    2C     WDESIE        IFEQ      'E'
130500970115    3C     TBO(C)        IFEQ      ' '
130510970115     C     TBO(C)        OREQ      'E'
130520970115     C                   MOVEL     'S'           WRICER            1
130530970115    3C                   ENDIF
130540970115    2C                   ENDIF
130550970115    2C     WDESIE        IFEQ      'I'
130560970115    3C     TBO(C)        IFEQ      ' '
130570970115     C     TBO(C)        OREQ      'I'
130580970115     C                   MOVEL     'S'           WRICER            1
130590970115    3C                   ENDIF
130600970115    2C                   ENDIF
130610970115     C*
130620970115    2C     WRICER        IFEQ      'S'
130630970115     C                   MOVEL     TBO(C)        W003A
130640970115     C                   MOVE      LDC(C)        W003A
130650970115     C                   MOVEL     '3F'          COD
130660970115     C                   MOVEL(P)  W003A         KEY
130670970115     C     KTAB2         CHAIN     TABEL                              30
130680970115    3C     *IN30         IFEQ      *OFF
130690970115     C                   MOVEA     TBLUNI        K89
130700970115    3C                   ENDIF
130710970115     C                   MOVEL     LDC(C)        Z                 2 0
130720970115     C                   Z-ADD     1             Y                 3 0
130730970115     C*
130740970115    3C     Y             DOWLT     86
130750970115     C                   CLEAR                   W015A
130760970115     C                   MOVEA     K89(Y)        W015A            15
130770970115    4C     W015A         IFNE      *BLANKS
130780970115     C     W015A:Z       SCAN      VIDNAS                                 31
130790970115     C* ERRORE
130800970115    5C     *IN31         IFEQ      *ON
130810970115     C*
130820970115     C     WDESIE        IFEQ      'E'
130830970115     C                   MOVEA     ERR(135)      K78
130840970115     C                   ELSE
130850970115     C                   MOVEA     ERR(136)      K78
130860970115     C                   ENDIF
130870970115     C                   Z-ADD     11            YY                3 0
130880970115     C                   DO        Z
130890970115     C                   MOVEL     K89(Y)        K78(YY)
130900970115     C                   ADD       1             YY
130910970115     C                   ADD       1             Y
130920970115     C                   ENDDO
130930970115     C                   MOVEL     '"'           K78(YY)
130940970115     C                   MOVEA     K78           VIDMSG
130950970115     C*
130960970115     C                   SETON                                        4890
130970970115     C                   Z-ADD     89            Y
130980970115     C                   Z-ADD     29            C
130990970115    5C                   ENDIF
131000970115    4C                   ENDIF
131010970115     C*
131020970115     C                   ADD       Z             Y
131030970115    3C                   ENDDO
131040970115    2C                   ENDIF
131050970115     C*
131060970115     C                   ADD       1             C
131070970115    1C                   ENDDO
131080940930     C***
131090940930     C*** MITTENTE ORIGINALE ***
131100941103     C                   MOVEL     VIDRMO        WRMO
131110941103     C                   MOVEL     VIDCMO        WCMO
131120941108     C                   MOVEL     VIDNMO        WNAR
131130941103     C                   EXSR      CTRMO
131140941103     C                   MOVEL     WNAR          VIDNMO
131150941103     C     WEMFOR        IFEQ      '1'
131160941103     C                   GOTO      ENDC02
131170941103     C                   ENDIF
131180091008     c*** . . .obbligatorio per porti assegnati import
131190091008     c                   if        §3atb1='A2' and (§ogntw='FED' or
131200091008     c                             §ogntw='DPD' or §ogntw='EEX')
131210091008     c                             and (vidrmo=*blanks or vidcmo=*blanks)
131220091016     c                             and *in44=*off and vidfbr<>'S'
131230091008     C                   MOVEL     ERR(328)      VIDMSG
131240091008     C                   SETON                                        90
131250091008     c                   select
131260091008     c                   when      vidrmo=*blanks
131270091008     c                   seton                                        71
131280091008     c                   when      vidcmo=*blanks
131290091008     c                   seton                                        72
131300091008     c                   endsl
131310091008     C                   GOTO      ENDC02
131320091008     c                   endif
131330091008     c
131340940922     C***
131350940922     C*** CONTRASSEGNO ***
131360961204     c***
131370961204     C* PER BOLLE DI RESO NON SI PUO' INSERIRE
131380961204     C     VIDFBR        IFEQ      'S'
131390961204     C     §3AFCA        ANDGT     0
131400961204     C                   MOVEL     ERR(134)      VIDMSG
131410961204     C                   SETON                                        5090
131420961204     C                   GOTO      ENDC02
131430961204    1C                   ENDIF
131440940922     C* IN MANUTENZIONE: SE BOLLA CHE PREVEDE C/A MA E' CON MAMMA E
131450940922     C*  SI TRATTA DI UN TIPO BOLLA NON MANUTENZ, NON POSSO INSERIRE:
131460940922     C*  NE' TIPO INCASSO NE' C/ASSEGNO, MENTRE POSSO INSERIRE LE VARIE
131470940922     C*
131480940922    1C     *IN12         IFEQ      *ON
131490940922     C     *IN15         ANDEQ     *OFF
131500940922     C     *IN44         ANDEQ     *ON
131510940922     C     §3ABCM        ANDNE     ' '
131520940922     C     §3AFCA        ANDNE     0
131530940922     C*
131540940922    2C     VIDTIC        IFNE      *BLANKS
131550940922     C                   MOVEL     ERR(99)       VIDMSG
131560940922     C                   SETON                                        4990
131570940922    2C                   END
131580940922    2C  N90VIDCAS        IFNE      0
131590940922     C                   MOVEL     ERR(98)       VIDMSG
131600940922     C                   SETON                                        5090
131610940922    2C                   END
131620940922     C*
131630940922   X1C                   ELSE
131640940922     C*
131650940922     C* IN TUTTI GLI ALTRI CASI SI SEGUONO LE REGOLE CORRETTE
131660940922     C* NON C'E' FLAG C/ASSEGNO SU TIPO BOLLA
131670940922    2C     §3AFCA        IFEQ      0
131680940922     C*
131690940922    3C     VIDTIC        IFNE      *BLANKS
131700940922     C                   MOVEL     ERR(99)       VIDMSG
131710940922     C                   SETON                                        4990
131720940922    3C                   ENDIF
131730940922    3C  N90VIDCAS        IFNE      0
131740940922     C                   MOVEL     ERR(98)       VIDMSG
131750940922     C                   SETON                                        5090
131760940922    3C                   ENDIF
131770940922     C*
131780940922   X2C                   ELSE
131790940922     C*
131800940922     C*     C'E' FLAG C/ASSEGNO SU TIPO BOLLA
131810940922    3C     VIDCAS        IFEQ      0
131820940922     C                   MOVEL     ERR(98)       VIDMSG
131830940922     C                   SETON                                        5090
131840940922    3C                   ENDIF
131850011108     C  N90VIDVCA        IFEQ      *BLANKS
131860011108     C                   MOVEL     ERR(169)      VIDMSG
131870011108     C                   SETON                                        5190
131880011108     C                   ENDIF
131890940922    2C                   ENDIF
131900940922     C*
131910940922    1C                   ENDIF
131920940922     C* ERRORE
131930940922     C   90              GOTO      ENDC02
131940090622     c*
131950090622     c* Controllo tipo incasso C/A e relativa divisa
131960090622     c* richiamo pgm TRULTICR
131970090625    1c                   if        vidtic<>*blanks or vidcas>0
131980091211     c                   exsr      sr_trultic
131990091211     c                   exsr      sr_impochktic
132000090622     c
132010090625    2c                   if        oticric='T'
132020090624     c                   movel     otictic       vidtic
132030090624     c                   eval      wemfor='1'
132040090624     C                   GOTO      ENDC02
132050090625    2c                   endif
132060090625    2c                   if        oticric='D'
132070090624     c                   movel     oticdiv       vidvca
132080090624     C                   eval      wemfor='1'
132090090624     C                   GOTO      ENDC02
132100090625    2c                   endif
132110090622     c* Errore tipo incasso
132120091211     c* Se errore di tipo "C" lo segnalo solo se non c'è orm con
132130091211     c* triangolazione oppure se è stato già scelto il beneficiario
132140091211     c* del contrassegno
132150091211    2c                   if        oticerr='T' or (oticerr='C' and
132160091211     c                             (nochkticC=*off or (wcassel1='X'or
132170091211     c                             wcassel2='X')))
132180090624     C                   MOVEL     oticmsg       VIDMSG
132190090624     C                   SETON                                        4990
132200090624     C                   GOTO      ENDC02
132210091211    2C                   ENDIF
132220090622     c* Errore divisa
132230090625    2c                   if        oticerr='D'
132240090624     C                   MOVEL     oticmsg       VIDMSG
132250090624     C                   SETON                                        5190
132260090624     C                   GOTO      ENDC02
132270090624    2C                   ENDIF
132280090624     c* Ulteriori controlli non presenti in TRULTICR
132290090625
132300060707     c* se tipo incasso richiede il mittente originale controllo che
132310060707     c* sia stato immesso
132320090625    2c                   if        §1amro='S' and vidrmo=*blanks
132330060707     C                   MOVEL     ERR(304)      VIDMSG
132340060707     C                   SETON                                        7190
132350060707     C                   GOTO      ENDC02
132360090625    2c                   endif
132370090625      * Devo lo stesso agganciare tabella "TM" perchè serve poi nella
132380090625      * routine di registrazione
132390090625     C                   MOVEL     'TM'          COD
132400090625     C                   MOVEL(P)  WKSC          KEY
132410090625     C*
132420090625     C                   EXSR      CTABEL
132430090625     c  n30              movel     tbluni        dstm
132440090625     c   30              clear                   dstm
132450090625     c*
132460090625    1c                   endif
132470011108     C*
132480011108     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE IL C/A
132490011108     C* INDICATORE DI CHANGE 11 ON
132500011108    1C     VARVCA        IFNE      VIDVCA
132510011108    2C     WIN11         IFEQ      *BLANKS
132520011108     C     VIDCAS        ANDNE     0
132530011108     C                   MOVEL     ERR(105)      VIDMSG
132540011108     C                   SETON                                        5090
132550011108     C                   GOTO      ENDC02
132560011108    2C                   ENDIF
132570011108     C*
132580011108    1C                   ENDIF
132590011108     C*
132600011212      * pulisco il flag x la forzatura importo C/Assegno
132610011212     C     VIDCAS        IFNE      WARCAS
132620011212     C                   CLEAR                   FORCAS
132630011212     C                   Z-ADD     VIDCAS        WARCAS
132640011212     C                   ENDIF
132650011212     C                   CLEAR                   FCASAV
132660011211     C* Richiamo TRUL21R per controllo limiti importo C/Assegno
132670090921    1C     VIDCAS        IFGT      *ZEROS
132680011211     C                   CLEAR                   DSUL21
132690011211     C                   MOVEL     VIDCBO        I21CBO
132700090921    2C     VIDTSP        IFNE      *BLANKS
132710011211     C                   MOVEL     VIDTSP        I21TSP
132720011211     C                   ELSE
132730011211     C                   MOVEL     COMTSP        I21TSP
132740090921    2C                   ENDIF
132750011211     C                   Z-ADD     VIDLNP        I21LNP
132760011211     C                   MOVEL     VIDNZM        I21NZM
132770011211     C                   Z-ADD     COMLNA        I21LNA
132780011211     C                   MOVEL     VIDNZD        I21NZD
132790090921    2C     *IN04         IFEQ      *ON
132800011211     C                   Z-ADD     9999          I21KSC
132810011211     C                   MOVEL     VIDLNP        I21KSC
132820090921   x2C                   ELSE
132830011211     C                   Z-ADD     VIDCCM        I21KSC
132840090921    3C     VIDFLC        IFEQ      0
132850011211     C                   MOVEL     VIDLNP        I21KSC
132860090921   x3C                   ELSE
132870011211     C                   MOVEL     VIDFLC        I21KSC
132880090921    3C                   ENDIF
132890090921    2C                   ENDIF
132900011211     C                   MOVEL     VIDCTR        I21CTR
132910011211     C                   MOVEL     VIDTIC        I21TIC
132920011211     C                   Z-ADD     VIDCAS        I21IMP
132930011211     C                   MOVEL     VIDVCA        I21DIV
132940011211     C                   MOVEL     KNMUS         I21UTE
132950011211     C                   MOVEL     NOMPGM        I21PGM
132960011211     C                   CALL      'TRUL21R'
132970011211     C                   PARM                    DSUL21
132980011212     C* Salvo il flag del limite di abilitazione C/A che mi servirà per
132990011212     C* il richiamo del pgm di stampa L.V.
133000011212     C                   MOVE      O21FCA        FCASAV
133010011211     C* IMPORTO MAGGIORE DEL LIMITE MAX
133020090921    2C     O21FX2        IFNE      *BLANKS
133030011211     C                   MOVEA     ERR(131)      K78
133040011212     C                   MOVE      O21LX2        WNUMED
133050011212     C* richiamo routine per editare il limite
133060011212     C                   EXSR      CALLXE
133070011211      * metto il numero editato nel campo del messaggio
133080011211     C                   MOVEA     W014A         SKII(1)
133090011211     C                   MOVEA     SKII(1)       K78(47)
133100011211     C*
133110011211     C                   MOVEA     K78           VIDMSG
133120011211     C                   SETON                                        5090
133130011211     C                   GOTO      ENDC02
133140090921    2C                   ENDIF
133150090921     c
133160011211     C* IMPORTO INFERIORE AL LIMITE MINIMO
133170090921    2C     O21FMN        IFNE      *BLANKS
133180011212     C                   MOVEA     ERR(236)      K78
133190011212     C                   MOVE      O21LMN        WNUMED
133200011212     C* richiamo routine per editare il limite
133210011212     C                   EXSR      CALLXE
133220011212      * metto il numero editato nel campo del messaggio
133230011212     C                   MOVEA     W014A         SKII(1)
133240011212     C                   MOVEA     SKII(1)       K78(31)
133250011212     C*
133260011212     C                   MOVEA     K78           VIDMSG
133270011212     C                   SETON                                        5090
133280011212     C                   GOTO      ENDC02
133290090921    2C                   ENDIF
133300090921     c
133310011211     C* IMPORTO MAGGIORE DEL LIMITE FORZABILE
133320090921    2C     O21FX1        IFNE      *BLANKS
133330011212     C     FORCAS        ANDEQ     *BLANKS
133340011212     C                   MOVEL     '1'           FORCAS            1
133350011212     C                   MOVEA     ERR(237)      K78
133360011212     C                   MOVE      O21LX1        WNUMED
133370011212     C* richiamo routine per editare il limite
133380011212     C                   EXSR      CALLXE
133390011212      * metto il numero editato nel campo del messaggio
133400011212     C                   MOVEA     W014A         SKII(1)
133410011212     C                   MOVEA     SKII(1)       K78(24)
133420011212     C                   MOVEA     K78           VIDMSG
133430011212     C                   SETON                                        5090
133440011212     C                   GOTO      ENDC02
133450090921    2C                   ENDIF
133460090921     c
133470090921     c* Tipo servizio H non ammesso er C/ASS da abilitare
133480090921     c                   if        fcasav<>*blanks  and  vidtsp='H'
133490090921     c                   SETON                                        5090
133500090921     C                   MOVEL     ERR(149)      VIDMSG
133510090921     C                   GOTO      ENDC02
133520090921     c                   endif
133530090921     c
133540090921    1C                   ENDIF
133550090625     C*
133560011108     C                   MOVEL     VIDVCA        VARVCA
133570011108     C                   CLEAR                   WIN11
133580940916     C***
133590961111     C*** N O T E    ***
133600990610     C* SONO OBBLIGATORIE SE BOLLA PREPAGATO PER TELEFONO E REFERENTE
133610990610     C*  RITIRO
133620990610    3C     PARTCH        IFEQ      'P'
133630990610     C     SES           ANDEQ     0
133640010306    3C     §LPFPR        OREQ      'O'
133650010306     C     SES           ANDEQ     0
133660990610     C                   MOVEL     ERR(159)      VIDMSG
133670990610     C                   MOVEL     1             SES
133680990610     C                   SETON                                        8690
133690990610     C                   GOTO      ENDC02
133700990610    3C                   END
133710990610     C*
133720990610    3C     VIDNT1        IFEQ      *BLANKS
133730990610     C     VIDNT2        ANDEQ     *BLANKS
133740990610     C     PARTCH        ANDEQ     'P'
133750010306    3C     VIDNT1        OREQ      *BLANKS
133760010306     C     VIDNT2        ANDEQ     *BLANKS
133770010306     C     §LPFPR        ANDEQ     'O'
133780990610     C                   MOVEL     ERR(159)      VIDMSG
133790990610     C                   SETON                                        8690
133800990610     C                   GOTO      ENDC02
133810990610    3C                   END
133820961111     C***
133830961111     C*** IMPORTO DA ASSICURARE ***
133840961111     C***
133850950120     C* SE VARIATO ME LO SALVO
133860950120     C     *IN89         IFEQ      *ON
133870950120     C                   MOVEL     '1'           WIN89             1
133880950120     C                   ENDIF
133890950104     C*
133900011112     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
133910011112     C     VIDIAS        IFGT      *ZEROS
133920011112     C     VIDVAS        ANDEQ     *BLANKS
133930011112     C                   MOVEL     ERR(169)      VIDMSG
133940011114     C                   SETON                                        8190
133950011112     C                   GOTO      ENDC02
133960011112     C                   ENDIF
133970011112     C*
133980950104     C                   MOVEL     VIDVAS        WVLT
133990950104     C                   Z-ADD     VIDIAS        W0133            13 3
134000950104     C* CONTROLLO LA DIVISA
134010950104     C                   EXSR      CTRVLT
134020950104     C                   MOVEL     WVLT          VIDVAS
134030950104     C* ERRORE
134040950104     C   90              SETON                                        81
134050950104     C*
134060950104     C     WEMFOR        IFEQ      '1'
134070950104     C                   GOTO      ENDC02
134080950104     C                   ENDIF
134090011113     C*
134100011113     C* CONTROLLO SCADENZA DIVISA
134110011113     C     BLPDSP        IFGT      §CVDLI
134120011113     C     VIDIAS        ANDNE     0
134130011113     C                   MOVEL     ERR(232)      VIDMSG
134140011114     C                   SETON                                        8190
134150011113     C                   GOTO      ENDC02
134160011113     C                   ENDIF
134170950104     C*
134180950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
134190950104     C* INDICATORE DI CHANGE 89 ON
134200950104     C     VIDVAS        IFNE      VARVAS
134210950120     C     WIN89         ANDEQ     *BLANKS
134220011112     C     VIDIAS        ANDNE     0
134230950104     C                   MOVEL     ERR(105)      VIDMSG
134240950104     C                   SETON                                        8090
134250950104     C                   GOTO      ENDC02
134260950104    2C                   ENDIF
134270950104     C*
134280950104     C                   MOVEL     VIDVAS        VARVAS
134290950120     C                   CLEAR                   WIN89
134300940922     C*
134310940922     C* LO PRENDO SOLO PER LE SPEDIZIONI IN FRANCO PERCHE' IN ASSEGNATO
134320940922     C*  LA MERCE E' FRANCO STABILIMENTO, PER CUI DIVENTA DEL DESTINAT
134330941103    1C     *IN04         IFEQ      *OFF
134340940922     C* SOLO SE IL MITTENTE HA TARIFFE
134350941108     C     WTKS          ANDEQ     'S'
134360950104     C*
134370950104     C* SE <> 0 CONTROLLO CHE NON SUPERI IL VALORE IN TARIFFA
134380011211    2C     VIDIAS        IFNE      VARIAS
134390950104     C     VIDNCL        ORNE      VARNCL
134400950104     C                   Z-ADD     0             DIE
134410991028    2C                   END
134420940922     C*
134430940922    2C     VIDIAS        IFGT      0
134440940922     C     DIE           ANDNE     NUMFOR
134450950215     C     TAMFIS        ORNE      '0'
134460011211     C                   Z-ADD     VIDIAS        VARIAS
134470940922     C                   MOVEL     VIDNCL        VARNCL
134480960209     C* NON CONTROLLA DA TARIFFA SE OBBLIG.SE TIPO BOLLA NON PREVISTO
134490960209     C     §3ATB1        LOOKUP    TBL                                    30
134500960209     C*
134510960209   2AC     *IN30         IFEQ      *ON
134520940922     C*
134530940922     C* SOLO SE E' ASSICURAZIONE ANCHE PER LE PARTENZE ( <> A )
134540990818     C     KTPT          CHAIN     TITPT000                           30
134550950220    3C     *IN30         IFEQ      *ON
134560950220     C     TPTATB        ORNE      ' '
134570950220     C     TPTAPL        ORNE      'A'
134580950215     C*
134590950215     C* TAMFIS=1 OBBLIGATORIO     FORZABILE --> CON ENTER PRENDO MAX
134600950215     C*                                         IMPORTO DA TARIFFA
134610950215    4C     TAMFIS        IFEQ      '1'
134620950215     C     CIN           ANDNE     NUMFOR
134630011211     C     VIDIAS        ANDEQ     0
134640950215     C                   MOVEL     ERR(93)       VIDMSG
134650950215     C                   SETON                                        8090
134660950215     C                   ADD       1             CIN
134670950215     C                   GOTO      ENDC02
134680950215    4C                   ENDIF
134690950215     C*
134700950215     C* TAMFIS=3 OBBLIGATORIO NON FORZABILE --> ERRORE SEMPRE
134710950215    4C     TAMFIS        IFEQ      '3'
134720011211     C     VIDIAS        ANDEQ     0
134730950215     C                   MOVEL     ERR(94)       VIDMSG
134740950215     C                   SETON                                        8090
134750950215     C                   GOTO      ENDC02
134760950215    4C                   ENDIF
134770950215     C*
134780950215     C* TAMFIS=2 NON INSERIBILE             --> ERRORE SEMPRE
134790950215    4C     TAMFIS        IFEQ      '2'
134800011211     C     VIDIAS        ANDNE     0
134810950215     C                   MOVEL     ERR(95)       VIDMSG
134820950217     C                   SETON                                        8090
134830950215     C                   GOTO      ENDC02
134840950215    4C                   ENDIF
134850950220    3C                   ENDIF
134860950215     C* SE C'E VALORE MERCE:
134870950220    3C  N30TPTATB        IFEQ      ' '
134880950220     C     TPTAPL        ANDNE     'A'
134890950220     C     TPTVLM        ANDGT     0
134900940922     C* VALORE A COLLO
134910950220    4C     TPTFVM        IFEQ      '1'
134920991028     C     VIDNCL        MULT      TPTVLM        W0133A           13 3
134930950220   X4C                   ELSE
134940950220    5C     TPTFVM        IFEQ      '2'
134950991028     C                   Z-ADD     TPTVLM        W0133A
134960950220   X5C                   ELSE
134970940922     C     V2CPKG        ADD       0,9           W0060             6 0
134980991028     C     W0060         MULT      TPTVLM        W0133A
134990950220    5C                   END
135000950220    4C                   END
135010991028     C**
135020991028     C* TRASFORMO L'IMPORTO DA ASSICURARE NELLA DIVISA DELLA TARIFFA
135030011113     C                   Z-ADD     VIDIAS        IASTAR
135040991028    5C     COMDIV        IFNE      VIDVAS
135050991028     C                   CLEAR                   DSYEUR
135060991028     C                   MOVEL     VIDVAS        YECDVI
135070991028     C                   MOVEL     COMDIV        YECDVO
135080991028     C                   Z-ADD     VIDIAS        YECIMI
135090011113     C                   MOVE      COMDEC        YECDCO
135100991028     C*
135110991028     C                   CALL      'YEURCO'
135120991028     C                   PARM                    DSYEUR
135130991028     C*
135140991028    6C     YECESI        IFEQ      ' '
135150011113     C                   Z-ADD     YECIMO        IASTAR           17 3
135160991028    6C                   ENDIF
135170991028    5C                   ENDIF
135180940922     C*
135190011113    4C     IASTAR        IFGT      W0133A
135200950217     C     DIE           ANDNE     NUMFOR
135210940922     C                   ADD       1             DIE
135220940922     C                   MOVEL     ERR(97)       VIDMSG
135230941231     C                   SETON                                        8090
135240940922     C                   GOTO      ENDC02
135250950220    4C                   ENDIF
135260940922     C*
135270950215    3C                   ENDIF
135280960209   2AC                   ENDIF
135290960209    2C                   ENDIF
135300940922    1C                   ENDIF
135310940916     C*
135320011211      * pulisco il flag x la forzatura importo da assicurare forzabile
135330011211     C     VIDIAS        IFNE      WARIAS
135340011211     C                   CLEAR                   FORIAS
135350011211     C                   Z-ADD     VIDIAS        WARIAS
135360011211     C                   ENDIF
135370011211     C*
135380011211     C* CONTROLLO LIMITI IMPORTO DA ASSICURARE
135390011211     C     VIDIAS        IFGT      0
135400011211     C                   CLEAR                   DSUL22
135410011211     C                   MOVEL     VIDCBO        I22CBO
135420011211     C     VIDTSP        IFNE      *BLANKS
135430011211     C                   MOVEL     VIDTSP        I22TSP
135440011211     C                   ELSE
135450011211     C                   MOVEL     COMTSP        I22TSP
135460011211     C                   ENDIF
135470011212     C                   Z-ADD     VIDLNP        I22LPS
135480011211     C                   MOVEL     VIDNZM        I22NZM
135490011211     C                   Z-ADD     COMLNA        I22LNS
135500011211     C                   MOVEL     VIDNZD        I22NZD
135510011211     C     *IN04         IFEQ      *ON
135520011211     C                   Z-ADD     9999          I22KSC
135530011211     C                   MOVEL     VIDLNP        I22KSC
135540011211     C                   ELSE
135550011211     C                   Z-ADD     VIDCCM        I22KSC
135560011211     C     VIDFLC        IFEQ      0
135570011211     C                   MOVEL     VIDLNP        I22KSC
135580011211     C                   ELSE
135590011211     C                   MOVEL     VIDFLC        I22KSC
135600011211     C                   ENDIF
135610011211     C                   ENDIF
135620011211     C                   MOVEL     VIDCTR        I22CTR
135630011211     C                   Z-ADD     VIDIAS        I22IMP
135640011211     C                   MOVEL     VIDVAS        I22DIV
135650011211     C                   MOVEL     KNMUS         I22UTE
135660011211     C                   MOVEL     NOMPGM        I22PGM
135670011211     C                   CALL      'TRUL22R'
135680011211     C                   PARM                    DSUL22
135690011211     C* IMPORTO DA ASSICUARE NON AMMESSO
135700011211     C     O22FMN        IFNE      *BLANKS
135710011211     C     O22FX1        ANDNE     *BLANKS
135720011211     C     O22FX2        ANDNE     *BLANKS
135730011211     C                   MOVEL     ERR(234)      VIDMSG
135740011211     C                   SETON                                        8090
135750011211     C                   GOTO      ENDC02
135760011211     C                   ENDIF
135770011211     C* IMPORTO DA ASSICURARE > DEL LIMITE IMPOSTO
135780011211     C     O22FX2        IFNE      *BLANKS
135790011211     C                   MOVEA     ERR(96)       K78
135800011212     C                   MOVE      O22LX2        WNUMED
135810011212     C* richiamo routine per editare il limite
135820011212     C                   EXSR      CALLXE
135830011211      * metto il numero editato nel campo del messaggio
135840011211     C                   MOVEA     W014A         SKII(1)
135850011211     C                   MOVEA     SKII(1)       K78(38)
135860011211     C                   MOVEA     K78           VIDMSG
135870011211     C                   SETON                                        8090
135880011211     C                   GOTO      ENDC02
135890011211     C                   ENDIF
135900011211     C* IMPORTO DA ASSICURARE INFERIORE DEL LIMITE DI LEGGE
135910011211     C     O22FMN        IFNE      *BLANKS
135920011211     C                   MOVEA     ERR(165)      VIDMSG
135930011211     C                   SETON                                        8090
135940011211     C                   GOTO      ENDC02
135950011211     C                   ENDIF
135960011211     C* IMPORTO DA ASSICURARE > DEL LIMITE FORZABILE
135970011211     C     O22FX1        IFNE      *BLANKS
135980011211     C     FORIAS        ANDEQ     *BLANKS
135990011211     C                   MOVEL     '1'           FORIAS            1
136000011211     C                   MOVEA     ERR(235)      K78
136010011212     C                   MOVE      O22LX1        WNUMED
136020011212     C* richiamo routine per editare il limite
136030011212     C                   EXSR      CALLXE
136040011211      * metto il numero editato nel campo del messaggio
136050011211     C                   MOVEA     W014A         SKII(1)
136060011211     C                   MOVEA     SKII(1)       K78(28)
136070011211     C                   MOVEA     K78           VIDMSG
136080011211     C                   SETON                                        8090
136090011211     C                   GOTO      ENDC02
136100011211     C                   ENDIF
136110011211     C                   ENDIF
136120950102     C***
136130950102     C*** QUANTITA' DA FATTURARE  ***
136140950102     C                   MOVEL     VIDCTR        W001A
136150950102     C*
136160950103     C* SE MODIFICATA, PULISCO IL FLAG DI CONTROLLO
136170950102     C     VIDQFT        IFNE      VARQFT
136180950102     C                   CLEAR                   UND
136190950102     C                   MOVEL     VIDQFT        VARQFT
136200950102     C                   ENDIF
136210950102     C*
136220950103     C* CONTROLLO LA Q.TA DA FATTURARE CON TARIFFE SOLO SE C'E'
136230950103     C*  TARIFFA E SE E' FRANCO, PER ASSEGNATO E' DEL DESTINATARIO
136240950102    1C     WTKS          IFEQ      'S'
136250950102     C     W001A         ANDEQ     '4'
136260950103     C     *IN04         ANDEQ     *OFF
136270950102     C*
136280950102    2C     VIDQFT        IFEQ      0
136290950102     C*
136300950102     C* TAMFVD = '1' ASSUMO VALORE DA ASSICURARE SE NON IMMESSO
136310950103    3C     TAMFVD        IFEQ      '1'
136320950103     C     UND           ANDEQ     0
136330950102     C                   MOVEL     ERR(106)      VIDMSG
136340950102     C                   SETON                                        8490
136350950102     C                   MOVEL     1             UND
136360950102     C                   GOTO      ENDC02
136370950103    3C                   ENDIF
136380961007     C* TAMFVD = '2' O '4'  INSERIRE IN BOLLETTAZIONE
136390950103    3C     TAMFVD        IFEQ      '2'
136400961007     C     TAMFVD        OREQ      '4'
136410950102     C                   MOVEL     ERR(107)      VIDMSG
136420950102     C                   SETON                                        8490
136430950102     C                   GOTO      ENDC02
136440950103    3C                   ENDIF
136450950102     C*
136460950102   X2C                   ELSE
136470950102     C* TAMFVD = '3' ASSUME SEMPRE IMPORTO DA ASSICURARE: DA NON INSER
136480950102    3C     TAMFVD        IFEQ      '3'
136490950102     C                   MOVEL     ERR(108)      VIDMSG
136500950102     C                   SETON                                        8490
136510950102     C                   GOTO      ENDC02
136520950102    3C                   ENDIF
136530950102    2C                   ENDIF
136540950102    1C                   ENDIF
136550950102     c* TARIFFA A QUANTITA'
136560950102     C     W001A         IFEQ      '5'
136570950102     C     VIDQFT        ANDEQ     0
136580950102     C                   MOVEL     ERR(109)      VIDMSG
136590950102     C                   SETON                                        8490
136600950102     C                   GOTO      ENDC02
136610950102    3C                   ENDIF
136620940922     C***
136630940922     C*** VALORE MERCE DICHIARATO ***
136640940922     C*
136650011113     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
136660011113     C     VIDVMD        IFGT      *ZEROS
136670011113     C     VIDVAD        ANDEQ     *BLANKS
136680011113     C                   MOVEL     ERR(169)      VIDMSG
136690011113     C                   SETON                                        6990
136700011113     C                   GOTO      ENDC02
136710011113     C                   ENDIF
136720021118
136730021118      * Se Spedizione Export EuroExpress con ddt "S"
136740021118      *  ---> Obbligatorio il valore merce
136750021118     c                   If        SavGdd = 'S' and VidVmd = *Zeros
136760021118     c                             and a_§OgNtw = 'EEX'
136770021118     c                   Movel     Err(259)      VidMsg
136780021118     c                   Eval      *In82 = *On
136790021118     c                   Eval      *In90 = *On
136800021118     c                   Goto      Endc02
136810021118     c                   EndIf
136820011113     C*
136830940922     C                   MOVEL     VIDVAD        WVLT
136840940922     C                   Z-ADD     VIDVMD        W0133            13 3
136850940922     C* CONTROLLO LA DIVISA
136860940922     C                   EXSR      CTRVLT
136870940922     C                   MOVEL     WVLT          VIDVAD
136880940922     C* ERRORE
136890950410     C   90              SETON                                        69
136900940922     C*
136910940928    1C     WEMFOR        IFEQ      '1'
136920940922     C                   GOTO      ENDC02
136930940928    1C                   ENDIF
136940011113     C*
136950011113     C* CONTROLLO SCADENZA DIVISA
136960011113     C     BLPDSP        IFGT      §CVDLI
136970011113     C     VIDVMD        ANDNE     0
136980011113     C                   MOVEL     ERR(232)      VIDMSG
136990011113     C                   SETON                                        6990
137000011113     C                   GOTO      ENDC02
137010011113     C                   ENDIF
137020941219     C*
137030950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
137040941219     C* INDICATORE DI CHANGE 88 ON
137050941219    2C     VARVAD        IFNE      VIDVAD
137060950120     C     WIN88         ANDEQ     *BLANKS
137070011113     C     VIDVMD        ANDNE     0
137080941220     C                   MOVEL     ERR(105)      VIDMSG
137090941231     C                   SETON                                        8290
137100941219     C                   GOTO      ENDC02
137110941219     C                   ENDIF
137120941219     C*
137130941219     C                   MOVEL     VIDVAD        VARVAD
137140950120     C                   CLEAR                   WIN88
137150011212      * pulisco il flag x la forzatura valore merce
137160011212     C     VIDVMD        IFNE      WARVMD
137170011212     C                   CLEAR                   FORVMD
137180050714     c                   Clear                   forzavmd          1
137190011212     C                   Z-ADD     VIDVMD        WARVMD
137200011212     C                   ENDIF
137210011212     C* CONTROLLO LIMITI
137220011212     C                   CLEAR                   DSUL23
137230011212     C                   MOVEL     VIDCBO        I23CBO
137240011212     C     VIDTSP        IFNE      *BLANKS
137250011212     C                   MOVEL     VIDTSP        I23TSP
137260011212     C                   ELSE
137270011212     C                   MOVEL     COMTSP        I23TSP
137280011212     C                   ENDIF
137290011212     C                   Z-ADD     VIDLNP        I23LNP
137300011212     C                   MOVEL     VIDNZM        I23NZM
137310011212     C                   Z-ADD     COMLNA        I23LNA
137320011212     C                   MOVEL     VIDNZD        I23NZD
137330011212     C     *IN04         IFEQ      *ON
137340011212     C                   Z-ADD     9999          I23KSC
137350011212     C                   MOVEL     VIDLNP        I23KSC
137360011212     C                   ELSE
137370011212     C                   Z-ADD     VIDCCM        I23KSC
137380011212     C     VIDFLC        IFEQ      0
137390011212     C                   MOVEL     VIDLNP        I23KSC
137400011212     C                   ELSE
137410011212     C                   MOVEL     VIDFLC        I23KSC
137420011212     C                   ENDIF
137430011212     C                   ENDIF
137440011212     C                   MOVEL     VIDCTR        I23CTR
137450011212     C                   Z-ADD     VIDVMD        I23IMP
137460011212     C                   MOVEL     VIDVAD        I23DIV
137470011212     C                   MOVEL     KNMUS         I23UTE
137480011212     C                   MOVEL     NOMPGM        I23PGM
137490011212     C                   CALL      'TRUL23R'
137500011212     C                   PARM                    DSUL23
137510011212     C* IMPORTO INFERIORE AL LIMITE MINIMO
137520011212    1C     O23FMN        IFNE      *BLANKS
137530011212     C* Il messaggio è diverso a seconda che l'importo passato sia 0
137540011212     C* O > 0
137550011212    2C     VIDVMD        IFEQ      *ZEROS
137560011212     C                   MOVEL     ERR(238)      VIDMSG
137570011212   x2C                   ELSE
137580011212     C                   MOVEA     ERR(239)      K78
137590011212     C                   MOVE      O23LMN        WNUMED
137600011212     C* richiamo routine per editare il limite
137610011212     C                   EXSR      CALLXE
137620011212      * metto il numero editato nel campo del messaggio
137630011212     C                   MOVEA     W014A         SKII(1)
137640011212     C                   MOVEA     SKII(1)       K78(37)
137650011212     C                   MOVEA     K78           VIDMSG
137660011212    2C                   ENDIF
137670011212     C                   SETON                                        8290
137680011212     C                   GOTO      ENDC02
137690011212    1C                   ENDIF
137700011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO BLOCCANTE
137710011212     C     O23FX2        IFNE      *BLANKS
137720011212     C                   MOVEA     ERR(240)      K78
137730011212     C                   MOVE      O23LX2        WNUMED
137740011212     C* richiamo routine per editare il limite
137750011212     C                   EXSR      CALLXE
137760011212      * metto il numero editato nel campo del messaggio
137770011212     C                   MOVEA     W014A         SKII(1)
137780011212     C                   MOVEA     SKII(1)       K78(53)
137790011212     C                   MOVEA     K78           VIDMSG
137800011212     C                   SETON                                        8290
137810011212     C                   GOTO      ENDC02
137820011212     C                   ENDIF
137830011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO FORZABILE
137840011212     C     O23FX1        IFNE      *BLANKS
137850011212     C     FORVMD        ANDEQ     *BLANKS
137860011212     C                   MOVE      '1'           FORVMD            1
137870011212     C                   MOVEA     ERR(241)      K78
137880011212     C                   MOVE      O23LX1        WNUMED
137890011212     C* richiamo routine per editare il limite
137900011212     C                   EXSR      CALLXE
137910011212      * metto il numero editato nel campo del messaggio
137920011212     C                   MOVEA     W014A         SKII(1)
137930011212     C                   MOVEA     SKII(1)       K78(30)
137940011212     C                   MOVEA     K78           VIDMSG
137950011212     C                   SETON                                        8290
137960011212     C                   GOTO      ENDC02
137970011212     C                   ENDIF
137980950410     C* SE IMP ASSICURARE E VAL MERCE HANNO STESSO IMPORTO--> DEVONO
137990950410     C*  AVERE  ANCHE STESSA DIVISA E VICEVERSA
138000050714      * msg forzabile
138010950410    1C     VIDVMD        IFGT      0
138020950410     C*
138030950410     C     VIDIAS        IFEQ      VIDVMD
138040950410     C     VIDVAD        ANDNE     VIDVAS
138050050714     c     forzavmd      andeq     *Blanks
138060050714     c                   Eval      vidmsg = ERR(122)
138070950410     C                   SETON                                        6990
138080050714     c                   Eval      forzavmd = '1'
138090950410     C                   GOTO      ENDC02
138100950410    2C                   ENDIF
138110950410     C     VIDVAD        IFEQ      VIDVAS
138120950410     C     VIDIAS        ANDGT     0
138130950410     C     VIDIAS        ANDNE     VIDVMD
138140050714     c     forzavmd      andeq     *Blanks
138150050714     c                   Eval      vidmsg = ERR(122)
138160950410     C                   SETON                                        8290
138170050714     c                   Eval      forzavmd = '1'
138180950410     C                   GOTO      ENDC02
138190950410    2C                   ENDIF
138200950410     C*
138210950410    1C                   ENDIF
138220940913     C***
138230930329     C*** CONSEGNA RICHISTA ***
138240090901     c*  non accetto la consegna richiesta se tipo servizio H
138250100223     c                   if        (viddcr>0 or vidhcr>0) and vidtsp='H'
138260090901     C                   MOVEL     ERR(60)       VIDMSG
138270090901     C                   SETON                                        5990
138280090901     c                   goto      endc02
138290090901     c                   endif
138300090901     c
138310941115     C                   Z-ADD     VIDDCR        WDCR
138320941115     C                   Z-ADD     VIDHCR        WHCR
138330941115     C                   Z-ADD     VIDMCR        WMCR
138340940913     C                   MOVEL     VIDTCR        WTCR
138350940913     C                   EXSR      CTRCR
138360940916     C                   MOVEL     WDCR          VIDDCR
138370940920     C   90              GOTO      ENDC02
138380101022     c
138390101022     c* Controllo se cade in giorno festivo col calendario arrivi
138400101022    1c                   if        vidtcr=' '  and viddcr>0
138410101022     c                   movel     comdcr        wdata
138420101022     c                   clear                   w0030
138430101022     C     KCLNa         CHAIN     AZCLN01L                           30
138440101022     C   30              CLEAR                   CLNPOM
138450101022     C                   MOVEA     CLNPOM        K31
138460101022     C                   MOVEL     K31(WGG)      WFEST
138470101022     c     wfest         lookup    S1Y                                    30
138480101022     c
138490101022     c                   if        *in30 and wfest<>' '
138500101022     C                   MOVEL     ERR(197)      VIDMSG
138510101022     C                   SETON                                        5990
138520101022     C                   GOTO      ENDC02
138530101022    2C                   ENDIF
138540101022    1C                   ENDIF
138550940916     C***
138560960319     C*** GIORNI DI CHIUSURA ***
138570960319     C                   MOVEL     VIDGC1        WGC1
138580960319     C                   MOVEL     VIDGC2        WGC2
138590960319     C                   EXSR      CTRGCH
138600960319     C   90              GOTO      ENDC02
138610940214     C*
138620100219     c
138630940919     C***
138640940919     C*** PARTICOLARITA' C/A ***
138650940919    1C     VIDGCA        IFNE      *BLANKS
138660941005     C     VIDGCR        ORNE      *BLANKS
138670031029      * salto questo controllo
138680031029      * xchè per ora la particolarità c/a non deve essere gestita
138690031029     c                   GoTo      DopoMsg
138700940922     C*
138710940922     C* non posso indicarla se tipo bolla non prevede C/Assegno
138720940928    2C     §3AFCA        IFEQ      0
138730941005     C     VIDGCA        ANDNE     *BLANKS
138740940922     C                   SETON                                        6590
138750940922     C                   MOVEL     ERR(103)      VIDMSG
138760940922     C                   GOTO      ENDC02
138770940922    2C                   ENDIF
138780031029     c     DopoMsg       Tag
138790940922     C*
138800941005     C* RICHIAMO IL PRG DI RICERCA
138810941005    2C     VIDGCR        IFEQ      '?'
138820031029      * non devo fare nessuna ricerca xchè per ora la particolarità c/a non
138830031029      * deve essere gestita
138840031029     c                   GoTo      DopoRicGca
138850941005     C                   CLEAR                   DS7PQR
138860941005     C                   MOVEL     'S'           DS7RIC
138870941005     C                   MOVEL     'V'           DS7GES
138880941005     C                   MOVEL     WKSC          DS7KSC
138890941005     C                   MOVEL     VIDGCA        DS7COD
138900941005     C                   MOVEL     DS7PQR        KPJBU
138910941005     C                   CALL      'TRTB72R'
138920941005     C                   PARM                    KPJBA
138930941005     C                   MOVEL     KPJBU         DS7PQR
138940111110     C***                CLEAR                   VIDGCR
138950941005     C*
138960941005     C     VIDGCA        IFEQ      *BLANKS
138970941005     C                   MOVEL     DS7COD        VIDGCA
138980941005    2C                   ENDIF
138990941005     C*
139000111110     c     DopoRicGca    Tag
139010111110     C                   CLEAR                   VIDGCR
139020960109     C                   SETON                                        65
139030941005     C                   MOVEL     '1'           WEMFOR
139040111110     c***  DopoRicGca    Tag
139050941005     C                   GOTO      ENDC02
139060941005    2C                   ENDIF
139070941005     C* CONTROLLO
139080031029      * non devo fare nessun controllo xchè per ora la particolarità c/a non
139090031029      * deve essere gestita
139100031029      * ma se immessa emetto un errore
139110031029     c                   Eval      VidMsg = Err(31)
139120031029     c                   Eval      *In65 = *On
139130031029     c                   Eval      *In90 = *On
139140031029     c                   Goto      EndC02
139150031029
139160941005     C                   CLEAR                   DS7PQR
139170941005     C                   MOVEL     'S'           DS7RIC
139180941005     C                   MOVEL     'C'           DS7GES
139190941005     C                   MOVEL     WKSC          DS7KSC
139200941005     C                   MOVEL     VIDGCA        DS7COD
139210941005     C                   MOVEL     DS7PQR        KPJBU
139220941005     C                   CALL      'TRTB72R'
139230941005     C                   PARM                    KPJBA
139240941005     C                   MOVEL     KPJBU         DS7PQR
139250941005     C* ERRORE
139260941005    2C     DS7ERR        IFEQ      '1'
139270941005     C                   MOVEL     DS7MSG        VIDMSG
139280941005     C                   SETON                                        6590
139290940920     C                   GOTO      ENDC02
139300940919    2C                   ENDIF
139310940922     C*
139320940922    1C                   ENDIF
139330940919     C***
139340940919     C*** PARTICOLARITA' GIACENZA ***
139350940919    1C     VIDGGA        IFNE      *BLANKS
139360941005     C     VIDGGR        ORNE      *BLANKS
139370941005     C*
139380941005     C* RICHIAMO IL PRG DI RICERCA
139390951120    2C     VIDGGR        IFEQ      '?'
139400941005     C                   CLEAR                   DS7PQR
139410941005     C                   MOVEL     'S'           DS7RIC
139420941005     C                   MOVEL     'V'           DS7GES
139430941005     C                   MOVEL     VIDGGA        DS7COD
139440941005     C                   MOVEL     DS7PQR        KPJBU
139450941005     C                   CALL      'TRTB69R'
139460941005     C                   PARM                    KPJBA
139470941005     C                   MOVEL     KPJBU         DS7PQR
139480960109     C                   CLEAR                   VIDGGR
139490941005     C*
139500941005     C     VIDGGA        IFEQ      *BLANKS
139510941005     C                   MOVEL     DS7COD        VIDGGA
139520941005    2C                   ENDIF
139530941005     C*
139540960109     C                   SETON                                        66
139550941005     C                   MOVEL     '1'           WEMFOR
139560941005     C                   GOTO      ENDC02
139570941005    2C                   ENDIF
139580941005     C* CONTROLLO
139590941005     C                   CLEAR                   DS7PQR
139600941005     C                   MOVEL     'S'           DS7RIC
139610941005     C                   MOVEL     'C'           DS7GES
139620941005     C                   MOVEL     WKSC          DS7KSC
139630941005     C                   MOVEL     VIDGGA        DS7COD
139640941005     C                   MOVEL     DS7PQR        KPJBU
139650941005     C                   CALL      'TRTB69R'
139660941005     C                   PARM                    KPJBA
139670941005     C                   MOVEL     KPJBU         DS7PQR
139680941005     C* ERRORE
139690941005    2C     DS7ERR        IFEQ      '1'
139700941005     C                   MOVEL     DS7MSG        VIDMSG
139710941005     C                   SETON                                        6690
139720940920     C                   GOTO      ENDC02
139730940919    2C                   ENDIF
139740940919    1C                   ENDIF
139750940919     C***
139760940919     C*** PARTICOLARITA' CONSEGNA ***
139770100218     c                   clear                   ds7r
139780940922    1C     VIDGMA        IFNE      *BLANKS
139790951120     C     VIDGMR        ORNE      *BLANKS
139800941005     C* RICHIAMO IL PRG DI RICERCA
139810941005    2C     VIDGMR        IFEQ      '?'
139820941005     C                   CLEAR                   DS7PQR
139830941005     C                   MOVEL     'S'           DS7RIC
139840941005     C                   MOVEL     'V'           DS7GES
139850941005     C                   MOVEL     VIDGMA        DS7COD
139860941005     C                   MOVEL     DS7PQR        KPJBU
139870941005     C                   CALL      'TRTB70R'
139880941005     C                   PARM                    KPJBA
139890941005     C                   MOVEL     KPJBU         DS7PQR
139900960109     C                   CLEAR                   VIDGMR
139910941005     C*
139920941005     C     VIDGMA        IFEQ      *BLANKS
139930941005     C                   MOVEL     DS7COD        VIDGMA
139940941005    2C                   ENDIF
139950941005     C*
139960960109     C                   SETON                                        67
139970941005     C                   MOVEL     '1'           WEMFOR
139980941005     C                   GOTO      ENDC02
139990941005    2C                   ENDIF
140000941005     C* CONTROLLO
140010941005     C                   CLEAR                   DS7PQR
140020941005     C                   MOVEL     'S'           DS7RIC
140030941005     C                   MOVEL     'C'           DS7GES
140040941005     C                   MOVEL     WKSC          DS7KSC
140050941005     C                   MOVEL     VIDGMA        DS7COD
140060941005     C                   MOVEL     DS7PQR        KPJBU
140070941005     C                   CALL      'TRTB70R'
140080941005     C                   PARM                    KPJBA
140090941005     C                   MOVEL     KPJBU         DS7PQR
140100941005     C* ERRORE
140110941005    2C     DS7ERR        IFEQ      '1'
140120100215     C                   MOVEL     DS7MSG        VIDMSG
140130941005     C                   SETON                                        6790
140140940920     C                   GOTO      ENDC02
140150940919    2C                   ENDIF
140160100215     c*
140170100215     c* Da tabella 7R verifico se prevede il calcolo della consegna
140180100215     c*  richeista (Tab DCR) e segnalo eventuali incongruenze
140190100215     C                   MOVEL     '7R'          COD
140200100215     C                   MOVEL(P)  VIDGMA        KEY
140210100215     C                   EXSR      CTABEL
140220100215     C                   MOVEL     TBLUNI        DS7R
140230100215     c
140240100215     c                   if        §7ratt ='S' and
140250100215     c                             (vidtsp='H' or vidtsp='E')
140260100215     C                   MOVEL     err(332)      VIDMSG
140270100215     C                   SETON                                        6790
140280100215     C                   GOTO      ENDC02
140290100215    2C                   ENDIF
140300100218     c
140310100224    1c                   if        §7ratt ='S' and
140320100217     c                             (vidore>0 or viddcr>0 )
140330100218     c* In manutenzione non do errore se la particolarità c'era
140340100218     c*  anche prima
140350100224     c* Se richiamato da pgm di cambio porto dirottamento non do errore
140360100224     c                   if        not *in44 and (not *in12 or *in15 or
140370100224     c                              blpgma<>vidgma)
140380100215     C                   MOVEL     err(333)      VIDMSG
140390100215     C                   SETON                                        6790
140400100215     C                   GOTO      ENDC02
140410100215    2C                   ENDIF
140420100224    1C                   ENDIF
140430100218     c
140440100224     c                   if        §7ratt ='S' and (§3arbl='R' or
140450100224     c                             §3arbl='C' and §3aucb=' ')
140460100217     C                   MOVEL     err(334)      VIDMSG
140470100217     C                   SETON                                        6790
140480100217     C                   GOTO      ENDC02
140490100217    2C                   ENDIF
140500100215     c
140510030805      * Se la bolla prevede la particolarità consegne 'RC' devo controllare
140520030805      * che esista l'ORM da utilizzare per il ritiro contestuale alla consegna
140530030912      * solo se non sono chiamata da giacenze
140540100604If  2c**                 If        VidGma = 'RC' and
140550100604If  2c                   If        §7rRC = 'S'   and
140560030912If  2c                             savfpr <> 'G' and savfpr <> 'P'
140570031217     c                   Eval      wope = 'C'
140580030805     c                   ExSr      Sr_RicOrm
140590030805If  3c                   If        *In90 = *On
140600030805     c                   GoTo      EndC02
140610030805    3c                   EndIf
140620030805    2c                   EndIf
140630940919    1C                   ENDIF
140640100219     c
140650100219     C* DATA CONSEGNA NON PUO' ESSERE < DATA CONSEGNA TEORICA
140660100219     C* SE TIPO CONSEGNA E' ' ' O 'P' (IL O PRIMA DEL)
140670100219     C* (QUESTO CONTROLLO LO METTO DOPO I GIORNI CHIUSURA e dopo la partic.
140680100219     C*  consegna perchè mi SERVONO E CORRETTI)
140690100219     c* data consegna non puo' essere > data consegna teorica più i gio
140700100219     c* rni di tolleranza oltre delivery come da tabella vpo
140710100219    1C     VIDDCR        IFGT      0
140720100219     C* CALL AL TNSD99
140730100219     c                   clear                   UsaCass
140740100219     C                   EXSR      CLSE98
140750100219     c                   z-add     d98dce        s_d98dce
140760100219   1aC     VIDTCR        ifne      'D'
140770100219     C*
140780100219    2C     COMDCR        IFLT      D98DCE
140790100219     c* se tipo servizio "Distribuzione" richiamo nuovamente TNSD99R passand
140800100219     c* ogli tipo servizio corriere. Infatti se la data consegna richiesta
140810100219     c* è inferiore anche della data teorica per il servizio corriere l'erro
140820100219     c* re è bloccante altrimenti è forzabile
140830100219    3c                   if        d98tsp = 'D'
140840100219     c                   eval      d98tsp = 'C'
140850100219     C                   CALL      'TNSD99R'
140860100219     C                   PARM                    DSSD99
140870100219    4c     comdcr        ifge      d98dce
140880100219    5c     uno           ifne      '1'
140890100219     C                   MOVEL     ERR(62)       VIDMSG
140900100219     C                   seTON                                        5990
140910100219     C                   MOVEL     '1'           UNO
140920100219     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
140930100219     C                   GOTO      ENDC02
140940100219    5c                   endif
140950100219   x4c                   else
140960100219     C                   MOVEL     ERR(62)       VIDMSG
140970100219     C                   SETON                                        5990
140980100219     c                   goto      endc02
140990100219    4c                   endif
141000100219   x3c                   else
141010100219     C                   MOVEL     ERR(62)       VIDMSG
141020100219     C                   SETON                                        5990
141030100219     C                   GOTO      ENDC02
141040100219    3c                   endif
141050100219    2C                   ENDIF
141060100219   1aC                   ENDIF
141070100219     c** Aggiungo alla data consegna teorica i giorni previsti in tabella
141080100219      *  escludendo i festivi
141090100219      *  questo messaggio non lo do per particolarità di ATTESA
141100100219    2c                   if        vidgma= *blanks  or  §7rATT=' '
141110100219     c                   Clear                   Trul13ds
141120100219     c                   Eval      tI13Tla = 'L'
141130100219     c                   Eval      I13Mod = 'A'
141140100219     c                   Eval      I13Fil = comlna
141150100219     c                   Eval      I13Din = S_d98dce
141160100219     c                   Eval      I13gio = §vpodcrod
141170100219     c                   Call      'TRUL13R'
141180100219     c                   Parm                    Trul13ds
141190100219    3c                   If        tO13Err = *Blanks  and
141200100219     c                             comdcr > o13dfi and fordcr = *blanks
141210100219     c                   eval      vidmsg = err(294)
141220100219     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
141230100219     c                             %trim(%editc(§vpodcrod:'Z'))  +
141240100219     c                             ' giorni la data consegna teorica.' +
141250100219     c                             'ENTER x FORZ.'
141260100219     C                   SETON                                        5990
141270100219     c                   movel     '1'           fordcr
141280100219     C                   GOTO      ENDC02
141290100219    3c                   endif
141300100219    2C                   ENDIF
141310100219    1C                   ENDIF
141320100219     c
141330050415     c* Se particolarita varia = 'O' il controllo seguente l'ho già
141340050415     c* fatto prima del calcolo del volume automatico
141350050415     c                   if        %subst(vidgva:1:1)<>'O'
141360050415     c                   exsr      sr_CntPVBan
141370050415     c     wemfor        ifeq      '1'
141380050415     c                   goto      endc02
141390050415     c                   endif
141400050415     c                   endif
141410040216
141420040216      * --> Telefono del destinatario
141430040216      *     (da immettere in prima videata)
141440040216      * x Spedizione con Appuntamento
141450040216      * x Spedizione con consegna a PRIVATI
141460040216if  1c                   If        VidTel = *Blanks and wforza1 = *Off and
141470040216     c                             wforza2 = *Off
141480040216s   2c                   Select
141490040216     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
141500040216     c                   Eval      VidMsg = Err(267)
141510040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
141520040216     c                   Eval      *In90 = *On
141530040216     c                   When      %subst(VidGva:1:1) = 'P'
141540040216     c                   Eval      VidMsg = Err(58)
141550040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
141560040216     c                   Eval      *In90 = *On
141570040216    2c                   EndSl
141580040216if  2c                   If        *In90
141590040216     c                   Eval      wforza2 = *On
141600040216     c                   GoTo      EndC02
141610040216    2c                   EndIf
141620040216    1c                   EndIf
141630040610     C***
141640040610     C*** Tipo MERCE V-Valore ***
141650040610    1C     VIDbva        ifne      *BLANKS
141660040610     c     §1bfg8        andne     'S'
141670040610     C                   MOVEL     ERR(281)      VIDMSG
141680040610     C                   SETON                                        90
141690040610     c                   z-add     20            H2riga
141700040610     c                   z-add     80            H2colo
141710040610     C                   GOTO      ENDC02
141720040610    1C                   END
141730940919     C***
141740050309     c*
141750050309     c* Essendosi verificato un caso di bolla immessa senza il cod boll
141760050309     c* per sicurezza aggiungo il seguente controllo
141770050309     c     vidcbo        ifeq      *blanks
141780050309     C                   MOVEL     ERR(292)      VIDMSG
141790050309     C                   SETON                                        90
141800050309     C                   GOTO      ENDC02
141810050309     c                   endif
141820940919     C*** FINE SUBROUTINE
141830940920     C     ENDC02        TAG
141840940826     C   90              MOVEL     '1'           WEMFOR
141850941021     C*
141860940826     C                   ENDSR
141870091211     C* Richiamo trulticr per controllo tipo incasso c/a e divisa  ---*
141880091211     c     sr_trultic    begsr
141890091211     c                   clear                   trulticds
141900091211     c                   clear                   ds1a
141910091211     c                   eval      iticTBO='P'
141920091211     c                   eval      iticlnp=vidlnp
141930091211     c                   eval      iticlna=comlna
141940091211     c                   eval      iticlnantw=A_§ogntw
141950091211     c                   eval      iticnzd=vidnzd
141960091211     c                   eval      iticprd=vidprd
141970091211     c                   eval      iticcad=vidcad
141980091211     c                   eval      iticlod=vidlod
141990091211     c                   eval      iticind=vidind
142000091211     c                   eval      iticrsd=vidrsd
142010091211     c                   eval      iticdsp=blpdsp
142020091211     c* se orm con triangolazione e beneficiario ordinante-->passo ordinante
142030091211     c* altrimenti sempre il mittente
142040091211     c                   if        nochkticC=*on and wcassel2='X'
142050091211     C                   eval      iticccm=ormksc
142060091211     c                   else
142070091211     C                   eval      iticccm=wksc
142080091211     c                   endif
142090091211
142100091211     c                   eval      itictic=vidtic
142110091211     c                   eval      iticdiv=vidvca
142120091211     c                   eval      iticcas=vidcas
142130091211     c                   eval      iticpgm='FNLS01R'
142140091211     c* 44 on = richiamato da pgm giacenze --> devo passare
142150091211     c*         l'info a trultic per far si che venga bypassato il
142160091211     c*         controllo su tabella "TM"
142170091211    2c                   if        *in44
142180091211     c                   eval      %subst(iticpgm:10:1)='1'
142190091211    2c                   endif
142200091211     c                   call      'TRULTICR'
142210091211     c                   parm                    TRULTICDS
142220091211     c                   parm                    ds1a
142230091211     c*
142240091211     c                   endsr
142250091211     c*
142260091211     C* Impostazinoe flag per controllo tic --------------------------*
142270091211     C     sr_impochktic BEGSR
142280091211     C*
142290091214     c                   eval      nochkticC=*off
142300091211     c                   if        dateu>=§vpocas
142310091211     c                   if        §3afca<>0 and flgfit<>'S' and ormpag='O'
142320091211     c                             and §1amro<>'S'
142330091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
142340091211     c                                 %editc(ormksc:'X')
142350091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
142360091211     c                                 %subst(%editc(ormcor:'X'):1:7)
142370091211     c                   eval      nochkticC=*on
142380091211     c                   endif
142390091211     c                   endif
142400091211     c                   endsr
142410940922     C*
142420940922     C* CONTROLLO DIVISA ---------------------------------------------*
142430940922     C     CTRVLT        BEGSR
142440940922     C*
142450940922     C                   MOVEL     'CV'          COD
142460940922     C* RICERCA
142470940922     C     '?'           SCAN      WVLT                                   30
142480940922     C     *IN30         IFEQ      *ON
142490940922     C                   EXSR      CX§TAB
142500940922     C                   MOVEL     §KEY          WVLT
142510940922     C                   GOTO      ENDVLT
142520940922     C                   ENDIF
142530940922     C*
142540940922     C* CONTROLLO DIVISA
142550940922     C                   MOVEL(P)  WVLT          KEY
142560940922     C                   EXSR      CTABEL
142570940922     C* ERRORE
142580940922    1C     *IN30         IFEQ      *ON
142590941110     C                   MOVEL     ERR(79)       VIDMSG
142600940922     C                   SETON                                        90
142610940922     C                   GOTO      ENDVLT
142620940922    1C                   ENDIF
142630940922     C                   MOVEL     TBLUNI        DSCV
142640940922     C*
142650940922     C* VEDO SE AMMESSI IMPORTI DECIMALI NELL'IMPORTO
142660940922    1C     §CVFDC        IFNE      'S'
142670940922     C                   MOVE      W0133         W0033             3 3
142680940922    2C     W0033         IFNE      0
142690941110     C                   MOVEL     ERR(78)       VIDMSG
142700940922    2C                   ENDIF
142710991025      *
142720991025   X1C                   ELSE
142730991025      * VERIFICO SE I DECIMALI INSERITI SONO QUELLLI AMMESSI
142740991025     C                   SELECT
142750991025     C     §CVDEC        WHENEQ    3
142760991025     C     §CVDEC        WHENEQ    2
142770991025     C                   MOVE      W0133         W0010             1 0
142780991025     C     W0010         IFNE      *ZEROS
142790991025     C                   MOVEL     ERR(171)      VIDMSG
142800991025     C                   ENDIF
142810991025     C     §CVDEC        WHENEQ    1
142820991025     C                   MOVE      W0133         W0020             2 0
142830991025     C     W0020         IFNE      *ZEROS
142840991025     C                   MOVEL     ERR(171)      VIDMSG
142850991025     C                   ENDIF
142860991025     C     §CVDEC        WHENEQ    0
142870991025     C                   ENDSL
142880991025      *
142890991025    1C                   ENDIF
142900991025      *
142910991025     C     VIDMSG        IFNE      *BLANKS
142920991025     C                   SETON                                        90
142930991025     C                   GOTO      ENDVLT
142940991025     C                   ENDIF
142950940922     C*
142960940922     C     ENDVLT        TAG
142970940922     C   90              MOVEL     '1'           WEMFOR
142980940922     C                   ENDSR
142990940916     C*
143000940916     C* PREPARA IL MESSAGGIO DI SEGNACOLLO DOPPIO -------------------*
143010940916     C     PRPMSG        BEGSR
143020940916     C* MUOVO LA SKIERA DELL ERRORE
143030940916     C                   MOVEA     ERR(92)       K78
143040940916     C*
143050940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL SEGNACOLLO
143060940916     C                   MOVEL     COMSCD        W007A             7
143070950718     C                   MOVEA     W007A         SKI(9)
143080950718     C                   Z-ADD     9             I                 3 0
143090950718     C                   EXSR      ABBL
143100940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
143110950718     C                   MOVEA     SKI(9)        K78(19)
143120940916     C* IMPOSTO L'ANNO
143130120828     C                   MOVE      BLTAAS        W004A             4
143140120828     C***                MOVE      ARTAAS        W004A             4
143150940916     C                   MOVEA     W004A         K78(52)
143160940916     C* LINEA DI PARTENZA
143170120828     C                   MOVEL     BLTLNP        W003A             3
143180120828     C***                MOVEL     ARTLNP        W003A             3
143190940916     C                   MOVEA     W003A         K78(57)
143200940916     C* SERIE
143210120828     C     BLTNRS        IFEQ      00
143220120828     C***  ARTNRS        IFEQ      00
143230940916     C                   MOVEA     '  '          K78(61)
143240940916     C                   ELSE
143250120828     C                   MOVEL     BLTNRS        W002A             2
143260120828     C***                MOVEL     ARTNRS        W002A             2
143270940916     C                   MOVEA     W002A         K78(61)
143280940916     C                   ENDIF
143290940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL NUM.SPEDIZIONE
143300120828     C                   MOVEL     BLTNSP        W007A
143310120828     C***                MOVEL     ARTNSP        W007A
143320950718     C                   MOVEA     W007A         SKI(9)
143330950718     C                   Z-ADD     9             I
143340950718     C                   EXSR      ABBL
143350940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
143360950718     C                   MOVEA     SKI(9)        K78(64)
143370940916     C* LINEA DI ARRIVO
143380120828     C                   MOVEL     BLTLNA        W003A             3
143390120828     C***                MOVEL     ARTLNA        W003A             3
143400940916     C                   MOVEA     W003A         K78(76)
143410940916     C*
143420940916     C* MUOVO LA SKIERA NEL MESSAGGIO
143430940916     C                   MOVEA     K78           VIDMSG
143440940922     C                   SETON                                        45
143450940916     C                   ENDSR
143460960318     C*
143470960318     C* CONTROLLO SE SPEDIZIONE CON COLLI > DEL PREVISTO-------------*
143480960318     C     CTRCRG        BEGSR
143490960318    1C     VIDNCL        IFGT      §3INCL
143500030704      * Se devo bancalare i colli emetto la finestra
143510030704     c                   Clear                   w03rig1
143520030704     c                   Clear                   w03rig2
143530030704     c                   Eval      w03rig1 =
143540030704     c                                      'Attenzione numero colli +
143550030704     c                                       superiore a'
143560030704     c                   Eval      w03rig1 =
143570030704     c                                      %trim(w03rig1) + ' ' +
143580030704     c                                      %trim(%editc(§3iNcl:'4'))
143590030704     c                   Eval      w03rig2 =
143600030704     c                                      'Bancalare i colli prima di +
143610030704     c                                       bollettare'
143620030704     c                   Eval      At3c01 = nodi
143630030704     c                   Eval      At3cor = ndpr
143640030704     c                   Eval      At3c02 = nodi
143650030704     c                   Eval      At3csf = ndpr
143660030704     c                   Eval      At3f12 = nodi
143670030704     c                   Do        *Hival
143680030704     c                   Exfmt     Ls01w03
143690030704     c                   Eval      *In41 = *On
143700030704     c                   Eval      wforw03 = '1'
143710030704     c   kf              Leave
143720030704     c                   EndDo
143730030704
143740960318    1C                   ENDIF
143750960318     C                   ENDSR
143760030704      *---------------------------------------------------------------*
143770030704      * Emetto window x colli originali + controlli
143780030704      *---------------------------------------------------------------*
143790030704     c     Sr_Over25     BegSr
143800030704
143810030704     c                   Clear                   w03rig1
143820030704     c                   Clear                   w03rig2
143830030704     c                   Eval      w03rig1 =
143840030704     c                             'Spedizione con colli bancalati'
143850030704     c                   If        *In12 and Not *In15
143860030704     c                   Eval      w03rig2 =
143870030704     c                             'Immettere i seguenti dati:'
143880030704     c                   EndIf
143890030704     c                   Clear                   At3c01
143900030704     c                   Clear                   At3cor
143910030704     c                   Clear                   At3c02
143920030704     c                   Clear                   At3csf
143930030704     c                   Clear                   At3f12
143940030708     c                   Clear                   H3riga
143950030708     c                   Clear                   H3colo
143960030718      * Salvo i comandi F8 e F9
143970030718     c                   Eval      savinkh = *Inkh
143980030718     c                   Eval      savinki = *Inki
143990030708      * Controllo il totale dei colli
144000030708     c                   If        wtotncl > *Zeros
144010030708      * deve essere uguale ai bancali + sfusi
144020030708     c                   If        wtotncl <> vidncl
144030030707     c                   Eval      At3csf = rimm
144040030707     c                   z-add     04            H3riga
144050030707     c                   z-add     37            H3colo
144060030707     c                   Eval      w03msg =
144070030708     c                             'sfusi+bancali diversi da colli bolla'
144080030707     c                   Eval      *In90 = *On
144090030708     c                   EndIf
144100040128      *  NON deve essere superiore ai colli originali
144110040128     c                   If        wtotncl > w03cor and Not *In90
144120030708     c                   Eval      At3cor = rimm
144130030708     c                   z-add     04            H3riga
144140030708     c                   z-add     18            H3colo
144150030708     c                   Eval      w03msg =
144160030708     c                             'Colli originali minori di sfusi+bancali'
144170030708     c                   Eval      *In90 = *On
144180030708     c                   EndIf
144190030707     c                   EndIf
144200030704
144210030704     c                   Do        *Hival
144220030704     c                   Exfmt     Ls01w03
144230030704
144240030707     c                   Eval      *In90 = *Off
144250030704     c                   Clear                   w03msg
144260030704     c                   Clear                   At3c01
144270030704     c                   Clear                   At3cor
144280030704     c                   Clear                   At3c02
144290030704     c                   Clear                   At3csf
144300030704     c                   Clear                   At3f12
144310030704     c                   Clear                   H3riga
144320030704     c                   Clear                   H3colo
144330030704
144340030708      * F12 Ritorno
144350030708     c                   If        *Inkl
144360030708     c                   Eval      w03cor = savw03cor
144370030708     c                   Eval      w03csf = savw03csf
144380030708     c                   If        w03csf = *Zeros
144390030708     c                   Clear                   wtotncl
144400030708     c                   Else
144410030708     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
144420030708     c                   EndIf
144430030718     c                   Movel     '1'           WEMFOR
144440030708     c                   Leave
144450030708     c                   EndIf
144460030708      * colli originali obbligatori
144470030704     c                   If        w03Cor = *zeros
144480030704     c                   Eval      At3cor = rimm
144490030704     c                   z-add     04            H3riga
144500030707     c                   z-add     18            H3colo
144510030704     c                   Eval      w03msg = 'Immettere i colli originali'
144520030704     c                   Eval      *In90 = *On
144530030704     c                   Iter
144540030704     c                   EndIf
144550030707
144560030707     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
144570040129      * il totale dei colli NON deve essere superiore ai colli originali
144580040129     c                   If        wtotncl > w03cor
144590030708     c                   Eval      At3cor = rimm
144600030708     c                   z-add     04            H3riga
144610030708     c                   z-add     18            H3colo
144620030708     c                   Eval      w03msg =
144630030708     c                             'Colli originali minori di sfusi+bancali'
144640030708     c                   Eval      *In90 = *On
144650030708     c                   Iter
144660030708     c                   EndIf
144670030708      * il totale dei colli deve essere uguali ai bancali + sfusi
144680030707     c                   If        wtotncl <> vidncl
144690030707     c                   Eval      At3csf = rimm
144700030707     c                   z-add     04            H3riga
144710030707     c                   z-add     37            H3colo
144720030707     c                   Eval      w03msg =
144730030708     c                             'sfusi+bancali diversi da colli bolla'
144740030707     c                   Eval      *In90 = *On
144750030707     c                   Iter
144760030707     c                   EndIf
144770030704
144780030704     c   kf              Leave
144790030704
144800030704     c                   EndDo
144810030718      * Ripristino i comandi F8 e F9
144820030718     c                   Eval      *Inkh = savinkh
144830030718     c                   Eval      *InKi = savinki
144840030704
144850030704     c                   EndSr
144860030805      *---------------------------------------------------------------*
144870030805      * Ricerco l'orm x fare il ritiro contestuale alla consegna
144880030805      *---------------------------------------------------------------*
144890030805     c     Sr_RicOrm     BegSr
144900030805
144910091006      * Preparo la ds x il richiamo a FNLS28R
144920091006      * Solo se richiamato FNLS28R x i controlli
144930031217if  1c                   If        wope = 'C'
144940091006     c                   Clear                   Fnls28ds
144950091006     c                   Eval      I28Ope = wope
144960091006     c                   Eval      I28ccm = wksc
144970080407     c                   if        *in12
144980091006     c                   Move      §lpaac        I28Aas
144990080407     c                   endif
145000120326      * passo sempre la lnp del video in quanto ad oggi dei traduttori
145010120326      * personalizzati per ORM RC non ce ne sono.
145020120326      * Attenzione che se dovessero esserci di nuovo dei traduttori
145030120326      * personalizzati il pgm prevede di controllare l'esistenza dell'ORM RC
145040120326      * e per collegare ORM con Bolla si fa tramite RFA dell'ORM = al n. bolla
145050120326      * memorizzato sul VAB di conseguenza la LNP del video non va più bene.
145060120326     c                   move      vidlnp        I28lnp
145070091006     c                   if        widspe <> 0
145080120326     c**!!!              Move      Widlnp        I28lnp
145090091006     c                   Move      Widnrs        I28nrs
145100091006     c                   Move      Widnsp        I28nsp
145110091006     c                   else
145120091006     c  n12              eval      i28aas = waas
145130120326     c**!!!              move      vidlnp        i28lnp
145140091006     c                   endif
145150091006     c                   Eval      I28Lna = comlna
145160091006     c                   Move      varznc        I28Znc
145170091006     c                   eval      i28rsd = vidrsd
145180091006     c                   eval      i28ind = vidind
145190091006     c                   eval      i28cad = vidcad
145200091006     c                   eval      i28lod = vidlod
145210091006     c                   eval      i28prd = vidprd
145220091006     c                   eval      i28nzd = vidnzd
145230091006     c                   eval      i28ncl = v1cncl
145240091006     c                   eval      i28pkb = vidpkg
145250091006      * Solo se richiamato FNLS28R x i aggiornare passo solo I28Ope
145260031217      * gli altri dati sono già impostati
145270031217   x1c                   Else
145280091006     c                   Eval      I28Ope = wope
145290040227      * se sono in conferma bolle da dischetto e il cliente non mantiene il
145300040227      * numero di spedizione devo aggiornare anche il riferimento sull'ORM
145310091006      * o immissione bolla
145320091006if  2c                   If        (*In12 and *In15 and BlpNsp <> WidNsp)
145330091006     c                              or not *in12
145340091006     c                   Eval      I28nAas = BlpAas
145350091006     c                   Eval      I28Lnp = BlpLnp
145360091006     c                   Eval      I28Nrs = BlpNrs
145370091006     c                   Eval      I28Nsp = BlpNsp
145380040227    2c                   EndIf
145390031217    1c                   EndIf
145400091006     c                   Call      'FNLS28R'
145410091006     c                   parm                    kpjba
145420091006     c                   Parm                    Fnls28ds
145430091006      * Solo se ho richiamato FNLS28R x i controlli verifico gli errori
145440031217if  1c                   If        wope = 'C'
145450031217      * Orm Non trovato
145460091006if  2c                   If        O28Err = 01
145470031217     c                   Eval      VidMsg = Err(150)
145480031217     c                   Eval      *In67 = *On
145490031217     c                   Eval      *In90 = *On
145500031217    2c                   EndIf
145510031217      * Altri errori sull'ORM
145520091006if  2c                   If        O28Err > *Zeros and O28Err <> 01
145530091006     c                   Eval      VidMsg = O28Msg
145540031217     c                   Eval      *In67 = *On
145550031217     c                   Eval      *In90 = *On
145560031217    2c                   EndIf
145570091124    1c                   EndIf
145580031217      * Ok ORM - imposto campi x memorizzarli in FIAR5 rcd 'RCC'
145590091006     c                   Eval      savOrmPoe = O28Poe
145600091006     c                   Eval      savOrmNsr = O28Nsr
145610091006     c                   Eval      savOrmNor = O28Nor
145620091006     c                   Eval      savOrmNrv = O28Nrv
145630030805
145640030805     c                   EndSr
145650960319     C*
145660960319     C* CONTROLLO GIORNI DI CHIUSURA --------------------------------*
145670960319     C     CTRGCH        BEGSR
145680960319     C*** 1° GIORNO CHIUSURA ***
145690960319    1C     WGC1          IFNE      *BLANKS
145700960319     C                   MOVEL     WGC1          ACOM              1
145710960319     C                   MOVE      WGC1          BCOM              1
145720960319     C                   Z-ADD     1             B                 3 0
145730960319     C     ACOM          LOOKUP    GGG(B)                                 30
145740960319     C* ERRORE
145750960319    2C     *IN30         IFEQ      *OFF
145760960319     C                   MOVEL     ERR(63)       VIDMSG
145770960319     C                   SETON                                        7490
145780960319     C                   GOTO      ENDGCH
145790960319    2C                   ENDIF
145800960319     C*
145810960319    2C     BCOM          IFNE      ' '
145820960319     C     BCOM          ANDNE     'P'
145830960319     C     BCOM          ANDNE     'M'
145840960319     C                   MOVEL     ERR(63)       VIDMSG
145850960319     C                   SETON                                        7490
145860960319     C                   GOTO      ENDGCH
145870960319    2C                   END
145880960319     C*
145890960319    1C                   END
145900960319     C***
145910960319     C*** 2° GIORNO CHIUSURA ***
145920960319    1C     WGC2          IFNE      *BLANKS
145930960319     C                   MOVEL     WGC2          ACOM              1
145940960319     C                   MOVE      WGC2          BCOM              1
145950960319     C                   Z-ADD     1             B
145960960319     C     ACOM          LOOKUP    GGG(B)                                 30
145970960319     C* ERRORE
145980960319    2C     *IN30         IFEQ      *OFF
145990960319     C                   MOVEL     ERR(63)       VIDMSG
146000960319     C                   SETON                                        6290
146010960319     C                   GOTO      ENDGCH
146020960319    2C                   ENDIF
146030960319     C*
146040960319    2C     BCOM          IFNE      ' '
146050960319     C     BCOM          ANDNE     'P'
146060960319     C     BCOM          ANDNE     'M'
146070960319     C                   MOVEL     ERR(63)       VIDMSG
146080960319     C                   SETON                                        6290
146090960319     C                   GOTO      ENDGCH
146100960319    2C                   END
146110960319     C*
146120960319     C* I GIORNI DI CHIUSURA NON POSSO ESSERE UGUALI
146130960319    2C     WGC1          IFEQ      WGC2
146140960319     C                   MOVEL     ERR(63)       VIDMSG
146150960319     C                   SETON                                        6290
146160960319     C                   GOTO      ENDGCH
146170960319    2C                   END
146180960319    1C                   END
146190960319     C* NON POSSONO ESSERE ' P' ' M'
146200960319    1C     WGC1          IFEQ      ' M'
146210960319     C     WGC1          OREQ      ' P'
146220960319    2C     WGC2          IFEQ      ' M'
146230960319     C     WGC2          OREQ      ' P'
146240960319     C                   MOVEL     ERR(63)       VIDMSG
146250960319     C                   SETON                                        6290
146260960319     C                   GOTO      ENDGCH
146270960319    2C                   END
146280960319    1C                   END
146290960319     C* personalizzazione
146300960319    2C     WPERSO        IFEQ      'P'
146310960319     C     WGC1          IFNE      '  '
146320960319     C     WGC2          ORNE      '  '
146330960319     C                   SETON                                        91
146340960319    2C                   ENDIF
146350960319    2C                   ENDIF
146360960319     C*
146370960319     C     ENDGCH        ENDSR
146380050415     C* CONTROLLO PARTICOLARITA' VARIE E BANCALI --------------------*
146390050415     c     sr_CntPVBan   begsr
146400050415     C***
146410050415     C*** PARTICOLARITA' VARIE    ***
146420050415     C*   PER ORA NON ESISTONO E SALTO COMPLETAMENTE IL CONTROLLO
146430050415     C*   SI PUO' SOLO IMMETTERE 'P ' CHE INDICA CONSEGNA A PRIVATI
146440050415      *   si può inserire anche 'B' bancali o 'O' bancali x over 25
146450050415    1C     VIDGVA        IFNE      *BLANKS
146460050415     C     VIDGVR        ORNE      *BLANKS
146470050415     C* RICHIAMO IL PRG DI RICERCA
146480050415    2C     VIDGVR        IFEQ      '?'
146490050415     C                   CLEAR                   DS7PQR
146500050415     C                   MOVEL     'S'           DS7RIC
146510050415     C                   MOVEL     'V'           DS7GES
146520050415     C                   MOVEL     WKSC          DS7KSC
146530050415     C                   MOVEL     VIDGVA        DS7COD
146540050415     C                   MOVEL     DS7PQR        KPJBU
146550050415     C                   CALL      'TRTB73R'
146560050415     C                   PARM                    KPJBA
146570050415     C                   MOVEL     KPJBU         DS7PQR
146580050415     C                   CLEAR                   VIDGVR
146590050415     C*
146600050415     C     VIDGVA        IFEQ      *BLANKS
146610050415     C                   MOVEL     DS7COD        VIDGVA
146620050415    2C                   ENDIF
146630050415     C*
146640050415     C                   MOVEL     '1'           WEMFOR
146650050415     C                   GOTO      ENDpvban
146660050415    2C                   ENDIF
146670050415     C* CONTROLLO
146680050415     C                   CLEAR                   DS7PQR
146690050415     C                   MOVEL     'S'           DS7RIC
146700050415     C                   MOVEL     'C'           DS7GES
146710050415     C                   MOVEL     WKSC          DS7KSC
146720050415     C                   MOVEL     VIDGVA        DS7COD
146730050415     C                   MOVEL     DS7PQR        KPJBU
146740050415     C                   CALL      'TRTB73R'
146750050415     C                   PARM                    KPJBA
146760050415     C                   MOVEL     KPJBU         DS7PQR
146770050415     C* ERRORE
146780050415    2C     DS7ERR        IFEQ      '1'
146790050415     C                   MOVEL     DS7MSG        VIDMSG
146800050415     C                   SETON                                        7590
146810050415     C                   GOTO      ENDpvban
146820050415    2C                   ENDIF
146830050415     c* controllo ambito di utilizzo particolarità varia
146840050415     C                   MOVEL     '7S'          COD
146850050415     C                   MOVEL(P)  vidgva        KEY
146860050415     c                   clear                   ds7s
146870050415     C                   EXSR      CTABEL
146880050415     C                   MOVEL     TBLUNI        DS7S
146890050415     c     §7suti        ifeq      'B'
146900050415     c     §ogntw        andeq     'PPT'
146910050415     c     §7suti        oreq      'P'
146920050415     c     §ogntw        andne     'PPT'
146930050415     C                   MOVEL     err(288)      VIDMSG
146940050415     C                   SETON                                        7590
146950050415     C                   GOTO      ENDpvban
146960050415     c                   endif
146970050415    1C                   ENDIF
146980050415      * B A N C A L I
146990050415      * tipo bancali
147000050415If  1c                   If        VidTba <> *Blanks and VidTba <> '00'
147010050415      * ricerca
147020050415     c     '?'           Scan      VidTba                                 30
147030050415If  2c                   If        *In30
147040050415     c                   Clear                   Dsbs02
147050050415     c                   Eval      T02Mod = 'R'
147060050415     c                   Eval      T02Sif = Knsif
147070050415     c                   Eval      T02Cod = 'TBA'
147080050415     c                   Call      'TIBS02R'
147090050415     c                   Parm                    Kpjba
147100050415     c                   Parm                    Dsbs02
147110050415     c                   Movel     T02Ke1        VidTba
147120050415     c                   Eval      Wemfor = '1'
147130050415     c                   z-add     23            H2riga
147140050415     c                   z-add     16            H2colo
147150050415     c                   GoTo      ENDpvban
147160050415    2c                   EndIf
147170050415      * controllo
147180050415     c                   Clear                   Dsbs02
147190050415     c                   Clear                   dTba
147200050415     c                   Eval      T02Mod = 'C'
147210050415     c                   Eval      T02Sif = Knsif
147220050415     c                   Eval      T02Cod = 'TBA'
147230050415     c                   Movel(p)  VidTba        T02Ke1
147240050415     c                   Call      'TIBS02R'
147250050415     c                   Parm                    Kpjba
147260050415     c                   Parm                    Dsbs02
147270050415If  2c                   If        T02Err <> *Blanks
147280050415     c                   Movel     Rimm          AtrTba
147290050415     c                   Eval      VidMsg = Err(269)
147300050415     c                   Eval      *In90 = *On
147310050415     c                   z-add     23            H2riga
147320050415     c                   z-add     16            H2colo
147330050415     c                   GoTo      ENDpvban
147340050415    2c                   EndIf
147350050415     c                   Movel     T02Uni        dTba
147360050415     c                   Z-Add     §TbaPkg       wTbaPkg1
147370050415     c                   Z-Add     §TbaVol       wTbaVol1
147380050415   x1c                   Else
147390050415If  2c                   If        VidNba > *Zeros
147400050415     c                   Movel     Rimm          AtrTba
147410050415     c                   Eval      VidMsg = Err(269)
147420050415     c                   Eval      *In90 = *On
147430050415     c                   z-add     23            H2riga
147440050415     c                   z-add     16            H2colo
147450050415     c                   GoTo      ENDpvban
147460050415    2c                   EndIf
147470050415    1c                   EndIf
147480050415      * numero bancali
147490050415If  1c                   If        VidNba = *Zeros and VidTba > *Zeros
147500050415     c                   Movel     Rimm          AtrNba
147510050415     c                   Eval      VidMsg = Err(268)
147520050415     c                   Eval      *In90 = *On
147530050415     c                   z-add     23            H2riga
147540050415     c                   z-add     22            H2colo
147550050415     c                   GoTo      ENDpvban
147560050415    1c                   EndIf
147570050415      * tipo bancali 2
147580050415If  1c                   If        VidTb2 <> *Blanks and VidTb2 <> '00'
147590050415      * ricerca
147600050415     c     '?'           Scan      VidTb2                                 30
147610050415If  2c                   If        *In30
147620050415     c                   Clear                   Dsbs02
147630050415     c                   Eval      T02Mod = 'R'
147640050415     c                   Eval      T02Sif = Knsif
147650050415     c                   Eval      T02Cod = 'TBA'
147660050415     c                   Call      'TIBS02R'
147670050415     c                   Parm                    Kpjba
147680050415     c                   Parm                    Dsbs02
147690050415     c                   Movel     T02Ke1        VidTb2
147700050415     c                   Eval      Wemfor = '1'
147710050415     c                   z-add     23            H2riga
147720050415     c                   z-add     32            H2colo
147730050415     c                   GoTo      ENDpvban
147740050415    2c                   EndIf
147750050415      * controllo
147760050415     c                   Clear                   Dsbs02
147770050415     c                   Clear                   dTba
147780050415     c                   Eval      T02Mod = 'C'
147790050415     c                   Eval      T02Sif = Knsif
147800050415     c                   Eval      T02Cod = 'TBA'
147810050415     c                   Movel(p)  VidTb2        T02Ke1
147820050415     c                   Call      'TIBS02R'
147830050415     c                   Parm                    Kpjba
147840050415     c                   Parm                    Dsbs02
147850050415If  2c                   If        T02Err <> *Blanks
147860050415     c                   Movel     Rimm          AtrTb2
147870050415     c                   Eval      VidMsg = Err(269)
147880050415     c                   Eval      *In90 = *On
147890050415     c                   z-add     23            H2riga
147900050415     c                   z-add     32            H2colo
147910050415     c                   GoTo      ENDpvban
147920050415    2c                   EndIf
147930050415     c                   Movel     T02Uni        dTba
147940050415     c                   Z-Add     §TbaPkg       wTbaPkg2
147950050415     c                   Z-Add     §TbaVol       wTbaVol2
147960050415   x1c                   Else
147970050415If  2c                   If        VidNb2 > *Zeros
147980050415     c                   Movel     Rimm          AtrTb2
147990050415     c                   Eval      VidMsg = Err(269)
148000050415     c                   Eval      *In90 = *On
148010050415     c                   z-add     23            H2riga
148020050415     c                   z-add     32            H2colo
148030050415     c                   GoTo      ENDpvban
148040050415    2c                   EndIf
148050050415    1c                   EndIf
148060050415      * numero bancali 2
148070050415If  1c                   If        VidNb2 = *Zeros and VidTb2 > *Zeros
148080050415     c                   Movel     Rimm          AtrNb2
148090050415     c                   Eval      VidMsg = Err(268)
148100050415     c                   Eval      *In90 = *On
148110050415     c                   z-add     23            H2riga
148120050415     c                   z-add     38            H2colo
148130050415     c                   GoTo      ENDpvban
148140050415    1c                   EndIf
148150050415      * non si possono immettere 2 tipi bancali uguali
148160050415If  1c                   If        VidTba > *Zeros and VidTb2 > *Zeros
148170050415     c                             and VidTba = VidTb2
148180050415     c                   Movel     Rimm          AtrTb2
148190050415     c                   Eval      VidMsg = Err(270)
148200050415     c                   Eval      *In90 = *On
148210050415     c                   z-add     23            H2riga
148220050415     c                   z-add     32            H2colo
148230050415     c                   GoTo      ENDpvban
148240050415    1c                   EndIf
148250050415      * se inseriti i bancali la particolarità Varie "B" è obbligatoria
148260050415      * oppure la particolarità Varie "O"
148270050415If  1c                   If        (VidTba > *Zeros or VidTb2 > *Zeros) and
148280050415     c                              %Subst(VidGva:1:1) <> 'B' and
148290050415     c                              %Subst(VidGva:1:1) <> 'O'
148300050415     c                   Select
148310050415     c                   When      wgva = 'O'
148320050415     c                   Eval      VidMsg = Err(32)
148330050415     c                   When      wgva = 'B'
148340050415     c                   Eval      VidMsg = Err(35)
148350050415     c                   Other
148360050415     c                   Eval      VidMsg = Err(274)
148370050415     c                   EndSl
148380050415     c                   Eval      *In90 = *On
148390050415     c                   Eval      *In75 = *On
148400050415     c                   GoTo      ENDpvban
148410050415    1c                   EndIf
148420050415      * se inserita la particolarità Varie "B" sono obbligatori
148430050415      * oppure la particolarità Varie "O"
148440050415If  1c                   If        (%subst(VidGva:1:1) ='B' or
148450050415     c                              %subst(VidGva:1:1) ='O')  and
148460050415     c                             (VidTba = *Blanks or VidTba = '00') and
148470050415     c                             (VidTb2 = *Blanks or Vidtb2 = '00')
148480050415     c                   Movel     Rimm          AtrTba
148490050415     c                   Eval      VidMsg = Err(271)
148500050415     c                   Eval      *In90 = *On
148510050415     c                   z-add     23            H2riga
148520050415     c                   z-add     16            H2colo
148530050415     c                   GoTo      ENDpvban
148540050415    1c                   EndIf
148550050415      * msg info x n. colli inferiore al tot. bancali
148560050415     c                   Eval      wtotnba = VidNba + VidNb2
148570050415     c                   If        VidNcl < wtotnba and wtotnba > *Zeros
148580050415     c                             and wfornba = *Blanks
148590050415     c                   Eval      VidMsg = Err(27)
148600050415     c                   Eval      *In41 = *On
148610050415     c                   Eval      *In90 = *On
148620050415     c                   Eval      wfornba = '1'
148630050415     c                   GoTo      ENDpvban
148640050415     c                   EndIf
148650050415      * Manutenzione di bolla con bancali
148660050415      * Se viene modificato il numero di bancali
148670050415      * emetto un msg info
148680050415     c                   If        *In12 and Not *In15                      and
148690050415     c                             (VidNba <> SavNba or VidNb2 <> SavNb2)   and
148700110921     c                             wNba = *Blanks                           and
148710110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
148720050415     c                   Eval      wNba = '1'
148730050415     c                   Eval      VidMsg = Err(273)
148740050415     c                   If        VidNba <> SavNba
148750050415     c                   Movel     Rimm          AtrNba
148760050415     c                   z-add     23            H2riga
148770050415     c                   z-add     22            H2colo
148780050415     c                   EndIf
148790050415     c                   If        VidNb2 <> SavNb2
148800050415     c                   Movel     Rimm          AtrNb2
148810050415     c                   z-add     23            H2riga
148820050415     c                   z-add     38            H2colo
148830050415     c                   EndIf
148840050415     c                   Eval      *In90 = *On
148850050415     c                   GoTo      ENDpvban
148860050415     c                   EndIf
148870050415      * per Particolarità varie 'O'
148880050415      * questi controlli non li faccio se richiamato da giacenze
148890050415     c                   If        %subst(VidGva:1:1) = 'O'
148900050415      * se colli originali già immessi devo controllare il n. dei colli sfusi
148910050415      * con i bancali
148920050415     c                   If        w03Cor > *zeros
148930050415     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
148940050415     c                   EndIf
148950050415      * devo controllare se inseriti i colli originali
148960050415      * se non sono stati inseriti emetto la window per inserirli
148970050415     c                   If        w03cor = *Zeros     or
148980050415      * oppure se sono in manutenzione bolla e sono stati variati
148990050415      * o i bancali o il n. dei colli
149000050415      * emetto la window
149010050415     c                             (*In12 and Not *In15)                   or
149020050415     c                             (wtotncl > *Zeros  and
149030050415     c                             (wtotncl <> vidncl or
149040050415     c                             (wtotncl >= w03cor and w03cor > *Zeros)))
149050050415     c                   ExSr      Sr_Over25
149060050415     c                   EndIf
149070050415     c                   EndIf
149080050415     c     endpvban      tag
149090050415     C   90              MOVEL     '1'           WEMFOR
149100050415     c                   endsr
149110940826     C*
149120940826     C* GESTIONE 3 VIDEATA ------------------------------------------*
149130940826     C     GESD03        BEGSR
149140991008      *
149150940928     C                   CLEAR                   WEMD03
149160971211     C                   MOVEL     COMLNA        V3CLNA
149170940826     C* DECODIFICA LNA
149180940826     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
149190971211     C  N30              MOVEL     ORGDES        V3DLNA
149200940923     C*
149210940923     C* SE TASSAZIONE CON TARIFFA MITTENTE, TASSO LA BOLLA
149220950125     C* SOLO PER GLI ASSEGNATI
149230950125     C   04SAVFTM        IFNE      ' '
149240940923     C     VIDFTM        ORNE      ' '
149250940923     C     VIDIMV        IFEQ      0
149260980506     C                   MOVEL     '1'           WBOL
149270011025      *
149280011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
149290011025      * varia 'N'
149300011025     C     FLGVRN        IFEQ      '1'
149310011115      * leggo il sbfl delle varie
149320011115     C                   DO        20            NRR
149330011115     C     NRR           CHAIN     LS01S03                            30
149340011115     C     V3CSV1        IFEQ      'N'
149350011115     C     V3CVA1        ANDEQ     88888888
149360011115     C                   EXSR      TASSAN
149370011115     C  N30              UPDATE    LS01S03
149380011115     C                   ENDIF
149390011115     C                   ENDDO
149400011025     C                   ENDIF
149410011025      *
149420940923     C                   EXSR      TASSAZ
149430941219     C* SE TASSAZIONE RIUSCITA, MSG CHE E' TASSATA CON TARIFFA MITTEN
149440950504     C* IN CONFERMA BOLLE DA  CLIENTI NON LO DO'
149450941219     C     *IN90         IFEQ      *OFF
149460950504     C     *IN12         IFEQ      *OFF
149470950504     C     *IN15         OREQ      *OFF
149480950504     C     §LPFPR        OREQ      'V'
149490941110     C                   MOVEL     ERR(59)       VIDMSG
149500940923     C                   SETON                                        90
149510940923     C                   ENDIF
149520950504     C                   ENDIF
149530941219     C*
149540941219     C                   ENDIF
149550940923     C                   ENDIF
149560950504     C*
149570950504     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
149580950504     C*    AI CONTROLLI --> SE NON C'E' STATO UN ERRORE IN TASSAZIONE
149590950504     C  N90
149600950504     CAN 12
149610950504    2CAN 15§LPFPR        IFNE      'V'
149620950504     C                   GOTO      CT3TAG
149630950504    2C                   END
149640961111     C* EMETTO MSG CHE DEVO TASSARE IL PORTO SE FRANCO FRONTIERA
149650961111     C     VIDFBR        IFEQ      'F'
149660961111     C     SED           ANDEQ     0
149670961111     C                   MOVEL     ERR(129)      VIDMSG
149680961111     C                   SETON                                        9052
149690961111     C                   MOVEL     1             SED
149700961111     C                   ENDIF
149710940923     C*
149720940826     C     FOR03         TAG
149730941011     C                   Z-ADD     1             NRR
149740940826     C*
149750940923     C                   WRITE     LS01D04
149760940923     C                   EXFMT     LS01C03
149770950504     C*
149780950504     C     CT3TAG        TAG
149790941115     C*
149800941021     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
149810950126     C                   EXSR      OFFD03
149820940826     C*
149830990701     C* F22 - CALCOLO PROVVIGIONI DEL MITTENTE
149840940928    3C     *INKW         IFEQ      *ON
149850940919     C* SOLO SE SI TRATTA DI UN CODIFICATO
149860940919    4C     VIDCCM        IFNE      9999
149870940919    4C     VIDCCM        ANDNE     8888
149880940919     C* SOLO SE IL CLIENTE HA UNA TARIFFA ALMENO VALIDA
149890980608     C*  ALTRIMENTI USA LA TARIFFA DI CARTELLO IL PGM TNSF20R
149900980506     C                   MOVEL     '2'           WBOL              1
149910980506     C                   EXSR      TASSAZ
149920980506     C** IMPOSTO LA VARIA SE TROVATA IN VI2VA1
149930940826   X4C                   ELSE
149940940919     C* ERRORE PER 8888 O 9999
149950941110     C                   MOVEL     ERR(82)       VIDMSG
149960980608     C                   SETON                                        4090
149970940919    4C                   ENDIF
149980940919     C*
149990940826     C                   GOTO      FOR03
150000940919    3C                   ENDIF
150010941115     C*
150020940826     C* CONTROLLI
150030940826     C                   EXSR      CTRD03
150040940826     C* RIEMETTO FORMATO
150050950127     C     WEMFOR        IFEQ      '1'
150060950127     C                   EXSR      ESCIER
150070950127     C     §LPFPR        IFNE      '5'
150080000113     C  NKL              GOTO      FOR03
150090950127     C                   ELSE
150100950127     C                   GOTO      ENDD03
150110950127     C                   ENDIF
150120950127     C                   ENDIF
150130941115     C*
150140990701     C* F12 - RITORNO VIDEATA 2
150150941115     C     *INKL         IFEQ      *ON
150160990701     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA F9 QUESTA VIDEATA
150170941115     C     VIDPOR        IFNE      0
150180941115     C     WESVAR        ORNE      ' '
150190941115     C     VIDCEI        ORNE      ' '
150200040116     c     wesvar1       orne      *Blanks
150210941115     C     VI2CEI        ORNE      ' '
150220000113     C     WEMFOR        OREQ      '1'
150230941115     C                   MOVEL     'S'           WEMD03            1
150240000113     C                   CLEAR                   WEMFOR
150250000113     C                   CLEAR                   VIDMSG
150260000113     C                   SETOFF                                       90
150270941115     C                   ENDIF
150280941115     C                   GOTO      ENDD03
150290941115     C                   ENDIF
150300940826     C*
150310990630     C* F14 - TASSAZIONE BOLLA
150320990630     C     *INKN         IFEQ      *ON
150330990630     C                   MOVEL     '1'           WBOL
150340011025      *
150350011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
150360011025      * varia 'N'
150370011025     C     FLGVRN        IFEQ      '1'
150380011115      * leggo il sbfl delle varie
150390011115     C                   DO        20            NRR
150400011115     C     NRR           CHAIN     LS01S03                            30
150410011115     C     V3CSV1        IFEQ      'N'
150420011115     C     V3CVA1        ANDEQ     88888888
150430011025     C                   EXSR      TASSAN
150440011115     C  N30              UPDATE    LS01S03
150450011115     C                   ENDIF
150460011115     C                   ENDDO
150470011025     C                   ENDIF
150480011025      *
150490990630     C                   EXSR      TASSAZ
150500990701     C*
150510990630     C* PER PREPAGATI CALCOLO IL TOTALE FATTURA
150520990701     C     *IN22         IFEQ      *ON
150530990716     C     VIDIMV        IFGT      0
150540060208     c* se sono in manutenzione ed è variato il totale imponibile
150550060208     c* errore se prepagato già incassato
150560070514     c***                if        *in12 = *on and *in15 = *off  and
150570070514     c***                          dateu >= §vpogpp
150580070514     c                   if        *in12 = *on and *in15 = *off
150590060208     c                   exsr      sr_callycow
150600060208     c                   if        prmesito <> 0
150610060208     C                   MOVEL     ERR(297)      VIDMSG
150620060208     C                   SETON                                        90
150630060208     C                   GOTO      FOR03
150640060208     c                   endif
150650060208     c                   endif
150660120105     c                   if        viddft>0
150670120105     C                   Z-ADD     viddft        G02DAT
150680120105     C                   MOVEL     *BLANK        G02ERR
150690120105     C                   CALL      'XSRDA8'
150700120105     C                   PARM                    WLBDAT
150710120105     C                   MOVEL     G02INV        comdft
150720120105     c                   else
150730990701     C                   Z-ADD     DATEU         COMDFT
150740120105     c                   endif
150750991014     C                   EXSR      TOTFAT
150760990701     C                   Z-ADD     D04IFT        VIDIFT
150770990701     C                   Z-ADD     D04IMV        VIDIMV
150780990701     C                   Z-ADD     D04POR        VIDPOR
150790990701     C                   Z-ADD     D04IMV        SAVIMV
150800991014     C                   Z-ADD     D04POR        MEMPOR
150810990701     C                   ENDIF
150820990716     C                   ENDIF
150830990630     C*
150840990630     C                   GOTO      FOR03
150850990630     C                   ENDIF
150860060207     c*
150870060207     c* MANUTENZIONE: GESTIONE MOTIVAZIONE PER PREPAGATI
150880060207     c* Se sono in manutenzione di un prepagato ed è stato variato il
150890060207     c* totale imponibile richiedo motivazione
150900060308     c*
150910060308     c                   movel     'TR'          wcvb
150920060308     c                   exsr      cls_lv85
150930060308     c*
150940060208     c                   clear                   ilv85cvb
150950060207     c                   if        *in12 = *on and *in15= *off and
150960070514     c****                         dateu >= §vpogpp  and
150970060208     c                             *in22 = *on and vidimv <> savimvo
150980060227     c                   movel     '7L'          cod
150990060227     C                   MOVEL(P)  'TR'          KEY
151000060227     C                   EXSR      CTABEL
151010060227     C                   MOVEL     TBLUNI        DS7L
151020060227     c                   if        §7lmtv = 'S'
151030060227     c                   clear                   fnlv85ds
151040060208     c                   eval      ilv85cvb = 'TR'
151050060209     c                   eval      ilv85tel = 'V'
151060060207     c                   movel     fnlv85ds      kpjbu
151070060207     c                   call      'FNLV85R'
151080060207     c                   parm                    kpjba
151090060210     c                   movel     kpjbu         fnlv85ds
151100060207     c* F12=Ritorno --> riemetto formato 03
151110060209     c                   if        olv85f12 = '1'
151120060207     c                   goto      for03
151130060207     c                   endif
151140060227     c                   endif
151150060207     c                   endif
151160940826     C*
151170940919     C* SE CONTO SERVIZIO IMMISSIONE PER CMD6
151180101104     c                   if        not *inkf and not *inkh
151190101104     C     WFPR          IFNE      'I'
151200940919     C     §3ARBL        ANDEQ     'C'
151210950410     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
151220950410    4C     VIDLNP        IFNE      102
151230950410     C     *IN12         OREQ      *OFF
151240950410     C     *IN15         OREQ      *OFF
151250940928     C                   MOVEL     ERR(40)       VIDMSG
151260940923     C                   SETON                                        90
151270940919     C                   GOTO      FOR03
151280900504     C                   END
151290950410     C                   END
151300101104     c                   endif
151310960318     C**
151320960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
151330960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
151340960805     C* NON LO FACCIO SE BOLLA DI RECUPERO
151350960805     C  NKF§3ARBL        IFNE      'R'
151360960805     C                   EXSR      CTRCRG
151370030704     c   41              GoTo      For03
151380960805     C                   ENDIF
151390940919     C*
151400940923     C     ENDD03        ENDSR
151410900507     C*
151420900507     C*--- CONTROLLO FORMATO 3 ---------------------------------------*
151430940826     C     CTRD03        BEGSR
151440991008      *
151450941004     C                   SETOFF                                       90
151460941115     C                   CLEAR                   VIDMSG
151470940826     C                   CLEAR                   WEMFOR
151480030623     C                   CLEAR                   WVAR3A            1
151490991028     C**
151500991028     C* CONTROLLO DIVISA SE MODIFICATA
151510991028    1C     VI2DIV        IFNE      *BLANKS
151520991028     C     VI2DIV        ANDNE     WDIV2
151530991028     C     WDIV2         ANDNE     *BLANKS
151540991028     C                   CLEAR                   DSLV16
151550991028     C                   CLEAR                   DTASV
151560991028     C                   MOVEL     'D'           D17FIM
151570991028     C                   MOVE      VI2DIV        D17DIV
151580991028     C                   Z-ADD     BLPDSP        D17DSP
151590991028     C                   CALL      'FNLV16R'
151600991028     C                   PARM                    DSLV16
151610991028     C                   PARM                    DTASV
151620991028     C                   MOVEL     D17DIV        VI2DIV
151630991028     C* ERRORE
151640991028    2C     O17ERR        IFNE      *BLANKS
151650991028     C                   SETON                                        43
151660991028    3C     O17MSG        IFNE      *BLANKS
151670991028     C                   MOVEL     O17MSG        VIDMSG
151680991028     C                   SETON                                        90
151690991028    3C                   ENDIF
151700991028     C                   GOTO      ENDC03
151710991028    2C                   ENDIF
151720991028     C**
151730991028      * SE VARIATA DIVISA DEVO CONVERTIRE GLI IMPORTI NON MODIFICATI
151740991028    2C     VI2VA1        IFEQ      VA2VA1
151750991028     C     VI2VA1        ANDGT     *ZEROS
151760991028     C                   CLEAR                   DSYEUR
151770991028     C                   MOVEL     WDIV2         YECDVI
151780991028     C                   Z-ADD     VI2VA1        YECIMI
151790991028     C                   MOVEL     VI2DIV        YECDVO
151800991028    3C     O17FDC        IFEQ      'S'
151810991028     C                   MOVEL     '3'           YECDCO
151820991028    3C                   ENDIF
151830991028     C**
151840991028     C                   CALL      'YEURCO'
151850991028     C                   PARM                    DSYEUR
151860991028     C**
151870991028    3C     YECESI        IFEQ      ' '
151880991028     C                   Z-ADD     YECIMO        VI2VA1
151890991028     C                   MOVEL     '1'           WEMFOR
151900991028    3C                   ENDIF
151910991028    2C                   ENDIF
151920040114      * Varia 2
151930040114    2c                   If        Vi2Va2 = Va2Va2 and Vi2Va2 > 0
151940040114     c                   Clear                   dsyeur
151950040114     c                   Movel     wdiv2         YecDvi
151960040114     c                   Z-add     Vi2va2        YecImi
151970040114     c                   Movel     Vi2Div        YecDvo
151980040114    3c                   If        O17fDc = 'S'
151990040114     c                   Movel     '3'           YecDco
152000040114    3c                   EndIf
152010040114     c                   Call      'YEURCO'
152020040114     c                   Parm                    dsyeur
152030040114    3c                   If        YecEsi = *Blanks
152040040114     c                   Z-add     YecImo        Vi2Va2
152050040114     c                   Eval      wemfor = '1'
152060040114    3c                   EndIf
152070040114    2c                   EndIf
152080040114      * Varia 3
152090040114    2c                   If        Vi2Va3 = Va2Va3 and Vi2Va3 > 0
152100040114     c                   Clear                   dsyeur
152110040114     c                   Movel     wdiv2         YecDvi
152120040114     c                   Z-add     Vi2va3        YecImi
152130040114     c                   Movel     Vi2Div        YecDvo
152140040114    3c                   If        O17fDc = 'S'
152150040114     c                   Movel     '3'           YecDco
152160040114    3c                   EndIf
152170040114     c                   Call      'YEURCO'
152180040114     c                   Parm                    dsyeur
152190040114    3c                   If        YecEsi = *Blanks
152200040114     c                   Z-add     YecImo        Vi2Va3
152210040114     c                   Eval      wemfor = '1'
152220040114    3c                   EndIf
152230040114    2c                   EndIf
152240040114      * Varia 4
152250040114    2c                   If        Vi2Va4 = Va2Va4 and Vi2Va4 > 0
152260040114     c                   Clear                   dsyeur
152270040114     c                   Movel     wdiv2         YecDvi
152280040114     c                   Z-add     Vi2va4        YecImi
152290040114     c                   Movel     Vi2Div        YecDvo
152300040114    3c                   If        O17fDc = 'S'
152310040114     c                   Movel     '3'           YecDco
152320040114    3c                   EndIf
152330040114     c                   Call      'YEURCO'
152340040114     c                   Parm                    dsyeur
152350040114    3c                   If        YecEsi = *Blanks
152360040114     c                   Z-add     YecImo        Vi2Va4
152370040114     c                   Eval      wemfor = '1'
152380040114    3c                   EndIf
152390040114    2c                   EndIf
152400041217      * Varia 5
152410041217    2c                   If        Vi2Va5 = Va2Va5 and Vi2Va5 > 0
152420041217     c                   Clear                   dsyeur
152430041217     c                   Movel     wdiv2         YecDvi
152440041217     c                   Z-add     Vi2va5        YecImi
152450041217     c                   Movel     Vi2Div        YecDvo
152460041217    3c                   If        O17fDc = 'S'
152470041217     c                   Movel     '3'           YecDco
152480041217    3c                   EndIf
152490041217     c                   Call      'YEURCO'
152500041217     c                   Parm                    dsyeur
152510041217    3c                   If        YecEsi = *Blanks
152520041217     c                   Z-add     YecImo        Vi2Va5
152530041217     c                   Eval      wemfor = '1'
152540041217    3c                   EndIf
152550041217    2c                   EndIf
152560041217      * Varia 6
152570041217    2c                   If        Vi2Va6 = Va2Va6 and Vi2Va6 > 0
152580041217     c                   Clear                   dsyeur
152590041217     c                   Movel     wdiv2         YecDvi
152600041217     c                   Z-add     Vi2va6        YecImi
152610041217     c                   Movel     Vi2Div        YecDvo
152620041217    3c                   If        O17fDc = 'S'
152630041217     c                   Movel     '3'           YecDco
152640041217    3c                   EndIf
152650041217     c                   Call      'YEURCO'
152660041217     c                   Parm                    dsyeur
152670041217    3c                   If        YecEsi = *Blanks
152680041217     c                   Z-add     YecImo        Vi2Va6
152690041217     c                   Eval      wemfor = '1'
152700041217    3c                   EndIf
152710041217    2c                   EndIf
152720040114
152730991028    1C                   ENDIF
152740991028      *
152750991028     C                   Z-ADD     VI2VA1        VA2VA1
152760040114     c                   Z-add     Vi2Va2        Va2Va2
152770040114     c                   Z-add     Vi2Va3        Va2Va3
152780040114     c                   Z-add     Vi2Va4        Va2Va4
152790041217     c                   Z-add     Vi2Va5        Va2Va5
152800041217     c                   Z-add     Vi2Va6        Va2Va6
152810040121     C                   Z-ADD     VI2VA1        VVA(1)
152820040121     c                   Z-add     Vi2Va2        Vva(2)
152830040121     c                   Z-add     Vi2Va3        Vva(3)
152840040121     c                   Z-add     Vi2Va4        Vva(4)
152850041217     c                   Z-add     Vi2Va5        Vva(5)
152860041217     c                   Z-add     Vi2Va6        Vva(6)
152870991028     C                   MOVEL     VI2DIV        WDIV2
152880991028     C* RIEMETTO VIDEATA
152890991028     C     WEMFOR        IFEQ      '1'
152900991028     C                   GOTO      ENDC03
152910991028    2C                   ENDIF
152920940826     C*
152930100119      * Gli altri controlli sono demandati al FNLV16
152940100119     C                   CLEAR                   Dlv1601
152950100119     C                   CLEAR                   DSLV16
152960100119     C                   CLEAR                   DTASV
152970100119
152980940920     C* 2 BOLLA --> CONTROLLO I CAMPI
152990991011    1C     VI2SV1        IFNE      *BLANKS
153000991011     C     VI2VA1        ORNE      *ZEROS
153010040114     c     Vi2Sv2        orne      *Blanks
153020040114     c     Vi2Va2        orne      *Zeros
153030040114     c     Vi2Sv3        orne      *Blanks
153040040114     c     Vi2Va3        orne      *Zeros
153050040114     c     Vi2Sv4        orne      *Blanks
153060040114     c     Vi2Va4        orne      *Zeros
153070041217     c     Vi2Sv5        orne      *Blanks
153080041217     c     Vi2Va5        orne      *Zeros
153090041217     c     Vi2Sv6        orne      *Blanks
153100041217     c     Vi2Va6        orne      *Zeros
153110991011     C     VI2DIV        ORNE      *BLANKS
153120100119     C                   MOVEL     'E'           D17FIM
153130100119   x1c                   else
153140100119     c* controllo solo il codice esenzione IVA
153150100119    2C     VI2CEI        ifne      *BLANKS
153160100119     C                   MOVEL     'I'           D17FIM
153170100119    2c                   endif
153180100119    1c                   endif
153190991026      *
153200100119    1c                   if        d17fim<>' '
153210991011     C                   MOVEL     'P'           D17TBO
153220991011     C                   MOVEL     WKSC          D17KSC
153230991028     C                   Z-ADD     BLPDSP        D17DSP
153240991011     C                   MOVEL     VIDLNP        D17LNP
153250991011     C                   MOVEL     VIDLNA        D17LNA
153260991011     C                   MOVEL     §3ATB2        D17TBL
153270991011     C                   MOVEL     §3ARBL        D17RBL
153280020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
153290040115     c                   Movel     §3asva        §d17Sva
153300040115      * passo che devo controllare la seconda bolla
153310040115     c                   Eval      §d17Tb2 = 'S'
153320100119     c                   Eval      §d17ctriso='S'
153330100119     c                   Eval      §d17iso=vidisd
153340100119
153350100119     c                   if        vidpid<>*blanks and vidisd=*blanks
153360100119     c                   eval      §d17iso='IT'
153370100119     c                   endif
153380100119
153390040115     c                   Movel     Dlv1601       D17Flo
153400991011     C                   MOVEL     VI2DIV        D17DIV
153410991011     C                   MOVEL     WDIV2         D17DVP
153420991011     C     §3AFCA        IFEQ      2
153430991011     C                   MOVEL     'S'           D17FCA
153440991011     C                   ENDIF
153450991011     C                   MOVEL     VI2CEI        D17CEI
153460991012     C                   MOVEL     VI2SV1        VSV(1)
153470991012     C                   MOVEL     VI2VA1        VVA(1)
153480040121     c                   Movel     Vi2Es1        ves(1)
153490040115     C                   MOVEL     VI2SV2        VSV(2)
153500040115     C                   Z-add     VI2VA2        VVA(2)
153510040121     c                   Movel     Vi2Es2        ves(2)
153520040115     C                   MOVEL     VI2SV3        VSV(3)
153530040115     C                   Z-add     VI2VA3        VVA(3)
153540040121     c                   Movel     Vi2Es3        ves(3)
153550040115     C                   MOVEL     VI2SV4        VSV(4)
153560040115     C                   Z-add     VI2VA4        VVA(4)
153570040121     c                   Movel     Vi2Es4        ves(4)
153580041217     C                   MOVEL     VI2SV5        VSV(5)
153590041217     C                   Z-add     VI2VA5        VVA(5)
153600041217     c                   Movel     Vi2Es5        ves(5)
153610041217     C                   MOVEL     VI2SV6        VSV(6)
153620041217     C                   Z-add     VI2VA6        VVA(6)
153630041217     c                   Movel     Vi2Es6        ves(6)
153640100119     c* In questo caso passo il codice iso della partita iva del destinatario
153650100119     c
153660991011      *
153670991011     C                   CALL      'FNLV16R'
153680991011     C                   PARM                    DSLV16
153690991012     C                   PARM                    DTASV
153700991011      *
153710991011     C                   MOVEL     D17CEI        VI2CEI
153720991011     C                   MOVEL     D17DIV        VI2DIV
153730991015     C                   MOVEL     O17FDC        WFDC2
153740991011     C                   MOVEL     O17DEI        V2DCEI
153750040115      * Ricarico le varie
153760040115     c                   Movel     Vsv(1)        Vi2Sv1
153770040115     c                   Z-add     Vva(1)        Vi2Va1
153780040121     c                   Movel     Ves(1)        Vi2Es1
153790040115     c                   Movel     Vsv(2)        Vi2Sv2
153800040115     c                   Z-add     Vva(2)        Vi2Va2
153810040121     c                   Movel     Ves(2)        Vi2Es2
153820040115     c                   Movel     Vsv(3)        Vi2Sv3
153830040115     c                   Z-add     Vva(3)        Vi2Va3
153840040121     c                   Movel     Ves(3)        Vi2Es3
153850040115     c                   Movel     Vsv(4)        Vi2Sv4
153860040115     c                   Z-add     Vva(4)        Vi2Va4
153870040121     c                   Movel     Ves(4)        Vi2Es4
153880041217     c                   Movel     Vsv(5)        Vi2Sv5
153890041217     c                   Z-add     Vva(5)        Vi2Va5
153900041217     c                   Movel     Ves(5)        Vi2Es5
153910041217     c                   Movel     Vsv(6)        Vi2Sv6
153920041217     c                   Z-add     Vva(6)        Vi2Va6
153930041217     c                   Movel     Ves(6)        Vi2Es6
153940991011      *
153950991011     C     O17ERR        IFNE      *BLANKS
153960991011      *
153970991011      *  Se errore riemetto videata con messaggio
153980991011     C     O17MSG        IFNE      *BLANKS
153990991011     C                   MOVEL     O17MSG        VIDMSG
154000991011     C                   SETON                                        90
154010991011      *  Se interrogazione riemetto videata
154020991011     C                   ELSE
154030991011     C                   MOVEL     '1'           WEMFOR            1
154040991011     C                   ENDIF
154050991011      *
154060991011     C                   SELECT
154070991011     C     O17ERR        WHENEQ    '1'
154080991011     C                   SETON                                        42
154090991011     C     O17ERR        WHENEQ    '6'
154100040116     c                   If        O17Erv = 1
154110991011     C                   SETON                                        40
154120040115     c                   EndIf
154130040116     c                   If        O17Erv = 2
154140040115     c                   z-add     09            H3riga
154150041217     c                   z-add     49            H3colo
154160040115     c                   EndIf
154170040116     c                   If        O17Erv = 3
154180041217     c                   z-add     09            H3riga
154190041217     c                   z-add     65            H3colo
154200040115     c                   EndIf
154210040116     c                   If        O17Erv = 4
154220040115     c                   z-add     10            H3riga
154230041217     c                   z-add     33            H3colo
154240040115     c                   EndIf
154250041217     c                   If        O17Erv = 5
154260041217     c                   z-add     10            H3riga
154270041217     c                   z-add     49            H3colo
154280041217     c                   EndIf
154290041217     c                   If        O17Erv = 6
154300041217     c                   z-add     10            H3riga
154310041217     c                   z-add     65            H3colo
154320041217     c                   EndIf
154330991011     C     O17ERR        WHENEQ    '7'
154340991011     C                   SETON                                        43
154350991011     C                   ENDSL
154360991011      *
154370991011     C   90              GOTO      ENDC03
154380991011     C                   ENDIF
154390991011      *
154400991011    1C                   ENDIF
154410040130      * salvo le varie in una sk per poterle poi riorganizzare al momento
154420040130      * della scrittura dei file FIAR6 e FIAR7
154430040130     c                   Eval      W2sv(1) = vi2sv1
154440040130     c                   Eval      W2va(1) = vi2va1
154450040130     c                   Eval      W2sv(2) = vi2sv2
154460040130     c                   Eval      W2va(2) = vi2va2
154470040130     c                   Eval      W2sv(3) = vi2sv3
154480040130     c                   Eval      W2va(3) = vi2va3
154490040130     c                   Eval      W2sv(4) = vi2sv4
154500040130     c                   Eval      W2va(4) = vi2va4
154510041217     c                   Eval      W2sv(5) = vi2sv5
154520041217     c                   Eval      W2va(5) = vi2va5
154530041217     c                   Eval      W2sv(6) = vi2sv6
154540041217     c                   Eval      W2va(6) = vi2va6
154550040130      * Controllo se caricata almeno una varia
154560041217do  1c                   Do        6             c
154570040130     c                   If        w2sv(c) <> *Blanks
154580040130     c                   Eval      wesvar1 = 'S'
154590040130     c                   EndIf
154600040130    1c                   EndDo
154610011212     C* CONTROLLO CHE LA L'IMPORTO NON SUPERI IL LIMITE FATTURABILE
154620040130     c                   xfoot     w2va          wsomts
154630040116if  1c                   If        wsomts > *Zeros
154640011212     C     VI2DIV        IFNE      §GEDCN
154650011212     C                   CLEAR                   DSYEUR
154660011212     C                   MOVEL     VI2DIV        YECDVI
154670011212     C                   MOVEL     §GEDCN        YECDVO
154680040114     c                   Z-add     wsomts        YecImi
154690011212     C                   MOVE      DECCN         YECDCO
154700011212     C                   CALL      'YEURCO'
154710011212     C                   PARM                    DSYEUR
154720011212     C     YECESI        IFEQ      ' '
154730011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
154740011212     C                   ENDIF
154750011212     C                   ENDIF
154760011212     C     WSOMTS        IFGT      IMFGEI
154770040115     c                   Movea     err(242)      k78
154780011212     C                   MOVE      IMFGEI        WNUMED
154790011212     C* richiamo routine per editare il limite
154800011212     C                   EXSR      CALLXE
154810011212      * metto il numero editato nel campo del messaggio
154820011212     C                   MOVEA     W014A         SKII(1)
154830040115     c                   Movea     skii(1)       k78(54)
154840040115     c                   Movea     §gedcn        k78(69)
154850011212     C*
154860011212     C                   MOVEA     K78           VIDMSG
154870011212     C                   SETON                                        4190
154880011212     C                   GOTO      ENDC03
154890011212     C                   ENDIF
154900040116    1C                   ENDIF
154910040126
154920040126     c                   Z-add     wsomts        Vi2Imv
154930991011      *
154940991012      * SE TASSAZIONE CON TARIFFA MITTENTE PROVO A RITASSARE
154950991012      * NON TASSO SE P.A. EXPORT
154960950127    1C   04SAVFTM        IFEQ      'S'
154970950127     C     VIDFTM        OREQ      'S'
154980950127    2C     VIDIMV        IFEQ      0
154990980506     C                   MOVEL     '1'           WBOL
155000950127     C                   EXSR      TASSAZ
155010950127    2C                   END
155020950127    1C                   END
155030991012      *
155040991012      * SE VARIATA LA DIVISA: LA CONTROLLO, CONVERTO IMPORTI MODIFICATI
155050991012      *                       E RIEMETTO LA VIDEATA
155060991012     C     VIDDIV        IFNE      WDIV1
155070991015     C     VIDDIV        ANDNE     *BLANKS
155080991026     C     WDIV1         ANDNE     *BLANKS
155090991012     C                   EXSR      VARDIV
155100991028     C     WEMFOR        IFEQ      '1'
155110991012     C                   GOTO      ENDC03
155120991028     C                   ENDIF
155130991012     C                   ENDIF
155140991012      *
155150100119     C                   CLEAR                   Dlv1601
155160100119     C                   CLEAR                   DSLV16
155170991007     C                   CLEAR                   DTASV
155180941219     C                   MOVEL     'P'           D17TBO
155190991012      * PER PREPAGATI IMPOSTO IL FLAG APPOSITO
155200991012     C   22              MOVEL     'S'           D17PRP
155210991012     C  N04              MOVEL     WKSC          D17KSC
155220941219     C*
155230941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
155240991012    1C     SAVFTM        IFEQ      'S'
155250991012     C     *IN04         ANDEQ     *ON
155260941219     C     VIDFTM        OREQ      'S'
155270991012     C     *IN04         ANDEQ     *ON
155280941221     C                   MOVE      WKSC          D17KSC
155290941219     C                   MOVEL     'S'           D17FTM
155300991012      *
155310991012      * SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
155320941219   X2C                   ELSE
155330941221     C                   MOVEL     COMLNA        D17KSC
155340941221     C                   MOVE      9999          D17KSC
155350991012    1C                   ENDIF
155360991012      *
155370991012     C                   MOVEL     'C'           D17FIM
155380941219     C                   MOVEL     VIDLNP        D17LNP
155390941219     C                   MOVEL     VIDLNA        D17LNA
155400941219     C                   MOVEL     §3ATB1        D17TBL
155410941219     C                   MOVEL     §3ARBL        D17RBL
155420020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
155430020503     C                   MOVEL     §3ASVA        D17FLO
155440950103     C     §3AFCA        IFEQ      1
155450941219     C                   MOVEL     'S'           D17FCA
155460941219     C                   ENDIF
155470941219     C                   MOVEL     VIDIAS        D17IAS
155480941219     C                   MOVEL     VIDQFT        D17QFT
155490941219     C                   MOVEL     VIDPOR        D17POR
155500991014     C     COMDFT        IFGT      *ZEROS
155510991014     C                   Z-ADD     COMDFT        D17DSP
155520991012     C                   ELSE
155530991028     C                   Z-ADD     BLPDSP        D17DSP
155540991012     C                   ENDIF
155550941219     C                   MOVEL     VIDIMV        D17IMV
155560941219     C                   MOVEL     VIDCEI        D17CEI
155570941219     C                   MOVEL     VIDFIV        D17FIV
155580941219     C                   MOVEL     VIDNFT        D17NFT
155590941219     C                   MOVEL     VIDDFT        D17DFG
155600941219     C                   MOVEL     'S'           D17FFI
155610991012     C                   MOVEL     VIDDIV        D17DIV
155620991012     C                   MOVEL     WDIV1         D17DVP
155630100119     c
155640100119     c* Controllo codice esenzione iva con partita iva del "chi paga"
155650100120     c*  sempre se ASSEGNATO
155660100119
155670100119     c                   if        *in04
155680100120     c                   Eval      §d17ctriso='S'
155690100119     c                   Eval      §d17iso=vidisd
155700100119     c                   if        vidpid<>*blanks and vidisd=*blanks
155710100119     c                   eval      §d17iso='IT'
155720100119     c                   endif
155730100119
155740100119     c                   else
155750100120     c*  solo per prepagati se FRANCO
155760100120     c                   if        *in22
155770100120     c                   Eval      §d17ctriso='S'
155780100119     c                   Eval      §d17iso=vidism
155790100119     c                   if        vidpim<>*blanks and vidism=*blanks
155800100119     c                   eval      §d17iso='IT'
155810100119     c                   endif
155820100120     c                   endif
155830100120     c
155840100119     c                   endif
155850100119
155860100119     c                   Movel     Dlv1601       D17Flo
155870991012      *
155880991012      * CARICO SCHIERA VARIE
155890941219     C                   CLEAR                   C
155900941219     C                   DO        20            NRR
155910941219     C     NRR           CHAIN     LS01S03                            30
155920941219     C     *IN30         IFEQ      *OFF
155930970604     C**
155940941219     C                   ADD       1             C
155950941219     C                   MOVEL     V3CSV1        VSV(C)
155960991007     C                   Z-ADD     V3CVA1        VVA(C)
155970030623     C* MEMORIZZO SE C'E' LA VARIA DELLA BOLLA NEL CASO DI BOLLE CON SINGOLA VAR
155980030623     C                   IF        §3ASVA <> *BLANKS AND V3CSV1 = §3ASVA
155990030623     C                   MOVEL     'S'           WVAR3A            1
156000030623     C                   ENDIF
156010941219     C                   ENDIF
156020941219     C                   ENDDO
156030970604     C* ERRORE
156040970604     C   90              GOTO      ENDC03
156050990701     C**
156060941219     C** CALL
156070991008     C                   CALL      'FNLV16R'
156080991008     C                   PARM                    DSLV16
156090991007     C                   PARM                    DTASV
156100991012      *
156110991012     C                   MOVEL     D17DIV        VIDDIV
156120991015     C                   MOVEL     O17FDC        WFDC1
156130941219     C                   MOVEL     D17CEI        VIDCEI
156140991011     C                   MOVEL     O17DEI        DESCEI            8
156150991011     C                   MOVEL     O17DEI        V3DCEI
156160941219     C                   Z-ADD     D17DFG        VIDDFT
156170991011     C                   Z-ADD     O17DFA        COMDFT
156180991012      *
156190991012      * RICARICO LE VARIE
156200941219     C                   DO        20            NRR
156210941219     C     NRR           CHAIN     LS01S03                            30
156220941219     C                   MOVEL     VSV(NRR)      V3CSV1
156230941219     C                   MOVEL     VES(NRR)      V3CEV1
156240941223     C*
156250941223     C     VSV(NRR)      IFNE      *BLANKS
156260941223     C                   MOVEL     'S'           WESVAR            1
156270941223     C                   ENDIF
156280941219     C* SE C'E' ERRORE SU VARIA, ACCENDO INDICATORE DI POSIZIONAMENTO
156290991011     C     O17ERV        IFEQ      NRR
156300941219     C                   SETON                                        5090
156310991019     C                   MOVEL     O17MSG        VIDMSG
156320941219     C                   ELSE
156330941219     C                   SETOFF                                       50
156340941219     C                   ENDIF
156350991012      *
156360941219     C  N30              UPDATE    LS01S03
156370941219     C   30              WRITE     LS01S03
156380941219     C                   ENDDO
156390991012      *
156400991015     C   90              GOTO      ENDC03
156410991015      *
156420991012      * GESTIONE ERRORI
156430991011    1C     O17ERR        IFNE      *BLANKS
156440941219     C                   MOVEL     '1'           WEMFOR
156450941021     C*
156460991011    2C     O17MSG        IFNE      *BLANKS
156470991011     C                   MOVEL     O17MSG        VIDMSG
156480941219     C                   SETON                                        90
156490941021    2C                   ENDIF
156500941021     C**
156510941021     C* ESENZIONE IVA
156520991011    2C     O17ERR        IFEQ      '1'
156530950103     C                   SETON                                        46
156540940920     C                   GOTO      ENDC03
156550941021    2C                   ENDIF
156560941021     C**
156570941021     C* NUMERO FATTURA
156580991011     C     O17ERR        IFEQ      '2'
156590941219     C                   SETON                                        48
156600941021     C                   GOTO      ENDC03
156610941021    2C                   ENDIF
156620941021     C**
156630960926     C* REGISTRO IVA FATTURA
156640991011    2C     O17ERR        IFEQ      '3'
156650941219     C                   SETON                                        47
156660941021     C                   GOTO      ENDC03
156670941021    2C                   ENDIF
156680941021     C**
156690941021     C* DATA FATTURA
156700991011     C     O17ERR        IFEQ      '4'
156710941219     C                   SETON                                        49
156720941021     C                   GOTO      ENDC03
156730941021    2C                   ENDIF
156740941021     C**
156750941021     C* IMPONIBILE
156760991011     C     O17ERR        IFEQ      '5'
156770941219     C                   SETON                                        45
156780941021     C                   GOTO      ENDC03
156790941021    2C                   ENDIF
156800991012     C**
156810991012     C* DIVISA
156820991012     C     O17ERR        IFEQ      '7'
156830991012     C                   SETON                                        53
156840991012     C                   GOTO      ENDC03
156850991012    2C                   ENDIF
156860991012     C**
156870991012     C* PORTO
156880991012     C     O17ERR        IFEQ      '8'
156890991012     C                   SETON                                        52
156900991012     C                   GOTO      ENDC03
156910991012    2C                   ENDIF
156920941021     C*
156930941021    1C                   ENDIF
156940991104      *
156950991104      * MEMORIZZO GLI IMPORTI DI TASSAZIONE IN CAMPI DI COMODO PER CONFRONTI
156960011212     C* MENTRE MEMORIZZO FACCIO ANCHE LA SOMMA DEGLI IMPORTI PER POI
156970011212     C* CONTROLLARLA COL LIMITE FATTURABILE
156980991104     C                   Z-ADD     VIDPOR        MEMPOR
156990011212     C                   Z-ADD     VIDPOR        WSOMTS           17 3
157000991104     C                   MOVEL     VIDDIV        WDIV1
157010991104     C                   DO        20            NRR
157020991104     C     NRR           CHAIN     LS01S03                            30
157030991104     C                   Z-ADD     V3CVA1        V3HVA1
157040011219     C* Se è bolla di rientro non tassata fino all'imponibile con varia
157050011219     c* "N" 88888888 non la considero per il confronto con §geimf
157060011219     C     VIDFBR        IFEQ      'S'
157070011219     C     V3CSV1        ANDEQ     'N'
157080011219     C     V3CVA1        ANDEQ     88888888
157090011219     C     VIDIMV        ANDEQ     *ZEROS
157100030624     C* oppure varia & 8888888
157110030624     C     V3CSV1        OREQ      '&'
157120030624     C     V3CVA1        ANDEQ     88888888
157130030624     C     VIDIMV        ANDEQ     *ZEROS
157140011219     C                   ELSE
157150011212     C                   ADD       V3CVA1        WSOMTS
157160011219     C                   ENDIF
157170991104     C  N30              UPDATE    LS01S03
157180991104     C                   ENDDO
157190011212     C***
157200011212     C     VIDIMV        IFGT      *ZEROS
157210011212     C                   Z-ADD     VIDIMV        WSOMTS
157220011212     C                   ENDIF
157230011212     C* CONTROLLO CHE LA SOMMA DEGLI IMPORTI O IL TOTALE IMPONIBILE,
157240011212     C* SE PRESENTE, NON SUPERI IL LIMITE FATTURABILE
157250011212     C     WSOMTS        IFGT      *ZEROS
157260011212     C     VIDDIV        IFNE      §GEDCN
157270011212     C                   CLEAR                   DSYEUR
157280011212     C                   MOVEL     VIDDIV        YECDVI
157290011212     C                   MOVEL     §GEDCN        YECDVO
157300011212     C                   Z-ADD     WSOMTS        YECIMI
157310011212     C                   MOVE      DECCN         YECDCO
157320011212     C                   CALL      'YEURCO'
157330011212     C                   PARM                    DSYEUR
157340011212     C     YECESI        IFEQ      ' '
157350011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
157360011212     C                   ENDIF
157370011212     C                   ENDIF
157380011212     C     WSOMTS        IFGT      IMFGEI
157390011212     C                   MOVEA     ERR(242)      K78
157400011212     C                   MOVE      IMFGEI        WNUMED
157410011212     C* richiamo routine per editare il limite
157420011212     C                   EXSR      CALLXE
157430011212      * metto il numero editato nel campo del messaggio
157440011212     C                   MOVEA     W014A         SKII(1)
157450011212     C                   MOVEA     SKII(1)       K78(54)
157460011212     C                   MOVEA     §GEDCN        K78(69)
157470011212     C*
157480011212     C                   MOVEA     K78           VIDMSG
157490011212     C                   SETON                                        5290
157500011212     C                   GOTO      ENDC03
157510011212     C                   ENDIF
157520011212     C                   ENDIF
157530991012      *
157540991012     C* PER COD 8888 O 9999 CON VARIA "R" OBBLIGATORIO IMPORTO DA ASSICURARE
157550991012     C*  "S" IN O17FAS INDICA QUESTO TIPO DI ERRORE
157560991011    3C     O17FAS        IFEQ      'S'
157570940923     C* SE = 0 E FORZO CON ENTER PRENDO VALORE DA TARIFFA
157580941021    4C     SEI           IFNE      NUMFOR
157590941021     C                   MOVEL     ERR(9)        VIDMSG
157600940923     C                   SETON                                        5090
157610940923     C                   ADD       1             SEI
157620940923     C                   GOTO      ENDC03
157630940923    4C                   ENDIF
157640940923    3C                   ENDIF
157650940826     C*
157660950421     C* DATA FATTURA DEVE APPARTENERE ALLO STESSO MESE DELLA DATA SPEDI
157670990701    3C     VIDDFT        IFGT      0
157680990830     C     *IN22         ANDEQ     *OFF
157690950421     C                   MOVEL     VIDDFT        W0040             4 0
157700950421     C                   MOVE      W0040         W0020F            2 0
157710950421     C                   MOVEL     VIDDSP        W0040
157720950421     C                   MOVE      W0040         W0020S            2 0
157730990701    4C     W0020S        IFNE      W0020F
157740950421     C                   SETON                                        4990
157750950421     C                   MOVEL     ERR(116)      VIDMSG
157760950421     C                   GOTO      ENDC03
157770990701    4C                   ENDIF
157780990701    3C                   ENDIF
157790961111     C**
157800990830     C* SE LA DATA FATTURA <=10 DATA DI PARUT, IMPOSTO LA PRIMA DATA
157810000113     C*  DEL GIORNO, SE NON CAMBIA L'ANNO, ALTRIMENTI ERRORE
157820991011    2C   22O17DFA        IFLE      WDTU10
157830991011     C     O17DFA        ANDGT     0
157840000113     C                   MOVEL     O17DFA        W0040
157850000113     C     W0040         IFEQ      WAAUPI
157860990830     C* IMPOSTO WDTU10 + 1 E AVVISO
157870990830     C                   Z-ADD     WDTUPI        VIDDFT
157880990830     C                   SETON                                        4990
157890990830     C                   MOVEL     ERR(167)      VIDMSG
157900990830     C                   GOTO      ENDC03
157910000113     C                   ELSE
157920000113     C**
157930000113     C                   SETON                                        4990
157940000113     C                   MOVEL     ERR(182)      VIDMSG
157950000113     C                   GOTO      ENDC03
157960991012    2C                   ENDIF
157970000113    2C                   ENDIF
157980001121     C* SE DATA FATTURA < DATA SPEDIZIONE E CAMBIO MESE, NON POSSO
157990001121     C*  METTERE IN SOSPENSIONE LA BOLLA
158000000508    2C   22O17DFA        IFGT      WDTU10
158010000508     C     O17DFA        ANDGT     0
158020001121     C                   MOVEL     O17DFA        W0060F            6 0
158030001121     C                   MOVEL     BLPDSP        W0060S            6 0
158040000508     C     W0060F        IFLT      W0060S
158050000508     C     BLPDSP        ANDGT     DATEU
158060000508     C                   SETON                                        4990
158070000508     C                   MOVEL     ERR(193)      VIDMSG
158080000508     C                   GOTO      ENDC03
158090000508     C                   ENDIF
158100000508     C                   ENDIF
158110000113     C*
158120990610     C* SE FRANCO FRONTIERA SPECIFICARE IL PORTO
158130961111     C  NKLVIDPOR        IFEQ      0
158140961111     C     VIDFBR        ANDEQ     'F'
158150961111     C                   SETON                                        5290
158160961111     C                   MOVEL     ERR(129)      VIDMSG
158170961111     C                   GOTO      ENDC03
158180961111     C                   ENDIF
158190990610     C*
158200990610     C* SE PREPAGATO INSERIRE TASSAZIONE O F14 PER TASSARE
158210990701     C  NKL
158220990701    1CANNKN*IN22         IFEQ      *ON
158230990701    2C     VIDIMV        IFEQ      0
158240990614     C                   SETON                                        5290
158250990610     C                   MOVEL     ERR(160)      VIDMSG
158260990610     C                   GOTO      ENDC03
158270990701   X2C                   ELSE
158280990701    3C     VIDIMV        IFNE      SAVIMV
158290990716     C     VIDIMV        ANDGT     0
158300060207     c* se sono in manutenzione errore se già incassato
158310060208     c                   if        *in12 = *on and *in15 = *off and
158320070514     c****                         dateu >= §vpogpp and vidimv <> savimvo
158330070514     c                             vidimv <> savimvo
158340060208     c                   exsr      sr_callycow
158350060208     c                   if        prmesito <> 0
158360060208     C                   SETON                                        90
158370060208     C                   MOVEL     ERR(297)      VIDMSG
158380060208     C                   GOTO      ENDC03
158390060208     c                   endif
158400060207     c                   endif
158410120105     c                   if        viddft>0
158420120105     C                   Z-ADD     viddft        G02DAT
158430120105     C                   MOVEL     *BLANK        G02ERR
158440120105     C                   CALL      'XSRDA8'
158450120105     C                   PARM                    WLBDAT
158460120105     C                   MOVEL     G02INV        comdft
158470120105     c                   else
158480990630     C                   Z-ADD     DATEU         COMDFT
158490120105     c                   endif
158500990630     C                   EXSR      TOTFAT
158510990630     C                   Z-ADD     D04IFT        VIDIFT
158520990701     C                   Z-ADD     D04IMV        VIDIMV
158530990701     C                   Z-ADD     D04POR        VIDPOR
158540991014     C                   Z-ADD     D04POR        MEMPOR
158550990701     C                   MOVEL     '1'           WEMFOR
158560990701     C                   Z-ADD     VIDIMV        SAVIMV
158570990701    3C                   ENDIF
158580990701    2C                   ENDIF
158590990630     C* LIBRO IVA
158600990701    2C     *IN34         IFEQ      *ON
158610020725     C                   clear                   DSBS02
158620020725     C                   clear                   DYIV
158630020725     C                   movel     'C'           T02mod
158640020725     C                   movel     KNSIF         T02sif
158650020725     C                   movel     'YIV'         T02cod
158660020725     C                   movel     C_Soc         T02ke1
158670020725     C                   movel     VIDLNP        T02ke2
158680020725     C                   call      'TIBS02R'
158690020725     C                   parm                    KPJBA
158700020725     C                   parm                    DSBS02
158710020725     C                   IF        T02err = *blanks
158720020725     C                   movel     T02uni        DYIV
158730020725     C                   movel     §IVLVF        FIV
158740020725     C                   else
158750020725     C                   clear                   DYIV
158760020725     C                   movel     VIDLNP        FIV
158770020725     C                   endif
158780990630     C* NUMERO FATTURA
158790990630     C     KNUM          CHAIN(N)  CNNUM000                           30
158800990630     C* ERRORE : MANCA IL NUMERATORE DELLE FATTURE
158810990701    3C     *IN30         IFEQ      *ON
158820990630     C                   MOVEL     ERR(164)      VIDMSG
158830990630     C                   SETON                                        5290
158840990630     C                   GOTO      ENDC03
158850990701    3C                   ENDIF
158860990701    2C                   ENDIF
158870990701    1C                   ENDIF
158880011025      * Se è bolla di reso con varia 'N' 88888888 deve esserci la varia 'N'
158890011025     C                   SETOFF                                       50
158900011025    1C     FLGVRN        IFEQ      '1'
158910011025    2C                   DO        20            NRR
158920011025     C     NRR           CHAIN     LS01S03                            30
158930011025    3C     *IN32         IFEQ      *OFF
158940011025     C                   SETON                                        50
158950011025    4C     V3CSV1        IFEQ      'N'
158960011025     C                   SETOFF                                       50
158970011025     C                   LEAVE
158980011025    4C                   ENDIF
158990011025    3C                   ENDIF
159000011025    2C                   ENDDO
159010011025    2C     *IN50         IFEQ      '1'
159020011025     C     1             CHAIN     LS01S03                            30
159030011025     C  N30              UPDATE    LS01S03
159040011114     C                   MOVEL     ERR(233)      VIDMSG
159050011025     C                   SETON                                        90
159060011025     C                   GOTO      ENDC03
159070011025    2C                   ENDIF
159080011025    1C                   ENDIF
159090991012      *
159100940923     C     ENDC03        TAG
159110940928     C   90              MOVEL     '1'           WEMFOR            1
159120991012      *
159130940923     C                   ENDSR
159140060208     C* Richiamo pgm che verifca se prepagato incassato -------------*
159150060208     C     sr_callycow   BEGSR
159160060208     c                   z-add     §lpaas        prmaas
159170060208     c                   z-add     §lplnp        prmlnp
159180060208     c                   z-add     §lpnrs        prmnrs
159190060208     c                   z-add     §lpnsp        prmnsp
159200060208     c                   z-add     vidfiv        prmfiv
159210060208     c                   z-add     vidnft        prmnft
159220060208     c                   z-add     dftar6        prmdft
159230060209     c                   clear                   prmesito
159240060607     c                   call      'YCOW0121R1'
159250060208     C                   PARM                    prmaas
159260060208     C                   PARM                    prmLnp
159270060208     C                   PARM                    prmNrs
159280060208     C                   PARM                    prmNsp
159290060208     C                   PARM                    prmFiv
159300060208     C                   PARM                    prmDft
159310060208     C                   PARM                    prmNft
159320060208     C                   PARM                    prmEsito
159330060208     C                   ENDSR
159340971211     C*
159350971211     C* GESTIONE 6 VIDEATA ------------------------------------------*
159360081008     C**   GESD06        BEGSR
159370081008     C**                 MOVEL     COMLNA        V6CLNA
159380971211     C* DECODIFICA LNA
159390081008     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
159400081008     C**N30              MOVEL     ORGDES        V6DLNA
159410971211     C*
159420081008     C**   FOR06         TAG
159430971211     C*
159440081008     C**                 EXFMT     LS01D06
159450081008     C**                 SETOFF                                       4090
159460971211     C* CONTROLLO SE INSERITO NUMERO AWB: NON POSSO CANCELLARLO SE
159470971211     C*  C'ERA
159480081008     C** 12
159490081008    1C**ANN15V6CAWB        IFEQ      0
159500081008     C**   SAVAWB        ANDGT     0
159510081008     C**                 SETON                                        4090
159520081008     C**                 MOVEL     ERR(145)      VIDMSG
159530081008     C**                 GOTO      FOR06
159540081008    1C**                 ENDIF
159550971211     C*
159560081008     c**   A_§ogntw      ifeq      'EUP'
159570081008     C**                 MOVEL     WKSC          W007A
159580081008     C**   W007A         LOOKUP    KSS                                    30
159590081008    2C**   *IN30         IFEQ      *ON
159600971211     C**
159610971211     C* CONTROLLO CHECK DIGIT
159620081008    3C**   V6CAWB        IFGT      0
159630081008     C**                 MOVEL     V6CAWB        W0090             9 0
159640081008     C**   W0090         DIV       7             RISUL            10 0
159650081008     C**                 MVR                     RESTO             1 0
159660971211     C**
159670081008     C**                 MOVE      V6CAWB        W0010             1 0
159680081008    4C**   RESTO         IFNE      W0010
159690081008     C**                 SETON                                        4090
159700081008     C**                 MOVEA     ERR(147)      K78
159710081008     C**                 MOVEL     RESTO         K78(66)
159720081008     C**                 MOVEA     K78           VIDMSG
159730081008     C**                 GOTO      FOR06
159740081008    4C**                 ENDIF
159750081008    3C**                 ENDIF
159760081008    2C**                 ENDIF
159770081008    1C**                 ENDIF
159780971211     C**
159790081008     C**                 ENDSR
159800991203     C*
159810991203     C* GESTIONE 7 VIDEATA ------------------------------------------*
159820991203     C     GESD07        BEGSR
159830991203     C                   MOVEL     COMLNA        V7CLNA
159840991203     C* DECODIFICA LNA
159850991203     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
159860991203     C  N30              MOVEL     ORGDES        V7DLNA
159870991203     C*
159880991203     C     FOR07         TAG
159890991203     C*
159900991203     C                   EXFMT     LS01D07
159910991203     C                   SETOFF                                       4090
159920991203     C* CONTROLLO SE INSERITO NUMERO PARCEL: NON POSSO CANCELLARLO SE
159930991203     C*  C'ERA
159940991203     C   12
159950060616     CANN15V7CNPR        IFEQ      *blanks
159960060616     C     SAVNPR        ANDne     *blanks
159970991203     C                   SETON                                        4090
159980991203     C                   MOVEL     ERR(176)      VIDMSG
159990991203     C                   GOTO      FOR07
160000991203     C                   ENDIF
160010991203      **
160020991203      * CONTROLLO VALIDITA'
160030060616    1C     V7CNPR        IFne      *blanks
160040000308     C     §3ARBL        ANDNE     'R'
160050000124     C                   MOVEL     V7CNPR        WNPR
160060000124     C                   EXSR      DPDVAL
160070000124     C   90              SETON                                        40
160080000124     C   90              GOTO      FOR07
160090070323     c* Sped. export DPD:
160100070323     c* dal I° aprile non più ammessi parcel dpd lunghi 12
160110070326     C                   if        A_§OGNTW='DPD' and dateu >=20070401
160120070326     c                             and %subst(wnpr:14:1)=*blanks
160130070326     c                             and vidfbr<>'S'
160140070323     c                   seton                                        9040
160150070323     C                   MOVEL     ERR(299)      VIDMSG
160160070323     C                   GOTO      FOR07
160170070323     c                   endif
160180000124     C*
160190991227    1C                   ENDIF
160200070323     c
160210000124     C**
160220000124     C* CONTROLLO NUMERO PARCEL DPD DOPPIO
160230000308     C* IGNORO PER BOLLA SENZA SEGNACOLLI
160240000308     C     §1BFG8        IFEQ      'S'
160250060616     C                   movel     V7CNPR        WNPR
160260060616     c                   if        *in79=*on
160270060616     c                   exsr      dpddop_imp
160280060616     c                   else
160290000124     C                   EXSR      DPDDOP
160300060616     c                   endif
160310000124     C* ERRORE
160320000124     C   90              SETON                                        40
160330000124     C   90              GOTO      FOR07
160340060612     C                   ENDIF
160350991217     C**
160360060623     c* se import dpd metto il nuovo numero nel rmn se possibile
160370060623     c                   if        *in79='1' and *in13='0' and
160380060623     c                             wsolo_num=*blanks
160390060623     c                   clear                   vidrmn
160400060623     c                   if        %subst(v7cnpr:14:1) <> *blanks
160410060623     C                   move      VIDNRD        VIDRMN
160420060623     c                   else
160430060623     c                   eval      w012a=%subst(v7cnpr:1:12)
160440060623     c                   move      w012A         vidrmn
160450060623     c                   endif
160460060623     c
160470060623     c                   endif
160480000124     C                   ENDSR
160490000124     C**
160500000124     C* CONTROLLO VALIDITA' PARCEL DPD--------------------------------*
160510000124     C     DPDVAL        BEGSR
160520060613     c                   clear                   wsolo_num         1
160530060612     c                   select
160540060612     c* controllo parcel lungo 14 --> non devono esserci dei blanks
160550060613     c* e ammesso solo a partire da data in tabella "VPO" (per export)
160560060612     c                   when      %subst(wnpr:14:1) <> *blanks
160570070515     c***                if        *in79='0' and §vpodpd > dateu
160580070515     c***                          and vidfbr =' '
160590070515     C***                SETON                                        90
160600070515     C***                MOVEL     ERR(299)      VIDMSG
160610070515     c***                else
160620060612     c                   if        %scan(' ':wnpr) > 0
160630060612     C                   SETON                                        90
160640060612     C                   MOVEL     ERR(299)      VIDMSG
160650060613     c                   endif
160660070515     c****               endif
160670060613     c                   if        *in90='0'
160680060613     c* controllo se parcel lungo 14 contiene solo numeri
160690060619     c                   z-add     1             hh                2 0
160700061031     c                   z-add     0             hy                2 0
160710060613     c     hh            dowle     14
160720061031     c***  wsolo_num     andeq     *blanks
160730060619     c                   if        %subst(wnpr:hh:1) < '0'
160740060613     c                   eval      wsolo_num='N'
160750061031     c                   eval      hy=hh
160760060613     c                   endif
160770060613     c                   add       1             hh
160780060613     c                   enddo
160790061031     c* le lettere possono esserci solo nei primi 4 bytes dal quinto in poi
160800061031     c* devono essere solo numeri
160810061031     c                   if        wsolo_num='N' and hy >4
160820061031     C                   SETON                                        90
160830061031     C                   MOVEL     ERR(299)      VIDMSG
160840061031     c                   endif
160850061031     c
160860060613     c                   endif
160870060612     c* errore se parcel lungo 13
160880060612     c                   when      %subst(wnpr:13:1) <> *blanks
160890060612     C                   SETON                                        90
160900060612     C                   MOVEL     ERR(299)      VIDMSG
160910060612     c                   other
160920060612     c* controllo parcel lungo 12. Deve contenere solo numeri
160930060612     c                   z-add     1             hh
160940060612     c     hh            dowle     12
160950060612     c     *in90         andeq     '0'
160960060619     c                   if        %subst(wnpr:hh:1) < '0'
160970060612     C                   SETON                                        90
160980060612     C                   MOVEL     ERR(299)      VIDMSG
160990060612     c                   endif
161000060612     c                   add       1             hh
161010060612     c                   enddo
161020060612     c                   if        *in90 = '0'
161030060620     C                   movel     WNPR          DPDBRC
161040060619     C                   Z-ADD     DPDCHD        WDPDBR            1 0
161050061012     C                   CLEAR                   DPDCHD
161060000124     C                   EXSR      M1031
161070000124    3C     DPDCHD        IFNE      WDPDBR
161080000124     C                   SETON                                        90
161090060612     C                   MOVEL     ERR(299)      VIDMSG
161100060612    3C                   ENDIF
161110060612     C                   ENDIF
161120060612     c                   endsl
161130061012     c* Siccome i primi byte del numero parcel dpd corrispondono al
161140061012     c* depot dpd viene segnalato errore bloccante se il numero non
161150061012     c* è presente nell'archivio dei depot
161160061106     c                   if        *in90='0' and
161170061106     c                             ((*in79 and *in12='0') or *in79='0')
161180061012     c                   if        %subst(wnpr:14:1) <> *blanks
161190061012     c                   movel     wnpr          wdpc
161200061012     c                   else
161210061012     c                   eval      wdpc='0'+%subst(wnpr:1:3)
161220061012     c                   endif
161230061107     c                   clear                   truldepds
161240061107     c                   movel     wdpc          idepdpc
161250061107     c                   call      'TRULDEPR'
161260061107     c                   parm                    truldepds
161270061107     c                   if        odeperr='1'
161280061012     C                   SETON                                        90
161290061012     C                   MOVEL     ERR(306)      VIDMSG
161300061012     c                   endif
161310061012     c                   endif
161320060612      *se spedizione export devo anche controllare che numero parcel
161330060621      * inizi per '084' altrimenti errore forzabile
161340060626     c                   if        *in79='0' and *in90='0'
161350060621     c                   if        %subst(wnpr:14:1) <> *blanks
161360060621     c                   movel     wnpr          w0003a            3
161370060621     c     w0003a        ifne      '084'
161380060612     c     wnpr          andne     wnprpre
161390060612     C                   SETON                                        90
161400060621     C                   MOVEL     ERR(303)      VIDMSG
161410060612     c                   endif
161420060621     c                   else
161430060621     c                   movel     wnpr          w0020n            2 0
161440060621     c     w0020n        ifne      84
161450060621     c     wnpr          andne     wnprpre
161460060621     C                   SETON                                        90
161470060621     C                   MOVEL     ERR(289)      VIDMSG
161480060621     c                   endif
161490060621     c                   endif
161500060612     c                   move      wnpr          wnprpre
161510060612     c                   endif
161520000124     C                   ENDSR
161530000124      *
161540000124     C* CONTROLLO SE NUMERO PARCEL EXPORT DPD E' DOPPIO--------------*
161550000124     C     DPDDOP        BEGSR
161560070305     c* non eseguo controllo se pgm richiamato da giacenze
161570070305     c                   if        savfpr<>'G' and savfpr<>'P'
161580000124     C* NON DEVE ESSERE GIA' ESISTENTE
161590000124     C                   MOVEL(P)  WNPR          W030A            30
161600060601     c* tologo il check digit per ricercare il parcel number su fiar4
161610060615    1c                   if        %subst(wnpr:14:1) = *blanks
161620060601     c                   eval      %subst(w030a:12:1)= ' '
161630060616    1c                   endif
161640060601     C                   MOVEL     'I'           WTRC
161650060215     C     Kar4F         SETLL     Fiar403l
161660060215     C     WTRC          READE     fiar403l                               30
161670000124    1C     *IN30         DOWEQ     *OFF
161680000124    2C     *IN12         IFEQ      *OFF
161690000124     C     *IN15         OREQ      *ON
161700060215     C     ar4NRS        ORNE      §LPNRS
161710060215     C     ar4AAS        ORNE      §LPAAS
161720060215     C     ar4NSP        ORNE      §LPNSP
161730000124     C*
161740060615     C                   MOVEL     ar4N30        W014a
161750060615     c                   movel     wnpr          wnpr14           14
161760060707    1c                   if        %subst(wnpr:14:1) = *blanks
161770060707     c                   eval      %subst(wnpr14:12:1)= ' '
161780060707    1c                   endif
161790060615    3C     W014a         IFEQ      WNPR14
161800070305     C**   Kar4B         CHAIN(N)  FNBLT01L                           30
161810070305     C**SOLO SE LNA E LNP UGUALE DO ERRORE
161820070305    4C**N30BLTLNA        IFEQ      COMLNA
161830070305     C**   BLTLNP        ANDEQ     VIDLNP
161840000124     C                   MOVEL     ERR(181)      VIDMSG
161850000124     C                   SETON                                        90
161860000124     C                   GOTO      ENDDOP
161870070305    4C**                 ENDIF
161880000124    3C                   ENDIF
161890000124     C**
161900000203     C                   SETOFF                                       30
161910060615    3C     W014a         IFGT      WNPR14
161920000124     C                   SETON                                        30
161930000124    3C                   ENDIF
161940000124    2C                   ENDIF
161950000124     C*
161960060215     C  N30WTRC          READE     Fiar403l                               30
161970000124    1C                   ENDDO
161980070305     c                   endif
161990000124     C     ENDDOP        ENDSR
162000060613     C* CONTROLLO SE NUMERO PARCEL import DPD E' DOPPIO--------------*
162010060613     C     DPDDOP_imp    BEGSR
162020060613     C* NON DEVE ESSERE GIA' ESISTENTE
162030060613     C                   MOVEL(P)  vidnrd        W030A            30
162040060614     c* se immesso numero parcel lungo 12
162050060613     c* tolgo il check digit per ricercare il parcel number su fiar4
162060060614    1c                   if        %subst(vidnrd:14:1) = *blanks
162070060613     c                   eval      %subst(w030a:12:1)= ' '
162080060614    1c                   endif
162090060613     C                   MOVEL     'I'           WTRC
162100060613     C     Kar4F         SETLL     Fiar403l
162110060613     C     WTRC          READE     fiar403l                               30
162120060614    1C     *IN30         DOWEQ     *OFF
162130060613    2C     *IN12         IFEQ      *OFF
162140060613     C     *IN15         OREQ      *ON
162150060613     C     ar4NRS        ORNE      §LPNRS
162160060613     C     ar4AAS        ORNE      §LPAAS
162170060613     C     ar4NSP        ORNE      §LPNSP
162180060613     C*
162190060613     C                   MOVEL     ar4N30        W014a            14
162200060623     c                   movel     w030a         wnpr14           14
162210060613    3C     W014a         ifeq      WNPR14
162220060628     c     ar4lnp        andeq     vidlnp
162230060614     c
162240060613     c                   movel     dsblp0        savblp
162250061212     c     kblp4m        chain     fnblp01l
162260060614    4c                   if        %found(fnblp01l)
162270060614     C                   Z-ADD     BLPMGS        WDSP
162280060614     C                   MOVEL     BLPAAS        WDSP
162290060614    5C     WDSP          IFGE      DPDDSP
162300061012     c     blpcca        andne     '7'
162310060614     C                   MOVEL     ERR(181)      VIDMSG
162320060614     C                   SETON                                        3090
162330060614    5C                   ENDIF
162340060614    4c                   endif
162350060614     C                   MOVEL     SAVBLP        DSBLP0
162360060613    3C                   ENDIF
162370060613    3C     W014a         IFGT      WNPR14
162380060613     C                   SETON                                        30
162390060613    3C                   ENDIF
162400060613    2C                   ENDIF
162410060613     C*
162420060613     C  N30WTRC          READE     Fiar403l                               30
162430060614    1c                   ENDDO
162440060614     c*
162450060614     c
162460060613     C     ENDDOP_imp    ENDSR
162470991012      *
162480991012      *--- CONVERTO IMPORTI VIDEATA FATTURAZIONE NON MODIFICATI ------*
162490991104     C     VARDIV        BEGSR
162500991012      *
162510991012      * CONTROLLO DIVISA
162520991012     C                   CLEAR                   DSLV16
162530991012     C                   CLEAR                   DTASV
162540991012     C                   MOVEL     'D'           D17FIM
162550991014     C     COMDFT        IFGT      *ZEROS
162560991014     C                   Z-ADD     COMDFT        D17DSP
162570991012     C                   ELSE
162580991028     C                   Z-ADD     BLPDSP        D17DSP
162590991012     C                   ENDIF
162600991012     C                   MOVEL     VIDDIV        D17DIV
162610991012      *
162620991012     C                   CALL      'FNLV16R'
162630991012     C                   PARM                    DSLV16
162640991012     C                   PARM                    DTASV
162650991104      *
162660991104     C                   MOVEL     D17DIV        VIDDIV
162670991012      *
162680991012     C     O17ERR        IFEQ      '7'
162690991012     C                   SETON                                        53
162700991028     C                   MOVEL     '1'           WEMFOR
162710991012     C     O17MSG        IFNE      *BLANKS
162720991015     C                   MOVEL     O17MSG        VIDMSG
162730991012     C                   SETON                                        90
162740991012    2C                   ENDIF
162750991012     C                   GOTO      ENDDIV
162760991012    2C                   ENDIF
162770991012      *
162780991012     C                   CLEAR                   WCONVE
162790991012     C                   CLEAR                   DTASV
162800991012      *
162810991012      * PORTO
162820991012     C     VIDPOR        IFGT      *ZEROS
162830991012    3C     VIDPOR        ANDEQ     MEMPOR
162840991012     C                   CLEAR                   DSYEUR
162850991012     C                   MOVEL     WDIV1         YECDVI
162860991012     C                   Z-ADD     VIDPOR        YECIMI
162870991012     C                   MOVEL     VIDDIV        YECDVO
162880991012     C     O17FDC        IFEQ      'S'
162890991012     C                   MOVEL     '3'           YECDCO
162900991012     C                   ENDIF
162910991012     C                   CALL      'YEURCO'
162920991012     C                   PARM                    DSYEUR
162930991028    4C     YECESI        IFEQ      ' '
162940991012     C                   Z-ADD     YECIMO        VIDPOR
162950991015     C                   MOVEL     'S'           WCONVE            1
162960991028    4C                   ENDIF
162970991028    3C                   ENDIF
162980991012      *
162990991012      * VARIE
163000991012     C                   DO        20            NRR
163010991012     C     NRR           CHAIN     LS01S03                            30
163020991012     C     V3CVA1        IFGT      *ZEROS
163030991012    3C     V3CVA1        ANDEQ     V3HVA1
163040991012     C                   CLEAR                   DSYEUR
163050991012     C                   MOVEL     WDIV1         YECDVI
163060991012     C                   Z-ADD     V3CVA1        YECIMI
163070991012     C                   MOVEL     VIDDIV        YECDVO
163080991012     C     O17FDC        IFEQ      'S'
163090991012     C                   MOVEL     '3'           YECDCO
163100991012     C                   ENDIF
163110991012     C                   CALL      'YEURCO'
163120991012     C                   PARM                    DSYEUR
163130991028    4C     YECESI        IFEQ      ' '
163140991012     C                   Z-ADD     YECIMO        V3CVA1
163150991012     C                   Z-ADD     YECIMO        V3HVA1
163160991019     C                   UPDATE    LS01S03
163170991012     C                   MOVEL     'S'           WCONVE
163180991028    4C                   ENDIF
163190991028    3C                   ENDIF
163200991012     C                   Z-ADD     NRR           C
163210991012      * CARICO SCHIERA VARIE X RICALCOLO TOT FATTURA
163220991012     C     VIDIMV        IFGT      *ZEROS
163230991012     C                   MOVEL     V3CSV1        VSV(C)
163240991012     C                   Z-ADD     V3CVA1        VVA(C)
163250991015     C                   MOVEL     V3CEV1        VES(C)
163260991012     C                   ENDIF
163270991012     C                   ENDDO
163280991012      *
163290991012      * SE CONVERTITI IMPORTI ED è IMPOSTATO IL TOTALE FATTURA LO RICALCOLO
163300991012     C     WCONVE        IFEQ      'S'
163310991028     C                   MOVEL     '1'           WEMFOR
163320991028     C     VIDIMV        IFGT      *ZEROS
163330991012     C                   CLEAR                   DSLV16
163340991012     C                   MOVEL     'T'           D17FIM
163350991012     C                   Z-ADD     VIDPOR        D17POR
163360991012     C                   CALL      'FNLV16R'
163370991012     C                   PARM                    DSLV16
163380991012     C                   PARM                    DTASV
163390991012     C                   ENDIF
163400991028     C                   ENDIF
163410991012      *
163420991012     C     O17ERR        IFEQ      *BLANKS
163430991012     C                   Z-ADD     O17IMV        VIDIMV
163440991012     C                   ELSE
163450991012     C                   CLEAR                   VIDIMV
163460991012     C                   ENDIF
163470991012      *
163480991012     C                   MOVEL     VIDDIV        WDIV1
163490991012     C                   Z-ADD     VIDPOR        MEMPOR
163500991012      *
163510991012     C     ENDDIV        ENDSR
163520991012      *
163530930331     C*--- CALCOLO IL VOLUME -----------------------------------------*
163540930331     C     CALVOL        BEGSR
163550930331     C                   MLLZO     1             VIDNCL
163560930331     C                   MLLZO     1             VIDVOL
163570940825     C                   MLLZO     1             V2CPKG
163580930331     C*
163590930401     C                   Z-ADD     0             VARVOL
163600941230     C* SE DA DISK CLIENTI E' PASSATO IL VOLUME E NON E' STATO VARIATO
163610941230     C* PRENDO IL FLG VOLUME PASSATO SE C'E'
163620941230     C   12
163630941230    1CAN 15VIDVOL        IFNE      0
163640941230     C                   MOVEL     VIDVOL        VARVOL
163650941230     C*
163660941230     C     VIDVOL        IFEQ      §LPVLB
163670941230     C                   MOVEL     §LPFVB        VIDFVR
163680941230     C                   ELSE
163690941230     C                   MOVEL     'R'           VIDFVR
163700941230    1C                   END
163710941230    1C                   END
163720930331     C*
163730941230    1C  N12VIDVOL        IFNE      0
163740930331     C                   MOVEL     'R'           VIDFVR
163750930401     C                   MOVEL     VIDVOL        VARVOL
163760941108    1C                   END
163770930331     C*
163780941108     C   12
163790941108    1CANN15VIDVOL        IFNE      BLPVLB
163800941108    2C     VIDVOL        IFNE      0
163810930401     C                   MOVEL     VIDVOL        VARVOL
163820930331     C                   MOVEL     'R'           VIDFVR
163830941108    2C                   END
163840930331     C*
163850941108   X1C                   ELSE
163860930331     C*
163870941107     C* IN MANUTENZIONE SE NON E' GIA' VOLUME REALE, RICALCOLO
163880941108    2C     §7TRVL        IFEQ      'R'
163890941107     C                   MOVEL     VIDVOL        VARVOL
163900941108    2C                   END
163910941108    1C                   END
163920930331     C*
163930930331     C*  CALCOLO VOLUME AUTOMATICO SE A ZEROS
163940940923    1C     VARVOL        IFEQ      0
163950941025     C                   CLEAR                   DSLV18
163960941025     C                   MOVEL     §3ATB1        D18TBL
163970941025     C                   MOVEL     'P'           D18TBO
163980941025     C                   MOVEL     BLPDSP        D18AAS
163990941025     C                   MOVE      BLPDSP        D18MGS
164000941108     C                   MOVEL     V2CPKG        D18PKF
164010941025     C                   MOVEL     VIDNCL        D18NCL
164020050415     c* se previsti bancali passo il numero colli originali
164030050415     c                   if        %subst(vidgva:1:1)='O'
164040050415     c                   z-add     w03cor        d18ncl
164050050415     c                   endif
164060940923     C* SE NON C'E' TARIFFA CLIENTE USO TARIFFA CARTELLO
164070941108    2C     WTKS          IFEQ      ' '
164080941025     C                   MOVEL     TARKSC        D18KSC
164090941025     C                   MOVEL     TARPRG        D18PRG
164100941025     C                   MOVEL     TARCTR        D18CTR
164110941025     C                   ELSE
164120941025     C                   MOVEL     WKSC          D18KSC
164130941025     C                   MOVEL     COMPRG        D18PRG
164140941025     C                   MOVEL     COMCTR        D18CTR
164150940923    2C                   ENDIF
164160020311     c     vidtsp        ifne      *blanks
164170020311     c                   movel     vidtsp        d18tsp
164180020311     c                   else
164190020311     c                   movel     comtsp        d18tsp
164200020311     c                   endif
164210020311     c     comlna        ifgt      *zeros
164220020311     c                   z-add     comlna        d18lna
164230020311     c                   else
164240020311     c                   movel     i27tln        d18tln
164250020311     c                   endif
164260020311     c                   z-add     vidlnp        d18lnp
164270020311     c
164280941025     C*
164290941025     C                   CALL      'FNLV18R'
164300941025     C                   PARM                    DSLV18
164310941025     C*
164320941108     C                   MOVEL     D18FVF        VIDFVR
164330941108     C                   MOVEL     D18VLF        VARVOL
164340930331     C                   END
164350941025     C*
164360941025     C* SE  VOLUME=0 IMPOSTO 0,001
164370930401     C     VARVOL        IFEQ      0
164380941024     C                   Z-ADD     0,001         VARVOL
164390930331     C                   END
164400930331     C                   ENDSR
164410940628     C*
164420940628     C* CALCOLO IL FLAG INOLTRO --------------------------------------*
164430940628     C     INOLTR        BEGSR
164440940628     C                   MOVEL     VIDFIN        WFIN
164450940628     C*
164460940628     C*   SE FERMO DEPOSITO E' SEMPRE ' '
164470940628    1C     VIDFFD        IFEQ      'S'
164480941110     C                   MOVEL     'C'           WFIN
164490940628     C*
164500940628   X1C                   ELSE
164510940628     C*
164520940628     C* CALCOLO  SE NON C'E' FORZATURA
164530940926    2C     WFIN          IFEQ      ' '
164540940919     C                   MOVEL     COMFIN        WFIN
164550940926    2C                   ENDIF
164560940926    1C                   ENDIF
164570940628     C                   ENDSR
164580000627     C*
164590000627     C* ASSEGNO NUMERO DI SEGNACOLLI ALLA BOLLA ----------------------*
164600000627     C     ASSSGN        BEGSR
164610000627     C* IN MANUTENZIONE  SE NUMERO COLLI < DIMINUISCO IL DAL
164620000627     C*  SE > RIASSEGNO I NUMERI
164630000627     C   12
164640000627     CANN15
164650000627    2CAN 25              DO
164660050428    3C     VIDNCL        IFLT      SAVNCL
164670000627     C     SAVNCL        SUB       VIDNCL        DIF               5 0
164680000627     C                   SUB       DIF           VIDNCA
164690000627     C* SE COLLO 1 AZZERO SEGNACOLLO AL
164700000627    4C     VIDNCA        IFEQ      VIDNCD
164710000627     C                   Z-ADD     0             VIDNCA
164720000627    4C                   END
164730000627    3C                   END
164740000627     C*
164750000627    3C     VIDNCL        IFGT      SAVNCL
164760000627    3C     SAVLNA        ORNE      VIDLNA
164770111026     c* Routine di memorizzazione vecchi segnacolli per scrittura R.A. prima
164780111026     c* di pulire VIDNCD e VIDNCA
164790111026     c                   exsr      sr_memRA
164800000627     C                   CLEAR                   VIDNCD
164810000627     C                   CLEAR                   VIDNCA
164820000627    3C                   END
164830000627    2C                   END
164840000627     C*
164850000627     C* SE SEGNACOLLI IMMESSI LI MEMORIZZO
164860000627     C*  SE DEVO STAMPARE SEGNACOLLO LI CALCOLO
164870000627    2C     VIDNCD        IFGT      0
164880000627     C                   MOVEL     VIDNCD        BLPNCD
164890000627     C                   MOVEL     VIDNCA        BLPNCA
164900000627   X2C                   ELSE
164910000627     C                   Z-ADD     0             BLPNCD
164920000627     C                   Z-ADD     0             BLPNCA
164930000627     C* PER CREAZIONE SEGNACOLLO
164940000627    3C     §1BFG8        IFEQ      'S'
164950000627    4C   25              DO
164960000627     C                   CLEAR                   AAS
164970000627     C                   Z-ADD     9             CNU
164980000627     C                   Z-ADD     VIDLNP        COMLIN
164990000627     C                   Z-ADD     COMLNA        LIV2
165000000627     C     KNUF2         CHAIN     FLNUF                              3031
165010000627     C*
165020000627     C   30              Z-ADD     0             BLPNCD
165030000627     C   30              Z-ADD     0             BLPNCA
165040000627     C*
165050000627     C     *IN31         IFEQ      *ON
165060000627     C                   SETON                                        90
165070000627     C                   MOVEL     ERR(42)       VIDMSG
165080000627     C                   MOVEL     '1'           WEMFOR
165090000627     C                   GOTO      ENDASS
165100000627     C                   ENDIF
165110000627     C*
165120000627    5C     *IN30         DOWEQ     *OFF
165130000627     C     NUFNUM        ADD       VIDNCL        BLPNCA
165140000627     C* SE SUPERO IL RANGE FINALE RICOMINCIO DA QUELLO INIZIALE
165150000627    6C     BLPNCA        IFGT      NUFRFI
165160000627     C                   Z-ADD     NUFRIN        NUFNUM
165170000627    6C                   END
165180000627     C*
165190000627     C     NUFNUM        ADD       1             COMSCD
165200000627     C     VIDNCL        ADD       NUFNUM        BLPNCA
165210000627     C*
165220000627     C* CONTROLLO SE ESISTONO GIA' SEGNACOLLI IN QUEL RANGE
165230000627     C*
165240000627    6C     COMSCD        DOWLE     BLPNCA
165250000627     C     COMSCD        ANDGT     0
165260120816     C***  KBLT          CHAIN     FNBLT27L                           30
165270120816     C***                if        not %found(fnblt27l)
165280120816     C     KBLT          CHAIN     FIART27L                           30
165290120816     C                   if        not %found(fIART27l)
165300080925     C     KBLT          CHAIN(N)  fiars01l                           30
165310120817     C**                 if        not %found(fiars01l)
165320120817     C**   KBLT          CHAIN     fnart27l                           30
165330120817     c**                 endif
165340080925     c                   endif
165350000627     C  N30              Z-ADD     COMSCD        NUFNUM
165360000627     C  N30              Z-ADD     BLPNCA        COMSCD
165370000627     C                   ADD       1             COMSCD
165380000627    6C                   END
165390000627     C*
165400000627     C   30NUFNUM        ADD       1             BLPNCD
165410000627     C   30              Z-ADD     BLPNCA        NUFNUM
165420000627     C   30              UPDATE    FLNUF
165430000627    5C                   END
165440000627     C*
165450000627     C* SE AL = DAL AZZERO IL CAMPO
165460000627    5C     BLPNCA        IFEQ      BLPNCD
165470000627     C                   Z-ADD     0             BLPNCA
165480000627    5C                   END
165490000627    4C                   END
165500000627     C*
165510000627   X3C                   ELSE
165520000627     C*
165530000627     C* PER BOLLE SENZA SEGNACOLLI
165540000627     C                   CLEAR                   BLPNCD
165550000627     C                   CLEAR                   BLPNCA
165560000627     C                   CLEAR                   BLPFLS
165570000627     C*
165580000627    3C                   END
165590000627    2C                   END
165600000627     C*
165610000627     C     ENDASS        ENDSR
165620000627     C*
165630000627     C* VEDO COME AGGIORNARE IL CAMPO AGGFST -------------------------*
165640000627     C     AGGFST        BEGSR
165650000627     C* ALLEGA BAM
165660000627     C** PER DISK CLIENTI VEDO SE DEVO STAMPARE LA BOLLA
165670000627     C                   EXSR      CTRSTA
165680000627     C**
165690000627     C*  S I    D D T
165700000627     C**
165710000627    1C     VIDBAM        IFEQ      'S'
165720000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
165730000627    2C     §1BFG3        IFEQ      'S'
165740000627     C                   MOVEL     'C'           BLPFST
165750000627     C                   ELSE
165760000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
165770000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
165780000627     C                   MOVEL     'S'           BLPFST
165790000627    2C                   ENDIF
165800000627     C*
165810000627   X1C                   ELSE
165820000627     C**
165830000627     C*  N O    D D T
165840000627     C**
165850000627     C                   SELECT
165860000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
165870000627    2C     §1BFG3        WHENEQ    'S'
165880000627     C                   MOVEL     'K'           BLPFST
165890000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
165900000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
165910000627    2C     §3ATB1        WHENEQ    'A3'
165920000627     C     WSTA          OREQ      ' '
165930000627     C     WSTA          OREQ      'S'
165940000627     C* SE BOLLA F3 FACCIO FINA CHE SIA STAMPATO MA IN REALTA' NON
165950000627     C*  LA STAMPO NEMMENO IN DIFFERITA PERCHE' NON SERVE
165960000627    2C     §3ATB1        OREQ      'F3'
165970000627     C                   MOVEL     'Y'           BLPFST
165980000627     C*
165990000627     C* SE E' BOLLA DPD IMPOSTO FLAG DI GIA' STAMPATO
166000020319     C     A_§OGNTW      WHENEQ    'DPD'
166010000627     C* EXPORT NON DPD, GIA' STAMPATO
166020020319     c     A_§ogntw      oreq      'EEX'
166030081008     c**   A_§ogntw      oreq      'EUP'
166040020319     c     A_§ogntw      oreq      'FED'
166050000627     C* POSTE , GIA' STAMPATO
166060020319     c     §ogntw        oreq      'PPT'
166070040729     c     blpdsp        andlt     §vpoptl
166080000627     C                   MOVEL     'Y'           BLPFST
166090000627   X2C                   OTHER
166100000627     C*
166110000627     C* SE SONO IN VARIAZIONE BOLLA E NON HO MODIFICATO IL FLAG DDT
166120000627     C*  LASCIO QUELLO CHE C'ERA
166130000627     C                   MOVEL     'N'           BLPFST
166140000627    3C     *IN12         IFEQ      *ON
166150000627     C     *IN15         ANDEQ     *OFF
166160000627     C*
166170000627    4C     SAVBAM        IFEQ      'Y'
166180000627     C                   MOVEL     'Y'           BLPFST
166190000627    4C                   ENDIF
166200000627     C* SE ERA DPD E NON LO E' PIU', DEVO METTERE "N" PER FAR
166210000627     C*  STAMPARE LA BOLLA
166220020319    4C     SAVNTW        IFEQ      'DPD'
166230020319     C     A_§OGNTW      ANDNE     'DPD'
166240000627     C                   MOVEL     'N'           BLPFST
166250000627    4C                   ENDIF
166260000627     C* IN MANUTENZIONE DI UN PREPAGATO, IMPOSTO SEMPRE PER DDT NO,
166270000627     C*  DA STAMPARE
166280000627    4C     *IN22         IFEQ      *ON
166290000627     C                   MOVEL     'N'           BLPFST
166300000627    4C                   ENDIF
166310000627    3C                   ENDIF
166320000627     C**
166330000627    2C                   ENDSL
166340000627    1C                   ENDIF
166350000627     C                   ENDSR
166360900504     C*
166370900504     C*--- REGISTRAZIONE BOLLA ---------------------------------------*
166380090623     c     REGIS         begsr
166390940928     C* DPO LA PRIMA BOLLA MI POSIZIONO SEMPRE SUL MITTENTE
166400010222     C* SE ATTIVATA PROCEDURA ORM E SONO IN IMMISSIONE O MANUTENZIONE
166410010306     C* E NON SONO NEL GIRO DEI PREPAGATI MI POSIZIONO SEMPRE SUL N.ORM
166420010222     C     WORM          IFEQ      'S'
166430010222     C     PARTCH        ANDNE     'P'
166440010307     C     §LPFPR        ANDNE     'O'
166450010222     C     *IN12         ANDEQ     *OFF
166460010222     C     WORM          OREQ      'S'
166470010222     C     PARTCH        ANDNE     'P'
166480010307     C     §LPFPR        ANDNE     'O'
166490010222     C     *IN15         ANDEQ     *OFF
166500010222     C                   SETON                                        06
166510010222     C                   ELSE
166520940928     C                   SETON                                        07
166530010222     C                   ENDIF
166540010222     C*
166550950123     C                   CLEAR                   WRD2
166560900507     C* AZZERO CAMPI COMODO
166570940214     C                   CLEAR                   SAVFST
166580991014     C                   CLEAR                   DSLV04
166590991027     C                   CLEAR                   WSV1
166600991027     C                   CLEAR                   WVA1
166610991027     C                   CLEAR                   WSV2
166620991027     C                   CLEAR                   WVA2
166630991027     C                   CLEAR                   WSV3
166640991027     C                   CLEAR                   WVA3
166650001019     C                   CLEAR                   WSTSGN
166660070604     c                   clear                   wmsg_pda          1
166670070606     c                   clear                   w02pdr_p
166680111026     c                   clear                   RA_ncd
166690111026     c                   clear                   RA_nca
166700111026     c                   clear                   RA_ncl
166710111026     c                   clear                   RA_lna
166720941108     C*
166730930331     C*  VALORE POSITIVO DEI CAMPI NUMERI A VIDEO
166740920505     C                   MLLZO     1             VIDPOR
166750940926     C                   MLLZO     1             VIDNFT
166760940926     C                   MLLZO     1             VIDFIV
166770940926     C                   MLLZO     1             VIDRMN
166780940926     C                   MLLZO     1             VIDCAS
166790940825     C                   MLLZO     1             VIDIAS
166800940926     C                   MLLZO     1             VIDQFT
166810920505     C                   MLLZO     1             VIDNCD
166820920505     C                   MLLZO     1             VIDNCA
166830920505     C                   MLLZO     1             VIDHCR
166840940926     C                   MLLZO     1             VI2VA1
166850040116     c                   Mllzo     1             Vi2Va2
166860040116     c                   Mllzo     1             Vi2Va3
166870040116     c                   Mllzo     1             Vi2Va4
166880041217     c                   Mllzo     1             Vi2Va5
166890041217     c                   Mllzo     1             Vi2Va6
166900021218     c                   Mllzo     1             VidNba
166910021218     c                   Mllzo     1             VidNb2
166920060209     c* Le seguenti specifiche le ho spostate più sotto per permettere
166930060209     c* la storicizzazione delle variazioni dei prepagati, non potendo
166940060209     c* storicizzare ora dal momento che ci possono essere dei casi
166950060209     c* di uscita dalla routine senza registrare la bolla (v. goto
166960060209     c* endreg)
166970991006      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
166980991006      * IN FIAR700F
166990060209     C**   WAR7          IFEQ      'E'
167000060209     c**   war61         oreq      'E'
167010060209     c**   wkscsf1       andne     0000
167020060209     c**   wkscsf1       andne     9999
167030060209     C**                 MOVEL     '1'           WTRC
167040060209     C**   KBLP4         SETLL     FIAR7000
167050060209     C**   KBLP4         READE     FIAR7000                               30
167060991006      *
167070060209    2C**   *IN30         DOWEQ     *OFF
167080060209     C**                 DELETE    FIAR7000
167090060209     C**   KBLP4         READE     FIAR7000                               30
167100060209    2C**                 ENDDO
167110991006      *
167120060209     C**                 ENDIF
167130040116      * anche per la seconda bolla
167140060209if  1c****               If        War71 = 'E' or (war62 = 'E' and
167150060209     c****                         wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
167160060209     c****               Eval      Wtrc = '2'
167170060209     c**** Kblp4         Setll     Fiar7000
167180060209do  2c****               Do        *Hival
167190060209     c**** Kblp4         Reade     Fiar7000
167200060209     c****               If        %Eof(Fiar701l)
167210060209     c****               Leave
167220060209     c****               EndIf
167230060209     c****               Delete    Fiar7000
167240060209    2c****               EndDo
167250060209    1c****               EndIf
167260941115     C* PULISCO I FORMATI
167270060209     C***                CLEAR                   FIAR6000
167280060209     C***                CLEAR                   FIAR7000
167290051115     C                   CLEAR                   Fiar9000
167300900507     C*
167310900504     C                   Z-ADD     VIDLNP        BLPLNP
167320900504     C                   MOVEL     BLPDSP        BLPAAS
167330900504     C                   MOVE      VIDNRS        BLPNRS
167340940926     C                   MOVE      BLPDSP        BLPMGS
167350940926     C                   MOVEL     VIDCBO        BLPCBO
167360920410     C*
167370920410     C* DISK CLI: SE NON SI ASSEGNA NUMERAZ. SEGNAC. AZZERO SERIE
167380930628     C   12
167390930628    1CAN 15§1BFG2        IFEQ      'N'
167400980410     C     §1BFG6        ANDNE     'C'
167410910606     C                   Z-ADD     0             BLPNRS
167420950525     C* SE IL CTM ERA "%" --> IMPOSTO "§"
167430000214    2C     VIDSOP        IFEQ      '%'
167440950525     C                   MOVEL     '§'           VIDSOP
167450000214     C* SE E' DISK "C"    --> IMPOSTO ":"
167460050223     C     *IN79         IFEQ      *ON
167470050223    3C     WASDKC        ANDEQ     'S'
167480050223     C     §3CDKC        ANDEQ     'S'
167490000905     C     §1BF12        ORNE      'N'
167500001106     C     §1BF12        ANDNE     'E'
167510001106     C     §1BF12        OREQ      'E'
167520001106     C     WASDKC        ANDEQ     'S'
167530000214     C                   MOVEL     ':'           VIDSOP
167540000214    3C                   ENDIF
167550000214    2C                   ENDIF
167560950525    1C                   ENDIF
167570001013     C* SE VENGO DA CONFERMA DA DISCHETTO E NON È DISK B METTO SOP=: SE
167580001013     C* E' DISK C
167590001013     C   12
167600001013     CAN 15§1BFG1        IFNE      'S'
167610001013     C     WASDKC        ANDEQ     'S'
167620001013     C     §1BF12        ANDNE     'N'
167630001013     C                   MOVEL     ':'           VIDSOP
167640001013     C                   ENDIF
167650930624     C***
167660930624     C***   N U M E R O   S P E D I Z I O N E
167670920415     C                   SETOFF                                       30
167680921012     C* IN IMMISSIONE : SE NON E' BOLLA DI RECUPERO
167690990602    1C  N12PARTCH        IFEQ      'R'
167700921006     C                   Z-ADD     RECNSP        BLPNSP
167710930628   X1C                   ELSE
167720921006     C                   SETON                                        30
167730930628    1C                   END
167740921012     C*
167750921005     C* IN DISK CLI :  SE NON SI STAMPA LA BOLLA
167760921012     C*                O NON E' BOLLA DI RECUPERO
167770921012     C*                O NON MANTIENE NUM SPEDIZIONE
167780930628     C   12
167790930628    1CAN 15§1BFG3        IFNE      'S'
167800921005     C*
167810930628    2C     §3CFSP        IFEQ      'S'
167820921012     C     §1BFG2        ANDEQ     'S'
167830921012     C     §LPFPR        OREQ      'R'
167840971104     C**
167850971104    3C     VIDNSP        IFGT      0
167860921005     C                   Z-ADD     VIDNSP        BLPNSP
167870971104   X3C                   ELSE
167880971104     C** SE MANCA LO RIASSEGNO
167890971104     C** SE L'HO AZZERATO IN CARICAMENTO LO RIPRENDO DA DS
167900971104    4C     §LPNSP        IFGT      0
167910971104     C                   Z-ADD     §LPNSP        BLPNSP
167920971104     C                   ELSE
167930971104     C                   SETON                                        30
167940971104    4C                   ENDIF
167950971104    3C                   ENDIF
167960971104     C***
167970971104    3C     VIDNRS        IFEQ      0
167980971104     C                   Z-ADD     §LPNRS        BLPNRS
167990971104    3C                   ENDIF
168000971104     C**
168010930628   X2C                   ELSE
168020920415     C                   SETON                                        30
168030930628    2C                   END
168040921005     C*
168050930628   X1C                   ELSE
168060921005     C*
168070920421     C                   Z-ADD     VIDNSP        BLPNSP
168080930628    1C                   END
168090920415     C*
168100930628    1C     *IN30         IFEQ      *ON
168110951228     C                   MOVE      VIDDSP        AAS
168120910117     C                   Z-ADD     3             CNU
168130910117     C                   Z-ADD     VIDLNP        COMLIN
168140000509     C                   CLEAR                   WNUF2
168150000509     C* SE LNP POSTE METTO ANCHE LA SERIE ON CHIAVE
168160020319     C     §ogntw        IFEQ      'PPT'
168170000509     C                   Z-ADD     VIDNRS        WNUF2
168180000509     C                   ENDIF
168190921006     C* CHAIN FINO A QUANDO NON TROVO UN NUMERO LIBERO
168200930628    2C     *IN30         DOWEQ     '1'
168210000509     C     KNUFSP        CHAIN     FLNUF                              3031
168220951228     C* SE NON TROVATO IL NUMERATORE PROVO A CREARLO
168230000627     C*  NON LO FACCIO PER POSTE
168240020319     C     §ogntw        IFNE      'PPT'
168250000627     C     *IN30         ANDEQ     *ON
168260951228     C                   Z-ADD     CNU           PA4CNU
168270951228     C                   CALL      'FNLVCNR'
168280951228     C                   PARM                    PA4CNU
168290000509     C     KNUFSP        CHAIN     FLNUF                              3031
168300951228     C                   ENDIF
168310951228     C*
168320951228     C* SE ANCORA NON TROVATO ERRORE
168330940923     C   30              SETON                                        90
168340940923     C   30              MOVEL     ERR(39)       VIDMSG
168350020320     C* RECORD ALLOCATO
168360940923     C   31              SETON                                        90
168370940923     C   31              MOVEL     ERR(42)       VIDMSG
168380951228     C* PER ERRORE ESCO
168390950508     C   90              MOVEL     '1'           WEMFOR
168400921006     C   90              GOTO      ENDREG
168410921006     C*
168420900824     C                   ADD       1             NUFNUM
168430900824     C                   UPDATE    FLNUF
168440921006     C                   Z-ADD     NUFNUM        RECNSP
168450921006     C*
168460921006     C* 30 ON - SPED ESISTENTE FACCIO NUOVA CHAIN
168470940915     C     KNSP          SETLL     FNBLP01L                               30
168480040329      * devo controllare anche su titas che non ci sia già
168490040329      * una spedizione con lo stesso numero
168500040329     c                   If        Not *In30 and %Open(Titas30c)
168510040329     c     kNsp          Chain(n)  Titas30c
168520040329     c                   If        %Found(Titas30c)
168530040329     c                   Eval      *In30 = *On
168540040329     c                   EndIf
168550040329     c                   EndIf
168560040329
168570921006     C  N30              MOVEL     NUFNUM        BLPNSP
168580930628    2C                   ENDDO
168590040727   x1c                   Else
168600040727      * se bolla già presente su TITAS emetto errore bloccante
168610040727     c                   If        %Open(Titas30c)
168620040727     c                   Eval      recnsp = BlpNsp
168630040727     c     kNsp          Chain(n)  Titas30c
168640040727     c                   If        %Found(Titas30c)
168650040727     c                   Eval      VidMsg = Err(55)
168660040727     c                   Eval      *In90 = *On
168670040727     c                   Eval      wemfor = '1'
168680040727     c                   Goto      EndReg
168690040727     c                   EndIf
168700040727     c                   EndIf
168710930628    1C                   ENDIF
168720920410     C*
168730900827     C   12
168740900827     CANN15              MOVEL     VIDNSP        BLPNSP
168750940926     C*
168760940926     C* MEMORIZZO I CAMPI IMPOSTATI A VIDEO: SE BOLLA CON MAMMA
168770940926     C*  NON LI MEMORIZZO MA STAMPO SOLTANTO
168780051115     C                   MOVEL     VIDCAS        ar9CAS
168790011108     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO CONTRASSEGNO > 0
168800011108     C     VIDCAS        IFGT      *ZEROS
168810051115     C                   MOVEL     VIDVCA        ar9VCA
168820011113     C                   ELSE
168830051115     C                   CLEAR                   ar9VCA
168840011108     C                   ENDIF
168850050518     c* Se = *blanks, e forzabile da tabella TM --> forzo
168860051115     C                   MOVEL     VIDTIC        ar9TIC
168870091001     c                   clear                   w_ar5tic
168880111213     c                   if        vidcas>0
168890121022     c* per spedizioni export non valgono le seguenti forzature ma
168900121022     c* pilotano i tipi incasso abilitati come da tabella "1AX"
168910121022     c                             and a_§ogntw<>'DPD'
168920121022     c                             and a_§ogntw<>'EEX'
168930121022     c                             and a_§ogntw<>'FED'
168940071011     c                   select
168950071011     c                   when      vidtic=*blanks and §TMFTI<>*BLANKS
168960051115     C                   MOVEL     §TMfti        ar9tic
168970080625     C                   MOVEL     §TMfti        vidtic
168980090706     c* frozatura per destinatario particolare
168990111213     c                   when      vidtic=*blanks and
169000091002     c                             ot0err=*blanks and OT0X1TICF<>*blanks
169010090706     C                   MOVEL     OT0X1TICF     ar9tic
169020090706     C                   MOVEL     OT0X1TICF     vidtic
169030091001     c                   movel     ot0x1ticf     w_ar5tic
169040111213     c                   when      vidtic=*blanks
169050071008     c* Se = *blanks, e forzabile da tabella FSC --> forzo
169060090619     c* Se cliente abilitato da tabella CIC non devo forzare
169070090619     C                   CLEAR                   dsbs02
169080090619     C                   MOVEL     'C'           T02MOD
169090090619     C                   MOVEL     KNSIF         T02SIF
169100090619     C                   MOVEL     'CIC'         T02COD
169110090619     c                   if        vidflc=0
169120090622     c                   eval      t02ke1=%editc(vidlnp:'X')+%editc(vidccm:'X')
169130090619     c                   else
169140090619     c                   eval      t02ke1=%editc(vidflc:'X')+%editc(vidccm:'X')
169150090619     c                   endif
169160090619     C                   CALL      'TIBS02R'
169170090619     C                   PARM                    KPJBA
169180090619     C                   PARM                    dsbs02
169190090619      * Cliente non presente in tabella "CIC"
169200090619     c                   if        t02err<>*blanks
169210071008     C                   CLEAR                   dsbs02
169220071008     C                   MOVEL     'C'           T02MOD
169230071008     C                   MOVEL     KNSIF         T02SIF
169240071008     C                   MOVEL     'FSC'         T02COD
169250071008     c                   movel(P)  comlna        t02ke1
169260071008     C                   CALL      'TIBS02R'
169270071008     C                   PARM                    KPJBA
169280071008     C                   PARM                    dsbs02
169290071008    2C                   IF        T02ERR = *BLANKS and t02atb=*blanks
169300071008     C                   movel     'SC'          ar9tic
169310080625     C                   movel     'SC'          vidtic
169320071008    2C                   ENDIF
169330090619     c                   endif
169340071011     c                   endsl
169350111213     c                   endif
169360050518     c
169370941005     C***
169380941005     C***   N U M E R O   S E G N A C O L L I
169390941005     C                   MOVEL     WFLS          BLPFLS
169400971211     C                   MOVEL     COMLNA        VIDLNA
169410940926     C*
169420940926     C* MEMORIZZO SEGNACOLLI SE BOLLA SENZA MAMMA
169430940926    1C     §3ABCM        IFEQ      ' '
169440000627     C* ASSEGNO NUMERO DI SEGNACOLLI
169450000627     C                   EXSR      ASSSGN
169460000627     C     WEMFOR        IFEQ      '1'
169470000627     C                   GOTO      ENDREG
169480000627     C                   ENDIF
169490940926     C*
169500940926   X1C                   ELSE
169510940926     C* BOLLA CON MAMMA
169520950215     C                   CLEAR                   BLPFLS
169530940926     C                   CLEAR                   BLPNCD
169540940926     C                   CLEAR                   BLPNCA
169550051115     C                   CLEAR                   ar9TIC
169560051115     C                   CLEAR                   ar9CAS
169570051115     C                   CLEAR                   ar9VCA
169580940926    1C                   ENDIF
169590020320     c* Se bolla Export FedEx prelevo numeri AWB
169600020320     c     A_§ogntw      ifeq      'FED'
169610020320     c                   clear                   wawbini
169620020320     c* devo assegnare numeri awb fedex in immissione o conferma bolle
169630020320     c* SEMPRE oppure in manutenzione se è aumentato il numero dei colli
169640020320     c* oppure se è cambiata la linea di arrivo e la precedente era una
169650020320     c* linea non fedex
169660020320     c     *in12         ifeq      *off
169670020320     c     *in15         oreq      *on
169680020320     c     *in15         oreq      *off
169690020320     C     vidncl        andgt     savncl
169700020320     c     *in15         oreq      *off
169710020320     C     savntw        andne     'FED'
169720020320     c                   clear                   trul33ds
169730020320     c                   z-add     21            i33cnu
169740020320     c                   z-add     vidncl        i33num
169750020320     c                   movel     trul33ds      kpjbu
169760020320     c                   call      'TRUL33R'
169770020320     c                   PARM                    kpjba
169780020320     c                   movel     kpjbu         trul33ds
169790020320     c* se errore vado a fine routine
169800020320     c     o33err        ifgt      *zeros
169810020320     c                   seton                                        90
169820020320     c                   movel     '1'           wemfor
169830020320     c                   select
169840020320     c     o33err        wheneq    1
169850020320     c                   movel     err(250)      vidmsg
169860020320     c     o33err        wheneq    2
169870020320     c                   movel     err(251)      vidmsg
169880020320     c     o33err        wheneq    3
169890020320     c                   movel     err(252)      vidmsg
169900020320     c                   endsl
169910020320     c                   goto      endreg
169920020320     c                   endif
169930020320     c                   z-add     o33nri        wawbini
169940020320     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
169950051102     c* del ARS trk "F"
169960020320     c                   z-add     wawbini       wawb
169970020320     c                   endif
169980020320     c                   endif
169990010228     C* SE SONO IN IMMISSIONE DEI MIEI PREPAGATI RICHIAMO PGM DI IMM.
170000010227     C* ORM
170010010227     C     PARTCH        IFEQ      'P'
170020010227     C     VIDMAG        ANDNE     'S'
170030010307     C     WORM          ANDEQ     'S'
170040010713     C     §3ARBL        ANDNE     'R'
170050010227     C                   EXSR      RIEO05
170060010228     C                   CLEAR                   KPJBU
170070010227     C                   CALL      'FIOR05R'
170080010227     C                   PARM                    KPJBA
170090010228     C                   PARM                    DSOR05
170100010227     C* SE PREMUTO F3 VADO A FINE ROUTINE E RIEMETTO LA VIDEATA
170110010227     C     §RMERR        IFEQ      '3'
170120010227     C                   MOVEL     '1'           WEMFOR
170130010227     C                   GOTO      ENDREG
170140010227     C                   ENDIF
170150010227     C                   ENDIF
170160001024     C*
170170060215     C* SE ANNO SPEDIZIONE E ANNO DI VAD SONO <> SISTEMO Fiar4 E
170180970107     C*  EDRDE01L
170190060215     c* 15/02/2006: Non si deve più aggiornare ar4 perchè è stato
170200060215     c* sostituito dal vat. Bisogna però continuare ad aggiornare EDRDE
170210060215     c* per bolle import
170220060215     C*****              CLEAR                   WESRDE
170230970107     C   12
170240970107    1CAN 15§1BFG3        IFEQ      'S'
170250970107     C*
170260970107     C     §3CFSP        OREQ      'S'
170270970107     C     §1BFG2        ANDEQ     'S'
170280970107     C*
170290060216     C* SE NON C'E' IL VAD RICONTROLLO KAAS CON Fiar4
170300060216     c* non serve più: ora l'informazione viene passata col vat
170310970107     C*
170320970407    2C     §LPAAC        IFNE      §LPAAS
170330060215     C**   KBLC4         CHAIN     Fiar401L                           31
170340060215    3C**   *IN31         DOWEQ     *OFF
170350060215     C**                 Z-ADD     §LPAAS        ar4AAS
170360060215     C**                 UPDATE    Fiar4000
170370060215     C**                 MOVEL     'S'           WESRDE            1
170380060215     C***  KBLC4         READE     Fiar401L                               31
170390060215    3C**                 ENDDO
170400970107     C*
170410060215    3C**** WESRDE        IFEQ      'S'
170420060215    3c                   if        §ogntw = 'EEX' or §ogntw = 'FED' or
170430081008     c                             §ogntw = 'DPD'
170440970107     C**
170450970107    4C     WOPRDE        IFEQ      ' '
170460970107     C                   OPEN      EDRDE01L
170470970107     C                   MOVEL     'S'           WOPRDE            1
170480970107    4C                   ENDIF
170490970107     C**
170500970107     C     KBLC4         CHAIN     EDRDE01L                           31
170510970107    4C     *IN31         DOWEQ     *OFF
170520970107     C                   Z-ADD     §LPAAS        RDEAAS
170530970107     C                   UPDATE    EDRDE000
170540970107     C     KBLC4         READE     EDRDE01L                               31
170550970107    4C                   ENDDO
170560970107    3C                   ENDIF
170570970107    2C                   ENDIF
170580970107     C*
170590970107    1C                   ENDIF
170600060209     c*
170610060209     c* STORICIZZAZIONI PER PREPAGATI
170620060209     c* Se cvb <> *blanks significa che è stata richiesta una variazione
170630060209     c* da gestire
170640060209     c                   if        ilv85cvb <> *blanks
170650060209     c* -- Storicizzazione variazione --
170660060209     c                   if        §7lfsa = 'S'
170670060209     c* se variazione da storicizzare e si tratta di variazione di
170680060209     c* tassazione memorizzo fiar6 e fiar7 prima di cancellare
170690060209     c* La write verrà eseguita prima della write di fnblp
170700060209     c                   if        ilv85cvb = 'TR'
170710060209     c                   clear                   fiarbt00
170720060209     c                   movel     knmus         arbpru
170730060209     c                   z-add     dateu         arbdtv
170740060209     c                   time                    arborv
170750060209     c                   movel     ilv85cvb      arbcvb
170760060209     c                   movel     '1'           arbtrc
170770060209     c                   exsr      stoarb
170780060209     c                   endif
170790060209     c                   endif
170800060209     c* -- Storicizzazione motivo variazione --
170810060209     c                   if        §7lmtv = 'S'
170820070604     c*                  movel     'L'           ilv85tla
170830070604     c                   movel     ' '           ilv85tla
170840060209     c                   movel     'R'           ilv85tel
170850060209     c                   z-add     arbdtv        ilv85dac
170860060209     c                   z-add     arborv        ilv85orc
170870060209     c                   z-add     blpaas        ilv85aas
170880060209     c                   z-add     blplnp        ilv85lnp
170890060209     c                   z-add     blpnrs        ilv85nrs
170900060209     c                   z-add     blpnsp        ilv85nsp
170910060307     c                   movel     olv85mtv      ilv85mtv
170920060307     c                   movel     olv85nt1      ilv85nt1
170930060307     c                   movel     olv85nt2      ilv85nt2
170940060209     c                   movel     fnlv85ds      kpjbu
170950060209     c                   call      'FNLV85R'
170960060209     c                   parm                    kpjba
170970060210     c                   movel     kpjbu         fnlv85ds
170980060209     c                   endif
170990060209     c                   endif
171000060209      *
171010060209      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
171020060209      * IN FIAR700F
171030060209     C     WAR7          IFEQ      'E'
171040060209     c     war61         oreq      'E'
171050060209     c     wkscsf1       andne     0000
171060060209     c     wkscsf1       andne     9999
171070060209     C                   MOVEL     '1'           WTRC
171080060209     C     KBLP4         SETLL     FIAR7000
171090060209     C     KBLP4         READE     FIAR7000                               30
171100060209      *
171110060209    2C     *IN30         DOWEQ     *OFF
171120060209     C                   DELETE    FIAR7000
171130060209     C     KBLP4         READE     FIAR7000                               30
171140060209    2C                   ENDDO
171150060209      *
171160060209     C                   ENDIF
171170060209      * anche per la seconda bolla
171180060209if  1c                   If        War71 = 'E' or (war62 = 'E' and
171190060209     c                             wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
171200060209     c                   Eval      Wtrc = '2'
171210060209     c     Kblp4         Setll     Fiar7000
171220060209do  2c                   Do        *Hival
171230060209     c     Kblp4         Reade     Fiar7000
171240060209     c                   If        %Eof(Fiar701l)
171250060209     c                   Leave
171260060209     c                   EndIf
171270060209     c                   Delete    Fiar7000
171280060209    2c                   EndDo
171290060209    1c                   EndIf
171300060209     C* PULISCO I FORMATI
171310060209     C                   CLEAR                   FIAR6000
171320060209     C                   CLEAR                   FIAR7000
171330940926     C***
171340941108     C*
171350940926     C***  T O T A L E   F A T T U R A
171360940926    1C     VIDNFT        IFGT      0
171370990630     C     *IN34         OREQ      *ON
171380941108     C*
171390120109     c* Qui non viene impostato comdft prima di richiamare totfat
171400120109     c* In caso di immissione di un prepagato il comdft in questo
171410120109     c* momento è = 0 (viene azzerato all'uscita dal FNLV16R) e
171420120109     c* viene quindi passata data fattura=0 al pgm fnlv04r.
171430120109     c* Nei periodi a cavallo di cambio aliquota IVA non è comunque
171440120109     c* un problema visto che il pgm FNLV04R se riceve data fattura=0,
171450120109     c* sceglie l'aliquota iva per il calcolo in base alla data del giorno
171460990630     C                   EXSR      TOTFAT
171470941108     C*
171480941108     C* SE E' UN ASSEGNATO MEMORIZZO TUTTI I CAMPI DELLA TASSAZIONE
171490990629     C*  OPPURE SE E' UN PREPAGATO
171500941108     C     *IN04         IFEQ      *ON
171510990629     C     *IN34         OREQ      *ON
171520941108     C                   ADD       D04BOL        DB0ESE
171530941108     C                   Z-ADD     D04IFT        DB0IFT
171540990701     C                   Z-ADD     D04IVA        DB0IVA
171550990701     C                   Z-ADD     D04IMV        VIDIMV
171560991130     C                   Z-ADD     VIDIMV        DB0IMV
171570990630     C                   Z-ADD     D04POR        VIDPOR
171580991014     C                   Z-ADD     D04POR        MEMPOR
171590941108    2C                   ENDIF
171600990630     C**
171610990630     C* REPERISCO: PO IVA, NUMERO E DATA FATTURA
171620990630    2C     *IN34         IFEQ      *ON
171630990630     C     KNUM          CHAIN     CNNUM000                           30
171640990630    3C     *IN30         IFEQ      *OFF
171650990630     C                   ADD       1             NUMNUM
171660990630     C                   Z-ADD     NUMNUM        VIDNFT
171670990630     C                   MOVE      DATEU         NUMDTP
171680990630     C                   UPDATE    CNNUM000
171690990630   X3C                   ELSE
171700990630     C                   Z-ADD     0             VIDNFT
171710990630    3C                   ENDIF
171720990630     C                   Z-ADD     FIV           VIDFIV
171730990630     C                   Z-ADD     DATEU         COMDFT
171740990630    2C                   ENDIF
171750941108    1C                   ENDIF
171760940926     C*
171770940926     C* SE ESISTE ALMENO UNA VARIA LEGGO IL SFL E GIA' CHE CI SONO
171780940926     C*  IMPOSTO GIA' I CAMPI DELLA TASSAZIONE
171790940926     C                   Z-ADD     1             NRR
171800941108     C                   Z-ADD     1             C
171810991014    1C     WESVAR        IFNE      ' '
171820940926     C*
171830941108    2C                   DO        20            NRR
171840940926     C     NRR           CHAIN     LS01S03                            30
171850991014      *
171860941108    3C     *IN30         IFEQ      *OFF
171870941108     C     V3CSV1        ANDNE     ' '
171880991014      * ESENTE: SOMMO AL TOTALE FATTURA SE E' DA IMPOSTARE
171890940926    4C     V3CEV1        IFNE      ' '
171900940926     C     VIDNFT        ANDGT     0
171910941108     C                   ADD       V3CVA1        DB0ESE
171920991130     C                   SUB       V3CVA1        DB0IMV
171930940926    4C                   ENDIF
171940991014      * SCRIVO VARIE
171950991014     C                   EXSR      WRTVAR
171960940926    3C                   ENDIF
171970940926    2C                   ENDDO
171980991014      *
171990940926    1C                   ENDIF
172000991014      *
172010991014      * SE IMPOSTATA L'IVA SCRIVO VARIA
172020991014     C     D04IVA        IFGT      *ZEROS
172030991014     C                   MOVEL     §$2IVA        V3CSV1
172040991014     C                   Z-ADD     D04IVA        V3CVA1
172050991014     C                   EXSR      WRTVAR
172060991014     C                   ENDIF
172070991014      * SE IMPOSTATO IL BOLLO SCRIVO VARIA, IN DB0ESE è GIA' STATA SOMMATA
172080991014     C     D04BOL        IFGT      *ZEROS
172090991014     C                   MOVEL     §$2BOL        V3CSV1
172100991014     C                   Z-ADD     D04BOL        V3CVA1
172110991014     C                   EXSR      WRTVAR
172120991014     C                   ENDIF
172130991027      *
172140991027      * SE PIENA UNA VARIA O ANTICIPATA O NUMERO FATTURA O PORTO
172150991027      *  O INOLTRO O DIRITTO FISSO O ESENZ.IVA  --> SCRIVO FIAR600F
172160991006      *
172170991006      * Se agganciata precedentemente riaggancio file tassazione per 1a bolla
172180991006     C     WAR61         IFEQ      'E'
172190991006     C                   MOVEL     '1'           WTRC
172200050331     c* se presente cod.Segue fattura significa che era stata tassata
172210050331     c* in arrivo --> DELETO la tassazione dell'arrivo
172220050331     c                   if        wKSCsf1 <> 0000 and wKSCsf1 <> 9999
172230050331     c     kblp4         delete    fiar6000
172240050331     c                   clear                   war61
172250050331     c                   else
172260991006     C     KBLP4         CHAIN     FIAR6000                           30
172270050331     c                   endif
172280991006     C                   ENDIF
172290991006      *
172300941108    1C     VIDDFT        IFGT      0
172310051116     C     wsv1          ORNE      ' '
172320051116     C     wsv2          ORNE      ' '
172330051116     C     wsv3          ORNE      ' '
172340051116     C     VIDCEI        ORNE      ' '
172350940926     C     VIDPOR        ORNE      0
172360991202     C*          VIDANT    ORNE 0
172370991006     C                   MOVEL     '1'           AR6TRC
172380991006     C                   Z-ADD     BLPAAS        AR6AAS
172390991006     C                   Z-ADD     BLPLNP        AR6LNP
172400991006     C                   Z-ADD     BLPNRS        AR6NRS
172410991006     C                   Z-ADD     BLPNSP        AR6NSP
172420991006     C                   Z-ADD     VIDPOR        AR6POR
172430991006     C                   Z-ADD     VIDIMV        AR6IMV
172440991006     C                   MOVEL     VIDCEI        AR6CEI
172450991027      *
172460991027     C                   MOVEL     WSV1          AR6SV1
172470991027     C                   Z-ADD     WVA1          AR6VA1
172480991027     C                   MOVEL     WSV2          AR6SV2
172490991027     C                   Z-ADD     WVA2          AR6VA2
172500991027     C                   MOVEL     WSV3          AR6SV3
172510991027     C                   Z-ADD     WVA3          AR6VA3
172520991027      *
172530120104      * L'aliquota iva la memorizzo solo se presente numero fattura
172540991006      * SE ESENZIONE NON MEMORIZZO L'ALIQUOTA
172550120104     c                   if        vidnft>0
172560941108    2C     VIDCEI        IFEQ      *BLANKS
172570120109     c                   if        comdft>§qtdsa
172580991006     C                   Z-ADD     §QTALI        AR6ALI
172590120104     c                   else
172600120104     C                   Z-ADD     §QTALO        AR6ALI
172610120104     c                   endif
172620941108   X2C                   ELSE
172630991006     C                   MOVEL     *ZEROS        AR6ALI
172640941108    2C                   ENDIF
172650120104     c                   endif
172660991006     C                   Z-ADD     D04IFT        AR6IFT
172670991006     C                   Z-ADD     VIDFIV        AR6FIV
172680991006     C                   Z-ADD     VIDNFT        AR6NFT
172690991006     C                   Z-ADD     COMDFT        AR6DFT
172700991015     C                   MOVEL     VIDDIV        AR6DIV
172710991015      * IMPOSTO FLAG DI TOTALE IMPONIBILE INSERITO IN PARTENZA
172720991015     C     AR6IMV        IFGT      *ZEROS
172730991015     C                   MOVEL     'P'           AR6FIM
172740991015     C                   ELSE
172750991015     C                   CLEAR                   AR6FIM
172760991015     C                   ENDIF
172770991015      * PER ASSEGNATI IMPOSTO CODICE DI FATTURAZIONE
172780991015     C                   CLEAR                   AR6CTR
172790991015     C     *IN04         IFEQ      *ON
172800991022     C                   MOVE      9999          AR6KSC
172810991022     C                   MOVEL     AR6LNP        AR6KSC
172820991015     C                   ELSE
172830991015     C                   CLEAR                   AR6KSC
172840991015     C                   ENDIF
172850991006      *
172860991015      *
172870991006     C     WAR61         IFEQ      'E'
172880991006     C                   UPDATE    FIAR6000
172890940926     C                   ELSE
172900991006     C                   WRITE     FIAR6000
172910940926     C                   ENDIF
172920941108     C*
172930941108     C* DATI PER STAMPA
172940990629     C* PER ASEGNATO O FRANCO PREPAGATO
172950941108     C     *IN04         IFEQ      *ON
172960990629     C     *IN34         OREQ      *ON
172970941108     C                   MOVEL     VIDCEI        DB0CEI
172980991014     C                   MOVEL     V3DCEI        DB0DCE
172990991014     C                   MOVEL     VIDDIV        DB0DIV
173000991014     C                   MOVEL     WFDC1         DB0FDC
173010941108     C                   Z-ADD     VIDIMV        DB0IMV
173020941108     C                   ENDIF
173030021209      * Per prepagato stampo sempre i dati della fattura
173040021209     c                   If        *In34
173050941108     C                   Z-ADD     VIDNFT        DB0NFT
173060941108     C                   Z-ADD     COMDFT        DB0DFT
173070941108     C                   ENDIF
173080940926     C*
173090940926   X1C                   ELSE
173100991006     C* SE NON DEVO SCRIVERE IL RECORD FIAR6 E C'ERA --> DELETO
173110991006    2C     WAR61         IFEQ      'E'
173120991006     C                   DELETE    FIAR6000
173130940926    2C                   ENDIF
173140940926    1C                   ENDIF
173150930624     C***
173160940919     C***  F L A G   I N O L T R O
173170940628     C                   EXSR      INOLTR
173180940628     C                   MOVEL     WFIN          BLPFIN
173190930624     C***
173200930624     C***  L I N E A   D I   A R R I V O
173210940628     C                   MOVEL     COMLNA        BLPLNA
173220930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
173230941107     C* CAMPI PER LA STAMPA BOLLA
173240941107     C                   MOVEL     ORGFAG        DB0FAG
173250941107     C                   MOVEL     ORGDES        DB0DLA
173260941107     C                   MOVEL     ORGIND        DB0INL
173270941107     C                   MOVEL     ORGLOC        DB0LOL
173280941107     C                   MOVEL     ORGPRO        DB0PRL
173290941107     C                   MOVEL     ORGTEL        DB0TEL
173300941107     C                   MOVEL     ORGFAX        DB0FAX
173310100319     c* Mancava l'impostazione del CAP db0CAL ma lo lascio vuoto perchè
173320100319     c*  così capiamo che si tratta di LVD stampata in partenza che
173330100319     c*  non dovrebbe mai essere usata per la consegna
173340941107     C*
173350910426     C* DESCRIZIONE LINEA ARRIVO PER SEGNACOLLO
173360930628    1C     ORGDE5        IFNE      *BLANKS
173370000208     C                   MOVEL     ORGDE5        WDLA
173380910426     C                   ELSE
173390000208     C                   MOVEL     ORGDES        WDLA
173400930628    1C                   END
173410001024     C                   MOVE      COMTFA        BLPTFA
173420971202     C* BLPFEA: TERMINAL DI PARTENZA DELLA LINEA DI ARRIVO
173430971202     C                   CLEAR                   DSLV55
173440971202     C                   MOVEL     'P'           D55TPT
173450971202     C                   MOVEL     COMLNA        D55LIN
173460971202     C                   MOVEL     BLPDSP        D55DRF
173470971202     C                   CALL      'FNLV55R'
173480971202     C                   PARM                    DSLV55
173490971202     C     D55ERR        IFEQ      ' '
173500971202     C                   MOVEL     D55TFP        BLPFEA
173510971202     C                   ELSE
173520971202     C                   MOVEL     COMLNA        BLPFEA
173530971202     C                   ENDIF
173540910201     C*
173550971202     C* TERMINAL DI PARTENZA
173560960130     C                   MOVEL     COMTFP        BLPTFP
173570111128     C                   MOVEL     comtfp        BLPFLE
173580940919     C***
173590940919     C***  M I T T E N T E
173600940919     C* SE ASSEGNATO SCRIVO 9999 NEL CODICE SPEDIZIONE
173610940919     C*  E IL MITTENTE, SE CODIFICATO, IN BLPCCM
173620940919     C                   CLEAR                   BLPCCM
173630940919    1C     *IN04         IFEQ      *ON
173640940919     C                   Z-ADD     9999          BLPKSC
173650940919     C                   MOVEL     BLPLNP        BLPKSC
173660940919     C*
173670940919    2C     VIDCCM        IFNE      9999
173680940919     C                   Z-ADD     VIDCCM        BLPCCM
173690940919     C*
173700940927    3C     VIDFLC        IFEQ      0
173710940919     C                   MOVEL     VIDLNP        BLPCCM
173720940919     C                   ELSE
173730940919     C                   MOVEL     VIDFLC        BLPCCM
173740940927    3C                   ENDIF
173750940927    2C                   ENDIF
173760940919    1C                   ENDIF
173770940919     C*
173780940919     C* SE FRANCO CODICE SEMPRE IL BLPKSC
173790941103     C     *IN04         IFEQ      *OFF
173800940919     C                   Z-ADD     VIDCCM        BLPKSC
173810940919     C     VIDFLC        IFEQ      0
173820940919     C                   MOVEL     VIDLNP        BLPKSC
173830940919     C                   ELSE
173840940919     C                   MOVEL     VIDFLC        BLPKSC
173850940919     C                   ENDIF
173860940919     C                   ENDIF
173870940919     C*
173880900504     C                   MOVEL     VIDRSM        BLPRSM
173890900504     C                   MOVEL     VIDINM        BLPINM
173900900504     C                   MOVEL     VIDCAM        BLPCAM
173910900504     C                   MOVEL     VIDLOM        BLPLOM
173920900504     C                   MOVEL     VIDPRM        BLPPRM
173930930202     C                   MOVEL     *BLANKS       BLPCPI
173940940919     C                   MOVEL     VIDNZM        BLPNZM
173950050114     c* flag unificazione spedizioni impostato solo se provengo da
173960050114     c* conferma bolle da cliente
173970130301     c  n12              clear                   blpxco
173980050114     c                   if        *in12 and *in15
173990050114     c                   eval      blpxco = wxco
174000050114     c                   endif
174010941221     C* MERCE PORTATA A MAGAZZINO
174020990915     C     *IN34         IFEQ      *ON
174030990915     C     VIDPDR        ANDLE     *ZEROS
174040001024     C                   MOVEL     VIDMAG        BLPFDN
174050990915     C                   ELSE
174060941221     C                   MOVEL     APDFCM        BLPFDN
174070990915     C                   ENDIF
174080950626     C* P A R T I T A   I V A
174090950626     C*
174100950626     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
174110950626     C*     NELLA P.IVA
174120950626     C     VIDISM        IFEQ      '$$'
174130950626     C     VIDCPM        ANDEQ     *BLANKS
174140950626     C                   MOVEL     'PRIVATO'     VIDCPM
174150950626     C                   ENDIF
174160950626     C     VIDISD        IFEQ      '$$'
174170950626     C     VIDCPD        ANDEQ     *BLANKS
174180950626     C                   MOVEL     'PRIVATO'     VIDCPD
174190950626     C                   ENDIF
174200950626     C*
174210941103     C  N04VIDISM        IFEQ      *BLANKS
174220940927     C                   MOVEL     VIDCPM        BLPCPI
174230940927     C                   ELSE
174240940927     C                   MOVEL     VIDPIM        BLPCPI
174250940927     C                   ENDIF
174260940927     C   04VIDISD        IFEQ      *BLANKS
174270940927     C                   MOVEL     VIDCPD        BLPCPI
174280940927     C                   ELSE
174290940927     C                   MOVEL     VIDPID        BLPCPI
174300940927     C                   ENDIF
174310950303     C*
174320950303     C* SE BOLLA DIRETTA ALL'ESTERO SCRIVO LE P.IVA
174330950303    1C     WDESIE        IFEQ      'E'
174340100119     c* Se c'e' esenzione IVA seconda bolla, memorizzo la partita IVA
174350100119     c     vi2cei        orne      ' '
174360100119     c* In manutenzione la devo cancellare se non è estero e non c'e' esenz.IVA
174370971230     C     *IN12         OREQ      *ON
174380971230     C     *IN15         ANDEQ     *OFF
174390971230     C     WDESIE        ANDNE     'E'
174400100119     C     vi2cei        andeq     ' '
174410950303     c*
174420971222     C                   CLEAR                   D19NT1
174430950303     C     VIDISD        IFEQ      *BLANKS
174440950303     C                   MOVEL     VIDCPD        W016A
174450950303     C                   ELSE
174460950303     C                   MOVEL     VIDPID        W016A            16
174470950303     C                   ENDIF
174480950303     C*
174490950303     C                   MOVE      W016A         D19NT1
174500950303     C*
174510950303     C     VIDISM        IFEQ      *BLANKS
174520950303     C                   MOVEL     VIDCPM        W016A
174530950303     C                   ELSE
174540950303     C                   MOVEL     VIDPIM        W016A            16
174550950303     C                   ENDIF
174560950303     C*
174570971222     C                   MOVEL     W016A         D19NT1
174580100119     c
174590100119     c                   if        *in12 and not *in15
174600100119     c                             and WDESIE<>'E' and vi2cei=' '
174610100119     C**   12
174620100119     C**ANN15WDESIE        IFNE      'E'
174630971230     C                   CLEAR                   D19NT1
174640971230     C                   ENDIF
174650060216     C                   MOVEL     'T'           D19ftr
174660950303     C                   MOVEL     BLPAAS        D19AAS
174670950303     C                   MOVEL     BLPLNP        D19LNP
174680950303     C                   MOVEL     BLPNRS        D19NRS
174690950303     C                   MOVEL     BLPNSP        D19NSP
174700950303     C                   MOVEL     'P'           D19TRC
174710950303     C                   CLEAR                   D19NT2
174720950303     C                   CALL      'FNLV19R'
174730950303     C                   PARM                    DSLV19
174740950303     C                   ENDIF
174750061110     c* Codice Fiscale mittente se inserito per prepagati non codificati
174760061110     c                   if        (*in34 and vidcdf<>*blanks) or
174770061110     c                             (not *in34 and *in22)
174780061110     C                   CLEAR                   D19NT1
174790061110     c                   movel     vidcdf        d19nt1
174800061110     C                   MOVEL     'T'           D19ftr
174810061110     C                   MOVEL     BLPAAS        D19AAS
174820061110     C                   MOVEL     BLPLNP        D19LNP
174830061110     C                   MOVEL     BLPNRS        D19NRS
174840061110     C                   MOVEL     BLPNSP        D19NSP
174850061110     C                   MOVEL     'Q'           D19TRC
174860061110     C                   CLEAR                   D19NT2
174870061110     C                   CALL      'FNLV19R'
174880061110     C                   PARM                    DSLV19
174890061110     C                   ENDIF
174900940919     C***
174910940919     C***  D E S T I N A T A R I O
174920900504     C                   MOVEL     VIDRSD        BLPRSD
174930950123     C                   MOVE      VIDRSD        WRD2             35
174940941025     C*
174950940919     C* SE SCRITTA ANCHE 2 RAGIONE SOCIALE DESTINATARIO
174960940919     C*  SCRIVO IL FILE DI ESTENSIONE DESCRIZIONI SE SUPERA IL MINIMO
174970940919     C*  CARATTERI PREVISTI  (CAMPO §7KMNC)
174980941025     C*  IN MANUTENZIONE VADO SEMPRE, PER IL RESTO SOLO SE IMMESSA
174990941025     C     *IN12         IFEQ      *ON
175000941025     C     *IN15         ANDEQ     *OFF
175010950123    2C     WRD2          ORNE      *BLANKS
175020060216     C                   MOVEL     'T'           D19ftr
175030941025     C                   MOVEL     BLPAAS        D19AAS
175040941025     C                   MOVEL     BLPLNP        D19LNP
175050941025     C                   MOVEL     BLPNRS        D19NRS
175060941025     C                   MOVEL     BLPNSP        D19NSP
175070941025     C                   MOVEL     'D'           D19TRC
175080971219     C                   MOVEL(P)  WRD2          D19NT1
175090941025     C                   CLEAR                   D19NT2
175100941025     C                   CALL      'FNLV19R'
175110941025     C                   PARM                    DSLV19
175120941025     C                   ENDIF
175130900504     C                   MOVEL     VIDIND        BLPIND
175140900504     C                   MOVEL     VIDCAD        BLPCAD
175150060705     c* se spedizione export DPD diretta in Portogallo devo aggiungere al
175160060705     c* cap immesso tanti 0 a dx quanti ne servono per arrivare ad una
175170060705     c* lunghezza di cap di 7 byte
175180060705     c                   if        a_§ogntw='DPD' and vidnzd = 'P  '
175190060705     c     ' '           checkr(e) blpcad:7      NN                1 0
175200060705     c                   if        %found
175210060705     c                   eval      %subst(blpcad:nn+1:7-nn)=*all'0'
175220060705     c                   endif
175230060705     c                   endif
175240900504     C                   MOVEL     VIDLOD        BLPLOD
175250900504     C                   MOVEL     VIDPRD        BLPPRD
175260940919     C                   MOVEL     VIDNZD        BLPNZD
175270940919     C*
175280900504     C                   MOVEL     VIDGC1        BLPGC1
175290900504     C                   MOVEL     VIDGC2        BLPGC2
175300900504     C                   MOVEL     VIDCTR        BLPCTR
175310900613     C                   MOVEL     SAVCTS        BLPCTS
175320911008     C                   MOVEL     VIDFBR        BLPFBR
175330000627     C*
175340000627     C* ALLEGA BAM
175350000627     C                   EXSR      AGGFST
175360950127     C*
175370960118     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
175380951009     C                   CLEAR                   BLPFTM
175390950127     C   04SAVFTM        IFEQ      'S'
175400950127     C     VIDFTM        OREQ      'S'
175410950127     C                   MOVEL     'S'           BLPFTM
175420950127     C                   ENDIF
175430950127     C*
175440941230     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
175450941230    2C     APDFCM        IFNE      ' '
175460941230     C                   MOVEL     'C'           BLPFAP
175470941230     C                   ELSE
175480941230     C                   MOVEL     COMFAP        BLPFAP
175490941230    2C                   END
175500940922     C* SE NON IMMESSO TIPO SERVIZIO
175510940922     C     VIDTSP        IFNE      *BLANKS
175520940919    1C                   MOVEL     VIDTSP        BLPTSP
175530940922     C                   ELSE
175540940922     C* LO PRENDO DA TARIFFA
175550940922     C                   MOVEL     COMTSP        BLPTSP
175560940922     C                   ENDIF
175570020725     C*
175580940919     C                   MOVEL     VIDIAS        BLPIAS
175590011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO ASSICURARE > 0
175600011113     C     VIDIAS        IFGT      *ZEROS
175610011113     C                   MOVEL     VIDVAS        BLPVAS
175620011113     C                   ELSE
175630011113     C                   CLEAR                   BLPVAS
175640011113     C                   ENDIF
175650940919     C                   MOVEL     VIDVMD        BLPVMD
175660011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE VALORE MERCE > 0
175670011113     C     VIDVMD        IFGT      *ZEROS
175680011113     C                   MOVEL     VIDVAD        BLPVAD
175690011113     C                   ELSE
175700011113     C                   CLEAR                   BLPVAD
175710011113     C                   ENDIF
175720940919     C                   MOVEL     VIDQFT        BLPQFT
175730900504     C                   MOVEL     VIDNAS        BLPNAS
175740941115     C                   MOVEL     V1CNCL        BLPNCL
175750940919     C                   MOVEL     V2CPKG        BLPPKB
175760940919     C                   MOVEL     V2CPKG        BLPPKF
175770940919     C                   MOVEL     VIDFVR        BLPFVB
175780940919     C                   MOVEL     VARVOL        BLPVLB
175790940919     C                   MOVEL     VIDFVR        BLPFVF
175800940919     C                   MOVEL     VARVOL        BLPVLF
175810030204      * Immissione bolla
175820030204     c                   If        (*In12 and *In15) or Not *In12
175830030204      * Se sono stati impostati i bancali devo sommare al peso e al volume
175840030204      * il peso e il volume dei bancali
175850030922      * no x particolarità varia 'O'
175860030922     c                   If        %subst(VidGva:1:1) <> 'O'
175870110921     c                   If        VidNba > *Zeros and §cliban=*blanks
175880030204     c                   Clear                   w0071
175890030204     c                   Clear                   w0053
175900030204     c     wTbaPkg1      Mult      VidNba        w0071
175910030204     c                   Add       w0071         BlpPkb
175920030204     c                   Add       w0071         BlpPkf
175930030204     c     wTbaVol1      Mult      VidNba        w0053
175940030204     c                   Add       w0053         BlpVlb
175950030204     c                   Add       w0053         BlpVlf
175960030204     c                   EndIf
175970030204     c                   If        VidNb2 > *Zeros
175980030204     c                   Clear                   w0071
175990030204     c                   Clear                   w0053
176000030204     c     wTbaPkg2      Mult      VidNb2        w0071
176010030204     c                   Add       w0071         BlpPkb
176020030204     c                   Add       w0071         BlpPkf
176030030204     c     wTbaVol2      Mult      VidNb2        w0053
176040030204     c                   Add       w0053         BlpVlb
176050030204     c                   Add       w0053         BlpVlf
176060030204     c                   EndIf
176070030922     c                   EndIf
176080030204     c                   EndIf
176090010214     C     VIDFFD        IFEQ      'N'
176100010214     C                   MOVEL     *BLANKS       BLPFFD
176110010214     C                   ELSE
176120940919     C                   MOVEL     VIDFFD        BLPFFD
176130010214     C                   ENDIF
176140940919     C                   MOVEL     COMDRT        BLPDRT
176150000308     C                   CLEAR                   BLPPDR
176160990630     C  N34              MOVEL     VIDLNP        BLPPDR
176170990630     C  N34              MOVE      VIDPDR        BLPPDR
176180940919     C                   MOVEL     VIDFPP        BLPFPP
176190940928     C                   MOVEL     VIDNRT        BLPNRT
176200940919     C                   MOVEL     VIDTCR        BLPTCR
176210940919     C                   MOVEL     COMDCR        BLPDCR
176220940919     C                   MOVEL     VIDHCR        BLPHCR
176230940919     C                   MOVE      VIDMCR        BLPHCR
176240030326      * Data consegna richiesta - Forzata su richiesta del cliente
176250030326      * in immissione bolla
176260030410      * e se non già impostata la data consegna richiesta
176270100219     c                   If        ((*In12 and *In15) or Not *In12)
176280100219     c                               and BlpDcr = *Zeros
176290030326     c                   ExSr      SrDcr
176300100217     c                   EndIf
176310100217     c
176320000214     C* SE E' UN DISK "C" MA NUMERAZIONE AUTOMATICA DPD,
176330000214     C* TRATTO COME DISK "A"
176340940919     C                   MOVEL     VIDSOP        BLPSOP
176350940919     C                   MOVEL     VIDRMN        BLPRMN
176360940919     C                   MOVEL     VIDRMA        BLPRMA
176370940919     C                   MOVEL     VIDRMO        BLPRMO
176380941005     C*
176390941005     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
176400941005     C     VIDCMO        IFNE      *BLANKS
176410941005     C                   MOVEL     VIDCMO        BLPCAM
176420941005     C                   MOVEL     VIDNMO        BLPNZM
176430941005     C                   ENDIF
176440941005     C*
176450940919     C                   MOVEL     VARZNC        BLPZNC
176460950303     C     §3ACTM        IFNE      *BLANKS
176470950303     C                   MOVEL     §3ACTM        BLPCTM
176480950303     C                   ELSE
176490940919     C                   MOVEL     VIDCTM        BLPCTM
176500950303     C                   ENDIF
176510941005     C     BLPCTM        IFEQ      *BLANKS
176520941005     C                   MOVEL     WCTM          BLPCTM
176530941005     C                   ENDIF
176540940919     C                   MOVEL     VIDTC1        BLPTC1
176550940919     C                   MOVEL     VIDTC2        BLPTC2
176560001205     C* SE MANUTENZIONE DI BOLLA POSTE E AGGIUNTA O TOLTA TC1/2 "F"
176570060215     C* DEVO AGGIORNARE ar4 TIPO RECORD J
176580001205     C   12
176590020319     CANN15§ogntw        IFEQ      'PPT'
176600001205     C                   CLEAR                   WTCP
176610001205     C                   CLEAR                   WSVTCP
176620001205     C     VIDTC1        IFEQ      'F'
176630001205     C     VIDTC2        OREQ      'F'
176640001205     C                   MOVEL     'F'           WTCP
176650001205     C                   ENDIF
176660001205     C     SAVTC1        IFEQ      'F'
176670001205     C     SAVTC2        OREQ      'F'
176680001205     C                   MOVEL     'F'           WSVTCP
176690001205     C                   ENDIF
176700001205     C                   SELECT
176710001205     C* SE NON E' STATA NE' AGGIUNTA NE' TOLTA LA "F" NON FACCIO NIENTE
176720001205     C     VIDTC1        WHENNE    'F'
176730001205     C     VIDTC2        ANDNE     'F'
176740001205     C     SAVTC1        ANDNE     'F'
176750001205     C     SAVTC2        ANDNE     'F'
176760001205     C     WTCP          OREQ      'F'
176770001205     C     WSVTCP        ANDEQ     'F'
176780001205     C                   OTHER
176790001205     C                   MOVEL     'J'           WTRC
176800060215     C     KBLP4         CHAIN(N)  Fiar401L                           30
176810001205    3C     *IN30         IFEQ      *OFF
176820060215     C                   MOVEL     ar4NOT        DSBL4J
176830001205     C* TOLTO LA 'F'
176840001205    4C     WTCP          IFEQ      *BLANKS
176850001205     C     WSVTCP        ANDEQ     'F'
176860001205     C                   CLEAR                   §B4BAI
176870001205   X4C                   ELSE
176880001205     C* AGGIUNTA 'F'
176890001205    5C     WTCP          IFEQ      'F'
176900001205     C     WSVTCP        ANDEQ     *BLANKS
176910001205     C                   MOVEL     'S'           §B4BAI
176920001205    5C                   ENDIF
176930001205    4C                   ENDIF
176940001205     C                   CLEAR                   DSLV19
176950001205     C                   MOVEL     DSBL4J        D19NT1
176960060215     c                   movel     'T'           d19ftr
176970001205     C                   MOVEL     BLPAAS        D19AAS
176980001205     C                   MOVEL     BLPLNP        D19LNP
176990001205     C                   MOVEL     BLPNRS        D19NRS
177000001205     C                   MOVEL     BLPNSP        D19NSP
177010001205     C                   MOVEL     'J'           D19TRC
177020001205     C                   CLEAR                   D19NT2
177030001205     C                   CALL      'FNLV19R'
177040001205     C                   PARM                    DSLV19
177050001205   X3C                   ELSE
177060001205     C* AGGIUNTA 'F' --> CREO RECORD "J"
177070001205    4C     WTCP          IFEQ      'F'
177080001205     C     WSVTCP        ANDEQ     *BLANKS
177090001205     C                   CLEAR                   DSLV19
177100001205     C                   CLEAR                   DSBL4J
177110060215     c                   movel     'T'           d19ftr
177120001205     C                   MOVEL     'S'           §B4BAI
177130001205     C                   MOVEL     DSBL4J        D19NT1
177140001205     C                   MOVEL     BLPAAS        D19AAS
177150001205     C                   MOVEL     BLPLNP        D19LNP
177160001205     C                   MOVEL     BLPNRS        D19NRS
177170001205     C                   MOVEL     BLPNSP        D19NSP
177180001205     C                   MOVEL     'J'           D19TRC
177190001205     C                   CLEAR                   D19NT2
177200001205     C                   CALL      'FNLV19R'
177210001205     C                   PARM                    DSLV19
177220001205    4C                   ENDIF
177230001205    3C                   ENDIF
177240001205     C                   ENDSL
177250001205     C                   ENDIF
177260940919     C                   MOVEL     VIDGGA        BLPGGA
177270940919     C                   MOVEL     VIDGMA        BLPGMA
177280940919     C                   MOVEL     VIDGVA        BLPGVA
177290960208     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
177300960208     C* DELLE PARTICOLARITA' VARIE
177310970707     C     W2LN          IFEQ      'S'
177320960208     C                   MOVE      'D'           BLPGVA
177330960208     C                   ELSE
177340960208     C                   MOVE      ' '           BLPGVA
177350960208     C                   ENDIF
177360940919     C* C/ASSEGNO
177370051115    1C     ar9CAS        IFGT      0
177380940919     C     VIDGCA        ORNE      *BLANKS
177390051115     C                   MOVEL     BLPAAS        ar9AAS
177400051115     C                   MOVEL     BLPLNP        ar9LNP
177410051115     C                   MOVEL     BLPNRS        ar9NRS
177420051115     C                   MOVEL     BLPNSP        ar9NSP
177430051115     C                   MOVEL     VIDGCA        ar9GCA
177440051115     C                   MOVEL     dateu         ar9duv
177450940919     C*
177460051115     C     War9          IFEQ      'E'
177470051115     C                   UPDATE    Fiar9000
177480940926     C                   ELSE
177490051115     C                   WRITE     Fiar9000
177500940926     C                   ENDIF
177510940926     C*
177520940926     C                   ELSE
177530940926     C* SE C'ERA E ORA NON PIU' DELETO
177540051115     C     War9          IFEQ      'E'
177550051115     C                   DELETE    Fiar9000
177560940919     C                   ENDIF
177570940926     C                   ENDIF
177580900828     C*
177590941025     C* SE NO A BORDERO' METTO 99999 IN DATA BORDERO' E NUM.F.VIAGG
177600930628    1C     §1BFG4        IFEQ      'N'
177610900829     C                   MOVEL     DATEU         BLPDBR
177620900828     C                   MOVEL     *ALL'9'       BLPNFV
177630930628   X1C                   ELSE
177640930628    2C     *IN12         IFEQ      *ON
177650930628     C     *IN15         ANDEQ     *ON
177660930628     C     *IN12         OREQ      *OFF
177670930628     C                   MOVEL     *ZEROS        BLPDBR
177680930628     C                   MOVEL     *ZEROS        BLPNFV
177690930628    2C                   END
177700930628    1C                   END
177710910805     C  N12              MOVEL     *BLANKS       BLPFNS
177720910805     C   12              MOVEL     VIDFNS        BLPFNS
177730971212     C**
177740971215     C** SE BOLLA EXP/IMP SDI CON NUMERO AWB SCRITTO, LO MEMORIZZO
177750020211     c** SE BOLLA EXPORT FEDEX ASSEGNO IL NUMERO AWB
177760971217     C   12
177770971217     CAN 15
177780971217     CORN12              CLEAR                   DSBL4E
177790020213     c     A_§ogntw      ifeq      'FED'
177800020320     c     wawbini       andgt     *zeros
177810020211     C                   CLEAR                   DSBL4E
177820020228     c                   movel     wawbini       w0012a           12
177830020228     c* calcolo check digit
177840020228     c                   exsr      chkdgf
177850020228     c                   movel     w0012a        §b4erp
177860020211     C                   MOVEL     'A'           §B4EMA
177870020211     C                   MOVEL     'P'           §B4EAT
177880020212     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
177890051102     c* del ARS trk "F"
177900020208     c                   endif
177910081008    1C**   V6CAWB        IFEQ      0
177920081008     c**   A_§ogntw      andeq     'EUP'
177930971212     C* VEDO SE C'E' IL CONTATORE 19 - NUMERO AWB
177940081008     C***                CLEAR                   AAS
177950081008     C**                 Z-ADD     19            CNU
177960081008     C**                 Z-ADD     BLPTFP        COMLIN
177970081008     C**   KNUF          CHAIN     FLNUF01L                           30
177980081008    2C**   *IN30         IFEQ      *OFF
177990081008     C**                 ADD       1             NUFNUM
178000980623     C* SE SUPERA RANGE FINALE, RIPARTO DA QUELLO INIZIALE
178010081008     C**   NUFNUM        IFGT      NUFRFI
178020081008     C**                 Z-ADD     NUFRIN        NUFNUM
178030081008    6C**                 END
178040081008     C**                 UPDATE    FLNUF
178050081008     C**                 Z-ADD     NUFNUM        W0090
178060081008     C**                 MOVEL     §3IFAW        W0090
178070081008     C**   W0090         DIV       7             RISUL
178080081008     C**                 MVR                     RESTO
178090081008     C**                 MOVEL     W0090         W010A
178100081008     C**                 MOVE      RESTO         W010A
178110971217     C*
178120081008     C**                 CLEAR                   DSBL4E
178130081008     C**                 MOVEL     W010A         §B4ERP
178140081008     C**                 MOVEL     'A'           §B4EMA
178150081008     C**                 MOVEL     'P'           §B4EAT
178160971216     C* SE LA STAMPO IN IMMEDIATO METTO SUBITO LA S DI STAMPATO
178170081008    3C**   §1BFG6        IFEQ      'I'
178180971217     C*
178190081008     C**   §1BFG6        OREQ      'C'
178200081008     C**   §1BFG0        ANDEQ     'I'
178210971217     C*
178220081008     C**   §1BFG6        OREQ      'C'
178230081008     C**   §1BFG0        ANDEQ     'C'
178240081008     C**   §1BF11        ANDEQ     'I'
178250081008     C**                 MOVEL     'S'           §B4EST
178260081008     C**                 ELSE
178270081008     C**                 MOVEL     'N'           §B4EST
178280081008    3C**                 ENDIF
178290081008    2C**                 ENDIF
178300971212     C**
178310081008   X1C**                 ELSE
178320971217     C* IN MANUTENZIONE SOLO SE HO MODIFICATO IL NUMERO
178330971217     C*  ALTRIMENTI LASCIO QUELLO CHE C'E'
178340081008    2C**   V6CAWB        IFGT      0
178350980310     C* SOLO SE EXPORT SDI
178360081008     c**   A_§ogntw      ifeq      'EUP'
178370081008    4C**   SAVAWB        IFNE      V6CAWB
178380081008     C**   §B4EMA        OREQ      ' '
178390081008     C**                 CLEAR                   DSBL4E
178400081008     C**                 MOVEL     V6CAWB        §B4ERP
178410081008     C**                 MOVEL     'M'           §B4EMA
178420081008     C**                 MOVEL     'P'           §B4EAT
178430081008     C**                 MOVEL     'S'           §B4EST
178440081008    4C**                 ENDIF
178450081008    3C**                 ENDIF
178460081008    2C***                ENDIF
178470081008    1C**                 ENDIF
178480971230     C* SE MODIFICATA LA LNA E DIVENTATE ENTRAMBE IN ITALIA
178490060215     C*    AZZERO NUMERO AWB E CANCELLO Fiar4
178500971230    2C     *IN12         IFEQ      *ON
178510971230     C     *IN15         ANDEQ     *OFF
178520120302     C* PER LA LINEA DI PARTENZA VALE SOLO PER BRT
178530020211     c     §ogntw        ifne      'EEX'
178540020211     c     §ogntw        andne     'FED'
178550081008     c***  §ogntw        andne     'EUP'
178560020213     c     A_§ogntw      andne     'FED'
178570081008     c***  A_§ogntw      andne     'EUP'
178580020211     C                   MOVEL     'E'           WTRC
178590060215     C     KBLP4         DELETE    Fiar4000                           30
178600020211     C                   CLEAR                   §B4ERP
178610020211     c                   endif
178620971230    2C                   ENDIF
178630060216     C* SE C'E' NUMERO AWB SCRIVO RECORD E IN ar4
178640971212    1C     §B4ERP        IFNE      *BLANKS
178650971216     C     SAVAWB        ORNE      0
178660081008     c***  A_§ogntw      ifeq      'EUP'
178670081008     c     A_§ogntw      ifeq      'FED'
178680060215     C                   MOVEL     'T'           D19ftr
178690971212     C                   MOVEL     BLPAAS        D19AAS
178700971212     C                   MOVEL     BLPLNP        D19LNP
178710971212     C                   MOVEL     BLPNRS        D19NRS
178720971212     C                   MOVEL     BLPNSP        D19NSP
178730971212     C                   MOVEL     'E'           D19TRC
178740971212     C                   CLEAR                   D19NT1
178750971212     C                   MOVEL     DSBL4E        D19NT1
178760971212     C                   CLEAR                   D19NT2
178770971212     C                   CALL      'FNLV19R'
178780971212     C                   PARM                    DSLV19
178790020211     c                   endif
178800971212    1C                   ENDIF
178810031219      * se ho caricato il riferimento partner estero da FIVAT rcd 'C'
178820060216      * scrivo il Fiar4 rcd 'E'
178830031219    1c                   If        *In12 and *In15
178840080128     c                             and A_§ogntw<>'FED'
178850060215     c                   MOVEL     'T'           D19ftr
178860031219     C                   MOVEL     BLPAAS        D19AAS
178870031219     C                   MOVEL     BLPLNP        D19LNP
178880031219     C                   MOVEL     BLPNRS        D19NRS
178890031219     C                   MOVEL     BLPNSP        D19NSP
178900031219     C                   MOVEL     'E'           D19TRC
178910031219     C                   CLEAR                   D19NT1
178920031219     C                   MOVEL     wrifp         D19NT1
178930031219     C                   CLEAR                   D19NT2
178940031219     C                   CALL      'FNLV19R'
178950031219     C                   PARM                    DSLV19
178960031219    1c                   EndIf
178970991203      **
178980060216      ** SE EXPORT DPD CON NUMERO PARCEL SCRITTO, LO MEMORIZZO IN Fiar4
178990060509     c                   if        (*in12 and *in15) or *in12 = '0'
179000061003     C****               CLEAR                   DSBL4F
179010060509     C                   CLEAR                   DSBL4I
179020060509     C                   CLEAR                   DSBL4K
179030060509     c                   endif
179040991203      *
179050020319    1C     A_§OGNTW      IFEQ      'DPD'
179060060620     c*
179070991203      *
179080060616    2C     V7CNPR        IFne      *blanks
179090060620     c* Imposto dsbl4f solo se si utilizza ancora il cappario vecchio
179100061003     C****               CLEAR                   DSBL4F
179110061003    3c****               if        dateu < §vpodpd  AND
179120061003     c****                         %subst(v7cnpr:14:1)=*blanks
179130061003     C****               MOVEL     V7CNPR        §B4FNP
179140061003     C**** §1BF13        IFEQ      'A'
179150061003     C****               MOVEL     'A'           §B4FMA
179160061003     C****               ELSE
179170061003     C****               MOVEL     'M'           §B4FMA
179180061003     C****               ENDIF
179190061003     C****               MOVEL     'P'           §B4FAT
179200061003     C****               MOVEL     'S'           §B4FST
179210061003     C****               MOVEL     OD3NAZ        §B4NAZ
179220061003     C****               MOVEL     OD3RTN        §B4RTN
179230061003     C****               MOVEL     OD3ZON        §B4ZON
179240061003     C****               MOVEL     OD3COL        §B4FNR
179250061003    3c****               endif
179260060616     c* imposto dsbl4i/k
179270060509     c                   clear                   dsbl4i
179280060616     c                   clear                   dsbl4k
179290060509     C                   MOVEL     V7CNPR        §B4IPN
179300060616     c* tolgo il check digit dal parcel number se n. parcel lungo 12
179310060620     c                   if        %subst(§b4ipn:14:1) = *blanks
179320060509     c                   eval      %subst(§b4ipn:12:1)=' '
179330060620     c                   eval      §b4icd=%subst(v7cnpr:12:1)
179340060616     c                   else
179350060616     c* se parcel lungo 14 calcolo il check digit
179360060616     c                   clear                   trul28ds4
179370060616     c                   eval      i284cod=§b4ipn
179380060616     c                   call      'TRUL28R5'
179390060616     c                   parm                    trul28ds4
179400060616     c                   movel     o284ckd       §b4icd
179410060616     c                   endif
179420060616     c* Se ho usato il cappario dpd vecchio imposto dsbl4i con campi
179430060616     c* del cappario vecchio altrimenti perndo quelli del cappario nuov
179440070515     c***                if        dateu < §vpodpd  AND
179450070515     c***                          %subst(v7cnpr:14:1)=*blanks
179460060510     c* depot di arrivo --> muovo uno 0 in prima posizione
179470070515     c***                movel     '0'           §b4ida
179480070515     C***                MOVE      OD3RTN        §B4ida
179490070515     C***                MOVEL     OD3ZON        §B4iza
179500060509     c* imposto dsbl4k
179510070515     C***                MOVEL     OD3COL        §B4krt
179520070515     c***                else
179530060616     c                   movel     osie3dsrt     §b4ids
179540060616     c                   movel     osie3bidp     §b4ibi
179550060616     c                   movel     osie3ddep     §b4ida
179560060616     c                   move      isie3srv      §b4isc
179570061010     c                   movel     osie3iatad    §b4iat
179580061010     c                   movel     osie3ptyg     §b4ipy
179590070515     c***                endif
179600991203      *
179610991203    2C                   ENDIF
179620991203    1C                   ENDIF
179630050228     c*
179640050228    1C     *in79         IFEQ      *on
179650070605    1C     A_§OGNTW      andne     'DPD'
179660060616    2C     v7cnpr        IFne      *blanks
179670061003     C****               CLEAR                   DSBL4F
179680060621     c* solo se parcel lungo 11
179690061003     c****               if        %subst(v7cnpr:14:1) = *blanks
179700061003     c****               movel     v7cnpr        §b4fnp
179710061003     c***                endif
179720060510     c* imposto dsbl4i
179730060616     c                   movel     v7cnpr        §b4ipn
179740060621    3c                   if        %subst(§b4ipn:14:1) = *blanks
179750060616     c                   eval      %subst(§b4ipn:12:1)=' '
179760060619     c                   eval      §b4icd=%subst(v7cnpr:12:1)
179770060621   x3c                   else
179780060616     c* se parcel lungo 14 calcolo il check digit
179790060616     c                   clear                   trul28ds4
179800060616     c                   eval      i284cod=§b4ipn
179810060616     c                   call      'TRUL28R5'
179820060616     c                   parm                    trul28ds4
179830060616     c                   movel     o284ckd       §b4icd
179840060621    3c                   endif
179850060621     c* destination sort
179860060621     c                   move      §oghb1        §b4ids
179870060621     c                   move      a_§ogdp1      §b4ida
179880060621    3c                   select
179890060628     c* immissione o bolla di reso
179900060628     c                   when      *in12='0' or blpfbr = 'S'
179910060621     C                   CLEAR                   PTYPE             2
179920060621     c                   if        blppkb>§3ilmp
179930060621     c                   move      101           §b4isc
179940060621     c                   eval      ptype='01'
179950060621     c                   else
179960060621     c                   move      136           §b4isc
179970060928     c                   eval      ptype='02'
179980060621     c                   endif
179990060628     c                   if        blpfbr='S'
180000060628     c                   move      300           §b4isc
180010060628     c                   endif
180020060621     c                   move      '%'           §b4ibi
180030060621     c                   if        %subst(§b4ipn:14:1)=*blanks
180040060621     c                   eval      §b4krt='39' + %subst(blpcad:1:5)+
180050060621     c                             ptype
180060060621     c                   endif
180070060628     c* conferma da disk
180080060628     c                   when      *in12='1' and *in15='1'
180090060628     c                   move      §VATESCD      §B4ISC
180100060628     c                   move      §VATEbid      §b4ibi
180110060628    4c                   if        §vaterou <> *blanks
180120060628     c                   move      §vaterou      §b4krt
180130060628    4c                   endif
180140060621    3c                   endsl
180150050228    2C                   ENDIF
180160050228    1C                   ENDIF
180170991203      *
180180991203      * SE MODIFICATA LA LNA E NON È PIÙ DPD AZZERO IL NUMERO PARCEL
180190060215      *  E CANCELLO Fiar4
180200991203    2C     *IN12         IFEQ      *ON
180210991203     C     *IN15         ANDEQ     *OFF
180220020319     C     A_§OGNTW      ANDNE     'DPD'
180230050228     c     *in79         andne     *on
180240061003     C***                MOVEL     'F'           WTRC
180250061003     C***  KBLP4         DELETE    Fiar4000                           30
180260060626     C***                CLEAR                   §B4FNP
180270061003     C***                CLEAR                   dsbl4f
180280060510     C                   MOVEL     'I'           WTRC
180290060510     C     KBLP4         DELETE    Fiar4000                           30
180300060626     C                   CLEAR                   dsbl4i
180310060510     C                   MOVEL     'K'           WTRC
180320060510     C     KBLP4         DELETE    Fiar4000                           30
180330060626     C                   CLEAR                   dsbl4k
180340991203    2C                   ENDIF
180350991203      *
180360060620      * SE C'E' NUMERO PARCEL SCRIVO RECORD "I" IN ar4
180370060620     c* Tipo rekord F
180380061003     c***                if        §b4fnp<>*blanks or savfnp<>*blanks
180390061003     C***                MOVEL     'T'           D19ftr
180400061003     C***                MOVEL     BLPAAS        D19AAS
180410061003     C***                MOVEL     BLPLNP        D19LNP
180420061003     C***                MOVEL     BLPNRS        D19NRS
180430061003     C***                MOVEL     BLPNSP        D19NSP
180440061003     C***                MOVEL     'F'           D19TRC
180450061003     C***                MOVEL(P)  DSBL4F        D19NT1
180460061003     C***                CLEAR                   D19NT2
180470061003     C***                CALL      'FNLV19R'
180480061003     C***                PARM                    DSLV19
180490061003     c***                endif
180500060620     c* Tipo record K
180510060620     c                   if        §b4krt<>*blanks or savkrt<>*blanks
180520060620     C                   MOVEL     'T'           D19ftr
180530060620     C                   MOVEL     BLPAAS        D19AAS
180540060620     C                   MOVEL     BLPLNP        D19LNP
180550060620     C                   MOVEL     BLPNRS        D19NRS
180560060620     C                   MOVEL     BLPNSP        D19NSP
180570060620     C                   MOVEL     'K'           D19TRC
180580060620     C                   MOVEL(P)  DSBL4K        D19NT1
180590060620     C                   CLEAR                   D19NT2
180600060620     C                   CALL      'FNLV19R'
180610060620     C                   PARM                    DSLV19
180620060620     c                   endif
180630060620     c* Tipo record I
180640060510    1C     §B4IPN        IFNE      *BLANKS
180650060616     C     SAVNPR        ORNE      *blanks
180660060510     c*
180670060510     C                   MOVEL     'T'           D19ftr
180680060510     C                   MOVEL     BLPAAS        D19AAS
180690060510     C                   MOVEL     BLPLNP        D19LNP
180700060510     C                   MOVEL     BLPNRS        D19NRS
180710060510     C                   MOVEL     BLPNSP        D19NSP
180720060510     C                   MOVEL     'I'           D19TRC
180730060510     C                   MOVEL(P)  DSBL4I        D19NT1
180740060510     C                   CLEAR                   D19NT2
180750060510     C                   CALL      'FNLV19R'
180760060510     C                   PARM                    DSLV19
180770061106     c* se sono in conferma bolle import dpd scrivo depot su DPPDC
180780061106     c* se manca
180790061107     c                   if        §b4ipn<>*blanks and *in79  and *in12
180800061107     c                             and *in15
180810061106     c                   clear                   truldepds
180820061106     c
180830061106     c                   if        %subst(§b4ipn:14:1) <> *blanks
180840061106     c                   movel     §b4ipn        idepdpc
180850061106     c                   else
180860061106     c                   eval      idepdpc='0'+%subst(§b4ipn:1:3)
180870061106     c                   endif
180880061106     c                   call      'TRULDEPR'
180890061106     c                   parm                    truldepds
180900061106     c                   if        odeperr='1'
180910061106     c                   clear                   dppdc000
180920061106     c                   eval      pdcdpc=idepdpc
180930061106     c                   z-add     19900101      pdcdde
180940061106     c                   z-add     20391231      pdcdsc
180950061106     c                   z-add     dateu         pdcdtv
180960061107     c                   time                    pdcorv
180970061106     c                   movel     'FNLS01R'     pdcpru
180980061106     c                   write     dppdc000
180990061106     c                   endif
181000061106     c                   endif
181010991214     C**
181020991214     C* SCRIVO IL NUMERO DI PARCEL ANCHE NELLE NOTE
181030991214     C*
181040050405     c* se import dpd non lo devo fare lo faccio solo per export
181050060616     c                   clear                   dpdsta
181060060616     c                   clear                   dpdsta14         27
181070050405    2c     *in79         ifeq      *off
181080060626     c     §b4ipn        ifne      *blanks
181090060510     C***                MOVEL     §B4FNP        DPDPAR
181100060616     c                   if        %subst(§b4ipn:14:1)=*blanks
181110060510     c                   movel     §b4ipn        dpdpar
181120060510     c                   move      §b4icd        dpdpar
181130991214     C                   MOVEL     DPD1          DPDS1
181140991214     C                   MOVEL     DPD2          DPDS2
181150991214     C                   MOVEL     DPD3          DPDS3
181160991214     C                   MOVEL     CDPD          DPDCOS
181170060616     c                   else
181180060616     c                   eval      dpdsta14=cdpd+%subst(§b4ipn:1:4)+
181190060616     c                             ' '+%subst(§b4ipn:5:10)
181200060616     c                   endif
181210060626     c                   endif
181220991217     C* IN MANUTENZIONE CONTROLLO SE LE NOTE SONO QUELLE MESSE IN AUTOM
181230991217     C*  DEL PARCEL
181240991217     C     *IN12         IFEQ      *ON
181250991217     C     *IN15         ANDEQ     *OFF
181260991217     C                   MOVEL     VIDNT1        W012A            12
181270991217     C*
181280991217     C     W012A         IFEQ      CDPD
181290991217     C                   CLEAR                   VIDNT1
181300991217     C                   ENDIF
181310991217     C                   ENDIF
181320991217     C*
181330060626     c                   if        dpdsta<>*blanks or dpdsta14<>*blanks
181340060626    3C     VIDNT1        IFEQ      *BLANKS
181350060626    4c                   if        dpdsta<>*blanks
181360991214     C                   MOVEL(P)  DPDSTA        VIDNT1
181370060616     c                   else
181380060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
181390060626    4c                   endif
181400060626   x3C                   ELSE
181410991214     C                   MOVEL     VIDNT1        VIDNT2
181420060626    4c                   if        dpdsta<>*blanks
181430991214     C                   MOVEL(P)  DPDSTA        VIDNT1
181440060616     c                   else
181450060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
181460060626    4c                   endif
181470060626    3C                   ENDIF
181480060626     c                   endif
181490050405    2c                   endif
181500991203    1C                   ENDIF
181510991117      *
181520010502      * SE BOLLA CON LNP DPD E NUM. DISTINTA NON IMPOSTATO DEVO:
181530991130      *  - RICAVARE IL NUMERO DISTINTA E MEMORIZZARLO IN RMA
181540000218      *  - CREARE IL FILE EVENTI DPD TRANNE PER BOLLE DI RECUPERO
181550060619     C     *IN79         IFEQ      *ON
181560080304     C***  BLPRMA        ANDEQ     *BLANKS
181570060619     c* solo per parcel number lungo 14 continuo a scrivere n.distinta
181580080304     c                   if        %subst(§b4ipn:14:1)=*blanks
181590080304     c                             and blprma=*blanks
181600060619     C                   EXSR      SPEDPD
181610060619     C                   MOVEL     DPDBRC        BLPRMA
181620060619     c                   endif
181630060619     C     §3ARBL        IFNE      'R'
181640060619     C                   EXSR      EVEDPD
181650060619     C                   ENDIF
181660060619     C                   ENDIF
181670010502     C*
181680010924      * MEMORIZZO IL RIF. ORM NEL RIF. MITTENTE ALFANUMERICO
181690010924      *  - SEMPRE SE QUELLO IN BOLLA E' VUOTO
181700010924      *  - SE ENTRAMBI PIENI SOLO SE IMPOSTATO L'APPOSITO FLAG SULL'ORM
181710010924      *  - MAI SE BOLLA DPD
181720040226if  1c                   If        worm = 'S' and
181730040226     c                             (Not *In79 or wrifm = *Off)
181740010924      *  PREPAGATO
181750010502    2C     PARTCH        IFEQ      'P'
181760010924      *
181770010502    3C     VIDMAG        IFNE      'S'
181780010924     C     BLPRMA        ANDEQ     *BLANKS
181790010502     C                   MOVEL     §RMRFA        BLPRMA
181800010502    3C                   ENDIF
181810010924      *
181820010502   X2C                   ELSE
181830010924      *  NO PREPAGATO
181840010502    3C     FLGFIT        IFNE      'S'
181850010924    4C     BLPRMA        IFEQ      *BLANKS
181860010502     C                   MOVEL     ORMRFA        BLPRMA
181870010924   X4C                   ELSE
181880010924    5C     ORMRFA        IFNE      *BLANKS
181890010924     C     §ORMFR        ANDEQ     'S'
181900010924     C                   MOVEL     ORMRFA        BLPRMA
181910010924    5C                   ENDIF
181920010924    4C                   ENDIF
181930010924    3C                   ENDIF
181940010924      *
181950010502    2C                   ENDIF
181960010924      *
181970010502    1C                   ENDIF
181980991214     C***
181990991214     C***  N O T E
182000060216     C                   MOVEL     'T'           D19ftr
182010991214     C                   MOVEL     BLPAAS        D19AAS
182020991214     C                   MOVEL     BLPLNP        D19LNP
182030991214     C                   MOVEL     BLPNRS        D19NRS
182040991214     C                   MOVEL     BLPNSP        D19NSP
182050991214     C                   MOVEL     VIDNT1        D19NT1
182060991214     C                   MOVEL     VIDNT2        D19NT2
182070991214     C     VIDNT1        IFNE      *BLANKS
182080991214     C     VIDNT2        ORNE      *BLANKS
182090991214     C                   MOVEL     '8'           D19TRC
182100991214     C                   CALL      'FNLV19R'
182110991214     C                   PARM                    DSLV19
182120991214     C                   ENDIF
182130991214     C**
182140991214     C* REIMPOSTO LE NOTE IN MANUTENZIONE
182150991214     C   12
182160991214     CANN15              MOVEL     D19NT1        VIDNT1
182170991214     C   12
182180991214     CANN15              MOVEL     D19NT2        VIDNT2
182190991214     C**
182200991214     C* IN MANUTENZIONE SE IL PGM MI RESTITUISCE LA 2 RIGA VUOTA,
182210991214     C* LA DELETO PERCHE' POTEVA PRIMA ESISTERE
182220991214     C   12
182230991214    1CANN15D19ERR        IFEQ      *BLANKS
182240991214     C     D19NT1        ANDNE     *BLANKS
182250991214     C     D19NT2        ANDEQ     *BLANKS
182260991214     C                   MOVEL     '9'           D19TRC
182270991214     C                   CLEAR                   D19NT1
182280991214     C                   CLEAR                   D19NT2
182290991214     C                   CALL      'FNLV19R'
182300991214     C                   PARM                    DSLV19
182310991214    1C                   ENDIF
182320991214     C* SE TORNATO CODICE DI ERRORE RICHIAMO IL PGM 2 VOLTE
182330991214     C* UNA VOLTA PER NOTA
182340991214    2C     D19ERR        IFNE      *BLANKS
182350991214    1C     *IN12         OREQ      *ON
182360991214     C     *IN15         ANDEQ     *OFF
182370991214     C     VIDNT1        ANDEQ     *BLANKS
182380991214     C     VIDNT2        ANDEQ     *BLANKS
182390991214     C* NOTA 1
182400991214     C                   MOVEL     '8'           D19TRC
182410991214     C                   MOVEL     VIDNT1        D19NT1
182420991214     C                   CLEAR                   D19NT2
182430991214     C                   CALL      'FNLV19R'
182440991214     C                   PARM                    DSLV19
182450991214     C* NOTA 2
182460991214     C                   MOVEL     '9'           D19TRC
182470991214     C                   MOVEL     VIDNT2        D19NT1
182480991214     C                   CLEAR                   D19NT2
182490991214     C                   CALL      'FNLV19R'
182500991214     C                   PARM                    DSLV19
182510991214    1C                   ENDIF
182520000508     C* DATI POSTE SOLO IN CONFERMA
182530000508     C     *IN12         IFEQ      *ON
182540000508     C     *IN15         ANDEQ     *ON
182550020319     C     §ogntw        ANDEQ     'PPT'
182560000509     C* SE CE' IAS O XCO
182570000509     C     §B4IAS        IFGT      0
182580000509     C     §B4XCO        ORNE      ' '
182590001221     C     §B4DSC        ORNE      *BLANKS
182600000508     C                   CLEAR                   DSLV19
182610060215     C                   MOVEL     'T'           D19ftr
182620000508     C                   MOVEL     BLPAAS        D19AAS
182630000508     C                   MOVEL     BLPLNP        D19LNP
182640000508     C                   MOVEL     BLPNRS        D19NRS
182650000508     C                   MOVEL     BLPNSP        D19NSP
182660000508     C                   MOVEL     DSBL4J        D19NT1
182670000508     C                   MOVEL     'J'           D19TRC
182680000508     C                   CALL      'FNLV19R'
182690000508     C                   PARM                    DSLV19
182700000508     C                   ENDIF
182710000509     C                   ENDIF
182720000623     C*
182730000623     C* SE ESISTE TABELLA 3Q, CREO RECORD VUOTO W
182740060217     c* Se sono in manutenzione aggiorno (azzero la data) solo se cambi
182750060217     c* ato codice
182760000623    1C     WES3Q         IFEQ      'S'
182770060217     c
182780060217     c                   if        *in12 = *off or *in15 = *on or
182790060217     c                             wksc <> savmit
182800000623     C*
182810060217     C                   CLEAR                   DSBL4W
182820060223     C                   CLEAR                   DSLV19
182830000623     C**
182840060217     C                   MOVEL     DSBL4W        d19nt1
182850060217     C                   MOVEL     BLPAAS        d19AAS
182860060217     C                   MOVEL     BLPLNP        d19LNP
182870060217     C                   MOVEL     BLPNRS        d19NRS
182880060217     C                   MOVEL     BLPNSP        d19NSP
182890060217     C                   MOVEL     'W'           d19TRC
182900060223     c                   movel     'T'           d19ftr
182910060217     c                   clear                   d19nt2
182920060217     c* se sono in manutenzione richiamo fnlv19r solo se cambiato codice
182930060217     C                   CALL      'FNLV19R'
182940060217     C                   PARM                    DSLV19
182950060217     c                   endif
182960000623     C*
182970000623   X1C                   ELSE
182980000623     C* SE ESISTEVA MA ADESSO NON ESISTE PIU' DEVO CANCELLARE IL RECORD
182990000623    2C     WBL4W         IFEQ      'E'
183000060223     c                   clear                   dslv19
183010060217     C                   clear                   d19nt1
183020060217     C                   MOVEL     BLPAAS        d19AAS
183030060217     C                   MOVEL     BLPLNP        d19LNP
183040060217     C                   MOVEL     BLPNRS        d19NRS
183050060217     C                   MOVEL     BLPNSP        d19NSP
183060060217     C                   MOVEL     'W'           d19TRC
183070060223     c                   movel     'T'           d19ftr
183080060217     c                   clear                   d19nt2
183090060217     C                   CALL      'FNLV19R'
183100060217     C                   PARM                    DSLV19
183110000623    2C                   ENDIF
183120000623    1C                   ENDIF
183130090325     C* Impostazione campi cliente/tariffa per tassazione porti assegnati
183140090805     c                   clear                   w_ar5ass
183150090325     c                   if        *in04
183160090325     c                   exsr      riewdwcli
183170091027     c                   select
183180091027     c                   when      flgfit<>'S' and ormpag='O'
183190090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
183200090806     c                                 %editc(ormksc:'X')
183210090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
183220090806     c                                 %subst(%editc(ormcor:'X'):1:7)
183230090804     c                   eval      w_ar5ass='T'
183240091027     c                   when      *in12 and *in15 and §lpass='T'
183250091027     c                   eval      w_ar5ass='T'
183260091027     c                   endsl
183270090325     c                   endif
183280091214     c* impostazione campo codice benefeiciario contrassegno
183290091214     c                   clear                   w_ar5cdi
183300091214     c                   select
183310091214     c                   when      wcassel2='X' and wwdwcas='S'
183320091214     c                   eval      w_ar5cdi=wcascor
183330091214     c                   when      *in12 and *in15 and §lpcdi>0
183340091214     c                   eval      w_ar5cdi=§lpcdi
183350091214     c                   endsl
183360090325     c*
183370010215     C* SE ATTIVATA PROCEDURA O.R.M. E NUMERO O.R.M. NON FITTIZIO LO
183380060215     C* MEMORIZZO SU Fiar4 TIPO RECORD "M"
183390060215      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
183400010925      * TIPO RECORD "Z" PER RITORNO VAS
183410010925    1C     WORM          IFEQ      'S'
183420010220     C     PARTCH        ANDNE     'P'
183430010228     C     WORM          OREQ      'S'
183440010228     C     VIDMAG        ANDNE     'S'
183450010713     C     §3ARBL        ANDNE     'R'
183460010215     C                   CLEAR                   DSLV19
183470060215     C                   MOVEL     'T'           D19ftr
183480010215     C                   MOVEL     BLPAAS        D19AAS
183490010215     C                   MOVEL     BLPLNP        D19LNP
183500010215     C                   MOVEL     BLPNRS        D19NRS
183510010215     C                   MOVEL     BLPNSP        D19NSP
183520010925    2C     FLGFIT        IFNE      'S'
183530010228     C     PARTCH        OREQ      'P'
183540010215     C  N12
183550010215     COR 12
183560010215     CAN 15              CLEAR                   DSBL4M
183570010925    3C     PARTCH        IFEQ      'P'
183580010228     C                   Z-ADD     §RMPOO        §B4POE
183590010228     C                   Z-ADD     §RMNSO        §B4NSR
183600010228     C                   Z-ADD     §RMNOO        §B4NOR
183610010228     C                   Z-ADD     §RMNRO        §B4NRV
183620010925   X3C                   ELSE
183630010215     C                   Z-ADD     WOPOE         §B4POE
183640010222     C                   Z-ADD     WONSR         §B4NSR
183650010222     C                   Z-ADD     WONOR2        §B4NOR
183660010215     C                   Z-ADD     WONRV         §B4NRV
183670010925    3C                   ENDIF
183680090325     c*
183690090325     c                   if        *in04
183700090325     c                   eval      §b4clg=wclg
183710090325     c                   endif
183720010221     C*
183730010925     C                   MOVEL     'M'           D19TRC
183740010215     C                   MOVEL     DSBL4M        D19NT1
183750010215     C                   CALL      'FNLV19R'
183760010215     C                   PARM                    DSLV19
183770060216      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
183780010925      * TIPO RECORD "Z" PER RITORNO VAS
183790121123    3c                   if        not *in12 or *in15
183800121123    4C     §ORMKS        IFEQ      'S'
183810040319     C     ORMKSC        ANDGT     *ZEROS
183820010925     C                   MOVEL     'Z'           D19TRC
183830010925     C                   CLEAR                   D19NT1
183840010925     C                   CLEAR                   D19NT2
183850010925     C                   CLEAR                   D19ERR
183860010927     C                   CLEAR                   DSBL4Z
183870010925     C                   MOVEL     ORMKSC        §B4OKC
183880010925     C                   MOVEL     DSBL4Z        D19NT1
183890010925     C                   CALL      'FNLV19R'
183900010925     C                   PARM                    DSLV19
183910121123    4C                   ENDIF
183920121123   x3c                   else
183930121122     c* in manutenzione verifico se modificare cancellare o aggiungere ar4 trk Z
183940130219     c* . . . se situazione invariata non faccio nulla
183950130219     c                   clear                   wnoZ              1
183960130219    4c                   if        wesar4z='S' and §ormks='S'
183970130219     c                             and wkscz=ormksc
183980130219     c                   eval      wnoZ='N'
183990130219    4c                   endif
184000130219    4c                   if        wnoz=*blanks  and
184010130219     c                             (wesar4z='S' and wtrasmz='N' or
184020130219     c                             (§ormks='S' and ormksc>*zeros))
184030121123     C                   MOVEL     'Z'           D19TRC
184040121123     C                   CLEAR                   D19NT1
184050121123     C                   CLEAR                   D19NT2
184060121123     C                   CLEAR                   D19ERR
184070121123     C                   CLEAR                   DSBL4Z
184080121122
184090121123    5c                   select
184100121123     c* era presente tipo record "Z"  ma ora non più : cancella se non trasmesso
184110121123     c                   when      wesar4z='S' and §ormks<>'S'
184120121126     c* era presente tipo record "Z" prima e adesso ma cliente diverso: aggiorna
184130121126     c* a sflagga per la ritrasmissione
184140121123     c                   when      wesar4z='S' and §ormks='S' and ormksc>*zeros
184150121123     c                             and wkscz<>ormksc
184160121123     C                   MOVEL     ORMKSC        §B4OKC
184170121126     C                   clear                   §B4dtr
184180121123     C                   MOVEL     DSBL4Z        D19NT1
184190121123     c* non era presente tipo record "Z" e ora si: scrive nuovo "Z"
184200121123     c                   when      wesar4z<>'S'
184210121123     C                   MOVEL     ORMKSC        §B4OKC
184220121123     C                   MOVEL     DSBL4Z        D19NT1
184230121123    5c                   endsl
184240121123     C                   CALL      'FNLV19R'
184250121123     C                   PARM                    DSLV19
184260121123    4c                   endif
184270121123    3c                   endif
184280010925      *--
184290010925   X2C                   ELSE
184300010925      *--
184310010215     C* SE SONO IN MANUTENZIONE E N. O.R.M. FITTIZIO DEVO CANCELLARE
184320060215     C* ar4 CON TIPO RECORD "M" E "Z" SE PRESENTI
184330010925    3C     *IN12         IFEQ      *ON
184340010215     C     *IN15         ANDEQ     *OFF
184350010925     C                   MOVEL     'M'           D19TRC
184360010215     C                   CALL      'FNLV19R'
184370010215     C                   PARM                    DSLV19
184380121127     c* Record "Z" lo cancello solo se non trasmesso.
184390121127     c* Se invece era stato trasmesso non lo cancello per mantenere traccia di
184400121127     c* quello che era stato fatto
184410121127     c                   if        wesar4z='S' and wtrasmz='N'
184420010925     C                   MOVEL     'Z'           D19TRC
184430010925     C                   CALL      'FNLV19R'
184440010925     C                   PARM                    DSLV19
184450121127     c                   endif
184460040319      * cancello anche il record 'A'
184470040319      * ma solo se prima dell'ORM fittizio era impostato un ORM reale
184480040319      * e lo so testando il flag wmodorm impostato nella ctrorm
184490040319if  4c                   If        wmodorm = *On
184500040319     c                   Movel     'A'           d19trc
184510040319     c                   Call      'FNLV19R'
184520040319     c                   Parm                    dslv19
184530040319e   4c                   EndIf
184540010925    3C                   ENDIF
184550010925      *
184560010925    2C                   ENDIF
184570010925    1C                   ENDIF
184580090325     c*
184590090325     c* memorizzo ksc/ctr per p.assegnati
184600090325     c                   if        *in04
184610090325     c                   Clear                   dsbl4a
184620090325     c                   Clear                   dslv19
184630090325     C                   MOVEL     'T'           D19ftr
184640090325     C                   MOVEL     BLPAAS        D19AAS
184650090325     C                   MOVEL     BLPLNP        D19LNP
184660090325     C                   MOVEL     BLPNRS        D19NRS
184670090325     C                   MOVEL     BLPNSP        D19NSP
184680090325     c                   Movel     'A'           d19trc
184690090327     c                   if        wcliksc>0
184700090327     c                   z-add     wcliksc       §b4aks
184710090326     C                   IF        wclictr<>*blanks
184720090325     c                   move      wclictr       §b4act
184730090325     c                   endif
184740090325     c                   exsr      sr_fncls
184750090325     c                   move      wclsflo8      §b4af1
184760090325     c                   Movel     dsbl4a        d19nt1
184770090325     c                   Call      'FNLV19R'
184780090325     c                   Parm                    Dslv19
184790090325     c                   endif
184800090325     c                   endif
184810110706     c* memorizzo CUP/CIG se presenti
184820110706     c                   if        wcupcup<>*blanks or wcupcig<>*blanks
184830110706     c                   Clear                   dsbl44
184840110706     c                   Clear                   dslv19
184850110706     C                   MOVEL     'T'           D19ftr
184860110706     C                   MOVEL     BLPAAS        D19AAS
184870110706     C                   MOVEL     BLPLNP        D19LNP
184880110706     C                   MOVEL     BLPNRS        D19NRS
184890110706     C                   MOVEL     BLPNSP        D19NSP
184900110706     c                   Movel     '4'           d19trc
184910110706     c                   movel     wcupcup       §b44cup
184920110706     c                   movel     wcupcig       §b44cig
184930110706     c                   Movel     dsbl44        d19nt1
184940110706     c                   Call      'FNLV19R'
184950110706     c                   Parm                    Dslv19
184960110706     c                   else
184970110706     c                   if        *in12 and not *in15
184980110706     c                   Clear                   dslv19
184990110706     C                   MOVEL     'T'           D19ftr
185000110706     C                   MOVEL     BLPAAS        D19AAS
185010110706     C                   MOVEL     BLPLNP        D19LNP
185020110706     C                   MOVEL     BLPNRS        D19NRS
185030110706     C                   MOVEL     BLPNSP        D19NSP
185040110706     c                   Movel     '4'           d19trc
185050110706     c                   Call      'FNLV19R'
185060110706     c                   Parm                    Dslv19
185070110706     c                   endif
185080110706     c                   endif
185090130305     c* F I A R 8
185100130305     c* Se sono in conferma bolle da dischetto e ctm che prevede fivax
185110130305     c* scrivo fiar8
185120130308     c                   clear                   w_allx
185130130408     c                   clear                   w_allm
185140130417     c                   clear                   w_alls
185150130305     c                   If        *In12 and *In15
185160130305     c                             and §1bf16 = 'S'
185170130305     c                   if        wvax='S'
185180130305     c                   exsr      sr_fiar8
185190130305     c                   endif
185200130305     c                   if        wvatp='S'
185210130305     c                   exsr      sr_fiar8_vatp
185220130305     c                   endif
185230130305     c                   endif
185240130305     c* se richiamato da pgm "Wanda" vedo se creare fiar8 oer la nuova
185250130305     c* bolla copiando i dati dal fiar8 della bolla mamma
185260130305     c   12
185270130305    1can 15savfpr        ifeq      'G'
185280130305     c     savfpr        oreq      'P'
185290130305    2c     §lpar8        ifeq      'S'
185300130305     c     kbolm         setll     fiar801l
185310130305    3c                   do        *hival
185320130305     c     kbolm         reade(n)  fiar801l
185330130305    4c                   if        %eof(fiar801l)
185340130305     c                   leave
185350130305    4c                   endif
185360130305     c                   Eval      Ar8Aas = BlpAas
185370130305     c                   Eval      Ar8Lnp = BlpLnp
185380130305     c                   Eval      Ar8Nrs = BlpNrs
185390130305     c                   Eval      Ar8Nsp = BlpNsp
185400130305     c                   write     fiar8000
185410130311    4c                   if        ar8tmd<>'§PDF'
185420130311     c                   eval      w_allx='S'
185430130408     c                   else
185440130408     c                   eval      dar8§pdf=ar8uni
185450130408     c* il secondo byte è per la mail  ('1'=invia mail)
185460130408    5c                   if        %subst(§ar8pidz:2:1)='1'
185470130408     c                   eval      w_allm='S'
185480130408    5c                   endif
185490130417     c*
185500130417    5c                   if        %subst(§ar8pidz:1:1)='1' and
185510130417    5c                             (§ar8ptrt='S' or §ar8ptrt='X')
185520130417     c                   eval      w_alls='S'
185530130417    5c                   endif
185540130417     c*
185550130311    4c                   endif
185560130305    3c                   enddo
185570130305    2c                   endif
185580130305    1c                   endif
185590130305     c* F I A R 5
185600030805      * se bolla con bancali - part. varia "B"
185610021218      * scrivo o aggiorno il file estensione FIAR500F record "BAN"
185620030704     c                   If        %subst(VidGva:1:1) = 'B'
185630021218     c                   Clear                   DAr5Ban
185640030704     c                   Eval      Kar5Trd = 'BAN'
185650021218     c     KFiar5        Chain     Fiar501l
185660021218     c                   Move      Dateu         Ar5Dac
185670021218     c                   Movel     W0140         Ar5Orc
185680021218     c                   Movel     VidTba        §Ar5Tba
185690021218     c                   Eval      §Ar5Nba = VidNba
185700021218     c                   Movel     VidTb2        §Ar5Tb2
185710021218     c                   Eval      §Ar5Nb2 = VidNb2
185720021218     c                   Movel(p)  DAr5Ban       Ar5Uni
185730030704     c                   ExSr      Sr_wrtFiar5
185740021218     c                   EndIf
185750030805      * se bolla con bancali - part. varia "O"
185760030704      * scrivo o aggiorno il file estensione FIAR500F record "BNB"
185770030730      * se non richiamto da giacenze
185780031125     c                   If        %subst(VidGva:1:1) = 'O'
185790030704     c                   Clear                   DAr5Bnb
185800030704     c                   Eval      Kar5Trd = 'BNB'
185810030704     c     KFiar5        Chain     Fiar501l
185820030704     c                   Move      Dateu         Ar5Dac
185830030704     c                   Movel     W0140         Ar5Orc
185840030704     c                   Movel     VidTba        §Ar5bTba
185850030704     c                   Eval      §Ar5bNba = VidNba
185860030704     c                   Movel     VidTb2        §Ar5bTb2
185870030704     c                   Eval      §Ar5bNb2 = VidNb2
185880030704     c                   Eval      §Ar5bCor = w03cor
185890030704     c                   Eval      §Ar5bCsf = w03csf
185900030704     c                   Movel(p)  DAr5Bnb       Ar5Uni
185910030704     c                   ExSr      Sr_wrtFiar5
185920030704     c                   EndIf
185930030805      * se bolla con paricolarità consegna "RC"
185940030805      * scrivo o aggiorno il file estensione FIAR500F record "RCC"
185950030912      * solo se non sono richiamata da giacenze
185960100604     c**                 If        VidGma = 'RC' and
185970100604     c                   If        §7rRC  = 'S'  and
185980030912     c                             savfpr <> 'G' and savfpr <> 'P'
185990091124      * Aggiorno l'ORM se sono in immissione
186000091124     c                   If        Not *In12 or
186010091124     c                             (*In12 and *In15)
186020091221      * oppure aggiornamento ed inserito "RC"
186030100604     c                             or (*in12 and Not *in15 and w7rRC <> 'S')
186040091124     c                   Eval      wope = 'A'
186050091124     c                   ExSr      Sr_Ricorm
186060030805     c                   Clear                   DAr5Rcc
186070030805     c                   Eval      Kar5Trd = 'RCC'
186080030805     c     KFiar5        Chain     Fiar501l
186090030805     c                   Move      Dateu         Ar5Dac
186100030805     c                   Movel     W0140         Ar5Orc
186110030805     c                   Eval      §Ar5rPoe = savOrmPoe
186120030805     c                   Eval      §Ar5rNsr = savOrmNsr
186130030805     c                   Eval      §Ar5rNor = savOrmNor
186140030805     c                   Eval      §Ar5rNrv = savOrmNrv
186150030805     c                   Movel(p)  DAr5Rcc       Ar5Uni
186160030805     c                   ExSr      Sr_wrtFiar5
186170091221     c                   EndIf
186180030805     c                   EndIf
186190031113      * Se inseriti il referente o il n. di telefono devo memorizzarli
186200031113      * nel FIAR500F record "GEN"
186210040610      * Idem per tipo merce v-valore
186220090804      * Idem se bolla in assegnato con triangolazione
186230110527      * 27/05/11 Ci sarà sempre il record GEN, quindi chaino sempre e scrivo o
186240110527      *          aggiorno
186250110527if  1c****               If        VidRef <> *Blanks or VidTel <> *Blanks
186260110527     c****                         or vidbva <> *blanks  or w_ar5ass='T'
186270110527     c****                         or w_ar5tcp<>*blanks or w_ar5tic<>*blanks
186280110527     c****                         or ar9tic<>*blanks or
186290110527     c****                         w_ar5cdi>0 or not *in12 or *in15
186300031113     c                   Clear                   DAr5Gen
186310031113     c                   Eval      Kar5Trd = 'GEN'
186320031113     c     KFiar5        Chain     Fiar501l
186330031114if  2c                   If        Not %Found(Fiar501l)
186340031113     c                   Move      Dateu         Ar5Dac
186350031113     c                   Movel     W0140         Ar5Orc
186360110527     c                   eval      §ar5bpru=knmus
186370110527     c                   eval      §ar5bnmtd=knmtd
186380031114     c                   Eval      §Ar5Ref = VidRef
186390031114     c                   Eval      §Ar5Teld = VidTel
186400040610     c                   Eval      §Ar5bva = Vidbva
186410090804     c                   Eval      §Ar5ass = w_ar5ass
186420091001     c                   Eval      §Ar5tcp = w_ar5tcp
186430091001     c                   Eval      §Ar5tic = w_ar5tic
186440091104     c                   Eval      §Ar5tici =ar9tic
186450091214     c                   if        w_ar5cdi>0
186460091214     c                   Eval      §Ar5CDI  =%editc(w_ar5cdi:'X')
186470091119     c                   else
186480091119     c                   clear                   §ar5cdi
186490091118     c                   endif
186500130308     c                   eval      §ar5alx=w_allx
186510130408     c                   eval      §ar5alm=w_allm
186520130417     c                   eval      §ar5als=w_alls
186530031113     c                   Movel(p)  DAr5Gen       Ar5Uni
186540031113     c                   ExSr      Sr_wrtFiar5
186550031114   x2c                   Else
186560040610     c                   movel     ar5uni        DAr5Gen
186570031114     c                   Eval      §Ar5Ref = VidRef
186580031114     c                   Eval      §Ar5Teld = VidTel
186590040610     c                   eval      §ar5bva = vidbva
186600090804     c                   Eval      §Ar5ass = w_ar5ass
186610091001     c                   Eval      §Ar5tcp = w_ar5tcp
186620091001     c                   Eval      §Ar5tic = w_ar5tic
186630091104     c                   Eval      §Ar5tici =ar9tic
186640091214     c                   if        w_ar5cdi>0
186650091214     c                   Eval      §Ar5cdi  =%editc(w_ar5cdi:'X')
186660091119     c                   else
186670091119     c                   clear                   §ar5cdi
186680091118     c                   endif
186690031113     c                   Movel(p)  DAr5Gen       Ar5Uni
186700031113     c                   Update    Fiar5000
186710031114    2c                   EndIf
186720110527    1c****               EndIf
186730110512      * Indirizzo email destinatario
186740110512      * scrivo o aggiorno il file estensione FIAR500F record "EMD"
186750130315     c                   If        wemdest <> *blanks  or wsms<>*blanks
186760110512     c                   Clear                   DAr5emd
186770110512     c                   Eval      Kar5Trd = 'EMD'
186780110512     c     KFiar5        Chain     Fiar501l
186790110613if  2c                   If        Not %Found(Fiar501l)
186800110512     c                   Move      Dateu         Ar5Dac
186810110512     c                   Movel     W0140         Ar5Orc
186820110512     c                   Movel     wemdest       §Ar5eml
186830130315     c                   movel     wsms          §ar5tel
186840130315     c                   movel     wsmp          §ar5smp
186850110512     c                   Movel(p)  DAr5emd       Ar5Uni
186860110512     c                   ExSr      Sr_wrtFiar5
186870110613     c                   else
186880110613     c                   movel     ar5uni        DAr5emd
186890110613     c                   Movel     wemdest       §Ar5eml
186900130315     c                   movel     wsms          §ar5tel
186910130315     c                   movel     wsmp          §ar5smp
186920111012     c                   Movel(p)  DAr5Emd       Ar5Uni
186930110613     c                   Update    Fiar5000
186940110613     c                   endif
186950110512     c                   EndIf
186960040610      * Se non sono inseriti il referente e il n. di telefono e v-valore
186970031114      * e sono in manutenzione cancello il FIAR500F record "GEN"
186980110527if  1c****               If        *In12 and Not *In15 and
186990110527     c*****                        VidRef = *Blanks and VidTel = *Blanks
187000110527     c*****                        and vidbva = *blanks
187010110527     c*****                        and w_ar5ass=*blanks
187020110527     c******                       and w_ar5tcp=*blanks
187030110527     c******                       and w_ar5tic=*blanks
187040110527     c******                       and ar9tic=*blanks
187050110527     c*****                        and w_ar5cdi=0
187060110527     c*****              Eval      Kar5Trd = 'GEN'
187070110527     c**** KFiar5        Chain     Fiar501l
187080110527     c****               If        %Found(Fiar501l)
187090110527     c****               Delete    Fiar5000
187100110527     c****               EndIf
187110110527    1c****               EndIf
187120030805      * se sono in manutenzione bolla e non c'è la particolarità
187130021218      * varie "B" controllo se c'è il record in FIAR500F record "BAN"
187140021218      * se c'è è da cancellare
187150030127     c                   If        *In12 and Not *In15 and
187160030704     c                             %Subst(BlpGva:1:1) <> 'B'
187170030704     c                   Eval      Kar5Trd = 'BAN'
187180021218     c     KFiar5        Chain     Fiar501l
187190021218     c                   If        %Found(Fiar501l)
187200021218     c                   Delete    Fiar5000
187210021218     c                   EndIf
187220021218     c                   EndIf
187230030805      * se sono in manutenzione bolla e non c'è la particolarità
187240030704      * varie "O" controllo se c'è il record in FIAR500F record "BNB"
187250030704      * se c'è è da cancellare
187260030704     c                   If        *In12 and Not *In15 and
187270030704     c                             %Subst(BlpGva:1:1) <> 'O'
187280030704     c                   Eval      Kar5Trd = 'BNB'
187290030704     c     KFiar5        Chain     Fiar501l
187300030704     c                   If        %Found(Fiar501l)
187310030704     c                   Delete    Fiar5000
187320030704     c                   EndIf
187330030704     c                   EndIf
187340030807      * se sono in manutenzione bolla e non c'è la particolarità
187350030807      * consegna "RC" controllo se c'è il record in FIAR500F record "RCC"
187360030807      * se c'è è da cancellare
187370030807     c                   If        *In12 and Not *In15 and
187380100604     c                             §7rRC  <> 'S'
187390100604     c***                          BlpGma <> 'RC'
187400030807     c                   Eval      Kar5Trd = 'RCC'
187410030807     c     KFiar5        Chain     Fiar501l
187420030807     c                   If        %Found(Fiar501l)
187430030807     c                   Delete    Fiar5000
187440030807     c                   EndIf
187450030807     c                   EndIf
187460110512      * In msanutenzine cancello fiar5 rcd EMD se è stato eliminato
187470110512if  1c                   If        *In12 and Not *In15 and
187480110512     c                             wemdest = *blanks  and atremd=*blanks
187490130315     c                             and wsms=*blanks
187500110527     c                   Eval      Kar5Trd = 'EMD'
187510110512     c     KFiar5        Chain     Fiar501l
187520110512     c                   If        %Found(Fiar501l)
187530110512     c                   Delete    Fiar5000
187540110512     c                   EndIf
187550110512    1c                   EndIf
187560061213     c*
187570061213     C                   CLEAR                   WABLT
187580071221     C                   CLEAR                   WAgglna           1
187590071221    0c                   if        *in12 and not *in15
187600071221   0Ac                   if        §1bfg6='C' and savlna<>vidlna and
187610071221     c                             §clidkb='S'
187620071221     c                   eval      wagglna='S'
187630071221  x0Ac                   else
187640071221     C*  12
187650071221    1C*ANN15BLPFNS        IFEQ      ' '
187660071221    1c     blpfns        ifeq      ' '
187670061213     C     BLPNCD        ANDNE     0
187680061213     C     §1BFG8        ANDNE     'N'
187690061213     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
187700061213     C     §1BFG8        OREQ      'N'
187710061213     C**
187720061213     C* VEDO SE CANCELLARE LE SPUNTE ENTRATA:
187730061213     C* 1) SE FG8 = N SEMPRE
187740061213     C* 2) SE MODIFICATA LA LNA SEMPRE
187750061213     C* 3) SE AUMENTATO IL NUMERO DEI COLLI SOLO SE FG6 =D O I
187760061213     C* 4) SE DIMINUITO IL NUMERO DEI COLLI SOLO PER GLI ULTIMI
187770061213     C                   MOVEL     'S'           WDELBR            1
187780061213     C                   MOVEL     'S'           WABLT             1
187790061213    2C                   SELECT
187800061213     C     §1BFG8        WHENEQ    'N'
187810061213     C     SAVLNA        ORNE      VIDLNA
187820061213     C                   Z-ADD     99999         WCONTC            5 0
187830061213     C*
187840061213     C     SAVNCL        WHENLT    VIDNCL
187850061213     C     §1BFG6        ANDEQ     'D'
187860061213     C     SAVNCL        ORLT      VIDNCL
187870061213     C     §1BFG6        ANDEQ     'I'
187880061213     C                   Z-ADD     99999         WCONTC            5 0
187890061213     C*
187900061213     C     SAVNCL        WHENGT    VIDNCL
187910061213     C     §1BFG6        ANDEQ     'D'
187920061213     C     SAVNCL        ORGT      VIDNCL
187930061213     C     §1BFG6        ANDEQ     'I'
187940061213     C                   CLEAR                   WCONTC
187950061213     C     SAVNCD        WHENNE    BLPNCD
187960061213     C     SAVNCA        ORNE      BLPNCA
187970061213     C                   MOVEL     'N'           WDELBR            1
187980061213   X2C                   OTHER
187990061213     C                   MOVEL     'N'           WDELBR            1
188000061213     C                   MOVEL     'N'           WABLT
188010061213    2C                   ENDSL
188020061213    1c                   endif
188030071221   0Ac                   endif
188040071221    0c                   endif
188050061213     c* In manutenzione bolle , se riscrivo  fnblt devo clearare blpncr/ncp
188060061213    1c                   if        *in12 and not *in15
188070061213    2c                   if        wablt='S'
188080061213     c                   clear                   blpncr
188090061213     c                   clear                   blpncp
188100061213     c                   clear                   blpvlc
188110061213     c                   clear                   blppkc
188120061213   x2c                   else
188130061213     c* Se già calcolato volume cml devo reimpostarlo su VLF
188140061213    3c                   if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
188150061213     c                   clear                   dslv20
188160061213     C                   MOVEL     'P'           D20TBO
188170061213     C                   MOVEL     'C'           D20TVL
188180061213     c                   movel     'L'           d20tla
188190061213     C                   MOVEL     BLPvlc        D20vlu
188200061213     C                   MOVEL     BLPncr        D20ncr
188210061213     C                   MOVEL     BLPFVF        D20FVF
188220061213     C                   MOVEL     BLPVLF        D20VLF
188230061213     C                   MOVEL     BLPFVB        D20FVB
188240061213     C                   MOVEL     BLPVLB        D20VLB
188250061213     C                   MOVEL     BLPAAS        D20AAS
188260061213     C                   MOVEL     BLPLNP        D20LNP
188270061213     C                   MOVEL     BLPNRS        D20NRS
188280061213     C                   MOVEL     BLPNSP        D20NSP
188290061213     C                   MOVEL     BLPCBO        D20CBO
188300061213     C                   MOVEL     BLPNCL        D20NCL
188310061213    4C     BLPDBR        IFGT      *ZEROS
188320061213     C                   MOVE      BLPDBR        D20DTE
188330061213     C                   ELSE
188340061213     C                   MOVE      BLPMGS        D20DTE
188350061213     C                   MOVEL     BLPAAS        D20DTE
188360061213    4C                   END
188370061213     C                   MOVEL     DSLV20        KPJBU
188380061213     C*
188390061213     C                   CALL      'FNLV20R'
188400061213     C                   PARM                    KPJBA
188410061213     c                   parm      'N'           pwstor            1
188420061213     C*
188430061213     C                   MOVEL     KPJBU         DSLV20
188440061213     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
188450061213    4C     D20ERR        IFNE      '1'
188460061213     C                   MOVEL     D20FVF        BLPFVF
188470061213     C                   MOVEL     D20VLF        BLPVLF
188480061213E   4C                   ENDIF
188490061213    3c                   endif
188500061213    2c                   endif
188510061213    1c                   endif
188520070403     c*
188530070403     c                   exsr      sr_fiarg
188540070604     c*
188550070529     c* manutenzione di un prepagato ed è stato variato l'importo fattura
188560070529     c* eseguo operazioni per invio dati a PDA
188570070601    1c                   if        *in12 and *in15='0' and *in22
188580080213     c                             and vidimv<>savimvo and s_§ogpdaorm<>*blanks
188590070529     c                             and (ormfao=400 or ormfao=410)
188600070604     c                   exsr      sr_pda
188610070601    1c                   endif
188620111026     c* Richiamo pgm per scrittura R.A. in caso di manutenzione con
188630111026     c* riassegnazione segnacolli
188640111026     c                   if        RA_ncl>0
188650111026     c                   exsr      sr_wrtRA
188660111026     c                   endif
188670040601     c
188680950713     C**
188690950713     C* W R I T E   I N   F N B L P 0 0 F
188700950713     C   12
188710950713     CAN 15
188720950713     CORN12              WRITE     FNBLP000
188730950713     C* SE MANUTENZIONE AGGIORNO
188740950713     C   12
188750950713     CANN15              UPDATE    FNBLP000
188760081014     c                   if        *in12 and *in15 and §3cabd_s<>' '
188770081014     c                   clear                   trtc86drds
188780081020     c                   eval      i86mod='UV'
188790081020     c                   z-add     §fgs          i86fgsv
188800081020     c                   z-add     §lpaac        i86aasv
188810081014     c                   z-add     §lplnp        i86lnpv
188820081014     c                   z-add     §lpnrs        i86nrsv
188830081014     c                   z-add     §lpnsp        i86nspv
188840081014     c                   z-add     §lpccm        i86ccmv
188850081014     c                   z-add     §lprmn        i86rmnv
188860081014     c                   move      §lprma        i86rmav
188870081014     c                   z-add     blpaas        i86aasb
188880081014     c                   z-add     blplnp        i86lnpb
188890081014     c                   z-add     blpnrs        i86nrsb
188900081014     c                   z-add     blpnsp        i86nspb
188910081017     c                   if        blpccm>0
188920081014     c                   z-add     blpccm        i86ccmb
188930081017     c                   else
188940081017     c                   z-add     blpksc        i86ccmb
188950081017     c                   endif
188960081014     c                   z-add     blprmn        i86rmnb
188970081014     c                   move      blprma        i86rmab
188980081014     c                   call      'TRTC86DRR'
188990081014     c                   parm                    trtc86drds
189000081014     c                   endif
189010110902     c* Se valore di accorpamento spedizioni in consegna non valido invio
189020110902     c* email a CED
189030110902     c                   if        werrxco=*on
189040110902     c                   exsr      sr_mail
189050110902     c                   endif
189060971215     C**
189070971215     C** VERIFICO SE C'E' ETICHETTA ESTERA DA STAMPARE
189080081008     C**                 CLEAR                   WESTER
189090000204     C* ANCHE PER DPD
189100081008     C**   A_§OGNTW      IFEQ      'DPD'
189110040525     c* se ogsea = "S" significa che l'etichetta estera viene stampata in
189120040525     c* arrivo e quindi lascio wester = blanks
189130081008     c***  A_§ogsea      andne     'S'
189140081008     C***                MOVEL     'S'           WESTER
189150081008     C***                ENDIF
189160001024     C* MANUTENZIONE: SE MODIFICATA DATA SPEDIZIONE AGGIORNO LA DATA
189170001024     C*               ANCHE SU FISGN
189180001024     C   12
189190001024     CANN15BLPDSP        IFNE      WBDSP
189200001024     C     §3CDKC        IFEQ      'S'
189210001024     C     *IN79         ANDEQ     *ON
189220001024     C     §1BF12        ORNE      'N'
189230001106     C     §1BF12        ANDNE     'E'
189240001106     C     §1BF12        OREQ      'E'
189250001106     C     WASDKC        ANDEQ     'S'
189260001024     C     KBLP3         SETLL     FISGN05L
189270001024     C     KBLP3         READE     FISGN05L                               30
189280001024     C     *IN30         DOWEQ     *OFF
189290001024     C                   MOVE      BLPMGS        §LDMGS
189300010326     C                   Z-ADD     BLPTFA        §LDTNA
189310121213     c* Non serve più anzi crea problemi nel caso di fisgn duplicato su altro
189320121213     c* tfp.
189330121213     C***                Z-ADD     BLPTFP        SGNTNP
189340010116     C                   CLEAR                   SGNT6A
189350010116     C                   CLEAR                   SGNT6B
189360010116     C                   CLEAR                   SGNT6C
189370010116     C                   CLEAR                   SGNT6D
189380010116     C                   CLEAR                   SGNT6E
189390010116     C                   CLEAR                   SGNT6F
189400080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
189410001024     C                   UPDATE    FISGN005
189420001024     C     KBLP3         READE     FISGN05L                               30
189430001024     C                   ENDDO
189440001024     C                   ENDIF
189450001024     C                   ENDIF
189460000908     C*
189470000908     C* PER DISK C INSERITO CON DAL AL LO DEVO ESPLODERE
189480001009     C* (TEORICAMENTE DOVREI ESCLUDERE EXPORT DPD SE CHI SONO IMMESSO
189490001009     C* MANUALMENTE O DA RMN IN PRATICA ESCLUDO SEMPRE SE SI TRATTA
189500001009     C* DI EXPORT DPD DAL MOMENTO CHE LE SPEDIZIONI PER DPD SONO
189510001009     C* MONOCOLLO)
189520050224     c* per lo stesso motivo escludo anche le import dpd
189530000913    1C     §1BF12        IFNE      'N'
189540001011     C     WEXDPD        ANDNE     'S'
189550050223     c     *in79         andne     *on
189560000911     C     OZ1NCL        ANDGT     2
189570000908     C* I COD. CHI SONO CHE ESPLODO LI SCRIVO NEL SUBFILE IN AGGIUNTA
189580000908     C* PARTENDO DA NUMERO DI RECORD=NR8
189590000908     C* PRIMA DI CLEARARE LA DS MEMORIZZO IL DAL AL IMPOSTATI NEL
189600000908     C* RICHIAMO FATTO DURANTE I CONTROLLI
189610000911     C     OZ1MAX        IFEQ      '2'
189620000908     C                   MOVEL     IZ1CH1        CHIDAL
189630000908     C                   MOVEL     IZ1CH2        CHIAL
189640000911     C                   ELSE
189650000911     C                   MOVEL     IZ1CH2        CHIDAL
189660000911     C                   MOVEL     IZ1CH1        CHIAL
189670000911     C                   ENDIF
189680000908     C* FACCIO UN CICLO DI RICHIAMI A FNLSZ1R FINO AD ARRIVARE AL
189690000908     C* "CHI SONO" AL
189700000911     C                   MOVE      *ALL' '       WW               35
189710000911     C                   Z-ADD     1             IX
189720000911     C     WW            LOOKUP    CHI(IX)                                30
189730000908    2C     CHIDAL        DOWNE     CHIAL
189740000908     C                   CLEAR                   DSLSZ1
189750000908     C                   MOVEL     'E'           IZ1MOD
189760000908     C                   MOVEL     CHIDAL        IZ1CH1
189770000908     C                   Z-ADD     V8CKSC        IZ1CCM
189780000908     C                   MOVEL     BLPCTM        IZ1CTM
189790000908     C                   Z-ADD     BLPNRS        IZ1NRS
189800000908     C                   CALL      'FNLSZ1R'
189810010402     C                   PARM                    KPJBA
189820000908     C                   PARM                    DSLSZ1
189830000908     C                   PARM                    DS1B
189840000911     C     OZ1CHI        IFNE      CHIAL
189850000908     C                   MOVEL     OZ1CHI        V8CNOT
189860000908     C                   CLEAR                   V8CSCE
189870000908     C                   CLEAR                   V8HDKC
189880000908     C                   CLEAR                   V8HESG
189890000915     C                   CLEAR                   V8HST2
189900000915     C                   CLEAR                   V8HFLS
189910000915     C                   CLEAR                   V8HLNA
189920000915     C                   CLEAR                   V8HNRS
189930000915     C                   CLEAR                   V8HNSC
189940000921     C                   CLEAR                   V8HPRE
189950000911     C                   ADD       1             NR8
189960000911     C                   MOVEL     OZ1CHI        CHI(IX)
189970000911     C                   Z-ADD     NR8           POS(IX)
189980000918     C                   ADD       1             IX
189990000908     C                   WRITE     LS01S08
190000000911     C                   ENDIF
190010000908     C                   MOVEL     OZ1CHI        CHIDAL
190020000908    2C                   ENDDO
190030000908    1C                   ENDIF
190040070322     c* se sono in immissione/conferma bolla di sped export dpd
190050070322     c* con numero parcel lungo 12 carico vidnrd nel subfile
190060070322     c                   if        (*in12='0' or *in15='1') and
190070070322     c                             wexdpd='S' and wparcel='12'
190080070322     c                             and §1bf13<>'A'
190090070326     C* PULIZIA SFL
190100070326     C                   SETON                                        35
190110070326     C                   WRITE     LS01C08
190120070326     C                   SETOFF                                       357833
190130070326     c*
190140070322     c                   z-add     0             nr8
190150070322     C                   MOVEL     vidnrd        V8CNOT
190160070322     C                   MOVEL     *BLANKS       V8CSCE
190170070322     C                   MOVE      *BLANKS       V8HDKC
190180070322     C                   MOVE      *BLANKS       V8HESG
190190070322     C                   MOVE      *ZEROS        V8HST2
190200070322     C                   clear                   V8HFLS
190210070322     C                   clear                   V8HLNA
190220070322     C                   clear                   V8HNRS
190230070322     C                   clear                   V8HNSC
190240070322     C* SCRIVO SUBFILE
190250070322     C                   ADD       1             NR8
190260070322     C                   WRITE     LS01S08
190270070322     c                   endif
190280000204     C**
190290000204     C** PER SI DISK "C" --> CHAIN   F I S G N 0 0 F
190300000204    1C     §3CDKC        IFEQ      'S'
190310070323     c     *IN79         ANDEQ     *ON
190320000907     C     §1BF12        ORNE      'N'
190330001106     C     §1BF12        ANDNE     'E'
190340001106     C     §1BF12        OREQ      'E'
190350001106     C     WASDKC        ANDEQ     'S'
190360000204     C                   CLEAR                   WESSGN
190370000929     C                   CLEAR                   WSGNR
190380000208     C                   CLEAR                   FISGN000
190390000919     C                   MOVEL     'S'           WDKC              1
190400000204     C                   SELECT
190410000204     C* IMPORT DPD --> RIF.MITTENTE
190420060622     C     *IN79         WHENEQ    *ON
190430050301     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
190440050301     C                   CLEAR                   V8HCOL
190450060619    4C     savnpr        IFNE      v7cnpr
190460060623     c     savnpr        andne     *blanks
190470060622     C****               move      savnpr        W0120            12 0
190480060622     C****               MOVEL(P)  W0120         KWHO
190490060622     C     Kblp3         setll     FISGN05L
190500060622    5C                   do        *hival
190510060622     C     Kblp3         reade     FISGN05L
190520060622     c                   if        %eof(fisgn05l)
190530060622     c                   leave
190540060622     c                   endif
190550050301     C                   EXSR      ANNSGN
190560060622    5C                   ENDdo
190570050301     C                   ELSE
190580050301     C                   MOVE      *HIVAL        V8HCOL
190590050301    4C                   ENDIF
190600060621     c* Il chi sono per chainare fisgn lo compongo come segue:
190610060621     c* 1) se ho il barcode id -> barcodeId+CapDest+n.parcel+serv.code+iso N
190620060621     c* 2) se non ho il barcode id --> numero parcel lungo 11+1
190630060622    4c                   if        §b4ibi<>*blanks
190640060623     c* se sono in conferma bolle o in immissione o in manutenzione di
190650060623     c* bolla immessa a mano (no disk)
190660060623     c* compongo il chi sono con i dati che ho
190670060623    5c                   if        *in12='0' or *in15='1'
190680060623     c                             or  *in13='0'
190690090511    6c                   if        *in15='1'
190700090511    7c                   if        §lpcad<>*blanks
190710060622     c                   eval      §lpcad_w=§lpcad
190720090511   x7c                   else
190730060622     c                   eval      §lpcad_w=blpcad
190740090511    7c                   endif
190750090514     c                   else
190760090514     c                   eval      §lpcad_w=blpcad
190770090511    6c                   endif
190780060621     c                   clear                   outcapdpd
190790060621     c                   call      'XCAPDPD'
190800060622     c                   parm                    §lpcad_w
190810060621     c                   parm                    outcapdpd         7
190820060621     c                   eval      kwho=§b4ibi+outcapdpd
190830060621     c* se parcel lungo 12 lo trucco con 0 e 99
190840060622    6c                   if        %subst(§b4ipn:14:1)=*blanks
190850060621     c                   eval      kwho=%trim(kwho)+'0'
190860060621     c                             +%subst(§b4ipn:1:3)
190870060621     c                             +'99' + %subst(§b4ipn:4:8)
190880060622   x6c                   else
190890060621     c                   eval      kwho=%trim(kwho)+§b4ipn
190900060622    6c                   endif
190910060621     C                   MOVEL     '15'          COD
190920060621     C                   MOVEL(P)  BLPNZD        KEY
190930060621     C                   EXSR      CTABEL
190940060621     C   30              CLEAR                   DS15
190950060621     C  N30              MOVEL     TBLUNI        DS15
190960060621     c                   movel     §15cie        §15ciea           3
190970060621     c                   eval      kwho=%trim(kwho)+§b4isc+§15ciea
190980060622   x5c                   else
190990060623     c* altrimenti se sono in manutenzione di bolla ricevuta da cliente
191000060623     c* (DISK A) il chi sono lo reperisco chainando fisgn per key
191010060623     c* spedizione
191020060622     c     kblp3         chain(N)  fisgn05l
191030060622     c                   eval      kwho=sgnwho
191040060622    5c                   endif
191050060622   x4c                   else
191060060710     C                   clear                   kwho
191070060710     C                   movel     §b4ipn        kwho
191080060621     C                   eval      %subst(kwho:12:1)=§b4icd
191090060622    4c                   endif
191100000908     C                   EXSR      CTRSGN
191110050221     C* EXPORT DPD --> da vat O DIGITATO, DA CTM
191120001011    2C     WEXDPD        WHENEQ    'S'
191130001009     C     §1BF13        ANDNE     'A'
191140070322     c     wparcel       andne     '12'
191150000204     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
191160001009     C                   CLEAR                   V8HCOL
191170001009    4C     SAVNPR        IFNE      V7CNPR
191180001009     C                   MOVEL(P)  SAVNPR        KWHO
191190010116     C     KSGN          CHAIN     FISGN01L                           30
191200001009    5C     *IN30         IFEQ      *OFF
191210001009     C                   EXSR      ANNSGN
191220001009    5C                   ENDIF
191230001009     C                   ELSE
191240001009     C                   MOVE      *HIVAL        V8HCOL
191250001009    4C                   ENDIF
191260000209     C*
191270001009     C                   MOVEL(P)  V7CNPR        KWHO
191280001009     C                   EXSR      CTRSGN
191290000915     C* DISK C NO DPD: RICHIAMO CTRSGN PER OGNI RECORD DEL SUBFILE
191300001002     C     §1BF12        WHENNE    'N'
191310000908     C                   Z-ADD     1             NR8
191320000908     C                   MOVE      *BLANKS       SAVDKC            1
191330000915     C                   MOVE      *ZEROS        JJ                3 0
191340000908     C     NR8           CHAIN     LS01S08                            30
191350000908    3C     *IN30         DOWEQ     *OFF
191360000908     C* Escludo record annullati
191370000908    4C     V8CSCE        IFEQ      *BLANKS
191380000908     C                   MOVEL(P)  V8CNOT        KWHO
191390000908     C                   CLEAR                   WESSGN
191400000908     C* Controllo file fisgn
191410000908     C                   EXSR      CTRSGN
191420000908     C                   MOVE      WDKC          V8HDKC
191430000919    5C     WESSGN        IFEQ      'S'
191440000908     C                   MOVEL     'S'           V8HESG
191450000915     C                   Z-ADD     SGNST2        V8HST2
191460000919   X5C                   ELSE
191470000920     C                   CLEAR                   V8HESG
191480000915     C                   CLEAR                   V8HST2
191490000919    5C                   ENDIF
191500000908     C                   UPDATE    LS01S08
191510000920     C* Tratto la spedizione come diskC (scrittura di fisgn) se almeno
191520000920     C* un collo lo tratto come DISK C
191530000919    5C     WDKC          IFEQ      'S'
191540000908     C                   MOVE      WDKC          SAVDKC
191550000919    5C                   ENDIF
191560000908     C                   MOVEL     'S'           WDKC
191570000919   X4C                   ELSE
191580051102     C* MEMORIZZO IN SCHIERA ANNULLATI SE LEGATO A ARS
191590000920    5C     V8HCOL        IFGT      *ZEROS
191600000915     C                   ADD       1             JJ
191610000915     C                   Z-ADD     V8HCOL        ANN(JJ)
191620000919     C* SE RECORD ANNULLATO ANNULLO FISGN
191630010116     C     KSGN8         CHAIN     FISGN01L                           30
191640000920    6C     *IN30         IFEQ      *OFF
191650000921     C* Se annullato con A non lo potrò più riattivare perchè ormai i
191660000921     C* dati memorizzati su fisgn non sono più aggiornati correttamente
191670000921     c* Se annullato con A e progressivo = 0 significa che non ci sono
191680000921     c* più bolle manutenzionabili con questo cod. chi sono e quindi
191690000921     c* annullo con *
191700000921     C                   EXSR      ANNSGN
191710000920    6C                   ENDIF
191720000920    5C                   ENDIF
191730000920    4C                   ENDIF
191740000911     C                   ADD       1             NR8
191750000908     C     NR8           CHAIN     LS01S08                            30
191760000908    3C                   ENDDO
191770000908     C     SAVDKC        IFEQ      'S'
191780000908     C                   MOVE      'S'           WDKC
191790000908     C                   ENDIF
191800000204     C                   OTHER
191810000204     C                   MOVEL     'N'           WDKC
191820000204    2C                   ENDSL
191830000204     C*
191840000929   X1C                   ELSE
191850010515     C* 15/05/01: FISGN NON DEVE PIU' ESSERE SCRITTO PER LA RISTAMPA
191860001106     C                   MOVEL     'N'           WDKC
191870000204    1C                   ENDIF
191880980409     C*
191890980409     C* ABBLENCO CAMPO DI COMODO USATO IN ROUTINE CRTBLD PER SAPERE
191900980409     C* SE RISTAMAPRE O MENO L'ETICHETTA SEGNACOLLO
191910980409     C* (WPRT = ' '--> SI RISTAMPA; WPRT= 'N' --> NO RISTAMPA)
191920980409     C                   MOVE      *BLANKS       WPRT              1
191930950713     C**
191940940914     C* F N V A D 0 0 F : DETTAGLIO SEGNACOLLI
191950910807     C** DISK CLI:  CONTROLLO SE SE SONO RECORD NON SEQUENZIALI
191960000919     C   12
191970000919     CAN 15§1BFG7        IFEQ      'S'
191980980410     C     §1BFG6        ANDEQ     'C'
191990980219     C                   SETOFF                                       3130
192000020917     C     KBLC          SETLL     FIVAD000
192010020917     C     KBLC          READE     FIVAD000                               30
192020001002     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
192030001002     C  N30WSGNR         IFEQ      'S'
192040081008     C***  WESTER        IFEQ      'S'
192050081008     C***                MOVEL     'ALL'         §DETST
192060081008     C***                ELSE
192070001106     C                   MOVEL     'ITA'         §DETST
192080040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
192090040506     c* etichetta Italia con dati esteri
192100040506     C     A_§ogntw      IFEQ      'EEX'
192110040506     C                   MOVEL     'EEX'         §DETSE
192120040506     c                   else
192130040506     c                   clear                   §detse
192140040506     C                   ENDIF
192150081008     C***                ENDIF
192160001005     C                   CLEAR                   WSTSEG
192170001002     C                   EXSR      RIESEG
192180001002     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
192190001002     C                   CLEAR                   DSBLD7
192200001002     C                   MOVE      BLPLNP        §LCLNP
192210001002     C                   MOVE      BLPLNA        §LCLNA
192220001002     C                   MOVE      BLPNRS        §LCNRS
192230001002     C                   MOVE      BLPZNC        §LCZSC
192240001002     C                   MOVE      DSBLD         WWBLD
192250001002     C                   MOVE      DSBLDE        WWBLDE
192260001002     C                   ENDIF
192270930930     C*
192280930930     C* SE NON SEQUENZIALI MEMORIZZO IL PRIMO SEGNACOLLO
192290971215    2C  N30BLPFNS        IFEQ      'S'
192300941230     C                   MOVEL     BLDNCD        VIDNCD
192310951019     C                   Z-ADD     1             BLDNC1
192320971215    2C                   ENDIF
192330910802     C*
192340971215    2C     *IN30         DOWEQ     '0'
192350001002     C*
192360001002     C     WSGNR         IFEQ      'S'
192370001002     C                   MOVE      WWBLD         DSBLD
192380001002     C                   MOVE      WWBLDE        DSBLDE
192390001002     C                   ENDIF
192400001002     C*
192410980403     C                   MOVEL     BLDNCD        SV1NCD
192420980319     C*
192430980319    3C     BLDNCA        IFEQ      0
192440980319     C                   Z-ADD     BLDNCD        BLDNCA
192450980319    3C                   ENDIF
192460000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
192470051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
192480000915     C     §1BF12        IFNE      'N'
192490000915     C                   Z-ADD     1             NR8
192500000915     C                   ENDIF
192510000929     C*
192520000929     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
192530000929     C     WSGNR         IFEQ      'S'
192540000929     C                   MOVE      BLDCDP        §LDCDP
192550000929     C                   ENDIF
192560980319     C*
192570980319    3C     BLDNCD        DOWLE     BLDNCA
192580990318     C     BLDNCD        ANDGT     0
192590980319     C*
192600980319     C                   MOVEL     BLDNCD        WNSC
192610000929     C                   EXSR      CRTBLT
192620001003     C* No disk c: scrittura fisgn in ristampa
192630010404     C* N.B.: Scrittura fisgn per ristampa --> REGOLA: viene effettua
192640010404     C*       ta al momento della creazione del dettaglio colli (CRTBLT
192650010404     c*       ). Non viene fatta nell routine stasci o stascd come per
192660010404     c*       la scrittura di fisgn per §1bf12<>"N" o per import dpd
192670010404     c*       in quanto queste routine non vengono sempre richiamate
192680010404     c*       (per esempio in conferma bolle da disk quando fg6='S')
192690020917     c*       ECCEZIONE: Se cliente con fivad e fg6="D" l'fisgn viene
192700010404     C*       creato dentro stascd per non perdere il codice prodotto
192710010404     c*       Idem se sono in manutenzione
192720001002     C     WSGNR         IFEQ      'S'
192730000929     C                   ADD       1             §LDNC1
192740001002     C                   Z-ADD     WNSC          §LDNCD
192750001002     C                   Z-ADD     WNSC          §LCNCD
192760001002     C                   EXSR      M10
192770001002     C                   MOVEA     §CA           V8CNOT
192780010404     C                   EXSR      EUREXP
192790010306     C                   MOVEL     DSBLD         WSBLD
192800010306     C                   MOVEL     DSBLDE        WSBLDE
192810010306     C     KSGN8         CHAIN     FISGN01L                           30
192820010306     C                   MOVEL     WSBLD         DSBLD
192830010306     C                   MOVEL     WSBLDE        DSBLDE
192840010306     C   30              EXSR      WRTSGN
192850010306     C  N30              EXSR      UPDSGN
192860001002     C                   ENDIF
192870980319     C*
192880980319     C                   ADD       1             BLDNCD
192890980319    3C                   ENDDO
192900001002     C*
192910001002     C                   MOVE      DSBLD         WWBLD
192920001002     C                   MOVE      DSBLDE        WWBLDE
192930980319     C*
192940980403     C* REIMPOSTO NUMERO SEGNACOLLO CHE SI E' SPORCATO NEL CICLO
192950980403     C* DI CREAZIONE DEL BLT
192960980403     C                   Z-ADD     SV1NCD        BLDNCD
192970980403    3C     BLDNCA        IFEQ      BLDNCD
192980980319     C                   MOVE      *ZEROS        BLDNCA
192990980319    3C                   ENDIF
193000951019     C* CREO FNBLD PER SEGNACOLLI NON SEQUENZIALI
193010971215    3C     BLPFNS        IFEQ      'S'
193020971215     C**
193030971215    4C     §1BFG9        IFEQ      'S'
193040971217     C*
193050081008     C**   §1BFG0        OREQ      'D'
193060081008     C**   §1BFG6        ANDEQ     'C'
193070081008     C**   WESTER        ANDEQ     'S'
193080971217     C*
193090081008     C**   §1BF11        OREQ      'D'
193100081008     C**   §1BFG0        ANDEQ     'C'
193110081008     C**   WESTER        ANDEQ     'S'
193120951019     C                   Z-ADD     BLDNCD        COMSCD
193130951019     C                   Z-ADD     BLDNCL        VARNCL
193140971224     C                   MOVEL     BLDCDP        VARCDP
193150951019     C                   EXSR      ROTCDP
193160971215    4C                   ENDIF
193170971215     C**
193180971215     C** STAMPA LA SOLA ETICHETTA DELL'ESTERO IN IMMEDIATO
193190120302     C**  PER SDI SEMPRE, PER BRT SOLO SE IN IMMEDIATO
193200081008    4C**   WESTER        IFEQ      'S'
193210081008     C**   §1BFG9        ANDNE     'S'
193220971217     C*
193230081008    5C**   §1BFG0        IFEQ      'I'
193240081008     C**   §1BFG6        ANDEQ     'C'
193250971217     C*
193260081008     C**   §1BF11        OREQ      'I'
193270081008     C**   §1BFG0        ANDEQ     'C'
193280081008     C**                 MOVEL     'EST'         §DETST
193290971215     C**
193300971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
193310081008     C**                 Z-ADD     BLDNCD        CO2SCD
193320081008    6C**   BLDNCA        IFEQ      0
193330081008     C**                 Z-ADD     BLDNCD        STANCA
193340081008     C**                 ELSE
193350081008     C**                 Z-ADD     BLDNCA        STANCA
193360081008    6C**                 END
193370971215     C**
193380081008     C**                 EXSR      STASCI
193390081008    5C**                 ENDIF
193400081008    4C**                 ENDIF
193410971215    3C                   ENDIF
193420951019     C*
193430910802     C* CANCELLO FLBLD
193440020917     C                   DELETE    FIVAD000
193450910802     C* RILEGGO
193460020917     C     KBLC          READE     FIVAD000                               30
193470971215    2C                   ENDDO
193480971215    1C                   ENDIF
193490910802     C*
193500921006     C* CREO FLBLT SEQUENZIALE PER:
193510921006     C*         DISK CLI CON SEGNAC SEQUENZIALI
193520921006     C*         MANUTENZIONE BOLLE SE SEQUENZIALI
193530921006     C*         IMMISSIONE BOLLE
193540921016     C                   SETOFF                                       30
193550960404     C   12
193560960404    1CAN 15§3ABCM        IFEQ      ' '
193570941221     C* SE IL CTM PREVEDE SEGNACOLLI --> LI CREO
193580941221     C     §1BFG8        ANDEQ     'S'
193590960404    2C     §1BFG7        IFNE      'S'
193600980410     C     §1BFG6        ORNE      'C'
193610921006     C                   SETON                                            30
193620960404    2C                   END
193630960404    1C                   END
193640921006     C*
193650071221     c                   if        *in12 and not *in15
193660071221     c                   if        wagglna='S'
193670071221     c     kblp3         setll     fnblt01l
193680071221     c     kblp3         reade     fnblt01l
193690071221     c                   dow       not %eof(fnblt01l)
193700071221     c                   eval      bltlna=blplna
193710071221     c                   if        wsbord='S' and bltdfv=0
193720071221     c                   clear                   bltnfv
193730071221     c                   endif
193740071221     c                   update    fnblt000
193750071221     c     kblp3         reade     fnblt01l
193760071221     c                   enddo
193770120814     c* Ripeto lo stesso aggiornamento anche per fiart
193780120814     c     kblp3         setll     fiart01l
193790120814     c     kblp3         reade     fiart01l
193800120814     c                   dow       not %eof(fiart01l)
193810120814     c                   eval      artlna=blplna
193820120814     c                   if        wsbord='S' and bltdfv=0
193830120814     c                   clear                   artnfv
193840120814     c                   endif
193850120814     c                   update    fiart000
193860120814     c     kblp3         reade     fiart01l
193870120814     c                   enddo
193880071221     c                   else
193890071221     C** 12
193900071221    1C**ANN15BLPFNS        IFEQ      ' '
193910071221     c     blpfns        ifeq      ' '
193920921016     C     BLPNCD        ANDNE     0
193930921019     C     §1BFG8        ANDNE     'N'
193940950504     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
193950950504     C     §1BFG8        OREQ      'N'
193960960404     C*
193970980407   2AC     WABLT         IFEQ      'S'
193980960404     C                   MOVEL     5             KNPG
193990960404     C                   MOVEL     SIMFEL        KFLE
194000980320     C*
194010980320     C                   MOVE      *BLANKS       WCRT
194020960404     C*
194030940915     C     KBLP3         SETLL     FNBLT000
194040960404    2C     *IN30         DOWEQ     *OFF
194050051124     C     KBLP3         READE     FNBLT000                               30
194060960404     C*
194070980407    4C  N30WCONTC        IFNE      99999
194080960404     C                   ADD       1             WCONTC
194090960404    4C                   ENDIF
194100960404     C* CANCELLO LE SPUNTE ENTRATA SOLO SE C'E' 'S' E SE WCONTC
194110960404     C*  > DEL NUMERO DEI COLLI
194120980407    3C  N30WDELBR        IFEQ      'S'
194130980407     C     WCONTC        ANDGT     BLPNCL
194140070123     C     KBRV          CHAIN     FNBRV000                           31
194150960404    4C     *IN31         DOWEQ     *OFF
194160051124     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
194170051124     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
194180051124     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
194190051124     c* no anomalie da cancellare create a fronte della spunta entrata
194200051124     c**                 z-add     brvnfv        wrvnfv
194210051124     c**                 movel     param2        kpjbu
194220051124     C**                 CALL      'FNLSA8R'
194230051124     C**                 PARM                    KPJBA
194240070123     C                   DELETE    FNBRV000
194250070123     C     KBRV          READE     FNBRV000                               31
194260960404    4C                   ENDDO
194270040415     c*
194280040415    3C                   ENDIF
194290040415     c*
194300040415     c* cancello dalle spunte entrata il peso e volume se c'e' S e
194310040415     c*  se WCONT <= del numero dei colli
194320040415    3C  N30WDELBR        IFEQ      'S'
194330040415     C     WCONTC        ANDle     BLPNCL
194340070123     C     KBRV          CHAIN     FNBRV000                           31
194350040415    4C     *IN31         DOWEQ     *OFF
194360040415     c                   clear                   brvvuc
194370040415     c                   clear                   brvpuc
194380070123     C                   update    FNBRV000
194390070123     C     KBRV          READE     FNBRV000                               31
194400040415    4C                   ENDDO
194410960404     C*
194420960404    3C                   ENDIF
194430960404     C*
194440000915    3C     *IN30         IFEQ      *OFF
194450980320     C                   MOVE      'S'           WCRT              1
194460051124     C  N30              DELETE    FNBLT000
194470120814     c     kfiart        delete    fiart000                           31
194480980323     C                   MOVEL     'E'           WTRC
194490051102     C     KARS1         CHAIN     FIARS01L                           31
194500051102     C  N31              DELETE    FIARS000
194510020212     C                   MOVEL     'F'           WTRC
194520051102     C     KARS1         CHAIN     FIARS01L                           31
194530020212     c     *in31         ifeq      *off
194540020212     c* Se ho diminuito il numero dei colli oppure ho variato la linea di
194550020212     c* arrivo non devo riassegnare i numeri awb per il segnacollo fedex
194560051102     c* quindi memorizzo il primo numero awb prima di cancellare il ARS
194570020212     c* 'erchè mi servirà per ricrearlo
194580020212     c     wawbini       ifeq      *zeros
194590051102     c                   movel     ARSnot        wawbini
194600020212     c                   z-add     wawbini       wawb
194610020212     c                   endif
194620051102     C                   DELETE    FIARS000
194630020212     c                   endif
194640000915     C                   MOVEL     'C'           WTRC
194650051102     C     KARS1         CHAIN     FIARS01L                           31
194660000920    4C     *IN31         IFEQ      *OFF
194670000921     C* SE HO ELIMINATO SEGNACOLLI DOVREI ANNULLARE EVENTUALE FISGN
194680001003     C* MA NON LO FACCIO PERCHE' QUESTO CASO NON DOVREBBE MAI VERIFI-
194690000921     C* CARSI DAL MOMENTO CHE IN MANUTENZIONE BOLLE NON E' POSSIBILE
194700000921     C* CAMBIARE IL CODICE TRATTAMENTO MERCE
194710051102     C                   DELETE    FIARS000
194720000920    4C                   ENDIF
194730980320    3C                   ENDIF
194740960404    2C                   ENDDO
194750980320     C* SE HO CANCELLATO IL DETTAGLIO COLLI LO RICREO
194760980320     C     §1BFG8        IFEQ      'S'
194770980320     C     WCRT          ANDEQ     'S'
194780980320     C                   Z-ADD     BLPNCD        CO2SCD
194790980320     C     BLPNCA        IFEQ      0
194800980320     C                   Z-ADD     BLPNCD        BLPNCA
194810980320     C                   END
194820000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
194830051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
194840000915     C     §1BF12        IFNE      'N'
194850000915     C                   Z-ADD     1             NR8
194860000915     C                   ENDIF
194870980320     C*
194880980320     C     CO2SCD        DOWLE     BLPNCA
194890000915     C     CO2SCD        ANDGT     0
194900980320     C                   Z-ADD     CO2SCD        WNSC
194910980320     C                   EXSR      CRTBLT
194920980320     C                   ADD       1             CO2SCD
194930980320     C                   END
194940980320     C                   END
194950980408  X2AC                   ELSE
194960980408     C* SE HO SBORDERIZZATO LA BOLLA ELIMINO BLTNFV SU DETT. COLLI
194970980408    2C     WSBORD        IFEQ      'S'
194980980409     C                   EXSR      SBORD
194990980408    2C                   ENDIF
195000980320   2AC                   ENDIF
195010950713     C*
195020960404   X1C                   ELSE
195030950713     C* SE SEGNACOLLI NON SEQUENZIALI E HO SBORDERIZZATO IN AUTOMATICO
195040950713     C*  LA BOLLA --> ELIMINO BLTNFV SU DETT COLLI
195050960404    2C     BLPFNS        IFEQ      'S'
195060950713     C     WSBORD        ANDEQ     'S'
195070980409     C                   EXSR      SBORD
195080960404    2C                   ENDIF
195090950713     C*
195100960404    1C                   ENDIF
195110071221    1C                   endif
195120071221    1C                   endif
195130000915     C* SE SONO IN MANUTENZIONE E NON SONO AUMENTATI O DIMINUITI I
195140051102     C* COLLI E NON E' VARIATA LA LNA DEVO AGGIORNARE ARS PER
195150000915     C* EVENTUALI ANNULLAMENTI E AGGIUNTE SU SUBFILE COD CHI SONO
195160000915     C                   MOVEL     *BLANKS       WUPDSG            1
195170001009    1C     *IN12         IFEQ      *ON
195180001009     C     *IN15         ANDEQ     *OFF
195190001009     C     WABLT         ANDNE     'S'
195200071221     C     WAgglna       ANDNE     'S'
195210001009    2C                   SELECT
195220050228     c* IMPORT DPD                                                     cel
195230050228     c     *in79         wheneq    *on
195240050228     c     §1bf12        andne     'N'
195250060619     c     savnpr        andne     v7cnpr
195260050228     C                   MOVEL     'C'           WTRC
195270051102     C     KARS1P        CHAIN     FIARS01L                           31
195280060622     C**N31              move      v7cnpr        w0120
195290060622     C**N31              movel     w0120         ARSNOT
195300060622     c  n31              movel     v7cnpr        arsnot
195310051114     C  N31              movel     dateu         ARSduv
195320051102     C  N31              UPDATE    FIARS000
195330050228     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
195340050228     C  N31              MOVEL     'S'           WUPDSG
195350001009     C* EXPORT DPD
195360001009     C     §1BF12        WHENNE    'N'
195370001011     C     WEXDPD        ANDEQ     'S'
195380001009     C     §1BF13        ANDNE     'A'
195390070323     c     wparcel       andne     '12'
195400001009     C     SAVNPR        ANDNE     V7CNPR
195410001009     C                   MOVEL     'C'           WTRC
195420051102     C     KARS1P        CHAIN     FIARS01L                           31
195430051102     C  N31              MOVEL     V7CNPR        ARSNOT
195440051114     C  N31              MOVEL     dateu         ARSduv
195450051102     C  N31              UPDATE    FIARS000
195460001009     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
195470001009     C  N31              MOVEL     'S'           WUPDSG
195480001009     C     §1BF12        WHENNE    'N'
195490050224     c     *in79         andeq     *off
195500000915     C     ANN(1)        ANDGT     *ZEROS
195510000915     C                   Z-ADD     1             NR8
195520000915     C                   Z-ADD     1             JJ
195530000915     C     NR8           CHAIN     LS01S08                            31
195540001009   2AC     *IN31         DOWEQ     *OFF
195550001003    3C     V8HCOL        IFEQ      *ZEROS
195560000915     C     V8CSCE        ANDEQ     *BLANKS
195570000915     C                   MOVE      ANN(JJ)       KANNUL
195580000915     C                   MOVEL     'C'           WTRC
195590051102     C     KARS1K        CHAIN     FIARS01L                           31
195600051102     C  N31              MOVEL     V8CNOT        ARSNOT
195610051114     C  N31              MOVEL     dateu         ARSduv
195620051102     C  N31              UPDATE    FIARS000
195630000915     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
195640000915     C  N31              MOVEL     'S'           WUPDSG
195650020212    4C     §ogntw        IFEQ      'EEX'
195660000915     C                   MOVEL     'E'           WTRC
195670051102     C     KARS1K        CHAIN     FIARS01L                           31
195680051102     C  N31              MOVEL     V8CNOT        ARSNOT
195690051114     C  N31              MOVEL     dateu         ARSduv
195700051102     C  N31              UPDATE    FIARS000
195710001003    4C                   ENDIF
195720000915     C                   ADD       1             JJ
195730001003    3C                   ENDIF
195740000915     C                   ADD       1             NR8
195750000915     C     NR8           CHAIN     LS01S08                            31
195760001009   2AC                   ENDDO
195770070323     C     §1BF12        WHENNE    'N'
195780070323     C     WEXDPD        ANDEQ     'S'
195790070323     c     v7cnpr        andne     savnpr
195800070323     C                   MOVEL     'S'           WUPDSG
195810001009    2C                   ENDSL
195820001009    1C                   ENDIF
195830921006     C*
195840921006     C  N12BLPNCD        IFGT      0
195850921006     C                   SETON                                        30
195860921006     C                   END
195870921006     C* CREO FLBLT
195880980320     C   12
195890980320     CAN 15
195900980320     CAN 30
195910980320     CORN12
195920980320     CAN 30              DO
195930910827     C                   Z-ADD     BLPNCD        CO2SCD
195940910826     C     BLPNCA        IFEQ      0
195950910826     C                   Z-ADD     BLPNCD        BLPNCA
195960910826     C                   END
195970000908     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
195980051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
195990000908     C     §1BF12        IFNE      'N'
196000000908     C                   Z-ADD     1             NR8
196010000908     C                   ENDIF
196020001003     C*
196030001003     C     WSGNR         IFEQ      'S'
196040001005     C     §1BFG6        ANDNE     'M'
196050001003     C     §1BFG6        IFNE      'D'
196060001003     C     §1BFG7        ORNE      'S'
196070081008     C**   WESTER        IFEQ      'S'
196080081008     C**                 MOVEL     'ALL'         §DETST
196090081008     C**                 ELSE
196100001003     C                   MOVEL     'ITA'         §DETST
196110040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
196120040506     c* etichetta Italia con dati esteri
196130040506     C     A_§ogntw      IFEQ      'EEX'
196140040506     C                   MOVEL     'EEX'         §DETSE
196150040506     c                   else
196160040506     c                   clear                   §detse
196170040506     C                   ENDIF
196180081008     C***                ENDIF
196190001005     C                   CLEAR                   WSTSEG
196200001003     C                   EXSR      RIESEG
196210001003     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
196220001003     C                   CLEAR                   DSBLD7
196230001003     C                   MOVE      BLPLNP        §LCLNP
196240001003     C                   MOVE      BLPLNA        §LCLNA
196250001003     C                   MOVE      BLPNRS        §LCNRS
196260001003     C                   MOVE      BLPZNC        §LCZSC
196270001003     C                   ENDIF
196280001003     C                   ENDIF
196290000908     C*
196300910827     C     CO2SCD        DOWLE     BLPNCA
196310990318     C     CO2SCD        ANDGT     0
196320940926     C                   Z-ADD     CO2SCD        WNSC
196330910802     C                   EXSR      CRTBLT
196340001003     C* No disk c: scrittura fisgn in ristampa
196350001003     C* Se la stampa segnacolli è in differita e il cliente mi passa
196360020917     C* fivad non creo qui fisgn ma lo creo quando scrivo fnbld perchè
196370001003     C* in questo caso devo memorizzare su fisgn anche il codice prodot
196380001003     C     WSGNR         IFEQ      'S'
196390001005     C     §1BFG6        ANDNE     'M'
196400001003     C     §1BFG6        IFNE      'D'
196410001003     C     §1BFG7        ORNE      'S'
196420001003     C                   ADD       1             §LDNC1
196430001003     C                   Z-ADD     WNSC          §LDNCD
196440001003     C                   Z-ADD     WNSC          §LCNCD
196450001003     C                   EXSR      M10
196460001003     C                   MOVEA     §CA           V8CNOT
196470010404     C                   EXSR      EUREXP
196480010306     C                   MOVEL     DSBLD         WSBLD
196490010306     C                   MOVEL     DSBLDE        WSBLDE
196500010306     C     KSGN8         CHAIN     FISGN01L                           30
196510010306     C                   MOVEL     WSBLD         DSBLD
196520010306     C                   MOVEL     WSBLDE        DSBLDE
196530010306     C  N30              EXSR      UPDSGN
196540010306     C   30              EXSR      WRTSGN
196550001003     C                   ENDIF
196560001003     C                   ENDIF
196570910827     C                   ADD       1             CO2SCD
196580910805     C                   END
196590910802     C                   END
196600910802     C*
196610910826     C     BLPNCA        IFEQ      BLPNCD
196620910826     C                   Z-ADD     0             BLPNCA
196630910826     C                   END
196640950504     C* PER ELIMINAZIONE DEI SEGNACOLLI, CANCELLO ANCHE FNBLD
196650950504     C   12
196660950504     CANN15§1BFG8        IFEQ      'N'
196670950504     C     KBLP3         SETLL     FNBLD000                               30
196680950504     C     *IN30         IFEQ      *ON
196690950504     C*
196700950504     C     KBLP3         READE     FNBLD000                               30
196710950504     C     *IN30         DOWEQ     *OFF
196720950504     C                   DELETE    FNBLD000
196730950504     C     KBLP3         READE     FNBLD000                               30
196740950504     C                   ENDDO
196750950504     C                   ENDIF
196760950504     C                   ENDIF
196770980320     C*
196780980320     C* LE SEGUENTI ISTRUZIONI SI COLLOCAVANO, PER ANALOGIA, DOPO
196790980320     C* LA CREAZIONE DEL BLD PER I SEGNACOLLI NON SEQUENZIALI.
196800980320     C* SONO STATE SPOSTATE QUI AFFINCHE' IN OGNI CASO IL DETTAGLIO
196810980320     C* COLLI SIA GIA' STATO CREATO PER POTER PERMETTERE LA STAMPA
196820980320     C* DELLE ETICHETTE ESTERE
196830980320     C*
196840980320     C* SE FG9='S' CREO 1 RECORD IN FNBLD  SE SEGNACOLLI SEQUENZIALI
196850980320     C   12
196860980320    1CAN 15BLPFNS        IFEQ      ' '
196870980320     C*
196880980320    2C     §1BFG6        IFEQ      'C'
196890980320     C     §1BFG9        ANDEQ     'S'
196900980320     C*
196910081008     C**   §1BFG0        OREQ      'D'
196920081008    2C**   §1BFG6        ANDEQ     'C'
196930081008     C**   WESTER        ANDEQ     'S'
196940980320     C*
196950081008     C**   §1BF11        OREQ      'D'
196960081008     C**   §1BFG0        ANDEQ     'C'
196970081008     C**   WESTER        ANDEQ     'S'
196980980320     C                   Z-ADD     BLPNCD        BLDNCD
196990980320     C                   Z-ADD     BLPNCA        BLDNCA
197000980320     C                   Z-ADD     VIDNCL        BLDNCL
197010980320     C                   Z-ADD     1             BLDNC1
197020980320     C                   EXSR      CRTBLD
197030980320    2C                   ENDIF
197040980320     C** STAMPA ETICHETTA IN IMMEDIATO SE ESTERA LA LNA
197050081008    2C**   WESTER        IFEQ      'S'
197060081008     C**   §1BFG9        ANDNE     'S'
197070980320     C*
197080081008    3C**   §1BFG0        IFEQ      'I'
197090081008     C**   §1BFG6        ANDEQ     'C'
197100980320     C*
197110081008     C**   §1BF11        OREQ      'I'
197120081008     C**   §1BFG0        ANDEQ     'C'
197130081008     C**                 MOVEL     'EST'         §DETST
197140980320     C**
197150980320     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
197160081008     C**                 Z-ADD     BLPNCD        CO2SCD
197170081008    4C**   BLPNCA        IFEQ      0
197180081008     C**                 Z-ADD     BLPNCD        STANCA
197190081008     C**                 ELSE
197200081008     C**                 Z-ADD     BLPNCA        STANCA
197210081008    4C**                 END
197220980320     C**
197230081008     C**                 EXSR      STASCI
197240081008    3C**                 ENDIF
197250081008    2C**                 ENDIF
197260980320    1C                   ENDIF
197270910805     C*
197280910805     C* E S T E N S I O N E   B O L L A
197290991006      *
197300991006      * Se agganciata precedentemente riaggancio file tassazione per 2a bolla
197310991006     C     WAR62         IFEQ      'E'
197320991006     C                   MOVEL     '2'           WTRC
197330050331     c                   if        wKSCsf2 <> 0000 and wKSCsf2 <> 9999
197340050331     c     kblp4         delete    fiar6000
197350050331     c                   clear                   war62
197360050331     c                   else
197370991006     C     KBLP4         CHAIN     FIAR6000                           30
197380050331     c                   endif
197390991006     C                   ENDIF
197400991006      *
197410040116if  1c                   If        *In05 and
197420040116     c                             (wesvar1 <> *Blanks or Vi2Cei <> *Blanks)
197430040116      * Carico le varie
197440040116if  2c                   If        wesvar1 <> *Blanks
197450040116     c                   Clear                   wsv1
197460040116     c                   Clear                   wva1
197470040116     c                   Clear                   wsv2
197480040116     c                   Clear                   wva2
197490040116     c                   Clear                   wsv3
197500040116     c                   Clear                   wva3
197510040116     c                   Eval      ContaSv = 1
197520041217do  3c                   Do        6             c
197530040116     c                   If        w2sv(c) <> *Blanks
197540040116     c                   Exsr      Wrtvar1
197550040116     c                   EndIf
197560040116    3c                   EndDo
197570040116    2c                   EndIf
197580991006      *
197590991006     C                   CLEAR                   FIAR6000
197600991006      *
197610991006     C                   MOVEL     '2'           AR6TRC
197620991006     C                   MOVEL     BLPAAS        AR6AAS
197630991006     C                   MOVEL     BLPLNP        AR6LNP
197640991006     C                   MOVEL     BLPNRS        AR6NRS
197650991006     C                   MOVEL     BLPNSP        AR6NSP
197660991006     C                   MOVEL     VI2CEI        AR6CEI
197670040116     c                   Movel     wsv1          Ar6Sv1
197680040116     c                   Z-add     wva1          Ar6Va1
197690040116     c                   Movel     wsv2          Ar6Sv2
197700040116     c                   Z-add     wva2          Ar6Va2
197710040116     c                   Movel     wsv3          Ar6Sv3
197720040116     c                   Z-add     wva3          Ar6Va3
197730991015     C                   MOVEL     VI2DIV        AR6DIV
197740991022     C                   MOVE      9999          AR6KSC
197750991022     C                   MOVEL     AR6LNP        AR6KSC
197760040126     c                   Z-add     Vi2Imv        Ar6Imv
197770991022     C     AR6IMV        IFGT      *ZEROS
197780991022     C                   MOVEL     'P'           AR6FIM
197790991022     C                   ELSE
197800991022     C                   CLEAR                   AR6FIM
197810991022     C                   ENDIF
197820991014     C* DATI PER STAMPA SOLO SE NON è PREPAGATO
197830991014     C     *IN34         IFEQ      *OFF
197840040116     c                   Z-add     Ar6Imv        Db0Imv
197850941108     C                   MOVEL     VI2CEI        DB0CEI
197860991014     C                   MOVEL     V2DCEI        DB0DCE
197870991015     C                   MOVEL     VI2DIV        DB0DIV
197880991014     C                   MOVEL     WFDC2         DB0FDC
197890991014     C                   ENDIF
197900900507     C*
197910991006     C     WAR62         IFEQ      'E'
197920991006     C                   UPDATE    FIAR6000
197930940926     C                   ELSE
197940991006     C                   WRITE     FIAR6000
197950940926     C                   ENDIF
197960930624     C*
197970940920   X1C                   ELSE
197980940926     C*  C'ERA MA ELIMINATA LA ESTENSIONE BOLLA
197990991006    2C     WAR62         IFEQ      'E'
198000991006     C                   DELETE    FIAR6000
198010930624    2C                   ENDIF
198020930624    1C                   ENDIF
198030940926     C***
198040930331     C*** L E G A M E   B O L L A
198050930331     C   12
198060930331     CANN15VIDLNA        IFNE      SAVLNA
198070940915     C     KBLP3         CHAIN     FNLBL000                           30
198080930331     C  N30              Z-ADD     BLPLNA        LBLLAN
198090940928     C  N30              MOVEL     ' '           LBLFT1
198100940928     C  N30              MOVEL     ' '           LBLFT2
198110940915     C  N30              UPDATE    FNLBL000
198120930331     C                   END
198130910117     C***
198140910125     C* IMMISSIONE:
198150910411     C* NO STAMPA SEGNACOLLO IN  D I F F E R I T A:
198160910220     C     §1BFG6        IFNE      'D'
198170951019     C   12
198180951019     CAN 15              EXSR      DELVAD
198190910220     C                   ELSE
198200960805     C*    STAMPA SEGNACOLLO IN DIFFERITA: CREO FNBLD00F
198210910128     C  N12              DO
198220910128     C                   SETON                                        30
198230910128     C                   Z-ADD     BLPNCD        BLDNCD
198240910128     C                   Z-ADD     BLPNCA        BLDNCA
198250910506     C                   Z-ADD     VIDNCL        BLDNCL
198260910128     C                   EXSR      CRTBLD
198270910128     C                   END
198280910129     C* MANUTENZIONE / DISK CLIENTI:
198290910129     C   12              DO
198300910521     C*** DISK CLIENTI NO DETTAGLIO COLLI DA CLIENTE:
198310910411     C   15§1BFG7        IFNE      'S'
198320040618     c     §1bf12        oreq      'B'
198330910411     C                   Z-ADD     BLPNCD        BLDNCD
198340910411     C                   Z-ADD     BLPNCA        BLDNCA
198350910506     C                   Z-ADD     VIDNCL        BLDNCL
198360910521     C                   Z-ADD     1             BLDNC1
198370910411     C                   EXSR      CRTBLD
198380020917     C* DELETO FIVAD SE C'ERA
198390960805     C                   EXSR      DELVAD
198400910411     C*
198410910411     C                   ELSE
198420910411     C*
198430910521     C*** DISK CLIENTI SI DETTAGLIO COLLI DA CLIENTE:
198440020917     C     KBLC          SETLL     FIVAD000
198450020917     C     KBLC          READE     FIVAD000                               30
198460910411     C*
198470940214     C                   Z-ADD     BLPNCD        COMSCD
198480940214     C                   MOVEL     BLDCDP        VARCDP
198490910411     C                   Z-ADD     1             BLDNC1
198500940214     C                   CLEAR                   VARNCL
198510910411     C*
198520930628     C     *IN30         DOWEQ     *OFF
198530940214     C*
198540960805     C* CREO RECORD IN FNBLD00 PER ROTTURA COD PRODOTTO
198550940214     C     BLDCDP        IFNE      VARCDP
198560001018     C* SE DEVO SCRIVERE FISGN IN RISTAMPA IMPOSTO WSGNR = 'B' PER
198570001018     C* RICHIAMARE STASCD (SCRITTURA DI FISGN AL MOMENTO DELLA SCRITTU-
198580001018     C* DI FNBLD)
198590001018     C     WSGNR         IFEQ      'S'
198600010515     C                   MOVEL     'B'           WSGNR             1
198610001018     C                   ENDIF
198620940214     C                   EXSR      ROTCDP
198630940214     C                   ENDIF
198640940214     C*
198650940214     C* SE CODICE PRODOTTO NON MODIFICATO, SOMMO INSIEME I 2 RECORD
198660940214     C                   ADD       BLDNCL        VARNCL
198670940214     C*
198680910411     C* CANCELLO IL RECORD DAL FLBLD DI PASSAGGIO
198690020917     C                   DELETE    FIVAD000
198700910411     C*
198710020917     C     KBLC          READE     FIVAD000                               30
198720940214     C                   ENDDO
198730940214     C* ULTIMA ROTTURA
198740001018     C     WSGNR         IFEQ      'S'
198750001018     C                   MOVEL     'B'           WSGNR
198760001018     C                   ENDIF
198770940214     C                   EXSR      ROTCDP
198780940214     C*
198790910411     C                   END
198800910411     C*
198810910411     C*** MANUTENZIONE BOLLE:
198820910411     C  N15              DO
198830001003     C*
198840001003     C*
198850910201     C                   SETOFF                                       3132
198860910411     C     SAVLNA        COMP      VIDLNA                             3131
198870910411     C  N31VIDNCL        COMP      SAVNCL                             3132
198880910125     C*
198890940214     C*  L I N E A   A R R I V O   > <   O   N C L   A U M E N T A T O
198900910411     C   31              DO
198910000915     C     KBLP3         CHAIN     FNBLD000                           33
198920940214     C*
198930000915     C     *IN33         IFEQ      *OFF
198940940214     C                   Z-ADD     BLPNCD        COMSCD
198950940214     C                   MOVEL     BLDFST        SAVFST
198960940214     C*
198970940214     C     SAVNCL        IFNE      VIDNCL
198980940214     C                   Z-ADD     VIDNCL        BLDNCL
198990940214     C                   ENDIF
199000940214     C                   ENDIF
199010910128     C*
199020001019     C                   CLEAR                   WSTSGN
199030001019     C*
199040000915     C     *IN33         DOWEQ     '0'
199050001018     C     WSGNR         IFEQ      'S'
199060001018     C                   MOVEL     'B'           WSGNR
199070001018     C                   ENDIF
199080940224     C                   Z-ADD     BLDNCL        VARNCL
199090940224     C                   MOVEL     BLDCDP        VARCDP
199100940224     C*
199110940224     C                   EXSR      ROTCDP
199120940214     C*
199130960404     C* SE PUO' AVERE PIU' CODICI PRODOTTO (FLAG 7 = "S") RILEGGO
199140960404     C*  ALTRIMENTI ESCO DALLA LETTURA DI FNBLD00F, PERCHE' SE HO
199150940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
199160940907     C     §1BFG7        IFEQ      'S'
199170000915     C     KBLP3         READE     FNBLD000                               33
199180940907     C                   ELSE
199190000915     C                   SETON                                        33
199200940907     C                   END
199210940907     C*
199220940214     C                   ENDDO
199230910128     C*
199240910128     C                   END
199250910128     C*
199260910405     C** ALTRE MODIFICHE DELLA MANUTENZIONE BOLLE
199270910405     C*
199280940214     C* D I M I N U Z I O N E   N U M E R O   D E I   C O L L I
199290910411     C  N31*IN32         IFEQ      '1'
199300001019     C                   CLEAR                   WSTSGN
199310000915     C     KBLP3         CHAIN     FNBLD000                           33
199320910405     C*
199330910405     C                   Z-ADD     BLPNCD        BLDNCD
199340910405     C                   Z-ADD     BLPNCA        BLDNCA
199350910506     C                   Z-ADD     VIDNCL        BLDNCL
199360000915     C  N33              MOVEL     BLDFST        SAVFST
199370001018     C     WSGNR         IFEQ      'S'
199380001018     C                   MOVEL     'B'           WSGNR
199390001018     C                   ENDIF
199400910405     C                   EXSR      CRTBLD
199410910405     C*
199420910405     C                   ELSE
199430910405     C*
199440910405     C*                    MODIFICHE CON   AGGIORNAMENTO FLBLD
199450940214     C*
199460940921     C     SAVMIT        IFNE      WKSC
199470960926     C     SAVPDR        ORNE      VIDPDR
199480940214     C     SAVRSD        ORNE      VIDRSD
199490910411     C* CODICE PRODOTTO DA RIF ALFABETICO
199500940214     C     §1BFG7        ORNE      'S'
199510940922     C     SAVRMA        ANDNE     VIDRMA
199520940214     C                   SETON                                        31
199530980409     C* Memorizzo di non ristampare l'etichetta
199540050422     c* (solo se non ho variato campi per cui devo ristampare)
199550050422     C     SAVTSP        IFeq      BLPTSP
199560050422     C     SAVCAD        andeq     VIDCAD
199570050422     C     SAVZNC        andeq     VARZNC
199580050422     C     SAVbva        andeq     vidbva
199590980409     C                   MOVE      'N'           WPRT              1
199600050422     c                   endif
199610940214     C                   ENDIF
199620910411     C*
199630910405     C*                    MODIFICHE SENZA AGGIORNAMENTO FLBLD
199640980409     C  N31SAVTSP        IFNE      BLPTSP
199650940214     C     SAVCAD        ORNE      VIDCAD
199660940214     C     SAVZNC        ORNE      VARZNC
199670050421     C     SAVbva        ORNE      vidbva
199680910405     C                   SETON                                        3132
199690930402     C                   END
199700120302     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BRT
199710051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
199720980409     C     SAVCAD        IFNE      VIDCAD
199730051102     C                   EXSR      AGGARS
199740980409     C                   END
199750000915     C* SE HO VARIATO SOLO COD.CHI SONO DEVO ANDARE IN WRITE SU FISGN
199760000915     C     *IN31         IFEQ      *OFF
199770000915     C     *IN32         ANDEQ     *OFF
199780000915     C     WUPDSG        ANDEQ     'S'
199790000915     C                   SETON                                        3132
199800000915     C                   ENDIF
199810940214     C* --> VARIO FLBLD
199820971230     C     *IN31         IFEQ      *ON
199830001019     C                   CLEAR                   WSTSGN
199840000915     C     KBLP3         CHAIN     FNBLD000                           33
199850000915     C  N33              MOVEL     BLDFST        SAVFST
199860941108     C*
199870000915     C     *IN33         DOWEQ     *OFF
199880001018     C     WSGNR         IFEQ      'S'
199890001018     C                   MOVEL     'B'           WSGNR
199900001018     C                   ENDIF
199910980410     C* VARIAZIONE FLBLD00F E STAMPA
199920971230     C     *IN32         IFEQ      *OFF
199930940214     C                   EXSR      CRTBLD
199940971230     C                   ELSE
199950001005     C* RICHIAMO STASCD PER SCRITTURA FISGN IN RISTAMPA
199960001005     C     WSGNR         IFEQ      'B'
199970001005     C                   EXSR      STASCD
199980001005     C                   MOVEL     'S'           WSGNR
199990001005     C                   ENDIF
200000940214     C* SOLO STAMPA
200010971217     C*  NON VENGONO RISTAMPATI I SAGNACOLLI SE SONO SOLO ESTERO
200020971230     C     SAVFST        IFEQ      'S'
200030980319     C                   EXSR      STASCD
200040081008     C**   *IN12         IFEQ      *ON
200050081008     C**   *IN15         ANDEQ     *OFF
200060081008     c**   A_§ogntw      andeq     'EUP'
200070081008     C**                 MOVEL     'E'           WTRC
200080081008     C**   KBLP4         CHAIN     Fiar4000                           90
200090081008     C**   *IN90         IFEQ      *OFF
200100081008     C**                 MOVEL     ar4NOT        DSBL4E
200110081008     C**                 MOVEL     'S'           §B4EST
200120081008     C**                 MOVEL     DSBL4E        ar4NOT
200130081008     C**                 UPDATE    Fiar4000
200140081008     C**                 ENDIF
200150081008     C**                 SETOFF                                       90
200160081008     C**                 ENDIF
200170971230     C                   ENDIF
200180040603     c* disalloco record di fnbld
200190040603     c                   unlock    fnbld01l
200200971230     C                   ENDIF
200210940907     C*
200220940907     C* SE PUO' AVERE PIU' CODICI PORDOTTO (FLAG 7 = "S") RILEGGO
200230940907     C*  ALTRIMENTI ESCO DALLA LETTURA DI FLBLD50F, PERCHE' SE HO
200240940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
200250971230     C     §1BFG7        IFEQ      'S'
200260000915     C     KBLP3         READE     FNBLD000                               33
200270940907     C                   ELSE
200280000915     C                   SETON                                        33
200290971230     C                   END
200300940907     C*
200310940214     C                   ENDDO
200320940214     C                   ENDIF
200330910417     C                   END
200340910128     C*
200350910128     C                   END
200360910411     C                   END
200370910201     C                   END
200380910411     C*
200390910411     C* STAMPA SEGNACOLLO IN  I M M E D I A T O
200400910131     C     §1BFG6        IFEQ      'I'
200410910208     C* PER DISK CLIENTI O IMMISSIONE BOLLE STAMPO SUBITO
200420910208     C                   MOVEL     *BLANKS       §LDRST
200430081008     C**   WESTER        IFEQ      'S'
200440081008     C**                 MOVEL     'ALL'         §DETST
200450081008     C**                 ELSE
200460971215     C                   MOVEL     'ITA'         §DETST
200470040505     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
200480040505     c* etichetta Italia con dati esteri
200490040505     C     A_§ogntw      IFEQ      'EEX'
200500040505     C                   MOVEL     'EEX'         §DETSE
200510040506     c                   else
200520040506     c                   clear                   §detse
200530040505     C                   ENDIF
200540081008     C**                 ENDIF
200550971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
200560971215     C                   Z-ADD     BLPNCD        CO2SCD
200570971215     C     BLPNCA        IFEQ      0
200580971215     C                   Z-ADD     BLPNCD        STANCA
200590971215     C                   ELSE
200600971215     C                   Z-ADD     BLPNCA        STANCA
200610971215     C                   END
200620910131     C   12
200630910131     CAN 15
200640910201     CORN12              EXSR      STASCI
200650910131     C*
200660910405     C* IN MANUTENZIONE STAMPO SOLO SE CAMBIATI:
200670910131     C   12
200680910131     CANN15              DO
200690001005     C     WSGNR         IFEQ      'S'
200700001005     C                   MOVEL     'B'           WSGNR
200710001005     C                   ENDIF
200720980320     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BAR (MA NON LA LNA)
200730051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
200740980409     C     SAVCAD        IFNE      VIDCAD
200750051102     C                   EXSR      AGGARS
200760980409     C                   END
200770000922     C* SE DISK C DEVO RICHIAMARE STASCI ANCHE PER LE SEGUENTI VARIAZ.
200780050228     C***  §1BF12        IFNE      'N'
200790050228     C***  §1BF12        ANDNE     'E'
200800050228     C***  §1BF12        OREQ      'E'
200810050228     C***  WASDKC        ANDEQ     'S'
200820050228     C***  WSGNR         OREQ      'B'
200830050228     C***  SAVMIT        IFNE      WKSC
200840050228     C***  SAVPDR        ORNE      VIDPDR
200850050228     C***  SAVRSD        ORNE      VIDRSD
200860050228     C***  §1BFG7        ORNE      'S'
200870050228     C***  SAVRMA        ANDNE     VIDRMA
200880050228     C***                MOVEL     'S'           WUPDSG
200890050228     C***                ENDIF
200900050228     C***                ENDIF
200910980320     C*
200920001018     C                   CLEAR                   WNOPRT
200930940214     C     SAVLNA        IFNE      VIDLNA
200940940214     C     SAVNCL        ORNE      VIDNCL
200950940214     C     SAVCAD        ORNE      VIDCAD
200960930930     C     SAVZNC        ORNE      VIDZNC
200970941230     C     SAVTSP        ORNE      BLPTSP
200980050421     C     SAVbva        ORNE      vidbva
200990910405     C*
201000930930     C                   EXSR      STASCI
201010001018     C                   ELSE
201020050228     c     wdkc          ifeq      'S'
201030050228     c     wsgnr         oreq      'B'
201040050228     C     SAVMIT        IFNE      WKSC
201050050228     C     SAVPDR        ORNE      VIDPDR
201060050228     C     SAVRSD        ORNE      VIDRSD
201070050228     C     §1BFG7        ORNE      'S'
201080050228     C     SAVRMA        ANDNE     VIDRMA
201090050228     c     wupdsg        oreq      'S'
201100001018     C                   MOVEL     '1'           WNOPRT            1
201110001018     C                   EXSR      STASCI
201120001018     C                   ENDIF
201130050228     c                   endif
201140930930     C                   ENDIF
201150910131     C                   END
201160910117     C                   END
201170910312     C*
201180910129     C* PER DISK CLIENTI SE CAMBIATO CTM E PRIMA ERA "D" CANCELLO
201190020917     C*   IN FIVAD01L I RECORD
201200940222     C     *IN12         IFEQ      *ON
201210940222     C     *IN15         ANDEQ     *ON
201220970328     C* FLAG DI RISTAMPA BOLLA
201230970328     C                   MOVEL     WSTA          CMD8
201240940222     C                   ENDIF
201250980406     C* PER DISK CLIENTI SE CAMBIATO CTM VEDO SE CANCELLARE IL VAT
201260980406     C     *IN12         IFEQ      *ON
201270980406     C     *IN15         ANDEQ     *ON
201280980406     C                   EXSR      DELVAT
201290040601     C                   EXSR      DELVAX
201300980406     C                   END
201310940920     C***
201320940216     C* S T A M P A    B O L L A
201330940920     C***
201340020619     C* ESCLUDO SEMPRE BOLLE DI RECUPERO (TRANNE LE BOLLE FO-ASSEGNATO
201350020619     c* RECUPERO BOLLE firmate perchè in questo caso la bolla firmata
201360020619     c* deve partire con allegata la bolla di recupero)
201370040701     C* ESCLUDO SEMPRE BOLLE EXPORT DPD, BOLLE POSTE (solo se data
201380040701     c* spedizione < data in tabella "VPO" trk "PPT"
201390000121     C*
201400940920     C* 1) SE FLG STAMPA BOLLA CLIENTE NON E' "S" (STAMPATA DAL CLIENT)
201410940920     C*                              E NON E' "B" (DA STAMPARE COL PGM
201420940920     C*                                            DI RISTAMPA BOLLA)
201430940920     C*                                MA  E' "N" (DA STAMPARE IN IMMIS
201440940920     C*                                            SIONE BOLLE)
201450940920     C* IN MANUTENZIONE SI PUO' RISTAMPARE SEMPRE
201460970407     C* 2) SE IN MANUT. SE PREMUTO CMD8  (CMD8= 1)
201470941230     C* 3) SE DA DISK CLIENTI SOLO SE LNP >< DA LNA   PER "G"
201480960321     C* 4) SE DA DISK CLIENTI MAI                     PER "P"
201490970407     C* 5) SE IN MANUT. SE ERA NO DDT E DIVENTA SI DDT STAMPO SUBITO
201500000121     C* 6) SE IN MANUT. SE ERA SI DDT DPD E DIVENTA SI DDT NON DPD
201510000121     C*                                                STAMPO SUBITO
201520940216     C*
201530000121     C* 7) RESI E DIROTTAMENTI SEMPRE SUBITO
201540000121     C* 8) SE BOLLA A3 NON SI PUO' MAI STAMPARE
201550000121     C* 9) SE BOLLA F3 NON SI PUO' STAMPARE IN IMMISSIONE
201560000509     C*10) SE MANUTENZIONE DI PREPAGATO, RISTAMPO SEMPRE SE E' DDT SI
201570000121     C*11) SE IMMISSIONE   DI PREPAGATO, STAMPO SEMPRE
201580960321    0C     §3ATB1        IFNE      'A3'
201590020319     C     A_§OGNTW      ANDNE     'DPD'
201600020319     C     §ogntw        ANDNE     'PPT'
201610020619     c     §3atb1        oreq      'A3'
201620020619     c     blpcbo        andeq     'FO'
201630020319     C     §ogntw        OREQ      'PPT'
201640000713     C     BLPNRS        ANDEQ     0
201650040701     c     §ogntw        oreq      'PPT'
201660040729     c     blpdsp        andge     §vpoptl
201670000218     C* PER I PREPAGATI STAMPO LA BOLLA CHE E'LA FATTURA
201680000218     C     *IN34         OREQ      *ON
201690960321     C*
201700941110    1C     *IN12         IFEQ      *OFF
201710970128     C     BLPFST        ANDEQ     'S'
201720940216     C*
201730940216     C     *IN12         OREQ      *ON
201740940216     C     CMD8          ANDEQ     '1'
201750970404     C     BLPFST        ANDNE     'N'
201760970404     C*
201770970404     C     *IN12         OREQ      *ON
201780970404     C     *IN15         ANDEQ     *OFF
201790970404     C     SAVBAM        ANDNE     'S'
201800970404     C     SAVBAM        ANDNE     'C'
201810970404     C     BLPFST        ANDEQ     'S'
201820970407     C*
201830970407     C     *IN12         OREQ      *ON
201840970407     C     *IN15         ANDEQ     *ON
201850970407     C     CMD8          ANDEQ     'S'
201860990630     C*
201870990630     C     *IN12         OREQ      *ON
201880990701     C     *IN15         ANDEQ     *OFF
201890990630     C     BLPFST        ANDEQ     'S'
201900990701     C     *IN22         ANDEQ     *ON
201910990701     C     *IN12         OREQ      *OFF
201920990701     C     *IN34         ANDEQ     *ON
201930000121     C*
201940000121     C     *IN12         OREQ      *ON
201950000121     C     *IN15         ANDEQ     *OFF
201960020319     C     SAVNTW        ANDEQ     'DPD'
201970020319     C     A_§OGNTW      ANDNE     'DPD'
201980000121     C     BLPFST        ANDEQ     'S'
201990900514     C                   EXSR      STAMPA
202000940216    1C                   END
202010960321    0C                   END
202020911031     C*
202030911031     C* PASSO IL NUMERO DI SPEDIZIONE AL PGM RICHIAMATO
202040911031     C   12              Z-ADD     BLPNSP        §LPNSP
202050921006     C* SE RECUPERO ADDIZIONO 1 AL NUMERO
202060921006     C  N12
202070921006     CAN 98              ADD       1             RECNSP
202080900504     C*
202090040415     c* In manutenzione bolle , se riscritto fnblt devo clearare blpncr/ncp
202100061213    1c*                  if        *in12 and not *in15
202110061213    2c*                  if        wablt='S'
202120061213     c*    blpnrr        chain     fnblp000                           90
202130061213     c*                  clear                   blpncr
202140061213     c*                  clear                   blpncp
202150061213     c*                  clear                   blpvlc
202160061213     c*                  clear                   blppkc
202170061213     c* n90              update    fnblp000
202180061213   x2c*                  else
202190050502     c* Se già calcolato volume cml devo reimpostarlo su VLF
202200061213    3c*                  if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
202210061213     c*    blpnrr        chain     fnblp000                           90
202220061213     c*                  clear                   dslv20
202230061213     C*                  MOVEL     'P'           D20TBO
202240061213     C*                  MOVEL     'C'           D20TVL
202250061213     c*                  movel     'L'           d20tla
202260061213     C*                  MOVEL     BLPvlc        D20vlu
202270061213     C*                  MOVEL     BLPncr        D20ncr
202280061213     C*                  MOVEL     BLPFVF        D20FVF
202290061213     C*                  MOVEL     BLPVLF        D20VLF
202300061213     C*                  MOVEL     BLPFVB        D20FVB
202310061213     C*                  MOVEL     BLPVLB        D20VLB
202320061213     C*                  MOVEL     BLPAAS        D20AAS
202330061213     C*                  MOVEL     BLPLNP        D20LNP
202340061213     C*                  MOVEL     BLPNRS        D20NRS
202350061213     C*                  MOVEL     BLPNSP        D20NSP
202360061213     C*                  MOVEL     BLPCBO        D20CBO
202370061213     C*                  MOVEL     BLPNCL        D20NCL
202380061213    4C*    BLPDBR        IFGT      *ZEROS
202390061213     C*                  MOVE      BLPDBR        D20DTE
202400061213     C*                  ELSE
202410061213     C*                  MOVE      BLPMGS        D20DTE
202420061213     C*                  MOVEL     BLPAAS        D20DTE
202430061213    4C*                  END
202440061213     C*                  MOVEL     DSLV20        KPJBU
202450050502     C*
202460061213     C*                  CALL      'FNLV20R'
202470061213     C*                  PARM                    KPJBA
202480061213     c*                  parm      'N'           pwstor            1
202490050502     C*
202500061213     C*                  MOVEL     KPJBU         DSLV20
202510050502     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
202520061213    4C*    D20ERR        IFNE      '1'
202530061213     C*                  MOVEL     D20FVF        BLPFVF
202540061213     C*                  MOVEL     D20VLF        BLPVLF
202550061213E   4C*                  ENDIF
202560061213     c*                  update    fnblp000
202570061213    3c*                  endif
202580061213    2c*                  endif
202590061213    1c*                  endif
202600070601     c                   if        wmsg_pda='S'
202610070606     c* decodifico l'aut.
202620070606     C                   move      w02pdr_p      kpdpdr
202630070606     C                   move      'A'           kpdtip
202640070606     c                   clear                   w02rsc_p
202650070606     c     kfapd         chain     fiapd01l
202660070606     c                   if        %found(fiapd01l)
202670070606     c                   movel     apdrsc        w02rsc_p
202680070606     c                   endif
202690070601     c                   exfmt     ls01w02pda
202700070601     c                   endif
202710040408     c
202720080603     c* disalloco fisgn01l: Se manutneziono bolla export dpd senza
202730080603     c* modificare nulla, nella routine CTRSGN viene allocato fisgn
202740080603     c* e non viene poi pèiù disallocato
202750080603     c                   unlock    fisgn01l
202760081111     c* in manutenzione se cambiata data ritiro verifico se rielaborare
202770081121     c* statistica partito e a terra
202780090330     c* devo rielaborare anche in immissione se la data ritiro è inferiore
202790090330     c* a udate
202800090330    1c                   if        (*in12 and not *in15 and blpdrt<>s_drtblpi)
202810090330     c                             or ((*in12='0' or *in15) and blpdrt>0)
202820090330     c                   z-add     blpncl        st2ncl
202830090330    2c                   If        blpdrt <= §SdfParU
202840081111     C                   MOVE      blpdrt        SA2DTS            8 0
202850081111     C                   MOVE      'P'           SA2TRC            1
202860090330     C                   exsr      sr_callsa2r3
202870090330    2c                   endif
202880090330    2c                   If        s_drtblpi <= §SdfParU
202890081121     c                             and s_drtblpi > 0
202900081111     C                   MOVE      s_drtblpi     SA2DTS            8 0
202910081111     C                   MOVE      'P'           SA2TRC            1
202920090330     C                   exsr      sr_callsa2r3
202930090330    2c                   endif
202940090330    2c                   If        blpdrt <= §SdfterU
202950081121     C                   MOVE      blpdrt        SA2DTS            8 0
202960081121     C                   MOVE      'T'           SA2TRC            1
202970090330     C                   exsr      sr_callsa2r3
202980090330    2c                   endif
202990090330    2c                   If        s_drtblpi <= §SdfTerU
203000081121     c                             and s_drtblpi > 0
203010081121     C                   MOVE      s_drtblpi     SA2DTS            8 0
203020081121     C                   MOVE      'T'           SA2TRC            1
203030090330     C                   exsr      sr_callsa2r3
203040090330    2c                   endif
203050090330    1c                   endif
203060130308     c* invio messagio a ced se cliente fornisce pdf senza abilitazione
203070130313     c* e nel caso in cui la bolla sia stata confermata senza (hanno
203080130313     c* cambiato il CTM a video)
203090130313     c                   if        wvatpe='S' and §1bf16<>'S'
203100130308     c                   exsr      ced_alert
203110130308     c                   endif
203120080603
203130040408     C     ENDREG        ENDSR
203140090330      *--------------------------------------------------------------*
203150090330      * Richiamo pgm per rielaborazione statistiche partito e a terra
203160090330      *--------------------------------------------------------------*
203170090330     c     sr_callsa2r3  BegSr
203180090330     C                   CALL      'FNLSA2R3'
203190090330     C                   PARM                    SA2TLA            1
203200090330     C                   PARM                    SA2TRC
203210090330     C                   PARM                    SA2DTS
203220090330     C                   PARM                    WWLNA             3 0
203230090330     C                   PARM                    st2ncl            5 0
203240090330     c                   endsr
203250060209      *--------------------------------------------------------------*
203260060209      * Storicizzazione variazione di tassazione prepagato
203270060209      *--------------------------------------------------------------*
203280060209     c     Stoarb        BegSr
203290060209     c*
203300060209     c                   open      fiarbt0f
203310060209     c                   open      fiarbu0f
203320060209     c*
203330060209     c                   movel     '1'           wtrc
203340060209     C     KBLP4         CHAIN     FIAR6000
203350060209     c*
203360060209     c                   z-add     blpaas        arbaas
203370060209     c                   z-add     blplnp        arblnp
203380060209     c                   z-add     blpnrs        arbnrs
203390060209     c                   z-add     blpnsp        arbnsp
203400060209     C                   MOVEL     AR6DIV        ARBDIV
203410060209     C                   MOVEL     AR6POR        ARBPOR
203420060209     C                   MOVEL     AR6SV1        ARBSV1
203430060209     C                   MOVEL     AR6VA1        ARBVA1
203440060209     C                   MOVEL     AR6SV2        ARBSV2
203450060209     C                   MOVEL     AR6VA2        ARBVA2
203460060209     C                   MOVEL     AR6SV3        ARBSV3
203470060209     C                   MOVEL     AR6VA3        ARBVA3
203480060209     C                   MOVEL     AR6IMV        ARBIMV
203490060209     C                   MOVEL     AR6ALI        ARBALI
203500060209     C                   MOVEL     AR6CEI        ARBCEI
203510060209     C                   MOVEL     AR6IFT        ARBIFT
203520060209     C                   MOVEL     AR6DFT        ARBDFT
203530060209     C                   MOVEL     AR6NFT        ARBNFT
203540060209     C                   MOVEL     AR6FIV        ARBFIV
203550060209     C                   MOVEL     AR6FIM        ARBFIM
203560060209     c                   z-add     blpksc        arbksc
203570060209     c                   z-add     blpctr        arbctr
203580060209     c                   move      blpcbo        arbcbo
203590060209      *
203600060209      * Metto nell'ultimo byte del campo arbpru che la bolla aggiornata
203610060209      * è in partenza 'P'
203620060209     C                   MOVE      'P'           ARBPRU
203630060209      *
203640060209     C                   WRITE     FIARBT00
203650060209     C*
203660060209     C* SE HO DELLE ATRE VARIE LE STORICIZZO NEL FILE FIARBU0F
203670060209    1C     WAR7          IFEQ      'E'
203680060209     C     Kblp4         SETLL     FIAR7000
203690060209     C     Kblp4         READE     FIAR7000                               30
203700060209     C*
203710060209    2C     *IN30         DOWEQ     *OFF
203720060209     C                   MOVEL     AR7SVN        ARBSVN
203730060209     C                   MOVEL     AR7VAN        ARBVAN
203740060209     C                   WRITE     FIARBU00
203750060209     C*
203760060209     C     Kblp4         READE(N)  FIAR7000                               30
203770060209    2C                   ENDDO
203780060209     C                   ENDIF
203790060209     C*
203800060209     c                   close     fiarbt0f
203810060209     c                   close     fiarbu0f
203820060209     C*
203830060209     c                   endsr
203840060209
203850050209      *--------------------------------------------------------------*
203860050209      * Chaino fncls per codice ass. per impostazione §b4af1
203870050209      *--------------------------------------------------------------*
203880050209     c     Sr_fncls      BegSr
203890050209     c                   clear                   WCLSflo8
203900050209     c     §b4aks        chain     fncls01l
203910050209     c                   if        %found(fncls01l)
203920050209     c                   eval      wclsflo8 = %SUBST(clsflo:8:1)
203930050209     c                   endif
203940050209     c                   endsr
203950030704
203960030704      *--------------------------------------------------------------*
203970030704      * Scrivo/Aggiorno Fiar5
203980030704      *--------------------------------------------------------------*
203990030704     c     Sr_wrtFiar5   BegSr
204000030704
204010030704     c                   If        %Found(Fiar501l)
204020030704     c                   Update    Fiar5000
204030030704     c                   Else
204040030704     c                   Eval      Ar5Aas = BlpAas
204050030704     c                   Eval      Ar5Lnp = BlpLnp
204060030704     c                   Eval      Ar5Nrs = BlpNrs
204070030704     c                   Eval      Ar5Nsp = BlpNsp
204080030704     c                   Eval      Ar5Trd = KAr5Trd
204090030704     c                   Eval      Ar5Ft1 = 'T'
204100030704     c                   Eval      Ar5Dt1 = *All'9'
204110030704     c                   Eval      Ar5Ft2 = 'T'
204120030704     c                   Eval      Ar5Dt2 = *All'9'
204130030704     c                   Write     Fiar5000
204140030704     c                   EndIf
204150030704
204160030704     c                   EndSr
204170030326
204180030326      *--------------------------------------------------------------*
204190030326      * Forzo la data consegna richiesta
204200030326      *--------------------------------------------------------------*
204210030326     c     SrDcr         BegSr
204220111206     c* questa DS mi serve per controllare la data calcolata con i giorni
204230111206     c*  di chiusura, solo in caso di partciolarità di attesa
204240111206     c*  richiamerò non il TRUL13 ma il TRUL13R1
204250111206     c                   clear                   trul13ds1
204260100218     c
204270100218    1c                   select
204280030409      * Se non ho le ore da aggiungere alla delivery
204290100218If  1c                   when      VidOre > *Zeros
204300100218     c
204310100218     c                   Eval      wwtcr = 'P'
204320100218     c                   Eval      wore = VidOre
204330100218     c                   if        blptsp='C' or blptsp='E'
204340100218     c                   eval      wore=wore+24
204350100218     c                   endif
204360100218     c                   if        blptsp<>'H'
204370100218     c                   Exsr      CalDcr
204380100218     c                   endif
204390100218     c
204400100218     c* Se ho la particolarità, cerco con particolarità
204410100218    1c                   when      vidgma<>'  ' and §7ratt='S'
204420100218     c                   Clear                   dDcr
204430100218     c                   Clear                   dsbs02
204440100218     c                   Eval      T02Mod = 'C'
204450100218     c                   Eval      T02Sif = Knsif
204460100218     c                   Eval      T02Cod = 'DCR'
204470100218     c                   Movel     wksc          T02Ke1
204480100218     c                   Movel     'TTR'         t02ke2
204490100218     c                   Call      'TIBS02R'
204500100218     c                   Parm                    Kpjba
204510100218     c                   Parm                    Dsbs02
204520100218     c
204530100218      * se il cliente è codificato in tabella calcolo la nuova data
204540100218      * consegna richiesta
204550100218If  2c                   If        T02Err = *Blanks
204560100218     c                   Movel     T02Uni        dDcr
204570100218     c                   Eval      wore = §DcrOre
204580100218     c                   Eval      wwtcr = §DcrTcr
204590111206     c* Imposto i giorni di chiusura
204600111206     c                   eval      i13gc1=vidgc1
204610111206     c                   eval      i13gc2=vidgc2
204620111206     c                   eval      i13tcr=wwtcr
204630100218     c                   Exsr      CalDcr
204640100218     c                   endif
204650100218     c
204660100218   x1c                   other
204670100218      * Forzo la data consegna richiesta con tabella DCR se:
204680100218      * 1) non è una bolla di recupero o un conto servizi
204690100218      * 2) non è un tipo serivizio "H"=Consegna ore 10:30
204700100218      * 3) non è un tipo serivizio "E"=priority
204710100218      *  se trovo la tabella DCR con cliente/tariffa o solo cliente
204720100218     c
204730100218If  2c                   If        §3arbl = 'N' and blptsp<>'H'
204740100217     c                             and blptsp<>'E'
204750100215
204760030326     c                   Clear                   dDcr
204770030326     c                   Clear                   dsbs02
204780030326     c                   Eval      T02Mod = 'C'
204790030326     c                   Eval      T02Sif = Knsif
204800030326     c                   Eval      T02Cod = 'DCR'
204810100215     c                   Movel     wksc          T02Ke1
204820100218     c                   Movel     VidCtr        t02ke2
204830030326     c                   Call      'TIBS02R'
204840030326     c                   Parm                    Kpjba
204850030326     c                   Parm                    Dsbs02
204860030326      * se il cliente è codificato in tabella calcolo la nuova data
204870030326      * consegna richiesta
204880100218If  3c                   If        T02Err <>*Blanks
204890100218     c                   Eval      T02Mod = 'C'
204900100218     c                   Eval      T02Sif = Knsif
204910100218     c                   Eval      T02Cod = 'DCR'
204920100218     c                   Movel     wksc          T02Ke1
204930100218     c                   clear                   t02ke2
204940100218     c                   Call      'TIBS02R'
204950100218     c                   Parm                    Kpjba
204960100218     c                   Parm                    Dsbs02
204970100218    3c                   endif
204980100218     c
204990100218If  3c                   If        T02Err = *Blanks
205000030326     c                   Movel     T02Uni        dDcr
205010030409     c                   Eval      wore = §DcrOre
205020030409     c                   Eval      wwtcr = §DcrTcr
205030030409     c                   Exsr      CalDcr
205040100218    3c                   EndIf
205050100218    2c                   EndIf
205060100218    1c                   Endsl
205070030326
205080030326     c                   EndSr
205090030409
205100030409      *--------------------------------------------------------------*
205110030409      * Calcolo le ore da aggiungere alla delivery
205120030409      *--------------------------------------------------------------*
205130030409     c     CalDcr        BegSr
205140100222     c* Se 24 ore per IL o  48 per PRIMA DDEL
205150100219     c*   devo aggiungere alla delivery anche i tempi
205160100219     c*   del C/ass altrimenti non servono (48 ore le ho comunque)
205170100222     c                   if        (wwTCR= ' ' and  wore>24)
205180100222     c                             or (wwTCR='P' and wore>48)
205190100222     c                             or wwTCR='D'
205200100219     c                   eval      UsaCass='N'
205210100219     c                   endif
205220100219     c
205230030409      * CALL AL TNSD99 x calcolare la data consegna teorica
205240030409     c                   ExSr      CLSE98
205250100219     c
205260100219      * Richiamo pgm che calcola la prima data lavorativa disponibile
205270030409     c                   Clear                   Trul13ds
205280030409     c                   Eval      tI13Tla = 'L'
205290030409     c                   Eval      I13Mod = 'A'
205300030409     c                   Eval      I13Fil = BlpLna
205310030409     c                   Eval      I13Din = d98dce
205320030409     c                   Eval      I13Hin = d98hce
205330030409     c                   Eval      I13Ore = wore
205340111206     c
205350111206     c* se impostati i giorni di chiusura, richiamo trul13r1
205360111206     c                   if        i13gc1<>*blanks or i13gc2<>*blanks
205370111206     c                   Call      'TRUL13R1'
205380111206     c                   Parm                    Trul13ds
205390111206     c                   Parm                    Trul13ds1
205400111206     c                   else
205410030409     c                   Call      'TRUL13R'
205420030409     c                   Parm                    Trul13ds
205430111206     c                   endif
205440111206     c
205450111206     c                   If        tO13Err = *Blanks and o13dfi>0
205460030409     c                   Eval      BlpTcr = wwtcr
205470030409     c                   Eval      BlpDcr = O13Dfi
205480030409     c                   EndIf
205490030409
205500030409     c                   EndSr
205510000209     C*
205520000209     C* CONTROLLO FILE FISGN00F -------------------------------------*
205530000209     C     CTRSGN        BEGSR
205540010116     C     KSGN          CHAIN     FISGN01L                           30
205550000209    3C     *IN30         IFEQ      *OFF
205560000209     C* SE NON E' LA STESSA SPEDIZIONE, ANNULLO
205570000209    4C     §LDAAS        IFNE      BLPAAS
205580000209     C     SGNLNP        ORNE      BLPLNP
205590000209     C     §LDNRS        ORNE      BLPNRS
205600000209     C     SGNNSP        ORNE      BLPNSP
205610000919    5C     SGNATB        IFNE      '*'
205620000920     C* Se il chi sono non è di nuova immissione non devo incrementare
205630000920     C* il progressivo ed in generale non è necessario updatare fisgn
205640000920     C* perchè in questo caso risulta già annullato
205650000920    6C     V8HCOL        IFEQ      *ZEROS
205660000209     C                   MOVEL     'A'           SGNATB
205670010116     C                   CLEAR                   SGNT6A
205680010116     C                   CLEAR                   SGNT6B
205690010116     C                   CLEAR                   SGNT6C
205700010116     C                   CLEAR                   SGNT6D
205710010116     C                   CLEAR                   SGNT6E
205720010116     C                   CLEAR                   SGNT6F
205730080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
205740000920    7C     SGNFL1        IFEQ      *BLANKS
205750000920     C                   MOVE      *ZEROS        WSGPRG            1 0
205760000920     C                   ELSE
205770000920     C                   MOVE      SGNFL1        WSGPRG
205780000920    7C                   ENDIF
205790000920     C                   ADD       1             WSGPRG
205800000920     C                   MOVE      WSGPRG        SGNFL1
205810000209     C                   UPDATE    FISGN000
205820000921   X6C                   ELSE
205830001009     C     *IN79         IFEQ      *OFF
205840001011     C     WEXDPD        ANDNE     'S'
205850001009     C                   UNLOCK    FISGN01L
205860001009     C                   ENDIF
205870000920    6C                   ENDIF
205880000209     C                   MOVEL     'N'           WDKC
205890000919   x5C                   ELSE
205900000919     C* altra spedizione ma sgnatb='*' --> posso andare in update
205910000919     C                   MOVEL     'S'           WESSGN            1
205920000921     C                   CLEAR                   SGNST2
205930000920     C     *IN79         IFEQ      *OFF
205940001011     C     WEXDPD        ANDNE     'S'
205950000919     C                   UNLOCK    FISGN01L
205960000919    5C                   ENDIF
205970000920    5C                   ENDIF
205980000209   X4C                   ELSE
205990000209     C*
206000000921     C* MEMORIZZO CHE ESISTE FISGN --> VADO IN UPDATE
206010000921     C* SE PERO' E' ANNULLATO IL COLLO NON DEVO TRATTARLO COME DISK C
206020000921     C     SGNATB        IFEQ      'A'
206030000921     C                   MOVEL     'N'           WDKC
206040000921     C                   ELSE
206050000209     C                   MOVEL     'S'           WESSGN            1
206060000921     C                   ENDIF
206070000918     C     *IN79         IFEQ      *OFF
206080001011     C     WEXDPD        ANDNE     'S'
206090000918     C                   UNLOCK    FISGN01L
206100000918     C                   ENDIF
206110000209    4C                   ENDIF
206120000209     C*
206130000209   X3C                   ELSE
206140000209     C* IMMISSIONE
206150000919     C                   CLEAR                   SGNATB
206160000209     C                   MOVEL(P)  KWHO          SGNWHO
206170000211     C                   Z-ADD     §3ISEA        SGNSEA
206180000209     C                   MOVEL     'S'           SGNST1
206190000921     C                   CLEAR                   SGNST2
206200000921     C                   MOVE      '0'           SGNFL1
206210000211     C     BLPCCM        IFGT      0
206220000211     C                   MOVEL     BLPCCM        SGNKSC
206230000211     C                   ELSE
206240000211     C                   MOVEL     BLPKSC        SGNKSC
206250000908    4C                   ENDIF
206260000921     C                   MOVEL     BLPLNP        SGNLNP
206270000921     C                   MOVEL     BLPNSP        SGNNSP
206280010116     C                   CLEAR                   SGNT6A
206290010116     C                   CLEAR                   SGNT6B
206300010116     C                   CLEAR                   SGNT6C
206310010116     C                   CLEAR                   SGNT6D
206320010116     C                   CLEAR                   SGNT6E
206330010116     C                   CLEAR                   SGNT6F
206340080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
206350000922     C                   CLEAR                   SGNRST
206360000211    3C                   ENDIF
206370000211     C**
206380000209     C                   ENDSR
206390000921     C* ANNULLO FILE FISGN00F -------------------------------------*
206400000921     C     ANNSGN        BEGSR
206410000921    1C     SGNATB        IFEQ      'A'
206420000921    2C     SGNFL1        IFEQ      *BLANKS
206430000921     C                   MOVE      *ZEROS        WSGPRG
206440000921   X2C                   ELSE
206450000921     C                   MOVE      SGNFL1        WSGPRG
206460000921    2C                   ENDIF
206470000921    2C     WSGPRG        IFEQ      0
206480000921     C                   MOVE      '*'           SGNATB
206490000921   X2C                   ELSE
206500000921     C                   SUB       1             WSGPRG
206510000921     C                   MOVE      WSGPRG        SGNFL1
206520000921    2C                   ENDIF
206530000921   X1C                   ELSE
206540000921    2C     SGNATB        IFEQ      *BLANKS
206550000921     C                   MOVEL     '*'           SGNATB
206560000921    2C                   ENDIF
206570000921    1C                   ENDIF
206580010116     C                   CLEAR                   SGNT6A
206590010116     C                   CLEAR                   SGNT6B
206600010116     C                   CLEAR                   SGNT6C
206610010116     C                   CLEAR                   SGNT6D
206620010116     C                   CLEAR                   SGNT6E
206630010116     C                   CLEAR                   SGNT6F
206640080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
206650001005     C     WSGNR         IFEQ      'B'
206660060622     c     *in79         oreq      *on
206670001005     C                   UPDATE    FISGN005
206680001005     C                   ELSE
206690000921     C                   UPDATE    FISGN000
206700001005     C                   ENDIF
206710000921     C                   ENDSR
206720991014      *
206730991014      * AGGIORNO VARIE IN FNBLP E IN FIAR7 -------------------------*
206740991014     C     WRTVAR        BEGSR
206750991014      *
206760991014     C                   SELECT
206770991026    4C     C             WHENGT    3
206780991014     C                   Z-ADD     BLPAAS        AR7AAS
206790991014     C                   Z-ADD     BLPLNP        AR7LNP
206800991014     C                   Z-ADD     BLPNRS        AR7NRS
206810991014     C                   Z-ADD     BLPNSP        AR7NSP
206820991014     C                   MOVEL     '1'           AR7TRC
206830991014     C                   MOVEL     V3CSV1        AR7SVN
206840991014     C                   Z-ADD     V3CVA1        AR7VAN
206850991014     C                   WRITE     FIAR7000
206860991014    4 *
206870991014    4C     C             WHENEQ    3
206880991027     C                   MOVEL     V3CSV1        WSV3
206890991027     C                   Z-ADD     V3CVA1        WVA3
206900991014     C                   ADD       1             C
206910991014    4 *
206920991014    4C     C             WHENEQ    2
206930991027     C                   MOVEL     V3CSV1        WSV2
206940991027     C                   Z-ADD     V3CVA1        WVA2
206950991014     C                   ADD       1             C
206960991014    4 *
206970991014    4C     C             WHENEQ    1
206980991027     C                   MOVEL     V3CSV1        WSV1
206990991027     C                   Z-ADD     V3CVA1        WVA1
207000991014     C                   ADD       1             C
207010991014    4C                   ENDSL
207020991014      *
207030991014     C                   ENDSR
207040040116      *
207050040116      *-------------------------------------------------------------*
207060040116      * Aggiorno le varie della seconda bolla
207070040116      *-------------------------------------------------------------*
207080040116     c     WrtVar1       BegSr
207090040116
207100040116s   1c                   Select
207110040116     c                   When      ContaSv > 3
207120040116     c                   Eval      Ar7Aas = BlpAas
207130040116     c                   Eval      Ar7Lnp = BlpLnp
207140040116     c                   Eval      Ar7Nrs = BlpNrs
207150040116     c                   Eval      Ar7Nsp = BlpNsp
207160040116     c                   Eval      Ar7Trc = '2'
207170040116     c                   Eval      Ar7Svn = w2sv(c)
207180040116     c                   Eval      Ar7Van = w2va(c)
207190040116     c                   Write     Fiar7000
207200040116
207210040116     c                   When      ContaSv = 3
207220040116     c                   Movel     w2sv(c)       wsv3
207230040116     c                   Z-add     w2va(c)       wva3
207240040116     c                   Add       1             ContaSv
207250040116
207260040116     c                   When      ContaSv = 2
207270040116     c                   Movel     w2sv(c)       wsv2
207280040116     c                   Z-add     w2va(c)       wva2
207290040116     c                   Add       1             ContaSv
207300040116
207310040116     c                   When      ContaSv = 1
207320040116     c                   Movel     w2sv(c)       wsv1
207330040116     c                   Z-add     w2va(c)       wva1
207340040116     c                   Add       1             ContaSv
207350040116    1c                   EndSl
207360040116
207370040116     c                   EndSr
207380991014     C*
207390991014     C* CONTROLLO SE BOLLA DA STAMPARE O MNEO ----------------------*
207400991014     C     CTRSTA        BEGSR
207410970328     C                   MOVEL     '1'           WSTA
207420970328     C* SOLO PER RICHIAMO DA CONFERMA BOLLA
207430970328     C*  SE NON E' DA STAMPARE FACCIO FINTA CHE SIA STAMPA STAMPATA
207440970328     C     *IN12         IFEQ      *ON
207450970328     C     *IN15         ANDEQ     *ON
207460970328     C*
207470970407     C                   SELECT
207480970407     C     WFPR          WHENEQ    'G'
207490970328     C     BLPLNP        ANDEQ     BLPLNA
207500970328     C                   MOVEL     ' '           WSTA
207510970328     C* SE NON E' DA STAMPARE, NON STAMPO
207520970407     C     §1BFG3        WHENNE    'N'
207530970328     C                   MOVEL     ' '           WSTA
207540970328     C* SE FLAG "P" NON STAMPO MAI
207550970407     C     WFPR          WHENEQ    'P'
207560970328     C                   MOVEL     ' '           WSTA              1
207570970407     C**
207580970407     C* SE NON VENGO DA CONFERMA BOLLE STAMPO SEMPRE SUBITO
207590970407     C     §LPRIC        WHENNE    'C'
207600970407     C                   MOVEL     'S'           WSTA
207610970407     C                   ENDSL
207620970328     C*
207630970328     C                   ENDIF
207640970328     C                   ENDSR
207650970328     C*
207660020917     C*--- CANCELLO RECORD FIVAD00F ----------------------------------*
207670951019     C     DELVAD        BEGSR
207680020917     C     KBLC          SETLL     FIVAD000                               30
207690910220     C   30              DO        *HIVAL
207700020917     C     KBLC          READE     FIVAD000                               30
207710020917     C  N30              DELETE    FIVAD000
207720910220     C  N30              END
207730910220     C*
207740910220     C                   ENDSR
207750020917     C*--- CANCELLO RECORD FIVAT00F ----------------------------------*
207760980406     C     DELVAT        BEGSR
207770020917     C     KBLC          SETLL     FIVAT000                               30
207780980406     C   30              DO        *HIVAL
207790020917     C     KBLC          READE     FIVAT000                               30
207800020917     C  N30              DELETE    FIVAT000
207810980406     C  N30              END
207820980406     C*
207830980406     C                   ENDSR
207840040601     c*
207850040601     C*--- CANCELLO RECORD FIVAX00F ----------------------------------*
207860040601     C     DELVAX        BEGSR
207870040601     C     KBLC          SETLL     FIVAX000                               30
207880040601     C   30              DO        *HIVAL
207890040601     C     KBLC          READE     FIVAX000                               30
207900040601     C  N30              DELETE    FIVAX000
207910040601     C  N30              END
207920040601     C*
207930040601     C                   ENDSR
207940940214     C*
207950940214     C* ROTTURA CODICE PRODOTT DA DETTAGLIO COLLI CLIENTE -----------*
207960940214     C     ROTCDP        BEGSR
207970940214     C*
207980940214     C                   Z-ADD     COMSCD        BLDNCD
207990940214     C     BLDNCD        ADD       VARNCL        BLDNCA
208000940214     C                   SUB       1             BLDNCA
208010940214     C                   ADD       VARNCL        COMSCD
208020940214     C     BLDNCA        IFEQ      BLDNCD
208030940214     C                   Z-ADD     0             BLDNCA
208040940214     C                   END
208050000426     C                   MOVEL     BLDNCL        SA2NCL
208060000426     C                   MOVE      BLDCDP        SA2CDP
208070000426     C                   MOVEL     VARNCL        BLDNCL
208080000426     C                   MOVE      VARCDP        BLDCDP
208090940224     C* CREA O AGGIORNA SEGNACOLLI
208100940214     C                   EXSR      CRTBLD
208110001002     C*
208120000426     C                   MOVEL     SA2NCL        BLDNCL
208130000426     C                   MOVE      SA2CDP        BLDCDP
208140940214     C                   ADD       VARNCL        BLDNC1
208150940214     C                   MOVEL     BLDCDP        VARCDP
208160940214     C                   CLEAR                   VARNCL
208170940214     C                   ENDSR
208180991117     C*
208190991117     C*--- IMPOSTO NUMERO DISTINTA PER SPED DPD ----------------------*
208200991117     C     SPEDPD        BEGSR
208210991117      *
208220991117     C                   CLEAR                   DPDBRC
208230991117      *
208240060510     C                   MOVE      §OGDP1        DPDLNP
208250991117      *
208260991117     C                   MOVEL     BLPMGS        W0020
208270991117     C                   MOVE      W0020         DPDGMS
208280991117     C                   MOVE      BLPMGS        W0020
208290991117     C                   MOVEL     W0020         DPDGMS
208300991117      * Aggancio numeratore 190 per progressivo distinta
208310991117     C                   CLEAR                   NUFNUM
208320991117     C                   EXSR      DPDNUM
208330991117     C                   Z-ADD     NUFNUM        DPDNDS
208340991117      * Calcolo CHECK DIGIT
208350991117     C                   EXSR      M1031
208360991117      *
208370991117     C                   ENDSR
208380991117      *
208390991117      ** CALCOLA CHECK DIGIT -----------------------------
208400991117     C     M1031         BEGSR
208410991117      *
208420991117     C                   MOVE      *ZERO         §TT2              3 0
208430991117     C                   CLEAR                   W0030
208440991117     C                   CLEAR                   W0010
208450991117      *
208460991117      * TOTALIZZO I VALORI, QUELLI NELLE POSIZIONI DISPARI PER 3
208470991117     C                   DO        11            XX                2 0
208480991117      *
208490991117     C     XX            DIV       2             §CTR              3 0
208500991117     C                   MVR                     §RST              3 030
208510991117      *
208520991117     C     *IN30         IFEQ      '1'
208530991117     C     §11(XX)       MULT      3             §CTR
208540991117     C                   ELSE
208550991117     C                   Z-ADD     §11(XX)       §CTR
208560991117     C                   ENDIF
208570991117      *
208580991117     C                   ADD       §CTR          W0030
208590991117     C                   ENDDO
208600991117      *
208610991117     C     W0030         ADD       9             §TT2
208620991117     C                   MOVE      0             §TT2
208630991117     C     §TT2          SUB       W0030         DPDCHD
208640991117      *
208650991117     C                   ENDSR
208660991117      *
208670991117      *--- NUMERO DISTINTA DPD ---------------------------------------*
208680991117     C     DPDNUM        BEGSR
208690991117      *
208700991117     C                   Z-ADD     BLPMGS        DATA6
208710991117     C                   MOVE      BLPAAS        W0020
208720991117     C                   MOVEL     W0020         DATA6
208730991117     C                   Z-ADD     190           CNU
208740991117      *
208750991118     C     KNUF3         CHAIN     FLNUF2                             30
208760991117      * SE NON TROVATO IL NUMERATORE PROVO A CREARLO
208770991117     C     *IN30         IFEQ      *ON
208780991117     C                   CLEAR                   FLNUF2
208790991117     C                   Z-ADD     CNU           NUFCNU
208800991117     C                   Z-ADD     DATA6         NUFDAT
208810991117     C                   WRITE     FLNUF2
208820991118     C     KNUF3         CHAIN     FLNUF2                             30
208830991118     C                   ENDIF
208840991117      *
208850991117     C     *IN30         IFEQ      *OFF
208860991117     C                   ADD       1             NUFNUM
208870991117     C                   UPDATE    FLNUF2
208880991117     C                   ENDIF
208890991117      *
208900991117     C                   ENDSR
208910991130      *
208920991130      *--- EVENTI DPD ------------------------------------------------*
208930991130     C     EVEDPD        BEGSR
208940991130      *
208950060619     C                   MOVE      'S'           WEU12             1
208960991130      *
208970060619     C                   CLEAR                   fieu12ds
208980060619     C                   Z-ADD     BLPAAS        i12AAS
208990060619     C                   Z-ADD     BLPLNP        i12LNP
209000060619     C                   Z-ADD     BLPNRS        i12NRS
209010060619     C                   Z-ADD     BLPNSP        i12NSP
209020060619     C                   Z-ADD     BLPLNA        i12LNA
209030060619     C                   movel     v7cnpr        i12parcel
209040060619     c                   movel     'I'           i12ie
209050991130      *
209060060619     C                   CALL      'FIEU12R'
209070991130     C                   PARM                    KPJBA
209080060619     C                   PARM                    fieu12ds
209090991130      *
209100991130     C                   ENDSR
209110991117      *
209120991117      *--- STAMPA BOLLE ----------------------------------------------*
209130900508     C     STAMPA        BEGSR
209140941107     C*
209150941107     C                   MOVEL     'P'           DB0TBO
209160110323     C                   MOVEL     'B'           DB0GES
209170990610     C* STAMPO DI UN FRANCO PREPAGATO
209180990610     C     PARTCH        IFEQ      'P'
209190010307     C     §LPFPR        OREQ      'O'
209200990610     C                   MOVEL     '8'           DB0TBO
209210110323     c* Per la stampa di un prepagato
209220110323     c* non va più bene richiamare con "B" perchè non c'è la possibilità
209230110323     c* di passare l'importo del bollo (bisognerebbe modificare la fnlsb5ds
209240110323     c* ma per il momento non è il caso mentre non va bene il campo db0ese pechè
209250110323     c* è stato pensato per contenere la somma degli importi esenti..)
209260110323     c* Quindi richiamo con DB0GES=' ': in questo modo il pgm di stampa
209270110323     c* reperisce autonomamente i dati della bolla incluso il bollo se presente
209280110323     C                   MOVEL     ' '           DB0GES
209290990610     C                   ENDIF
209300941108     C*
209310941108     C* SE SONO IN MANUTENZIONE SI TRATTA DI RISTAMPA
209320941108    1C     *IN12         IFEQ      *ON
209330941108     C     *IN15         ANDEQ     *OFF
209340941108     C                   MOVEL     'R'           DB0RIS
209350941108    1C                   ENDIF
209360941107     C*
209370941107     C                   MOVEL     BLPCBO        DB0CBO
209380941107     C                   MOVEL     §3ATB1        DB0TB1
209390941107     C                   MOVEL     §3ATB2        DB0TB2
209400990610     C* DE NON E' PREPAGATO STAMPO LA DECODIFICA DEL TIPO BOLLA
209410990628     C     PARTCH        IFNE      'P'
209420010307     C     §LPFPR        ANDNE     'O'
209430990610     C                   MOVEL(P)  §3ADES        DB0DCB
209440990610     C                   ELSE
209450990610     C                   MOVEL(P)  CPREPA        DB0DCB
209460990610     C                   ENDIF
209470990610     C**
209480941107     C                   MOVEL     BLPTSP        DB0TSP
209490941107     C                   Z-ADD     1             C
209500941107     C     BLPTSP        LOOKUP    TSP(C)                                 30
209510941107     C   30              MOVEL     DTS(C)        DB0DTS
209520941115     C   30              MOVEL     STS(C)        DB0FST
209530941107     C*
209540941107     C                   MOVEL     BLPAAS        DB0AAS
209550941107     C                   MOVEL     BLPMGS        DB0MGS
209560941107     C                   MOVEL     BLPLNP        DB0LNP
209570941107     C                   MOVEL     BLPNRS        DB0NRS
209580941107     C                   MOVEL     BLPNSP        DB0NSP
209590941107     C                   MOVEL     BLPTC1        DB0TC1
209600941107     C                   MOVEL     BLPTC2        DB0TC2
209610941107     C                   MOVEL     BLPFNS        DB0FNS
209620941107     C                   MOVEL     BLPRMN        DB0RMN
209630941107     C                   MOVEL     BLPRMA        DB0RMA
209640941107     C                   MOVEL     BLPIAS        DB0IAS
209650941107     C                   MOVEL     BLPVAS        DB0VAS
209660941107     C                   MOVEL     BLPVMD        DB0VMD
209670941107     C                   MOVEL     BLPVAD        DB0VAD
209680961007     C     TAMFVD        IFNE      '4'
209690941107     C                   MOVEL     BLPQFT        DB0QFT
209700961007     C                   ENDIF
209710941107     C                   MOVEL     VIDTIC        DB0TIC
209720980806     C* SE L'IMPORTO DEL C/A E' OLTRE IL LIMITE PRENDO DESCRIZIONE OLTR
209730980806     C                   MOVEL     §1ADES        DB0DTI
209740980806     C**
209750980806     C     §1ADEO        IFNE      *BLANKS
209760980806     C** DESCRIZIONE OLTRE LIMITE
209770011212     C     FCASAV        IFNE      *BLANKS
209780980806     C                   MOVEL     §1ADEO        DB0DTI
209790980806     C                   ENDIF
209800980806     C                   ENDIF
209810980806     C**
209820950208     C                   MOVEL     §1AUCM        DB0UCM
209830950208     C                   MOVEL     §1ASTE        DB0STE
209840941107     C                   MOVEL     VIDCAS        DB0CAS
209850941107     C                   MOVEL     VIDVCA        DB0VCA
209860941107     C                   MOVEL     VIDGCA        DB0GCA
209870941107     C                   MOVEL     BLPLNA        DB0LNA
209880941107     C                   MOVEL     BLPZNC        DB0ZNC
209890941107     C* CODICE MITENTE PIENO
209900941108    1C     BLPCCM        IFGT      0
209910941107     C                   Z-ADD     BLPCCM        DB0CCM
209920941108   X1C                   ELSE
209930941107     C* SE NON E' ASSEGNO LO IMPOSTO DA KSC
209940941108    2C     *IN04         IFEQ      *OFF
209950941107     C                   MOVEL     BLPKSC        DB0CCM
209960950125     C* SOLO SE BOLLA FRANCO PASSO LA P.IVA
209970061110     C***                MOVEL     BLPCPI        DB0CPI
209980061110     c* Adesso nel campo della partita iva ci passo il codice fiscale per
209990061110     c*  la stampa
210000061110     c                   movel     vidcdf        db0cpi
210010941108    2C                   ENDIF
210020941108    1C                   ENDIF
210030941107     C*
210040941107     C* ASSEGNATO O 2 BOLLA: CODICE DESTINATARIO LNA9999
210050941108    1C     §3ATB2        IFNE      *BLANKS
210060941108     C     *IN04         OREQ      *ON
210070941107     C                   Z-ADD     9999          DB0CCD
210080941107     C                   MOVEL     BLPLNA        DB0CCD
210090941108    1C                   ENDIF
210100941107     C                   MOVEL     BLPRSM        DB0RSM
210110941107     C                   MOVEL     BLPINM        DB0INM
210120941107     C                   MOVEL     BLPLOM        DB0LOM
210130941107     C                   MOVEL     BLPCAM        DB0CAM
210140941107     C                   MOVEL     BLPFAP        DB0FAP
210150941107     C                   MOVEL     BLPNZM        DB0NZM
210160941107     C                   MOVEL     BLPPRM        DB0PRM
210170941107     C*
210180941107     C                   MOVEL     BLPRSD        DB0RSD
210190950123     C                   MOVE      WRD2          DB0RD2
210200941107     C                   MOVEL     BLPIND        DB0IND
210210941107     C                   MOVEL     BLPLOD        DB0LOD
210220941107     C                   MOVEL     BLPCAD        DB0CAD
210230941107     C                   MOVEL     BLPFIN        DB0FIN
210240941107     C                   MOVEL     BLPNZD        DB0NZD
210250941107     C                   MOVEL     BLPPRD        DB0PRD
210260941107     C                   MOVEL     BLPRMO        DB0RMO
210270941107     C                   MOVEL     BLPGC1        DB0GC1
210280941107     C                   MOVEL     BLPGC2        DB0GC2
210290941107     C                   MOVEL     BLPNAS        DB0NAS
210300941107     C                   MOVEL     BLPNCL        DB0NCL
210310941107     C                   MOVEL     BLPPKF        DB0PKF
210320941107     C                   MOVEL     BLPVLF        DB0VLF
210330941115     C                   MOVEL     BLPFVF        DB0FVF
210340941107     C                   MOVEL     BLPFLS        DB0FLS
210350941107     C                   MOVEL     BLPNCD        DB0NCD
210360941107     C                   MOVEL     BLPNCA        DB0NCA
210370941107     C                   MOVEL     BLPXCO        DB0XCO
210380941107     C                   MOVEL     VIDNT1        DB0NT1
210390941107     C                   MOVEL     VIDNT2        DB0NT2
210400941107     C                   MOVEL     BLPFFD        DB0FFD
210410941107     C                   MOVEL     BLPDCR        DB0DCR
210420941107     C                   MOVEL     BLPTCR        DB0TCR
210430941107     C                   MOVEL     BLPHCR        DB0HCR
210440941107     C                   MOVEL     BLPFBR        DB0FBR
210450941107     C                   MOVEL     BLPGGA        DB0GGA
210460941107     C                   MOVEL     BLPGMA        DB0GMA
210470960208     C                   MOVEL     VIDGVA        DB0GVA
210480950125     C                   MOVEL     BLPSOP        DB0SOP
210490950626     C                   MOVEL     BLPCTR        DB0CTR
210500990628     C                   MOVEL     BLPDRT        DB0DRT
210510990628     C                   MOVEL     BLPNRT        DB0NRT
210520990628     C                   MOVEL     BLPPDR        DB0PDR
210530990628     C                   MOVEL     BLPFPP        DB0FPP
210540950102     C   12
210550950102     CANN15              MOVEL     'V'           DB0RIS
210560970206     C*
210570970206     C* ALLEGA BAM
210580970206     C     BLPFST        IFEQ      'S'
210590970206     C     BLPFST        OREQ      'C'
210600970206     C                   MOVEL     'S'           DB0BAM
210610970206     C                   ENDIF
210620970206     C*
210630030611     C                   CALL      WD90PSL
210640030626     C                   PARM                    fnlsb5DS
210650130318     c                   parm                    FNLSB6ds1
210660941108     C*
210670941108     C                   Z-ADD     1             I100
210680941107     C**
210690900508     C                   ENDSR
210700900511     C*
210710990701     C*--- CARICO RECORD DI MANUTENZIONE -----------------------------*
210720010215     C     CARBLP        BEGSR
210730990630     C                   SETOFF                                       22
210740990701     C                   CLEAR                   SAVNFT
210750070918     c                   clear                   s_drt
210760950206     C                   Z-ADD     KCI           CCC
210770011025      *
210780011025     C                   CLEAR                   FLGVRN
210790030204     c                   Clear                   wPkg
210800030204     c                   Clear                   wNba
210810070322     c                   clear                   wparcel
210820091221     c                   clear                   wvidgma
210830100604     c                   clear                   w7rRC
210840011025      *
210850900511     C* CHAIN
210860061212     C     KBLP3         CHAIN     FNBLP01l
210870061212     c                   if        %found(fnblp01l)
210880061218     c                   z-add     blpnrr        savnrr
210890061212     c     blpnrr        chain     fnblp00f                           90
210900950102     C     *IN90         IFEQ      *OFF
210910940927     C*
210920940927     C* DATA SPEDIZIONE
210930930414     C                   Z-ADD     BLPMGS        BLPDSP
210940930414     C                   MOVEL     BLPAAS        BLPDSP
210950000104     C                   Z-ADD     BLPMGS        WBDSP             8 0
210960000104     C                   MOVEL     BLPAAS        WBDSP
210970940927     C* DATA RITIRO MERCE
210980940927     C                   Z-ADD     BLPDRT        VIDDRT
210990081111     C                   Z-ADD     BLPDRT        s_drtblpi
211000940927     C* DATA CONSEGNA RICHIESTA
211010940927     C                   Z-ADD     BLPDCR        VIDDCR
211020940927     C*
211030960926     C* AUTOTRASPORTATORE
211040950126     C                   MOVE      BLPPDR        SAVPDR
211050990915     C                   MOVE      BLPPDR        SAVPD4
211060940928     C                   MOVE      BLPPDR        VIDPDR
211070010220     C                   MOVE      BLPPDR        PREPDR
211080990915     C                   MOVE      BLPFPP        VIDFPP
211090010220     C                   MOVE      BLPFPP        PREFPP
211100991001     C* SE ERA PREPAGATO, FACCIO ALMENO VEDERE SE MERCE PORTATA A MAG
211110991001     C                   MOVEL     BLPFDN        VIDMAG
211120900511     C*
211130900516     C                   MOVE      BLPNSP        VIDNSP
211140900511     C                   MOVEL     BLPNRS        VIDNRS
211150900511     C                   MOVEL     BLPLNP        VIDLNP
211160910805     C                   MOVEL     BLPFNS        VIDFNS            1
211170040506
211180040506      * Imposto la ds di comodo del n. spedizione
211190040506     c                   Z-add     BlpNsp        WidNsp
211200040506     c                   Z-add     BlpNrs        WidNrs
211210040506     c                   Z-add     BlpLnp        WidLnp
211220040506
211230970128     C* ALLEGA BAM
211240970128     C     BLPFST        IFEQ      'S'
211250970128     C     BLPFST        OREQ      'C'
211260970128     C                   MOVEL     'S'           VIDBAM
211270970128     C                   ELSE
211280970128     C                   MOVEL     'N'           VIDBAM
211290970128     C                   ENDIF
211300970404     C                   MOVEL     BLPFST        SAVBAM
211310940920     C* CODICE BOLLA
211320940920     C                   MOVEL     BLPCBO        VIDCBO
211330081023     C                   MOVEL     BLPCBO        cbo_blp
211340940920     C* SIGLA OPERATORE
211350940920     C                   MOVEL     BLPSOP        VIDSOP
211360900511     C* LINEA ARRIVO E DECODIFICA
211370900511     C                   MOVEL     BLPLNA        VIDLNA
211380070404     C                   MOVEL     BLPLNA        lna_sav
211390960926     C* PUNTO OPERATIVO CLIENTE
211400940927     C     BLPCCM        IFGT      0
211410940927     C                   MOVEL     BLPCCM        W0030
211420940927     C                   MOVE      BLPCCM        VIDCCM
211430940927     C                   MOVEL     BLPCCM        WKSC
211440940927     C                   ELSE
211450940927     C                   MOVEL     BLPKSC        W0030
211460940927     C                   MOVE      BLPKSC        VIDCCM
211470940927     C                   MOVEL     BLPKSC        WKSC
211480940927     C                   ENDIF
211490940927     C* SALVO IL CODICE MITTENTE
211500060515     C                   MOVEL     WKSC          bolksc
211510060515     C                   MOVEL     WKSC          SAVMIT
211520941115     C                   MOVEL     VIDCCM        WCCMS
211530940927     C* PARTITA IVA
211540940927     C                   MOVEL     BLPCPI        WPIVA
211550940929     C*
211560940929     C* VEDO SE C'E' TASSAZIONE
211570991006     C                   MOVEL     '1'           WTRC
211580991006     C     KBLP4         CHAIN     FIAR6000                           30
211590940929    1C     *IN30         IFEQ      *OFF
211600050331     c                   move      ar6ksc        wKSCsf1
211610991006     C                   MOVEL     'E'           WAR61             1
211620050331     c* se c'è cod. S.F. significa che bolla tassata in arrivo:NON DEVO
211630050331     c* CARICARLA
211640050331   1ac                   if        wKSCsf1 = 0000 or wKSCsf1 = 9999
211650940929     C*
211660991012     C                   MOVEL     AR6POR        VIDPOR
211670991012     C                   MOVEL     AR6POR        MEMPOR
211680991006     C                   MOVEL     AR6IMV        VIDIMV
211690991006     C                   MOVEL     AR6IMV        SAVIMV
211700060208     C                   MOVEL     AR6IMV        SAVIMVO
211710991006     C                   MOVEL     AR6CEI        VIDCEI
211720991008     C                   MOVEL     AR6DIV        VIDDIV
211730991011     C                   MOVEL     AR6DIV        WDIV1
211740940929     C*
211750991006     C                   MOVEL     AR6NFT        SAVNFT
211760991006     C                   MOVEL     AR6NFT        VIDNFT
211770991006     C                   MOVEL     AR6FIV        VIDFIV
211780991006     C                   MOVEL     AR6DFT        VIDDFT
211790060208     C                   MOVEL     AR6DFT        DFTar6
211800991006     C     AR6NFT        IFGT      0
211810991006     C     AR6NFT        ANDLT     §QTNFT
211820990630     C                   SETON                                        22
211830991006     C                   Z-ADD     AR6IFT        VIDIFT
211840990630     C                   ENDIF
211850991027      *
211860940929     C                   Z-ADD     0             NRR
211870011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
211880011025     C     BLPFBR        IFEQ      'S'
211890011025     C                   SELECT
211900011025     C     AR6SV1        WHENEQ    'N'
211910011025     C     AR6VA1        ANDEQ     88888888
211920011025     C                   MOVEL     '1'           FLGVRN            1
211930011025     C     AR6SV2        WHENEQ    'N'
211940011025     C     AR6VA2        ANDEQ     88888888
211950011025     C                   MOVEL     '1'           FLGVRN
211960011025     C     AR6SV3        WHENEQ    'N'
211970011025     C     AR6VA3        ANDEQ     88888888
211980011025     C                   MOVEL     '1'           FLGVRN
211990011025     C                   ENDSL
212000011025     C                   ENDIF
212010991027      *
212020991027     C                   MOVEL     AR6SV1        WSVN
212030991027     C                   Z-ADD     AR6VA1        WVAN
212040940929     C                   EXSR      CARVAR
212050991027      *
212060991027     C                   MOVEL     AR6SV2        WSVN
212070991027     C                   Z-ADD     AR6VA2        WVAN
212080940929     C                   EXSR      CARVAR
212090991027      *
212100991006    2C     AR6SV3        IFNE      ' '
212110991027     C                   MOVEL     AR6SV3        WSVN
212120991027     C                   Z-ADD     AR6VA3        WVAN
212130940929     C                   EXSR      CARVAR
212140941021     C*
212150940929     C* VISTO CHE C'E' LA 3 VARIA VEDO SE CE NE SONO ANCORA
212160991006     C                   MOVEL     '1'           WTRC
212170991006     C     KBLP4         SETLL     FIAR7000
212180991006     C     KBLP4         READE     FIAR7000                               30
212190940929    3C     *IN30         DOWEQ     *OFF
212200011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
212210011025     C     BLPFBR        IFEQ      'S'
212220011025     C     FLGVRN        ANDNE     '1'
212230011025     C     AR7SVN        ANDEQ     'N'
212240011025     C     AR7VAN        ANDEQ     88888888
212250011025     C                   MOVEL     '1'           FLGVRN
212260011025     C                   ENDIF
212270011025      *
212280991006     C                   MOVEL     'E'           WAR7              1
212290991027     C                   MOVEL     AR7SVN        WSVN
212300991027     C                   MOVEL     AR7VAN        WVAN
212310940929     C                   EXSR      CARVAR
212320991006     C     KBLP4         READE     FIAR7000                               30
212330940929    3C                   ENDDO
212340940929    2C                   ENDIF
212350940929     C*
212360941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
212370941020     C     VIDPOR        IFNE      0
212380941020     C     NRR           ORNE      0
212390941020     C     VIDCEI        ORNE      ' '
212400941020     C                   MOVEL     'S'           WEMD03            1
212410941020     C                   ENDIF
212420991006      *
212430991006     C                   CLEAR                   FIAR6000
212440050331   1ac                   endif
212450940929    1C                   ENDIF
212460941107     C* TIPO SERVIZIO
212470941107     C                   MOVEL     BLPTSP        VIDTSP
212480941107     C                   MOVEL     BLPTSP        SAVTSP
212490941115     C                   MOVEL     BLPTSP        VARTSP
212500941115     C* CONSEGNE PARTICOLARI
212510941115     C                   MOVEL     BLPTC1        VIDTC1
212520941115     C                   MOVEL     BLPTC2        VIDTC2
212530091001     c                   movel     blptc1        sav_tc1
212540091001     c                   movel     blptc2        sav_tc2
212550001205     C                   MOVEL     BLPTC1        SAVTC1
212560001205     C                   MOVEL     BLPTC2        SAVTC2
212570001205     C                   MOVEL     BLPTC1        WSVTCP
212580001205     C                   MOVEL     BLPTC1        WTCP
212590940929     C*
212600940929     C* D E C O D I F I C H E
212610940927     C                   EXSR      DECBOL
212620120926     c* se cod.bolla franco recupero e bolla presente su giacenze in part
212630120926     c* per il recupero delle spese devo disabilitare F16=Annullamento
212640120926     c* Se non voglio più addebitare le spese devono stornare la bolla
212650120926     c* dalla manutenzione bolle di sede
212660120926     c                   if        savrbl='R' and  savtb1='F'
212670120926     C/exec sql
212680120927     c+ Select gcpagc into :wagc
212690120926     c+   from tigcp00f
212700120926     c+   where GCPLPW = :BLPLNP AND GCPASW=:BLPAAS AND GCPNSW=:BLPNRS
212710120927     c+     and GCPNBW = :BLPNSP AND GCPSEDE=' '
212720120926     C/end-exec
212730120926     c                   if        SqlCOD < 0 or sqlCOD = 100
212740120926     c                   else
212750120926      * se qui : ha trovato la giacenza E DISATTIVO QUINDI F16
212760120927     c                   movel     nodi          atrann
212770120926     c                   end
212780120926     c                   endif
212790990702     C* E MANCA LA DATA RITIRO O COD PADR, MI POSIZIONO SULLA DATA
212800990702     C*  RITIRO
212810990702     C     BLPPDR        IFEQ      0
212820990702     C     BLPDRT        OREQ      0
212830990702     C                   SETOFF                                       07
212840040909     c                   z-add     09            h1riga
212850040909     c                   z-add     20            h1colo
212860990702     C                   ENDIF
212870940929     C*
212880950125     C* SALVO LA DECODIFICA DEL TIPO SPEDIZIONE
212890950125     C                   MOVEL     V1DTSP        WDETSP           10
212900940928     C* VEDO SE CARICARE IL MITTENTE O NO
212910941005     C                   MOVEL     *BLANKS       VIDFAP
212920941005    1C     VIDCCM        IFEQ      8888
212930940928     C     VIDCCM        OREQ      9999
212940940928     C                   MOVEL     BLPRSM        VIDRSM
212950940928     C                   MOVEL     BLPINM        VIDINM
212960940928     C                   MOVEL     BLPLOM        VIDLOM
212970940928     C                   MOVEL     BLPCAM        VIDCAM
212980940928     C                   MOVEL     BLPPRM        VIDPRM
212990940928     C                   MOVEL     BLPNZM        VIDNZM
213000941005     C*
213010941005   X1C                   ELSE
213020941005     C*
213030941005     C* CHAIN SU CNACO PER VEDERE SE CAP E NAZIONE DIVERSI
213040941005     C     KACO          CHAIN     CNIND000                           30
213050941005     C*
213060941005    2C     *IN30         IFEQ      *OFF
213070941005    3C     INDCAE        IFNE      BLPCAM
213080941005     C     INDSTA        ORNE      BLPNZM
213090941005     C                   MOVEL     BLPCAM        VIDCMO
213100941005     C                   MOVEL     BLPNZM        VIDNMO
213110941005    3C                   ENDIF
213120941005    2C                   ENDIF
213130941005    1C                   ENDIF
213140910429     C*
213150941005     C* CHAIN PER VEDERE SE ESISTE LA 2 DESCRIZIONE DESTINATARIO
213160940927     C                   MOVEL     'D'           WTRC
213170060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
213180940927     C* TROVATA
213190940927     C     *IN30         IFEQ      *OFF
213200060215     C                   MOVE      ar4NOT        VIDRSD
213210060215     C                   MOVE      ar4NOT        SAVRSD
213220940927     C                   ENDIF
213230900511     C                   MOVEL     BLPRSD        VIDRSD
213240910405     C                   MOVEL     BLPRSD        SAVRSD
213250900511     C                   MOVEL     BLPIND        VIDIND
213260070404     C                   MOVEL     BLPIND        savIND
213270900511     C                   MOVEL     BLPPRD        VIDPRD
213280070404     C                   MOVEL     BLPPRD        savPRD
213290910405     C                   MOVEL     BLPCAD        SAVCAD
213300910405     C                   MOVEL     BLPCAD        VIDCAD
213310940930     C                   MOVEL     BLPCAD        VARCAD
213320900511     C                   MOVEL     BLPLOD        VIDLOD
213330070404     C                   MOVEL     BLPLOD        savLOD
213340940927     C                   MOVEL     BLPNZD        VIDNZD
213350020122     C                   MOVEL     BLPNZD        NZDINI
213360911031     C                   MOVEL     BLPCTS        SAVCTS
213370941107     C* CONTROLLO SE IL CLIENTE E' ITALIA O ESTERO
213380941107     C                   MOVEL     BLPNZD        WNAR
213390941107     C                   EXSR      CTRNAR
213400941107     C* NAZIONE CORRETTA
213410941107     C     WEMFOR        IFNE      '1'
213420941107     C     §15ITA        IFEQ      'I'
213430941108     C                   MOVEL     'I'           WDESIE
213440941107     C                   ELSE
213450941108     C                   MOVEL     'E'           WDESIE
213460941107     C                   ENDIF
213470941107     C*
213480941107     C* NAZIONE ERRATA: IMPOSTO SEMPRE "I"
213490941107     C                   ELSE
213500941108     C                   MOVEL     'I'           WDESIE
213510941107     C                   ENDIF
213520941107     C*
213530941107     C* VEDO SE BOLLA ITALIANA O ESTERA
213540971216     C     BLPLNP        CHAIN     AZORG01L      UNIORG               30
213550991203     C                   MOVEL     ORGDE3        OG143
213560000121     C* MEMORIZZO TELEFONO E FAX
213570000121     C                   MOVEL     ORGTEL        LNPTEL           15
213580000121     C                   MOVEL     ORGFAX        LNPFAX           15
213590971210     C**
213600021119     c                   clear                   trul27ds
213610021119     c                   z-add     BlpPkf        I27Pkg
213620021119     c                   move      BlpCtr        I27Ctb
213630020215     c                   exsr      riccar
213640020218     c                   movel     o27fie        savfie
213650970407     C* MI SERVE PER IL CONFRONTO PER CARICARE I CODICI TARIFFA
213660970407     C     VIDCCM        IFNE      9999
213670940927     C                   MOVEL     WKSC          SAVCCM
213680970407     C                   ELSE
213690970407     C                   CLEAR                   SAVCCM
213700970407     C                   ENDIF
213710940927     C*
213720900607     C                   MOVEL     BLPCTR        VIDCTR
213730060515     C                   MOVEL     BLPCTR        BolCTR
213740971210     C* VEDO SE ESISTE NUMERO AWB SOLO PER IMPORTO SDI O EXPORT SDI
213750081008    1c**   §ogntw        ifeq      'EUP'
213760081008     c**   A_§ogntw      oreq      'EUP'
213770081008     C**                 MOVEL     'E'           WTRC
213780081008     C**   KBLP4         CHAIN(N)  Fiar4000                           30
213790081008    2C**   *IN30         IFEQ      *OFF
213800081008     C**                 MOVEL     ar4NOT        DSBL4E
213810081008     C**                 MOVEL     §B4ERP        W010A            10
213820971210     C**
213830081008    3C**   W010A         IFGT      *ZEROS
213840081008     C**                 MOVEL     §B4ERP        V6CAWB
213850081008     C**                 MOVEL     §B4ERP        SAVAWB
213860081008    3C**                 ENDIF
213870971210     C** INSERIMENTO MANUALE
213880081008     C**   §B4EMA        IFEQ      'M'
213890081008     C**                 MOVEL     'MANUALE'     V6CINS
213900081008     C**                 ENDIF
213910971210     C** INSERIMENTO AUTOMATICO
213920081008     C**   §B4EMA        IFEQ      'A'
213930081008     C**                 MOVEL     'AUTOMATI'    V6CINS
213940081008     C**                 MOVE      'CO'          V6CINS
213950081008     C**                 ENDIF
213960971210     C* STAMPATO S/N
213970081008     C**   §B4EST        IFEQ      'S'
213980081008     C**                 MOVEL     'SI'          V6CSTA
213990081008     C**                 ENDIF
214000081008    3C**   §B4EST        IFEQ      'N'
214010081008     C**                 MOVEL     'NO'          V6CSTA
214020081008    3C**                 ENDIF
214030081008    2C**                 ENDIF
214040971210     C**
214050081008    1C**                 ENDIF
214060991203      *
214070060620      * VEDO SE ESISTE NUMERO PARCEL PER IMPORT/EXPORT DPD
214080020319    1C     A_§OGNTW      IFEQ      'DPD'
214090060619    1C     §ogntw        oreq      'DPD'
214100060620     c*
214110061003     C***                MOVEL     'F'           WTRC
214120061003     C***  KBLP4         CHAIN(N)  Fiar4000                           30
214130061003    2C***  *IN30         IFEQ      *OFF
214140061003     C***                MOVEL     ar4NOT        DSBL4F
214150061003     C***                MOVEL     §B4FNP        savfnp
214160061003    2C***                ENDIF
214170060620     c*
214180060620     C                   MOVEL     'K'           WTRC
214190060620     C     KBLP4         CHAIN(N)  Fiar4000                           30
214200060620     C     *IN30         IFEQ      *OFF
214210060620     C                   MOVEL     ar4NOT        DSBL4K
214220060620     C                   MOVEL     §B4krt        savkrt
214230060620     C                   ENDIF
214240060620     c***
214250060605     C                   MOVEL     'I'           WTRC
214260060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214270991203      *
214280991203    2C     *IN30         IFEQ      *OFF
214290060605     C                   MOVEL     ar4NOT        DSBL4I
214300991203      *
214310060619     c                   if        §b4ipn<>*blanks
214320060605     C                   MOVEL     §B4ipn        V7CNPR
214330060619     c* se parcel number lungo 11 aggiungo a video anche il check digit
214340060619     c                   if        %subst(§b4ipn:14:1)=*blanks
214350060619     c                   eval      %subst(v7cnpr:12:1)=§b4icd
214360060619     c                   endif
214370060619     C                   MOVEL     v7cnpr        SAVNPR
214380991203    3C                   ENDIF
214390991203      *
214400991203    2C                   ENDIF
214410991203    1C                   ENDIF
214420941115     C*
214430941115     C* CARICO LE NOTE
214440941115     C                   MOVEL     '8'           WTRC
214450060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214460941115     C* TROVATA
214470941115     C     *IN30         IFEQ      *OFF
214480060215     C                   MOVEL     ar4NOT        VIDNT1
214490941115     C*
214500941115     C                   MOVEL     '9'           WTRC
214510060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214520941115     C* TROVATA
214530941115     C     *IN30         IFEQ      *OFF
214540060215     C                   MOVEL     ar4NOT        VIDNT2
214550941115     C                   ENDIF
214560000124     C                   ENDIF
214570000124     C**
214580000124     C* SE LA PRIMA NOTA E' MESSA IN AUTOMATICO, LA CLEARO
214590000124     C                   MOVEL     VIDNT1        W012A            12
214600000124     C*
214610000124     C     W012A         IFEQ      CDPD
214620000124     C                   CLEAR                   VIDNT1
214630000124     C     VIDNT2        IFNE      *BLANKS
214640000124     C                   MOVEL     VIDNT2        VIDNT1
214650000124     C                   CLEAR                   VIDNT2
214660000124     C                   ENDIF
214670000124     C                   ENDIF
214680000623     C***
214690060216     C* VEDO SE CE' RECORD ar4 W
214700000623     C                   MOVEL     'W'           WTRC
214710060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214720000623     C  N30              MOVEL     'E'           WBL4W             1
214730121123     C***
214740121123     C* VEDO SE CE' RECORD ar4 Z
214750121123     c                   clear                   wesar4z
214760121123     c                   clear                   wtrasmz
214770121123     c                   clear                   wkscz
214780121123     C                   MOVEL     'Z'           WTRC
214790121123     C     KBLP4         CHAIN(N)  Fiar4000                           30
214800121123     c                   if        not *in30
214810121123     C                   MOVEL     'S'           Wesar4z           1
214820121123     C                   MOVEL     AR4NOT        DSBL4Z
214830121123     c                   if        §B4DTR=0
214840121123     C                   EVAL      WTRASMz='N'
214850121123     C                   ENDIF
214860121123     c                   move      §b4okc        wkscz
214870121123     c                   endif
214880061110     c*
214890061110     C* CARICO il codice fiscale se presente
214900061110     C                   MOVEL     'Q'           WTRC
214910061110     C     KBLP4         CHAIN(N)  Fiar4000                           30
214920061110     C     *IN30         IFEQ      *OFF
214930061110     c                   movel     ar4not        vidcdf
214940061110     c                   endif
214950950410     c*
214960950410     C* CARICO LE P.IVA MITTENTE E DESTINATARIO
214970950410     C                   MOVEL     'P'           WTRC
214980060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
214990950410     C     *IN30         IFEQ      *OFF
215000950410     C*
215010060215     C                   MOVEL     ar4NOT        WPIVA
215020050921     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
215030050921     c                   select
215040050921     c* solo numeri
215050050921     c* "PRIVATO senza iso
215060050921     c     *in30         wheneq    *off
215070050921     c     wiso          andge     *zeros
215080050921     c     *in30         oreq      *on
215090050921     c     posiz         andlt     3
215100050921     c                   movel     wpiva         vidcpm
215110050921     c* iso + numeri
215120050921     c* iso + "PRIVATO"
215130050921     c     *in30         wheneq    *off
215140050921     c     posiz         orgt      2
215150050921     c                   movel     wpiva         vidpim
215160050921     c                   endsl
215170050921     c
215180950410     C*
215190060215     C                   MOVE      ar4NOT        WPIVA
215200050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
215210050921     c                   select
215220050921     c* solo numeri
215230050921     c* "PRIVATO senza iso
215240050921     c     *in30         wheneq    *off
215250050921     c     wiso          andge     *zeros
215260050921     c     *in30         oreq      *on
215270050921     c     posiz         andlt     3
215280050921     c                   movel     wpiva         vidcpd
215290050921     c* iso + numeri
215300050921     c* iso + "PRIVATO"
215310050921     c     *in30         wheneq    *off
215320050921     c     posiz         orgt      2
215330050921     c                   movel     wpiva         vidpid
215340050921     c                   endsl
215350950410     C*
215360950410     C                   ENDIF
215370900607     C*
215380900604     C* FLAG INOLTRO PULISCO SE NON E' UNA ISOLA
215390900604     C                   MOVEL     ' '           VIDFIN
215400941115     C                   MOVEL     BLPFBR        VIDFBR
215410941115     C                   MOVEL     BLPGC1        VIDGC1
215420900511     C                   MOVEL     BLPGC2        VIDGC2
215430900511     C                   MOVEL     BLPFTM        VIDFTM
215440940927     C                   MOVEL     BLPIAS        VIDIAS
215450940927     C                   MOVEL     BLPVAS        VIDVAS
215460950410     C                   MOVEL     BLPVAS        VARVAS
215470940927     C                   MOVEL     BLPVMD        VIDVMD
215480940927     C                   MOVEL     BLPVAD        VIDVAD
215490950410     C                   MOVEL     BLPVAD        VARVAD
215500940927     C                   MOVEL     BLPQFT        VIDQFT
215510940928     C                   MOVEL     BLPGGA        VIDGGA
215520940928     C                   MOVEL     BLPGMA        VIDGMA
215530091221     c                   eval      wvidgma = blpgma
215540100604     c* Verifico se c'e' ritiro contestuale alla consegna
215550100604     c                   clear                   ds7r
215560100604     C                   MOVEL     '7R'          COD
215570100604     C                   MOVEL(P)  blpGMA        KEY
215580100604     C                   EXSR      CTABEL
215590100604     C  n30              MOVEL     TBLUNI        DS7R
215600100604     c                   eval      w7rRC = §7rRC
215610100604     c
215620960208     C                   CLEAR                   VIDGVA
215630960208     C                   MOVEL     BLPGVA        W001A
215640960208     C                   MOVEL     W001A         VIDGVA
215650900511     C                   MOVEL     BLPNAS        VIDNAS
215660900511     C                   MOVEL     BLPNCL        VIDNCL
215670940819     C                   MOVEL     BLPNCL        V1CNCL
215680930331     C                   MOVEL     BLPNCL        SAVNCL
215690980408     C                   MOVE      BLPNCD        SAVNCD
215700980408     C                   MOVE      BLPNCA        SAVNCA
215710940927     C                   MOVEL     BLPPKB        VIDPKG
215720940927     C                   MOVEL     BLPPKB        V2CPKG
215730980402     C                   MOVEL     BLPPKB        SAVPKG
215740940927     C                   MOVEL     BLPVLB        VIDVOL
215750980402     C                   MOVEL     BLPVLB        SAVVOL
215760090609     c                   movel     blppkb        wpes_pre
215770090609     c                   movel     blpvlb        wvol_pre
215780090609     C                   MOVEL     BLPNCL        wncl_pre
215790930512     C* VEDO RAGGRUPPAMENTO DEL VOLUME
215800940928     C                   MOVEL     BLPFVB        VIDFVR            1
215810930512     C                   MOVEL     '7T'          COD
215820940928     C                   MOVEL(P)  BLPFVB        KEY
215830930708     C                   EXSR      CTABEL
215840930512     C  N30              MOVEL     TBLUNI        DS7T
215850930708     C   30              CLEAR                   DS7T
215860910125     C*
215870900511     C                   MOVEL     BLPRMN        VIDRMN
215880060619     C******             MOVEL     BLPRMN        savrmn
215890940825     C                   MOVEL     BLPRMA        VIDRMA
215900940922     C                   MOVEL     BLPRMA        SAVRMA
215910900511     C                   MOVEL     BLPRMO        VIDRMO
215920900511     C                   MOVEL     BLPNCD        VIDNCD
215930900511     C                   MOVEL     BLPNCA        VIDNCA
215940960808     C                   MOVEL     BLPNCD        WNSNCD
215950960808     C                   MOVEL     BLPNCA        WNSNCA
215960900511     C                   MOVEL     BLPZNC        VIDZNC
215970930401     C                   MOVEL     BLPZNC        VARZNC
215980930402     C                   MOVEL     BLPZNC        SAVZNC
215990900511     C                   MOVEL     BLPCTM        VIDCTM
216000900511     C                   MOVEL     BLPFFD        VIDFFD
216010930401     C                   MOVEL     BLPFFD        VARFFD
216020010214     C     BLPFFD        IFEQ      *BLANKS
216030010214     C                   MOVEL     'N'           VIDFFD
216040010214     C                   MOVEL     'N'           VARFFD
216050010214     C                   ENDIF
216060910114     C*
216070900516     C                   MOVEL     BLPNFV        VIDNFV
216080910114     C                   MOVEL     BLPTCR        VIDTCR
216090940927     C                   MOVEL     BLPHCR        VIDHCR
216100940927     C                   MOVE      BLPHCR        VIDMCR
216110900516     C* GIRO DATA BORDERO
216120940927     C                   CLEAR                   WLBDAT
216130950107     C                   MOVEL     '3'           G02ERR
216140940927     C                   Z-ADD     BLPDBR        G02INV
216150940927     C                   CALL      'XSRDA8'
216160940927     C                   PARM                    WLBDAT
216170940927     C                   Z-ADD     G02DAT        VIDDBR
216180940928     C* VEDO SE ESISTE C/A
216190940928     C     §3AFCA        IFNE      0
216200051115     C     KBLP3         CHAIN     Fiar9000                           30
216210940928     C     *IN30         IFEQ      *OFF
216220051115     C                   MOVEL     'E'           War9              1
216230051115     C                   Z-ADD     ar9CAS        VIDCAS
216240051115     C                   MOVEL     ar9TIC        VIDTIC
216250051115     C                   MOVEL     ar9GCA        VIDGCA
216260051115     C                   MOVEL     ar9VCA        VIDVCA
216270051115     C                   MOVEL     ar9VCA        VARVCA
216280940928     C                   ENDIF
216290940928     C                   ENDIF
216300940928     C*
216310900517     C* SE ESISTE AGGANCIO 2° BOLLA
216320991006     C                   MOVEL     '2'           WTRC
216330991006     C     KBLP4         CHAIN     FIAR6000                           30
216340940927    1C     *IN30         IFEQ      *OFF
216350050331     c                   move      ar6ksc        wKSCsf2
216360991006     C                   MOVEL     'E'           WAR62             1
216370040114
216380050331   1ac                   if        wKSCsf2 = 0000 or wKSCsf2 = 9999
216390040114     c                   Z-add     Ar6Va1        Vi2Va1
216400040116     c                   Z-add     Ar6Va1        Va2va1
216410991006     C                   MOVEL     AR6SV1        VI2SV1
216420040114     c                   Z-add     Ar6Va2        Vi2Va2
216430040114     c                   Z-add     Ar6Va2        Va2Va2
216440040114     c                   Movel     Ar6Sv2        Vi2Sv2
216450040114     c                   Z-add     Ar6Va3        Vi2Va3
216460040114     c                   Z-add     Ar6Va3        Va2Va3
216470040114     c                   Movel     Ar6Sv3        Vi2Sv3
216480040126     c                   Z-add     Ar6Imv        Vi2Imv
216490040114      * Vedo se ci sono altre varie su FIAR7
216500040114     c                   Eval      wtrc = '2'
216510041217     c                   clear                   contasv
216520040114     c     Kblp4         Setll     Fiar7000
216530040114     c                   Do        *Hival
216540040114     c     Kblp4         Reade     Fiar7000
216550040114     c                   If        %Eof(Fiar701l)
216560040114     c                   Leave
216570040114     c                   EndIf
216580040114     c                   Eval      war71 = 'E'
216590041217     c                   select
216600041217     c                   when      contasv = 0
216610040114     c                   Movel     Ar7Svn        Vi2Sv4
216620040114     c                   Z-add     Ar7Van        Vi2Va4
216630040114     c                   Z-add     Ar7Van        Va2Va4
216640041217     c                   add       1             contasv
216650041217     c                   when      contasv = 1
216660041217     c                   Movel     Ar7Svn        Vi2Sv5
216670041217     c                   Z-add     Ar7Van        Vi2Va5
216680041217     c                   Z-add     Ar7Van        Va2Va5
216690041217     c                   add       1             contasv
216700041217     c                   when      contasv = 2
216710041217     c                   Movel     Ar7Svn        Vi2Sv6
216720041217     c                   Z-add     Ar7Van        Vi2Va6
216730041217     c                   Z-add     Ar7Van        Va2Va6
216740040114     c                   Leave
216750041217     c                   endsl
216760040114     c                   EndDo
216770040114
216780991006     C                   MOVEL     AR6CEI        VI2CEI
216790991008     C                   MOVEL     AR6DIV        VI2DIV
216800991011     C                   MOVEL     AR6DIV        WDIV2
216810940927     C* SE ESISTE ESENZIONE IVA DECODIFICO
216820991006    2C     VI2CEI        IFNE      *BLANKS
216830940927     C                   MOVEL     'EI'          COD
216840940927     C                   MOVEL(P)  VI2CEI        KEY
216850940927     C                   EXSR      CTABEL
216860940927     C  N30              MOVEL     TBLUNI        V2DCEI
216870940927    2C                   ENDIF
216880980120     C**
216890050407     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
216900050407     C     VI2imv        IFNE      0
216910050407     C     vi2va1        ORNE      0
216920050407     C     vi2va2        ORNE      0
216930050407     C     vi2va3        ORNE      0
216940050407     C     vi2va4        ORNE      0
216950050407     C     vi2va5        ORNE      0
216960050407     C     vi2va6        ORNE      0
216970050407     C     VI2CEI        ORNE      ' '
216980050407     C                   MOVEL     'S'           WEMD03            1
216990050407     C                   ENDIF
217000050407     c*
217010991006     C                   CLEAR                   FIAR6000
217020050331   1ac                   endif
217030940927    1C                   ENDIF
217040941011     C*
217050941011     C* METTO IL NUMERO DI SPEDIZIONE IN 1 VIDEATA
217060941011     C                   Z-ADD     BLPNRS        PRENRS
217070941011     C                   Z-ADD     BLPNSP        PRENSP
217080941011     C                   MOVEL     BLPLNA        PRELNA
217090941011     C                   Z-ADD     BLPRMN        PRERMN
217100941011     C                   Z-ADD     BLPZNC        PREZNC
217110000913     C*
217120000913     C* SE DISK C CARICO COD.CHI SONO NEL SUBFILE
217130000913     C                   SETOFF                                       96
217140000918     C* PRENDO CTM
217150000918     C                   MOVE      '1B'          COD
217160000918     C                   MOVEL(P)  VIDCTM        KEY
217170000918     C                   EXSR      CTABEL
217180000918     C  N30              MOVEL     TBLUNI        DS1B
217190000918     C   30              CLEAR                   DS1B
217200000918     C*
217210000913    2C     §1BF12        IFNE      'N'
217220020319     C     A_§OGNTW      ANDNE     'DPD'
217230050228     c     §ogntw        andne     'DPD'
217240001009     C     §1BF12        ORNE      'N'
217250020319     C     A_§OGNTW      ANDEQ     'DPD'
217260001009     C     §1BF13        ANDEQ     'A'
217270000913     C* Attivo F22=Manutenzione cod."Chi Sono"
217280000913     C                   SETON                                        96
217290000913     C                   MOVEL     'C'           WTRC
217300000913     C                   Z-ADD     0             NR8
217310120817     C**   KBLT1         SETLL     FNBLT01L
217320120817     C**   KBLT1         READE(N)  FNBLT01L                               30
217330120817     C     KBLT1         SETLL     FIART01L
217340120817     C     KBLT1         READE(N)  FIART01L                               30
217350000913    3C     *IN30         DOWEQ     *OFF
217360120817     C***  KARS1         CHAIN(N)  FIARS01L                           30
217370120817     C     KARS1A        CHAIN(N)  FIARS01L                           30
217380051102     C  N30              EXSR      CARARS
217390120817     C**   KBLT1         READE(N)  FNBLT01L                               30
217400120817     C     KBLT1         READE(N)  FIART01L                               30
217410000913    3C                   ENDDO
217420000913     C     NR8           IFGT      0
217430000913     C                   SETON                                        78
217440000913     C                   ENDIF
217450000918     C                   Z-ADD     NR8           SAVNR8
217460000913    2C                   ENDIF
217470070322     c* se bolla export dpd con numero parcel non automatico verifico
217480070322     c* se chi sono diverso dal numero parcel ed in questo caso memoriz
217490070323     c* zo nel subfile ma non abilito l'f22
217500070322     C     §1BF12        ifNE      'N'
217510070322     C     A_§OGNTW      ANDEQ     'DPD'
217520070322     C     §1BF13        ANDne     'A'
217530070322     C                   Z-ADD     0             NR8
217540070322     C                   MOVEL     'C'           WTRC
217550120817     C***  KBLT1         chain(N)  FNBLT01L
217560120817     c***                if        %found(fnblt01l)
217570120817     C***  KARS1         CHAIN(N)  FIARS01L
217580120817     C     KBLT1         chain(N)  FIART01L
217590120817     c                   if        %found(fiart01l)
217600120817     C     KARS1A        CHAIN(N)  FIARS01L
217610070322     c                   if        %found(fiars01l)
217620070322     c                             and arsnot<>v7cnpr
217630070322     c                   exsr      carars
217640070322     c                   eval      wparcel='12'
217650070322     C                   SETON                                        78
217660070322     c                   endif
217670070322     c                   endif
217680070322     C                   Z-ADD     NR8           SAVNR8
217690070322     c                   endif
217700010209     C* PRENDO NUMERO ORM SE PRESENTE
217710010209     C                   MOVEL     'M'           WTRC
217720060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
217730060215     C  N30              MOVEL     ar4NOT        DSBL4M
217740010209     C   30              CLEAR                   DSBL4M
217750061122     c                   movel     dsbl4m        S_dsbl4m
217760010209     C                   Z-ADD     §B4POE        VIDPOE
217770010222     C                   MOVEL     §B4NSR        VIDNOR
217780010222     C                   MOVE      §B4NOR        VIDNOR
217790010209     C                   Z-ADD     §B4NRV        VIDNRV
217800010215     C                   MOVEL     VIDORM        W01ORM
217810011126     C                   MOVEL     '1'           WOVUO
217820070427     C                   MOVEL     '1'           WOVUO1
217830011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
217840011126     C                   Z-ADD     VIDPOE        WOPOE
217850011126     C                   Z-ADD     VIDNOR        WONOR
217860011126     C                   Z-ADD     VIDNRV        WONRV
217870091008
217880011126     C                   CLEAR                   DORM01
217890090327     c                   clear                   s_ormksc
217900090327     c                   clear                   s_ormctr
217910011126     C     KORM          CHAIN     FNORM01L                           30
217920011126     C  N30              MOVEL     ORMFLO        DORM01
217930090327     c  n30              z-add     ormksc        s_ormksc
217940090327     c  n30              move      ormctr        s_ormctr
217950011126     C     §ORMFD        IFEQ      'S'
217960011126     C                   MOVEL     PROT          ATRDES
217970011126     C                   ELSE
217980011126     C                   CLEAR                   ATRDES
217990011126     C                   ENDIF
218000021218      * Aggancio file estensione Fiar500f record "BAN" per recuperare i
218010021218      * bancali
218020030704     c                   If        %subst(VidGva:1:1) = 'B'
218030021218     c                   Clear                   DAr5Ban
218040030704     c                   Eval      kAr5Trd = 'BAN'
218050021218     c     KFiar5        Chain(n)  Fiar501l
218060021218     c                   If        %Found(Fiar501l)
218070021218     c                   Movel     Ar5Uni        DAr5Ban
218080021218     c                   EndIf
218090021220     c                   If        §Ar5Tba > *Zeros
218100021218     c                   Movel     §Ar5Tba       VidTba
218110021220     c                   EndIf
218120021218     c                   Eval      VidNba = §Ar5Nba
218130030204     c                   Eval      SavNba = §Ar5Nba
218140021220     c                   If        §Ar5Tb2 > *Zeros
218150021220     c                   Movel     §Ar5Tb2       VidTb2
218160021220     c                   EndIf
218170021218     c                   Eval      VidNb2 = §Ar5Nb2
218180030204     c                   Eval      SavNb2 = §Ar5Nb2
218190030704     c                   EndIf
218200030704
218210030704      * Aggancio file estensione Fiar500f record "BNB" per recuperare i
218220030704      * bancali e i colli originali
218230030704     c                   If        %subst(VidGva:1:1) = 'O'
218240030704     c                   Clear                   DAr5Bnb
218250030704     c                   Eval      kAr5Trd = 'BNB'
218260030704     c     KFiar5        Chain(n)  Fiar501l
218270030704     c                   If        %Found(Fiar501l)
218280030704     c                   Movel     Ar5Uni        DAr5Bnb
218290030704     c                   EndIf
218300030704     c                   If        §Ar5bTba > *Zeros
218310030704     c                   Movel     §Ar5bTba      VidTba
218320030704     c                   EndIf
218330030704     c                   Eval      VidNba = §Ar5bNba
218340030704     c                   Eval      SavNba = §Ar5bNba
218350030704     c                   If        §Ar5bTb2 > *Zeros
218360030704     c                   Movel     §Ar5bTb2      VidTb2
218370030704     c                   EndIf
218380030704     c                   Eval      VidNb2 = §Ar5bNb2
218390030704     c                   Eval      SavNb2 = §Ar5bNb2
218400030704     c                   Eval      w03cor = §Ar5bCor
218410030704     c                   Eval      w03csf = §Ar5bCsf
218420030708     c                   Eval      savw03cor = §Ar5bCor
218430030708     c                   Eval      savw03csf = §Ar5bCsf
218440030704     c                   EndIf
218450031113      * Aggancio file estensione Fiar500f record "GEN" per recuperare
218460040610      * il referente e il telefono e v-valore
218470031113     c                   Clear                   DAr5Gen
218480091001     c                   clear                   w_ar5tcp
218490031114     c                   Eval      kAr5Trd = 'GEN'
218500031113     c     KFiar5        Chain(n)  Fiar501l
218510031113     c                   If        %Found(Fiar501l)
218520031113     c                   Movel     Ar5Uni        DAr5Gen
218530031113     c                   EndIf
218540031113     c                   Eval      VidRef = §Ar5Ref
218550031113     c                   Eval      VidTel = §Ar5Teld
218560040610     c                   Eval      Vidbva = §Ar5bva
218570050421     c                   eval      savbva = §ar5bva
218580091001     c                   eval      w_ar5tcp=§ar5tcp
218590091211     c                   eval      nochkticC=*off
218600091112     c* window scelta beneficiario contrassegno: se presente codice su
218610091112     c* fiar5 rek gen imposto opportunamente campo scelta beneficiario C/A
218620091118     c                   if        dateu>=§vpocas
218630091119     c                   if        §ar5cdi<>*blanks
218640091112     c                   eval      wcassel2='X'
218650091211     c                   eval      nochkticC=*on
218660091112     c                   else
218670091127     C                   CLEAR                   DS1a
218680091127     c                   if        vidtic<>*blanks
218690091127     C                   MOVEL     '1A'          COD
218700091127     C                   MOVEL(P)  vidtic        KEY
218710091127     C                   EXSR      CTABEL
218720091127     C  N30              MOVEL     TBLUNI        DS1a
218730091127     c                   endif
218740091112     c                   if        §3afca<>0 and *in04 and widor1>0
218750091112     c                             and ormpag='O'
218760091204     c                             and §1amro<>'S'
218770091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
218780091112     c                                 %editc(ormksc:'X')
218790091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
218800091112     c                                 %subst(%editc(ormcor:'X'):1:7)
218810091112     c                   eval      wcassel1='X'
218820091211     c                   eval      nochkticC=*on
218830091112     c                   endif
218840091112     c                   endif
218850091118     c                   endif
218860110512      * Aggancio file estensione Fiar500f record "EMD" per recuperare indirizzo
218870130315      * email destinatario e numero di telefono per sms
218880110512     c                   Clear                   DAr5emd
218890110512     c                   Eval      kAr5Trd = 'EMD'
218900110512     c     KFiar5        Chain(n)  Fiar501l
218910110512     c                   If        %Found(Fiar501l)
218920110512     c                   Movel     Ar5Uni        DAr5Emd
218930110512     c                   Eval      wemdest = §Ar5eml
218940130315     c                   if        wemdest<>*blanks
218950110512     c                   clear                   atremd
218960130315     c                   endif
218970130315     c                   Eval      wsms    = §Ar5tel
218980130315     c                   Eval      wsmp    = §Ar5smp
218990110512     c                   EndIf
219000110706     C* Aggancio fiar4 record "4" perr recuperare codici cup e cig
219010110706     C                   MOVEL     '4'           WTRC
219020110706     C     KBLP4         CHAIN(N)  Fiar4000                           30
219030110706     C  N30              MOVEL     ar4NOT        DSBL44
219040110706     C   30              CLEAR                   DSBL44
219050110706     c                   if        §b44cup<> *blanks or §b44cig<>*blanks
219060110706     c                   movel     §b44cup       wcupcup
219070110706     c                   movel     §b44cig       wcupcig
219080110706     c                   endif
219090090326     C* Manutenzione bolle: se sono in manutenzione bolle devo eventualmente
219100090326     c* completare la videata prendendo ksc/ctr memorizzati su data base
219110090326     c* se bolla avente sigla operatore presente in tabella 3M proteggo sempre
219120090326     c* perchè potebbe trattarsi di codici inseriti in automatico in fase di
219130090326     c* bolettazione in quanto passati da chiamante
219140090326     c                   if        *in04
219150090326     c                   exsr      sr_daar4a
219160090326     c                   endif
219170091112     c
219180000913     C*
219190950102     C                   ENDIF
219200061212     C                   ENDIF
219210900511     C                   ENDSR
219220011025     C*
219230011025      *--- TASSAZIONE VARIA 'N' --------------------------------------*
219240011025     C     TASSAN        BEGSR
219250011025      *
219260011025     C                   CLEAR                   DTAS
219270011025     C                   CLEAR                   DTASV
219280011025     C                   Z-ADD     BLPKSC        TASKSC
219290011025     C                   Z-ADD     BLPCTR        TASCTR
219300011025     C                   Z-ADD     BLPPKF        TASPKF
219310011025     C                   MOVEL     BLPLNP        TASLNP
219320011025     C                   MOVEL     BLPCTS        TASCTS
219330011025     C                   MOVEL     BLPDSP        TASDSP
219340011025     C                   MOVEL     BLPDSP        TASDCT
219350011025     C                   MOVEL     BLPVLF        TASVLF
219360011025     C                   MOVEL     BLPTSP        TASTSP
219370011025     C     WBOL          IFEQ      '1'
219380011025     C                   MOVEL     §3ATB1        TASTBL
219390011025     C                   ELSE
219400011025     C                   MOVEL     §3ATB2        TASTBL
219410011025     C                   ENDIF
219420011025     C                   MOVEL     BLPLNA        TASLNA
219430011025     C                   MOVEL     BLPNCL        TASNCL
219440011025     C                   MOVEL     BLPQFT        TASQFT
219450011025     C     WBOL          IFEQ      '1'
219460011025     C     §3AFCA        ANDEQ     1
219470011025     C     WBOL          OREQ      '2'
219480011025     C     §3AFCA        ANDEQ     2
219490051115     C                   MOVEL     ar9CAS        TASCAS
219500051115     C                   MOVEL     ar9VCA        TASVCA
219510051115     C                   MOVEL     ar9TIC        TASTIC
219520011025     C                   ENDIF
219530011025     C                   MOVEL     BLPIAS        TASIAS
219540011025     C                   MOVEL     BLPVAS        TASVAS
219550011025     C                   MOVEL     BLPCAD        TASCAD
219560011025     C                   MOVEL     BLPNZD        TASNZD
219570011025     C                   MOVEL     BLPFIN        TASFIN
219580011025     C                   MOVEL     BLPCAM        TASCAM
219590011025     C                   MOVEL     BLPNZM        TASNZM
219600011025     C                   MOVEL     BLPFAP        TASFAP
219610011025     C                   MOVEL     BLPTC1        TASTC1
219620011025     C                   MOVEL     BLPTC2        TASTC2
219630011025     C     BLPFST        IFEQ      'S'
219640011025     C     BLPFST        OREQ      'C'
219650011025     C                   MOVEL     'S'           TASDDT
219660011025     C                   ELSE
219670011025     C                   MOVEL     'N'           TASDDT
219680011025     C                   ENDIF
219690061002     c*****              movel     blpfbr        §tasflo
219700061002     c* Passo nella DTAS01 il blpfbr
219710061002     c                   clear                   dtas01
219720061002     c                   movel     blpfbr        §asfbr
219730061002     c                   movel(P)  dtas01        §tasflo
219740011025      **
219750011025      * SE BOLLA EXPORT--> NON PASSO MAI IL FLAG CONSEGNA A MAGAZZINO
219760011025      *                    IN MODO CHE TASSI SEMPRE LA VARIA 'U'
219770020219     C     A_§ogntw      ifeq      'COR'
219780020219     c     A_§ogntw      oreq      'MES'
219790020219     c     A_§ogntw      oreq      'PPT'
219800011025     C                   MOVEL     BLPFDN        TASFDN
219810011025     C                   ENDIF
219820011025      **
219830011025      * CHAIN SU CAPPARIO PER PRENDERE COD TASSAZIONE MITTENTE
219840011025     C                   CLEAR                   DSSI95
219850011025     C                   MOVEL     BLPLOM        I95LOC
219860011025     C                   MOVEL     BLPCAM        I95CAP
219870011025     C                   MOVEL     BLPNZM        I95NAR
219880011025     C                   MOVEL     '3'           I95TCN
219890011025     C                   MOVEL     BLPDSP        I95DAT
219900011025     C     §3AFCA        IFNE      0
219910011025     C                   MOVEL     'S'           I95FCA
219920011025     C                   ENDIF
219930011025     C                   MOVEL     §3ATB1        I95TPO
219940020305     c* se network fedex passo flag apposito per dire di prendere i dati
219950020305     c* dalla tabella della nazione
219960020305     c     §ogntw        ifeq      'FED'
219970020305     c                   movel     'S'           i95fi1
219980020305     c                   endif
219990011025     C                   CALL      'TISI95R'
220000011025     C                   PARM                    DSSI95
220010011025     C     O95ERR        IFEQ      *BLANKS
220020011025     C                   MOVEL     O95CTS        TASMCT
220030011025     C                   ENDIF
220040011025     C                   MOVEL     'S'           WCAL13            1
220050020218      * ELABORO E CHIUDO CON RT IL PGM
220060011025     C                   MOVEL     ' '           TASTLA
220070011212     C* DATA TASSAZIONE = 0    : SE STO TASSANDO LA VARIA "N" NON E'
220080011121     C*                          POSSIBILE CHE LA BOLLA SIA GIA' FATTU-
220090011121     C*                          RATA
220100021002     c* imposto peso vdl e colli rilevati
220110030204     c                   z-add     blpncp        Tasncp
220120030204     c                   z-add     blppkc        Taspkc
220130030204      * Bancali
220140030205If  1c                   If        %Subst(VidGva:1:1) ='B'
220150030204     c                   Eval      TasBan = VidNba + VidNb2
220160030205     c                   EndIf
220170030728      * Colli originali
220180030728If  1c                   If        %Subst(VidGva:1:1) ='O'
220190030728     c                   Eval      TasNcl = W03Cor
220200030728     c                   EndIf
220210011025      *
220220011025     C                   CALL      'TNSF20R'
220230011025     C                   PARM                    KPJBA
220240011025     C                   PARM                    DTAS
220250011025     C                   PARM                    DTASV
220260011025      *
220270011025      * Tassazione andata buon fine
220280011025     C     TASERR        IFEQ      *BLANKS
220290011025      *
220300011025      * Controllo la divisa della tassazione con la divisa del video
220310011025      * se non corrispondono devo convertire la varia 'N' nella divisa
220320011025      * del video
220330011025     C     TASDIV        IFNE      VIDDIV
220340011025      * aggancio la tabella CV per sicurezza
220350011025     C                   CLEAR                   DSCV
220360011025     C                   MOVEL     'CV'          COD
220370011025     C                   MOVEL(P)  VIDDIV        KEY
220380011025     C                   EXSR      CTABEL
220390011025     C  N30              MOVEL     TBLUNI        DSCV
220400011025      *
220410011025     C                   CLEAR                   DSYEUR
220420011025     C                   MOVEL     TASDIV        YECDVI
220430011025     C                   MOVEL     VIDDIV        YECDVO
220440011025     C                   Z-ADD     TASIMV        YECIMI
220450011025     C     §CVFDC        IFEQ      'S'
220460011025     C                   MOVE      '3'           YECDCO
220470011025     C                   ELSE
220480011025     C                   MOVE      '0'           YECDCO
220490011025     C                   ENDIF
220500011025     C                   CALL      'YEURCO'
220510011025     C                   PARM                    DSYEUR
220520011025     C     YECESI        IFEQ      ' '
220530011025     C                   Z-ADD     YECIMO        TASIMV
220540011025     C                   ELSE
220550011025     C                   Z-ADD     88888888      TASIMV
220560011025     C                   ENDIF
220570011025     C                   ENDIF
220580011025      *
220590011025     C                   Z-ADD     TASIMV        V3CVA1
220600011025     C                   ENDIF
220610011025      *
220620011025     C                   ENDSR
220630901031     C*
220640901031     C*--- TASSAZIONE BOLLA ------------------------------------------*
220650901031     C     TASSAZ        BEGSR
220660991012      *
220670991007     C                   CLEAR                   DTAS
220680020503     C                   CLEAR                   WTASSA            1
220690030623     C                   CLEAR                   WTASSAD           1
220700030623     C                   CLEAR                   ITASSA           11 3
220710941219     C*
220720941219     C                   MOVEL     VIDCTR        TASCTR
220730990701     C* SE E' FRANCO CODIFICATO SEMPRE CODICE CLIENTE
220740941219    1C     *IN04         IFEQ      *OFF
220750941219     C                   MOVEL     WKSC          TASKSC
220760990701     C* PER 8888 IMPOSTO LA TARIFFA DI TASSAZIONE DEI PREPAGATI
220770990701   1AC     VIDCCM        IFEQ      8888
220780990610     C*
220790990610     C* PER PREPAGATI CERCO LA TARIFFA GIUSTA
220800020117      *
220810020117      * Non più, prendere sempre la tariffa di cartello
220820990610     C**
220830020218     c                   z-add     o27ksc        tasksc
220840020218     c                   z-add     o27ctr        tasctr
220850990610     C**
220860990701   1AC                   ENDIF
220870990701    1C                   ENDIF
220880941219     C*
220890941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
220900941219    1C     *IN04         IFEQ      *ON
220910991007      *
220920941219    2C     SAVFTM        IFEQ      'S'
220930941219     C     VIDFTM        OREQ      'S'
220940941219     C                   MOVE      WKSC          TASKSC
220950941219   X2C                   ELSE
220960941219     C*
220970941219     C* SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
220980941219     C                   MOVEL     COMLNA        TASKSC
220990941219     C                   MOVE      9999          TASKSC
221000941219     C                   Z-ADD     0             TASCTR
221010941219    2C                   END
221020941219    1C                   END
221030941219     C                   MOVEL     VIDCAM        TASCAM
221040991014     C                   MOVEL     VIDNZM        TASNZM
221050990610    1C     APDFCM        IFNE      ' '
221060941230     C                   MOVEL     'C'           TASFAP
221070941230     C                   ELSE
221080941230     C                   MOVEL     COMFAP        TASFAP
221090990610    1C                   END
221100941219     C*
221110941219     C* FLAG INOLTRO
221120990610    0C     *IN90         IFEQ      *OFF
221130990610     C*
221140941219     C                   EXSR      INOLTR
221150941219     C                   MOVEL     WFIN          TASFIN
221160941219     C                   MOVEL     VIDCAD        TASCAD
221170991014     C                   MOVEL     VIDNZD        TASNZD
221180941219     C*
221190941219     C                   Z-ADD     V2CPKG        TASPKF
221200941219     C                   MOVEL     VIDLNP        TASLNP
221210941219     C                   MOVEL     SAVCTS        TASCTS
221220941219     C*
221230941219     C                   MOVEL     BLPDSP        TASDSP
221240970414     C                   MOVEL     BLPDSP        TASDCT
221250941219     C                   MOVEL     VARVOL        TASVLF
221260941219     C     VIDTSP        IFNE      *BLANKS
221270941219    1C                   MOVEL     VIDTSP        TASTSP
221280941219     C                   ELSE
221290941219     C* LO PRENDO DA TARIFFA
221300941219     C                   MOVEL     COMTSP        TASTSP
221310941219    1C                   ENDIF
221320941219     C* SE E' ANCORA VUOTO, IMPOSTO "C"
221330941219    1C     TASTSP        IFEQ      ' '
221340941219     C                   MOVEL     'C'           TASTSP
221350941219    1C                   ENDIF
221360980512     C     WBOL          IFEQ      '1'
221370980512     C                   MOVEL     §3ATB1        TASTBL
221380980512     C                   ELSE
221390980512     C                   MOVEL     §3ATB2        TASTBL
221400020503    1C                   ENDIF
221410941219     C*
221420950116     C* SOLO SE C/A SULLA 1 BOLLA
221430020503    1C     WBOL          IFEQ      '1'
221440980506     C     §3AFCA        ANDEQ     1
221450980506     C     WBOL          OREQ      '2'
221460980506     C     §3AFCA        ANDEQ     2
221470941219     C                   MOVEL     VIDCAS        TASCAS
221480941219     C                   MOVEL     VIDVCA        TASVCA
221490941219     C                   MOVEL     VIDTIC        TASTIC
221500020503    1C                   ENDIF
221510941219     C*
221520941219     C                   MOVEL     COMLNA        TASLNA
221530941219     C                   MOVEL     VIDNCL        TASNCL
221540040127      * passo il porto se sto tassando la prima bolla
221550040127     c                   If        wbol = '1'
221560941219     C                   MOVEL     VIDPOR        TASPOR
221570040127     c                   EndIf
221580941219     C                   MOVEL     VIDIAS        TASIAS
221590941219     C                   MOVEL     VIDVAS        TASVAS
221600941219     C                   MOVEL     VIDTC1        TASTC1
221610941219     C                   MOVEL     VIDTC2        TASTC2
221620941219     C                   MOVEL     VIDQFT        TASQFT
221630020503    1C     VIDBAM        IFEQ      'S'
221640970411     C                   MOVEL     'S'           TASDDT
221650020503    1C                   ENDIF
221660061002     c*vidfbr            movel     vidfbr        §tasflo
221670061002     c* Passo nella DTAS01 il blpfbr
221680061002     c                   clear                   dtas01
221690061002     c                   movel     vidfbr        §asfbr
221700110613     c                   if        wemdest<>*blanks
221710110613     c                   movel     'S'           §asemd
221720110613     c                   endif
221730061002     c                   movel(P)  dtas01        §tasflo
221740941219     C* LEGGO IL SFL PER PRENDERE LE VARIE
221750980506     C* SOLO PER 1 BOLLA ESISTE TASSAZIONE COMPLETA
221760991007     C                   CLEAR                   DTASV
221770980506    1C     WBOL          IFEQ      '1'
221780941219     C                   Z-ADD     1             NRR
221790941219     C                   Z-ADD     1             C
221800941219     C*
221810980506    2C                   DO        20            NRR
221820941219     C     NRR           CHAIN     LS01S03                            30
221830941219     C*
221840980506    3C     *IN30         IFEQ      *OFF
221850020503     c* se devo tassare una specifica varia(da tabella 3A) e c'e' gia'
221860020503     c*  non richiamo la tassazione
221870020503     c                   if        §3asva<>*blanks and v3csv1=§3asva
221880020503     c                   eval      wtassa='N'
221890030623      * mi salvo l'importo della varia
221900030623     c                   eval      itassa=v3cva1
221910020503     c                   endif
221920030623     c* se esiste già la varia "D" non la ricalcolo
221930030623     c*
221940030623     c                   if        v3csv1='D'
221950030623     c                   eval      wtassad='N'
221960030623     c                   endif
221970030624      * SE ESISTE LA VARIA "&" CON TUTTI 8888888 NON LA PASSO AL TNSF20R
221980030624      * MA PASSO UN FLAG  DI RICHIESTA CALCOLO VARIA "&"
221990030624     C                   IF        V3CSV1 = '&' AND V3CVA1 = 88888888
222000030624     C                   EVAL      TASFCAA = 'S'
222010030624     C                   ELSE
222020941219     C                   MOVEL     V3CSV1        VSV(C)
222030991007     C                   Z-ADD     V3CVA1        VVA(C)
222040030624     c                   ENDIF
222050941219     C                   ADD       1             C
222060980506    3C                   ENDIF
222070980506    2C                   ENDDO
222080980506     C**
222090991019     C                   MOVEL     VIDDIV        TASDIV
222100991019     C**
222110980506     C** 2 BOLLA: IMPOSTO LA VARIA "G"
222120980506   X1C                   ELSE
222130991019     C                   MOVEL     VI2DIV        TASDIV
222140980608     C     VI2VA1        IFGT      0
222150980608     C                   MOVEL     VI2SV1        VSV(1)
222160991007     C                   Z-ADD     VI2VA1        VVA(1)
222170040121     c                   Movel     Vi2Es1        Ves(1)
222180980608     C                   ENDIF
222190040115     c                   If        Vi2Va2 > *Zeros
222200040115     c                   Movel     Vi2Sv2        Vsv(2)
222210040115     c                   Z-add     Vi2Va2        Vva(2)
222220040121     c                   Movel     Vi2Es2        Ves(2)
222230040115     c                   EndIf
222240040115     c                   If        Vi2Va3 > *Zeros
222250040115     c                   Movel     Vi2Sv3        Vsv(3)
222260040115     c                   Z-add     Vi2Va3        Vva(3)
222270040121     c                   Movel     Vi2Es3        Ves(3)
222280040115     c                   EndIf
222290040115     c                   If        Vi2Va4 > *Zeros
222300040115     c                   Movel     Vi2Sv4        Vsv(4)
222310040115     c                   Z-add     Vi2Va4        Vva(4)
222320040121     c                   Movel     Vi2Es4        Ves(4)
222330040115     c                   EndIf
222340041217     c                   If        Vi2Va5 > *Zeros
222350041217     c                   Movel     Vi2Sv5        Vsv(5)
222360041217     c                   Z-add     Vi2Va5        Vva(5)
222370041217     c                   Movel     Vi2Es5        Ves(5)
222380041217     c                   EndIf
222390041217     c                   If        Vi2Va6 > *Zeros
222400041217     c                   Movel     Vi2Sv6        Vsv(6)
222410041217     c                   Z-add     Vi2Va6        Vva(6)
222420041217     c                   Movel     Vi2Es6        Ves(6)
222430041217     c                   EndIf
222440980608     C                   MOVEL     'G'           TASSVA
222450040115     c                   Eval      TascVag = 'S'
222460980506    1C                   ENDIF
222470990915     C* MERCE PORTATA A MAGAZZINO DAL COD.AUTOTRASPORTATORE
222480990915     C*  PER I PREPAGATI LA RICHIESTA VIENE FATTA A VIDEO
222490990915     C     VIDPDR        IFLE      *ZEROS
222500990915     C     *IN22         ANDEQ     *ON
222510001024     C                   MOVEL     VIDMAG        TASFDN
222520990915     C                   ELSE
222530990915     C                   MOVEL     APDFCM        TASFDN
222540990915     C                   ENDIF
222550020220     c* se bolla in assegnato export faccio sempre pagare la varia U
222560020220     c     *in04         ifeq      *on
222570020220     c     A_§ogntw      ifeq      'EEX'
222580081008     c***  A_§ogntw      oreq      'EUP'
222590020220     c     A_§ogntw      oreq      'DPD'
222600020220     c     A_§ogntw      oreq      'FED'
222610020220     c                   clear                   tasfdn
222620020220     c                   endif
222630020220     c                   endif
222640941219     C*
222650970708     C                   MOVEL     MITCTS        TASMCT
222660021002     c**
222670030204
222680030204      * Bancali
222690030205If  1c                   If        %Subst(VidGva:1:1) ='B'
222700030204     c                   Eval      TasBan = VidNba + VidNb2
222710030205     c                   EndIf
222720030728      * Colli originali
222730030728If  1c                   If        %Subst(VidGva:1:1) ='O'
222740030728     c                   Eval      TasNcl = W03Cor
222750030728     c                   EndIf
222760030204
222770020503     c                   if        wtassa=' '
222780020503     c* se devo tassare solo una varia, da tipo bolla, la imposto
222790020503     c                   if        §3asva<>*blanks
222800020503     c                   eval      tassva=§3asva
222810020503     c                   endif
222820030623      *
222830030623     c                   endif
222840030623      * per prepagato passo al TNSF20R la varia  "D" e l'importo del dir.fat.
222850030623      * da sommare che prendo CNIND (INDSIN)
222860030623      *
222870030623     c                   if        *in34  or *in22
222880030623      * recupero le spese incasso
222890030623     c     kaco          chain     cnind00f
222900030623     c                   if        %found(cnind00f)
222910031007      * se diritto di fatturazione a zero con calcolo la varia D
222920031007     c                   if        indsin = 0
222930031007     c                   eval      wtassad='N'
222940031007      *
222950031007     c                   else
222960030623     c                   move      indsin        tasivdf
222970030623     c                   eval      tassvdf = 'D'
222980031007     c                   endif
222990031007      *
223000030623     c                   endif
223010030623      *
223020030623     c                   if        wtassa='N' and wtassad = ' '
223030030623     c* se ho già tassata la singola varia devo sommare il solo diritto di fattu
223040030623     c* maggiore di zero oppure se imponibile a zero ho la singola varia valoriz
223050030623     c                   if        tasimv > 0  or (tasimv = 0 and itassa > 0)
223060030623     c                   eval      tassva='D'
223070030623     c                   else
223080030623     c                   eval      wtassad = 'N'
223090030623     c                   endif
223100030623     c                   endif
223110030623     c**
223120030623     c                   if        wtassa = 'N' and wtassad = 'N'
223130030623     c                   goto      endtas
223140030623     c                   endif
223150040115      * no prepagato
223160040115     c                   Else
223170040115     c                   if        wtassa = 'N'
223180040115     c                   goto      endtas
223190040115     c                   endif
223200040115     c                   endif
223210030623     c*
223220990701     C                   CLEAR                   WFIAS
223230990701     C                   MOVEL     PARAMF        KPJBU
223240991014      *
223250941219     C                   CALL      'TNSF20R'
223260941221     C                   PARM                    KPJBA
223270991007     C                   PARM                    DTAS
223280991007     C                   PARM                    DTASV
223290941219     C*
223300941219     C                   Z-ADD     0             NRR
223310941219     C                   Z-ADD     1             C
223320991014      *
223330991014      * PRIMA BOLLA
223340980506    1C     WBOL          IFEQ      '1'
223350991014     C* IMPOSTO LE VARIE
223360941219    2C                   DO        20            C
223370991027     C                   MOVEL     VSV(C)        WSVN
223380991027     C                   Z-ADD     VVA(C)        WVAN
223390941219     C                   MOVEL     VES(C)        WEV1
223400941219     C                   EXSR      CARVAR
223410941219    2C                   ENDDO
223420991025     C*
223430991025     C                   ADD       1             NRR
223440991025     C     NRR           DO        20            NRR
223450991025     C     NRR           CHAIN     LS01S03                            30
223460991025     C                   CLEAR                   V3CSV1
223470991025     C                   CLEAR                   V3CVA1
223480991025     C                   CLEAR                   V3HVA1
223490991025     C                   CLEAR                   V3CEV1
223500991025     C   30              WRITE     LS01S03
223510991025     C  N30              UPDATE    LS01S03
223520991025     C                   ENDDO
223530930415     C*
223540980506    2C     TASERR        IFEQ      *BLANKS
223550901031     C                   MOVEL     TASPOR        VIDPOR
223560991015     C                   MOVEL     TASPOR        MEMPOR
223570950220     C                   Z-ADD     TASQFT        VIDQFT
223580991014     C                   MOVEL     TASIMV        VIDIMV
223590991015     C                   MOVEL     TASDIV        VIDDIV
223600991015     C                   MOVEL     TASDIV        WDIV1
223610991015      *
223620991015   X2C                   ELSE
223630991015     C     TASMSG        IFEQ      *BLANKS
223640991015     C                   MOVEL     ERR(104)      VIDMSG
223650991015     C                   ELSE
223660991015     C                   MOVEL(P)  TASMSG        VIDMSG
223670991015     C                   ENDIF
223680991015     C                   SETON                                        9052
223690991015    2C                   ENDIF
223700991014      *
223710991014      * 2 BOLLA
223720980506   X1C                   ELSE
223730040115     c                   Clear                   ContaSv
223740040115      * carico le varie
223750040115Do  2c                   Do        20            c
223760040115If  3c                   If        Vsv(c) <> §$2Iva and
223770040115     c                             Vsv(c) <> §$2Bol
223780040115     c                   Add       1             ContaSv
223790040115S   4c                   Select
223800040115     c                   When      ContaSv = 1
223810040115     c                   Movel     Vsv(c)        Vi2Sv1
223820040115     c                   Z-add     Vva(c)        Vi2Va1
223830040121     c                   Movel     Ves(c)        Vi2Es1
223840040115     c                   When      ContaSv = 2
223850040115     c                   Movel     Vsv(c)        Vi2Sv2
223860040115     c                   Z-add     Vva(c)        Vi2Va2
223870040121     c                   Movel     Ves(c)        Vi2Es2
223880040115     c                   When      ContaSv = 3
223890040115     c                   Movel     Vsv(c)        Vi2Sv3
223900040115     c                   Z-add     Vva(c)        Vi2Va3
223910040121     c                   Movel     Ves(c)        Vi2Es3
223920040115     c                   When      ContaSv = 4
223930040115     c                   Movel     Vsv(c)        Vi2Sv4
223940040115     c                   Z-add     Vva(c)        Vi2Va4
223950040121     c                   Movel     Ves(c)        Vi2Es4
223960041217     c                   When      ContaSv = 5
223970041217     c                   Movel     Vsv(c)        Vi2Sv5
223980041217     c                   Z-add     Vva(c)        Vi2Va5
223990041217     c                   Movel     Ves(c)        Vi2Es5
224000041217     c                   When      ContaSv = 6
224010041217     c                   Movel     Vsv(c)        Vi2Sv6
224020041217     c                   Z-add     Vva(c)        Vi2Va6
224030041217     c                   Movel     Ves(c)        Vi2Es6
224040040115    4c                   EndSl
224050040115    3c                   EndIf
224060040115    2c                   EndDo
224070991014      *
2240809806080   2C     TASERR        IFEQ      ' '
224090040115     C                   MOVEL     TASDIV        VI2DIV
224100040115     C                   MOVEL     TASDIV        WDIV2
224110040126     c                   Movel     TasImv        Vi2Imv
224120980506     C**
224130980506   X2C                   ELSE
224140980506     C* MANCA TARIFFA
224150980608     C     TASMSG        IFEQ      *BLANKS
224160980506     C                   MOVEL     ERR(104)      VIDMSG
224170980608     C                   ELSE
224180980608     C                   MOVEL(P)  TASMSG        VIDMSG
224190980608     C                   ENDIF
224200980506     C                   SETON                                        9041
224210980506    2C                   ENDIF
224220980506    1C                   ENDIF
224230990610    0C                   ENDIF
224240940923     C*
224250940919     C     ENDTAS        ENDSR
224260990630     C*
224270990630     C* CALCOLO IL TOTALE FATTURA ------------------------------------*
224280990630     C     TOTFAT        BEGSR
224290991014      *
224300991015      *  RECUPERO L'ARROTONDAMENTO
224310991102     C                   CLEAR                   DSBS02
224320991102     C                   MOVEL     'C'           T02MOD
224330991102     C                   MOVEL     KNSIF         T02SIF
224340991102     C                   MOVEL     'GEI'         T02COD
224350991102     C                   MOVEL     VIDDIV        T02KE1
224360991102      *
224370991102     C                   CALL      'TIBS02R'
224380991102     C                   PARM                    KPJBA
224390991102     C                   PARM                    DSBS02
224400991102      *
224410991102     C     T02ERR        IFEQ      *BLANKS
224420991102     C                   MOVEL     T02UNI        DGEI
224430991102     C                   ELSE
224440991102     C                   CLEAR                   DGEI
224450991102     C                   ENDIF
224460991015      *
224470990630     C     VIDIMV        IFGT      0
224480991014     C                   CLEAR                   DSLV04
224490990630     C                   Z-ADD     COMDFT        D04DFT
224500991014     C                   Z-ADD     VIDIMV        D04IMV
224510991014     C                   MOVEL     VIDDIV        D04DIV
224520990630     C                   MOVEL     VIDCEI        D04CEI
224530991014     C                   MOVEL     VIDTIC        D04TIC
224540990630     C                   Z-ADD     VIDCAS        D04CAS
224550990630     C                   MOVEL     VIDVCA        D04VCA
224560990630     C                   Z-ADD     VIDPOR        D04POR
224570990701     C     *IN22         IFEQ      *ON
224580991015     C                   MOVEL     §GEAED        D04AED
224590991015     C                   Z-ADD     §GEAVL        D04VAR
224600990701     C                   ENDIF
224610991014     C     *IN04         IFEQ      *ON
224620991014     C                   MOVEL     '1'           D04SPE
224630991014     C                   ELSE
224640991014     C                   MOVEL     '8'           D04SPE
224650991014     C                   ENDIF
224660991014     C                   MOVEL     §3ATB1        D04TBL
224670991014      *
224680991014     C                   CALL      'FNLV04R'
224690991014     C                   PARM                    DSLV04
224700991007     C                   PARM                    DTASV
224710990630     C                   ENDIF
224720991014      *
224730990630     C                   ENDSR
224740930915     C*
224750930915     C* ANNULLAMENTO BOLLA -------------------------------------------*
224760930915     C     ANNULL        BEGSR
224770930915     C                   SETOFF                                       90
224780060307     C                   clear                   wf12              1
224790970408     C* NON POSSO ANNULLARE MAI UNA BOLLA LEGATA
224800940915     C     KBLP3         CHAIN     FNLBL01L                           30
224810930915     C*
224820930915    1C     *IN30         IFEQ      *OFF
224830941020     C                   MOVEL     ERR(65)       VIDMSG
224840941020     C                   SETON                                        90
224850970408    1C                   ENDIF
224860040614     c* Non posso annullare mai una bolla £ se lnp=lna
224870040611     C  N90BLPCBO        ifeq      '£ '
224880040611     C     BLPLNP        ANDeq     BLPLNA
224890040611     C                   MOVEL     ERR(282)      VIDMSG
224900040611     C                   SETON                                        90
224910040611     c                   endif
224920061127     c* Non posso annullare bolla con C.A.
224930061127     c                   clear                   fidn12ds
224940061127     c                   eval      dn_i12aas = §LPAAS
224950061127     c                   eval      dn_i12lnp = §LPLNP
224960061127     c                   eval      dn_i12nrs = §LPNRS
224970061127     c                   eval      dn_i12nsp = §LPNSP
224980061127     c                   eval      dn_i12fel = 'E'
224990061127     c                   eval      dn_i12fan = 'E'
225000061127     c                   call      'FIDN12R'
225010061127     c                   parm                    fidn12ds
225020061127     c* se numero di CA trovate maggiore di zero
225030061127     c                   if        dn_o12nca > 0
225040061127     C                   MOVEL     ERR(310)      VIDMSG
225050061127     C                   SETON                                        90
225060061127     c                   endif
225070110321     c* avviso se sono presenti spunte entrata
225080110321     c                   if        wforzbrv=*off
225090110321     c                   eval      wcheck=*on
225100110321     c                   exsr      sr_gesbranm
225110110321     c                   if        *in90
225120110321     C                   MOVEL     ERR(336)      VIDMSG
225130110321     c                   endif
225140110321     c                   eval      wforzbrv=*on
225150110321     c                   endif
225160060210     c* ANNULLAMENTO DI UN PREPAGATO
225170060210     c* verifico se in caso di annullamento prepagati devo richiedere
225180060210     c* la motivazione
225190060308     c                   movel     'KM'          wcvb
225200060308     c                   exsr      cls_lv85
225210060210     c                   clear                   ilv85cvb
225220070514     c**n90              if        *in22 = *ON and dateu >= §vpogpp
225230070514     c  n90              if        *in22 = *ON
225240060213     c*  Prima di tutto controllo che il prepagato non sia già stato incassa
225250060213     c*  to
225260060213     c                   exsr      sr_callycow
225270060213     c                   if        prmesito <> 0
225280060213     C                   MOVEL     ERR(297)      VIDMSG
225290060213     C                   SETON                                        90
225300060213     c                   else
225310110419     c*  Poi controllo che l'ORM non sia in distinta
225320110419     c                   if        ormndc>0
225330110419     c                   seton                                        90
225340110419     c*        errore: ORM già ritirato
225350110419     c                   if        ormfao=600
225360110419     C                   MOVEL     ERR(337)      VIDMSG
225370110419     c                   else
225380110419     c*        errore: per annullare togliere l'orm dalla distinta
225390110419     C                   MOVEL     ERR(338)      VIDMSG
225400110419     c                   endif
225410110419     c                   else
225420060227     c                   movel     '7L'          cod
225430060227     C                   MOVEL(P)  'KM'          KEY
225440060227     C                   EXSR      CTABEL
225450060227     C                   MOVEL     TBLUNI        DS7L
225460060227     c                   if        §7lmtv = 'S'
225470060210     c                   clear                   fnlv85ds
225480060210     c                   eval      ilv85cvb = 'KM'
225490060210     c                   eval      ilv85tel = 'V'
225500060309     c                   z-add     5             ilv85row
225510060210     c                   movel     fnlv85ds      kpjbu
225520060210     c                   call      'FNLV85R'
225530060210     c                   parm                    kpjba
225540060227     c*****              parm                    ds7l
225550060210     c                   movel     kpjbu         fnlv85ds
225560060210     c* F12=Ritorno --> riemetto formato 01
225570060210     c                   if        olv85f12 = '1'
225580060307     c                   eval      wf12   = '1'
225590060307     c                   goto      fannull
225600060210     c                   endif
225610060227     c                   endif
225620060213     c                   endif
225630060210     c                   endif
225640110419     c                   endif
225650060125
225660060125      * Richiamo il pgm per annullare l'ORM legato alla bolla RC
225670100604     c***                If        blpgma = 'RC'
225680110321     c  n90              If        w7rRC  = 'S'
225690060125     c                   Clear                   fnls25ds
225700060125     c                   If        blpccm > *Zeros
225710060125     c                   Eval      i25Ksc = blpccm
225720060125     c                   Else
225730060125     c                   Eval      i25ksc = blpksc
225740060125     c                   EndIf
225750060125     c                   Move      blpaas        i25aas
225760060125     c                   Eval      i25spe = %editc(blplnp:'X') +
225770060125     c                                      %editc(blpnrs:'X') +
225780060125     c                                      %editc(blpnsp:'X')
225790060125     c                   Call      'FNLS25R'
225800060125     c                   Parm                    Fnls25ds
225810060125     c                   EndIf
225820061122     c* se annullamento di un prepagato richiamo il seguente pgm per
225830061122     c* chiudere l'orm. No considero eventuali errori ricevuti dal
225840061122     c* pgm in quanto ininfluenti per questa operazione
225850070627     c  n90              if        *in22=*on and S_§b4fit<>*all'9'
225860061122     c                   clear                   fior51ds
225870061122     c                   z-add     s_§b4poe      i51poe
225880061122     c                   z-add     s_§b4nsr      I51NSR
225890061122     c                   z-add     s_§b4nor      I51NOR
225900061122     c                   z-add     s_§b4nrv      I51NRV
225910061122     c                   z-add     999           i51far
225920061122     c                   movel     '80'          i51car
225930061122     c                   call      'FIOR51R'
225940061122     c                   parm                    fior51ds
225950061122     c                   endif
225960060125
225970970408     C****
225980930915     C* CANCELLAZIONE FISICA FILES
225990930915     C  N90              EXSR      DELBLP
226000941020     C* PASSO NEL FALG PROVENIENZA '1' PER INDICARE CHE LA BOLLA E'
226010941011     C*  STATA ANNULLATA
226020941020     C                   MOVEL     '1'           §LPFPR
226030930915     C*
226040060307     C     fannull       ENDSR
226050901031     C*
226060930915     C*--- CANCELLAZIONE FISICA BOLLA IN TUTTI I SUOI FILES ----------*
226070930915     C     DELBLP        BEGSR
226080950410     C*
226090930915     C* SCRIVO RECORD IN FLBLA
226100070514     c***                if        *in22 = *off or dateu < §vpogpp
226110070514     c                   if        *in22 = *off
226120900511     C                   MOVEL     BLPLNP        BLALNP
226130900511     C                   MOVEL     BLPAAS        BLAAAS
226140900511     C                   MOVEL     BLPMGS        BLAMGS
226150900511     C                   MOVEL     BLPNRS        BLANRS
226160900511     C                   MOVEL     BLPNSP        BLANSP
226170900511     C                   MOVEL     BLPLNA        BLALNA
226180080904     C                   MOVEL     §3atb1        BLATBL
226190900511     C                   MOVEL     DATEU         BLADAN
226200080904     C                   MOVEL     simfel        BLAfle
226210110411     C                   MOVEL     blpcbo        BLAcbo
226220110411     c                   time                    blaoan
226230110411     c                   movel     knmus         blapru
226240110411     c                   movel     knmtd         blamtd
226250110411     c                   if        blpccm>0
226260110411     c                   z-add     blpccm        blaccm
226270110411     c                   else
226280110411     c                   if        not *in04
226290110411     c                   z-add     blpksc        blaccm
226300110411     c                   endif
226310110411     c                   endif
226320110411     c                   z-add     blprmn        blarmn
226330110411     c                   movel     blprma        blarma
226340110411     c                   movel     blprsm        blarsm
226350110411     c                   movel     blpinm        blainm
226360110411     c                   movel     blpcam        blacam
226370110411     c                   movel     blplom        blalom
226380110411     c                   movel     blpprm        blaprm
226390110411     c                   movel     blpnzm        blanzm
226400110411     c                   movel     blprsd        blarsd
226410110411     c                   movel     blpcad        blacad
226420110411     c                   movel     blplod        blalod
226430110411     c                   movel     blpprd        blaprd
226440110411     c                   movel     blpnzd        blanzd
226450110411     c                   movel     blpctm        blactm
226460110411     c                   z-add     blpncl        blancl
226470110411     c                   z-add     blppkb        blapkb
226480110411     c                   z-add     blpfls        blafls
226490110411     c                   z-add     blpncd        blancd
226500110411     c                   z-add     blpnca        blanca
226510080904     C                   WRITE     TNBLA000
226520060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
226530060210     c* anomalie
226540110321     c                   eval      wcheck=*off
226550060210     c                   exsr      sr_gesbranm
226560060210     c                   endif
226570060210     C* DISALLOCAZIONE FILES
226580001130      *
226590061212     C                   UNLOCK    FNBLP00F
226600051115     C                   UNLOCK    Fiar901L
226610001211     C                   UNLOCK    FIAR601L
226620001211     C                   UNLOCK    FIAR701L
226630060215     C                   UNLOCK    Fiar401L
226640001211     C                   UNLOCK    FNBLT01L
226650051102     C                   UNLOCK    FIARS01L
226660120814     C                   UNLOCK    FIART01L
226670060210     c*
226680070514     c* OPERAZIONI PER PREPAGATI
226690070514     c****               if        *in22 = *on and dateu >= §vpogpp
226700070514     c                   if        *in22 = *on
226710060210     c* richiamo fnlr48r per storicizzare la variazione
226720060210     c* ed effettuare altri eventuali aggiornamenti su file contrassegni
226730060210     c* e tassazione seconda bolla. L'aggiornamento della testata bolla
226740060210     c* viene effettuato in questo pgm al compimento di tutti gli aggiornam.
226750060303     c                   clear                   fnlr48ds
226760060210     C                   MOVEL     'L'           D48TLA
226770060210     C                   z-add     blplnp        D48FGS
226780060210     C                   z-add     blpaas        D48AAS
226790060210     C                   MOVE      blpLNP        D48LNP
226800060210     C                   MOVE      blpNRS        D48NRS
226810060210     C                   MOVE      blpNSP        D48NSP
226820060210     C                   MOVE      blpcbo        D48CBO
226830060210     C                   MOVEL     'KM'          D48CVB
226840060210     C                   MOVEL     'K'           D48TRC
226850060210     C                   MOVEL     'E'           D48FFR
226860060210     C                   MOVEL     ' '           D48ERR
226870060210     C                   MOVEL     *BLANK        D48MSG
226880060210     C                   MOVEL     'P'           D48TBO
226890060303     c                   movel     'N'           d48mct
226900060307     c                   eval      d48mtv = olv85mtv
226910060307     c                   movel     olv85nt1      d48not
226920060307     c                   move      olv85nt2      d48not
226930060210     c                   clear                   dsarbk
226940060210     C                   MOVEL     'M'           §BKcbn
226950060210     C                   MOVEL     fnlr48ds      KPJBU
226960060210     C                   CALL      'FNLR48R'
226970060210     C                   PARM                    KPJBA
226980060210     C                   PARM                    DSARBD
226990060210     C                   PARM                    DSARBK
227000060210     C                   PARM                    DARBT
227010060210     C                   PARM                    DSARBG
227020060210     C                   PARM                    trul90ds
227030060210     C                   MOVEL     KPJBU         fnlr48ds
227040060210     C     D48ERR        IFne      *BLANK
227050060210     c                   seton                                        90
227060060213     c                   movel     D48msg        vidmsg
227070060210     c                   goto      e_del
227080060210     C                   END
227090060210     c* rialloco fnblp
227100061218     C     savnrr        CHAIN     FNBLP000                           90
227110060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
227120060210     c* anomalie
227130110321     c                   eval      wcheck=*off
227140060210     c                   exsr      sr_gesbranm
227150060210     c                   endif
227160001211     C*
227170060210     C* RICHIAMO PROGRAMMA DI CANCELLAZIONE
227180060210     C*
227190001130     C                   MOVE      KPJBU         WA256           256
227200001130     C                   CLEAR                   DSLS63
227210060213     c* se è un prepagato lo richiamo in modalità "P" per cancellare solo
227220060213     c* il dettaglio colli e suoi file legati
227230070514     c****               if        *in22 = *on and dateu >= §vpogpp
227240070514     c                   if        *in22 = *on
227250060210     c                   movel     'P'           i63mod
227260060210     c                   endif
227270001130     C                   MOVE      BLPAAS        I63AAS
227280001130     C                   MOVE      BLPLNP        I63LNP
227290001130     C                   MOVE      BLPNRS        I63NRS
227300001130     C                   MOVE      BLPNSP        I63NSP
227310001130     C                   MOVEL     DSLS63        KPJBU
227320001130     C                   CALL      'FNLS63R'
227330001130     C                   PARM                    KPJBA
227340001130     C                   MOVE      WA256         KPJBU
227350081020     c                   clear                   trtc86drds
227360081020     c* richiamo pgm per cancellare eventuali record su firab
227370081020     c                   eval      i86mod='DC'
227380081020     c                   z-add     blpaas        i86aasb
227390081020     c                   z-add     blplnp        i86lnpb
227400081020     c                   z-add     blpnrs        i86nrsb
227410081020     c                   z-add     blpnsp        i86nspb
227420081020     c                   call      'TRTC86DRR'
227430081020     c                   parm                    trtc86drds
227440060210     c*
227450070514     c* OPERAZIONI PER PREPAGATI
227460070514     c****               if        *in22 = *on and dateu >= §vpogpp
227470070514     c                   if        *in22 = *on
227480060210     C                   exsr      sr_aggblp
227490060210     c                   endif
227500910807     C*
227510060210     C     e_del         ENDSR
227520060210     C*--- Operazioni su spunte e anomalie a fronte di f16=Annullam --*
227530060210     C     sr_gesbranm   BEGSR
227540060210     C* LEGGO FNBLT SE ESISTE
227550060210     C                   MOVEL     5             KNPG
227560060210     C                   MOVEL     SIMFEL        KFLE
227570060210     C*
227580120817     C***  KBLP3         SETLL     FNBLT000                               30
227590120817     C     KBLP3         SETLL     FIART000                               30
227600060210    1C     *IN30         IFEQ      *ON
227610120817     C***  KBLP3         READE(N)  FNBLT000                               30
227620120817     C     KBLP3         READE(N)  FIART000                               30
227630060210    2C     *IN30         DOWEQ     *OFF
227640110321   2ac                   if        wcheck=*on
227650120817     C***  KBRV          setll     FNBRV000
227660120817     C     KBRVA         setll     FNBRV000
227670110321     c                   if        %equal(fnbrv09l)
227680110321     c                   seton                                        90
227690110321     c                   leavesr
227700110321     c                   endif
227710110321  x2ac                   else
227720060210     C* SPUNTE ENTRATA
227730120817     C***  KBRV          CHAIN     FNBRV000                           31
227740120817     C     KBRVA         CHAIN     FNBRV000                           31
227750060210    3C     *IN31         DOWEQ     *OFF
227760060210     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
227770060210     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
227780060210     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
227790060210     c* no anomalie da cancellare create a fronte della spunta entrata
227800060210     c**                 z-add     brvnfv        wrvnfv
227810060210     c**                 movel     param2        kpjbu
227820060210     C**                 CALL      'FNLSA8R'
227830060210     C**                 PARM                    KPJBA
227840070123     C                   DELETE    FNBRV000
227850120817     C***  KBRV          READE     FNBRV000                               31
227860120817     C     KBRVA         READE     FNBRV000                               31
227870060210    3C                   ENDDO
227880060210     c* se presenti anomalie con key segnacollo aventi anche la spedizione
227890060210     C* le aggiorno togliendo i dati della spedizione se invece si tratta
227900060210     c* di anomalie  con key spedizione aventi anche il segnacollo le deleto
227910060210     c     kanm2         setll     fnanm02l
227920060210    3c                   do        *hival
227930060210     c     kanm2         reade     fnanm02l
227940060210    4c                   if        %eof(fnanm02l)
227950060210     c                   leave
227960060210    4c                   endif
227970060210     c                   movel     '7C'          cod
227980060210     c                   movel(p)  anmcaa        key
227990060210     C                   EXSR      CTABEL
228000060210     C                   MOVEL     TBLUNI        DS7C
228010060210    4c                   if        §7ckey = 'S'
228020060210     c                   clear                   anmaas
228030060210     c                   clear                   anmlnp
228040060210     c                   clear                   anmnsp
228050060210     c                   update    fnanm000
228060060210   x4c                   else
228070060210     c                   delete    fnanm000
228080060210    4c                   endif
228090060210    3c                   enddo
228100060210     C*
228110110321   2ac                   endif
228120110321     c*
228130120817     C***  KBLP3         READE(N)  FNBLT000                               30
228140120817     C     KBLP3         READE(N)  FIART000                               30
228150060210    2C                   ENDDO
228160060210    1C                   ENDIF
228170060210     c* leggo eventuali anomalie rimaste con key spedizione e se ce ne sono
228180060210     c* le deleto
228190110321     c                   if        wcheck=*off
228200060210     c     kanm1         setll     fnanm01l
228210060210    1c                   do        *hival
228220060210     c     kanm1         reade     fnanm01l
228230060210     c                   if        %eof(fnanm01l)
228240060210     c                   leave
228250060210     c                   endif
228260060210     c                   delete    fnanm01
228270060210    1c                   enddo
228280110321     c                   endif
228290060210     c                   endsr
228300060210     C*--- Operazioni aggiornamento fnblp  a fronte di f16 su prepagato
228310060210     C     sr_aggblp     BEGSR
228320060210     c                   z-add     dateu         blpdrt
228330060210     c                   z-add     999           blppdr
228340060210     C                   eval      BLPFPP = 'P'
228350060214     c                   movel     'N'           blpft1
228360060214     c                   movel     'N'           blpft2
228370060210     C                   MOVEL     *ALL'9'       BLPNFV
228380060210     C                   MOVEL     '4 '          BLPctm
228390060210     c                   movel     'M '          blpcbo
228400060303     c* azzero importo da assicurare altrimenti in ricezione bolle in sede
228410060303     c* scrive fiar4 trk "c" e fiarbt0e
228420060303     c                   clear                   blpias
228430060303     c                   clear                   blpvas
228440060210     c                   update    fnblp000
228450060210     c                   endsr
228460900824     C*
228470900824     C*--- CARICO RECORD BOLEL DA DISK CLIENTI -----------------------*
228480900824     C     CARBLC        BEGSR
228490100319     c                   clear                   WesORE            1
228500100319     c                   clear                   DoreGEN
228510000508     C                   CLEAR                   DSBL4J
228520980115     C                   MOVEL     CMAIUS        MA               26
228530980115     C                   MOVEL     CMINUS        MI               26
228540000124     C* SPIEGO IL SIGNIFICATO DEL FLAG §LPFPR:
228550950419     C* - SE "V" - VISUALIZZO SEMPRE LA BOLLA CHE CONFERMO
228560950419     C* - SE "X" - VISUALIZZO SOLO SE C'E' ERRORE
228570950419     C* - SE "W" - NON VISUALIZZO MAI MA PASSO CODICE DI ERRORE
228580950419     C*
228590930630     C                   MOVEL     *OFF          *INKL
228600930630     C                   MOVEL     *OFF          *INKC
228610930630     C                   MOVEL     *OFF          *INKI
228620930630     C                   MOVEL     *OFF          *INKF
228630940927     C*
228640940921     C                   Z-ADD     0             WKSC
228650091221     c                   clear                   wvidgma
228660100604     c                   clear                   w7rRC
228670940927     C* D A T E
228680910702     C* DATA SPEDIZIONE
228690940926     C                   Z-ADD     §LPMGS        BLPDSP
228700940926     C                   MOVEL     §LPAAS        BLPDSP
228710970512     C*
228720970512     C* LA LINEA DI PARTENZA E' QUELLA DEL CODICE AUTOTRASP.
228730970512     C                   MOVEL     §LPPDR        VIDLNP
228740971216     C     VIDLNP        IFNE      BLCLNP
228750971216     C                   Z-ADD     VIDLNP        W0030
228760971216     C     W0030         CHAIN     AZORG01L      UNIORG               30
228770000508     C                   MOVEL     ORGDE3        OG143
228780971216     C                   MOVEL     VIDLNP        BLCLNP
228790971216     C                   ENDIF
228800941011     C*
228810940927     C* DATA CONSEGNA RICHIESTA
228820940927     C                   Z-ADD     §LPDCR        VIDDCR
228830941011     C* SIGLA OPERATORE VIDEO
228840941011     C                   MOVEL     §LPSOP        VIDSOP
228850960926     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
228860941011     C                   Z-ADD     §LPDRT        VIDDRT
228870940927     C                   MOVEL     §LPNRT        VIDNRT
228880940927     C                   MOVEL     §LPFPP        VIDFPP
228890010220     C                   MOVEL     §LPFPP        PREFPP
228900900824     C*
228910941011     C                   MOVEL     §LPPDR        W0030
228920960927     C     W0030         IFNE      VIDLNP
228930941011     C                   CLEAR                   VIDPDR
228940010220     C                   CLEAR                   PREPDR
228950941011     C                   ELSE
228960941011     C                   MOVE      §LPPDR        VIDPDR
228970010220     C                   MOVE      §LPPDR        PREPDR
228980941011     C                   ENDIF
228990010212     C* NUMERO O.R.M.
229000010220     C* SE RICHIAMATO DA PGM GIACENZE IMPOSTO NUMERO ORM FITTIZIO
229010020522     c* idem se richiamato da pgm ritiri annullati
229020010220     C     §LPFPR        IFEQ      'G'
229030010220     C     §LPFPR        OREQ      'I'
229040010220     C     §LPFPR        OREQ      'P'
229050020522     C     §LPFPR        OREQ      'T'
229060010220     C                   MOVEL     §LPPDR        W0030             3 0
229070010220     C     W0030         CHAIN     AZORG01L      UNIORG               30
229080010220     C  N30              MOVEL     ORGDE8        OG148
229090010220     C   30              CLEAR                   OG148
229100060926     c* faccio finta che abbia sempre la procedura ORM attiva
229110060926     c                   eval      §ogorm='S'
229120060926     c
229130010220     C     §OGORM        IFEQ      'S'
229140010220     C                   MOVEL     §LPPDR        VIDPOE
229150010220     C                   MOVE      *ALL'9'       VIDNOR
229160010220     C                   MOVE      *ALL'9'       VIDNRV
229170010220     C                   ELSE
229180010220     C                   MOVE      *ZEROS        VIDPOE
229190010220     C                   MOVE      *ZEROS        VIDNOR
229200010220     C                   MOVE      *ZEROS        VIDNRV
229210010220     C                   ENDIF
229220011126     C                   CLEAR                   ATRDES
229230010220     C                   ELSE
229240010212     C                   Z-ADD     §LPPOE        VIDPOE
229250010222     C                   MOVEL     §LPNSR        VIDNOR
229260010222     C                   MOVE      §LPNOR        VIDNOR
229270010212     C                   Z-ADD     §LPNRV        VIDNRV
229280011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
229290011126     C                   Z-ADD     VIDPOE        WOPOE
229300011126     C                   Z-ADD     VIDNOR        WONOR
229310011126     C                   Z-ADD     VIDNRV        WONRV
229320011126     C                   Z-ADD     VIDLNP        WOLNP
229330011126     C                   CLEAR                   DORM01
229340011126     C     KORM          CHAIN     FNORM01L                           30
229350011126     C  N30              MOVEL     ORMFLO        DORM01
229360011126     C     §ORMFD        IFEQ      'S'
229370011126     C                   MOVEL     PROT          ATRDES
229380011126     C                   ELSE
229390011126     C                   CLEAR                   ATRDES
229400011126     C                   ENDIF
229410111209     c* se sull'orm sono presenti le note le visualizzo subito
229420111209     c                   if        not *in30 and
229430111209     c                             (ormno1<> *blanks or ormno2<>*blanks)
229440111209     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
229450120127     c                   movel     ormno1        vidno1
229460120127     c                   movel     ormno2        vidno2
229470120127     c                   movel     'NoteOrm'     viddno
229480111209     c                   endif
229490010220     C                   ENDIF
229500100319     c
229510010212     C                   MOVEL     VIDORM        W01ORM
229520940927     C* CODICE BOLLA
229530940926     C                   MOVEL     §LPCBO        VIDCBO
229540940929     C* PARTITA IVA
229550940929     C                   MOVEL     §LPCPI        WPIVA
229560011206     C*
229570011206     C* IMPOSTO IL CODICE CLIENTE MITTENTE
229580011206     C                   MOVE      §LPCCN        WKSC
229590011206     C                   MOVE      §LPCCN        VIDCCM
229600011206     C                   MOVE      §LPCCN        WCCMS
229610011206     C                   MOVEL     §LPCCN        W0030
229620011206     C* CODICE TRATTAMENTO MERCE
229630011206     C                   MOVEL     §LPCTM        VIDCTM
229640011206     C                   MOVEL     VIDCTM        WCTM
229650011206     C                   EXSR      CTRCTM
229660011206     C* SE TROVATO ERRORE DOPO LO FACCIO RICONTROLLARE
229670011206     C     *IN90         IFEQ      *ON
229680120903     c     vidctm        oreq      *blanks
229690011206     C                   SETOFF                                       90
229700011206     C                   CLEAR                   SAVCTM
229710011206     C                   CLEAR                   DS1B
229720011206     C                   ENDIF
229730940927     C* LINEA ARRIVO
229740020621     C     §1BFG1        IFeq      'S'
229750020320     c     §1bf14        oreq      'S'
229760980126     C     §LPFPR        OREQ      'G'
229770980126     C     §LPFPR        OREQ      'P'
229780980126     C     §LPFPR        OREQ      'I'
229790011206     C* SE DISK "C" EX DISK "B" LNA E ZNC DEVONO RIMANERE = 0
229800011206     C     §1BF12        IFNE      'B'
229810911031     C                   MOVEL     §LPLNA        VIDLNA
229820980126     C                   MOVEL     §LPZNC        VIDZNC
229830011206     C                   ENDIF
229840980126     C                   ENDIF
229850970512     C*
229860970512     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
229870970512     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
229880970512     C     W0030         IFNE      VIDLNP
229890970512     C                   SETON                                        1438
229900970512     C                   MOVEL     W0030         VIDFLC
229910970512     C                   ENDIF
229920940929     C* DATI FATTURA
229930940929     C                   MOVEL     §LPCEI        VIDCEI
229940940929     C                   MOVEL     §LPNFT        VIDNFT
229950940929     C                   MOVEL     §LPFIV        VIDFIV
229960940929     C                   Z-ADD     §LPDFT        VIDDFT
229970080327     C* TIPO SERVIZIO: lo carichiamo solo se inseribile dal bollettista/clie
229980080327     C                   MOVEL     §LPTSP        VIDTSP
229990080327     C                   Z-ADD     1             C
230000080327     C     vidtsp        LOOKUP    TSP(C)                                 30
230010080327     c                   if        not *in30 or uts(C)<>'S'
230020080327     c                   clear                   vidtsp
230030080327     c                   endif
230040080327     c
230050941115     C* CONSEGNE PARTICOLARI
230060941115     C                   MOVEL     §LPTC1        VIDTC1
230070941115     C                   MOVEL     §LPTC2        VIDTC2
230080091001     C                   MOVEL     §LPTC1        sav_tc1
230090091001     C                   MOVEL     §LPTC2        sav_tc2
230100091001     c                   clear                   w_ar5tcp
230110940929     C*
230120940929     C* D E C O D I F I C H E   BOLLA
230130940927     C                   EXSR      DECBOL
230140030303
230150030303      * Controllo se proteggere o meno il campo del rif. mitt. alf.
230160080331      * Bolla non manutenzionabile proteggo (solo se rma <> blanks)
230170080331     c                   If        §3aucb = 'N'
230180080331     c                   if        §lprma<>*blanks
230190030304     c                   Movel     Prot1         AtrRma
230200030304     c                   Eval      wrma = 's'
230210080331     c                   endif
230220030303     c                   Else
230230030303      * Provengo da giacenze e il p.o. del cliente è DPD proteggo
230240030303     c                   If        (§lpfpr = 'P' or §lpfpr = 'G')
230250060627     C                   MOVEL     OG143         SAV143
230260030303     c                   Clear                   og143
230270060627     c     w0030         Chain     Azorg01l      uniorg
230280030303     c                   If        %Found(Azorg01l)
230290030303     c                   Movel     orgde3        og143
230300030303     c                   Endif
230310030303     c                   If        §Ogntw = 'DPD'
230320030304     c                   Movel     Prot1         AtrRma
230330030304     c                   Eval      wrma = 's'
230340030303     c                   EndIf
230350060627     C                   MOVEL     SAV143        OG143
230360030303     c                   Endif
230370030303     c                   Endif
230380081014     C** Memorizzo se per il cliente del vab si gestisce il raggruppamento
230390081014     c** bolle
230400081014     C                   CLEAR                   DS3C
230410081014     C                   MOVEL     '3C'          COD
230420081014     C                   MOVEL(P)  §lpccm        KEY
230430081014     C                   EXSR      CTABEL
230440081014     C  N30              MOVEL     TBLUNI        DS3C
230450081014     c                   eval      §3cabd_s=§3cabd
230460980310     C* CARICO LA DS3C DEL CLIENTE PER VEDERE SE MANTIENE IL NUMERO
230470060216     C*  DI SPEDIZIONE PER VEDERE SE CHAINARE RECORD E DI ar4
230480980310     C                   CLEAR                   DS3C
230490980310     C                   MOVEL     '3C'          COD
230500980310     C                   MOVEL(P)  WKSC          KEY
230510980310     C*
230520980310     C                   EXSR      CTABEL
230530980310     C  N30              MOVEL     TBLUNI        DS3C
230540971222     C* VEDO SE ESISTE NUMERO AWB SEMPRE PERCHE' POTREBBE ESSERE SBAGLI
230550971222     C*  ATA LA LNA SULLA BOLLA
230560980310     C     §3CFSP        IFEQ      'S'
230570060216     C     KBLC4         CHAIN(N)  Fiar4000                           30
230580971216     C     *IN30         IFEQ      *OFF
230590060216     C                   MOVEL     ar4NOT        DSBL4E
230600971216     C                   MOVEL     §B4ERP        W010A            10
230610971216     C**
230620971216     C     W010A         IFGT      *ZEROS
230630020208     C                   MOVEL     §B4ERP        v6cawb
230640971216     C                   MOVEL     §B4ERP        SAVAWB
230650971216     C                   ENDIF
230660971222     C                   ENDIF
230670980310     C                   ENDIF
230680110818     c* FLAG ACCORPAMENTO SPEDIZIONI in consegna
230690110818     c* Se cliente abilitato al passaggio del flag accorpamento sped.
230700110818     c* verifico in tabella XCO se flag valido:
230710110818     c* - memorizzo errore, se flag non valido
230720110818     c* - memorizzo il dato nel campo wxco, se flag valido
230730110901     c* - memorizzo se si devee inviare messaggio al ced
230740050114     c                   clear                   wxco
230750110818     c                   eval      werrxco=*off
230760050114    1c                   if        §lpxco <> *blanks
230770050114    2c                   if        §3caus = 'S'
230780050114     C                   CLEAR                   dsbs02
230790110818     c                   clear                   dxco
230800050114     C                   MOVEL     'C'           T02MOD
230810050114     C                   MOVEL     KNSIF         T02SIF
230820110818     C                   MOVEL     'XCO'         T02COD
230830110818     c                   movel(P)  'XCO'         t02ke1
230840050114     c                   call      'TIBS02R'
230850050114     C                   PARM                    KPJBA
230860050114     C                   PARM                    dsbs02
230870050114    3C                   IF        T02ERR = *BLANKS
230880110818     C                   MOVEL     T02uni        dxco
230890050114    3C                   ENDIF
230900110901     c* Se valore non presente in tabella:
230910110901     c* memorizzo che devo inviare email a CED
230920110818    3c                   if        %lookup(§lpxco:vaa)=0
230930110901     c                   eval      werrxco=*on
230940110901     c* e se il valore è numerico>0 lo mantengo comunque
230950110901     c                   if        §lpxco>'0'
230960110901     c                   eval      wxco = §lpxco
230970110901     c                   endif
230980110818     c                   else
230990110901     c* Se valore presente in tabella  ---> tutto ok
231000110818     c                   eval      wxco = §lpxco
231010110818    3c                   endif
231020050114    2c                   endif
231030050114    1c                   endif
231040050114     c*
231050000214     C* VEDO SE DISK 'C'
231060911031     C*
231070940926     C* MITTENTE
231080020507     C* SE 8888 O 9999
231090941010    1C     VIDCCM        IFEQ      8888
231100940926     C     VIDCCM        OREQ      9999
231110980115     C                   MOVEL     §LPRSM        VIDRSM
231120911031     C                   MOVEL     §LPINM        VIDINM
231130911031     C                   MOVEL     §LPLOM        VIDLOM
231140911031     C                   MOVEL     §LPCAM        VIDCAM
231150920130     C                   MOVEL     §LPPRM        VIDPRM
231160940926     C                   MOVEL     §LPNZM        VIDNZM
231170941010     C*
231180941010   X1C                   ELSE
231190941010     C*
231200941010     C* SE CODIFICATO E §LPCAM E §LPNZM SONO PIENI, CONTROLLO CON CNIND
231210941010    2C     §LPCAM        IFNE      *BLANKS
231220941010     C     §LPNZM        ORNE      *BLANKS
231230950529     C                   Z-ADD     KCI           CCC
231240941010     C     KACO          CHAIN     CNIND000                           30
231250941010     C*
231260941010    3C     *IN30         IFEQ      *OFF
231270941010    4C     INDCAE        IFNE      §LPCAM
231280941010     C     INDSTA        ORNE      §LPNZM
231290941010     C                   MOVEL     §LPCAM        VIDCMO
231300941010     C                   MOVEL     §LPNZM        VIDNMO
231310941010    4C                   ENDIF
231320941010    3C                   ENDIF
231330941010    2C                   ENDIF
231340941010     C*
231350941010    1C                   ENDIF
231360941010     C*
231370940926     C                   MOVEL     *BLANKS       VIDFAP
231380940927     C                   MOVEL     *BLANKS       VIDFIN
231390911031     C*
231400980115     C                   MOVEL     §LPRSD        VIDRSD
231410980115     C                   MOVE      §LPRD2        VIDRSD
231420980115     C     MI:MA         XLATE     VIDRSD        VIDRSD
231430980115     C     MI:MA         XLATE     §LPIND        VIDIND
231440980115     C     MI:MA         XLATE     §LPPRD        VIDPRD
231450980115     C     MI:MA         XLATE     §LPCAD        VIDCAD
231460980115     C     MI:MA         XLATE     §LPLOD        VIDLOD
231470980115     C     MI:MA         XLATE     §LPNZD        VIDNZD
231480070404     c                   movel     vidrsd        savrsd
231490070404     c                   movel     vidind        savind
231500070404     c                   movel     vidprd        savprd
231510070404     c                   movel     vidcad        savcad
231520070404     c                   movel     vidlod        savlod
231530070404     c                   movel     vidnzd        nzdini
231540910204     C*
231550940927     C                   MOVEL     §LPCCN        SAVMIT
231560900824     C*
231570980115     C     MI:MA         XLATE     §LPGC1        VIDGC1
231580980115     C     MI:MA         XLATE     §LPGC2        VIDGC2
231590911031     C                   MOVEL     §LPFTM        VIDFTM
231600940927     C                   MOVEL     §LPQFT        VIDQFT
231610940927     C                   MOVEL     §LPIAS        VIDIAS
231620940926     C                   MOVEL     §LPVAS        VIDVAS
231630950517     C                   MOVEL     §LPVAS        VARVAS
231640940926     C                   MOVEL     §LPVMD        VIDVMD
231650940926     C                   MOVEL     §LPVAD        VIDVAD
231660950517     C                   MOVEL     §LPVAD        VARVAD
231670911031     C                   MOVEL     §LPNAS        VIDNAS
231680040610     C                   MOVEL     §LPbva        VIDbva
231690940819     C                   MOVEL     §LPNCL        V1CNCL
231700930401     C                   MOVEL     §LPNCL        SAVNCL
231710930401     C                   MOVEL     §LPNCL        VIDNCL
231720940926     C                   Z-ADD     §LPPKB        VIDPKG
231730940926     C                   Z-ADD     §LPPKB        V2CPKG
231740980402     C                   Z-ADD     0             SAVPKG
231750940926     C                   Z-ADD     §LPVLB        VIDVOL
231760980402     C                   Z-ADD     0             SAVVOL
231770940926     C                   MOVEL     §LPCAS        VIDCAS
231780110519     C     mi:ma         xlate     §LPVCA        VIDVCA
231790110519     C     mi:ma         xlate     §LPVCA        VARVCA
231800911031     C                   MOVEL     §LPTIC        VIDTIC
231810900824     C*
231820911031     C                   MOVEL     §LPRMN        VIDRMN
231830940926     C                   MOVEL     §LPRMA        VIDRMA
231840911031     C                   MOVEL     §LPRMO        VIDRMO
231850091008     C                   MOVEL     '1'           WOVUO1
231860060627     c* se lnp dpd metto rmn in nrd
231870060628     c                   if        §ogntw='DPD' and §3arbl <> 'R'
231880060628     c                   movel     §lpnpr        vidnrd
231890060628     c                   endif
231900900824     C* CONTROLLO SE POSIZIONARMI SU SEGNACOLLO O SU VOLUME
231910911031     C     §LPNCD        IFEQ      0
231920931123     C                   SETOFF                                       36
231930900824     C                   ELSE
231940900827     C                   SETON                                        36
231950900824     C                   END
231960940926     C                   MOVEL     §LPNOT        VIDNT1
231970940926     C                   MOVEL     §LPNT2        VIDNT2
231980910129     C* CODICE TRATTAMENTO MERCE
231990011206     C* QUESTE SPECIFICHE LE HO SPOSTATE PRIMA DELL'IMPOSTAZIONE DI VID
232000011206     C* LNA PERCHE' MI SERVIVA IL CONTENUTO DI §1BF12
232010950504     C*
232020910805     C                   MOVEL     *ZEROS        VIDNCD
232030910805     C                   MOVEL     *ZEROS        VIDNCA
232040921005     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
232050920203     C     §LPFPR        IFEQ      'G'
232060941230     C                   MOVEL     §LPFPR        WFPR              1
232070920203     C                   MOVEL     §LPNCD        VIDNCD
232080920203     C                   MOVEL     §LPNCA        VIDNCA
232090920203     C                   MOVEL     'V'           §LPFPR
232100950420     C                   SETON                                        8744
232110011029     C                   MOVEL     PROT          ATRFTM
232120970328     C     §LPBAM        IFEQ      ' '
232130970328     C                   MOVEL     'S'           §LPBAM
232140920203     C                   END
232150970328     C                   END
232160941230     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
232170941230     C* IN QUESTO CASO NON MI FERMO SULLA BOLLA E NON LA STAMPO
232180941230     C     §LPFPR        IFEQ      'P'
232190941230     C                   MOVEL     §LPFPR        WFPR              1
232200941230     C                   MOVEL     §LPNCD        VIDNCD
232210941230     C                   MOVEL     §LPNCA        VIDNCA
232220941230     C                   MOVEL     'X'           §LPFPR
232230950420     C                   SETON                                        8744
232240011029     C                   MOVEL     PROT          ATRFTM
232250970328     C     §LPBAM        IFEQ      ' '
232260970328     C                   MOVEL     'S'           §LPBAM
232270970328     C                   END
232280941230     C                   END
232290921029     C* CREO BOLLA PER INVIO DISPOSIZIONI MITTENTE AI CLIENTI
232300921029     C     §LPFPR        IFEQ      'I'
232310921029     C                   MOVEL     'X'           §LPFPR
232320940222     C                   MOVEL     'I'           WFPR
232330011029     C                   SETON                                        87
232340011029     C                   MOVEL     PROT          ATRFTM
232350921029     C                   END
232360020522     C     §LPFPR        IFEQ      'T'
232370030609      * se sto creando una bolla "FT" x ORM commissionati
232380030609      * devo impostare §lpfpr = 'X' e proteggere la lna
232390030609    2c                   If        §lpCbo = 'FT'
232400030609     c                   Eval      §lpFpr = 'X'
232410030609     c                   Movel     Prot1         AtrLna
232420030609    xc                   Else
232430020522     C                   MOVEL     'V'           §LPFPR
232440030609    2c                   EndIf
232450020522     c                   endif
232460910208     C* SOLO CON FLAG6=C PRENDO I SEGNACOLLI SE NO COMUNQUE LI AZZERO
232470910208     C     §1BFG6        IFEQ      'C'
232480911031     C                   MOVEL     §LPNCD        VIDNCD
232490911031     C                   MOVEL     §LPNCA        VIDNCA
232500920204     C                   END
232510910805     C* SE FLAG7=S ABILITO TASTO PER GESTIONE DETT. STAMPA SEGNACOLLI
232520910805     C     §1BFG7        IFEQ      'S'
232530020917     C* Se DISKC non devo abilitare l'F21 di manutenzione fivad
232540001016     C     §1BF12        IFEQ      'N'
232550001106     C     §1BF12        OREQ      'E'
232560001106     C     WASDKC        ANDNE     'S'
232570910805     C                   SETON                                        94
232580001016     C                   ENDIF
232590910805     C* SE VI3FNS=S -> C'E' SEGNACOLLO E NON CODICE PRODOTTO
232600020917     C     KBLC          SETLL     FIVAD000
232610020917     C     KBLC          READE(N)  FIVAD000                               31
232620910805     C  N31BLDNCD        IFGT      0
232630920204     C     BLDCDP        ANDEQ     *BLANKS
232640910805     C                   MOVEL     'S'           VI3FNS
232650910805     C                   END
232660910805     C                   END
232670910220     C*
232680120903     C***  §1BFG2        IFNE      'N'
232690120903     C***  §LPFPR        OREQ      'R'
232700120903     C     §1BFG2        IFeq      'S'
232710921005     C                   MOVEL     §LPNSP        VIDNSP
232720921005     C                   MOVEL     §LPNRS        VIDNRS
232730921005     C                   ELSE
232740910129     C                   Z-ADD     0             VIDNSP
232750910129     C                   Z-ADD     0             VIDNRS
232760000829     C                   END
232770050222     C* SE NAZIONE DESTINATARIO ESTERA,
232780050222     C* CONTROLLO IL COD.TARIFFA PER SAPERE SE E' TRAFFICO DPD
232790050222     C                   MOVEL     '15'          COD
232800050222     C                   MOVEL(P)  VIDNZD        KEY
232810050222     C                   EXSR      CTABEL
232820050222     C   30              CLEAR                   DS15
232830050222     C  N30              MOVEL     TBLUNI        DS15
232840050222     C*
232850050222    1C     §15ITA        IFNE      'I'
232860050222     C                   MOVE      WKSC          W0040
232870050222     C*
232880050222     C* SE CLIENTE CODIFICATO, FACCIO COME ADESSO
232890050222     C* SE CLIENTE NON CODIFICATO MA COD.TRATTAMENTO MERCE PER DPD,
232900050222     C*   E LNA DPD, CONSIDERO LO STESSO IL RIF.MITTENTE
232910050222   1AC     W0040         IFEQ      8888
232920050222     C     W0040         OREQ      9999
232930050222     C     VIDLNA        IFGT      *ZEROS
232940050222     C     A_§OGNTW      ANDEQ     'DPD'
232950050222     C                   MOVEL     'D'           VIDDPD
232960050222     C*
232970050222     c                   select
232980050222    5C     §1BF13        wheneq    'R'
232990060628     c                   movel     §lpnpr        vidnrd
233000050222    5C     §1BF13        wheneq    *blanks
233010050222     c                   exsr      sr_vatdpd
233020060612     c                   movel     w014a         vidnrd
233030050222     C                   ENDsl
233040050222     c                   else
233050050222     c     vidlna        ifgt      *zeros
233060050222     c     A_§ogntw      andeq     'FED'
233070050222     c                   movel     'F'           viddpd
233080050222     c                   endif
233090050222     C                   ENDIF
233100050222     C*
233110050222  X1AC                   ELSE
233120050222     C*
233130050921     c                   clear                   fnlv59ds
233140050921     C                   MOVEL     'P'           ilv59tbo
233150050222      * se bolla monovaria pulisco il tipo bolla
233160050222     C                   IF        §3ASVA <> *BLANK
233170050921     C                   CLEAR                   ilv59tbo
233180050921     C                   movel     'P'           ilv59prp
233190050222     C                   ENDIF
233200050222
233210050921     C                   MOVEL     WKSC          ilv59KSC
233220050921     C                   MOVEL     KCI           ilv59KCI
233230050921     C                   MOVEL     BLPDSP        ilv59DSP
233240050921     C                   MOVEL     VIDTSP        ilv59TSP
233250050921     C                   MOVEL     §LPCTR        ilv59CTR
233260050921     C                   MOVEL     'S'           ilv59RIC
233270050921     C                   MOVEL     'S'           ilv59CON
233280050222     C* CONTROLLO TRA LE TARIFFE ESTERE E ITALIADPD
233290050921     C                   MOVEL     'S'           ilv59FIE
233300050921     C                   CALL      'FNLV59R'
233310050921     C                   PARM                    fnlv59ds
233320050222     C*
233330050222     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDOPRG
233340050921    2C     olv59err      IFEQ      ' '
233350050921     C     olv59tks      ANDEQ     'S'
233360050921     C                   MOVEL     olv59prg      COMPRG
233370050222     C                   MOVEL     §LPCTR        COMCTR
233380050222     C     KTAM2         CHAIN     TNTAM000                           30
233390050222     C* TARIFFA VALIDA
233400050222    3C     *IN30         IFEQ      *OFF
233410050222     C     TAMATB        ANDEQ     ' '
233420050222     C                   MOVEL     TAMFLO        DSTA01
233430050222     C* TARIFFA DPD
233440050222    4C     §TADPD        IFEQ      'S'
233450050222     C                   MOVEL     'D'           VIDDPD
233460050222     c                   select
233470050222    5C     §1BF13        wheneq    'R'
233480060628     c                   movel     §lpnpr        vidnrd
233490050222    5C     §1BF13        wheneq    *blanks
233500050222     c                   exsr      sr_vatdpd
233510060612     c                   movel     w014a         vidnrd
233520050222    5C                   endsl
233530050222     c                   else
233540050222     c* tariffa fedex
233550050222     c     §tafed        ifeq      'S'
233560050222     c                   movel     'F'           viddpd
233570050222     c                   endif
233580050222    4C                   ENDIF
233590050222    3C                   ENDIF
233600050222    2C                   ENDIF
233610050222   1AC                   ENDIF
233620050222    1C                   ENDIF
233630000831     C* PER NO DISK "B" CONTROLLO SE DISK "C"
233640000904     C* Spengo indicatore per attivazione tasto funzionale di gestione
233650000904     c* cod. CHI SONO
233660000901     C                   SETOFF                                       96
233670000901    1C     §1BFG1        IFNE      'S'
233680000831     C     WASDKC        ANDEQ     'S'
233690000831     C* SE IMPORT DPD O COD.TRATTAMENTO MERCE CHE PREVEDE IL DISK C
233700000901    2C     §1BF12        IFNE      'N'
233710001013     C     §1BF12        ANDNE     ' '
233720020319     C     §OGNTW        OREQ      'DPD'
233730000919     C     §3CDKC        ANDEQ     'S'
233740000214     C                   MOVEL     ':'           VIDSOP
233750000901     C* Carico subfile prendendo il chi sono dal VAT oppure dal VAB/VAD
233760000901     C* in base al tipo di DISKC
233770050222     c* Non devo caricare il subfile se:
233780050222     c* 1) spedizione export dpd e numero parcel dpd = codice chi sono
233790050222     c* 2) spedizione import dpd
233800050222     c* in questi due casi infatti il cod.chi sono coincide col numero
233810050222     c* parcel dpd che viene già inserito in altro modo
233820051102     c* Sarà il pgm a tenerne conto per la scrittura di fisgn e FIARS
233830000901    3C     §1BF12        IFEQ      'E'
233840050222     c     viddpd        andne     'D'
233850050222     c     §ogntw        andne     'DPD'
233860050222     c     §1bf12        oreq      'E'
233870050222     c     viddpd        andeq     'D'
233880050222     c     §1bf13        andne     *blanks
233890030321      * se non ho superato i 500 colli
233900050222     c     V1cNcl        ifle      500
233910000829     C                   EXSR      CARVAT
233920000901     C                   SETON                                        96
233930000911     C     NR8           IFGT      0
233940000911     C                   SETON                                        78
233950000911     C                   ENDIF
233960050222     c                   endif
233970000901   X3C                   ELSE
233980000901    4C     §1BF12        IFEQ      'B'
233990030321      * se non ho superato i 500 colli
234000030321     c     V1cNcl        andle     500
234010000901     C                   EXSR      CARVAB
234020000911     C     NR8           IFGT      0
234030000911     C                   SETON                                        78
234040000911     C                   ENDIF
234050000901     C                   SETON                                        96
234060050222     c                   else
234070050222     c* se import dpd e numero parcel nel fivat lo metto nel rmn
234080050222     c     §1bf12        ifeq      'E'
234090050222     c     §ogntw        andeq     'DPD'
234100050222     c                   exsr      sr_vatdpd
234110060612     c                   movel     w014a         vidnrd
234120060616     c                   seton                                        79
234130050222     c                   endif
234140000901    4C                   ENDIF
234150000901    3C                   ENDIF
234160000901    2C                   ENDIF
234170000901    1C                   ENDIF
234180001106     C*
234190001106     C* SE FLAG 12 = 'E' MA AS400 NON ABILITATO A DISK C CARICO LO
234200020917     C* STESSO SUBFILE PRENDENDO I DATI DA FIVAT
234210001106    1C     §1BFG1        IFNE      'S'
234220001106     C     WASDKC        ANDNE     'S'
234230001106     C     §1BF12        ANDEQ     'E'
234240030321      * se non ho superato i 500 colli
234250030321     c     V1cNcl        andle     500
234260050222     c     viddpd        ifne      'D'
234270050222     c     §ogntw        andne     'DPD'
234280050222     c     viddpd        oreq      'D'
234290050222     c     §1bf13        andne     *blanks
234300001106     C                   EXSR      CARVAT
234310001106     C                   SETON                                        96
234320001106     C     NR8           IFGT      0
234330001106     C                   SETON                                        78
234340001106     C                   ENDIF
234350050222     c                   endif
234360001106     C                   ENDIF
234370000831     C*
234380911031     C                   MOVEL     §LPFFD        VIDFFD
234390010214     C     §LPFFD        IFEQ      *BLANKS
234400010214     C                   MOVEL     'N'           VIDFFD
234410010214     C                   ENDIF
234420911031     C                   MOVEL     §LPTCR        VIDTCR
234430940927     C                   MOVEL     §LPHCR        VIDHCR
234440940927     C                   MOVE      §LPHCR        VIDMCR
234450940927     C* MI SERVONO PER IL CONFRONTO PER SAPERE SE CAMBIARE O NO I CAMPI
234460940927     C   04              Z-ADD     §LPCCN        SAVCCM
234470941103     C  N04              Z-ADD     1             SAVCCM
234480920123     C*
234490920123     C                   MOVEL     §LPFBR        VIDFBR
234500031029     c                   Clear                   VidGca
234510940927     C                   MOVEL     §LPGGA        VIDGGA
234520940927     C                   MOVEL     §LPGMA        VIDGMA
234530091221     c                   eval      wvidgma = §lpgma
234540100604     c* Verifico se c'e' ritiro contestuale alla consegna
234550100604     c                   clear                   ds7r
234560100604     C                   MOVEL     '7R'          COD
234570100604     C                   MOVEL(P)  §lpGMA        KEY
234580100604     C                   EXSR      CTABEL
234590100604     C  n30              MOVEL     TBLUNI        DS7R
234600100604     c                   eval      w7rRC = §7rRC
234610100604     c
234620940927     C                   MOVEL     §LPGVA        VIDGVA
234630031029     c                   move      ' '           VidGva
234640920123     C                   MOVEL     §LPPOR        VIDPOR
234650940927     C                   MOVEL     §LPIMV        VIDIMV
234660991026     C                   MOVEL     §LPDIV        VIDDIV
234670970326     C* FLAG DDT S/N
234680970326     C     §LPBAM        IFNE      ' '
234690970328     C     §LPBAM        IFEQ      'S'
234700970328     C     §LPBAM        OREQ      'C'
234710060609     C     §LPBAM        OREQ      'P'
234720060609     C     §LPBAM        OREQ      'Q'
234730991007     C                   MOVEL     'S'           VIDBAM
234740970328     C                   ELSE
234750970328     C                   MOVEL     'N'           VIDBAM
234760970326     C                   ENDIF
234770970328     C                   ENDIF
234780020102     C* SE SONO RICHIAMATA DA PGM DELLE GIACENZE E HO DEGLI IMPORTI DI
234790020102     C* TASSAZIONE SENZA NUMERO FATTURA E LA DIVISA E' DIVERSA DA GE
234800020102     C* DCN MEMORIZZO CHE DEVO CARICARE LA VIDEATA CON GLI IMPORTI CON-
234810020102     C* VERTITI NELLA DIVISA DI CONTO DAL MOMENTO CHE PER §LPFPR = "G",
234820020102     C* "I" O "P" I DATI DI TASSAZIONE SONO PROTETTI ED IN CASO DI
234830020102     C* ERRORE DI DIVISA SCADUTA L'YENTE NON PUO' IN ALCUN MODO INTERVE
234840020102     C* NIRE PER CAMBIARE LA DIVISA
234850020102     C                   CLEAR                   WCONV
234860020102     C     WFPR          IFEQ      'G'
234870020102     C     WFPR          OREQ      'I'
234880020102     C     WFPR          OREQ      'P'
234890020102     C     VIDNFT        IFEQ      0
234900020102     C     VIDDIV        ANDNE     *BLANKS
234910020102     C     VIDDIV        ANDNE     §GEDCN
234920020102     C                   MOVEL     '1'           WCONV             1
234930020102     C                   ENDIF
234940020102     C                   ENDIF
234950940927     C* CARICO LE VARIE
234960940927     C                   Z-ADD     0             NRR
234970941108     C                   DO        20            C
234980991027     C                   MOVEL     VSV(C)        WSVN
234990991027     C                   Z-ADD     VVA(C)        WVAN
235000940927     C                   EXSR      CARVAR
235010020102      * CARICO SCHIERA VARIE X RICALCOLO TOT.IMPONIBILE
235020020102     C     WCONV         IFEQ      '1'
235030020102     C     VIDIMV        ANDGT     *ZEROS
235040020102     C                   MOVEL     V3CSV1        VSV(C)
235050020102     C                   Z-ADD     V3CVA1        VVA(C)
235060020102     C                   MOVEL     V3CEV1        VES(C)
235070020102     C                   ENDIF
235080941108     C                   ENDDO
235090020102     C* CONVERTO ANCHE PORTO E RICALCOLO EVENTUALMENTE IL TOTALE IMPO-
235100020102     C* NIBILE
235110020102    1C     WCONV         IFEQ      '1'
235120020102     C* PORTO
235130020102    2C     VIDPOR        IFGT      *ZEROS
235140020102     C                   CLEAR                   DSYEUR
235150020102     C                   MOVEL     VIDDIV        YECDVI
235160020102     C                   Z-ADD     VIDPOR        YECIMI
235170020102     C                   MOVEL     §GEDCN        YECDVO
235180020102     C     COMFDC        IFEQ      'S'
235190020102     C                   MOVEL     '3'           YECDCO
235200020102     C                   ELSE
235210020102     C                   MOVEL     '0'           YECDCO
235220020102     C                   ENDIF
235230020102     C                   CALL      'YEURCO'
235240020102     C                   PARM                    DSYEUR
235250020102    3C     YECESI        IFEQ      ' '
235260020102     C                   Z-ADD     YECIMO        VIDPOR
235270020102    3C                   ENDIF
235280020102    2C                   ENDIF
235290020102     C* TOTALE IMPONIBILE
235300020102    2C     VIDIMV        IFGT      *ZEROS
235310020102     C                   CLEAR                   DSLV16
235320020102     C                   MOVEL     'T'           D17FIM
235330020102     C                   Z-ADD     VIDPOR        D17POR
235340020102     C                   CALL      'FNLV16R'
235350020102     C                   PARM                    DSLV16
235360020102     C                   PARM                    DTASV
235370020102     C                   Z-ADD     O17IMV        VIDIMV
235380020102    2C                   ENDIF
235390020102     C* DIVISA
235400020102     C                   MOVE      §GEDCN        VIDDIV
235410020102    1C                   ENDIF
235420020102     C                   CLEAR                   WCONV
235430940927     C*
235440940927     C* NUM TENTATIVI PER SUPERARE CONTROLLI FORZATI
235450940927     C     §LPFPR        IFNE      'V'
235460941021     C                   Z-ADD     1             NUMFOR
235470940927     C                   ELSE
235480940927     C                   Z-ADD     1             NUMFOR
235490940927     C                   ENDIF
235500941020     C*
235510941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
235520941020     C     VIDPOR        IFNE      0
235530941020     C     NRR           ORNE      0
235540941020     C     VIDCEI        ORNE      ' '
235550941020     C     VI2SV1        ORNE      ' '
235560040114     c     Vi2Sv2        orne      *Blanks
235570040114     c     Vi2Sv3        orne      *Blanks
235580040114     c     Vi2Sv4        orne      *Blanks
235590941020     C     VI2CEI        ORNE      ' '
235600941020     C                   MOVEL     'S'           WEMD03            1
235610941020    1C                   ENDIF
235620941011     C*
235630941011     C* VISUALIZZO IL NUMERO DI SPEDIZIONE CHE STO CONFERMANDO
235640941011     C                   Z-ADD     §LPNRS        PRENRS
235650941011     C                   Z-ADD     §LPNSP        PRENSP
235660941011     C                   MOVEL     §LPLNA        PRELNA
235670941011     C                   Z-ADD     §LPRMN        PRERMN
235680941011     C                   Z-ADD     §LPZNC        PREZNC
235690040506
235700040506      * Imposto la ds di comodo del n. spedizione
235710060222     c****               Z-add     VidLnp        WidLnp
235720060222     c                   Z-add     §lplnp        WidLnp
235730040506     c                   Z-add     §lpNrs        WidNrs
235740040506     c                   Z-add     §lpNsp        WidNsp
235750000124     C*
235760000508     C*
235770050114     C* SE LNP POSTE, MEMORIZZO A PARTE IAS, PER
235780060216     C*  MEMORIZZARLO NEL ar4 RECORD "J"
235790020319     C     §ogntw        IFEQ      'PPT'
235800000508     C                   Z-ADD     VIDIAS        §B4IAS
235810000508     C                   MOVEL     VIDVAS        §B4VAS
235820010215     C                   MOVEL     §LPDSK        §B4DSC
235830050114     c                   clear                   §b4xco
235840000508     C                   CLEAR                   VIDIAS
235850000508     C                   CLEAR                   VIDVAS
235860000508     C                   ENDIF
235870031125
235880021218      * Carico i dati relativi ai bancali
235890021220     c                   If        §LpTba > *Zeros
235900021218     c                   Movel     §LpTba        VidTba
235910021220     c                   EndIf
235920021218     c                   Eval      VidNba = §LpNba
235930030704     c                   Eval      SavNba = §LpNba
235940030224     c                   If        §LpTb2 > *Zeros
235950021218     c                   Movel     §LpTb2        VidTb2
235960021220     c                   EndIf
235970021218     c                   Eval      VidNb2 = §LpNb2
235980030704     c                   Eval      SavNba = §LpNb2
235990031125      * più quelli relativi ai colli sfusi e originali
236000031125     c                   Eval      w03Cor = §LpCor
236010031125     c                   Eval      w03Csf = §LpCsf
236020030409
236030030409      * Ore da sommare alla delivery
236040030409     c                   Move      §ore          VidOre
236050031125
236060031125      * carico i dati del telefono e del referente
236070031125     c                   Eval      VidRef = §LpRef
236080031125     c                   Eval      VidTel = §LpTel
236090031125
236100031125      * Imposto i campi dal FIVAT no record 'E'
236110031125     c                   ExSr      Sr_CarVat
236120031125      * Controllo quali dati dei bancali devo tenere
236130031126      * se non sono richiamta da giacenze
236140031126     c                   If        (savfpr <> 'P' and savfpr <> 'G')
236150031125     c                   ExSr      Sr_CtrBancali
236160031126     c                   EndIf
236170021218
236180900824     C                   ENDSR
236190010301     C*
236200010301     C*--- CARICO RECORD BOLLE DA CONFERMA ORM PREPAGATI -------------*
236210010301     C     CARBLO        BEGSR
236220010301     C                   Z-ADD     §LPPOE        VIDPOE
236230010301     C                   MOVEL     §LPNSR        VIDNOR
236240010301     C                   MOVE      §LPNOR        VIDNOR
236250010301     C                   Z-ADD     §LPNRV        VIDNRV
236260010301     C                   Z-ADD     VIDORM        WIDORM
236270010924     C                   CLEAR                   DORM01
236280010301     C     KORM          CHAIN     FNORM01L                           30
236290010301     C                   Z-ADD     ORMPOR        VIDLNP
236300010301     C                   MOVEL     '1'           VIDCBO
236310010924     C                   MOVEL     ORMFLO        DORM01
236320011121     C* Proteggo i campi a video relativi il destinatario se devo forza
236330011121     C* re il destinatario da orm
236340011121     C     §ORMFD        IFEQ      'S'
236350011121     C                   MOVEL     PROT          ATRDES
236360011121     C                   ELSE
236370011121     C                   CLEAR                   ATRDES
236380011121     C                   ENDIF
236390010301     C                   EXSR      PRPOR1
236400010307     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
236410010307     C* ANDRO' A PROPORRE NELLE NOTE
236420010307     C     'TEL.:'       CAT       ORMTER        W021A            21
236430010307     C     W021A         CAT(P)    ORMRER:1      WTELRF           70
236440010307     C                   MOVE      WTELRF        WTELR2           35
236450010301     C                   ENDSR
236460000627     C*
236470000627     C*--- RISCRIVO AGGIORNATA LA DBLP -------------------------------*
236480000627     C     AGDBLP        BEGSR
236490000627     C* DATA SPEDIZIONE
236500000627     C                   Z-ADD     BLPDSP        §LPMGS
236510000627     C                   MOVEL     BLPDSP        §LPAAS
236520000627     C* DATA CONSEGNA RICHIESTA
236530000627     C                   Z-ADD     COMDCR        §LPDCR
236540000627     C                   MOVEL     VIDSOP        §LPSOP
236550000627     C                   MOVEL     VIDRMN        §LPRMN
236560000627     C                   MOVEL     VIDRMA        §LPRMA
236570000627     C                   MOVEL     VIDRMO        §LPRMO
236580000627     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
236590000627     C                   Z-ADD     COMDRT        §LPDRT
236600000627     C                   MOVEL     VIDNRT        §LPNRT
236610000627     C                   MOVEL     VIDFPP        §LPFPP
236620000627     C                   MOVEL     VIDLNP        §LPPDR
236630000627     C                   MOVE      VIDPDR        §LPPDR
236640000627     C*
236650000627     C* CODICE BOLLA
236660000627     C                   MOVEL     VIDCBO        §LPCBO
236670000627     C                   Z-ADD     VIDCAS        §LPCAS
236680011113     C     VIDCAS        IFGT      *ZEROS
236690011113     C                   MOVEL     VIDVCA        §LPVCA
236700011113     C                   ELSE
236710011113     C                   CLEAR                   §LPVCA
236720011113     C                   ENDIF
236730000627     C                   MOVEL     VIDTIC        §LPTIC
236740000627     C                   MOVEL     VIDGCA        §LPGCA
236750011113     C                   CLEAR                   §LPCMB
236760000627     C* SEGNACOLLI
236770000627    1C     §3ABCM        IFEQ      ' '
236780000627     C                   EXSR      ASSSGN
236790000627     C     WEMFOR        IFEQ      ' '
236800000627     C                   MOVEL     BLPNCD        §LPNCD
236810000627     C                   MOVEL     BLPNCA        §LPNCA
236820000627     C                   ENDIF
236830000627     C                   ELSE
236840000627     C                   CLEAR                   §LPNCD
236850000627     C                   CLEAR                   §LPNCA
236860000627     C                   ENDIF
236870000627     C* TASSAZIONE
236880000627     C                   Z-ADD     VIDPOR        §LPPOR
236890000627     C                   Z-ADD     VIDIMV        §LPIMV
236900000627     C                   MOVEL     VIDCEI        §LPCEI
236910000627     C                   MOVEL     VIDDIV        §LPDIV
236920000627     C* MANCANO LE VARIE E DATI FATTURA !!
236930000627     C**
236940000627     C                   MOVEL     COMLNA        §LPLNA
236950000627     C                   MOVEL     VIDRSM        §LPRSM
236960000627     C                   MOVEL     VIDINM        §LPINM
236970000627     C                   MOVEL     VIDCAM        §LPCAM
236980000627     C                   MOVEL     VIDLOM        §LPLOM
236990000627     C                   MOVEL     VIDPRM        §LPPRM
237000000627     C                   MOVEL     VIDNZM        §LPNZM
237010000627     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
237020000627     C     VIDCMO        IFNE      *BLANKS
237030000627     C                   MOVEL     VIDCMO        §LPCAM
237040000627     C                   MOVEL     VIDNMO        §LPNZM
237050000627     C                   ENDIF
237060000627     C*
237070000627     C                   MOVEL     VARZNC        §LPZNC
237080000627     C     §3ACTM        IFNE      *BLANKS
237090000627     C                   MOVEL     §3ACTM        §LPCTM
237100000627     C                   ELSE
237110000627     C                   MOVEL     VIDCTM        §LPCTM
237120000627     C                   ENDIF
237130000627     C     BLPCTM        IFEQ      *BLANKS
237140000627     C                   MOVEL     WCTM          §LPCTM
237150000627     C                   ENDIF
237160000627     C                   MOVEL     VIDTC1        §LPTC1
237170000627     C                   MOVEL     VIDTC2        §LPTC2
237180000627     C                   MOVEL     VIDGGA        §LPGGA
237190000627     C                   MOVEL     VIDGMA        §LPGMA
237200000627     C                   MOVEL     VIDGVA        §LPGVA
237210000627     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
237220000627     C* DELLE PARTICOLARITA' VARIE
237230000627     C     W2LN          IFEQ      'S'
237240000627     C                   MOVE      'D'           §LPGVA
237250000627     C                   ELSE
237260000627     C                   MOVE      ' '           §LPGVA
237270000627     C                   ENDIF
237280000627     C* P A R T I T A   I V A
237290000627     C*
237300000627     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
237310000627     C*     NELLA P.IVA
237320000627     C     VIDISM        IFEQ      '$$'
237330000627     C     VIDCPM        ANDEQ     *BLANKS
237340000627     C                   MOVEL     'PRIVATO'     VIDCPM
237350000627     C                   ENDIF
237360000627     C     VIDISD        IFEQ      '$$'
237370000627     C     VIDCPD        ANDEQ     *BLANKS
237380000627     C                   MOVEL     'PRIVATO'     VIDCPD
237390000627     C                   ENDIF
237400000627     C*
237410000627     C  N04VIDISM        IFEQ      *BLANKS
237420000627     C                   MOVEL     VIDCPM        §LPCPI
237430000627     C                   ELSE
237440000627     C                   MOVEL     VIDPIM        §LPCPI
237450000627     C                   ENDIF
237460000627     C   04VIDISD        IFEQ      *BLANKS
237470000627     C                   MOVEL     VIDCPD        §LPCPI
237480000627     C                   ELSE
237490000627     C                   MOVEL     VIDPID        §LPCPI
237500000627     C                   ENDIF
237510000627     C**
237520000627     C                   MOVEL     VIDRSD        §LPRSD
237530000627     C                   MOVE      VIDRSD        §LPRD2
237540000627     C                   MOVEL     VIDIND        §LPIND
237550000627     C                   MOVEL     VIDCAD        §LPCAD
237560000627     C                   MOVEL     VIDLOD        §LPLOD
237570000627     C                   MOVEL     VIDPRD        §LPPRD
237580000627     C                   MOVEL     VIDNZD        §LPNZD
237590000627     C                   MOVEL     VIDGC1        §LPGC1
237600000627     C                   MOVEL     VIDGC2        §LPGC2
237610000627     C                   MOVEL     VIDCTR        §LPCTR
237620000627     C                   MOVEL     SAVCTS        §LPCTS
237630000627     C                   MOVEL     VIDFBR        §LPFBR
237640000627     C* ALLEGA BAM
237650000627     C                   EXSR      AGGFST
237660000627     C                   MOVEL     BLPFST        §LPBAM
237670000627     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
237680000627     C                   CLEAR                   §LPFTM
237690000627     C   04SAVFTM        IFEQ      'S'
237700000627     C     VIDFTM        OREQ      'S'
237710000627     C                   MOVEL     'S'           §LPFTM
237720000627     C                   ENDIF
237730000627     C* SE NON IMMESSO TIPO SERVIZIO
237740000627     C     VIDTSP        IFNE      *BLANKS
237750000627    1C                   MOVEL     VIDTSP        §LPTSP
237760000627     C                   ELSE
237770000627     C* LO PRENDO DA TARIFFA
237780000627     C                   MOVEL     COMTSP        §LPTSP
237790000627     C                   ENDIF
237800000627     C                   MOVEL     VIDIAS        §LPIAS
237810011113     C     VIDIAS        IFGT      *ZEROS
237820011113     C                   MOVEL     VIDVAS        §LPVAS
237830011113     C                   ELSE
237840011113     C                   CLEAR                   §LPVAS
237850011113     C                   ENDIF
237860000627     C                   MOVEL     VIDVMD        §LPVMD
237870011113     C     VIDVMD        IFGT      *ZEROS
237880011113     C                   MOVEL     VIDVAD        §LPVAD
237890011113     C                   ELSE
237900011113     C                   CLEAR                   §LPVAD
237910011113     C                   ENDIF
237920000627     C                   MOVEL     VIDQFT        §LPQFT
237930000627     C                   MOVEL     VIDNAS        §LPNAS
237940000627     C                   MOVEL     V1CNCL        §LPNCL
237950000627     C                   MOVEL     V2CPKG        §LPPKB
237960000627     C                   MOVEL     VIDFVR        §LPFVB
237970000627     C                   MOVEL     VARVOL        §LPVLB
237980000627     C                   MOVEL     VIDFFD        §LPFFD
237990010214     C     VIDFFD        IFEQ      'N'
238000010214     C                   MOVE      *BLANKS       §LPFFD
238010010214     C                   ENDIF
238020000627     C                   MOVEL     VIDTCR        §LPTCR
238030000627     C                   MOVEL     COMDCR        §LPDCR
238040000627     C                   MOVEL     VIDHCR        §LPHCR
238050000627     C                   MOVE      VIDMCR        §LPHCR
238060000627     C*
238070000627     C                   MOVEL     VIDNT1        §LPNOT
238080000627     C                   MOVEL     VIDNT2        §LPNT2
238090000627     C***
238100000627     C***  F L A G   I N O L T R O
238110000627     C                   EXSR      INOLTR
238120000627     C                   MOVEL     WFIN          §LPFIN
238130000627     C*
238140000627     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
238150000627    2C     APDFCM        IFNE      ' '
238160000627     C                   MOVEL     'C'           §LPFAP
238170000627     C                   ELSE
238180000627     C                   MOVEL     COMFAP        §LPFAP
238190000627    2C                   END
238200050114     c* flag unificazione spedizioni
238210050114     c                   if        *in12 and *in15
238220050114     c                   eval      §lpxco = wxco
238230050114     c                   endif
238240000627     C**
238250000627     C                   ENDSR
238260940927     C*
238270940927     C* CARICAMENTO BOLLE: DECODIFICHE -------------------------------*
238280940927     C     DECBOL        BEGSR
238290961007     C                   SETOFF                                       0413
238300950410     C                   SETOFF                                       131487
238310940927     C                   SETOFF                                       364494
238320940928     C*
238330940928     C* SE EMETTO 1 VIDEATA MI POSIZIONO SEMPRE SUL MITTENTE
238340010222     C* O SUL NUMERO ORM SE ATTIVATA PROCEDURA E SONO IM MANUTENZIONE
238350961007     C                   SETON                                        0730
238360940927     C*
238370940927     C* M I T T E N T E
238380960926     C* LNP CODICE <> LNP BOLLA: IMPOSTO P.O. CLIENTE
238390950103     C     W0030         IFNE      VIDLNP
238400950103     C                   MOVEL     W0030         VIDFLC
238410950103     C                   SETON                                        14
238420940927     C                   ENDIF
238430950103     C*
238440940927     C* C O D I C E   B O L L A
238450940927     C                   MOVEL     '3A'          COD
238460940927     C                   MOVEL(P)  VIDCBO        KEY
238470940927     C                   EXSR      CTABEL
238480940927     C  N30              MOVEL     TBLUNI        DS3A
238490940927     C  N30              MOVEL     §3ATB1        FLGTB1
238500940927     C   30              MOVEL     'F'           FLGTB1
238510070427     c                   move      flgtb1        savtb1
238520120926     c   30              clear                   savrbl
238530120926     c  n30              movel     §3arbl        savrbl
238540940927     C*
238550940927     C     FLGTB1        IFEQ      'A'
238560940927     C                   SETON                                        04
238570940927     C                   END
238580940927     C*
238590940927     C* CODICE BOLLA NON MANUTENZIONABILE
238600940927     C     §3AUCB        IFEQ      'N'
238610940927     C                   SETON                                        44
238620940927     C                   END
238630051123     c* Proteggo il codice bolla se in manutenzione o conferma bolle
238640051123     c* e bolla monovaria
238650051123     c                   if        *in12 = *on and §3asva <> *blanks
238660051123     c                   Movel     Prot1         AtrCbo
238670051123     c                   endif
238680940927     C* P A R T I T A   I V A
238690050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
238700050921     c                   select
238710050921     c* solo numeri
238720070427     c* "PRIVATO senza iso
238730050921     c     *in30         wheneq    *off
238740050921     c     wiso          andge     *zeros
238750050921     c     *in30         oreq      *on
238760050921     c     posiz         andlt     3
238770050921     c  n04              movel     wpiva         vidcpm
238780050921     c   04              movel     wpiva         vidcpd
238790050921     c* iso + numeri
238800050921     c* iso + "PRIVATO"
238810050921     c     *in30         wheneq    *off
238820050921     c     posiz         orgt      2
238830050921     c  n04              movel     wpiva         vidpim
238840050921     c   04              movel     wpiva         vidpid
238850050921     c                   endsl
238860050921     C***  *IN30         IFEQ      *ON
238870050921     C***  WISO          ORGE      *ZEROS
238880050921     C**N04              MOVEL     WPIVA         VIDCPM
238890050921     C** 04              MOVEL     WPIVA         VIDCPD
238900050921     C**                 ELSE
238910050921     C**N04              MOVEL     WPIVA         VIDPIM
238920050921     C** 04              MOVEL     WPIVA         VIDPID
238930050921     C**                 ENDIF
238940940927     C*
238950940927     C* L I N E A   D I   A R R I V O
238960941011     C                   MOVEL     VIDLNA        SAVLNA
238970940927     C     VIDLNA        IFGT      *ZEROS
238980941011     C                   MOVEL     VIDLNA        COMLNA
238990940927     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
239000940927     C  N30              MOVEL     ORGDES        V1DLNA
239010940927     C   30              MOVEL     *BLANKS       V1DLNA
239020020213     C                   MOVEL     ORGDE3        A_OG143
239030060707     C                   MOVEL     a_§ogntw      savaogntw
239040040525     C                   MOVEL     ORGDF0        A_OG150
239050020215     c                   movel     A_§ogntw      savntw
239060940927     C                   ENDIF
239070940927     C*
239080941011     C* C O D I C E   P A D R O N C I N O
239090990702     C                   CLEAR                   V1DPDR
239100941011     C     VIDPDR        IFGT      *ZEROS
239110941011     C                   MOVEL     VIDLNP        W0070
239120941011     C                   MOVE      VIDPDR        W0070
239130021204     C                   move      w0070         kpdpdr
239140021203     C                   move      'A'           kpdtip
239150021203     C     kfapd         chain     fiapd01l                           30
239160941011     C  N30              MOVEL     APDRSC        V1DPDR
239170940927     C   30              CLEAR                   V1DPDR
239180941011     C                   ENDIF
239190941107     C*
239200941107     C* T I P O   S E R V I Z I O
239210941107     C     VIDTSP        IFNE      ' '
239220941107     C                   Z-ADD     1             C
239230941107     C     VIDTSP        LOOKUP    TSP(C)                                 30
239240090604     C**!30              MOVEL     DTS(C)        V1DTSP
239250090604     C   30              MOVEL     DTS08(C)      V1DTSP
239260941107     C                   ENDIF
239270941115     C*
239280941115     C* C O N S E G N E   P A R T I C O L A R I
239290941115     C                   MOVEL     '1P'          COD
239300941115     C     VIDTC1        IFNE      *BLANKS
239310941115     C                   MOVEL(P)  VIDTC1        KEY
239320941115     C                   EXSR      CTABEL
239330941115     C  N30              MOVEL     TBLUNI        V2DTC1
239340941115     C                   ENDIF
239350941115     C     VIDTC2        IFNE      *BLANKS
239360941115     C                   MOVEL(P)  VIDTC2        KEY
239370941115     C                   EXSR      CTABEL
239380941115     C  N30              MOVEL     TBLUNI        V2DTC2
239390941115     C                   ENDIF
239400940927     C*
239410940927     C* S I G L A   O P E R A T O R E
239420940927     C* SE E' IN TABELLA  3M  SIGNIFICA CHE NON SI PUO' MANUTENZIONARE
239430940927     C                   MOVEL     '3M'          COD
239440940927     C                   MOVEL(P)  VIDSOP        KEY
239450940927     C                   EXSR      CTABEL
239460940927     C* SE TROVATA IN TABELLA --> PROTEGGO IL CAMPO
239470940927     C     *IN30         IFEQ      *OFF
239480940927     C                   SETON                                        13
239490940927     C                   END
239500940929     C* E S E N Z I O N E   I V A
239510940929     C     VIDCEI        IFNE      ' '
239520940929     C                   MOVEL     'EI'          COD
239530940929     C                   MOVEL(P)  VIDCEI        KEY
239540940929     C                   EXSR      CTABEL
239550940929     C  N30              MOVEL     TBLUNI        V3DCEI
239560940929     C                   ENDIF
239570940927     C* G I R O   D A T E
239580940927     C                   CLEAR                   WLBDAT
239590940927     C                   MOVE      BLPDSP        G02INV
239600940927     C                   MOVEL     '3'           G02ERR
239610940927     C                   CALL      'XSRDA8'
239620940927     C                   PARM                    WLBDAT
239630940927     C                   MOVEL     G02DAT        VIDDSP
239640940927     C* LA CONTROLLO SEMPRE LA DATA RITIRO
239650940927     C                   CLEAR                   SAVDRT
239660940927     C*
239670940927     C                   CLEAR                   WLBDAT
239680940927     C                   Z-ADD     VIDDRT        G02INV
239690940927     C                   MOVEL     '3'           G02ERR
239700940927     C                   CALL      'XSRDA8'
239710940927     C                   PARM                    WLBDAT
239720940927     C                   MOVEL     G02DAT        VIDDRT
239730010221     C                   Z-ADD     VIDDRT        PREDRT
239740070829     C                   Z-ADD     VIDDRT        s_drtblp
239750940927     C*
239760940927     C                   CLEAR                   WLBDAT
239770940927     C                   Z-ADD     VIDDCR        G02INV
239780940927     C                   MOVEL     '3'           G02ERR
239790940927     C                   CALL      'XSRDA8'
239800940927     C                   PARM                    WLBDAT
239810940927     C                   MOVEL     G02DAT        VIDDCR
239820940929     C*
239830940929     C                   CLEAR                   WLBDAT
239840940929     C                   Z-ADD     VIDDFT        G02INV
239850941115     C                   MOVEL     '3'           G02ERR
239860940929     C                   CALL      'XSRDA8'
239870940929     C                   PARM                    WLBDAT
239880940929     C                   Z-ADD     G02DAT        VIDDFT
239890940927     C                   ENDSR
239900910117     C*
239910910117     C*--- CREO RECORD PER STAMPA BOLLA ------------------------------*
239920910117     C     CRTBLD        BEGSR
239930910129     C  N12              MOVEL     *BLANKS       BLDATB
239940910201     C                   MOVEL     BLPLNP        BLDLNP
239950910117     C                   MOVEL     BLPAAS        BLDAAS
239960910117     C                   MOVEL     BLPNSP        BLDNSP
239970910117     C                   MOVEL     BLPNRS        BLDNRS
239980940214     C*
239990991201     C* RIFERIMENTO MITTENTE ALFABETICO, SE LNP DPD SCRIVO NUMERICO
240000910411     C     §1BFG7        IFNE      'S'
240010020319     C     §OGNTW        IFNE      'DPD'
240020940825     C                   MOVEL     BLPRMA        BLDCDP
240030991201     C                   ELSE
240040060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
240050060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
240060060622     c* in ogni caso non lo prendo più dal rmn
240070060622     c                   if        %subst(§b4ipn:14:1)=*blanks
240080060622     C                   eval      bldcdp=%subst(§b4ipn:1:3) + ' ' +
240090060622     c                             %subst(§b4ipn:4:8) + ' ' +
240100060622     c                             §b4icd
240110060622     c                   else
240120060622     c                   eval      bldcdp=§b4ipn
240130060622     c                   endif
240140991201     C                   ENDIF
240150940214     C                   ENDIF
240160940214     C*
240170910201     C  N12              MOVEL     *BLANKS       BLDFST
240180910220     C  N12              Z-ADD     1             BLDNC1
240190971215     C   12
240200971215     CAN 15              SELECT
240210971215     C* DEVO RISTAMPARE ENTRAMBE LE ETICHETTE
240220971215     C     §1BFG9        WHENEQ    'S'
240230951019     C     §1BFG6        ANDEQ     'C'
240240951019     C                   MOVEL     'S'           BLDFST
240250971215     C* DEVO STAMPARE SOLO ETICHETTA ESTERA
240260971215     C     §1BFG0        WHENEQ    'D'
240270971215     C     §1BFG6        ANDEQ     'C'
240280971215     C                   MOVEL     'E'           BLDFST
240290971217     C     §1BFG0        WHENEQ    'C'
240300971217     C     §1BFG6        ANDEQ     'C'
240310971217     C     §1BF11        ANDEQ     'D'
240320971217     C                   MOVEL     'E'           BLDFST
240330971215     C                   OTHER
240340951019     C                   MOVEL     ' '           BLDFST
240350971215     C                   ENDSL
240360971215     C*
240370971215     C                   MOVEL     BLPPDR        BLDPDR
240380910205     C                   MOVEL     BLPLNA        BLDLNA
240390910205     C                   MOVEL     BLPTFA        BLDTFA
240400910405     C                   MOVEL     BLPRSD        BLDRSD
240410910412     C                   MOVEL     BLPRSM        BLDRSM
240420910117     C     BLPCCM        IFGT      0
240430910117     C                   MOVEL     BLPCCM        BLDCCM
240440910117     C                   ELSE
240450910117     C                   MOVEL     BLPKSC        BLDCCM
240460910117     C                   END
240470000204     C**
240480000204     C* SE DEVO CREARE IL FILE METTO LA "S" DI STAMPATO
240490000204     C     WDKC          IFEQ      'S'
240500001003     C     WSGNR         OREQ      'B'
240510000211     C                   EXSR      STASCD
240520001005     C* Reimposto a "S" flag per scrittura fisgn in ristampa perchè
240530001005     C* se viene richiamato deve essere lanciato il pgm di stampa e non
240540001005     C* deve più scrivere fisgn
240550001005     C     WSGNR         IFEQ      'B'
240560001005     C                   MOVEL     'S'           WSGNR
240570001005     C                   ENDIF
240580000914     C                   ENDIF
240590000211     C*
240600000914     C* SE DISK C FLAGGO COME STAMPATO BLDFST
240610020917     C* SE FLAG 12 = E (DISK A CON FIVAT) FLAGGO SOLO SE AS400 ABILITA-
240620001106     C* TO AL DISK C
240630000914     C     *IN79         IFEQ      *ON
240640000925     C     §3CDKC        ANDEQ     'S'
240650000914     C     §1BF12        ORNE      'N'
240660001106     C     §1BF12        ANDNE     'E'
240670001106     C     §1BF12        OREQ      'E'
240680001106     C     WASDKC        ANDEQ     'S'
240690000204     C                   MOVEL     'S'           BLDFST
240700000211     C                   ENDIF
240710910117     C*
240720910204     C   15
240730000911     CORN12
240740000915     COR 12
240750000915     CANN15
240760000915     CAN 33              WRITE     FNBLD000
240770000915     C   12
240780000915     CANN15
240790000915     CANN33              UPDATE    FNBLD000
240800940214     C*
240810940214     C* SE LI AVEVO GIA' STAMPATI LI RISTAMPO SUBITO
240820971217     C*  NON VENGONO RISTAMPATI SE SONO SOLO ESTERO
240830980409     C*  NON RISTAMPO ANCHE SE E' UNA SOLUZIONE A E NON HANNO VARIATO
240840980409     C*  NESSUNO DEI CAMPI CHE INTERESSANO (N.COLLI,LNA,ZONA,CAP DEST.,
240850980409     C*  TSP.) --> WPRT = "N"
240860971217     C     SAVFST        IFEQ      'S'
240870980409     C     WPRT          ANDEQ     ' '
240880001003     C* PER DISK C STASCD L'HO GIA' RICHIAMATA
240890000915     C     WDKC          IFNE      'S'
240900940214     C                   EXSR      STASCD
240910000915     C                   ENDIF
240920060216     C* SE C'E' Fiar4 PER LNA ESTERO SDI AGGIORNO IL FLAG DI STAMPA
240930081008     C**   *IN12         IFEQ      *ON
240940081008     C**   *IN15         ANDEQ     *OFF
240950081008     c**   A_§ogntw      andeq     'EUP'
240960081008     C**                 MOVEL     'E'           WTRC
240970081008     C**   KBLP4         CHAIN     Fiar4000                           90
240980081008    2C**   *IN90         IFEQ      *OFF
240990081008     C**                 MOVEL     ar4NOT        DSBL4E
241000081008     C**                 MOVEL     'S'           §B4EST
241010081008     C**                 MOVEL     DSBL4E        ar4NOT
241020081008     C**                 UPDATE    Fiar4000
241030081008     C**                 ENDIF
241040081008     C**                 SETOFF                                       90
241050081008     C**                 ENDIF
241060971230     C                   ENDIF
241070910117     C*
241080910117     C                   ENDSR
241090940927     C*
241100940927     C* CARICO LA VARIA IN SFL ---------------------------------------*
241110940927     C     CARVAR        BEGSR
241120991012      *
241130991027     C     WSVN          IFNE      ' '
241140950418     C     *IN87         OREQ      *ON
241150991027      *
241160991027     C     WSVN          IFNE      §$2IVA
241170991027     C     WSVN          ANDNE     §$2BOL
241180991027      *
241190940927     C                   ADD       1             NRR
241200940927     C     NRR           CHAIN     LS01S03                            30
241210991027     C                   MOVEL     WSVN          V3CSV1
241220991027     C                   Z-ADD     WVAN          V3CVA1
241230991027     C                   Z-ADD     WVAN          V3HVA1
241240020102    3C     WCONV         IFEQ      '1'
241250020102     C     WVAN          ANDGT     0
241260020102    4C     VIDIMV        IFGT      *ZEROS
241270020102     C     WSVN          ORNE      'N'
241280020102     C     WVAN          ORNE      88888888
241290020102     C                   CLEAR                   DSYEUR
241300020102     C                   MOVEL     VIDDIV        YECDVI
241310020102     C                   MOVEL     §GEDCN        YECDVO
241320020102     C                   Z-ADD     WVAN          YECIMI
241330020102     C     COMFDC        IFEQ      'S'
241340020102     C                   MOVEL     '3'           YECDCO
241350020102     C                   ELSE
241360020102     C                   MOVEL     '0'           YECDCO
241370020102     C                   ENDIF
241380020102     C                   CALL      'YEURCO'
241390020102     C                   PARM                    DSYEUR
241400020102    5C     YECESI        IFEQ      ' '
241410020102     C                   Z-ADD     YECIMO        V3CVA1
241420020102     C                   Z-ADD     YECIMO        V3HVA1
241430020102    5C                   ENDIF
241440020102    4C                   ENDIF
241450020102    3C                   ENDIF
241460941021     C                   MOVEL     WEV1          V3CEV1
241470940927     C   30              WRITE     LS01S03
241480940927     C  N30              UPDATE    LS01S03
241490991027      *
241500940927     C                   ENDIF
241510991027     C                   ENDIF
241520991012      *
241530940927     C                   ENDSR
241540910117     C*
241550971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO ----------------------------*
241560910201     C     STASCI        BEGSR
241570000121     C                   MOVEL     'I'           WSTSEG            1
241580000121     C                   EXSR      RIESEG
241590971215     C**
241600971215     C**  SOLO SE DEVO STAMPARE QUALCHE COSA
241610971215     C     §DETST        IFNE      *BLANKS
241620001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
241630001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
241640001005     C   12
241650001005     CANN15WSGNR         IFEQ      'B'
241660001005     C     KBLP3         SETLL     FISGN05L
241670001005     C                   ENDIF
241680971215     C     CO2SCD        DOWLE     STANCA
241690990318     C     CO2SCD        ANDGT     0
241700980320     C* Routine per segnacolli euroexpress: imposta §DEEUR e §LDCDP
241710980320     C                   EXSR      EUREXP
241720980319     C*
241730910208     C                   ADD       1             §LDNC1
241740911119     C                   Z-ADD     CO2SCD        §LDNCD
241750910201     C*
241760000914     C* SE DISK C NON STAMPO MAI IN IMMEDIATO
241770001018     C* ANCHE SE SCRIVO FISGN SOLO PER RISTAMPA E HO VBARIATO CAMPI
241780001018     C* PER I QUALI NON È NECESSARIO RISTAMPARE IMMEDIATAMENTE L'ETICH.
241790050302     C     *IN79         IFEQ      *OFF
241800050302     C     §1BF12        ANDEQ     'N'
241810050302     C     WNOPRT        ANDNE     '1'
241820001107     C*
241830050302     C     §1BF12        oreq      'E'
241840050302     C     WASDKC        ANDNE     'S'
241850050302     C     WNOPRT        ANDNE     '1'
241860001107     C*
241870050302     C     §1BF12        OREQ      'N'
241880050302     C     *IN79         ANDEQ     *ON
241890050302     C     §3CDKC        ANDNE     'S'
241900050302     C     WNOPRT        ANDNE     '1'
241910001107     C*
241920030611     C                   CALL      WD90pss
241930910201     C                   PARM                    DSBLD
241940971216     C                   PARM                    DSBLDE
241950001005     C                   ENDIF
241960001107     C* SCRITTURA/AGGIORNAMENTO FISGN00F: PER DISKC O PER SOLA RISTAMP
241970050302     C     §1BF12        IFNE      'N'
241980050302     C     §1BF12        ANDNE     'E'
241990050302     C     §1BF12        OREQ      'E'
242000050302     C     WASDKC        ANDEQ     'S'
242010050302     C     *IN79         OREQ      *ON
242020050302     C     §3CDKC        ANDEQ     'S'
242030001005     C     WSGNR         OREQ      'B'
242040000225     C*
242050000225     C* PULISCO PERCHE' HO AGGIORNATO
242060000913    3C                   SELECT
242070050225     c* import dpd (ctm disk c)
242080050225     c     §1bf12        whenne    'N'
242090050225     c     *in79         andeq     *on
242100050302     c     wdkc          ifeq      'S'
242110050225     C     WESSGN        IFEQ      'S'
242120050225     C                   EXSR      UPDSGN
242130050225     C                   ELSE
242140050225     C                   Z-ADD     COMTFP        SGNTNP
242150050225     C                   WRITE     FISGN000
242160050225     C                   ENDIF
242170060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
242180060622     c* anche fisgn con key composta dal solo numero parcel
242190060622     c                   if        §b4ibi<>*blanks
242200060622     c                             and %subst(§b4ipn:14:1)=*blanks
242210060622     c                   clear                   kwho
242220060622     C                   movel     §b4ipn        kwho
242230060622     C                   eval      %subst(kwho:12:1)=§b4icd
242240060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
242250060623     c* serviranno per la seconda scrittura
242260060623     C                   MOVEL     DSBLD         WSBLD
242270060623     C                   MOVEL     DSBLDE        WSBLDE
242280060622     C                   CLEAR                   WESSGN
242290060622     C                   CLEAR                   WSGNR
242300060622     C                   CLEAR                   FISGN000
242310060622     C                   MOVEL     'S'           WDKC              1
242320060622     C                   EXSR      CTRSGN
242330060622     C     WDKC          IFEQ      'S'
242340060623     C                   MOVEL     WSBLD         dsbld
242350060623     C                   MOVEL     WSBLDE        dsblde
242360060622     C     WESSGN        IFEQ      'S'
242370060622     C                   EXSR      UPDSGN
242380060622     C                   ELSE
242390060622     C                   Z-ADD     COMTFP        SGNTNP
242400060622     C                   WRITE     FISGN000
242410060622     C                   ENDIF
242420060622     C                   ENDIF
242430060622     c                   endif
242440050302     C                   ENDIF
242450050221     C* EXPORT DPD DA VAT O MANUALE
242460001009     C     §1BF12        WHENNE    'N'
242470001011     C     WEXDPD        ANDEQ     'S'
242480001009     C     §1BF13        ANDNE     'A'
242490070323     c     wparcel       andne     '12'
242500050302     C     WDKC          IFEQ      'S'
242510001009     C     WESSGN        IFEQ      'S'
242520001009     C                   EXSR      UPDSGN
242530001009     C                   ELSE
242540010116     C                   Z-ADD     COMTFP        SGNTNP
242550001009     C                   WRITE     FISGN000
242560001009     C                   ENDIF
242570050302     C                   ENDIF
242580000912     C     §1BF12        WHENNE    'N'
242590000911     C                   Z-ADD     CO2SCD        WO2SCD
242600000911     C                   MOVEL     'C'           WTRC
242610051102     C     KARS01        CHAIN(N)  FIARS01L                           30
242620000913    4C     *IN30         IFEQ      *OFF
242630000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
242640000911     C                   Z-ADD     1             IX
242650051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
242660000911     C     POS(IX)       CHAIN     LS01S08                            30
242670000204     C*
242680000204     C* SCRITTURA DEL FILE  PER DISK "C"
242690000913    5C     V8HDKC        IFEQ      'S'
242700000913    6C     V8HESG        IFEQ      'S'
242710000919     C                   MOVEL     DSBLD         WSBLD
242720000919     C                   MOVEL     DSBLDE        WSBLDE
242730010116     C     KSGN8         CHAIN     FISGN01L                           30
242740000919     C                   MOVEL     WSBLD         DSBLD
242750000919     C                   MOVEL     WSBLDE        DSBLDE
242760000921     C                   EXSR      UPDSGN
242770000913   X6C                   ELSE
242780000929     C                   EXSR      WRTSGN
242790000913    6C                   ENDIF
242800000913    5C                   ENDIF
242810000913    4C                   ENDIF
242820050225     C* IMPORT DPD (ctm no diskc)
242830000912     C     *IN79         WHENEQ    *ON
242840000912     C     WESSGN        IFEQ      'S'
242850000921     C                   EXSR      UPDSGN
242860000912     C                   ELSE
242870010116     C                   Z-ADD     COMTFP        SGNTNP
242880000912     C                   WRITE     FISGN000
242890000912     C                   ENDIF
242900001005     C* SCRIVO O UPDATO FISGN PER RISTAMPA
242910001005     C     WSGNR         WHENEQ    'B'
242920001005     C                   MOVEL     DSBLD         WSBLD
242930001005     C                   MOVEL     DSBLDE        WSBLDE
242940001005     C     KBLP3         READE     FISGN05L                               30
242950001013     C                   MOVE      *IN30         WIN30
242960001005     C                   MOVEL     WSBLD         DSBLD
242970001005     C                   MOVEL     WSBLDE        DSBLDE
242980001013     C                   CLEAR                   DSBLD7
242990001013     C                   MOVE      §LDLNP        §LCLNP
243000001013     C                   MOVE      §LDLNA        §LCLNA
243010001013     C                   MOVE      §LDNRS        §LCNRS
243020001013     C                   MOVE      §LDZSC        §LCZSC
243030001013     C                   MOVE      §LDNCD        §LCNCD
243040001013     C                   EXSR      M10
243050001013     C                   MOVEA     §CA           SGNWHO
243060001013     C                   MOVEA     §CA           V8CNOT
243070001013     C                   MOVE      WIN30         *IN30
243080001005     C     *IN30         IFEQ      *OFF
243090001005     C                   EXSR      UPDSGN
243100001005     C                   ELSE
243110001005     C                   EXSR      WRTSGN
243120001005     C                   ENDIF
243130000913    3C                   ENDSL
243140000204     C                   ENDIF
243150910201     C*
243160910827     C                   ADD       1             CO2SCD
243170910201     C*
243180971215     C                   ENDDO
243190001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
243200001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
243210001005     C   12
243220001005     CANN15WSGNR         IFEQ      'B'
243230001005     C     VIDNCL        ANDLT     SAVNCL
243240001005     C     KBLP3         READE     FISGN05L                               30
243250001005     C     *IN30         DOWEQ     *OFF
243260001005     C                   EXSR      ANNSGN
243270001005     C     KBLP3         READE     FISGN05L                               30
243280001005     C                   ENDDO
243290001005     C                   ENDIF
243300971215     C                   ENDIF
243310910404     C*
243320910117     C                   ENDSR
243330000121     C*
243340000121     C* RIEMPO DS PER STAMPA SEGNACOLLI ------------------------------*
243350000121     C     RIESEG        BEGSR
243360000124     C                   CLEAR                   §DEEUR
243370000124     C                   CLEAR                   §DEAWB
243380000124     C                   CLEAR                   §DEFCA
243390040506     C                   CLEAR                   §DEISA
243400000124     C                   CLEAR                   §DESIA
243410000201     C                   CLEAR                   §DESSE
243420010302     C                   CLEAR                   SAVCDP
243430000124     C*
243440000121     C     WSTSEG        IFEQ      'I'
243450000929     C* WSGNR = 'S' --> Scrivo fisgn per eventuale ristampa
243460001107     C* (Se provengo da manutenzione non devo azzerare nc1 prechè in
243470001107     C*  questo caso devo richiamare pgm di stampa e non scrittura di
243480001107     C*  fisgn. Se azzerassi, la stampa del progressivo sull'etichetta
243490001107     C*  partirebbe da 0 anzichè da 1)
243500000929     C     WSGNR         OREQ      'S'
243510001107     C     *IN12         ANDEQ     *OFF
243520001107     C     WSGNR         OREQ      'S'
243530001107     C     *IN15         ANDEQ     *ON
243540000121     C                   Z-ADD     0             §LDNC1
243550000121     C                   ELSE
243560000121     C                   Z-ADD     BLDNC1        §LDNC1
243570000121     C                   ENDIF
243580000208     C*
243590000208     C                   MOVEL     WDLA          §LDDLA
243600000208     C                   MOVEL     BLPFLS        §LDLNP
243610000121     C     BLPFLS        CHAIN     AZORG01L      UNIORG               30
243620000121     C  N30              MOVEL     ORGDES        §LDDLP
243630000121     C   30              MOVEL     *BLANKS       §LDDLP
243640000121     C     WSTSEG        IFEQ      'D'
243650000121     C                   MOVEL     BLDCDP        §LDCDP
243660000121     C                   ELSE
243670000121      * RIFERIMENTO MITTENTE ALFABETICO
243680000121     C                   MOVEL     BLPRMA        §LDCDP
243690000121     C                   ENDIF
243700000121      *
243710000121      * SE LNP DPD SCRIVO NUMERICO
243720020319     C     §OGNTW        IFEQ      'DPD'
243730060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
243740060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
243750060622     c* in ogni caso non lo prendo più dal rmn
243760060622     c                   if        %subst(§b4ipn:14:1)=*blanks
243770060622     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
243780060622     c                             %subst(§b4ipn:4:8) + ' ' +
243790060622     c                             §b4icd
243800060622     c                   else
243810060622     c                   eval      §ldcdp=§b4ipn
243820060622     c                   endif
243830000121     C                   ENDIF
243840000121      *
243850000121      * PER EXPORT DPD SCRIVO NUMERO PARCEL
243860020319    1C     A_§OGNTW      IFEQ      'DPD'
243870060510    2C     §B4ipn        ANDNE     *BLANKS
243880010302     C* Se RMA diverso da blanks lo devo stampare, allineato a dx,
243890120302     C* nella prima riga di stampa dell'etichetta brt andando
243900010302     C* a coprire in parte la ragione sociale del mittente
243910010302     C* In questo punto mi salvo quindi il rma che andrò a muovere
243920010302     c* nela campo della ragione sociale se <> da blank (v.sotto)
243930060510     c* ATTENZIONE: per numero parcel lungo 14 continuiamo a stamparlo
243940120302     c* sull'etichetta brt ma non più distanziato in quanto
243950060510     c* §ldcdp non è abbastanza lungo
243960010302     C                   MOVE      §LDCDP        SAVCDP
243970060626     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
243980060626     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
243990060626     c                   if        %subst(§b4ipn:14:1)=*blanks
244000060626     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
244010060626     c                             %subst(§b4ipn:4:8) + ' ' +
244020060626     c                             §b4icd
244030060626     c                   else
244040060626     c                   eval      §ldcdp=§b4ipn
244050060626     c                   endif
244060000121    2C                   ENDIF
244070020211     c*
244080020211      * PER EXPORT FEDEX SCRIVO AWB
244090020213    1C     A_§ogntw      IFEQ      'FED'
244100020211     C                   MOVEL     §B4ERP        §LDCDP
244110020211    1C                   ENDIF
244120000201     C*
244130000201     C* ALTRI DATI ETICHETTA ESTERA
244140000201     C                   EXSR      ETIEST
244150000121     C*
244160000121     C                   MOVEL     BLPNRS        §LDNRS
244170000121     C                   MOVEL     BLPLNA        §LDLNA
244180000121     C                   MOVEL     BLPTFA        §LDTNA
244190000121     C                   MOVE      BLPPDR        §LDCPD
244200000121     C                   MOVEL     BLPTSP        §LDTSP
244210000121     C                   MOVEL     BLPZNC        §LDZSC
244220000121     C                   MOVE      BLPNCL        §LDNC2
244230000121     C                   MOVEL     BLPRSM        §LDRSM
244240010302     C* SOLO PER SEGNACOLLI EXPORT DPD:
244250010302     C* MUOVO ALLINEATO, A SX DELLA RSM, IL RMA SE <> DA BLANKS
244260010302     C* E LO COMPATTO PERDENDO CIOÈ I BLANK NON SIGNIFICATIVI
244270010302     C     SAVCDP        IFNE      *BLANKS
244280010302     C                   CLEAR                   W35
244290010302     C                   MOVEA     SAVCDP        W35
244300010302     C     ' '           CHECKR    SAVCDP        §Z                2 0
244310010302     C                   ADD       2             §Z
244320010302     C                   MOVEA     BLPRSM        W35(§Z)
244330010302     C                   MOVEA     W35           §LDRSM
244340010302     C                   ENDIF
244350000121     C                   MOVEL     BLPPRM        §LDPRM
244360000121     C                   MOVEL     BLPRSD        §LDRSD
244370000121     C                   MOVEL     BLPCAD        §LDCAD
244380000121     C                   MOVEL     BLPLOD        §LDLOD
244390000121     C                   MOVEL     BLPIND        §LDIND
244400000121     C                   MOVE      BLPPRD        §LDPRD
244410000121     C                   MOVEL     *ZEROS        §LDNCP
244420000121     C                   MOVEL     *ZEROS        §LDNCU
244430000121     C                   MOVEL     BLPFVF        §LDFVR
244440000121     C                   MOVEL     BLPVLF        §LDVOL
244450000121     C                   MOVEL     BLPPKF        §LDPKG
244460000121     C                   MOVEL     BLPAAS        §LDAAS
244470000121     C                   MOVEL     BLPMGS        §LDMGS
244480050422     c                   clear                   §ldrst
244490050422     c* in conferma o in immissione imposto "V" di valore se collo
244500050422     c* di valore
244510050422     c                   if        (*in12 = *off or *in15 = *on) and
244520050422     c                             vidbva <> *blanks
244530050422     c                   eval      §ldrst = 'V'
244540050422     c                   endif
244550050422     c* in manutenzione metto "M" se modificato no collo di valore
244560050422     c*                 metto "W" se modificato    collo di valore
244570050422     C     *IN12         IFEQ      *ON
244580050422     C     *IN15         ANDEQ     *OFF
244590050422     c     vidbva        ifeq      *blanks
244600050422     c* Se è un disk c non ha senso stampare l'etichetta con la "M" in
244610050422     c* quanto questa esce solo quando il collo passa sull'impianto
244620050422     c     wdkc          ifne      'S'
244630050422     c     wsgnr         andne     'B'
244640050422     C                   MOVEL     'M'           §LDRST
244650050422     c                   endif
244660050422     c                   else
244670050422     c     wdkc          ifne      'S'
244680050422     c     wsgnr         andne     'B'
244690050422     c                   movel     'W'           §ldrst
244700050422     c                   else
244710050422     c                   movel     'V'           §ldrst
244720050422     c                   endif
244730050422     c                   endif
244740050422     c                   endif
244750000121     C                   ENDSR
244760000929     C*
244770971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO COME RISTAMPA DEL "D" ------*
244780910201     C     STASCD        BEGSR
244790910201     C* RICHIAMO DIRETTAMENTE IL PROGRAMMA DI STAMPA SEGNACOLLO
244800910827     C                   Z-ADD     BLDNCD        CO2SCD
244810910201     C     BLDNCA        IFEQ      0
244820910201     C                   Z-ADD     BLDNCD        BLDNCA
244830910201     C                   END
244840040506     C* IMPOSTO DSBLDE
244850081008     C**   WESTER        IFEQ      'S'
244860081008     C**                 MOVEL     'ALL'         §DETST
244870081008     C**                 ELSE
244880040506     C                   MOVEL     'ITA'         §DETST
244890040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
244900040506     c* etichetta Italia con dati esteri
244910040506     C     A_§ogntw      IFEQ      'EEX'
244920040506     C                   MOVEL     'EEX'         §DETSE
244930040506     c                   else
244940040506     c                   clear                   §detse
244950040506     C                   ENDIF
244960081008     C***                ENDIF
244970000121     C* RIEMPO LE DS
244980060622     C                   MOVEL     'D'           WSTSEG
244990000121     C                   EXSR      RIESEG
245000000211     C**
245010000919     C*
245020001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
245030001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
245040001005     C   12
245050001005     CANN15WSGNR         IFEQ      'B'
245060001019     C     WSTSGN        ANDEQ     *BLANKS
245070001005     C     KBLP3         SETLL     FISGN05L
245080001019     C                   MOVE      '1'           WSTSGN            1
245090001005     C                   ENDIF
245100980320     C*
245110000908     C     CO2SCD        DOWLE     BLDNCA
245120990318     C     CO2SCD        ANDGT     0
245130980320     C* Routine per impostazione campi segnacollo euroexpress di dsblde
245140980320     C                   EXSR      EUREXP
245150911122     C                   Z-ADD     CO2SCD        §LDNCD
245160910201     C*
245170000204     C     WDKC          IFNE      'S'
245180001003     C     WSGNR         ANDNE     'B'
245190030611     C                   CALL      WD90pss
245200910201     C                   PARM                    DSBLD
245210971216     C                   PARM                    DSBLDE
245220000913     C                   ELSE
245230000225     C*
245240000225     C* PULISCO PERCHE' HO AGGIORNATO
245250000912    3C                   SELECT
245260050224     C* IMPORT DPD
245270050224     c     §1bf12        whenne    'N'
245280050224     C     *IN79         andeq     *ON
245290050224     C     WDKC          IFEQ      'S'
245300050224     C     WESSGN        IFEQ      'S'
245310050224     C                   EXSR      UPDSGN
245320050224     C                   ELSE
245330050224     C                   Z-ADD     COMTFP        SGNTNP
245340050224     C                   WRITE     FISGN000
245350050224     C                   ENDIF
245360050224     C                   ENDIF
245370060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
245380060622     c* anche fisgn con key composta dal solo numero parcel
245390060622     c                   if        §b4ibi<>*blanks
245400060622     c                             and %subst(§b4ipn:14:1)=*blanks
245410060622     c                   clear                   kwho
245420060622     C                   movel     §b4ipn        kwho
245430060622     C                   eval      %subst(kwho:12:1)=§b4icd
245440060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
245450060623     c* serviranno per la seconda scrittura
245460060623     C                   MOVEL     DSBLD         WSBLD
245470060623     C                   MOVEL     DSBLDE        WSBLDE
245480060622     C                   CLEAR                   WESSGN
245490060622     C                   CLEAR                   WSGNR
245500060622     C                   CLEAR                   FISGN000
245510060622     C                   MOVEL     'S'           WDKC              1
245520060622     C                   EXSR      CTRSGN
245530060622     C     WDKC          IFEQ      'S'
245540060623     C                   MOVEL     WSBLD         dsbld
245550060623     C                   MOVEL     WSBLDE        dsblde
245560060622     C     WESSGN        IFEQ      'S'
245570060622     C                   EXSR      UPDSGN
245580060622     C                   ELSE
245590060622     C                   Z-ADD     COMTFP        SGNTNP
245600060622     C                   WRITE     FISGN000
245610060622     C                   ENDIF
245620060622     C                   ENDIF
245630060622     c                   endif
245640050221     C* DISK C EXPORT DPD DA vat O MANUALE
245650001009     C     §1BF12        WHENNE    'N'
245660001011     C     WEXDPD        ANDEQ     'S'
245670001009     C     §1BF13        ANDNE     'A'
245680070323     C     wparcel       ANDNE     '12'
245690001009     C     WDKC          IFEQ      'S'
245700001009     C     WESSGN        IFEQ      'S'
245710001009     C                   EXSR      UPDSGN
245720001009     C                   ELSE
245730010116     C                   Z-ADD     COMTFP        SGNTNP
245740001009     C                   WRITE     FISGN000
245750001009     C                   ENDIF
245760001009     C                   ENDIF
245770000912     C     §1BF12        WHENNE    'N'
245780000911     C                   Z-ADD     CO2SCD        WO2SCD
245790000911     C                   MOVEL     'C'           WTRC
245800051102     C     KARS01        CHAIN(N)  FIARS01L                           30
245810000912    4C     *IN30         IFEQ      *OFF
245820000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
245830000911     C                   Z-ADD     1             IX
245840051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
245850000911     C     POS(IX)       CHAIN     LS01S08                            30
245860000204     C*
245870000204     C* SCRITTURA DEL FILE  PER DISK "C"
245880000912    5C     V8HDKC        IFEQ      'S'
245890000912    6C     V8HESG        IFEQ      'S'
245900000919     c* prima di chainare fisgn mi salvo la ds
245910000919     C                   MOVEL     DSBLD         WSBLD
245920000919     C                   MOVEL     DSBLDE        WSBLDE
245930010116     C     KSGN8         CHAIN     FISGN01L                           30
245940000919     C                   MOVEL     WSBLD         DSBLD
245950000919     C                   MOVEL     WSBLDE        DSBLDE
245960000912     C                   EXSR      UPDSGN
245970000912   X6C                   ELSE
245980000929     C                   EXSR      WRTSGN
245990000912    6C                   ENDIF
246000000912    5C                   ENDIF
246010000912    4C                   ENDIF
246020050224     C* IMPORT DPD (ctm no disk c)
246030000912     C     *IN79         WHENEQ    *ON
246040000912     C     WESSGN        IFEQ      'S'
246050000912     C                   EXSR      UPDSGN
246060000912     C                   ELSE
246070010116     C                   Z-ADD     COMTFP        SGNTNP
246080000912     C                   WRITE     FISGN000
246090000912     C                   ENDIF
246100001003     C* FISGN IN RISTAMPA
246110001003     C     WSGNR         WHENEQ    'B'
246120001005     c* prima di leggere fisgn mi salvo la ds
246130001005     C                   MOVEL     DSBLD         WSBLD
246140001005     C                   MOVEL     DSBLDE        WSBLDE
246150001005     C     KBLP3         READE     FISGN05L                               30
246160001013     C                   MOVE      *IN30         WIN30             1
246170001005     C                   MOVEL     WSBLD         DSBLD
246180001005     C                   MOVEL     WSBLDE        DSBLDE
246190001013     C                   CLEAR                   DSBLD7
246200001013     C                   MOVE      §LDLNP        §LCLNP
246210001013     C                   MOVE      §LDLNA        §LCLNA
246220001013     C                   MOVE      §LDNRS        §LCNRS
246230001013     C                   MOVE      §LDZSC        §LCZSC
246240001013     C                   MOVE      §LDNCD        §LCNCD
246250001013     C                   EXSR      M10
246260001013     C                   MOVEA     §CA           SGNWHO
246270001013     C                   MOVEA     §CA           V8CNOT
246280001013     C                   MOVE      WIN30         *IN30
246290001005     C     *IN30         IFEQ      *OFF
246300001005     C                   EXSR      UPDSGN
246310001005     C                   ELSE
246320001003     C                   EXSR      WRTSGN
246330001005     C                   ENDIF
246340000912    3C                   ENDSL
246350000911     C                   ENDIF
246360910201     C*
246370910827     C                   ADD       1             CO2SCD
246380910313     C                   ADD       1             §LDNC1
246390910201     C*
246400910201     C                   END
246410001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
246420001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
246430001005     C   12
246440001005     CANN15WSGNR         IFEQ      'B'
246450001005     C     VIDNCL        ANDLT     SAVNCL
246460001005     C     KBLP3         READE     FISGN05L                               30
246470001005     C     *IN30         DOWEQ     *OFF
246480001005     C                   EXSR      ANNSGN
246490001005     C     KBLP3         READE     FISGN05L                               30
246500001005     C                   ENDDO
246510001005     C                   ENDIF
246520910201     C                   ENDSR
246530910805     C*
246540910805     C*--- CREO FLBLT00F ---------------------------------------------*
246550910805     C     CRTBLT        BEGSR
246560940926     C                   CLEAR                   FNBLT000
246570910805     C                   MOVEL     BLPAAS        BLTAAS
246580940926     C                   MOVEL     BLPLNP        BLTLNP
246590910805     C                   MOVEL     BLPNRS        BLTNRS
246600000921     C                   MOVEL     BLPNSP        BLTNSP
246610910828     C                   MOVEL     BLPLNA        BLTLNA
246620910828     C                   MOVEL     BLPFLS        BLTFLS
246630060622     C                   MOVEL     BLPNFV        BLTNFV
246640920910     C                   MOVEL     BLPFLP        BLTFLP
246650940926     C                   MOVEL     WNSC          BLTNSC
246660940915     C                   WRITE     FNBLT000
246670120817     c* richiamo creazione dettaglio colli unico
246680120817     c                   exsr      crtFIART
246690980318     C*
246700000908     C* RICHIAMO CREAZIONE ESTENSIONE DETTAGLIO SEGNACOLLO
246710000908     C* PER MEMORIZZAZIONE COD. "CHI SONO"
246720051102     C                   EXSR      CRTARS
246730910805     C*
246740910805     C                   ENDSR
246750120814     C*--- CREO FIART00F ---------------------------------------------*
246760120814     C     crtFIART      BEGSR
246770120814     C                   CLEAR                   FIART000
246780120814     C                   MOVEL     BLPAAS        ARTAAS
246790120814     C                   MOVEL     BLPLNP        ARTLNP
246800120814     C                   MOVEL     BLPNRS        ARTNRS
246810120814     C                   MOVEL     BLPNSP        ARTNSP
246820120814     C                   MOVEL     BLPLNA        ARTLNA
246830120814     C                   MOVEL     BLPFLS        ARTFLS
246840120814     C                   MOVEL     BLPNFV        ARTNFV
246850120814     C                   MOVEL     BLPFLP        ARTFLP
246860120814     C                   MOVEL     WNSC          ARTNSC
246870120814     C                   WRITE     FIART000
246880120814     c                   endsr
246890051102     C*--- CREO FIARS00F ---------------------------------------------*
246900051102     C     CRTARS        BEGSR
246910001009     C*
246920001013    1C                   SELECT
246930050221     C* DISK C EXPORT DPD DA vat O MANUALE
246940001011     C     WEXDPD        WHENEQ    'S'
246950001009     C     §1BF13        ANDNE     'A'
246960001009     C     §1BF12        ANDNE     'N'
246970070322     c     wparcel       andne     '12'
246980051102     C                   CLEAR                   FIARS000
246990120817     C***                MOVE      BLTFLS        ARSFLS
247000120817     C***                MOVE      BLTLNA        ARSLNA
247010120817     C***                MOVE      BLTNRS        ARSNRS
247020120817     C***                MOVE      BLTNSC        ARSNSC
247030120817     C                   MOVE      ARTFLS        ARSFLS
247040120817     C                   MOVE      ARTLNA        ARSLNA
247050120817     C                   MOVE      ARTNRS        ARSNRS
247060120817     C                   MOVE      ARTNSC        ARSNSC
247070051102     C                   MOVEL     'C'           ARSTRC
247080051102     C                   MOVEL     V7CNPR        ARSNOT
247090051114     C                   MOVEL     dateu         ARSduv
247100051102     C                   WRITE     FIARS000
247110050224     c* Disk C import DPD
247120050224     c     *in79         wheneq    *on
247130050224     c     §1bf12        andne     'N'
247140051102     C                   CLEAR                   FIARS000
247150120817     C***                MOVE      BLTFLS        ARSFLS
247160120817     C***                MOVE      BLTLNA        ARSLNA
247170120817     C***                MOVE      BLTNRS        ARSNRS
247180120817     C***                MOVE      BLTNSC        ARSNSC
247190120817     C                   MOVE      ARTFLS        ARSFLS
247200120817     C                   MOVE      ARTLNA        ARSLNA
247210120817     C                   MOVE      ARTNRS        ARSNRS
247220120817     C                   MOVE      ARTNSC        ARSNSC
247230051102     C                   MOVEL     'C'           ARSTRC
247240060622     c***                z-add     blprmn        w0120
247250060622     C***                MOVEL     w0120         ARSNOT
247260060622     c                   movel     v7cnpr        arsnot
247270051114     C                   MOVEL     dateu         ARSduv
247280051102     C                   WRITE     FIARS000
247290980318     C*
247300000908     C* DISK C
247310000608     C*
247320000908     C     §1BF12        WHENNE    'N'
247330000908     C     NR8           CHAIN     LS01S08                            30
247340000908     C     *IN30         DOWEQ     *OFF
247350000908     C     V8CSCE        ANDEQ     'A'
247360000908     C                   ADD       1             NR8
247370000908     C     NR8           CHAIN     LS01S08                            30
247380000908     C                   ENDDO
247390000908     C     *IN30         IFEQ      *OFF
247400051102     C                   CLEAR                   FIARS000
247410120817     C***                MOVE      BLTFLS        ARSFLS
247420120817     C***                MOVE      BLTLNA        ARSLNA
247430120817     C***                MOVE      BLTNRS        ARSNRS
247440120817     C***                MOVE      BLTNSC        ARSNSC
247450120817     C                   MOVE      ARTFLS        ARSFLS
247460120817     C                   MOVE      ARTLNA        ARSLNA
247470120817     C                   MOVE      ARTNRS        ARSNRS
247480120817     C                   MOVE      ARTNSC        ARSNSC
247490051102     C                   MOVEL     'C'           ARSTRC
247500051102     C                   MOVEL     V8CNOT        ARSNOT
247510051114     C                   MOVEL     dateu         ARSduv
247520051102     C                   WRITE     FIARS000
247530000911     C                   ADD       1             NR8
247540000908     C                   ENDIF
247550120302     C* SE IMPORT BRT DEVO MEMORIZZARE SEMPRE SU ARS ANCHE
247560000911     C* RECORD TIPO 'E' PER SEGNACOLLO EUROEXPRESS
247570020211     c     §ogntw        ifeq      'EEX'
247580000911     C     §1BF12        ANDEQ     'E'
247590051102     C                   CLEAR                   FIARS000
247600120817     C***                MOVE      BLTFLS        ARSFLS
247610120817     C***                MOVE      BLTLNA        ARSLNA
247620120817     C***                MOVE      BLTNRS        ARSNRS
247630120817     C***                MOVE      BLTNSC        ARSNSC
247640120817     C                   MOVE      ARTFLS        ARSFLS
247650120817     C                   MOVE      ARTLNA        ARSLNA
247660120817     C                   MOVE      ARTNRS        ARSNRS
247670120817     C                   MOVE      ARTNSC        ARSNSC
247680051102     C                   MOVEL     'E'           ARSTRC
247690051102     C                   MOVEL     V8CNOT        ARSNOT
247700051114     C                   MOVEL     dateu         ARSduv
247710051102     C                   WRITE     FIARS000
247720000911     C                   ENDIF
247730000908    1C                   ENDSL
247740051020     c*
247750051020     c                   select
247760120302     C* EXPORT BRT
247770051020     c     A_§ogntw      wheneq    'EEX'
247780051102     C                   CLEAR                   FIARS000
247790120817     C***                MOVE      BLTFLS        ARSFLS
247800120817     C***                MOVE      BLTLNA        ARSLNA
247810120817     C***                MOVE      BLTNRS        ARSNRS
247820120817     C***                MOVE      BLTNSC        ARSNSC
247830120817     C                   MOVE      ARTFLS        ARSFLS
247840120817     C                   MOVE      ARTLNA        ARSLNA
247850120817     C                   MOVE      ARTNRS        ARSNRS
247860120817     C                   MOVE      ARTNSC        ARSNSC
247870051102     C                   MOVEL     'E'           ARSTRC
247880051020     c                   clear                   dsbld7
247890120817     c***                eval      §lclnp=bltfls
247900120817     c***                eval      §lclna=bltlna
247910120817     c***                eval      §lcnrs=bltnrs
247920120817     c***                eval      §lcncd=bltnsc
247930120817     c                   eval      §lclnp=artfls
247940120817     c                   eval      §lclna=artlna
247950120817     c                   eval      §lcnrs=artnrs
247960120817     c                   eval      §lcncd=artnsc
247970051020     c                   eval      §lczsc=blpznc
247980051020     c                   exsr      m10
247990051102     C                   MOVEA     §CA           ARSnot
248000051114     C                   MOVEL     dateu         ARSduv
248010051020     C*
248020051102     C                   WRITE     FIARS000                             30
248030051020     C* EXPORT FEDEX
248040051020     c     A_§ogntw      wheneq    'FED'
248050051102     C                   CLEAR                   FIARS000
248060120817     C***                MOVE      BLTFLS        ARSFLS
248070120817     C***                MOVE      BLTLNA        ARSLNA
248080120817     C***                MOVE      BLTNRS        ARSNRS
248090120817     C***                MOVE      BLTNSC        ARSNSC
248100120817     C                   MOVE      ARTFLS        ARSFLS
248110120817     C                   MOVE      ARTLNA        ARSLNA
248120120817     C                   MOVE      ARTNRS        ARSNRS
248130120817     C                   MOVE      ARTNSC        ARSNSC
248140051102     C                   MOVEL     'F'           ARSTRC
248150051020     c                   movel     wawb          w0012a           12
248160051020     c* calcolo check digit
248170051020     c                   exsr      chkdgf
248180051102     c                   movel     w0012a        ARSnot
248190051114     C                   MOVEL     dateu         ARSduv
248200051020     C*
248210051102     C                   WRITE     FIARS000
248220051020     c                   add       1             wawb
248230051020     C                   ENDsl
248240980318     C                   ENDSR
248250980320     C*--- COMPATTO IL CAP TOGLIENDO TUTTI I BLANK -------------------*
248260980320     C     WRKCAP        BEGSR
248270011120     C     WNO55L        IFEQ      *BLANKS
248280980320     C* Compongo il segnacollo Euroexpress
248290980320     C                   MOVE      *ZEROS        §Y                2 0
248300980320     C                   MOVE      *BLANKS       §S9
248310980320     C                   MOVE      *BLANK        §O9
248320980320     C                   MOVEA     WRKCAD        §S9
248330980320     C* Compatto il cap togliendo tutti i blank
248340980320    2C                   DO        9             §X1               2 0
248350980320    3C     §S9(§X1)      IFNE      *BLANKS
248360980320     C                   ADD       1             §Y
248370980320     C                   MOVE      §S9(§X1)      §O9(§Y)
248380980320    3C                   END
248390980320    2C                   END
248400011120     C                   ENDIF
248410980320     C* Prendo codice iso della nazione
248420980320     C                   MOVEL     '15'          COD
248430980320     C                   MOVEL(P)  BLPNZD        KEY
248440980320     C                   EXSR      CTABEL
248450980320     C   30              CLEAR                   DS15
248460980320     C  N30              MOVEL     TBLUNI        DS15
248470980320     C* Unisco il cap compattato alla nazione
248480980320     C                   MOVEL     §15COD        W15COD            2
248490980320     C                   ENDSR
248500051102     C*--- AGGIORNO FIARS00F -----------------------------------------*
248510051102     C     AGGARS        BEGSR
248520040514     c                   clear                   jf                2 0
248530980320     C                   MOVEL     'E'           WTRC
248540020213    1C     A_§ogntw      IFEQ      'EEX'
248550120817     C***  KBLT1         SETLL     FNBLT01L
248560120817     C***  KBLT1         READE(N)  FNBLT01L                               30
248570120817     C     KBLT1         SETLL     FIART01L
248580120817     C     KBLT1         READE(N)  FIART01L                               30
248590980320    2C     *IN30         DOWEQ     *OFF
248600120817     C***  KARS1         CHAIN     FIARS01L                           30
248610120817     C     KARS1A        CHAIN     FIARS01L                           30
248620980320    3C     *IN30         IFEQ      *OFF
248630051102     c                   eval      jf=%scan(wjut:ARSnot)
248640040514    4c     jf            ifgt      *zeros
248650051102     C                   MOVEL     ARSNOT        DSEEX
248660980320     C* Compatto il cap nuovo e prendo cod.iso
248670980320     C                   MOVEL     VIDCAD        WRKCAD
248680980320     C                   EXSR      WRKCAP
248690011120     C     WNO55L        IFEQ      *BLANKS
248700980320     C                   MOVEA     §O9           WCAD
248710980320     C* Unisco il cap compattato alla nazione salvata
248720980408     C                   CLEAR                   WCADN
248730980320     C     WCAD          CAT       W15COD:0      WCADN
248740011107     C                   ELSE
248750011107     C                   CLEAR                   WCADN
248760011126     C                   CLEAR                   W55L
248770011120     C                   MOVEL     W15COD        W15C
248780011107     C                   ENDIF
248790980320     C*
248800051102     C                   MOVEL     DSEEX         ARSNOT
248810051114     C                   MOVEL     dateu         ARSduv
248820051102     C                   UPDATE    FIARS000
248830040514    4c                   endif
248840980320    3C                   END
248850040514     c     jf            ifgt      *zeros
248860120817     C**** KBLT1         READE(N)  FNBLT01L                               30
248870120817     C     KBLT1         READE(N)  FIART01L                               30
248880040514     c                   else
248890040514     c                   seton                                        30
248900040514     c                   endif
248910980320    2C                   ENDDO
248920980320    1C                   END
248930980320     C                   ENDSR
248940980320     C*--- IMPOSTO CAMPI SEGNAC.EUROEX DA PASSARE A PGM DI STAMPA ----*
248950980320     C     EUREXP        BEGSR
248960040505     C     §ogntw        ifeq      'EEX'
248970980320     C                   MOVEL     'E'           WTRC
248980980320     C                   Z-ADD     CO2SCD        WO2SCD            7 0
248990051102     C     KARS01        CHAIN(N)  FIARS01L                           30
249000980320    2C     *IN30         IFEQ      *OFF
249010980320     C* PASSO AL PGM DI STAMPA ETICHETTE IL N. SEGNACOLLO EUROEXPRESS
249020051102     C                   MOVEL     ARSNOT        §DEEUR
249030120302     C* SE IMPORT BRT METTO NEL CODICE PRODOTTO DELL'ETICHETTA
249040980320     C* ITALIA IL N.SEGNACOLLO EUROEXPRESS
249050000209     C*
249060051102     C                   MOVEA     ARSNOT        W35
249070980330     C                   Z-ADD     1             BB                2 0
249080980330     C     ' '           LOOKUP    W35(BB)                                30
249090980330     C   30              MOVEA     *BLANKS       W35(BB)
249100980330     C                   MOVEA     W35(6)        §LDCDP
249110980320    2C                   ENDIF
249120980320    1C                   ENDIF
249130020212     c* EXPORT FEDEX
249140020213    1C     A_§ogntw      IFEQ      'FED'
249150020212     C                   MOVEL     'F'           WTRC
249160020212     C                   Z-ADD     CO2SCD        WO2SCD            7 0
249170051102     C     KARS01        CHAIN(N)  FIARS01L                           30
249180020212    2C     *IN30         IFEQ      *OFF
249190020212     C* METTO NEL CODICE PRODOTTO DELL'ETICHETTA ITALIA il n.segnac. FEDEX
249200051102     C                   MOVEL     ARSNOT        §ldcdp
249210020212    2C                   ENDIF
249220020212    1C                   ENDIF
249230980320     C                   ENDSR
249240980409     C*
249250980409     C*--- SBORDERIZZAZIONE ------------------------------------------*
249260980409     C     SBORD         BEGSR
249270981020     C                   SETOFF                                       30
249280980409     C     KBLP3         SETLL     FNBLT000
249290980409    1C     *IN30         DOWEQ     *OFF
249300980409     C     KBLP3         READE     FNBLT000                               30
249310980409     C* SOLO SE NON C'E' GIA' LA DATA DI PARTENZA
249320980409    2C  N30BLTDFV        IFEQ      0
249330980409     C                   CLEAR                   BLTNFV
249340980409     C                   UPDATE    FNBLT000
249350120814     c     kfiart        chain     fiart01l
249360120814     c                   if        %found(fiart01l)
249370120814     C                   CLEAR                   ARTNFV
249380120814     C                   UPDATE    FIART000
249390120814     c                   endif
249400980409    2C                   ENDIF
249410980409    1C                   ENDDO
249420980409     C                   ENDSR
249430940916     C*
249440930708     C*--- CHAIN TABEL00F --------------------------------------------*
249450930708     C     CTABEL        BEGSR
249460930708     C     KTAB2         CHAIN     TABEL                              30
249470930708     C  N30TBLFLG        IFNE      ' '
249480930708     C                   SETON                                        30
249490930708     C                   END
249500930708     C                   ENDSR
249510930708     C*
249520930708     C*--- READ  TABEL00F --------------------------------------------*
249530930708     C     RTABEL        BEGSR
249540930708     C     KTAB3         READE     TABEL                                  30
249550930708     C                   ENDSR
249560940214     C*
249570940214     C*--- PASSO DATI PER CALCOLARE CONSEGNA TEORICA -----------------*
249580940214     C     CLSE98        BEGSR
249590970925     C                   CLEAR                   DSSD99
249600940214     C*
249610941230     C     VIDTSP        IFNE      *BLANKS
249620940214     C                   MOVEL     VIDTSP        D98TSP
249630941230     C                   ELSE
249640941230     C                   MOVEL     COMTSP        D98TSP
249650941230     C                   ENDIF
249660940214     C                   MOVEL     VIDCAD        D98CAD
249670970925     C                   MOVEL     VIDLOD        D98LOD
249680950102     C                   MOVEL     VIDNZD        D98NZD
249690940628     C* CALCOLO FLAG INOLTRO
249700940628     C                   EXSR      INOLTR
249710940628     C                   MOVEL     WFIN          D98FIN
249720940214     C*
249730001031     C* TERMINAL DI PARTENZA
249740960130     C                   MOVEL     COMTFP        D98TFP
249750940214     C*
249760001031     C* TERMINAL DI ARRIVO
249770970925     C                   CLEAR                   DSLV55
249780970925     C                   MOVEL     'A'           D55TPT
249790001031     C                   MOVEL     VIDLNP        D55LNP
249800001031     C*
249810970925     C                   MOVEL     COMLNA        D55LIN
249820970925     C                   MOVEL     BLPDSP        D55DRF
249830970925     C                   CALL      'FNLV55R'
249840970925     C                   PARM                    DSLV55
249850970925     C*
249860001031    1C     D55ERR        IFEQ      ' '
249870970925     C                   MOVEL     D55TFA        D98TFA
249880970925     C                   ELSE
249890970925     C                   MOVEL     COMLNA        D98TFA
249900001031    1C                   ENDIF
249910960927     C*
249920970925     C                   MOVEL     VIDLNP        D98LNP
249930970925     C                   MOVEL     COMLNA        D98LNA
249940940214     C                   MOVEL     BLPDSP        D98DSP
249950950102     C                   MOVE      BLPDSP        D98MGS
249960940214     C                   MOVEL     VIDGC1        D98GC1
249970940214     C                   MOVEL     VIDGC2        D98GC2
249980950102     C                   MOVEL     §3ATB1        D98TBL
249990950102     C                   MOVEL     WKSC          D98KSC
250000100219     c* In alcuni casi, per la delivery, non devo tenere conto dei tempi
250010100219     c*  del C/Ass e fermo deposito
250020100219     c                   if        UsaCass=' '
250030010823     C                   Z-ADD     VIDCAS        D98CAS
250040010823     C                   MOVEL     VIDVCA        D98VCA
250050940214     C                   MOVEL     VIDTIC        D98TIC
250060940214     C                   MOVEL     VIDFFD        D98FFD
250070010214     C     D98FFD        IFEQ      'N'
250080010214     C                   MOVE      *BLANKS       D98FFD
250090010214     C                   ENDIF
250100100219     C                   ENDIF
250110950102     C*
250120970925     C                   CALL      'TNSD99R'
250130970925     C                   PARM                    DSSD99
250140940214     C* FLAG CHE TENGO MEMORIZZATO PER POI CHIUDERE I FILES
250150940214     C                   MOVEL     '1'           WCL98             1
250160940214     C*
250170100219     c                   clear                   UsaCass
250180900427     C                   ENDSR
250190950126     C*
250200950126     C* SPENGO INDICATORI DELLA 1 VIDEATA ---------------------------*
250210950126     C     OFFD01        BEGSR
250220950126     C                   SETOFF                                       404142
250230000313     C                   SETOFF                                       614356
250240950126     C                   SETOFF                                       455150
250250950126     C                   SETOFF                                       626346
250260950126     C                   SETOFF                                       474849
250270950126     C                   SETOFF                                       646566
250280950126     C                   SETOFF                                       676869
250290950126     C                   SETOFF                                       701090
250300950303     C                   SETOFF                                       553871
250310000120     C                   SETOFF                                       5257
250320010222     C                   CLEAR                   H1RIGA
250330010222     C                   CLEAR                   H1COLO
250340010214     C                   CLEAR                   H0RIGA
250350010214     C                   CLEAR                   H0COLO
250360071107     c****               if        dateu<§vpodrt
250370071107     C****               CLEAR                   ATRDRT
250380071107     c****               endif
250390010214     C                   CLEAR                   ATRPDR
250400010214     C                   CLEAR                   ATRCCM
250410010214     C                   CLEAR                   ATRFFD
250420010214     C                   CLEAR                   ATRFPP
250430010220     C                   CLEAR                   ATRLNA
250440010305     C                   CLEAR                   ATRNCL
250450010305     C                   CLEAR                   ATRPKG
250460100319     C                   CLEAR                   ATRTSP
250470950126     C                   ENDSR
250480950126     C*
250490950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE -------------*
250500950126     C     OFFD02        BEGSR
250510950126     C                   SETOFF                                       929399
250520950126     C                   SETOFF                                       414243
250530961111     C                   SETOFF                                       454686
250540950126     C                   SETOFF                                       474849
250550950126     C                   SETOFF                                       505152
250560950126     C                   SETOFF                                       535455
250570950126     C                   SETOFF                                       565759
250580950126     C                   SETOFF                                       606162
250590950126     C                   SETOFF                                       636465
250600950410     C                   SETOFF                                       586667
250610950410     C                   SETOFF                                       686970
250620950126     C                   SETOFF                                       717273
250630950126     C                   SETOFF                                       109040
250640950126     C                   SETOFF                                       808182
250650950126     C                   SETOFF                                       839784
250660961111     C                   SETOFF                                       747586
250670991117     C                   SETOFF                                       77
250680040610     c     atrbva        ifne      prri
250690040610     c                   movel     hiul          atrbva
250700040610     c                   endif
250710040216
250720040301     c                   Eval      wkk = *Off
250730021217
250740021218     c                   Clear                   H2riga
250750021218     c                   Clear                   H2colo
250760021217
250770950126     C                   ENDSR
250780950126     C*
250790950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE 3 VIDEATA-----*
250800950126     C     OFFD03        BEGSR
250810991025     C                   SETOFF                                       404142
250820991025     C                   SETOFF                                       434546
250830991025     C                   SETOFF                                       474849
250840991025     C                   SETOFF                                       505152
250850991025     C                   SETOFF                                       5390
250860040116     c                   Clear                   Atrsv2
250870040116     c                   Clear                   Atrsv3
250880040116     c                   Clear                   Atrsv4
250890041217     c                   Clear                   Atrsv5
250900041217     c                   Clear                   Atrsv6
250910950126     C                   ENDSR
250920950126     C*
250930950126     C* SE DISK CLIENTI CON "X" ESCO DAL PGM ED EMETTO NUOVA BOLLA----*
250940091111     C     ESCIER        BEGSR
250950950126     C*
250960091111     c* devo entrare se presente errore (90 on) oppure se devo per forza
250970091111     c* emettere una videata
250980020123     c     *in90         ifeq      *on
250990091111     c     wvidobb       oreq      '1'
251000020123     C     §LPFPR        IFEQ      'V'
251010950419     C     §LPFPR        OREQ      'X'
251020950126     C     *IN12         OREQ      *OFF
251030950126     C     *IN15         OREQ      *OFF
251040010305     C     §LPFPR        IFNE      'O'
251050950126     C  N12
251060950126     COR 12
251070950126     CANN15              CLEAR                   §LPFPR
251080070307     C                   ENDIF
251090950126     C*
251100950126     C                   ELSE
251110950126     C*
251120950126     C                   MOVEL     '5'           §LPFPR
251130950126     C                   ENDIF
251140020123     C                   ENDIF
251150950126     C                   ENDSR
251160950127     C* SE E' STATA BATTUTA UNA CHIAVE RICERCA
251170950127     C*          E NON E STATO IMMESSO CODICE-01 ON ABILITATA LA RICERC
251180950127     C     RICALF        BEGSR
251190950127    1C   01WCCM          IFEQ      0
251200950127     C     PAXDMT        ANDNE     *BLANKS
251210950127     C* DESCRIZIONE AZIENDA
251220950127     C                   MOVEL     VIDDSA        PAXDUT           30
251230950127     C* PAXSTA=9 ESCLUDO ANNULLATI
251240950127     C                   Z-ADD     9             PAXSTA
251250950127     C* CAPOCONTO CLIENTI
251260950127     C                   Z-ADD     KCI           PAXCCC
251270950127     C* CODICE DA RICERCARE: SE IMMESSA LNP CERCO SOLO AL SUO INTERNO
251280000207     C                   MOVEL(P)  WFLC          PAXFLR
251290980929     C                   CLEAR                   PAXDIT
251300000121     C                   Z-ADD     1             PAXNUM
251310950127     C*
251320000121     C                   CALL      'XALFA3BR'
251330950127     C                   PARM                    PAXDUT
251340950127     C                   PARM                    CODUT
251350950127     C                   PARM                    PAXDMT
251360950127     C                   PARM                    PAXCCC
251370950127     C                   PARM                    PAXSTA            1 0
251380961016     C                   PARM                    PAXFLR           90
251390980701     C                   PARM                    PAXDIT            3
251400000121     C                   PARM                    PAXNUM            2 0
251410000121     C                   PARM                    PAXKCM           80
251420000121     C                   PARM                    PAXKSM          140
251430000121     C                   PARM                    PAXKDM           60
251440950127     C*
251450950127     C                   MOVEL     '1'           WEMFOR
251460950127     C* NON TROVATO O PREMUTO CMD12
251470950127    2C     PAXSTA        IFGT      -1
251480950127     C* CODICE SELEZIONATO: IMPOSTO A VIDEO
251490000127     C                   MOVEL     PAXKSM        W0070             7 0
251500000127     C                   MOVE      W0070         WCCM
251510000127     C                   MOVEL     W0070         W0030
251520950127     C                   SETON                                        50
251530950127     C*
251540950127     C* SE LA LINEA DEL CODICE NON CORRISPONDE ALLA LINEA PARTENZA
251550960926     C*  IMPOSTO ANCHE IL PUNTO OPEATIVO CLIENTE
251560950127     C     W0030         IFNE      WLNP
251570950127     C                   MOVEL     W0030         WFLC
251580950127     C                   SETON                                        14
251590950127     C                   ENDIF
251600950127    2C                   ENDIF
251610950127    1C                   ENDIF
251620950127     C                   ENDSR
251630950104     C**************************************************************************
251640950104     C*  ABBLANCA ZERO NON SIGNIFICATIVI
251650950104     C**************************************************************************
251660950104     C     ABBL          BEGSR
251670950104     C*
251680950104     C     SKI(I)        DOWEQ     '0'
251690950717     C     I             ANDLT     15
251700950104     C                   MOVEL     ' '           SKI(I)
251710950104     C                   ADD       1             I
251720950717     C                   ENDDO
251730950104     C*
251740950104     C                   ENDSR
251750950717     C**************************************************************************
251760950717     C*  CONTROLLO SEGNACOLLO DOPPIO ALL'INTERNO DELLA STESSA BOLLA
251770950717     C**************************************************************************
251780950717     C     VADDOP        BEGSR
251790020917     C     KBLC          SETLL     FIVAD000
251800020917     C     KBLC          READE(N)  FIVAD000                               30
251810950717     C                   CLEAR                   WNCD
251820950717     C*
251830950717     C     *IN30         DOWEQ     *OFF
251840950717     C*
251850950717     C     WNCD          IFNE      BLDNCD
251860950717     C                   MOVEL     BLDNCD        WNCD
251870020917     C     KBLC          READE(N)  FIVAD000                               30
251880950717     C                   ELSE
251890950717     C                   SETON                                        629030
251900950717     C                   ENDIF
251910950717     C*
251920950717     C                   ENDDO
251930950717     C* PREPARO MESSAGGIO
251940950717     C     *IN90         IFEQ      *ON
251950950717     C                   MOVEA     ERR(120)      K78
251960950717     C                   MOVEL     WNCD          W007A
251970950717     C                   MOVEA     W007A         SKI(9)
251980950717     C                   Z-ADD     9             I                 3 0
251990950717     C                   EXSR      ABBL
252000950717     C                   MOVEA     SKI(9)        K78(37)
252010950717     C                   MOVEA     K78           VIDMSG
252020950717     C                   ENDIF
252030950717     C*
252040950717     C                   ENDSR
252050001031     C**
252060120302     C* STAMPA ETICHETTA ESTERA SDI O BRT ----------------------------*
252070971215     C     ETIEST        BEGSR
252080971215     C*
252090040506     c* entro in questa routine anche per la stampa dell'etichetta Ita
252100040506     c* lia se segnacollo export Euroexpress per impostare la nazione
252110040506     c* §defca viene impostato ma per il momento non utilizzato nel
252120040506     c* pgm di stampa
252130040506     c*
252140081008    1C***  WESTER        IFEQ      'S'
252150081008     c     §detse        ifeq      'EEX'
252160971215     C                   MOVEL     DESCOD        §DEISA
252170971215     C**
252180971215    3C                   SELECT
252190971215     C     FLGTB1        WHENEQ    'A'
252200971215     C     §3AFCA        ANDEQ     0
252210971215     C                   MOVEL     'A'           §DEFCA
252220971215     C     FLGTB1        WHENEQ    'A'
252230971215     C     §3AFCA        ANDNE     0
252240971215     C                   MOVEL     'X'           §DEFCA
252250971215     C     §3AFCA        WHENNE    0
252260971215     C                   MOVEL     'S'           §DEFCA
252270971215    3C                   ENDSL
252280971215    1C                   ENDIF
252290971215     C**
252300971215     C                   ENDSR
252310000901     C*****************************************************
252320000901     C* CALCOLA CIFRA DI CONTROLLO SECONDO IL MODULO 10 IBM
252330000901     C*****************************************************
252340000901     C     M10           BEGSR
252350000901     C                   MOVE      *ZERO         §TT               3 0
252360000906     C                   MOVE      *ZERO         §TT2              3 0
252370000901     C                   MOVE      *ZERO         §1                1 0
252380000901     C                   Z-ADD     18            §S                2 0
252390000901     C                   DO        17            §N                2 0
252400000901     C                   SUB       1             §S
252410000901     C* INTANTO SPOSTO DA UNA SCHIERA AL CAMPO COD.BARRE
252420000901     C                   MOVE      §C(§N)        §CB(§N)
252430000901     C     §N            DIV       2             §CTR              3 0
252440000901     C                   MVR                     §RST              3 030
252450000901     C     *IN(30)       IFEQ      '1'
252460000901     C     §C(§S)        MULT      2             §N2               2 0
252470000901     C                   MOVE      §N2           §A2               2
252480000901     C                   MOVEA     §A2           §2A
252490000901     C                   XFOOT     §2            §CTR
252500000901     C                   ELSE
252510000901     C                   Z-ADD     §C(§S)        §CTR
252520000901     C                   END
252530000901     C                   ADD       §CTR          §TT
252540000901     C                   END
252550000901     C*
252560000901     C     §TT           ADD       9             §TT2
252570000901     C                   MOVE      0             §TT2
252580000901     C     §TT2          SUB       §TT           §1
252590000901     C*
252600000901     C                   MOVE      §1            §CB(18)
252610000901     C                   ENDSR
252620000901     C**************************************************************************
252630020917     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIVAT
252640000901     C**************************************************************************
252650000901     C     CARVAT        BEGSR
252660000905     C* CAMPI SFL CONTROL
252670000912     C                   MOVE      §LPCCN        V8CKSC
252680000905     C                   Z-ADD     KCI           CCC
252690000905     C     KACO          CHAIN     CNACO000                           30
252700000905     C  N30              MOVEL     ACORAG        V8DKSC
252710000905     C   30              MOVEL     *BLANKS       V8DKSC
252720000905     C*
252730000901     C                   Z-ADD     0             NR8
252740000901     C                   MOVEL     'E'           WTRC
252750020917     C     KVAT          SETLL     FIVAT000
252760061010     C     KVAT          READE(N)  FIVAT000                               30
252770000901     C     *IN30         DOWEQ     *OFF
252780000901     C                   MOVEL     *BLANKS       V8CSCE
252790040302     c                   Eval      wtxt = VatNot
252800041117     c                   eval      uppercase = '1'
252810040302     c                   ExSr      Sr_Chk
252820040302     c                   Movel     wtxt          V8cNot
252830000908     C                   MOVE      *BLANKS       V8HDKC
252840000908     C                   MOVE      *BLANKS       V8HESG
252850000915     C                   MOVE      *ZEROS        V8HST2
252860000915     C                   CLEAR                   V8HFLS
252870000915     C                   CLEAR                   V8HLNA
252880000915     C                   CLEAR                   V8HNRS
252890000915     C                   CLEAR                   V8HNSC
252900000921     C                   CLEAR                   V8HPRE
252910000901     C* SCRIVO SUBFILE
252920040617     c* potrebbe succcedere che il cliente ci passi più di 500 record
252930040617     c* di vat ma sul vab il numero colli è inferiore a 500
252940040617     c* In questo caso ne carico al max 500
252950040617     c     nr8           ifeq      500
252960040617     c                   seton                                        30
252970040617     c                   else
252980000901     C                   ADD       1             NR8
252990000901     C                   WRITE     LS01S08
253000061010     C     KVAT          READE(N)  FIVAT000                               30
253010040617     c                   endif
253020000901     C                   ENDDO
253030000918     C                   Z-ADD     NR8           SAVNR8
253040000901     C*
253050000901     C                   ENDSR
253060050221     C**************************************************************************
253070050221     C*  CARICAMENTO numero parcel dpd
253080050221     C**************************************************************************
253090050221     C     sr_vatdpd     BEGSR
253100050221     C                   MOVEL     'E'           WTRC
253110050221     c                   clear                   werrvat           1
253120060612     c                   clear                   w014a
253130050221     C     KVAT          SETLL     FIVAT000
253140061010     C     KVAT          READE(N)  FIVAT000                               30
253150050221     C     *IN30         DOWEQ     *OFF
253160050221     c     werrvat       andeq     *blanks
253170060612     c     w014a         ifeq      *blanks
253180060612     c                   if        §ogntw = 'DPD'
253190060612     c                   movel     vatnot        dvate
253200060612     c                   movel     §VATEPRN      w014a
253210060612     c                   else
253220060612     c                   movel     vatnot        w014a
253230060612     c                   endif
253240050221     c                   else
253250050221     c                   eval      werrvat = '1'
253260050221     c                   endif
253270061010     C     KVAT          READE(N)  FIVAT000                               30
253280050221     c                   enddo
253290050221     c                   endsr
253300000901     C**************************************************************************
253310020917     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIVAB O FIVAD
253320000901     C**************************************************************************
253330000901     C     CARVAB        BEGSR
253340000901     C                   Z-ADD     0             NR8
253350000905     C* CAMPI SFL CONTROL
253360000912     C                   MOVE      §LPCCN        V8CKSC
253370000905     C                   Z-ADD     KCI           CCC
253380000905     C     KACO          CHAIN     CNACO000                           30
253390000905     C  N30              MOVEL     ACORAG        V8DKSC
253400000905     C   30              MOVEL     *BLANKS       V8DKSC
253410000901     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
253420000901     C                   CLEAR                   DSBLD7
253430000901     C                   MOVE      §LPLNP        §LCLNP
253440000901     C                   MOVE      §LPLNA        §LCLNA
253450000901     C                   MOVE      §LPNRS        §LCNRS
253460000901     C                   MOVE      §LPZNC        §LCZSC
253470020917     C* SEGNACOLLI SEQUENZIALI: CARICO CHI SONO DA FIVAB
253480000901    1C     §1BFG7        IFNE      'S'
253490000901     C                   MOVE      §LPNCD        §LCNCD
253500000901     C* Calcolo il check digit
253510000901     C                   EXSR      M10
253520000911     C                   MOVEA     §CA           V8CNOT
253530000901     C                   MOVEL     *BLANKS       V8CSCE
253540000908     C                   MOVE      *BLANKS       V8HDKC
253550000908     C                   MOVE      *BLANKS       V8HESG
253560000915     C                   MOVE      *ZEROS        V8HST2
253570000915     C                   CLEAR                   V8HFLS
253580000915     C                   CLEAR                   V8HLNA
253590000915     C                   CLEAR                   V8HNRS
253600000915     C                   CLEAR                   V8HNSC
253610000921     C                   CLEAR                   V8HPRE
253620000901     C                   ADD       1             NR8
253630000901     C                   WRITE     LS01S08
253640101217     c                   movel     v8cnot        chidal
253650000901    2C     §LPNCA        IFGT      *ZEROS
253660001016     C     §LPNCA        ANDNE     §LPNCD
253670101217     C                   MOVE      §LPNCA        §LCNCD
253680101217     C* Calcolo il check digit
253690101217     C                   EXSR      M10
253700101217     C                   MOVEA     §CA           V8CNOT
253710101217     C                   MOVEL     *BLANKS       V8CSCE
253720101217     C                   ADD       1             NR8
253730101217     C                   WRITE     LS01S08
253740101217     c                   movel     v8cnot        chial
253750101217     c     chidal        downe     chial
253760101216     C                   CLEAR                   DSLSZ1
253770101216     C                   MOVEL     'E'           IZ1MOD
253780101216     C                   MOVEL     CHIDAL        IZ1CH1
253790101216     C                   Z-ADD     V8CKSC        IZ1CCM
253800101216     C                   MOVEL     wctm          IZ1CTM
253810101216     C                   Z-ADD     §lpnrs        IZ1NRS
253820101216     C                   CALL      'FNLSZ1R'
253830101216     C                   PARM                    KPJBA
253840101216     C                   PARM                    DSLSZ1
253850101216     C                   PARM                    DS1B
253860101217     c     oz1chi        ifne      chial
253870101216     C                   MOVEL     OZ1CHI        V8CNOT
253880000901     C                   MOVEL     *BLANKS       V8CSCE
253890000901     C                   ADD       1             NR8
253900000901     C                   WRITE     LS01S08
253910000901    2C                   ENDIF
253920101217     c                   eval      chidal=oz1chi
253930101217     c                   enddo
253940101217     c                   endif
253950000918     C                   Z-ADD     NR8           SAVNR8
253960000901   X1C                   ELSE
253970020917     C* ALTRIMENTI LI CARICO DA FIVAD
253980020917     C     KBLC          SETLL     FIVAD000
253990020917     C     KBLC          READE     FIVAD000                               30
254000000904    2C     *IN30         DOWEQ     *OFF
254010000904    3C     BLDNCA        IFEQ      0
254020000904     C                   Z-ADD     BLDNCD        BLDNCA
254030000904    3C                   ENDIF
254040000904     C*
254050000904    3C     BLDNCD        DOWLE     BLDNCA
254060000904     C     BLDNCD        ANDGT     0
254070000904     C                   MOVE      BLDNCD        §LCNCD
254080000904     C* Calcolo il check digit
254090000904     C                   EXSR      M10
254100000911     C                   MOVEA     §CA           V8CNOT
254110000901     C                   MOVEL     *BLANKS       V8CSCE
254120000908     C                   MOVE      *BLANKS       V8HDKC
254130000908     C                   MOVE      *BLANKS       V8HESG
254140000915     C                   MOVE      *ZEROS        V8HST2
254150000915     C                   CLEAR                   V8HFLS
254160000915     C                   CLEAR                   V8HLNA
254170000915     C                   CLEAR                   V8HNRS
254180000915     C                   CLEAR                   V8HNSC
254190000921     C                   CLEAR                   V8HPRE
254200000901     C* SCRIVO SUBFILE
254210000901     C                   ADD       1             NR8
254220000901     C                   WRITE     LS01S08
254230000904     C                   ADD       1             BLDNCD
254240000904    3C                   ENDDO
254250020917     C     KBLC          READE     FIVAD000                               30
254260000904    2C                   ENDDO
254270000918     C                   Z-ADD     NR8           SAVNR8
254280000904     C*
254290000904    1C                   ENDIF
254300000901     C*
254310000901     C                   ENDSR
254320000913     C**************************************************************************
254330051102     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIARS
254340000913     C**************************************************************************
254350051102     C     CARARS        BEGSR
254360000913     C* CAMPI SFL CONTROL
254370000913     C                   MOVE      WKSC          V8CKSC
254380000913     C                   Z-ADD     KCI           CCC
254390000913     C     KACO          CHAIN     CNACO000                           30
254400000913     C  N30              MOVEL     ACORAG        V8DKSC
254410000913     C   30              MOVEL     *BLANKS       V8DKSC
254420000913     C*
254430000913     C                   MOVEL     *BLANKS       V8CSCE
254440051102     C                   MOVEL     ARSNOT        V8CNOT
254450000913     C                   MOVE      *BLANKS       V8HDKC
254460000913     C                   MOVE      *BLANKS       V8HESG
254470000915     C                   MOVE      *ZEROS        V8HST2
254480051102     C                   Z-ADD     ARSFLS        V8HFLS
254490051102     C                   Z-ADD     ARSLNA        V8HLNA
254500051102     C                   Z-ADD     ARSNRS        V8HNRS
254510051102     C                   Z-ADD     ARSNSC        V8HNSC
254520000913     C* SCRIVO SUBFILE
254530000913     C                   ADD       1             NR8
254540000913     C                   WRITE     LS01S08
254550000913     C*
254560000913     C                   ENDSR
254570031114      *------------------------------------------------------------------------*
254580031114      *  CARICAMENTO DATI DA FIVAT00F
254590031114      *------------------------------------------------------------------------*
254600031114     c     Sr_CarVat     BegSr
254610110818     c**
254620110818     c** N.B: l'elenco dei tipi record del fivat e le relative descrizioni
254630110818     c**      sono interrogabili sulla tabella "VAT"
254640110818     c**
254650031125     c                   Clear                   dVato
254660031125
254670031114      * Leggo FIVAT00f
254680031114     c     kVat1         Setll     Fivat01l
254690031114     c                   Do        *Hival
254700061010     c     kVat1         Reade(N)  Fivat01l
254710031114     c                   If        %Eof(Fivat01l)
254720031114     c                   Leave
254730031114     c                   EndIf
254740031114      * Escludo i record "E"
254750031114     c                   If        VatTrc = 'E'
254760031114     c                   Iter
254770031114     c                   EndIf
254780040302
254790040302      * Controllo i dati inviati dal cliente, tranne il rcd 'O' xchè è tutto
254800040302      * numerico
254810040302     c                   If        VatTrc <> 'O'
254820040302     c                   Eval      wtxt = VatNot
254830040302     c                   ExSr      Sr_Chk
254840040302     c                   Movel     wtxt          VatNot
254850040302     c                   EndIf
254860031114      * Imposto i campi in base al tipo record
254870031114     c                   Select
254880031114      * Referente
254890031114     c                   When      VatTrc = 'A'
254900031114     c                   Eval      VidRef = VatNot
254910031114      * Telefono
254920031114     c                   When      VatTrc = 'B'
254930031114     c                   Eval      VidTel = VatNot
254940031125      * Bancali x particolarità varia 'O'
254950031125     c                   When      VatTrc = 'O'
254960031125     c                   Movel     VatNot        dVato
254970031219      * Riferimento partener estero
254980031219     c                   When      VatTrc = 'C'
254990031219     c                   Movel     VatNot        wrifp
255000110510      * E-mail al destinatario - indirizzo
255010110510     c                   When      VatTrc = 'I'
255020110512     c                   Clear                   atremd
255030110510     c                   Movel     VatNot        wemdest
255040110512     c                   When      VatTrc = 'J'
255050110512     c                   Clear                   atremd
255060110512     c                   if        wemdest<>*blanks
255070110512     c                   eval      wemdest=%trimr(wemdest) + vatnot
255080110512     c                   else
255090110512     c                   Movel     VatNot        wemdest
255100110512     c                   endif
255110110704      * codici CUP e CIG per tracciabilità flussi finanziari
255120110704     c                   when      VatTrc='4'
255130110704     c                   movel     vatnot        dvat4
255140120606     c                   exsr      impocupcig
255150120606     c***                eval      Wcupcup=§vat4cup
255160120606     c***                eval      Wcupcig=§vat4cig
255170130315     c* numero di telefono per invio sms
255180130315     c                   when      VatTrc='S'
255190130315     c                   Movel     VatNot        dVats
255200130403     c                   eval      wsms=§vatstel
255210130403     c                   eval      wsmp=§vatssmp
255220031219      * Altri record non li carico
255230031219     c                   Other
255240031219     c                   Iter
255250031114
255260031114     c                   EndSl
255270031114
255280031114     c                   EndDo
255290031114
255300031114     c                   EndSr
255310040302      *---------------------------------------------------------
255320040302      * Controllo i caratteri dei campi alfanumerici
255330040302      *---------------------------------------------------------
255340040302     c     Sr_Chk        BegSr
255350040302
255360040302     c                   Eval      TxtInOut = wtxt
255370040302     c                   Call      'XCHKCHAR'
255380040302     c                   Parm                    TxtInOut
255390040302     c                   Parm                    ElencoChar
255400040302     c                   Parm                    TipoElenco
255410040302     c                   Parm                    CharSost
255420040302     c                   Parm                    UpperCase
255430040302     c                   Parm                    ChkNull
255440040302     c                   Parm                    CharNull
255450040302     c                   Parm                    Esito
255460040302     c                   If        Esito = '1'
255470040302     c                   Move      TxtInOut      wtxt
255480040302     c                   EndIf
255490040302
255500040302     c                   EndSr
255510120606      *---------------------------------------------------------
255520120606      * Verifica e impostazione CUP e  CIG ricevuti dal cliente
255530120606      *---------------------------------------------------------
255540120606     c     impocupcig    BegSr
255550120606     c                   clear                   wstringa
255560120606     c     '0':' '       xlate     §vat4cup      wstringa
255570120606     c                   if        wstringa<>*blanks
255580120606     c                   eval      Wcupcup=§vat4cup
255590120606     c                   endif
255600120606     c                   clear                   wstringa
255610120606     c     '0':' '       xlate     §vat4cig      wstringa
255620120606     c                   if        wstringa<>*blanks
255630120606     c                   eval      Wcupcig=§vat4cig
255640120606     c                   endif
255650120606     c                   EndSr
255660110512      *---------------------------------------------------------
255670110512      * Controllo indirizzo email destinatario
255680110512      *---------------------------------------------------------
255690110512     c     Sr_Chkemd     BegSr
255700110512     c                   Clear                   dsemail
255710110512     c                   Eval      §emlindi = wemdest
255720110512     c                   Call      'XEMAIL'
255730110512     c                   Parm                    dsemail
255740110512     c                   EndSr
255750031125      *------------------------------------------------------------------------*
255760031125      *  CONTROLLO CHE DATI TENERE PER I BANCALI
255770031125      *------------------------------------------------------------------------*
255780031125     c     Sr_CtrBancali BegSr
255790031125
255800031125     c                   Clear                   wgva
255810031125
255820031126     c                   Select
255830031126      * particolarità varia 'O'
255840031126w   1c                   When      %subst(VidGva:1:1) = 'O'
255850031126      * dati trovati in FIVAT rcd 'O'
255860031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
255870031126      * carico i dati del FIVAT
255880031126     c                   Clear                   VidTba
255890031126     c                   If        §VatoTba > *Zeros
255900031126     c                   Movel     §VatoTba      VidTba
255910031126     c                   EndIf
255920031126     c                   Eval      VidNba = §VatoNba
255930031126     c                   Eval      SavNba = §VatoNba
255940031126     c                   Clear                   VidTb2
255950031126     c                   If        §VatoTb2 > *Zeros
255960031126     c                   Movel     §VatoTb2      VidTb2
255970031126     c                   EndIf
255980031126     c                   Eval      VidNb2 = §VatoNb2
255990031126     c                   Eval      SavNba = §VatoNb2
256000031126     c                   Eval      w03Cor = §VatoCor
256010031126     c                   Eval      w03Csf = §VatoCsf
256020031126      * dati non trovati in FIVAT rcd 'O'
256030031126   x2c                   Else
256040031126      * pulisco i campi del video
256050031126     c                   Clear                   VidTba
256060031126     c                   Clear                   VidNba
256070031126     c                   Clear                   SavNba
256080031126     c                   Clear                   VidTb2
256090031126     c                   Clear                   VidNb2
256100031126     c                   Clear                   SavNba
256110031126    2c                   EndIf
256120031126
256130031126      * particolarità varia 'B'
256140031126w   1c                   When      %subst(VidGva:1:1) = 'B'
256150031126      * dati trovati in FIVAT rcd 'O'
256160031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
256170031126      * pulisco i dati del FIVAT
256180031126     c                   Clear                   dVato
256190031126    2c                   EndIf
256200031126
256210031126      * particolarità varia = ' '
256220031126w   1c                   When      %subst(VidGva:1:1) = ' '
256230031126      * dati trovati in FIVAT rcd 'O'
256240031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
256250031126      * carico i dati del FIVAT
256260031126     c                   Clear                   VidTba
256270031126     c                   If        §VatoTba > *Zeros
256280031126     c                   Movel     §VatoTba      VidTba
256290031126     c                   EndIf
256300031126     c                   Eval      VidNba = §VatoNba
256310031126     c                   Eval      SavNba = §VatoNba
256320031126     c                   Clear                   VidTb2
256330031126     c                   If        §VatoTb2 > *Zeros
256340031126     c                   Movel     §VatoTb2      VidTb2
256350031126     c                   EndIf
256360031126     c                   Eval      VidNb2 = §VatoNb2
256370031126     c                   Eval      SavNba = §VatoNb2
256380031126     c                   Eval      w03Cor = §VatoCor
256390031126     c                   Eval      w03Csf = §VatoCsf
256400031126      * imposto un flag per emettere un msg mirato in seconda videata
256410031126     c                   Eval      wgva = 'O'
256420031126      * dati non trovati in FIVAT rcd 'O'
256430031126   x2c                   Else
256440031126      * se ho i bancali
256450031126if  3c                   If        §LpNba > *Zeros or §LpNb2 > *Zeros
256460031126      * imposto un flag per emettere un msg mirato in seconda videata
256470031126     c                   Eval      wgva = 'B'
256480031126    3c                   EndIf
256490031126    2c                   EndIf
256500031126
256510031126   o1c                   other
256520031126      * dati trovati in FIVAT rcd 'O'
256530031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
256540031126      * pulisco i dati del FIVAT
256550031126     c                   Clear                   dVato
256560031126      * dati non trovati in FIVAT rcd 'O'
256570031126   x2c                   Else
256580031126      * pulisco i campi del video
256590031126     c                   Clear                   VidTba
256600031126     c                   Clear                   VidNba
256610031126     c                   Clear                   SavNba
256620031126     c                   Clear                   VidTb2
256630031126     c                   Clear                   VidNb2
256640031126     c                   Clear                   SavNba
256650031126    2c                   EndIf
256660031126
256670031126    1c                   EndSl
256680031125
256690031125     c                   EndSr
256700000904     C**************************************************************************
256710000904     C*  GESTIONE VIDEATA MANUTENZIONE COD. CHI SONO
256720000904     C**************************************************************************
256730000904     C     GESD08        BEGSR
256740000905     C  N90              Z-ADD     1             V8CNBR
256750000904     C                   CLEAR                   V8ZMSG
256760000905     C   90              MOVEL     W08MSG        V8ZMSG
256770000928     C* SE DSIK C EX DISK BI ACCENDO 33 PER DISABILITARE F9-AGGIUNTA
256780000928     C     §1BF12        IFEQ      'B'
256790000928     C                   SETON                                        33
256800000928     C                   ENDIF
256810000904     C* EMISSIONE VIDEATA
256820000904     C     EMD08         TAG
256830000904     C                   WRITE     LS01Z08
256840000904     C                   EXFMT     LS01C08
256850000911     C                   SETOFF                                       6190
256860000904     C                   CLEAR                   V8ZMSG
256870000904     C     *INKL         CABEQ     *ON           ENDD08
256880010504     C* CONTROLLO EVENTUALI RECORD ANNULLATI E LI TOLGO DALLA SCHIERA
256890010504     C* DI WORK
256900010504     C                   EXSR      CTRS8A
256910000904     C* F9=AGGIUNTA CODICI
256920000904     C     *INKI         IFEQ      *ON
256930000904     C                   EXSR      GESD09
256940000914     C     *INKL         CABEQ     *ON           ENDD08
256950000904     C                   ENDIF
256960010504     C* CONTROLLO DATI
256970010504     C                   EXSR      CTRS08
256980010504     C   90              MOVEL     W08MSG        V8ZMSG
256990010504     C  NKF
257000010504     COR 90              GOTO      EMD08
257010000904     C     ENDD08        ENDSR
257020000830     C**************************************************************************
257030000830     C*  GESTIONE VIDEATA INSERIMENTO COD. CHI SONO
257040000830     C**************************************************************************
257050000904     C     GESD09        BEGSR
257060000905     C* QUESTA ROUTINE POTREBBE ESSERE RICHIAMATA DURANTE LA MANUTENZIO
257070000905     C* NE DEL SUBFILE: IN QUESTO CASO DEVO MANTENERE IL POSIZIONAMENTO
257080000905     C* NEL SUBFILE CHE C'È GIA'
257090000904     C     V8CNBR        IFEQ      0
257100000830     C                   Z-ADD     1             V8CNBR
257110000904     C                   ENDIF
257120000918     C                   Z-ADD     SAVNR8        NR8
257130051121     c                   write     ls01d08
257140000904     C     EMD09         TAG
257150000830     C                   WRITE     LS01C08
257160000830     C                   EXFMT     LS01D09
257170000904     C                   SETOFF                                       61
257180000921     C* SCRIVO SUBFILE (SE CHI SONO GIA' IMMESSO NON LO RICARICO E NON
257190000921     C* DO ERRORE)
257200000830     C     V9CNOT        IFNE      *BLANKS
257210000921     C     V9CNOT        LOOKUP    CH2                                    31
257220000921     C     *IN31         IFEQ      *OFF
257230000830     C                   ADD       1             NR8
257240000830     C                   Z-ADD     NR8           V8CNBR
257250000911     C                   MOVEL     V9CNOT        V8CNOT
257260000830     C                   CLEAR                   V8CSCE
257270000908     C                   CLEAR                   V8HDKC
257280000908     C                   CLEAR                   V8HESG
257290000915     C                   CLEAR                   V8HST2
257300000915     C                   CLEAR                   V8HFLS
257310000915     C                   CLEAR                   V8HLNA
257320000915     C                   CLEAR                   V8HNRS
257330000915     C                   CLEAR                   V8HNSC
257340000921     C                   CLEAR                   V8HPRE
257350000830     C                   WRITE     LS01S08
257360000921     C                   SETON                                        78
257370000921     C                   ADD       1             I2                3 0
257380000921     C                   MOVE      V9CNOT        CH2(I2)
257390000921     C                   ENDIF
257400000911     C                   CLEAR                   V9CNOT
257410000830     C                   ENDIF
257420000918     C                   Z-ADD     NR8           SAVNR8
257430000905     C* PER F6 ESCO DALLA VIDEATA DI IMMISSIONE "CHI SONO"
257440000914     C     *INKF         IFEQ      *OFF
257450000914     C     *INKL         ANDEQ     *OFF
257460000914     C                   GOTO      EMD09
257470000914     C                   ENDIF
257480000830     C                   ENDSR
257490000830     C**************************************************************************
257500000830     C*   CONTROLLO SUBFILE CHI SONO
257510000905     C**************************************************************************
257520000830     C     CTRS08        BEGSR
257530000830     C                   CLEAR                   CHI
257540000907     C                   CLEAR                   POS
257550021119     c                   Clear                   Prefisso
257560000830     C                   CLEAR                   W08MSG
257570000830     C                   Z-ADD     0             IX                4 0
257580000911    0C     *IN78         IFEQ      *ON
257590000830     C                   Z-ADD     1             NR8
257600000921     C                   SETOFF                                       9061
257610000830     C     NR8           CHAIN     LS01S08                            31
257620000831    1C     *IN31         DOWEQ     *OFF
257630000904     C* IGNORO CODICE SE ANNULLATO
257640000904   1AC     V8CSCE        IFEQ      ' '
257650000904     C* IL CODICE CHI SONO NON DEVE ESSERE RIPETUTO ALL'INTERNO
257660000904     C* DEL SUBFILE
257670000830     C     V8CNOT        LOOKUP    CHI                                    31
257680000831    2C     *IN31         IFEQ      *ON
257690000830     C* SE IL CODICE È DOPPIO ERRORE - ESCO DAL CICLO MEMORIZZANDO IL
257700000830     C* NRR IN ERRORE
257710000905     C                   Z-ADD     NR8           V8CNBR
257720000905     C                   SETON                                        9061
257730000911     C     WC01FG        IFEQ      'C'
257740000831     C                   MOVEL     ERR(205)      W08MSG
257750000911     C                   ELSE
257760000911     C                   MOVEA     ERR(205)      K78
257770000911     C                   MOVEA     *BLANKS       K78(44)
257780000911     C                   MOVEA     K78           W08MSG
257790000911     C                   ENDIF
257800000905     C                   UPDATE    LS01S08
257810000831     C                   GOTO      ENDS08
257820000831    2C                   ENDIF
257830021119      * Controllo prefisso chi sono
257840021119     c                   Movel     V8cNot        Wpre
257850080307     c     digits        check     v8cnot:3      wy
257860021119      * prefisso "FD" o "FM possibile solo per bolle FedEx
257870080307      * (se è seguito da 12 cifre)
257880021119     c                   If        (Wpre = 'FD' or Wpre = 'FM')
257890021119     c                              and A_§OgNtw <> 'FED' and
257900021119     c                                   VidDpd <> 'F'
257910080307     c                              and wy=15
257920021119     c                   Z-Add     Nr8           V8cNbr
257930021119     c                   Eval      *In90 = *On
257940021119     c                   Eval      *In61 = *On
257950021119     c                   Movel     Err(261)      W08Msg
257960021119     c                   Update    Ls01s08
257970021119     c                   GoTo      EndS08
257980021119     c                   EndIf
257990021119      * solo per bolle FedEx
258000021119If  2c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED')
258010021119     c                              and ix > 1
258020021119      * immesso prefisso "FM" o "FD"
258030021119      * tutti i segnacolli devono avere lo stesso prefisso
258040021119If  3c                   If        (Wpre = 'FD' or Wpre = 'FM')
258050021119     c     Wpre          Lookup    Prefisso                               30
258060021119      * Deve essere lo stesso prefisso già inserito
258070021119If  4c                   If        Not *In30
258080021119     c                   Z-Add     Nr8           V8cNbr
258090021119     c                   Eval      *In90 = *On
258100021119     c                   Eval      *In61 = *On
258110021119     c                   Movel     Err(260)      W08Msg
258120021119     c                   Update    Ls01s08
258130021119     c                   GoTo      EndS08
258140021119    4c                   EndIf
258150021119   x3c                   Else
258160021119      * immesso altro prefisso
258170021119      * non devono essere stati inseriti prefissi "FD" o "FM"
258180021119     c     'FD'          Lookup    Prefisso                               30
258190021119If  4c                   If        *In30
258200021119     c                   Z-Add     Nr8           V8cNbr
258210021119     c                   Eval      *In90 = *On
258220021119     c                   Eval      *In61 = *On
258230021119     c                   Movel     Err(260)      W08Msg
258240021119     c                   Update    Ls01s08
258250021119     c                   GoTo      EndS08
258260021119    4c                   EndIf
258270021119     c     'FM'          Lookup    Prefisso                               30
258280021119If  4c                   If        *In30
258290021119     c                   Z-Add     Nr8           V8cNbr
258300021119     c                   Eval      *In90 = *On
258310021119     c                   Eval      *In61 = *On
258320021119     c                   Movel     Err(260)      W08Msg
258330021119     c                   Update    Ls01s08
258340021119     c                   GoTo      EndS08
258350021119    4c                   EndIf
258360021119    3c                   EndIf
258370021119    2c                   EndIf
258380020308     c* Richiamo routine per controllare che cod. chi sono non sia
258390020308     c* doppio su fisgn e su blp (se segnacollo euroexpress)
258400020308     c                   eval      w8hcol = v8hcol
258410020308     c                   eval      w8cnot = v8cnot
258420020308     c                   eval      wnopos = ' '
258430020308     c                   exsr      ctrchidop
258440020308     c   90              goto      ends08
258450020308     C* SE NON C'È ERRORE MEMORIZZO IN SCHIERA
258460020308     C                   ADD       1             IX
258470020308     C                   MOVE      V8CNOT        CHI(IX)
258480020308     C                   Z-ADD     NR8           POS(IX)
258490021119      * Mi carico un Sk con solo il prefisso dei chi sono
258500021119     c                   Movel     Chi(ix)       Prefisso(ix)
258510000904   1AC                   ENDIF
258520000921     C                   UPDATE    LS01S08
258530000830     C                   ADD       1             NR8
258540000830     C  N90NR8           CHAIN     LS01S08                            31
258550000831    1C                   ENDDO
258560000911     C   31              SUB       1             NR8
258570000911    0C                   ENDIF
258580000907     C     IX            IFEQ      *ZEROS
258590000905     C                   SETON                                        90
258600000911     C     WC01FG        IFEQ      'C'
258610000905     C                   MOVEL     ERR(152)      W08MSG
258620000911     C                   ELSE
258630000911     C                   MOVEA     ERR(152)      K78
258640000911     C                   MOVEA     *BLANKS       K78(27)
258650000911     C                   MOVEA     K78           W08MSG
258660000911     C                   ENDIF
258670000911     C                   GOTO      ENDS08
258680000905     C                   ENDIF
258690000907     C* Richiamo pgm controllo Cod."CHI SONO"
258700010306     C* Se inseriti solo 2 codici E NUMERO COLLI A VIDEO > DI 2
258710000918     C* si potrebbe trattare di un dal/al
258720000907     C* e quindi richiamo pgm una volta sola passando entrambi i codici
258730000907    1C     IX            IFEQ      2
258740010306     C     V1CNCL        ANDGT     2
258750000907     C                   CLEAR                   DSLSZ1
258760000907     C                   MOVEL     'C'           IZ1MOD
258770000911     C                   MOVEL     WCTM          IZ1CTM
258780000907     C                   Z-ADD     V8CKSC        IZ1CCM
258790000907     C     §1BF12        IFEQ      'B'
258800000907     C                   Z-ADD     §LPNRS        IZ1NRS
258810000907     C                   ENDIF
258820000907     C                   MOVEL     CHI(1)        IZ1CH1
258830000907     C                   MOVEL     CHI(2)        IZ1CH2
258840000907     C                   CALL      'FNLSZ1R'
258850010402     C                   PARM                    KPJBA
258860000907     C                   PARM                    DSLSZ1
258870000907     C                   PARM                    DS1B
258880000907    2C     OZ1ERR        IFNE      ' '
258890000907    3C     OZ1ECH        IFEQ      '1'
258900000907     C                   Z-ADD     POS(1)        V8CNBR
258910000907   X3C                   ELSE
258920000907     C                   Z-ADD     POS(2)        V8CNBR
258930000907    3C                   ENDIF
258940000918     C     V8CNBR        CHAIN     LS01S08                            31
258950000907     C                   SETON                                        9061
258960000911     C     WC01FG        IFEQ      'C'
258970000907     C                   MOVEL     ERR(208)      W08MSG
258980000911     C                   ELSE
258990000911     C                   MOVEA     ERR(208)      K78
259000000911     C                   MOVEA     *BLANKS       K78(45)
259010000911     C                   MOVEA     K78           W08MSG
259020000911     C                   ENDIF
259030000907     C                   UPDATE    LS01S08
259040000911     C                   GOTO      ENDS08
259050000908     C                   ELSE
259060000908     C* SE NO ERRORE MEMORIZZO IL NUMERO DEI COLLI
259070000908     C                   Z-ADD     OZ1NCL        IX
259080020308    3c     oz1ncl        ifgt      2
259090020308     c                   movel     dslsz1        sav_dslsz1
259100020308     c* se numero dei colli > 2 si tratta di un dal/al
259110020308     c* devo quindi esplodere i codici per controllare che anche
259120020308     c* quelli all'interno del range non siano già presenti su fisgn
259130020308    4C     OZ1MAX        IFEQ      '2'
259140020308     C                   MOVEL     IZ1CH1        CHIDAL
259150020308     C                   MOVEL     IZ1CH2        CHIAL
259160020308   x4C                   ELSE
259170020308     C                   MOVEL     IZ1CH2        CHIDAL
259180020308     C                   MOVEL     IZ1CH1        CHIAL
259190020308    4C                   ENDIF
259200030214      * Prima di esplodere (per evitare giri inutili) controllo che il
259210030214      * n. dei cod. CHI SONO coincida con il n. dei colli immesso in
259220030214      * prima videata
259230030214If  4c                   If        Ix <> V1cNcl
259240030214     c                   Eval      *In90 = *On
259250030214If  5c                   If        Wc01Fg = 'C'
259260030214     c                   Eval      w08msg = Err(154)
259270030214   x5c                   Else
259280030214     c                   Movea     Err(154)      K78
259290030214     c                   Movea     *Blanks       K78(54)
259300030214     c                   Movea     K78           w08msg
259310030214    5c                   EndIf
259320030214     c                   GoTo      EndS08
259330030214    4c                   EndIf
259340020308    4C     CHIDAL        DOWNE     CHIAL
259350020308     C                   CLEAR                   DSLSZ1
259360020308     C                   MOVEL     'E'           IZ1MOD
259370020308     C                   MOVEL     CHIDAL        IZ1CH1
259380020308     C                   Z-ADD     V8CKSC        IZ1CCM
259390020308     C                   MOVEL     WCTM          IZ1CTM
259400020308     C     §1BF12        IFEQ      'B'
259410020308     C                   Z-ADD     §LPNRS        IZ1NRS
259420020308     C                   ENDIF
259430020308     C                   CALL      'FNLSZ1R'
259440020308     C                   PARM                    KPJBA
259450020308     C                   PARM                    DSLSZ1
259460020308     C                   PARM                    DS1B
259470020308    5C     OZ1CHI        IFNE      CHIAL
259480020308     c                   clear                   w8hcol
259490020308     c                   movel     '1'           wnopos
259500020308     c                   eval      w8cnot = oz1chi
259510020308     c                   exsr      ctrchidop
259520020308     c   90              movel     sav_dslsz1    dslsz1
259530020308     c   90              goto      ends08
259540020308    5c                   endif
259550020308     C                   MOVEL     OZ1CHI        CHIDAL
259560020308    4C                   ENDDO
259570020308     c                   movel     sav_dslsz1    dslsz1
259580020308    3c                   endif
259590000907    2C                   ENDIF
259600000907   X1C                   ELSE
259610010306     C* Se codici inseriti diverso da 2 O NUMERO COLLI <= 2
259620000918     C* li controllo una alla volta
259630001031     C                   Z-ADD     1             II                4 0
259640000907    2C     II            DOWLE     IX
259650000907     C                   CLEAR                   DSLSZ1
259660000907     C                   MOVEL     'C'           IZ1MOD
259670000911     C                   MOVEL     WCTM          IZ1CTM
259680000907     C                   Z-ADD     V8CKSC        IZ1CCM
259690000907     C     §1BF12        IFEQ      'B'
259700000907     C                   Z-ADD     §LPNRS        IZ1NRS
259710000907     C                   ENDIF
259720000907     C                   MOVEL     CHI(II)       IZ1CH1
259730000907     C                   CALL      'FNLSZ1R'
259740010402     C                   PARM                    KPJBA
259750000907     C                   PARM                    DSLSZ1
259760000907     C                   PARM                    DS1B
259770000907    3C     OZ1ERR        IFNE      ' '
259780000907     C                   Z-ADD     POS(II)       V8CNBR
259790000918     C     V8CNBR        CHAIN     LS01S08                            31
259800000907     C                   SETON                                        9061
259810000911     C     WC01FG        IFEQ      'C'
259820000907     C                   MOVEL     ERR(208)      W08MSG
259830000911     C                   ELSE
259840000911     C                   MOVEA     ERR(208)      K78
259850000911     C                   MOVEA     *BLANKS       K78(45)
259860000911     C                   MOVEA     K78           W08MSG
259870000911     C                   ENDIF
259880000907     C                   UPDATE    LS01S08
259890000911     C                   GOTO      ENDS08
259900000907    3C                   ENDIF
259910000911     C                   ADD       1             II
259920000907    2C                   ENDDO
259930000907    1C                   ENDIF
259940000908     c* Controllo che numero cod.chi sono corrisponda con numero colli
259950000908     c* in prima videata
259960000908     C     IX            IFNE      V1CNCL
259970000908     C                   SETON                                        90
259980000911     C     WC01FG        IFEQ      'C'
259990000908     C                   MOVEL     ERR(154)      W08MSG
260000000911     C                   ELSE
260010000911     C                   MOVEA     ERR(154)      K78
260020000911     C                   MOVEA     *BLANKS       K78(54)
260030000911     C                   MOVEA     K78           W08MSG
260040000911     C                   ENDIF
260050000908     C                   ENDIF
260060000911     C     ENDS08        TAG
260070000911     C                   MOVE      *BLANKS       WC01FG
260080000911     C                   ENDSR
260090020308     C**************************************************************************
260100020308     C*   Controllo se cod. chi sono già esistente
260110020308     C**************************************************************************
260120020308     C     CTRCHIDOP     BEGSR
260130020308     C* Se segnac. EUROEX controllo che non sia doppio in altra bolla
260140040505    1c     §ogntw        ifeq      'EEX'
260150020308     C     W8HCOL        ANDEQ     *ZEROS
260160020308     C                   MOVEL     'E'           WTRC
260170051102     C     KARS2         SETLL     FIARS02L                               31
260180020308    2C     *IN31         IFEQ      *ON
260190020308    3c     wnopos        ifeq      *blanks
260200020308     C                   Z-ADD     NR8           V8CNBR
260210020308     c                   seton                                        61
260220020308    3c                   endif
260230020308     C                   SETON                                        90
260240020308     C                   MOVEA     ERR(155)      K78
260250020308     C                   MOVEL     w8CNOT        W030A            30
260260020308     C                   MOVEA     W030A         K78(18)
260270020308     C                   MOVEA     K78           W08MSG
260280020308    3c     wnopos        ifeq      *blanks
260290020308     C                   UPDATE    LS01S08
260300020308    3c                   endif
260310020308     C                   GOTO      ENDCDOP
260320020308    2C                   ENDIF
260330020308    1C                   ENDIF
260340020308     C* MSG FORZABILE SE CHI SONO GIA' PRESENTE SU FISGN
260350020308     C* (SOLO SE RECORD E' DI NUOVA IMMISSIONE)
260360020308     C* 02/05/01: RENDO ERRORE BLOCCANTE SU RICHIESTA DELLA LORENA
260370020308    1C     W8HCOL        IFEQ      *ZEROS
260380020308     C     KSGN88        CHAIN(N)  FISGN01L                           31
260390020308    2C     *IN31         IFEQ      *OFF
260400020308     C     SGNATB        ANDNE     '*'
260410020308    3c     wnopos        ifeq      *blanks
260420020308     C                   Z-ADD     NR8           V8CNBR
260430020308     c                   seton                                        61
260440020308    3c                   endif
260450020308     C                   SETON                                        90
260460020308     c                   eval      w08msg = %trim(err(209)) + ' '
260470020308     c                             + %trim(w8cnot)
260480020308     c                             + ' presente in altra bolla'
260490020308    3c     wnopos        ifeq      *blanks
260500020308     C                   UPDATE    LS01S08
260510020308    3c                   endif
260520020308     C                   GOTO      ENDCDOP
260530020308    2C                   ENDIF
260540020308    1C                   ENDIF
260550020308     c     ENDCDOP       endsr
260560010504     C**************************************************************************
260570010504     C*   ELIMINAZIONE CHI SONO ANNULLATI DA SUBFILE
260580010504     C**************************************************************************
260590010504     C     CTRS8A        BEGSR
260600010504    0C     *IN78         IFEQ      *ON
260610010504     C                   Z-ADD     1             NR8
260620010504     C     NR8           CHAIN     LS01S08                            31
260630010504    1C     *IN31         DOWEQ     *OFF
260640010504     C* SE RECORD ANNULLATO DEVO TOGLIERLO DA CH2
260650010504     C     V8CSCE        IFEQ      'A'
260660010504     C                   Z-ADD     1             WK                3 0
260670010504     C     V8CNOT        LOOKUP    CH2(WK)                                31
260680010504     C   31              MOVE      *BLANKS       CH2(WK)
260690010504     C                   UPDATE    LS01S08
260700010504     C                   ENDIF
260710010504     C                   ADD       1             NR8
260720010504     C  N90NR8           CHAIN     LS01S08                            31
260730010504    1C                   ENDDO
260740010504     C   31              SUB       1             NR8
260750010504    0C                   ENDIF
260760010504     C                   ENDSR
260770000912     C**************************************************************************
260780000912     C*   AGGIORNAMENTO FILE FISGN00F
260790000912     C**************************************************************************
260800000912     C     UPDSGN        BEGSR
260810000921     C* QUESTO CAMPO NON CREDO CHE SIA UTILIZZATO ADOGNI MODI MI SEMBRA
260820000921     C* GIUSTO IN QUESTO CASO ABBLENCARLO
260830000921     C     SGNATB        IFEQ      '*'
260840000921     C                   CLEAR                   SGNSQU
260850000921     C                   ENDIF
260860000921     C*
260870000919     C                   CLEAR                   SGNATB
260880000921     C                   Z-ADD     §3ISEA        SGNSEA
260890000921     C                   MOVEL     'S'           SGNST1
260900000925     C     §1BF12        IFNE      'N'
260910001011     C     WEXDPD        ANDNE     'S'
260920050228     c     *in79         andeq     *off
260930090624      *
260940001009     C     §1BF12        ORNE      'N'
260950001011     C     WEXDPD        ANDEQ     'S'
260960001009     C     §1BF13        ANDEQ     'A'
260970090624      *
260980070323     C     §1BF12        ORNE      'N'
260990070323     C     WEXDPD        ANDEQ     'S'
261000090624     C     wparcel       andeq     '12'
261010090624      *
261020000925     C                   Z-ADD     V8HST2        SGNST2
261030000925     C                   ENDIF
261040000921     C                   MOVE      '0'           SGNFL1
261050000912     C     BLPCCM        IFGT      0
261060000912     C                   MOVEL     BLPCCM        SGNKSC
261070000912     C                   ELSE
261080000912     C                   MOVEL     BLPKSC        SGNKSC
261090000912     C                   ENDIF
261100000921     C                   Z-ADD     BLPLNP        SGNLNP
261110000921     C                   Z-ADD     BLPNSP        SGNNSP
261120010116     C                   CLEAR                   SGNT6A
261130010116     C                   CLEAR                   SGNT6B
261140010116     C                   CLEAR                   SGNT6C
261150010116     C                   CLEAR                   SGNT6D
261160010116     C                   CLEAR                   SGNT6E
261170010116     C                   CLEAR                   SGNT6F
261180080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
261190000922     C                   CLEAR                   SGNRST
261200001005     C     WSGNR         IFEQ      'B'
261210001005     C                   UPDATE    FISGN005
261220001005     C                   ELSE
261230000912     C                   UPDATE    FISGN000
261240001005     C                   ENDIF
261250000912     C                   ENDSR
261260000929     C**************************************************************************
261270000929     C*   SCRITTURA     FILE FISGN00F
261280000929     C**************************************************************************
261290000929     C     WRTSGN        BEGSR
261300000929     C                   CLEAR                   SGNATB
261310000929     C                   MOVEL(P)  V8CNOT        SGNWHO
261320000929     C                   Z-ADD     §3ISEA        SGNSEA
261330000929     C                   MOVEL     'S'           SGNST1
261340001002     C     WSGNR         IFEQ      *BLANKS
261350000929     C                   CLEAR                   SGNST2
261360001002     C                   ELSE
261370001002     C                   Z-ADD     1             SGNST2
261380010405     C* SGNFL2 = N SIGNIFICA CHE SI TRATTA DI FISGN SCRITTO PER SOLA
261390010405     C* RISTAMPA --> NON E' UN REALE DISK C
261400010405     C                   MOVEL     'N'           SGNFL2
261410001002     C                   ENDIF
261420000929     C                   MOVE      '0'           SGNFL1
261430000929     C                   MOVEL     BLPLNP        SGNLNP
261440000929     C                   MOVEL     BLPNSP        SGNNSP
261450000929     C     BLPCCM        IFGT      0
261460000929     C                   MOVEL     BLPCCM        SGNKSC
261470000929     C                   ELSE
261480000929     C                   MOVEL     BLPKSC        SGNKSC
261490000929    4C                   ENDIF
261500010116     C                   CLEAR                   SGNT6A
261510010116     C                   CLEAR                   SGNT6B
261520010116     C                   CLEAR                   SGNT6C
261530010116     C                   CLEAR                   SGNT6D
261540010116     C                   CLEAR                   SGNT6E
261550010116     C                   CLEAR                   SGNT6F
261560080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
261570000929     C                   CLEAR                   SGNRST
261580010116     C                   Z-ADD     COMTFP        SGNTNP
261590001005     C     WSGNR         IFEQ      'B'
261600001005     C                   WRITE     FISGN005
261610001005     C                   ELSE
261620001005     C                   WRITE     FISGN000
261630001005     C                   ENDIF
261640001005     C*
261650000929     C                   ENDSR
261660010209     C**************************************************************************
261670010209     C*   VERIFICO SE ATTIVATA PROCEDURA O.R.M.
261680011121     C**************************************************************************
261690010209     C     ATTORM        BEGSR
261700010209     C                   MOVE      *BLANKS       WORM              1
261710010220     C   12
261720010220     CAN 15VIDPOE        IFGT      *ZEROS
261730010209     C                   MOVEL     'S'           WORM
261740010209     C                   ENDIF
261750010305     C     §LPFPR        IFNE      'O'
261760010215     C     *IN12         IFEQ      *OFF
261770010215     C     *IN15         OREQ      *OFF
261780010219     C                   MOVE      WLNPO         W0030
261790010215     C     W0030         CHAIN     AZORG01L      UNIORG               30
261800010209     C  N30              MOVEL     ORGDE8        OG148
261810010209     C   30              CLEAR                   OG148
261820060926     c                   eval      §ogorm='S'
261830010209     C     §OGORM        IFEQ      'S'
261840010209     C                   MOVEL     'S'           WORM
261850010209     C                   ENDIF
261860010215     C                   ENDIF
261870010305     C                   ELSE
261880010301     C                   MOVEL     'S'           WORM
261890010301     C                   ENDIF
261900010209     C* IMPOSTO INDICATORI PER NON VISUALIZZARE KEY ORM SE P.O. NON
261910010209     C* ABILITATO
261920010209     C     WORM          IFEQ      *BLANKS
261930010223     C                   SETOFF                                       37
261940010209     C                   MOVEL     NDPR          ATRPOE
261950010215     C                   MOVEL     NDPR          ATRORM
261960010219     C                   MOVEL     NODI          ATRDOR
261970010209     C                   CLEAR                   VIDPOE
261980010209     C                   CLEAR                   VIDNOR
261990010209     C                   CLEAR                   VIDNRV
262000010209     C* Campi della videata di personalizzazione
262010010209     C                   MOVEL     NDPR          AT0POE
262020010215     C                   MOVEL     NDPR          AT0ORM
262030010219     C                   MOVEL     NODI          AT0DOR
262040010209     C                   CLEAR                   V0CPOE
262050010209     C                   CLEAR                   V0CNOR
262060010209     C                   CLEAR                   V0CNRV
262070010222     C* Questa routine viene richiamata anche in immissione bolle
262080010222     C* tutte le volte che variano la linea di partenza.
262090010222     C* Se si passa da lnp attivata a proc. ORM ad una NON attivata
262100010222     C* bisogna spegnere indicatore 06 di posiz. cursore su N. ORM
262110010222     C* se è acceso e al suo posto bisogna accendere lo 07
262120010222     C  N12*IN06         IFEQ      *ON
262130010222     C                   SETOFF                                       06
262140010222     C                   SETON                                        07
262150010222     C                   ENDIF
262160010209     C                   ELSE
262170010209     C* PROCEDURA ORM ATTIVA
262180010409     C* Chaino tabella DFT per prendere il massimo peso in KG per la
262190010409     C* richiesta note obbligatoria
262200010409     C* Provo prima con key = p.o. ritiro
262210010409     c* Se record non trovato chaino record 999
262220010409     C                   CLEAR                   WTRDFT
262230010409     C                   CLEAR                   DSBS02
262240010409     C                   MOVEL     'C'           T02MOD
262250010409     C                   MOVEL     KNSIF         T02SIF
262260010409     C                   MOVEL     'DFT'         T02COD
262270010409     C                   MOVEL(P)  WLNPO         T02KE1
262280010409     C     WTRDFT        DOWEQ     *BLANKS
262290010409      *
262300010409     C                   CALL      'TIBS02R'
262310010409     C                   PARM                    KPJBA
262320010409     C                   PARM                    DSBS02
262330010409      *
262340010409     C     T02ERR        IFEQ      *BLANKS
262350010409     C     T02KE1        OREQ      '999'
262360010409     C                   MOVEL     '1'           WTRDFT            1
262370010409     C     T02ERR        IFEQ      *BLANKS
262380010409     C                   MOVEL     T02UNI        DDFT
262390010409     C                   ELSE
262400010409     C                   CLEAR                   DDFT
262410010409     C                   ENDIF
262420010409     C                   ELSE
262430010409     C                   MOVEL     '999'         T02KE1
262440010409     C                   CLEAR                   T02ERR
262450010409     C                   ENDIF
262460010409     C                   ENDDO
262470010409     C*
262480010209     C                   CLEAR                   ATRPOE
262490010215     C                   CLEAR                   ATRORM
262500010219     C                   CLEAR                   ATRDOR
262510010209     C* Campi della videata di personalizzazione
262520010209     C                   CLEAR                   AT0POE
262530010215     C                   CLEAR                   AT0ORM
262540010219     C                   CLEAR                   AT0DOR
262550010209     C* IN IMMISSIONE PREPAGATI  MIEI KEY ORM = ND + PR
262560010220     C     PARTCH        IFEQ      'P'
262570010220     C                   MOVEL     NDPR          ATRPOE
262580010220     C                   MOVEL     NDPR          ATRORM
262590010220     C                   MOVEL     NODI          ATRDOR
262600010220     C                   MOVEL     NDPR          AT0POE
262610010220     C                   MOVEL     NDPR          AT0ORM
262620010220     C                   MOVEL     NODI          AT0DOR
262630010220     C                   ENDIF
262640010209     C* IN IMMISSIONE PREPAG.NON MIEI KEY ORM =      PR
262650010301     C     §LPFPR        IFEQ      'O'
262660010209     C* IN CONFERMA                   KEY ORM =      PR
262670010301     C     *IN12         OREQ      *ON
262680010301     C     *IN15         ANDEQ     *ON
262690010301     C                   MOVEL     PROT          ATRPOE
262700010301     C                   MOVEL     PROT          ATRORM
262710010301     C                   ENDIF
262720010213     C*
262730010213     C* INIZIALIZZO ANCHE CAMPI DI CMODO CHE MI SERVONO NELLA ROUTINE
262740010213     C* DEI CONTROLLI SE PROCEDURA ORM ATTIVATA
262750010220     C     *IN12         IFEQ      *OFF
262760010301     C     §LPFPR        ANDNE     'O'
262770010213     C                   CLEAR                   PREDRT
262780010214     C                   CLEAR                   PREPDR
262790010214     C                   CLEAR                   PREFPP
262800010214     C                   CLEAR                   PRECCM
262810010214     C                   CLEAR                   PREFFD
262820010222     C* Questa routine viene richiamata anche in immissione bolle
262830010222     C* tutte le volte che variano la linea di partenza.
262840010222     C* Se si passa da lnp non attivata a proc. ORM ad una attivata
262850010222     C* bisogna spegnere indicatore 07 di posiz. cursore su cod mitt
262860010222     C* se è acceso e al suo posto bisogna accendere lo 06
262870010222     C     *IN07         IFEQ      *ON
262880010222     C                   SETOFF                                       07
262890010222     C                   SETON                                        06
262900010222     C                   ENDIF
262910010220     C                   ENDIF
262920010215     C                   CLEAR                   WORMMD
262930010220     C                   CLEAR                   WPRIMV
262940040319     c                   Eval      wmodorm = *Off
262950010222     C* SE SONO IN MANUTENZIONE DEVO POSIZIONARE IL CURSORE SUL
262960010222     C* NUMERO ORM
262970010222     C     *IN12         IFEQ      *ON
262980010222     C     *IN15         ANDEQ     *OFF
262990040323      * ma se bolla di recupero o bolla 'FW' devo proteggere il n. ORM
263000040323if  3c                   If        §3arbl = 'R' or vidcbo = 'FW'
263010040323     c                   Movel     prot          atrpoe
263020040323     c                   Movel     prot          atrorm
263030040324     c                   Eval      *In06 = *Off
263040040323     c                   GoTo      Endattorm
263050040323e   3c                   EndIf
263060040323      * o se bolla legata devo proteggere il n. ORM
263070040323     c     kBlp3         Setll     Fnlbl01l
263080040323if  3c                   If        %Equal(Fnlbl01l)
263090040323     c                   Movel     prot          atrpoe
263100040323     c                   Movel     prot          atrorm
263110040324     c                   Eval      *In06 = *Off
263120040323     c                   GoTo      Endattorm
263130040323    3c                   EndIf
263140010222     C                   SETOFF                                       07
263150010222     C                   SETON                                        06
263160010222     C                   ENDIF
263170010209     C                   ENDIF
263180011121     C*
263190040323     C     endattorm     ENDSR
263200010228     C**************************************************************************
263210010228     C*   RIEMPIMENTO CAMPI DI PASSAGGIO A PGM FIOR05R
263220010228     C**************************************************************************
263230010228     C     RIEO05        BEGSR
263240010228     C                   CLEAR                   DSOR05
263250010228     C*
263260010228     C                   MOVEL     '2'           §RMTLA
263270010228     C                   MOVEL     'B'           §RMFPR
263280010228     C                   Z-ADD     VIDLNP        §RMPOE
263290010228     C                   Z-ADD     VIDLNP        §RMPOR
263300010228     C                   MOVEL     'P'           §RMTOR
263310010228     C                   MOVEL     'P'           §RMTCO
263320010305     C                   Z-ADD     VIDCCM        W0070             7 0
263330010228     C     VIDFLC        IFEQ      0
263340010228     C                   MOVEL     VIDLNP        W0070
263350010228     C                   ELSE
263360010228     C                   MOVEL     VIDFLC        W0070
263370010228     C                   ENDIF
263380010228     C                   CLEAR                   §RMCRA
263390010228     C     VIDCCM        IFNE      8888
263400010228     C                   MOVEL     W0070         §RMCRA
263410010228     C                   ENDIF
263420010228     C                   MOVEL     VIDRSM        §RMRSR
263430010228     C                   MOVEL     VIDINM        §RMINR
263440010228     C                   MOVEL     VIDCAM        §RMCAR
263450010228     C                   MOVEL     VIDLOM        §RMLOR
263460010228     C                   MOVEL     VIDPRM        §RMPRR
263470010228     C                   MOVEL     VIDNZM        §RMNAR
263480010228     C                   MOVEL     VIDRSD        §RMRSC
263490010228     C                   MOVEL     VIDIND        §RMINC
263500010228     C                   MOVEL     VIDCAD        §RMCAC
263510010228     C                   MOVEL     VIDLOD        §RMLOC
263520010228     C                   MOVEL     VIDPRD        §RMPRC
263530010228     C                   MOVEL     VIDNZD        §RMNAC
263540010228     C     VIDFFD        IFEQ      'N'
263550010228     C                   MOVEL     *BLANKS       §RMFFD
263560010228     C                   ELSE
263570010228     C                   MOVEL     VIDFFD        §RMFFD
263580010228     C                   ENDIF
263590010228     C                   MOVEL     VIDNAS        §RMNAM
263600010228     C                   Z-ADD     VIDNCL        §RMNCL
263610010228     C                   Z-ADD     VIDPKG        §RMPKG
263620010228     C                   Z-ADD     VIDVOL        §RMVLM
263630010228     C                   MOVEL     'M'           §RMPAG
263640010228     C                   MOVEL     VIDNT1        §RMNO1
263650010228     C                   MOVEL     VIDNT2        §RMNO2
263660010228     C                   MOVEL     VIDRMA        §RMRFA
263670010228     C                   ENDSR
263680011212     C**************************************************************************
263690011212     C*   RICHIAMO PGM DI UTILITA' PER EDITARE CAMPO NUMERICO
263700011212     C**************************************************************************
263710011212     C     CALLXE        BEGSR
263720011212     C                   CLEAR                   DSEDIT
263730011212     C                   CLEAR                   W014A
263740011212     C                   MOVE      WNUMED        IEDNUM
263750011212     C                   Z-ADD     3             IEDNRD
263760011212     C                   MOVE      '4'           IEDEDT
263770011212     C                   Z-ADD     14            IEDLEN
263780011212     C                   CALL      'XEDIT'
263790011212     C                   PARM                    DSEDIT
263800011212     C     OEDFLG        IFEQ      *OFF
263810011212     C                   MOVEL     OEDNUM        W014A            14
263820011212     C                   ENDIF
263830011212     C                   ENDSR
263840020212     C**************************************************************************
263850020212     C*   Calcolo check digit AWB FEDEX
263860020212     C**************************************************************************
263870020212     C     CHKDGF        BEGSR
263880020212      * Il check digit del codice a barre di FedEx va colcolato moltiplicando
263890020212      * il numero del codice a barre (partendo dall'undicesimo e andando a
263900020212      * a ritroso) per un valore alternato (1 - 3 - 7) e sommati tra loro, il
263910020212      * totale va diviso per 11 e il resto è i check digit
263920020212      * se il resto è 10 o 0 il check digit deve essere 0
263930020212      * Esempio:
263940020212      * codice a barre 0 1  2 3 4  5  6 7  8  9 8
263950020212      * valore         3 1  7 3 1  7  3 1  7  3 1
263960020212      * totale         0 1 14 9 4 35 18 7 56 27 8 = 179
263970020212      * check digit    179 / 11 = 16 resto 3
263980020212     c                   move      w0012a        fedexbrc
263990020214     c                   clear                   totale
264000020212
264010020212      * Carico 1 - 3 - 7 in una schiera di comodo 'base'
264020020212
264030020212     c                   eval      base(1) = 1
264040020212     c                   eval      base(2) = 3
264050020212     c                   eval      base(3) = 7
264060020212
264070020212     c                   eval      zw = 0
264080020212
264090020212      * parto dall'undicesimo numero
264100020212     c     11            do        11            xw
264110020212      * andando all'indietro il contatore arriva a 0 e devo uscire dal ciclo
264120020212     c                   if        xw = 0
264130020212     c                   leave
264140020212     c                   endif
264150020212     c                   eval      zw = zw + 1
264160020212     c                   eval      totale = totale + (fbrc(xw) * base(zw))
264170020212
264180020212     c                   if        zw = 3
264190020212     c                   eval      zw = 0
264200020212     c                   endif
264210020212      * torno indietro
264220020212     c                   enddo     -1
264230020212
264240020212     c     totale        div       11            intero
264250020212     c                   mvr                     restof
264260020212
264270020212     c                   if        restof = 0 or restof = 10
264280020212     c                   move      '0'           fchd
264290020212     c                   else
264300020212     c                   move      restof        fchd
264310020212     c                   endif
264320020212
264330020212     c                   move      fedexbrc      w0012a
264340020212     c                   ENDSR
264350040601     C**************************************************************************
264360040601     C*   Scrittura fiar8
264370040601     C**************************************************************************
264380040601     C     SR_fiar8      BEGSR
264390040601     c     kblc          setll     fivax01l
264400040601     c                   do        *hival
264410061010     c     kblc          reade(N)  fivax01l
264420040601     c                   if        %eof(fivax01l)
264430040601     c                   leave
264440040601     C                   endif
264450040601     c                   clear                   fiar8000
264460040601     c                   Eval      Ar8Aas = BlpAas
264470040601     c                   Eval      Ar8Lnp = BlpLnp
264480040601     c                   Eval      Ar8Nrs = BlpNrs
264490040601     c                   Eval      Ar8Nsp = BlpNsp
264500040601     c                   eval      ar8tmd = vaxtmd
264510040601     c                   eval      ar8prr = vaxprr
264520040601     c                   eval      ar8trk = vaxtrk
264530050913     c                   eval      ar8uni = %trimr(vaxdtt)
264540040601     c                   write     fiar8000
264550130308     c                   eval      w_allx='S'
264560040601     c                   enddo
264570040601     c                   endsr
264580130304     C**************************************************************************
264590130304     C*   Scrittura fiar8 da fivat tipo record "P"
264600130304     C**************************************************************************
264610130304     C     SR_fiar8_vatp BEGSR
264620130304     c                   clear                   w_prr
264630130304     c                   clear                   w_pdfn
264640130304     C                   MOVEL     'P'           WTRC
264650130304     c     kvat          setll     fivat01l
264660130305    1c                   do        *hival
264670130304     c     kvat          reade(N)  fivat01l
264680130305    2c                   if        %eof(fivat01l)
264690130304     c                   leave
264700130305    2C                   endif
264710130304     c                   movel(P)  vatnot        dvatp
264720130305    2c                   if        §vatppdfn=*blanks
264730130304     c                             or §vatppdfn=w_pdfn
264740130304     C                   iter
264750130305    2c                   endif
264760130304     c                   movel     §vatppdfn     w_pdfn
264770130304     c                   eval      w_prr+=1
264780130304     c                   clear                   fiar8000
264790130304     c                   Eval      Ar8Aas = BlpAas
264800130304     c                   Eval      Ar8Lnp = BlpLnp
264810130304     c                   Eval      Ar8Nrs = BlpNrs
264820130304     c                   Eval      Ar8Nsp = BlpNsp
264830130304     c                   eval      ar8tmd = '§PDF'
264840130304     c                   eval      ar8prr = w_prr
264850130304     c                   clear                   dar8§pdf
264860130304     c                   eval      §AR8PIDZ=§VATPIDZ
264870130306     c                   eval      §AR8PPDFP=§clipdfp
264880130306     c                   eval      §AR8PPDFn=§VATPPDFN
264890130311     c* se non prevista la stampa imposto a "N" il flag per il trattamento
264900130311     c* dell'allegato (su richiesta di FG)
264910130315     c                   if        %subst(§ar8pidz:1:1)<>'1'
264920130311     c                   eval      §ar8ptrt='N'
264930130315     c                   endif
264940130408     c* se non prevista la mail   imposto a "N" il flag per invio email
264950130408     c                   if        %subst(§ar8pidz:2:1)<>'1'
264960130408     c                   eval      §ar8peml='N'
264970130408     c                   else
264980130408     c                   eval      w_allm='S'
264990130408     c                   endif
265000130304     c                   eval      ar8uni = %trimr(dar8§pdf)
265010130304     c                   write     fiar8000
265020130305    1c                   enddo
265030130304     c                   endsr
265040060308     C**************************************************************************
265050060308     C*   Richiamo lv85r per chiusura in LR
265060060308     C**************************************************************************
265070060308     C     CLS_lv85      BEGSR
265080060308     c*   ATTENZIONE: Il pgm fnlv85r serve per gestire richiesta, controllo
265090060308     c*               registrazione su data base del motivo variazione
265100060308     c*
265110060308     c*               Per ora il pgm di bollettazione richiama l'lv85
265120060308     c*               in due casi diversi di variazione bolla:
265130060308     c*               1)variazione totale imponibile di un prepagato (cvb TR
265140060308     c*               2)annullamento di un prepagato (cvb KM)
265150060308     c*
265160060308     c*               Quando fnlv85r viene richiamato in modalità "V"
265170060308     c*               (richiesta e controllo della motivazione)
265180060308     c*               viene passato tipo lancio (ilv85tla) = blanks
265190060308     c*               per chiudere in return.
265200060308     c*               In questo modo la window di richiesta motivazione
265210060308     c*               non viene pulita ed in caso di F12=Ritorno e successi-
265220060308     c*               va riconferma della variazione la window viene ripropo
265230060308     c*               sta con i dati precedentemente immessi.
265240060308     c*               Il pgm deve però essere chiuso con LR se la window
265250060308     c*               precedente era stata emessa a fronte di una causale
265260060308     c*               diversa dalla quale si era usciti con f12 anzichè
265270060308     c*               con f6=Conferma. Questa routine serve proprio per
265280060308     c*               chiudere con LR se cambiata la causale variazione
265290060308     c*               al fine di emettere la window pulita.
265300060308     c*
265310060308     c                   if        ilv85cvb <> *blanks and ilv85cvb <> wcvb
265320060308     c                   clear                   fnlv85ds
265330060308     c                   eval      ilv85tla = 'C'
265340060308     c                   movel     fnlv85ds      kpjbu
265350060308     c                   call      'FNLV85R'
265360060308     c                   parm                    kpjba
265370060308     c                   endif
265380060308     c                   endsr
265390060427     C**************************************************************************
265400060427     C*   Forzature per orm esteri con triangolazione
265410060427     C**************************************************************************
265420060427     C     sr_FOrmEst    BEGSR
265430060427      * Forzo che deve essere un porto franco
265440060427     c                   Eval      §OrPfb = 'F'
265450060427      * Flag di appoggio per portare l'ordinante nel mittente
265460060427      * e il mittente orm nel mittente originale
265470060427     c                   Eval      wforpf = '1'
265480060427if 1ac                   if        wnoccm = '1'
265490130212     c                   clear                   wnoccm
265500060427      * Ksc da ORM
265510060427if  2c                   If        OrmKsc > *Zeros
265520060427      * propongo il ksc dell'ORM
265530060427     c                   Move      OrmKsc        vidccm
265540060427     c                   Movel     OrmKsc        w0030
265550130212     c                   Z-add     w0030         vidflc
265560060427      * SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
265570060427      *  BOLLA --> ABILITA LA FILIALE CLIENTE
265580060427if  3C                   If        w0030 <> vidlnp
265590130212     c****               Z-add     w0030         vidflc
265600060427     c                   Seton                                        14
265610060427    3c                   EndIf
265620060427      * no Ksc da ORM
265630060427   x2c                   Else
265640060427      * propongo la ragione sociale dell'ordinante nella ricerca alfabetica
265650060427     c                   Movel     OrmRso        viddmt
265660060427     c                   clear                   vidccm
265670060427if  3c                   If        viddmt <> *Blanks
265680060427     c***                Seton                                        0138
265690060427     c                   Seton                                        01
265700060427    3c                   EndIf
265710060427    2c                   EndIf
265720060427   1ac                   endif
265730060427     c                   endsr
265740070403     C**************************************************************************
265750070403     C*   Aggiornamento/scrittura numero giro
265760070403     C**************************************************************************
265770070403     C     sr_FIARG      BEGSR
265780070404     c                   clear                   wupd              1
265790100323     c                   clear                   wFGI              1
265800100323     c                   clear                   wAggioARG
265810100323     c* Verifico se per il cliente mittente è presente una forzatura GIRO
265820100323     c*  nel file azfgi
265830100323     c                   eval      kksc=wksc
265840100323     c                   eval      klnp=blplnp
265850100323     c                   eval      klna=blplna
265860100323     c                   exsr      LeggiFGI
265870100323     c
265880100323    1c                   if        wfgi=*blanks
265890100323     c                   eval      klnp=999
265900100323     c                   exsr      LeggiFGI
265910100323    1c                   endif
265920100323     c
265930100323    1c                   select
265940070405     c* conferma bolla di reso
265950070405     c                   when      *in12='1' and *in15='1' and
265960070405     c                             vidfbr='S' and *in44='1'
265970070705     c*                  if        §lpcgi<>*blanks and
265980070705     c*                            vidrsd=savrsd and
265990070705     c*                            vidind=savind and
266000070705     c*                            vidprd=savprd and
266010070705     c*                            vidcad=savcad and
266020070705     c*                            vidlod=savlod and
266030070705     c*                            vidnzd=nzdini
266040100323    2c                   if        §lpcgi<>*blanks
266050070405     c                   eval      w_cgi=§lpcgi
266060070405     c                   exsr      ges_arg
266070100323    2c                   endif
266080100323
266090100323     c* Immissione oppure conferma bolla NON di reso
266100100323    1c                   when      *in12='0' or *in15='1'
266110100323     c*  Se c'e' AZFGI --> vince sui destinatari
266120100323    2c                   if        wfgi='S'
266130100323     c                   eval      w_cgi=fgicgi
266140100323     c                   exsr      ges_arg
266150100323   x2c                   else
266160100323    3c                   if        ot0err=*blanks and ot0x1cgi<>*blanks
266170070924     c                             and comlna=ot0x1pog
266180070924     c                   eval      w_cgi=ot0x1cgi
266190070404     c                   exsr      ges_arg
266200100323    3c                   endif
266210100323    2c                   endif
266220100323     c* Manutenzione bolla
266230100323    1c                   when      *in12='1' and *in15='0'
266240100323     c* Se modificato il mittente ed il nuovo ha il giro forzato --> vince
266250100323    2c                   if        wksc<>savmit  or
266260100323     c                             blplna<>lna_sav
266270100323     c                   clear                   wupd              1
266280100323     c     kblp3         chain     fiarg01l
266290100323    3c                   if        %found(fiarg01l)
266300100323     c                   eval      wupd='1'
266310100323    3c                   endif
266320100323     c
266330100323    3c                   if        wFGI='S'
266340100323     c                   eval      w_cgi=fgicgi
266350100323     c                   exsr      ges_arg
266360100323   x3c                   else
266370100323     c
266380100323     c* Se non ha il giro ed il vecchio ce lo aveva, cancello FIARG
266390100323     c*  e poi proseguo con gli altri controlli
266400100323     c
266410100323    4c                   if        %found(fiarg01l)
266420100323     c                   eval      klna=lna_sav
266430100323     c                   eval      kksc=savmit
266440100323     c                   eval      klnp=blplnp
266450100323     c                   exsr      LeggiFGI
266460100323     c
266470100323    5c                   if        wfgi=*blanks
266480100323     c                   eval      klnp=999
266490100323     c                   exsr      LeggiFGI
266500100323    5c                   endif
266510100323     c
266520100323    5c                   if        wfgi='S' and fgicgi=argcgi
266530100323     c                   delete    fiarg000
266540100323    5c                   endif
266550100323    4c                   endif
266560100323    3c                   endif
266570100323    2c                   endif
266580100323     c
266590100323    2c                   if        vidrsd<>savrsd or
266600070404     c                             blpind<>savind or
266610070404     c                             blpprd<>savprd or
266620070404     c                             blpcad<>savcad or
266630070404     c                             blplod<>savlod or
266640070404     c                             blpnzd<>savnzd or
266650100323     c                             blplna<>lna_sav or
266660100323     c                             wksc<>savmit
266670100323     c
266680100323     c* non Faccio nulla se ho già aggiornato FIARG col nuovo mittente o
266690100323     c*  nuova linea di arrivo
266700100323    3c                   if        WaggioARG=' '
266710100323     c
266720100323    4c                   if        ot0err=*blanks and
266730071010     c                             ot0x1cgi<>*blanks and comlna=ot0x1pog
266740070924     c                   eval      w_cgi=ot0x1cgi
266750100323     c                   clear                   wupd              1
266760070404     c     kblp3         chain     fiarg01l
266770100323    5c                   if        %found(fiarg01l)
266780070404     c                   eval      wupd='1'
266790100323    5c                   endif
266800070404     c                   exsr      ges_arg
266810100323   x4c                   else
266820070404     c     kblp3         delete(e) fiarg01l
266830100323    4c                   endif
266840100323    3c                   endif
266850100323    2c                   endif
266860100323    1c                   endsl
266870070403     c
266880070403     c                   endsr
266890070404     C**************************************************************************
266900070404     C*   Aggiornamento/scrittura numero giro
266910070404     C**************************************************************************
266920070404     C     ges_arg       BEGSR
266930100323     c                   clear                   WaggioARG         1
266940070404     c                   if        wupd=*blanks
266950070404     c                   clear                   fiarg000
266960070404     c                   z-add     blpaas        argaas
266970070404     c                   z-add     blplnp        arglnp
266980070404     c                   z-add     blpnrs        argnrs
266990070404     c                   z-add     blpnsp        argnsp
267000070404     c                   endif
267010070404     c                   z-add     blplna        arglna
267020070404     c* p.o. di consegna capofila della £6 del p.o. di arrivo
267030070404     c                   clear                   dslv55
267040070404     c                   eval      d55tpt = '6'
267050070404     c                   z-add     blplna        d55lin
267060070404     c                   z-add     blpdsp        d55drf
267070070404     c                   call      'FNLV55R'
267080070404     c                   parm                    dslv55
267090070404     c                   z-add     d55tfa        argpoc
267100070404     c                   movel     'M'           argtgi
267110070404     c                   movel     w_cgi         argcgi
267120070404     c                   if        wupd=*blanks
267130070404     c                   write     fiarg000
267140070404     c                   else
267150070404     c                   update    fiarg000
267160070404     c                   endif
267170100323     c
267180100323     c                   eval      wAggioARG='S'
267190070404     c                   endsr
267200100323     C**************************************************************************
267210100323     c* Lettura file forzatura giro di consegna
267220100323     C**************************************************************************
267230100323     c     LeggiFGI      BEGSR
267240100323     c     kfgi          setll     azfgi01l
267250100323     c     kfgi          reade     azfgi01l
267260100323     c
267270100323     c                   dow       not %eof(azfgi01l)
267280100323     c                   if        blpdsp>=fgidde and blpdsp<=fgidsc
267290100323     c                             and fgiatb=' '  and klna = fgipog
267300100323     c                   eval      wfgi='S'
267310100323     c                   leave
267320100323     c                   endif
267330100323     c
267340100323     c     kfgi          reade     azfgi01l
267350100323     c                   enddo
267360100323
267370100323     c                   ENDSR
267380070604     C**************************************************************************
267390070604     C*   Aggiornamento dati per PDA
267400070604     C**************************************************************************
267410070604     C     Sr_pda        BEGSR
267420070604     c* verifico se già estratti orm per pda
267430080111     C****               CLEAR                   dsbs02
267440080111     c****               clear                   dpdo
267450080111     C****               MOVEL     'C'           T02MOD
267460080111     C****               MOVEL     KNSIF         T02SIF
267470080111     C****               MOVEL     'PDO'         T02COD
267480080111     c****               movel(P)  g_ormpor      t02ke1
267490080111     C****               CALL      'TIBS02R'
267500080111     C****               PARM                    KPJBA
267510080111     C****               PARM                    dsbs02
267520080111    2C****               IF        T02ERR = *BLANKS
267530080111     C****               MOVEL     T02uni        dpdo
267540080111    2C****               ENDIF
267550080111     c****               clear                   aggpda            1
267560080111    1c****               if        d§pdodata>0
267570080111    2c****               if        ormddc<> d§pdodata
267580070604     c     kfnorf        chain     fnorf01l
267590070604    3c                   if        %found(fnorf01l)
267600080221     c**!!!kfipdo        chain     fipdo01t
267610080111    4c****               if        not %found(fipdo01t)
267620080221    4c**!!!              if        %found(fipdo01t)
267630080111     c****               eval      aggpda='N'
267640080111    4c****               endif
267650080111    3c****               endif
267660080111    2c****               endif
267670080111    2c****               if        aggpda=' '
267680070604     c                   clear                   fior56ds
267690070604     c                   eval      or56tla = 'O'
267700070604     c                   eval      or56poe = ormpoe
267710070604     c                   eval      or56nsr = ormnsr
267720070604     c                   eval      or56nor = ormnor
267730070604     c                   eval      or56nrv = ormnrv
267740080111     c                   eval      or56fgs = orffgs
267750080111     c                   eval      or56ndcd = orfndc
267760080111     c                   eval      or56ndca = orfndc
267770080111     c                   eval      or56ddc = orfddc
267780070604     c                   call      'FIOR56R'
267790070604     c                   parm                    kpjbu
267800070604     c                   parm                    fior56ds
267810070604     c* se effettuato scarico memorizzo di avvisare dell'avvenuto sca-
267820070604     c* rico a PDA
267830070604    3c                   if        or56err=*blanks
267840070604     c                   eval      wmsg_pda='S'
267850070606     c                   exsr      sr_dst
267860070606     c                   move      dstpdr        w02pdr_p
267870070604    3c                   endif
267880080221    2c**!!!              endif
267890070604    1c                   endif
267900070604     c                   endsr
267910071023     C**************************************************************************
267920071023     C*   Impostazione campo partita iva mittente
267930071023     C**************************************************************************
267940071023     C     Sr_wpiva      BEGSR
267950071023     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
267960071023     c                   select
267970071023     c* solo numeri
267980071023     c* "PRIVATO senza iso
267990071023     c     *in30         wheneq    *off
268000071023     c     wiso          andge     *zeros
268010071023     c     *in30         oreq      *on
268020071023     c     posiz         andlt     3
268030071023     c                   movel     wpiva         vidcpm
268040071023     c* iso + numeri
268050071023     c* iso + "PRIVATO"
268060071023     c     *in30         wheneq    *off
268070071023     c     posiz         orgt      2
268080071023     c                   movel     wpiva         vidpim
268090071023     c                   endsl
268100071023     c                   endsr
268110071218     C**************************************************************************
268120071218     C*   Reperimento dati tabella cli
268130071218     C**************************************************************************
268140071218     C     Sr_dcli       BEGSR
268150071218     C                   CLEAR                   dsbs02
268160071218     c                   clear                   dcli
268170071218     C                   MOVEL     'C'           T02MOD
268180071218     C                   MOVEL     KNSIF         T02SIF
268190071218     C                   MOVEL     'CLI'         T02COD
268200071221     c                   movel(P)  wksc          t02ke1
268210071218     C                   CALL      'TIBS02R'
268220071218     C                   PARM                    KPJBA
268230071218     C                   PARM                    dsbs02
268240071218    2C                   IF        T02ERR = *BLANKS
268250071218     C                   MOVEL     T02uni        dcli
268260071218    2C                   ENDIF
268270071218     c                   endsr
268280071220     C**************************************************************************
268290071220     C*   Controlli per abilitazione modifica lna di sped. disk B
268300071220     C**************************************************************************
268310071220     C     Sr_chkabilna  BEGSR
268320120817     c***  kblt1         setll     fnblt01l
268330120817     c***  kblt1         reade(N)  fnblt01l
268340120817     c***                dow       not %eof(fnblt01l)
268350120817     c     kblt1         setll     fiart01l
268360120817     c     kblt1         reade(N)  fiart01l
268370120817     c                   dow       not %eof(fiart01l)
268380120817     c     kanm2         setll     fnbrv07l
268390071220     c* - presenti spunte dei segnacolli con la vecchia lna
268400071220     c                   if        %equal(fnbrv07l)
268410071220     c                   seton                                        4790
268420071221     c                   movel     err(315)      vidmsg
268430071220     c                   goto      f_chkabilna
268440071220     c                   endif
268450071220     c* - non presenti spunte dei segnacolli con la nuova lna
268460071221     c     kbrv7         setll     fnbrv07l
268470071220     c                   if        not %equal(fnbrv07l)
268480071220     c                   seton                                        4790
268490071221     c                   movel     err(316)      vidmsg
268500071220     c                   goto      f_chkabilna
268510071220     c                   endif
268520071220     c* - segnacolli doppi sulla nuova lna
268530120829     c* - Non controlla presenza su fiars perchè in questa situazione ars non c'
268540120829     c*   è
268550120817     c**   kbrv7         setll     fnblt27l
268560120817     c**                 if        %equal(fnblt27l)
268570120817     c**   kbrv7         chain     fnblt27l
268580120817     c     kbrv7         setll     fiart27l
268590120817     c                   if        %equal(fiart27l)
268600120817     c     kbrv7         chain     fiart27l
268610071221     c                   seton                                        4790
268620071221     c                   clear                   vidmsg
268630080103     c                   eval      vidmsg='SEGNACOLLO'
268640071221     c                   eval      vidmsg=%trim(vidmsg) + ' ' +
268650120817     c                             %char(artnsc)
268660071221     c                   eval      vidmsg=%trim(vidmsg)+
268670080103     c                             ' DOPPIO: presente su spedizione '
268680120817     c                             + %char(artlnp)
268690120817     c                   eval      vidmsg=%trim(vidmsg)+ ' ' + %char(artnrs)
268700080103     c                             + '-'
268710080103     c                   eval      vidmsg=%trim(vidmsg) +
268720120817     c                             %char(artnsp) +' ' + %char(artaas)
268730071221     c                   goto      f_chkabilna
268740071221     c                   endif
268750120817     c***  kblt1         reade(N)  fnblt01l
268760120817     c     kblt1         reade(N)  fiart01l
268770071220     c                   enddo
268780071220     c* - nuova lna è estera
268790100210     c                   if        a_§ogntw<>'COR' and a_§ogntw<>'MES'
268800100210     c                   seton                                        4790
268810100210     c                   movel     err(317)      vidmsg
268820100210     c                   goto      f_chkabilna
268830100210     c                   endif
268840071220     c     f_chkabilna   endsr
268850080313     C**************************************************************************
268860080313     C*   Verifica se cliente con serie parziale
268870080313     C**************************************************************************
268880100517     C**   Sr_parz       BEGSR
268890100517     c**                 clear                   wparz
268900100517     c**                 clear                   wparz_d
268910100517     c**                 clear                   wparz_a
268920100517    1c**                 if        vidnrs>0
268930100517     c**                 eval      k_tbecod = '3CP'
268940100517     c**                 movel(p)  wksc          k_tbeke1
268950100517     c**   ktbe1         setll     tntbe01l
268960100517    2c**                 do        *hival
268970100517     c**   ktbe1         reade(N)  tntbe01l
268980100517    3c**                 if        %eof(tntbe01l)
268990100517     c**                 leave
269000100517    3c**                 endif
269010100517    3c**                 if        tbeatb='A'
269020100517     c**                 iter
269030100517    3c**                 endif
269040100517     c**                 movel     tbeuni        d3cp
269050100517     c**                 clear                   w007a             7
269060100517     c**                 eval      w007a  = %subst(tbeke2: 3: 7)
269070100517     c**                 move      w007a         wparz_d
269080100517     c**                 z-add     §3cpal        wparz_a
269090100517     c**                 eval      wparz = 'S'
269100100517    2c**                 enddo
269110100517    1c**                 endif
269120100517     c**                 endsr
269130090327     C**************************************************************************
269140090327     C*    PULIZIA CAMPI window cliente/tariffa tassazione porti assegnati
269150090327     C**************************************************************************
269160090327     C     sr_inzwdwcli  BEGSR
269170090327     c                   clear                   wcliksc
269180090327     c                   clear                   wclidks
269190090327     c                   clear                   wclictr
269200090327     c                   clear                   atrwksc
269210090327     c                   clear                   atrwctr
269220090327     c                   endsr
269230090323     C**************************************************************************
269240090323     C*   Gestione window per immissione/modifica cli/tariffa per tassaz. p.a.
269250090323     C**************************************************************************
269260090323     C     geswdw_clitar BEGSR
269270090323     c                   exsr      riewdwcli
269280090325     c                   clear                   hcliriga
269290090325     c                   clear                   hclicolo
269300090327     c                   eval      s_wcliksc=wcliksc
269310090326     c                   eval      s_wclictr=wclictr
269320090324     c                   eval      $fine='0'
269330090323     c*
269340090323     c                   dow       $fine='0'
269350090323     c                   exfmt     ls01wcli
269360090325     c                   eval      *in90='0'
269370090325     c                   clear                   hcliriga
269380090325     c                   clear                   hclicolo
269390090323     c                   select
269400090323     c* f12=Ritorno
269410090323     c                   when      *inkl='1'
269420090323     c                   eval      $fine='1'
269430090327     c                   eval      wcliksc=s_wcliksc
269440090326     c                   eval      wclictr=s_wclictr
269450090323     c                   other
269460090323     c* f6=conferma o enter
269470090323     c                   exsr      ctrwdwcli
269480090323     c                   if        *inkf and not *in90
269490090326     c                   eval      $fine='1'
269500090323     c                   endif
269510090323     c                   endsl
269520090323     c                   enddo
269530090323     c*
269540090323     c                   endsr
269550090324     C**************************************************************************
269560090324     C* Riempimento campi window cliente/tariffa per tassazione porti assegnati
269570090324     C**************************************************************************
269580090325     C     riewdwcli     BEGSR
269590090324
269600090324     c                   select
269610090324     c* DA ORM
269620090324     c                   when      partch<>'P' and flgfit<>'S'
269630090325     c                   exsr      sr_clearing
269640090324      * Se ORM richiede la bolla in porto assegnato e bolla in porto assegnato
269650090324      * memorizzo il codice cliente che servirà in arrivo in tassazione
269660090324      * porti assegnati. Memorizzo il codice cliente anche nel caso
269670090324      * di bolla in p.a. che fa parte del clearing dpd
269680090324if  2c                   If         ((§OrPfb = 'A' or wforpf = '1') and *In04
269690090324     c                              and Ormksc > *Zeros) or *in04 and wclg='S'
269700090324    3c                   if        wclg=' '
269710090327     c                   Z-add     OrmKsc        wcliksc
269720090325     c                   eval      atrwksc=prot
269730090327     c                   if        ormctr<>*blanks
269740090324     c                   Move      OrmCtr        wclictr
269750090325     c                   eval      atrwctr=prot
269760090324     c                   endif
269770090324   x3c                   else
269780090324     c* se spedizione che va nel clearing il codice cliente è da
269790090324     c* reperire su EDTAB tab 'PU'
269800090324     c                   eval      kedcod='PU'
269810090324     c                   clear                   kedkey
269820090324     c                   move      wopoe         com003a           3
269830090324     c                   eval      kedkey='DPD'+com003a
269840090324     c     kedtab        chain     edtab01l
269850090324    4c                   if        %found(edtab01l)
269860090324     c                   movel     tabuni        edidspu
269870090324     c                   if        §puormaksc>*zeros
269880090327     c                   move      §PUORMAKSC    wcliksc
269890090325     c                   eval      atrwksc=prot
269900090324     c                   endif
269910090327     c                   if        §puormactr<>*blanks
269920090324     c                   move      §PUORMACTR    wclictr
269930090325     c                   eval      atrwctr=prot
269940090324     c                   endif
269950090324    4c                   endif
269960090324    3c                   endif
269970090324e   2c                   EndIf
269980090324     c* DA PGM CHIAMANTE
269990090327     c                   when      *in12 and *in15 and *in04 and vidcbo<>'FW'
270000090325    1c                   if        §lpksca>*zeros
270010090325     c                   eval      w_§lpksca=§lpksca
270020090325     c                   eval      w_§lpctra=§lpctra
270030090325   x1c                   else
270040090325    2c                   if        savfpr='T' or savfpr='P'
270050090325     c                   z-add     §lpccm        w0040
270060090325     c                   if        w0040<> 9999
270070090325     c                   move      §lpccm        w_§lpksca
270080090325     c                   if        §lpctr<>999
270090090325     c                   move      §lpctr        w_§lpctra
270100090325     c                   endif
270110090325     c                   endif
270120090325    2c                   endif
270130090325    1c                   endif
270140090325    1c                   if        w_§lpksca>*zeros
270150090327     c                   movel     w_§lpksca     wcliksc
270160090324     c                   eval      atrwksc=prot
270170090327    2c                   if        w_§lpctra<>*blanks
270180090325     c                   move      w_§lpctra     wclictr
270190090324     c                   eval      atrwctr=prot
270200090325    2c                   endif
270210090325    1c                   endif
270220090324     c* DA CONFERMA BOLLE PER BOLLE "FW"
270230090324     c                   when      *in12 and *in15 and vidcbo='FW'
270240090324     c                             and (%Subst(§lpNot:1:18) = wnotfw
270250090324     c                             or   %Subst(§lpNt2:1:18) = wnotfw)
270260090324     c                   Clear                   w007a
270270090324     c                   If        %Subst(§lpNot:1:18) = wnotfw
270280090324     c                   Eval      w007a = %Subst(§lpNot:20:7)
270290090324     c                   Else
270300090324     c                   Eval      w007a = %Subst(§lpNt2:20:7)
270310090324     c                   EndIf
270320090324      * verifico che siano tutti numeri
270330090324     c                   if        %check(digits:w007a)=0
270340090327     c                   Move      w007a         wcliksc
270350090324     c                   eval      atrwksc=prot
270360090324     c                   EndIf
270370090325     c                   endsl
270380090326     c*
270390090327     c                   if        wcliksc>0
270400090326     C                   clear                   TIBS69DS
270410090327     C                   z-add     wcliksc       I69kac
270420090326     C                   call      'TIBS69R'
270430090326     C                   parm                    tibs69DS
270440090326     C                   parm                    ds_cnaco
270450090326     C                   parm                    ds_cnind
270460090326     C                   parm                    ds_cnclp
270470090326     C                   parm                    ds_fncls
270480090515     c                   eval      wclidks=BS_acorag
270490090326     c                   endif
270500090324     c
270510090324     c                   endsr
270520090325     C**************************************************************************
270530090325     C* Controllo window cliente/tariffa per tassazione porti assegnati
270540090325     C**************************************************************************
270550090325     C     ctrwdwcli     BEGSR
270560090327     c                   if        wcliksc=0
270570090326     c                   clear                   wclidks
270580090326     c                   endif
270590090325     c* codice cliente
270600090326     c                   if        atrwksc=*blanks
270610090327     c                   if        wcliksc>0
270620090326     c                   clear                   wclidks
270630090325     C                   clear                   TIBS69DS
270640090327     C                   z-add     wcliksc       I69kac
270650090327     C                   z-add     wcliksc       I69kin
270660090325     C                   call      'TIBS69R'
270670090325     C                   parm                    tibs69DS
270680090325     C                   parm                    ds_cnaco
270690090325     C                   parm                    ds_cnind
270700090325     C                   parm                    ds_cnclp
270710090325     C                   parm                    ds_fncls
270720090515     c                   eval      wclidks=BS_acorag
270730090325     C* ERRORE
270740090325     c     O69Err        Ifeq      '1'
270750090515     c     BS_acoflg     Orne      *Blanks
270760090325     C     wcliksc       OREQ      8888
270770090325     c                   eval      *in90=*on
270780090325     C                   MOVEL     err(319)      wclimsg
270790090325     c                   z-add     04            Hcliriga
270800090325     c                   z-add     18            Hclicolo
270810090325     c                   goto      endwcli
270820090325    2C                   ENDIF
270830130312    2C***  BS_Acoabl     IFEQ      '8'
270840130312    2C***  BS_acoabl     OREQ      '*'
270850130312    2C     BS_Acoabl     IFne      *blanks
270860090325     c                   eval      *in90=*on
270870090325     C                   MOVEL     err(320)      wclimsg
270880090325     c                   z-add     04            Hcliriga
270890090325     c                   z-add     18            Hclicolo
270900090325     c                   goto      endwcli
270910090325    2C                   END
270920090325     c                   endif
270930090325     c                   endif
270940090325     c* codice tariffa
270950090326     c                   if        atrwctr=*blanks and wclictr<>*blanks
270960090325     c* errore se manca il codice cliente
270970090327     c                   if        wcliksc=*zeros
270980090325     c                   eval      *in90=*on
270990090325     C                   MOVEL     err(319)      wclimsg
271000090325     c                   z-add     04            Hcliriga
271010090325     c                   z-add     18            Hclicolo
271020090325     c                   goto      endwcli
271030090325     c                   endif
271040090325     c*
271050090325     c                   eval      s_fnlv59ds=fnlv59ds
271060090325     C                   CLEAR                   fnlv59ds
271070090325     C                   MOVEL     'A'           ilv59tbo
271080090325      * Se bolla monovaria carico tutte le tariffe ma propongo la partenza
271090090325     C                   IF        §3ASVA <> *BLANK
271100090325     C                   movel     ' '           ilv59tbo
271110090325     C                   movel     'P'           ilv59prp
271120090325     C                   ENDIF
271130090325      *
271140090327     C                   MOVEL     wcliksc       ilv59KSC
271150090325     C                   MOVEL     KCI           ilv59KCI
271160090325     C                   MOVEL     WFIE          ilv59FIE
271170090325     C                   MOVEL     blpdsp        ilv59DSP
271180090325     C                   MOVEL     vidtsp        ilv59TSP
271190090325     C                   MOVEL     'S'           ilv59RIC
271200090325     c                   move      wclictr       ilv59ctr
271210090325     C*
271220090325     C                   CALL      'FNLV59R'
271230090325     C                   PARM                    fnlv59ds
271240090325     C* ERRORE
271250090325     C     olv59msg      IFNE      *BLANKS
271260090325     C                   MOVEL     olv59msg      wclimsg
271270090325     C                   eval      *in90='1'
271280090325     c                   z-add     05            Hcliriga
271290090325     c                   z-add     18            Hclicolo
271300090325     c                   eval      fnlv59ds=s_fnlv59ds
271310090325     C                   GOTO      endwcli
271320090325     C                   ENDIF
271330090325     c*
271340090325     c                   eval      fnlv59ds=s_fnlv59ds
271350090325     c                   endif
271360090325     c     endwcli       endsr
271370090324     C**************************************************************************
271380090324     C* Verifica se spedizione che va nel clearing
271390090324     C**************************************************************************
271400090324     C     sr_clearing   BEGSR
271410090324     c                   clear                   wclg
271420090324    1c                   if        *in12 and *in15='0' and
271430090324     c                             s_§b4poe=wopoe and
271440090324     c                             s_§b4nsr=wonsr and
271450090324     c                             s_§b4nor=wonor2 and
271460090324     c                             s_§b4nrv=wonrv
271470090324     c                   eval      wclg=§b4clg
271480090324   x1c                   else
271490090324     c* se spedizione commissionata da dpd con orm automatico
271500090324     c* verifico se
271510090324     c* sono presenti altre bolle aventi lo stesso orm per l'impostazione
271520090324     c* del flag §b4clg
271530090324     C
271540090324    2c                   if        ormrfa<>*blanks and %subst(ormrfa:1:
271550090324     c                             3)='DPD'
271560090324     c                   eval      kdpodep=%subst(ormrfa:4:4)
271570090324     c                   eval      w006a=%subst(ormrfa:8:6)
271580090324     c                   move      w006a         kdpoord
271590090324     c     kdpo          setll     fidpo03l
271600090324    3c                   if        %equal(fidpo03l)
271610090324     c                   eval      wclg='S'
271620090324     c                   movel     'M'           kar4trc
271630090324     c                   movel     widorm        kar4n14
271640090324     c     kar403        setll     fiar404l
271650090324    4c                   do        *hival
271660090324     c     kar403        reade     fiar404l
271670090324     c* fine file
271680090324    5c                   if        %eof(fiar404l)
271690090324     c                   leave
271700090324    5c                   endif
271710090324     c*
271720090324     c                   eval      wclg=' '
271730090324    4c                   enddo
271740090324    3c                   endif
271750090324    2c                   endif
271760090324    1c                   endif
271770090324     c                   endsr
271780090326     C**************************************************************************
271790090326     C* Carico cliente/tariffa per tassazione p.a. da fiar4 trk 'A'
271800090326     C**************************************************************************
271810090326     C     sr_daar4a     BEGSR
271820090326     C                   MOVEL     'A'           WTRC
271830090326     c     kblp4         chain(N)  fiar401l
271840090326     c                   if        %found(fiar401l)
271850090326     c                   movel     ar4not        dsbl4a
271860090326     C                   MOVEL     '3M'          COD
271870090326     C                   MOVEL(P)  Vidsop        KEY
271880090326     C                   EXSR      CTABEL
271890090327     c                   if        §b4aks>0
271900090327     c                   z-add     §b4aks        wcliksc
271910090327     c                   if        s_ormksc>0  or not *in30
271920090326     c                   eval      atrwksc=prot
271930090326     c                   endif
271940090327     c                   if        §b4act<>*blanks
271950090326     c                   move      §b4act        wclictr
271960090327     c                   if        (s_ormksc>0 and s_ormctr<>*blanks)
271970090327     c                             or (not *in30 and s_ormksc=0)
271980090326     c                   eval      atrwctr=prot
271990090326     c                   endif
272000090327     c                   else
272010090327     c* se cod.tariffa non presente ma bolla non da orm proteggo comunque se
272020090327     c* ksc impostato altrimenti poi se fosse sprotetto non avrebbero più
272030090327     c* la possibiltà di correggerlo in caso di errore
272040090327     c                   if        not *in30 and wcliksc>0 and s_ormksc=0
272050090327     c                   eval      atrwctr=prot
272060090327     c                   endif
272070090326     c                   endif
272080090326     c                   endif
272090090326     c                   endif
272100090326     c                   endsr
272110110512     C**************************************************************************
272120110512     C*   Gestione window per manutenzione indirizzo email destinatario
272130110512     C**************************************************************************
272140110613     C     sr_geswdwemd  BEGSR
272150110512     c                   clear                   hemdriga
272160110512     c                   clear                   hemdcolo
272170110512     c                   eval      $fine='0'
272180110516     c                   eval      s_wemdest=wemdest
272190110512     c*
272200110512     c                   dow       $fine='0'
272210110512     c                   exfmt     ls01wemd
272220110512     c                   eval      *in90='0'
272230110512     c                   clear                   hemdriga
272240110512     c                   clear                   hemdcolo
272250110512     c                   clear                   wemdmsg
272260110512     c                   select
272270110512     c* f12=Ritorno
272280110512     c                   when      *inkl='1'
272290110512     c                   eval      $fine='1'
272300110516     c                   eval      wemdest=s_wemdest
272310110512     c                   other
272320110512     c* f6=conferma o enter
272330110512     c                   if        wemdest<>*blanks
272340110613     c                   if        wdesie='E'
272350110613     c                   Eval      *In90 = *On
272360110613     c                   Eval      wemdmsg = err(342)
272370110613     c                   Eval      wemdmsg=%trimr(wemdmsg) +
272380110613     c                             ':eliminare Indir.'
272390110613     c                   eval      hemdriga=3
272400110613     c                   eval      hemdcolo=1
272410110613     c                   else
272420110512     c                   exsr      Sr_Chkemd
272430110512      * Errore
272440110512if  3c                   If        §emlerro <> '0'
272450110512     c                   Eval      *In90 = *On
272460110512     c                   Eval      wemdmsg = err(340)
272470110512     c                   eval      hemdriga=3
272480110512     c                   eval      hemdcolo=1
272490110512   x3c                   else
272500110512     c                   Eval      wemdest = §emlindo
272510110512    3c                   EndIf
272520110613     c                   EndIf
272530110512     c                   endif
272540110512     c                   if        *inkf and not *in90
272550110512     c                   eval      $fine='1'
272560110512     c                   endif
272570110512     c                   endsl
272580110512     c                   enddo
272590110512     c*
272600110512     c                   endsr
272610110705     C**************************************************************************
272620110705     C*   Gestione window per codici CUP e CIG
272630110705     C**************************************************************************
272640110705     C     sr_geswdwcup  BEGSR
272650110705     c                   eval      $fine='0'
272660110705     c                   eval      s_wcupcup=wcupcup
272670110705     c                   eval      s_wcupcig=wcupcig
272680110705     c*
272690110705     c                   dow       $fine='0'
272700110705     c                   exfmt     ls01wcup
272710110705     c                   eval      *in90='0'
272720110705     c                   select
272730110705     c* f12=Ritorno
272740110705     c                   when      *inkl='1'
272750110705     c                   eval      $fine='1'
272760110705     c                   eval      wcupcup=s_wcupcup
272770110705     c                   eval      wcupcig=s_wcupcig
272780110705     c                   other
272790110705     c* f6=conferma
272800110705     c                   if        *inkf
272810110705     c                   eval      $fine='1'
272820110705     c                   endif
272830110705     c                   endsl
272840110705     c                   enddo
272850110705     c*
272860110705     c                   endsr
272870090608     C**************************************************************************
272880090608     C* Carico limiti (peso/colli/volume) per tipo servizio
272890090608     C**************************************************************************
272900090608     C     sr_limtsp     BEGSR
272910090609     c                   clear                   wmsgtsp
272920090608     c                   clear                   trul73ds
272930090608     c                   if        vidtsp<>*blanks
272940090608     c                   eval      i73tsp=vidtsp
272950090608     c                   else
272960090608     c                   eval      i73tsp=comtsp
272970090608     c                   endif
272980111026     c* campi per la forzatura del messaggio di errore --> pulizia a cambio di
272990111026     c* tipo servizio
273000111026     c                   if        i73tsp<>savtsp73
273010111026     c                   clear                   wncl_pre
273020111026     c                   clear                   wpes_pre
273030111026     c                   clear                   wvol_pre
273040111026     c                   eval      savtsp73=i73tsp
273050111026     c                   endif
273060090619     c* Esco dalla routine senza effettuare il controllo se non ho il tipo
273070090619     c* servizio e provengo da controlli della prima videata:
273080090619     c* è successo che abbiano fatto un dirottamento ma il codice tariffa
273090090619     c* della bolla mamma utilizzato non è uno dei codici presenti per il
273100090619     c* cliente della bolla di dirottamento e quindi il tipo serivizio in
273110090619     c* questi casi è vuoto. In seconda videata poi saranno costretti a
273120090619     c* modificare il codice tariffa e di conseguenza i controlli limiti per
273130090619     c* tipo servizio verranno eseguiti correttamente
273140090619     c                   if        wvid='1' and i73tsp=*blanks
273150090619     c                   leavesr
273160090619     c                   endif
273170090609     c                   z-add     1             c
273180090609     c     i73tsp        lookup    tsp(c)                                 30
273190090609     c                   eval      i73psk=wpes
273200090608     c                   eval      i73vmc=wvol
273210090608     c                   eval      i73ncl=wncl
273220090608     c                   call      'TRUL73R'
273230090608     c                   parm                    trul73ds
273240090608     c                   select
273250090608     c                   when      o73err='E'
273260090608     c                   seton                                        90
273270090609     c                   eval      wmsgtsp=err(324)
273280090609     c                   eval      %subst(wmsgtsp: 40: 8)=dts08(c)
273290090609     c* colli bloccante
273300090608     c                   when      o73fclm='1'
273310090608     c                   seton                                        90
273320090609     c                   if        wvid='1'
273330090609     c                   seton                                        62
273340090609     c                   else
273350090609     c                   seton                                        41
273360090609     c                   endif
273370090609     c                   eval      wmsgtsp=err(325)
273380090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273390090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclm:'4')
273400090609     c* peso kg bloccante
273410090608     c                   when      O73FKGM='1'
273420090608     c                   seton                                        90
273430090609     c                   if        wvid='1'
273440090609     c                   seton                                        63
273450090609     c                   else
273460090609     c                   seton                                        42
273470090609     c                   endif
273480090609     c                   eval      wmsgtsp=err(326)
273490090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273500090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgm:'4')
273510090609     c*volume mc bloccante
273520090608     c                   when      O73FMCM='1'
273530090609     c                   seton                                        9047
273540090609     c                   eval      wmsgtsp=err(327)
273550090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273560090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcm:'4')
273570090609     c* colli forzabile
273580090608     c                   when      O73FCLF='1' and wncl<>wncl_pre
273590090608     c                   seton                                        90
273600090609     c                   if        wvid='1'
273610090609     c                   seton                                        62
273620090609     c                   else
273630090609     c                   seton                                        41
273640090609     c                   endif
273650090609     c                   eval      wmsgtsp=err(325)
273660090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273670090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclf:'4')
273680090610     c                   eval      wmsgtsp=%trim(wmsgtsp)+ '. ENTER per forzare'
273690090609     c                   eval      wncl_pre=wncl
273700090609     c* peso kg forzabile
273710090609     c                   when      O73Fkgf='1' and wpes<>wpes_pre
273720090608     c                   seton                                        90
273730090609     c                   if        wvid='1'
273740090609     c                   seton                                        63
273750090609     c                   else
273760090609     c                   seton                                        42
273770090609     c                   endif
273780090609     c                   eval      wmsgtsp=err(326)
273790090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273800090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgf:'4')
273810090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
273820090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
273830090609     c                   eval      wpes_pre=wpes
273840090609     c* volume mc forzabile
273850090608     c                   when      O73FmcF='1' and wvol<>wvol_pre
273860090609     c                   seton                                        9047
273870090609     c                   eval      wmsgtsp=err(327)
273880090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
273890090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcf:'4')
273900090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
273910090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
273920090609     c                   eval      wvol_pre=wvol
273930090608     c                   endsl
273940090608     c                   endsr
273950091111     C**************************************************************************
273960091111     C*   Gestione window per scelta beneficiario contrassegno
273970091111     C**************************************************************************
273980091111     C     geswdw_cas    BEGSR
273990091111     c                   exsr      riewdwcas
274000091111     c                   clear                   hcasriga
274010091111     c                   clear                   hcascolo
274020091111     c                   eval      $fine='0'
274030091111     c*
274040091111     c                   dow       $fine='0'
274050091111     c                   exfmt     ls01wcas
274060091111     c                   eval      *in90='0'
274070091111     c                   clear                   hcasriga
274080091111     c                   clear                   hcascolo
274090091111     c                   select
274100091111     c* f12=Ritorno
274110091111     c                   when      *inkl='1'
274120091111     c                   eval      $fine='1'
274130091111     c                   other
274140091111     c* f6=conferma o enter
274150091111     c                   exsr      ctrwdwcas
274160091111     c                   if        *inkf and not *in90
274170091111     c                   eval      $fine='1'
274180091111     c                   endif
274190091111     c                   endsl
274200091111     c                   enddo
274210091111     c*
274220091111     c                   endsr
274230091111     C**************************************************************************
274240091111     C* Riempimento campi window scelta beneficiario contrassegno
274250091111     C**************************************************************************
274260091111     C     riewdwcas     BEGSR
274270091111     c* mittente spedizione
274280091111     c                   eval      wcasmit=vidrsm
274290091111     c* ordinante O.R.M.
274300091117     c                   eval      wcascor=ormksc
274310091112     c* ..ragione sociale da cnaco
274320091112     C                   clear                   TIBS69DS
274330091112     C                   z-add     ormksc        I69kac
274340091112     C                   call      'TIBS69R'
274350091112     C                   parm                    tibs69DS
274360091112     C                   parm                    ds_cnaco
274370091112     C                   parm                    ds_cnind
274380091112     C                   parm                    ds_cnclp
274390091112     C                   parm                    ds_fncls
274400091112     c                   eval      wcasord=BS_acorag
274410091112     c*
274420091111     c* destinatario spedizione
274430091111     c                   eval      wcasdest=v2crsd
274440091111     c                   endsr
274450091111     C**************************************************************************
274460091111     C* Controllo window scelta beneficiario contrassegno
274470091111     C**************************************************************************
274480091111     C     ctrwdwcas     BEGSR
274490091111     c                   select
274500091111     c* Effettuare alemno una selazione
274510091111     c                   when      wcassel1=*blanks and wcassel2=*blanks
274520091111     c                   z-add     15            Hcasriga
274530091111     c                   z-add     36            Hcascolo
274540091112     C                   MOVEL     err(329)      wcasmsg
274550091112     c                   seton                                        90
274560091111     c* Selezionare o mittente o ordinante
274570091111     c                   when      wcassel1='X' and wcassel2='X'
274580091111     c                   z-add     15            Hcasriga
274590091111     c                   z-add     36            Hcascolo
274600091112     C                   MOVEL     err(330)      wcasmsg
274610091112     c                   seton                                        90
274620091211     c* ricontrollo il tipo incasso in base alla scelta effettuata
274630091211     c                   other
274640091211     c                   exsr      sr_trultic
274650091211     c                   if        oticerr='T' or  oticerr='C'
274660091211     C                   MOVEL     err(331)      wcasmsg
274670091214     c* eccendo anche indicatore per posizionamento su tic in seconda videata
274680091214     c                   seton                                        9049
274690091211     c                   endif
274700091111     c                   endsl
274710091111     c                   endsr
274720091119     C**************************************************************************
274730091119     C* Inizializzazione campi window scelta beneficiario D/A
274740091127     C**************************************************************************
274750091119     C     inzwdwcas     BEGSR
274760091119     c                   clear                   wcasmit
274770091119     c                   clear                   wcascor
274780091119     c                   clear                   wcasord
274790091119     c                   clear                   wcasdest
274800091119     c                   clear                   wcassel1
274810091119     c                   clear                   wcassel2
274820091211     c                   eval      nochkticC=*off
274830091119     c                   endsr
274840110516     C**************************************************************************
274850110516     C* Window per richiesta conferma annullamento
274860110516     C**************************************************************************
274870110516     C     sr_geswdwconf BEGSR
274880110516     c                   clear                   wvann
274890110516     c                   eval      $fine='0'
274900110516     c*
274910110516     c                   dow       $fine='0'
274920110516     c                   exfmt     ls01wann
274930110516     c                   if        *inkf
274940110516     c                   eval      $fine='1'
274950110516     c                   endif
274960110516     c                   enddo
274970110516     c                   endsr
274980110519     C**************************************************************************
274990110519     C* Controllo presenza bolle da confermare
275000110519     C**************************************************************************
275010110519     C     sr_chkvab     BEGSR
275020110519    4c                   if        s_wksc<>wksc
275030110519     c                   eval      wfvab=*off
275040110519    4c                   endif
275050110519     c     wksc          setll     fivab01l
275060110519     c     wksc          setll     edivab1l
275070110519    4c                   if        (%equal(fivab01l) or %equal(edivab1l) )
275080110519     c                             and (s_wksc<>wksc or wfvab=*off)
275090110519     c                   movel     '1'           wemfor
275100110519     c                   eval      wms1=err(341)
275110110519     c                   eval      wfvab=*on
275120110519    5c*                  select
275130110519     c*                  when      %equal(fivab01l) and
275140110519     c*                            %equal(edivab1l)
275150110519     c*                  eval      wms1=err(341)
275160110519     c*                  eval      wfvab=*on
275170110519     c*                  when      %equal(fivab01l)
275180110519     c*                  eval      wms1=err(341)
275190110519     c*                  eval      wfvab=*on
275200110519     c*                  when      %equal(edivab1l)
275210110519     c*                  eval      wfvab=*on
275220110519     c*                  eval      wms1=err(341)
275230110519    5c*                  endsl
275240110519     c                   eval      $fine='0'
275250110519     c                   dow       $fine='0'
275260110519     c                   exfmt     ls01wvab
275270110519     c* f12=Ritorno
275280110519     c                   if        *inkl='1'
275290110519     c                   eval      $fine='1'
275300110519     c                   endif
275310110519     c                   enddo
275320110519     c*
275330110519    4c                   endif
275340110519     c                   eval      s_wksc=wksc
275350110519     c                   endsr
275360110902     C**************************************************************************
275370110902     C* Invio email a CED per errore valore accorpamento spedizioni in consegna
275380110902     C**************************************************************************
275390110902     C     sr_mail       BEGSR
275400110902     C* Inizializzo variabili
275410110902     C                   movel     *blanks       wrkEmlTo        253
275420110902     C                   movel     *blanks       wrkEmlCc        253
275430110902     C                   movel     *blanks       wrkMsg         5000
275440110902     C                   movel     *blanks       wrkOgg           44
275450110902     C                   movel     *blanks       wrkesito          1
275460120302     C* Valorizzo i campi della @-mail
275470120302     C                   eval      wrkEmlTo='ced@brt.it'
275480110902     c                   eval      wrkEmlCc = *blank
275490110902     C                   eval      wrkOgg='PERFECT ORDER WURTH'
275500110902     C                   eval      wrkMsg='Valore di accorpamento "'   +
275510110902     c                             §lpxco                              +
275520110902     C                             '" non presente in tabella "XCO"'   +':/N'+
275530110902     C                             ' '                                 +':/N'+
275540110902     C                             'SPEDIZIONE: ' +%editc(blplnp:'X')  +
275550110902     c                             ' ' +%editc(blpnrs:'Z') + ' '       +
275560110902     c                             %editc(blpnsp:'Z') +' '             +
275570110902     c                             %editc(blpaas:'X')                  +':/N'+
275580110902     C                             'RMN: '+%editc(blprmn:'Z')          +':/N'+
275590110902     C                             'RMA: '+blprma                      +':/N'+
275600110902     c                             ' '                                 +':/N'+
275610110902     c                             ' '
275620110902     C*
275630110902     C                   call(e)   'TIS701C1'
275640110902     C                   parm                    wrkEmlto
275650110902     C                   parm                    wrkEmlCc
275660110902     C                   parm                    wrkOgg
275670110902     C                   parm                    wrkMsg
275680110902     C                   parm                    wrkesito
275690110902     c                   endsr
275700111026     C**************************************************************************
275710111026     C* Memorizzazione dati vecchi colli per scrittura R.A.
275720111026     C**************************************************************************
275730111026     C     sr_memRA      BEGSR
275740111026     c* devo memorizzare il numero dei colli e il range dal/al prima della
275750111026     c* riassegnazione per poi poterli memorizzare nel file delle R.A.
275760111026     c* Devo memorizzare anche se si tratta di variazione di lna o di
275770111026     c* aumento colli
275780111026     c                   eval      RA_ncd=vidncd
275790111026     c                   eval      RA_nca=vidnca
275800111026     c                   eval      RA_ncl=savncl
275810111026     c                   eval      RA_lna=savlna
275820111026     c
275830111026     c                   endsr
275840111026     C**************************************************************************
275850111026     C* Richiamo pgm di scrittura R.A. per bolla modificata con riass.segnacolli
275860111026     C**************************************************************************
275870111026     C     sr_wrtRA      BEGSR
275880111026     c                   clear                   fidna3ds
275890111026     c                   eval      ia3mad=' 30'
275900111026     c                   eval      ia3tor='S'
275910111026     c                   eval      ia3ogg=%editc(blplnp:'X')+%editc(blpnrs:'X')+
275920111026     c                             %editc(blpnsp:'X')+%editc(blpaas:'X')
275930111026     c                   move      RA_lna        wRA_lna
275940111026     c                   if        wRa_lna<>blplna
275950111026     c                   eval      ia3no2='Ex LNA'
275960111026     c                   eval      ia3no2=%trim(ia3no2)+' '+RA_lna
275970111026     c                   eval      ia3no2=%trim(ia3no2)+' colli'
275980111026     c                   else
275990111026     c                   eval      ia3no2='Ex Nr. colli'
276000111026     c                   endif
276010111026     c                   eval      ia3no2=%trim(ia3no2)+' '+%editc(RA_ncl:'Z')
276020111026     c                   eval      %subst(ia3no2:36:13)='Segnacolli da'
276030111026     c                   eval      ia3no2=%trim(ia3no2)+' '+%editc(RA_ncd:'2')
276040111026     c                   if        RA_nca>0
276050111026     c                   eval      ia3no2=%trim(ia3no2)+' a '+%editc(RA_nca:'2')
276060111026     c                   endif
276070111026     c                   call      'FIDNA3R'
276080111026     c                   parm                    kpjba
276090111026     c                   parm                    fidna3ds
276100111026     c                   endsr
276110130304     C* CONTROLLO SE nome file PDF doppio ---------------------------*
276120130304     C     pdfdop        BEGSR
276130130307     c                   movel     dsblp0        savblp
276140130304     c     kvat          reade(N)  fivat01l
276150130304    1c                   dow       not  %eof(fivat01l)
276160130304     c                   movel     vatnot        dvatp
276170130304    2c                   if        §vatppdfn<>*blanks
276180130306     c     kar8§pdf      setll     fiar802l
276190130306     c     kar8§pdf      reade     fiar802l
276200130304    3c                   dow       not %eof(fiar802l)
276210130304     c     kblpar8       chain     fnblp01l
276220130304    4c                   if        %found(fnblp01l)
276230130304     C                   Z-ADD     BLPMGS        WDSP
276240130304     C                   MOVEL     BLPAAS        WDSP
276250130305    5C     WDSP          IFGE      datapdf
276260130304     c     blpcca        andne     '7'
276270130304     C                   MOVEL     ERR(348)      VIDMSG
276280130304     C                   SETON                                        90
276290130307     C                   MOVEL     SAVBLP        DSBLP0
276300130304     c                   leavesr
276310130304     c                   endif
276320130304     c                   endif
276330130306     c     kar8§pdf      reade     fiar802l
276340130304    3c                   enddo
276350130304    2c                   endif
276360130304     c     kvat          reade(n)  fivat01l
276370130304    1c                   enddo
276380130307     C                   MOVEL     SAVBLP        DSBLP0
276390130304     c*
276400130304     C                   ENDSR
276410130308     C* Invio messagio a Ced se cliente fornisce pdf ma non abilitato*
276420130308     C     ced_alert     BEGSR
276430130311     c                   eval      wrkEmlTo = 'CedAlert@brt.it'
276440130308     c                   eval      wrkEmlcc = *blank
276450130312     c                   eval      wrkOgg = 'PDF del cliente ' +
276460130312     c                                      %editc(§lpccn:'X') +
276470130313     c                                      ' NON ELABORATO'
276480130313     C                   eval      wrkMsg = 'Il cliente ha trasmesso FIVAT' +
276490130313     c                                      ' Tipo Rek "P" ma non è abilitato.'
276500130308     c
276510130308     C                   CALL      'TIS701C1'
276520130308     C                   PARM                    wrkEmlTo        253
276530130308     C                   PARM                    wrkEmlCc        253
276540130308     C                   PARM                    wrkOgg           44
276550130308     C                   PARM                    wrkMsg         5000
276560130308     C                   PARM                    wrkesito          1
276570130308     c                   endsr
276580941221     OFNLV22P   T    LRNLR
276590011212**   GGG
2766009006111234567
276610900511**   VAR
276620941011 ** IMMISSIONE  BOLLE  PARTENZE **
276630941011 ** MANUTENZIONE BOLLE PARTENZE **
276640941011 ** CONFERMA  BOLLE  DA CLIENTI **
276650941011 ** RECUPERO  IMMISSIONE  BOLLE **
276660941011 ** RECUPERO   CONFERMA   BOLLE **
276670990602 **   IMMISSIONE   PREPAGATI    **
276680030409** RigW  Max lung.67                                             67
276690030409              Spedizione da affidare a network FedEx
276700030409         Spedizione relativa ad ORM Commissionato da FedEx
276710030409- Indicare la NATURA DELLA MERCE in lingua inglese
276720030409- Indicare PESO e VOLUME reali
276730030409- Allegare COPIA della fattura alla lettera di vettura (DDT=SI)
276740030520- Allegare ai colli gli altri documenti ritirati dal cliente
276750030409- Indicare AWB FedEx nel Riferimento mittente numerico
276760030520- Allegare alla LDV TUTTI i documenti ritirati dal cliente (DDT=SI)
276770060110       Destinatario con obbligo del DDT in fase di consegna
276780060110Allegare alla LDV l'originale del documento di trasporto (DDT=SI)
276790040329** cmdt
276800040329OVRDBF FILE(TITAS30C) TOFILE(
276810030409** ERR
276820030417Data cons. richiesta superiore a 1 mese dalla data odierna. ENTER x forzare   01
276830950920Data Spedizione formalmente errata  o  superiore a data sospensione xx/xx/xx
276840941020L'anno di spedizione non si puo' variare
276850941020Per le bolle di RECUPERO la Data Spedizione non puo' essere minore di 3 Giorni
276860061221Data Spedizione -per Spedizioni non di Recupero- non minore del xx/xx/xxxx
276870941020Data Ritiro Merce Errata
276880960926Data Ritiro Merce Errata:già confermati i conteggi autotrasp. in questa data
276890941020Linea di PARTENZA Errata
276900941021Immessa Varia "R" per 8888 o 9999 :obbligatorio l'imp.Assicur.Se 0 da tariffa 09
276910941020Codice Bolla Errato o non utilizzabile                                        10
276920941020Discordanza tra codice bolla e codice cliente mittente
276930110217Linea di Arrivo errata o annullata o bloccata                                 12
276940941020Non si puo' variare la linea di arrivo se bolla da cliente
276950941020Immettere la linea di arrivo
276960941110Tipo Servizio Errato o non inseribile dal bollettista                         15
276970941102Codice Trattamento Merce errato
276980950125ATTENZIONE!! TIPO SERVIZIO da x-xxxxxxxx   diventa  x-xxxxxxxx
276990030415Immettere il codice cliente se immessi i dati della Consegna Richiesta        18
277000941020Data Consegna Richiesta Errata
277010941020Ora Consegna richiesta Errata                                                 20
277020960926Codice Autotrasportatore errato
277030941020Cliente Errato o Annullato
277040941020Codice inutilizzabile: cliente che non spedisce
277050941020Se immessa"Tassazione con Tariffa Mittente" inserire anche codice cliente mitt
277060941021Se immessa la Descrizione del Mittente indicare anche il codice: 8888 o 9999  25
277070980623ATTENZIONE! Spedizione di volume > xx,xxx mc. Avvisare ROM. ENTER per forzare 26
277080030728ATTENZIONE! Il numero colli è inferiore ai bancali inseriti                   27
277090940822Nazione Errata
277100950713Sigla Operatore non utilizzabile o non immessa
277110030905L'ORM richiede la bolla in Porto xxxxxxxxx                                    30
277120031029Non immettere la particolarità C/Assegno                                      31
277130031125Immettere la particolarità varia "O" per spedizione con bancali               32
277140941020Numero Spedizione gia' esistente o non immesso
277150941020Manca Numero COLLI
277160031125Immettere la particolarità varia "B" per spedizione con bancali               35
277170040216Referente e Telefono obbligatori per bolla Export con C/A. ENTER X FORZARE    36
277180941020Manca Dettaglio colli: inserirlo con F21 !!!
277190941021PESO Errato o diverso da precedente videata
277200941020MANCA NUMERATORE BOLLE: telefonare in Sede !!!!!!!
277210941020CONTO SERVIZIO : F6  per l'Immissione !!!                                     40
277220941020MANCA NUMERATORE PER STAMPA SEGNACOLLI: Telefonare in Sede !!!!!!
277230991117NUMERATORE BOLLE/SEGNACOLLI non disponibile: RITENTARE  NUOVAMENTE !!!
277240941102Se immesso tipo immettere anche la data o l'ora Consegna Richiesta
277250941020Inoltro Forzato:  F6  per Confermare l'Immissione
277260941102Numero Colli errato o diverso dalla prima videata                             45
277270980402Immettere il peso
277280941020Manca Riferimento Mittente Numerico
277290030805Serie ORM xx non gestita - AVVISARE IL CED                                    48
277300941020Serie incongruente con codice trattamento Merce
277310941020Numero Spedizione indicato in prima videata gia' esistente
277320941020Segnacollo Errato
277330980623ATTENZIONE! Spedizione di peso > xxxxxx,x kg. Avvisare ROM. ENTER per forzare 52
277340941020Manca natura merce
277350040216Referente e Tel. obbligatori per bolla EXPORT in P.Assegnato. ENTER X FORZARE 54
277360040727Spedizione già esistente!!!! Non è possibile confermare la bolla.             55
277370040213Bolla Export FedEx inserire il Telefono del destinatario. ENTER X FORZARE     56
277380090901T.Servizio "H" non ammesso per i tempi di trazione della bolla:F12 x corregg. 57
277390040216Spedizione con consegna a PRIVATI ins. il Telefono del dest.                  58
277400941110T A S S A Z I O N E   C O N   T A R I F F A   M I T T E N T E !!!!            59
277410090901Consegna richiesta non ammessa per tipo servizio "H"                          60
277420941020Zona digitata inesistente per la linea di arrivo della bolla
277430051007Consegna richiesta MINORE della data consegna teorica.
277440941020Giorno Chiusura Errato
277450030411§§Consegna particolare errata                                                 64
277460970408Impossibile annullare bolla LEGATA                                            65
277470030411§§dice Tariffa immesso ha TIPO SERVIZIO x-xxxxxxxx, diverso da quello in bolla66
277480100517Spedizione da cliente,impossibile modificare cod.Cliente Mittente:SERIE DIVERS67
277490030411§§Importo obbligatorio se immessa la sigla varia                              68
277500050429Non si puo' variare: bolla da disk clienti
277510030411§§Per bolla con C/Assegno e' obbligatoria la varia "G"                        70
277520100319ORM non inseribile: Tipo Servizio personalizzato o da disk"B" diverso dall'ORM71
277530100208Cod.Trattam.Merce "xx" non utilizzabile:forzato da"ConfermaBolle"in 1°videata 72
277540100319ORM non inseribile: linea Arrivo personalizzata o da disk"B" diversa dall'ORM
277550100319Forzata linea di arrivo e tipo servizio come da O.R.M.                        74
277560100319Forzato Tipo Servizio come da O.R.M.                                          75
277570100319Tipo Servizio diverso da quello definito sull'O.R.M.                          76
277580030411§§bligatorio dichiarare VALORE MERCE se destinat.estero con attraversam.dogana77
277590950410Non ammessi importi con decimali per la divisa indicata
277600950410Divisa errata                                                                 79
277610100210CAP Destin.Incongruente con L.Arrivo/PESO/VOLM:correggere T.Servizio"H" in "E"80
277620960926Codice non ammesso se cliente di altro punto operativo
277630941110Impossibile usare tariffa cliente per calcolare varia "G":tariffa inesistente
277640970724Bolla legata: impossibile impostare linea di arrivo uguale a linea di partenza83
277650950208Il cliente non presenta tariffe per la bolla ITALIA o ESTERO:ENTER per forzare84
277660950220La bolla presenta un numero segnacollo = 0 : verificare con F21               85
277670940909La serie non e' quella del cliente
277680940909Totale colli del dettaglio segnacolli non corrisponde
277690950525Partita IVA obbligatoria se bolla diretta all'estero con attraversam. dogana  88
277700980310Non e' possibile inserire il numero AWB                                       89
277710970415CAP Destin.Incongruente con L.Arrivo/PESO/VOLM: ENTR x forzare; F12 x corregg.90
277720030904§§CAP Destinatario incongruente con Linea Arrivo:x spediz.in F.DEP. non si forza
277730941011SEGNACOLLO DOPPIO xxxxxxx  presente su  spedizione xxxx xxx xx xxxxxxx per xxx
277740940916Importo da Assicurare = 0 : ENTER per prendere il massimo importo da Tariffa
277750940916Importo da Assicurare obbligatorio, come indicato nella tariffa del cliente
277760011211Importo da Assicurare da non immettere, come indicato nella tariffa del clien.
277770011211Importo da Ass. > DEL LIMITE IMPOSTO XXXXXXXXXX,XXX EUR:TEL.IN SEDE X AUTORIZ.96
277780940916Importo da Assicurare superiore al mandato esposto in tariffa:ENTER x Forzare
277790940919Importo C/Assegno Errato
277800941110Tipo Incasso C/Assegno inesistente o non e' da indicare
277810110217Se immesso CAP o Nazione Mit.Originale immettere tutti 3 i campi:CAP NAZ e MIT
277820090921Fermo Deposito non ammesso per tipo servizio "H"                              01
277830940919Consegna Particolare inesistente o non utilizzabile
277840940919Particolarita' C/A errata,non ammessa o non utilizzabile x il cliente indicato
277850941219Errori in Tassazione                                                           4
277860001106Se modificata la divisa, ridigitare il relativo importo
277870950102Q.ta'da fatturare = 0 per tariffa a valore:ENTER per prendere importo da assic 6
277880950103Inserire la quantita' fatturare  per tariffa a valore
277890950102Q.ta'da fatturare non inseribile per tariffa a valore:assunto importo da assic 8
277900950103Q.ta'da fatturare = 0 per tariffa a quantita'
277910950525Riferimento mitt.alfabetico obbligatorio se destin.estero con attravers.dogana
277920950410Se Imp.Assicurare e Val.Merce uguali, devono anche avere la stessa divisa     11
277930950410Se stessa divisa, importo da Assicurare e Valore Merce devono essere uguali
277940030411§§IMPOSSIBILE ANNULLARE BOLLA: gia' consegnata                                13
277950030411§§IMPOSSIBILE ANNULLARE BOLLA: bolla in consegna                              14
277960950421Zona arrivo xx da bolla cliente diversa da zona xx risultante dal Cappario    15
277970950421Data fattura prepagato deve essere dello stesso mese della data spedizione    16
277980950525Impossibile forzare LINEA ARRIVO ITALIA se destinatario estero                17
277990950525Impossibile forzare LINEA ARRIVO ESTERA se destinatario italiano              18
278000950717"Tassazione con Tariffa Mittente"ammessa solo per assegnati con mittente codif19
278010951027Bolla non confermabile: segnacollo  xxxxxxx  presente piu' volte in bolla     20
278020951027Le consegne particolari non possono essere uguali                             21
278030050714Attenzione!! Verificare Importo da Assicurare e Valore Merce. ENTER X FORZARE 22
278040960213Fermo Deposito errato                                                         23
278050960319Spedizione legata a bolla precedente: non si puo' modificare il codice bolla
278060960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio: F12 x corregg
278070960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio
278080960805Bolla cliente con dettaglio colli: impossibile modificare il numero segnacolli27
278090970704Manca provincia del Mittente in anagrafica: INSERIRLA!!!!                     28
278100961111Se "FRANCO FRONTIERA" tassare la spedizione fino a Milano indicando il PORTO  29
278110080327Tipo Servizio immesso DIVERSO da tariffa e non forzabile                      30
278120011211Importo C/Assegno SUPERIORE al limite imposto XXXXXXXXXX,XXX EUR              31
278130030411§§Per porti assegnati EXPORT, impossibile inserire l'importo da assicurare    32
278140030411§§Per bolle IMPORT, impossibile inserire l'importo da assicurare              33
278150961204Per bolle di RESO  impossibile inserire il C/Assegno
278160970115Dicitura "                non ammessa nella natura merce per bolla ESTERO     35
278170970115Dicitura "                non ammessa nella natura merce per bolla ITALIA     36
278180970128Impossibile ristampare bolla non ancora stampata                              37
278190970328Bolle di recupero devono avere per forza  NO   D D T                          38
278200011212Il CAP prevede obbligatoriamente il documento di trasporto ( SI DDT )         39
278210970408Bolle dirette a nazione con attraversamento dogana devono avere   SI   D D T
278220970414Impossibile modificare linea di arrivo: bolla legata e legame gia' inviato
278230100118Non possono esserci bolle export con servizio XXXXXXXXXX                      42
278240970528Codice bolla non utilizzabile per bolle export                                43
278250030411§§Tassazione non ammessa per P.A. export. Accettata solo la varia N           44
278260971211Non e' possibile togliere il numero A.W.B.                                    45
278270980311Numero A.W.B. obbligatorio per questo codice mittente : F18 per inserirlo     46
278280971211Ultima cifra (CHECK DIGIT) del numero A.W.B. errata: deve essere x            47
278290030805Utilizzare codice bolla xx - ritiro contestuale a consegna.                   48
278300090921T.Servizio "H" non ammesso per C/Assegno da abilitare:F12 x correggere        49
278310030808Ritiro contestuale alla consegna: non trovato ORM abbinato. AVVISARE CED.     50
278320030411§§Impossibile variare il numero colli per bolle import etichettate EUROEXPRESS51
278330000904Codici "CHI SONO" mancanti: F22 per immetterli                                52
278340030411§§lla non confermabile:presenti in bolla segn.Euroexpress doppi.F22 X corregg.53
278350000904Il nr. colli non corrisponde al tot. cod."CHI SONO". F22 X CORREGGERE         54
278360980403Segn.EuroExpress XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX già presente in altra bolla   55
278370030411§§Impossibile selezionare cliente di altro Circuito                           56
278380060921Nazione destinatario valida per DPD soltanto per bolle di RESO!!              57
278390060922CAP inutilizzabile per il network xxx                                         58
278400990610Prepagato: Immettere nelle note il TELEFONO e REFERENTE del RITIRO            59
278410990610Prepagato: premere F14 per tassare o inserire tassazione fino all'imponibile
278420030411§§Non trovata tariffa per tassare i prepagati !!                              61
278430030411§§Per i prepagati i dati della fattura sono obbligatori                       62
278440990628Immettere la prestazione ritiro: mattina o pomeriggio                         63
278450990630MANCA NUMERATORE fatture Prepagati:impossibile confermare.Inserirlo in contab 64
278460060221Importo da assicurare INFERIORE a quanto previsto dalla legge                 65
278470030411§§Per i Prepagati, Numero fattura deve essere maggiore di XXXXXX              66
278480990830Data fattura modificata perche' gia' bloccata per contabilizzazione           67
278490990915Cod.Autotrasport.incongruente con indicazione di merce a magazzino.ENTR forza 68
278500991011E' obbligatorio indicare la divisa                                            69
278510030411§§Prepagati: cliente non codificato o senza tariffa obbligatoria la divisa xxx70
278520991026Numero di decimali errato per la divisa immessa                               71
278530030411§§Prepagati: utilizzare la divisa della tariffa del cliente, xxx              72
278540991026Codice bolla non valido per prepagati                                         73
278550991130Rif.Mittente numerico contiene PARCEL DPD non valido                          74
278560991203Numero PARCEL obbligatorio per EXPORT DPD : F18 per inserirlo                 75
278570991203Non e' possibile togliere il numero PARCEL DPD                                76
278580991203Il numero PARCEL DPD inserito non è corretto                                  77
278590991206Se linea di partenza DPD la spedizione deve essere di 1 collo                 78
278600991206Se linea di arrivo DPD la spedizione deve essere di 1 collo                   79
278610991213Spedizione D.P.D. : non ammesso un peso superiore a xxxxxx,x kg.              80
278620991214Numero  PARCEL D.P.D.  gia' presente                                          81
278630000113Data fattura errata perche'gia'contabilizzata ma impossibile il cambio d'anno!82
278640020214Linea di arrivo errata: non e' una linea prevista per il network              83
278650020214Numero DPD inseribile soltanto se richiesto il network DPD per l'estero       84
278660000120Numero DPD non inseribile: attribuito in modo automatico                      85
278670060612Manca il numero DPD. Inserirlo!!                                              86
278680061030Per network xxxxxx non ammesse spedizioni con C/Assegno per la nazione indicat
278690020214Non trovate tariffe DPD per il cliente: IMPOSSIBILE utilizzare il network DPD 88
278700061011CAP no trovato su cappario D.P.D:F12 x attivazione automatica int.Cappario DPD
278710000124Numero  PARCEL D.P.D.inserito in prima videata, gia' presente !!              90
278720060109Non si posso fare bolle export DPD per clienti soluzioni "B"
278730020214Per la nazione del destinatario non è previsto il network DPD                 92
278740000508Per corretta contabilizzazione,impossibile bollettare la fattura in SOSPENSION93
278750020201Tipo servizio non ammesso per la linea di partenza indicata                   94
278760000509Se linea di partenza POSTE la spedizione deve essere di 1 collo               95
278770000509Spedizione POSTE : peso superiore a xxxxxx,x kg.  Enter per forzare!          96
278780101022Data consegna richiesta immessa errata: cade in giorno festivo                97
278790000509Consegna particolare non ammessa per spedizione POSTE                         98
278800000509Sono ammesse solo spedizioni in  FRANCO  per le  POSTE
278810000509Ammessi soltanto clienti POSTE per spedizioni POSTE                           00
278820000622CAP o localita' inutilizzabili perche' obsoleti                               01
278830000622In conferma di bolle autogenerate POSTE non si puo'cambiare la linea di arrivo
278840000627Impossibile stampare la bolla:dati in controllo e non in aggiornamento!       03
278850000725Bolle poste: utilizzabili solo cod.trattamento merce soluzioni "B"            04
278860000830Presenti in bolla codici "CHI SONO" doppi. F22 PER CORREGGERE                 05
278870000904Terminal di partenza non abilitato all'uso del DISK C                         06
278880030904§§Cliente non abilitato all'uso del DISK C                                    07
278890000918Presenti in bolla codici "CHI SONO" errati. F22 PER CORREGGERE                08
278900020308ATTENZIONE:cod."CHI SONO"                                                     09
278910110419Immettere l'Autotrasportatore per interrogare l'O.R.M.                        10
278920001024Non trovato terminal di partenza della linea di partenza. TELEFONARE IN SEDE  11
278930001024Non trovato terminal di arrivo della linea di arrivo.     TELEFONARE IN SEDE  12
278940110217
278950001220SEGNAC.DOPPIO: presente su spedizione xxxx xxx xx xxxxxxx per xxx.ENTR x FORZ.
278960001212Cliente DPD: la linea di partenza deve essere uguale al p.o. cliente
278970010212Immettere il numero O.R.M.                                                    16
278980010212O.R.M. inesistente                                                            17
278990010220Immettere un  O.R.M. avente p.o. ritiro uguale alla linea di partenza bolla
279000010212O.R.M. in fase non bollettabile. ENTER PER FORZARE
279010010213Forzata linea di arrivo come da O.R.M.                                        20
279020010221Dati diversi rispetto a quelli definiti sull'O.R.M. ENTER PER FORZARE         21
279030010214Il numero O.R.M. non deve essere un prepagato                                 22
279040010214Il numero O.R.M. deve essere un prepagato                                     23
279050010215Codice tariffa diverso da quello definito sull'O.R.M.                         24
279060100319Linea di arrivo diversa da quella definita sull'O.R.M.                        25
279070100319ATTENZIONE:MODIFICATO O.R.M. - Alcuni dati potrebbero aver subito variazioni  26
279080010313La bolla presenta,nel dettaglio colli,un tot.colli errato: verificare con F21 27
279090010409O.R.M. annullato
279100020207Bolla Export       in p.ass.: immettere O.R.M. reale commiss. da p.o.         29
279110010504O.R.M. utilizzabile solo in "Conferma bolle da clienti". F20 PER FORZARE
279120090921Per tipo servizio "H" non ammesse consegne per APPUNTAMENTO o SUPERMERCATI    31
279130011112Divisa scaduta                                                                32
279140011114Manca la varia 'N'                                                            33
279150011211Importo da assicurare non ammesso                                             34
279160011212Importo da assicurare > di XXXXXXXXXX,XXX EUR: VERIFICARE. ENTER PER FORZARE  35
279170011212Importo C/Assegno INFERIORE a xxxxxxxxxx,xxx EUR                              36
279180011212Importo C/Assegno > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE       37
279190011212Valore merce dichiarato obbligatorio                                          38
279200011212Valore merce dichiarato INFERIORE a xxxxxxxxxx,xxx EUR                        39
279210011212Valore merce dichiarato SUPERIORE al limite imposto xxxxxxxxxx,xxx EUR        40
279220011212Valore merce dichiarato > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE 41
279230011212Gli importi inseriti SUPERANO il limite fatturabile, xxxxxxxxxx,xxx xxx       42
279240040116§§ orto varia SUPERA il limite fatturabile, xxxxxxxxxx,xxx xxx                43
279250020214Per la nazione del destinatario non è previsto il network FedEx               44
279260030221Bolla export FedEx: non ammesse spedizioni in C/Servizio                      45
279270020214Non trovate tariffe FedEx x il cliente:IMPOSSIBILE utilizzare il network FedEx46
279280020228Per la nazione del destinatario non è previsto il network Euroexpress         47
279290020319Non trovato il progressivo della tariffa di cartello: TELEFONARE IN SEDE      48
279300020320Linea di arrivo non manutenzionabile                                          49
279310020320Manca il numeratore per l'assegnazione dell'AWB FedEx:TELEFONARE IN SEDE      50
279320020320Numeratore AWB FedEx non disponibile: RITENTARE NUOVAMENTE !!!                51
279330020320Numeratore AWB FedEx oltre il massimo del range previsto: TELEFONARE IN SEDE  52
279340020417Non ammesso cliente mittente non codificato per P.A. Euroexpress              53
279350020507Bolle di recupero per bolle firmate devono avere  per forza  SI   D D T       54
279360040608Destinatario                 :immettere la relativa consegna particolare      55
279370020611C/servizio non ammesso per un prepagato                                       56
279380020731Non è possibile indicare contemporaneamente consegne particolari 'S' e 'X'    57
279390021111Spedizione xxxx xxx xx xxxxxxx per xxx già consegnata                         58
279400021118Valore merce dichiarato obbligatorio per territori Extra CEE                  59
279410021119Se immesso prefisso "FD" o "FM" tutti i segnacolli devo avere lo stesso pref. 60
279420021119Prefisso segnacollo valido solo per bolle FedEx                               61
279430021120Immettere codice tariffa della relativa cartello FedEx                        62
279440030904§§Non ammessa tariffa FedEx Documenti: peso superiore a Kg. xxxxxx,x          63
279450021120Peso incongruente con Bolla FedEx tipo Documenti                              64
279460030904§§Peso incongruente con Bolla FedEx tipo Merci                                65
279470021209Immettere il rif.mittente alfabetico, bolla con cons.particolare Supermercati 66
279480040213Spedizione con APPUNTAMENTO inserire il Telefono del destin.                  67
279490030114Immettere il n. bancali                                                       68
279500021218Tipo bancale errato                                                           69
279510021218Non ammesso stesso tipo bancale                                               70
279520030805Immettere il tipo e il n. bancali x particolarità varie "B" o "O"             71
279530030204Spedizione con bancali, verificare peso e volume                              72
279540030204Modificato il numero dei bancali, verificare peso e volume                    73
279550030805Immettere la particolarità varie "B" o "O" per spedizione con bancali         74
279560030321Bolla con più di 500 colli non è possibile bollettare "DISK C"                75
279570030411Immettere o i dati della consegna richiesta o il numero delle ore             76
279580051215Data consegna richiesta non ammessa: oltre                                    77
279590030415Le ore da aggiungere alla delivery devono essere:  24 - 48 - 72               78
279600130312Mancano dati per la gestione del Packing List/PDF del cliente                 79
279610040603Presenti progressivi riga duplicati nei dati per stampa DDT del cliente
279620040610Bolla senza colli: tipo merce V=valore non ammesso                            81
279630040614Impossibile annullare questa bolla "£ " --> già presente anche in arrivo      82
279640040917Attenzione: inserito mittente estero, VERIFICARE. Enter per continuare        83
279650040930Codice cliente non utilizzabile                                               84
279660041012Particolarità Varie='U':consegna per Appuntamento o a Supermercati non ammessa85
279670041013Per l'O.R.M. immesso già presenti altre bolle con diverso autotrasportatore   86
279680041110Spedizione che prevede la stampa del DDT nella LdV: obbligatorio NO DDT       87
279690041126Codice particolarità varie non utilizzabile per questa linea di partenza bolla88
279700041117ATTENZIONE! Il numero parcel DPD non inizia per 84. ENTER per FORZARE         89
279710041210ATTENZIONE! Manca il logo                                                     90
279720050221Presenti numeri parcel dpd da cliente ripetuti o in numero maggiore di 1      91
279730050309ATTENZIONE: manca il codice bolla. Telefonare IMMEDIATAMENTE in sede          92
279740050914Volume obbligatorio                                                           93
279750051214Consegna richiesta supera di                                                  94
279760060103Bolla in P.Assegnato diretta a destinatario che richiede il SI DDT.ENTER x FOR95
279770060109Bolla export DPD "Disk B":codice trattamento merce errato."Chi Sono" non Autom96
279780060208Prepagato già incassato: impossibile variare totale imponibile                97
279790060324Consegna part. per Appuntamento non valida: presente data consegna "Tassativa"98
279800060612Numero Parcel DPD non valido
279810060613Manca il numeratore per l'assegnazione del Parcel DPD:TELEFONARE IN SEDE      00
279820060613Numeratore Parcel DPD non disponibile: RITENTARE NUOVAMENTE !!!               01
279830060613Numeratore Parcel DPD oltre il massimo del range previsto: TELEFONARE IN SEDE 02
279840060621ATTENZIONE! Il numero parcel DPD non inizia per 084. ENTER per FORZARE        03
279850060707Per il Tipo Incasso C/Assegno richiesto immettere anche il Mittente Originale 04
279860060707Non è possibile variare Linea Arr. passando da network NON DPD a network DPD  05
279870061109Parcel DPD errato:i caratteri iniziali non corrispondono a un Depot esistente 06
279880090827Località non servita per il tipo servizio indicato                            07
279890061109Codice Fiscale obbligatorio per Prepagato non codificato: ENTER per forzare
279900061121O.R.M. commissionato da DPD: selezionare network "DPD"                        09
279910061127Presente C.A.: impossibile annullare                                          10
279920070307Linea di Arrivo     non ammessa per un prepagato di mitt. non codificato      11
279930070620Preapagato: numero O.R.M. non modificabile
279940070806Completare l'indirizzo del destinatario                                       13
279950071023P.Iva/Cd.Fiscale obbligatori per Prepagato non codificato: ENTER per forzare  14
279960071221Linea di arrivo non modificabile:presenti spunte sulla vecchia linea di arrivo15
279970071221Per la linea di arrivo richiesta mancano le spunte: modifica non ammessa      16
279980071221Linea di arrivo estera: non utilizzabile per manutenzione bolla cliente diskB 17
279990081110Codice bolla non valido per un codice trattamento merce di recupero           18
280000090325Codice cliente errato o inesistente                                           19
280010090325Codice cliente non utilizzabile: bloccato in Piano dei Conti                  20
280020090326Attenzione:cambiando l'ORM potrebbe cambiare il cliente/tariffa per tassazione21
280030090326Tasto funzionale non abilitato                                                22
280040090429ORM commissionato da DPD: la spedizione deve essere di 1 collo                23
280050090609Manca tabella Limiti per Tipo Servizio          - TELEFONARE IN SEDE          24
280060090901ATTENZIONE! Sped."   " di n.colli > xxxxx  non ammessa                        25
280070090901ATTENZIONE! Sped."   " di peso > xxxxxx,x Kg. non ammessa                     26
280080090901ATTENZIONE! Sped."   " di volume > xx,xxx mc. non ammessa                     27
280090091008Dato obbligatorio per Porto Assegnato Import                                  28
280100091112Effettuare almeno una selezione                                               29
280110091211Selezionare il mitt. OPPURE l'ordinante ORM                                   30
280120091211Tp.incasso C/A errato --> F12 x correggere                                    31
280130100215Particolarità CONSEGNA incongruente con tipo servizio della bolla             32
280140100217Particolarità CONSEGNA non ammessa se presente consegna richiesta             33
280150100217Particolarità CONSEGNA non ammessa per bolle di recupero o in C/servizio      34
280160101105Bolle dirette a  FEDEX  devono avere   SI   D D T                             35
280170110321ATTENZIONE! Presenti spunte entrata: F16 per forzare                          36
280180110419IMPOSSIBILE ANNULLARE IL PREPAGATO: O.R.M. già ritirato                       37
280190110419O.R.M. ASSEGNATO: disassegnare l'ORM per poter annullare il prepagato         38
280200110422ATTENZIONE: inserita data ritiro più vecchia di xx gg lavorativi.ENTERxFORZARE39
280210110516Presenti errori nell'indirizzo Email Destinatario                             40
280220110519Presenti bolle da VAS non confermate per il cliente mittente: VERIFICARE      41
280230110613Avviso al destinatario non previsto per bolla export                          42
280240130131Inserire la P.Iva o il Codice Fiscale.                                        43
280250130131P.Iva obbligatoria per cliente Italia.                                        44
280260120508P.Iva "$$" non ammessa per prepagato                                          45
280270120515Bolla con attraversamento dogana: inserire la P.Iva o Cod.Fiscale se privato  46
280280120926Non si può trasformare un franco recupero in una bolla non di recupero        47
280290130312Nome PDF per gestione DDT del cliente già presente in altra bolla.Avvisare CED48
280300130313Cliente non abilitato al PDF.                                                 49
