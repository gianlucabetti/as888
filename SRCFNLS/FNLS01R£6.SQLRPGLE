000100120302     /*PRM dbgview(*source)
000110120302     /*CMD ovrdbf file(TITAS30C) tofile(GAITRAGRPS/TITAS30C) +
000120120302     /*CMD        ovrscope(*calllvl)
000130120302     /*CMD ovrdbf file(TNBLA00F) tofile(GAITRAGRPS/TNBLA00F) +
000140120302     /*CMD        ovrscope(*calllvl)
000150120302     /*END dltovr file(TITAS30C TNBLA00F) lvl(*)
000160120302     /*END
000170120302      *
000180000920     H DECEDIT('0,') DATEDIT(*DMY.)
000190140423     h dftactgrp(*no) actgrp(*caller) bnddir('UBBNDDIR')
000200940819     F* FNLS01R *-----------------------------------------------------*
000210900427     F*       IMMISSIONE BOLLE
000220040329      *
000230040329      * COMPILARE CON
000240040329      *               OVRDBF FILE(TITAS30C) TOFILE(GAITRAGRPS/TITAS30C)
000250050407      *
000251170216      *?BISOGNA FARE ATTENZIONE AI PGM EVENTUALMENTE RICHIAMATI NEL CASO
000252170216      *?UTILIZZASSERO SIMFEL: SAREBBE UN PROBLEMA IN CASO DI BOLLETTAZIONE PER
000253170216      *?LNP DI ALTRO TERMINAL DI PARTENZA
000255170216
000260050407      * Annotazioni:
000270050407     c* La gest.del richiamo a fnls01r con §lpfpr='R'(recupero bolle DskCli)
000280050407     c* è rimasta nel pgm ma non viene più utilizzata. Non è stata tolta
000290050407     c* solo per comodità visto che è presente in più punti del pgm
000300000000     F*---------------------------------------------------------------*
000310160613     FFNLS01D   CF   E             WORKSTN usropn
000320161129     F                                     maxdev(*file)
000330940923     F                                     SFILE(LS01S03:NRR)
000340000829     F                                     SFILE(LS01S08:NR8)
000350021203     FFIAPD01L  IF   E           K DISK
000360950920     FAZCLN01L  IF   E           K DISK
000370990630     FCNNUM00F  UF   E           K DISK    USROPN
000380940822     FCNACO00F  IF   E           K DISK
000390900427     FCNIND00F  IF   E           K DISK
000400050209     Ffncls01l  IF   E           K DISK
000410080904     FTNBLA00F  O  A E           K DISK    USROPN extfile(WTNBLA)
000420930120     FFLNUF01L  UF   E           K DISK
000430991117     FFLNUF02L  UF A E           K DISK
000440991117     F                                     RENAME(FLNUF:FLNUF2)
000450940822     FTNTAM01L  IF   E           K DISK
000460990818     FTITPT01L  IF   E           K DISK
000470930629     FAZORG01L  IF   F 5000     2PIDISK    KEYLOC(4)
000480991117     FTABEL00F  IF   E           K DISK
000490941110     FFNBLD01L  UF A E           K DISK
000500020917     FFIVAD02L  UF   E           K DISK    USROPN
000510020917     FFIVAT01L  UF   E           K DISK    USROPN
000520040601     FFIVAX01L  UF   E           K DISK    USROPN
000530110518     FFIVAb01L  UF   E           K DISK    USROPN
000540110518     Fedivab1L  UF   E           K DISK    USROPN
000550940825     F*
000560061212     FFNBLP01L  IF   E           K DISK
000570061212     F                                     INFDS(FNBLP1)
000580061212     F                                     RENAME(FNBLP000:FNBLP001)
000590061212     FFNBLP00F  UF A E             DISK
000600940825     F*
000610140506     FFNarb01l  iF   E           k DISK
000620140506     f*
000630150929     FFIAR801L  IF A E           K DISK
000640130304     FFIAR802L  iF   E           K DISK    rename(fiar8000:fiar802)
000650940825     F* ESTENSIONE DESCRIZIONI
000660060216     FFiar401L  UF A E           K DISK
000670060215     FFiar403L  IF   E           K DISK
000680060215     F                                     RENAME(Fiar4000:Fiar4003)
000690160209     FFiar405l  IF   E           K DISK
000700060215     F                                     RENAME(fiar4000:Fiar4004)
000710021218     fFiar501l  uf a e           k Disk
000720940825     F*
000730991006     F* TASSAZIONE
000740991006     FFIAR701L  UF A E           K DISK
000750991006     FFIAR601L  UF A E           K DISK
000760940825     F*
000770940825     F* C/ASSEGNO
000780051115     FFiar901L  UF A E           K DISK
000790040603     F*
000800940825     F* DETTAGLIO COLLI
000810940825     FFNBLT01L  UF A E           K DISK
000820120814     FFIART01L  UF A E           K DISK
000830120817     FFIART27L  IF   E           K DISK
000840120817     F                                     RENAME(FIART000:FIART027)
000850120828     FFNBLT27L  IF   E           K DISK
000860120828     F                                     RENAME(FNBLT000:FNBLT027)
000870120816     F***FNBLT29L  IF   E           K DISK
000880120816     F***                                  RENAME(FNBLT000:FNBLT029)
000890120828     FFNART27L  IF   E           K DISK    prefix(BLT:3)
000900051102     FFIARS01L  UF A E           K DISK
000910170131     FFIARS03L  IF   E           K DISK
000920170131     F                                     RENAME(FIARS000:FIARS3)
000930940825     F*
000940940825     FFNLBL01L  UF   E           K DISK    USROPN
000950011126     FFIFTT02L  IF   E           K DISK
000960011126     FFIFST02L  IF   E           K DISK
000970011126     F                                     RENAME(FIFTT000:FIFST000)
000980070123     FFNBRV09L  UF   E           K DISK    USROPN
000990071221     FFNBRV07L  iF   E           K DISK    USROPN
001000071221     F                                     RENAME(Fnbrv000:Fnbrv007)
001010080313     F*TNTBE02L  UF A E           K DISK
001020080313     FTNTBE01L  IF   E           K DISK
001030970107     F* FILE DI EDI
001040970107     FEDRDE01L  UF   E           K DISK    USROPN
001050000204     FFISGN01L  UF A E           K DISK
001060001005     FFISGN05L  UF A E           K DISK
001070001005     F                                     RENAME(FISGN000:FISGN005)
001080010212     F*
001090010212     FFNORM01L  IF   E           K DISK
001100100319     FFNORE01L  IF   E           K DISK
001110120611     FFIDST01L  IF   E           K DISK
001120010214     FFNFVV01L  IF   E           K DISK
001130051123     FFNANM02L  UF   E           K DISK
001140051124     FFNANM01L  UF   E           K DISK
001150051124     F                                     RENAME(FNANM000:FNANM01)
001160151112     Fdppdc01l  uf a E           k DISK
001170040329      * Bolle sede
001180040329     fTitas30c  if   e           k Disk    UsrOpn
001190151014     ffiar531c  uf a e           k disk    usropn
001200151014     F                                     RENAME(Fiar5000:fiar500s)
001210151014     F                                     ignore(Fiar5p00)
001220060209      * STORICIZZAZIONE VARIAZIONI
001230060209     FFIARBT0F  O  A E             DISK    usropn
001240060209     FFIARBU0F  O  A E             DISK    usropn
001250070404     FFIARG01L  UF A E           K DISK
001260160120     F*.......... V A R I A Z I O N I   B O L L E
001270160120     FFiARBF2C  IF   E           K DISK    usropn
001280160120     f                                     rename(fnarbd00:fnarbd0c)
001290160120     f                                     rename(fnarbk00:fnarbk0c)
001300160120     f                                     rename(fnarbg00:fnarbg0c)
001310160120     f                                     rename(fiarbt00:fiarbt0c)
001320160120     f                                     rename(fnarbm00:fnarbm0c)
001330160120     f                                     rename(fnarbv00:fnarbv0c)
001340160120     f                                     rename(fnarbp00:fnarbp0c)
001350160120     f                                     rename(fnarbn00:fnarbn0c)
001360070530     F*
001370080221     f**!!!fipdo01t  if   e           k disk
001380070601     ffnorf01l  if   e           k disk
001390070612     FEDTAB01L  IF   E           K DISK
001400070626     ffidpo03l  if   e           k disk
001410100323     fazfgi01l  if   e           k disk
001420160201     ftiidc01l  uf   e           k disk
001430160125      *.......... T E L E F O N A T E   /   R E C L A M I
001440160303     fFITGD32L  if   e           k disk
001450160203     fFITGD01L  if   e           k disk    RENAME(Fitgd000:fitgd001)
001460970107     F*
001470941221     FFNLV22P   O    F  132        PRINTER
001480960926     D L1              S              3  0 DIM(30)
001490070807     D L6              S              3  0 DIM(30)
001500970925     D*
001510940922     D CPA             S              2    DIM(30)
001520970115     D*
001530970115     D TBO             S              1    DIM(30)
001540970115     D LDC             S              2    DIM(30)
001550941108     D*
001560941107     D TSP             S              1    DIM(10)
001570941107     D UTS             S              1    DIM(10)
001580941115     D STS             S              1    DIM(10)
001590941107     D DTS             S             15    DIM(10)
001600000509     D USO             S              1    DIM(10)
001610090604     D DTS08           S              8    DIM(10)
001620090609     D DTS03           S              3    DIM(10)
001630090827     D TSttc           S              5    DIM(10)
001640960209     D*
001650960209     D TBL             S              2    DIM(20)
001660101022     D S1Y             S              1    DIM(20)
001670940916     D*
001680940923     D K07             S              1    DIM(7)
001690940923     D K09             S              1    DIM(9)
001700940919     D K35             S              1    DIM(35)
001710950920     D K31             S              1    DIM(31)
001720940919     D K78             S              1    DIM(78)
001730970115     D K89             S              1    DIM(89)
001740950104     D SKI             S              1    DIM(15)
001750011211     D SKII            S              1    DIM(14)
001760001214     D KOL             S             10    DIM(20)
001770971211     D*
001780971211     D KSS             S              7    DIM(12)
001790940922     D*
001800900611     D GGG             S              1    DIM(8) CTDATA PERRCD(8)
001810990602     D DES             S             34    DIM(6) CTDATA PERRCD(1)
001820151015     d rigw            s             67    Dim(13) Ctdata Perrcd(1)
001830160718     d cmdt            s             60    dim(02) ctdata perrcd(1)
001840170503     D ERR             S             78    DIM(366) CTDATA PERRCD(1)
001850930611     D*
001860980318     D*  SCHIERE PER COMPORRE SEGNACOLLO EUROEXPRESS
001870980318     D §S9             S              1    DIM(9)
001880980318     D §O9             S              1    DIM(9)
001890980330     D W35             S              1    DIM(35)
001900991201      *  SCHIERA PER COMPORRE BARCODE SU LETTERA VETTURA DPD IMPORT
001910991201      *  SCHIERA PER COMPORRE RMN IN STAMPA SEGNACOLLO DPD IMPORT
001920991201     D W15             S              1    DIM(15)
001930991026      *
001940000830     D* COD. CHI SONO PER CONTROLLI DI RECORD DOPPIO
001950021104     D CHI             S             35    DIM(500)
001960021104     D POS             S              4  0 DIM(500)
001970021104     D ANN             S             15  0 DIM(500)
001980021104     D CH2             S             35    DIM(500)
001990021119     d Prefisso        s              2    Dim(500)
002000930629     D UNIORG        E DS          5000    EXTNAME(AZORG00F)
002010040116      * sk x gestire le varie della seconda bolla
002020041217     d w2sv            s              1    Dim(6)
002030041217     d w2va            s             11  3 DIm(6)
002040061011     d
002050061011     D CAP             S              1    DIM(9)
002060061011     D CAF             S              1    DIM(9)
002070020212     D*
002080130117
002090130117      // - Sk per Tabella OSR
002100130117     d skCLIosr        s              7  0 dim(900)
002110130117     d skLNPNRSosr     s              5    dim(900)
002120150414
002130150414      * filiali abilitate a cons.part "Z"=Expo
002140151119     d*fil_expo        s              3    dim(85)
002150130117
002160130117      // - Indici di schiera
002170130117     d osrxx           s              3  0 inz
002180130117
002190130117      // - Campo di comodo per Ordinante ORM lungo 7
002200130117     d wORMcor         s              7s 0 inz
002210130117
002220090827     d Wttc            s              5
002230090827     d WttcCAP         s              5
002240150929     d KoreTrc         s                   like(oretrc) inz('G')
002250100319     d KAr5Trd         s                   like(Ar5Trd)
002260060515     d Bolksc          s                   Like(blpksc)
002270060515     d Bolctr          s                   Like(vidctr)
002280110304     d savnot          s                   Like(tamnot)
002290020212     D wawb            s             11  0
002300020212     D wawbini         s             11  0
002310021119     d Wpre            s              2
002320030204     d wPkg            s              1
002330030204     d wNba            s              1
002340030204     d w0071           s              7  1
002350030204     d w0053           s              5  3
002360050119     d wsolo_prp       s              1
002370030204     d wTbaPkg1        s                   Like(§TbaPkg)
002380030204     d wTbaVol1        s                   Like(§TbaVol)
002390030204     d wTbaPkg2        s                   Like(§TbaPkg)
002400030204     d wTbaVol2        s                   Like(§TbaVol)
002410150302     d wTba            s                   Like(igatba)
002420030204     d SavNba          s                   Like(§Ar5Nba)
002430030204     d SavNb2          s                   Like(§Ar5Nb2)
002440090804     d w_ar5ass        s                   Like(§Ar5ass)
002450091001     d w_ar5tcp        s                   Like(§Ar5tcp)
002460151117     d w_ar5als        s                   Like(§Ar5als)
002470151117     d w_ar5alx        s                   Like(§Ar5alx)
002480151117     d w_§b4ado        s                   Like(§b4ado)
002490091001     d w_ar5tic        s                   Like(§Ar5tic)
002500091214     d w_ar5cdi        s                   Like(§lpcdi)
002510091001     d sav_tc1         s                   like(vidtc1)
002520091001     d sav_tc2         s                   like(vidtc1)
002530030304     d wrma            s              1    Inz
002540030409     d Dataiso         s               d   datfmt(*iso)
002550030415     d woggi5          s              8  0
002560051214     d*woggi1m         s              8  0
002570051214     d woggidcgm1      s              8  0
002580051214     d woggidcgm2      s              8  0
002590051214     d s_woggidcg      s                   like(woggidcgm1)
002600051214     d s_vpodcg        s                   like(§vpodcgm1)
002610080603     d datam40         s              8  0
002620130305     d datapdf         s              8  0
002630030409     d wwtcr           s              1
002640030409     d wflagore        s              1
002650030409     d wore            s              3  0
002660030409     d §ore            s              2  0
002670030417     d fordcr          s              1    Inz
002680060103     d savddt          s                   like(vidbam)
002690030520     d wnonum          s              1    Inz
002700030704     d wforw03         s              1    Inz
002710030704     d wtotncl         s              6  0
002720030708     d savw03cor       s                   Like(§Ar5bCor)
002730030708     d savw03csf       s                   Like(§Ar5bCsf)
002740030718     d savinkh         s              1
002750030718     d savinki         s              1
002760030728     d wfornba         s              1    Inz
002770030728     d wtotnba         s              3  0
002780031125     d wgva            s              1
002790030805     d wkosr           s              5  0
002800030805     d w012a           s             12
002810040608     d w016ad          s             16
002820031001     d wfortbo         s              1    Inz
002830031201     d wnoccm          s              1    Inz
002840031201     d wforpf          s              1    inz
002850091006     d wope            s                        Like(I28Ope)
002860031219     d wrifp           s                        Like(VatNot)
002870141031     d wPinCode        s             15
002880040114     d va2va2          s                        Like(Vi2Va2)
002890040114     d va2va3          s                        Like(Vi2Va3)
002900040114     d va2va4          s                        Like(Vi2Va4)
002910041217     d va2va5          s                        Like(Vi2Va5)
002920041217     d va2va6          s                        Like(Vi2Va6)
002930040603     d s_vaxprr        s                        Like(vaxprr)
002940050119     d s_vidorm        s                        Like(vidorm)
002950050315     d s_ormpers       s              1
002960040114     d war71           s              1
002970040116     d ContaSv         s              2  0
002980121123     d wesvar1         s              1
002990040216     d wforza1         s              1    inz(*off)
003000040216     d wforza2         s              1    inz(*off)
003010110321     d wforzbrv        s              1    inz(*off)
003020110422     d wforzadrt       s              1    inz(*off)
003030141124     d wforz_lna       s                   like(comlna)
003040141124     d wforz_lnap      s                   like(v0clna)
003050141201     d wForzPCExp      s              1
003060110321     d wcheck          s              1    inz(*off)
003070040226     d p26vol          s              8  3
003080040226     d wrifm           s              1    Inz(*Off)
003090040301     d wkk             s              1    Inz(*Off)
003100040319     d wmodorm         s              1    Inz(*Off)
003110170228     d*LnpOgAs         s                   Like(§OgAs)
003120070529     d s_§ogpdaorm     s                   Like(§Ogpdaorm)
003130080111     d*g_ormpor        s                   Like(ormpor)
003140040329     d wlib            s             10
003150040329     d comman          s             80
003160040329     d lenght          s             15  5 inz(80)
003170040302
003180040302     d wtxt            S           2048
003190040302     d TxtInOut        S           2048
003200040302     d ElencoChar      S            256
003210040302     d TipoElenco      S              1
003220100219     d UsaCAss         S              1
003230040302     d CharSost        S              1
003240040302     d UpperCase       S              1
003250040302     d ChkNull         S              1    Inz('1')
003260040302     d CharNull        S              1
003270040302     d Esito           S              1
003280050209     D wclsflo8        S              1
003290081008     D w005a           S              5
003300050331     d wKSCsf1         s              4  0
003310050331     d wKSCsf2         s              4  0
003320051214     d s_d98dce        s                   like(d98dce)
003330061011     d savcapDPD       s                   like(vidcad)
003340061109     d savrsm          s                   like(vidrsm)
003350070827     d W_vidind        s                   like(vidind)
003360061109     d wcdf            s                   like(vidcdf)
003370071022     d wiva            s                   like(vidpim)
003380151106     d wCdfFlg         s                   like(xcfivaflg)
003390061221     d salvatgi        s                   like(g02tgi)
003400081014     d §3cabd_s        s                   like(§3cabd)
003410081023     d cbo_blp         s                   like(vidcbo)
003420061011     d Cappariodpd     S              1
003430120611     d w0050           S              5  0
003440080904     d WTNBLA          s             21    inz('GAITRAGRU /TNBLA00F')
003450091221     d wvidgma         s                   like(vidgma)
003460100604     d w7rRC           s                   like(§7rRC)
003470141202     d w7rPC           s                   like(§7rpincode)
003480100319     d Wofit           s             11  0 inz(99999999999)
003490100323     d kksc            s                   like(acoksc)
003500100323     d klnp            s                   like(blplnp)
003510100323     d klna            s                   like(blplnp)
003520110518     d s_wksc          s                   like(wksc) inz(0)
003530111122     d prelnp          s                   like(vidlnp)
003540111123     d pr0lnp          s                   like(v0clnp)
003550150304     d v2cpkg_i        s                   like(v2cpkg)
003560150304     d varvol_i        s                   like(varvol)
003570130308     d w_allx          s              1
003580130408     d w_allm          s              1
003590130417     d w_alls          s              1
003600130308     d wvatpe          s              1
003610130308     d wvatp           s              1
003620130306     d wvax            s              1
003630130403     d w_prr           s                   like(ar8prr)
003640140307     d w_pdfn          s                   like(§vatppdfn)
003650020212     D*
003660940930     D* PASSO A GESTIONE DETTAGLIO COLLI DA DISK CLIENTI-FNLS78R -
003670900511     D PARAM           DS
003680950321     D  PARCCM               101    107  0
003690941221     D  PARAAS               108    111  0
003700941221     D  PARLNP               112    114  0
003710941221     D  PARNRS               115    116  0
003720941221     D  PARNSP               117    123  0
003730941221     D  PARLNA               124    126  0
003740941221     D  VI3FNS               127    127
003750941221     D  KCI                  128    131  0
003760020917     D  PARFGS               132    134  0
003770160120      * PASSAGGIO A INTERROGAZIONE VARIAZIONI            - FNLR75R -
003780160120     D PARAM1          DS
003790160120     D  PA1AAS                14     17  0
003800160120     D  PA1LNP                18     20  0
003810160120     D  PA1NRS                21     22  0
003820160120     D  PA1NSP                23     29  0
003830160120      *  PREMUTO F3
003840160120     D  PA1F03                30     30
003850160120      *  FLG = "C" CHIUSURA FILES
003860160120     D  PA1FLG                31     31
003870160120     D  PA1PGM                32     41
003880160120     D  PA1DSA                42     61
003890160120     D  PA1GIA               144    144
003900160120     D  PA1FEL               145    147  0
003910160120     D  PA1TBO               148    148
003920160120      *
003930021203      * Ds esterna per ricerca codice padroncino
003940021203     D FNLV24DS      E DS
003950991008     D* STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO/PREPAGATI DA KPJBU
003960950118     D PARAM3          DS
003970170216     D**WPGMSS               246    255
003980990602     D  PARTCH               256    256
003990951228     D* PASSO A CREAZIONE NUMERATORI                   - FNLVCNR -
004000951228     D PARAM4          DS
004010951228     D  PA4CNU                 1      3  0
004020990701     D* PASSO A TASSAZIONE BOLLE                       - TNSF20R -
004030990701     D PARAMF          DS
004040990701     D  WFIAS                256    256
004050940822     D V0DMIT          DS
004060940822     D  V0CRSM                 1     35
004070940907     D  V0CINM                36     70
004080940907     D  V0CLOM                71    105
004090940907     D  V0CCAM               106    114
004100940907     D  V0CPRM               115    116
004110940907     D  V0CNZM               117    119
004120940825     D VIDMIT          DS
004130940825     D  VIDRSM                 1     35
004140940907     D  VIDINM                36     70
004150940907     D  VIDLOM                71    105
004160940907     D  VIDCAM               106    114
004170940907     D  VIDPRM               115    116
004180940907     D  VIDNZM               117    119
004190940824     D*
004200940824     D                 DS
004210940927     D  V0CISM                 1      2
004220940927     D  V0CCPM                 3     16
004230940927     D  V0CPIM                 1     16
004240940824     D                 DS
004250940927     D  VIDISM                 1      2
004260940927     D  VIDCPM                 3     16
004270940927     D  VIDPIM                 1     16
004280940824     D                 DS
004290940927     D  VIDISD                 1      2
004300940927     D  VIDCPD                 3     16
004310940927     D  VIDPID                 1     16
004320940824     D                 DS
004330940927     D  WISO                   1      2
004340940927     D  WCPI                   3     16
004350940927     D  WPIVA                  1     16
004360900427     D TCUDS           DS
004370000000     D  F1                     1      1
004380000000     D  F3                     3      3
004390000000     D  F2                     2      2
004400000000     D  F4                     4      4
004410000000     D  F56                    5      6
004420900514     D                 DS
004430900514     D  VIDLNP                 1      3  0
004440900514     D  VIDNRS                 4      5  0
004450900514     D  VIDNSP                 6     12  0
004460900514     D  VIDSPE                 1     12  0
004470040506     d                 DS
004480040506     d  widlnp                 1      3  0
004490040506     d  widnrs                 4      5  0
004500040506     d  widnsp                 6     12  0
004510040506     d  widspe                 1     12  0
004520900514     D                 DS
004530120828     D  BLTLNP                 1      3  0
004540120828     D  BLTNRS                 4      5  0
004550120828     D  BLTNSP                 6     12  0
004560120828     D**ARTLNP                 1      3  0
004570120828     D**ARTNRS                 4      5  0
004580120828     D**ARTNSP                 6     12  0
004590910829     D  BLPSPE                 1     12  0
004600940214     D                 DS
004610940214     D  VARNCL                 1      5  0
004620940214     D  VARCDP                 6     20
004630940214     D  VARCN                  1     20
004640950921     D                 DS
004650950921     D  WAA                    1      4  0
004660950921     D  WMM                    5      6  0
004670950921     D  WGG                    7      8  0
004680950921     D  WDATA                  1      8  0
004690991201      * PER SEGNACOLLO DPD
004700991214     D                 DS
004710991214     D  DPDSTA                 1     26
004720991214     D  DPDCOS                 1     12
004730991214     D  DPDSTP                13     26
004740991214     D  DPDS1                 13     15
004750991214     D  DPDV1                 16     16    INZ
004760991214     D  DPDS2                 17     24
004770991214     D  DPDV2                 25     25    INZ
004780991214     D  DPDS3                 26     26
004790991214     D                 DS
004800991214     D  DPDPAR                 1     12
004810991214     D  DPD1                   1      3
004820991214     D  DPD2                   4     11
004830991214     D  DPD3                  12     12
004840940819     D***
004850940819     D* PARAMETRI PER CONTROLLO DATA E TRASFORM IN GIORNI - XSRDA8 -
004860940819     D***
004870940819     D WLBDAT          DS                  INZ
004880940819     D  G02DAT                 1      8  0
004890940819     D  G02INV                 9     16  0
004900940819     D  G02ERR                17     17
004910940819     D  G02TGI                18     22  0
004920940819     D***
004930940819     D* PARAMETRI PER TRASFORM GIORNI IN DATA             - XSRDGI -
004940940819     D***
004950940819     D WGIDAT          DS                  INZ
004960940819     D  GIODAT                 1      8  0
004970940819     D  GIOINV                 9     16  0
004980940819     D  GIOTGI                17     21  0
004990000000     D KPJBA         E DS
005000991117      * CALCOLO DEL CHCK DIGIT PER BARCODE DPD
005010991117     D                 DS
005020991117     D  DPDLNP                 1      3  0
005030991117     D  DPDGMS                 4      7  0
005040010222     D  DPDNDS                 8     11  0
005050991117     D  §11                    1     11  0
005060991201     D                                     DIM(11)
005070991117     D  DPDCHD                12     12  0
005080991117     D  DPDBRC                 1     12  0
005090000915     D                 DS
005100000915     D  V8HFLS                 1      3  0
005110000915     D  V8HLNA                 4      6  0
005120000915     D  V8HNRS                 7      8  0
005130000915     D  V8HNSC                 9     15  0
005140000915     D  V8HCOL                 1     15  0
005150000915     D                 DS
005160000915     D  KFLSAN                 1      3  0
005170000915     D  KLNAAN                 4      6  0
005180000915     D  KNRSAN                 7      8  0
005190000915     D  KNSCAN                 9     15  0
005200000915     D  KANNUL                 1     15  0
005210010212     D                 DS
005220010213     D  WOPOE                  1      3  0
005230010222     D  WONSR                  4      5  0
005240010222     D  WONOR2                 6     12  0
005250010222     D  WONOR                  4     12  0
005260010213     D  WONRV                 13     14  0
005270010222     D  WIDOR1                 4     14  0
005280010215     D  WIDORM                 1     14  0
005290010215     D                 DS
005300010215     D  VIDPOE                 1      3  0
005310010222     D  VIDNOR                 4     12  0
005320010215     D  VIDNRV                13     14  0
005330010215     D  VIDORM                 1     14  0
005340010219     D                 DS
005350010219     D  V0CPOE                 1      3  0
005360010222     D  V0CNOR                 4     12  0
005370010219     D  V0CNRV                13     14  0
005380041220     D  V0CORM1                4     14  0
005390010219     D  V0CORM                 1     14  0
005400041220     D                 DS
005410041220     D  s_v0cpoe               1      3  0
005420041220     D  s_v0cnor               4     12  0
005430041220     D  s_v0cnrv              13     14  0
005440041220     D  s_v0corm               1     14  0
005450030805     d                 ds
005460030805     d  savOrmPoe              1      3  0
005470030805     d  savOrmNsr              4      5  0
005480030805     d  savOrmNor              6     12  0
005490030805     d  savOrmNrv             13     14  0
005500030805     d  savkeyorm              1     14  0
005510040227
005520040227     d  OrmRfa         ds
005530040227     d  wrmbolla               1      1
005540040227     d  wrmaas                 2      3
005550040227     d  wrmlnp                 4      6
005560040227     d  wrmnrs                 7      8
005570040227     d  wrmnsp                 9     15
005580030805
005590000901     D DSBLD7        E DS
005600000901     D  §C                     1     17  0
005610000901     D                                     DIM(17)
005620001012     D                 DS
005630000911     D  §CB                    1     18  0
005640000901     D                                     DIM(18)
005650000911     D  §CA                    1     18
005660000911     D                                     DIM(18)
005670001012     D                 DS
005680001012     D  §2                     1      2  0
005690000901     D                                     DIM(2)
005700001012     D  §2A                    1      2
005710000901     D                                     DIM(2)
005720991011     D* DS PER YEURCO - EURO CONVERTITORE
005730991011     D DSYEUR        E DS                  EXTNAME(YEURCODS)
005740061109     d
005750061109     d* Controllo codice fiscale
005760151106     d xcfiva1ds     e ds
005770061109     d
005780061110     D* DS PER YCO601R - RICERCA codice fiscale
005790061109     D YCO600DS      E DS
005800940819     D*
005810991007     D DS$2          E DS
005820991007     D OG148         E DS
005830000204     D OG150         E DS
005840000204     D OG143         E DS
005850020213     D A_og143       E DS                  EXTNAME(OG143)
005860020213     D                                     prefix(A_)
005870040525     D A_og150       E DS                  EXTNAME(OG150)
005880040525     D                                     prefix(A_)
005890080623     D edidspu       E DS
005900000623     D DSBL4W        E DS
005910140122     D*DSBL4J        E DS
005920010212     D DSBL4M        E DS
005930141103     D DSBL4Y        E DS
005940110706     D DSBL44        E DS
005950061122     D S_dsbl4m      E DS                  EXTNAME(dsbl4m)
005960061122     D                                     prefix(S_)
005970070620     D  s_§b4orm               1     14  0
005980070627     D  s_§b4fit               4     14  0
005990160209     D A_dsbl4m      E DS                  EXTNAME(dsbl4m)
006000160209     D                                     prefix(A_)
006010070620
006020020523     D DSBL4A        E DS
006030010925     D DSBL4Z        E DS
006040061003     D*DSBL4F        E DS
006050060509     D DSBL4I        E DS
006060060509     D DSBL4K        E DS
006070991203     D DSBL4E        E DS
006080971215     D DSBLDE        E DS
006090971215     D DSBLD         E DS
006100000627     D DBLP          E DS
006110150916     D DBLP01        E DS
006120991007     D DTAS          E DS
006130040329     d  §tasflo      e                     extfld(tasflo)
006140991007     D DTASV         E DS
006150941108     D  VSV                    1     20
006160941108     D                                     DIM(20)
006170991008     D  VVA                   21    140P 3
006180991007     D                                     DIM(20)
006190991007     D  VES                  141    160
006200941108     D                                     DIM(20)
006210971216     D DS1A          E DS
006220900529     D DS1B          E DS
006230940928     D DS1P          E DS
006240061030     d
006250940928     D DS15          E DS
006260080414     D*ds15x         E DS                  EXTNAME(ds15)
006270080414     d**                                   prefix(X_)
006280160224     D DS16          E DS
006290061030     d
006300101022     D DS1Y          E DS
006310101022     D DS3A          E DS
006320921217     D DS3C          E DS
006330100517     D** D3cp          E DS
006340940825     D DS3I          E DS
006350991213     D DS3IDP        E DS
006360000509     D DS3IPT        E DS
006370941102     D DS5E          E DS
006380980806     D DS7T          E DS
006390041126     D DS7S          E DS
006400051124     D DS7c          E DS
006410100217     D DS7R          E DS
006420921217     D DSCC          E DS
006430921217     D DSCT          E DS
006440940826     D DSCV          E DS
006450011108     D DSCW          E DS
006460020725     D DYIV          E DS
006470000124     D DSTA01        E DS
006480061002     d* campo §tasflo della DTAS
006490061002     D DTAS01        E DS
006500000124     D DSTB          E DS
006510940914     D DSQT1         E DS
006520921217     D DSTM          E DS
006530060208     D DS7L          E DS
006540991008     D DGED          E DS
006550991008     D DGEI          E DS
006560161229     D*Dfsc          E DS
006570010924     D DORM01        E DS
006580010409     D DDFT          E DS
006590010409     D  §DFORA       E                     EXTFLD(D§DFTORA)
006600010409     D  §DFORR       E                     EXTFLD(D§DFTORR)
006610010409     D  §DFTOR       E                     EXTFLD(D§DFTTOR)
006620010409     D  §DFTCO       E                     EXTFLD(D§DFTTCO)
006630010409     D  §DFDDT       E                     EXTFLD(D§DFTDDT)
006640010409     D  §DFPAG       E                     EXTFLD(D§DFTPAG)
006650010409     D  §DFPKG       E                     EXTFLD(D§DFTPKG)
006660010409     D  §DFBNC       E                     EXTFLD(D§DFTBNC)
006670010409     D  §DFMAX       E                     EXTFLD(D§DFTMAXKG)
006680000120     D DCHI          E DS
006690010212     D DFAR          E DS
006700010215     D  §FARDS       E                     EXTFLD(D§FARDES)
006710010215     D  §FARFB       E                     EXTFLD(D§FARFFB)
006720010309     D  §FARNF       E                     EXTFLD(D§FARNONF)
006730010319     D  §FARMN       E                     EXTFLD(D§FARMAN)
006740010319     D  §FARST       E                     EXTFLD(D§FARSTP)
006750010319     D  §FARAF       E                     EXTFLD(D§FARAFVV)
006760010319     D  §FARCF       E                     EXTFLD(D§FARCFVV)
006770011025     D  §FAROO       E                     EXTFLD(D§FARNOO)
006780011025     D  §FARUV       E                     EXTFLD(D§FARUVA)
006790011025     D  §FARDV       E                     EXTFLD(D§FARDVA)
006800060103     d ddstflo       e ds
006810021120     D DDFE          E DS
006820021218     d Dar5Ban       e Ds
006830030704     d Dar5Bnb       e Ds
006840151015     d Dar5FAT       e Ds
006850130306     d Dar8§pdf      e Ds
006860030204     d dTba          e ds
006870030326     d dDcr          e ds
006880030805     d dAr5Rcc       e Ds
006890030805     d dOsr          e Ds
006900031113     d Dar5Gen       e Ds
006910100319     d DoreGen       e Ds
006920110512     d Dar5Emd       e Ds
006930031125     d dVato         e ds
006940110704     d dVat4         e ds
006950130306     d dVatP         e ds
006960130315     d dVats         e ds
006970040701     d dVpoppt       e ds
006980041217     d dVpo          e ds
006990160829     d dVpols01      e ds
007000060207     d dVpodeco      e ds
007010150304     d dVpotellus    e ds
007020121017     d ddgd          e ds
007030160323     d dnsd          e ds
007040081111      * Ds date statistiche
007050081111     d dSdf          e ds
007060110818     d*** dVUS          e ds
007070110818     d dxco          e ds
007080110818     D  vaa                    1     10    dim(10)
007090060612     d dVate         e ds
007100070529     d dPdo          e ds
007110071220     d dcli          e ds
007120090625     d trulticds     E DS
007130100517     d trulNRSds     E DS
007140061106     D TRULdepds     E DS
007150030610      * DS - PARAMETRI PER STAMPA BOLLE ED ETICHETTE
007160030610     D TRUL90DS      E DS
007170030611     D WTRUL90DS     E DS                  extname(TRUL90DS) prefix(W)
007180060619      * DS PER FIEU12R - CREAZIONE EVENTI FISSI DPD
007190060619     D fieu12ds      E DS
007200941005     D* DS PER TRTB69R - TRTB70R - TRTB72R - TRTB73R - INT E GEST PARTI
007210941005     D DS7PQR        E DS                  EXTNAME(DS7PQRS)
007220940919     D* DS PER TRUL06R - CARICAMENTO £X
007230940919     D DSUL06        E DS                  EXTNAME(TRUL06DS)
007240940919     D  LIN                    1     90  0
007250960926     D                                     DIM(30)
007260011211     D* DS PER TRUL21R - CONTROLLO LIMITI IMPORTO DA C/ASSEGNO
007270011211     D DSUL21        E DS                  EXTNAME(TRUL21DS)
007280011211     D* DS PER TRUL22R - CONTROLLO LIMITI IMPORTO DA ASSICURARE
007290011211     D DSUL22        E DS                  EXTNAME(TRUL22DS)
007300011211     D  I22TLS       E                     EXTFLD(I22TLA)
007310011211     D  I22LNS       E                     EXTFLD(I22LNA)
007320011212     D  I22LPS       E                     EXTFLD(I22LNP)
007330011212     D* DS PER TRUL23R - CONTROLLO LIMITI VALORE MERCE
007340011212     D DSUL23        E DS                  EXTNAME(TRUL23DS)
007350090608     D* DS PER TRUL73R - CONTROLLO LIMITI per tipo servizio
007360090608     D trul73ds      E DS
007370020320     D* DS PER TRUL33R - REPERIMENTO/AGGIORNAMENTO NUMERATORI SU AZNUM
007380020320     D TRUL33DS      E DS
007390991102     D* DS PER TIBS02R - GESTIONE TNTBE00F
007400991102     D DSBS02        E DS                  EXTNAME(TIBS02DS)
007410050502     D* DS PER FNLV20R - DS DEI CAMPI PER CALCOLO VOLUME DA FATTURARE
007420050502     D DSLV20        E DS                  EXTNAME(FNLV20DS)
007430030626     D* DS PER STAMPA BOLLA
007440030626     D fnlsb5DS      E DS
007450130315     d FNLSB6ds1     e ds                  inz
007460130419     d   DB6pdf      e                     inz('X')
007470991014     D* DS PER FNLV04R - CALCOLO TOTALE FATTURA SE IMMESSO NUMERO E DAT
007480991014     D DSLV04        E DS                  EXTNAME(FNLV04DS)
007490970707     D* DS PER FNLV13R - CONTROLLO DI UN CAP
007500970707     D DSLV13        E DS                  EXTNAME(FNLV13DS)
007510970707     D* DS PER FNLV14R - CONTROLLO DI INDIRIZZO COMPLETO  SENZA CAP
007520970707     D DSLV14        E DS                  EXTNAME(FNLV14DS)
007530970702     D* DS PER TISI95R - CONTROLLO DI CAP
007540970702     D DSSI95        E DS                  EXTNAME(TISI95DS)
007550060922     D TISI97DS      E DS
007560160223     D d_TISI97DS    E DS                  extname(tisi97ds)
007570160223     D                                     prefix(d_)
007580150731
007590150731     D DSSI00        E DS                  EXTNAME(TISI00DS)
007600150731     D tisi30ds      E DS
007610150731
007620060619     D* DS PER TISIE3R - CAPPARIO DPD  - NUOVO
007630060619     D TISIe3ds      E DS
007640061011     D* DS PER TISIE8R - interrogazione CAPPARIO DPD  - NUOVO
007650061011     D TISIe8ds      E DS
007660991008     D* DS PER FNLV16R - CONTROLLO TASSAZIONE
007670991008     D DSLV16        E DS                  EXTNAME(FNLV16DS)
007680040115     D DLV1601       E DS
007690941025     D* DS PER FNLV18R - CALCOLO DI UN VOLUME AUTOMATICO
007700941025     D DSLV18        E DS                  EXTNAME(FNLV18DS)
007710060215     D* DS PER FNLV19R - PER SCRITTURA Fiar400F
007720941028     D DSLV19        E DS                  EXTNAME(FNLV19DS)
007730050920     D* DS PER FNLV59R - CARICAMENTO E CONTROLLO TARIFFE DI 1 CLIENTE
007740050920     D fnlv59ds      E DS
007750970925     D* DS PER FNLV55R - RICERCA TERMINAL DI PARTENZA/ARRIVO
007760970925     D DSLV55        E DS                  EXTNAME(FNLV55DS)
007770970925     D* DS PER TNSD99R - CALCOLO  DELLA CONSEGNA TEORICA BOLLA
007780970925     D DSSD99        E DS                  EXTNAME(TNSD99DS)
007790000907     D* DS PER FNLSZ1R - CONTROLLO COD. "CHI SONO"
007800000907     D DSLSZ1        E DS                  EXTNAME(FNLSZ1DS)
007810020213     D* DS PER TRUL27R - Ricerca tarfiffa di cartello
007820160219     D*trul27ds      E DS
007830160219     D* DS PER TRUL27R1 - Ricerca network bolla
007840160219     D trul27ds1     E DS
007850160219     D* DS PER TRUC27R  - Ricerca tariffa di cartello
007860160219     D trulc7ds      E DS
007870051206     D* DS PER tntb51R - controllo se dati EDI trasferiti
007880051206     D tntb50ds      E DS
007890061122     D fior51ds      E DS
007900070604     D fior56ds      E DS
007910081014     D trtc86drds    E DS
007920150226     D tisigads      E DS
007930030326     d Trul13ds      e ds
007940030326     D  tI13Tla      e                     EXTFLD(I13Tla)
007950030326     D  tO13Err      e                     EXTFLD(O13Err)
007960030326     D  tO13Msg      e                     EXTFLD(O13Msg)
007970111206     d
007980111206     d Trul13ds1     e ds
007990090325
008000090325     D TIBS69DS      E DS
008010090515     D ds_cnaco      E DS                  extname(CNACO00F) prefix(BS_)
008020090515     D ds_cnind      E DS                  extname(CNIND00F) prefix(BS_)
008030090515     D ds_cnclp      E DS                  extname(CNCLP00F) prefix(BS_)
008040090515     D ds_fncls      E DS                  extname(FNCLS00F) prefix(BS_)
008050090325
008060980108     D CNCR80        E DS
008070900427     D UT§DSE        E DS                  EXTNAME(UT§DSE0F)
008080000000     D  TCU                  398    697
008090000000     D                                     DIM(50)
008100000000     D  KCU                  698    847P 0
008110000000     D                                     DIM(50)
008120000000     D                                     PACKEVEN
008130000000     D  DTU                  848    895P 0
008140000000     D                                     DIM(12)
008150000000     D                                     PACKEVEN
008160991214     D* DS DI BLP
008170000211     D DSBLP0        E DS                  EXTNAME(FNBLP00F)
008180000211     D DSBLD0        E DS                  EXTNAME(FNBLD00F)
008190000211     D DSSGN0        E DS                  EXTNAME(FISGN00F)
008200041019     D SAVBLP        E DS                  EXTNAME(FNBLP00F)
008210041019     D                                     prefix(x_)
008220001130     D* DS RICHIAMO PROGRAMMA CANCELLAZIONE BOLLA SINGOLA
008230001130     D DSLS63        E DS                  EXTNAME(FNLS63DS)
008240010216     D* DS RICHIAMO PROGRAMMA RICERCA O.R.M.
008250150928     D*DSOR04        E DS                  EXTNAME(FIOR04DS)
008260150928     D fior010ds     E DS
008270110419     D fior58ds      E DS
008280010228     D* DS RICHIAMO PROGRAMMA IMMISSIONE ORM PREPAGATO
008290010228     D DSOR05        E DS                  EXTNAME(FIOR05DS)
008300010228     D  §RMPOO       E                     EXTFLD(§RMPOEO)
008310010228     D  §RMNSO       E                     EXTFLD(§RMNSRO)
008320010228     D  §RMNOO       E                     EXTFLD(§RMNORO)
008330010228     D  §RMNRO       E                     EXTFLD(§RMNRVO)
008340980318     D* DS PER COMPOSIZIONE SEGNACOLLO EUROEXPRESS
008350980318     D                 DS
008360980318     D  WJUT                   1      3    INZ('JUT')
008370980318     D  WIT                    4      5    INZ('IT')
008380051102     D  ARSFLS                 6      8  0
008390051102     D  ARSNRS                 9     10  0
008400051102     D  ARSNSC                11     17  0
008410011120     D  W15C                  18     19
008420011107     D  W55L                  18     21
008430980408     D  WCADN                 22     32
008440980408     D  DSEEX                  1     32
008450010216     D*
008460010216     D* DS PER RICHIAMO FIOR07R PER VISUALIZZAZIONE ORM
008470010216     D FIOR07          DS
008480010216     D  D07POE                 1      3  0
008490010216     D  D07NOR                 4     10  0
008500010216     D  D07NSR                11     12  0
008510010216     D  D07NRV                13     14  0
008520010216     D  D07SCE                15     15
008530010216     D  D07FGS                16     18  0
008540010216     D  D07POR                19     21  0
008550010216     D  D07DTR                22     29  0
008560010216     D  D07MDB                30     39
008570010216     D  D07PRB                40     49
008580010216     D  D07DTS                50     57  0
008590010216     D  D07RMP                58     58
008600010216     D  D07BRC                59     59
008610010216     D  D07REF                60     61
008620010216     D  D07MIO                62     62
008630011108     D DSEDIT        E DS                  EXTNAME(XEDITDS)
008640011108     D  IEDNUM       E                     EXTFLD(IEDNUMERO)
008650011108     D  IEDNRD       E                     EXTFLD(IEDNRDEC)
008660011108     D  IEDEDT       E                     EXTFLD(IEDEDTCOD)
008670011108     D  IEDLEN       E                     EXTFLD(IEDLENFLD)
008680011108     D  OEDNUM       E                     EXTFLD(OEDNUMAN)
008690011108     D  OEDFLG       E                     EXTFLD(OEDFLGERR)
008700011108     D  OEDCOD       E                     EXTFLD(OEDCODERR)
008710020530     D*
008720060213     D DSARBD        E DS
008730060213     D DSARBG        E DS
008740060213     D DARBT         E DS
008750060213     D DSARBK        E DS
008760060213     D fnlr48ds      E DS
008770020530     D tisit0ds      E DS
008780070924     D tisit0x1ds    E DS
008790091006      * ds x richiamo pgm FNLS28R
008800091006     d Fnls28ds      e ds
008810040227      * ds x richiamo pgm FNLS26R
008820040227     d Fnls26ds      e ds
008830060125      * ds x richiamo pgm FNLS25R
008840060125     d Fnls25ds      e ds
008850060207      * ds x richiamo pgm FNLv85R
008860060207     d Fnlv85ds      e ds
008861161220
008862161220     d Fnlv84ds      e ds
008870060616     d trul28ds4     e ds
008880061127     d fidn12ds      e ds                  prefix(dn_)
008890110512     d dsemail       e ds
008900110517     d Fnls80ds      e ds
008910110517     d  dPog                   1     90  0 Dim(30)
008920140507     d fidna6ds      e ds
008930160129     d fidna7ds      e ds
008940160125     d FIDNA2ds      e ds                  inz
008950160125     d  IA2mod       e                     inz('I')
008960160125     d  IA2tor       e                     inz('S')
008970060208     D cndizion      E DS
008980060208     D                                     BASED(nullPtr)
008990060208     D                                     PREFIX(diz)
009000120615     d trulflbds     e ds
009010080109      * - Aggiunta/Sottrazione di n giorni lavorativi ad una data
009020080109     d TRUL52ds      e ds
009030151023
009040151023     d fieulpdds     e ds
009050151023
009060051123     d* Ds per richiamo fnlsa8r
009070051124     D*PARAM2          DS
009080051123     D* PARAM2: PASSAGGIO AD ANNULLAMENTO ANOMALIE E DATE
009090051124     D**wrvnfv                 2      6  0
009100051124     D**BRVNPG                 7      7  0
009110051124     D**BRVLNP                 8     10  0
009120051124     D**BRVLNA                11     13  0
009130051124     D**BRVNRS                14     15  0
009140051124     D**BRVNSC                16     22  0
009150051124     D**BRVCAN                23     23
009160051124     D**BRVVUC                24     30  6
009170051124     D**PARFLG                31     31
009180051124     D**PARFEL                92     94  0
009190051124     D**BRVNPS                95     96  0
009200051124     D**BRVFGS                97     99  0
009210051124     D**BRVFLE               100    102  0
009220051124     D**BRVpes               103    105  0
009230080410     D dcppflo       e ds
009240080410     D dntw          e ds
009250140121     D dspr          e ds
009260140612
009270140612     d TRULVPODS     e ds
009280160304     d** sk_VPODIR            16    765    inz   dim(250)
009290160310     d   sk_VPODPD            16    765    inz   dim(250)
009300150701     d* Aggiorna record di FISGN duplicati su altro Terminal di Partenza
009310150701     d fnlssgnds     e ds
009320160223      *
009330160223     d fnlvdpds      e ds
009340061212     d*
009350061212     D FNBLP1          DS
009360061212     D  BLPNRR               397    400B 0
009370160125      *?definizione oggetto reclamo come spedizione?
009380160125     d ds_OggSped      ds                  inz
009390160125     d  wdna2lnp                      3s 0 inz
009400160125     d  wdna2nrs                      2s 0 inz
009410160125     d  wdna2nsp                      7s 0 inz
009420160125     d  wdna2aas                      4s 0 inz
009430020212     d*
009440020212     d xw              s              2  0
009450020212     d zw              s              2  0
009460020212     d totale          s              3  0
009470020212     d intero          s              2  0
009480020212     d restof          s              2  0
009490021120     d Ksc8888         s              4  0
009500021120     d DueCtr          s              2  0
009510021120     d Wctr            s                   Like(VidCtr)
009520020212     d*
009530020212     d fedexbrc        ds
009540020212     d  fbrc                   1     11  0 dim(11)
009550020212     d  fchd                  12     12  0
009560020212     d*
009570020212     d base            s              1  0 dim(3)
009580020308     d*
009590020308     d sav_dslsz1      s                   like(dslsz1)
009600021118     d SavGdd          s                   Like(O95Gdd)
009610020308     d w8hcol          s                   like(v8hcol)
009620020308     d w8cnot          s                   like(v8cnot)
009630020308     d wnopos          s              1
009640020319     d clintw          s                   like(§ogntw)
009650081215     d ntwpor          s                   like(§ogntw)
009660020530     d wdisag          s                   like(ot0dos)
009670030305     d savdisag        s                   like(ot0dos)
009680070924     d savpart         s                   like(ot0dos)
009690080307     D WY              s              2  0
009700021203
009710021203     D kpdpdr          S                   LIKE(APDpdr)
009720021203     D kpdtip          S                   LIKE(APDtip)
009730060109     d d_o95lna        s                   like(o95lna)
009740060109     d d_o95znc        s                   like(o95znc)
009750060109     d d_o952ln        s                   like(o952ln)
009760060308     d wcvb            s                   like(ilv85cvb)
009770060522     d kfgs            s                   like(dstfgs)
009780060522     d w_pogest        s                   like(dstfgs)
009790060622     d §lpcad_w        s                   like(§lpcad)
009800060707     d savaogntw       s                   like(§ogntw)
009810061121     d poentw          s                   like(§ogntw)
009820061012     d wdpc            s                   like(pdcdpc)
009830060613     d wsolo_num       s              1
009840060614     d comnrd          s             14  0
009850061218     d savnrr          s                   like(blpnrr)
009860070322     d wparcel         s              2
009870070404     d w_cgi           s                   like(§lpcgi)
009880070404     d lna_sav         s                   like(blplna)
009890070427     d savtb1          s                   like(flgtb1)
009900120926     d savrbl          s                   like(§3arbl)
009910120927     d wagc            s                   like(blpaas)
009920070612     d kedcod          s                   like(tabcod)
009930070612     d kedkey          s                   like(tabkey)
009940070626     d kdpodep         s                   like(dpodep)
009950070626     d kdpoord         s                   like(dpoord)
009960070829     d s_drt           s                   like(viddrt)
009970070829     d s_drtblp        s                   like(viddrt)
009980081111     d s_drtblpi       s                   like(blpdrt)
009990071023     d w_callyco       s              1
010000080313     d k_tbecod        S                   LIKE(tbecod)
010010080313     d k_tbeke1        S                   LIKE(tbeke1)
010020100517     d** wparz           s              1
010030100517     d** wparz_d         s                   like(vidncd)
010040100517     d** wparz_a         s                   like(vidnca)
010050080314     d w_bldncd        s                   like(bldncd)
010060080314     d w_bldnca        s                   like(bldnca)
010070100517     d** no_range        s              1
010080080314     d f_range         s              1
010090160726     d*wemznc          s              2  0
010100160726     d*wmsgzo          s              1
010110090609     d wmsgtsp         s             78
010120090609     d wvid            s              1
010130090609     d wncl            s                   like(v1cncl)
010140090609     d wpes            s                   like(vidpkg)
010150090609     d wvol            s                   like(vidvol)
010160090609     d wncl_pre        s                   like(v1cncl)
010170090609     d wpes_pre        s                   like(vidpkg)
010180090609     d wvol_pre        s                   like(vidvol)
010190160219     d oc7prgc_        s                   like(tamprg)
010200160219     d s_27ntw         s                   like(o27ntw)
010210060208     d*
010220060208     D nullPtr         S               *
010230060208     D prmAas          S
010240060208     D                                     LIKE(diz$Aas)
010250060208     D prmLnp          S
010260060208     D                                     LIKE(diz$Lnp)
010270060208     D prmNrs          S
010280060208     D                                     LIKE(diz$Nrs)
010290060208     D prmNsp          S
010300060208     D                                     LIKE(diz$Nsp)
010310060208     D prmFiv          S
010320060208     D                                     LIKE(diz$Fiv)
010330060208     D prmDft          S
010340060208     D                                     LIKE(diz$Dft)
010350060208     D prmNft          S
010360060208     D                                     LIKE(diz$Nft)
010370060208     D prmEsito        S             10I 0
010380020212     d*
010390090325     d $Fine           s               n   inz(*off)
010400090326     d wclg            s                   like(§b4clg)
010410090326     d w_§lpksca       s                   like(§lpksca)
010420090326     d w_§lpctra       s                   like(§lpctra)
010430090326     d s_fnlv59ds      s                   like(fnlv59ds)
010440090326
010450090327     d s_wcliksc       s                   like(wcliksc)
010460090326     d s_wclictr       s                   like(wclictr)
010470090327     d s_ormksc        s                   like(ormksc)
010480090327     d s_ormctr        s                   like(ormctr)
010490140211     d ormloc_n        s                   like(ormloc)
010500110516     d s_wemdest       s                   like(wemdest)
010510140423     d s_wsms          s                   like(wsms)
010520160511     d sav_wemdest     s                   like(wemdest)
010530160511     d sav_wsms        s                   like(wsms)
010540130315     d wsms            s                   like(§vatstel)
010550130315     d wsmp            s                   like(§vatssmp)
010560130918     d wmmp            s                   like(§vatsmmp)
010570130918     d wmmp_ar5        s                   like(§ar5mmp)
010580110705     d s_wcupcup       s                   like(wcupcup)
010590110705     d s_wcupcig       s                   like(wcupcig)
010600110705
010610091211     d nochkticC       s               n   inz(*off)
010620110518     d wfvab           s               n   inz(*off)
010630110818     d werrxco         s               n   inz(*off)
010640111026     d RA_ncd          s                   like(vidncd)
010650111026     d RA_nca          s                   like(vidnca)
010660111026     d RA_ncl          s                   like(savncl)
010670111026     d RA_lna          s                   like(savlna)
010680111026     d wRA_lna         s                   like(blplna)
010690111026     d savtsp73        s                   like(i73tsp)
010700120606     d wstringa        s                   like(§VAT4CUP)
010710121123     d wesar4z         s              1
010720121123     d wtrasmz         s              1
010730121123     d wkscz           s                   like(§b4okc)
010740130219     d wnoZ            s              1
010750130924     d aggioAr8        s              1
010760130927     d w_emd           s              1
010770140424     d w_smp           s              1
010780131003     d n_§clipsm       s                   like(blppkb)
010790131003     d n_§clivlm       s                   like(blpvlb)
010800140110     d posl            s              2  0
010810140110     d posr            s              2  0
010820140110     d lung            s              2  0
010830141202     d lenPC           s              2  0
010840140212     d* Lunghezza di CHARNOOK deve essere:  lunghezza di tbeuni + 1
010850140212     d* Il +1 è necessario per assicurarmi che nella stringa sia sempre
010860140212     d* presente un blank
010870141202     d charnook        s            257
010880140212     d charnookf       s                   like(charnook)
010890160112     d charnooki       s                   like(charnook)
010900140403     d comgf2          s                   like(o95gf2)
010910140716     d wznbrv          s                   like(brvznc)
010920140716     d wdfs            s                   like(brvdfs)
010930140716     d whms            s                   like(brvhms)
010940140716     d wokzona         s              1
010950150202     d wLocNorm        s                   like(o95loc)
010960141202     d charPCok        s            256
010970150305     d wfiglia         s              1
010980150907     d wlv13           s              1
010990150907     d wlv13_giro2     s              1
011000151014     d PesVolpkcn      s                   Like(Taspkcn)
011010151014     d PesVolSpc       s                   Like(TasSpc)
011020151014     d PesVolIMV       s                   Like(Ar6IMV)
011030151014     d savimv_fat      s                   Like(vidimv)
011040160120     d $finef10        s              1
011050160120     d wf10            s              1
011060160126     d wf16            s              1
011070160201     d wfine           s              1
011080160223     d pkgbolla        s                   like(vidpkg)
011090160224     d w_aDpd          s              1
011100160302     d wtip            s                   like(i27tip)
011110160421     d w_VariaZnc      s              1
011120161229     d*wcadal          s                   like(§fscdal)
011130161229     d*wcaal           s                   like(§fscal)
011140161019     d w_unoI          s              1
011150161019     d w_unoJ          s              1
011151170214     d simfel_s        s                   like(simfel)
011152170214     d simpou_s        s                   like(simpou)
011153170214     d simtpp_s        s                   like(simtpp)
011154170214     d ParLnpB         s              3  0
011155170214     d s_ParLnpB       s                   like(ParLnpB)
011156170214     d wcarsimfel      s              1
011157170214
011160011211     D                SDS
011170011211     D  NOMPGM                 1     10
011180930629     D*
011190930629     D* DEFINIZIONE COSTANTI
011200930629     D*
011210990610     D CPREPA          C                   CONST('FRANCO PREPAGATO')
011220990610     D CNOSEQ          C                   CONST('NON SEQUENZIALI')
011230941011     D CULTSP          C                   CONST('ULTIMA SPEDIZIONE: ')
011240941011     D CVARIA          C                   CONST('S P E D I Z I O N E')
011250941011     D CCONFE          C                   CONST('BOLLA DA CONFERMARE')
011260941231     D CPDC            C                   CONST('su Piano dei Conti')
011270950303     D CPIVA           C                   CONST('Partita IVA:')
011280050427     D CAUT            C                   CONST('(AUT.       ) ENTER x FORZ.')
011290980115     D CMAIUS          C                   CONST('ABCDEFGHIJKLMNOPQRS-
011300980115     D                                     TUVWYXZ')
011310980115     D CMINUS          C                   CONST('abcdefghijklmnopqrs-
011320980115     D                                     tuvwyxz')
011330991214     D CDPD            C                   CONST('PARCEL DPD: ')
011340020726      * - Società chiave per tabella "YIV"
011350020725     D C_Soc           c                   const('201')
011360010209     D*
011370010209     D* CAMPO PER DSPATR "REVERSE IMAGE"        DEI CAMPI A VIDEO
011380010209     D RIMM            C                   CONST(X'21')
011390040610     D* CAMPO PER DSPATR "HI" + "UL"            DEI CAMPI A VIDEO
011400040610     D HIUL            C                   CONST(X'26')
011410040610     D* CAMPO PER DSPATR "RI" + "UL"            DEI CAMPI A VIDEO
011420040610     D RIUL            C                   CONST(X'25')
011430010209     D* CAMPO PER DSPATR "NO DISPLAY"+"PROTECT" DEI CAMPI A VIDEO
011440010209     D NDPR            C                   CONST(X'A7')
011450011122     D* CAMPO PER DSPATR "PROTECT" + "HI"       DEI CAMPI A VIDEO
011460011122     D PROT            C                   CONST(X'A2')
011470040609     D* CAMPO PER DSPATR "PROTECT" + "RI"       DEI CAMPI A VIDEO
011480040609     D PRRI            C                   CONST(X'A1')
011490010219     D* CAMPO PER DSPATR "NO DISPLAY"
011500010219     D NODI            C                   CONST(X'27')
011510070801     D* CAMPO PER DSPATR "Blinking"
011520111206     D*BLNK            C                   CONST(X'28')
011530111206     D BLNK            C                   CONST(X'2E')
011540061110     D* CAMPO PER DSPATR "UL"
011550061110     D ul              C                   CONST(X'24')
011560030304     D* CAMPO PER DSPATR "PROTECT"+ HI + UL     DEI CAMPI A VIDEO
011570030304     D PROT1           C                   CONST(X'A6')
011580030627      * testo x cliente tassazione bolle FW
011590030627     d wnotfw          c                   Const('cliente tassazione')
011600130117
011610130117      // - Tabella OSR
011620130117     d c_tabosr        c                   const('OSR')
011630080307
011640080307     D digits          c                   '0123456789'
011650130117
011660130117      // - Reperimento tabella
011670130117     d tibs02r         pr                  extpgm('TIBS02R')
011680130117     d  kpjba                              likeds(kpjba)    const
011690130117     d  dsbs02                             likeds(dsbs02)
011700140423
011710140423      // ? PROTOTIPI ?
011720140423      /copy gaitrasrc/srcprotopr,ubchkcel
011730140423      /copy gaitrasrc/srcprotopi,ubchkcel
011740130117
011750020917     IFIVAD000
011760020917     I              VADATB                      BLDATB
011770941230     I              VADCCM                      BLDCCM
011780941230     I              VADLNP                      BLDLNP
011790941230     I              VADAAS                      BLDAAS
011800941230     I              VADNRS                      BLDNRS
011810941230     I              VADNSP                      BLDNSP
011820941230     I              VADCDP                      BLDCDP
011830941230     I              VADNCL                      BLDNCL
011840941230     I              VADNCD                      BLDNCD
011850941230     I              VADNCA                      BLDNCA
011860000208     IFISGN000
011870000204     I              SGNFLS                      §LDLNP
011880000204     I              SGNDLP                      §LDDLP
011890000204     I              SGNCDP                      §LDCDP
011900000204     I              SGNNRS                      §LDNRS
011910000208     I              SGNNCD                      §LDNCD
011920000204     I              SGNLNA                      §LDLNA
011930000204     I              SGNDLA                      §LDDLA
011940000204     I              SGNTNA                      §LDTNA
011950000204     I              SGNTSP                      §LDTSP
011960000207     I              SGNZSC                      §LDZSC
011970000204     I              SGNNC1                      §LDNC1
011980000204     I              SGNNC2                      §LDNC2
011990000204     I              SGNRSM                      §LDRSM
012000000204     I              SGNPRM                      §LDPRM
012010000204     I              SGNRSD                      §LDRSD
012020000204     I              SGNCAD                      §LDCAD
012030000204     I              SGNIND                      §LDIND
012040000204     I              SGNLOD                      §LDLOD
012050000204     I              SGNPRD                      §LDPRD
012060000204     I              SGNCPD                      §LDCPD
012070000204     I              SGNNCP                      §LDNCP
012080000204     I              SGNNCU                      §LDNCU
012090050421     I              SGNRST                      §LDRST
012100000204     I              SGNVOL                      §LDVOL
012110000204     I              SGNPKG                      §LDPKG
012120000204     I              SGNFVR                      §LDFVR
012130000204     I              SGNAAS                      §LDAAS
012140000204     I              SGNMGS                      §LDMGS
012150000208     I              SGNTST                      §DETST
012160000208     I              SGNTSE                      §DETSE
012170000208     I              SGNSSE                      §DESSE
012180000208     I              SGNSIP                      §DESIP
012190000208     I              SGNSIA                      §DESIA
012200000208     I              SGNAWB                      §DEAWB
012210000208     I              SGNISA                      §DEISA
012220000208     I              SGNFCA                      §DEFCA
012230000208     I              SGNEUR                      §DEEUR
012240000208     I              SGNXX1                      §DEXX1
012250000208     I              SGNXX2                      §DEXX2
012260001005     IFISGN005
012270001005     I              SGNFLS                      §LDLNP
012280001005     I              SGNDLP                      §LDDLP
012290001005     I              SGNCDP                      §LDCDP
012300001005     I              SGNNRS                      §LDNRS
012310001005     I              SGNNCD                      §LDNCD
012320001005     I              SGNLNA                      §LDLNA
012330001005     I              SGNDLA                      §LDDLA
012340001005     I              SGNTNA                      §LDTNA
012350001005     I              SGNTSP                      §LDTSP
012360001005     I              SGNZSC                      §LDZSC
012370001005     I              SGNNC1                      §LDNC1
012380001005     I              SGNNC2                      §LDNC2
012390001005     I              SGNRSM                      §LDRSM
012400001005     I              SGNPRM                      §LDPRM
012410001005     I              SGNRSD                      §LDRSD
012420001005     I              SGNCAD                      §LDCAD
012430001005     I              SGNIND                      §LDIND
012440001005     I              SGNLOD                      §LDLOD
012450001005     I              SGNPRD                      §LDPRD
012460001005     I              SGNCPD                      §LDCPD
012470001005     I              SGNNCP                      §LDNCP
012480001005     I              SGNNCU                      §LDNCU
012490001005     I              SGNVOL                      §LDVOL
012500001005     I              SGNPKG                      §LDPKG
012510001005     I              SGNFVR                      §LDFVR
012520001005     I              SGNAAS                      §LDAAS
012530001005     I              SGNMGS                      §LDMGS
012540001005     I              SGNTST                      §DETST
012550001005     I              SGNTSE                      §DETSE
012560001005     I              SGNSSE                      §DESSE
012570001005     I              SGNSIP                      §DESIP
012580001005     I              SGNSIA                      §DESIA
012590001005     I              SGNAWB                      §DEAWB
012600001005     I              SGNISA                      §DEISA
012610001005     I              SGNFCA                      §DEFCA
012620001005     I              SGNEUR                      §DEEUR
012630001005     I              SGNXX1                      §DEXX1
012640001005     I              SGNXX2                      §DEXX2
012650930611     IAZORG01L  AA
012660000000     I/SPACE 3
012670900504     C****************************************************************
012680900504     C*  RIEPILOGO INDICATORI
012690011115     C* N.B.: IL 92,93 E 99 SONO RIUTILIZZABILI DOPO AVERLI TOLTI ANCHE
012700011115     C*       DAL FORMATO VIDEO
012710900504     C***************************************************************
012720990628     C* 01    - ON-RICERCA ANAGRAFICA ATTIVATA
012730940825     C* 02    - PROTEGGO MITTENTE IN 2 VIDEATA
012740941103     C* 03    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE ORIGINALE
012750900504     C* 04    - BOLLA ASSEGNATO
012760940920     C* 05    - ESISTE 2 BOLLA E NON E' TASSATO DESTINO
012770010222     C* 06    - POSIZIONAMENTO CURSORE SU NUMERO ORM DAL SECONDO GIRO
012780040915     C*         IN POI SE ATTIVATA PRCEDURA ORM
012790960926     C* 07    - IL PRIMO GIRO SI POSIZIONA SUL COD AUTOTRASPORTATORE
012800940928     C*         DAL 2 IN POI SUL MITTENTE
012810900507     C* 08    - TASSATO DESTINO
012820940922     C* 09    - EMETTO IL TIPO SERVIZIO IN "RI" SE DA TARIFFA
012830941004     C* 10    - EVIDENZIO IL CODICE ISO DELLA P.IVA SE IMPOSTATO DA NAZ
012840941219     C* 11    - CHANGE SU C/ASSEGNO
012850941219     C* 12    - PROVENGO DA MANUTENZIONE
012860940920     C* 13    - PROTEGGO IL CODICE OPERATORE QUANDO NON MODIFICABILE
012870991130     C*          E SE LNP DPD, *IN79=*ON, PROTEGGO RMN
012880940913     C* 14    - SPROTEGGO LA LNP CLIENTE E MI POSIZIONO
012890900824     C* 15    - PROVENGO DA CARICAMENTO BOLLE DA DISK CLIENTI
012900940825     C* 16    - IMMISS.  BOLLE - PERSONALIZ.DATA CONSEGNA RICHIESTA
012910940825     C* 17    - IMMISS.  BOLLE - PERSONALIZ.TIPO CONSEGNA RICHIESTA
012920930329     C* 18    - IMMISS.  BOLLE - PERSONALIZ.ESPRESSO
012930940825     C* 19    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE
012940930329     C* 20    - IMMISS.  BOLLE - PERSONALIZ.LINEA ARRIVO
012950930329     C* 21    - IMMISS.  BOLLE - PERSONALIZ.CODICE BOLLA
012960990630     C* 22    - PROTEZIONE DATI FATTURA E VISUAL.TOT.FATTURA PER PREPAG
012970940920     C* 23    - IMMISS.  BOLLE - PERSONALIZ.ORA  CONSEGNA RICHIESTA
012980930329     C* 24    - IMMISS.  BOLLE - PERSONALIZ.DATA SPEDIZIONE
012990940826     C* 25    - CTM PER CREAZIONE SEGNACOLLI
013000930329     C* 26    - IMMISS.  BOLLE - PERSONALIZ.COD TRATTAM MERCE
013010940825     C* 27    - IMMISS.  BOLLE - PERSONALIZ. DELLA NATURA MERCE
013020930329     C* 28    - IMMISS.  BOLLE - PERSONALIZ.COD TARIFFA MITTENTE
013030930329     C* 29    - IMMISS.  BOLLE - PERSONALIZ.IL CODICE TARIFFA
013040900508     C* 30/32 - DI COMOD RIUTILIZZABILI
013050980219     C* 33    - PROTEGGO LA DIVISA DEL C/A
013060000928     C*         IN MANUTENZIONE MI SERVE PER AGGIORNAMENTO FNBLD
013070000928     C*         IN CONFERMA DISK (DISK C EX DISK B) LO ACCENDO PER
013080000928     C*         DISABILITARE AGGIUNTA COD.CHI SONO
013090990610     C* 34    - ELABORAZIONE PER PREPAGATI
013100940926     C* 35    - SFLDSP
013110940825     C* 36    - BOLLE DISK CLI - ON -POSIZIONAMENTO CURSORE SU VOLUME
013120931123     C*       - BOLLE DISK CLI - OFF-POSIZIONAMENTO CURSORE SU SEGNACOL
013130010222     C* 37    - IMMISS.  BOLLE - PERSONALIZ.NUMERO ORM
013140941020     C* 38    - POSIZIONAMENTO CURSORE STD SE SPENTO.
013150941020     C*         SE ACCESO SIGNIFICA CHE E' STATO ATTIVATO UN ALTRO POSZ
013160960319     C* 39    - PROTEGGO LA P.IVA DEL MITTENTE
013170960319     C* 40/84 - ERRORE
013180940826     C* 44    - BOLLE DISK CLI - SE DA GIACENZE O CAMBIO PORTO
013190930330     C*          E MANUT BOLLE -   NO VARIAZIONE DEL TIPO BOLLA
013200960319     C* 71/73 - ERRORE SU CAP/NAZIONE/RAGIONE SOCIAL MITTENTE ORIGINALE
013210980219     C* 76    - PROTEZIONE DEI CAMPI TIPO INCASSO C/A SE EXPORT
013220000905     C* 77    - ERRORE SU FLAG DDT
013230000830     C* 78    - INDICATORE SFLDSP PER SFL COD."CHI SONO"
013240991130     C* 79    - PROTEZIONE DEL RIF.ALFABETICO PER BOLLE DPD E SE CODICE
013250991130     C*          OPERATORE NON MODIFICABILE, *IN13=*ON, PROTEGGO RMN
013260950303     C* 85    - IMMISS.  BOLLE - PERSONALIZ.SOLO COD CLIENTE
013270961111     C* 86    - ERRORE SULLE NOTE
013280961111     C* 87    - PROTEZIONE DELLA TASSAZIONE SE PGM RICHIAMO DA GIACENZE
013290950410     C* 88    - change su VALORE MERCE DICHIARATO
013300941219     C* 89    - change su importo da assicurare
013310941219     C* 90    - SEGNALA LA PRESENZA DI ERRORI
013320960319     C* 91    - IMMISS.  BOLLE - PERSONALIZ.I GIORNI DI CHIUSURA
013330011115     C* 92    - EVIDENZIO DIVISA IMP ASSIC SE DA MITTENTE(E NON E' IT)
013340011115     C* 93    - EVIDENZIO DIVISA C/A       SE DA DESTINAT(E NON E' IT)
013350930414     C* 94    - BOLLE DISK CLI - ABILITO CM21 X GEST. DETT.STAMPA SEGN
013360940922     C* 95    - ABILITA INSERIM.SERIE PER BOLLETTAZIONE
013370940922     C*         CLIENTI CON SERIE CHE DANNO SOLO ETICH
013380980324     C* 96    - BOLLE DISK CLI - ABILITO F22 X GEST.ESTENS. DETT.COLLI
013390940922     C* 97    - EMETTO I CAMPI RIPRESI DA TARIFFA IN "RI"
013400940922     C* 98    - BOLLE DI RECUPERO
013410011115     C* 99    - EVIDENZIO DIVISA VAL MERCE SE DA MITTENTE(E NON E' IT)
013420900504     C*****************************************************************
013430930611     C     *ENTRY        PLIST
013440930611     C                   PARM                    KPJBA
013450991007     C                   PARM                    DBLP
013460991007     C                   PARM                    DTASV
013470030610     C                   PARM                    trul90ds
013471170214     C                   PARM                    ParLnpB
013480030610      *
013490030610      * Il numero dei parametri ricevuti è testato, in caso di modifica
013500030610      *  ricercare la stringa "%PARMS"
013510020917      *
013520021002      * Controllo se p.o. gestione numerico
013530021002     C                   IF        %subst(§lpfgs:1:1) < '0' or
013540021002     C                             %subst(§lpfgs:2:1) < '0' or
013550021002     C                             %subst(§lpfgs:3:1) < '0'
013560021002     C                   clear                   §fgs              3 0
013570021002     C                   ELSE
013580021002     C                   movel     §lpfgs        §FGS
013590021002     C                   ENDIF
013600030409      * controllo le ore
013610030409     c                   IF        %subst(§lpore:1:1) < '0' or
013620030409     c                             %subst(§lpore:2:1) < '0'
013630030409     c                   Clear                   §ore
013640030409     c                   Else
013650030409     c                   Move      §lpOre        §ore
013660030409     c                   EndIf
013661170214     c
013662170214     c* Routine per impostazione del simfel e di tutto ciò che si
013663170214     c* lega a SIMFEL
013667170214     c                   exsr      sr_Simfel
013670001219     C*
013680000000     C*----------------------------------------------------*
013690930628     C* §LPFPR = 'M' VENGO DA MANUTENZIONE   : CHIUDO IN RETRN
013700930628     C* §LPFPR = 'X' VENGO DA DISK CLI       : CHIUDO IN RETRN
013710930628     C* §LPFPR = 'V' VENGO DA DISK CLI       : CHIUDO IN RETRN
013720950419     C* §LPFPR = 'W' VENGO DA DISK CLI       : CHIUDO IN RETRN
013730160627     C* §LPFPR = 'D' Richiamo batch per "Vedi Pacco DPD" : CHIUDO CON LR
013740160829     c*              valido anche per il richiamo batch per creazione
013750160829     c*              bolle F* import dpd per recuperare dal ns. cliente
013760160829     c*              le spese di dirottamento addebitateci da DPD
013770050407     C* §LPFPR = 'R' VENGO DA REC BOL DSK CLI: CHIUDO IN RETRN --> OBSOLETO
013780010213     C* §LPFPR = 'O' VENGO DA CONFERMA O.R.M.: CHIUDO IN RETRN
013790990602     C* §LPFPR = 'G' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013800941230     C* §LPFPR = 'P' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013810941230     C*              NON DEVO STAMPARE LA BOLLA
013820930628     C* §LPFPR = 'I' VENGO DA INVIO DISPOSIZ : CHIUDO CON LR
013830150302     C* §LPFPR = 'B' VENGO DA GEST. BANCALI  : CHIUDO CON LR
013840020522     C* §LPFPR = 'T' VENGO DA RITIRI ANNULLATI:CHIUDO CON LR
013850030609      *                  o da ORM commissionati
013860930707     C* §LPFPR = 'C'                           CHIUDO CON LR
013870900511     C*
013880941020     C* CODICI DI RITORNO:
013890941020     C* §LPFPR = '1'                           BOLLA ANNULLATA
013900111007     C* §LPFPR = '2'                           Richiesto annullamento VAB...
013910000517     C* §LPFPR = '3'                           CMD03
013920941020     C* §LPFPR = '4'                           CMD12
013930941020     C* §LPFPR = '5'                           TROVATI ERRORI IN CONFER
013940161129     C* §LPFPR = '6'                           uscita dopo 50 secondi
013950000627     C*
013960000627     C* §LPFLG = 'C' - EFFETTUARE SOLO CONTROLLI RESTITUENDO DBLP
013970000627     C*                AGGIORNATA
013980930707    1C     §LPFPR        IFEQ      'C'
013990930628     C     §LPFPR        OREQ      'G'
014000930628     C     §LPFPR        OREQ      'I'
014010950102     C     §LPFPR        OREQ      'P'
014020020522     C     §LPFPR        OREQ      'T'
014030150302     C     §LPFPR        OREQ      'B'
014040160627     C     §LPFPR        OREQ      'D'
014050930628     C                   SETON                                        LR
014060010103   X1C                   ENDIF
014070010103     C*
014080010103     C     *LIKE         DEFINE    §LPFPR        SAVFPR
014090010103     C                   CLEAR                   SAVFPR
014100010103    1C     §LPFPR        IFEQ      'G'
014110010103     C     §LPFPR        OREQ      'P'
014120020522     C     §LPFPR        OREQ      'T'
014130150302     C     §LPFPR        OREQ      'B'
014140160613     C     §LPFPR        OREQ      'D'
014150010103     C                   MOVEL     §LPFPR        SAVFPR
014160010103     C                   ENDIF
014170011029      * PULISCO CAMPO DI ATTRIBUTI VISUALIZZAZIONE X 'FLAG TARIFFA MITTENTE'
014180011029     C                   CLEAR                   ATRFTM
014190030911      * pulisco ds di work del numero ORM
014200030911     c                   Clear                   widorm
014210040506      * pulisco ds di work del numero bolla da dsblp
014220040506     c                   Clear                   widspe
014230091221      * pulisco campo appoggio per particolarità consegna
014240091221     c                   clear                   wvidgma
014250100604     c                   clear                   w7rRC
014260141202     c                   clear                   w7rPC
014270111007     C* Attributo di visualizzazione F16=Annull:
014280111007     c* in conferma     è da visualizzare solo se richiamata con "X" o "V"
014290111007     c* in manutenzione sempre
014300111007     c                   clear                   atrann
014310111007     c                   if        *in15 and §lpfpr<> 'V' and §lpfpr <>'X'
014320111007     c                   movel     nodi          atrann
014330111007     c                   endif
014340900509     C* PULISCO CAMPI FOR02 E FOR03
014350941115    1C     §LPFPR        IFNE      'C'
014360000829     C                   EXSR      INZ08
014370991203     C                   EXSR      INZ07
014380991203     C                   EXSR      INZ06
014390971210     C                   EXSR      INZ03
014400941011     C                   EXSR      INZ02
014410940819     C                   EXSR      INZ01
014420930628     C*  MANUTENZIONE
014430950102     C   12
014440950102     CANN15              DO
014450950102     C                   EXSR      CARBLP
014460950102     C   90              GOTO      FINE
014470950102     C                   ENDDO
014480950126     C*
014490930628     C*  CARICAMENTO BOLLE DA DISK CLI
014500900824     C   12
014510900824     CAN 15              EXSR      CARBLC
014520010301     C*  CARICAMENTO DA CONFERMA ORM PREPAGATI
014530010301     C     §LPFPR        IFEQ      'O'
014540010301     C                   EXSR      CARBLO
014550010301     C                   ENDIF
014560010209     C*
014570010209     C*  HO CARICATO LA VIDEATA: VERIFICO SE ATTIVATA PROC. O.R.M.
014580010209     C*  SE PGM RICHIAMATO DA GIACENZE O CONFERMA BOLLE LA PROCED. ORM
014590010209     C*  NON E' ATTIVATA SE P.O. EMITTENTE = 0
014600010219     C                   Z-ADD     VIDLNP        WLNPO
014610010209     C*  NEGLI ALTRI CASI FACCIO CHAIN SU ORGANIGRAMMA
014620010209     C                   EXSR      ATTORM
014630010219     C* SE SONO IN MANUTENZIONE E ORM FITTIZIO IMPOSTO NUMERO ORM A VI-
014640010219     C* DEO
014650010219     C     WORM          IFEQ      'S'
014660010219     C     *IN12         ANDEQ     *ON
014670010219     C     *IN15         ANDEQ     *OFF
014680010219     C     VIDPOE        ANDEQ     *ZEROS
014690010219     C                   Z-ADD     VIDLNP        VIDPOE
014700010219     C                   MOVE      *ALL'9'       VIDNOR
014710010219     C                   MOVE      *ALL'9'       VIDNRV
014720010219     C                   MOVEL     VIDORM        W01ORM
014730070627     C                   MOVEL     VIDORM        s_dsbl4m
014740010219     C                   ENDIF
014750010502     C* IN IMMISSIONE E NO PREPAGATO E PROCEDURA ORM ATTIVA IL FLAG
014760010502     C* MATTINO/POMERIGGIO LO LASCIO VUOTO
014770010502     C     WORM          IFEQ      'S'
014780010502     C     *IN12         ANDEQ     *OFF
014790010502     C     PARTCH        ANDNE     'P'
014800010502     C     §LPFPR        ANDNE     'O'
014810010502     C                   CLEAR                   VIDFPP
014820010502     C                   ENDIF
014830010209     C*
014840910108     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
014850910108     C*    AI CONTROLLI
014860940214     C   12
014870940214    2CAN 15§LPFPR        IFNE      'V'
014880910108     C                   GOTO      CT1TAG
014890940214    2C                   END
014900900427     C*
014910900427     C     FOR01         TAG
014920121017      * Se la data del giorno è compresa nel range dal/al per blocco immiss.
014930121017      * prepagati (tabella DGD) --> ERRORE
014940041217     c                   If        (Partch = 'P' or §LpFpr = 'O') and
014950121017     c                              dateu>= §dgdbpd and dateu<=§dgdbpa
014960121017     c****                          Dateu = §vpodip
014970041217     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
014980041217     c                             spedizioni in Porto Prepagato'
014990041217     c                   Eval      *In90 = *On
015000041217     c                   EndIf
015010940825     C* V I D E O   1
015020050119     c                   z-add     VIDORM        S_VIDORM
015030160120     c* se sono in manutenzione e sono presenti variazioni effettuate
015040160120     c* dall'arrivo devo emmettere una finestra di avviso con gestione tasto
015050160120     c* funzionale per permettere di interrogare le variazioni presenti
015060160126     c* Idem se presenti R.A.
015070160126     c                   if        *in12 and not *in15 and (
015080160126     c                             (at0fva=*blanks and wF10='S')  or
015090160126     c                             (at0fra=*blanks and wf16='S'))
015100160120     c                   eval      $finef10='0'
015110160120     c                   exsr      sr_WdwF10
015120160120     c                   clear                   wf10
015130160126     c                   clear                   wf16
015140160120     c                   endif
015150161129     c
015160161129     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
015170161129     c                   if        *in12 and not *in15
015180161129     C                   write     LS01D01
015190161129     C                   read(E)   fnls01d
015200161129     c                   else
015210161129     C                   exfmt     LS01D01
015220161129     c                   endif
015230941003     C*
015240941003     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
015250950126     C                   EXSR      OFFD01
015260161129     c
015270161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
015280161129     c                   if        %error
015290161129     C                   MOVEL     '6'           §LPFPR
015300161129     c                   goto      fine
015310161129     c                   endif
015320900427     C* CMD3 - FINE LAVORO
015330920713     C   KL
015340920713     CAN 12
015350920713     CAN 15              MOVEL     '4'           §LPFPR
015360000518     C   KC
015370000518     CAN 12
015380000518     CAN 15              MOVEL     '3'           §LPFPR
015390010308     C* IDEM SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI (IN QUESTO
015400010308     C* CASO *IN12 = OFF
015410010308     C     §LPFPR        IFEQ      'O'
015420010308     C   KL              MOVEL     '4'           §LPFPR
015430010308     C   KC              MOVEL     '3'           §LPFPR
015440010308     C   KC
015450010308     COR KL              GOTO      FINE
015460010308     C                   ENDIF
015470940825     C   KC
015480940825     COR KL
015490940825     CAN 12              GOTO      FINE
015500121017      * Se la data del giorno è nel range dal/al per blocco immissione
015510121017      * prepagati (tabella DGD) ---> ERRORE
015520050215     c                   If        (Partch = 'P' or §LpFpr = 'O') and
015530121017     c                              dateu>=§dgdbpd and dateu<=§dgdbpa
015540121017     c****                          Dateu = §vpodip
015550050215     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
015560050215     c                             spedizioni in Porto Prepagato'
015570050215     c                   Eval      *In90 = *On
015580050215     c                   goto      for01
015590050215     c                   EndIf
015600940819     C*
015610900427     C* CMD13 - PERSONALIZZAZIONE CAMPI
015620940819     C     *INKM         IFEQ      *ON
015630150722     c* per richiamo con "O" non abilito la personalizzazione che
015640150722     c* non ha senso e tra l'altro può generare errori (sul n. orm
015650150722     c* se imposto il fittizio, al ritorno in prima videata si perdono
015660150722     c* i 99999 in quanto la routine ctrorm non considera la personalizzazione
015670150722     c* per §lpfpr='O')
015680150722     c     §lpfpr        ifne      'O'
015690940819    2C                   EXSR      GESD00
015700150722     C** KC§LPFPR        IFEQ      'O'
015710150722     C**                 MOVEL     '3'           §LPFPR
015720150722     C**                 ENDIF
015730940819     C   KC              GOTO      FINE
015740040908     c* se personalizzato n. orm prima di riemettere la videata di
015750040908     c* bollettazione devo effettuare i controlli per poporre eventuali
015760040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
015770040908     c* porti allo stesso modo di quando dalla prima videata viene
015780040908     c* immesso il numero orm con la pistola (enter automatico)
015790041221     c***37              exsr      ctrd01
015800041221     c                   if        *in37 = *on
015810050119     c***                if        flgfit <> 'S' and s_v0corm <> V0corm
015820050119     c                   if        flgfit <> 'S'
015830050119     c* passo flag a ctrd01 per dire di riemettere la videata dopo aver
015840050119     c* elaborato eventuali proposte a prescindere dal fatto che vi siano
015850050119     c* dati da proporre o meno (serve per non dare errore sul n.colli blocc
015860050119     c* ando così la tastiera)
015870050119     c                   eval      wsolo_prp = '1'
015880041221     c                   exsr      ctrd01
015890041221     c                   else
015900041221     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
015910041221     c* (per uniformità: fa così anche per orm reale)
015920050117     c* Idem se orm non fittizio ma rimasto invariato
015930041221     c  n38              z-add     13            h1riga
015940041221     c  n38              z-add     20            h1colo
015950041221     c                   endif
015960041221     c                   endif
015970150722     c                   endif
015980940825     C                   GOTO      FOR01
015990940819     C                   ENDIF
016000930330     C**
016010051207     C* F16 - ANNULLAMENTO
016020111007    2C     *INKQ         IFEQ      *ON
016030111007    3c     atrann        ifeq      *blanks
016040110516     c* window per richiesta conferma
016050110516     c                   exsr      sr_geswdwconf
016060161202
016070161202     c* Se tempo max --> esco dal pgm
016080161202     c                   if        §lpfpr='6'
016090161202     c                   goto      fine
016100161202     c                   endif
016110161202     c
016120111007    4c                   select
016130111007   whc                   when      wvann='N'
016140110516     c                   goto      for01
016150111007   whc                   when      wvann='S'
016160111007     c* f16 in manutenzione --> cancello bolla da blp e file collegati
016170111007    5c                   if        *in15=*off
016180930915     C                   EXSR      ANNULL
016190111007    6C                   if        wf12 = '1' or *in90 = '1'
016200060307     c                   goto      for01
016210111007    6c                   endif
016220930915     C                   GOTO      FINE
016230111007   x5c                   else
016240111007     c* f16 in conferma --> ritorno al chiamante codice '2' per far cancellare
016250111007     c* vab e suoi collegati
016260111007     c                   eval      §lpfpr='2'
016270111007     C                   GOTO      FINE
016280111007    5c                   endif
016290111007    4c                   endsl
016300111007   x3c                   else
016310111007     c* se premuto f16 ma non è abilitato riemetto la videata
016320111007     c                   goto      for01
016330111007    3c                   endif
016340940214    2C                   END
016350010216     C**
016360051207     C* F8 - INTERROGAZIONE O.R.M.
016370010223     C     *INKH         IFEQ      *ON
016380010219     C     WORM          ANDEQ     'S'
016390010227     C     PARTCH        ANDNE     'P'
016400010220     C     VIDNOR        ANDEQ     *ZEROS
016410111122     c* se lnp import continuo a richiamare FIOR04R
016420111122     c*****              if        %lookup(vidlnp:fio)=0
016430111122     c****                         and %lookup(999:fio)=0
016440111122     c                   if        vidlnp<>prelnp
016450111122     c                   clear                   og143
016460111122     C     vidlnp        CHAIN     AZORG01L      UNIORG
016470111122     c                   if        %found(azorg01l)
016480111122     C                   MOVEL     ORGDE3        OG143
016490111122     c                   endif
016500111122     c                   eval      prelnp=vidlnp
016510111122     c                   endif
016520111122     c                   if        §ogntw='DPD' or §ogntw='EEX' or
016530111122     c                             §ogntw='FED'
016540150928     C***                CLEAR                   DSOR04
016550150928     C***                MOVEL     '1'           I04RIC
016560150928     C****               Z-ADD     VIDLNP        I04POR
016570150928     c                   clear                   fior010ds
016580150928     c                   eval      ior010ric='1'
016590150928     c                   eval      ior010por=vidlnp
016600051207     c
016610051207     c* Richiamo tnsb51r per vedere che p.o. ritiro passare
016620150929     c* non per DPD
016630150929     c                   if        *in12 and not *in15 and vidccm>0
016640150929     c                             and §ogntw<>'DPD'
016650150929     c                   clear                   tntb50ds
016660150929     C                   move      VIDCCM        b50ke2
016670051207     C*
016680150929    3C     VIDFLC        IFEQ      0
016690150929     C                   MOVEL     VIDLNP        b50ke2
016700150929     C                   ELSE
016710150929     C                   MOVEL     VIDFLC        b50ke2
016720150929    3C                   ENDIF
016730051207     c
016740150929     c                   movel     b50ke2        b50ke1
016750051207     c* controllo linea
016760150929     c                   movel     'C'           b50opz
016770150929     c                   movel     vidlnp        b50poa
016780150929     c                   call      'TNTB51R'
016790150929     c                   parm                    kpjba
016800150929     c                   parm                    tntb50ds
016810051207     c
016820150929     c                   if        b50err=' ' and b50ormreso>*zeros
016830150929     c***                movel     b50ormreso    i04por
016840150929     c                   movel     b50ormreso    ior010por
016850150929     c                   endif
016860150929     c                   endif
016870051207     c
016880150928     C***                CALL      'FIOR04R'
016890150928     C***                PARM                    KPJBA
016900150928     C***                PARM                    DSOR04
016910150928     C***  O04CM3        IFEQ      *BLANKS
016920150928     C***                Z-ADD     O04POE        VIDPOE
016930150928     C***                MOVEL     O04NSR        VIDNOR
016940150928     C***                MOVE      O04NOR        VIDNOR
016950150928     C***                Z-ADD     O04NRV        VIDNRV
016960150929     c                   call      'FIOR010R'
016970150928     c                   parm                    kpjba
016980150928     c                   parm                    fior010ds
016990150928     C     OOR010F03     IFEQ      *BLANKS
017000150928     C     OOR010F12     andeq     *BLANKS
017010150928     C     OOR010err     andeq     *BLANKS
017020150928     C                   Z-ADD     OOR010POE     VIDPOE
017030150928     C                   MOVEL     OOR010NSR     VIDNOR
017040150928     C                   MOVE      OOR010NOR     VIDNOR
017050150928     C                   Z-ADD     OOR010NRV     VIDNRV
017060050117     c                   eval      *inkh = '0'
017070050117     c                   else
017080010216     C                   GOTO      FOR01
017090050117     c                   endif
017100110419     c                   else
017110161215     c                   setoff                                       30
017120161215     c                   clear                   w001a
017130161215     c                   if        vidpdr>*zeros
017140161215     C                   TESTN                   vidpdr               30
017150161215     C                   MOVE      vidpdr        W001A
017160161215     c                   endif
017170161215     c                   if        vidpdr<=*zeros or not *in30 or
017180161215     c                             w001a<'0'
017190110419     c                   eval      *in90='1'
017200110419     c                   eval      *in56='1'
017210110419     c                   eval      vidmsg=err(210)
017220110419     c                   goto      for01
017230110419     c                   else
017240110419     c                   clear                   fior58ds
017250110419     c                   movel     vidlnp        ior58pdr
017260110419     c                   move      vidpdr        IOR58PDR
017270110419     C                   CALL      'FIOR58R'
017280110419     C                   PARM                    KPJBA
017290110419     C                   PARM                    fior58ds
017300110419     C     OOR58F03      IFEQ      *BLANKS
017310110419     C                   Z-ADD     OOR58POE      VIDPOE
017320110419     C                   MOVEL     OOR58NSR      VIDNOR
017330110419     C                   MOVE      OOR58NOR      VIDNOR
017340110419     C                   Z-ADD     OOR58NRV      VIDNRV
017350110419     c                   eval      *inkh = '0'
017360110419     c                   else
017370110419     C                   GOTO      FOR01
017380110419     c                   endif
017390110419     c                   endif
017400110419     c                   endif
017410010216     C                   ENDIF
017420010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
017430010227     C* SE NON SEMPRE VISUALIZZATO. SE NON ATTIVATA PROCEDURA ORM
017440010227     C* O SONO NEL GIRO DEI PREPAGATI MIEI RIEMETTO VIDEATA
017450010227     C   KHWORM          IFNE      'S'
017460010227     C     PARTCH        OREQ      'P'
017470010227     C                   GOTO      FOR01
017480010227     C                   ENDIF
017490930915     C*
017500910219     C* CMD21 - GESTIONE DETTAGLIO SEGNACOLLI (SOLO IN DISK CLI)
017510940214    2C   KV              DO
017520950321     C                   MOVEL     §LPCCM        PARCCM
017530991116     C                   MOVEL     §LPAAC        PARAAS
017540920204     C                   MOVEL     §LPNRS        PARNRS
017550911031     C                   MOVEL     §LPLNP        PARLNP
017560911031     C                   MOVEL     §LPLNA        PARLNA
017570911031     C                   MOVEL     §LPNSP        PARNSP
017580020917      * P.O DI GESTIONE
017590021002     C                   MOVEL     §FGS          PARFGS
017600910219     C                   MOVEL     PARAM         KPJBU
017610941230     C                   CALL      'FNLS78R'
017620910219     C                   PARM                    KPJBA
017630910219     C                   GOTO      FOR01
017640940214    2C                   END
017650990701     C* F22 - GESTIONE ESTENSIONE DETT. SEGNACOLLI (SOLO IN DISK CLI)
017660980325    2C   KW              DO
017670000904     C                   EXSR      GESD08
017680161129     c
017690161129     c                   if        §lpfpr='6'
017700161129     c                   goto      fine
017710161129     c                   endif
017720161129     c
017730980325     C                   GOTO      FOR01
017740980325    2C                   END
017750110512     c* F17-Indirizzo Email destinatario
017760150213     c***                if        *inkr=*on
017770150213     c***                if        atremd=*blanks
017780150213     c***                exsr      sr_geswdwemd
017790150213     c***                endif
017800150213     C***                GOTO      FOR01
017810150213     c***                endif
017820110705     c* F5-Riepilogo bolle da confermare
017830110519     c                   if        *inke=*on
017840110517     c                   Clear                   Fnls80ds
017850110517     c                   Movea     l1            dpog
017860110517     c                   z-add     99            d80Nsr
017870110517     c                   if        vidccm>0
017880110517     C                   MOVE      VIDCCM        d80ccm
017890110517     C     VIDFLC        IFNE      0
017900110517     C                   movel     VIDFLC        d80ccm
017910110517     C                   ELSE
017920110517     C                   movel     VIDLNP        d80ccm
017930110517     C                   ENDIF
017940110517     c                   endif
017950110517     c                   if        vidlna>*zeros
017960110517     c                   Movel     Vidlna        d80lna
017970110517     c                   else
017980110517     c                   z-add     999           d80lna
017990110517     c                   endif
018000110517     c                   call      'FNLS80R'
018010110517     c                   parm                    kpjba
018020110517     c                   parm                    fnls80ds
018030110517     C                   GOTO      FOR01
018040110517     c                   endif
018050110705     c* F19-codici CUP/CIG per tacciabilità flussi finanziari
018060110705     c                   if        *inkt=*on
018070110705     c                   if        atrcup=*blanks
018080110705     c                   exsr      sr_geswdwcup
018090110705     c                   endif
018100110705     C                   GOTO      FOR01
018110110705     c                   endif
018120150731     c* F11-Cappario
018130150731     c                   if        *inkk=*on
018140150731     C                   CLEAR                   DSSI00
018150150731     C                   MOVEL     'L01'         D00OP0
018160150731     C                   MOVEL     vidlod        D00LOC
018170150731     C                   MOVEL     blpdsp        D00DRI
018180150731     c                   movel     'S'           i30flg
018190150731     c                   movel     vidcad        i30cap
018200150731     c                   movel     vidlod        i30loc
018210150731     c                   movel     vidprd        i30prv
018220150731     c                   movel     vidnzd        i30nar
018230150731     c                   call      'TISI30R'
018240150731     C                   PARM                    KPJBA
018250150731     C                   PARM                    DSSI00
018260150731     C                   PARM                    tisi30ds
018270150731     C* Se Selezione
018280150731    5C     D00CAP        IFNE      *BLANKS
018290150731     C                   MOVEL     D00CAP        vidcad
018300150731     C                   MOVEL     D00LOC        vidlod
018310150731     C                   MOVEL     D00NAR        vidnzd
018320150731     C                   MOVEL     D00PRV        vidprd
018330150731     c                   endif
018340150731     C                   GOTO      FOR01
018350150731     c                   endif
018360940825     C*
018370971211     C* F7  - ABILITO CAMPO PER RICERCA ALFABETICA
018380941021     C   KG              SETON                                        0138
018390900427     C   KG              GOTO      FOR01
018400971211     C* F10 - ABILITO CAMPO PUNTO OPERATIVO CLIENTE
018410941020     C   KJ              SETON                                        1438
018420940921     C   KJ              GOTO      FOR01
018430900427     C* CONTROLLI FORMATO1
018440900824     C     CT1TAG        TAG
018450050119     c* imposto flag per dire se fare solo eventuali proposte da orm
018460050119     c* e poi riemettere sempre la videata o se dopo le proposte even
018470050119     c* tuali continuare coi controlli
018480050119     c* Serve perchè se sono stati personalizzati tutti i campi proponi
018490050119     c* bili il pgm emetterebbe messaggio di errore su n.colli bloccand
018500050119     c* la tastiera senza aver dato il tempo al bollettista di inserire
018510050119     c* i dati mancanti
018520050209     c* lo faccio solo se sono in immissione bolle non lo faccio in
018530050209     c* conferma bolle e in manutenzione
018540050209     c                   eval      wsolo_prp = ' '
018550050209     c                   if        s_vidorm = *zeros and *in12 = *off
018560050119     c                   eval      wsolo_prp = '1'
018570050119     c                   endif
018580010216     C                   EXSR      CTRD01
018590950126     C*
018600950126     C* CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
018610950126     C* DI ERRORE
018620950126     C     WEMFOR        IFEQ      '1'
018630010816     C                   EXSR      ESCIER
018640950126     C     §LPFPR        IFNE      '5'
018650161129     C     §LPFPR        andne     '6'
018660950127     C                   GOTO      FOR01
018670950127     C                   ELSE
018680950127     C                   GOTO      FINE
018690950126     C                   ENDIF
018700950126     C                   ENDIF
018710010215     C* RIEMETTO LA VIDEATA PER VISUALIZZARE CAMPI VIDEO DA ORM
018720010215     C     WEFORM        IFEQ      '1'
018730010215     C                   GOTO      FOR01
018740010215     C                   ENDIF
018750010214     C* ESEGUO CONTROLLI DI INCONGRUENZA CON CAMPI DELL'ORM
018760010214     C     WORM          IFEQ      'S'
018770010214     C                   EXSR      CNFOR1
018780010214     C     WEMFOR        IFEQ      '1'
018790010214     C                   EXSR      ESCIER
018800010214     C     §LPFPR        IFNE      '5'
018810161129     C     §LPFPR        andne     '6'
018820010214     C                   GOTO      FOR01
018830010214     C                   ELSE
018840010214     C                   GOTO      FINE
018850010214     C                   ENDIF
018860010214     C                   ENDIF
018870010214     C                   ENDIF
018880020122     C* SE IMMESSA LA NAZIONE EMETTO WINDOW  PER RICHIESTA CONFERMA
018890020131     c* (Se si tratta di nazione per cui è richiesta forzatura (§15FFN="S"))
018900020122     C* IN MANUTENZIONE LA EMETTO SOLO SE È DIVERSA DA QUELLA CHE C'ERA
018910020122    2C     VIDNZD        IFNE      *BLANKS
018920020131     c     DESFFN        ANDEQ     'S'
018930030707      * e se non è una bolla di recupero
018940030707     c     §3arbl        andne     'R'
018950161006     c* e se non è un disk "B"
018960161006     c                   if        §1bfg6<>'C' or §1bfg2<>'S'
018970020123     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
018980020123     c* se devo emettere la window o ritornare al chiamante con errore
018990091111     c                   move      '1'           wvidobb           1
019000020123     c                   exsr      escier
019010091111     c                   move      ' '           wvidobb
019020020123    3c     §lpfpr        ifne      '5'
019030161129    3c     §lpfpr        andne     '6'
019040020122     C* Manutenzione
019050020123    4C     *IN12         IFEQ      *ON
019060020122     C     *IN15         ANDEQ     *OFF
019070020122     C     VIDNZD        ANDNE     NZDINI
019080020122     C* Immissione
019090020122     C     *IN12         OREQ      *OFF
019100020122     c* Conferma bolle
019110020122     C     *IN15         OREQ      *ON
019120020122     C                   MOVEL     '15'          COD
019130020122     C                   MOVEL(P)  VIDNZD        KEY
019140020122     C                   EXSR      CTABEL
019150020122     C                   MOVEL     TBLUNI        DS15
019160020123     c                   eval      w01nzd = %trim(vidnzd) + '-' + §15des
019170020123     c     §lpfpr        ifne      'V'
019180020123     c                   write     ls01d01
019190020123     c                   endif
019200020124     c     forw01        tag
019210161129     c                   if        *in12 and not *in15
019220161129     C                   write     LS01W01
019230161129     C                   read(E)   fnls01d
019240161129     c                   else
019250020122     C                   EXFMT     LS01W01
019260161129     c                   endif
019270161129     c
019280161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
019290161129     c                   if        %error
019300161129     C                   MOVEL     '6'           §LPFPR
019310161129     c                   goto      fine
019320161129     c                   endif
019330020122     C* Se premuto F12 riemetto prima videata.
019340020123     C* Se pgm richiamato con "W" anzichè riemettere la prima videata ritorn
019350020123     c* l'errore al chiamante
019360020123     C   KL              goto      for01
019370020124     c  NKF              goto      forw01
019380020123    4C                   ENDIF
019390020123   x3c                   else
019400020123     c                   goto      fine
019410020123    3c                   endif
019420161006     c                   endif
019430020122    2C                   ENDIF
019440900926     C*
019450000831     C* DISK C
019460000830     C* Emetto videata per inserimento del cod. CHI SONO" se DISK C
019470020917     C* in bollettazione o se diska senza fivat
019480160226     c*    Instradamento forzato a DPD: in immissione/conferma wexdpd conterrà
019490160226     c*    blanks e va bene così perchè in questo caso la richiesta del CHI
019500160226     c*    SONO sarà da fare solo in base al flag 12 (il parcel dpd in
019510160226     c*    questi casi sarà sempre automatico a prsecindere dal flag 13)
019520050223     c* Escludo:
019530050223     C* 1) Bolle export dpd disk c se chi sono non automatico perchè in
019540050223     c*    questo caso il chi sono non viene immesso da sfl
019550050223     c* 2) Bolle import dpd sempre perchè anche in questo caso il chi sono
019560050223     c*    non viene immesso da sfl
019570000913     C  N12
019580000913     COR 12
019590000913     CAN 15§1BF12        IFEQ      'S'
019600001011     C     WEXDPD        ANDNE     'S'
019610050223     c     *in79         andeq     *off
019620001009     C     §1BF12        OREQ      'S'
019630001011     C     WEXDPD        ANDEQ     'S'
019640001009     C     §1BF13        ANDEQ     'A'
019650030321      * se non ho superato i 500 colli
019660030321If  2c                   If        v1cncl <= 500
019670000911     C     FOR09         TAG
019680010816     C* IMPOSTO CAMPI SUBFILE CONTROL
019690010816     C                   MOVE      WKSC          V8CKSC
019700010816     C                   MOVEL     VIDDMT        V8DKSC
019710000904     C                   EXSR      GESD09
019720161129
019730000914     C     *INKL         CABEQ     *ON           FOR01
019740000830     C* Controllo i dati immessi
019750000830     C                   EXSR      CTRS08
019760161129
019770000830     C     *IN90         IFEQ      *ON
019780000830     C                   EXSR      ESCIER
019790000830     C     §LPFPR        IFNE      '5'
019800000904     c* Se errore riemetto videata subfile cod.chi sono per poterla
019810000904     c* manutenzionare
019820000904     C                   EXSR      GESD08
019830000904     C   KL              GOTO      FOR01
019840000830     C                   ELSE
019850000830     C                   GOTO      FINE
019860000830     C                   ENDIF
019870000830     C                   ENDIF
019880030321   x2c                   Else
019890030321     c                   Eval      VidMsg = Err(275)
019900030321     c                   Eval      *In90 = *On
019910030321     c                   Eval      *In62 = *On
019920030321     C                   EXSR      ESCIER
019930030321     C     §LPFPR        IFNE      '5'
019940030321     C                   GOTO      FOR01
019950030321     C                   ELSE
019960030321     C                   GOTO      FINE
019970030321     C                   ENDIF
019980030321    2c                   EndIf
019990000830     C                   ENDIF
020000021120
020010021120      * Solo x FedEx richiamo di nuovo il trul27 xchè in questo momento ho anche
020020021120      * il prefisso del segnacollo che mi serve per ricerare la cartello
020030021120      * FedEx giusta
020040021120     c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED') and
020050021120     c                             (Prefisso(1) = 'FD' or Prefisso(1) = 'FM')
020060160216     c                   Clear                   Trul27Ds1
020070021120     c                   Movel     Prefisso(1)   I27Tip
020080160322     c                   eval      wtip= Prefisso(1)
020090021120     c                   Exsr      TarCar
020100021120     c                   If        Not *In12
020110021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
020120021120      * a quanto indicato in tabella "DFE"
020130021120     c                   If        O27Fie = 'N' and VidPkg > §DfePkgD
020140021120     c                   Movel     Err(264)      VidMsg
020150021120     c                   Eval      *In90 = *On
020160021120     c                   Eval      *In63 = *On
020170021120     c                   EndIf
020180021120     c                   EndIf
020190021120      * Errori
020200021120     c                   If        *In90
020210021120      * CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
020220021120      * DI ERRORE
020230021120     C                   EXSR      ESCIER
020240021120     C     §LPFPR        IFNE      '5'
020250161129     C     §LPFPR        andne     '6'
020260021120     C                   GOTO      FOR01
020270021120     C                   ELSE
020280021120     C                   GOTO      FINE
020290021120     C                   ENDIF
020300021120     c                   EndIf
020310021120     c                   EndIf
020320021120
020330011107     C* SE ATTIVATA PRCEDURA ORM E NUMERO ORM NON FITTIZIO DEVO
020340010215     C* PROPORRE I CAMPI DELLA SECONDA VIDEATA PRIMA DI EMETTERLA
020350010215     C* LO FACCIO SOLO SE NON SONO IN CONFERMA BOLLE DA DISCHETTO
020360010215     C     WORM          IFEQ      'S'
020370010215     C     FLGFIT        ANDNE     'S'
020380010215     C     PARTCH        ANDNE     'P'
020390070427     C     *IN12         IFEQ      *OFF
020400070427     C     *IN15         OREQ      *OFF
020410010215     C* in manutenzione propongo solo se variato il numero ORM
020420070427     C     WORMMD        ANDEQ     '1'
020430010215     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
020440010215     c* fine dell'immissione
020450010215     C                   EXSR      PRPOR2
020460010220     C* SE SONO IN MANUTENZIONE SEGNALO CHE POTREBBERO ESSERE VARIATI
020470010220     C* DEI DATI PRENDENDOLI DAL NUOVO N.ORM
020480010220     C   12
020490010220     CANN15WPRIMV        IFEQ      *BLANKS
020500010220     C                   SETON                                        90
020510010220     C                   MOVEL     ERR(226)      VIDMSG
020520010220     C                   MOVEL     '1'           WPRIMV            1
020530010220     C                   ENDIF
020540010215     C                   ENDIF
020550091008     c* se bolla import     porto assegnato abbinata ad orm devo proporre
020560070427     c* il mittente dell'orm nel mittente originale
020570091008     c***                if        *in79 and flgtb1='A'
020580091008     c                   if        flgtb1='A' and (§ogntw='EEX' or
020590091008     c                             §ogntw='FED' or §ogntw='DPD')
020600070427     c                   if        *in12='0' or *in15 or
020610070427     c                             (*in15='0' and (wormmd='1' or
020620070427     c                             (flgtb1='A' and flgtb1<>savtb1)))
020630070427     c                   exsr      prpor2_rmo
020640070427     c                   endif
020650070427     c                   endif
020660010215     C                   ENDIF
020670001020     C*
020680001020     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
020690001020     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
020700060113     C** 12
020710060113    2C**AN 15§LPFPR        IFNE      'V'
020720060113     C***                   GOTO      TAG02
020730060113    2C**                   END
020740040226
020750040227      * Salto il prossimo controllo se bolla con Lnp o Lna DPD
020760040227S   1c                   Select
020770040227     c                   When      *In79
020780160224     c                   When      VidDpd = 'D' or a_§OgNtw = 'DPD' or
020790160224     c                             w_aDpd='S'
020800040227     c                   Other
020810040226      * se orm con serie devo recuperare i riferimenti del mittente
020820040226      * immessi nella bolla originale legata al ritiro contestuale
020830040226      * se previsto da tabella 'OSR'
020840040227      * non forzo se bolla con Lna o Lnp DPD
020850040227if  2c                   If        wonsr > *Zeros and flgfit <> 'S' and
020860040227     c                             (d§OsrRmn = 'S' or d§OsrRma = 'S')
020870040226      * richiamo pgm x recupero dei riferimenti
020880040226     c                   Clear                   Fnls26ds
020890040227     c                   Move      wrmaas        I26Aas
020900040227     c                   Move      wrmlnp        I26Lnp
020910040227     c                   Move      wrmnrs        I26Nrs
020920040227     c                   Move      wrmnsp        I26Nsp
020930040226     c                   Call      'FNLS26R'
020940040226     c                   Parm                    Fnls26ds
020950040227if  3c                   If        O26Err = *Zeros
020960040227if  4c                   If        d§OsrRmn = 'S'
020970040227     c                   Eval      VidRmn = O26Rmn
020980040226      * proteggo il campo
020990040226     c                   Movel     Prot1         AtrRmn
021000040226     c                   Eval      wrifm = *On
021010040227    4c                   EndIf
021020040227if  4c                   If        d§OsrRma = 'S'
021030040226     c                   Eval      VidRma = O26Rma
021040040226      * proteggo il campo
021050040226     c                   Movel     Prot1         AtrRma
021060040226     c                   Eval      wrifm = *On
021070040227    4c                   EndIf
021080040227    3c                   EndIf
021090040227    2c                   EndIf
021100040227    1c                   EndSl
021110030409
021120030409      * Prima di procedere con la seconda videata devo emettere una finestra
021130030409      * se spedizione con lna FedEx o se spedizione relative ad ORM
021140030409      * commissionati da FedEx
021150030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
021160091111     c                   move      '1'           wvidobb           1
021170060113     c                   exsr      escier
021180091111     c                   move      ' '           wvidobb
021190060113    3c     §lpfpr        ifne      '5'
021200161129    3c     §lpfpr        andne     '6'
021210060113     c     §lpfpr        ifne      'V'
021220060113     c                   write     ls01d01
021230060113     c                   endif
021240091112     c                   eval      $fine='0'
021250091112     c                   Dow       $fine='0'
021260060110     c                   clear                   w02tes1
021270030409     c                   Eval      w02Tes = Rigw(1)
021280030409     c                   Eval      w02Rig1 = Rigw(3)
021290030409     c                   Eval      w02Rig2 = Rigw(4)
021300030409     c                   Eval      w02Rig3 = Rigw(5)
021310030409     c                   Eval      w02Rig4 = Rigw(6)
021320161129     c                   if        *in12 and not *in15
021330161129     C                   write     LS01W02
021340161129     C                   read(E)   fnls01d
021350161129     c                   else
021360030409     c                   Exfmt     ls01w02
021370161129     c                   endif
021380161129     c
021390161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
021400161129     c                   if        %error
021410161129     C                   MOVEL     '6'           §LPFPR
021420161129     c                   goto      fine
021430161129     c                   endif
021440161129
021450030409     c                   If        *InKl = *On
021460091112     c                   eval      $fine='1'
021470110309     c                   eval      *inkl=*off
021480030409     c                   EndIf
021490030409     c                   EndDo
021500060113   x3c                   else
021510060113     c                   goto      fine
021520060113    3c                   endif
021530030409     c                   EndIf
021540060113     c*
021550030409     c                   If        §orMic = 'F'
021560091111     c                   move      '1'           wvidobb           1
021570060113     c                   exsr      escier
021580091111     c                   move      ' '           wvidobb
021590060113    3c     §lpfpr        ifne      '5'
021600161129    3c     §lpfpr        andne     '6'
021610060113     c     §lpfpr        ifne      'V'
021620060113     c                   write     ls01d01
021630060113     c                   endif
021640091112     c                   eval      $fine='0'
021650091112     c                   Dow       $fine='0'
021660060110     c                   clear                   w02tes1
021670030409     c                   Eval      w02Tes = Rigw(2)
021680030409     c                   Eval      w02Rig1 = Rigw(7)
021690030409     c                   Eval      w02Rig2 = Rigw(4)
021700030409     c                   Eval      w02Rig3 = Rigw(8)
021710030409     c                   Clear                   w02Rig4
021720161129     c                   if        *in12 and not *in15
021730161129     C                   write     LS01W02
021740161129     C                   read(E)   fnls01d
021750161129     c                   else
021760030409     c                   Exfmt     ls01w02
021770161129     c                   endif
021780161129     c
021790161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
021800161129     c                   if        %error
021810161129     C                   MOVEL     '6'           §LPFPR
021820161129     c                   goto      fine
021830161129     c                   endif
021840161129     c
021850030409     c                   If        *InKl = *On
021860091112     c                   eval      $fine='1'
021870110309     c                   eval      *inkl=*off
021880030409     c                   EndIf
021890030409     c                   EndDo
021900060113   x3c                   else
021910060113     c                   goto      fine
021920060113    3c                   endif
021930030409     c                   EndIf
021940151015      * Prima di procedere con la seconda videata devo emettere una finestra
021950151015      * se spedizione export EEX con attraversamento doganale
021960151015     c                   if        ((wdesie='E' and viddpd=*blanks and
021970160303     c                               comlna=*zeros )
021980160224     c                              or A_§ogntw='EEX' )
021990151015     C                   MOVEL     '15'          COD
022000151015     C                   MOVEL(P)  VIDNZD        KEY
022010151015     C                   EXSR      CTABEL
022020151015     C                   MOVEL     TBLUNI        DS15
022030151015    2c                   if        §15dog<>*blanks
022040151015     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
022050151015     c* se devo emettere la window o ritornare al chiamante con errore
022060151015     c                   move      '1'           wvidobb           1
022070151015     c                   exsr      escier
022080151015     c                   move      ' '           wvidobb
022090151015    3c     §lpfpr        ifne      '5'
022100161129    3c     §lpfpr        andne     '6'
022110151015     c     §lpfpr        ifne      'V'
022120151015     c                   write     ls01d01
022130151015     c                   endif
022140151015     c                   eval      $fine='0'
022150151015    4c                   Dow       $fine='0'
022160151015     c                   clear                   w02tes
022170151015     c                   clear                   w02tes1
022180151015     c                   clear                   w02Rig2
022190151015     c                   Eval      w02rig1 = Rigw(11)
022200151015     c                   Eval      w02Rig3 = Rigw(12)
022210151015     c                   Eval      w02Rig4 = Rigw(13)
022220161129     c                   if        *in12 and not *in15
022230161129     C                   write     LS01W02
022240161129     C                   read(E)   fnls01d
022250161129     c                   else
022260151015     c                   Exfmt     ls01w02
022270161129     c                   endif
022280161129
022290161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
022300161129     c                   if        %error
022310161129     C                   MOVEL     '6'           §LPFPR
022320161129     c                   goto      fine
022330161129     c                   endif
022340161129     c
022350151015     c                   If        *InKl = *On
022360151015     c                   eval      $fine='1'
022370151015     c                   eval      *inkl=*off
022380151015     c                   EndIf
022390151015    4c                   EndDo
022400151015   x3c                   else
022410151015     c                   goto      fine
022420151015    3c                   endif
022430151015    2c                   endif
022440151015     c                   endif
022450151015      *
022460060113      * Prima di procedere con la seconda videata devo emettere una finestra
022470060113      * se spedizione in porto assegnato con destinatario con obbligo ddt in
022480060113      * fase di consegna (DDT=SI)
022490060113    2c                   If        Vidbam = 'S' and §dstddt = 'S' and
022500060113     c                             §3arbl <> 'R' and §1bf16 <> 'S' and
022510060113     c                             flgtb1 = 'A'
022520060113     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
022530060113     c* se devo emettere la window o ritornare al chiamante con errore
022540091111     c                   move      '1'           wvidobb           1
022550060113     c                   exsr      escier
022560091111     c                   move      ' '           wvidobb
022570060113    3c     §lpfpr        ifne      '5'
022580161129    3c     §lpfpr        andne     '6'
022590060113     c     §lpfpr        ifne      'V'
022600060113     c                   write     ls01d01
022610060113     c                   endif
022620091112     c                   eval      $fine='0'
022630091112    4c                   Dow       $fine='0'
022640060113     c                   clear                   w02tes
022650060113     c                   Eval      w02Tes1 = Rigw(9)
022660060113     c                   Eval      w02Rig2 = Rigw(10)
022670060113     c                   clear                   w02Rig1
022680060113     c                   clear                   w02Rig3
022690060113     c                   clear                   w02Rig4
022700161129
022710161129     c                   if        *in12 and not *in15
022720161129     C                   write     LS01W02
022730161129     C                   read(E)   fnls01d
022740161129     c                   else
022750060113     c                   Exfmt     ls01w02
022760161129     c                   endif
022770161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
022780161129     c                   if        %error
022790161129     C                   MOVEL     '6'           §LPFPR
022800161129     c                   goto      fine
022810161129     c                   endif
022820161129
022830060113     c                   If        *InKl = *On
022840091112     c                   eval      $fine='1'
022850110309     c                   eval      *inkl=*off
022860060113     c                   EndIf
022870060113    4c                   EndDo
022880060113   x3c                   else
022890060113     c                   goto      fine
022900060113    3c                   endif
022910060113    2c                   EndIf
022920090323     c
022930090323     c* tasto funzionale f15=cli/tar per tassazione porto assegnato
022940090323     c* Se la bolla non è in porto assegnato non è da visualizzare
022950090323     c                   if        flgtb1<>'A'
022960090323     c                   eval      atrf15=nodi
022970090323     c                   else
022980090323     c                   clear                   atrf15
022990090323     c                   endif
023000060113     c*
023010060113     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
023020060113     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
023030060113     C   12
023040060113    2CAN 15§LPFPR        IFNE      'V'
023050060113     C                   GOTO      TAG02
023060060113    2C                   END
023070941020     C*
023080941020     C* SE TUTTO OK EMETTO FORMATO2
023090941020     C     FOR02         TAG
023100940825     C* V I D E O   2
023110161129     c                   if        *in12 and not *in15
023120161129     C                   write     LS01D02
023130161129     C                   read(E)   fnls01d
023140161129     c                   else
023150940819     C                   EXFMT     LS01D02
023160161129     c                   endif
023170161201
023180161201     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
023190161201     c                   if        %error
023200161201     C                   MOVEL     '6'           §LPFPR
023210161201     c                   goto      fine
023220161201     c                   endif
023230941003     C*
023240900926     C     TAG02         TAG
023250950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
023260950126     C                   EXSR      OFFD02
023270161129
023280900926     C*
023290000905     C* CMD12 - RITORNO VIDEATA PRECEDENTE
023300000905     C     *INKL         IFEQ      *ON
023310000914     C* PER DISK C MANUTENZIONE RITORNO ALLA PRIMA VIDIEATA
023320000914     C* (IN QUESTO CASO INFATTI LA VIDEATA DI MANUTENZIONE COD CHI SONO
023330000914     C* DEVE ESSERE RICHIESTA CON F22 IN PRIMA VIDEATA)
023340160226
023350160226     c* Disk C da inserire in immissione/conferma no DPD
023360160226     c                   if        (§1bf12='S' and
023370160226     c                              Wexdpd<>'S' and
023380160226     c                              *in79 = *off and
023390160226     c                              (*in12 = *off or *in15))
023400160226     c                              OR
023410160226     c* Disk C da inserire in immissione/conferma Export DPD e numero parcel
023420160226     c* calcolato in automatico - (se bolla EEX da forzare in DPD WEXDPD non è
023430160226     c* a "S" - va bene così: in questo caso il chi sono non sarà mail numero
023440160226     c* parcel dpd e devo quindi trattarlo come una bolla non dpd)
023450160226     c                             (§1bf12='S' and
023460160226     c                              wexdpd='S' and
023470160226     c                              §1bf13='A' and
023480160226     c                              (*in12 = *off or *in15))
023490001009     C*
023500000905     C                   GOTO      FOR09
023510000905     C                   ELSE
023520000905     C                   GOTO      FOR01
023530000905     C                   ENDIF
023540000905     C                   ENDIF
023550010215     C* PRIMA DI FARE I CONTROLLI DELLA VIDEATA, SE ATTIATA PROC.ORM,
023560010215     C* E ORM NON FITTIZIO, PROPONGO EVENTUALI CAMPI SE A VIDEO SONO
023570010215     C* VUOTI
023580010215     C     WORM          IFEQ      'S'
023590010215     C     FLGFIT        ANDNE     'S'
023600010215     C     PARTCH        ANDNE     'P'
023610010215     C     *IN12         IFEQ      *OFF
023620010226     C     *IN15         OREQ      *OFF
023630010215     C                   EXSR      PRPOR2
023640010215     c* Se ho proposto dei campi non continuo i controlli ma devo
023650010215     c* riemettere videata per visualizzare i dati aggiunti
023660010215     C     WEFORM        IFEQ      '1'
023670010215     C                   GOTO      FOR02
023680010215     C                   ENDIF
023690010215     C                   ENDIF
023700091008     c****               if        *in79 and flgtb1='A'
023710091008     c                   if        flgtb1='A'  and (§ogntw='DPD' or
023720091008     c                             §ogntw='FED' or §ogntw='EEX')
023730070427     c                   exsr      prpor2_rmo
023740070427     C     weform        ifeq      '1'
023750070427     C                   goto      for02
023760070427     C                   endif
023770150414     c                   endif
023780010215     C                   ENDIF
023790040226
023800040226      * F11 - Calcolo volume
023810040226     c                   If        *Inkk = *On
023820040226     c                   Clear                   p26vol
023830040226     c                   Call      'TRUL36R'
023840040226     c                   Parm                    p26vol
023850040226     c                   Add       p26vol        VidVol
023860040226      * imposto wemfor per riemettere la videata
023870040301     c                   Eval      wkk = *On
023880040226     c                   EndIf
023890040226
023900900427     C* CONTROLLI
023910940825     C                   EXSR      CTRD02
023920040301
023930040301      * Se ho richiamato il calcolo del volume riemetto la videata
023940040301      * in modo da far vedere il volume calcolato in automatico
023950040301     c                   If        wkk = *On
023960040301     c                   Eval      wemfor = '1'
023970040301     c                   EndIf
023980940826     C* RIEMETTO FORMATO
023990950127     C     WEMFOR        IFEQ      '1'
024000950127     C                   EXSR      ESCIER
024010950127     C     §LPFPR        IFNE      '5'
024020161129     C     §LPFPR        andne     '6'
024030950127     C                   GOTO      FOR02
024040950127     C                   ELSE
024050950127     C                   GOTO      FINE
024060950127     C                   ENDIF
024070950127     C                   ENDIF
024080010215     C* RICHIAMO ROUTINE DI CONTROLLO INCONGRUENZA COD.TARIFFA CON
024090010306     C* O.R.M.
024100010215     C     WORM          IFEQ      'S'
024110010215     C     FLGFIT        ANDNE     'S'
024120010215     C     PARTCH        ANDNE     'P'
024130010215     C     *IN12         IFEQ      *OFF
024140010301     C     *IN15         OREQ      *OFF
024150010215     C                   EXSR      CNFOR2
024160010215     C* RIEMETTO FORMATO
024170010215     C     WEMFOR        IFEQ      '1'
024180010215     C                   EXSR      ESCIER
024190010215     C     §LPFPR        IFNE      '5'
024200161129     C     §LPFPR        andne     '6'
024210010215     C                   GOTO      FOR02
024220010215     C                   ELSE
024230010215     C                   GOTO      FINE
024240010215     C                   ENDIF
024250010215     C                   ENDIF
024260010215     C                   ENDIF
024270010215     C                   ENDIF
024280090323     c***
024290090323     C* F15=Cli/tariffa per tassazione porti assegnati
024300090323     c***
024310090323     c* emetto window solo se tasto di funzione è abilitato
024320090326     c                   if        *inkp='1'
024330090326     c                   if        atrf15=*blanks
024340090323     c                   exsr      geswdw_clitar
024350161202     c
024360161202     c                   if        §lpfpr='6'
024370161202     c                   goto      fine
024380161202     c                   endif
024390161202     c
024400090326     c                   else
024410090326     c                   movel     err(322)      vidmsg
024420090326     c                   seton                                        90
024430090326     c                   endif
024440090323     c                   goto      for02
024450090326     c                   endif
024460941115     C***
024470941115     C* CMD8 - RISTAMPA BOLLA
024480941115     C***
024490000627     C* NON POSSO FARE RISTAMPA SE SONO SOLO NEI CONTROLLI
024500000627     C     §LPFLG        IFEQ      'C'
024510000627     C     *INKH         ANDEQ     *ON
024520000627     C                   MOVEL     ERR(203)      VIDMSG
024530000627     C                   SETON                                        90
024540000627     C                   GOTO      FOR02
024550000627     C                   ENDIF
024560000627     C**
024570970128     C* POSSO RISTAMPARE SOLTANTO SE ALLEGA BAM E' S
024580970128     C*  O NO MA LA BOLLA E' GIA' STATA STAMPATA
024590000112     C  N22*INKH         IFEQ      *ON
024600970128     C     VIDBAM        IFEQ      'N'
024610970128     C     BLPFST        IFEQ      'N'
024620970128     C     BLPFST        OREQ      'S'
024630970128     C* ERRORE
024640000627     C                   MOVEL     ERR(137)      VIDMSG
024650970128     C                   SETON                                        90
024660970128     C                   GOTO      FOR02
024670970128     C                   ENDIF
024680970128     C                   ENDIF
024690970128     C*
024700970128     C                   MOVEL     '1'           CMD8              1
024710970128     C                   ENDIF
024720091111
024730091111     c*** Gestione window per scelta Beneficiario Contrassegno
024740091124     c*** per spedizione con contrassegno legata ad orm che paga ordinante
024750091124     C*** (spedizione in assegnato con triangolazione)
024760091123     c                   clear                   wwdwcas           1
024770091211     c                   if        nochkticC=*on
024780091111     c                   eval      wvidobb='1'
024790091111     c                   exsr      escier
024800091111     c                   eval      wvidobb=' '
024810091111    2c                   if        §lpfpr<>'5'
024820091111    3c                   if        *in12 and *in15 and §lpfpr<>'V'
024830091111     c                   write     ls01d02
024840091111    3c                   endif
024850091111     c                   exsr      geswdw_cas
024860091123     c                   eval      wwdwcas='S'
024870091111     c   kl              goto      for02
024880091111   x2c                   else
024890091111     c                   goto      fine
024900091111    2c                   endif
024910091119     c                   endif
024920940920     C***
024930990610     C* F9  - ESTENSIONE BOLLA
024940940920     C***       VISUALIZZA LA 2 BOLLA SE ESISTE E LA TASSAZIONE
024950940923     C* SE TASSAZIONE CON TARIFFA MITTENTE CI VADO OBBLIGATORIAMENTE
024960940923     C* SE INSERITO ALMENO UN CAMPO E POI CMD12 CI RITORNO OBBLIGATOR
024970940826    2C     *INKI         IFEQ      *ON
024980940923     C     SAVFTM        ORNE      ' '
024990950125     C     *IN04         ANDEQ     *ON
025000940923     C     VIDFTM        ORNE      ' '
025010950125     C     *IN04         ANDEQ     *ON
025020961111     C* SE FRANCO FRONTIERA DEVO OBBLIGATORIAMENTE INDICARE IL PORTO
025030961111     C     VIDFBR        OREQ      'F'
025040940923     C     WEMD03        ORNE      ' '
025050990610     C* SE PREPAGATO CI VADO OBBLIGATORIAMENTE
025060990610     C     PARTCH        OREQ      'P'
025070010305     C     §LPFPR        OREQ      'O'
025080000112     C     *IN22         OREQ      *ON
025090940826     C                   EXSR      GESD03
025100940826     C   KL              GOTO      FOR02
025110941020     C*
025120950419     C* SE E' ERRORE E PGM DA DISK CLIENTI CHIAMATO CON "W" --> ESCO
025130950127     C     §LPFPR        IFEQ      '5'
025140161202     C     §LPFPR        oreq      '6'
025150950127     C                   GOTO      FINE
025160950127     C                   ENDIF
025170940923     C*
025180940923   X2C                   ELSE
025190940923     C*
025200101104     C* SE CONTO SERVIZIO IMMISSIONE PER F6   o F8
025210101104     c                   if        not *inkf and not *inkh
025220101104    3C     WFPR          IFNE      'I'
025230940923     C     §3ARBL        ANDEQ     'C'
025240950407     C*
025250950407     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
025260950410    4C     VIDLNP        IFNE      102
025270950407     C     *IN12         OREQ      *OFF
025280950407     C     *IN15         OREQ      *OFF
025290940923     C                   MOVEL     ERR(40)       VIDMSG
025300940923     C                   SETON                                        90
025310940923     C                   GOTO      FOR02
025320950410    4C                   ENDIF
025330950410    3C                   ENDIF
025340101104     c                   endif
025350960318     C**
025360960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
025370960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
025380960805     C* NON LO FACCIO PER LE SPEDIZIONI DI RECUPERO
025390960805     C  NKF§3ARBL        IFNE      'R'
025400030704     c     wforw03       andeq     *Blanks
025410121003     C                   EXSR      CTRCRG
025420161202     c
025430161202     c                   if        §lpfpr='6'
025440161202     c                   goto      fine
025450161202     c                   endif
025460161202     c
025470121003     c   41              GoTo      For02
025480960805     C                   ENDIF
025490940923     C*
025500940923    2C                   ENDIF
025510940920     C***
025520900608     C* CMD8 - RISTAMPA BOLLA
025530940920     C***
025540970128     C     *INKH         IFEQ      *ON
025550970128     C     VIDBAM        IFEQ      'N'
025560970128     C     BLPFST        IFEQ      'N'
025570970128     C     BLPFST        OREQ      'N'
025580970128     C* ERRORE
025590970128     C                   MOVEL     ERR(137)      VIDMSG
025600970128     C                   SETON                                        90
025610970128     C                   GOTO      FOR02
025620970128     C                   ENDIF
025630970128     C                   ENDIF
025640970128     C*
025650970128     C                   MOVEL     '1'           CMD8              1
025660970128     C                   ENDIF
025670940920     C***
025680930930     C* SE VARIATA LIN.ARRIVO O DATA SPEDIZIONE DI UNA BOLLA BORDERIZZ.
025690930930     C* EMETTO IL MESSAGGIO E LA SBORDERIZZO (SONO ESCLUSI I RECUPERI)
025700161202     c* ES 02/12/16 - visto che ora borderizziamo alla chiusura FGV
025710161202     c*               lascio per sicurezza le specifiche di pulizia dei
025720161202     c*               campi di borderizzazione ma toglo l'emissione della vid
025730940214     C   12
025740940214    2CANN15§1BFG4        IFEQ      'S'
025750940920     C     BLPDBR        ANDGT     0
025760940920     C*
025770940920    3C     COMLNA        IFNE      BLPLNA
025780940920     C     BLPDSP        ORGT      BLPDBR
025790930331     C* DECODIFICA LNA
025800930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
025810940928     C  N30              MOVEL     ORGDES        V1DLNA
025820930331     C*
025830161202     C***                write     LS01D05
025840161202     C***                exfmt     fnls01d
025850161129     C*
025860940920     C                   CLEAR                   BLPNFV
025870940920     C                   CLEAR                   BLPDBR
025880940920     C                   CLEAR                   BLPFLP
025890950126     C* MEMORIZZO CHE HO SBORDERIZZATO LA BOLLA PER CANCELLARE ANCHE
025900950126     C* SUL DETTAGLIO COLLI IL NUMERO DI FOGLIO VIAGGIO
025910950126     C                   MOVEL     'S'           WSBORD            1
025920940920    3C                   ENDIF
025930940920    2C                   ENDIF
025940940920     C***
025950000627     C* SE SOLO CONTROLLI AGGIORNO LA DBLP CHE RESTITUISCO AL CHIAMANTE
025960940920     C***
025970000627     C     §LPFLG        IFEQ      'C'
025980000627     C                   EXSR      AGDBLP
025990000627     C                   ELSE
026000000627     C***
026010000627     C* REGISTRO BOLLA E STAMPO
026020000627     C***
026030900504     C                   EXSR      REGIS
026040000627     C                   ENDIF
026050000313     C*
026060000313     C* SE PGM RICHIAMATO PASSO INDIETRO IL FLAG DDT, CHE SERVE
026070000313     C* QUANDO SONO RICHIAMATO DA GIACENZE PER POI DECIDERE SE RISTAMPA
026080000313     C*  RE O MENO LA BOLLA
026090000627     C   12
026100000627     CAN 15§LPFLG        IFNE      'C'
026110000627     C                   MOVEL     VIDBAM        §LPBAM
026120000627     C                   ENDIF
026130950127     C* RIEMETTO FORMATO
026140950127     C     WEMFOR        IFEQ      '1'
026150950127     C                   EXSR      ESCIER
026160950127     C     §LPFPR        IFNE      '5'
026170950127     C                   GOTO      FOR02
026180950127     C                   ELSE
026190950127     C                   GOTO      FINE
026200950127     C                   ENDIF
026210950127     C                   ENDIF
026220900504     C*
026230900508     C* PULISCO CAMPI FOR01 E FOR02
026240940214    2C     *IN12         IFEQ      *OFF
026250010307     C     §LPFPR        ANDNE     'O'
026260940819     C                   EXSR      INZ01
026270940819     C                   EXSR      INZ02
026280941011     C                   EXSR      INZ03
026290971210     C                   EXSR      INZ06
026300991203     C                   EXSR      INZ07
026310000911     C                   EXSR      INZ08
026320040908     c* se personalizzato n. orm prima di riemettere la videata di
026330040908     c* bollettazione devo effettuare i controlli per poporre eventuali
026340040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
026350040908     c* porti allo stesso modo di quando dalla prima videata viene
026360040908     c* immesso il numero orm con la pistola (enter automatico)
026370041217     c* Non lo faccio se ORM fittizio in quanto non c'è nulla da proporre
026380041220     c                   if        *in37 = *on
026390041220     c                   if        flgfit <> 'S'
026400050119     c                   eval      wsolo_prp = '1'
026410041217     c                   exsr      ctrd01
026420041220     c                   else
026430041220     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
026440041220     c* (per uniformità: fa così anche per orm reale)
026450041220     c                   z-add     13            h1riga
026460041220     c                   z-add     20            h1colo
026470041220     c                   endif
026480041217     c                   endif
026490930628     C                   GOTO      FOR01
026500940214    2C                   END
026510930628     C*
026520000000     C     FINE          TAG
026530940214     C*
026540930628     C  N12              SETON                                        LR
026550060308     c* Chiudo con LR pgm gestione motivazione variazione ad ogni bolla per
026560060308     c* pulire la videata
026570060308     c                   clear                   fnlv85ds
026580060308     c                   eval      ilv85tla = 'C'
026590060308     c                   movel     fnlv85ds      kpjbu
026600060308     c                   call      'FNLV85R'
026610060308     c                   parm                    kpjba
026620060222     c*
026630150929     c                   if        not *inlr
026640150929     C* DISALLOCAZIONE FILES
026650150929      *
026660150929     C                   UNLOCK    FNBLP00F
026670150929     C                   UNLOCK    Fiar901L
026680150929     C                   UNLOCK    FIAR601L
026690150929     C                   UNLOCK    FIAR701L
026700150929     C                   UNLOCK    Fiar401L
026710150929     C                   UNLOCK    FNBLT01L
026720150929     C                   UNLOCK    FIARS01L
026730150929     C                   UNLOCK    FIART01L
026740150929     c                   endif
026750130419     c  nlr              return
026760940214    1C                   ENDIF
026770940214     C* CHIUDO FILES
026780941108     C     *INLR         IFEQ      *ON
026790941108     C*
026800941108     C     WCL98         IFEQ      '1'
026810940214     C                   MOVEL     'C'           D98TLA
026820970925     C                   CALL      'TNSD99R'
026830970925     C                   PARM                    DSSD99
026840940214    1C                   ENDIF
026850970722     C**
026860991102     C                   CLEAR                   DSBS02
026870991102     C                   MOVEL     'C'           T02TLA
026880991102     C                   CALL      'TIBS02R'
026890991102     C                   PARM                    KPJBA
026900991102     C                   PARM                    DSBS02
026910991102     C**
026920970722     C                   MOVEL     'C'           I13TLA
026930970722     C                   CALL      'FNLV13R'
026940970722     C                   PARM                    KPJBA
026950970722     C                   PARM                    DSLV13
026960970722     C                   PARM                    DSSI95
026970061109     C**
026980061109     C                   MOVEL     'C'           ISIE3TLA
026990061109     C                   CALL      'TISIE3R'
027000061109     C                   PARM                    TISIE3DS
027010061109     c
027020151106     C                   MOVEL     'C'           XCFIVA1ds
027030151106     C                   CALL      'XCFIVAR1'
027040151106     C                   PARM                    XCFIVA1ds
027050991130     C**
027060060619    2C     WEU12         IFEQ      'S'
027070060619     C                   MOVEL     'C'           i12TLA
027080060619     C                   CALL      'FIEU12R'
027090991130     C                   PARM                    KPJBA
027100060619     C                   PARM                    fieu12ds
027110991130    3C                   ENDIF
027120011212     C*
027130011212     C                   CLEAR                   DSUL21
027140011212     C                   MOVEL     'C'           I21TLA
027150011212     C                   CALL      'TRUL21R'
027160011212     C                   PARM                    DSUL21
027170011212     C*
027180011212     C                   CLEAR                   DSUL22
027190011212     C                   MOVEL     'C'           I22TLS
027200011212     C                   CALL      'TRUL22R'
027210011212     C                   PARM                    DSUL22
027220011212     C*
027230011212     C                   CLEAR                   DSUL23
027240011212     C                   MOVEL     'C'           I23TLA
027250011212     C                   CALL      'TRUL23R'
027260011212     C                   PARM                    DSUL23
027270941108     C*
027280941108    2C     *IN12         IFEQ      *OFF
027290941108     C     *IN15         OREQ      *ON
027300941108     C*
027310941108    3C     I100          IFEQ      1
027320941108     C                   MOVEL     '*'           DB0GES
027330941108    3C                   ENDIF
027340941108    2C                   ENDIF
027350941108     C*
027360160630     c                   if        savfpr<>'D'
027370941108     C                   MOVEL     'C'           DB0TLA
027380030611     C                   CALL      WD90PSL
027390030626     C                   PARM                    fnlsb5DS
027400160630     c                   endif
027410970925     C*
027420970925     C                   CLEAR                   DSLV55
027430970925     C                   MOVEL     'C'           D55TLA
027440970925     C                   CALL      'FNLV55R'
027450970925     C                   PARM                    DSLV55
027460000918     C*
027470000918     C                   CLEAR                   DSLSZ1
027480000918     C                   MOVEL     'C'           IZ1TLA
027490000918     C                   CALL      'FNLSZ1R'
027500010402     C                   PARM                    KPJBA
027510000918     C                   PARM                    DSLSZ1
027520000918     C                   PARM                    DS1B
027530020213     c*
027540160219     C                   CLEAR                   trul27ds1
027550020213     C                   MOVEL     'C'           I27TLA
027560160219     C                   CALL      'TRUL27R1'
027570160219     C                   PARM                    TRUL27DS1
027580020218     c*
027590160219     C                   CLEAR                   trulc7ds
027600160219     C                   MOVEL     'C'           Ic7TLA
027610160219     C                   CALL      'TRULC7R'
027620160219     C                   PARM                    TRULc7DS
027630160219
027640020218     c                   movel     'C'           tastla
027650020218     C                   CALL      'TNSF20R'
027660020218     C                   PARM                    KPJBA
027670020218     C                   PARM                    DTAS
027680020218     C                   PARM                    DTASV
027690020320     c*
027700020320     c                   clear                   trul33ds
027710020320     c                   movel     'C'           i33tla
027720020320     c                   movel     trul33ds      kpjbu
027730020320     C                   CALL      'TRUL33R'
027740020320     C                   PARM                    KPJBA
027750020531     c*
027760020531     c                   clear                   tisit0ds
027770071010     c                   clear                   tisit0x1ds
027780020531     c                   movel     'C'           it0tla
027790020531     C                   CALL      'TISIT5R'
027800020531     C                   PARM                    tisit0ds
027810071010     C                   PARM                    tisit0x1ds
027820031217
027830091006     c                   Clear                   Fnls28ds
027840091006     c                   Eval      I28Tla = 'C'
027850091006     c                   Call      'FNLS28R'
027860091006     c                   Parm                    kpjba
027870091006     c                   Parm                    Fnls28ds
027880040227
027890040227     c                   Clear                   Fnls26ds
027900040227     c                   Eval      I26Tla = 'C'
027910040227     c                   Call      'FNLS26R'
027920040227     c                   Parm                    Fnls26ds
027930061107     c*
027940061107     c                   Eval      Ideptla = 'C'
027950061107     c                   call      'TRULDEPR'
027960061107     c                   parm                    truldepds
027970061127     c* Richiamo il *pgm d utilità FIDN12R in modalità "solo chiusura"
027980061127     c                   clear                   fidn12ds
027990061127     c                   eval      dn_i12tla = 'C'
028000061127     c                   call      'FIDN12R'
028010061127     c                   parm                    fidn12ds
028020081111
028030081111     C                   MOVEL     'C'           SA2TLA
028040081111     C                   CALL      'FNLSA2R3'
028050081111     C                   PARM                    SA2TLA
028060081111     C                   PARM                    SA2TRC
028070081111     C                   PARM                    SA2DTS
028080081111     C                   PARM                    WWLNA             3 0
028090090626     c*
028100090626     c                   clear                   trulticds
028110090626     c                   eval      itictla='C'
028120090626     c                   call      'TRULTICR'
028130090626     c                   parm                    TRULTICDS
028140090626     c                   parm                    ds1a
028150120615     c*
028160120615     c                   clear                   trulflbds
028170120615     c                   eval      iflbtla='C'
028180120615     c                   call      'TRULFLBR'
028190120615     c                   parm                    TRULFLBDS
028200061107     c*
028210040329      * Chiudo Titas30c
028220040329     c                   If        %Open(Titas30c)
028230040329     c                   Close     Titas30c
028240040329     c                   EndIf
028250151014      * Chiudo fiar531c
028260151014     c                   If        %Open(fiar531c)
028270151014     c                   Close     fiar531c
028280151014     c                   EndIf
028290160613      * Chiudo FNLS01D
028300160613     c                   If        %Open(fnls01d)
028310160613     c                   Close     fnls01d
028320160613     c                   EndIf
028330150302
028340150302     c                   clear                   tisigads
028350150302     c                   movel     'C'           igatla
028360150302     c                   movel     tisigads      kpjbu
028370150302     C                   CALL      'TISIGAR'
028380150302     C                   PARM                    KPJBA
028390150701
028400150701     c                   clear                   fnlssgnds
028410150701     c                   movel     'C'           isgntla
028420150701     C                   CALL      'FNLSSGNR1'
028430150701     C                   PARM                    fnlssgnds
028440160226
028450160226     c                   clear                   fnlvdpds
028460160226     c                   movel     'C'           idptla
028470160226     c                   movel     fnlvdpds      kpjbu
028480160226     C                   CALL      'FNLVDPR'
028490160226     C                   PARM                    kpjba
028491161220
028492161220     c                   if        *in12 and *in15
028493161220     c                   clear                   fnlv84ds
028494161220     c                   movel     'C'           ilv84tla
028496161220     C                   CALL      'FNLV84R'
028497161220     C                   PARM                    fnlv84ds
028498161220     c                   endif
028500160120
028510160711     C                   IF        *in12 and not *in15 and (at0fva=*blanks or
028520160126     c                             at0fra=*blanks)
028530160120     C                   MOVEL     'C'           PA1FLG
028540160120     C                   MOVEL     PARAM1        KPJBU
028550160120     C                   CALL      'FNLR75R'                            99
028560160120     C                   PARM                    KPJBA
028570160120     c                   endif
028580941108     C*
028590941108    1C                   ENDIF
028600991008      *----------------------------------------------------------------
028610991008      *--  OPERAZIONI INIZIALI   -------------------------------------*
028620991008      *----------------------------------------------------------------
028630940819     C     *INZSR        BEGSR
028640011114     C* N.B.: QUANDO NON SI VORRÀ PIÙ STAMPARE BLANK+55L+CAP DESTINO:
028650011114     C*       ASTERISCARE    "MOVE *BLANKS   WNO55L"
028660011114     C*       DISASTERISCARE "MOVE '1'       WNO55L"
028670020725     C***                MOVE      *BLANKS       WNO55L            1
028680011126     C                   MOVE      '1'           WNO55L            1
028690030610      * MEMORIZZO STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO
028700950118     C                   MOVEL     KPJBU         PARAM3
028710030610      *
028720030610      * SE RICEVO TRUL90DS TENGO BUONO I PGM DELLA DS, in caso contrario
028730030610      *  quello della KPJBU + FNLSB0R
028740030610      * ....... modifica da togliere dopo aver eliminato TRUL01R
028750160613     C***                IF        %PARMS < 4
028760160613     C***                movel(P)  Wpgmss        WD90PSS
028770160613     C***                movel(P)  'FNLSB0R'     WD90PSL
028780160613     C***                ELSE
028790030611     C                   movel(P)  D90PSS        WD90PSS
028800030611     C                   movel(P)  D90PSL        WD90PSL
028810160613     c***                ENDIF
028820030610      *
028830011107     C     WNO55L        IFEQ      *BLANKS
028840011107     C                   MOVEL     ' 55L'        W55L
028850011107     C                   ELSE
028860011107     C                   CLEAR                   W55L
028870011107     C                   ENDIF
028880040329
028890040329      * Se sono in ambiente buono - GAITRAGRU
028900040329     c                   If        knsif = 'FILTRA201 '
028910040329     c                   Eval      wlib = 'GAITRAGRU '
028920040329      *  Se sono in ambiente di prova - GAITRAGRPS
028930040329     c                   Else
028940040329     c                   Eval      wlib = 'GAITRAGRPS'
028950040329     c                   EndIf
028960940819     C***
028970940819     C* KLIST
028980940819     C***
028990940819     C* ACCESSO   CNACO
029000940819     C     KACO          KLIST
029010940819     C                   KFLD                    CODUT
029020940819     C                   KFLD                    CCC
029030940909     C                   KFLD                    WKSC
029040990630     C     KNUM          KLIST
029050990630     C                   KFLD                    DATAAS            2 0
029060990630     C                   KFLD                    RGS               1 0
029070990630     C                   KFLD                    FIV               3 0
029080990630     C**
029090990630     C                   Z-ADD     2             RGS
029100990630     C**
029110950920     C* ACCESSO   AZCLN
029120950920     C     KCLN          KLIST
029130950920     C                   KFLD                    SIMFEL
029140950920     C                   KFLD                    W0030
029150950920     C                   KFLD                    WAA               4 0
029160950920     C                   KFLD                    WMM               2 0
029170101022     C     KCLNA         KLIST
029180101022     C                   KFLD                    w0030
029190101022     C                   KFLD                    comlna
029200101022     C                   KFLD                    WAA               4 0
029210101022     C                   KFLD                    WMM               2 0
029220940819     C* ACCESSO   TFTAM SENZA PROGRESSIVO
029230940819     C     KTAM2         KLIST
029240940909     C                   KFLD                    WKSC
029250940819     C                   KFLD                    COMCTR            3 0
029260940819     C                   KFLD                    COMPRG            3 0
029270940819     C* ACCESSO   TFTPT SENZA PROGRESSIVO
029280940819     C     KTPT          KLIST
029290940909     C                   KFLD                    WKSC
029300940819     C                   KFLD                    COMCTR            3 0
029310940819     C                   KFLD                    COMPRG            3 0
029320990818     C                   KFLD                    FTC               2
029330940819     C* ACCESSO   TFTAM TARIFFA DI CARTELLO
029340020208     c*
029350160216     C***  KCAR2         KLIST
029360160216     C**+                KFLD                    TARKSC
029370160216     C***                KFLD                    TARCTR            3 0
029380160216     C****               KFLD                    TARPRG            3 0
029390160216     C     KCAR2         KLIST
029400160216     C                   KFLD                    OC7KSCC
029410160216     C                   KFLD                    OC7CTRC
029420160219     C                   KFLD                    OC7PRGC_
029430940819     C* ACCESSO   TABEL
029440940819     C     KTAB2         KLIST
029450940819     C                   KFLD                    CODUT
029460940819     C                   KFLD                    COD               2
029470940819     C                   KFLD                    KEY               8
029480940819     C* ACCESSO   TABEL
029490940819     C     KTAB3         KLIST
029500940819     C                   KFLD                    CODUT
029510940819     C                   KFLD                    COD               2
029520170214     C*    KTBE          KLIST
029530170214     C*                  KFLD                    KTCOD
029540170214     C*                  KFLD                    KTLIN
029550170214     C*                  KFLD                    KTSIF
029560170214     C*                  KFLD                    KTKE1
029570170214     C*                  KFLD                    KTKE2
029580070612     C* ACCESSO   EDTAB
029590070612     C     KEDTAB        KLIST
029600070612     C                   KFLD                    Kedcod
029610070612     C                   KFLD                    kedkey
029620940819     C* ACCESSO   FILE DISCHETTO CLIENTI
029630940819     C     KBLC          KLIST
029640020917     C                   KFLD                    §FGS
029650020917     C                   KFLD                    §LPCCM
029660970407     C                   KFLD                    §LPAAC
029670940819     C                   KFLD                    §LPLNP
029680940819     C                   KFLD                    §LPNRS
029690940819     C                   KFLD                    §LPNSP
029700970107     C     KBLC4         KLIST
029710970407     C                   KFLD                    §LPAAC
029720970107     C                   KFLD                    §LPLNP
029730970107     C                   KFLD                    §LPNRS
029740970107     C                   KFLD                    §LPNSP
029750940819     C* ACCESSO   FILE BOLLE VISTA LOGICA 1
029760940819     C     KBLP3         KLIST
029770940819     C                   KFLD                    §LPAAS
029780940819     C                   KFLD                    §LPLNP
029790940819     C                   KFLD                    §LPNRS
029800940819     C                   KFLD                    §LPNSP
029810051124     C**   KBLP33        KLIST
029820051124     C**                 KFLD                    §LPAAS
029830051124     C**                 KFLD                    §LPLNP
029840051124     C**                 KFLD                    §LPNRS
029850051124     C**                 KFLD                    §LPNSP
029860051124     C**                 KFLD                    bltnsc
029870940926     C     KBLP4         KLIST
029880940926     C                   KFLD                    §LPAAS
029890940926     C                   KFLD                    §LPLNP
029900940926     C                   KFLD                    §LPNRS
029910940926     C                   KFLD                    §LPNSP
029920940926     C                   KFLD                    WTRC
029930041013     C     KBLP4M        KLIST
029940060215     c                   kfld                    ar4aas
029950060215     c                   kfld                    ar4lnp
029960060215     c                   kfld                    ar4nrs
029970060215     c                   kfld                    ar4nsp
029980001212     C* Usata per controllo segnacolli doppi bolle poste
029990120817     C***  KBLP1         KLIST
030000120817     C***                KFLD                    BLTAAS
030010120817     C***                KFLD                    BLTLNP
030020120817     C***                KFLD                    BLTNRS
030030120817     C***                KFLD                    BLTNSP
030040120814     C     Kfiart        KLIST
030050120814     C                   KFLD                    BLTAAS
030060120814     C                   KFLD                    BLTLNP
030070120814     C                   KFLD                    BLTNRS
030080120814     C                   KFLD                    BLTNSP
030090120814     C                   KFLD                    BLTNSC
030100120817     C***  KBLP4P        KLIST
030110120817     C***                KFLD                    BLTAAS
030120120817     C***                KFLD                    BLTLNP
030130120817     C***                KFLD                    BLTNRS
030140120817     C***                KFLD                    BLTNSP
030150120817     C***                KFLD                    WTRC
030160940819     C* KEY PER SEGNACOLLI DOPPI IN FLBLT
030170940819     C     KBLT          KLIST
030180940916     C                   KFLD                    WFLS
030190940819     C                   KFLD                    COMLNA
030200940819     C                   KFLD                    VIDNRS
030210940819     C                   KFLD                    COMSCD
030220120816     C***  KBLT29        KLIST
030230120816     C***                KFLD                    WFLS
030240120816     C***                KFLD                    VIDNRS
030250120816     C***                KFLD                    COMSCD
030260980320     C     KBLT1         KLIST
030270980320     C                   KFLD                    BLPAAS
030280980320     C                   KFLD                    BLPLNP
030290980320     C                   KFLD                    BLPNRS
030300980320     C                   KFLD                    BLPNSP
030310080103     C     KBRV          KLIST
030320960404     C                   KFLD                    KNPG
030330960404     C                   KFLD                    BLTFLS
030340960404     C                   KFLD                    BLTLNA
030350960404     C                   KFLD                    BLTNRS
030360960404     C                   KFLD                    BLTNSC
030370960404     C                   KFLD                    KFLE
030380120817     C     KBRVA         KLIST
030390120817     C                   KFLD                    KNPG
030400120817     C                   KFLD                    ARTFLS
030410120817     C                   KFLD                    ARTLNA
030420120817     C                   KFLD                    ARTNRS
030430120817     C                   KFLD                    ARTNSC
030440120817     C                   KFLD                    KFLE
030450940819     C* ACCESSO   FILE NUMERATORE
030460940819     C     KNUF          KLIST
030470940819     C                   KFLD                    AAS               2 0
030480940819     C                   KFLD                    CNU               3 0
030490940819     C                   KFLD                    COMLIN            3 0
030500940819     C     KNUF2         KLIST
030510940819     C                   KFLD                    AAS               2 0
030520940819     C                   KFLD                    CNU
030530940819     C                   KFLD                    COMLIN
030540940819     C                   KFLD                    LIV2              3 0
030550991117     C     KNUF3         KLIST
030560991117     C                   KFLD                    CNU
030570991118     C                   KFLD                    DATA6             6 0
030580000509     C     KNUFSP        KLIST
030590000509     C                   KFLD                    AAS               2 0
030600000509     C                   KFLD                    CNU               3 0
030610000509     C                   KFLD                    COMLIN            3 0
030620000509     C                   KFLD                    WNUF2             3 0
030630940819     C* PER CONTROLLO NUM DI SPEDIZIONE
030640940819     C     KNSP          KLIST
030650940916     C                   KFLD                    WAAS
030660940819     C                   KFLD                    VIDLNP
030670940819     C                   KFLD                    VIDNRS
030680940819     C                   KFLD                    RECNSP
030690940819     C     KFTT          KLIST
030700940819     C                   KFLD                    W01PDR
030710940819     C                   KFLD                    W01FVL
030720940819     C                   KFLD                    COMDRT
030730940819     C                   KFLD                    W01TSR
030740980318     C     KVAT          KLIST
030750020917     C                   KFLD                    §FGS
030760020917     C                   KFLD                    §LPCCM
030770980318     C                   KFLD                    §LPAAC
030780980318     C                   KFLD                    §LPLNP
030790980318     C                   KFLD                    §LPNRS
030800980318     C                   KFLD                    §LPNSP
030810980318     C                   KFLD                    WTRC
030820031114
030830031114     c     kVat1         Klist
030840031114     C                   Kfld                    §Fgs
030850031114     C                   Kfld                    §LpCcm
030860031114     C                   Kfld                    §LpAac
030870031114     C                   Kfld                    §LpLnp
030880031114     C                   Kfld                    §LpNrs
030890031114     C                   Kfld                    §LpNsp
030900031114
030910980320     C*
030920051102     C     KARS1         KLIST
030930980320     C                   KFLD                    BLTFLS
030940980320     C                   KFLD                    BLTLNA
030950980320     C                   KFLD                    BLTNRS
030960980320     C                   KFLD                    BLTNSC
030970980320     C                   KFLD                    WTRC
030980120817     C     KARS1A        KLIST
030990120817     C                   KFLD                    ARTFLS
031000120817     C                   KFLD                    ARTLNA
031010120817     C                   KFLD                    ARTNRS
031020120817     C                   KFLD                    ARTNSC
031030120817     C                   KFLD                    WTRC
031040051102     C     KARS1P        KLIST
031050050211     C                   KFLD                    BLpFLS
031060050211     C                   KFLD                    BLpLNA
031070050211     C                   KFLD                    BLpNRS
031080050211     C                   KFLD                    BLpNcd
031090050211     C                   KFLD                    WTRC
031100120817     C***  KARSD         KLIST
031110120817     C***                KFLD                    BLTFLS
031120120817     C***                KFLD                    BLTLNA
031130120817     C***                KFLD                    BLTNRS
031140120817     C***                KFLD                    BLTNSC
031150051102     C     KARS1K        KLIST
031160000915     C                   KFLD                    KFLSAN
031170000915     C                   KFLD                    KLNAAN
031180000915     C                   KFLD                    KNRSAN
031190000915     C                   KFLD                    KNSCAN
031200000915     C                   KFLD                    WTRC
031210051102     C     KARS01        KLIST
031220980320     C                   KFLD                    BLPFLS
031230980320     C                   KFLD                    BLPLNA
031240980320     C                   KFLD                    BLPNRS
031250980320     C                   KFLD                    WO2SCD
031260980320     C                   KFLD                    WTRC
031270051102     C     KARS2         KLIST
031290980325     C                   KFLD                    WTRC
031291170131     C                   KFLD                    W8CNOT
031300060215     C     Kar4F         KLIST
031310991217     C                   KFLD                    WTRC
031320991217     C                   KFLD                    W030A
031330060215     C     Kar4B         KLIST
031340060215     C                   KFLD                    ar4AAS
031350060215     C                   KFLD                    ar4LNP
031360060215     C                   KFLD                    ar4NRS
031370060215     C                   KFLD                    ar4NSP
031380060215     C     Kar403        KLIST
031390060215     C                   KFLD                    kar4trc
031400060215     C                   KFLD                    kar4n14
031410010116     C     KSGN          KLIST
031420010116     C                   KFLD                    COMTFP
031430010116     C                   KFLD                    KWHO
031440010116     C     KSGN8         KLIST
031450010116     C                   KFLD                    COMTFP
031460010116     C                   KFLD                    V8CNOT
031470020308     C     KSGN88        KLIST
031480020308     C                   KFLD                    COMTFP
031490020308     C                   KFLD                    W8CNOT
031500010212     C     KORM          KLIST
031510010212     C                   KFLD                    WOPOE
031520010212     C                   KFLD                    WONSR
031530010222     C                   KFLD                    WONOR2
031540010212     C                   KFLD                    WONRV
031550100319     C     KORME         KLIST
031560100319     C                   KFLD                    WOPOE
031570100319     C                   KFLD                    WONSR
031580100319     C                   KFLD                    WONOR2
031590100319     C                   KFLD                    WONRV
031600100319     C                   KFLD                    koretrc
031610010212     C     KDST          KLIST
031620120611     C                   KFLD                    ormnpg
031630120611     C                   KFLD                    ormndc
031640060522     C                   KFLD                    kfgs
031650010214     C     KFVV          KLIST
031660010214     C                   KFLD                    ORMNPG
031670010215     C                   KFLD                    W0050
031680060522     C                   KFLD                    kfgs
031690021203     C     Kfapd         klist
031700021203     C                   kfld                    kpdtip
031710021203     C                   kfld                    kpdpdr
031720021218     c     KFiar5        Klist
031730021218     c                   Kfld                    BlpAas
031740021218     c                   Kfld                    BlpLnp
031750021218     c                   Kfld                    BlpNrs
031760021218     c                   Kfld                    BlpNsp
031770021218     c                   Kfld                    KAr5Trd
031780040601     c     Kbolm         Klist
031790040601     c                   Kfld                    §lpaasm
031800040601     c                   Kfld                    §lplnpm
031810040601     c                   Kfld                    §lpNrsm
031820040601     c                   Kfld                    §lpNspm
031830130305     c     Kbolm5        Klist
031840130305     c                   Kfld                    §lpaasm
031850130305     c                   Kfld                    §lplnpm
031860130305     c                   Kfld                    §lpNrsm
031870130305     c                   Kfld                    §lpNspm
031880130305     c                   Kfld                    KAr5Trd
031890051123     c     Kanm2         Klist
031900120817     c***                Kfld                    bltfls
031910120817     c***                Kfld                    bltlna
031920120817     c***                Kfld                    bltnrs
031930120817     c***                Kfld                    bltnsc
031940120817     c                   Kfld                    artfls
031950120817     c                   Kfld                    artlna
031960120817     c                   Kfld                    artnrs
031970120817     c                   Kfld                    artnsc
031980051124     c     Kanm1         Klist
031990051125     C                   KFLD                    §LPAAS
032000051125     C                   KFLD                    §LPLNP
032010051125     C                   KFLD                    §LPNRS
032020051125     C                   KFLD                    §LPNSP
032030070601     c*
032040070601     c     kfnorf        klist
032050070601     c                   kfld                    ormpoe
032060070601     c                   kfld                    ormnsr
032070070601     c                   kfld                    ormnor
032080070601     c                   kfld                    ormnrv
032090070601     c                   kfld                    ormdfo
032100070601     c                   kfld                    ormofo
032110070601     c                   kfld                    ormfao
032120080221     c**!!!kfipdo        klist
032130080221     c**!!!              kfld                    orffgs
032140080221     c**!!!              kfld                    orfndc
032150080221     c**!!!              kfld                    orfpoe
032160080221     c**!!!              kfld                    orfnsr
032170080221     c**!!!              kfld                    orfnor
032180080221     c**!!!              kfld                    orfnrv
032190070613     c     kdpo          klist
032200070626     c                   kfld                    kdpodep
032210070626     c                   kfld                    kdpoord
032220071221
032230071221     c     Kbrv7         Klist
032240120817     c***                Kfld                    bltfls
032250120817     c***                Kfld                    comlna
032260120817     c***                Kfld                    bltnrs
032270120817     c***                Kfld                    bltnsc
032280120817     c                   Kfld                    artfls
032290120817     c                   Kfld                    comlna
032300120817     c                   Kfld                    artnrs
032310120817     c                   Kfld                    artnsc
032320140716     c     Kbrv7z        Klist
032330140716     c                   Kfld                    artfls
032340140716     c                   Kfld                    artlna
032350140716     c                   Kfld                    artnrs
032360140716     c                   Kfld                    artnsc
032370080313
032380080313     C     KTbe1         KLIST
032390080313     C                   KFLD                    k_tbecod
032400080313     C                   KFLD                    k_tbeke1
032410100323     C     Kfgi          KLIST
032420100323     C                   KFLD                    kksc
032430100323     C                   KFLD                    klnp
032440130304     C     Kblpar8       KLIST
032450130304     C                   KFLD                    ar8AAS
032460130304     C                   KFLD                    ar8LNP
032470130304     C                   KFLD                    ar8NRS
032480130304     C                   KFLD                    ar8NSP
032490130306     C     Kar8§pdf      KLIST
032500130306     C                   KFLD                    §clipdfp
032510130306     C                   KFLD                    §VATPPDFN
032520160303      * File FITGD32L
032530160125     c     K02TGD02      klist
032540160125     c                   kfld                    TGDtor
032550160125     c                   kfld                    TGDogg
032560160203     c     Ktgd01        klist
032570160203     c                   kfld                    idcant
032580160203     c                   kfld                    idcnut
032590160203     c                   kfld                    idcpdt
032600940819     C***
032610940819     C* DEFINIZIONE CAMPI
032620940819     C***
032630001031     C     *LIKE         DEFINE    BLPTFA        COMTFA
032640000508     C     *LIKE         DEFINE    DSBLD         WSBLD
032650000211     C     *LIKE         DEFINE    DSBLDE        WSBLDE
032660001002     C     *LIKE         DEFINE    DSBLD         WWBLD
032670001002     C     *LIKE         DEFINE    DSBLDE        WWBLDE
032680000211     C     *LIKE         DEFINE    DSBLD0        SAVBLD
032690000211     C     *LIKE         DEFINE    §LDDLA        WDLA
032700000208     C     *LIKE         DEFINE    SGNWHO        KWHO
032710000204     C     *LIKE         DEFINE    OG143         SAV143
032720000201     C     *LIKE         DEFINE    V7CNPR        WNPR
032730041116     C     *LIKE         DEFINE    V7CNPR        WNPRpre
032740051124     c     *LIKE         DEFINE    O14LAD        DESLAD
032750060920     c     *LIKE         DEFINE    O14red        DESred
032760080414     c**   *LIKE         DEFINE    §15cex        DEScaeex
032770080414     c**   *LIKE         DEFINE    §15cdp        DEScadpd
032780080414     c**   *LIKE         DEFINE    §15cfe        DEScafed
032790060613     C**** *LIKE         DEFINE    VIDNRD        COMNRD
032800170214     C**** *LIKE         DEFINE    TBECOD        KTCOD
032810170214     C**** *LIKE         DEFINE    TBELIN        KTLIN
032820170214     C**** *LIKE         DEFINE    TBESIF        KTSIF
032830170214     C**** *LIKE         DEFINE    TBEKE1        KTKE1
032840170214     C**** *LIKE         DEFINE    TBEKE2        KTKE2
032850000120     C     *LIKE         DEFINE    BLPDSP        WDSP
032860020102     C     *LIKE         DEFINE    §CVFDC        COMFDC
032870011113     C     *LIKE         DEFINE    §CVDEC        COMDEC
032880991028     C     *LIKE         DEFINE    O17FDC        WFDC1
032890991015     C     *LIKE         DEFINE    O17FDC        WFDC2
032900991014     C     *LIKE         DEFINE    VIDPOR        MEMPOR
032910991012     C     *LIKE         DEFINE    VI2VA1        VA2VA1
032920991011     C     *LIKE         DEFINE    AR6DIV        WDIV1
032930991011     C     *LIKE         DEFINE    AR6DIV        WDIV2
032940990701     C     *LIKE         DEFINE    VIDNFT        SAVNFT
032950990701     C     *LIKE         DEFINE    VIDIMV        SAVIMV
032960060208     C     *LIKE         DEFINE    VIDIMV        SAVIMVO
032970990630     C     *LIKE         DEFINE    O95CZC        WCZC
032980980211     C     *LIKE         DEFINE    O95CZO        WCZO
032990980211     C     *LIKE         DEFINE    VIDLNP        BLCLNP
033000971216     C     *LIKE         DEFINE    BLPNCA        STANCA
033010971215     C     *LIKE         DEFINE    V6CAWB        SAVAWB
033020050228     C     *LIKE         DEFINE    V7CNPR        SAVNPR
033030061003     C***  *LIKE         DEFINE    §b4fnp        SAVfnp
033040060620     C     *LIKE         DEFINE    §b4krt        SAVkrt
033050060619     C***  *LIKE         DEFINE    vidrmn        savrmn
033060941104     C*  MI IMPOSTO IL FLAG I/E DELLE TARIFFE DA CARICARE
033070941104     C     *LIKE         DEFINE    TAMFIE        WFIE
033080941107     C* FLAG SALVATO DA MANUTENZIONE BOLLE
033090941117     C     *LIKE         DEFINE    TAMFIE        SAVFIE
033100020122     C     *LIKE         DEFINE    BLPNZD        NZDINI
033110061124     C     *LIKE         DEFINE    BLPNZD        savnzd
033120941107     C* =S CLIENTE CON TARIFFE VALIDE
033130050921     C     *LIKE         DEFINE    olv59tks      WTKS
033140980701     C* CAMPI DELLA PARAM PER RICERCA ALFABETICA
033150940928     C     *LIKE         DEFINE    ACOKCC        PAXCCC
033160940928     C     *LIKE         DEFINE    ACORAG        PAXDMT
033170940928     C     *LIKE         DEFINE    ACOKCC        CCC
033180940928     C* SALVO IL MITTENTE PER IL QUALE HO CARICATO LE TARIFFE: SE MODIF
033190940928     C*  RICARICO LE TARIFFE
033200940928     C     *LIKE         DEFINE    BLPKSC        SAVCCM
033210940928     C* SE MODIFICATO IL CODICE TARIFFA EMETTO I CAMPI PRESI DA TARIFFA
033220940928     C*  IN "RI"
033230940928     C     *LIKE         DEFINE    VIDCTR        SAVCTR
033240950504     C     *LIKE         DEFINE    VIDCTM        SAVCTM
033250941219     C     *LIKE         DEFINE    VIDVCA        VARVCA
033260941219     C     *LIKE         DEFINE    VIDVAS        VARVAS
033270941219     C     *LIKE         DEFINE    VIDVAD        VARVAD
033280970702     C     *LIKE         DEFINE    VIDLOD        VARLOD
033290970704     C     *LIKE         DEFINE    VIDLOM        VARLOM
033300940928     C*
033310940928     C     *LIKE         DEFINE    §15VLT        MITVLT
033320940922     C     *LIKE         DEFINE    §15VLT        DESVLT
033330940928     C     *LIKE         DEFINE    §15EFT        DESEFT
033340000321     C     *LIKE         DEFINE    §15EFD        DESEFD
033350020130     C     *LIKE         DEFINE    §15EFD        DESEFf
033360020131     C     *LIKE         DEFINE    §15ffn        DESffn
033370971215     C     *LIKE         DEFINE    §15COD        DESCOD
033380940922     C     *LIKE         DEFINE    BLDFST        SAVFST
033390950717     C     *LIKE         DEFINE    BLDNCD        WNCD
033400950321     C     *LIKE         DEFINE    BLPCCM        SAVMIT
033410000426     C     *LIKE         DEFINE    VARNCL        SA2NCL
033420000426     C     *LIKE         DEFINE    VARCDP        SA2CDP
033430940819     C     *LIKE         DEFINE    TBLKUT        §KUT
033440940819     C     *LIKE         DEFINE    TBLCOD        §COD
033450940819     C     *LIKE         DEFINE    TBLKEY        §KEY
033460940819     C     *LIKE         DEFINE    VIDINM        VI2INM
033470940819     C     *LIKE         DEFINE    VIDCAM        VI2CAM
033480940819     C     *LIKE         DEFINE    VIDPIM        VI2PIM
033490120817     C     *LIKE         DEFINE    ARTNSC        WNSC
033500940926     C     *LIKE         DEFINE    BLPAAS        WAAS
033510940926     C     *LIKE         DEFINE    BLPFIN        WFIN
033520940916     C     *LIKE         DEFINE    BLPFLS        WFLS
033530060216     C     *LIKE         DEFINE    ar4TRC        WTRC
033540060215     C     *LIKE         DEFINE    ar4TRC        kar4trc
033550060215     C     *LIKE         DEFINE    ar4n14        kar4n14
033560991006     C     *LIKE         DEFINE    AR6SV1        WSV1
033570991027     C     *LIKE         DEFINE    AR6VA1        WVA1
033580991027     C     *LIKE         DEFINE    AR6SV1        WSV2
033590991027     C     *LIKE         DEFINE    AR6VA1        WVA2
033600991027     C     *LIKE         DEFINE    AR6SV1        WSV3
033610991027     C     *LIKE         DEFINE    AR6VA1        WVA3
033620991027     C     *LIKE         DEFINE    AR6SV1        WSVN
033630991027     C     *LIKE         DEFINE    AR6VA1        WVAN
033640941021     C     *LIKE         DEFINE    §CCCEI        WEV1
033650950123     C     *LIKE         DEFINE    VIDRSD        SAVRSD
033660070404     C     *LIKE         DEFINE    VIDind        SAVind
033670070404     C     *LIKE         DEFINE    VIDprd        SAVprd
033680070404     C     *LIKE         DEFINE    VIDlod        SAVlod
033690010302     C     *LIKE         DEFINE    §LDCDP        SAVCDP
033700940930     C* CONTROLLO SE MODIFICATO CAP MITT E DESTIN PER RICONTROLLARE
033710940930     C     *LIKE         DEFINE    BLPCAD        VARCAD
033720940930     C     *LIKE         DEFINE    BLPCAM        VARCAM
033730940930     C     *LIKE         DEFINE    BLPCAM        VARCMO
033740950102     C     *LIKE         DEFINE    BLPQFT        VARQFT
033750940922     C* SALVO DA TARIFFA PER VEDERE COSA MEMORIZZARE SU COLLO
033760940922     C     *LIKE         DEFINE    BLPTSP        COMTSP
033770940922     C* SALVATO IN MANUTENZIONE PER VEDERE SE RISTAMPARE SEGNACOLLO
033780100209     C     *LIKE         DEFINE    BLPTSP        SA2TSP
033790100209     C     *LIKE         DEFINE    BLPTSP        SAVTSP
033800940819     C     *LIKE         DEFINE    BLPCAD        SAVCAD
033810050421     C     *LIKE         DEFINE    vidbva        SAVbva
033820940922     C     *LIKE         DEFINE    BLPRMA        SAVRMA
033830940819     C     *LIKE         DEFINE    BLPFTM        SAVFTM
033840961111     C     *LIKE         DEFINE    BLPFBR        SAVFBR
033850961122     C     *LIKE         DEFINE    BLPCBO        SAVCBO
033860970404     C     *LIKE         DEFINE    VIDBAM        SAVBAM
033870940922     C* CAMPI USATI NELLE ROUTINE DI CONTROLLO, UNICHE PER
033880960319     C*  VIDEATA PERSONALIZZAZIONE E 1 VIDEATA
033890960319     C     *LIKE         DEFINE    VIDGC1        WGC1
033900960319     C     *LIKE         DEFINE    VIDGC2        WGC2
033910960319     C     *LIKE         DEFINE    VIDTSP        WTSP
033920940928     C     *LIKE         DEFINE    VIDNZM        WNAR
033930941103     C     *LIKE         DEFINE    VIDCMO        WCMO
033940941103     C     *LIKE         DEFINE    VIDRMO        WRMO
033950940824     C     *LIKE         DEFINE    VIDLNA        WLNA
033960940824     C     *LIKE         DEFINE    VIDPDR        WPDR
033970940824     C     *LIKE         DEFINE    VIDCBO        WCBO
033980940824     C     *LIKE         DEFINE    VIDLNP        WLNP
033990940825     C     *LIKE         DEFINE    VIDFTM        WFTM
034000940825     C     *LIKE         DEFINE    VIDCCM        WCCM
034010940928     C     *LIKE         DEFINE    VIDCCM        WCCMS
034020940921     C     *LIKE         DEFINE    VIDFLC        WFLC
034030940922     C     *LIKE         DEFINE    COD           WCOD
034040940922     C     *LIKE         DEFINE    VIDVAS        WVLT
034050940928     C     *LIKE         DEFINE    VIDCTM        WCTM
034060940923     C     *LIKE         DEFINE    VIDIMV        COMIMV
034070940921     C     *LIKE         DEFINE    VIDCCM        SAVFLC
034080940928     C     *LIKE         DEFINE    VIDPDR        SAVPDR
034090990915     C     *LIKE         DEFINE    VIDPDR        SAVPD4
034100940819     C     *LIKE         DEFINE    VIDNCL        SAVNCL
034110940819     C     *LIKE         DEFINE    VIDFFD        VARFFD
034120010214     C     *LIKE         DEFINE    VIDFFD        COMFFD
034130011211     C     *LIKE         DEFINE    VIDIAS        VARIAS
034140011211     C     *LIKE         DEFINE    VIDIAS        WARIAS
034150011212     C     *LIKE         DEFINE    VIDCAS        WARCAS
034160011212     C     *LIKE         DEFINE    VIDVMD        WARVMD
034170940819     C     *LIKE         DEFINE    VIDVOL        VARVOL
034180980402     C     *LIKE         DEFINE    VIDVOL        SAVVOL
034190940819     C     *LIKE         DEFINE    VIDVOL        VA2VOL
034200940819     C     *LIKE         DEFINE    VIDPKG        VARPKG
034210980402     C     *LIKE         DEFINE    VIDPKG        SAVPKG
034220020531     C     *LIKE         DEFINE    VIDtc1        VARtc1
034230020531     C     *LIKE         DEFINE    VIDtc2        VARtc2
034240060110     C     *LIKE         DEFINE    VIDrsd        D_VARrsd
034250060110     C     *LIKE         DEFINE    VIDind        D_VARind
034260060110     C     *LIKE         DEFINE    VIDlod        D_VARlod
034270060110     C     *LIKE         DEFINE    VIDprd        D_VARprd
034280060110     C     *LIKE         DEFINE    VIDnzd        D_VARnzd
034290940819     C     *LIKE         DEFINE    VIDZNC        VARZNC
034300940819     C     *LIKE         DEFINE    VIDZNC        SAVZNC
034310940819     C     *LIKE         DEFINE    VIDPRD        VARPRD
034320940819     C     *LIKE         DEFINE    VIDDSP        SAVDSP
034330940819     C     *LIKE         DEFINE    VIDFAP        COMFAP
034340940919     C     *LIKE         DEFINE    VIDFIN        COMFIN
034350940819     C     *LIKE         DEFINE    VIDDRT        SAVDRT
034360940928     C     *LIKE         DEFINE    VIDDCR        WDCR
034370940913     C     *LIKE         DEFINE    VIDHCR        WHCR
034380940913     C     *LIKE         DEFINE    VIDMCR        WMCR
034390940913     C     *LIKE         DEFINE    VIDTCR        WTCR
034400941011     C     *LIKE         DEFINE    VIDLNA        SAVLNA
034410941011     C     *LIKE         DEFINE    BLPLNP        SAVLNP
034420940824     C     *LIKE         DEFINE    BLPLNA        COMLNA
034430940824     C     *LIKE         DEFINE    BLPLNA        CO2LNA
034440940819     C     *LIKE         DEFINE    BLPCTM        COMCTM
034450940819     C     *LIKE         DEFINE    BLPDRT        COMDRT
034460991006     C     *LIKE         DEFINE    AR6DFT        COMDFT
034470060208     C     *LIKE         DEFINE    AR6DFT        dftar6
034480940819     C     *LIKE         DEFINE    FTTPDR        W01PDR
034490940819     C     *LIKE         DEFINE    FTTTSR        W01TSR
034500940819     C     *LIKE         DEFINE    FTTFVL        W01FVL
034510941005     C* CAMPI DI CONFRONTO PER RICARICARE IL CODICE TARIFFA MITTENTE
034520941005     C     *LIKE         DEFINE    VIDTSP        VARTSP
034530960404     C     *LIKE         DEFINE    BRVFLE        KFLE
034540960404     C     *LIKE         DEFINE    BRVNPG        KNPG
034550960805     C* CAMPI che non devono essere modificati
034560960805     C     *LIKE         DEFINE    VIDNCD        WNSNCD
034570960805     C     *LIKE         DEFINE    VIDNCA        WNSNCA
034580960927     C*
034590980318     C     *LIKE         DEFINE    BLPCAD        WCAD
034600980320     C     *LIKE         DEFINE    BLPCAD        WRKCAD
034610980320     C     *LIKE         DEFINE    BLPNCA        SAVNCA
034620980320     C     *LIKE         DEFINE    BLPNCD        SAVNCD
034630980403     C     *LIKE         DEFINE    BLPNCD        SV1NCD
034640000830     C     *LIKE         DEFINE    V8CNBR        WNBR
034650000908     C     *LIKE         DEFINE    IZ1CH1        CHIDAL
034660000908     C     *LIKE         DEFINE    IZ1CH2        CHIAL
034670000911     C     *LIKE         DEFINE    V8CNBR        NR8
034680000911     C     *LIKE         DEFINE    V8ZMSG        W08MSG
034690000918     C     *LIKE         DEFINE    NR8           SAVNR8
034700001205     C     *LIKE         DEFINE    BLPTC1        SAVTC1
034710001205     C     *LIKE         DEFINE    BLPTC2        SAVTC2
034720140122     C***  *LIKE         DEFINE    BLPTC1        WTCP
034730140122     C***  *LIKE         DEFINE    BLPTC1        WSVTCP
034740010215     C* CAMPI PER O.R.M.
034750010215     C     *LIKE         DEFINE    VIDPDR        PREPDR
034760010215     C     *LIKE         DEFINE    VIDPDR        WDPDR
034770010215     C     *LIKE         DEFINE    VIDDRT        PREDRT
034780010215     C     *LIKE         DEFINE    VIDFPP        PREFPP
034790010215     C     *LIKE         DEFINE    ORMKSC        PRECCM
034800010215     C     *LIKE         DEFINE    VIDCTR        PRECTR
034810010215     C     *LIKE         DEFINE    VIDFFD        PREFFD
034820010305     C     *LIKE         DEFINE    V1CNCL        PRENCL
034830010305     C     *LIKE         DEFINE    VIDPKG        PREPKG
034840010215     C     *LIKE         DEFINE    VIDORM        W01ORM
034850010215     C     *LIKE         DEFINE    V0CLNP        WOLNP
034860010215     C     *LIKE         DEFINE    ORMKSC        WOCCM
034870010219     C     *LIKE         DEFINE    WLNP          WLNPO
034880010220     C     *LIKE         DEFINE    ORMFAO        PREFAO
034890010313     C     *LIKE         DEFINE    BLDNCD        WNCOL
034900010313     C     *LIKE         DEFINE    BLDNCD        WNCOA
034910011108     C*
034920011212     C     *LIKE         DEFINE    §CVDEC        DECCN
034930011212     C     *LIKE         DEFINE    O21FCA        FCASAV
034940011212     C     *LIKE         DEFINE    §GEIMF        IMFGEI
034950011205     C     *LIKE         DEFINE    §ORMFD        SORMFD
034960011212     C     *LIKE         DEFINE    IEDNUM        WNUMED
034970020211     C     *LIKE         DEFINE    tamksc        tarksc
034980020215     C     *LIKE         DEFINE    §ogntw        savntw
034990050114     C     *LIKE         DEFINE    §lpxco        wxco
035000940819     C***
035010940819     C* CAMPI CHE INIZIALIZZO SOLO ALL'ENTRATA DEL PROGRAMMA E BASTA
035020940819     C***
035030940819     C                   CLEAR                   VIDSOP
035040940819     C                   CLEAR                   VIDDRT
035050000104     C                   CLEAR                   WBDSP
035060990603     C* PER TIPO CHIAMATA PREPAGATO, NON IMPOSTO IL PADORNCINO
035070010301     C* NON LO IMPOSTO NEMMENO PER CHIAMATA DA CONFERMA ORM PREPAGATI
035080010301     C* DI ALTRO P.O.
035090990603     C     PARTCH        IFNE      'P'
035100010301     C     §LPFPR        ANDNE     'O'
035110941021     C                   MOVEL     '?   '        VIDPDR
035120990628     C                   MOVEL     'P'           VIDFPP
035130990603     C                   ENDIF
035140940819     C                   CLEAR                   VIDNRT
035150940819     C                   CLEAR                   VIDLNP
035160961016     C                   CLEAR                   PAXFLR
035170010212     C                   CLEAR                   VIDPOE
035180010212     C                   CLEAR                   VIDNOR
035190010212     C                   CLEAR                   VIDNRV
035200010212     C                   CLEAR                   W01ORM
035210941107     C**
035211170216     c* ATTENZIONE: in caso di sostituzione dell' X§PARUT con il TIBS34R
035212170216     c* non bisogna aggiornare l'area dati utente in quanto questo pgm,
035213170216     c* se richiesto dal chiamante, modifica il campi SIMFEL/SIMPOU/SIMTPP
035214170216     c* ma tale modifica deve valere solo in bollettazione.
035220930628     C                   Z-ADD     1             CODUT
035230930628     C                   CALL      'X§PARUT'
035240930628     C                   PARM                    UT§DSE
035250940819     C                   MOVEL     RAGUT         VIDDSA
035260930628     C                   MOVEL     REC80         CNCR80
035261170214     c* mi salvo simfel/simpou/simtpp nel caso il pgm sia richiamato per
035262170214     c* la bollettazione in altro terminal di partenza
035263170214     c                   eval      simfel_s=simfel
035264170214     c                   eval      simpou_s=simpou
035265170214     c                   eval      simtpp_s=simtpp
035266170214     c                   eval      wcarsimfel=' '
035267170214     c                   clear                   s_ParLnpB
035270930628     C*--- RICERCA CAPOCONTI
035280930628     C                   DO        50            X                 2 0
035290930628     C                   MOVE      TCU(X)        TCUDS
035300930628     C     F56           CABNE     'CG'          END1
035310930628     C     F4            COMP      '1'                                    21
035320930628     C     F4            COMP      '2'                                    22
035330930628     C     F4            COMP      '3'                                    23
035340930628     C     F4            COMP      '6'                                    27
035350930628     C** 1 CLIENTI   21
035360930628     C** 2 FORNITORI 22
035370930628     C** 3 AGENTI    23
035380930628     C     F3            COMP      '0'                                242425
035390930628     C     F3            COMP      'I'                                    26
035400930628     C** 0 ITALIA   25
035410930628     C** 1 ESTERO   24
035420930628     ** I CAPO CONTO IVA
035430930628     C   21
035440930628     CAN 24              Z-ADD     KCU(X)        KCE               4 0
035450930628     C   21
035460930628     CAN 25              Z-ADD     KCU(X)        KCI               4 0
035470930628     C   22
035480930628     CAN 24              Z-ADD     KCU(X)        KFE               4 0
035490930628     C   22
035500930628     CAN 25              Z-ADD     KCU(X)        KFI               4 0
035510930628     C   23
035520930628     CAN 24              Z-ADD     KCU(X)        KAE               4 0
035530930628     C   23
035540930628     CAN 25              Z-ADD     KCU(X)        KAI               4 0
035550930628     C   26              Z-ADD     KCU(X)        KIVA              4 0
035560930628     C   27              Z-ADD     KCU(X)        KBNA              4 0
035570930628     C     END1          TAG
035580930628     C                   END
035590940614     C                   SETOFF                                       212223
035600940614     C                   SETOFF                                       242526
035610940614     C                   SETOFF                                       27
035620991214     C                   CLEAR                   DSBLP0
035630950920     C***
035640950920     C* CARICO DATI VARIABILI PARTENZE
035650950920     C***
035660950920     C                   MOVEL     '3I'          COD
035670950920     C                   MOVEL     '1       '    KEY
035680950920     C                   EXSR      CTABEL
035690950920     C  N30              MOVEL     TBLUNI        DS3I
035700950920     C   30              CLEAR                   DS3I
035710991213     C***
035720991213     C* CARICO TABELLA DPD
035730991213     C***
035740991213     C                   MOVEL     '3I'          COD
035750991213     C                   MOVEL(P)  'DPD'         KEY
035760991213     C*
035770991213     C                   EXSR      CTABEL
035780991213     C  N30              MOVEL     TBLUNI        DS3IDP
035790991213     C   30              CLEAR                   DS3IDP
035800000509     C***
035810000509     C* CARICO TABELLA POSTE
035820000509     C***
035830000509     C                   MOVEL     '3I'          COD
035840000509     C                   MOVEL(P)  'POSTE'       KEY
035850000509     C*
035860000509     C                   EXSR      CTABEL
035870000509     C  N30              MOVEL     TBLUNI        DS3IPT
035880000509     C   30              CLEAR                   DS3IPT
035890971211     C***
035900971211     C* CARICO CODICI CLIENTI SDI PER I QUALI INSERISCO OBBLIGATORIAM
035910971211     C*  NUMERO AWB CON CONTROLLO CHECK DIGIT
035920971211     C***
035930971211     C                   MOVEL     '3I'          COD
035940971211     C                   MOVEL     'E       '    KEY
035950971211     C                   EXSR      CTABEL
035960971211     C  N30              MOVEA     TBLUNI        KSS
035970971212     C* 2 CIFRE INIZIALI FISSE PER NUMERO AWB
035980971212     C  N30              MOVE      TBLUNI        §3IFAW            2 0
035990971211     C   30              CLEAR                   KSS
036000971212     C   30              CLEAR                   §3IFAW
036010950920     C**
036020930401     C* CODICE PER ASSICURAZIONE PER CONTO
036030950920     C**
036040990818     C                   MOVEL     'C '          FTC
036050041217     c**
036060041217      * Aggancio tabella "VPO" per reperimento giorni per calcolo
036070041217      * max data consegna richiesta
036080041217     C                   CLEAR                   dsbs02
036090041217     c                   clear                   dvpo
036100041217     C                   MOVEL     'C'           T02MOD
036110041217     C                   MOVEL     KNSIF         T02SIF
036120041217     C                   MOVEL     'VPO'         T02COD
036130041217     c                   movel(P)  'VPO'         t02ke1
036140041217     C                   CALL      'TIBS02R'
036150041217     C                   PARM                    KPJBA
036160041217     C                   PARM                    dsbs02
036170041217    2C                   IF        T02ERR = *BLANKS
036180041217     C                   MOVEL     T02uni        dvpo
036190041217    2C                   ENDIF
036200121017      * Aggancio tabella "VPODECO"
036210060207     C                   CLEAR                   dsbs02
036220060207     c                   clear                   dvpodeco
036230060207     C                   MOVEL     'C'           T02MOD
036240060207     C                   MOVEL     KNSIF         T02SIF
036250060207     C                   MOVEL     'VPO'         T02COD
036260060207     c                   movel(P)  'DECO'        t02ke1
036270060207     C                   CALL      'TIBS02R'
036280060207     C                   PARM                    KPJBA
036290060207     C                   PARM                    dsbs02
036300060207    2C                   IF        T02ERR = *BLANKS
036310060207     C                   MOVEL     T02uni        dvpodeco
036320060207    2C                   ENDIF
036330150414      * Aggancio tabella "VPO" "EXPO"
036340151119     C*                  CLEAR                   dsbs02
036350151119     c*                  clear                   fil_expo
036360151119     C*                  MOVEL     'C'           T02MOD
036370151119     C*                  MOVEL     KNSIF         T02SIF
036380151119     C*                  MOVEL     'VPO'         T02COD
036390151119     c*                  movel(P)  'EXPO'        t02ke1
036400151119     C*                  CALL      'TIBS02R'
036410151119     C*                  PARM                    KPJBA
036420151119     C*                  PARM                    dsbs02
036430151119    2C*                  IF        T02ERR = *BLANKS
036440151119     C*                  MOVEa     T02uni        fil_expo
036450151119    2C*                  ENDIF
036460150304      * Aggancio tabella "VPO" "TELLUS"
036470150304     C                   CLEAR                   dsbs02
036480150304     c                   clear                   dvpotellus
036490150304     C                   MOVEL     'C'           T02MOD
036500150304     C                   MOVEL     KNSIF         T02SIF
036510150304     C                   MOVEL     'VPO'         T02COD
036520150304     c                   movel(P)  'TELLUS'      t02ke1
036530150304     C                   CALL      'TIBS02R'
036540150304     C                   PARM                    KPJBA
036550150304     C                   PARM                    dsbs02
036560150304    2C                   IF        T02ERR = *BLANKS
036570150304     C                   MOVEL     T02uni        dvpotellus
036580150304    2C                   ENDIF
036590121017      * Aggancio tabella "DGD"
036600121017     C                   CLEAR                   dsbs02
036610160321     c                   clear                   ddgd
036620121017     C                   MOVEL     'C'           T02MOD
036630121017     C                   MOVEL     KNSIF         T02SIF
036640121017     C                   MOVEL     'DGD'         T02COD
036650121017     c                   movel(P)  '1'           t02ke1
036660121017     C                   CALL      'TIBS02R'
036670121017     C                   PARM                    KPJBA
036680121017     C                   PARM                    dsbs02
036690121017    2C                   IF        T02ERR = *BLANKS
036700121017     C                   MOVEL     T02uni        ddgd
036710121017    2C                   ENDIF
036720160323      * Aggancio tabella "NSD"
036730160323     C                   CLEAR                   dsbs02
036740160323     c                   clear                   dnsd
036750160323     C                   MOVEL     'C'           T02MOD
036760160323     C                   MOVEL     KNSIF         T02SIF
036770160323     C                   MOVEL     'NSD'         T02COD
036780160323     c                   movel(P)  '1'           t02ke1
036790160323     C                   CALL      'TIBS02R'
036800160323     C                   PARM                    KPJBA
036810160323     C                   PARM                    dsbs02
036820160323    2C                   IF        T02ERR = *BLANKS
036830160323     C                   MOVEL     T02uni        dnsd
036840160323    2C                   ENDIF
036850140212      * Aggancio tabella "CSP"--> Caratteri Speciali per eliminazione
036860140212      *                           caratteri di punteggiatura da loc.dest.
036870160112     c*  Caratteri da togliere validi per TUTTO il campo  tab "CSP" "LOC_ALL"
036880140212     C                   CLEAR                   dsbs02
036890140212     C                   CLEAR                   charnook
036900140212     C                   MOVEL     'C'           T02MOD
036910140212     C                   MOVEL     KNSIF         T02SIF
036920140212     C                   MOVEL     'CSP'         T02COD
036930160112     c****               movel(P)  'LOC'         t02ke1
036940160112     c                   movel(P)  'LOC_ALL'     t02ke1
036950140212     C                   CALL      'TIBS02R'
036960140212     C                   PARM                    KPJBA
036970140212     C                   PARM                    dsbs02
036980140212    2C                   IF        T02ERR = *BLANKS
036990140212     C                   MOVEL     T02uni        charnook
037000140212    2C                   ENDIF
037010160112
037020160112     c*  Caratteri da togliere validi per la FINE del campo  tab "CSP" "LOC_F"
037030160112     C                   CLEAR                   dsbs02
037040160112     C                   CLEAR                   charnookf
037050160112     C                   MOVEL     'C'           T02MOD
037060160112     C                   MOVEL     KNSIF         T02SIF
037070160112     C                   MOVEL     'CSP'         T02COD
037080160112     c                   movel(P)  'LOC_F'       t02ke1
037090160112     C                   CALL      'TIBS02R'
037100160112     C                   PARM                    KPJBA
037110160112     C                   PARM                    dsbs02
037120160112    2C                   IF        T02ERR = *BLANKS
037130160112     C                   MOVEL     T02uni        charnookf
037140160112    2C                   ENDIF
037150160112     c*  Caratteri da togliere validi per l'INIZIO del campo  tab "CSP" "LOC_I"
037160160112     C                   CLEAR                   dsbs02
037170160112     C                   CLEAR                   charnooki
037180160112     C                   MOVEL     'C'           T02MOD
037190160112     C                   MOVEL     KNSIF         T02SIF
037200160112     C                   MOVEL     'CSP'         T02COD
037210160112     c                   movel(P)  'LOC_I'       t02ke1
037220160112     C                   CALL      'TIBS02R'
037230160112     C                   PARM                    KPJBA
037240160112     C                   PARM                    dsbs02
037250160112    2C                   IF        T02ERR = *BLANKS
037260160112     C                   MOVEL     T02uni        charnooki
037270160112    2C                   ENDIF
037280140212     c* imposto stringa contenente caratteri speciali per il controllo
037290140212     c* della parte finale (uguale alla charnook maa senza l'eventuale '.')
037300160112     c****               eval      charnookf=%xlate('.':' ':charnook)
037310141202      * Aggancio tabella "CSP"--> Caratteri ammessi per PIN CODE
037320141202     C                   CLEAR                   dsbs02
037330141202     C                   CLEAR                   charPCok
037340141202     C                   MOVEL     'C'           T02MOD
037350141202     C                   MOVEL     KNSIF         T02SIF
037360141202     C                   MOVEL     'CSP'         T02COD
037370141202     c                   movel(P)  'PINCODE'     t02ke1
037380141202     C                   CALL      'TIBS02R'
037390141202     C                   PARM                    KPJBA
037400141202     C                   PARM                    dsbs02
037410141202    2C                   IF        T02ERR = *BLANKS
037420141202     C                   MOVEL     T02uni        charPCok
037430141202    2C                   ENDIF
037440140612
037450140612     c* ricerca P.O. abilitati da tabella VPO per step di test
037460160304     c***                clear                   trulvpods
037470160304     c****               eval      ivpoke1 = 'DECOFIDIR'
037480160304     c***                call      'TRULVPOR'
037490160304     c***                parm                    trulvpods
037500140212     c
037510160310     c* ricerca P.O. abilitati da tabella VPO per progetto
037520160310     c* forzatura instradamento da eex a dpd
037530160310     c                   clear                   trulvpods
037540160310     c                   eval      ivpoke1 = 'DECOFIDPD'
037550160310     c                   call      'TRULVPOR'
037560160310     c                   parm                    trulvpods
037570111130     c
037580101022     C***
037590101022     C* CARICO TABELLA SIMBOLI CALENDARIO FESTIVI
037600101022     C***
037610101022     C                   MOVEL     '1Y'          COD
037620101022     C                   Z-ADD     1             C
037630101022     C     KTAB3         SETLL     TABEL
037640101022     C                   EXSR      RTABEL
037650101022     C*
037660101022     C     *IN30         DOWEQ     '0'
037670101022     C     TBLFLG        IFEQ      ' '
037680101022     C                   MOVEL     TBLUNI        DS1Y
037690101022     C     §1Yfec        IFEQ      'S'
037700101022     C                   MOVEL     TBLKEY        s1Y(C)
037710101022     C                   ADD       1             C
037720101022     C                   ENDIF
037730101022     C                   ENDIF
037740101022     C*
037750101022     C                   EXSR      RTABEL
037760101022     C                   ENDDO
037770930401     C*
037780950920     C* DATA BOLLETTAZIONE:  TRA UDATE E DATA GIORNO + §3IGGS
037790950920     C*  SOLO PER LE SPEDIZ.DI RECUPERO E' TRA DATA G. - 3  E  + §3IGGS
037800940920     C                   TIME                    W0140            14 0
037810940920     C* UDATE IN GGMMAAAA
037820940920     C                   MOVE      W0140         WDTGIO            8 0
037830990630     C                   MOVE      WDTGIO        DATAAS
037840940819     C*
037850940920     C* UDATE IN AAAAMMGG
037860940920     C                   Z-ADD     WDTGIO        G02DAT
037870910208     C                   MOVEL     *BLANK        G02ERR
037880940819     C                   CALL      'XSRDA8'
037890910208     C                   PARM                    WLBDAT
037900940819     C                   MOVEL     G02INV        DATEU             8 0
037910030409
037920030415      * Calcolo oggi + 5 gg.
037930051215     c****               Move      Dateu         Dataiso
037940051215     c****               Adddur    §vpodcg:*d    Dataiso
037950051215     c****               Move      Dataiso       woggi5
037960051215     c*
037970051215     c                   Move      Dateu         Dataiso
037980051215     c                   Adddur    §vpodcgm1:*d  Dataiso
037990051215     c                   Move      Dataiso       woggidcgm1
038000051215     c*
038010051215     c                   Move      Dateu         Dataiso
038020051215     c                   Adddur    §vpodcgm2:*d  Dataiso
038030051215     c                   Move      Dataiso       woggidcgm2
038040030416
038050051214      **Calcolo oggi + 1 mm.
038060051214     c**                 Move      Dateu         Dataiso
038070051214     c**                 Adddur    1:*m          Dataiso
038080051214     c**                 Move      Dataiso       woggi1m
038090030409
038100950921     C* SE NON FOSSE PERMESSO BOLLETTARE IN SOSPENSIONE
038110950921     C*  SI PUO' BOLLETTARE SOLO FINO A OGGI
038120950921     C                   Z-ADD     G02INV        DATAPA            8 0
038130950921     C                   MOVEL     G02DAT        DATAPG            8
038140950919     C* SOTTRAGGO  3
038150950919     C     G02TGI        SUB       3             GIOTGI
038160950919     C*
038170950919     C                   CALL      'XSRGI8'
038180950919     C                   PARM                    WGIDAT
038190950919     C*
038200950919     C                   Z-ADD     GIOINV        DATAM             8 0
038210080109     C* SOTTRAGGO  giorni per ottenere data minima per data ritiro
038220080109     c                   clear                   TRUL52ds
038230080109     c                   eval      d52gio=§3iggb
038240080109     c                   eval      d52sgn='-'
038250080109     c                   z-add     dateu         D52din
038260080109     c                   call      'TRUL52R'
038270080109     c                   parm                    TRUL52ds
038280080109     C*
038290080109     C                   Z-ADD     d52dfi        DATAmin           8 0
038300080603     c* sottraggo 40 gg. per otternere data minima per data ritiro per
038310080603     c* prepagati
038320080603     c                   move      dateu         dataiso
038330080603     c                   subdur    40:*d         dataiso
038340080603     c                   move      dataiso       datam40
038350080603     c
038360061220     c                   z-add     g02tgi        salvatgi
038370991214     C*
038380991214     C* SOTTRAGGO  I GIORNI PER LA DATA CONTROLLO OPPIO PARCEL DPD
038390991214     C     G02TGI        SUB       §3IGGU        GIOTGI
038400991214     C*
038410991214     C                   CALL      'XSRGI8'
038420991214     C                   PARM                    WGIDAT
038430991214     C*
038440991214     C                   Z-ADD     GIOINV        DPDDSP            8 0
038450130305     c* sottraggo i giorni per controllo pdf cliente doppio
038460130305     c                   move      dateu         dataiso
038470130305     c                   subdur    §vpogpdf:*d   dataiso
038480130305     c                   move      dataiso       datapdf
038490950919     C*
038500950919     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
038510990602     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
038520990602     C* PER I PREPAGATI
038530950920     C                   Z-ADD     1             X
038540950920    1C     X             DOWLE     §3IGGS
038550990602     C     PARTCH        ANDNE     'P'
038560010301     C     §LPFPR        ANDNE     'O'
038570990602    1C     X             ORLE      §3IGGP
038580990602     C     PARTCH        ANDEQ     'P'
038590010301    1C     X             ORLE      §3IGGP
038600010301     C     §LPFPR        ANDEQ     'O'
038610950920     C*
038620950921     C                   MOVEL     'F'           WFEST             1
038630950920     C*
038640950920    2C     WFEST         DOWNE     ' '
038650950919     C     G02TGI        ADD       1             GIOTGI
038660950919     C                   ADD       1             G02TGI
038670940819     C                   CALL      'XSRGI8'
038680910208     C                   PARM                    WGIDAT
038690910221     C*
038700950920     C                   Z-ADD     GIOINV        DATAPA            8 0
038710950920     C                   MOVEL     GIODAT        DATAPG            8
038720950920     C*
038730950920     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
038740950921     C                   Z-ADD     GIOINV        WDATA
038750950920     C                   CLEAR                   W0030
038760120302     C* CHAIN SUL CALENDARIO BRT
038770950920     C     KCLN          CHAIN     AZCLN01L                           30
038780950920     C   30              CLEAR                   CLNPOM
038790950921     C                   MOVEA     CLNPOM        K31
038800950920     C                   MOVEL     K31(WGG)      WFEST
038810101022     c* Se non è festivo pulisco il campo WFEST
038820101022     c     wfest         lookup    S1Y                                    30
038830101022     c                   if        not *in30
038840101022     c                   clear                   wfest
038850101022     c                   endif
038860101022     c
038870950920    2C                   ENDDO
038880950920     C*
038890950920     C                   ADD       1             X
038900990602    1C                   ENDDO
038910061220     c
038920061220     c* trovo primo giorno lavorativo minore di oggi per bollettare in
038930061220     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
038940061220     C                   TIME                    orapgm            6 0
038950061221    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
038960061220     C                   MOVEL     'F'           WFEST             1
038970061220     c                   z-add     salvatgi      giotgi
038980061220     C*
038990061220    1C     WFEST         DOWNE     ' '
039000061221     C     salvatgi      sub       1             GIOTGI
039010061221     C                   sub       1             salvatgi
039020061220     C                   CALL      'XSRGI8'
039030061220     C                   PARM                    WGIDAT
039040061220     C*
039050061220     C                   Z-ADD     GIOINV        DATAmeno1         8 0
039060061221     C                   MOVEL     GIODAT        DATgmeno1         8 0
039070061220     C*
039080061220     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
039090061220     C                   Z-ADD     GIOINV        WDATA
039100061220     C                   CLEAR                   W0030
039110120302     C* CHAIN SUL CALENDARIO BRT
039120061220     C     KCLN          CHAIN     AZCLN01L                           30
039130061220     C   30              CLEAR                   CLNPOM
039140061220     C                   MOVEA     CLNPOM        K31
039150061220     C                   MOVEL     K31(WGG)      WFEST
039160101022     c* Se non è festivo pulisco il campo WFEST
039170101022     c     wfest         lookup    S1Y                                    30
039180101022     c                   if        not *in30
039190101022     c                   clear                   wfest
039200101022    2C                   ENDif
039210101022     c
039220061220    1C                   ENDDO
039230061220   x0c                   else
039240061220     C*
039250061221     C                   Z-ADD     dateu         DATAmeno1
039260061221     C                   MOVEL     wdtgio        DATgmeno1
039270061220    0c                   endif
039280941109     C***
039290941109     C* CARICO CAMPI FISSI PER TASSAZIONE/BOLLETTAZIONE
039300941109     C***
039310941109     C                   MOVEL     'QT'          COD
039320941109     C                   MOVEL     '1       '    KEY
039330941109     C                   EXSR      CTABEL
039340941109     C  N30              MOVEL     TBLUNI        DSQT1
039350941109     C   30              CLEAR                   DSQT1
039360930601     C*
039370920427     C* NUMERO PER FORZARE GLI ERRORI: 1 PER IMM E MANUT.BOLLE
039380920427     C*                                2 PER DISK CLI
039390920427     C                   Z-ADD     1             NUMFOR            1 0
039400940923     C***
039410940923     C* DTU,10 LA PORTO A 8 PER I CONTROLLO
039420940923     C***
039430940923     C                   CLEAR                   WLBDAT
039440940923     C                   Z-ADD     DTU(10)       G02INV
039450940923     C                   MOVEL     '3'           G02ERR
039460940923     C                   CALL      'XSRDA8'
039470940923     C                   PARM                    WLBDAT
039480940923     C                   MOVEL     G02INV        WDTU10            8 0
039490990830     C* ADDIZIONO  3
039500990830     C     G02TGI        ADD       1             GIOTGI
039510990830     C*
039520990830     C                   CALL      'XSRGI8'
039530990830     C                   PARM                    WGIDAT
039540990830     C*
039550990830     C                   Z-ADD     GIODAT        WDTUPI            8 0
039560000113     C                   MOVE      GIODAT        WAAUPI            4 0
039570990830     C*
039580941107     C***
039590960926     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
039600941107     C***
039610941107     C                   CLEAR                   DSUL06
039620941107     C                   MOVE      '£1'          D06COD
039630941107     C                   MOVEL     SIMFEL        D06KEY
039640961003     C                   MOVEL     'L'           D06TLA
039650941107     C                   MOVEL     DSUL06        KPJBU
039660941107     C*
039670941107     C                   CALL      'TRUL06R'
039680941107     C                   PARM                    KPJBA
039690941107     C                   MOVEL     KPJBU         DSUL06
039700941107     C                   MOVEA     LIN           L1
039710070807     C***
039720070807     C* CARICO £6
039730070807     C***
039740070807     C                   CLEAR                   DSUL06
039750070807     C                   MOVE      '£6'          D06COD
039760070807     C                   movel     SImpou        D06KEY
039770070807     C                   MOVEL     'L'           D06TLA
039780070807     C                   MOVEL     DSUL06        KPJBU
039790070807     C*
039800070807     C                   CALL      'TRUL06R'
039810070807     C                   PARM                    KPJBA
039820070807     C                   MOVEL     KPJBU         DSUL06
039830070807     C                   MOVEA     LIN           L6
039840941107     C***
039850941107     C* CARICO TABELLA 5E : TIPI SERVIZIO
039860941107     C***
039870941107     C                   MOVEL     '5E'          COD
039880941107     C                   Z-ADD     1             C
039890941107     C     KTAB3         SETLL     TABEL
039900941107     C                   EXSR      RTABEL
039910941107     C*
039920941107     C     *IN30         DOWEQ     '0'
039930941107     C     TBLFLG        IFEQ      ' '
039940941107     C                   MOVEL     TBLKEY        TSP(C)
039950941108     C                   MOVEL     TBLUNI        DS5E
039960941107     C                   MOVEL     §5EDES        DTS(C)
039970941107     C                   MOVEL     §5EFUB        UTS(C)
039980941115     C                   MOVEL     §5EFST        STS(C)
039990000509     C                   MOVEL     §5EUSO        USO(C)
040000090604     c                   eval      dts08(c) = §5ed08
040010090609     c                   eval      dts03(c) = §5ed03
040020090827     c                   eval      tsTTC(c) = §5ettc
040030941107     C                   ADD       1             C
040040941107     C                   ENDIF
040050941107     C*
040060941107     C                   EXSR      RTABEL
040070941107     C                   ENDDO
040080960209     C***
040090960209     C* CARICO TABELLA TIPI BOLLA CHE PREVEDONO L'ASSICURAZIONE
040100960209     C***
040110960209     C                   MOVEL     'TB'          COD
040120960209     C                   Z-ADD     1             C
040130960209     C     KTAB3         SETLL     TABEL
040140960209     C                   EXSR      RTABEL
040150960209     C*
040160960209     C     *IN30         DOWEQ     '0'
040170960209     C     TBLFLG        IFEQ      ' '
040180960209     C                   MOVEL     TBLUNI        DSTB
040190960209     C     §TBFAS        IFEQ      '1'
040200960209     C                   MOVEL     TBLKEY        TBL(C)
040210960209     C                   ADD       1             C
040220960209     C                   ENDIF
040230960209     C                   ENDIF
040240960209     C*
040250960209     C                   EXSR      RTABEL
040260960209     C                   ENDDO
040270970115     C***
040280970115     C* CARICO TABELLA 3F : DICITURE NON AMMESSE NELLA NATURA MERCE
040290970115     C***
040300970115     C                   MOVEL     '3F'          COD
040310970115     C                   Z-ADD     1             C
040320970115     C     KTAB3         SETLL     TABEL
040330970115     C                   EXSR      RTABEL
040340970115     C*
040350970115     C     *IN30         DOWEQ     *OFF
040360970115     C     TBLFLG        IFEQ      ' '
040370970115     C                   MOVEL     TBLKEY        W003A
040380970115     C                   MOVEL     W003A         TBO(C)
040390970115     C                   MOVE      W003A         LDC(C)
040400970115     C                   ADD       1             C
040410970115     C                   ENDIF
040420970115     C*
040430970115     C                   EXSR      RTABEL
040440970115     C                   ENDDO
040450991007     c***
040460991007     c* CARICO TABELLA CODICI VARIE
040470991007     c***
040480991007     C                   MOVEL     '$2'          COD
040490991007     C                   MOVEL     *BLANKS       KEY
040500991007     C                   MOVEL     '1'           KEY
040510991007     C     KTAB2         CHAIN     TABEL                              30
040520991007     C     *IN30         IFEQ      *OFF
040530991007     C                   MOVEL     TBLUNI        DS$2
040540991007     C                   ELSE
040550991007     C                   CLEAR                   DS$2
040560991007     C                   ENDIF
040570991008      *
040580991102      * AGGANCIO TABELLA GED PER DIVISA DELLA MONETA DI CONTO
040590991102     C                   CLEAR                   DSBS02
040600000124     C                   MOVEL     'C'           T02MOD
040610991102     C                   MOVEL     KNSIF         T02SIF
040620991102     C                   MOVEL     'GED'         T02COD
040630991102     C                   MOVEL     '1'           T02KE1
040640991102      *
040650991102     C                   CALL      'TIBS02R'
040660991102     C                   PARM                    KPJBA
040670991102     C                   PARM                    DSBS02
040680991102      *
040690991102     C     T02ERR        IFEQ      *BLANKS
040700991102     C                   MOVEL     T02UNI        DGED
040710991008     C                   ELSE
040720991008     C                   CLEAR                   DGED
040730991008     C                   ENDIF
040740011108     c*
040750011108      * Tabella CV della moneta di conto
040760011212     C                   CLEAR                   DSCV
040770011212     C                   CLEAR                   DECCN
040780020102     C                   CLEAR                   COMFDC
040790011212     C                   MOVEL     'CV'          COD
040800011212     C                   MOVEL(P)  §GEDCN        KEY
040810011212     C                   EXSR      CTABEL
040820011212     C     *IN30         IFEQ      *OFF
040830011212     C                   MOVEL     TBLUNI        DSCV
040840011212     C                   MOVEL     §CVDEC        DECCN
040850020102     C                   MOVEL     §CVFDC        COMFDC
040860011212     C                   ENDIF
040870011108     C*
040880011212      * AGGANCIO TABELLA GEI PER LIMITE FATTURABILE
040890011212     C                   CLEAR                   DSBS02
040900011212     C                   MOVEL     'C'           T02MOD
040910011212     C                   MOVEL     KNSIF         T02SIF
040920011212     C                   MOVEL     'GEI'         T02COD
040930011212     C                   MOVEL     §GEDCN        T02KE1
040940011108      *
040950011212     C                   CALL      'TIBS02R'
040960011212     C                   PARM                    KPJBA
040970011212     C                   PARM                    DSBS02
040980011108      *
040990011212     C     T02ERR        IFEQ      *BLANKS
041000011212     C                   MOVEL     T02UNI        DGEI
041010011212     C                   ELSE
041020011212     C                   CLEAR                   DGEI
041030011212     C                   ENDIF
041040011212     C                   Z-ADD     §GEIMF        IMFGEI
041050000124      *
041060000124      * AGGANCIO TABELLA "CHI" PER TEL E FAX PER EXPORT DPD
041070040525     C***                CLEAR                   DSBS02
041080040525     C***                MOVEL     'C'           T02MOD
041090040525     C***                MOVEL     KNSIF         T02SIF
041100040525     C***                MOVEL     'CHI'         T02COD
041110040525     C***                MOVEL     'TELFAX'      T02KE1
041120000124      *
041130040525     C***                CALL      'TIBS02R'
041140040525     C***                PARM                    KPJBA
041150040525     C***                PARM                    DSBS02
041160000124      *
041170040525     C***  T02ERR        IFEQ      *BLANKS
041180040525     C***                MOVEL     T02UNI        TELFAX
041190040525     C***                ELSE
041200040525     C***                MOVEL     *ALL'?'       TELFAX
041210040525     C***                ENDIF
041220021120
041230021120      * Aggancio tabella default tariffe fedex
041240021120     c                   Clear                   Dsbs02
041250021120     c                   Movel     'C'           T02Mod
041260021120     c                   Movel     KNSIF         T02Sif
041270021120     c                   Movel     'DFE'         T02Cod
041280021120     c                   Movel     'FED'         T02Ke1
041290021120     c                   Call      'TIBS02R'
041300021120     c                   Parm                    Kpjba
041310021120     c                   Parm                    Dsbs02
041320021120     c                   If        T02Err = *Blanks
041330021120     c                   Movel     T02Uni        DDfe
041340021120     c                   Else
041350021120     c                   Clear                   DDfe
041360021120     c                   EndIf
041370040701      * Aggancio tabella "VPO" per reperimento data ultima fase poste
041380040701     C                   CLEAR                   dsbs02
041390040701     c                   clear                   dvpoppt
041400040701     C                   MOVEL     'C'           T02MOD
041410040701     C                   MOVEL     KNSIF         T02SIF
041420040701     C                   MOVEL     'VPO'         T02COD
041430040701     c                   movel(P)  'PPT'         t02ke1
041440040701     C                   CALL      'TIBS02R'
041450040701     C                   PARM                    KPJBA
041460040701     C                   PARM                    dsbs02
041470040701    2C                   IF        T02ERR = *BLANKS
041480040701     C                   MOVEL     T02uni        dvpoppt
041490040701    2C                   ENDIF
041500160829      * Aggancio tabella "VPO" "FNLS01R" per recupero eventuali flag di
041510160829      * forzatura temporanee
041520160829     C                   CLEAR                   dsbs02
041530160829     c                   clear                   dvpols01
041540160829     C                   MOVEL     'C'           T02MOD
041550160829     C                   MOVEL     KNSIF         T02SIF
041560160829     C                   MOVEL     'VPO'         T02COD
041570160829     c                   movel(P)  'LS01'        t02ke1
041580160829     C                   CALL      'TIBS02R'
041590160829     C                   PARM                    KPJBA
041600160829     C                   PARM                    dsbs02
041610160829    2C                   IF        T02ERR = *BLANKS
041620160829     C                   MOVEL     T02uni        dvpols01
041630160829    2C                   ENDIF
041640081111      * Recupero le date delle statistiche
041650081111     c                   Clear                   dsbs02
041660081111     c                   Clear                   dSdf
041670081111     c                   Eval      T02Mod = 'C'
041680081111     c                   Eval      T02Sif = Knsif
041690081111     c                   Eval      T02Cod = 'SDF'
041700081111     c                   Movel(p)  Simfel        T02Ke1
041710081111     c                   Call      'TIBS02R'
041720081111     c                   Parm                    Kpjba
041730081111     c                   Parm                    dsbs02
041740081111     c                   If        T02Err = *Blanks
041750081111     c                   Movel     T02Uni        dSdf
041760081111     c                   EndIf
041770021120
041780000202     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
041790000202     C                   Z-ADD     SIMFEL        W0030
041800000202     C     W0030         CHAIN     AZORG01L      UNIORG               30
041810000202     C                   MOVEL     ORGFEL        WASFEL            3 0
041820000204     C                   MOVEL     ORGDF0        OG150
041830000204     C                   MOVEL     §OGDKC        WASDKC            1
041840170228     c****               Eval      Og143 = Orgde3
041850170228     c****               Eval      LnpOgAs = §OgAs
041860991008     C*
041870930628     C***
041880930628     C* VEDO SE SONO SIMFEL O REMOTO
041890930628     C***
041900930628     C                   MOVEL     SIMFEL        CDU               3 0
041910930628     C*
041920020513     c     simtpp        ifeq      '2'
041930020513     c     simtpp        oreq      *blanks
041940020513     c                   movel     simpou        cdu
041950930628     C                   END
041960941115     C**
041970941115     C* VEDO IL RICHIAMO
041980941115     C**
041990160613     c* Se richiamato in batch per "Vedi Pacco DPD" non bisogna aprire
042000160613     c* il file display
042010160613    1c                   if        §lpfpr<>'D'
042020160613     c                   open      fnls01d
042030160613    1c                   endif
042040160613
042050941115    1C     §LPFPR        IFNE      'C'
042060941115     C     §LPFPR        ANDNE     'G'
042070941115     C     §LPFPR        ANDNE     'I'
042080150302     C     §LPFPR        ANDNE     'B'
042090941115     C*
042100990602     C                   SELECT
042110990602     C* RECUPERO BOLLE
042120990602    2C     PARTCH        WHENEQ    'R'
042130941115     C                   MOVE      DES(4)        VIDTES
042140941115     C                   SETON                                        98
042150990602     C* PROCEDURA PREPAGATI
042160990602    2C     PARTCH        WHENEQ    'P'
042170010301     C     §LPFPR        OREQ      'O'
042180990602     C                   MOVE      DES(6)        VIDTES
042190990602   X2C                   OTHER
042200941115     C                   MOVE      DES(1)        VIDTES
042210990602    2C                   ENDSL
042220941115    1C                   ENDIF
042230941115     C*
042240941115     C* SE IMMISSIONE VISUALIZZO: ULTIMA SPEDIZIONE
042250941115     C                   MOVEL     CULTSP        PREDSS
042260941115     C*
042270941115    1C     §LPFPR        IFNE      'C'
042280941115     C* ESEGUO SOLO UNA VOLTA
042290941115    2C     RIC           IFEQ      ' '
042300941115    3C     §LPFPR        IFNE      ' '
042310010301     C     §LPFPR        ANDNE     'O'
042320941115     C*
042330941115     C* PROVENGO DA MANUTENZIONE
042340941115    4C     §LPFPR        IFEQ      'M'
042350941115     C                   SETON                                        12
042360941115     C                   MOVE      DES(2)        VIDTES
042370941115     C                   MOVEL     CVARIA        PREDSS
042380941115     C                   OPEN      FNLBL01L
042390070123     C                   OPEN      FNBRV09L
042400071221     C                   OPEN      FNBRV07L
042410080904     C                   OPEN(e)   TNBLA00F
042420160120     c                   open      fiarbf2c
042430080904     c
042440080904     c                   if        not %open(tnbla00f)
042450080904     c                   eval      %subst(WTNBLA:7:4)='GRPS'
042460080904     C                   OPEN      TNBLA00F
042470080904     c                   endif
042480941115     C*
042490941115   X4C                   ELSE
042500941115     C* PROVENGO DA CARICAMENTO BOLLE DA DISK
042510941115     C                   SETON                                        1215
042520941115     C                   MOVEL     CCONFE        PREDSS
042530020917     C                   OPEN      FIVAD02L
042540020917     C                   OPEN      FIVAT01L
042550040601     C                   OPEN      FIVAX01L
042560140716     C                   OPEN      FNBRV07L
042570941115     C     *IN98         IFEQ      *OFF
042580941115     C                   MOVE      DES(3)        VIDTES
042590941115     C                   ELSE
042600941115     C                   MOVE      DES(5)        VIDTES
042610941115     C                   ENDIF
042620941115     C*
042630941115    4C                   END
042640941115    3C                   END
042650941115    2C                   END
042660941115    1C                   END
042670110518     c*
042680110518     c                   if        not *in12
042690110518     c                   open      fivab01l
042700110518     c                   open      edivab1l
042710110518     c                   endif
042720940819     C*
042730940915     C* QUESTI 2 CAMPI UNA VOLTA IMPOSTATI NON LI TOCCO PIU':
042740070828     c* Non più: la data ritiro a nuova bolla la reimposterò sempre a udate
042750940915     C*
042760960926     C* LINEA DI PARTENZA --> IMPOSTO
042770940915     C  N12              MOVEL     CDU           VIDLNP
042780940915     C* DATA RITIRO       --> IMPOSTO DATA DEL GIORNO
042790990628     C  N12PARTCH        IFNE      'P'
042800010301     C     §LPFPR        ANDNE     'O'
042810070828     C                   MOVEL     WDTGIO        VIDDRT
042820990630     C                   ELSE
042830990630     C                   OPEN      CNNUM00F
042840990628     C                   ENDIF
042850940915     C*
042860930628     C* CAMPI CHE INIZIALIZZO SOLO IN IMMISSIONE BOLLE
042870930628     C*   E PER DISK CLIENTI
042880930628     C   12
042890930628     CAN 15
042900930628     CORN12              DO
042910930628     C                   MOVEL     *ZEROS        RECNSP
042920930628     C                   MOVEL     *ZEROS        VIDDBR
042930930628     C                   MOVEL     *ZEROS        VIDNFV
042940930628     C                   MOVEL     *ZEROS        VIDNSP
042950930628     C                   MOVE      *BLANKS       BLPATB
042960940915     C                   MOVEL     CDU           BLPFLB
042970111128     C****               MOVEL     SIMFEL        BLPFLE
042980940915     C                   MOVEL     *ZEROS        BLPDPC
042990940915     C                   MOVEL     *ZEROS        BLPDUC
043000940819     C                   MOVEL     *ZEROS        BLPFLP
043010930628     C                   MOVEL     *ZEROS        BLPDAM
043020930628     C                   MOVEL     *ZEROS        BLPDCM
043030930628     C                   MOVEL     *ZEROS        BLPHMC
043040930628     C                   MOVEL     *ZEROS        BLPDUT
043050930628     C                   MOVEL     *ZEROS        BLPDET
043060930628     C                   MOVEL     *ZEROS        BLPDSE
043070940915     C                   MOVEL     *ZEROS        BLPVLC
043080930628     C                   MOVEL     *ZEROS        BLPNCR
043090940915     C                   MOVEL     *ZEROS        BLPDT1
043100940915     C                   MOVEL     *ZEROS        BLPDT2
043110940915     C                   MOVEL     *ZEROS        BLPDT3
043120940915     C                   MOVEL     *BLANKS       BLPFT1
043130940915     C                   MOVEL     *BLANKS       BLPFT2
043140940915     C                   MOVEL     *BLANKS       BLPFT3
043150940915     C                   Z-ADD     DATEU         BLPDIM
043160940915     C                   CLEAR                   BLPFDN
043170940915     C                   CLEAR                   BLPNCP
043180940915     C                   CLEAR                   BLPPKC
043190940915     C                   CLEAR                   BLPDTI
043200940915     C                   CLEAR                   BLPHTI
043210940915     C                   CLEAR                   BLPDCE
043220940915     C                   CLEAR                   BLPNPI
043230940915     C                   CLEAR                   BLPNCI
043240940915     C                   CLEAR                   BLPNCR
043250940915     C                   CLEAR                   BLPNDC
043260940915     C                   CLEAR                   BLPDDC
043270940915     C                   CLEAR                   BLPDCP
043280940915     C                   CLEAR                   BLPCCA
043290940915     C                   CLEAR                   BLPTMC
043300040901     c                   clear                   blpscl
043310040329      * per immissione bolle o per conferma bolle da clienti
043320040329      * Se il p.o. è già su AS unico apro TITAS
043330170228     c***                If        LnpOgAs = 946
043340170228     c***                          and Not %Open(Titas30c)
043341170228     c                   if        Not %Open(Titas30c)
043350040329     c                   Clear                   comman
043360040329     c                   Movel(p)  cmdt(1)       comman
043370040329     c                   Eval      %Subst(comman:30:10) = wlib
043380040329     c                   Eval      comman =
043390040329     c                             %trim(comman) + '/TITAS30C)'
043400040329     c                   Call      'QCMDEXC'                            99
043410040329     c                   Parm                    comman
043420040329     c                   Parm                    lenght
043430040329     c  n99              Open      Titas30c
043440040329     c                   EndIf
043450940928     C                   ENDDO
043460151014      * Se il p.o. è già su AS unico apro FIAR5 di sede
043470170228     c****               If        LnpOgAs = 946
043480170228     c***                          and Not %Open(fiar531c)
043481170228     c                   if        Not %Open(fiar531c)
043490151014     c                   Clear                   comman
043500151015     c                   Movel(p)  cmdt(2)       comman
043510151014     c                   Eval      %Subst(comman:30:10) = wlib
043520151014     c                   Eval      comman =
043530151014     c                             %trim(comman) + '/FIAR531C)'
043540151014     c                   Call      'QCMDEXC'                            99
043550151014     c                   Parm                    comman
043560151014     c                   Parm                    lenght
043570151014     c  n99              Open      fiar531c
043580151014     c                   EndIf
043590930611     C*
043600930611     C* STAMPA DEI 3 ASTERISCHI ALLA FINE SE><0
043610930611     C                   Z-ADD     0             I100              1 0
043620930628     C*
043630930628     C                   MOVEL     'C'           RIC               1
043640940920     C* SIGLA OPERATORE:
043650940920     C* IN IMMISSIONE SEMPRE SPROTETTA
043660940920     C     *IN12         IFEQ      *OFF
043670940920     C                   SETOFF                                       13
043680940920     C                   ENDIF
043690940920     C*
043700940920     C* IN DISK CLIENTI SEMPRE PROTETTA
043710940920     C     *IN12         IFEQ      *ON
043720940920     C     *IN15         ANDEQ     *ON
043730940920     C                   SETON                                        13
043740940920     C                   ENDIF
043750940920     C* IN MANUTENZIONE SOLO SE E' UNA SIGNA NON UTILIZABILE:
043760940920     C* LO CONTROLLO BOLLA PER BOLLA QUINDI IN CARBLP LO FACCIO
043770941117     C                   CLEAR                   SAVFIE
043780160219     C                   CLEAR                   s_27ntw
043790971215     C* IMPOSTO LA DS ESTERA PER I CAMPI FISSI
043800971215     C                   CLEAR                   DSBLD
043810971215     C                   CLEAR                   DSBLDE
043820000120     C*
043830170214     C***                MOVEL     'CHI'         KTCOD
043840170214     C***                MOVEL     WASFEL        KTKE1
043850170214     C***                CLEAR                   KTLIN
043860170214     C***                CLEAR                   KTSIF
043870170214     C***                CLEAR                   KTKE2
043880010319     C* VEDO SE IN L1 PRESENTE P.O. DPD
043890010319     C                   CLEAR                   WSIDPD
043900010319     C                   Z-ADD     1             II
043910010319     C     II            DOWLE     30
043920010319     C     WSIDPD        ANDEQ     *BLANKS
043930010319     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
043940010319     C  N30              MOVEL     ORGDE3        OG143
043950010319     C   30              CLEAR                   OG143
043960020319     C     §OGntw        IFEQ      'DPD'
043970010319     C                   MOVEL     'S'           WSIDPD            1
043980010319     C                   ENDIF
043990010319     C                   ADD       1             II
044000010319     C                   ENDDO
044010051124     c* imposto campi fissi da passare a fnlsa8r
044020051124     c**                 z-add     simfel        parfel
044030051124     c**                 movel     '1'           parflg
044040130117
044050130117      * Carico la tabella OSR
044060130117     c                   exsr      carosr
044070130117
044080920220     C                   ENDSR
044090130117
044100130117      /free
044110130117       // ----------------------------------------------------------------------
044120130117       //?Carico tabella OSR.
044130130117       // ----------------------------------------------------------------------
044140130117       begsr carosr;
044150130117
044160130117         clear osrxx;
044170130117
044180130117       //?carico tutta la tabella OSR delle LNP/NRS ORM
044190130117         setll    c_tabosr tntbe01l;
044200130117         reade(n) c_tabosr tntbe01l;
044210130117
044220130117         dow not %eof(tntbe01l);
044230130122           IF  TBEatb = *blanks;
044240130117           dosr = tbeuni;
044250130117       //?carico in sk tutti i clienti che trovo
044260130117       //?skCLIosr = cliente
044270130117       //?skLNPNRSosr = LNP + serie (TBEke1)
044280130117           IF d§osrcli <> 0;
044290130117             osrxx = %lookup(d§OSRcli:skCLIosr);
044300130117             IF  osrxx = 0;
044310130117               osrxx = %lookup(*zeros:skCLIosr);
044320130117               IF  osrxx > 0;
044330130117                 skCLIosr(osrxx) = d§OSRcli;
044340130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044350130117               ENDIF;
044360130117             ENDIF;
044370130117           ENDIF;
044380130117
044390130117           IF d§osrcl2 <> 0;
044400130117             osrxx = %lookup(d§OSRcl2:skCLIosr);
044410130117             IF  osrxx = 0;
044420130118               osrxx = %lookup(*zeros:skCLIosr);
044430130117               IF  osrxx > 0;
044440130117                 skCLIosr(osrxx) = d§OSRcl2;
044450130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044460130117               ENDIF;
044470130117             ENDIF;
044480130117           ENDIF;
044490130117
044500130117           IF d§osrcl3 <> 0;
044510130117             osrxx = %lookup(d§OSRcl3:skCLIosr);
044520130117             IF  osrxx = 0;
044530130117               osrxx = %lookup(*zeros:skCLIosr);
044540130117               IF  osrxx > 0;
044550130117                 skCLIosr(osrxx) = d§OSRcl3;
044560130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044570130117               ENDIF;
044580130117             ENDIF;
044590130117           ENDIF;
044600130117
044610130117           IF d§osrcl4 <> 0;
044620130117             osrxx = %lookup(d§OSRcl4:skCLIosr);
044630130117             IF  osrxx = 0;
044640130117               osrxx = %lookup(*zeros:skCLIosr);
044650130117               IF  osrxx > 0;
044660130117                 skCLIosr(osrxx) = d§OSRcl4;
044670130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044680130117               ENDIF;
044690130117             ENDIF;
044700130117           ENDIF;
044710130117
044720130117           IF d§osrcl5 <> 0;
044730130117             osrxx = %lookup(d§OSRcl5:skCLIosr);
044740130117             IF  osrxx = 0;
044750130117               osrxx = %lookup(*zeros:skCLIosr);
044760130117               IF  osrxx > 0;
044770130117                 skCLIosr(osrxx) = d§OSRcl5;
044780130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044790130117               ENDIF;
044800130117             ENDIF;
044810130117           ENDIF;
044820130117
044830130117           IF d§osrcl6 <> 0;
044840130117             osrxx = %lookup(d§OSRcl6:skCLIosr);
044850130117             IF  osrxx = 0;
044860130117               osrxx = %lookup(*zeros:skCLIosr);
044870130117               IF  osrxx > 0;
044880130117                 skCLIosr(osrxx) = d§OSRcl6;
044890130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044900130117               ENDIF;
044910130117             ENDIF;
044920130117           ENDIF;
044930130117
044940130117           IF d§osrcl7 <> 0;
044950130117             osrxx = %lookup(d§OSRcl7:skCLIosr);
044960130117             IF  osrxx = 0;
044970130117               osrxx = %lookup(*zeros:skCLIosr);
044980130117               IF  osrxx > 0;
044990130117                 skCLIosr(osrxx) = d§OSRcl7;
045000130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045010130117               ENDIF;
045020130117             ENDIF;
045030130117           ENDIF;
045040130117
045050130117           IF d§osrcl8 <> 0;
045060130117             osrxx = %lookup(d§OSRcl8:skCLIosr);
045070130117             IF  osrxx = 0;
045080130117               osrxx = %lookup(*zeros:skCLIosr);
045090130117               IF  osrxx > 0;
045100130117                 skCLIosr(osrxx) = d§OSRcl8;
045110130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045120130117               ENDIF;
045130130117             ENDIF;
045140130117           ENDIF;
045150130117
045160130117           IF d§osrcl9 <> 0;
045170130117             osrxx = %lookup(d§OSRcl9:skCLIosr);
045180130117             IF  osrxx = 0;
045190130117               osrxx = %lookup(*zeros:skCLIosr);
045200130117               IF  osrxx > 0;
045210130117                 skCLIosr(osrxx) = d§OSRcl9;
045220130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045230130117               ENDIF;
045240130117             ENDIF;
045250130117           ENDIF;
045260130117
045270130117           IF d§osrcl10 <> 0;
045280130117             osrxx = %lookup(d§OSRcl10:skCLIosr);
045290130117             IF  osrxx = 0;
045300130117               osrxx = %lookup(*zeros:skCLIosr);
045310130117               IF  osrxx > 0;
045320130117                 skCLIosr(osrxx) = d§OSRcl10;
045330130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045340130117               ENDIF;
045350130117             ENDIF;
045360130117           ENDIF;
045370130117
045380130117           IF d§osrcl11 <> 0;
045390130117             osrxx = %lookup(d§OSRcl11:skCLIosr);
045400130117             IF  osrxx = 0;
045410130117               osrxx = %lookup(*zeros:skCLIosr);
045420130117               IF  osrxx > 0;
045430130117                 skCLIosr(osrxx) = d§OSRcl11;
045440130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045450130117               ENDIF;
045460130117             ENDIF;
045470130117           ENDIF;
045480130117
045490130117           IF d§osrcl12 <> 0;
045500130117             osrxx = %lookup(d§OSRcl12:skCLIosr);
045510130117             IF  osrxx = 0;
045520130117               osrxx = %lookup(*zeros:skCLIosr);
045530130117               IF  osrxx > 0;
045540130117                 skCLIosr(osrxx) = d§OSRcl12;
045550130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045560130117               ENDIF;
045570130117             ENDIF;
045580130117           ENDIF;
045590130117
045600130117           IF d§osrcl13 <> 0;
045610130117             osrxx = %lookup(d§OSRcl13:skCLIosr);
045620130117             IF  osrxx = 0;
045630130117               osrxx = %lookup(*zeros:skCLIosr);
045640130117               IF  osrxx > 0;
045650130117                 skCLIosr(osrxx) = d§OSRcl13;
045660130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045670130117               ENDIF;
045680130117             ENDIF;
045690130117           ENDIF;
045700130117
045710130117           IF d§osrcl14 <> 0;
045720130117             osrxx = %lookup(d§OSRcl14:skCLIosr);
045730130117             IF  osrxx = 0;
045740130117               osrxx = %lookup(*zeros:skCLIosr);
045750130117               IF  osrxx > 0;
045760130117                 skCLIosr(osrxx) = d§OSRcl14;
045770130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045780130117               ENDIF;
045790130117             ENDIF;
045800130117           ENDIF;
045810130117
045820130117           IF d§osrcl15 <> 0;
045830130117             osrxx = %lookup(d§OSRcl15:skCLIosr);
045840130117             IF  osrxx = 0;
045850130117               osrxx = %lookup(*zeros:skCLIosr);
045860130117               IF  osrxx > 0;
045870130117                 skCLIosr(osrxx) = d§OSRcl15;
045880130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
045890130117               ENDIF;
045900130117             ENDIF;
045910130117           ENDIF;
045920130117
045930130117           IF d§osrcl16 <> 0;
045940130117             osrxx = %lookup(d§OSRcl16:skCLIosr);
045950130117             IF  osrxx = 0;
045960130117               osrxx = %lookup(*zeros:skCLIosr);
045970130117               IF  osrxx > 0;
045980130117                 skCLIosr(osrxx) = d§OSRcl16;
045990130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
046000130117               ENDIF;
046010130117             ENDIF;
046020130117           ENDIF;
046030130122
046040130122           ENDIF;
046050130117
046060130117           reade(n) c_tabosr tntbe01l;
046070130117         enddo;
046080130117
046090130117       endsr;
046100130117      /end-free
046110900427     C*
046120900427     C*--- PULIZIA CAMPI FORMATO1 ------------------------------------*
046130940819     C     INZ01         BEGSR
046140950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
046150950126     C                   EXSR      OFFD01
046160900427     C*
046170991014     C                   CLEAR                   DSLV04
046180940222     C                   MOVE      ' '           UNO               1
046190940930     C                   MOVE      0             DUE               1 0
046200940930     C                   MOVE      0             TRE               1 0
046210920427     C                   MOVE      0             QUA               1 0
046220100209     C                   MOVE      0             QUAH              1 0
046230940930     C                   MOVE      0             CIN               1 0
046240940930     C                   MOVE      0             SEI               1 0
046250941020     C                   MOVE      0             SET               1 0
046260940930     C                   MOVE      0             OTT               1 0
046270910801     C                   MOVEL     ' '           NOV               1
046280940930     C                   MOVEL     0             DIE               1 0
046290950102     C                   MOVEL     0             UND               1 0
046300950410     C                   MOVEL     0             DOD               1 0
046310160726     C*****              MOVEL     0             QUI               1 0
046320961111     C                   MOVEL     0             SED               1 0
046330040213     C**!!!              MOVEL     0             DIC               1 0
046340040213     C**!!!              MOVEL     0             VEN               1 0
046350990610     C                   MOVEL     0             SES               1 0
046360970702     C                   MOVEL     0             AAA               1 0
046370970702     C                   MOVEL     0             AAB               1 0
046380990915     C                   MOVEL     0             AAC               1 0
046390991213     C                   MOVEL     0             AAD               1 0
046400970704     C                   MOVEL     0             MMA               1 0
046410970704     C                   MOVEL     0             MMB               1 0
046420000622     C                   MOVEL     0             MMD               1 0
046430970704     C                   MOVEL     0             COMA              1 0
046440970704     C                   MOVEL     0             COMB              1 0
046450990915     C                   MOVEL     ' '           WFPR              1
046460000509     C                   MOVEL     ' '           WPT1              1
046470001025     C                   MOVEL     ' '           VIDMAG
046480010504     C                   MOVE      ' '           WFORZO
046490990915     C                   CLEAR                   SAVPD4
046500030417     c                   Clear                   fordcr
046510030704     c                   Clear                   wforw03
046520030728     c                   Clear                   wfornba
046530031001     c                   Clear                   wfortbo
046540031201     c                   Clear                   wnoccm
046550060515     c                   clear                   bolksc
046560060515     c                   clear                   bolctr
046570040216     c                   Eval      wforza1 = *Off
046580040216     c                   Eval      wforza2 = *Off
046590110321     c                   Eval      wforzbrv = *Off
046600110422     c                   Eval      wforzadrt = *Off
046610141124     c                   clear                   wforz_lna
046620141124     c                   clear                   wforz_lnap
046630041116     c                   clear                   wnprpre
046640060104     C                   MOVEL     *ZEROS        VARZNC
046650941107     C* PULISCO LA DS DI STAMPA
046660991007     C  N12              CLEAR                   DTAS
046670991007     C  N12              CLEAR                   DTASV
046680030626     C                   CLEAR                   fnlsb5DS
046690941115     C                   CLEAR                   WESVAR
046700950209     C                   CLEAR                   DS1A
046710950120     C                   CLEAR                   WIN11
046720950120     C                   CLEAR                   WIN88
046730940926     C*
046740940926     C* CAMPI CHE MI INDICATO SE E' PRESENTE UNA ESTENSIONE BOLLA
046750991006     C                   CLEAR                   WAR62
046760991006     C                   CLEAR                   WAR61
046770050331     C                   CLEAR                   WKSCsf1
046780050331     C                   CLEAR                   WKSCsf2
046790991006     C                   CLEAR                   WAR7
046800040114     c                   Clear                   war71
046810051115     C                   CLEAR                   War9
046820000623     C                   CLEAR                   WES3Q
046830000623     C                   CLEAR                   WBL4W
046840040116     c                   Clear                   wesvar1
046850940926     C*
046860950126     C                   CLEAR                   WSBORD
046870940930     C                   CLEAR                   VARCAD
046880940930     C                   CLEAR                   VARCAM
046890940926     C                   CLEAR                   SAVFTM
046900940921     C                   CLEAR                   SAVFLC
046910940922     C                   CLEAR                   SAVCTR
046920961111     C                   CLEAR                   SAVFBR
046930961122     C                   CLEAR                   SAVCBO
046940000211     C                   CLEAR                   WESSGN
046950100209     C                   CLEAR                   Sa2TSP
046960941005     C* CANCELLO I CAMPI DI CONFRONTO PER RICARICARE COD TARIFFA
046970941005     C                   CLEAR                   VARTSP
046980941107     C                   CLEAR                   WFIE
046990990610     C                   CLEAR                   WCOCCM
047000050926     c* pulizia campo per errore forzabile su volume in base alla tarif
047010050926     c* fa
047020050926     c                   clear                   fvol
047030941231     C**
047040941231     C* IL CAMPO SAVCCM MI SERVE PER IL CONFRONTO DEL CODICE CLI
047050941231     C*  PER CARICARE LE TARIFFE RELATIVE
047060941231     C                   Z-ADD     1             SAVCCM
047070940922     C* SPENGO INDICATORI DI ABILITAZIONE RICERCA MITTENTE E FIL CLIENT
047080941020     C                   SETOFF                                       0138
047090940922     C* INDICATORI DI "RI" PER CAMPI PRESI DA TARIFFA
047100941107     C                   SETOFF                                       97
047110040610     c     atrbva        ifne      prri
047120040610     c                   movel     hiul          atrbva
047130040610     c                   endif
047140990630     C* INDICATORI DI PTOTEZIONE DATI FATTURA E VISUL.TOT IMPONIBILE
047150990630     C                   SETOFF                                       22
047160000915     C* INDICATORE ABILITAZIONE TASTO F22-MANTUENZIONE COD.CHI SONO
047170000915     C                   SETOFF                                       96
047180051123     c* Protezione codice bolla
047190051123     C                   CLEAR                   ATRcbo
047200070801     c* imposto no display l'attributo della costante video:"Da ORM" che
047210070801     c* deve essere visualizzata quando la data ritiro viene modificata
047220070801     c* proponendola da ORM
047230070801     c                   movel     nodi          atrdaorm
047240070918     c                   clear                   s_drt
047250070831     c* data ritiro
047260070831     c                   exsr      inzdrt
047270111124     c*
047280111124     c                   clear                   vidno1
047290111124     c                   clear                   vidno2
047300111128     c                   clear                   viddno
047310940922     C*
047320940819     C* 24 ON - DATA SPEDIZIONE PERSONALIZZATA
047330940819     C     *IN24         IFEQ      *OFF
047340940819     C                   Z-ADD     WDTGIO        VIDDSP
047350940819     C                   ENDIF
047360010222     C* 37 ON - NUMERO O.R.M. PERSONALIZZATO
047370010222     C     *IN37         IFEQ      *OFF
047380040909     c                   clear                   vidpoe
047390010222     C                   CLEAR                   VIDNOR
047400010222     C                   CLEAR                   VIDNRV
047410011126     C                   CLEAR                   ATRDES
047420011205     C                   CLEAR                   SORMFD
047430010222     C                   ENDIF
047440940819     C* 21 ON - CODICE BOLLA   PERSONALIZZATO
047450940819     C     *IN21         IFEQ      *OFF
047460940819     C                   MOVEL     *BLANKS       VIDCBO
047470940819     C                   ENDIF
047480940819     C* 20 ON - LINEA DI ARRIVO PERSONALIZZATO
047490940819     C     *IN20         IFEQ      *OFF
047500950208     C                   Z-ADD     0             CO2LNA
047510950208     C                   Z-ADD     0             COMLNA
047520020213     C                   CLEAR                   A_OG143
047530040525     C                   CLEAR                   A_OG150
047540940819     C                   MOVEL     *BLANKS       VIDLNA
047550940920     C                   MOVEL     *BLANKS       V1DLNA
047560940819     C                   ENDIF
047570940819     C* 18 ON - TIPO SERVIZIO PERSONALIZZATO
047580940819     C     *IN18         IFEQ      *OFF
047590940819     C                   MOVEL     *BLANKS       VIDTSP
047600941005     C                   MOVEL     *BLANKS       V1DTSP
047610950303     C                   CLEAR                   V2DTSP
047620940819     C                   ENDIF
047630940819     C* 26 ON - CODICE TRATTAMENTO MERCE PERSONALIZZATO
047640940819     C     *IN26         IFEQ      *OFF
047650940819     C                   MOVEL     *BLANKS       VIDCTM
047660940920     C                   MOVEL     *BLANKS       V1DCTM
047670940819     C                   ENDIF
047680940920     C* 28 ON - TASSAZ TARIFFA MITTENTE PERSONALIZZATO
047690940819     C     *IN28         IFEQ      *OFF
047700940819     C                   MOVEL     *BLANKS       VIDFTM
047710940819     C                   ENDIF
047720940921     C* 19 ON - MITTENTE PERSONALIZZATO
047730950303     C* 85 ON - COD.MITTENTE PERSONALIZZATO
047740940921     C     *IN19         IFEQ      *OFF
047750950303     C*
047760950303     C     *IN85         IFEQ      *OFF
047770950123     C                   CLEAR                   WCCMS
047780941005     C                   CLEAR                   VIDFLC
047790941005     C                   CLEAR                   VIDCCM
047800950303     C                   CLEAR                   VIDDMT
047810950303     C                   ENDIF
047820950303     C                   CLEAR                   V2DTEL
047830940921     C                   CLEAR                   VIDRSM
047840940921     C                   CLEAR                   VIDINM
047850940921     C                   CLEAR                   VIDCAM
047860940921     C                   CLEAR                   VIDPRM
047870950303     C                   CLEAR                   VIDLOM
047880940921     C                   CLEAR                   VIDPIM
047890061109     C                   CLEAR                   VIDcdf
047900061109     c                   movel     hiul          atrcdf
047910080804     c                   clear                   forzcdf           1
047920120504     c                   clear                   forzcdf1          1
047930061109     c                   clear                   savrsm
047940940921     C                   CLEAR                   VIDNZM
047950940921     C                   CLEAR                   VIDFAP
047960941020     C                   SETOFF                                       14
047970940921     C                   ENDIF
047980940825     C* DESTINATARIO
047990940819     C                   MOVEL     *BLANKS       VIDRSD
048000940819     C                   MOVEL     *BLANKS       VIDIND
048010940819     C                   MOVEL     *BLANKS       VIDLOD
048020940819     C                   MOVEL     *BLANKS       VIDPRD
048030940819     C                   MOVEL     *BLANKS       VARPRD
048040940819     C                   MOVEL     *BLANKS       VIDNZD
048050940819     C                   CLEAR                   VIDCAD
048060940928     C                   CLEAR                   VIDPID
048070940819     C                   MOVEL     *BLANKS       VIDFIN
048080030305     c                   Clear                   savdisag
048090070924     c                   Clear                   savpart
048100050214     c                   Clear                   wdesie
048110940819     C*
048120940915     C* ULTIMA SPEDIZIONE        SE IMMISSIONE BOLLA (12 OFF)
048130940819     C     *IN12         IFEQ      *OFF
048140010301     C     §LPFPR        ANDNE     'O'
048150900427     C                   Z-ADD     BLPNRS        PRENRS
048160900427     C                   Z-ADD     BLPNSP        PRENSP
048170941011     C                   MOVEL     BLPLNA        PRELNA
048180900427     C                   Z-ADD     BLPRMN        PRERMN
048190910128     C                   Z-ADD     BLPZNC        PREZNC
048200940819     C                   ENDIF
048210940819     C*
048220900427     C                   Z-ADD     0             VIDPKG
048230980402     C                   Z-ADD     0             SAVPKG
048240940819     C                   Z-ADD     0             V1CNCL
048250090609     c                   clear                   wncl_pre
048260090609     c                   clear                   wpes_pre
048270111026     c                   clear                   savtsp73
048280971222     C* PULISCO I CAMPI DELL'EXPORT SDI
048290971222     C                   CLEAR                   DSBL4E
048300900502     C* PULISCO ALCUNI CAMPI DEL FOR02
048310900517     C                   Z-ADD     0             VIDZNC
048320930628     C     *IN12         IFEQ      *ON
048330930628     C                   CLEAR                   VIDTCR
048340930628     C                   CLEAR                   VIDDCR
048350930628     C                   CLEAR                   VIDHCR
048360030409     c                   Clear                   VidOre
048370930628     C                   CLEAR                   VIDMCR
048380930628     C                   CLEAR                   VIDCTR
048390930628     C                   CLEAR                   DEFCTR
048400930628     C                   CLEAR                   VIDNAS
048410040610     c                   clear                   vidbva
048420960319     C                   CLEAR                   VIDGC1
048430960319     C                   CLEAR                   VIDGC2
048440930628     C                   ELSE
048450940920     C  N17              MOVEL     ' '           VIDTCR
048460930628     C  N16              MOVEL     *ZEROS        VIDDCR
048470940920     C  N23              MOVEL     *ZEROS        VIDHCR
048480940920     C  N23              MOVEL     *ZEROS        VIDMCR
048490030409     c                   If        wflagore = *Blanks
048500030409     c                   Clear                   VidOre
048510030409     c                   EndIf
048520930628     C  N29              CLEAR                   VIDCTR
048530930628     C  N29              CLEAR                   DEFCTR
048540940825     C  N27              CLEAR                   VIDNAS
048550040610     c     atrbva        ifne      prri
048560040610     c                   clear                   vidbva
048570040610     c                   endif
048580960319     C  N91              CLEAR                   VIDGC1
048590960319     C  N91              CLEAR                   VIDGC2
048600960319     C                   ENDIF
048610990630     C* MEMORIZZO E PROTEGGO LA DATA PER I PREPAGATI
048620990630     C     PARTCH        IFEQ      'P'
048630010301     C     §LPFPR        OREQ      'O'
048640990630     C                   Z-ADD     WDTGIO        VIDDSP
048650990701     C                   SETON                                        2426
048660990630     C                   SETON                                        3422
048670990630     C* IMPOSTO FISSO IL CTM
048680990630     C                   MOVEL     §3ICTP        VIDCTM
048690990630     C* IMPOSTO IL COD MITTENTE --> 8888
048700990720     C* SOLO SE NON PERSONALIZZATO
048710010307     C     PARTCH        IFEQ      'P'
048720990720     C  N19
048730990720     CANN85              Z-ADD     8888          VIDCCM
048740010307     C                   ENDIF
048750990630     C                   ENDIF
048760050126     c* autotrasportatore
048770050426     c***  atrpdr        ifne      prri
048780050426     c***                clear                   vidpdr
048790050426     c***                clear                   v1dpdr
048800050426     c**n34              movel     '?'           vidpdr
048810050426     c***                endif
048820050126     c* flag mattino pomeriggio
048830050426     c***  atrfpp        ifne      prri
048840050426     c***                clear                   vidfpp
048850050426     c***                endif
048860031113     c                   Clear                   VidRef
048870031113     c                   Clear                   VidTel
048880031219     c                   Clear                   wrifp
048890141031     c                   Clear                   wPinCode
048900000120     C*
048910000120     C                   CLEAR                   VIDDPD
048920000120     C                   CLEAR                   VIDNRD
048930000120     C                   CLEAR                   COMNRD
048940050315     C                   MOVE      *BLANKS       VIDFFD
048950010223     C                   CLEAR                   WOVUO
048960070427     C                   CLEAR                   WOVUO1
048970010226     C                   CLEAR                   CHGORM
048980090327     C                   CLEAR                   CHGORM1
048990091120     C                   CLEAR                   CHGORM2
049000090327     C                   CLEAR                   w_fcli
049010110512     c* imposto no display l'attributo della costante video:"F17=ind.mail dest
049020110512     c* che deve essere visualizzata solo quando ricevo il dato da VAT
049030150213     c                   movel     nodi          atremd
049040150213     c***                movel     ndpr          atrwemd
049050150213     c***                movel     ndpr          atrwtel
049060110512     c                   clear                   wemdest
049070160511     c                   clear                   sav_wemdest
049080130315     c                   clear                   wsms
049090160511     c                   clear                   sav_wsms
049100130315     c                   clear                   wsmp
049110130918     c                   clear                   wmmp
049120130923     c                   clear                   wmmp_ar5
049130110705     c* visualizzazione f19=CUP/CIG solo da data attivazione
049140110705     C                   IF        DATEU < §VPOTFF
049150110705     c                   movel     nodi          atrCUP
049160110705     C                   ELSE
049170110705     c                   clear                   atrCUP
049180110705     C                   ENDIF
049190110706     c                   clear                   wcupcup
049200110706     c                   clear                   wcupcig
049210141201     c                   clear                   wpincode
049220130311
049230130311     c                   clear                   wvatpe
049240160323     c                   clear                   wtip
049250160323     c                   clear                   w_vediP
049260900427     C                   ENDSR
049270070831     C*
049280070831     C* inizializzazione campo data ritiro --------------------------*
049290070831     C     inzdrt        BEGSR
049300070831     c* data ritiro=udate se data ritiro non personalizzata
049310070831     C  N12PARTCH        IFNE      'P'
049320070831     C     §LPFPR        ANDNE     'O'
049330071107     c***  dateu         andge     §vpodrt
049340070831     c                   if        atrdrt<>prri or viddrt=0
049350070831     C                   MOVEL     WDTGIO        VIDDRT
049360070831     c                   endif
049370070831     c                   endif
049380070831     c                   endsr
049390940819     C*
049400940819     C* GESTIONE VIDEATA DI PERSONALIZZAZIONE -----------------------*
049410050118     C     GESD00        BEGSR
049420940824     C                   MOVEL     'P'           WPERSO            1
049430940819     C*
049440941230     C                   CLEAR                   V0CRSM
049450941230     C                   CLEAR                   V0CINM
049460941230     C                   CLEAR                   V0CCAM
049470941230     C                   CLEAR                   V0CLOM
049480941230     C                   CLEAR                   V0CPRM
049490941230     C                   CLEAR                   V0CNZM
049500941230     C                   CLEAR                   V0CPIM
049510061109     C                   CLEAR                   V0Ccdf
049520061109     c                   movel     hiul          atrcdf
049530941230     C                   CLEAR                   V0CFAP
049540941230     C                   CLEAR                   V0CLNA
049550941230     C                   CLEAR                   V0CCBO
049560941230     C                   CLEAR                   V0CTSP
049570941230     C                   CLEAR                   V0CCTM
049580941230     C                   CLEAR                   V0CCCM
049590941230     C                   CLEAR                   V0CFLC
049600941230     C                   CLEAR                   V0CCTR
049610941230     C                   CLEAR                   V0CNAS
049620040610     C                   CLEAR                   V0Cbva
049630941230     C                   CLEAR                   V0CTCR
049640941230     C                   CLEAR                   V0CDCR
049650941230     C                   CLEAR                   V0CHCR
049660941230     C                   CLEAR                   V0CMCR
049670941230     C                   CLEAR                   V0CRMO
049680941230     C                   CLEAR                   V0CNMO
049690941230     C                   CLEAR                   V0CCMO
049700960319     C                   CLEAR                   V0CGC1
049710960319     C                   CLEAR                   V0CGC2
049720010209     C                   CLEAR                   V0CNOR
049730010209     C                   CLEAR                   V0CNRV
049740030409     c                   Clear                   V0cOre
049750050426     c***                clear                   v0cpdr
049760050426     c***                clear                   v0cfpp
049770940819     C* MUOVO TUTTI I CAMPI DAL VIDEO 1 PER LA PERSONALIZZAIZONE
049780941230     C* SOLO SE LI AVEVO PERSONALI<ZZATI E QUELLI CHE RIMANGONO
049790941230     C*  SEMPRE IMPOSTATI
049800941230     C                   MOVEL     VIDSOP        V0CSOP
049810010502     C* NON IMPOSTO, NELLA VIDEATA DI PERSONALIZZAZIONE LA RICERCA ALFA
049820010502     C* BETICA SU PADRONCINO SE ATTIVATA PROCEDURA ORM
049830050426     c***  atrpdr        ifeq      prri
049840050426     C     WORM          IFNE      'S'
049850050426     C     VIDPDR        ORNE      '?   '
049860940819     C                   MOVEL     VIDPDR        V0CPDR
049870050426     c***                clear                   vidpdr
049880010502     C                   ENDIF
049890050426     c***  atrfpp        ifeq      prri
049900050126     C                   MOVEL     VIDFPP        V0CFPP
049910050426     c***                clear                   vidfpp
049920050426     c***                endif
049930940819     C                   MOVEL     VIDNRT        V0CNRT
049940940819     C                   MOVEL     VIDLNP        V0CLNP
049950010222     C                   Z-ADD     VIDPOE        V0CPOE
049960010222     C   37              Z-ADD     VIDNOR        V0CNOR
049970041108     C   37              Z-ADD     VIDNRV        V0CNRV
049980070828     c***37              movel     atrdaorm      at0daorm
049990070828     c                   movel     nodi          at0daorm
050000071107     c***                if        dateu>=§vpodrt
050010070828     c                   clear                   viddrt
050020071107     c***                endif
050030041220     c                   z-add     vidpoe        s_v0cpoe
050040041220     c                   z-add     vidnor        s_v0cnor
050050041220     c                   z-add     vidnrv        s_v0cnrv
050060050315     C   37              MOVE      'P'           s_ormpers
050070050315     C  N37              MOVE      ' '           s_ormpers
050080010222     C   37              CLEAR                   VIDPOE
050090010222     C   37              CLEAR                   VIDNOR
050100010222     C   37              CLEAR                   VIDNRV
050110941230     C   20              MOVEL     VIDLNA        V0CLNA
050120941231     C   20              CLEAR                   VIDLNA
050130941230     C   21              MOVEL     VIDCBO        V0CCBO
050140941231     C   21              CLEAR                   VIDCBO
050150941230     C   18              MOVEL     VIDTSP        V0CTSP
050160941231     C   18              CLEAR                   VIDTSP
050170941230     C   26              MOVEL     VIDCTM        V0CCTM
050180941231     C   26              CLEAR                   VIDCTM
050190950125     C     *IN19         IFEQ      *ON
050200950303     C     *IN85         OREQ      *ON
050210950125     C                   MOVEL     VIDCCM        V0CCCM
050220950125     C                   CLEAR                   VIDCCM
050230050120     c***                clear                   viddmt
050240950125     C                   MOVEL     VIDFLC        V0CFLC
050250950125     C                   CLEAR                   VIDFLC
050260950303     C                   ENDIF
050270941221     C* SE NON E' UN CODIFICATO, IMPOSTO IL MITTENTE COSI' COME E'
050280950303     C     *IN19         IFEQ      *ON
050290020507     C     V0CCCM        ifeQ      8888
050300950125     C     V0CCCM        OREQ      9999
050310940819     C                   MOVEL     VIDRSM        V0CRSM
050320940819     C                   MOVEL     VIDINM        V0CINM
050330940819     C                   MOVEL     VIDLOM        V0CLOM
050340940819     C                   MOVEL     VIDCAM        V0CCAM
050350940819     C                   MOVEL     VIDPRM        V0CPRM
050360940819     C                   MOVEL     VIDNZM        V0CNZM
050370940819     C                   MOVEL     VIDFAP        V0CFAP
050380940819     C                   MOVEL     VIDPIM        V0CPIM
050390061109     C                   MOVEL     VIDcdf        V0Ccdf
050400950125     C                   ENDIF
050410941231     C                   CLEAR                   VIDRSM
050420941231     C                   CLEAR                   VIDINM
050430941231     C                   CLEAR                   VIDLOM
050440941231     C                   CLEAR                   VIDCAM
050450941231     C                   CLEAR                   VIDPRM
050460941231     C                   CLEAR                   VIDNZM
050470941231     C                   CLEAR                   VIDFAP
050480941231     C                   CLEAR                   VIDPIM
050490061109     C                   CLEAR                   VIDcdf
050500941230     C                   ENDIF
050510941230     C   28              MOVEL     VIDFTM        V0CFTM
050520941231     C   28              CLEAR                   VIDFTM
050530941230     C   27              MOVEL     VIDNAS        V0CNAS
050540941231     C   27              CLEAR                   VIDNAS
050550040610     c     atrbva        ifeq      prri
050560040610     C                   MOVEL     VIDbva        V0Cbva
050570040610     C                   CLEAR                   VIDbva
050580040610     c                   endif
050590941230     C   17              MOVEL     VIDTCR        V0CTCR
050600941231     C   17              CLEAR                   VIDTCR
050610941230     C   16              MOVEL     VIDDCR        V0CDCR
050620941231     C   16              CLEAR                   VIDDCR
050630941230     C   23              MOVEL     VIDHCR        V0CHCR
050640941230     C   23              MOVEL     VIDMCR        V0CMCR
050650941231     C   23              CLEAR                   VIDHCR
050660941231     C   23              CLEAR                   VIDMCR
050670030409     c                   If        wflagore = '1'
050680030409     c                   Eval      V0cOre = VidOre
050690030409     c                   Clear                   VidOre
050700030409     c                   EndIf
050710941230     C   03              MOVEL     VIDRMO        V0CRMO
050720941230     C   03              MOVEL     VIDNMO        V0CNMO
050730941231     C   03              CLEAR                   VIDRMO
050740941231     C   03              CLEAR                   VIDNMO
050750941230     C   03              MOVEL     VIDCMO        V0CCMO
050760941231     C   03              CLEAR                   VIDCMO
050770950206     C   29              MOVEL     VIDCTR        V0CCTR
050780950206     C   29              CLEAR                   VIDCTR
050790960319     C     *IN91         IFEQ      *ON
050800960319     C                   MOVEL     VIDGC1        V0CGC1
050810960319     C                   CLEAR                   VIDGC1
050820960319     C                   MOVEL     VIDGC2        V0CGC2
050830960319     C                   CLEAR                   VIDGC2
050840960319     C                   ENDIF
050850050119     C                   MOVEL     *BLANKS       VIDDMT
050860940819     C*
050870990720     C* SPENGO GLI INDICATORI DI PROTEZIONE DELLA VIDEATA DELLE PERSON
050880990719     C*  CHE SERVONO PER LA PROCEDURA PREPAGATI
050890990719     C     PARTCH        IFNE      'P'
050900010307     C     §LPFPR        ANDNE     'O'
050910990720     C                   SETOFF                                       2426
050920990719     C                   ENDIF
050930990720     C                   SETOFF                                       19
050940041214     C* ABILITA LA RICERCA ALFABETICA
050950041214     C                   SETON                                        01
050960041214     C                   SETOFF                                       1438
050970990719     C**
050980940819     C     FORD00        TAG
050990041109     c****               z-add     v0cnrv        v0cnrvv
051000071107     c****               if        dateu>=§vpodrt
051010070828     c                   clear                   atrdrt
051020071107     c****               endif
051030940819     C                   EXFMT     LS01D00
051040041109     c****               z-add     v0cnrvv       v0cnrv
051050940819     C* CMD3 - FINE LAVORO
051060940819     C   KC              GOTO      ENDG00
051070161215     C* F8 - INTERROGAZIONE O.R.M.
051080010223     C     *INKH         IFEQ      *ON
051090010226     C     WORM          ANDEQ     'S'
051100010227     C     PARTCH        ANDNE     'P'
051110010220     C     V0CNOR        ANDEQ     *ZEROS
051120111123     c* se lnp import continuo a richiamare FIOR04R
051130111123     c****               if        %lookup(v0clnp:fio)=0
051140111123     c*****                        and %lookup(999:fio)=0
051150111123     c                   if        v0clnp>pr0lnp
051160111123     c                   clear                   og143
051170111123     C     v0clnp        CHAIN     AZORG01L      UNIORG
051180111123     c                   if        %found(azorg01l)
051190111123     C                   MOVEL     ORGDE3        OG143
051200111123     c                   endif
051210111123     c                   eval      pr0lnp=v0clnp
051220111123     c                   endif
051230111123     c                   if        §ogntw='DPD' or §ogntw='EEX' or
051240111123     c                             §ogntw='FED'
051250150928     C                   CLEAR                   fior010ds
051260150928     C                   MOVEL     '1'           Ior010ric
051270150928     C                   Z-ADD     V0CLNP        ior010por
051280051207     c
051290150928     C                   CALL      'FIOR010R'
051300150928     C                   PARM                    KPJBA
051310150928     C                   PARM                    fior010ds
051320150928     C     OOR010F03     IFEQ      *BLANKS
051330150928     C     OOR010F12     andeq     *BLANKS
051340150928     C     OOR010err     andeq     *BLANKS
051350150928     C                   Z-ADD     OOR010POE     V0CPOE
051360150928     C                   MOVEL     OOR010NSR     V0CNOR
051370150928     C                   MOVE      OOR010NOR     V0CNOR
051380150928     C                   Z-ADD     OOR010NRV     V0CNRV
051390050117     c                   eval      *inkh = '0'
051400050117     c                   else
051410010226     C                   GOTO      FORD00
051420050117     c                   endif
051430110419     c                   else
051440161215     c                   setoff                                       30
051450161215     c                   clear                   w001a
051460161215     c                   if        v0cpdr>*zeros
051470161215     C                   TESTN                   v0cpdr               30
051480161215     C                   MOVE      v0cpdr        W001A
051490161215     c                   endif
051500161215     c                   if        v0cpdr<=*zeros or not *in30 or
051510161215     c                             w001a<'0'
051520110419     c                   eval      *in90='1'
051530110419     c                   eval      *in56='1'
051540110419     c                   eval      vidmsg=err(210)
051550110419     c                   goto      ford00
051560110419     c                   else
051570110419     c                   clear                   fior58ds
051580110419     c                   movel     v0clnp        ior58pdr
051590110419     c                   move      v0cpdr        IOR58PDR
051600110419     C                   CALL      'FIOR58R'
051610110419     C                   PARM                    KPJBA
051620110419     C                   PARM                    fior58ds
051630110419     C     OOR58F03      IFEQ      *BLANKS
051640110419     C                   Z-ADD     OOR58POE      V0cPOE
051650110419     C                   MOVEL     OOR58NSR      V0cNOR
051660110419     C                   MOVE      OOR58NOR      V0cNOR
051670110419     C                   Z-ADD     OOR58NRV      V0cNRV
051680110419     c                   eval      *inkh = '0'
051690110419     c                   else
051700110419     C                   GOTO      FORd00
051710110419     c                   endif
051720110419     c                   endif
051730110419     c                   endif
051740010226     C                   ENDIF
051750010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
051760010227     C* SE NON SEMPRE VISUALIZZATO. PER CMD8 E PROCEDURA NON ATTIVATA
051770010227     C* O SONO NEL GIRO DEI MIEI PREPAGATI RIEMETTO SEMPRE LA VIDEATA
051780010227     C   KHWORM          IFNE      'S'
051790010227     C     PARTCH        OREQ      'P'
051800010227     C                   GOTO      FORD00
051810010227     C                   ENDIF
051820940819     C*
051830940819     C* CONTROLLO CAMPI PERSONALIZZATI
051840940819     C                   EXSR      CTRD00
051850940929     C     WEMFOR        IFEQ      '1'
051860040908     c* Se no Errori ma non premuto F6 riemetto la videata
051870040908     c     *inkf         oreq      *off
051880940929     C                   GOTO      FORD00
051890940929     C                   ENDIF
051900041220     c* SOLO SE CAMBIATO ORM:
051910041220     c* pulisco la prima videata per essere sicura che
051920041220     c* non rimangano impostati campi del precedente orm ma non giusti per i
051930041220     c* l nuovo ORM
051940050315     c                   if        s_v0corm <> v0corm and (v0corm1 > 0 or
051950050315     c                             s_ormpers='P')
051960041220     c                   exsr      inz01
051970041220     c                   endif
051980070831     c
051990070831     c* Se non è cambiato l'ORM ma la data ritiro è = 0 forzo comunque
052000070831     c* data ritiro=udate
052010070831     c                   if        viddrt=0
052020070831     c                   exsr      inzdrt
052030070831     c                   endif
052040070831     c
052050940819     C*
052060940819     C* MUOVO TUTTI I CAMPI CHE HO PERSONALIZZATO
052070041129     c*
052080940819     C                   MOVEL     V0CSOP        VIDSOP
052090050426     c***  atrpdr        ifeq      prri
052100940819     C                   MOVEL     V0CPDR        VIDPDR
052110050426     c***                endif
052120070806     c                   movel     at0daorm      atrdaorm
052130011122     C* SE SONO IN IMMISSIONE PREPAGATI NON DEVO METTERE "?" IN QUANTO
052140011122     C* IN QUESTO CASO IL CODICE AUTOTRASPORTATORE NON E' DA IMMETTERE
052150011122     C  N34V0CPDR        IFEQ      *BLANKS
052160010502     C     WORM          ANDEQ     'S'
052170010502     C                   MOVEL     '?   '        VIDPDR
052180050128     c                   clear                   v1dpdr
052190010502     C                   ENDIF
052200960926     C* SE HO GIA' INSERITO IL AUTOTRASPORTATORE MI POSIZIONO SOTTO
052210950206     C     V0CPDR        IFGT      *ZEROS
052220010222     C     WORM          IFEQ      'S'
052230010222     C     PARTCH        ANDNE     'P'
052240010307     C     §LPFPR        ANDNE     'O'
052250010222     C                   SETON                                        06
052260010222     C                   ELSE
052270950206     C                   SETON                                        07
052280010222     C                   ENDIF
052290950206     C                   ENDIF
052300940819     C                   MOVEL     V0CNRT        VIDNRT
052310050426     c***  atrfpp        ifeq      prri
052320940819     C                   MOVEL     V0CFPP        VIDFPP
052330050426     c***                endif
052340940819     C                   MOVEL     V0CLNP        VIDLNP
052350010222     C                   Z-ADD     V0CPOE        VIDPOE
052360010222     C   37              Z-ADD     V0CNOR        VIDNOR
052370010222     C   37              Z-ADD     V0CNRV        VIDNRV
052380941230     C   20              MOVEL     V0CLNA        VIDLNA
052390941230     C   21              MOVEL     V0CCBO        VIDCBO
052400941230     C   18              MOVEL     V0CTSP        VIDTSP
052410941230     C   26              MOVEL     V0CCTM        VIDCTM
052420941230     C*
052430941230     C     *IN19         IFEQ      *ON
052440950303     C     *IN85         OREQ      *ON
052450941230     C                   MOVEL     V0CCCM        VIDCCM
052460941230     C                   MOVEL     V0CFLC        VIDFLC
052470941011     C     V0CFLC        IFNE      0
052480941020     C                   SETON                                        14
052490941011     C                   ENDIF
052500950303     C                   ENDIF
052510940825     C*
052520940825     C* IMPOSTO I CAMPI DEL MITTENTE SE PERSONALIZZATO
052530061109    1C     *IN19         IFEQ      *ON
052540061109    2C     V0CINM        IFEQ      *BLANKS
052550940825     C                   MOVEL     ACORAG        VIDRSM
052560940825     C                   MOVEL     ACORAG        VIDDMT
052570940825     C                   MOVEL     INDVIA        VIDINM
052580941005     C                   MOVEL     INDCAE        VIDCAM
052590940825     C                   MOVEL     INDCIT        VIDLOM
052600940825     C                   MOVEL     INDPRV        VIDPRM
052610940825     C                   MOVEL     INDSTA        VIDNZM
052620940825     C                   MOVEL     INDIVA        WISO
052630950125     C     WISO          IFGE      '00'
052640940825     C                   MOVEL     INDIVA        VIDCPM
052650120504     C                   clear                   VIDism
052660940825     C                   ELSE
052670940825     C                   MOVEL     INDIVA        VIDPIM
052680940825     C                   ENDIF
052690120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
052700120508     c* in contabilità crea problemi
052710120508     c                   if        *in22 and wiso='$$'
052720120508     c                   clear                   vidpim
052730120508     c                   endif
052740061110     c   22              movel     indcdf        vidcdf
052750941230     C*
052760061109   x2C                   ELSE
052770941230     C*
052780941230     C                   MOVEL     V0CRSM        VIDRSM
052790941230     C                   MOVEL     V0CINM        VIDINM
052800941230     C                   MOVEL     V0CLOM        VIDLOM
052810941230     C                   MOVEL     V0CCAM        VIDCAM
052820941230     C                   MOVEL     V0CPRM        VIDPRM
052830941230     C                   MOVEL     V0CNZM        VIDNZM
052840941230     C                   MOVEL     V0CFAP        VIDFAP
052850941230     C                   MOVEL     V0CPIM        VIDPIM
052860061109     C                   CLEAR                   VIDcdf
052870071023     c                   eval      w_callyco=' '
052880071023     c* Codice fiscale: se non c'e' effettuo la ricerca
052890061110    3c   22              if        v0ccdf<>*BLANKS
052900061109     C                   MOVEL     V0Ccdf        VIDcdf
052910061109   x3C                   ELSE
052920061109    4c                   if        vidnzm=*blanks
052930061110     c* richiamo pgm di richiesta
052940071023     c****               EXSR      CAlLyco
052950071023     c                   eval      w_callyco='1'
052960061109     c
052970061109    4C                   endif
052980061109    3C                   endif
052990071023     c* Partita Iva: se non c'e' effettuo la ricerca
053000071023    3c   22              if        vidpim=*BLANKS and vidnzm=*blanks
053010071023     c* memorizzo di richiamare pgm di richiesta
053020071023     c                   eval      w_callyco='1'
053030071023    3C                   endif
053040071023
053050120503     c                   if        w_callyco='1'
053060120503     c                   exsr      CALLyco
053070120503     c                   endif
053080061109     c
053090061109    2C                   ENDIF
053100061109     c* proteggo il campo del codice fiscale
053110061109     c                   movel     riul          atrcdf
053120061109    1C                   ENDIF
053130941230     C* IMPOSTO SOLO QUELLI PESONALIZZATI, GLI ALTRI LI LASCIO
053140941230     C*  COME SONO
053150950206     C   29              MOVEL     V0CCTR        VIDCTR
053160950206     C   28              MOVEL     V0CFTM        VIDFTM
053170941230     C   27              MOVEL     V0CNAS        VIDNAS
053180040610     c     atrbva        ifeq      prri
053190040610     c                   movel     v0cbva        vidbva
053200040610     c                   endif
053210941230     C   17              MOVEL     V0CTCR        VIDTCR
053220941230     C   16              MOVEL     V0CDCR        VIDDCR
053230941230     C   23              MOVEL     V0CHCR        VIDHCR
053240941230     C   23              MOVEL     V0CMCR        VIDMCR
053250030409     c                   If        wflagore = '1'
053260030409     c                   Eval      VidOre = V0cOre
053270030409     c                   EndIf
053280941230     C   03              MOVEL     V0CRMO        VIDRMO
053290941230     C   03              MOVEL     V0CNMO        VIDNMO
053300941230     C   03              MOVEL     V0CCMO        VIDCMO
053310960319     C   91              MOVEL     V0CGC1        VIDGC1
053320960319     C   91              MOVEL     V0CGC2        VIDGC2
053330940824     C* FINE PERSONALIZZAZIONE
053340940921     C                   SETOFF                                       01
053350940824     C                   MOVEL     ' '           WPERSO            1
053360940819    2C     ENDG00        ENDSR
053370061110     c*
053380061110     c* RICHIAMO PGM DI RICERCA COD FISCALE X 8888 O 9999-----------------*
053390061110     c     CALLYCO       BEGSR
053400061110     c                   eval      i600ela='R'
053410071023     c                   if        vidcdf=*blanks
053420061110     c                   eval      i600aCF='SI'
053430071023     c                   endif
053440071023     c                   if        vidpim=*blanks
053450071023     c                   eval      i600api='SI'
053460071023     c                   endif
053470061110     c     *iso          movel     20000101      i600dti
053480061110     c     *iso          movel     29991231      i600dtf
053490061110     c                   eval      i600rsc=vidrsm
053500061110     c                   eval      i600ind=vidinm
053510061110     c                   eval      i600cap=vidcam
053520061110     c                   eval      i600loc=vidlom
053530061110     c                   eval      i600prv=vidprm
053540061110     c                   movel     yco600ds      kpjbu
053550061110     c                   call      'YCO601R'
053560061110     c                   parm                    kpjba
053570061110     c
053580061110     c                   movel     kpjbu         yco600ds
053590061110    5c                   if        o600err=*blanks
053600071023     c                   if        vidcdf=*blanks
053610061110     c                   movel     o600cdfi      vidcdf
053620071023     c                   endif
053630071023     c                   if        vidpim=*blanks
053640071023     c                   movel     o600piva      wpiva
053650071023     c                   exsr      sr_wpiva
053660120508     c* Se partita iva $$ la puilisco: crea problemi in contabilità
053670120508     c                   if        vidism='$$'
053680120508     c                   clear                   vidpim
053690120508     c                   endif
053700071023     c                   endif
053710061110    5c                   endif
053720061110     c                   ENDSR
053730900427     C*
053740900427     C*--- CONTROLLO CAMPI PERSONALIZZAZIONE -------------------------*
053750940819     C     CTRD00        BEGSR
053760941115     C                   CLEAR                   VIDMSG
053770941103     C                   CLEAR                   WCMO
053780941103     C                   CLEAR                   WNAR
053790940824     C                   CLEAR                   WCBO
053800940824     C                   CLEAR                   WLNP
053810940824     C                   CLEAR                   WPDR
053820940824     C                   CLEAR                   WLNA
053830940824     C                   CLEAR                   WCTM
053840940824     C                   CLEAR                   WCCM
053850940825     C                   CLEAR                   WFTM
053860940824     C                   CLEAR                   WTSP
053870960319     C                   CLEAR                   WGC1
053880960319     C                   CLEAR                   WGC2
053890940929     C                   SETOFF                                       90
053900941003     C* SPENGO GLI INDICATORI DI PERSONALIZZAZIONE
053910941004     C                   SETOFF                                       161710
053920941103     C                   SETOFF                                       181903
053930990720     C                   SETOFF                                       202123
053940941003     C                   SETOFF                                       272829
053950990720     C                   SETOFF                                       859119
053960010222     C                   SETOFF                                       37
053970030409     c                   Clear                   wflagore
053980040610     c                   movel     hiul          atrbva
053990050426     c****               clear                   atrpdr
054000050426     c****               clear                   atrfpp
054010070829     c                   clear                   atrdrt
054020990602     C* GLI INDICATORI DELLA DATA E CTM LI SPENGO SOLO SE
054030990602     C*  NON PROVENGO DA PREPAGATI
054040990602     C     PARTCH        IFNE      'P'
054050010307     C     §LPFPR        ANDNE     'O'
054060990720     C                   SETOFF                                       2426
054070990602     C                   ENDIF
054080940929     C* SPENGO GLI INDICATORI DI POSIZONAMENTO CURSORE
054090940929     C                   SETOFF                                       404142
054100940929     C                   SETOFF                                       435645
054110940929     C                   SETOFF                                       464748
054120940929     C                   SETOFF                                       495051
054130940929     C                   SETOFF                                       525354
054140940929     C                   SETOFF                                       556870
054150940929     C                   SETOFF                                       585960
054160960319     C                   SETOFF                                       616274
054170040611     c                   clear                   h0riga
054180040611     c                   clear                   h0colo
054190030411     c                   Clear                   At0Tcr
054200030415     c                   Clear                   At0Ore
054210940929     C                   CLEAR                   WEMFOR
054220950504     C                   CLEAR                   DS3A
054230950209     C***
054240950209     C*** RICERCA ALFABETICA
054250950209     C                   MOVEL     V0CLNP        WLNP
054260950209     C                   Z-ADD     V0CCCM        WCCM
054270950209    2C     V0CFLC        IFNE      0
054280950209     C                   Z-ADD     V0CFLC        WFLC
054290950209     C                   ELSE
054300950209     C                   Z-ADD     V0CLNP        WFLC
054310950209    2C                   ENDIF
054320950209     C                   MOVEL(P)  V0CRSM        PAXDMT
054330050119     C                   CLEAR                   VIDDMT
054340950209     C* ESEGUO RICERCA ALFABETICA
054350950209     C                   EXSR      RICALF
054360950209     C                   MOVE      WCCM          V0CCCM
054370950209     C     *IN14         IFEQ      *ON
054380950209     C                   MOVEL     WFLC          V0CFLC
054390950209     C                   ENDIF
054400940822     C***
054410910208     C*** DATA SPEDIZIONE ***
054420930708     C                   EXSR      CTRDSP
054430001031     C   90              GOTO      ENDC00
054440940920     C***
054450940920     C*** SIGLA OPERATORE ***
054460940920     C* CONTROLLO SOLO SE NON E' PROTETTO
054470940928    1C     *IN13         IFEQ      *OFF
054480940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
054490940920     C                   MOVEL     '3M'          COD
054500940920     C                   MOVEL(P)  V0CSOP        KEY
054510940920     C                   EXSR      CTABEL
054520940928    2C     *IN30         IFEQ      *OFF
054530950713     C     V0CSOP        OREQ      ' '
054540940920     C                   MOVEL     ERR(29)       VIDMSG
054550940920     C                   SETON                                        4290
054560940920     C                   GOTO      ENDC00
054570940928    2C                   ENDIF
054580940928    1C                   ENDIF
054590940822     C***
054600940824     C*** DATA RITIRO MERCE ***
054610070806     C***                EXSR      CTRDRT
054620070806     C***90              GOTO      ENDC00
054630940822     C***
054640940819     C*** LINEA PARTENZA ***
054650940928     C                   MOVEL     V0CLNP        WLNP
054660940824     C                   EXSR      CTRLNP
054670940824     C   90              GOTO      ENDC00
054680010213     C***
054690010213     C*** NUMERO O.R.M.
054700010213     C*
054710010213     C* Controllo solo se attivata procedura O.R.M.
054720010213     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
054730010213     c* fine dell'immissione
054740010213     C     WORM          IFEQ      'S'
054750010213     C     PARTCH        ANDNE     'P'
054760010213     C                   Z-ADD     V0CPOE        WOPOE
054770010213     C                   Z-ADD     V0CNOR        WONOR
054780010213     C                   Z-ADD     V0CNRV        WONRV
054790010213     C                   Z-ADD     V0CLNP        WOLNP
054800010222     C     WIDOR1        IFGT      *ZEROS
054810010213     C                   EXSR      CTRORM
054820010213     C   90              GOTO      ENDC00
054830010216     C     WEMFOR        IFEQ      '1'
054840010216     C                   GOTO      ENDC00
054850010216     C                   ENDIF
054860010222     C                   ENDIF
054870010213     C                   ENDIF
054880010227     C* SE PREMUTO F8 E SONO NEL GIRO DEI PREPAGATI DEVO RIEMETTERE LA
054890010227     C* VIDEATA
054900010227     C   KH              GOTO      ENDC00
054910070806     c***
054920070806     C*** DATA RITIRO MERCE ***
054930070806     c* se orm non fittizio forzo data ritiro prendendola da ORM
054940070806     c                   if        flgfit <> 'S' and widor1>*zeros
054950071107     c*****                        and dateu>=§vpodrt
054960070828     c                   clear                   weform
054970070806     c                   exsr      fordrt
054980070831     c                   if        weform='1'
054990070831     c                   eval      wemfor='1'
055000070828     c                   goto      endc00
055010070828     c                   endif
055020070806     c                   endif
055030070828     c* se orm fittizio non controllo la data ritiro se non immessa
055040070905     c***                if        flgfit='S' and widor1>*zeros and viddrt=0
055050070905     c***                          and dateu>=§vpodrt
055060070905     c***                else
055070070806     C                   EXSR      CTRDRT
055080070806     C   90              GOTO      ENDC00
055090070905     c***                endif
055100070831     c* se immesso orm  proteggo la data ritiro
055110070831     c                   if        widor1>*zeros and viddrt>0
055120071107     c****                         and dateu>=§vpodrt
055130070828     c                   eval      atrdrt=prri
055140070828     c                   endif
055150940822     c***
055160960926     C*** CODICE AUTOTRASPORTATORE ***
055170940928    1C     V0CPDR        IFNE      *BLANKS
055180940824     C     V0CPDR        ANDNE     *ZEROS
055190940824     C*
055200940928     C                   MOVE      V0CPDR        WPDR
055210940824     C                   EXSR      CTRPDR
055220940915     C                   MOVE      WPDR          V0CPDR
055230940928    2C     WEMFOR        IFEQ      '1'
055240940824     C                   GOTO      ENDC00
055250940928    2C                   ENDIF
055260050126     c*
055270050426     c***                movel     prri          atrpdr
055280940824     C*
055290940928    1C                   ENDIF
055300050126     c*** FLAG MATTINO/POMERIGGIO  ***
055310050426     c***  v0cfpp        ifne      *blanks
055320050426     c***                movel     prri          atrfpp
055330050426     c***                endif
055340940822     C***
055350940822     C*** CODICE BOLLA ***
055360940928    1C     V0CCBO        IFNE      *BLANKS
055370940824     C*
055380940824     C                   MOVEL     V0CCBO        WCBO
055390940824     C                   EXSR      CTRCBO
055400940824     C                   MOVEL     WCBO          V0CCBO
055410940928    2C     WEMFOR        IFEQ      '1'
055420940824     C                   GOTO      ENDC00
055430940928    2C                   ENDIF
055440940824     C*
055450940928    1C                   ENDIF
055460940822     C***
055470940822     C*** LINEA ARRIVO ***
055480940824     C                   MOVEL     V0CLNA        WLNA
055490110217     C                   EXSR      CTRLNA_vid
055500940824     C                   MOVEL     WLNA          V0CLNA
055510940928    1C     WEMFOR        IFEQ      '1'
055520940824     C                   GOTO      ENDC00
055530940928    1C                   ENDIF
055540940824     C***
055550940822     C*** TIPO SERVIZIO ***
055560940824     C                   MOVEL     V0CTSP        WTSP
055570940824     C                   EXSR      CTRTSP
055580940824     C                   MOVEL     WTSP          V0CTSP
055590940928    1C     WEMFOR        IFEQ      '1'
055600940824     C                   GOTO      ENDC00
055610940928    1C                   ENDIF
055620940824     C***
055630940822     C*** CODICE TRATTAMENTO MERCE ***
055640940928     C* CONTROLLO SOLO SE IMMESSO
055650950504    1C     V0CCTM        IFNE      *BLANKS
055660940824     C                   MOVEL     V0CCTM        WCTM
055670940824     C                   EXSR      CTRCTM
055680940824     C                   MOVEL     WCTM          V0CCTM
055690950504    2C     WEMFOR        IFEQ      '1'
055700940824     C                   GOTO      ENDC00
055710950504    2C                   ENDIF
055720040611     c                   ENDIF
055730040611     c*** TIPO MERCE V-VALORE
055740040611     c     v0cbva        ifne      *blanks
055750040611     c     v0cctm        ifne      *blanks
055760040611     c     §1bfg8        andeq     'N'
055770040611     c                   Eval      *In90 = *On
055780040611     c                   Eval      VidMsg = Err(281)
055790040611     c                   z-add     21            H0riga
055800040611     c                   z-add     73            H0colo
055810040611     c                   GoTo      EndC00
055820040611     c                   endif
055830040611     c                   movel     prri          atrbva
055840040611     c                   endif
055850040611     C* PERSONALIZZAZIONE CTM
055860040611    1C     V0CCTM        IFNE      *BLANKS
055870950504     C                   SETON                                        26
055880950504     C                   MOVEL     TBLUNI        V1DCTM
055890940928    1C                   ENDIF
055900940822     C*
055910940822     C*** CODICE CLIENTE ***
055920940928    1C     V0CCCM        IFNE      0
055930940824     C     V0CRSM        ORNE      *BLANKS
055940940824     C*
055950940825     C                   MOVEL     V0CFTM        WFTM
055960940915     C                   Z-ADD     V0CCCM        WCCM
055970940928    2C     V0CFLC        IFNE      0
055980940915     C                   Z-ADD     V0CFLC        WFLC
055990940921     C                   ELSE
056000940921     C                   Z-ADD     V0CLNP        WFLC
056010940928    2C                   ENDIF
056020940920     C                   MOVEL(P)  V0CRSM        PAXDMT
056030050120     C                   CLEAR                   VIDDMT
056040950127     C*
056050940824     C                   EXSR      CTRCCM
056060950127     C*
056070940915     C                   MOVE      WCCM          V0CCCM
056080941011     C     *IN14         IFEQ      *ON
056090941011     C                   MOVEL     WFLC          V0CFLC
056100941011     C                   ENDIF
056110941011     C*
056120940928    2C     WEMFOR        IFEQ      '1'
056130940824     C                   GOTO      ENDC00
056140940928    2C                   ENDIF
056150950303     C*
056160950303   X1C                   ELSE
056170940825     C*
056180940825     C* SE CLIENTE A 0 NON IMMETTERE NEMMENO IL MITTENTE PER ESTESO
056190940928    2C     V0DMIT        IFNE      *BLANKS
056200940825     C                   MOVEL     ERR(25)       VIDMSG
056210940920     C                   SETON                                        5090
056220940825     C                   GOTO      ENDC00
056230940928    2C                   ENDIF
056240940928    1C                   ENDIF
056250940825     C***
056260940822     C*** CODICE TARIFFA MITTENTE ***
056270940825     C     V0CFTM        IFEQ      'S'
056280940822     C* SE IMMESSO DEVE ESISTERE IL CODICE MITTENTE
056290940822     C     V0CCCM        IFEQ      *ZEROS
056300940822     C                   MOVEL     ERR(24)       VIDMSG
056310940920     C                   SETON                                        5090
056320940822     C                   GOTO      ENDC00
056330940822     C                   END
056340940822     C* PERSONALIZZAZIONE
056350940822     C                   SETON                                        28
056360940822     C                   END
056370940825     C***
056380940825     C*** MITTENTE ****
056390940822     C* SOLO SE 8888 O 9999 O NON IMMESSO CLIENTE POSSO INDICARE IL MIT
056400950303    0C     V0DMIT        IFNE      *BLANKS
056410950303     C*
056420940909    1C     WCCM          IFEQ      8888
056430940909     C     WCCM          OREQ      9999
056440950303     C*
056450970703     C                   MOVEL     V0CRSM        I14RSC
056460970703     C                   CLEAR                   I14RS2
056470970703     C                   MOVEL     V0CINM        I14IND
056480970703     C                   MOVEL     V0CLOM        E14LOC
056490970703     C                   MOVEL     V0CPIM        E14PIP
056500970703     C                   MOVEL     V0CPRM        E14PRV
056510970703     C                   MOVEL     V0CNZM        E14NAR
056520970703     C                   MOVEL     V0CCAM        E14CAP
056530970704     C                   MOVEL     'M'           WCLI
056540061109     C                   MOVEL     v0ccdf        Wcdf
056550071022     C                   MOVEL     v0cpim        Wiva
056560970704     C                   EXSR      CTRIND
056570941020     C*
056580941020     C* CAMPI CHE POSSO AVER IMPOSTATO
056590970703     C                   MOVEL     E14LOC        V0CLOM
056600970703     C                   MOVEL     E14PIP        V0CPIM
056610970703     C                   MOVEL     E14PRV        V0CPRM
056620970703     C                   MOVEL     E14NAR        V0CNZM
056630970703     C                   MOVEL     E14CAP        V0CCAM
056640970704     C*
056650061109     c* Se errore sulla partita iva , visualizzo messaggio
056660061109     c                   if        xcfivaflg < *zeros
056670120503     c*****              if        wiva=*blanks and dateu>=§vpopiv
056680120504     c                   if        wcdf=*blanks or %subst(wcdf:12:1)=' '
056690071023     c                   z-add     16            H0riga
056700071022     c                   else
056710071023     c                   z-add     17            H0riga
056720071022     c                   endif
056730061109     c                   z-add     64            H0colo
056740061109     c                   endif
056750061109     c
056760970704     C     WEMFOR        IFEQ      '1'
056770970704     C     *IN90         OREQ      *ON
056780970704     C                   GOTO      ENDC00
056790970704     C                   ENDIF
056800040917     c* Segnalazione se inserito mittente estero
056810040917     c     wmitie        ifeq      'E'
056820040917     c     wcontmit      andeq     *blanks
056830040917     c                   movel     '1'           wcontmit
056840040917     c                   seton                                        90
056850040917     c                   z-add     16            h0riga
056860040917     c                   z-add     49            h0colo
056870040917     c                   movel     ERR(283)      vidmsg
056880040917     c                   goto      endc00
056890040917     c                   endif
056900941020     C**
056910950303     C                   SETON                                        1902
056920941110     C                   MOVEL     V0CRSM        VIDDMT
056930940930     C*
056940940930     C                   ELSE
056950940930     C*
056960940930     C* SE NON IMNMESSO CLIENTE O E' UN CODIFICATO PULISCO IL CAMPO
056970940930     C*  DEL CONTROLLO CAP VARIATO
056980940930     C                   CLEAR                   VARCAM
056990940930     C                   CLEAR                   OTT
057000940930    1C                   ENDIF
057010950303    0C                   ENDIF
057020930329     C*
057030930329     C**** CODICE TARIFFA ****
057040941107    1C     V0CCTR        IFNE      *BLANKS
057050050920     C                   CLEAR                   fnlv59ds
057060050920     C                   MOVEL     'S'           ilv59cfo
057070050920     C                   MOVEL     V0CCTR        ilv59ctr
057080050920     C                   CALL      'FNLV59R'
057090050920     C                   PARM                    fnlv59ds
057100941107     C* ERRORE
057110050920    2C     olv59msg      IFNE      *BLANKS
057120050920     C                   MOVEL     olv59msg      VIDMSG
057130941107     C                   SETON                                        9058
057140941107     C                   MOVEL     '1'           WEMFOR
057150941107     C                   GOTO      ENDC00
057160941107    2C                   ENDIF
057170940819     C*
057180050921     C                   MOVEL     olv59dfs      DEFCTR
057190930329     C                   SETON                                        29
057200941107    1C                   ENDIF
057210941103     C*
057220941103     C*** MITTENTE ORIGINALE ***
057230941110     C     V0CRMO        IFNE      *BLANKS
057240941110     C     V0CCMO        ORNE      *BLANKS
057250941103     C                   MOVEL     V0CRMO        WRMO
057260941103     C                   MOVEL     V0CCMO        WCMO
057270941103     C                   MOVEL     V0CNMO        WNAR
057280941103     C                   EXSR      CTRMO
057290941103     C                   MOVEL     WNAR          V0CNMO
057300941103     C     WEMFOR        IFEQ      '1'
057310941103     C                   GOTO      ENDC00
057320941103     C                   ENDIF
057330941110     C                   ENDIF
057340030415      * I dati relativi alla consegna richiesta
057350030411      * possono essere immessi solo se è stato inserito il codice cliente
057360030411      * mittente (no 8888/9999)
057370030411     c                   If        (V0cCcm = *Zeros or
057380030411     c                              V0cCcm = 8888   or  V0cCcm = 9999)   and
057390030411     c                             (V0cTcr <> *Blanks or V0cDcr > *Zeros or
057400030411     c                              V0cHcr >  *Zeros  or V0cMcr > *Zeros or
057410030411     c                              V0cOre >  *Zeros)
057420030411     c                   Eval      *In50 = *On
057430030411     c                   Eval      *In90 = *On
057440030411     c                   Eval      VidMsg = Err(18)
057450030416     c                   GoTo      EndC00
057460030411     c                   EndIf
057470960319     C***
057480930329     C*** CONSEGNA RICHIESTA ***
057490940913     C                   MOVEL     V0CDCR        WDCR
057500940913     C                   MOVEL     V0CHCR        WHCR
057510940913     C                   MOVEL     V0CMCR        WMCR
057520940913     C                   MOVEL     V0CTCR        WTCR
057530940913     C                   EXSR      CTRCR
057540940916     C                   MOVEL     WDCR          V0CDCR
057550940913     C   90              GOTO      ENDC00
057560030410      * o data consegna richiesta o n. ore
057570030409     c                   If        V0cOre > *Zeros
057580030411     c                   If        V0cTcr <> *Blanks
057590030411     c                   Movel     Rimm          At0Tcr
057600030411     c                   Eval      *In90 = *On
057610030411     c                   Eval      VidMsg = Err(276)
057620030411     c                   z-add     21            H0riga
057630030411     c                   z-add     14            H0colo
057640030411     c                   GoTo      EndC00
057650030411     c                   EndIf
057660030409     c                   If        V0cDcr > *Zeros
057670030409     c                   Eval      *In59 = *On
057680030409     c                   Eval      *In90 = *On
057690030409     c                   Eval      VidMsg = Err(276)
057700030409     c                   GoTo      EndC00
057710030409     c                   EndIf
057720030411     c                   If        V0cHcr > *Zeros or V0cMcr > *Zeros
057730030411     c                   Eval      *In60 = *On
057740030411     c                   Eval      *In90 = *On
057750030411     c                   Eval      VidMsg = Err(276)
057760030411     c                   GoTo      EndC00
057770030411     c                   EndIf
057780030415      * Si possono immettere solo 24 48 72 ore
057790030415     c                   If        V0cOre <> 24 and V0cOre <> 48 and
057800030415     c                             V0cOre <> 72
057810030415     c                   Movel     Rimm          At0Ore
057820030415     c                   Eval      *In90 = *On
057830030415     c                   Eval      VidMsg = Err(278)
057840030415     c                   z-add     23            H0riga
057850030415     c                   z-add     31            H0colo
057860030415     c                   GoTo      EndC00
057870030415     c                   EndIf
057880030409     c                   Eval      wflagore = '1'
057890030411     c                   Eval      *In17 = *On
057900030411     c                   Eval      *In16 = *On
057910030411     c                   Eval      *In23 = *On
057920030409     c                   EndIf
057930960319     C***
057940960319     C*** GIORNI DI CHIUSURA ***
057950960319     C                   MOVEL     V0CGC1        WGC1
057960960319     C                   MOVEL     V0CGC2        WGC2
057970960319     C                   EXSR      CTRGCH
057980960319     C   90              GOTO      ENDC00
057990930413     C*** NATURA MERCE ***
058000950112     C     V0CNAS        IFNE      *BLANKS
058010940825     C                   SETON                                        27
058020930329     C                   END
058030940824     C*
058040940824     C     ENDC00        TAG
058050940824     C   90              MOVEL     '1'           WEMFOR
058060940824     C                   ENDSR
058070940922     C*
058080940922     C* CALL AL PGM DI RICERCA TABELLE X§TABER -----------------------*
058090940922     C     CX§TAB        BEGSR
058100990915     C                   CLEAR                   §KEY
058110940922     C                   CALL      'X§TABER'
058120940922     C                   PARM                    CODUT
058130940922     C                   PARM                    COD
058140940922     C                   PARM                    §KEY
058150940922     C                   PARM                    §DES             25
058160940922     C                   MOVEL     '1'           WEMFOR
058170940922     C                   ENDSR
058180940916     C*
058190940916     C* CONTROLLO DATA SPEDIZIONE ------------------------------------*
058200940916     C     CTRDSP        BEGSR
058210940916     C*
058220940916     C                   Z-ADD     VIDDSP        G02DAT
058230940916     C                   MOVEL     *BLANK        G02ERR
058240940916     C                   CALL      'XSRDA8'
058250940916     C                   PARM                    WLBDAT
058260940916     C* ERRATA
058270940916    1C     G02ERR        IFEQ      '1'
058280940920     C                   SETON                                        41  90
058290950920     C* PREPARO L'ERRORE
058300950920     C                   MOVEA     ERR(2)        K78
058310950920     C     2             SUBST     DATAPG:1      W002A
058320950920     C                   MOVEA     W002A         K78(69)
058330950920     C                   MOVEL     '/'           K78(71)
058340950920     C     2             SUBST     DATAPG:3      W002A
058350950920     C                   MOVEA     W002A         K78(72)
058360950920     C                   MOVEL     '/'           K78(74)
058370950920     C     2             SUBST     DATAPG:7      W002A
058380950920     C                   MOVEA     W002A         K78(75)
058390950920     C                   MOVEA     K78           VIDMSG
058400940916    1C                   ENDIF
058410940916     C*
058420940916     C* REIMPOSTO LA DATA SPEDIZIONEGGMMAA PRENDENDO L'ANNO A 4 SE NON
058430940916     C*  IMMESSO DA VIDEO
058440940916    1C     *IN90         IFEQ      *OFF
058450940928     C                   Z-ADD     G02DAT        VIDDSP
058460940916     C*
058470940916     C* IM MANUT O DISK NON SI PUO' CAMBIARE L'ANNO DI SPEDIZIONE
058480940916     C                   MOVE      VIDDSP        WAAS
058490940916    2C   12WAAS          IFNE      §LPAAS
058500940920     C                   SETON                                        4190
058510940916     C                   MOVEL     ERR(3)        VIDMSG
058520940916    2C                   ENDIF
058530940916    1C                   ENDIF
058540001121      *
058550001124      * SE SONO IN MANUTENZIONE DI UN PREPAGATO NON POSSO METTERE IN
058560001124      * SOSPENSIONE LA BOLLA SE CAMBIO MESE
058570001121    1C   22*IN90         IFEQ      *OFF
058580001124     C     PARTCH        ANDNE     'P'
058590010307     C     §LPFPR        ANDNE     'O'
058600001121     C                   MOVEL     BLPAAS        W0080             8 0
058610001121     C                   MOVE      BLPMGS        W0080
058620001121     C                   MOVEL     W0080         W0060             6 0
058630001121     C                   MOVEL     G02INV        W0060S            6 0
058640001121     C     W0060         IFLT      W0060S
058650001121     C                   SETON                                        4190
058660001121     C                   MOVEL     ERR(193)      VIDMSG
058670001121     C                   ENDIF
058680121017     c* Errore se data compresa nel range dal/al per blocco immissione
058690121017     c* prepagati (tabella "DGD")
058700121017     c***                if        *in90 = '0' and g02inv = §vpodip
058710121017     c                   if        *in90 = '0' and
058720121017     c                             g02inv>=§dgdbpd and g02inv<=§dgdbpa
058730050215     c                   Eval      VidMsg = 'Data non ammessa per spedizioni +
058740050215     c                             in Porto Prepagato'
058750050215     c                   seton                                        4190
058760050215     c                   endif
058770001121     C                   ENDIF
058780940916     C*
058790940916    1C     *IN90         IFEQ      *OFF
058800940916     C                   Z-ADD     G02INV        BLPDSP            8 0
058810950920     C* DATE SPEDIZIONE NO > DATA MAX DI SOSPENSIONE
058820950920    2C     BLPDSP        IFGT      DATAPA
058830940920     C                   SETON                                        4190
058840950920     C                   MOVEA     ERR(2)        K78
058850950920     C     2             SUBST     DATAPG:1      W002A
058860950920     C                   MOVEA     W002A         K78(69)
058870950920     C                   MOVEL     '/'           K78(71)
058880950920     C     2             SUBST     DATAPG:3      W002A
058890950920     C                   MOVEA     W002A         K78(72)
058900950920     C                   MOVEL     '/'           K78(74)
058910950921     C     2             SUBST     DATAPG:7      W002A
058920950920     C                   MOVEA     W002A         K78(75)
058930950920     C                   MOVEA     K78           VIDMSG
058940940916    2C                   ENDIF
058950940916    1C                   ENDIF
058960940916     C* PERSONALIZZAZIONE
058970940916    1C  N90WPERSO        IFEQ      'P'
058980940928     C     BLPDSP        ANDNE     DATEU
058990940916     C                   SETON                                        24
059000940916    1C                   ENDIF
059010940916     C*
059020940916     C                   ENDSR
059030940916     C*
059040970704     C* CONTROLLO INDIRIZZO COMPLETO MITT/DESTIN ---------------------*
059050970704     C     CTRIND        BEGSR
059060970710     C* LE DS SONO DA CLEARARE PRIMA ALTRIMENTI DANNO PROBLEMI IN CTRER
059070970710     C                   CLEAR                   DSLV13
059080970710     C                   CLEAR                   DSSI95
059090060922     C                   CLEAR                   tisi97ds
059100151106     c                   clear                   xcfiva1ds
059110970710     C*
059120970704     C                   CLEAR                   I14ISO
059130970714     C                   MOVEL     BLPDSP        I14DRI
059140020205     c                   movel     'S'           i14cnz
059150100115     c                   movel     'S'           i14forzait
059160080414     c***                clear                   ds15x
059170151106     c                   if        wcli='M' and *in22
059180151105     c                   eval      I14P88='8'
059190151105     c                   endif
059200970704     C                   CALL      'FNLV14R'
059210970707     C                   PARM                    KPJBA
059220970707     C                   PARM                    DSLV14
059230080414     C***                PARM                    ds15x
059240970707     C*
059250970707     C                   MOVEL     O14ERR        WERR              1
059260970707     C                   MOVEL     O14MSG        VIDMSG
059270150907     C                   eval      wlv13_giro2=' '
059280970707     C                   EXSR      CTRERR
059290970707     C**
059300970707     C     WEMFOR        IFEQ      '1'
059310970707     C                   GOTO      ENDIND
059320970707     C                   ENDIF
059330061109     c
059340151106     c* Controllo il codice fiscale
059350151106     c*****              if        wcdf<>*blanks
059360151106     c                   clear                   xcfiva1ds
059370061109     c                   clear                   xcfivamod
059380061109     c                   eval      xcfivapar = wcdf
059390061109     c                   eval      xcfivanar = e14nar
059400061109     c                   eval      xcfivaprv = e14prv
059410151106     c                   eval      xcfivacap = e14cap
059420151106     c                   eval      xcfivaloc = e14loc
059430151106     c                   eval      xcfivapiva= wiva
059440151106     c                   if        *in22=*on
059450151106     c                   eval      XCFIVAP88='8'
059460151106     c                   endif
059470151106     c                   call      'XCFIVAR1'
059480151106     c                   parm                    xcfiva1ds
059490061109     c*
059500061109     c                   if        xcfivaflg < *zeros
059510080904     c                   movel     xcfivamsg     vidmsg
059520061109     c                   seton                                        2890
059530061109     C                   GOTO      ENDIND
059540061109     c                   endif
059550151106     c                   eval      wCdfFlg=xcfivaflg
059560151106     c*****              endif
059570061109     c
059580061109     c* MITTENTE: COD FISCALE OBBLIGATORIO FORZABILE, SE prepagato 8888
059590071022     c*  22              if        Wcli='M' and wccm=8888  and
059600071022     c*                            wcdf=*blanks  and e14nar=*blanks
059610120503     c*  22              if        Wcli='M' and wccm=8888
059620120503     c*                            and e14nar=*blanks and (wcdf=*blanks
059630120503     c*                            or (wiva=*blanks and dateu>=§vpopiv))
059640120508     c* MITTENTE: PREPAGATO
059650120508    1c   22              if        Wcli='M' and e14nar=*blanks
059660120508     c* P.iva $$ sempre errore
059670120508    2c                   if        %scan('$$':wiva) >0
059680120508     c                   movel     err(345)      vidmsg
059690120508     c                   seton                                        702890
059700120508     C                   GOTO      ENDIND
059710120508    2c                   endif
059720120508     c* Prepagato 8888
059730120508   1ac                   if        wccm=8888
059740120503     c* errore forzabile: Codice fiscale o Partita iva
059750120504    2c                   if        wcdf=*blanks   and wiva=*blanks
059760120503     c* errore forzabile: se inserito codice fiscale lungo 11 inserire anche la
059770120503     c*                   P.IVA
059780120503     c                             or (wcdf<>*blanks and %subst(wcdf:12:1)=' '
059790120503     c                                 and wiva=*blanks)
059800061109     c* Se cambiato mittente ricontrollo
059810120504    3c                   if        i14rsc<>savrsm
059820120503     c                   clear                   forzcdf           1
059830120504     c                   clear                   forzcdf1          1
059840120503     c                   movel     i14rsc        savrsm
059850120504    3c                   endif
059860151106
059870151106     c                   clear                   xcfiva1ds
059880151106     c                   eval      xcfivamod = 'P'
059890151106     c                   eval      xcfivapar = wcdf
059900151106     c                   eval      xcfivanar = e14nar
059910151106     c                   eval      xcfivaprv = e14prv
059920151106     c                   eval      xcfivacap = e14cap
059930151106     c                   eval      xcfivaloc = e14loc
059940151106     c                   eval      xcfivapiva= wiva
059950151106     c                   eval      XCFIVAP88='8'
059960151106     c                   call      'XCFIVAR1'
059970151106     c                   parm                    xcfiva1ds
059980061109     c*
059990130131     c* 31/01/2013: Errori non più forzabili ma sempre bloccanti
060000120504    3c                   select
060010130131     c****               when      forzcdf=' ' and wcdf=*blanks
060020151106     c                   when      wcdf=*blanks
060030151106     c                   select
060040151106     c* entrambi inseribili --> chiedo uno o l'altro
060050151106     c                   when      wcdfflg<>9 and xcfivaflg<>9
060060151106     c                   movel     err(343)      vidmsg
060070151106     c* solo codice fiscale
060080151106     c                   when      wcdfflg<>9
060090151106     c                   movel     err(364)      vidmsg
060100151106     c* solo partita IVA
060110151106     c                   when      xcfivaflg<>9
060120151106     c                   movel     err(344)      vidmsg
060130151106     c                   endsl
060140151106     c                   if        wcdfflg<>9 or xcfivaflg<>9
060150120504     c                   movel     '1'           forzcdf
060160120504     c                   z-add     -1            xcfivaflg
060170120504     c                   seton                                        2890
060180120504     C                   GOTO      ENDIND
060190151106     c                   endif
060200130131     c****               when      forzcdf1=' ' and wcdf<>*blanks
060210151106     c                   when      wcdf<>*blanks and xcfivaflg<>9
060220120503     c                   movel     err(344)      vidmsg
060230120504     c                   movel     '1'           forzcdf1
060240120503     c                   z-add     -1            xcfivaflg
060250120503     c                   seton                                        2890
060260120503     C                   GOTO      ENDIND
060270120504    3c                   endsl
060280120504    2c                   endif
060290120508   1ac                   endif
060300120504    1c                   endif
060310061109     c
060320020207     c* DESTINATARIO
060330020207     c     WCLI          ifeq      'D'
060340020207     C* SE IMMESSA LINEA DI ARRIVO PER DPD DEVE ESSERE UNA LINEA
060350020207     C* DPD    -   STESSA COSA PER FED-EX
060360020207     C     VIDDPD        IFEQ      'D'
060370051028     C**   O14IE         ANDEQ     'E'
060380020207     C     COMLNA        andgt     0
060390020207     C     COMLNA        ANDNE     O14LAD
060400020319     C     A_§OGNTW      ANDNE     'DPD'
060410020207     C     VIDDPD        oreq      'F'
060420051028     C**   O14IE         ANDEQ     'E'
060430020207     C     COMLNA        andgt     0
060440020207     C     COMLNA        ANDNE     O14LAF
060450020213     C     A_§OGNTW      ANDNE     'FED'
060460020207     C*
060470020207     C                   MOVEa     ERR(183)      k78
060480020207     C                   SETON                                        4790
060490020207     c     viddpd        ifeq      'D'
060500020207     c                   eval      w005a = 'DPD  '
060510020207     c                   else
060520020207     c                   eval      w005a = 'FedEx'
060530020207     c                   endif
060540020214     c                   movea     w005a         k78(66)
060550020207     C                   MOVEA     K78           VIDMSG
060560020211     C                   GOTO      ENDind
060570020207     c*
060580020207     C                   ENDIF
060590020207     c*
060600020207     c                   select
060610020207     C* SE LNA DPD =000 NON C'E' IL SERVIZIO
060620020207     c     viddpd        wheneq    'D'
060630020207     C     o14lad        andle     *ZEROS
060640020213     c     comlna        andeq     *zeros
060650020319     c     A_§ogNTW      oreq      'DPD'
060660020207     c     o14lad        andle     *zeros
060670060921     c* se però c'e' reso non do errore
060680060921     c                   if        o14red=' ' or
060690060921     c                             (o14red='S' and vidfbr<>'S')
060700020207     C                   MOVEL     ERR(192)      VIDMSG
060710020207     C                   SETON                                        90
060720020207     c     viddpd        ifeq      'D'
060730020207     c                   z-add     21            h1riga
060740020207     c                   z-add     10            h1colo
060750020207     c                   else
060760020207     C                   SETON                                        47
060770020207     c                   endif
060780020207     C                   GOTO      ENDind
060790060921     c                   endif
060800060921     c
060810020207     C* SE LNA FEDEX=000 NON C'E' IL SERVIZIO
060820020207     c     viddpd        wheneq    'F'
060830020207     C     o14laf        andle     *ZEROS
060840020213     c     comlna        andeq     *zeros
060850020213     c     A_§ogntw      oreq      'FED'
060860020207     C     o14laf        andle     *ZEROS
060870020207     C                   MOVEL     ERR(244)      VIDMSG
060880020207     C                   SETON                                          90
060890020207     c     viddpd        ifeq      'F'
060900020207     c                   z-add     21            h1riga
060910020207     c                   z-add     10            h1colo
060920020207     c                   else
060930020207     c                   seton                                        47
060940020207     c                   endif
060950020207     C                   GOTO      ENDind
060960020207     c* se flag EuroExpress = blank non c'è il servizio
060970020207     c     viddpd        wheneq    ' '
060980020207     c     o14ie         andeq     'E'
060990020207     c     o14eex        andeq     *blanks
061000020213     c     comlna        andeq     *zeros
061010020213     c     A_§ogntw      oreq      'EEX'
061020020207     c     o14eex        andeq     *blanks
061030020214     C                   MOVEL     ERR(247)      VIDMSG
061040020207     C                   SETON                                          90
061050020213     c     A_§ogntw      ifeq      'EEX'
061060020212     c     *in12         oreq      *on
061070020212     c     *in15         andeq     *off
061080020207     c                   seton                                        47
061090020207     c                   else
061100020207     c                   z-add     21            h1riga
061110020207     c                   z-add     10            h1colo
061120020207     c                   endif
061130020207     C                   GOTO      ENDind
061140020207     c                   endsl
061150020207     c                   endif
061160970707     C*************
061170020214     C* CONTROLLO CAP -
061180160324     c*****              if        w_vediP=*blanks
061190970707     C                   MOVEL     '7'           I95TCN
061200160324     c****               else
061210160324     C****               MOVEL     '3'           I95TCN
061220160324     C****               eval      i13cng='S'
061230160324     c****               endif
061240970707     C                   MOVEL     E14CAP        I95CAP
061250970707     C                   MOVEL     E14LOC        I95LOC
061260970707     C                   MOVEL     E14PRV        I95PRV
061270970707     C                   MOVEL     E14NAR        I95NAR
061280970714     C                   MOVEL     BLPDSP        I95DAT
061290971201     C     §3AFCA        IFNE      0
061300971201     C                   MOVEL     'S'           I95FCA
061310971201     C                   ENDIF
061320971201     C                   MOVEL     FLGTB1        I95TPO
061330970707     C                   MOVEL     'S'           I13AF0
061340061122     c* per disk "B" non deve controllare la congruenza della località
061350061122     c* con il cap anche quando quest'ultimo ha eccezioni
061360160323     c* anche per vedi pacco dpd
061370160323     c                   if        (wcli='D' and §1bfg6='C'
061380160323     c                             and §1bfg2='S') or
061390160323     c                             w_vediP='1'
061400061122     C                   clear                   I13AF1
061410061122     c                   else
061420970707     C                   MOVEL     'S'           I13AF1
061430061122     c                   endif
061440061122     c
061450970707     C                   MOVEL     'S'           I13SZ2
061460140122     C* CAP CON VIARIO: NON CONTROLLO PER DISK B
061470160323     c* non controllo nemmeno per vedi pacco dpd
061480000704     C     §1BFG6        IFNE      'C'
061490160324     C     w_vediP       andne     '1'
061500140122     C**** §1BFG2        ORNE      'S'
061510150304     c                   if        §vpouttlls='N'
061520150623     c******                       and simpou<>28 and simpou<>50
061530150304     C                   MOVEL     'S'           I13CNV
061540150304     c                   else
061550150121     C                   MOVEL     'Y'           I13CNV
061560150123     c                   movel     vidind        i95ind
061570150304     c                   endif
061580000704     C                   ENDIF
061590970707     C                   MOVEL     'S'           I13SZV
061600140121     c                   if        wcli='D'
061610140121     c                   clear                   dspr
061620140121     C                   MOVEL     'PR'          COD
061630140121     C                   MOVEL(P)  i95prv        KEY
061640140121     c     ktab2         chain     tabel00f
061650140121     c                   if        %found(tabel00f)
061660140121     c                   eval      dspr=tbluni
061670140121     c                   endif
061680140121     c                   if        §prpla='S'
061690140121     c                   clear                   i13szv
061700140121     c                   endif
061710140121     c                   endif
061720991213     C* PER LNP DPD, CONTROLLO CONGRUENZA LOCALITA' CAP E PROVINCIA
061730160323     C*  E NON SOLO CAP E PROVINCIA
061740160323     c* Per Vedi pacco dpd non faccio mai questo controllo
061750160323     c     w_vediP       ifne      '1'
061760020319     C     §OGNTW        IFEQ      'DPD'
061770000622     C* CONTROLLO PER TUTTI TRANNE CHE PER DSK "B"
061780000622     C     §1BFG6        ORNE      'C'
061790000622     C     §1BFG2        ORNE      'S'
061800000314      * TESTIAMO CONTROLLO SU SPEDIZIONI DI VERONA 15/03/00
061810000322      * TESTIAMO CONTROLLO SU SPEDIZIONI DI TREVISO 22/03/00
0618209912139/12 C                   MOVEL     'S'           I13LA3
0618309912139/12 C                   MOVEL     'S'           I13SZ3
061840991213     C                   ENDIF
061850160323     C                   ENDIF
061860970707     C**
061870970708     C**  M I T T E N T E
061880970707    1C     WCLI          IFEQ      'M'
061890970707     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO : ERRORE FORZABILE
061900970707    2C     E14CAP        IFNE      VARCAM
061910970707     C                   CLEAR                   OTT
061920970707     C                   CLEAR                   MMA
061930970707     C                   CLEAR                   MMB
061940000622     C                   CLEAR                   MMD
061950970707     C                   MOVEL     E14CAP        VARCAM
061960970707    2C                   ENDIF
061970970707     C** MODIFICA LOCALITA'
061980970707    2C     E14LOC        IFNE      VARLOM
061990970707     C                   MOVEL     E14LOC        VARLOM
062000970707     C                   CLEAR                   MMA
062010970707     C                   CLEAR                   MMB
062020000622     C                   CLEAR                   MMD
062030970707    2C                   ENDIF
062040970708     C**
062050970707     C                   MOVEL     OTT           E13FZV
062060970707     C                   MOVEL     MMA           E13FZ1
062070970707     C                   MOVEL     MMB           E13FZ2
062080000622     C                   MOVEL     MMD           E13FZ3
062090020218     c* se network fedex passo flag apposito per dire di prendere i dati
062100020218     c* dalla tabella della nazione
062110020218     c     §ogntw        ifeq      'FED'
062120020218     c                   movel     'S'           i95fi1
062130020218     c                   endif
062140970708     C**
062150970708     C                   ELSE
062160970708     C**
062170970708     C**  D E S T I N A T A R I O
062180970708     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO
062190970708    2C     E14CAP        IFNE      VARCAD
062200970708     C                   CLEAR                   DIE
062210970708     C                   CLEAR                   SET
062220970708     C                   CLEAR                   AAA
062230970708     C                   CLEAR                   AAB
062240991213     C                   CLEAR                   AAD
062250970708     C*
062260970708     C* SE CAMBIATO MA IN MANUTENZIONE RIMESSO QUELLO DELLA BOLLA  -->
062270970708     C*  COME SE NON FOSSE CAMBIATO NULLA
062280970708    3C     *IN12         IFEQ      *ON
062290970708     C     *IN15         ANDEQ     *OFF
062300970708     C     E14CAP        ANDEQ     BLPCAD
062310970708     C                   CLEAR                   NOV
062320970708     C                   ELSE
062330970708     C                   CLEAR                   QUA
062340100209     C                   CLEAR                   QUAH
062350970708     C                   MOVEL     '1'           NOV
062360970708    3C                   ENDIF
062370970708     C* MEMORIZZO NUOVO CAP
062380970708     C                   MOVEL     E14CAP        VARCAD
062390970708    2C                   ENDIF
062400970708     C* MODIFICA LA LOCALITA'
062410970708    2C     E14LOC        IFNE      VARLOD
062420970708     C                   MOVEL     E14LOC        VARLOD
062430970708     C                   CLEAR                   AAA
062440970708     C                   CLEAR                   AAB
062450991213     C                   CLEAR                   AAD
062460970708    2C                   ENDIF
062470970708     C**
062480970708     C                   MOVEL     SET           E13FZV
062490970708     C                   MOVEL     AAA           E13FZ1
062500970708     C                   MOVEL     AAB           E13FZ2
062510991213     C                   MOVEL     AAD           E13FZ3
062520020212     c* se network fedex passo flag apposito per dire di prendere i dati
062530020212     c* dalla tabella della nazione
062540020213     c     A_§ogntw      ifeq      'FED'
062550020212     c     viddpd        oreq      'F'
062560020218     c     o14ie         andeq     'E'
062570020212     c                   movel     'S'           i95fi1
062580060922     c                   movel     'FED'         i97ntw
062590020212     c                   endif
062600060922     c*
062610060922     c     A_§ogntw      ifeq      'DPD'
062620060922     c     viddpd        oreq      'D'
062630060922     c     o14ie         andeq     'E'
062640060922     c                   movel     'DPD'         i97ntw
062650060922     c                   endif
062660060922     c* se non ancora impostato ed è estero, è euroexpress
062670060922     c                   if        (i97ntw=*blanks and o14ie='E') or
062680060922     c                             (i97ntw=*blanks and A_§ogntw='EEX')
062690060922     c                   movel     'EEX'         i97ntw
062700060922     c                   endif
062710970707    1C                   ENDIF
062720970722     C**
062730970722     C* SE RICHIAMO DALLA CONFERMA BOLLE SENZA FERMARSI SULLA BOLLA
062740970722     C*  IN CASO DI ERRORE NON DO L'INTERROGAZIONE LOCALITA' IN CASO
062750970722     C*  DI RESTITUZIONE AFFIDABILITA'=1
062760970722     C   12
062770970722     CAN 15§LPFPR        IFNE      'V'
062780970722     C     §LPFPR        ANDNE     'X'
062790970722     C                   MOVEL     1             E13FZ1
062800970722     C                   ENDIF
062810970707     C**
062820970707     C** CALL
062830150907     C                   eval      wlv13_giro2=' '
062840150907     c                   exsr      sr_LV13
062850970708     C**
062860970708     C     WEMFOR        IFEQ      '1'
062870970708     C                   GOTO      ENDIND
062880970708     C                   ENDIF
062890150907
062900150907     c                   if        wlv13='S'
062910150907     C                   MOVEL     E14CAP        I95CAP
062920150907     C                   eval      wlv13_giro2='S'
062930150907     c                   exsr      sr_lv13
062940150907     C     WEMFOR        IFEQ      '1'
062950150907     C                   GOTO      ENDIND
062960150907     C                   ENDIF
062970150907     c                   endif
062980080410     c* PORTI ASSEGNATI
062990080410     c* Se porto assegnato effettuabile solo a fronte di orm commissionato
063000080410     c* da p.o. del network verifico che il p.o. emittente sia quello del
063010080410     c* network
063020080410     c                   clear                   wnocont
063030080411    1c                   if        o97uti='N' and wcli='D'
063040080410     c* Se provengo da manutenzione di bolla di reso lo memorizzo
063050080410     c* per non effettuare il controllo seguente
063060080411    2c     *in12         ifeq      *on
063070080410     c     *in15         andeq     *off
063080080410     c     vidfbr        andeq     'S'
063090080410     c                   move      'N'           wnocont           1
063100080411    2c                   endif
063110080410     c                   movel     o97flo        dcppflo
063120080410     c* ricavo p.o. emittente
063130080411    2c                   if            §cpppas='O' and wnocont=*blanks
063140080410     c                             and i95tpo='A'
063150080410     c* non richiamato da giacenze o ritiri annullati
063160080410     c                             and savfpr<>'P' and savfpr<>'G'
063170080410     c                             and savfpr<>'T'
063180080410     c* orm fittizio oppure orm non commissionato da po del network
063190080411    3c                   if        flgfit='S' or i97ntw<>poentw
063200080411    4c                   if        wperso='P'
063210080410     C                   Z-ADD     05            H0RIGA
063220080410     C                   Z-ADD     20            H0COLO
063230080410     c                   else
063240080410     C                   Z-ADD     06            H1RIGA
063250080410     C                   Z-ADD     20            H1COLO
063260080411    4c                   endif
063270080410     c                   seton                                        90
063280080410     c* preparo il testo del messaggio
063290080410     c                   movel     err(229)      vidmsg
063300080411     C                   CLEAR                   dsbs02
063310080411     c                   clear                   dntw
063320080411     C                   MOVEL     'C'           T02MOD
063330080411     C                   MOVEL     KNSIF         T02SIF
063340080411     C                   MOVEL     'NTW'         T02COD
063350080411     c                   movel(P)  i97ntw        t02ke1
063360080411     C                   CALL      'TIBS02R'
063370080411     C                   PARM                    KPJBA
063380080411     C                   PARM                    dsbs02
063390080411    4C                   IF        T02ERR = *BLANKS
063400080411     C                   MOVEL     T02uni        dntw
063410080411    4C                   ENDIF
063420080411     c                   eval      %subst(vidmsg:14:5)=%subst(§ntwdes:1:5)
063430080411     c                   eval      %subst(vidmsg:71:5)=%subst(§ntwdes:1:5)
063440080410     C                   GOTO      ENDIND
063450080411    3c                   endif
063460080411    2c                   endif
063470080411    1c                   endif
063480090827     c*
063490090921     c* Per destinatario vedo se il tipo servizio prevede un codice tempo
063500090827     c*  consegna obbligato, anche parziale
063510100322     c* Se esiste FNORE --> dico che si può utilizzare
063520100322     c                   if        Wcli='D' and WesORE='N'
063530100322     c                   movel     'S'           wesore
063540100322     c                   endif
063550100322     c
063560100125    1c                   if        vidtsp<>' ' and wcli='D'
063570100322
063580090827     C                   Z-ADD     1             C
063590090827     C     vidtsp        LOOKUP    TSP(C)                                 30
063600090827    2C                   IF        *in30  and TSttc(c)<>*blanks
063610090827     c* controllo posizione per posizione escudendo le "x"
063620090827     c                   eval      Wttc=TSttc(c)
063630090827     c                   eval      WttcCAP=%editc(o95ttc:'X')
063640090827     c                   z-add     1             c
063650090921    3c                   do        5             c
063660090827     c                   if        %subst(wttc:c:1)<>'x'
063670090827     c                             and
063680090827     c                             %subst(wttc:c:1)<>%subst(wttcCAP:c:1)
063690090827     C                   MOVEL     ERR(307)      VIDMSG
063700090827     c                   seton                                        9048
063710090827     C                   MOVEL     '1'           WEMFOR
063720100319     c* Se vengo da ORM --> memorizzo di non considerare FNORE
063730100319     c*  perchè incongruente col CAP
063740100319     c                   if        wesORE='S'
063750100319     c                   movel     'N'           wesore
063760100319     c                   endif
063770100319
063780100319     C                   GOTO      ENDIND
063790090827     c                   endif
063800090921    3c                   enddo
063810090827     c
063820090921    2c                   endif
063830090921     c
063840090921     c* Se fermo deposito non accetto tipo servizio H
063850090921    2c                   if        vidtsp='H'  and vidffd='S'
063860090921     C                   MOVEL     ERR(101)      VIDMSG
063870090921     c                   seton                                        9048
063880090921     C                   MOVEL     '1'           WEMFOR
063890090921     C                   GOTO      ENDIND
063900090921    2c                   endif
063910090921    1c                   endif
063920080410     c
063930000622     C**
063940000622     C* SE SI TATTA DI CAP OBSOLETO, ERRORE NO FORZABILE
063950061010     C***  §1BFG6        IFNE      'C'
063960061010     C***  §1BFG2        ORNE      'S'
063970061010     C***  O95CF1        IFEQ      'O '
063980061010     C***  WCLI          IFEQ      'M'
063990061010     C***                SETON                                        5390
064000061010     C***                ELSE
064010061010     C***                SETON                                        6590
064020061010     C***                ENDIF
064030061010     C***                MOVEL     ERR(201)      VIDMSG
064040061010     C***                MOVEL     '1'           WEMFOR
064050061010     C***                GOTO      ENDIND
064060061010     C***                ENDIF
064070061010     C***                ENDIF
064080970704     C**
064090970704     C* M I T T E N T E
064100970704    1C     WCLI          IFEQ      'M'
064110970704     C                   MOVEL     O14IE         WMITIE            1
064120970704     C                   MOVEL     O14VLT        MITVLT
064130970704     C                   MOVEL     O95ISO        COMFAP
064140970708     C                   MOVEL     O95CTS        MITCTS            2
064150140403     C                   MOVEL     O95gf2        comgf2
064160970704     C**
064170970704   X1C                   ELSE
064180970704     C*
064190970704     C                   MOVEL     O14IE         WDESIE            1
064200970704     C                   MOVEL     O14VLT        DESVLT
064210970704     C                   MOVEL     O14EFT        DESEFT
064220000321     C                   MOVEL     O14EFD        DESEFD
064230971215     C                   MOVEL     O14COD        DESCOD
064240000120     C                   MOVEL     O14LAD        DESLAD
064250060920     C                   MOVEL     O14red        DESred
064260020130     C                   MOVEL     O14eff        DESeff
064270020131     C                   MOVEL     O14ffn        DESffn
064280080414     c***                movel     x_§15cex      descaeex
064290080414     c***                movel     x_§15cdp      descadpd
064300080414     c***                movel     x_§15cfe      descafed
064310970704     C                   MOVEL     O95ISO        COMFIN
064320970704     C                   MOVEL     O95GDD        DESGDD            1
064330021118      * Se spedizione export il DDT va sempre impostato a 'N'
064340021118     c                   If        O14ie = 'E'
064350021118     c                   Eval      DesGdd = 'N'
064360021118     c                   EndIf
064370021118      * Mi salvo flag ddt
064380021118     c                   Eval      SavGdd = O95Gdd
064390970704     C   12
064400970704     CAN 15
064410970704     CORN12              MOVEL     O95CTS        SAVCTS            2
064420970704     C*
064430970704     C* MANUTENZIONE RICALCOLO COD TASSAZIONE SOLO SE CAMBIATA PROV
064440990629     C*  NAZIONE E CAP
064450970704     C   12
064460970704     CANN15BLPPRD        IFNE      E14PRV
064470990629     C     BLPNZD        ORNE      E14NAR
064480990629     C     BLPCAD        ORNE      E14CAP
064490030320     c     blpnzd        orne      *Blanks
064500030320     c     e14nar        orne      *Blanks
064510970704     C                   MOVEL     O95CTS        SAVCTS
064520970704     C                   ENDIF
064530970704     C**
064540970704    1C                   ENDIF
064550970704     C*
064560970704     C     ENDIND        ENDSR
064570970707     C*
064580970707     C* CONTROLLO SE C'E' ERRORE-------------------------------------*
064590970707     C     CTRERR        BEGSR
064600150907     c                   clear                   wlv13
064610970708     C* IMPOSTO CAMPI PASSATI
064620970708     C     O13RON        IFEQ      'S'
064630970708     C                   MOVEL     O95NAR        E14NAR
064640970708     C                   ENDIF
064650970708     C     O13ROC        IFEQ      'S'
064660970708     C                   MOVEL     O95CAP        E14CAP
064670970708     C                   ENDIF
064680970708     C     O13ROP        IFEQ      'S'
064690970708     C                   MOVEL     O95PRV        E14PRV
064700970708     C                   ENDIF
064710970708     C     O13ROL        IFEQ      'S'
064720970708     C                   MOVEL     O95LOC        E14LOC
064730970708     C                   ENDIF
064740970708     C**
064750970707     C* ERRORE O RICERCA CAMPO
064760970707    1C     WERR          IFNE      ' '
064770150907     c* Per controllo dati Destinatario
064780150907     c* l'errore con il posizionamento cursore lo emetto solo se
064790150907     c* CAP non reperito o non è stato reperito il SOLO cap
064800150907     c* L'unico caso è il msg:
064810150907     c* ATTENZIONE!! Presenti dati incongruenti: modificati.Enter per continuare
064820150907     c* che si è deciso di non emettere più perchè inutile al bollettista pur
064830150907     c* modificando i dati inseriti da quest'ultimo in base a quanto rieperito
064840150907     c* da lv13/tisi95
064850150907     c                   if        wcli='M' or
064860150907     c                             o13roc<>'S' or
064870150907     c                             (o13rop='S' or o13rol='S' or o13ron='S')
064880150907     c                             or wlv13_giro2='S'
064890970707     C*
064900970707    2C     VIDMSG        IFNE      *BLANKS
064910970707     C                   SETON                                        90
064920970707    2C                   ENDIF
064930970707     C* POSIZIONAMENTO CURSORE
064940970707    2C                   SELECT
064950970707    2C     WERR          WHENEQ    '1'
064960970707     C     WERR          OREQ      '2'
064970970707    3C     WCLI          IFEQ      'M'
064980970707     C                   SETON                                        52
064990970707     C                   ELSE
065000970707     C                   SETON                                        64
065010970707    3C                   ENDIF
065020970707    2C     WERR          WHENEQ    '3'
065030970707    3C     WCLI          IFEQ      'M'
065040970707     C                   SETON                                        54
065050970707     C                   ELSE
065060150826     C                   SETON                                        6638
065070970707    3C                   ENDIF
065080970707    2C     WERR          WHENEQ    '4'
065090970707    3C     WCLI          IFEQ      'M'
065100970707     C                   SETON                                        55
065110970707     C                   ELSE
065120970707     C                   SETON                                        71
065130970707    3C                   ENDIF
065140970707    2C     WERR          WHENEQ    '5'
065150970707    3C     WCLI          IFEQ      'M'
065160970707     C                   SETON                                        53
065170970707     C                   ELSE
065180150826     C                   SETON                                        6538
065190970707    3C                   ENDIF
065200970707    2C     WERR          WHENEQ    '6'
065210970707     C                   SETON                                        68
065220970707    2C     WERR          WHENEQ    '7'
065230970707     C                   SETON                                        70
065240970707    2C     WERR          WHENEQ    '8'
065250970707     C                   SETON                                        10
065260020204     c     werr          wheneq    '0'
065270020204    3C     WCLI          IFEQ      'M'
065280020204     C                   SETON                                        55
065290020204     C                   ELSE
065300020204     C                   SETON                                        71
065310020204    3C                   ENDIF
065320970707    2C                   ENDSL
065330970707     C*
065340970707     C                   MOVEL     '1'           WEMFOR
065350150907     c                   else
065360150907     c* Controllo indirizzo destinatario e poposto cap
065370150907     c* per avere i dati corretti del cappario bisogna richiamare nuovamente
065380150907     c* lv13
065390150907     c                   eval      wlv13='S'
065400970707    1C                   ENDIF
065410150825    1C                   ENDIF
065420970707    1C                   ENDSR
065430150907     c
065440150907     C* Richiamo FNLV13R da CTRIND  ---------------------------------*
065450150907     C     sr_LV13       BEGSR
065460150907
065470150907     c                   if        §3arbl<>'R'
065480150907     C                   CALL      'FNLV13R'
065490150907     C                   PARM                    KPJBA
065500150907     C                   PARM                    DSLV13
065510150907     C                   PARM                    DSSI95
065520150907     C                   PARM      ' '           flgbac            1
065530150907     C                   PARM                    tisi97ds
065540150907     c                   else
065550150907     C                   CALL      'FNLV13R'
065560150907     C                   PARM                    KPJBA
065570150907     C                   PARM                    DSLV13
065580150907     C                   PARM                    DSSI95
065590150907     C                   PARM      ' '           flgbac            1
065600150907     c                   endif
065610150907     C*
065620150907     C                   MOVEL     O13ERR        WERR              1
065630150907     C                   MOVEL     O13MSG        VIDMSG
065640150907     C                   EXSR      CTRERR
065650150907     C**
065660150907     C* REIMPOSTO LE FORZATURE
065670150907     C     WCLI          IFEQ      'M'
065680150907     C                   MOVEL     E13FZV        OTT
065690150907     C                   MOVEL     E13FZ1        MMA
065700150907     C                   MOVEL     E13FZ2        MMB
065710150907     C                   MOVEL     E13FZ3        MMD
065720150907     C                   ELSE
065730150907     C                   MOVEL     E13FZV        SET
065740150907     C                   MOVEL     E13FZ1        AAA
065750150907     C                   MOVEL     E13FZ2        AAB
065760150907     C                   MOVEL     E13FZ3        AAD
065770150907     C                   ENDIF
065780150907     c                   endsr
065790970704     C*
065800940916     C* CONTROLLO DATA RITIRO MERCE ----------------------------------*
065810940916     C     CTRDRT        BEGSR
065820940916     C*
065830940916     C* CONTROLLO SOLO QUANDO VIENE MODIFICATA
065840990610   0AC     PARTCH        IFEQ      'P'
065850990610     C     VIDDRT        ANDGT     0
065860010307     C     §LPFPR        OREQ      'O'
065870010307     C     VIDDRT        ANDGT     0
065880990610     C     PARTCH        ORNE      'P'
065890010307     C     §LPFPR        ANDNE     'O'
065900940916    0C     VIDDRT        IFNE      SAVDRT
065910950215     C     VIDDRT        OREQ      0
065920070808     C* Se O.R.M. fittizio imposto a no display la scritta "DA O.R.M."
065930070808     c                   if        flgfit='S'
065940070808     c                   if        wperso='P'
065950070808     c                   movel     nodi          at0daorm
065960070808     c                   else
065970070808     c                   movel     nodi          atrdaorm
065980070808     c                   endif
065990070808     c                   endif
066000070808     c*
066010070831     c
066020940920     C                   Z-ADD     VIDDRT        G02DAT
066030940916     C                   CLEAR                   G02ERR
066040940916     C                   CALL      'XSRDA8'
066050940916     C                   PARM                    WLBDAT
066060940916     C*
066070070831     c* se in personalizzazione e non immessa data ritiro non è obbligatoria
066080070905     c* se l'orm è fittizio
066090070905     c* non è obbligatoria anche se non immessa la data e non immesso l'ORM
066100071107     c****               if        wperso='P' and dateu>=§vpodrt and
066110071107     c                   if        wperso='P' and
066120070905     c                             viddrt=0 and
066130070905     c                             ((flgfit='S' and widor1>*zeros) or
066140070905     c                             widor1=*zeros)
066150070831     c                   else
066160940916     C* SE ERRATA O MAGGIORE DI WDTGIO ERRORE
066170080109     C* NO < DI xx GIORNI DA OGGI (come da tabella "3I")
066180070904    1C*    G02ERR        IFEQ      '1'
066190070904     C*    G02INV        ORGT      DATEU
066200070904     C*    PARTCH        ANDNE     'P'
066210070904     C*    §LPFPR        ANDNE     'O'
066220070904     C*    G02INV        ORLT      DATAM
066230070904     c                   if        g02err='1' or (g02inv>dateu and
066240070904     c                             partch<>'P' and §lpfpr<>'O')
066250110420     c                             or (g02inv<datamin and not *in22)
066260110420     c                             or (g02inv<datam40 and     *in22)
066270071107     c***                          or (g02inv<datam and (dateu<§vpodrt or
066280080109     c***                          or (g02inv<datamin and (
066290080109     c***                          flgfit='S' or s_drt<>viddrt))
066300940916     C                   MOVEL     ERR(6)        VIDMSG
066310940920     C                   SETON                                        4390
066320080109     c* se errore data ritiro in quanto viene forzata data orm aggiungo
066330080109     c* nel messaggio di verificare l'orm
066340080128     c                   if        g02inv<datamin and flgfit<>'S' and not *in22
066350080109     c                   eval      vidmsg=%trim(vidmsg)
066360080109     c                             + ': verificare l''O.R.M.'
066370080109     c                   endif
066380940916    1C                   ENDIF
066390110422     c* Se prepagato e immessa data più vecchia di datamin
066400110422     c* errore forzabile
066410110422     c                   if        g02inv<datamin and *in22 and wforzadrt=*off
066420110422     C                   MOVEL     ERR(339)      VIDMSG
066430110422     c                   eval      %subst(vidmsg:49:2)=%char(§3iggb)
066440110422     C                   SETON                                        4390
066450110422     c                   eval      wforzadrt=*on
066460110422     c                   endif
066470070831     c                   endif
066480940916     C* OK
066490940916     C  N90              MOVE      G02INV        COMDRT
066500940916     C  N90              MOVE      G02DAT        VIDDRT
066510940916     C*
066520950215     C  N90              MOVEL     VIDDRT        SAVDRT
066530070829     C  N90              MOVEL     VIDDRT        S_DRT
066540940916    0C                   ENDIF
066550990610   0AC                   ENDIF
066560990610     C*
066570990610     C     VIDDRT        IFEQ      0
066580990610     C                   CLEAR                   COMDRT
066590990610     C                   CLEAR                   SAVDRT
066600990610     C                   ENDIF
066610990628     C* PRESTAZIONE MATTINO POMERIGGIO
066620040909     C  N90PARTCH        IFNE      'P'
066630010307     C     §LPFPR        ANDNE     'O'
066640990628     C     VIDFPP        ANDEQ     ' '
066650010503     C     WPERSO        ANDNE     'P'
066660990628     C                   MOVEL     ERR(163)      VIDMSG
066670990628     C                   SETON                                        4090
066680990628    1C                   ENDIF
066690940916     C                   ENDSR
066700940824     C*
066710940824     C* CONTROLLO NAZIONE E P.IVA ------------------------------------*
066720940907     C     CTRNAR        BEGSR
066730940824     C*
066740020211     C                   MOVEL     '15'          COD
066750020211     C                   MOVEL     '15'          CODTAB
066760940824     C* RICERCA
066770940824     C     '?'           SCAN      WNAR                                   30
066780941003    1C     *IN30         IFEQ      *ON
066790020213     c                   call      'TRUL19R'
066800020130     c                   parm                    codtab            2
066810020305     c                   parm      '1'           ordina            1
066820020130     c                   parm                    keytab            8
066830020130     c                   parm                    cmd               1
066840020130     C                   MOVEL     keytab        WNAR
066850940824     C                   GOTO      ENDCNA
066860941003    1C                   ENDIF
066870940824     C* CONTROLLO
066880940920     C                   MOVEL(P)  WNAR          KEY
066890940824     C*
066900940824     C                   EXSR      CTABEL
066910940824     C*
066920941003    1C     *IN30         IFEQ      *ON
066930940824     C                   MOVEL     ERR(28)       VIDMSG
066940940920     C                   SETON                                        6890
066950940824     C                   GOTO      ENDCNA
066960941003    1C                   ENDIF
066970941003     C*
066980941003     C                   MOVEL     TBLUNI        DS15
066990940907     C*
067000940825     C     ENDCNA        TAG
067010940825     C   90              MOVEL     '1'           WEMFOR
067020940825     C                   ENDSR
067030940824     C*
067040940824     C* CONTROLLO LINEA DI PARTENZA ---------------------------------*
067050940824     C     CTRLNP        BEGSR
067060940824     C*
067070940824    1C     SAVLNP        IFNE      WLNP
067080981007     C     BLPDSP        ORNE      SAVDSP
067090000518     C* RICNTROLLO SE BOLLA IMPORT DPD MA INDICATORE RELATIVO SPENTO
067100020319     C     §OGNTW        OREQ      'DPD'
067110000518     C     *IN79         ANDEQ     *OFF
067120940824     C* CONTROLLO CHE SIA GESTIBILE
067130070807     c                   if        simtpp='2' or simtpp=*blanks
067140070807     C     WLNP          LOOKUP    L6                                     30
067150070807     c                   else
067160940824     C     WLNP          LOOKUP    L1                                     30
067170070807     c                   endif
067180940928    2C     *IN30         IFEQ      *OFF
067190940824     C                   MOVEL     ERR(8)        VIDMSG
067200940920     C                   SETON                                        9045
067210940824     C                   GOTO      ENDCLP
067220940928    2C                   ENDIF
067230941230     C*
067240940824     C                   Z-ADD     WLNP          W0030             3 0
067250940824     C     W0030         CHAIN     AZORG01L      UNIORG               30
067260940928    2C     *IN30         IFEQ      *ON
067270940921     C     *IN30         OREQ      *OFF
067280940921     C     ORGFVA        ANDNE     *BLANKS
067290940824     C                   MOVEL     ERR(8)        VIDMSG
067300940920     C                   SETON                                        9045
067310940824     C                   GOTO      ENDCLP
067320940928    2C                   ENDIF
067330971211     C**
067340971211     C* MEMORIZZO IL CAPO SDI E SE E' ESTERO
067350000121     C*
067360991130      * DATI DPD: SE LNP DPD PROTEGGO SEMPRE RMA E SE LA SIGLA OPERATORE
067370991130      *           È UNA DI QUELLE PROTETTE, *IN13 = *ON, ANCHE RMN
067380991117     C                   MOVEL     ORGDE3        OG143
067390020319     C     §OGNTW        COMP      'DPD'                                  79
067400940824     C*
067410940824     C* PRENDO TERMINAL PARTENZA LINEA DI PARTENZA
067420970925     C                   CLEAR                   DSLV55
067430970925     C                   MOVEL     'P'           D55TPT
067440970925     C                   MOVEL     W0030         D55LIN
067450970925     C                   MOVEL     BLPDSP        D55DRF
067460970925     C                   CALL      'FNLV55R'
067470970925     C                   PARM                    DSLV55
067480970925     C     D55ERR        IFEQ      ' '
067490970925     C                   MOVEL     D55TFP        COMTFP            3 0
067500970925     C                   ELSE
067510001024     C                   MOVEL     ERR(211)      VIDMSG
067520001024     C                   SETON                                        9045
067530001024     C                   GOTO      ENDCLP
067540970925     C                   ENDIF
067550940824     C*
067560940824     C* PRENDO COD TRATTAMENTO MERCE DI DFT DELLA LINEA DI PARTENZA
067570940824     C                   MOVEL     '3G'          COD
067580940920     C                   MOVEL(P)  WLNP          KEY
067590940824     C*
067600940824     C                   EXSR      CTABEL
067610940824     C  N30              MOVEL     TBLUNI        COMCTM
067620940824     C   30              MOVEL     '  '          COMCTM
067630940824     C*
067640990610     C* CAMBIATA LNP: CONTROLLO IL CLIENTE ANCHE SE PERSONALIZZATO
067650990610     C                   MOVEL     'S'           WCOCCM            1
067660010219     C* RICHIAMO ROUTINE CHE DETERMINA SE LINEA CON PROC. ORM ATTIVATA
067670010219     C     SAVLNP        IFNE      WLNP
067680010219     C                   Z-ADD     WLNP          WLNPO
067690010219     C                   EXSR      ATTORM
067700011122     C* Se cambiata lnp devo ricordarmi di eseguire il controllo O.R.M.
067710011122     C* anche se è stato personalizzato
067720011122     C     WORM          IFEQ      'S'
067730011122     C                   MOVEL     '1'           WCKORM            1
067740011122     C                   ENDIF
067750010219     C                   ENDIF
067760010219     C                   MOVEL     WLNP          SAVLNP
067770010219     C                   MOVEL     BLPDSP        SAVDSP
067780990610     C                   ENDIF
067790940824     C     ENDCLP        ENDSR
067800940824     C*
067810010212     C* CONTROLLO NUMERO O.R.M. -------------------------------------*
067820010212     C     CTRORM        BEGSR
067830010305     C     §LPFPR        IFEQ      'O'
067840010305     C                   CLEAR                   FLGFIT
067850010305     C                   ENDIF
067860011122     C* SOLO SE NON È STATO PERSONALIZZATO
067870011122     C* DEVO PERO' RICONTROLARE SEMPRE IN CASO DI VARIAZIONE DELLA LINE
067880011122     C* DI PARTENZA
067890010222    0C     *IN37         IFEQ      *OFF
067900010305     C     §LPFPR        ANDNE     'O'
067910011122     C     WCKORM        OREQ      '1'
067920010212     C                   CLEAR                   FLGFIT
067930060522     C                   CLEAR                   w_pogest
067940061124     c                   clear                   wforpf
067950010212     C* ERRORE SE NUMERO ORM = 0
067960010223    1C     WIDOR1        IFEQ      *ZEROS
067970010212     C                   MOVEL     ERR(216)      VIDMSG
067980010212     C                   SETON                                        90
067990010215    2C     WPERSO        IFEQ      'P'
068000040901     C                   Z-ADD     05            H0RIGA
068010040909     C                   Z-ADD     20            H0COLO
068020010213     C                   ELSE
068030040901     C                   Z-ADD     06            H1RIGA
068040040909     C                   Z-ADD     20            H1COLO
068050010215    2C                   ENDIF
068060010212     C                   GOTO      ENDORM
068070010212    1C                   ENDIF
068080010212     C*
068090070620     c* in manutenzione di un prepagato non si può variare il n.orm
068100070620     c                   if        *in12='1' and *in15='0' and *in22
068110070620     c                             and widorm<>s_§b4orm
068120070620     C                   SETON                                        90
068130070620     C                   MOVEL     ERR(312)      VIDMSG
068140070620     C                   SETON                                        90
068150070620    3C     WPERSO        IFEQ      'P'
068160070620     C                   Z-ADD     05            H0RIGA
068170070620     C                   Z-ADD     20            H0COLO
068180070620     C                   ELSE
068190070620     C                   Z-ADD     06            H1RIGA
068200070620     C                   Z-ADD     20            H1COLO
068210070620    3C                   ENDIF
068220070620     C                   GOTO      ENDORM
068230070620     c                   endif
068240040322      * ORM reale
068250040322if  1c                   If        widor1 <> wofit
068260010924     C                   CLEAR                   DORM01
068270010212     C     KORM          CHAIN     FNORM01L                           30
068280010924     C  N30              MOVEL     ORMFLO        DORM01
068290040322     c* se non trovato errore
068300040322    2C     *IN30         IFEQ      *ON
068310010212     C                   MOVEL     ERR(217)      VIDMSG
068320010212     C                   SETON                                        90
068330010215    3C     WPERSO        IFEQ      'P'
068340040901     C                   Z-ADD     05            H0RIGA
068350040909     C                   Z-ADD     20            H0COLO
068360010213     C                   ELSE
068370040901     C                   Z-ADD     06            H1RIGA
068380040909     C                   Z-ADD     20            H1COLO
068390010215    3C                   ENDIF
068400010212     C                   GOTO      ENDORM
068410040322    2C                   ENDIF
068420100319     c
068430100319     c* Verifico se esiste FNORE
068440100319     c*  sempre se cambiato ORM oppure se non c'è la N di IGNORARE
068450100319    2C     WIDORM        IFNE      W01ORM
068460100319     c     wesore        orne      'N'
068470100319     c                   clear                   wesore
068480100319     c                   clear                   DoreGEN
068490100319     C     KORME         CHAIN     FNORE01L                           30
068500100319     c                   if        %found(fnore01l)
068510100319     C                   MOVEL     OReDati       DOReGEN
068520100319     C                   Z-ADD     1             C
068530100319     C     §oretsp       LOOKUP    TSP(C)                                 30
068540100319    4c                   if        *in30 and uts(c)='S'
068550100319     c                   eval      WEsORE='S'
068560100319     c                   endif
068570100319     c                   endif
068580100319     c                   endif
068590040322      * ORM fittizzio
068600040322   x1c                   Else
068610100322     c                   clear                   wesore
068620100322     c                   clear                   DoreGEN
068630040322      * memorizzo
068640010212     C                   MOVEL     'S'           FLGFIT            1
068650150303     c                   if        savfpr<>'B'
068660011121     C                   CLEAR                   ATRDES
068670100319     C* devo anche pulire i campi del destinatario solo se il
068680011205     C* precedente orm prevedeva la forzatura del destinatario
068690011205     C     SORMFD        IFEQ      'S'
068700011205     C                   CLEAR                   VIDRSD
068710011205     C                   CLEAR                   VIDIND
068720011205     C                   CLEAR                   VIDCAD
068730011205     C                   CLEAR                   VIDLOD
068740011205     C                   CLEAR                   VIDPRD
068750011205     C                   CLEAR                   VIDNZD
068760011205     C                   CLEAR                   SORMFD
068770011205     C                   ENDIF
068780150303     c                   endif
068790010212    1C                   ENDIF
068800051207     c
068810051207     c                   clear                   vidmsg
068820010212     C* eseguo i seguenti controlli solo se orm non fittizio
068830010215    1C     FLGFIT        IFEQ      *BLANKS
068840010409     C* ERRORE SE O.R.M. ANNULLATO
068850010409    2C     ORMATB        IFNE      *BLANKS
068860010409     C                   MOVEL     ERR(228)      VIDMSG
068870010409   X2C                   ELSE
068880010212     C* ERRORE SE P.O. RITIRO DIVERSO DA LINEA DI PARTENZA BOLLA
068890010409    3C     ORMPOR        IFNE      WOLNP
068900060522     c* verifico se p.o. ritiro gestito dalla lnp bolla
068910060522     c* perchè in tal caso non devo dare errore se p.o. ritiro <> da
068920060522     c* lnp bolla
068930060522     c                   clear                   dslv55
068940060522     c                   eval      d55tpt = '6'
068950060522     c                   z-add     ormpor        d55lin
068960060522     c                   z-add     blpdsp        d55drf
068970060522     c                   call      'FNLV55R'
068980060522     c                   parm                    dslv55
068990060522     c                   if        d55err <> *blanks or d55tfa <> wolnp
069000051207     c* Verifico se si tratta di dati edi trasferiti: in questo caso
069010051206     c*  non do errore
069020051206     c                   clear                   tntb50ds
069030051206     C                   move      VIDCCM        b50ke2
069040051206     C*
069050051206    3C     VIDFLC        IFEQ      0
069060051206     C                   MOVEL     VIDLNP        b50ke2
069070051206     C                   ELSE
069080051206     C                   MOVEL     VIDFLC        b50ke2
069090051206    3C                   ENDIF
069100051206     c
069110051206     c                   movel     b50ke2        b50ke1
069120051207     c* controllo linea e p.o. orm
069130051207     c                   movel     'O'           b50opz
069140051207     c                   movel     ormpor        b50ormreso
069150051206     c                   movel     wolnp         b50poa
069160051206     c                   call      'TNTB51R'
069170051206     c                   parm                    kpjba
069180051206     c                   parm                    tntb50ds
069190051206     c
069200051206     c                   if        b50err<>' '
069210081215     c* po ritiro orm diverso da lnp vanno bene per dpd purchè entrambi
069220081215     c* i network siano dpd
069230081215     c                   clear                   ntwpor
069240081215     c                   if        §ogntw='DPD'
069250081215     C     ORMPOr        CHAIN     AZORG01L      UNIORG
069260081215     C                   MOVEL     OG143         SAV143
069270081215     C                   MOVEL     ORGDE3        OG143
069280081215     c                   movel     §ogntw        ntwpor
069290081215     C                   MOVEL     SAV143        OG143
069300081215     c                   endif
069310081215     c                   if        §ogntw<>'DPD' or ntwpor<>'DPD'
069320010212     C                   MOVEL     ERR(218)      VIDMSG
069330081215     c                   endif
069340010409    3C                   ENDIF
069350060522     c                   else
069360060522     c*se p.o. ritiro gestito da lnp bolla memorizzo
069370060522     c                   z-add     d55tfa        w_pogest
069380060522    3C                   ENDIF
069390051206    3C                   ENDIF
069400070529     c* verifico se p.o. ritiro abilitato allo scarico dei PDA
069410070606     c* cerco la capofila del p.o. ritiro
069420070606     c                   clear                   dslv55
069430070606     c                   z-add     ormpor        d55lin
069440070606     c                   movel     '6'           d55tpt
069450070606     c                   z-add     ormddc        d55drf
069460070606     c                   call      'FNLV55R'
069470070606     c                   parm                    dslv55
069480070606     c     d55tfa        chain     azorg01l      uniorg
069490070529     c                   if        %found(azorg01l)
069500070529     C                   MOVEL     ORGDE8        OG148
069510070529     c                   else
069520070529     c                   clear                   og148
069530070529     c                   endif
069540070529     c                   movel     §ogpdaorm     s_§ogpdaorm
069550070606     c* memorizzo il p.o. gestore del p.o. ritiro per eventuali ricerche su
069560070606     c* tab "PDO"
069570080111     c****               z-add     d55tfa        g_ormpor
069580010409    2C                   ENDIF
069590051206     c
069600051207    2C**   ORMATB        IFNE      *BLANKS
069610051207     C**   ORMPOR        ORNE      WOLNP
069620051207     c* Visto che in un caso p.o. ritiro <> da linea bolla va bene, tes
069630051207     c*  to il campo messaggio
069640051207     c                   if        vidmsg<>*blanks
069650010212     C                   SETON                                        90
069660010215    3C     WPERSO        IFEQ      'P'
069670040901     C                   Z-ADD     05            H0RIGA
069680040909     C                   Z-ADD     20            H0COLO
069690010213     C                   ELSE
069700040901     C                   Z-ADD     06            H1RIGA
069710040909     C                   Z-ADD     20            H1COLO
069720010215    3C                   ENDIF
069730010212     C                   GOTO      ENDORM
069740010215    2C                   ENDIF
069750010216     C* CMD14 - VISUALIZZA ORM
069760010223     C     *INKH         IFEQ      *ON
069770010216     C                   CLEAR                   FIOR07
069780010216     C                   Z-ADD     WOPOE         D07POE
069790010222     C                   Z-ADD     WONSR         D07NSR
069800010222     C                   Z-ADD     WONOR2        D07NOR
069810010216     C                   Z-ADD     WONRV         D07NRV
069820020513     c     simtpp        ifeq      '2'
069830020513     c     simtpp        oreq      *blanks
069840020513     c                   move      simpou        d07fgs
069850010216     C                   ELSE
069860010216     C                   Z-ADD     SIMFEL        D07FGS
069870010216     C                   ENDIF
069880010216     C                   MOVEL     FIOR07        KPJBU
069890010216     C                   CALL      'FIOR07R'
069900010216     C                   PARM                    KPJBA
069910010227     C                   MOVEL     '1'           WEMFOR
069920010216     C                   GOTO      ENDORM
069930010216     C                   ENDIF
069940010214     C* SE NON SONO NEL GIRO DEI PREPAGATI ORMTOR DEVE ESSERE DIVERSO
069950010214     C* DA "P"
069960010215    2C     *IN22         IFEQ      *OFF
069970010214     C     ORMTOR        ANDEQ     'P'
069980010214     C                   MOVEL     ERR(222)      VIDMSG
069990010214     C                   SETON                                        90
070000010215    3C     WPERSO        IFEQ      'P'
070010040901     C                   Z-ADD     05            H0RIGA
070020040909     C                   Z-ADD     20            H0COLO
070030010214     C                   ELSE
070040040901     C                   Z-ADD     06            H1RIGA
070050040909     C                   Z-ADD     20            H1COLO
070060010215    3C                   ENDIF
070070010503     C                   GOTO      ENDORM
070080010215    2C                   ENDIF
070090010214     C* VICEVERSA DEVE ESSERE = "P"
070100010215    2C     *IN22         IFEQ      *ON
070110010214     C     ORMTOR        ANDNE     'P'
070120010214     C                   MOVEL     ERR(223)      VIDMSG
070130010214     C                   SETON                                        90
070140010215    3C     WPERSO        IFEQ      'P'
070150040901     C                   Z-ADD     05            H0RIGA
070160040909     C                   Z-ADD     20            H0COLO
070170010214     C                   ELSE
070180040901     C                   Z-ADD     06            H1RIGA
070190040909     C                   Z-ADD     20            H1COLO
070200010215    3C                   ENDIF
070210010503     C                   GOTO      ENDORM
070220010215    2C                   ENDIF
070230100319     c
070240100319     c* Se presente LINEA DI ARRIVO personalizzata e  <> dall'ORM
070250100319     c*  oppure disk B --> erore bloccante
070260100319    2c                   if         not *in12 or not *in15
070270100319    3c                   if         ormpoc>0
070280100319     c
070290100319    4c                   if        (vidlna>*zeros  and *in20 )
070300100319     c                             or (*in12 and not *in15 and §1bfg6='C')
070310100319     c                   movel     vidlna        w0030
070320100319    5c                   if        w0030<>ormpoc
070330100319     C                   MOVEL     ERR(73)       VIDMSG
070340100319     C                   SETON                                        90
070350100319    6C     WPERSO        IFEQ      'P'
070360100319     C                   Z-ADD     05            H0RIGA
070370100319     C                   Z-ADD     20            H0COLO
070380100319     C                   ELSE
070390100319     C                   Z-ADD     06            H1RIGA
070400100319     C                   Z-ADD     20            H1COLO
070410100319    6C                   ENDIF
070420100319     C                   GOTO      ENDORM
070430100319    5C                   ENDIF
070440100319    4C                   ENDIF
070450100319    3C                   ENDIF
070460100319     c
070470100319     c* Se presente FNORE e TSP personalizzato <> dall'ORM
070480100319     c*  errore bloccante
070490100319    3c                   if        wesORE='S'
070500100319    4c                   if        (vidtsp<>' '    and *in18) or
070510100319     c                             (*in12 and not *in15 and §1bfg6='C')
070520100319
070530100319    5c                   if        vidtsp<>§oretsp
070540100319     C                   MOVEL     ERR(71)       VIDMSG
070550100319     C                   SETON                                        90
070560100319    6C     WPERSO        IFEQ      'P'
070570100319     C                   Z-ADD     05            H0RIGA
070580100319     C                   Z-ADD     20            H0COLO
070590100319     C                   ELSE
070600100319     C                   Z-ADD     06            H1RIGA
070610100319     C                   Z-ADD     20            H1COLO
070620100319    6C                   ENDIF
070630100319     C                   GOTO      ENDORM
070640100319    5C                   ENDIF
070650100319    4C                   ENDIF
070660100319    3C                   ENDIF
070670100319    2C                   ENDIF
070680100319     c
070690030805      * controllo la serie dell'ORM, se inserita deve esistere la key
070700030805      * poe + nrs in tab. 'OSR'
070710130116      * dal 16/01/2013 non è più così
070720130116      * la tabella OSR la leggo per cliente ORDINANTE dell'ORM
070730130116      * controllare solo la serie dell'ORM immessa è inutile
070740130116      * l'importante è che esista l'ORM
070750130117If  2c                   If        wonsr > *Zeros
070760130117      /free
070770130117       //?Non faccio controlli se OK orm RC, l'orm è stato controllato
070780130117       //?prima e se è un ORM con serie i controlli sono già stati fatti
070790130117       //?all'immissione dell'ORM
070800130117       //?qua devo solo recuperare i dati dalla tabella OSR
070810130117       //?la tabella la devo agganciare per cliente ordinante dell'ORM
070820130117       //?(solo i primi 7 caratteri del campo ORMCOR)
070830130117         clear dOSR;
070840130117         wORMcor = %dec(%subst(%editc(ORMcor:'X'):1:7):7:0);
070850130117         osrxx = %lookup(wORMcor:skCLIosr);
070860130117         IF  osrxx > 0;
070870130117         //?aggancio tabella OSR per recupero dati x ORM da tabella
070880130117           clear dsbs02;
070890130117           T02mod = 'C';
070900130117           T02cod = 'OSR';
070910130117           T02ke1 = skLNPNRSosr(osrxx);
070920130117           tibs02r(kpjba:dsbs02);
070930130117           IF  T02err = *blank;
070940130117             dOSR = T02uni;
070950130117           ENDIF;
070960130117         ENDIF;
070970130117      /end-free
070980130117
070990130116     c**!!!              Clear                   dOsr
071000130116     c**!!!              Clear                   dsbs02
071010130116     c**!!!              Clear                   wkosr
071020130116     c**!!!              Eval      T02Mod = 'C'
071030130116     c**!!!              Eval      T02Sif = Knsif
071040130116     c**!!!              Eval      T02Cod = 'OSR'
071050130116     c**!!!              Movel     wopoe         wkosr
071060130116     c**!!!              Move      wonsr         wkosr
071070130116     c**!!!              Movel(p)  wkosr         T02Ke1
071080130116     c**!!!              Call      'TIBS02R'
071090130116     c**!!!              Parm                    Kpjba
071100130116     c**!!!              Parm                    Dsbs02
071110130116If  3c**!!!              If        T02Err <> *Blanks
071120130116If  4C**!!!              If        wperso = 'P'
071130130116     c**!!!              Z-Add     05            H0riga
071140130116     c**!!!              Z-Add     20            H0colo
071150130116   x4c**!!!              Else
071160130116     c**!!!              Z-Add     06            H1riga
071170130116     c**!!!              Z-Add     20            H1colo
071180130116    4c**!!!              EndIf
071190130116     c**!!!              Eval      VidMsg = Err(48)
071200130116     c**!!!              Move      wonsr         w002a
071210130116     c**!!!              Eval      %subst(VidMsg:11:2) = w002a
071220130116     c**!!!              Eval      *In90 = *On
071230130116     c**!!!              GoTo      EndOrm
071240130116    3c**!!!              EndIf
071250130116     c**!!!              Movel     T02Uni        dOsr
071260030805      * se non inserito dall'utente imposto il codice bolla
071270030805If  3C                   If        wperso = 'P'
071280030805If  4c                   If        V0cCbo = *Blanks
071290030805     c                   Eval      V0cCbo = d§OsrCbo
071300030805    4c                   EndIf
071310030805   x3c                   Else
071320030805If  4c                   If        VidCbo = *Blanks
071330030805     c                   Eval      VidCbo = d§OsrCbo
071340030805    4c                   EndIf
071350030805    3c                   EndIf
071360030805    2c                   EndIf
071370010404     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
071380010404     C* ANDRO' A PROPORRE NELLE NOTE
071390050211     C***  ORMPOE        IFNE      ORMPOR
071400050211     C***  'TEL.:'       CAT       ORMTER        W021A            21
071410050211     C***  W021A         CAT(P)    ORMRER:1      WTELRF           70
071420050211     C***                MOVE      WTELRF        WTELR2           35
071430050211     C***                ENDIF
071440010212     C* L'ORM DEVE ESSERE IN UNA FASE BOLLETTABILE
071450010212     c* Errore forzabile
071460010220    2C     ORMFAO        IFNE      PREFAO
071470010220     C                   MOVE      ORMFAO        PREFAO
071480010220     C                   CLEAR                   DSBS02
071490010220     C                   MOVEL     'C'           T02MOD
071500010220     C                   MOVEL     KNSIF         T02SIF
071510010220     C                   MOVEL     'FAR'         T02COD
071520010220     C                   MOVEL     ORMFAO        T02KE1
071530010220      *
071540010220     C                   CALL      'TIBS02R'
071550010220     C                   PARM                    KPJBA
071560010220     C                   PARM                    DSBS02
071570010220    3C     T02ERR        IFEQ      *BLANKS
071580010220     C                   MOVEL     T02UNI        DFAR
071590010220     C                   ELSE
071600010220     C                   CLEAR                   DFAR
071610010220    3C                   ENDIF
071620010220    2C                   ENDIF
071630010620     C* Se fase 999: errore bloccante
071640010620     C     §FARFB        IFEQ      'N'
071650050504     c     §lpfpr        andne     'O'
071660010620     C                   MOVEL     ERR(219)      VIDMSG
071670010620     C                   MOVE      *BLANKS       BLANK            45
071680010620     C                   MOVE      BLANK         VIDMSG
071690010620     C                   SETON                                        90
071700010620    4C     WPERSO        IFEQ      'P'
071710040901     C                   Z-ADD     05            H0RIGA
071720040909     C                   Z-ADD     20            H0COLO
071730010620     C                   ELSE
071740040901     C                   Z-ADD     06            H1RIGA
071750040909     C                   Z-ADD     20            H1COLO
071760010620    4C                   ENDIF
071770010620     C                   GOTO      ENDORM
071780010620     C                   ENDIF
071790010220     C*
071800010215    2C     WIDORM        IFNE      W01ORM
071810010223     C                   CLEAR                   WOVUO
071820070427     C                   CLEAR                   WOVUO1
071830070918     C                   CLEAR                   savdrt
071840010226     C                   MOVEL     'S'           CHGORM            1
071850090327     C                   MOVEL     'S'           CHGORM1           1
071860091120     C                   MOVEL     'S'           CHGORM2           1
071870090327     c                   clear                   w_fcli            1
071880031001     c                   Clear                   wfortbo
071890010215     C* Se sono in manutenzione memorizzo che è cambiato il numero
071900010215     C* O.R.M. (Mi serve nelle routine che propongono i campi da orm
071910010215     C* che se in manutenzione devo proporre solo se modificato n. orm)
071920010215    3C     *IN12         IFEQ      *ON
071930010215     C     *IN15         ANDEQ     *OFF
071940010215     C                   MOVEL     '1'           WORMMD            1
071950010215    3C                   ENDIF
071960010214     C* Quando cambia il numero O.R.M. devo pulire i campi per la forza
071970010214     C* tura usati nella routine di controllo congruenza con campi dell
071980010214     c* O.R.M.
071990090326     C                   CLEAR                   PREDRT
072000010214     C                   CLEAR                   PREPDR
072010010214     C                   CLEAR                   PREFPP
072020010214     C                   CLEAR                   PRECCM
072030010214     C                   CLEAR                   PREFFD
072040010214     C                   CLEAR                   PRECTR
072050010504     C* Pulisco anche campo per forzatura su n. O.R.M.
072060010504     C                   CLEAR                   WFORZO
072070070905     c                   clear                   s_drt
072080070905     c                   if        wperso='P'
072090070905     c                   movel     nodi          at0daorm
072100070905     c                   else
072110070905     c                   movel     nodi          atrdaorm
072120070905     c                   endif
072130011122     C* A cambio numero O.R.M. devo anche reimpostare la lna + FLAG DPD
072140111124     c* e clearo i campi note da orm
072150011122    3C     *IN12         IFEQ      *OFF
072160011122     C     *IN15         OREQ      *OFF
072170111124     c                   clear                   vidno1
072180111124     c                   clear                   vidno2
072190111128     c                   clear                   viddno
072200011122     C                   CLEAR                   VIDDPD
072210070214     c* in manutenzione e lna dpd o fedex non la clearo altrimenti non
072220070214     c* è possibile reinstradarla a dpd/fedex
072230070214    4C     ORMPOC        IFEQ      *ZEROS
072240070214     c                   if        *in12='0' or (savntw<>'DPD' and savntw<>
072250070214     c                             'FED')
072260011122     C                   CLEAR                   VIDLNA
072270070214     c                   endif
072280011122     C* SE LNA PERSONALIZZATA DEVO IMPOSTARE QUESTA
072290011122    5C     *IN20         IFEQ      *ON
072300011122     C                   MOVE      V0CLNA        VIDLNA
072310011122    5C                   ENDIF
072320011122    4C                   ENDIF
072330011122     C* Sempre a cmabio di O.R.M. devo anche pulire i campi del desti-
072340011205     C* natario solo se il precedente orm prevedeva la forzatura del
072350011205     C* destinatario
072360011205     C     SORMFD        IFEQ      'S'
072370011122     C                   CLEAR                   VIDRSD
072380011122     C                   CLEAR                   VIDIND
072390011122     C                   CLEAR                   VIDCAD
072400011122     C                   CLEAR                   VIDLOD
072410011122     C                   CLEAR                   VIDPRD
072420011122     C                   CLEAR                   VIDNZD
072430011205     C                   CLEAR                   SORMFD
072440011205     C                   ENDIF
072450011122    3C                   ENDIF
072460010214     C*
072470011122     C                   MOVE      WIDORM        W01ORM
072480010215    3C     §FARFB        IFNE      'S'
072490050504     c     §lpfpr        andne     'O'
072500010212     C                   MOVEL     ERR(219)      VIDMSG
072510010212     C                   SETON                                        90
072520010215    4C     WPERSO        IFEQ      'P'
072530040901     C                   Z-ADD     05            H0RIGA
072540040909     C                   Z-ADD     20            H0COLO
072550010213     C                   ELSE
072560040901     C                   Z-ADD     06            H1RIGA
072570040909     C                   Z-ADD     20            H1COLO
072580010215    4C                   ENDIF
072590010212     C                   GOTO      ENDORM
072600010215    3C                   ENDIF
072610010212     C*
072620010215    2C                   ENDIF
072630010504     C* IN IMMISSIONE NON E' POSSIILE UTILIZZARE UN O.R.M. LE CUI BOLLE
072640010504     C* VENGONO TRASMESSE CON DISK
072650010504     C* ERRORE FORZABILE CON F20
072660010504    2C     *IN12         IFEQ      *OFF
072670010504     C* MEMORIZZO SE PREMUTO COMANDO PER FORZATURA
072680010504     C     *INKU         IFEQ      *ON
072690010504     C                   MOVEL     '1'           WFORZO            1
072700010504     C                   ENDIF
072710010924    3C     §ORMCB        IFEQ      'S'
072720010504     C     WFORZO        ANDEQ     *BLANKS
072730010504     C                   SETON                                        90
072740010504     C                   MOVEL     ERR(230)      VIDMSG
072750010504    4C     WPERSO        IFEQ      'P'
072760040901     C                   Z-ADD     05            H0RIGA
072770040909     C                   Z-ADD     20            H0COLO
072780010504     C                   ELSE
072790040901     C                   Z-ADD     06            H1RIGA
072800040909     C                   Z-ADD     20            H1COLO
072810010504    4C                   ENDIF
072820010504     C                   GOTO      ENDORM
072830010504    3C                   ENDIF
072840010504    2C                   ENDIF
072850011122     C* Proteggo i campi a video relativi il destinatario se devo forza
072860011122     C* re il destinatario da orm
072870011122     C     §ORMFD        IFEQ      'S'
072880011122     C                   MOVEL     PROT          ATRDES
072890011122     C                   ELSE
072900011122     C                   CLEAR                   ATRDES
072910011122     C                   ENDIF
072920090429
072930090429     c                   clear                   poentw
072940090429     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
072950090429     C                   MOVEL     OG143         SAV143
072960090429     C  N30              MOVEL     ORGDE3        OG143
072970090429     C   30              CLEAR                   OG143
072980090429     c                   eval      poentw=§ogntw
072990090429     C                   MOVEL     SAV143        OG143
073000090429
073010010227     C* SE ORM FITTIZIO E PREMUTO F8 DEVO RIEMETTERE LA VIDEATA
073020010227   X1C                   ELSE
073030040319      * imposto flag se sono in manutenzione ed ho modificato il n. ORM
073040040319if  2c                   If        *In12 and Not *In15 and
073050040319     c                             widorm <> w01orm
073060040319     C                   Eval      wmodorm = *On
073070040319e   2c                   EndIf
073080070829     c* a cambio numero orm devo mettere in ND la scritta
073090070829     c* eventuale "DA O.R.M."
073100070829     c                   if        widorm <> w01orm
073110090327     C                   MOVE      WIDORM        W01ORM
073120090327     C                   MOVEL     'S'           CHGORM1           1
073130091120     C                   MOVEL     'S'           CHGORM2           1
073140090327     c                   clear                   w_fcli
073150070918     c                   clear                   savdrt
073160070829     c                   if        wperso='P'
073170070829     c                   eval      at0daorm=nodi
073180070829     c                   else
073190070829     c                   eval      atrdaorm=nodi
073200070829     c                   endif
073210111124     c                   clear                   vidno1
073220111124     c                   clear                   vidno2
073230111128     c                   clear                   viddno
073240070829     c* solo in immissione: reimposto la data ritiro a udate se l'utente non
073250070829     c* l'ha variata
073260070829     c                   if        *in12='0' and viddrt<>wdtgio and viddrt>0
073270071107     c****                         and viddrt=s_drt  and dateu>=§vpodrt
073280071107     c                             and viddrt=s_drt
073290070831     c                   if        wperso='P'
073300070831     c                   clear                   viddrt
073310070831     c                   eval      s_drt=viddrt
073320070831     c                   else
073330070829     c                   eval      viddrt=wdtgio
073340070829     c                   eval      s_drt=wdtgio
073350070831     c                   endif
073360070829     c                   movel     '1'           wemfor
073370070829     c                   goto      endorm
073380070829     c                   endif
073390070904     c* Per ora non faccio il seguente controllo: se passo da un reale a un
073400070904     c* fittizio l'utente deve stare attento alla data ritiro.
073410070829     c* in manutenzione: se orm sulla bolla 999999 e data ritiro video<>da
073420070829     c* data ritiro bolla rimetto data ritiro bolla
073430070904     c*                  if        *in12 and *in15='0' and viddrt<>s_drtblp
073440070904     c*                  eval      viddrt=s_drtblp
073450070904     c*                  movel     '1'           wemfor
073460070904     c*                  goto      endorm
073470070904     c*                  endif
073480070829     c                   endif
073490040319
073500010227     C   KH              MOVEL     '1'           WEMFOR
073510010227     C   KH              GOTO      ENDORM
073520010215    1C                   ENDIF
073530010222     C* PERSONALIZZAZIONE
073540010222     C     WPERSO        IFEQ      'P'
073550010222     C                   SETON                                        37
073560010222     C                   ENDIF
073570011122     C  N90              CLEAR                   WCKORM
073580011205     C* Mi salvo il contenuto §ormfd per sapere se a cambio di O.R.M.
073590011205     C* devo pulire i dati del destinatario
073600090429     c                   clear                   sormfd
073610090429     c                   if        flgfit<>'S'
073620011205     C                   MOVE      §ORMFD        SORMFD
073630090429     c                   endif
073640010222   X0C                   ELSE
073650010226     C* SE PERSONALIZZATO GESTISCO EVENTUALE CMD08
073660010227     C* CMD8 - VISUALIZZA ORM
073670010223     C     *INKH         IFEQ      *ON
073680010227     C     FLGFIT        IFNE      'S'
073690010222     C                   CLEAR                   FIOR07
073700010222     C                   Z-ADD     WOPOE         D07POE
073710010222     C                   Z-ADD     WONSR         D07NSR
073720010222     C                   Z-ADD     WONOR2        D07NOR
073730010222     C                   Z-ADD     WONRV         D07NRV
073740070627     c     simtpp        ifeq      '2'
073750020513     c     simtpp        oreq      *blanks
073760020513     c                   move      simpou        d07fgs
073770010222     C                   ELSE
073780010222     C                   Z-ADD     SIMFEL        D07FGS
073790010222     C                   ENDIF
073800010222     C                   MOVEL     FIOR07        KPJBU
073810010222     C                   CALL      'FIOR07R'
073820010222     C                   PARM                    KPJBA
073830010226     C                   ENDIF
073840010227     C                   MOVEL     '1'           WEMFOR
073850010222     C                   GOTO      ENDORM
073860010222     C                   ENDIF
073870010222    0C                   ENDIF
073880090327     c* Se era stato impostato cliente/tariffa per tassazione porti assegnati
073890090327     c* verifico se emettere messaggio per avvisare che cambiando l'orm
073900090327     c* i dati verranno automaticamente modificati
073910091120    1c                   if        chgorm1='S' and *in04
073920090327    2c***                if        flgfit<>'S' and ormksc>0
073930090327    2c****                         and wcliksc>0 and atrwksc=*blanks
073940090327    3c***                if        w_fcli=' '
073950090327     c***                movel     '1'           w_fcli
073960090327     C***                MOVEL     ERR(321)      VIDMSG
073970090327     C***                SETON                                        90
073980090327     C***                GOTO      ENDORM
073990090327    3c***                endif
074000090327    2c****               endif
074010090327    2c                   if        (flgfit<>'S' and ormksc>0)
074020090327     c                             or atrwksc<>*blanks
074030090327     c                   exsr      sr_inzwdwcli
074040090327    2c                   endif
074050090327     c                   clear                   chgorm1
074060090327    1c                   endif
074070091120     c* a cambio di orm inzializzo window per scelta beneficiario c/a
074080091120    1c                   if        chgorm2='S'
074090091120     c                   exsr      inzwdwcas
074100091123     c                   clear                   chgorm2
074110091120     c                   endif
074120010212     C     ENDORM        ENDSR
074130010215     C*
074140010214     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA I° VIDEATA) -----------*
074150010215     C     PRPOR1        BEGSR
074160010212     C                   CLEAR                   WEFORM
074170070806     C*
074180070905     C* DATA RITIRO (SOLO SE ORM E' IN UNA FASE valida ai fini della da
074190070905     c* ta ritiro)
074200070905    2C     §LPFPR        ifne      'O'
074210070905     c                   exsr      fordrt
074220070905    2C                   ENDIF
074230111124     c* NOTE in visualizzazione
074240111124     c                   if        (ormno1<> *blanks or ormno2<>*blanks)
074250111124     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
074260120127     c                   movel     ormno1        vidno1
074270120127     c                   movel     ormno2        vidno2
074280120127     c                   movel     'NoteOrm'     viddno
074290120127     C                   MOVEL     '1'           WEFORM
074300111124     c                   endif
074310070806     c*
074320010215    1C     *IN12         IFEQ      *OFF
074330010220     C* In manutenzione propongo solo se variato il numero ORM
074340010215     C     *IN15         OREQ      *OFF
074350010220     C     WORMMD        ANDEQ     '1'
074360010215     C     *IN15         OREQ      *ON
074370010212     C*
074380040901     c*
074390050426     c*****              exsr      PRPOR1bis
074400010215     C*
074410010212     C* ATTENZIONE! SE SONO IN CONFERMA BOLLE DA DISCHETTO I SEGUENTI
074420010212     C* DATI NON LI DEVO PRENDERE DALL'ORM:
074430011121     C* (FANNO ECCEZIONE LE PROPOSTE DEL DESTINATARIO SE §ORMFD='S')
074440010212     C*
074450010212     C* CLIENTE MITTENTE
074460010215    2C     *IN12         IFEQ      *OFF
074470010212     C     *IN15         OREQ      *OFF
074480010215    3C     VIDCCM        IFEQ      *ZEROS
074490031201     c                   Eval      wnoccm = '1'
074500010215    4C     ORMKSC        IFGT      *ZEROS
074510010213     C                   MOVEL     '1'           WEFORM
074520030905      * Propongo il ksc dell'orm se l'ORM preve la bolla in porto franco
074530091020    5c     §OrPfb        Ifne      'A'
074540010212     C                   MOVE      ORMKSC        VIDCCM
074550010212     C                   MOVEL     ORMKSC        W0030             3 0
074560130212     C                   Z-ADD     W0030         VIDFLC
074570010215    6C     W0030         IFNE      VIDLNP
074580130212     C****               Z-ADD     W0030         VIDFLC
074590010302     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
074600010302     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
074610041129     C                   SETON                                        14
074620010215    6C                   ENDIF
074630010215   X5C                   ELSE
074640030905      * Propongo 9999 se l'orm prevede la bolla in porto assegnato
074650010212     C                   Z-ADD     9999          VIDCCM
074660010215    5C                   ENDIF
074670010214     C                   MOVE      VIDCCM        PRECCM
074680010214     C                   MOVEL     VIDFLC        PRECCM
074690010215    5C     VIDFLC        IFEQ      0
074700010214     C                   MOVEL     VIDLNP        PRECCM
074710010215    5C                   ENDIF
074720010215   X4C                   ELSE
074730030905      * se Ksc vuoto e l'orm prevede la bolla in porto franco propongo la
074740010214     C* RAGIONE SOCIALE NEL CAMPO DELLA RICERCA ALFABETICA
074750030905    5c     §OrPfb        Ifne      'A'
074760010215    6C     VIDDMT        IFEQ      *BLANKS
074770010215     C                   MOVEL     ORMRSR        VIDDMT
074780041129     C                   MOVEL     '1'           WEFORM
074790041129     C     VIDDMT        IFNE      *BLANKS
074800041129     C***                SETON                                        0138
074810041129     C                   SETON                                        01
074820041129     C                   ENDIF
074830010215    6C                   ENDIF
074840010328   X5C                   ELSE
074850030905      * se ksc vuoto e l'orm prevede la bolla in porto assegnato
074860030905      * PROPONGO 9999 IN CCM
074870010328     C                   Z-ADD     9999          VIDCCM
074880010328     C                   MOVEL     '1'           WEFORM
074890010215    5C                   ENDIF
074900010215    4C                   ENDIF
074910010215    3C                   ENDIF
074920011121    2C                   ENDIF
074930010212     C* DESTINATARIO (RAG SOC,INDIR....)
074940011121    2C     *IN12         IFEQ      *OFF
074950011121     C     *IN15         OREQ      *OFF
074960011121     C     *IN15         OREQ      *ON
074970011121     C     §ORMFD        ANDEQ     'S'
074980011121     C*
074990010215    3C     ORMTOR        IFEQ      'S'
075000010301     C     §LPFPR        OREQ      'O'
075010010215    4C     VIDRSD        IFEQ      *BLANKS
075020011122     C     ORMRSC        ANDNE     *BLANKS
075030011121     C     §ORMFD        OREQ      'S'
075040011122     C     ORMRSC        ANDNE     VIDRSD
075050010214     C                   MOVEL     '1'           WEFORM
075060010212     C                   MOVEL     ORMRSC        VIDRSD
075070010215    4C                   ENDIF
075080010215    4C     VIDIND        IFEQ      *BLANKS
075090011122     C     ORMINC        ANDNE     *BLANKS
075100011121     C     §ORMFD        OREQ      'S'
075110011122     C     ORMINC        ANDNE     VIDIND
075120010213     C                   MOVEL     '1'           WEFORM
075130010212     C                   MOVEL     ORMINC        VIDIND
075140010215    4C                   ENDIF
075150010215    4C     VIDCAD        IFEQ      *BLANKS
075160011122     C     ORMCAC        ANDNE     *BLANKS
075170011121     C     §ORMFD        OREQ      'S'
075180011122     C     ORMCAC        ANDNE     VIDCAD
075190010213     C                   MOVEL     '1'           WEFORM
075200010212     C                   MOVEL     ORMCAC        VIDCAD
075210010215    4C                   ENDIF
075220160112     c* eseguo routine per eliminare caratteri non ammessi nella
075230160112     c* località destinatario da ORM
075240140211     c                   clear                   ormloc_n
075250140211     c                   if        ormloc<>*blanks
075260160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
075270140211     c                   eval      wtxt=ormloc
075280160112     c                   eval      ElencoChar=charnook
075290160112     c                   eval      TipoElenco='1'
075300160112     c                   clear                   UpperCase
075310160112     c                   exsr      sr_chk
075320160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
075330160112     c* alla  fine
075340140211     c                   exsr      chkstringa
075350140211     c                   movel     wtxt          ormloc_n
075360140211     c                   endif
075370010215    4C     VIDLOD        IFEQ      *BLANKS
075380140211     C     ORMLOC_n      ANDNE     *BLANKS
075390011121     C     §ORMFD        OREQ      'S'
075400140211     C     ORMLOC_n      ANDNE     VIDLOD
075410010213     C                   MOVEL     '1'           WEFORM
075420140211     C                   MOVEL     ORMLOC_n      VIDLOD
075430010215    4C                   ENDIF
075440010216    4C     VIDPRD        IFEQ      *BLANKS
075450010216     C     ORMPRC        ANDNE     *BLANKS
075460010216     C     VIDCAD        ANDEQ     ORMCAC
075470010216     C     VIDCAD        ANDNE     *BLANKS
075480011121     C     §ORMFD        OREQ      'S'
075490011122     C     ORMPRC        ANDNE     VIDPRD
075500010216     C                   MOVEL     '1'           WEFORM
075510010216     C                   MOVEL     ORMPRC        VIDPRD
075520010216    4C                   ENDIF
075530010216    4C     VIDNZD        IFEQ      *BLANKS
075540010216     C     ORMNAC        ANDNE     *BLANKS
075550010216     C     VIDCAD        ANDEQ     ORMCAC
075560010216     C     VIDCAD        ANDNE     *BLANKS
075570011121     C     §ORMFD        OREQ      'S'
075580011122     C     ORMNAC        ANDNE     VIDNZD
075590010216     C                   MOVEL     '1'           WEFORM
075600010216     C                   MOVEL     ORMNAC        VIDNZD
075610010216    4C                   ENDIF
075620010215    3C                   ENDIF
075630011121    2C                   ENDIF
075640011121     C*
075650011121    2C     *IN12         IFEQ      *OFF
075660011121     C     *IN15         OREQ      *OFF
075670010212     C* LINEA DI ARRIVO
075680010214     C* La linea di arrivo se presente sull'orm deve sempre essere
075690010214     C* uguale a video quindi, se diversa, la forzo
075700010228     C* Il messaggio di errore lo emetto solo se lna a video > 0 e <> DA ORM
075710010215    3C     ORMPOC        IFGT      *ZEROS
075720010215    4C     VIDLNA        IFGT      *ZEROS
075730010215     C                   MOVE      VIDLNA        W0030
075740010215    5C     W0030         IFNE      ORMPOC
075750010213     C                   MOVEL     RIMM          ATRLNA
075760010213     C                   MOVEL     ERR(220)      VIDMSG
075770010216     C                   MOVEL     '1'           WEFORM
075780010216     C                   MOVE      ORMPOC        VIDLNA
075790010216     C                   SETON                                        9047
075800010215    5C                   ENDIF
075810010216   X4C                   ELSE
075820010216     C                   MOVEL     '1'           WEFORM
075830010216     C                   MOVE      ORMPOC        VIDLNA
075840010216    4C                   ENDIF
075850020204     C* SE LNA DPD DEVO IMPOSTARE 'D' NEL network
075860020207     C* SE LNA FEDEX DEVO IMPOSTARE 'F' NEL network
075870010214     C* SE SONO IM MANUTENZIONE NON LO DEVO FARE PERCHE' IN QUESTO
075880010214     C* CASO NON C'E' IL CAMPO VIDDPD
075890010215    4C     *IN12         IFEQ      *OFF
075900010215     C     ORMPOC        CHAIN     AZORG01L      UNIORG               30
075910010214     C                   MOVEL     OG143         SAV143
075920010214     C                   MOVEL     ORGDE3        OG143
075930020319    5C     §OGNTW        IFEQ      'DPD'
075940020204     C                   MOVEL     'D'           VIDDPD
075950020204     c                   else
075960020204     c     §ogntw        ifeq      'FED'
075970020204     c                   movel     'F'           viddpd
075980020204     c                   endif
075990010215    5C                   ENDIF
076000010214     C                   MOVEL     SAV143        OG143
076010010215    4C                   ENDIF
076020010215    3C                   ENDIF
076030010314     C* FERMO DEPOSITO  - RIEMETTO LA VIDEATA SOLO SE SU ORM E' = 'S'
076040010215    3C     VIDFFD        IFEQ      *BLANKS
076050010215    4C     ORMFFD        IFEQ      'S'
076060010213     C                   MOVE      'S'           VIDFFD
076070010314     C                   MOVEL     '1'           WEFORM
076080010213     C                   ELSE
076090010213     C                   MOVE      'N'           VIDFFD
076100010215    4C                   ENDIF
076110010214     C                   MOVE      VIDFFD        PREFFD
076120010215    3C                   ENDIF
076130100319     c*
076140100319     c* TIPO SERVIZIO da FNORE
076150100319     c*  come per la linea di arrivo, se diversa la cambio emettendo MSG
076160100319   3ac                   if        Wesore<>'N'
076170100319     c                   clear                   WesORE
076180100319     c                   clear                   DoreGEN
076190100319     c     korme         chain     fnore01l
076200100319    3c                   if        %found(fnore01l)
076210100319     c                   movel     oredati       doreGEN
076220100319     c                   eval      wesore='S'
076230100319     C                   Z-ADD     1             C
076240100319     C     §oretsp       LOOKUP    TSP(C)                                 30
076250100319    4c                   if        *in30 and uts(c)='S'
076260100319    5c                   if        vidtsp<>*blanks and
076270100319     c                             vidtsp<>§oretsp
076280100319     C                   MOVEL     RIMM          ATRtsp
076290100319     c* Se già impostato per la linea di arrivo --> uni msg
076300100319    6c                   if        vidmsg=err(220)
076310100319     C                   MOVEL     ERR(74)       VIDMSG
076320100319     c                   else
076330100319     C                   MOVEL     ERR(75)       VIDMSG
076340100319    6c                   endif
076350100319     c
076360100319     C                   MOVEL     '1'           WEFORM
076370100319     C                   SETON                                        9048
076380100319    5C                   ENDIF
076390100319     c
076400100319     c* Riemetto video anche se TSP vuoto
076410100319     c                   if        vidtsp=' '
076420100319     C                   MOVEL     '1'           WEFORM
076430100319     c                   endif
076440100319     C                   MOVE      §oretsp       VIDtsp
076450100319    4c                   endif
076460100319    3c                   endif
076470100319   3ac                   endif
076480100319     c
076490010215    2C                   ENDIF
076500010301     C* SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI DEVO PROPORRE
076510010301     C* ANCHE COLLI E PESO
076520010301     C     §LPFPR        IFEQ      'O'
076530010301     C     V1CNCL        IFEQ      *ZEROS
076540010301     C                   Z-ADD     ORMNCL        V1CNCL
076550010301     C                   MOVEL     '1'           WEFORM
076560010305     C                   Z-ADD     ORMNCL        PRENCL
076570010301     C                   ENDIF
076580010301     C     VIDPKG        IFEQ      *ZEROS
076590010301     C                   Z-ADD     ORMPKG        VIDPKG
076600010305     C                   Z-ADD     ORMPKG        PREPKG
076610010301     C                   MOVEL     '1'           WEFORM
076620010301     C                   ENDIF
076630010301     C                   ENDIF
076640061124     c*
076650061124     c                   if        wforpf='1'
076660061124     c                   eval      §orpfb='A'
076670061124     c                   clear                   wforpf
076680061124     c                   endif
076690031201
076700031201      * se non sono in conferma bolle da clienti
076710060428if  1c                   If        (Not *In12 or Not *In15) and
076720031201      * e l'ORM prevede:
076730031201      *               --> la bolla in porto Assegnato
076740031201      *               --> paga ordinante orm
076750031201      *               --> destinatario orm estero
076760031201      *               --> ordinante orm italia
076770060428      * n.b.:per sapere se destinatario estero nei casi in cui sull'orm
076780060428      *      non è indicato ma è indicato a video devo testare il contenuto
076790060428      *      di vidnzd (wdesie infatti è disponibile solo dopo che il pgm
076800060428      *      ha fatto i controlli del destinatario che vengono fatti dopo
076810060428      *      questo controllo). Anche se non è corretto testare vidnzd
076820060428      *      per sapere se nazione estera (è il flag §15ita che me lo dice)
076830060428      *      era l'unico modo per gestire la videata in maniera chiara
076840060428      *      per il bollettista effettuando la forzatura nel momento
076850060428      *      giusto anzichè dare altre segnalazioni di errore che con-
076860060428      *      fonderebbero sicuramente.
076870031201     c                             (§OrPfb = 'A' and OrmPag = 'O' and
076880060914     c                             (OrmNac<>*Blanks or vidnzd<>*blanks))
076890060914     c*
076900060914    2c                   if        ormnao <> *blanks
076910060914     c                   movel     ormcor        po_cor            3 0
076920060914     c                   clear                   w_ordntw          1
076930060914     c     po_cor        chain     azorg01l      uniorg
076940060914    3c                   if        %found(azorg01l)
076950060914     C                   MOVEL     OG143         SAV143
076960060914     c                   movel     orgde3        og143
076970060914    4c                   if        §ogntw = 'EEX' or §ogntw='DPD'
076980060914     c                             or  §ogntw='FED'
076990060914     c                   movel     'E'           w_ordntw
077000060914    4c                   endif
077010060914     C                   MOVEL     SAV143        OG143
077020060914    3c                   endif
077030060914    2c                   endif
077040060914    2c                   if        ormnao = *blanks or w_ordntw<>'E'
077050050622      **non era impostato vidccm
077060050622     c***                          wnoccm = '1'
077070060427     c                   exsr      sr_FOrmEst
077080060914    2c                   endif
077090031201    1c                   EndIf
077100031201
077110010301     C*
077120010213     C   90              MOVEL     '1'           WEMFOR
077130010215    2C  N90WEFORM        IFEQ      '1'
077140010213     C* SE SONO IN CONFERMA RICHIAMATA CON X O W NON DEVO RIEMETTERE
077150010213     C* LA VIDEATA PER VISUALIZZARE CAMPI DA ORM QUINDI PULISCO FLAG
077160010215    3C     §LPFPR        IFEQ      'V'
077170010213     C     *IN12         OREQ      *OFF
077180010213     C     *IN15         OREQ      *OFF
077190010213     C                   ELSE
077200010213     C                   CLEAR                   WEFORM
077210010215    3C                   ENDIF
077220010215    2C                   ENDIF
077230010215    1C                   ENDIF
077240040901     C                   ENDSR
077250070806     c***
077260070806     c* Forzatura data ritiro da orm ---------------------------------*
077270070806     c***
077280070806     c     fordrt        begsr
077290070905     c*
077300070806     C                   CLEAR                   WLBDAT
077310070806     C                   MOVEL     '3'           G02ERR
077320070806     c* se fase utilizzabile propongo la data della fase
077330070806    3C     d§fardar      ifeq      'S'
077340071112     c                   if        ormfao=400
077350071112     c                   z-add     ormddc        g02inv
077360071112     c                   else
077370070806     C                   Z-ADD     ORMDFO        G02INV
077380071112     c                   endif
077390070806   x3c                   else
077400070806     c* se l'orm non è in una fase utilizzabile per la data ritiro prendo
077410070806     c* la data ritiro presente sull'orm
077420070806     C                   Z-ADD     ORMDAR        G02INV
077430070806    3c                   endif
077440070806     c* se la data ritiro da proporre è maggiore della data odierna non
077450070905     c* propongo nulla. Non propongo la data anche se bolla import
077460070905    3c                   if        g02inv<=dateu and
077470081008     c                              §ogntw<>'EEX' and §ogntw<>'FED'
077480081008     c                              and §ogntw<>'DPD'
077490071107    4c***                if        viddrt= *zeros  or
077500071107     c****                          dateu>=§vpodrt
077510081008     c*                            (§ogntw<>'EEX' and §ogntw<>'FED'
077520081008     c*                             and §ogntw<>'DPD' and
077530070905     c*                             dateu>=§vpodrt)
077540070806     C                   CALL      'XSRDA8'
077550070806     C                   PARM                    WLBDAT
077560070905    5c                   if        g02dat<>viddrt
077570070806     c* se modificata data avviso con dicitura "DA ORM" blinking
077580070806    6c                   if        viddrt>0
077590070806     c                   if        wperso='P'
077600070806     c                   movel     blnk          at0daorm
077610070806     c                   else
077620070806     c                   movel     blnk          atrdaorm
077630070806     c                   endif
077640070806    6c                   endif
077650070905     C                   MOVEL     '1'           WEFORM            1
077660070806     C                   Z-ADD     G02DAT        VIDDRT
077670070806     C                   Z-ADD     VIDDRT        PREDRT
077680070806    5c                   endif
077690070918     C                   Z-ADD     G02DAT        s_drt
077700071107    4C****               ENDIF
077710070905   x3c                   else
077720070905     c* se non propongo la data perchè > data giorno o bolla import
077730070905     c* propongo udate
077740070918     c                   if        *in12='0'
077750070918     c                   if        viddrt=*zeros or
077760071107     c                             s_drt=0
077770071107     c****                         (dateu>=§vpodrt and s_drt=0)
077780070918     c****               if        s_drt=0 or (Dateu<§vpodrt and viddrt=0)
077790070918     c                   if        viddrt<>wdtgio
077800070918     C                   MOVEL     '1'           WEFORM            1
077810070918     c                   endif
077820070905     c                   z-add     wdtgio        viddrt
077830070905     c                   z-add     wdtgio        s_drt
077840070905     C                   Z-ADD     VIDDRT        PREDRT
077850070905     c                   endif
077860070918     c                   endif
077870070806    3C                   ENDIF
077880070806    cc                   endsr
077890040901     C*
077900040901     C* Proposta dati da orm - bis - Campi della prima videata ------*
077910060522     c* ATTENZIONE! Questa routine è al momento inutilizzata. Se diveni
077920060522     c* sse necessario riattivarla occorre rivederla in quanto non
077930060522     c* è sufficiete cercare la distinta con ormpor in quanto ormpor
077940060522     c* potrebbe essere un p.o. gestito ed in questo caso bisogna
077950060522     c* cercare la distinta della lnp bolla
077960120611     C**** PRPOR1bis     BEGSR
077970040901     C*
077980040901     C* PADRONCINO - LO DETERMINO DALLA DISTINTA
077990040901     C* IDEM FLAG MATTINO/POMERIGGIO
078000040901     C* Propongo il flag mattino/pomeriggio solo se non immesso e se il
078010040901     c* padroncino a video è uguale a quello della distinta
078020040901     C* Non propongo mai se richiamata da conferma prepagati
078030120611     C**** §LPFPR        IFNE      'O'
078040120611    2C**** ORMNDC        IFGT      *ZEROS
078050120611     C**** VIDPDR        ANDEQ     *ZEROS
078060120611     C**** *IN22         ANDEQ     *OFF
078070120611    2C**** ORMNDC        ORGT      *ZEROS
078080120611     C**** VIDPDR        ANDEQ     *BLANKS
078090120611     C**** *IN22         ANDEQ     *OFF
078100120611     C**** ORMNDC        ORGT      *ZEROS
078110120611     C**** VIDPDR        ANDEQ     '?   '
078120120611     C**** *IN22         ANDEQ     *OFF
078130120611     C**** ORMNDC        ORGT      *ZEROS
078140120611     C**** VIDFPP        ANDEQ     *BLANKS
078150120611     C**** *IN22         ANDEQ     *OFF
078160120611     c****
078170120611     C****               MOVE      ORMNDC        W0050             5 0
078180120611     C**** KDST          CHAIN     FIDST01L                           30
078190120611    3C**** *IN30         IFEQ      *OFF
078200120611    4C**** VIDPDR        IFEQ      *ZEROS
078210120611    4C**** VIDPDR        OREQ      *BLANKS
078220120611    4C**** VIDPDR        OREQ      '?   '
078230120611     C****               MOVE      DSTPDR        VIDPDR
078240120611     c****               clear                   v1dpdr
078250120611     C****               MOVE      DSTPDR        PREPDR
078260120611     C****               MOVEL     '1'           WEFORM
078270120611    4C****               ENDIF
078280120611     C****               MOVE      DSTPDR        WDPDR
078290120611    4C**** VIDPDR        IFEQ      WDPDR
078300120611     C**** VIDFPP        ANDEQ     *BLANKS
078310120611     C****               MOVE      ORMNDC        W0050
078320120611     C**** KFVV          CHAIN     FNFVV01L                           30
078330120611     C****               MOVE      FVVFPP        VIDFPP
078340120611     C****               MOVEL     FVVFPP        PREFPP
078350120611     C****               MOVEL     '1'           WEFORM
078360120611    4C****               ENDIF
078370120611    3C****               ENDIF
078380120611    2C****               ENDIF
078390120611     C****               ENDIF
078400120611     c****               ENDSR
078410010214     C*
078420010214     C* CONTROLLI DI CONGRUENZA CAMPI I°VIDEATA CON CAMPI DELL'ORM --*
078430010214     C     CNFOR1        BEGSR
078440050427     c                   clear                   wcaut            27
078450010214     C*
078460010214     C* I seguenti errori sono tutti forzabili e vengono effettuati
078470010214     C* solo se numero ORM non fittizio e se non sono in immissione
078480010214     C* dei miei prepagati perchè in questo caso l'ORM viene crato
078490010214     C* dopo l'immissione del prepagato
078500010214     C*
078510010215    1C     FLGFIT        IFNE      'S'
078520010214     C     PARTCH        ANDNE     'P'
078530010214     C*
078540010214     C*** DATA RITIRO ***
078550010214     C*
078560071107     c****               if        dateu<§vpodrt
078570071107    2C**** VIDDRT        IFGT      *ZEROS
078580071107     C**** §LPFPR        ANDNE     'O'
078590071107     C**** d§fardar      ANDEQ     'S'
078600071107     C**** VIDDRT        ANDNE     PREDRT
078610071107     C**** ORMDFO        ANDNE     COMDRT
078620071107     C****               MOVEL     RIMM          ATRDRT
078630071107     C****               Z-ADD     VIDDRT        PREDRT
078640071107     C****               SETON                                        90
078650071107    2C****               ENDIF
078660071107     c****               endif
078670040902     c                   exsr      CNFOR1bis
078680010214     C* I SEGUENTI CONTROLLI VENGONO FATTI SOLO SE NON SONO IN CONFERMA
078690010214     C* BOLLE DA DISCHETTO
078700010215    2C     *IN12         IFEQ      *OFF
078710010214     C     *IN15         OREQ      *OFF
078720010214     C*
078730010214     C** CODICE CLIENTE MITTENTE
078740010214     C*
078750010215    3C     VIDCCM        IFGT      *ZEROS
078760010214     C     ORMKSC        ANDGT     *ZEROS
078770010214     C                   MOVE      VIDCCM        WOCCM
078780010214     C                   MOVEL     VIDFLC        WOCCM
078790010215    4C     WOCCM         IFNE      PRECCM
078800010214     C                   Z-ADD     WOCCM         PRECCM
078810010215    5C     VIDFLC        IFEQ      *ZEROS
078820010214     C                   MOVEL     VIDLNP        WOCCM
078830010215    5C                   ENDIF
078840010215    5C     WOCCM         IFNE      ORMKSC
078850030905    6c                   If        §OrPfb <> 'A'
078860010214     C                   MOVEL     RIMM          ATRCCM
078870010214     C                   SETON                                        90
078880010215   X6C                   ELSE
078890030905    7c                   If        Vidccm <> 9999
078900010214     C                   MOVEL     RIMM          ATRCCM
078910010214     C                   SETON                                        90
078920010215    7C                   ENDIF
078930010215    6C                   ENDIF
078940010215    5C                   ENDIF
078950010215    4C                   ENDIF
078960010215    3C                   ENDIF
078970010214     C*
078980010214     C** FERMO DEPOSITO
078990010214     C*
079000010215     C     ORMFFD        IFEQ      ' '
079010010215     C                   MOVE      'N'           W001A             1
079020010215     C                   ELSE
079030010215     C                   MOVE      ORMFFD        W001A
079040010215     C                   ENDIF
079050010215    3C     VIDFFD        IFNE      W001A
079060010214     C     VIDFFD        ANDNE     PREFFD
079070010220     C                   MOVE      VIDFFD        PREFFD
079080010214     C                   MOVEL     RIMM          ATRFFD
079090010214     C                   SETON                                        90
079100010215    3C                   ENDIF
079110010305     C*
079120010305     C** COLLI E PESO ** SE SONO IN CONFERMA PREPAGATI DI ALTRI P.O.
079130010305     C*
079140010305    3C     §LPFPR        IFEQ      'O'
079150010305    4C     V1CNCL        IFNE      ORMNCL
079160010305     C     V1CNCL        ANDNE     PRENCL
079170010305     C                   Z-ADD     V1CNCL        PRENCL
079180010305     C                   MOVEL     RIMM          ATRNCL
079190010305     C                   SETON                                        90
079200010305    4C                   ENDIF
079210010305    4C     VIDPKG        IFNE      ORMPKG
079220010305     C     VIDPKG        ANDNE     PREPKG
079230010305     C                   Z-ADD     VIDPKG        PREPKG
079240010305     C                   MOVEL     RIMM          ATRPKG
079250010305     C                   SETON                                        90
079260010305    4C                   ENDIF
079270010305    3C                   ENDIF
079280010215    2C                   ENDIF
079290010214     C*
079300010214     C   90              MOVEL     ERR(221)      VIDMSG
079310010214     C   90              MOVEL     '1'           WEMFOR
079320050427     c   90              if        wcaut <> *blanks
079330050427     c                   move      wcaut         vidmsg
079340050427     c                   endif
079350010215    1C                   ENDIF
079360010214     C                   ENDSR
079370040902     C*
079380040902     C* CONTROLLI DI CONGRUENZA CAMPI PDR e FPP CON CAMPI DELL'ORM --*
079390040902     C     CNFOR1bis     BEGSR
079400040902     C*
079410040902     C**
079420040902     C* CODICE PADRONCINO + FLAG MATTINO/POMERIGGIO
079430040902     C**
079440040902    2C     ORMNDC        IFGT      *ZEROS
079450040902     C     VIDPDR        ANDGT     *ZEROS
079460040902     C     VIDPDR        ANDNE     PREPDR
079470070606     c                   exsr      sr_dst
079480040902     C                   MOVE      DSTPDR        WDPDR
079490040902    3C     WDPDR         IFNE      VIDPDR
079500050426     c**   atrpdr        ifne      prri
079510040902     C                   MOVEL     RIMM          ATRPDR
079520050426     c**                 endif
079530040902     C                   MOVE      VIDPDR        PREPDR
079540040902     C                   SETON                                        90
079550050427     c                   move      dstpdr        wadpdr            7
079560050427     c                   eval      wcaut = caut
079570050427     c                   eval      %subst(wcaut: 6: 7) = wadpdr
079580040902    3C                   ENDIF
079590040902    2C                   ENDIF
079600040902     C* Il flag mattino/pomeriggio lo controllo solo se il PDR è =
079610040902    2C     ORMNDC        IFGT      *ZEROS
079620040902     C     VIDPDR        ANDEQ     WDPDR
079630040902     C     VIDFPP        ANDNE     *BLANKS
079640040902     C     VIDFPP        ANDNE     PREFPP
079650040902     C                   MOVE      ORMNDC        W0050
079660060522     c                   if        w_pogest = *zeros
079670060522     c                   z-add     ormpor        kfgs
079680060522     c                   else
079690060522     c                   z-add     w_pogest      kfgs
079700060522     c                   endif
079710040902     C     KFVV          CHAIN     FNFVV01L                           30
079720040902    3C     FVVFPP        IFNE      VIDFPP
079730050426     c***  atrfpp        ifne      prri
079740040902     C                   MOVEL     RIMM          ATRFPP
079750050426     c***                endif
079760040902     C                   MOVE      VIDFPP        PREFPP
079770040902     C                   SETON                                        90
079780040902    3C                   ENDIF
079790040902    2C                   ENDIF
079800040902     c                   ENDSR
079810120611     c
079820120611     C* Ricerca codice autotrasportatore che ha eseguito l'orm ----------------
079830070606     C     sr_dst        BEGSR
079840120611     c
079850120611     C                   MOVE      ORMNDC        W0050
079860070606     c                   if        w_pogest = *zeros
079870070606     C                   z-add     ORMpor        kfgs
079880070606     c                   else
079890070606     c                   z-add     w_pogest      kfgs
079900070606     c                   endif
079910120611     C     KDST          CHAIN     FIDST01L                           30
079920070606     C   30              CLEAR                   DSTPDR
079930070606     c                   endsr
079940010215     C*
079950010215     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA II° VIDEATA) ----------*
079960010215     C     PRPOR2        BEGSR
079970010215     C                   CLEAR                   WEFORM
079980010215     C*
079990010215     C** MITTENTE (RAG.SOC.,INDIRIZZO...)
080000030912      * da mittente ORM se l'ORM prevede la bolla in porto assegnato
080010030912      * o se conferma ORM prepagati
080020010215     C*
080030030912    1c                   If        Not *In02 and
080040030923     c                             (VidCcm = 9999 or
080050030923     c                             (§LpFpr = 'O' and VidCcm = 8888))
080060010215    3C     WOVUO         IFEQ      *BLANKS
080070010215     C     VIDRSM        OREQ      *BLANKS
080080010215     C                   MOVEL     ORMRSR        VIDRSM
080090010215     C                   MOVEL     '1'           WEFORM
080100010215    3C                   ENDIF
080110010215    3C     WOVUO         IFEQ      *BLANKS
080120010215     C     VIDINM        OREQ      *BLANKS
080130010215     C                   MOVEL     ORMINR        VIDINM
080140010215     C                   MOVEL     '1'           WEFORM
080150010215    3C                   ENDIF
080160010215    3C     WOVUO         IFEQ      *BLANKS
080170010215     C     VIDCAM        OREQ      *BLANKS
080180010215     C                   MOVEL     ORMCAR        VIDCAM
080190010215     C                   MOVEL     '1'           WEFORM
080200010215    3C                   ENDIF
080210010215    3C     WOVUO         IFEQ      *BLANKS
080220010215     C     VIDLOM        OREQ      *BLANKS
080230010215     C                   MOVEL     ORMLOR        VIDLOM
080240010215     C                   MOVEL     '1'           WEFORM
080250010215    3C                   ENDIF
080260010215    3C     WOVUO         IFEQ      *BLANKS
080270010329     C     VIDPRM        OREQ      *BLANKS
080280010329     C     ORMPRR        ANDNE     *BLANKS
080290010329     C     VIDCAM        ANDEQ     ORMCAR
080300010329     C     ORMCAR        ANDNE     *BLANKS
080310010215     C                   MOVEL     ORMPRR        VIDPRM
080320010215     C                   MOVEL     '1'           WEFORM
080330010215    3C                   ENDIF
080340010216    3C     WOVUO         IFEQ      *BLANKS
080350010329     C     VIDNZM        OREQ      *BLANKS
080360010329     C     ORMNAR        ANDNE     *BLANKS
080370010329     C     VIDCAM        ANDEQ     ORMCAR
080380010329     C     ORMCAR        ANDNE     *BLANKS
080390010216     C                   MOVEL     ORMNAR        VIDNZM
080400010216     C                   MOVEL     '1'           WEFORM
080410010216    3C                   ENDIF
080420061113     c*
080430061113     c                   if        *in22 and ormtco='I' and ormcor=0
080440161019     c                   if        wovuo=*blanks or
080450161019     c                             (vidcdf=*blanks and vidpim=*blanks)
080460061113     c                   move      ormino        vidcdf
080470061113     c                   endif
080480161019     c                   endif
080490031201    1C                   ENDIF
080500031201      * se ho forzato il porto franco
080510031201if  1c                   If        wforpf = '1'
080520031201if  2c                   If        Not *In02
080530031201      * imposto l'ordinante dell'orm nel mittente bolla
080540031201    3C     WOVUO         IFEQ      *BLANKS
080550031201     C     VIDRSM        OREQ      *BLANKS
080560031201     C                   MOVEL     ORMRSO        VIDRSM
080570031201     C                   MOVEL     '1'           WEFORM
080580031201    3C                   ENDIF
080590031201    3C     WOVUO         IFEQ      *BLANKS
080600031201     C     VIDINM        OREQ      *BLANKS
080610031201     C                   MOVEL     ORMINO        VIDINM
080620031201     C                   MOVEL     '1'           WEFORM
080630031201    3C                   ENDIF
080640031201    3C     WOVUO         IFEQ      *BLANKS
080650031201     C     VIDCAM        OREQ      *BLANKS
080660031201     C                   MOVEL     ORMCAO        VIDCAM
080670031201     C                   MOVEL     '1'           WEFORM
080680031201    3C                   ENDIF
080690031201    3C     WOVUO         IFEQ      *BLANKS
080700031201     C     VIDLOM        OREQ      *BLANKS
080710031201     C                   MOVEL     ORMLOO        VIDLOM
080720031201     C                   MOVEL     '1'           WEFORM
080730031201    3C                   ENDIF
080740031201    3C     WOVUO         IFEQ      *BLANKS
080750031201     C     VIDPRM        OREQ      *BLANKS
080760031201     C     ORMPRO        ANDNE     *BLANKS
080770031201     C     VIDCAM        ANDEQ     ORMCAO
080780031201     C     ORMCAO        ANDNE     *BLANKS
080790031201     C                   MOVEL     ORMPRO        VIDPRM
080800031201     C                   MOVEL     '1'           WEFORM
080810031201    3C                   ENDIF
080820031201    3C     WOVUO         IFEQ      *BLANKS
080830031201     C     VIDNZM        OREQ      *BLANKS
080840031201     C     ORMNAO        ANDNE     *BLANKS
080850031201     C     VIDCAM        ANDEQ     ORMCAO
080860031201     C     ORMCAO        ANDNE     *BLANKS
080870031201     C                   MOVEL     ORMNAO        VIDNZM
080880031201     C                   MOVEL     '1'           WEFORM
080890031201    3C                   ENDIF
080900031201    2c                   EndIf
080910031201      * imposto il mittente dell'orm nel mittente originale bolla
080920031201    2c                   If        wovuo = *Blanks or vidrmo = *Blanks
080930031201     c                   Movel     OrmRsr        vidrmo
080940031201     c                   Eval      wemfor = '1'
080950031201    2c                   EndIf
080960031201    2c                   If        wovuo = *Blanks or vidcmo = *Blanks
080970031201     c                   Movel     OrmCar        vidcmo
080980031201     c                   Eval      wemfor = '1'
080990031201    2c                   EndIf
081000031201    2c                   If        wovuo = *Blanks or  vidnmo = *Blanks
081010031201     c                   Movel     OrmNar        vidnmo
081020031201     c                   Eval      wemfor = '1'
081030031201    2c                   EndIf
081040031201    1c                   EndIf
081050010306     C*
081060010306     C* VOLUME - SOLO SE RICHIAMATA DA CONFERMA PREPAGATI DI ALTRO P.O.
081070010306     C*
081080010306    1C     §LPFPR        IFEQ      'O'
081090010306     C     ORMVLM        ANDGT     *ZEROS
081100010306     C* Metto il test su campo wovuo anche per volume per uniformità
081110010306     C* anche se in questo caso forse non serve perchè il volume
081120010306     c* non viene mai impostato diverso da 0 in ctrd01
081130010306     C     WOVUO         IFEQ      *BLANKS
081140010306     C     VIDVOL        OREQ      *ZEROS
081150010306     C                   Z-ADD     ORMVLM        VIDVOL
081160010306     C                   MOVEL     '1'           WEFORM
081170010306     C                   ENDIF
081180010306    1C                   ENDIF
081190010215     C*
081200010215     C* CODICE TARIFFA
081210010215     C*
081220031201     c                   If        Not *In29 and §OrPfb <> 'A'
081230010215     C                   MOVE      VIDCCM        W0070             7 0
081240010215    2C     VIDFLC        IFEQ      *ZEROS
081250010215     C                   MOVEL     VIDLNP        W0070
081260010215     C                   ELSE
081270010215     C                   MOVEL     VIDFLC        W0070
081280010215    2C                   ENDIF
081290010226     C* Propongo il codice tariffa da orm solo se:
081300010226     C* Stesso codice cliente mittente
081310010215    2C     W0070         IFEQ      ORMKSC
081320010226     C* immesso codice tariffa su orm
081330010215     C     ORMCTR        ANDNE     *BLANKS
081340010226     C* codice tariffa a video = blanks
081350010226     C     VIDCTR        ANDEQ     *BLANKS
081360010215     C                   MOVE      ORMCTR        VIDCTR
081370010215     C                   MOVE      ORMCTR        PRECTR
081380010215     C                   MOVEL     '1'           WEFORM
081390010215    2C                   ENDIF
081400010215    1C                   ENDIF
081410010215     C*
081420010215     C* NATURA MERCE
081430010215     C*
081440011221    1C  N27              DO
081450011221     C                   MOVEL     ORMNAM        W015A
081460011221    2C     W015A         IFNE      *BLANKS
081470010226     C     VIDNAS        ANDEQ     *BLANKS
081480010215     C                   MOVEL     ORMNAM        VIDNAS
081490010215     C                   MOVEL     '1'           WEFORM
081500011221    2C                   ENDIF
081510011221    1C                   ENDDO
081520010215     C*
081530010404     C* NOTE: SE PESO > 50 Q.LI
081540010404     C*       SE O.R.M. COMMISSIONATI DA ALTRO P.O. NELLE NOTE METTO
081550010404     C*       SEMPRE E SOLO IL REFERENTE E NUMERO DI TELEFONO
081560010307    1C                   SELECT
081570010307     C     §LPFPR        WHENEQ    'O'
081580050211     C***  ORMPOE        ORNE      ORMPOR
081590010307     C     VIDNT1        IFEQ      *BLANKS
081600010307     C                   MOVEL     WTELRF        VIDNT1
081610010307     C                   MOVEL     '1'           WEFORM
081620010307     C                   ENDIF
081630010307     C     WTELR2        IFNE      *BLANKS
081640010307     C     VIDNT2        IFEQ      *BLANKS
081650010307     C     WOVUO         OREQ      *BLANKS
081660010307     C                   MOVE      WTELR2        VIDNT2
081670010307     C                   MOVEL     '1'           WEFORM
081680010307     C                   ENDIF
081690010307     C                   ENDIF
081700010409     C     VIDPKG        WHENGE    §DFMAX
081710010215    2C     ORMNO1        IFNE      *BLANKS
081720010226     C     VIDNT1        ANDEQ     *BLANKS
081730010215     C                   MOVEL     ORMNO1        VIDNT1
081740010215     C                   MOVEL     '1'           WEFORM
081750010215    2C                   ENDIF
081760010215    2C     ORMNO2        IFNE      *BLANKS
081770010226     C     VIDNT2        IFEQ      *BLANKS
081780010226     C     WOVUO         OREQ      *BLANKS
081790010215     C                   MOVEL     ORMNO2        VIDNT2
081800010215     C                   MOVEL     '1'           WEFORM
081810010226     C                   ENDIF
081820010215    2C                   ENDIF
081830010307    1C                   ENDSL
081840010223     C                   MOVE      '1'           WOVUO             1
081850010215     C                   ENDSR
081860010215     C*
081870010215     C* CONTROLLI DI CONGRUENZA COD.TARIFFA CON CAMPO DELL'ORM ------*
081880010215     C     CNFOR2        BEGSR
081890010215     C*
081900010215     C*** CODICE TAR. ***
081910010215     C*
081920010223     C                   MOVE      VIDCCM        W0070
081930010223     C     VIDFLC        IFEQ      *ZEROS
081940010223     C                   MOVEL     VIDLNP        W0070
081950010223     C                   ELSE
081960010223     C                   MOVEL     VIDFLC        W0070
081970010223     C                   ENDIF
081980030905     C* ORM NON PAGATO DA DESTINATARIO
081990030905      * L'orm prevede la bolla in porto franco
082000030905     c     §OrPfb        Ifne      'A'
082010010223     C* PRESENTE CODICE CLIENTE SU ORM
082020010223     C     ORMKSC        ANDGT     *ZEROS
082030010223     C     ORMKSC        ANDEQ     W0070
082040010215     C     VIDCTR        IFNE      *BLANKS
082050010215     C     VIDCTR        ANDNE     PRECTR
082060010215     C     ORMCTR        ANDNE     VIDCTR
082070010215     C     ORMCTR        ANDNE     *BLANKS
082080010215     C                   MOVEL     RIMM          ATRCTR
082090010215     C                   MOVEL     VIDCTR        PRECTR
082100010215     C                   SETON                                        90
082110010215     C                   ENDIF
082120010223     C                   ENDIF
082130010215     C*
082140010215     C   90              MOVEL     ERR(224)      VIDMSG
082150010215     C   90              MOVEL     '1'           WEMFOR
082160010215     C                   ENDSR
082170070427     C*
082180070427     C* PROPOSTA mittente originale da orm per import dpd in porto assegnato
082190070427     C     PRPOR2_rmo    BEGSR
082200091008     c****               if        dateu>=§vpormo and §vpormo>0
082210070427     C                   CLEAR                   WEFORM
082220070427    2c                   If        wovuo1= *Blanks or vidrmo = *Blanks
082230070427     c                   Movel     OrmRsr        vidrmo
082240070430     c                   Eval      weform = '1'
082250070427    2c                   endif
082260070427    2c                   If        wovuo1= *Blanks or vidcmo = *Blanks
082270070427     c                   Movel     OrmCar        vidcmo
082280070430     c                   Eval      weform = '1'
082290070427    2c                   endif
082300070427    2c                   If        wovuo1= *Blanks or vidnmo = *Blanks
082310070427     c                   Movel     OrmNar        vidnmo
082320070430     c                   Eval      weform = '1'
082330070427    2c                   endif
082340070427     c                   movel     '1'           wovuo1            1
082350091008     c****               endif
082360070427     c                   endsr
082370091008     c*
082380960926     C* CONTROLLO CODICE AUTOTRASPORTATORE --------------------------*
082390940824     C     CTRPDR        BEGSR
082400940824     C*
082410940930     C                   CLEAR                   V1DPDR
082420990614     C                   CLEAR                   APDRSC
082430990614     C                   CLEAR                   APDFCM
082440990614     C                   CLEAR                   APDATB
082450940929     C*
082460940824     C     '?'           SCAN      WPDR                                   30
082470940824     C*
082480990915    1C     *IN30         IFEQ      *ON
082490021203      *
082500021203      * imposto i campi della ds esterna fnlv24ds
082510021203     C                   clear                   fnlv24ds
082520021203     C                   eval      d24fil   = wlnp
082530021203     C                   eval      d24tip   = 'A'
082540021203     C                   eval      d24flg   = 'R'
082550021203     C                   movel     fnlv24ds      kpjbu
082560940824     C                   CALL      'FNLV24R'
082570940824     C                   PARM                    KPJBA
082580021203      *
082590021203      * valorizzo i campi a video
082600021203     C                   movel     kpjbu         fnlv24ds
082610021203     C                   if        d24pdr   <> *zeros
082620021203     C                   move      d24pdr        wpdr
082630021203     C                   movel     d24rsc        v1dpdr
082640021203     C                   endif
082650021203     C                   MOVEL     '1'           WEMFOR
082660941011     C                   SETON                                        56
082670940824     C                   GOTO      ENDCPD
082680990915    1C                   END
082690940928     C* ESEGUO TESTN
082700990915    1C     PARTCH        IFNE      'P'
082710010307     C     §LPFPR        ANDNE     'O'
082720990610     C* PER PREPAGATI SOLO SE IL CAMPO E' PIENO
082730990610     C     PARTCH        OREQ      'P'
082740990610     C     WPDR          ANDNE     *BLANKS
082750990610     C     WPDR          ANDNE     *ZEROS
082760010307     C     §LPFPR        OREQ      'O'
082770010307     C     WPDR          ANDNE     *BLANKS
082780010307     C     WPDR          ANDNE     *ZEROS
082790990610     C*
082800940928     C                   TESTN                   WPDR                 30
082810940928     C                   MOVE      WPDR          W001A
082820990915    2C     *IN30         IFEQ      *OFF
082830940928     C     W001A         ORLT      '0'
082840940928     C                   MOVEL     ERR(21)       VIDMSG
082850940928     C                   SETON                                        5690
082860940928     C                   GOTO      ENDCPD
082870990915    2C                   ENDIF
082880940824     C*
082890940928     C                   MOVEL     WLNP          W0070             7 0
082900940928     C                   MOVE      WPDR          W0070
082910021204     C                   move      w0070         kpdpdr
082920021203     C                   move      'A'           kpdtip
082930021203     C     kfapd         chain     fiapd01l                           30
082940990915    2C     *IN30         IFEQ      *ON
082950940824     C     *IN30         OREQ      *OFF
082960940824     C     APDATB        ANDNE     *BLANKS
082970940824     C                   MOVEL     ERR(21)       VIDMSG
082980940920     C                   SETON                                        5690
082990940824     C                   GOTO      ENDCPD
083000990915    2C                   ENDIF
083010940824     C*
083020940824     C* NON POSSO INSERIRE UNA DATA RITIRO SE ESISTE LA CONFERMA DEI
083030960926     C*  CONTEGGI AUTOTRASPORTATORI PER QUEL GIORNO
083040950116     C                   MOVE      W0070         W01PDR
083050940824     C                   MOVEL     ' '           W01TSR
083060940824     C                   MOVEL     'C'           W01FVL
083070011126     C     KFTT          SETLL     FIFTT000                               90
083080011126     C  N90KFTT          SETLL     FIFST000                               90
083090940824     C*
083100990915    2C     *IN90         IFEQ      *ON
083110940824     C                   MOVEL     ERR(7)        VIDMSG
083120940920     C                   SETON                                        56
083130940824     C                   GOTO      ENDCPD
083140990915    2C                   ENDIF
083150990915     C*
083160990915     C* SE SI TRATTA DELLA CONFERMA DI UN PREPAGATO, DO MSG SE FLAG
083170990915     C*  MERCE A MAGAZZINO DIVERSO DAL COD AUTOTRASPORTATORE
083180990915     C     VIDPDR        IFNE      SAVPD4
083190990915     C                   CLEAR                   AAC
083200990915     C                   MOVEL     VIDPDR        SAVPD4
083210990915     C                   ENDIF
083220991001     C*
083230991001     C* CONTROLLO PER IL MOMENTO SOSPESO: QUANDO ATTIVEREMO PER I
083240991001     C*  PREPAGATI LA VARIA "U" SI DEVE RIMETTERE
083250001024     C* RIATTIVATO IL 24/10/00
083260990915     C*
083270001024     C     *IN22         IFEQ      *ON
083280990915     C     *IN12         ANDEQ     *ON
083290990915     C     *IN15         ANDEQ     *OFF
083300990915     C     AAC           ANDEQ     0
083310990915     C     BLPPDR        ANDEQ     0
083320990915     C     VIDMAG        IFNE      APDFCM
083330990915     C                   MOVEL     1             AAC
083340990915     C                   MOVEL     ERR(168)      VIDMSG
083350990915     C                   SETON                                        5690
083360990915     C                   GOTO      ENDCPD
083370990915     C                   ENDIF
083380990915     C                   ENDIF
083390940824     C*
083400940824     C                   MOVEL     APDRSC        V1DPDR
083410041013     c* se orm reale controllo che non esistano altre bolle associate
083420041013     c* allo stesso orm ma abbinate ad altro autotrasportatore.
083430041013     c* Se presenti --> errore bloccante
083440041013     C     WORM          IFEQ      'S'
083450041013     C     FLGFIT        ANDNE     'S'
083460041013     c                   exsr      SR_CtrOrmPdr
083470041013     C   90              GOTO      ENDCPD
083480041013     c                   endif
083490990915    1C                   ENDIF
083500940824     C*
083510940824     C     ENDCPD        TAG
083520940824     C   90              MOVEL     '1'           WEMFOR
083530940824     C                   ENDSR
083540041013     C**************************************************************************
083550041013     C*   Controllo esistenza altre bolle associate all'orm immesso
083560041013     C**************************************************************************
083570041013     C     SR_CtrOrmPdr  BEGSR
083580041013     C                   MOVEL     DSBLP0        SAVBLP
083590041019     c     *in12         ifeq      *on
083600041019     c     *in15         andeq     *off
083610041019     c                   movel     *blanks       savbol           16
083620041019     c                   eval      savbol = %EDITW(BLPAAS:'    ')     +
083630041019     C                                      %editw(BLPLNP:'   ')      +
083640041019     C                                      %editw(BLPNRS:'  ')       +
083650041019     C                                      %editw(BLPNSP:'       ')
083660041019     c                   endif
083670041019     c
083680060215     c                   movel     'M'           kar4trc
083690060215     c                   movel     widorm        kar4n14
083700160209     c     kar403        setll     fiar405l
083710041013     c                   do        *hival
083720160209     c     kar403        reade     fiar405l
083730041013     c* fine file
083740160209     c                   if        %eof(fiar405l)
083750041013     c                   leave
083760041013     c                   endif
083770061212     c     kblp4m        chain     fnblp01l
083780041019     c
083790041019     c     *in12         ifeq      *on
083800041019     c     *in15         andeq     *off
083810041019     c                   movel     *blanks       blpbol           16
083820041019     C                   eval      blpbol = %editw(BLPAAS:'    ')   +
083830041019     C                                      %editw(BLPLNP:'   ')    +
083840041019     C                                      %editw(BLPNRS:'  ')     +
083850041019     C                                      %editw(BLPNSP:'       ')
083860041019     c                   endif
083870041013     c* trovata bolla con aut diverso errore --> esco dal ciclo
083880041013     c                   if        %found(fnblp01l) and
083890041019     c                             blppdr <> w01pdr and
083900041019     c                             blppdr > 0
083910041019     c* se sono in manutenzione e ho letto la bolla che sto manutenzion
083920041019     c* ando ignoro
083930041019     c     *in12         ifeq      *on
083940041019     c     *in15         andeq     *off
083950041019     c     blpbol        andne     savbol
083960041019     c     *in12         oreq      *off
083970041019     c     *in15         oreq      *on
083980041019     c
083990041013     C                   MOVEL     ERR(286)      VIDMSG
084000041013     C                   SETON                                        5690
084010041013     C                   leave
084020041019     c                   endif
084030041013     c                   endif
084040041013     c
084050041013     c                   enddo
084060041013     c
084070041013     C                   MOVEL     SAVBLP        DSBLP0
084080041013     c                   endsr
084090940824     C*
084100940824     C* CONTROLLO CODICE BOLLA ---------------------------------------*
084110940824     C     CTRCBO        BEGSR
084120940824     C* NO PERSONALIZZAZIONE
084130940824    0C     *IN21         IFEQ      *OFF
084140941103     C                   SETOFF                                       040508
084150940824     C* RICERCA
084160940922     C                   MOVEL     '3A'          COD
084170940824     C     '?'           SCAN      WCBO                                   30
084180940824    1C     *IN30         IFEQ      *ON
084190940922     C                   EXSR      CX§TAB
084200940824     C                   MOVEL     §KEY          WCBO
084210941011     C                   SETON                                        46
084220940824     C                   GOTO      ENDCCB
084230940824    1C                   ENDIF
084240940824     C*
084250940920     C                   MOVEL(P)  WCBO          KEY
084260940824     C*
084270940824     C                   EXSR      CTABEL
084280940824    1C     *IN30         IFEQ      *ON
084290940824     C                   MOVEL     ERR(10)       VIDMSG
084300940920     C                   SETON                                        4690
084310940824     C                   GOTO      ENDCCB
084320940824    1C                   ENDIF
084330940824     C*
084340940824     C                   MOVEL     TBLUNI        DS3A
084350940824     C                   MOVEL     §3ATB1        FLGTB1            1
084360940824     C                   MOVEL     §3ADES        V2DCBO
084370940824     C* VEDO SE CAUSALE UTILIZZABILE
084380940824     C  N12
084390940824     CORN44
084400940824    1CAN 12§3AUCB        IFEQ      'N'
084410940824     C                   MOVEL     ERR(10)       VIDMSG
084420940920     C                   SETON                                        4690
084430940824     C                   GOTO      ENDCCB
084440940824    1C                   END
084450000509     C*
084460000509     C* PER BOLLE POSTE AMMESSO SOLO FRANCO
084470020319     C     §ogntw        IFEQ      'PPT'
084480000906     C     FLGTB1        IFNE      'F'
084490000906     C     §3ATB2        ORNE      '  '
084500000509     C                   MOVEL     ERR(199)      VIDMSG
084510000509     C                   SETON                                        4690
084520000509     C                   GOTO      ENDCCB
084530000509     C                   ENDIF
084540000911     C                   ENDIF
084550940824     C*
084560991026     C     FLGTB1        COMP      'A'                                    04
084570941103     C*
084580940929     C* 08 ON - TASSATO DESTINO
084590940826     C     §3AFTD        IFEQ      1
084600940826     C                   SETON                                        08
084610940920     C                   ENDIF
084620940920     C* 05 ON - 2 BOLLA E NON E' TASSATO DESTINO
084630940920     C  N08§3ATB2        IFNE      *BLANKS
084640940920     C                   SETON                                        05
084650940920     C                   ENDIF
084660991026      *
084670991026      * SE SONO NELLA PROCEDURA PREPAGATI DEVO SELEZIONARE UN PORTO FRANCO
084680991026     C     *IN04         IFEQ      *ON
084690991026     C     PARTCH        ANDEQ     'P'
084700010307     C     *IN04         OREQ      *ON
084710010307     C     §LPFPR        ANDEQ     'O'
084720991026     C                   MOVEL     ERR(173)      VIDMSG
084730991026     C                   SETON                                        4690
084740991026     C                   GOTO      ENDCCB
084750991026     C                   ENDIF
084760020611     c* X prepagati non posso bollettare come C/servizio
084770020611     c     *in22         ifeq      *on
084780020611     c     §3arbl        andeq     'C'
084790020611     c                   movel     err(256)      vidmsg
084800020611     C                   SETON                                        4690
084810020611     C                   GOTO      ENDCCB
084820020611     c                   endif
084830030805      * se ORM con serie il codice bolla non può essere diverso da quello
084840030805      * indicato in tabella 'OSR'
084850030805If  1c                   If        wonsr > *Zeros and flgfit <> 'S' and
084860030808     c                             wCbo <> d§OsrCbo and d§OsrCbo <> *Blanks
084870030805     c                   Eval      VidMsg = Err(148)
084880030805     c                   Eval      %subst(VidMsg:25:2) = d§OsrCbo
084890030805     c                   Eval      *In46 = *On
084900030805     c                   Eval      *In90 = *On
084910030805     c                   GoTo      EndCcb
084920030805    1c                   EndIf
084930040122
084940040122      * Il codice bolla '2R' è ammesso solo se ho inserito un ORM con la serie
084950040203     c                   If        wcbo = '2R' and
084960040203     c                             (flgfit = 'S' or wonsr = *Zeros)
084970040122     c                   Eval      VidMsg = Err(10)
084980040122     c                   Eval      *In46 = *On
084990040122     c                   Eval      *In90 = *On
085000040122     c                   GoTo      EndCcb
085010040122     c                   EndIf
085020991026     C*
085030940824    0C                   ENDIF
085040940824     C*
085050940824     C* SE BOLLA DI RECUPERO NO DATA SPEDIZIONE < DATA GIORNO -3
085060940824     C* ALTRIMENTI NO < DATA GIORNO
085070940824    0C     §3ARBL        IFEQ      'R'
085080940824     C*
085090000113    1C     *IN12         IFEQ      *OFF
085100000113     C     *IN15         OREQ      *ON
085110000113     C     BLPDSP        ORNE      WBDSP
085120000113    2C     BLPDSP        IFLT      DATAM
085130940824     C                   MOVEL     ERR(4)        VIDMSG
085140940929     C                   SETON                                        4190
085150000113    2C                   ENDIF
085160000113    1C                   ENDIF
085170940824     C*
085180940824   X0C                   ELSE
085190940824     C*
085200000104     C* IMMISSIONE O CONFERMA
085210000104    1C     *IN12         IFEQ      *OFF
085220000104     C     *IN15         OREQ      *ON
085230000104     C     BLPDSP        ORNE      WBDSP
085240061221     c
085250000104     C* MANUTENZIONE : SOLO SE LA DATA SPEDIZIONE E' STATA CAMBIATA
085260061221    2C***  BLPDSP        IFLT      DATEU
085270061221    2C     BLPDSP        IFLT      datameno1
085280940824     C                   MOVEL     ERR(5)        VIDMSG
085290061221     c                   eval      %subst(vidmsg:65:10) =
085300061221     c                             %editw(datgmeno1: '  /  /    ')
085310940929     C                   SETON                                        4190
085320000104    2C                   ENDIF
085330000104    1C                   ENDIF
085340940824    0C                   ENDIF
085350000104     C   90              GOTO      ENDCCB
085360960319     C* IN MANUTENZIONE NON POSSO MODIFICARE IL TIPO BOLLA SE BOLLA
085370960319     C*  FIGLIA
085380960319     C   12
085390960319     CANN15BLPCBO        IFNE      WCBO
085400960319     C     KBLP3         SETLL     FNLBL01L                               90
085410960319     C     *IN90         IFEQ      *ON
085420960319     C                   MOVEL     ERR(124)      VIDMSG
085430960319     C                   SETON                                        46
085440960319     C                   GOTO      ENDCCB
085450120926     c*
085460120926     c                   else
085470120926     c                   if        savrbl='R' and savtb1='F' and
085480120926     c                             §3arbl<>'R'
085490120926     C                   MOVEL     ERR(347)      VIDMSG
085500120926     C                   SETON                                        4690
085510120926     C                   GOTO      ENDCCB
085520120926     c                   endif
085530960319     C                   ENDIF
085540960319     C                   ENDIF
085550961122     C*
085560990518     C* SE MODIFICATO TIPO BOLLA, PULISCO CAMPO DIC/VEN
085570961122     C     WCBO          IFNE      SAVCBO
085580040213     C**!!!              CLEAR                   DIC
085590040213     C**!!!              CLEAR                   VEN
085600961122     C                   MOVEL     WCBO          SAVCBO
085610961122     C                   ENDIF
085620070427     c* In manutenzione
085630070427     c* se modificato porto da franco ad assegnato pulisco campo per
085640070427     c* controlli proposte mittente originale
085650070427     c                   if        *in12='1' and *in15='0' and
085660070427     C                             flgtb1<>savtb1 and flgtb1='A'
085670070427     c                   clear                   wovuo1
085680070427     c                   endif
085690940824     C* personalizzazione
085700940824     C     WPERSO        IFEQ      'P'
085710940824     C                   SETON                                        21
085720940824     C                   ENDIF
085730940824     C*
085740940928     C     ENDCCB        TAG
085750940824     C   90              MOVEL     '1'           WEMFOR
085760940824     C                   ENDSR
085770050214     C* CONTROLLO codice bolla --------------------------------------*
085780050214     C     CTRCBO_orm    BEGSR
085790060918    1C     *IN12         IFEQ      *OFF
085800091019    1C     *IN15         oreq      *On
085810091019     c     flgfit        andne     'S'
085820091019     c     §orpfb        andeq     'A'
085830060918     C* In manutenzione controllo solo se variato il numero ORM
085840060918     C     *IN15         OREQ      *OFF
085850060918     C     WORMMD        ANDEQ     '1'
085860081023     c* se bolla export dpd controllo anche se variato il codice bolla
085870081023     c     *in15         oreq      *off
085880081023     c     A_§ogntw      andeq     'DPD'
085890081023     c     vidcbo        andne     cbo_blp
085900050214      * Controllo il tipo bolla con quanto memorizzato sull'ORM
085910050214     c                   If        §OrPfb <> *Blanks and Flgtb1 <> §OrPfb
085920050214     c                             and flgfit <> 'S'
085930050214     c                   If        §OrPfb = 'F'
085940061124     c                             and wfortbo = *Blanks
085950061124     c                   Eval      VidMsg = Err(30)
085960050214     c                   Eval      %subst(VidMsg:34:9) = 'Franco   '
085970050214     c                   Eval      %subst(VidMsg:45:15) = 'ENTER X FORZARE'
085980061124     c                   Eval      *In46 = *On
085990061124     c                   Eval      *In90 = *On
086000050214     c                   Eval      WforTbo = '1'
086010050214     c                   EndIf
086020050214     c                   If        §OrPfb = 'A'
086030061124     c                   Eval      VidMsg = Err(30)
086040050214     c                   Eval      %subst(VidMsg:34:9) = 'Assegnato'
086050061124     c                   Eval      *In46 = *On
086060061124     c                   Eval      *In90 = *On
086070050214     c                   EndIf
086080050214     c                   EndIf
086090060918     c                   endif
086100050214     c                   endsr
086110081107     C* CONTROLLO codice bolla con cod. trattamento merce -----------*
086120081107     C     CTRCBO_ctm    BEGSR
086130081107     c* se cd. trattamento merce di recupero non posso usarlo con cod.
086140081107     c* bolla non di recupero a meno che non sia un codice bolla abili-
086150081107     c* tato
086160081107     c                   if        §1bfg8='N' and §3arbl<>'R'
086170081107     c                              and §3aurc=' '
086180081107     C                   MOVEL     ERR(318)      VIDMSG
086190081107     C                   SETON                                        4690
086200081107     c                   endif
086210081107     c                   endsr
086220940824     C*
086230940824     C* CONTROLLO LINEA DI ARRIVO -----------------------------------*
086240110217     C     CTRLNA_vid    BEGSR
086250110217     c
086260940824     C* NON E' STATA PERSONALIZZATA
086270940824    0C     *IN20         IFEQ      *OFF
086280940824     C*
086290940928     C                   CLEAR                   V1DLNA
086300940824     C* SOLO SE INSERITA, ALTRIMENTI LA CALCOLO IN AUTOMATICO
086310940824    1C     WLNA          IFNE      *BLANKS
086320940824     C     WLNA          ANDNE     *ZEROS
086330940824     C*
086340940824     C     '?'           SCAN      WLNA                                   30
086350940824     C*
086360940824    2C     *IN30         IFEQ      *ON
086370940824     C                   MOVE      *BLANKS       §COD1
086380940824     C                   MOVE      *BLANKS       WLNA
086390941230     C                   CALL      'TNSD19R'
086400940824     C                   PARM                    §COD1             3
086410940824     C                   PARM                    §TIP              1
086420940928     C                   PARM                    §DES
086430940824     C                   MOVEL     §COD1         WLNA
086440940928     C                   MOVEL     §DES          V1DLNA
086450940824     C                   MOVEL     '1'           WEMFOR
086460941011     C                   SETON                                        47
086470940824     C                   GOTO      ENDCLA
086480940824    2C                   ENDIF
086490110217     c
086500110217     c                   exsr      Ctrlna_Base
086510110217     c
086520110217     c* Se errore accendo indicatore di posizionamento cursore
086530110217     c                   if        *in90
086540110217     c                   seton                                        47
086550110217     C                   GOTO      ENDCLA
086560110217     c                   endif
086570940824     C*
086580991202     C* SE CAMBIATA
086590940824    2C     CO2LNA        IFNE      COMLNA
086600940824     C                   MOVEL     0             QUA
086610100209     C                   MOVEL     0             QUAH
086620040213     C**!!!              MOVEL     0             DIC
086630040213     C**!!!              MOVEL     0             VEN
086640940920     C                   MOVEL     COMLNA        CO2LNA
086650940824    2C                   END
086660940824     C* DESCRIZIONE
086670940824     C                   MOVEL     ORGDES        V1DLNA
086680940824     C* PERSONALIZZAZIONE
086690940824    2C     WPERSO        IFEQ      'P'
086700940824     C                   SETON                                        20
086710940824    2C                   ENDIF
086720940824     C*
086730940824   X1C                   ELSE
086740940824     C* LINEA NON IMMESSA
086750940824     C                   MOVEL     *BLANKS       V1DLNA
086760940824     C                   Z-ADD     0             COMLNA
086770020213     C                   CLEAR                   A_OG143
086780040525     C                   CLEAR                   A_OG150
086790940824     C* RICONTROLLO SEMPRE IL CAP
086800940824     C                   MOVEL     0             QUA
086810100209     C                   MOVEL     0             QUAH
086820940824    1C                   END
086830010220     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
086840010220     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
086850010220     C     WPERSO        IFEQ      'P'
086860010220     C     WORM          ANDEQ     'S'
086870010220     C     PARTCH        ANDNE     'P'
086880010220     C     FLGFIT        ANDNE     'S'
086890010220     C     WLNA          ANDGT     *ZEROS
086900010220     C                   MOVE      WLNA          W0030             3 0
086910010220     C     W0030         IFNE      ORMPOC
086920010220     C     ORMPOC        ANDGT     *ZEROS
086930010220     C                   SETON                                        9047
086940010220     C                   MOVEL     ERR(225)      VIDMSG
086950010220     C                   GOTO      ENDCLA
086960010220     C                   ENDIF
086970010220     C                   ENDIF
086980940928    0C                   END
086990940824     C*
087000940824     C     ENDCLA        TAG
087010940824     C   90              MOVEL     '1'           WEMFOR
087020940824     C                   ENDSR
087030110217     C*
087040110217     C* CONTROLLI di base 1° e 2° videata della linea di arrivo ------*
087050110217     c     CTRLNA_Base   BEGSR
087060110217     c
087070110217     C                   TESTN                   WLNA                 30
087080110217     C                   MOVE      WLNA          W001A             1
087090110217    2C     *IN30         IFEQ      *OFF
087100110217     C     W001A         ORLT      '0'
087110110217     C                   MOVEL     ERR(12)       VIDMSG
087120110217     C                   SETON                                        90
087130110217     C                   leavesr
087140110217    2C                   ENDIF
087150110217     c
087160110217     c* Se in immissione prepagati e lna Portogallo o Spagna errore
087170110217     c                   if        (partch='P' or §lpfpr='O') and
087180120608     c                             (wlna='340' or wlna='345' or wlna='341')
087190120608     c                             and (wccm=8888 or wccm=0)
087200110217     C                   SETON                                        90
087210110217     C                   MOVEA     ERR(311)      K78
087220110217     C                   MOVE      wlna          W003A             3
087230110217     C                   MOVEA     W003A         K78(17)
087240110217     C                   MOVEA     K78           VIDMSG
087250110217     C                   leavesr
087260110217     c                   endif
087270110217     C*
087280110217    2C     WLNA          IFGT      *ZEROS
087290110217     C                   MOVEL     WLNA          COMLNA
087300110217     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
087310110217     C                   ELSE
087320110217     C                   SETON                                        30
087330110217    2C                   END
087340110217     C*
087350110217     C* CONTROLLO SE ANNULLATO
087360110217     C* CONSIDERO SOLO I TIPI "F" E "A"
087370110217    2C  N30ORGFVA        IFNE      *BLANKS
087380110217    2C     ORGFAG        ORNE      'F'
087390110217     C     ORGFAG        ANDNE     'A'
087400110217     C                   SETON                                        30
087410110217    2C                   END
087420110217     C* CONTROLLO CHE NON SIA UNA LINEA BLOCCATA
087430110217     C                   MOVEL     ORGDE8        OG148
087440110217     C     §OGLBL        IFEQ      'N'
087450110217     C                   SETON                                        30
087460110217    2C                   END
087470110217     C*
087480110217    2C     *IN30         IFEQ      *ON
087490110217     C                   MOVEL     ERR(12)       VIDMSG
087500110217     C                   SETON                                        90
087510110217     C                   leavesr
087520110217    2C                   ENDIF
087530110217     c
087540110217     C* TERMINAL DI ARRIVO
087550110217     C                   CLEAR                   DSLV55
087560110217     C                   MOVEL     'A'           D55TPT
087570110217     C** PER POSTE DEVO PASARE LA LINEA E NON IL TERMINAL
087580110217     C                   MOVEL     VIDLNP        D55LNP
087590110217     C**
087600110217     C                   MOVEL     COMLNA        D55LIN
087610110217     C                   MOVEL     BLPDSP        D55DRF
087620110217     C                   CALL      'FNLV55R'
087630110217     C                   PARM                    DSLV55
087640110217     C     D55ERR        IFEQ      ' '
087650110217     C                   MOVEL     D55TFA        COMTFA
087660110217     C                   ELSE
087670110217     C                   SETON                                        90
087680110217     C                   MOVEL     ERR(212)      VIDMSG
087690110217     C                   leavesr
087700110217     C                   ENDIF
087710110217     C*
087720110217     C                   MOVEL     ORGDE3        A_OG143
087730110217     C                   MOVEL     ORGDF0        A_OG150
087740110217     c                   ENDSR
087750940824     C*
087760940824     C* CONTROLLO TIPO SERVIZIO --------------------------------------*
087770940824     C     CTRTSP        BEGSR
087780940824     C* SOLO SE NON PERSONALIZZATO
087790941107    0C     *IN18         IFEQ      *OFF
087800941107     C                   SETOFF                                       09
087810940824     C                   CLEAR                   V1DTSP
087820940824     C*
087830080327     c                   clear                   NOutiTSP          1
087840940824    1C     WTSP          IFNE      *BLANKS
087850940922     C                   MOVEL     '5E'          COD
087860940922     C* RICERCA
087870940824    2C     WTSP          IFEQ      '?'
087880940922     C                   EXSR      CX§TAB
087890940824     C                   MOVEL     §KEY          WTSP
087900090604     C**!!!              MOVEL     §DES          V1DTSP
087910090604     C                   Z-ADD     1             C
087920090604     C     WTSP          LOOKUP    TSP(C)                                 30
087930090604    2C                   IF        *in30
087940090604     C                   MOVEL     DTS08(C)      V1DTSP
087950090604     c                   else
087960090604     c                   clear                   v1dtsp
087970090604     c                   endif
087980941011     C                   SETON                                        48
087990940824     C                   GOTO      ENDCSP
088000940824    2C                   END
088010940922     C* CONTROLLO
088020941107     C                   Z-ADD     1             C
088030941107     C     WTSP          LOOKUP    TSP(C)                                 30
088040940922     C* ERRORE
088050941107    2C     *IN30         IFEQ      *OFF
088060940824     C                   MOVEL     ERR(15)       VIDMSG
088070940929     C                   SETON                                        4890
088080940824     C                   MOVEL     '1'           WEMFOR
088090940824     C                   GOTO      ENDCSP
088100940824    2C                   ENDIF
088110940824     C*
088120090604     C**!!!              MOVEL     DTS(C)        V1DTSP
088130090604     C**!!!              MOVEL     DTS(C)        V2DTSP
088140090604     C                   MOVEL     DTS08(C)      V1DTSP
088150090604     C                   MOVEL     DTS08(C)      V2DTSP
088160941102     C*
088170941102     C* DEVE ESSERE UTILIZZABILE IN BOLLETTAZIONE
088180080327     c                   clear                   NOutiTSP          1
088190941107    2C     UTS(C)        IFNE      'S'
088200080327     C* IN IMMISSIONE  SEMPRE ERRORE
088210941108   3 C     *IN12         IFEQ      *OFF
088220080327     c* per  disk clienti se non utilizzabile do errore solo se
088230080327     c*    diverso da tariffa e  quindi posticipo il controllo
088240080326     C**** *IN12         OREQ      *OFF
088250080327     C**** *IN15         ANDEQ     *ON
088260941107     C* IN MANUTENZ SOLO SE E' CAMBIATO
088270941107     C     *IN12         OREQ      *ON
088280941107     C     *IN15         ANDEQ     *OFF
088290941107     C     WTSP          ANDNE     BLPTSP
088300941107     C*
088310941102     C                   MOVEL     ERR(15)       VIDMSG
088320941102     C                   SETON                                        4890
088330941102     C                   MOVEL     '1'           WEMFOR
088340941102     C                   GOTO      ENDCSP
088350941108    3C                   ENDIF
088360080327     c
088370080327     c                   if        *in12 and *in15
088380080327     c                   eval      NOutiTSP='N'
088390080327     c                   endif
088400080327     c
088410941108    2C                   ENDIF
088420080327     c
088430120302     C* VEDO SE VALIDO PER POSTE, BRT/SDI
088440000509     C     USO(C)        IFEQ      'P'
088450020319     C     §ogntw        ANDNE     'PPT'
088460000509     C                   MOVEL     ERR(194)      VIDMSG
088470000509     C                   SETON                                        4890
088480000509     C                   MOVEL     '1'           WEMFOR
088490000509     C                   GOTO      ENDCSP
088500000509    3C                   ENDIF
088510000509     C     USO(C)        IFEQ      'E'
088520020319     C     §ogntw        ANDEQ     'PPT'
088530000509     C                   MOVEL     ERR(194)      VIDMSG
088540000509     C                   SETON                                        4890
088550000509     C                   MOVEL     '1'           WEMFOR
088560000509     C                   GOTO      ENDCSP
088570000509    3C                   ENDIF
088580100209     c
088590100209     c* Se modifico pulisco i flag di controllo linea di arrivo
088600100209     c                   if        wtsp<>sa2tsp
088610100209     c                   clear                   qua
088620100209     c                   clear                   quaH
088630100209     c                   eval      sa2tsp=wtsp
088640100209     c                   endif
088650100319     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
088660100319     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
088670100319     C     WPERSO        IFEQ      'P'
088680100319     C     WORM          ANDEQ     'S'
088690100319     C     PARTCH        ANDNE     'P'
088700100319     C     FLGFIT        ANDNE     'S'
088710100319     C     WesORE        ANDeq     'S'
088720100319     C     Wtsp          ANDne     ' '
088730100319     C     wtsp          andne     §oretsp
088740100319     C                   SETON                                        9048
088750100319     C                   MOVEL     ERR(76)       VIDMSG
088760100319     C                   GOTO      ENDCSP
088770100319     C                   ENDIF
088780000509     C*
088790940824     C* PERSONALIZZAZIONE
088800940824    2C     WPERSO        IFEQ      'P'
088810940922     C                   SETON                                        18
088820940824    2C                   ENDIF
088830940824     C*
088840941107   X1C                   ELSE
088850941107     C                   SETON                                        09
088860940824    1C                   ENDIF
088870941107    0C                   ENDIF
088880940824     C*
088890940824     C     ENDCSP        ENDSR
088900940824     C*
088910940824     C* CONTROLLO CODICE TRATTAMENTO MERCE --------------------------*
088920940824     C     CTRCTM        BEGSR
088930950504     C* NON E' CAMBIATO IL CTM
088940950504     C     WCTM          IFNE      SAVCTM
088950940824     C                   CLEAR                   V1DCTM
088960940824     C* RICERCA
088970940922     C                   MOVE      '1B'          COD
088980940824     C     '?'           SCAN      WCTM                                   30
088990940922     C* RICERCA
089000940824    1C     *IN30         IFEQ      *ON
089010940922     C                   EXSR      CX§TAB
089020940824     C                   MOVEL     §KEY          WCTM
089030941011     C                   SETON                                        49
089040940824     C                   GOTO      ENDCTM
089050940824    1C                   END
089060940922     C* COTROLLO
089070940920     C                   MOVEL(P)  WCTM          KEY
089080940824     C                   EXSR      CTABEL
089090940922     C* ERRORE
089100940824    1C     *IN30         IFEQ      *ON
089110940824     C                   MOVEL     ERR(16)       VIDMSG
089120940920     C                   SETON                                        4990
089130940824     C                   GOTO      ENDCTM
089140940824    1C                   ENDIF
089150940824     C*
089160940824     C                   MOVEL     TBLUNI        DS1B
089170940824     C*
089180940824     C* FLAG2 >< "S" (NUM SPEDIZIONE DAL CLIENTE) IN IMMISSIONE
089190940824    1C  N12§1BFG2        IFEQ      'S'
089200100208     C                   MOVEL     ERR(16)       VIDMSG
089210940920     C                   SETON                                        4990
089220940824     C                   GOTO      ENDCTM
089230940824    1C                   END
089240940824     C*
089250940824     C* IN RECUPERO SOLO CTM DA MAGAZZINO
089260990602    1C  N12PARTCH        IFEQ      'R'
089270940824     C     §1BFG6        ANDNE     'M'
089280940824     C                   MOVEL     ERR(16)       VIDMSG
089290940920     C                   SETON                                        4990
089300940824     C                   GOTO      ENDCTM
089310940824    1C                   END
089320940824     C* IM IMMISSIONE NON POSSO USARE CTM CON FLG7=S
089330940824    1C  N12§1BFG7        IFEQ      'S'
089340940824     C                   MOVEL     ERR(16)       VIDMSG
089350940920     C                   SETON                                        4990
089360940824     C                   GOTO      ENDCTM
089370940824    1C                   END
089380000911     C*
089390000919     C* POSSO USARE CTM DISK C SOLO SE TERMINAL ABILITATO
089400001106     C* NON FACCIO QUESTO CONTROLLO SE FLAG 12 = 'E'. IN QUESTO CASO
089410001106     C* INFATTI DEVE ESSERE POSSIBILE BOLLETTARE SEMPRE E SE TERMINAL
089420001106     C* NON AIBLITATO NON LO CONSIDERERO' UN DISK C
089430000904     C     §1BF12        IFNE      'N'
089440001106     C     §1BF12        ANDNE     'E'
089450000904     C     WASDKC        ANDNE     'S'
089460000904     C                   MOVEL     ERR(206)      VIDMSG
089470000904     C                   SETON                                        4990
089480000904     C                   GOTO      ENDCTM
089490000904     C                   ENDIF
089500000911     C*
089510000919     C                   MOVEL     '3C'          COD
089520000919     C                   MOVEL(P)  WKSC          KEY
089530000919     C                   CLEAR                   DS3C
089540000919     C                   EXSR      CTABEL
089550000919     C  N30              MOVEL     TBLUNI        DS3C
089560000911     C*
089570940824     C* CONTROLLO SE PREVEDE L'ASSEGNAZIONE DEI SEGNACOLLI IN AUTOMATIC
089580980424     C                   SETOFF                                       25
089590940824    1C     §1BFG6        IFEQ      'D'
089600940824     C     §1BFG6        OREQ      'I'
089610940824     C     §1BFG6        OREQ      'N'
089620940824     C                   SETON                                        25
089630940824    1C                   END
089640950504     C* SALVO IL CTM
089650950504     C                   MOVEL     WCTM          SAVCTM
089660940824     C*
089670940824     C     ENDCTM        TAG
089680940824     C   90              MOVEL     '1'           WEMFOR
089690950504     C   90              CLEAR                   SAVCTM
089700940824    0C                   ENDIF
089710940824     C                   ENDSR
089720940824     C*
089730940824     C* CONTROLLO CODICE CLIENTE -------------------------------------*
089740940824     C     CTRCCM        BEGSR
089750000201     C*
089760940825    0C     *IN19         IFEQ      *OFF
089770990610     C     WCOCCM        OREQ      'S'
089780950303     C                   SETOFF                                       02
089790020319     c                   clear                   clintw
089800940922     C                   CLEAR                   MITVLT
089810940920     C* 19 ON - MITTENTE PERSONALIZZATO
089820950209     C     WFLC          IFEQ      WLNP
089830950209     C                   SETOFF                                       14
089840020319     C                   MOVEL     §ogntw        CLIntw
089850950209     C                   ELSE
089860950209     C                   SETON                                        14
089870000201     C**
089880020306     c     wccm          ifeq      8888
089890020507     c     wccm          oreq      9999
089900020306     C                   SETON                                        9050
089910020306     C                   MOVEL     ERR(81)       VIDMSG
089920020306     C                   GOTO      ENDCCM
089930020306     c                   endif
089940051207     C* Imposto campo del codice
089950051207     C                   MOVEL     WFLC          WKSC
089960051207     C                   MOVE      WCCM          WKSC
089970051207     C*
089980000201     C* CONTROLLO SE CLIENTE DPD
089990000201     C     WFLC          CHAIN     AZORG01L      UNIORG               30
090000000201     C                   MOVEL     OG143         SAV143
090010000201     C                   MOVEL     ORGDE3        OG143
090020020319     C     §OGNTW        IFEQ      'DPD'
090030010103     C     SAVFPR        IFNE      'P'
090040010103     C     SAVFPR        ANDNE     'G'
090050010319     C     WSIDPD        ANDEQ     'S'
090060051207     c* Possibile linea diversa solo se prevista da tabella 3TR
090070150929     c****               clear                   tntb50ds
090080150929     C****               movel     wksc          b50ke2
090090051207     C*
090100150929     c****               movel     b50ke2        b50ke1
090110150929     c****               movel     'C'           b50opz
090120150929     c****               movel     wlnp          b50poa
090130150929     c****               call      'TNTB51R'
090140150929     c****               parm                    kpjba
090150150929     c****               parm                    tntb50ds
090160051207     c
090170150929     c***                if        b50err<>' '
090180150730     c* filiale cliente diversa da lnp va bene per dpd purchè entrambi
090190150730     c* i network siano dpd
090200150929     c***                if        §ogntw<>'DPD'  or *in79=*off
090210150929     c                   if        *in79=*off
090220001212     C                   SETON                                        9045
090230001212     C                   MOVEL     ERR(215)      VIDMSG
090240001212     C                   GOTO      ENDCCM
090250150730     c                   endif
090260150929     C****               ENDIF
090270051207     c
090280051207     C                   ENDIF
090290000201     C                   ENDIF
090300020319     C                   MOVEL     §OGntw        CLINTW
090310040930     c* errore se network cliente è logistica o sede
090320040930     c     clintw        ifeq      'LOG'
090330040930     c     clintw        oreq      'XXX'
090340040930     C                   SETON                                        9051
090350040930     C                   MOVEL     ERR(284)      VIDMSG
090360040930     C                   GOTO      ENDCCM
090370040930     c                   endif
090380000201     C                   MOVEL     SAV143        OG143
090390950209     C                   ENDIF
090400051207     C* Imposto campo del codice
090410051207     C                   MOVEL     WFLC          WKSC
090420051207     C                   MOVE      WCCM          WKSC
090430940928     C                   Z-ADD     KCI           CCC
090440940824     C     KACO          CHAIN     CNACO000                           30
090450940824     C* ANNULLATO
090460940921    2C  N30ACOFLG        IFEQ      '*'
090470940824     C                   SETON                                        30
090480940921    2C                   END
090490940824     C*
090500940921    2C     *IN30         IFEQ      *ON
090510940824     C                   MOVEL     ERR(22)       VIDMSG
090520940922     C                   SETON                                        9050
090530940824     C                   GOTO      ENDCCM
090540940921    2C                   ENDIF
090550940824     C* FLAG=8 NON SPEDISCE - NO BOLLE
090560130312    2C***  ACOABL        IFEQ      '8'
090570130312    2C***  ACOABL        OREQ      '*'
090580130312    2C     ACOABL        IFne      *blanks
090590940824     C                   MOVEL     ERR(23)       VIDMSG
090600940922     C                   SETON                                        9050
090610940824     C                   GOTO      ENDCCM
090620940921    2C                   END
090630941011     C*
090640941011     C                   MOVEL     ACORAG        VIDDMT
090650940824     C*
090660940921    2C     WCCM          IFNE      8888
090670940909     C     WCCM          ANDNE     9999
090680940824     C     KACO          CHAIN     CNIND000                           30
090690940921    3C     *IN30         IFEQ      *ON
090700940824     C                   MOVEL     ERR(22)       VIDMSG
090710940922     C                   SETON                                        9050
090720940921    3C                   ENDIF
090730000509     C* PER BOLLA LNP POSTE, AMMESSI SOLO CLIENTI POSTE E VICEVERSA
090740020319     c     §ogntw        ifeq      'PPT'
090750020319     c     clintw        oreq      'PPT'
090760020319     C     §ogntw        IFNE      clintw
090770000509     C                   MOVEL     ERR(200)      VIDMSG
090780000509     C                   SETON                                        9050
090790020319     c                   endif
090800000509    3C                   ENDIF
090810000509     C*
090820970703     C* CONTROLLO LA NAZIONE
090830970703     C* VISTO CHE E' UN CODIFICATO PRENDO LA DIVISA CHE MI PUO' SERVIRE
090840970703     C*  PER L'IMPORTO DA ASSICURARE O VALORE MERCE DICHIARATO
090850970703     C                   MOVEL     '15'          COD
090860970703     C                   MOVEL(P)  INDSTA        KEY
090870970703     C                   EXSR      CTABEL
090880970703     C* NAZIONE ERRATA
090890970703    3C     *IN30         IFEQ      *ON
090900970703     C                   MOVEL     ERR(28)       VIDMSG
090910970703     C                   SETON                                        9050
090920970703   X3C                   ELSE
090930970703     C                   MOVEL     TBLUNI        DS15
090940970703     C                   MOVEL     §15VLT        MITVLT
090950970703    4C     §15ITA        IFNE      'I'
090960970703     C                   MOVEL     'E'           WMITIE            1
090970970703     C                   ELSE
090980970703     C                   MOVEL     'I'           WMITIE
090990970703    4C                   ENDIF
091000970703    3C                   ENDIF
091010970704     C*
091020970704     C* controllo se esiste in anagrafica la provincia
091030970704     C* SOLO SE NAZIONE ITALIA CIOE' ='   '
091040970704     C     INDSTA        IFEQ      *BLANKS
091050970704    3C     INDPRV        ANDEQ     *BLANKS
091060970704     C                   MOVEL     ERR(128)      VIDMSG
091070970704     C                   SETON                                        9050
091080970704     C                   GOTO      ENDCCM
091090100120    3C                   ENDIF
091100970703     C*
091110970703     C* CAP OBBLIGATORIO : CONTROLLO
091120970703     C                   CLEAR                   DSSI95
091130970708     C                   CLEAR                   DSLV13
091140970703     C                   MOVEL     '3'           I95TCN
091150970703     C                   MOVEL     INDCAE        I95CAP
091160970703     C                   MOVEL     INDSTA        I95NAR
091170970703     C                   MOVEL     INDPRV        I95PRV
091180970703     C                   MOVEL     INDCIT        I95LOC
091190970714     C                   MOVEL     BLPDSP        I95DAT
091200971201     C     §3AFCA        IFNE      0
091210971201     C                   MOVEL     'S'           I95FCA
091220971201     C                   ENDIF
091230971201     C                   MOVEL     FLGTB1        I95TPO
091240970708     C* ERRORE AFFIDABILITA = 0
091250970708     C                   MOVEL     'S'           I13AF0
091260970708     C* CONTROLLO CONGRUENZA CAP PROVINCIA
091270970708     C                   MOVEL     'S'           I13CNG
091280970708     C* CONTROLLO NON FORZABILE CITTA' CON VIARIO
091290100120     C*******            MOVEL     'S'           I13CNV
091300020212     c*
091310020212     c* mittente fedex passo flag apposito per dire di prendere i dati i
091320020212     c* dalla tabella della nazione
091330020212     c     §ogntw        ifeq      'FED'
091340020212     c                   movel     'S'           i95fi1
091350020212     c                   endif
091360970703     C                   CALL      'FNLV13R'
091370970708     C                   PARM                    KPJBA
091380970708     C                   PARM                    DSLV13
091390970708     C                   PARM                    DSSI95
091400941230     C* ERRORE
091410970708     C     O13ERR        IFNE      *BLANKS
091420970708     C                   MOVEL     O13MSG        W077A            77
091430970703     C* IMPOSTO IL MESSAGGIO METTENDO VICIVO LA SCRITTA:
091440970703     C*   "SUL PIANO DEI CONTI"
091450970703     C                   CLEAR                   K78
091460970703     C                   MOVEA     W077A         K78
091470970703     C     ' '           CHECKR    W077A         WP                2 0
091480970703     C                   ADD       2             WP
091490970703     C     WP            IFLT      61
091500970703     C                   MOVEA     CPDC          K78(WP)
091510970703     C                   MOVEA     K78           VIDMSG
091520970703     C                   ELSE
091530970703     C                   MOVEL     O95MSG        VIDMSG
091540970703     C                   MOVE      CPDC          VIDMSG
091550970703     C                   ENDIF
091560940922     C                   SETON                                        9050
091570941231     C                   GOTO      ENDCCM
091580941231    3C                   ENDIF
091590941230     C* SALVO IL FLAG ANTEPORTO
091600970703     C                   MOVEL     O95ISO        COMFAP
091610970708     C                   MOVEL     O95ISO        VIDFAP
091620970708     C                   MOVEL     O95CTS        MITCTS
091630140403     C                   MOVEL     O95gf2        comgf2
091640940922     C*
091650940921    2C                   ENDIF
091660940824     C*
091670940824     C   90              GOTO      ENDCCM
091680940824     C*
091690940921     C* PER MANUTENZIONE O DISK CLI OBBLIGATORIO IL COD.CLI ORIGINALE
091700960805     C* OPPURE UN CODICE CLIENTE CON LA STESSA SERIE
091710980410    1C   12§1BFG6        IFEQ      'C'
091720940824     C     §1BFG7        OREQ      'S'
091730940909    2C     WKSC          IFNE      SAVMIT
091740100517     c
091750960805     C*
091760100517     C**                 MOVEL     '3C'          COD
091770100517     C**                 MOVEL(P)  WKSC          KEY
091780960805     C*
091790100517     C**                 EXSR      CTABEL
091800100517     C**N30              MOVEL     TBLUNI        DS3C
091810960805     C*
091820100517    3C**   *IN30         IFEQ      *ON
091830100517     C**   §3CNRS        ORNE      VIDNRS
091840980805     C* E' VALIDA LA 3C SOLO SE HA L'ASTERISCO
091850100517     C**   §3COKD        ORNE      '*'
091860100517     C**                 MOVEL     ERR(67)       VIDMSG
091870100517     C**                 SETON                                        5090
091880100517    3C**                 ENDIF
091890100517     c
091900100517     c                   clear                   trulnrsds
091910100517     c                   movel     wksc          inrsCCM
091920100517     c                   movel     vidnrs        inrsNRS
091930100517     c                   movel     wfls          inrsFLS
091940100517     c
091950100517     c                   call      'TRULNRSR'
091960100517     c                   parm                    trulnrsds
091970100517     c                   if        onrserr<>' '
091980100517     C                   MOVEL     ERR(67)       VIDMSG
091990100517     C                   SETON                                        5090
092000100517    3C                   endif
092010100517     c
092020960805    2C                   END
092030940825    1C                   END
092040940825     C*
092050940825     C   90              GOTO      ENDCCM
092060940825    0C                   ENDIF
092070940824     C*
092080940824     C* CONTROLLI CODICE BOLLA CON CODICE CLIENTE
092090940825    0C     WCBO          IFNE      *BLANKS
092100941103    1C  N04WCCM          IFEQ      9999
092110940824     C                   MOVEL     ERR(11)       VIDMSG
092120940922     C                   SETON                                        5090
092130940825    1C                   END
092140940824     C* SE ASSEGNATO
092150940909    1C   04WCCM          IFEQ      8888
092160940824     C                   MOVEL     ERR(11)       VIDMSG
092170940922     C                   SETON                                        5090
092180940825    1C                   ENDIF
092190940824     C*
092200940824     C   90              GOTO      ENDCCM
092210940825    0C                   ENDIF
092220950125     C*
092230950125     C* SE E' FRANCO NON  SI PUO' TASSARE CON TARIFFA MITTENTE
092240990720    0C  N04WCBO          IFNE      *BLANKS
092250990720     C     WFTM          ANDEQ     'S'
092260950717     C                   MOVEL     ERR(119)      VIDMSG
092270950125     C                   SETON                                        5090
092280950125     C                   GOTO      ENDCCM
092290990720    0C                   ENDIF
092300940825     C*
092310020507     C* SE 8888 O 9999
092320940909    0C     WCCM          IFEQ      8888
092330940909     C     WCCM          OREQ      9999
092340940825     C*
092350950125     C* NON E' POSSIBILE IMMETTERE TASSAZIONE CON TAR MIT
092360940825    1C     WFTM          IFEQ      'S'
092370950717     C                   MOVEL     ERR(119)      VIDMSG
092380940922     C                   SETON                                        5090
092390940825     C                   GOTO      ENDCCM
092400940825    1C                   ENDIF
092410940921     C*
092420940921     C* SE PRIMA ERA CODIFICAT E ADESSO NO PULISCO I CAMPI DEL MITTENTE
092430990720    1C     WCCM          IFNE      WCCMS
092440950125     C                   CLEAR                   V2DTEL
092450940921     C*
092460940921     C* NON PULISCO SE CAMBIATO CODICE DA 8888 A 9999 O VICEVERSA
092470020507     C     WCCMS         ifNE      9999
092480940921     C     WCCMS         ANDNE     8888
092490010213     C*
092500940921     C                   CLEAR                   VIDRSM
092510940921     C                   CLEAR                   VIDLOM
092520940921     C                   CLEAR                   VIDINM
092530940921     C                   CLEAR                   VIDCAM
092540940921     C                   CLEAR                   VIDPRM
092550940921     C                   CLEAR                   VIDNZM
092560940921     C                   CLEAR                   VIDPIM
092570940921     C                   CLEAR                   VIDFAP
092580061110     C                   CLEAR                   VIDcdf
092590020507     c
092600990720    2C                   ENDIF
092610940921     C                   MOVEL     WCCM          WCCMS
092620990720    1C                   ENDIF
092630020507     c* se richiesta bolla firmata i dati del mittente sono quelli del
092640020507     c* p.o. mittente
092650020513     c     vidcbo        ifeq      'FO'
092660020507     c     wflc          chain     azorg01l      uniorg               30
092670020507     c                   movel     orgdes        vidrsm
092680020507     c                   movel     orgind        vidinm
092690020507     c                   movel     orgcpf        vidcam
092700020507     c                   movel     orgloc        vidlom
092710020507     c                   movel     orgpro        vidprm
092720020507     c                   endif
092730000113     C* SE E' IN PERSONALIZZAZIONE, RIPROTEGGO, E PROTETTO
092740000113     C   19              SETON                                        02
092750940825     C*
092760940825   X0C                   ELSE
092770110519     c* in immissione controllo se per il cliente mittente sono
092780110519     c* presenti bolle da confermare
092790110519     c* Se ce ne sono: messaggio forzabile
092800110519    3c                   if        not *in12
092810110519     c                   exsr      sr_chkvab
092820110519     c                   if        wemfor='1'
092830110519     c                   goto      endccm
092840110519     c                   endif
092850110519    3c                   endif
092860960926     C* SE TUTTO OK E NON E' 8888 O 9999 E CLIENTE DI ALTRO P.O.
092870940921     C* PROTEGGO IL MITTENTE E MEMORIZZO I CAMPI
092880940909     C*
092890940825     C                   SETON                                        02
092900990720    1C     WPERSO        IFEQ      'P'
092910950303     C                   SETON                                        19
092920990720    1C                   END
092930940909     C                   MOVEL     ACORAG        VIDRSM
092940940909     C                   MOVEL     INDCIT        VIDLOM
092950940909     C                   MOVEL     INDVIA        VIDINM
092960941005     C                   MOVEL     INDCAE        VIDCAM
092970940909     C                   MOVEL     INDPRV        VIDPRM
092980940909     C                   MOVEL     INDSTA        VIDNZM
092990940909     C                   MOVEL     INDIVA        WISO
093000990720    1C     WISO          IFGE      '00'
093010940909     C                   MOVEL     INDIVA        VIDCPM
093020120504     C                   clear                   VIDism
093030940909     C                   ELSE
093040940909     C                   MOVEL     INDIVA        VIDPIM
093050990720    1C                   END
093060120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
093070120508     c* in contabilità crea problemi
093080120508     c                   if        *in22 and wiso='$$'
093090120508     c                   clear                   vidpim
093100120508     c                   endif
093110061110     c   22              movel     indcdf        vidcdf
093120950123     C*
093130950123     C                   MOVE      INDTEL        V2DTEL
093140950123     C                   MOVEL     'Tel.'        V2DTEL
093150940825    0C                   ENDIF
093160940824     C* OK
093170940825    0C     WPERSO        IFEQ      'P'
093180950303     C                   SETON                                        85
093190940825    0C                   END
093200990720     C                   CLEAR                   WCOCCM
093210110921     c* accedo a tabella "CLI" del cliente mittente
093220080104     c                   clear                   dcli
093230110921     c****               if        *in12 and not *in15 and
093240110921     c*****                        vidnrs>0
093250071218     c                   exsr      sr_dcli
093260110922     c****               endif
093270061110     c
093280061110     c* se no prepagato solo sottolineato il campo del codice fiscale
093290061110     c  n22              movel     ul            atrcdf
093300940824     C*
093310940824     C     ENDCCM        TAG
093320940824     C   90              MOVEL     '1'           WEMFOR
093330940824     C                   ENDSR
093340941103     C*
093350941103     C* CONTROLLO IL MITTENTE ORIGINALE ------------------------------*
093360941103     C     CTRMO         BEGSR
093370941103     C*
093380941103    0C     *IN03         IFEQ      *OFF
093390941103     C*
093400941103     C* SE IMMESSO CAP O NAZIONE IMMETTERE TUTTI E 3
093410941103    1C     WCMO          IFNE      *BLANKS
093420950206     C     WRMO          ANDEQ     *BLANKS
093430941103     C                   MOVEL     ERR(100)      VIDMSG
093440941103     C                   SETON                                        7190
093450941103     C                   GOTO      ENDCMO
093460941103    1C                   ENDIF
093470941103     C*
093480941103    1C     WNAR          IFNE      *BLANKS
093490941103    2C     WCMO          IFEQ      *BLANKS
093500941103     C     WRMO          OREQ      *BLANKS
093510941103     C                   MOVEL     ERR(100)      VIDMSG
093520941103     C                   SETON                                        7190
093530941103     C                   GOTO      ENDCMO
093540941103    2C                   ENDIF
093550941103    1C                   ENDIF
093560941103     C*
093570941103     C* CONTROLLO NAZIONE MITTENTE ORIGINALE
093580941103    1C     WNAR          IFNE      *BLANKS
093590941103     C                   EXSR      CTRNAR
093600941103    2C     WEMFOR        IFEQ      '1'
093610941103     C                   SETOFF                                       68
093620941103     C                   SETON                                        73
093630941103     C                   GOTO      ENDCMO
093640941103    2C                   END
093650950215    1C                   END
093660941103     C*
093670941103     C* CONTROLLO ESISTENZA CAP MITTENTE ORIGINALE
093680950215    1C     WCMO          IFNE      *BLANKS
093690970708     C**
093700970708     C* CAP CON VIARIO --> ERRORE FORZABILE
093710970708    2C     WCMO          IFNE      VARCMO
093720970708     C                   CLEAR                   DUE
093730970708     C                   MOVEL     WCMO          VARCMO
093740970708    2C                   ENDIF
093750970708     C**
093760970704     C                   CLEAR                   DSSI95
093770970708     C                   CLEAR                   DSLV13
093780970704     C                   MOVEL     WNAR          I95NAR
093790970704     C                   MOVEL     WCMO          I95CAP
093800970704     C                   MOVEL     '3'           I95TCN
093810970708     C* NON POSSO DARE ERRORE PER AFFIDABILITA=0 PERCHE' NON HO LA
093820970708     C*  PROVINCIA
093830970708     C                   MOVEL     'S'           I13CNV
093840970708     C                   MOVEL     'S'           I13SZV
093850970708     C                   MOVEL     DUE           E13FZV
093860970704     C                   CALL      'FNLV13R'
093870970708     C                   PARM                    KPJBA
093880970708     C                   PARM                    DSLV13
093890970708     C                   PARM                    DSSI95
093900970708     C* FLAG FORZATURA
093910970708     C                   MOVEL     E13FZV        DUE
093920941103     C*
093930941103     C* SE CAP NON TROVATO  ERRORE
093940970708    2C     O13ERR        IFNE      *BLANKS
093950970708     C                   MOVEL     O13MSG        VIDMSG
093960941103     C                   SETON                                        7290
093970941103     C                   GOTO      ENDCMO
093980970704    2C                   ENDIF
093990941103     C*
094000941103    1C                   ENDIF
094010941103     C*
094020941103     C     WPERSO        IFEQ      'P'
094030941103     C                   SETON                                        03
094040941103     C                   ENDIF
094050941103     C*
094060941103     C     ENDCMO        TAG
094070941103     C   90              MOVEL     '1'           WEMFOR
094080941103    0C                   ENDIF
094090941103     C*
094100941103     C                   ENDSR
094110940913     C*
094120940913     C* CONTROLLO CONSEGNA RICHIESTA ---------------------------------*
094130940913     C     CTRCR         BEGSR
094140940913     C*
094150940913    1C     *IN16         IFEQ      *OFF
094160971007    2C     WDCR          IFEQ      0
094170940913     C                   Z-ADD     0             COMDCR
094180940913     C* DATA
094190971007   X2C                   ELSE
094200940913     C                   Z-ADD     WDCR          G02DAT
094210940913     C                   MOVEL     *BLANKS       G02ERR
094220940913     C                   CALL      'XSRDA8'
094230941115     C                   PARM                    WLBDAT
094240941115     C* ERRORE
094250940913    3C     G02ERR        IFEQ      '1'
094260940913     C                   MOVEL     ERR(19)       VIDMSG
094270941102     C                   SETON                                        5990
094280940913     C                   GOTO      ENDCR
094290940913    3C                   END
094300940913     C*  SE CAMBIATA LA DATA CONSEGNA RICHIESTA PULISCO LA FORZATURA
094310940913    3C     G02INV        IFNE      COMDCR
094320940913     C                   MOVEL     ' '           UNO
094330030417     c                   Clear                   fordcr
094340940913    3C                   ENDIF
094350940916     C*
094360940913     C                   MOVE      G02INV        COMDCR            8 0
094370940916     C                   MOVE      G02DAT        WDCR
094380940913     C*
094390940913     C* SE < ALLA DATA SPEDIZIONE: ERRORE
094400940913    3C     COMDCR        IFLT      BLPDSP
094410940916     C                   MOVEL     ERR(19)       VIDMSG
094420941102     C                   SETON                                        5990
094430940913     C                   GOTO      ENDCR
094440940913    3C                   ENDIF
094450101022     c* Verifico che non cada in giorno festivo per "IL"
094460101022     c* In personalizzazione lo posso fare solo col calendario partenza
094470101022     c                   if        WPERSO='P' and   wtcr=' '
094480101022     c                   movel     comdcr        wdata
094490101022     C                   CLEAR                   W0030
094500101022     C     KCLN          CHAIN     AZCLN01L                           30
094510101022     C   30              CLEAR                   CLNPOM
094520101022     C                   MOVEA     CLNPOM        K31
094530101022     C                   MOVEL     K31(WGG)      WFEST
094540101022     c     wfest         lookup    S1Y                                    30
094550101022     c
094560101022    4c                   if        *in30 and wfest<>' '
094570141124     c                   select
094580141124     c                   when      v0clna=*blanks or
094590141124     c                             (a_§ogntw<>'DPD' and a_§ogntw<>'EEX'
094600141124     c                              and a_§ogntw<>'FED')
094610101022     C                   MOVEL     ERR(197)      VIDMSG
094620101022     C                   SETON                                        5990
094630101022     C                   GOTO      ENDCR
094640141124     c                   when      v0clna<>wforz_lnap
094650141124     c                   eval      wforz_lnap=v0clna
094660141124     C                   MOVEL     ERR(197)      VIDMSG
094670141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
094680141124     C                   SETON                                        5990
094690141124     C                   GOTO      ENDCR
094700141124     c                   endsl
094710101022    4c                   endif
094720101022    3c                   endif
094730940913     C*
094740940913     C* 16 ON - PERSONALIZZAZIONE
094750940913    3C     WPERSO        IFEQ      'P'
094760940913     C                   SETON                                        16
094770940913    3C                   ENDIF
094780940913    2C                   ENDIF
094790940913    1C                   ENDIF
094800030409
094810051214      **Se sono in personalizzazione controllo che la data consegna
094820051214      **richiesta non sia superiore a oggi + i giorni previsti in §vpodcg
094830051214     c***                If        Wperso = 'P' and ComDcr > woggi5
094840051214     c***                Eval      *In59 = *On
094850051214     c***                Eval      *In90 = *On
094860051214     c***                Eval      VidMsg = Err(277)
094870051214     c***                Eval      VidMsg = %trim(vidmsg) + ' ' +
094880051214     c***                          %trim(%editc(§vpodcg:'Z'))  +
094890051214     c***                          ' giorni dalla data odierna'
094900051214     c***                GoTo      EndCr
094910051214     c***                EndIf
094920051214     c* controllo che la data consegna richiesta non sia superiore a oggi +
094930051214     c* i giorni previsti in tabella VPO
094940051214     c                   if        wtcr = 'P'
094950051214     c                   z-add     woggidcgm1    s_woggidcg
094960051214     c                   z-add     §vpodcgm1     s_vpodcg
094970051214     c                   else
094980051214     c                   z-add     woggidcgm2    s_woggidcg
094990051214     c                   z-add     §vpodcgm2     s_vpodcg
095000051214     c                   endif
095010051214     c*
095020051214     c                   if        comdcr > s_woggidcg
095030051214     c                   Eval      *In59 = *On
095040051214     c                   Eval      *In90 = *On
095050051214     c                   Eval      VidMsg = Err(277)
095060051214     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
095070051214     c                             %trim(%editc(s_vpodcg:'Z'))  +
095080051215     c                             ' giorni dalla data odierna.'
095090051214     c                   GoTo      EndCr
095100051214     c                   endif
095110030416
095120030416      * Controllo che la data consegna richiesta non sia superiore a oggi + 1 mm
095130051214     c*                  If        ComDcr > woggi1m
095140051214     c*                            and fordcr = *Blanks
095150051214     c*                  Eval      *In59 = *On
095160051214     c*                  Eval      *In90 = *On
095170051214     c*                  Eval      VidMsg = Err(1)
095180051214     c*                  Eval      fordcr = '1'
095190051214     c*                  GoTo      EndCr
095200051214     c*                  EndIf
095210030409
095220940913     C* ORA
095230940920    1C     *IN23         IFEQ      *OFF
095240940913     C*
095250150202    2C***  WHCR          IFLT      0
095260150202     C***  WHCR          ORGT      24
095270150203     c                   if        whcr>0  or wmcr>0
095280150202    2C     WHCR          IFLT      08
095290150202     C     WHCR          ORGT      20
095300940913     C                   MOVEL     ERR(20)       VIDMSG
095310960319     C                   SETON                                        6090
095320940913     C                   GOTO      ENDCR
095330940913    2C                   ENDIF
095340150202    2C                   ENDIF
095350940913     C*
095360940913    2C     WMCR          IFLT      0
095370940913     C     WMCR          ORGT      59
095380940913     C                   MOVEL     ERR(20)       VIDMSG
095390960319     C                   SETON                                        6090
095400940913     C                   GOTO      ENDCR
095410940913    2C                   ENDIF
095420150203     c*
095430150203     c                   if        whcr=20 and wmcr>0
095440150203     C                   MOVEL     ERR(20)       VIDMSG
095450150203     C                   SETON                                        6090
095460150203     C                   GOTO      ENDCR
095470150203     c                   endif
095480150203
095490940916     C* PERSONALIZZAZIONE
095500940913    2C     WPERSO        IFEQ      'P'
095510941102    3C     WHCR          IFNE      0
095520941102     C     WMCR          ORNE      0
095530940920     C                   SETON                                        23
095540940913    3C                   ENDIF
095550940913    2C                   ENDIF
095560940913     C*
095570941102     C* SE IMMESSO TIPO DEVO IMMETTERE ANCHE ORA O DATA
095580941005    2C     WTCR          IFNE      ' '
095590941102     C*
095600941102    3C     WDCR          IFEQ      0
095610941102     C     WHCR          ANDEQ     0
095620941102     C     WMCR          ANDEQ     0
095630941102     C                   MOVEL     ERR(43)       VIDMSG
095640941102     C                   SETON                                        5990
095650941102     C                   GOTO      ENDCR
095660941102    3C                   ENDIF
095670941102     C*
095680941102    3C     WPERSO        IFEQ      'P'
095690940913     C                   SETON                                        17
095700941102    3C                   ENDIF
095710941005    2C                   ENDIF
095720941005    1C                   ENDIF
095730940913     C*
095740940916     C     ENDCR         ENDSR
095750900427     C*
095760900427     C* CONTROLLO DATI FORMATO1 --------------------------------------
095770020531     C     CTRD01        BEGSR
095780961111     C                   SETOFF                                       953976
095790000915     C                   SETOFF                                       33
095800941003     C                   CLEAR                   WEMFOR
095810010412     C                   CLEAR                   WEFORM
095820941115     C                   CLEAR                   VIDMSG
095830070323     c                   if        *in12='0' or *in15='1'
095840070322     c                   clear                   wparcel
095850070323     c                   endif
095860950127     C***
095870950127     C*** ESEGUO RICERCA ALFABETICA
095880950127     C                   MOVEL     VIDCCM        WCCM
095890950209     C                   MOVEL     VIDLNP        WLNP
095900950127     C     VIDFLC        IFNE      0
095910950127     C                   Z-ADD     VIDFLC        WFLC
095920950127     C                   ELSE
095930950127     C                   Z-ADD     VIDLNP        WFLC
095940950127     C                   ENDIF
095950950127     C                   MOVEL(P)  VIDDMT        PAXDMT
095960950127     C                   EXSR      RICALF
095970950127     C                   MOVEL     WCCM          VIDCCM
095980050215     C                   MOVEL(p)  PAXDMT        VIDDMT
095990950127     C     *IN14         IFEQ      *ON
096000950127     C                   MOVEL     WFLC          VIDFLC
096010950127     C                   ENDIF
096020010216     C     WEMFOR        IFEQ      '1'
096030010216     C                   GOTO      ENDC01
096040010216     C                   ENDIF
096050970925     C***
096060160223     c*** DATA SPEDIZIONE ***
096070970925     C                   EXSR      CTRDSP
096080970925     C   90              GOTO      ENDC01
096090950208     C***
096100950208     C*** LINEA PARTENZA ***
096110950208     C                   MOVEL     VIDLNP        WLNP
096120950208     C                   EXSR      CTRLNP
096130950208     C   90              GOTO      ENDC01
096140991206      *
096150991206      * PER LNP DPD OBBLIGATORIO 1 COLLO
096160020319     C     §OGNTW        IFEQ      'DPD'
096170000509     C     V1CNCL        ANDNE     1
096180991206     C                   SETON                                        6290
096190991206     C                   MOVEL     ERR(178)      VIDMSG
096200991206     C                   GOTO      ENDC01
096210000509     C                   ENDIF
096220010212     C***
096230010212     C*** NUMERO O.R.M.
096240010212     C*
096250010212     C* Controllo solo se attivata procedura O.R.M.
096260010212     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
096270010212     c* fine dell'immissione
096280010212     C     WORM          IFEQ      'S'
096290010212     C     PARTCH        ANDNE     'P'
096300010213     C                   Z-ADD     VIDPOE        WOPOE
096310010213     C                   Z-ADD     VIDNOR        WONOR
096320010213     C                   Z-ADD     VIDNRV        WONRV
096330010213     C                   Z-ADD     VIDLNP        WOLNP
096340010212     C                   EXSR      CTRORM
096350010212     C   90              GOTO      ENDC01
096360010216     C     WEMFOR        IFEQ      '1'
096370010216     C                   GOTO      ENDC01
096380010216     C                   ENDIF
096390010212     C* Propongo campi da O.R.M. se non immessi da utente
096400010212     C* ** Solo se orm non è fittizio **
096410010212     C     FLGFIT        IFEQ      *BLANKS
096420010215     C                   EXSR      PRPOR1
096430010213     C   90              GOTO      ENDC01
096440010212     c* Se ho proposto dei campi non continuo i controlli ma devo
096450010212     c* riemettere videata per visualizzare i dati aggiunti
096460050119     c* idem se richiesto espressamente di non continuare i controlli
096470010212     C     WEFORM        IFEQ      '1'
096480050119     c     wsolo_prp     oreq      '1'
096490040915     c* posizionamento cursore su cod mittente dopo proposte campi da orm
096500040915     c* se però cod.mittente personalizzato mi posiziono su n.ro colli
096510041108     c**** *in19         ifeq      *off
096520041108     c**** *in85         andeq     *off
096530041108     c**** *in38         andeq     *off
096540041108     c****               z-add     12            h1riga
096550041108     c****               z-add     24            h1colo
096560041108     c****               else
096570041129     c     *in38         ifeq      *off
096580041108     c**** *in19         ifeq      *on
096590041108     c**** *in85         oreq      *on
096600040915     c                   z-add     13            h1riga
096610040915     c                   z-add     20            h1colo
096620040915     c                   endif
096630041108     c*****              endif
096640041108     c*****              endif
096650050321     c                   eval      weform = '1'
096660010212     C                   GOTO      ENDC01
096670010212     C                   ENDIF
096680010212     C                   ENDIF
096690010212     C                   ENDIF
096700010227     C* SE PREMUTO F8 MA PROC.ORM NON ATTIVATA RIEMETTO LA VIDEATA
096710010227     C   KH              MOVEL     '1'           WEMFOR
096720010227     C   KH              GOTO      ENDC01
096730940920     C***
096740940920     C*** SIGLA OPERATORE ***
096750940920     C* CONTROLLO SOLO SE NON E' PROTETTO
096760941011     C     *IN13         IFEQ      *OFF
096770940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
096780940920     C                   MOVEL     '3M'          COD
096790940920     C                   MOVEL(P)  VIDSOP        KEY
096800940920     C                   EXSR      CTABEL
096810940920     C     *IN30         IFEQ      *OFF
096820950713     C     VIDSOP        OREQ      ' '
096830940920     C                   MOVEL     ERR(29)       VIDMSG
096840940923     C                   SETON                                        4290
096850940920     C                   GOTO      ENDC01
096860940920     C                   ENDIF
096870940920     C                   ENDIF
096880940823     C***
096890990628     C*** DATA RITIRO MERCE E PRESTAZIONE M/P ***
096900020131     C                   EXSR      CTRDRT
096910940920     C   90              GOTO      ENDC01
096920940823     C***
096930960926     C*** CODICE AUTOTRASPORTATORE ***
096940940824     C                   MOVEL     VIDPDR        WPDR
096950940824     C                   EXSR      CTRPDR
096960940824     C                   MOVEL     WPDR          VIDPDR
096970940824     C     WEMFOR        IFEQ      '1'
096980940920     C                   GOTO      ENDC01
096990940824     C                   ENDIF
097000940823     C***
097010921006     C*** NUMERO SPEDIZIONE ***
097020990602     C  N12PARTCH        IFEQ      'R'
097030921006     C     RECNSP        ANDEQ     0
097040940823     C                   MOVEL     ERR(33)       VIDMSG
097050940923     C                   SETON                                        6190
097060940920     C                   GOTO      ENDC01
097070921006     C                   END
097080950127     C***
097090950127     C*** NUMERO COLLI ***
097100950127     C     V1CNCL        IFEQ      0
097110950127     C                   MOVEL     ERR(34)       VIDMSG
097120950127     C                   SETON                                        6290
097130950127     C                   GOTO      ENDC01
097140950127     C                   END
097150950127     C***
097160950127     C*** PESO   ***
097170950127     C* LO CONTROLLO SOLO IN SECONDA VIDEATA SE CARICAMENTO DISK  CLI
097180950127     C* >< DA 0
097190980402     C*
097200980402     C* OBBLIGATORIO
097210950127     C  N12VIDPKG        IFEQ      0
097220950127     C                   MOVEL     ERR(46)       VIDMSG
097230950127     C                   SETON                                        6390
097240950127     C                   GOTO      ENDC01
097250950127     C                   ENDIF
097260980402     C*
097270980402     C* NON MAGGIORE DEL LIMITE POSTO (forzabile)
097280090609     C* N12VIDPKG        IFGT      §QTPKB
097290090609     C*    VIDPKG        ANDNE     SAVPKG
097300090609     C*                  MOVE      VIDPKG        SAVPKG
097310090609     C*                  CLEAR                   WPT1
097320980623     C* PREPARO MSG
097330090609     C*                  MOVEA     ERR(52)       K78
097340090609     C*                  MOVEL     §QTPKB        W006A             6
097350090609     C*                  MOVEA     W006A         SKI(10)
097360090609     C*                  Z-ADD     10            I                 3 0
097370090609     C*                  EXSR      ABBL
097380090609     C*                  MOVEA     SKI(10)       K78(34)
097390090609     C*                  MOVE      §QTPKB        W001A
097400090609     C*                  MOVEL     W001A         K78(41)
097410090609     C*                  MOVEA     K78           VIDMSG
097420090609     C*                  SETON                                        6390
097430090609     C*                  GOTO      ENDC01
097440090609     C*                  ENDIF
097450940823     C***
097460940823     C*** CODICE BOLLA ***
097470940824     C                   MOVEL     VIDCBO        WCBO
097480940824     C                   EXSR      CTRCBO
097490940824     C                   MOVEL     WCBO          VIDCBO
097500940824     C     WEMFOR        IFEQ      '1'
097510940920     C                   GOTO      ENDC01
097520940824     C                   ENDIF
097530940929     C***
097540940929     C*** CODICE MITTENTE ***
097550940929     C                   MOVEL     VIDFTM        WFTM
097560940929     C                   MOVEL     VIDCCM        WCCM
097570940929     C     VIDFLC        IFNE      0
097580940929     C                   Z-ADD     VIDFLC        WFLC
097590940929     C                   ELSE
097600940929     C                   Z-ADD     VIDLNP        WFLC
097610941108     C                   ENDIF
097620940929     C                   EXSR      CTRCCM
097630941011     C                   MOVEL     WCCM          VIDCCM
097640941011     C     *IN14         IFEQ      *ON
097650941011     C                   MOVEL     WFLC          VIDFLC
097660941011     C                   ENDIF
097670941011     C*
097680940929     C     WEMFOR        IFEQ      '1'
097690940929     C                   GOTO      ENDC01
097700940929     C                   ENDIF
097710940823     C***
097720940823     C*** TIPO SERVIZIO ***
097730940824     C                   MOVEL     VIDTSP        WTSP
097740940929     C                   EXSR      CTRTSP
097750940929     C                   MOVEL     WTSP          VIDTSP
097760940824     C     WEMFOR        IFEQ      '1'
097770940920     C                   GOTO      ENDC01
097780940824     C                   ENDIF
097790940823     C***
097800940823     C*** CODICE TRATTAMENTO MERCE ***
097810940824     C*
097820940824     C* SE CODICE BOLLA PREVEDE IL CODICE TRATTAMENTO MERCE QUESTO
097830940824     C* PREVALE SUL CODICE DELL'ANAGRAFICA E SU QUELLO DIGITATO
097840940824     C     §3ACTM        IFNE      *BLANKS
097850940929     C                   MOVEL     §3ACTM        WCTM
097860940824     C                   ELSE
097870940824     C* SE NON IMMESSO PRENDO VALORE DI DEFAULT
097880940824     C     VIDCTM        IFEQ      *BLANKS
097890940929     C                   MOVEL     COMCTM        WCTM
097900940929     C                   ELSE
097910940929     C                   MOVEL     VIDCTM        WCTM
097920940824     C                   ENDIF
097930940824     C                   ENDIF
097940940824     C*
097950940824     C* CONTROLLO
097960950504     C                   CLEAR                   W003A
097970940929     C                   MOVEL     WCTM          W003A
097980940824     C                   EXSR      CTRCTM
097990940929     C* SCRIVO IL CTM SOLO SE AVEVO DIGITATO UN '?'
098000941005     C* SE IMPOSTO QUELLO DI DFT NON LO FACCIO VEDERE A VIDEO
098010940929     C     '?'           SCAN      W003A                                  30
098020940929     C     *IN30         IFEQ      *ON
098030940824     C                   MOVEL     WCTM          VIDCTM
098040940929     C                   ENDIF
098050940824     C     WEMFOR        IFEQ      '1'
098060940920     C                   GOTO      ENDC01
098070940824     C                   ENDIF
098080121106
098090121106     c* Non posso utilizzare un CTM che mantiene in numero di spedizione
098100121106     c*  se = 0
098110121106     C   12
098120121106    1Can 15§1BFG3        IFEQ      'S'
098130121106     c     vidnsp        andeq     0
098140121106     C                   MOVEL     ERR(72)       VIDMSG
098150121106     c                   eval      %subst(vidmsg:20:2)=vidctm
098160121106     C                   SETON                                        4990
098170121106     C                   GOTO      ENDC01
098180121106    1C                   END
098190940824     C*
098200910828     C* SE FLAG6=M O C  OBBLIGATORIA LA LINEA DI ARRIVO
098210910828     C     §1BFG6        IFEQ      'M'
098220910828     C     §1BFG6        OREQ      'C'
098230921019     C     §1BFG8        ANDNE     'N'
098240940823     C*
098250910828     C     VIDLNA        IFEQ      *BLANKS
098260910828     C     VIDLNA        OREQ      *ZEROS
098270940823     C                   MOVEL     ERR(14)       VIDMSG
098280940923     C                   SETON                                        4790
098290940920     C                   GOTO      ENDC01
098300910828     C                   END
098310910828     C                   END
098320081107     c* controllo la congruenza fra codice bolla e il codice trattamento merce
098330081107     c                   exsr      ctrcbo_ctm
098340081107     C     *in90         IFEQ      '1'
098350081107     C                   GOTO      ENDC01
098360081107     C                   ENDIF
098370910828     C*
098380910828     C* PER DISK CLI CONTROLLO ESISTENZA DETTAGLIO SEGNACOLLI X FLG7=S
098390950718     C   15
098400950718     CAN 12§1BFG7        IFEQ      'S'
098410020917     C     KBLC          SETLL     FIVAD000                               30
098420940823     C     *IN30         IFEQ      *OFF
098430940823     C                   MOVEL     ERR(37)       VIDMSG
098440940923     C                   SETON                                        6290
098450940920     C                   GOTO      ENDC01
098460970107     C                   ENDIF
098470950717     C* SE SEGNACOLLI DA CLIENTE, CONTROLLO CHE NON CI SIANO SEGNACOLLI
098480950717     C*  RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
098490950719     C     §1BFG6        IFEQ      'C'
098500980325     C                   EXSR      VADDOP
098510950717     C   90              GOTO      ENDC01
098520940823     C                   ENDIF
098530950719     C                   ENDIF
098540040601     C* PER DISK CLI CONTROLLO ESISTENZA estensione stmpa ddt x FLG16=S
098550040601     C   15
098560040603    1CAN 12§1BF16        IFEQ      'S'
098570130301     c                   clear                   wvax
098580130301     c                   clear                   wvatp
098590130301     C     KBLC          SETLL     FIVAX000
098600130301    2c                   if        %equal(fivax01l)
098610130301     c                   eval      wvax='S'
098620130301    2c                   endif
098630130301     C                   MOVEL     'P'           WTRC
098640130301     C     Kvat          SETLL     FIVAt000
098650130301    2C                   if        %equal(fivat01l)
098660130313     c* cliente abilitato al pdf: memkorizzo presenza pdf
098670130313     c                   eval      wvatp='S'
098680130313     c* cliente non abilitato alla gestione del PDF:
098690130313     c* memorizzo per l'invio mail di alert
098700130313     c                   if        §clipdfp=*blanks
098710130313     c                   eval      wvatpe='S'
098720130313     c                   endif
098730130301    2c                   endif
098740130301    2c                   if        wvax=*blanks and wvatp=*blanks
098750040601     C                   MOVEL     ERR(279)      VIDMSG
098760040601     C                   SETON                                        6290
098770040601     C                   GOTO      ENDC01
098780130313     c                   else
098790130313     c* cliente non abilitato al PDF
098800130313     c                   if        wvatp='S' and §clipdfp=*blanks
098810130313     C                   MOVEL     ERR(349)      VIDMSG
098820130313     C                   SETON                                        4990
098830130313     C                   GOTO      ENDC01
098840130313     c                   endif
098850040603    2C                   ENDIF
098860130301   2ac                   if        wvax='S'
098870040603     c                   clear                   s_vaxprr
098880040603    2c                   do        *hival
098890061010     c     kblc          reade(N)  fivax000
098900040603    3c                   if        %eof(fivax01l)
098910040603     c                   leave
098920040603    3c                   endif
098930040603    3c                   if        vaxprr = s_vaxprr
098940040603     C                   MOVEL     ERR(280)      VIDMSG
098950040603     c                   seton                                        6290
098960040603     C                   GOTO      ENDC01
098970040603   x3c                   else
098980040603     c                   eval      s_vaxprr=vaxprr
098990040603    3c                   endif
099000040603    2c                   enddo
099010041210     c* controllo esistenza logo su tabella ar8
099020041210     C                   CLEAR                   DSBS02
099030041210     C                   MOVEL     'C'           T02MOD
099040041210     C                   MOVEL     KNSIF         T02SIF
099050041210     C                   MOVEL     'AR8'         T02COD
099060041210     C                   MOVEL(P)  vaxtmd        T02KE1
099070041210      *
099080041210     C                   CALL      'TIBS02R'
099090041210     C                   PARM                    KPJBA
099100041210     C                   PARM                    DSBS02
099110041210      *
099120041210     C     T02ERR        IFne      *BLANKS
099130041210     C                   MOVEL     ERR(290)      VIDMSG
099140041210     c                   eval      vidmsg = %trim(vidmsg) + ' "' + vaxtmd + '" '
099150041210     c                             + 'per stampa Lettera di vettura.AVVISARE IL'
099160041210     c                             + ' CED'
099170041210     c                   seton                                        90
099180041210     C                   GOTO      ENDC01
099190041210     c                   endif
099200130301   2ac                   endif
099210130305     c* controlli pdf: verifico che non sia doppio negli ultimi 30gg
099220130304     c                   if        wvatp='S'
099230130304     c                   exsr      pdfdop
099240130304     c                   if        *in90
099250130304     C                   goto      ENDC01
099260130304     c                   endif
099270130301     c                   endif
099280040603    1C                   ENDIF
099290050221     c
099300970904     C**
099310970904     C* IN MANUTENZIONE NON SI PUO' VARIARE COLLI PER DISK CLIENTI B
099320050429     C   12
099330050429     CANN15V1CNCL        IFNE      SAVNCL
099340050429     C     §1BFG6        andeq     'C'
099350050429     C     §1BFG2        ANDEQ     'S'
099360050429     C                   MOVEL     ERR(69)       VIDMSG
099370050429     C                   SETON                                        6290
099380050429     C                   GOTO      ENDC01
099390050429     C                   ENDIF
099400940823     C***
099410940823     C*** LINEA ARRIVO ***
099420910805     C* IN MANUTENZIONE NON POSSO VARIARE LA LINEA PER DISK CLIENTI B
099430100210     c*  ES 10/02/10 parlando con Luciano ci sembrava non corretto far
099440100210     c*     modificare la data anche in conferma. Per evitare errori
099450100210     c*     anche dovuti al fatto che per servizio  H non ci può essere incongru
099460100210     c*     enza, metto il messaggio anche per la conferma
099470100210     c
099480100210     C*  12
099490100210     C*NN15§1BFG6        IFEQ      'C'
099500100210
099510100210     C   12§1BFG6        IFEQ      'C'
099520940928     C     SAVLNA        ANDNE     VIDLNA
099530071220     c     §clidkb       andne     'S'
099540100210     c     savlna        andgt     *zeros
099550940823     C                   MOVEL     ERR(13)       VIDMSG
099560940923     C                   SETON                                        4790
099570940920     C                   GOTO      ENDC01
099580910805     C                   END
099590020320     c* Non posso variare la linea di arrivo anche in base a §1bf14
099600020320     c   12
099610020320     cANN15§1bf14        ifeq      'S'
099620020320     C     SAVLNA        ANDNE     VIDLNA
099630020320     C                   MOVEL     ERR(249)      VIDMSG
099640020320     C                   SETON                                        4790
099650020320     C                   GOTO      ENDC01
099660020320     C                   END
099670970414     C* SE BOLLA DIROTTATA POSSO VARIARLA SOLO SE NON HO TRASMESSO
099680970414     C*  il LEGAME BOLLA
099690970414     C   12
099700970414     CANN15SAVLNA        IFNE      VIDLNA
099710970414     C     KBLP3         CHAIN(N)  FNLBL000                           32
099720970724     C  N32LBLFT1        IFNE      ' '
099730970414     C     LBLFT2        ORNE      ' '
099740970414     C                   MOVEL     ERR(141)      VIDMSG
099750970414     C                   SETON                                        4790
099760970414     C                   GOTO      ENDC01
099770970414     C                   END
099780970724     C* SE C'E' LEGAME BOLLA NON POSSO METTERE  L.ARRIVO=L.PARTENZA
099790970724     C  N32              MOVEL     VIDLNP        W003A
099800970724     C  N32W003A         IFEQ      VIDLNA
099810970724     C                   MOVEL     ERR(83)       VIDMSG
099820970724     C                   SETON                                        4790
099830970724     C                   GOTO      ENDC01
099840970724     C                   END
099850970414     C                   END
099860940824     C*
099870940824     C                   MOVEL     VIDLNA        WLNA
099880110217     C                   EXSR      CTRLNA_vid
099890940824     C                   MOVEL     WLNA          VIDLNA
099900940824     C     WEMFOR        IFEQ      '1'
099910940920     C                   GOTO      ENDC01
099920940824     C                   ENDIF
099930060707     c*
099940060707     c* Non posso variare la lna passando da lna non dpd a lna dpd
099950060707     c   12
099960060707     cann15savlna        ifne      vidlna
099970060707     c     savaogntw     andne     A_§ogntw
099980060707     c     A_§ogntw      andeq     'DPD'
099990060707     C                   MOVEL     ERR(305)      VIDMSG
100000060707     C                   SETON                                        4790
100010060707     C                   GOTO      ENDC01
100020060707     c                   endif
100030071220     c* Disk "B" - non posso variare la linea se:
100040071220     c                   if        *in12 and not *in15  and
100050071220     c                             §1bfg6='C' and savlna<>vidlna
100060071220     c                   exsr      sr_chkabilna
100070071221     c                   if        *in90
100080071221     c                   goto      endc01
100090071221     c                   endif
100100061124     c*
100110071220     c                   endif
100120061124     C* PER DISK A CON VAT OPPURE PER DISK C EX DISK B  CONTROLLO
100130061124     C* ESISTENZA CODICI CHI SONO
100140061124     C* IDEM SE SONO IN MANTUENZIONE
100150061124     C     A_§OGNTW      IFEQ      'DPD'
100160061124     C     VIDDPD        OREQ      'D'
100170061124     C                   MOVEL     'S'           WEXDPD            1
100180061124     C                   ELSE
100190061124     C                   CLEAR                   WEXDPD
100200061124     C                   ENDIF
100210061124     C*
100220160226     c* Disk A con VAT non DPD
100230160226     c                   if        (§1bf12='E' and wexdpd<>'S' and *in79=*off)
100240160226     c                             or
100250160226     c* Disk A con VAT export dpd con numero parcel automatico
100260160226     c                             (§1bf12='E' and wexdpd='S' and §1bf13='A')
100270160226     c                             or
100280160226     c* Dsik C ex disk B
100290160226     c                             (§1bf12='B')
100300160226     c                             or
100310160226     c* Manutenzione: Disk C (di qualunque tipo) no DPD
100320160226     c                             (*in12 and *in15=*off and
100330160226     c                              §1bf12<>'N' and wexdpd<>'S' and not *in79)
100340160226     c                             or
100350160226     c* Manutenzione: Disk C (di qualunque tipo) export dpd
100360160226     c* Con parcel automatico o instradamento forzato a dpd con parcel autom
100370160226     c                             (*in12 and *in15=*off and
100380160226     c                              §1bf12<>'N' and wexdpd='S' and (
100390160226     c                              §1bf13='A' or w_adpd='S'))
100400070323     c*  Per bolla export dpd con parcel  lungo 12 bypasso questo con-
100410070323     c*  trollo che non funzionerebbe
100420061124      * se non ho superato i 500 colli
100430061124If  2c                   If        v1cncl <= 500
100440061124     C* CONTROLLO CHE NON CI SIANO SEGNACOLLI
100450061124     C*                         RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
100460061124     C* CONTEGGIO ANCHE N° RECORD "CHI SONO" PERCHE' DEVE ESSERE = AL
100470061124     C* NUMERO DEI COLLI
100480061124     C* PASSO A ROUTINE UN FLAG PER SEGNALARE CHE E' RICHIAM.DA CTRD01
100490061124     C                   MOVEL     'C'           WC01FG            1
100500061124     C                   EXSR      CTRS08
100510061124     C   90              MOVEL     W08MSG        VIDMSG
100520061124     C   90              SETON                                        62
100530061124     C   90              GOTO      ENDC01
100540061124   x2c                   Else
100550061124     c                   Eval      VidMsg = Err(275)
100560061124     c                   Eval      *In90 = *On
100570061124     c                   Eval      *In62 = *On
100580061124     c                   GoTo      EndC01
100590061124    2c                   EndIf
100600061124     C                   ENDIF
100610061124     c* se sono in conferma bolle da disk di bolla dpd errore se
100620061124     c* il cliente mi ha passato più di un VAT
100630061124     c                   if        *in12 and *in15 and §1bf12 = 'E'
100640061124     c                             and werrvat = '1'  and
100650061124     c                             ((§1bf13 = *blanks and wexdpd = 'S')
100660061124     c                              or (*in79 = *on))
100670061124     c                   Eval      VidMsg = Err(291)
100680061124     c                   Eval      *In90 = *On
100690061124     c                   Eval      *In62 = *On
100700061124     c                   GoTo      EndC01
100710061124     c                   endif
100720960320     C*
100730960320     C* PER LNA 102 OBBLIGATORIO IL C/S
100740960320     C     COMLNA        IFEQ      102
100750960320     C     §3ARBL        ANDNE     'C'
100760960320     C                   SETON                                        4690
100770960320     C                   MOVEL     ERR(126)      VIDMSG
100780960320     C                   GOTO      ENDC01
100790960320    3C                   ENDIF
100800000609     C**
100810060109     C* PER BOLLA EXPORT DPD, NON POSSO ACCETTARE SOLUZIONI "B" se ctm
100820060109     c* che non prevede l'assegnazione automatica del "chi sono DPD"
100830000609     C   15
100840000609     CAN 12§1BFG6        IFEQ      'C'
100850000609     C     §1BFG2        ANDEQ     'S'
100860060109     c     §1bf13        andne     'A'
100870020319     C     A_§OGNTW      IFEQ      'DPD'
100880020204     C     VIDDPD        OREQ      'D'
100890060109     C                   MOVEL     ERR(296)      VIDMSG
100900000609     C                   SETON                                        6290
100910000609     C                   GOTO      ENDC01
100920000609     C                   ENDIF
100930000609     C                   ENDIF
100940061121     c*
100950080411     c* 11/04/2008: Asterisco i seguenti controlli perchè li ho spostat
100960080411     c* dentro la CTRIND
100970061121     C* VERIFICO SE P.O. EMITTENTE DPD o fed-ex
100980080411     c***                clear                   poentw
100990080411    2C***  FLGFIT        IFNE      'S'
101000080411     C***  ORMPOE        CHAIN     AZORG01L      UNIORG               30
101010080411     C***                MOVEL     OG143         SAV143
101020080411     C**N30              MOVEL     ORGDE3        OG143
101030080411     C** 30              CLEAR                   OG143
101040080411     c**                 eval      poentw=§ogntw
101050080411     C**                 MOVEL     SAV143        OG143
101060080411    2C***                ENDIF
101070010503     C* SE BOLLA EXPORT DPD IN PORTO ASSEGNATO DEVE ESSERE ASSOCIATA AD
101080010503     C* UN ORM REALE COMMISSIONATO DA UN P.O. DPD
101090020207     c* IDEM PER BOLLA FEDEX
101100010508     C* NON FACCIO QUESTO CONTROLLO SE PGM RICHIAMATO DA PGM GIACENZE
101110020527     c* o da ritiri annullati (savfpr="T")
101120080411    0c***  *in04         ifeq      *on
101130080411     c***                clear                   pofed             1
101140080411     c***                clear                   podpd             1
101150080411     C***                MOVEA     ERR(229)      K78
101160080411    1C***  A_§OGNTW      IFEQ      'DPD'
101170080411     C***  VIDDPD        OREQ      'D'
101180080411     c***                movel     '1'           podpd
101190080411     C***                MOVE      'DPD  '       W005A             5
101200080411     C***                MOVEA     W005A         K78(14)
101210080411     C***                MOVEA     W005A         K78(71)
101220080411     c***                endif
101230080411     c***  A_§ogntw      ifeq      'FED'
101240080411     c***  viddpd        oreq      'F'
101250080411     c***                movel     '1'           pofed
101260080411     C***                MOVE      'FedEx'       W005A             5
101270080411     C***                MOVEA     W005A         K78(14)
101280080411     C***                MOVEA     W005A         K78(71)
101290080411     c***                endif
101300040907     c*
101310080411     c***                clear                   wnocont
101320040907     c* Se provengo da manutenzione di bolla di reso lo memorizzo
101330040907     c* per non effettuare il controllo seguente
101340080411     c***  *in12         ifeq      *on
101350080411     c***  *in15         andeq     *off
101360080411     c***  vidfbr        andeq     'S'
101370080411     c***                move      'N'           wnocont           1
101380080411     c***                endif
101390020131     c
101400080411    1C**   podpd         IFEQ      '1'
101410080411     c**   pofed         oreq      '1'
101420080411   1AC**   SAVFPR        IFNE      'P'
101430080411     C*    SAVFPR        ANDNE     'G'
101440080411     C*    SAVFPR        ANDNE     'T'
101450080411     c*    wnocont       andeq     *blanks
101460080411    2C*    FLGFIT        IFEQ      'S'
101470080411     C*    poentw        ORNE      'DPD'
101480080411     c*    podpd         andeq     '1'
101490080411     C*    poentw        ORNE      'FED'
101500080411     c*    pofed         andeq     '1'
101510080411     C*                  MOVEA     K78           VIDMSG
101520080411     C*                  SETON                                        90
101530080411    3C*    WPERSO        IFEQ      'P'
101540080411     C*                  Z-ADD     05            H0RIGA
101550080411     C*                  Z-ADD     20            H0COLO
101560080411     C*                  ELSE
101570080411     C*                  Z-ADD     06            H1RIGA
101580080411     C*                  Z-ADD     20            H1COLO
101590080411    3C*                  ENDIF
101600080411     C*                  GOTO      ENDC01
101610080411    2C*                  ENDIF
101620080411   1AC*                  ENDIF
101630080411    1C*                  ENDIF
101640080411    0c*                  endif
101650940823     C***
101660940823     C*** DESTINATARIO  ***
101670001121      ***
101680001121      * ALLINEO A SX LA LOCALITA'
101690001121     C     VIDLOD        IFNE      *BLANKS
101700001121     C                   MOVEL     VIDLOD        W001A
101710001121     C     W001A         IFEQ      *BLANKS
101720001121     C                   MOVEA     VIDLOD        K35
101730001121     C     ' '           CHECK     VIDLOD        XX
101740001121     C                   CLEAR                   VIDLOD
101750001121     C                   MOVEA     K35(XX)       VIDLOD
101760001121     C                   ENDIF
101770001121     C                   ENDIF
101780130923     c* controllo dei caratteri
101790130923     c                   eval      wtxt=vidrsd
101800131003     c                   eval      uppercase = '1'
101810141202     c                   clear                   ElencoChar
101820160112     c                   clear                   TipoElenco
101830130923     c                   exsr      sr_chk
101840130923     c                   movel     wtxt          vidrsd
101850130923     c                   eval      wtxt=vidind
101860131003     c                   eval      uppercase = '1'
101870141202     c                   clear                   ElencoChar
101880160112     c                   clear                   TipoElenco
101890130923     c                   exsr      sr_chk
101900130923     c                   movel     wtxt          vidind
101910130923     c                   eval      wtxt=vidlod
101920131003     c                   eval      uppercase = '1'
101930141202     c                   clear                   ElencoChar
101940160112     c                   clear                   TipoElenco
101950130923     c                   exsr      sr_chk
101960160112     c* eseguo routine per eliminare caratteri non ammessi nella località come
101970160112     c* da tabella "CSP"
101980160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
101990160112     c                   clear                   uppercase
102000160112     c                   eval      ElencoChar=Charnook
102010160112     c                   eval      TipoElenco='1'
102020160112     c                   exsr      sr_chk
102030140207     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
102040140207     c* seguenti la località
102050140207     c                   exsr      chkstringa
102060140110     c                   movel     wtxt          vidlod
102070140113     c* segnalo errore se località contenente caratteri di punteggiatura
102080140113     c* a destra e/o a sinistra
102090140207     c***                if        vidlod<>*blanks
102100140207     c***                exsr      chkstringa
102110140207     c***                if        posl=0 or wtxt<>%subst(wtxt:posl:lung)
102120140207     C***                MOVEL     ERR(350)      VIDMSG
102130140207     C***                SETON                                        6690
102140140207     C***                GOTO      ENDC01
102150140207     c***                endif
102160140207     c***                endif
102170001121      *
102180970701     C                   MOVEL     VIDRSD        I14RSC
102190970701     C                   MOVE      VIDRSD        I14RS2
102200970701     C                   MOVEL     VIDIND        I14IND
102210970701     C                   MOVEL     VIDLOD        E14LOC
102220970701     C                   MOVEL     VIDPID        E14PIP
102230970701     C                   MOVEL     VIDPRD        E14PRV
102240970701     C                   MOVEL     VIDNZD        E14NAR
102250970701     C                   MOVEL     VIDCAD        E14CAP
102260970704     C                   MOVEL     'D'           WCLI              1
102270061121     c                   clear                   wcdf
102280970704     C                   EXSR      CTRIND
102290970702     C*
102300970702     C* IMPOSTO I CAMPI DI UNA EVENTUALE RICERCA
102310970704     C                   MOVEL     E14LOC        VIDLOD
102320970704     C                   MOVEL     E14CAP        VIDCAD
102330970704     C                   MOVEL     E14NAR        VIDNZD
102340970704     C                   MOVEL     E14PRV        VIDPRD
102350970702     C                   MOVEL     E14PIP        VIDPID
102360970704     C* ERRORE
102370970704     C     WEMFOR        IFEQ      '1'
102380970704     C     *IN90         OREQ      *ON
102390970704     C                   GOTO      ENDC01
102400970704     C                   ENDIF
102410160223     c*
102420160223     c* Se bolla export eex verifico se instradabile su DPD
102430160223     c*
102440160302     c                   if        not *in12 or *in15
102450160302     c                   clear                   w_adpd
102460160302     c                   if        viddpd=' ' and wdesie='E' and
102470160302     c                             (vidlna = *zeros or vidlna=*blanks)
102480160302     c                             and not *in44
102490160407     c                             and §lpfpr<>'O' and partch<>'P'
102500160407     c                             and §3arbl<>'R'
102510160226     c                             and not *in04
102520160223     c                   exsr      sr_instrADPD
102530160223     c                   endif
102540160223     c                   endif
102550160223
102560070808     c* Per TELLUS --> Indirizzo: deve essere di almeno 6 caratteri
102570090202     c* Ignoro l'errore se destinatario estero protetto
102580070808     c                   eval      w_vidind=%trim(vidind)
102590070827     c     ' '           checkr    w_vidind      num               2 0
102600090202     c                   if        num<6 and (wdesie<>'E' or atrdes<>prot)
102610070808     C                   SETON                                        90
102620070808     C                   Z-ADD     18            H1RIGA
102630070808     C                   Z-ADD     02            H1COLO
102640070808     C                   MOVEL     ERR(313)      VIDMSG
102650070808     C                   GOTO      ENDC01
102660070808     c                   endif
102670061121     c* Se destinatario estero e orm avente p.o. emittente DPD errore se
102680061121     c* il network non è dpd
102690061121     c                   if        wdesie='E' and flgfit<>'S'
102700061121     c                             and poentw='DPD' and viddpd<>'D'
102710061121     c                             and A_§ogntw<>'DPD'
102720061121     c                   seton                                        90
102730061121     c                   Eval      VidMsg = Err(309)
102740061121     c                   z-add     21            H1riga
102750061121     c                   z-add     10            H1colo
102760061121     c                   GoTo      EndC01
102770061121     c                   endif
102780160513     c* Se destinatario estero e orm avente p.o. emittente EEX errore se
102790160513     c* il network non è EEX
102800160513     c                   if        wdesie='E' and flgfit<>'S'
102810160513     c                             and poentw='EEX' and
102820160513     c                             (viddpd<>' ' or
102830160513     c                              (A_§ogntw<>*blanks and A_§ogntw<>'EEX'))
102840160513     c                   seton                                        90
102850160513     c                   Eval      VidMsg = Err(365)
102860160513     c                   if        viddpd<>' '
102870160513     c                   z-add     21            H1riga
102880160513     c                   z-add     10            H1colo
102890160513     c                   else
102900160513     c                   z-add     14            H1riga
102910160513     c                   z-add     55            H1colo
102920160513     c                   endif
102930160513     c                   GoTo      EndC01
102940160513     c                   endif
102950141202     c* Se presente PIN CODE lo controllo - SE sono in Conferma Bolle
102960141202
102970141202     c                   if        *in12 and *in15  and
102980141202     c                             wpincode<>*blanks
102990141202     c* se bolla export non lo controllo perchè per l'export non lo
103000141202     c* memorizziamo
103010141202     c                   if        (comlna>0 and
103020141202     c                              a_§ogntw<>'FED' and
103030141202     c                              a_§ogntw<>'EEX' and
103040141202     c                              a_§ogntw<>'DPD' ) or
103050141202     c                             (comlna = 0 and wdesie<>'E')
103060141202     c* errore se Pin Code ricevuto > di 15 caratteri
103070141202     c                   if        lenPC>15
103080141202     c                   Eval      *In90 = *On
103090141202     c                   Eval      vidmsg=err(355)
103100141202     c                   goto      endc01
103110141202     c                   endif
103120141202     c* verifico la presenza di caratteri non validi
103130141209     c* se presenti dati in tabella CSP record "PINCODE" altrimenti
103140141203     c* i caratteri sono tutti validi
103150141203     c                   if        charpcok<>*blanks
103160141202     c                   eval      wtxt=wpincode
103170141202     c                   clear                   uppercase
103180141202     c                   eval      ElencoChar=charPCok
103190160112     c                   clear                   TipoElenco
103200141202     c                   exsr      sr_chk
103210141202     c                   if        esito<>'0'
103220141202     c                   Eval      *In90 = *On
103230141202     c                   Eval      vidmsg=err(356)
103240141202     c                   goto      endc01
103250141202     c                   endif
103260141209     c                   endif
103270141209     c* verifico che non siano presenti dei blank dentro al pin code
103280141209     c                   if        %scan(' ':%subst(wpincode:1:lenpc))>0
103290141209     c                   Eval      *In90 = *On
103300141209     c                   Eval      vidmsg=err(356)
103310141209     c                   goto      endc01
103320141209     c                   endif
103330141202     c                   endif
103340141202     c                   endif
103350050214     c*
103360050214     c* SE DESTINATARIO ESTERO vedo se devo forzare il porto franco
103370050214     C* (si tratta delle stesse operazioni effettuate anche routine prp
103380050214     c* or1 che devono essere effettuate anche in questo momento
103390050214     c* se l'orm è multiplo per cui deve prima essere controllato il
103400060427     c* destinatario per sapere se è estero- Idem se orm singolo ma non è
103410060427     c* specificato il destinatario ORM)
103420060428if  1c****               If        (Not *In12 or Not *In15) and
103430060428     c****                         (ormtor = 'M' or ormrsc=*blanks  )  and
103440050214      * e l'ORM prevede:
103450060428      *****           --> la bolla in porto Assegnato
103460060428      *****           --> paga ordinante orm
103470060428      *****           --> destinatario estero
103480060428      *****           --> ordinante orm italia
103490060428     c*****                        (§OrPfb = 'A' and OrmPag = 'O' and
103500060428     c****                          wdesie = 'E' and OrmNao = *Blanks)
103510060428     c****               exsr      sr_FOrmEst
103520060428    1c****               EndIf
103530061124     c                   if        vidnzd<>savnzd
103540061124     c                   clear                   wfortbo
103550061124     c                   move      vidnzd        savnzd
103560061124     c                   endif
103570140423
103580050214     c                   exsr      CTRCBO_orm
103590050214     C     *in90         IFEQ      '1'
103600050214     c                   eval      wemfor = '1'
103610050214     C                   GOTO      ENDC01
103620050214     C                   ENDIF
103630061011     c
103640061011     c* Per bolla dpd con CAP errato richiamo in automatico int cappar
103650061011     c*  DPD
103660061011    1c                   if        CapparioDPD='S' or *inkb
103670061011     c* Se non è + dpd tolgo il flag
103680061011    2C     A_§OGNTW      IFEQ      'DPD'
103690061011     C     VIDDPD        OREQ      'D'
103700061011     C     WDESIE        ANDEQ     'E'
103710061011     c* Se modificato il CAP vado avanti senza l'interrogazione
103720061011    3c                   if        vidcad=savcapdpd   or *inkb
103730061011     c* Per l'interrogazione passo solo il cap fittizio
103740061011     C                   MOVEL     '15'          COD
103750061011     C                   MOVEL(P)  VIDNZD        KEY
103760061011     C                   EXSR      CTABEL
103770061011     C                   MOVEL     TBLUNI        DS15
103780061011     c                   movea     vidcad        cap
103790061011     C                   CLEAR                   CAF
103800061011     C                   MOVEA     CAP(§15pcf)   CAF(§15pcf)
103810061011     c     §15ecf        add       §15pcf        finefit           2 0
103820061011     c                   movea     *blanks       caf(finefit)
103830061011     c
103840061011     C                   CLEAR                   tisie8ds
103850061011     c                   z-add     blpdsp        isie8dri
103860061011     c                   movel     'D01'         isie8op0
103870061011     C                   MOVEL     vidnzd        isie8nar
103880061011     C                   MOVEa     caf           isie8cap
103890061011     C                   CALL      'TISIE8R'
103900061011     C                   PARM                    kpjba
103910061011     C                   PARM                    tisie8ds
103920061011     c*
103930061011     c* Se errore lo emetto
103940061011     c                   if        osie8err<>' '
103950061011     C                   MOVEL     osie8msg      VIDMSG
103960061011     C                   SETON                                        6590
103970061011     C                   GOTO      ENDC01
103980061011     c                   endif
103990061011     c
104000061011    4c                   if        osie8capb<>*blanks
104010061011     c                   movel     osie8capb     vidcad
104020061011     c                   clear                   cappariodpd
104030061011     c
104040061011     c* In manutenzione se cambiato CAP riemetto videata
104050061011     c* In immissione/conferma no tanto devo confermare la videata
104060061011     c*    x nazione estera
104070150825     c****               if        *in12 and not *in15
104080061011     c                   eval      wemfor='1'
104090150825    4c****               endif
104100061011     c
104110061011     c                   else
104120061011     c* se non selezionato riemetto videata
104130061011     c                   eval      wemfor='1'
104140061011    4c                   endif
104150061011    3c                   endif
104160061011     c
104170061011   x2c                   else
104180061011     c                   clear                   cappariodpd
104190150729     c                   eval      wemfor='1'
104200061011    2c                   endif
104210061011    1c                   endif
104220020530     c*
104230941020     C**
104240950303     C* SE DESTINATARIO ESTERO --> P.IVA OBBLIGATORIA
104250950525     C* SOLO SE PAESE EFTA
104260050427     c* e non è bolla di recupero
104270000905     C     WDESIE        IFEQ      'E'
104280950616     C     VIDPID        ANDEQ     *BLANKS
104290050427     c     §3arbl        andne     'R'
104300000321     C*
104310020319    2C     A_§OGNTW      IFEQ      'DPD'
104320000321     C     DESEFD        ANDNE     *BLANKS
104330000321     C*
104340020204     C     VIDDPD        OREQ      'D'
104350000321     C     DESEFD        ANDNE     *BLANKS
104360020131     c*
104370020213    2C     A_§OGntw      oreq      'FED'
104380020131     C     DESEFf        ANDNE     *BLANKS
104390020131     C*
104400020131     C     VIDDPD        OREQ      'F'
104410020131     C     DESEFf        ANDNE     *BLANKS
104420000321     C*
104430020319     C     A_§OGNTW      ORNE      'DPD'
104440020213     c     A_§ogntw      andne     'FED'
104450000321     C     VIDDPD        ANDEQ     ' '
104460000321     C     O14EFT        ANDNE     *BLANKS
104470950303     C                   MOVEL     '1'           WEMFOR
104480950303     C                   SETON                                        387090
104490950303     C                   MOVEL     ERR(88)       VIDMSG
104500950303     C                   GOTO      ENDC01
104510000321    2C                   ENDIF
104520000321    1C                   ENDIF
104530970528     C* NON POSSO USARE L'ESPRESSO PER BOLLE IMPORT/EXPORT
104540970528     C     VIDTSP        IFEQ      'E'
104550970528     C     WDESIE        IFEQ      'E'
104560100118     c**   §ogntw        oreq      'EEX'
104570100118     c**   §ogntw        oreq      'FED'
104580100118     c**   §ogntw        oreq      'DPD'
104590970528     C                   MOVEL     '1'           WEMFOR
104600970528     C                   SETON                                        487090
104610970528     C                   MOVEL     ERR(142)      VIDMSG
104620100118     c                   eval      %subst(vidmsg:47:10) = v1dtsp
104630090604     c                   eval      vidmsg = %trim(vidmsg) + '!!'
104640970528     C                   GOTO      ENDC01
104650970528    1C                   ENDIF
104660970528    1C                   ENDIF
104670020415     c* NON POSSO USARE CLIENTE 9999 PER PORTI ASSEGNATI EUROEXPRESS
104680020416     c* Lo posso usare solo se bolla associata a orm reale commissionato da
104690020416     c* un p.o. EEX
104700020416     C     SAVFPR        IFNE      'P'
104710020416     C     SAVFPR        ANDNE     'G'
104720020527     C     SAVFPR        ANDNE     'T'
104730020416     c     vidccm        andeq     9999
104740020415     c     wdesie        ifeq      'E'
104750020415     c     viddpd        andeq     *blanks
104760020415     c     comlna        andeq     *zeros
104770020415     c     A_§ogntw      oreq      'EEX'
104780020416     c                   clear                   wokccm            1
104790020416     C* Verifico se P.O. emittente "EEX"
104800020416    2C     FLGFIT        IFNE      'S'
104810020416     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
104820020416     C                   MOVEL     OG143         SAV143
104830020416     C  N30              MOVEL     ORGDE3        OG143
104840020416     C   30              CLEAR                   OG143
104850020416     c     §ogntw        ifeq      'EEX'
104860020416     c                   movel     'S'           wokccm
104870020416     c                   endif
104880020416     C                   MOVEL     sav143        og143
104890020416    2C                   ENDIF
104900020416     c     flgfit        ifeq      'S'
104910020416     c     wokccm        oreq      *blanks
104920020415     C                   MOVEL     ERR(253)      VIDMSG
104930020415     C                   SETON                                        9050
104940020415     c   90              goto      endc01
104950020416     c                   endif
104960020415     c                   endif
104970020415     c                   endif
104980970528     C* NON POSSO USARE TIPO BOLLA 5
104990970528     C     WDESIE        IFEQ      'E'
105000970528     C     VIDCBO        ANDEQ     '5 '
105010970528     C                   MOVEL     '1'           WEMFOR
105020970528     C                   SETON                                        467090
105030970528     C                   MOVEL     ERR(143)      VIDMSG
105040970528     C                   GOTO      ENDC01
105050970528    1C                   ENDIF
105060030707
105070030707      * Se non sto facendo una bolla di recupero
105080030707If  1c                   If        §3aRbl <> 'R'
105090991206      **
105100991206      * SE CAP ESTERO--> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ITALIA
105110020319      ***                TRANNE SE LINEA DPD
105120950525     C     WDESIE        IFEQ      'E'
105130950525     C     COMLNA        ANDGT     0
105140020319     c     A_§ogntw      ifeq      'COR'
105150020319     c     A_§ogntw      oreq      'MES'
105160020319     c     A_§ogntw      oreq      'PPT'
105170950525     C                   MOVEL     ERR(117)      VIDMSG
105180950525     C                   SETON                                        4790
105190950525     C                   GOTO      ENDC01
105200020319     c                   endif
105210950525     C                   ENDIF
105220950525     C*
105230991206      * SE CAP ITALIA -> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ESTERO
105240020319     C***NEMMENO DPD
105250950525     C     WDESIE        IFEQ      'I'
105260971211     C     COMLNA        ANDGT     0
105270020319     c     A_§ogntw      ifeq      'EEX'
105280020319     c     A_§ogntw      oreq      'FED'
105290020319     c     A_§ogntw      oreq      'DPD'
105300950525     C                   MOVEL     ERR(118)      VIDMSG
105310950525     C                   SETON                                        4790
105320950525     C                   GOTO      ENDC01
105330950525     C                   ENDIF
105340000121     C                   ENDIF
105350030707    1c                   EndIf
105360000121      *
105370000121      * PER LNA DPD OBBLIGATORIO 1 COLLO
105380020319     C     A_§OGNTW      IFEQ      'DPD'
105390020204     C     VIDDPD        OREQ      'D'
105400000121     C     WDESIE        ANDEQ     'E'
105410000121     C     V1CNCL        IFNE      1
105420000121     C                   SETON                                        6290
105430000121     C                   MOVEL     ERR(179)      VIDMSG
105440000121     C                   GOTO      ENDC01
105450000121     C                   ENDIF
105460000121     C                   ENDIF
105470090429      * OBBLIGATORIETA' DI un collo anche per orm commissionato da dpd
105480151002     c                   if        flgfit<>'S' and poentw='DPD' and v1cncl<>1
105490090429     C                   SETON                                        6290
105500090429     C                   MOVEL     ERR(323)      VIDMSG
105510090429     C                   GOTO      ENDC01
105520090429     c                   endif
105530000121      * PER LNA O LNP DPD Massimo peso inseribile da tabella
105540020319     C  N12A_§OGNTW      IFEQ      'DPD'
105550020319     C     §OGNTW        OREQ      'DPD'
105560020204     C     VIDDPD        OREQ      'D'
105570000121     C     WDESIE        ANDEQ     'E'
105580000121     C     VIDPKG        IFGT      §3IPKD
105590000121     C                   SETON                                        6390
105600000121     C                   MOVEA     ERR(180)      K78
105610000121     C                   MOVEL     §3IPKD        W006A             6
105620000121     C                   MOVEA     W006A         SKI(10)
105630000121     C                   Z-ADD     10            I                 3 0
105640000121     C                   EXSR      ABBL
105650000121     C                   MOVEA     SKI(10)       K78(53)
105660000121     C                   MOVE      §3IPKD        W001A
105670000121     C                   MOVEL     W001A         K78(60)
105680000121     C                   MOVEA     K78           VIDMSG
105690000121     C                   GOTO      ENDC01
105700000121     C                   ENDIF
105710000121     C                   ENDIF
105720020201     c* per servizio dpd non accettato tipo bolla con C/A  - IDEM per FED-EX
105730080414     c*    viddpd        ifeq      'D'
105740080414     c*    A_§ogntw      oreq      'DPD'
105750080414     c*                  eval      w006a = 'DPD   '
105760080414     c*                  else
105770080414     c*    viddpd        ifeq      'F'
105780080414     c*    A_§ogntw      oreq      'FED'
105790080414     c*                  eval      w006a = 'FedEx '
105800080414     c*                  else
105810080414     c*                  if        wdesie='E'
105820080414     c*                  eval      w006a = 'EUROEX'
105830080414     c*                  endif
105840080414     c*                  endif
105850080414     c*                  endif
105860061030     c
105870061030     c* Controllo se ammesso C/A per estero in base ai vari network
105880080414     c****               setoff                                       90
105890080414     c*****              select
105900080414     C***  VIDDPD        wheneq    'D'
105910080414     C**** WDESIE        ANDEQ     'E'
105920061030     c*
105930080414     C***  A_§OGNTW      OREQ      'DPD'
105940080414     c***                if        descadpd=' '  and §3afca<>0
105950080414     c****               seton                                        90
105960080414     c****               endif
105970061030     c
105980080414     C***  VIDDPD        wheneq    'F'
105990080414     C***  WDESIE        ANDEQ     'E'
106000061030     c
106010080414     C***  A_§OGntw      OREQ      'FED'
106020080414     c****               if        descafed=' '  and §3afca<>0
106030080414     c***                seton                                        90
106040080414     c****               endif
106050080414     c***                other
106060080414     c****               if        wdesie='E' and
106070080414     c****                         descaeex=' '  and §3afca<>0
106080080414     c****               seton                                        90
106090080414     c****               endif
106100080414     c***                endsl
106110061030     c
106120080414     C***                IF        *in90
106130080414     c***                movea     err(187)      k78
106140080414     c***                movea     w006a         k78(13)
106150080414     C***                MOVEa     k78           VIDMSG
106160080414     C***                SETON                                        4690
106170080414     C***                GOTO      ENDC01
106180080414     C***                ENDIF
106190061030     c*
106200030221     c* Per bolle export fedex non è ammesso l'inserimento di C/Servizio
106210030221     c     viddpd        ifeq      'F'
106220030221     c     A_§ogntw      oreq      'FED'
106230030221     c     §3arbl        ifeq      'C'
106240020228     C                   MOVEL     ERR(245)      VIDMSG
106250020228     C                   SETON                                        4690
106260020228     C                   GOTO      ENDC01
106270030221     c                   endif
106280020228     c                   endif
106290060613     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
106300060613     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
106310060613     C     *IN79         IFEQ      *ON
106320060613     C     VIDDPD        ANDne     'D'
106330060613     C     A_§OGNTW      ANDNE     'DPD'
106340060613     C     WDESIE        ANDEQ     'E'
106350060613     C                   SETOFF                                       79
106360060613     C                   ENDIF
106370000120     c* Numero dpd
106380000120     c*  INSERIBILE SOLTANTO SE RICHIESTO IL SERVIZIO O LNA ESTERA DPD
106390060612     c*  o se import dpd
106400000120     C  N12
106410060612    1COR 15VIDNRD        IFne      *blanks
106420060613   1ac     *in79         ifeq      *off
106430000120    2C     COMLNA        IFEQ      0
106440000120     C     VIDDPD        ANDEQ     ' '
106450020201    2C     COMLNA        oreq      0
106460020201     C     VIDDPD        andeq     'F'
106470000121    2C     COMLNA        ORGT      0
106480020319     C     A_§OGNTW      ANDNE     'DPD'
106490060921     c
106500000120     C     DESLAD        OREQ      0
106510060921     c     desred        andeq     ' '
106520060921     c
106530060921     C     DESLAD        OREQ      0
106540060921     c     desred        andeq     'S'
106550060921     c     vidfbr        andne     'S'
106560000120     C                   MOVEL     ERR(184)      VIDMSG
106570000120     C                   SETON                                        4790
106580000120     C                   GOTO      ENDC01
106590000120    2C                   ENDIF
106600060612     c
106610000120     C* NON INSERIBILE SE NON ACCETTATTO DAL CTM
106620000120    2C     §1BF13        IFEQ      'A'
106630000120     C                   MOVEL     ERR(185)      VIDMSG
106640000120     C                   SETON                                        5790
106650000120     C                   GOTO      ENDC01
106660000120    2C                   ENDIF
106670060612   1aC                   ENDIF
106680000120     C* SE INSERITO, e no bolla reupero,  CONTROLLO IL CHK DIGITS
106690000308    2C     §3ARBL        IFNE      'R'
106700060612     C                   movel     VIDNRD        WNPR
106710000124     C                   EXSR      DPDVAL
106720000124     C   90              SETON                                        57
106730000124     C   90              GOTO      ENDC01
106740060613     c* per import effettuo subito il controllo per parcel doppio
106750060613     c                   if        *in79='1' and §1bfg8='S'
106760060613     c                   exsr      dpddop_imp
106770060613     C   90              SETON                                        57
106780060613     C   90              GOTO      ENDC01
106790060613     c                   endif
106800070326     c* per export imposto campo wparcel
106810070326     c                   if        *in79='0' and %subst(wnpr:14:1)=*blanks
106820070326     c                             and vidfbr<>'S'
106830070326     c                   eval      wparcel='12'
106840080612     c* in questo caso devo anche controllare che il chi sono inserito non
106850080612     c* sia doppio su fisgn
106860080612     c                   clear                   w8hcol
106870080612     c                   movel     wnpr          w8cnot
106880080612     c                   clear                   w08msg
106890080612     c                   eval      wnopos='1'
106900080612     c                   exsr      ctrchidop
106910080612     C                   MOVEL     w08msg        VIDMSG
106920080612     C   90              SETON                                        57
106930080612     C   90              GOTO      ENDC01
106940070326     c                   endif
106950060613     c
106960000120    2C                   ENDIF
106970000120     C*
106980000120   X1C                   ELSE
106990000120     C*
107000060613     c     *in79         ifeq      *on
107010060612     C     §3ARBL        ANDNE     'R'
107020060612     C                   MOVEL     ERR(186)      VIDMSG
107030060612     C                   SETON                                        5790
107040060612     C                   GOTO      ENDC01
107050060612     c                   endif
107060060612    2C     §1BF13        ifne      'A'
107070000308     C     §3ARBL        ANDNE     'R'
107080000121     C     WDESIE        ANDEQ     'E'
107090020204    3C     VIDDPD        IFEQ      'D'
107100020319     C     A_§OGNTW      OREQ      'DPD'
107110000120     C                   MOVEL     ERR(186)      VIDMSG
107120000120     C                   SETON                                        5790
107130000120     C                   GOTO      ENDC01
107140000120    3C                   ENDIF
107150000120    2C                   ENDIF
107160000120    1C                   ENDIF
107170960213     C***
107180960213     C*** FERMO DEPOSITO ERRATO
107190960213     C     VIDFFD        IFNE      'S'
107200010214     C     VIDFFD        ANDNE     'N'
107210010220     C     VIDFFD        ANDNE     ' '
107220960213     C                   MOVEL     ERR(123)      VIDMSG
107230960213     C                   SETON                                        5290
107240960213     C                   GOTO      ENDC01
107250960213     C                   ENDIF
107260940916     C***
107270940916     C*** FLAG INOLTRO: SE IMPOSTATO FORZARE CON CMD6
107280940909     C  NKF
107290940909     CANN15
107300940909     CAN 12
107310940909     CORNKF
107320940909     CANN12VIDFIN        IFNE      ' '
107330940907     C                   MOVEL     ERR(44)       VIDMSG
107340940923     C                   SETON                                        6990
107350940920     C                   GOTO      ENDC01
107360940909     C                   ENDIF
107370110818     c***
107380110901     c*** valore per accorpamento spedizioni in consegna:
107390110818     c*** errore bloccante se il cliente ha passato un valore non previsto
107400110818     c*   in tabella "xco"
107410110901     c***                if        *in12 and *in15 and werrxco=*on
107420110901     C***                SETON                                        90
107430110901     c***                eval      vidmsg=err(343)
107440110901     C***                GOTO      ENDC01
107450110901     c***                endif
107460110818     c*
107470031121      * Obbligatori se spedizione per supermercato
107480040213if  1c**!!!              If        wdisag = 'S'
107490040213if  2c**!!!              If        VidRef = *Blanks
107500040213     c**!!!              Eval      VidMsg = Err(267)
107510040213     c**!!!              z-add     20            H1riga
107520040213     c**!!!              z-add     21            H1colo
107530040213     c**!!!              Eval      *In90 = *On
107540040213     c**!!!              Eval      wemfor = '1'
107550040213     c**!!!              GoTo      EndC01
107560040213    2c**!!!              EndIf
107570040213if  2c**!!!              If        VidTel = *Blanks
107580040213     c**!!!              Eval      VidMsg = Err(267)
107590040213     c**!!!              z-add     20            H1riga
107600040213     c**!!!              z-add     64            H1colo
107610040213     c**!!!              Eval      *In90 = *On
107620040213     c**!!!              Eval      wemfor = '1'
107630040213     c**!!!              GoTo      EndC01
107640040213    2c**!!!              EndIf
107650040213    1c**!!!              EndIf
107660941003     C*
107670941003     C* IMPOSTO LA LOCALITA' DEL DESTINATARIO IN 2 VIDEATA
107680941003     C                   MOVEL     VIDLOD        V2CLOD
107690950123     C                   MOVEL     VIDRSD        V2CRSD
107700910125     C****
107710020917     C* CONTO QUANTI COLLI E QUANTI RECORD HO IN Fivad:
107720040618    1C***12§1BFG7        IFEQ      'S'
107730040618     c* in conferma
107740040618    1c                   if        (*in12 = *on and *in15 = *on
107750040618     c                             and §1bfg7 = 'S' and §1bf12 <> 'B')
107760040618     c* in manutenzione
107770040618     c                             or (*in12 = *on and *in15 = *off
107780040618     c                             and §1bfg7 = 'S')
107790940909     C  N15KBLP3         SETLL     FNBLD000
107800020917     C   15KBLC          SETLL     FIVAD000
107810940908     C* CONT  = NUMERO RECORD
107820910125     C                   Z-ADD     0             CONT
107830940908     C* CONT2 = NUMERO COLLI
107840910128     C                   Z-ADD     0             CONT2
107850940908     C*
107860940909     C  N15KBLP3         READE(N)  FNBLD000                               31
107870020917     C   15KBLC          READE(N)  FIVAD000                               31
107880950220     C*
107890950220    2C     *IN31         DOWEQ     *OFF
107900950220     C                   ADD       1             CONT              3 0
107910950220     C                   ADD       BLDNCL        CONT2             6 0
107920950220     C*
107930950220     C* SE E' DA DISK CLIENTI VEDO SE IL COLLO E' > 0
107940950220     C     *IN15         IFEQ      *ON
107950980410     C     §1BFG6        ANDEQ     'C'
107960950220     C     BLDNCD        ANDEQ     0
107970950220     C                   MOVEL     ERR(85)       VIDMSG
107980950220     C                   SETON                                        629031
107990950220    3C                   ENDIF
108000010313     C* SE E' DA DISK CLIENTI CONTROLLO CHE IL NUMERO COLLI SIA
108010010313     C* CORRETTO RISPETTO AL RANGE DAL/AL PASSATO
108020010313    3C     *IN15         IFEQ      *ON
108030010313     C     §1BFG6        ANDEQ     'C'
108040010313     C* CONTO IL NUMERO COLLI NEL RANGE DAL/AL
108050010313    4C     BLDNCA        IFEQ      *ZEROS
108060010313     C     BLDNCA        OREQ      BLDNCD
108070010313     C                   Z-ADD     1             WNCOL
108080010313   X4C                   ELSE
108090010313     C                   Z-ADD     BLDNCD        WNCOA
108100010313     C                   CLEAR                   WNCOL
108110010313    5C     WNCOA         DOWLE     BLDNCA
108120010313     C                   ADD       1             WNCOL
108130010313     C                   ADD       1             WNCOA
108140010313    5C                   ENDDO
108150010313    4C                   ENDIF
108160010313    4C     WNCOL         IFNE      BLDNCL
108170010313     C                   MOVEL     ERR(227)      VIDMSG
108180010313     C                   SETON                                        629031
108190010313    4C                   ENDIF
108200010313    3C                   ENDIF
108210950220     C*
108220950220     C  N15
108230950220     CANN31KBLP3         READE(N)  FNBLD000                               31
108240950220     C   15
108250020917     CANN31KBLC          READE(N)  FIVAD000                               31
108260940909    2C                   ENDDO
108270950220     C*
108280950220     C   90              GOTO      ENDC01
108290940908     C*
108300910225     C* SE NUMERO SEGNACOLLI DEL DETTAGLIO BOLLE NON E' UGUALE
108310910225     C*   AL NUMERO INDICATO SULLA BOLLA
108320050113     C     CONT2         ifne      V1CNCL
108330940908     C*
108340910225     C* IN DISK CLIENTI SEMPRE ERRORE
108350940909    3C     *IN15         IFEQ      *ON
108360940908     C* IN MANUTENZIONE BOLLE SOLO SE + DI UN RECORD
108370940908     C     *IN15         OREQ      *OFF
108380940908     C     CONT          ANDGT     1
108390940908     C                   MOVEL     ERR(87)       VIDMSG
108400940923     C                   SETON                                        6290
108410940920     C                   GOTO      ENDC01
108420940909    3C                   ENDIF
108430910225     C*
108440940909    2C                   ENDIF
108450910128     C*
108460940909    1C                   END
108470000413     C**
108480000413     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
108490000413     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
108500060613     c*  13/06/06 - Sposto questi controlli prima dei controlli su vidnrd
108510060613     C**   *IN79         IFEQ      *ON
108520060613     C**   VIDDPD        ANDne     'D'
108530060613     C***  A_§OGNTW      ANDNE     'DPD'
108540060613     C***  WDESIE        ANDEQ     'E'
108550060613     C***                SETOFF                                       79
108560060613     C***                ENDIF
108570940909     C*
108580160216     c* richiamo trul27r1 per sapere che cosa devo passare in FIE a fnlv59r
108590160216     c                   Clear                   Trul27Ds1
108600021120     c                   Exsr      TarCar
108610021120     c                   If        *In90
108620021120     c                   GoTo      EndC01
108630021120     c                   EndIf
108640080327     c
108650080327     c* Se tipo servizio tariffa <> da fnvab in conferma bolle, errore
108660080327     c*   se non utilizzabile in bollettazione
108670080327     c                   if        *in12 and *in15 and NOutiTSP='N'
108680080327     c                             and tamtsp<>vidtsp
108690080327     C                   MOVEL     ERR(130)      VIDMSG
108700080327     C                   SETON                                        4890
108710080327     C                   GOTO      ENDC01
108720080327     c                   endif
108730090609     c* controllo i limiti di colli e peso
108740090609     c
108750090609     c                   z-add     v1cncl        wncl
108760090609     c  n12              z-add     vidpkg        wpes
108770090609     c   12              clear                   wpes
108780090609     c                   clear                   wvol
108790090609     c                   eval      wvid='1'
108800160224     c                   exsr      sr_limtsp
108810090609     c                   if        *in90
108820090609     C                   MOVEL     wmsgtsp       VIDMSG
108830090609     C                   GOTO      ENDC01
108840090609     c                   endif
108850041011     c*
108860041011     c* Verifico se destinatario disagiato
108870041011     c* Per bolle poste non faccio niente
108880091210     c                   clear                   wdisag
108890091210     c  n12              clear                   w_ar5tcp
108900091210     c                   clear                   ddstflo
108910041012    1c     §ogntw        ifne      'PPT'
108920091210     c
108930091210     c                   clear                   tisit0ds
108940091210     c                   clear                   tisit0x1ds
108950091210     c                   movel     'E'           it0tla
108960091210     c                   movel     vidnzd        it0naz
108970091210     c                   movel     vidprd        it0prv
108980091210     c                   movel     vidcad        it0cap
108990091210     c                   movel     vidlod        it0loc
109000091210     c                   movel     vidind        it0ind
109010091210     c                   movel     vidrsd        it0rag
109020091210     c                   call      'TISIT5R'
109030091210     c                   parm                    tisit0ds
109040091210     c                   parm                    tisit0x1ds
109050041012    2c     ot0err        ifeq      *blanks
109060060113     c                   movel     ot0flo        ddstflo
109070060102   2ac                   if        ot0dos = 'A' or ot0dos = 'D' or
109080060102     c                             ot0dos = 'S'
109090041011     c                   movel     ot0dos        wdisag
109100041012    3c     wdisag        ifeq      'D'
109110041011     c                   movel     'X'           wdisag
109120041012    3c                   endif
109130060102   2ac                   endif
109140041011     c                   Eval      savdisag = wdisag
109150070924     c                   Eval      savpart = 'S'
109160041012   x2c                   else
109170041011     c                   clear                   wdisag
109180041012    2c                   endif
109190041012     c                   exsr      sr_imptc12
109200070924     c* propongo eventuali gg. di chiusura se previsti nei dest.particolari
109210070924     c                   exsr      sr_impgc12
109220041012    1c                   endif
109230040608     c*
109240040608      * --> Referente e Telefono del destinatario
109250040608      *     (messaggio forzabile)
109260150213      * Solo in immissione
109270150213    0c                   If        not *in12
109280040608      * Da indicare se
109290091209      * - Spedizione FedEx
109300040608      * - Spedizione a Privati
109310040608      * - Spedizione con Appuntamento
109320040608      * - Spedizione Export in c/assegno o in porto assegnato
109330040608      * -> Referente solo sped. Export
109340040608if  1c                   If        VidRef = *Blanks and wforza1 = *Off and
109350040608     c                             ((comlna > *Zeros and
109360040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
109370040608     c                             (comlna = *Zeros and wdesie = 'E'))
109380040608if  2c                   If        §3aFca > *Zeros
109390040608     c                   Eval      VidMsg = Err(36)
109400040608     c                   Eval      *In90 = *On
109410040608    2c                   EndIf
109420040608if  2c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
109430040608     c                   Eval      VidMsg = Err(54)
109440040608     c                   Eval      *In90 = *On
109450040608    2c                   EndIf
109460040608if  2c                   If        *In90
109470040608     c                   z-add     20            H1riga
109480040608     c                   z-add     21            H1colo
109490040608     c                   Eval      wforza1 = *On
109500040608     c                   GoTo      EndC01
109510040608    2c                   EndIf
109520040608    1c                   EndIf
109530040608      * -> Telefono
109540040608if  1c                   If        VidTel = *Blanks and wforza1 = *Off
109550040608s   2c                   Select
109560040608     c                   When      a_§OgNtw = 'FED' or viddpd = 'F'
109570040608     c                   Eval      VidMsg = Err(56)
109580040608     c                   Eval      *In90 = *On
109590040608     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
109600040608     c                   Eval      VidMsg = Err(267)
109610040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
109620040608     c                   Eval      *In90 = *On
109630170412     c***                When      %subst(VidGva:1:1) = 'P'
109640170412     c***                Eval      VidMsg = Err(58)
109650170412     c***                Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
109660170412     c***                Eval      *In90 = *On
109670040608     c                   When      (comlna > *Zeros and
109680040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
109690040608     c                             (comlna = *Zeros and wdesie = 'E')
109700040608if  3c                   If        §3aFca > *Zeros
109710040608     c                   Eval      VidMsg = Err(36)
109720040608     c                   Eval      *In90 = *On
109730040608    3c                   EndIf
109740040608if  3c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
109750040608     c                   Eval      VidMsg = Err(54)
109760040608     c                   Eval      *In90 = *On
109770040608    3c                   EndIf
109780040608    2c                   EndSl
109790040608if  2c                   If        *In90
109800040608     c                   z-add     20            H1riga
109810040608     c                   z-add     64            H1colo
109820040608     c                   Eval      wforza1 = *On
109830040608     c                   GoTo      EndC01
109840040608    2c                   EndIf
109850040608    1c                   EndIf
109860150213    0c                   EndIf
109870910220     C*
109880910220     C* VEDO SE SPROTEGGERE LA SERIE
109890950103     C*
109900950103     C     *IN12         IFEQ      *OFF
109910950103     C                   CLEAR                   VIDNRS
109920950103     C                   ENDIF
109930930624     C* PER DISK CLIENTI
109940940930    1C     *IN12         IFEQ      *ON
109950930624     C     *IN15         ANDEQ     *ON
109960930624     C* PER SPEDIZIONI DI RECUPERO
109970930624     C     *IN12         OREQ      *OFF
109980930624     C     *IN98         ANDEQ     *ON
109990930624     C* PER SPEDIZIONI DI CLIENTI CHE SI ASSEGNANO SOLO I NUMERI SEGNAC
110000930624     C     *IN12         OREQ      *OFF
110010980410     C     §1BFG6        ANDEQ     'C'
110020930624     C     §1BFG2        ANDEQ     'N'
110030930803     C* PER CLIENTI CON SERIE
110040930803     C     *IN12         OREQ      *ON
110050930803     C     *IN15         ANDEQ     *OFF
110060930803     C     VIDNRS        ANDGT     0
110070000225     C* PER CLIENTI DISK "C"
110080000225     C     *IN12         OREQ      *ON
110090000225     C     *IN15         ANDEQ     *OFF
110100000225     C     VIDSOP        ANDEQ     ':'
110110930624     C*
110120000911     C                   CLEAR                   DS3C
110130910311     C                   MOVEL     'N'           §3CFG1
110140921012     C                   MOVEL     ' '           §3CFSP
110150910220     C                   MOVEL     '3C'          COD
110160940921     C                   MOVEL(P)  WKSC          KEY
110170910220     C*
110180930708     C                   EXSR      CTABEL
110190910301     C  N30              MOVEL     TBLUNI        DS3C
110200100517     C* SE IL TERMINAL NON HA ANCHILOSATO, NON LO HA NEMMENO IL CLIENT
110210000204     C     WASDKC        IFNE      'S'
110220000204     C                   CLEAR                   §3CDKC
110230000204     C                   ENDIF
110240921006     C*
110250980805   1AC     *IN30         IFEQ      *OFF
110260980805     C     §3COKD        ANDEQ     '*'
110270980805    2C     *IN12         IFEQ      *OFF
110280921006     C     *IN98         ANDEQ     '1'
110290921006     C                   SETON                                        95
110300921006     C                   MOVEL     §3CNRS        VIDNRS
110310921006     C*
110320940930   X2C                   ELSE
110330921006     C*
110340940930    3C     §3CFG1        IFEQ      'S'
110350910220     C                   SETON                                        95
110360910426     C* SE FLAG6 DEL CLIENTE PROPONGO GIA' LA SERIE
110370940930    4C     §1BFG6        IFEQ      'C'
110380921006     C     VIDNRS        ANDEQ     0
110390910426     C                   MOVEL     §3CNRS        VIDNRS
110400940930    4C                   END
110410910426     C*
110420940930    3C                   END
110430940930    2C                   END
110440980805   1AC                   END
110450980805    1C                   END
110460940930     C*
110470080313      * verifico se cliente ha serie parziale
110480100517     c******             exsr      sr_parz
110490940930     C* PER DISK CLI TENGO QUELLO PASSATO SOLO SE :
110500940930     C*  ABILITATO DA DS DEL CLIENTE
110510940930     C*  ABILITATO IL COD TASSAZIONE ALLA FORZATURA
110520120712     c* ES 12/07/12 --> tolto non più usata da tempo questa forzatura
110530120712     C** 12
110540120712     C*N 15§3CFCT        IFEQ      'S'
110550120712     C**                 MOVEL     'CT'          COD
110560120712     C**                 MOVEL(P)  §LPCTS        KEY
110570940930     C*
110580120712     C**                 EXSR      CTABEL
110590120712     C**N30              MOVEL     TBLUNI        DSCT
110600120712     C**N30§CTFDK        IFEQ      'S'
110610120712     C**                 MOVEL     §LPCTS        SAVCTS
110620120712     C**                 ENDIF
110630120712     C**                 ENDIF
110640910805     C*
110650910805     C* PER DISK CLI SE FLAG 6 NON E' "C" AZZERO LA SERIE
110660910805     C   12
110670910805     CAN 15§1BFG6        IFNE      'C'
110680921019     C     §1BFG8        ANDNE     'N'
110690910805     C                   Z-ADD     0             VIDNRS
110700910805     C                   END
110710940930     C*
110720910410     C* PULIZIA CAMPI NUMERO SEGNACOLLI SE IMMISSIONE E STAMPA SEGNAC
110730910410     C* NELL'ORGANIZZAZIONE
110740910410     C  N12
110750910410     CAN 25              Z-ADD     0             VIDNCD
110760910410     C  N12
110770910410     CAN 25              Z-ADD     0             VIDNCA
110780910606     C* PER DISK CLI AZZERO SOLO SE NON SI ASSEGNA I NUMERI SEGNACOLLI
110790980410     C   12
110800980410     CAN 25
110810980410     CAN 15§1BFG6        IFNE      'C'
110820910606     C                   Z-ADD     0             VIDNCD
110830910606     C                   Z-ADD     0             VIDNCA
110840910607     C                   END
110850910808     C  N12
110860910808     COR 12
110870910808     CAN 15              MOVEL     *BLANKS       VIDFNS
110880910805     C* CONTROLLO SE NON SEQUENZIALI
110890960805     C   12
110900960805    1CAN 15§1BFG7        IFEQ      'S'
110910980410     C     §1BFG6        ANDEQ     'C'
110920920917     C*
110930020917     C     KBLC          SETLL     FIVAD000
110940020917     C     KBLC          READE(N)  FIVAD000                               30
110950960805    3C  N30BLDNCA        IFNE      0
110960941230     C                   Z-ADD     BLDNCA        COMSCD
110970920917     C                   ELSE
110980941230     C                   Z-ADD     BLDNCD        COMSCD
110990960805    3C                   ENDIF
111000941230     C                   Z-ADD     BLDNCD        VIDNCD
111010941230     C                   SUB       BLDNCL        COMSCD
111020910805     C*
111030960805    3C     *IN30         DOWEQ     *OFF
111040941230     C                   ADD       BLDNCL        COMSCD
111050960805    4C     BLDNCA        IFNE      0
111060960805    5C     COMSCD        IFNE      BLDNCA
111070920917     C                   SETON                                        30
111080960805    5C                   ENDIF
111090920917     C*
111100960805   X4C                   ELSE
111110920917     C*
111120960805    5C     COMSCD        IFNE      BLDNCD
111130910805     C                   SETON                                        30
111140960805    5C                   ENDIF
111150960805    4C                   ENDIF
111160920917     C*
111170920917     C   30              MOVEL     'S'           VIDFNS
111180020917     C  N30KBLC          READE(N)  FIVAD000                               30
111190960805    3C                   ENDDO
111200920917     C* NON SEQ.: AZZERO
111210960805    3C     VIDFNS        IFEQ      'S'
111220910805     C                   Z-ADD     0             VIDNCD
111230910805     C                   Z-ADD     0             VIDNCA
111240920917     C*
111250960805   X3C                   ELSE
111260920917     C* SEQ : IMPOSTO SEGNACOLLO AL
111270960805    4C     V1CNCL        IFGT      1
111280960805    5C     BLDNCA        IFNE      0
111290941230     C                   Z-ADD     BLDNCA        VIDNCA
111300960805   X5C                   ELSE
111310941230     C                   Z-ADD     BLDNCD        VIDNCA
111320960805    5C                   ENDIF
111330960805    4C                   ENDIF
111340960805    3C                   ENDIF
111350960805     C* MI SALVO I SEGNACOLLI DAL / AL CHE NON POSSONO ESSERE MODIFICAT
111360960805     C                   Z-ADD     VIDNCD        WNSNCD
111370960805     C                   Z-ADD     VIDNCA        WNSNCA
111380910805     C*
111390960805    1C                   ENDIF
111400961111     C***
111410961111     C*** SE BOLLA EXPORT CON C/A PROTEGGO TIPO INCASSO E DIVISA
111420961111     C***
111430121022     C     COMLNA        IFEQ      0
111440121022     C     WDESIE        ANDEQ     'E'
111450121022     C     COMLNA        ORGT      0
111460121022     c     A_§ogntw      andeq     'EEX'
111470121022     C     COMLNA        ORGT      0
111480121022     c     A_§ogntw      andeq     'FED'
111490121022     C     COMLNA        ORGT      0
111500121022     c     A_§ogntw      andeq     'DPD'
111510020319     c
111520121022     C     §3AFCA        IFGT      0
111530121022     C***                SETON                                        76
111540121022     C***                MOVEL     'BM'          VIDTIC
111550011108     C**         VIDVCA    IFEQ *BLANKS
111560011108     C* Con l'euro la divisa non sarà mai più a blank, quindi propongo
111570011108     C* la divisa della nazione del destinatario solo se importo C/A=0
111580050504     c* 04/05/05: Se divisa della nazione diversa da "EUR" o "USD"
111590050504     c* non propongo niente. Questo per evitare errori da parte del
111600050504     c* bollettista di indicazione della divisa sbagliata in particolar
111610050504     c* per le spedizioni dirette a paesi europei che hanno conservato
111620050504     c* la loro divisa (Svizzera, Danimarca...)
111630121022     C     VIDCAS        IFEQ      *ZEROS
111640121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
111650121022     C                   MOVEL     DESVLT        VIDVCA
111660121022     C                   MOVEL     DESVLT        VARVCA
111670121022     c                   else
111680121022     C                   clear                   VIDVCA
111690121022     C                   clear                   VARVCA
111700121022     c                   endif
111710121022     C                   ENDIF
111720980219     C**
111730121022     C                   ELSE
111740121022     C                   CLEAR                   VIDTIC
111750121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
111760121022     C                   MOVEL     DESVLT        VIDVCA
111770121022     C                   MOVEL     DESVLT        VARVCA
111780121022     c                   else
111790121022     C                   clear                   VIDVCA
111800121022     C                   clear                   VARVCA
111810121022     c                   endif
111820121022     C                   ENDIF
111830011108     C                   ELSE
111840011108     C* SE DESTINATARIO NON È EXPORT E IMPORTO CONTRASSEGNO = 0
111850011108     C* PROPONGO GEDCN
111860011108     C     VIDCAS        IFEQ      *ZEROS
111870011108     C                   MOVEL     §GEDCN        VIDVCA
111880011108     C                   MOVEL     §GEDCN        VARVCA
111890011108     C                   ENDIF
111900961111     C                   ENDIF
111910091210     c***
111920091210     C*** Richiamo routine per impostare eventuali forzature flag DDT
111930091210     c***
111940091210     c                   exsr      SR_FRZBAM
111950070326     c***
111960070326     C* IMPOSTO LNA DPD SE NON 'C'E'
111970070326    1C     VIDDPD        IFEQ      'D'
111980070326     C     WDESIE        ANDEQ     'E'
111990070326     C     A_§OGNTW      OREQ      'DPD'
112000160302     c**** w_aDpd        oreq      'S'
112010070326    2C     VIDLNA        IFLE      *ZEROS
112020070326     C     DESLAD        ANDGT     0
112030070326     C                   Z-ADD     DESLAD        COMLNA
112040070326    2C                   ENDIF
112050070326    1C                   ENDIF
112060070326     C* SE NUMERO AUTOMATICO, LO PRELEVO
112070070326     c* 22/03/07: Prelevo quello automatico anche nel caso di inserimen
112080070326     c* to numero parcel lungo 12 in quanto dal 01/04/07 non saranno
112090070326     c* più gestiti da DPD
112100070326     C  N12
112110070326    1COR 15VIDDPD        IFEQ      'D'
112120070326     C     WDESIE        ANDEQ     'E'
112130070326     C     A_§OGNTW      OREQ      'DPD'
112140160224     c     w_ADpd        oreq      'S'
112150070326    2c                   if        Comnrd=0 and (§1bf13='A' or
112160160225     c                             wparcel='12' or w_aDpd='S')
112170070515    3c****               if        dateu >= §vpodpd
112180070326     c                   clear                   trul33ds
112190070326     c                   z-add     25            i33cnu
112200070326     c                   z-add     1             i33num
112210070326     c                   movel     trul33ds      kpjbu
112220070326     c                   call      'TRUL33R'
112230070326     c                   PARM                    kpjba
112240070326     c                   movel     kpjbu         trul33ds
112250070326    4c     o33err        ifgt      *zeros
112260070326     c                   seton                                        90
112270070326    5c                   select
112280070326     c     o33err        wheneq    1
112290070326     c                   movel     err(300)      vidmsg
112300070326     c     o33err        wheneq    2
112310070326     c                   movel     err(301)      vidmsg
112320070326     c     o33err        wheneq    3
112330070326     c                   movel     err(302)      vidmsg
112340070326    5c                   endsl
112350070326     c                   goto      endc01
112360070326    4c                   endif
112370070326     c                   z-add     o33nri        comnrd
112380070515   x3c****               else
112390070515     C**** KTBE          CHAIN     TNTBE02L                           30
112400070326     C* E NON C'E' LO CREO
112410070515     C***30              CLEAR                   TNTBE000
112420070515     C***30              CLEAR                   DCHI
112430070515     C**N30              MOVEL     TBEUNI        DCHI
112440070515     C***                ADD       1             §CHINM
112450070515     C***                MOVEL     DCHI          TBEUNI
112460070515    3C***  *IN30         IFEQ      *OFF
112470070515     C***                UPDATE    TNTBE000
112480070515     C***                ELSE
112490070515     C***                MOVEL     KTCOD         TBECOD
112500070515     C***                MOVEL     KTLIN         TBELIN
112510070515     C***                MOVEL     KTSIF         TBESIF
112520070515     C***                MOVEL     KTKE1         TBEKE1
112530070515     C***                MOVEL     KTKE2         TBEKE2
112540070515     C***                MOVEL     'DP'          TBEKE2
112550070515     C***                WRITE     TNTBE000
112560070515    3C***                ENDIF
112570070515     C***                CLEAR                   DPDBRC
112580070515     C***                MOVEL     §CHINM        DPDBRC
112590070515     C***                CLEAR                   DPDCHD
112600070515     C***                EXSR      M1031
112610070515     C***                z-add     DPDBRC        COMNRD
112620070515    3c***                endif
112630070326    2c                   endif
112640070326    1c                   endif
112650070326     c* Impostazione numero parcel dpd: se attribuzione automatica o
112660070326     c* numero parcel lungo 12 coincide con numero preso da numeratore
112670070326     c* altrimenti è quello immesso a video
112680070326    1c                   if        (*in12='0' or *in15=*on) and
112690070326     c                             ((viddpd='D' and wdesie='E') or
112700160225     c                             A_§ogntw='DPD' or W_aDpd='S')
112710160225     c                             and (§1bf13='A' or wparcel='12' or
112720160225     c                             W_aDpd='S')
112730070515    2c***                if        dateu >= §vpodpd
112740070326     c                   move      comnrd        v7cnpr
112750070515   x2c***                else
112760070326     c** parcel lungo 12
112770070515     c***                z-add     comnrd        w0120            12 0
112780070515     C***                movel     w0120         V7CNPR
112790070515    2c***                endif
112800070326     c* se sono in bollettazione (no conferma bolle) non propongo più
112810070326     c* numero parcel dpd nel RMN
112820070326    2C   15VIDRMN        IFEQ      0
112830070326     C                   z-add     COMNRD        VIDRMN
112840070326    2C                   ENDIF
112850070326   x1c                   else
112860070326    2c                   if        (*in12='0' or *in15=*on) and
112870070326     c                             vidnrd<>*blanks
112880070326     c* se numero dpd numerico lo propongo nel rif.mittente come segue:
112890070326     c* - Se spedizione export --> solo in conferma bolle da cliente
112900070326     c* - Se spedizione import --> sempre
112910070326     c* se numero dpd alfanumerico e spedizione import imposto 1 in rmn
112920070326     c* Numero parcel dpd numerico
112930070326    3c                   if        wsolo_num=*blanks
112940070326     c* export
112950070326    4c                   if        (*in15=*on and *in79=*off
112960070326     c                             and vidrmn=0)
112970070326     c* import
112980070326     c                             or (*in79='1')
112990070326     c                   clear                   vidrmn
113000070326    5c                   if        %subst(vidnrd:14:1) <> *blanks
113010070326     C                   move      VIDNRD        VIDRMN
113020070326     c                   else
113030070326     c                   eval      w012a=%subst(vidnrd:1:12)
113040070326     c                   move      w012A         vidrmn
113050070326    5c                   endif
113060070326    4C                   ENDIF
113070070326   x3c                   else
113080070326     c* Numero parcel dpd alfanumerico
113090070326    4c                   if        *in79='1'
113100070326     c                   z-add     1             vidrmn
113110070326    4c                   endif
113120070326    3c                   endif
113130070326     C                   movel     VIDNRD        V7CNPR
113140070326    2c                   endif
113150070326    1c                   endif
113160000623     C***
113170000623     C* CONTROLLO SE ESISTE LA DS3Q PER IL CIENE MITTENTE
113180970326     C***
113190000623     C                   CLEAR                   WES3Q
113200000623     C                   MOVEL     '3Q'          COD
113210000623     C                   MOVEL(P)  WKSC          KEY
113220000623     C*
113230000623     C                   EXSR      CTABEL
113240000623     C  N30              MOVEL     'S'           WES3Q             1
113250000623     C   30              MOVEL     ' '           WES3Q             1
113260011112     C***
113270011112     C* DIVISA IMPORTO DA ASSICURARE: PROPONGO DIVISA NAZIONE MITTENTE
113280011112     C*        SE ESTERO ALTIMENTI PROPONGO §GEDCN
113290011112     C***
113300011112     C     VIDIAS        IFEQ      *ZEROS
113310011112     C     MITVLT        IFNE      *BLANKS
113320011112     C     WMITIE        ANDEQ     'E'
113330011112     C                   MOVEL     MITVLT        VIDVAS
113340011112     C                   MOVEL     MITVLT        VARVAS
113350011112     C                   ELSE
113360011112     C                   MOVEL     §GEDCN        VIDVAS
113370011112     C                   MOVEL     §GEDCN        VARVAS
113380011112     C                   ENDIF
113390011112     C                   ENDIF
113400011113     C***
113410011113     C* DIVISA VALORE MERCE DICHIAR.: PROPONGO DIVISA NAZIONE MITTENTE
113420011113     C*        SE ESTERO, ALTIMENTI PROPONGO §GEDCN
113430011113     C***
113440011113     C     VIDVMD        IFEQ      *ZEROS
113450011115     C     MITVLT        IFNE      *BLANKS
113460011113     C     WMITIE        ANDEQ     'E'
113470011113     C                   MOVEL     MITVLT        VIDVAD
113480011113     C                   MOVEL     MITVLT        VARVAD
113490011113     C                   ELSE
113500011113     C                   MOVEL     §GEDCN        VIDVAD
113510011113     C                   MOVEL     §GEDCN        VARVAD
113520011113     C                   ENDIF
113530011115     C                   ENDIF
113540000120     C***
113550940920     C     ENDC01        TAG
113560940909     C   90              MOVEL     '1'           WEMFOR
113570940909     C                   ENDSR
113580940224     C*
113590940921     C* RICERCA E CARICAMENTO A VIDEO TARIFFE ------------------------*
113600940224     C     RICTAR        BEGSR
113610940921     C                   SETOFF                                       30
113620941221     C                   CLEAR                   WTACAR
113630941221     C                   CLEAR                   WTKS
113640991026     C                   CLEAR                   COMDIV
113650940921     C*
113660940921     C* PER DISK CLI PRENDO SEMPRE LA TARIFFA DEL CLIENTE
113670940921    1C     *IN12         IFEQ      *ON
113680940921     C     *IN15         ANDEQ     *ON
113690940921     C                   MOVEL     §LPCTR        VIDCTR
113700050921     C                   MOVEL     §LPCTR        ilv59ctr
113710050921     C                   MOVEL     'S'           ilv59ric
113720940921     C*
113730940921   X1C                   ELSE
113740010223     C*
113750130404     c* 1) caso IMISSIONE
113760130404     c* 2) caso manutenzione con ricaricamento tariffe
113770010223    2C  N29WORM          IFEQ      'S'
113780010223     C     FLGFIT        ANDNE     'S'
113790010223     C     PARTCH        ANDNE     'P'
113800050921     C     ilv59ric      ANDEQ     'S'
113810010223    3C     *IN12         IFEQ      *OFF
113820010223     C     *IN15         OREQ      *OFF
113830010223     C     WORMMD        ANDEQ     '1'
113840030905    4c                   If        §OrPfb <> 'A'
113850010223     C                   MOVE      VIDCCM        W0070             7 0
113860010223    5C     VIDFLC        IFEQ      *ZEROS
113870010223     C                   MOVEL     VIDLNP        W0070
113880010223     C                   ELSE
113890010223     C                   MOVEL     VIDFLC        W0070
113900010223    5C                   ENDIF
113910010223    5C     W0070         IFEQ      ORMKSC
113920010223     C     ORMCTR        ANDNE     *BLANKS
113930010223     C                   MOVE      ORMCTR        VIDCTR
113940010223     C                   MOVE      ORMCTR        PRECTR
113950050921     C                   MOVE      ORMCTR        ilv59ctr
113960010223    5C                   ENDIF
113970010223    4C                   ENDIF
113980010223    3C                   ENDIF
113990010223    2C                   ENDIF
114000130404     c*
114010130404     c* 3) caso manutenzione solo con  cambio ORM
114020130404    2C  N29WORM          IFEQ      'S'
114030130404     C     FLGFIT        ANDNE     'S'
114040130404     C     PARTCH        ANDNE     'P'
114050130404     C     ilv59ric      ANDEQ     ' '
114060130404     C     *IN12         andeq     *On
114070130404     C     *IN15         andeq     *OFF
114080130404     C     WORMMD        ANDEQ     '1'
114090130404     C     ORMCTR        ANDNE     *BLANKS
114100130404    4c                   If        §OrPfb <> 'A'
114110130404     C                   MOVE      VIDCCM        W0070             7 0
114120130404    5C     VIDFLC        IFEQ      *ZEROS
114130130404     C                   MOVEL     VIDLNP        W0070
114140130404     C                   ELSE
114150130404     C                   MOVEL     VIDFLC        W0070
114160130404    5C                   ENDIF
114170130404    5C     W0070         IFEQ      ORMKSC
114180130404     c                   if        ormctr<>vidctr
114190130404     c                   eval      CambiaCTR='S'
114200130404     c                   endif
114210130404     C                   MOVE      ORMCTR        VIDCTR
114220130404     C                   MOVE      ORMCTR        PRECTR
114230130404     C                   MOVE      ORMCTR        ilv59ctr
114240130404    5C                   ENDIF
114250130404    4C                   ENDIF
114260130404    2C                   ENDIF
114270940921     C*
114280940224     C* PER : IMMISSIONE (SE NON PERSONALIZZATO IL COD TARIFFA)
114290940921     C*       E MANUTENZIONE BOLLE
114300941107    2C     *IN29         IFEQ      *ON
114310941231     C* SE NON LO DEVO RICARICARE, IMPOSTO IL CODICE TARIFFA
114320050921     C     ilv59ric      ORNE      'S'
114330050921     C                   MOVEL     VIDCTR        ilv59ctr
114340941107    2C                   ENDIF
114350941107    1C                   ENDIF
114360950525     C* SE VIDCTR = '   ' E' COME SE LO DOVESSI RICARICARE
114370950525     C     VIDCTR        IFEQ      *BLANKS
114380050921     C                   MOVEL     'S'           ilv59ric
114390950525     C                   ENDIF
114400150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
114410150415     c* accetto anche tariffe bloccate
114420150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
114430150415     c                              and §3arbl='R' and §lpimv>0)
114440150415     C                   EVAL      ILV59blo='S'
114450150415     C                   ENDIF
114460941107     C*
114470941107     C* SE ESISTONO TARIFFE PER IL CLIENTE CERCO
114480050921     C                   MOVEL     'P'           ilv59tbo
114490040512      * se bolla monovaria pulisco il tipo bolla
114500040512     C                   IF        §3ASVA <> *BLANK
114510050921     C                   CLEAR                   ilv59tbo
114520050921     c                   movel     'P'           ilv59prp
114530040512     C                   ENDIF
114540040512
114550050921     C                   MOVEL     WKSC          ilv59ksc
114560050921     C                   MOVEL     KCI           ilv59kci
114570050921     C                   MOVEL     BLPDSP        ilv59dsp
114580050921     C                   MOVEL     VIDTSP        ilv59tsp
114590160216     C                   MOVEL     WFIE          ilv59fie
114600160216     c                   clear                   ilv59ta3
114610160216     c                   select
114620160216     c     viddpd        wheneq    'D'
114630160216     c     wdesie        andeq     'E'
114640160222     c     a_§ogntw      oreq      'DPD'
114650160216     c                   movel     'D'           ilv59ta3
114660160216     c     viddpd        wheneq    'F'
114670160216     c     wdesie        andeq     'E'
114680160222     c     a_§ogntw      oreq      'FED'
114690160216     c                   movel     'F'           ilv59ta3
114700160216     c     viddpd        wheneq    ' '
114710160216     c     wdesie        andeq     'E'
114720160222     c     a_§ogntw      oreq      'EEX'
114730160216     c                   movel     'E'           ilv59ta3
114740160216     c                   other
114750160216     c                   movel     'I'           ilv59ta3
114760160216     c                   endsl
114770050921     C                   CALL      'FNLV59R'
114780050921     C                   PARM                    fnlv59ds
114790160428
114800160428     c                   if        ilv59ric=' ' and ilv59con=' ' and
114810160428     c                             ilv59ta4='S' and ilv59ctr<>olv59ctr
114820160428     c                   eval      ilv59ric='S'
114830160428     c                   endif
114840900528     C*
114850050922     c* se avevo richiamato con CON e RIC vuoti il cod.tariffa non
114860050922     c* viene impostato. Quindi in questo caso non imposto vidctr
114870050922     c* Avrei potuto condizionare il richiamo di fnlv59r da con e/o ric
114880050922     c* pieni ma in questo caso mi si poneva il problema dell'impostazi
114890050922     c* one di wtacar, wtks e comdiv in caso di manutenzione.
114900050922     c                   if        ilv59ric <> ' ' or ilv59con <> ' '
114910080403     c*
114920080326     c                   if        olv59ctr<>vidctr
114930080326     c                   eval      CambiaCTR='S'
114940160428     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
114950160428     c* mettere in RI i campi presi da tariffa per avvisare della variazione
114960160428     c                   if        *in12 and not *in15
114970160428     c                   seton                                        97
114980160428     c     atrbva        ifne      prri
114990160428     c                   movel     riul          atrbva
115000160428     c                   endif
115010160428     c                   endif
115020080326     c                   endif
115030080326     c
115040050921     C                   MOVEL     olv59ctr      VIDCTR
115050050921     C                   MOVEL     olv59dfs      DEFCTR
115060050922     c                   endif
115070941221     C*
115080941221     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDO SEMPRE DATI DAL
115090941221     C* LA TARIFFA DI CARTELLO
115100050921     C     olv59tks      IFEQ      ' '
115110941221     C                   MOVEL     'S'           WTACAR            1
115120950410     C                   CLEAR                   UND
115130950410     C* SOLO SE LA DEVO RICARICARE LA AZZERO
115140050921     C  N29ilv59ric      IFEQ      'S'
115150941221     C                   MOVEL     *ZEROS        VIDCTR
115160021120      * Per bolla FedEx imposto il codice tariffa della cartello FedEx
115170021120     c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
115180160219     c***                Movel     O27Ctr        VidCtr
115190160219     c                   clear                   trulc7ds
115200160222     c                   eval      IC7tFIE =  'F'
115210160219     c                   eval      IC7DTA  =  blpdsp
115220160219     c                   eval      IC7PKG  =  vidpkg
115230160219     c                   eval      IC7tip  =  i27tip
115240160219     c                   call      'TRULC7R'
115250160219     c                   parm                    trulc7ds
115260160219     c                   Movel     Oc7Ctrc       VidCtr
115270021120     c                   EndIf
115280950410     C                   ENDIF
115290941221     C                   ENDIF
115300950410     C*
115310050921     C                   MOVEL     olv59tks      WTKS
115320941231     C* SE HO RICERCATO LA TARIFFA RICARICO IL PRG ALTRIMENTI
115330941231     C*  LO PULISCO
115340050921     C     ilv59ric      IFEQ      'S'
115350150424     C     ilv59con      oreq      'S'
115360150424     C     olv59err      ifeq      ' '
115370050921     C     olv59tks      ANDEQ     'S'
115380050921     C                   MOVEL     olv59prg      COMPRG
115390941231     C                   ENDIF
115400150424     C                   ENDIF
115410950103     C*
115420050921     C     olv59err      IFNE      ' '
115430050921     C     olv59tks      ORNE      'S'
115440941231     C                   Z-ADD     0             COMPRG
115450941231     C                   ENDIF
115460940921     C*
115470940921     C* SE LA TARIFFA E' FRA QUELLE TROVATE, CARICO GLI ALTRI DATI DEL
115480941110     C* ALTRIMENTI LI PRENDO SEMPRE DALLA TARIFFA DI CARTELLO
115490050921     C     ilv59ric      IFEQ      'S'
115500150424     c     CambiaCTR     oreq      'S'
115510940922     C                   EXSR      CTNTAM
115520010223     C*
115530950103     C                   ENDIF
115540941107     C*
115550941107     C* IMPOSTO I CAMPI DEI CODICI TARIFFA A VIDEO
115560050921     C                   MOVEL     olv59ct2      VIDCT2
115570050921     C                   MOVEL     olv59ct3      VIDCT3
115580050921     C                   MOVEL     olv59ct4      VIDCT4
115590050921     C                   MOVEL     olv59ct5      VIDCT5
115600050921     C                   MOVEL     olv59es2      VIDES2
115610050921     C                   MOVEL     olv59es3      VIDES3
115620050921     C                   MOVEL     olv59es4      VIDES4
115630050921     C                   MOVEL     olv59es5      VIDES5
115640940921     C*
115650940922     C* OGNI VOLTA CHE MODIFICATO IL COD MITTENTE, PER CUI RICARICO
115660940922     C*  LE TARIFFE, IMPOSTO "SAVCTR" CON QUELLO PROPOSTO
115670940922     C*  IN QUANTO I CAMPI LI HO PROPOSTI A VIDEO
115680940922     C                   MOVEL     VIDCTR        SAVCTR
115690930803     C                   SETOFF                                       30
115700900504     C                   ENDSR
115710940922     C*
115720940922     C* CHAIN SU TNTAM00F PER PRENDERE I CAMPI DA PROPORRE -----------*
115730940922     C     CTNTAM        BEGSR
115740941221     C                   SETOFF                                       30
115750010226     C                   CLEAR                   WNNTAR
115760010226     C                   CLEAR                   WN1TAR
115770050926     C                   CLEAR                   fvol              1
115780941231     C*
115790941231    1C     WTACAR        IFEQ      ' '
115800941231     C* ERRORE: NON TROVATA PROGRESSIVO COL CODICE TARIFFA
115810941231     C* IMPOSTATO
115820050921    2C     olv59err      IFNE      ' '
115830941221     C                   SETON                                        30
115840941221     C                   ELSE
115850941231     C                   MOVEL     VIDCTR        COMCTR
115860941231     C**
115870940922     C     KTAM2         CHAIN     TNTAM000                           30
115880110304     c
115890941231    2C                   ENDIF
115900941221     C*
115910941231   X1C                   ELSE
115920941221     C* TARIFFA DI CARTELLO
115930160216     c                   clear                   trulc7ds
115940160224     c                   select
115950160226     c                   when      o27ntw='DPD' or w_aDpd='S'
115960160224     c                   eval      IC7tFIE = 'D'
115970160224     c                   when      o27ntw='FED'
115980160224     c                   eval      IC7tFIE = 'F'
115990160224     c                   when      o27ntw='EEX'
116000160224     c                   eval      IC7tFIE = 'E'
116010160224     c                   other
116020160224     c                   eval      IC7tFIE = 'I'
116030160224     c                   endsl
116040160216     c                   eval      IC7DTA  =  blpdsp
116050160216     c                   eval      IC7CTB  =  vidctr
116060160216     c                   eval      IC7PKG  =  vidpkg
116070160219     c                   eval      IC7tip  =  i27tip
116080160216     c                   call      'TRULC7R'
116090160216     c                   parm                    trulc7ds
116100160219     c                   clear                   oc7prgc_
116110160219     c                   if        oc7prgc<>*blanks
116120160219     c                   movel     oc7prgc       oc7prgc_
116130160219     c                   endif
116140160216     c
116150160216     c
116160941107     C     KCAR2         CHAIN     TNTAM000                           30
116170941231    1C                   ENDIF
116180941221     C  N30              MOVEL     TAMDCV        DEVCTR
116190040610     C  N30              MOVEL     TAMflo        dsta01
116200961203     C* PRENDO TASSAZIONE TARIFFA MITT SOLO SE NON PROVENGO DA
116210961203     C*  GIACENZE PERCHE' IN DIROTTAMENTO NON HO PIU' LE TARIFFE
116220961203     C*  ORIGINALI
116230961203     C  N30
116240961203     CANN87              MOVEL     TAMFTM        SAVFTM
116250941221     C   30              CLEAR                   DEVCTR
116260941221     C   30              CLEAR                   SAVFTM
116270940922     C*
116280940922     C* PER DISK CLIENTI
116290940922     C* I CAMPI LI PRENDO SOLO SE SONO VUOTI
116300940922     C* PER IL RESTO       SEMPRE
116310941231    1C     *IN12         IFEQ      *ON
116320940922     C     *IN15         ANDEQ     *ON
116330970328     C*
116340970328     C  N30§LPBAM        IFEQ      ' '
116350970328     C                   MOVEL     TAMBAM        VIDBAM
116360970328     C                   ENDIF
116370940922     C*
116380941231    2C     §LPNAS        IFEQ      *BLANKS
116390941221     C  N30              MOVEL     TAMNAS        VIDNAS
116400030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
116410030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
116420030409     c                             and Not *In30
116430030409     c                   Clear                   VidNas
116440030409     c                   EndIf
116450941221     C   30              CLEAR                   VIDNAS
116460941231    2C                   ENDIF
116470040610     c* Tipo merce: V-Valore
116480040610     C  N30§lpbva        IFEQ      ' '
116490040610     c     §1bfg8        andne     'N'
116500040610     C                   MOVEL     §tabva        VIDbva
116510040610     C                   ENDIF
116520040610     c*
116530941231    2C     §LPNOT        IFEQ      *BLANKS
116540941221     C  N30              MOVEL     TAMNOT        VIDNT1
116550941221     C   30              CLEAR                   VIDNT1
116560941231   X2C                   ELSE
116570941231    3C     §LPNT2        IFEQ      *BLANKS
116580941221     C  N30              MOVEL     TAMNOT        VIDNT2
116590941221     C   30              CLEAR                   VIDNT2
116600941231    3C                   ENDIF
116610941231    2C                   ENDIF
116620940922     C*§
116630940922     C* GESTIONE PARTIC.C/A SOLO SE BOLLA CON C/A
116640941231    2C     §3AFCA        IFNE      0
116650940922     C     §LPGCA        ANDEQ     *BLANKS
116660940922     C     §3AFCA        ANDNE     0
116670941221     C  N30              MOVEL     TAMGCA        VIDGCA
116680941221     C   30              CLEAR                   VIDGCA
116690941231    2C                   ENDIF
116700941231    2C     §LPGGA        IFEQ      *BLANKS
116710941221     C  N30              MOVEL     TAMGGA        VIDGGA
116720941221     C   30              CLEAR                   VIDGGA
116730941231    2C                   ENDIF
116740941231    2C     §LPGMA        IFEQ      *BLANKS
116750160509     c     §3arbl        andne     'R'
116760100215     C  N30              MOVEL     TAMGMA        VIDGMA
116770941221     C   30              CLEAR                   VIDGMA
116780941231    2C                   ENDIF
116790941231    2C     §LPGVA        IFEQ      *BLANKS
116800941221     C  N30              MOVEL     TAMGVA        VIDGVA
116810941221     C   30              CLEAR                   VIDGVA
116820941231    2C                   ENDIF
116830940922     C*
116840941231   X1C                   ELSE
116850010226     C*
116860010226     C* NATURA MERCE
116870010226     C* SE NON E' STATA PERSONALIZZATA ED E' ATTIVATA PROCEDURA ORM
116880010226     C* DEVO PROPORRE LA NATURA MERCE DELL'ORM SE PRESENTE E NON
116890010226     C* QUELLA DA TARIFFA.
116900010226     C* IDEM PER LE NOTE
116910011221     C                   MOVEL     ORMNAM        W015A
116920150424    3C*    WORM          IFEQ      'S'
116930150424     C*    FLGFIT        ANDNE     'S'
116940150424     C*    PARTCH        ANDNE     'P'
116950150424     C*    ilv59ric      ANDEQ     'S'
116960150424    3c                   if        worm='S' and flgfit<>'S' and partch<>'P'
116970150424     c                             and (ilv59ric='S' or CambiaCTR='S')
116980010226     C     *IN27         IFEQ      *OFF
116990011221     C     W015A         ANDNE     *BLANKS
117000010226     C                   MOVEL     ORMNAM        VIDNAS
117010010226     C                   MOVEL     '1'           WNNTAR            1
117020010226     C                   ENDIF
117030010404     C* NOTE SE PESO > 50 Q.LI  O SE O.R.M COMMISSIONATO
117040010307    4C                   SELECT
117050010307     C     §LPFPR        WHENEQ    'O'
117060050211     C***  ORMPOE        ORNE      ORMPOR
117070080326     c                   if        vidnt1=*blanks
117080010307     C                   MOVEL     WTELRF        VIDNT1
117090080326     c                   else
117100080326     c                   if        vidnt2=*blanks
117110080326     C                   MOVEL     WTELRF        VIDNT2
117120080326     c                   endif
117130080326     c                   endif
117140080326     c
117150010307     C                   MOVEL     '1'           WN1TAR
117160010409     C     VIDPKG        WHENGE    §DFMAX
117170010226    5C     ORMNO1        IFNE      *BLANKS
117180080326     c                   if        vidnt1=*blanks
117190010226     C                   MOVEL     ORMNO1        VIDNT1
117200080326     c                   else
117210080326     c                   if        vidnt2=*blanks
117220150427     c                             and ormno1<>vidnt1
117230080326     C                   MOVEL     ORMNO1        VIDNT2
117240080326     c                   endif
117250080326     c                   endif
117260010226     C                   MOVEL     '1'           WN1TAR            1
117270010226    5C                   ENDIF
117280010307    4C                   ENDSL
117290010226    3C                   ENDIF
117300941231     C*
117310941231    3C     *IN30         IFEQ      *OFF
117320080326   3ac                   if        CambiaCTR='S'
117330080326     c
117340080326    4C     WNNTAR        IFEQ      *BLANKS
117350080326     c* solo se ho modificato la tariffa
117360941231     C  N27              MOVEL     TAMNAS        VIDNAS
117370030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
117380160411    5c                   If        (VidDpd = 'F' or a_§OgNtw = 'FED')
117390030409     c                             and Not *In27
117400030409     c                   Clear                   VidNas
117410080326    5c                   EndIf
117420080326    4C                   ENDIF
117430080326    4C     WN1TAR        IFEQ      *BLANKS
117440080326     c* In manutenzione solo se sono vuote
117450080326    5c     vidnt1        ifeq      *blanks
117460110304     c     vidnt1        oreq      savnot
117470940922     C                   MOVEL     TAMNOT        VIDNT1
117480110304     c                   movel     tamnot        savnot
117490080326     c                   else
117500080326    6c     vidnt2        ifeq      *blanks
117510110304     c     vidnt2        oreq      savnot
117520080326     C                   MOVEL     TAMNOT        VIDNT2
117530110304     c                   movel     tamnot        savnot
117540080326    6c                   endif
117550080326    5c                   endif
117560080326     c
117570080326    4C                   ENDIF
117580080326     c
117590080326    4c     atrbva        ifne      prri
117600040610     c     §1bfg8        andne     'N'
117610040610     c                   movel     §tabva        vidbva
117620080326    4c                   endif
117630941231    4C     §3AFCA        IFNE      0
117640940922     C                   MOVEL     TAMGCA        VIDGCA
117650941231    4C                   ENDIF
117660940922     C                   MOVEL     TAMGGA        VIDGGA
117670160509     c                   if        §3arbl<>'R'
117680940922     C                   MOVEL     TAMGMA        VIDGMA
117690160509     c                   endif
117700940922     C                   MOVEL     TAMGVA        VIDGVA
117710970128     C                   MOVEL     TAMBAM        VIDBAM
117720080326   3ac                   endif
117730080326     c
117740941231   X3C                   ELSE
117750941221     C*
117760941221     C* PULISCO I CAMPI CHE PRENDO DA TARIFFA
117770010226     C     WNNTAR        IFEQ      *BLANKS
117780941221     C  N27              CLEAR                   VIDNAS
117790010226     C                   ENDIF
117800080326   3ac                   if        CambiaCTR='S'
117810080326     C**   WN1TAR        IFEQ      *BLANKS
117820080326     C**                 CLEAR                   VIDNT1
117830080326     C**                 ENDIF
117840040610     c                   clear                   vidbva
117850941221     C                   CLEAR                   VIDGCA
117860941221     C                   CLEAR                   VIDGGA
117870941221     C                   CLEAR                   VIDGMA
117880941221     C                   CLEAR                   VIDGVA
117890970128     C                   MOVEL     'N'           VIDBAM
117900080326   3aC                   ENDIF
117910080326    3C                   ENDIF
117920010226     C*
117930941231    1C                   ENDIF
117940940922     C*
117950950125     C* IN MANUTENZIONE SE CAMBIANO CLIENTE, CAMBIO SEMPRE
117960950125     C*     IL TIPO SERVIZIO a meno che non sia stato inserito
117970950125     C*
117980950125     C* IN IMMISSIONE TIPO SERVIZIO LO PRENDO SOLO SE NON IMMESSO
117990150424    1C*    VIDTSP        IFEQ      ' '
118000950125     C*
118010150424     C*    *IN12         OREQ      *ON
118020150424     C*    *IN15         ANDEQ     *OFF
118030150424     C*    VIDTSP        ANDEQ     BLPTSP
118040150424     C*    TAMTSP        ANDNE     BLPTSP
118050150424     C*    ilv59ric      ANDEQ     'S'
118060150424     C*    DOD           ANDEQ     0
118070150424     c*    wesore        andne     'S'
118080100330     c
118090150424     c*    wesore        andne     'S'
118100150424     c                   if        vidtsp=' ' or
118110150424     c                             (*in12 and not *in15 and
118120150424     c                             vidtsp=blptsp and tamtsp<>blptsp and
118130150424     c                             (ilv59ric='S' or CambiaCtr='S') and DOD=0
118140150424     c                             and wesore<>'S')
118150941110     C* DECODIFICO
118160941110     C                   Z-ADD     1             C                 3 0
118170941110     C     TAMTSP        LOOKUP    TSP(C)                                 30
118180090604     C**!30              MOVEL     DTS(C)        V2DTSP
118190090604     C   30              MOVEL     DTS08(C)      V2DTSP
118200941110     C  N30              CLEAR                   V2DTSP
118210941110     C* SALVO
118220941110     C                   MOVEL     TAMTSP        COMTSP
118230941107     c*
118240950410     C* EMETTO IL MESSAGGIO SOLO SE CIO' CHE C'E' IN BOLLA E' DIVERSO
118250950103    2C     *IN12         IFEQ      *ON
118260941110     C     *IN15         ANDEQ     *OFF
118270941107     C                   MOVEA     ERR(17)       K78
118280941107     C*
118290950125     C                   MOVEA     BLPTSP        K78(31)
118300950125     C                   MOVEL     WDETSP        W008A             8
118310950125     C                   MOVEA     W008A         K78(33)
118320941107     C*
118330950125     C                   MOVEA     TAMTSP        K78(53)
118340090604     C**!!!              MOVEL     DTS(C)        W008A             8
118350090604     C                   MOVEL     DTS08(C)      W008A             8
118360950125     C                   MOVEA     W008A         K78(55)
118370941107     C                   MOVEA     K78           VIDMSG
118380950125     C                   CLEAR                   VIDTSP
118390950125     C                   CLEAR                   V1DTSP
118400950125     C                   CLEAR                   VARTSP
118410950410     C                   MOVEL     1             DOD
118420950410     C                   SETON                                        9048
118430950103    2C                   ENDIF
118440950103    1C                   ENDIF
118450941107     C*
118460151106     c                   if        vidnt1=vidnt2
118470151106     c                   clear                   vidnt2
118480151106     c                   endif
118490940922     C                   ENDSR
118500021120      *---------------------------------------------------------------*
118510021120      * Ricerco e carico tariffe
118520021120      *---------------------------------------------------------------*
118530021120     c     TarCar        BegSr
118540021120
118550160218     c* recupero il network bolla per il caricamento tariffe
118560021120     c                   exsr      riccar
118570160302     c** 90              goto      endTar
118580021120     c                   movel     o27fie        wfie
118590021120
118600021120     c* protezione p.iva del mittente
118610021120     c     *in04         ifeq      *on
118620021120     c                   select
118630021120     c     o27ntw        wheneq    'DPD'
118640021120     c     desefd        andeq     *blanks
118650021120     c     wdesie        andeq     'E'
118660021120     c                   seton                                        39
118670021120     c     o27ntw        wheneq    'FED'
118680021120     c     deseff        andeq     *blanks
118690021120     c     wdesie        andeq     'E'
118700021120     c                   seton                                        39
118710021120     c     o27ntw        wheneq    'EEX'
118720021120     c     deseft        andeq     *blanks
118730021120     c     wdesie        andeq     'E'
118740021120     c                   seton                                        39
118750021120     c     o27ntw        wheneq    'PPT'
118760021120     c     o27ntw        oreq      'COR'
118770021120     C                   SETON                                        39
118780021120     c                   endsl
118790021120     c                   endif
118800021120     C***
118810021120     C*** CARICAMENTO DEI CODICI TARIFFA ***
118820050921     C                   CLEAR                   fnlv59ds
118830080403     c                   clear                   CambiaCTR         1
118840080403     c*
118850150424     c                   if        *in29 and vidctr<>savctr
118860080403     C                   MOVEL     'S'           ilv59ric
118870080403     c                   MOVEL     'S'           CambiaCTR
118880080403     c                   endif
118890021120     C*
118900021120     C* SE MODIFICATO IL FLAG ITALIA ESTERO --> SEMPRE
118910021120     C     WFIE          IFNE      SAVFIE
118920160219     C     O27NTW        ORNE      S_27NTW
118930160219     C
118940160219     c
118950050921     C                   MOVEL     'S'           ilv59ric
118960021120     C                   MOVEL     WFIE          SAVFIE
118970160219     C                   MOVEL     O27NTW        S_27NTW
118980021120     C                   ENDIF
118990021120     C* IL TIPO SERVIZIO
119000160303     C     VIDTSP        IFNE      VARTSP
119010160428     C                   IF        VIDTSP=*BLANKS
119020160428     C                   MOVEL     'S'           ilv59ric
119030160428     C                   else
119040160428     C                   MOVEL     'S'           ilv59ta4
119050160428     c                   endif
119060160303     C                   MOVEL     VIDTSP        VARTSP
119070160303     C                   ENDIF
119080021120     C*
119090021120     C*  IL CODICE MITTENTE PER MANUTENZIONE
119100021120    1C     *IN12         IFEQ      *OFF
119110021120     C     *IN15         OREQ      *OFF
119120021120     C*
119130021120     C* DA ASSEGNATO CODIFICATO AD ASSEGNATO NON CODIFICATO --> PULISCO
119140021120     C*  I CAMPI PRESI DA TARIFFA
119150021120    2C     VIDCCM        IFEQ      9999
119160021120     C     SAVCCM        IFNE      0
119170021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
119180021120     C                   MOVEL     *ZEROS        SAVCCM
119190021120     C                   CLEAR                   TRE
119200021120     C                   CLEAR                   DOD
119210021120     C*
119220021120     C* VADO IN CARICAMENTO TARIFFA SOLO PER PULIRE LE SKIERE
119230050921     C                   MOVEL     'S'           ilv59ric
119240080403     C                   MOVEL     'S'           CambiaCTR
119250080403     c
119260021120     C                   ENDIF
119270021120     C*
119280021120   X2C                   ELSE
119290021120     C* ASSEGNATO CON MITTENTE CODIFICATO
119300021120     C*
119310021120     C* MITTENTE MODIFICATO
119320021120    3C     WKSC          IFNE      SAVCCM
119330050921     C                   MOVEL     'S'           ilv59ric
119340080403     C                   MOVEL     'S'           CambiaCTR
119350160429     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
119360160429     c* mettere in RI i campi presi da tariffa per avvisare della variazione
119370160429     c                   if        *in12 and not *in15
119380160429     c                   seton                                        97
119390160429     c     atrbva        ifne      prri
119400160429     c                   movel     riul          atrbva
119410160429     c                   endif
119420160429     c                   endif
119430021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
119440021120     C                   MOVEL     WKSC          SAVCCM
119450021120     C                   CLEAR                   TRE
119460021120     C                   CLEAR                   DOD
119470021120    3C                   ENDIF
119480021120    2C                   ENDIF
119490021120     C* VARIATO NUMERO ORM
119500021120     C     CHGORM        IFEQ      'S'
119510021120     C                   CLEAR                   CHGORM
119520130404     C******             MOVEL     'S'           ilv59ric
119530021120     C                   ENDIF
119540021120     C*
119550021120    1C                   ENDIF
119560150424      * Se cambiato codice tariffa tra prima e seconda videata
119570150424      * devo far assumere questa variazione a fnlv59r in modo da
119580150424      * ricevere i dati della nuova tariffa
119590150424     c                   if        vidctr<>savctr and ilv59ric=' '
119600150424     c                   eval      ilv59con='S'
119610150424     c                   eval      CambiaCTR='S'
119620150427     c                   seton                                        97
119630160429     c     atrbva        ifne      prri
119640160429     c                   movel     riul          atrbva
119650160429     c                   endif
119660150424     c                   endif
119670021120     C*
119680021120     C* CARICO TARIFFE DEL CLIENTE
119690021120     C*
119700021120     C* IMPOSTO CODICE TARIFFA A VIDEO
119710021120     C* IN MANUTENZIONE LE TARIFFE VENGONO RICARICATE SOLO SE MODIFICAT
119720021120     C                   EXSR      RICTAR
119730021120     C* SE IL CLIENTE NON HA TARIFFA--> ERRORE FORZABILE
119740160226     C* SE IL CLIENTE NON HA TARIFFA FED --> ERRORE NON FORZABILE
119750021120     C     WTKS          IFEQ      ' '
119760021120     C     VIDCCM        ANDNE     8888
119770021120     C     VIDCCM        ANDNE     9999
119780160226     C***  WFIE          IFNE      'D'
119790160226     c     wfie          ifne      'F'
119800021120     c     wfie          andne     'N'
119810021120     c     wfie          andne     'M'
119820021120     C     TRE           IFEQ      0
119830021120     C                   MOVEL     ERR(84)       VIDMSG
119840021120     C                   SETON                                        9050
119850021120     C                   MOVEL     1             TRE
119860021120     C                   GOTO      ENDTar
119870021120     C                   ENDIF
119880021120     C                   ELSE
119890160226     c*    wfie          ifeq      'D'
119900160226     C*                  MOVEL     ERR(188)      VIDMSG
119910160226     c*                  else
119920021120     C                   MOVEL     ERR(246)      VIDMSG
119930160226     c*                  endif
119940021120     C                   SETON                                        9050
119950021120     C                   GOTO      ENDTar
119960021120     C                   ENDIF
119970021120     C                   ENDIF
119980021120
119990021120     c     EndTar        EndSr
120000020207     C*
120010160224     C* RECUPERA NETWORK TARIFFA -------------------------------------*
120020020207     C     RICCAR        BEGSR
120030020213     c*
120040021120     c                   Z-Add     VidPkg        I27Pkg
120050020213     c                   movel     vidtsp        i27tsp
120060020213     c                   z-add     vidlnp        i27lnp
120070020213     c     comlna        ifgt      *zeros
120080020213     c                   z-add     comlna        i27lna
120090020213     c                   else
120100020213     c                   select
120110020213     c     viddpd        wheneq    'D'
120120020213     c     wdesie        andeq     'E'
120130020213     c                   movel     'D'           i27tln
120140020213     c     viddpd        wheneq    'F'
120150020213     c     wdesie        andeq     'E'
120160020213     c                   movel     'F'           i27tln
120170020213     c     viddpd        wheneq    ' '
120180020213     c     wdesie        andeq     'E'
120190020213     c                   movel     'E'           i27tln
120200020213     c                   other
120210020213     c                   movel     'I'           i27tln
120220020213     c                   endsl
120230020213     c                   endif
120240020213     c     vidflc        ifgt      *zeros
120250020213     c                   movel     vidflc        i27cli
120260020213     c                   else
120270020213     c                   movel     vidlnp        i27cli
120280020213     c                   endif
120290020213     c                   move      vidccm        i27cli
120300160216     c*****              z-add     blpdsp        i27dta
120310020213     c*
120320160216     c                   call      'TRUL27R1'
120330160216     c                   parm                    trul27ds1
120340160216     c***                z-add     o27ksc        tarksc
120350160216     c***                z-add     o27ctr        tarctr
120360020319     c* errore bloccante se non trovato il progressivo
120370160216     c***  o27prg        ifge      *zeros
120380160216     c***                move      o27prg        tarprg
120390160216     c***                else
120400160216     C***                SETON                                        90
120410160216     C***                MOVEL     ERR(248)      VIDMSG
120420160216     c***                endif
120430020213     c*
120440020207     c                   ENDSR
120450091210     C*--- IMPOSTAZIONE FORZATURE FLAG DDT ------------------------
120460091210     C     SR_FRZBAM     BEGSR
120470091210     C***
120480091210     C* SE BOLLA CON OBBLIGO DDT  RIMANE IMPOSTATO "S"
120490091210     C***
120500091210     C                   SELECT
120510101104     c* Se spedizione diretta a FEDEX sempre DDT SI
120520101104     c                   when      VidDpd = 'F' or a_§OgNtw = 'FED'
120530101104     C                   MOVEL     'S'           VIDBAM
120540091210     C* SE PAESE CON ATTRAVERSAMENTO DOGANA --> OBBLIGATORIA SI DDT
120550091210     C     DESEFT        WHENNE    ' '
120560091210     C     A_§OGNTW      ANDNE     'DPD'
120570091210     C     VIDDPD        ANDEQ     ' '
120580091210     c     A_§ogntw      andne     'FED'
120590091210     C                   MOVEL     'S'           VIDBAM
120600091210     c* Se richiesta bolla firmata --> Forzo si ddt
120610091210     c     vidcbo        wheneq    'FO'
120620091210     C                   MOVEL     'S'           VIDBAM
120630091210     C* SE BOLLA DI RECUPERO --> FORZI NO DDT
120640091210     C     §3ARBL        WHENEQ    'R'
120650091210     c**** vidcbo        andne     'FO'
120660091210     C                   MOVEL     'N'           VIDBAM
120670091210     C* SE OBBLIGO DDT DA CAPPARIO FORZO SI DDT
120680091210     C     DESGDD        WHENEQ    'S'
120690091210     c     savfpr        andne     'G'
120700091210     c     savfpr        andne     'P'
120710150302     c     savfpr        andne     'B'
120720091210     C                   MOVEL     'S'           VIDBAM
120730091210     c* se bolla con estensione ddt cliente (FIVAX) forzo NO DDT
120740091210     c     §1bf16        wheneq    'S'
120750091210     c                   movel     'N'           VIDBAM
120760091210     c     §dstddt       wheneq    'S'
120770091210     c     flgtb1        andeq     'A'
120780091210     c     vidcbo        andne     'FW'
120790091210     c     vidfbr        andne     'S'
120800091210     c     savfpr        andne     'G'
120810091210     c     savfpr        andne     'P'
120820091210     c                   movel     'S'           vidbam
120830091210     C                   ENDSL
120840091210     c                   eval      savddt = vidbam
120850091210     c                   endsr
120860041012     C*
120870041012     C*--- IMPOSTAZIONE CONSEGNE PARTICOLARI Per destinatario disagiat*
120880041012     C     SR_IMPtc12    BEGSR
120890041012     C*
120900041012     c* Referente e numero di telefono: se campi a video con '#'
120910041012     c* sono quelli automatici (dal tisit5) e quindi li pulisco
120920041012    2c                   if        %subst(Vidref:1:1) = '#'
120930041012     c                   clear                   vidref
120940041012    2c                   endif
120950041012    2c                   if        %subst(Vidtel:1:1) = '#'
120960041012     c                   clear                   vidtel
120970041012    2c                   endif
120980041012     c*
120990060324    2c                   if        (wdisag = 'X') OR
121000060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
121010060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
121020060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
121030041012     c                   select
121040041012     c     vidtc1        wheneq    *blanks
121050041012     c                   movel     wdisag        vidtc1
121060041012     c     vidtc2        wheneq    *blanks
121070041012     c                   movel     wdisag        vidtc2
121080041012     c                   endsl
121090041012    3c     vidtc1        ifeq      vidtc2
121100041012     c                   clear                   vidtc2
121110041012    3c                   endif
121120041012    3c                   if        vidref = *blanks
121130041012     c                   movel     ot0ref        vidref
121140041012    3c                   endif
121150041012    3c                   if        vidtel = *blanks
121160041012     c                   movel     ot0tel        vidtel
121170041012    3c                   endif
121180041012   x2c                   else
121190041012     c* se destinatario non disagiato e sono in immissione pulisco tc1 e tc2
121200041012     c* entro qui anche se destinatario supermercato/appuntamento ma previst
121210041012     c* ta consegna ad uffici
121220041012    3c                   if        *in12 = '0'
121230041012      * e se era stato precedentemente impostato da programma
121240041012     c                             and savdisag <> *Blanks
121250041012     c                   Eval      savdisag = wdisag
121260041012    4c     vidtc1        ifeq      'X'
121270091001     c     vidtc1        oreq      'S'
121280041012     c     vidtc1        oreq      'A'
121290041012     c                   clear                   vidtc1
121300041012     c                   Clear                   v2dtc1
121310041012    4c                   endif
121320041012    4c     vidtc2        ifeq      'X'
121330041012     c     vidtc2        oreq      'S'
121340041012     c     vidtc2        oreq      'A'
121350041012     c                   clear                   vidtc2
121360041012     c                   Clear                   v2dtc2
121370041012    4c                   endif
121380041012    3c                   endif
121390041012     c
121400041012    2c                   endif
121410091001     c* Memorizzo forzatura consegna particolare da destinatari particolari
121420091001     c                   if        wdisag<>*blanks and
121430091001     c                             (wdisag=vidtc1 or wdisag=vidtc2)
121440091001     c                   if        *in12=*off or
121450091001     c                             (wdisag<>sav_tc1 and wdisag<>sav_tc2)
121460091001     c                   eval      w_ar5tcp=wdisag
121470091001     c                   endif
121480091001     c                   endif
121490041012     c                   endsr
121500070924     C*--- IMPOSTAZIONE giorni di chiusura per destinatario particolar*
121510070924     C     SR_IMPgc12    BEGSR
121520070924     c*
121530070924    2c                   if        ot0err=*blanks
121540070924     c* propongo solo se a video non è stato specificato nulla.
121550070924     c* In manutenzione solo se cambiato il destinatario
121560070924     c                   if        vidgc1=*blanks and vidgc2=*blanks
121570070924     c                             and (*in12='0' or *in15='1' or
121580070924     c                             vidrsd<>savrsd or vidind<>savind or
121590070924     c                             vidprd<>savprd or vidcad<>savcad or
121600070924     c                             vidlod<>savlod or vidnzd<>savnzd)
121610070924     c                   eval      vidgc1=OT0X1GC1
121620070924     c                   eval      vidgc2=OT0X1GC2
121630070924     c                   endif
121640070924   x2c                   else
121650070924     c* se destinatario non presente e sono in immissione pulisco gc1 e gc2
121660070924    3c                   if        *in12 = '0'
121670070924      * e se era stato precedentemente impostato da programma
121680070924     c                             and savpart <> *Blanks
121690070924     c                   Eval      savpart = *blanks
121700070924     c                   clear                   vidgc1
121710070924     c                   Clear                   vidgc2
121720070924    3c                   endif
121730070924     c
121740070924    2c                   endif
121750070924     c                   endsr
121760900502     C*
121770900502     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
121780940819     C     INZ02         BEGSR
121790950126     C*
121800950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
121810971210     C                   EXSR      OFFD02
121820900502     C*
121830940923     C* SPENGO INDICATORI CHE EVIDENZIANO LE VALUTE
121840940923     C                   SETOFF                                       929399
121850940825     C                   MOVEL     *ZEROS        VIDRMN
121860060619     C***                MOVEL     *ZEROS        savRMN
121870940825     C                   MOVEL     *BLANKS       VIDRMA
121880941103     C* 03 ON - PERSONALIZZAIZONE MITTENTE ORIGINALE
121890941103     C     *IN03         IFEQ      *OFF
121900900502     C                   MOVEL     *BLANKS       VIDRMO
121910940930     C                   MOVEL     *BLANKS       VIDCMO
121920940930     C                   MOVEL     *BLANKS       VIDNMO
121930941103     C                   ENDIF
121940050315     C****               MOVE      *BLANKS       VIDFFD
121950940825     C                   MOVEL     *BLANKS       VIDFBR
121960900503     C                   MOVEL     *BLANKS       DEVCTR
121970940825     C                   MOVEL     *BLANKS       VIDTC1
121980940825     C                   MOVEL     *BLANKS       V2DTC1
121990940825     C                   MOVEL     *BLANKS       VIDTC2
122000940825     C                   MOVEL     *BLANKS       V2DTC2
122010900502     C                   MOVEL     *ZEROS        VIDNCL
122020930414     C                   MOVEL     *ZEROS        VARNCL
122030940825     C                   MOVEL     *ZEROS        V2CPKG
122040980402     C                   MOVEL     *ZEROS        SAVPKG
122050900502     C                   MOVEL     *ZEROS        VIDNRS
122060900502     C                   MOVEL     *ZEROS        VIDNCD
122070900502     C                   MOVEL     *ZEROS        VIDNCA
122080940825     C                   MOVEL     *BLANKS       VIDFVR
122090900502     C                   MOVEL     *ZEROS        VIDVOL
122100980402     C                   MOVEL     *ZEROS        SAVVOL
122110090609     c                   clear                   wvol_pre
122120940825     C                   MOVEL     *ZEROS        VIDCAS
122130011107     C                   MOVEL     §GEDCN        VIDVCA
122140011107     C                   MOVEL     §GEDCN        VARVCA
122150940825     C                   MOVEL     *BLANKS       VIDTIC
122160940825     C                   MOVEL     *ZEROS        VIDVMD
122170011113     C                   MOVEL     §GEDCN        VIDVAD
122180940825     C                   MOVEL     *ZEROS        VIDIAS
122190011211     C                   MOVEL     *ZEROS        VARIAS
122200011211     C                   MOVEL     *ZEROS        WARIAS
122210011212     C                   MOVEL     *ZEROS        WARCAS
122220011212     C                   MOVEL     *ZEROS        WARVMD
122230011112     C                   MOVEL     §GEDCN        VIDVAS
122240011112     C                   MOVEL     §GEDCN        VARVAS
122250940825     C                   MOVEL     *ZEROS        VIDQFT
122260950102     C                   MOVEL     *ZEROS        VARQFT
122270910912     C                   MOVEL     *ZEROS        BLPSPE
122280940825     C                   MOVEL     *BLANKS       VIDGGA
122290940825     C                   MOVEL     *BLANKS       VIDGCA
122300940825     C                   MOVEL     *BLANKS       VIDGMA
122310940825     C                   MOVEL     *BLANKS       VIDGVA
122320940922     C                   MOVEL     *BLANKS       VIDGGR
122330940922     C                   MOVEL     *BLANKS       VIDGCR
122340940922     C                   MOVEL     *BLANKS       VIDGMR
122350940922     C                   MOVEL     *BLANKS       VIDGVR
122360940825     C                   MOVEL     *BLANKS       VIDNT1
122370940825     C                   MOVEL     *BLANKS       VIDNT2
122380110304     c                   clear                   savnot
122390010220     C                   MOVEL     *BLANKS       VARFFD
122400930401     C                   MOVEL     *ZEROS        VA2VOL
122410930401     C                   MOVEL     *ZEROS        VARPKG
122420020531     C                   MOVEL     *ZEROS        VARtc1
122430020531     C                   MOVEL     *ZEROS        VARtc2
122440060110     C                   MOVEL     *ZEROS        D_VARrsd
122450060110     C                   MOVEL     *ZEROS        D_VARind
122460060110     C                   MOVEL     *ZEROS        D_VARlod
122470060110     C                   MOVEL     *ZEROS        D_VARprd
122480060110     C                   MOVEL     *ZEROS        D_VARnzd
122490060104     c* visto che in un caso questo campo lo andrò ad impostare anche
122500060104     c* nella routine ctrd01 sposto la pulizia nella inz01
122510060104     C****               MOVEL     *ZEROS        VARZNC
122520970128     C                   MOVEL     'N'           VIDBAM
122530021217     c                   Clear                   VidTba
122540021217     c                   Clear                   VidNba
122550030808     c                   Clear                   SavNba
122560021217     c                   Clear                   VidTb2
122570021217     c                   Clear                   VidNb2
122580030808     c                   Clear                   SavNb2
122590001214     C                   CLEAR                   KOL
122600001214     C                   Z-ADD     0             XY                2 0
122610040917     c* pulisco campo per forzatura mittente
122620040917     c                   clear                   wcontmit          1
122630030731
122640030731      * pulisco i campi di attributi visualizzazione e flag di work per
122650030731      * rif.mittente alfabetico, bancali, part.consegna varie
122660040226      * rif.mittente numerico
122670030731     c                   Clear                   AtrRma
122680030731     c                   Clear                   wrma
122690030731     c                   Clear                   AtrTba
122700030731     c                   Clear                   AtrNba
122710030731     c                   Clear                   AtrTb2
122720030731     c                   Clear                   AtrNb2
122730030731     c                   Clear                   AtrGva
122740040226     c                   Clear                   AtrRmn
122750150302     c                   clear                   atrnt1
122760150302     c                   clear                   atrnt2
122770150302     c                   clear                   atrncl2
122780150302     c                   clear                   atrpkg2
122790040226     c                   Eval      wrifm = *Off
122800150427     c                   clear                   atrctr
122810030708      * pulisco i campi della window x i colli originali + sfusi
122820030708     c                   Clear                   w03rig1
122830030708     c                   Clear                   w03rig2
122840030708     c                   Clear                   w03cor
122850030708     c                   Clear                   w03csf
122860030708     c                   Clear                   At3c01
122870030708     c                   Clear                   At3cor
122880030708     c                   Clear                   At3c02
122890030708     c                   Clear                   At3csf
122900030708     c                   Clear                   At3f12
122910030708     c                   Clear                   H3riga
122920030708     c                   Clear                   H3colo
122930030708     c                   Clear                   wtotncl
122940030708     c                   Clear                   savw03cor
122950030708     c                   Clear                   savw03csf
122960030805
122970030805     c                   Clear                   savkeyorm
122980080314     c* pulisco campo per forzatura serie parziale
122990080314     c                   clear                   f_range
123000090323     c* Campo per visualizzazione taso funzionale f15=cli/tar per tassaz.
123010090323     c* porti assegnati
123020090323     c                   clear                   atrf15
123030090327     c                   exsr      sr_inzwdwcli
123040091119     c*
123050091119     c                   exsr      inzwdwcas
123060940825     C                   ENDSR
123070940825     C*
123080940825     C*--- PULIZIA CAMPI FORMATO3 ------------------------------------*
123090940825     C     INZ03         BEGSR
123100950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
123110971210     C                   EXSR      OFFD03
123120950126     C*
123130940923     C* CAMPO CHE INDICA SE DEVO OBBLIGATORIAMENTE EMETTERE IL FORMATO3
123140940923     C                   CLEAR                   WEMD03
123150940923     C* TASSAZIONE
123160971211     C                   CLEAR                   V3CLNA
123170971211     C                   CLEAR                   V3DLNA
123180991008     C                   CLEAR                   VIDDIV
123190991011     C                   CLEAR                   WDIV1
123200940826     C                   MOVEL     *ZEROS        VIDPOR
123210991012     C                   MOVEL     *ZEROS        MEMPOR
123220940825     C                   MOVEL     *ZEROS        VIDIMV
123230940825     C                   MOVEL     *ZEROS        VIDFIV
123240991029     C                   MOVEL     *ZEROS        VA2VA1
123250040130     C                   MOVEL     *ZEROS        VA2VA2
123260040130     C                   MOVEL     *ZEROS        VA2VA3
123270040130     C                   MOVEL     *ZEROS        VA2VA4
123280041217     C                   MOVEL     *ZEROS        VA2VA5
123290041217     C                   MOVEL     *ZEROS        VA2VA6
123300940825     C                   MOVEL     *ZEROS        VIDNFT
123310940825     C                   MOVEL     *ZEROS        VIDDFT
123320940923     C                   MOVEL     ' '           VIDCEI
123330940826     C                   MOVEL     *BLANKS       V3DCEI
123340940929     C                   MOVEL     *BLANKS       V2DCEI
123350940923     C* PULIZIA SFL
123360940923     C                   SETON                                        35
123370160613     c* Per "Vedi Pacco DPD" in batch non si può utilizzare il file dislpay
123380160613     c                   if        savfpr<>'D'
123390941011     C                   WRITE     LS01C03
123400160613     c                   endif
123410940923     C                   SETOFF                                       35
123420940923     C*
123430940923     C                   CLEAR                   V3CSV1
123440940923     C                   CLEAR                   V3CVA1
123450940923     C                   CLEAR                   V3CEV1
123460991008     C                   CLEAR                   V3HVA1
123470940923     C*
123480160613     c                   if        savfpr<>'D'
123490941021     C                   DO        20            NRR               5 0
123500940923     C                   WRITE     LS01S03
123510940923     C                   ENDDO
123520160613     c                   endif
123530940923     C* ESTENSIONE BOLLA
123540940923     C                   MOVEL     ' '           VI2SV1
123550940923     C                   MOVEL     *ZEROS        VI2VA1
123560040114     c                   Clear                   Vi2Sv2
123570040114     c                   Clear                   Vi2Va2
123580040114     c                   Clear                   Vi2Sv3
123590040114     c                   Clear                   Vi2Va3
123600040114     c                   Clear                   Vi2Sv4
123610040114     c                   Clear                   Vi2Va4
123620041217     c                   Clear                   Vi2Sv5
123630041217     c                   Clear                   Vi2Va5
123640041217     c                   Clear                   Vi2Sv6
123650041217     c                   Clear                   Vi2Va6
123660930628     C                   MOVEL     ' '           VI2CEI
123670940923     C                   MOVEL     *BLANKS       V2DCEI
123680040121     c                   Clear                   Vi2Es1
123690040121     c                   Clear                   Vi2Es2
123700040121     c                   Clear                   Vi2Es3
123710040121     c                   Clear                   Vi2Es4
123720041217     c                   Clear                   Vi2Es5
123730041217     c                   Clear                   Vi2Es6
123740040126     c                   Clear                   Vi2Imv
123750991011     C                   CLEAR                   WDIV2
123760991011     C                   CLEAR                   VI2DIV
123770990701     C                   CLEAR                   VIDIFT
123780990701     C                   CLEAR                   SAVIMV
123790060208     C                   CLEAR                   SAVIMVO
123800151014     C                   CLEAR                   SAVIMV_fat
123810151014     c                   Clear                   PesVolPkcn
123820151014     c                   Clear                   PesVolSpc
123830151014     c                   Clear                   PesVolImv
123840991008      *
123850900502     C                   ENDSR
123860971210     C**
123870971210     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
123880971210     C     INZ06         BEGSR
123890081008     C**                 CLEAR                   V6CINS
123900081008     C**                 CLEAR                   V6CSTA
123910971210     C                   CLEAR                   V6CAWB
123920971211     C                   CLEAR                   SAVAWB
123930081008     C**                 CLEAR                   V6CLNA
123940081008     C**                 CLEAR                   V6DLNA
123950971210     C                   ENDSR
123960900502     C*
123970991203     C**
123980991203     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
123990991203     C     INZ07         BEGSR
124000991203     C                   CLEAR                   V7CNPR
124010991203     C                   CLEAR                   SAVNPR
124020991203     C                   CLEAR                   V7CLNA
124030991203     C                   CLEAR                   V7DLNA
124040061003     C***                CLEAR                   savfnp
124050060620     C                   CLEAR                   savkrt
124060991203     C                   ENDSR
124070000829     C*
124080000829     C*--- PULIZIA CAMPI FORMATO8 ------------------------------------*
124090000829     C     INZ08         BEGSR
124100000829     C*
124110000829     C                   CLEAR                   V8CKSC
124120000829     C                   CLEAR                   V8DKSC
124130000829     C* PULIZIA SFL
124140000829     C                   SETON                                        35
124150160613     c* Per "Vedi Pacco DPD" in batch non si può utilizzare il file dislpay
124160160613     c                   if        savfpr<>'D'
124170000829     C                   WRITE     LS01C08
124180160613     c                   endif
124190000928     C                   SETOFF                                       357833
124200000829     C                   MOVE      *ZEROS        V8CNBR
124210000829     C                   MOVE      *ZEROS        NR8
124220000918     C                   MOVE      *ZEROS        SAVNR8
124230000829     C*
124240000829     C                   CLEAR                   V8CSCE
124250000829     C                   CLEAR                   V8CNOT
124260000908     C                   CLEAR                   V8HDKC
124270000908     C                   CLEAR                   V8HESG
124280000915     C                   CLEAR                   V8HST2
124290000915     C                   CLEAR                   V8HFLS
124300000915     C                   CLEAR                   V8HLNA
124310000915     C                   CLEAR                   V8HNRS
124320000915     C                   CLEAR                   V8HNSC
124330000921     C                   CLEAR                   V8HPRE
124340000830     C*
124350000830     C* PULISCO ANCHE CAMPO FORMATO 9
124360000830     C                   CLEAR                   V9CNOT
124370000921     C                   CLEAR                   CH2
124380000921     C                   CLEAR                   I2
124390000829      *
124400000829     C                   ENDSR
124410960404     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
124420940825     C     CTRD02        BEGSR
124430940929     C                   CLEAR                   WEMFOR
124440941115     C                   CLEAR                   VIDMSG
124450930414     C                   Z-ADD     0             COMCTR
124460940216     C                   CLEAR                   CMD8
124470000321     C                   CLEAR                   WEFT
124480160302     c* Se bolla export eex verifico se instradabile su DPD
124490160302     c* Controllo già fatto nella ctrd01 ma qui è da ripetere nel caso
124500160302     c* cambiassero il peso in conferma bolle
124510160302     c                   if        *in12 and *in15
124520160302     c                   clear                   w_adpd
124530160302     c                   if        viddpd=' ' and wdesie='E' and
124540160302     c                             (vidlna = *zeros or vidlna=*blanks)
124550160302     c                             and not *in44
124560160407     c                             and §lpfpr<>'O' and partch<>'P'
124570160407     c                             and §3arbl<>'R'
124580160302     c                             and not *in04
124590160302     c                   exsr      sr_instrADPD
124600160302     c                   endif
124610160302     c                   endif
124620160406     c* In immissione bolle se immesso il volume verifico subito se rientra
124630160406     c* nei limiti per instradamento forzato a dpd
124640160406     c* (W_aDpd viene utilizzato per la ricerca della cartello in caso di bolla
124650160406     c* di cliente codificato con manca tariffa )
124660160406     c* se invece il volume non è immesso il controllo viene comunque rieseguito
124670160406     c* dopo il calcolo del volume automatico
124680160406     c                   if        not *in12 and w_aDpd='S' and vidvol>§16vld
124690160406     c                   eval      w_aDpd='N'
124700160406     c                   endif
124710160302     c* Se si vuole instradare a DpD una bolla EEX devo richiamare il
124720160302     c* cappario DPD per verificare che esista altrimenti devo mantenere
124730160302     c* EEX
124740160303    1c                   if        (not *in12 or *in15)
124750160303    2c                   select
124760160303   WHc                   when      w_aDpd='S'
124770160302     c                   exsr      sr_tisie3
124780160303    3C                   IF        Osie3err <> ' '
124790160302     c                   eval      w_aDpd='N'
124800160303     c                   clear                   comlna
124810160303   x3c                   else
124820160302     C* IMPOSTO LNA DPD SE NON 'C'E'
124830160302     C                   Z-ADD     DESLAD        COMLNA
124840160303    3c                   endif
124850160303   WHc                   when      w_aDpd='N'
124860160303     c                   clear                   comlna
124870160303    2c                   endsl
124880160303     c* Se eseguirò instradamento forzato a DPD
124890160303     c* Ripeto il controllo obbligatorietà p.iva destinatario già fatto
124900160303     c* in prima videata
124910160303     c                   if        w_aDpd='S' and
124920160303     c                             vidpid=*blanks and desefd<>*blanks
124930160303     C                   MOVEL     ERR(88)       VIDMSG
124940160303     c                   eval      vidmsg=%trim(vidmsg)+'; F12=x inserirla'
124950160303     C                   SETON                                        90
124960160303     C                   GOTO      ENDC02
124970160303     c                   endif
124980160324     c* Si è deciso di non memorizzare mai mail e cell per sped eex per
124990160324     c* le quali si forza l'instradamento a dpd e quindi non servono più
125000160324     c* le seguenti specifiche
125010160324     c****               if        wemdest<>*blanks and wdesie='E'
125020160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
125030160324     c****               clear                   wemdest
125040160324     c****               endif
125050160324     c****               if        wsms<>*blanks and wdesie='E'
125060160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
125070160324     c****               clear                   wsms
125080160324     c****               endif
125090160303    1c                   endif
125100160302
125110000321     C* SE DPD PAESE EFTA DA DPD
125120020319     C     A_§OGNTW      IFEQ      'DPD'
125130020204     C     VIDDPD        OREQ      'D'
125140160224     C     w_aDpd        OREQ      'S'
125150000321     C                   MOVEL     DESEFD        WEFT
125160000321     C                   ELSE
125170020213     c     A_§ogntw      ifeq      'FED'
125180020201     c     viddpd        oreq      'F'
125190020130     c                   movel     deseff        weft
125200020130     c                   else
125210000321     C                   MOVEL     DESEFT        WEFT              1
125220000321     C                   ENDIF
125230020130     C                   ENDIF
125240000321     C**
125250980219     C* SE VARIATO IMPORTO C/A LO SALVO
125260980219     C     *IN11         IFEQ      *ON
125270980219     C                   MOVEL     '1'           WIN11             1
125280980219     C                   ENDIF
125290980219     C* SE VARIATO IMPORTO ME LO SALVO
125300980219     C     *IN88         IFEQ      *ON
125310980219     C                   MOVEL     '1'           WIN88             1
125320980219     C                   ENDIF
125330940825     C***
125340940825     C*** MITTENTE ***
125350940825    1C     *IN02         IFEQ      *OFF
125360970703     C                   MOVEL     VIDRSM        I14RSC
125370970703     C                   CLEAR                   I14RS2
125380970703     C                   MOVEL     VIDINM        I14IND
125390970703     C                   MOVEL     VIDLOM        E14LOC
125400970703     C                   MOVEL     VIDPIM        E14PIP
125410970703     C                   MOVEL     VIDPRM        E14PRV
125420970703     C                   MOVEL     VIDNZM        E14NAR
125430970703     C                   MOVEL     VIDCAM        E14CAP
125440970704     C                   MOVEL     'M'           WCLI
125450061110     c   22              movel     vidcdf        wcdf
125460071023     c   22              movel     vidpim        wiva
125470970704     C                   EXSR      CTRIND
125480941020     C*
125490941020     C* CAMPI CHE POSSO AVER IMPOSTATO
125500970703     C                   MOVEL     E14LOC        VIDLOM
125510970703     C                   MOVEL     E14PIP        VIDPIM
125520970703     C                   MOVEL     E14PRV        VIDPRM
125530970703     C                   MOVEL     E14NAR        VIDNZM
125540970703     C                   MOVEL     E14CAP        VIDCAM
125550061109     C*
125560061109     c* Se errore sulla partita iva , visualizzo messaggio
125570061109     c                   if        xcfivaflg < *zeros
125580120504     c                   if        wcdf=*blanks OR %subst(wcdf:12:1)=' '
125590071023     c                   z-add     07            h2riga
125600071022     c                   else
125610071023     c                   z-add     08            H2riga
125620071022     c                   endif
125630061109     c                   z-add     64            H2colo
125640061109     c                   endif
125650970704     C*
125660970704     C     WEMFOR        IFEQ      '1'
125670970704     C     *IN90         OREQ      *ON
125680970704     C                   GOTO      ENDC02
125690970704     C                   ENDIF
125700040917     c* Segnalazione se inserito mittente estero
125710160628     c     savfpr        ifne      'G'
125720160628     c     savfpr        andne     'P'
125730160829     c     savfpr        andne     'D'
125740160628     c     wmitie        andeq     'E'
125750040917     c     wcontmit      andeq     *blanks
125760040917     c                   movel     '1'           wcontmit
125770040917     c                   seton                                        90
125780040917     c                   z-add     7             h2riga
125790040917     c                   z-add     49            h2colo
125800040917     c                   movel     ERR(283)      vidmsg
125810040917     c                   goto      endc02
125820040917     c                   endif
125830061110     C
125840061110     C** SE PREPAGATO 8888, CERCO IL CODICE FISCALE SE NON INSERITO
125850120503     C   22              IF        VIDCCM=8888 AND VIDNZM=*BLANKS AND
125860120504     C                             (VIDCDF=*BLANKS or vidpim=*blanks)
125870120503     C                   EXSR      CALLYCO
125880120503     C                   ENDIF
125890970704     C**
125900950303     C* SE BOLLA DIRETTA ALL'ESTERO --> P.IVA OBBLIGATORIA
125910120515     c* oppure obbligatorio il codice fiscale lungo 16
125920970704    2C     WDESIE        IFEQ      'E'
125930000321     C     WEFT          ANDNE     *BLANKS
125940050427     c     §3arbl        andne     'R'
125950120515     C***  VIDPIM        ANDEQ     *BLANKS
125960120515     c                   if        vidpim=*blanks and
125970120515     c                             (vidcdf=*blank or %subst(vidcdf:12:1)=' ')
125980950303     C                   MOVEL     '1'           WEMFOR
125990950303     C                   SETON                                        7090
126000120515     C                   MOVEL     ERR(346)      VIDMSG
126010950303     C                   GOTO      ENDC02
126020120515     c                   endif
126030000120    2C                   ENDIF
126040970704    1C                   ENDIF
126050930331     C***
126060930331     C*** NUMERO COLLI     ***
126070940928    1C     VIDNCL        IFNE      V1CNCL
126080940825     C                   MOVEL     ERR(45)       VIDMSG
126090940922     C                   SETON                                        4190
126100940920     C                   GOTO      ENDC02
126110940928    1C                   ENDIF
126120930331     C***
126130930331     C*** PESO ***
126140940928    1C   12V2CPKG        IFEQ      0
126150941110     C                   MOVEL     ERR(46)       VIDMSG
126160940922     C                   SETON                                        4290
126170940920     C                   GOTO      ENDC02
126180940928    1C                   END
126190030204      * Manutenzione di bolla con bancali
126200030204      * Se viene modificato il peso o il volume
126210030204      * emetto un msg info
126220030204     c                   If        *In12 and Not *In15                      and
126230030204     c                             (VidNba > *Zeros or VidNb2 > *Zeros)     and
126240030204     c                             (V2cPkg <> SavPkg or Vidvol <> SavVol)   and
126250110921     c                             wPkg = *Blanks                           and
126260110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
126270030204     c                   Eval      wPkg = '1'
126280030204     c                   Eval      VidMsg = Err(272)
126290030204     c                   If        V2cPkg <> SavPkg
126300030204     c                   Eval      *In42 = *On
126310030204     c                   EndIf
126320030204     c                   If        Vidvol <> SavVol
126330030204     c                   Eval      *In47 = *On
126340030204     c                   EndIf
126350030204     c                   Eval      *In90 = *On
126360030204     c                   GoTo      EndC02
126370030204     c                   EndIf
126380980402     C*
126390090609    1C** 12V2CPKG        IFGT      §QTPKB
126400090609     C**   V2CPKG        ANDNE     SAVPKG
126410090609     C**                 MOVE      V2CPKG        SAVPKG
126420090609     C***                CLEAR                   WPT1
126430980623     C* PREPARO MSG
126440090609     C***                MOVEA     ERR(52)       K78
126450090609     C***                MOVEL     §QTPKB        W006A             6
126460090609     C***                MOVEA     W006A         SKI(10)
126470090609     C***                Z-ADD     10            I                 3 0
126480090609     C***                EXSR      ABBL
126490090609     C***                MOVEA     SKI(10)       K78(34)
126500090609     C***                MOVE      §QTPKB        W001A
126510090609     C***                MOVEL     W001A         K78(41)
126520090609     C***                MOVEA     K78           VIDMSG
126530090609     C***                SETON                                        4290
126540090609     C***                GOTO      ENDC02
126550090609    1C**                 END
126560000509     C*
126570000509     C     V2CPKG        IFNE      SAVPKG
126580000509     C                   CLEAR                   WPT1
126590000509     C                   MOVE      V2CPKG        SAVPKG
126600000509     C                   ENDIF
126610000509     C*
126620930331     C* NON CONTROLLO SE SONO IN MANUTENZIONE PERCHE' NON ESISTE DISCOR
126630940928    1C  N12VIDPKG        IFNE      V2CPKG
126640940825     C                   MOVEL     ERR(38)       VIDMSG
126650940922     C                   SETON                                        4290
126660940920     C                   GOTO      ENDC02
126670940928    1C                   END
126680160322     c* Ricarica network bolla per FED se peso modificato
126690160322     c                   if        *in12 and
126700160322     c                             (a_§ogntw='FED' or viddpd='F')
126710160322     c                   clear                   trul27ds1
126720160322     c                   eval      i27tip=wtip
126730160322     c                   z-add     v2cpkg        vidpkg
126740160322     c                   exsr      riccar
126750160322     c                   movel     o27fie        wfie
126760160322     c                   endif
126770021120
126780021120     c                   If        *In12
126790021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
126800021120      * a quanto indicato in tabella "DFE"
126810021121     c                   If        O27Fie = 'N' and V2cPkg > §DfePkgD
126820021120     c                   Movel     Err(264)      VidMsg
126830021120     c                   Eval      *In90 = *On
126840021120     c                   Eval      *In42 = *On
126850021120     c                   GoTo      EndC02
126860021120     c                   EndIf
126870021120     c                   EndIf
126880930331     C***
126890941107     C*** CODICE TARIFFA ***
126900050921     C                   CLEAR                   fnlv59ds
126910050921     C                   MOVEL     'S'           ilv59con
126920050921     C                   MOVEL     'P'           ilv59tbo
126930040512      * se bolla monovaria pulisco il tipo bolla
126940040512     C                   IF        §3ASVA <> *BLANK
126950050921     C                   CLEAR                   ilv59tbo
126960050921     C                   movel     'P'           ilv59prp
126970040512     C                   ENDIF
126980040512
126990050921     C                   MOVEL     WKSC          ilv59ksc
127000050921     C                   MOVEL     KCI           ilv59kci
127010050921     C                   MOVEL     WFIE          ilv59fie
127020050921     C                   MOVEL     VIDCTR        ilv59ctr
127030050921     C                   MOVEL     BLPDSP        ilv59dsp
127040050921     C                   MOVEL     VIDTSP        ilv59tsp
127050060515     c* Se non  cambiato il cod tariffa nè il cod cliente e
127060060515     c*  sono in manutenzione, non controllo in assenza di tariffe
127070060515     c*  se tariffa bloccata o usata per altri network
127080060515     c                   if        wksc=bolksc and vidctr=bolctr
127090060515     C                             AND *IN12 AND NOT *IN15
127100060515     C                   EVAL      ILV59TA2='B'
127110060515     C                   ENDIF
127120150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
127130150415     c* accetto anche tariffe bloccate
127140150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
127150150415     c                              and §3arbl='R' and §lpimv>0)
127160150415     C                   EVAL      ILV59blo='S'
127170150415     c                   endif
127180941107     C*
127190050921     C                   CALL      'FNLV59R'
127200050921     C                   PARM                    fnlv59ds
127210050921     C                   MOVEL     olv59dfs      DEFCTR
127220941107     C*
127230941107     C* ATTIVATA LA RICERCA
127240050921     C     olv59err      IFEQ      'R'
127250050921     C                   MOVEL     olv59ctr      VIDCTR
127260941231     C                   SETON                                        83
127270941107     C                   MOVEL     '1'           WEMFOR
127280941107     C                   GOTO      ENDC02
127290941107     C                   ENDIF
127300941107     C* ERRORE
127310050921     C     olv59msg      IFNE      *BLANKS
127320050921     C                   MOVEL     olv59msg      VIDMSG
127330941231     C                   SETON                                        9083
127340941107     C                   GOTO      ENDC02
127350941107     C                   ENDIF
127360021120
127370021120      * Per bolla FedEx
127380021120If  1c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
127390160216     c****               Movel     O27Ctr        Wctr
127400021120      * --> Se non ho trovato tariffe
127410021121      *     Naturalmente questo può capitare solo per i clienti non codificati
127420021121      *     il pezzo che riguarda i clienti codificati lo lascio ma lo asterisco
127430021120If  2c                   If        Wtks <> 'S'
127440160322     c**                 Movel     Oc7ctrc       Wctr
127450021121      * ---> se ho richiamato il trul27r con i27tip = "FM" o "FD"
127460160322If  3c                   If        I27Tip = 'FM' or I27Tip = 'FD'
127470021121      * ---> oppure ho O27Fie = 'M'
127480021122     c                             or WFie = 'M'
127490160322     c                   clear                   trulc7ds
127500160322     c                   eval      IC7tFIE =  wfie
127510160322     c                   eval      IC7DTA  =  blpdsp
127520160322     c                   eval      IC7PKG  =  v2cpkg
127530160322     c                   eval      IC7tip  =  i27tip
127540160322     c                   call      'TRULC7R'
127550160322     c                   parm                    trulc7ds
127560021120      * la tariffa in bolla deve essere quella della cartello
127570160322     c                   Movel     Oc7ctrc       Wctr
127580160322If  4c                   If        VidCtr <> wctr
127590021120     c                   Eval      *In83 = *On
127600021120     c                   Eval      *In90 = *On
127610021120     c                   Movel     Err(262)      VidMsg
127620021120     c                   Goto      EndC02
127630021120    4c                   EndIf
127640021120    3c                   EndIf
127650021121      * ---> se ho richiamato il trul27r con i27tip <> "FM" e "FD"
127660160322If  3c                   If        I27Tip <> 'FM' and I27Tip <> 'FD'
127670021121      * ---> e O27Fie non è = 'M'
127680021122     c                             and WFie <> 'M'
127690021121     c                   Move      Wksc          Ksc8888
127700021120      * ----> cliente non codificato
127710021120If  4c                   If        Ksc8888 = 8888
127720021120      * richiamo il trul27r xchè la tariffa in bolla deve essere una delle
127730021120      * 2 cartello FedEx
127740160216     c***                clear                   trul27ds
127750160216     c***                Z-Add     VidPkg        I27Pkg
127760160216     c***                Movel     Vidctr        I27Ctb
127770160216     c***                ExSr      RicCar
127780160229     c***90              GoTo      EndC02
127790160229     c                   clear                   trulc7ds
127800160229     c                   eval      IC7tFIE = 'F'
127810160322     c                   Z-Add     V2cPkg        Ic7Pkg
127820160229     c                   Movel     Vidctr        Ic7Ctb
127830160229     c                   call      'TRULC7R'
127840160229     c                   parm                    trulc7ds
127850160216     c                   Movel     Oc7Ctrc       Wctr
127860021120If  5c                   If        VidCtr <> WCtr
127870021120     c                   Eval      *In83 = *On
127880021120     c                   Eval      *In90 = *On
127890021120     c                   Movel     Err(262)      VidMsg
127900021120     c                   Goto      EndC02
127910021120    5c                   EndIf
127920021120    4c                   EndIf
127930021120    3c                   EndIf
127940021120    2c                   EndIf
127950021120    1c                   EndIf
127960940922     C*
127970950103     C* MEMORIZZO SEMPRE IL CODICE TARIFFE E PROGRESSIVO
127980941107     C     WTKS          IFEQ      'S'
127990050921     C                   MOVEL     olv59prg      COMPRG
128000050921     C                   MOVEL     olv59ctr      COMCTR
128010050921     C                   MOVEL     olv59div      COMDIV            3
128020991028     C*
128030991028     C                   MOVEL     'CV'          COD
128040991028     C                   MOVEL(P)  COMDIV        KEY
128050991028     C                   EXSR      CTABEL
128060991028     C                   MOVEL     TBLUNI        DSCV
128070011113     C                   MOVEL     §CVDEC        COMDEC
128080950103     C*
128090950102     C* PER MANUTENZIONE CHAIN SULLA TARIFFA
128100950102     C   12
128110950102     CANN15KTAM2         CHAIN     TNTAM000                           30
128120950102     C   12
128130950102     CANN15*IN30         IFEQ      *ON
128140950102     C                   CLEAR                   WTKS
128150050914     c                   else
128160050914     C                   MOVEL     TAMflo        dsta01
128170950102     C                   ENDIF
128180950102     C*
128190950103     C* SE HO CAMBIATO IL CODICE TARIFFA, DEVO RIPROPORRE I CAMPI MODIF
128200940928    2C     VIDCTR        IFNE      SAVCTR
128210940922     C                   SETON                                        97
128220040610     c     atrbva        ifne      prri
128230040610     c                   movel     riul          atrbva
128240040610     c                   endif
128250950102     C* E' COME SE AVESSI MODIFICATO IL MITTENTE: RICARICO I DATI
128260080326     c                   eval      CambiaCTR='S'
128270050921     C                   MOVEL     'S'           ilv59ric
128280940922     C                   EXSR      CTNTAM
128290091210     c* verifico se impostare eventuali forzature flag DDT
128300091210     c                   EXSR      SR_FRZBAM
128310950102     C*
128320940922     C                   MOVEL     VIDCTR        SAVCTR
128330941231     C                   MOVEL     '1'           WEMFOR
128340950102     C                   CLEAR                   UND
128350041012     c* se destinatario supermercato/appuntamento ed in base a vidgva
128360041012     c* devo eventualmente aggiungere o togliere telefono,referente,tc1
128370041012     c* e tc2
128380041012     c     §ogntw        ifne      'PPT'
128390041012     c                   exsr      SR_IMPtc12
128400041012     c                   endif
128410940922     C                   GOTO      ENDC02
128420940928    2C                   ENDIF
128430930331     C*
128440940922    1C                   ENDIF
128450930331     C***
128460930331     C*** VOLUME ***
128470940928    1C     VIDVOL        IFGT      §QTVLB
128480980402    1C     VIDVOL        ANDNE     SAVVOL
128490980402     C                   MOVE      VIDVOL        SAVVOL
128500980623     C* PREPARO MSG
128510090609     C***                MOVEA     ERR(26)       K78
128520090609     C***                MOVEL     §QTVLB        W002A             2
128530090609     C***                MOVEA     W002A         SKI(14)
128540090609     C***                Z-ADD     2             I                 3 0
128550090609     C***                EXSR      ABBL
128560090609     C***                MOVEA     SKI(14)       K78(36)
128570090609     C***                MOVE      §QTVLB        W003A
128580090609     C***                MOVEA     W003A         K78(39)
128590090609     C***                MOVEA     K78           VIDMSG
128600090609     C***                SETON                                        4790
128610090609     C***                GOTO      ENDC02
128620940928    1C                   ENDIF
128630090609     c*
128640930331     C* CALCOLO VOLUME
128650050415     c* prima però se bancali 'O' devo controllare i bancali per avere
128660050415     c* il n.colli originali per calcolare correttamente il volume auto
128670050415     c* matico
128680050415     c                   if        %subst(vidgva:1:1)='O'
128690050415     c                   exsr      sr_CntPVBan
128700050415     c     wemfor        ifeq      '1'
128710050415     c                   goto      endc02
128720050415     c                   endif
128730050415     c                   endif
128740050913     c* Se previsto da tariffa richiedo obbligatorio l'inserimento del volum
128750050926     c                   select
128760050926     c* §taovb='M' --> obbligatorio l'inserimento del volume --> no calcolo
128770050926     c*                automatico
128780050926     c                   when      vidvol=0 and §taovb = 'M'
128790050913     C                   MOVEL     ERR(293)      VIDMSG
128800050913     C                   SETON                                        4790
128810050913     c                   goto      endc02
128820050926     c* §taovb='O' --> se volume non immesso errore forzabile --> calcolo
128830050926     c*                opzionale del volume automatico
128840050926     c                   when      vidvol=0 and §taovb = 'O' and fvol = ' '
128850050926     C                   MOVEL     ERR(293)      VIDMSG
128860050926     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
128870050926     C                   SETON                                        4790
128880050926     c                   eval      fvol = '1'
128890050926     c                   goto      endc02
128900050926     c                   endsl
128910050913     c*
128920930331     C                   EXSR      CALVOL
128930160406     c* se bolla che prevede instradamento forzato a dpd tolgo la forzatura se
128940160406     c* il volume suepera il max stabilito
128950160406     c                   if        (not *in12 or *in15) and
128960160406     c                             w_aDpd='S' and varvol>§16vld
128970160406     c                   eval      w_aDpd='N'
128980160406     c                   clear                   weft
128990160406     c                   clear                   comlna
129000160406     c                   endif
129010100607     c* controllo i limiti di colli peso e volume
129020100607     c
129030100607     c                   z-add     vidncl        wncl
129040100607     c                   z-add     v2cpkg        wpes
129050100607     c                   z-add     vidvol        wvol
129060100607     c                   if        vidvol=0
129070100607     c                   z-add     varvol        wvol
129080100607     c                   endif
129090100607     c                   eval      wvid='2'
129100100607     c                   exsr      sr_limtsp
129110100607     c                   if        *in90
129120100607     C                   MOVEL     wmsgtsp       VIDMSG
129130100607     C                   GOTO      ENDC02
129140100607     c                   endif
129150020531     C***
129160020531     C*** CONSEGNE PARTICOLARI ***
129170020531     c* N.B.: Ho spostato il controllo delle consegne particolari prima del
129180020531     c*       del richiamo all'fnlv13r perchè con la gestione dei supermerca
129190020531     c*       ti le devo passare a lv13 affinchè il tisi95r mi ritorni la
129200020531     c*       giusta lna e zona. Prima il controllo veniva fatto dopo il
129210020531     c*       controllo dei giorni di chiusura
129220020531     C                   MOVEL     *BLANKS       DB0DC1
129230020531     C                   MOVEL     *BLANKS       V2DTC1
129240020531    1C     VIDTC1        IFNE      ' '
129250020531     C                   MOVEL     '1P'          COD
129260020531     C* RICERCA
129270020531    2C     VIDTC1        IFEQ      '?'
129280020531     C                   EXSR      CX§TAB
129290020531     C                   MOVEL     §KEY          VIDTC1
129300020531     C                   MOVEL     §DES          V2DTC1
129310020531     C                   GOTO      ENDC02
129320020531    2C                   END
129330020531     C* CONTROLLO
129340020531     C                   MOVEL(P)  VIDTC1        KEY
129350020531     C                   EXSR      CTABEL
129360020531     C  N30              MOVEL     TBLUNI        DS1P
129370020531     C* ERRORE: INESISTENTE
129380020531    2C     *IN30         IFEQ      *ON
129390020531     C*         NON UTILIZZABILE IN PARTENZA
129400020531     C     §1PUPR        ORNE      'S'
129410020531     C     §ogntw        ANDNE     'PPT'
129420020531     C                   MOVEL     ERR(102)      VIDMSG
129430020531     C                   SETON                                        6390
129440020531     C                   GOTO      ENDC02
129450020531    2C                   ENDIF
129460020531     C*
129470020531     C                   MOVEL     §1PDES        DB0DC1
129480020531     C                   MOVEL     §1PDES        V2DTC1
129490120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
129500020531    2C     §ogntw        IFEQ      'PPT'
129510020531    3C     §1PFPC        IFNE      'E'
129520020531     C     §1PFPC        ANDNE     'P'
129530020531     C                   MOVEL     ERR(198)      VIDMSG
129540020531     C                   SETON                                        6390
129550020531     C                   GOTO      ENDC02
129560020531    3C                   ENDIF
129570020531    2C                   ENDIF
129580020531    1C                   ENDIF
129590020531     C***
129600020531     C                   MOVEL     *BLANKS       DB0DC2
129610020531     C                   MOVEL     *BLANKS       V2DTC2
129620020531    1C     VIDTC2        IFNE      ' '
129630020531     C                   MOVEL     '1P'          COD
129640020531     C* RICERCA
129650020531    2C     VIDTC2        IFEQ      '?'
129660020531     C                   EXSR      CX§TAB
129670020531     C                   MOVEL     §KEY          VIDTC2
129680020531     C                   MOVEL     §DES          V2DTC2
129690020531     C                   GOTO      ENDC02
129700020531    2C                   END
129710020531     C* CONTROLLO
129720020531     C                   MOVEL(P)  VIDTC2        KEY
129730020531     C                   EXSR      CTABEL
129740020531     C  N30              MOVEL     TBLUNI        DS1P
129750020531     C* ERRORE: INESISTENTE
129760020531    2C     *IN30         IFEQ      *ON
129770020531     C*         NON UTILIZZABILE IN PARTENZA
129780020531     C     §1PUPR        ORNE      'S'
129790020531     C     §ogntw        ANDNE     'PPT'
129800020531     C                   MOVEL     ERR(102)      VIDMSG
129810020531     C                   SETON                                        6490
129820020531     C                   GOTO      ENDC02
129830020531    2C                   ENDIF
129840120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
129850020531    2C     §ogntw        IFEQ      'PPT'
129860020531    3C     §1PFPC        IFNE      'E'
129870020531     C     §1PFPC        ANDNE     'P'
129880020531     C                   MOVEL     ERR(198)      VIDMSG
129890020531     C                   SETON                                        6490
129900020531     C                   GOTO      ENDC02
129910020531    3C                   ENDIF
129920020531    2C                   ENDIF
129930020531     C* NON POSSONO ESSERE UGUALI
129940020531     C     VIDTC1        IFEQ      VIDTC2
129950020531     C                   MOVEL     ERR(121)      VIDMSG
129960020531     C                   SETON                                        6490
129970020531     C                   GOTO      ENDC02
129980020531    2C                   ENDIF
129990020731     C* Non è possibile indicare contemporaneamente consegne particolari
130000051121     C*  'S' ed 'X' / 'S' ed 'A' / "S" e "P" / "X" e "P"
130010020731    2C                   IF           (VIDTC1 = 'X'  and  VIDTC2 = 'S')
130020020731     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'X')
130030050915     C                             or (VIDTC1 = 'A'  and  VIDTC2 = 'S')
130040050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'A')
130050050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'P')
130060050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'S')
130070051121     C*                            or (VIDTC1 = 'X'  and  VIDTC2 = 'A')
130080051121     C*                            or (VIDTC1 = 'A'  and  VIDTC2 = 'X')
130090050915     C                             or (VIDTC1 = 'X'  and  VIDTC2 = 'P')
130100050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'X')
130110020731     C                   movel     ERR(257)      VIDmsg
130120050915     c                   eval      %subst(vidmsg:67:1) = vidtc1
130130050915     c                   eval      %subst(vidmsg:73:1) = vidtc2
130140020731     C                   seton                                        6490
130150020731     C                   goto      ENDC02
130160020731    2C                   ENDIF
130170020531     C*
130180020531     C                   MOVEL     §1PDES        DB0DC2
130190020531     C                   MOVEL     §1PDES        V2DTC2
130200020531    1C                   ENDIF
130210150413
130220020531     c* Se destinatario disagiato o supermercato errore se non indicato
130230020531     c* in nessuno dei due campi di consegna particolare
130240040608     c* idem se destinatario con appuntamento
130250041012     c*
130260041012     c* Se particolarità varia="U" --> consegna ad uffici devo invece
130270041012     c* dare errore se immesso supermercato o appuntamento
130280041012     c                   if        %subst(vidgva:1:1)='U'
130290041013     c                             and (vidtc1='S' or vidtc1='A' or vidtc2='S'
130300041013     c                             or vidtc2='A')
130310041012     C                   MOVEl     ERR(285)      vidmsg
130320041012     C                   SETON                                        636490
130330041012     C                   GOTO      ENDC02
130340041012     c                   endif
130350060324     c* Se immesso appuntamento e richiesta data consegna tassativa
130360060324     c* ---> errore
130370060324     c                   if        vidtcr = *blanks and viddcr > *zeros  and
130380060324     c                             (vidtc1='A' or vidtc2='A')
130381161229     c* non segnalo quest'errore se in manutenzione e presenti variazioni
130382161229     C                   IF        *in12 and not *in15 and (at0fva=*blanks or
130383161229     c                             at0fra=*blanks)
130384161229     c                   else
130390060324     C                   MOVEl     ERR(298)      vidmsg
130400060324     C                   SETON                                        636490
130410060324     C                   GOTO      ENDC02
130411161229     c                   endif
130420060324     c                   endif
130430041012     c*
130440041012     C***  wdisag        ifne      *blanks
130450060324     c                   if        (wdisag = 'X') OR
130460060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
130470060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
130480060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
130490041012     c     wdisag        ifne      vidtc1
130500020531     c     wdisag        andne     vidtc2
130510020531     C                   MOVEa     ERR(255)      k78
130520020531     c                   select
130530020531     c     wdisag        wheneq    'X'
130540040608     c                   eval      w016ad = 'Disagiato     '
130550020531     c     wdisag        wheneq    'S'
130560040608     c                   eval      w016ad = '"Supermercato"  '
130570040608     c     wdisag        wheneq    'A'
130580040608     c                   eval      w016ad = 'con Appuntamento'
130590020531     c                   endsl
130600040608     C                   MOVEa     w016ad        k78(14)
130610020531     C                   MOVEA     K78           VIDMSG
130620020531     C                   SETON                                        636490
130630020531     C                   GOTO      ENDC02
130640041012     c                   endif
130650020531     c                   endif
130660090921     c
130670090921     c* Per tipo servizio "H" non accetto S o A
130680090921     c                   if        vidtc1='A' or vidtc1='S' or
130690090921     c                             vidtc2='A' or vidtc2='S'
130700090921     c                   if        vidtsp='H'
130710090921     C                   MOVEl     err(231)      VIDMSG
130720090921     C                   SETON                                        6390
130730090921     C                   GOTO      ENDC02
130740090921     c                   endif
130750090921     c                   endif
130760150304     c* BANCALI
130770150304     c* Se particolarita varia = 'O' il controllo seguente l'ho già
130780150304     c* fatto prima del calcolo del volume automatico
130790150304     c                   if        %subst(vidgva:1:1)<>'O'
130800150304     c                   exsr      sr_CntPVBan
130810150304     c     wemfor        ifeq      '1'
130820150304     c                   goto      endc02
130830150304     c                   endif
130840150304     c                   endif
130850940922     C***
130860070223     C*** CONTROLLO CAP
130870150304     c* se spedizione con bancali devo tenere conto anche del peso e volume dei
130880150304     c* bancali per il calcolo dell'instradamento
130890150304     c                   z-add     v2cpkg        v2cpkg_i
130900150304     c                   z-add     varvol        varvol_i
130910150304     c                   if        (not *in12 or (*in15 and not *in44)) and
130920150304     c                             %subst(VidGva:1:1) <> 'O'            and
130930150304     c                             §cliban=*blanks
130940150304     c                   if        vidnba>*zeros
130950150304     c                   Clear                   w0071
130960150304     c                   Clear                   w0053
130970150304     c     wTbaPkg1      Mult      VidNba        w0071
130980150304     c                   Add       w0071         v2cpkg_i
130990150304     c     wTbaVol1      Mult      VidNba        w0053
131000150304     c                   Add       w0053         varvol_i
131010150304     c                   endif
131020150304     c                   if        vidnb2>*zeros
131030150304     c                   Clear                   w0071
131040150304     c                   Clear                   w0053
131050150304     c     wTbaPkg2      Mult      VidNb2        w0071
131060150304     c                   Add       w0071         v2cpkg_i
131070150304     c     wTbaVol2      Mult      VidNb2        w0053
131080150304     c                   Add       w0053         varvol_i
131090150304     c                   endif
131100150304     c                   endif
131110911008      *
131120020531     C* SE CAMBIATO F.D. O PESO O VOLUME  o consegne particolari RICONTROLLO
131130940916    2C     VARFFD        IFNE      VIDFFD
131140150304     C     VARPKG        ORNE      V2CPKG_i
131150150304     C     VA2VOL        ORNE      VARVOL_i
131160020531     C     VArtc1        ORNE      vidtc1
131170020531     C     VArtc2        ORNE      Vidtc2
131180060110     c     D_varrsd      andeq     vidrsd
131190060110     c     D_varind      andeq     vidind
131200060110     c     D_varlod      andeq     vidlod
131210060110     c     D_varprd      andeq     vidprd
131220060110     c     D_varnzd      andeq     vidnzd
131230010214     C                   MOVE      VIDFFD        COMFFD
131240010214     C     COMFFD        IFEQ      'N'
131250010214     C                   MOVE      *BLANKS       COMFFD
131260010214     C                   ENDIF
131270930414     C                   MOVEL     0             DIE
131280940916     C*
131290930402     C* IN MANUTENZIONE SE SONO TORNATI COME IN BOLLA NON FACCIO NIENTE
131300940916    3C     *IN12         IFEQ      '1'
131310930402     C     *IN15         ANDEQ     '0'
131320940916     C*
131330940916     C* IN MANUTENZ.SE NOV =" " SIGNIFICA CHE IL CAP E' DI NUOVO UGUALE
131340940916     C*  A QUELLO DELLA BOLLA
131350940916     C     NOV           ANDEQ     ' '
131360010214     C     COMFFD        ANDEQ     BLPFFD
131370940928     C     V2CPKG        ANDEQ     BLPPKB
131380940928     C     VARVOL        ANDEQ     BLPVLB
131390020531     C     vidtc1        ANDEQ     BLPtc1
131400020531     C     vidtc2        ANDEQ     BLPtc2
131410060110     c     vidrsd        andeq     blprsd
131420060110     c     vidind        andeq     blpind
131430060110     c     vidlod        andeq     blplod
131440060110     c     vidprd        andeq     blpprd
131450060110     c     vidnzd        andeq     blpnzd
131460930402     C                   MOVEL     BLPZNC        VARZNC
131470940916   X3C                   ELSE
131480920427     C                   MOVEL     0             QUA
131490100209     C                   MOVEL     0             QUAH
131500930406     C                   MOVEL     '1'           NOV
131510940916    3C                   END
131520940916    2C                   END
131530930402     C*
131540910129     C* CONTROLLO IN PAESARIO LA LNA
131550940916    2C     QUA           IFNE      NUMFOR
131560910801     C*
131570930401     C                   MOVEL     VIDFFD        VARFFD
131580150304     C                   MOVEL     V2CPKG_i      VARPKG
131590150304     C                   MOVEL     VARVOL_i      VA2VOL
131600020531     C                   MOVEL     Vidtc1        VArtc1
131610020531     C                   MOVEL     Vidtc2        VArtc2
131620060110     C                   MOVEL     Vidrsd        D_VArrsd
131630060110     C                   MOVEL     Vidind        D_VArind
131640060110     C                   MOVEL     Vidlod        D_VArlod
131650060110     C                   MOVEL     Vidprd        D_VArprd
131660060110     C                   MOVEL     Vidnzd        D_VArnzd
131670940919     C*
131680970704     C                   CLEAR                   DSSI95
131690970708     C                   CLEAR                   DSLV13
131700970707     C                   CLEAR                   W2LN
131710970704     C                   MOVEL     VIDNZD        I95NAR
131720970704     C                   MOVEL     VIDCAD        I95CAP
131730970704     C                   MOVEL     VIDLOD        I95LOC
131740970704     C                   MOVEL     VIDPRD        I95PRV
131750970704     C                   MOVEL     VIDFFD        I95FFD
131760010214     C     VIDFFD        IFEQ      'N'
131770010214     C                   MOVE      *BLANKS       I95FFD
131780010214     C                   ENDIF
131790131003     c* Se per il cliente è presente personalizzazione instradamento merce
131800131003     c* imposto peso e volume medio al posto del peso e volume della sped.
131810150304     C                   Z-ADD     V2CPKG_i      I95LKG
131820131003     c                   if        n_§clipsm>0
131830131003     C                   Z-ADD     n_§clipsm     I95LKG
131840131003     c                   endif
131850980219     C* PASSO IL VOLUME AL CALCOLO DELLA LNA SOLO SE NON E' CLIENTE B
131860980219     C*  O E' CLIENTE B CON VOLUME REALE
131870980219     C     VIDNRS        IFEQ      0
131880980219     C     VIDFVR        OREQ      'R'
131890150304     C                   Z-ADD     VARVOL_i      I95LMC
131900131003     c                   if        n_§clivlm>0
131910131003     C                   Z-ADD     n_§clivlm     I95Lmc
131920131003     c                   endif
131930980219     C                   ENDIF
131940000623     C** SE BOLLA POSTA DEVO PASSARE LNP AL POSTO DI TFP
131950020319     C     §ogntw        IFEQ      'PPT'
131960000623     C                   Z-ADD     VIDLNP        I95TFP
131970000623     C                   ELSE
131980000623     C                   Z-ADD     COMTFP        I95TFP
131990000623     C                   ENDIF
132000000623     C*
132010970704     C     VIDTSP        IFNE      *BLANKS
132020970704    1C                   MOVEL     VIDTSP        I95TSP
132030970704     C                   ELSE
132040970704     C* LO PRENDO DA TARIFFA
132050970704     C                   MOVEL     COMTSP        I95TSP
132060970704     C                   ENDIF
132070131003     c                   if        §clitspf<>*blanks
132080131003     c                   movel     §clitspf      i95tsp
132090131003     c                   endif
132100971201     C     §3AFCA        IFNE      0
132110971201     C                   MOVEL     'S'           I95FCA
132120971201     C                   ENDIF
132130971201     C                   MOVEL     FLGTB1        I95TPO
132140970704     C                   MOVEL     '7'           I95TCN
132150970714     C                   MOVEL     BLPDSP        I95DAT
132160980602     C                   MOVEL     'S'           I95FRE
132170020212     c* se network fedex passo flag apposito per dire di prendere i dati
132180020212     c* dalla tabella della nazione
132190020213     c     A_§ogntw      ifeq      'FED'
132200020212     c     viddpd        oreq      'F'
132210020212     c     wdesie        andeq     'E'
132220020212     c                   movel     'S'           i95fi1
132230020212     c                   endif
132240020531     c*
132250020531     c                   movel     vidtc1        i95fi2
132260020531     c                   move      vidtc2        i95fi2
132270131003     c                   if        (vidtc1='S' or vidtc2='S')
132280131003     c                             and §clisup='N'
132290131003     c                   if        vidtc1='S'
132300131003     c                   movel     ' '           i95fi2
132310131003     c                   else
132320131003     c                   move      ' '           i95fi2
132330131003     c                   endif
132340131003     c                   endif
132350970704     C*
132360970704     C                   CALL      'FNLV13R'
132370970708     C                   PARM                    KPJBA
132380970708     C                   PARM                    DSLV13
132390970708     C                   PARM                    DSSI95
132400060105     c*
132410150128     c                   move      o95loc        wLocNorm
132420060105     c                   move      o95lna        d_o95lna
132430060105     c                   move      o95znc        d_o95znc
132440060105     c                   move      o952ln        d_o952ln
132450111201     c* EVENTUALE FORZATURA LINEA DI ARRIVO: non valida per i disk B e
132460111201     c* le bolle di reso
132461170322     c* Per il dirottamento bisogna sempre entrare (anche fnlg20r fa così)
132462170322     c* Per i resi non bisogna mai entrare nelle specifiche seguenti perchè
132463170322     c*     lg20r non usa mai le eccezioni tranne quando è presente il luogo
132464170322     c*     ma ls01r non è in grado di determinarlo
132470170322     c                   if        §1bfg6<>'C' and vidfbr<>'S'
132480170322     c****                         (vidfbr <> 'S' and *in44 = *off)
132490111201     c* .... Forzatura da archivio destinatari particolari
132500111201     c                   if        §dstlna > *zeros
132510060105     c                   movel     §dstlna       d_o95lna
132520060105     c                   clear                   d_o95znc
132530060105     c                   clear                   d_o952ln
132540060105     c                   if        §dstznc >= *zeros
132550060105     c                   movel     §dstznc       d_o95znc
132560060105     c                   endif
132570060105     c                   endif
132580120615     c* .... Forzatura da tabella "FLB/FLA"
132590120615     c* Forzatura linea di arrivo per codice cliente mittente o per linea di p.
132600120615     c                   clear                   trulflbds
132610120615     c                   movel     d_o95lna      iflblna
132620120615     c                   move      vidlnp        Iflblnp
132630120615    2c                   if        vidccm<>9999 and vidccm<>8888
132640120614     c                   move      vidccm        iflbccm
132650120615    3C     VIDFLC        IFEQ      0
132660120614     C                   MOVEL     VIDLNP        iflbccm
132670120614     C                   ELSE
132680120614     C                   MOVEL     VIDFLC        iflbccm
132690120614    3C                   ENDIF
132700120615    2c                   endif
132710120614     c                   call      'TRULFLBR'
132720120614     c                   parm                    trulflbds
132730120615    2c                   if        Oflblfz>*zeros
132740120615     c                   move      OflbLFZ       d_o95lna
132741170301     c                   if        oflberr='F'
132742170301     c                   clear                   d_o952ln
132743170301     c                   z-add     90            d_o95znc
132744170301     c                   movel     'S'           vidffd
132745170301     c                   clear                   wemdest
132746170301     c                   clear                   wsms
132747170301     c                   clear                   sav_wemdest
132748170301     c                   clear                   sav_wsms
132749170301     c                   endif
132750120615    2c                   endif
132760160829     c                   if        *in12  and *in15 and §ogntw='DPD'
132770161114     c                   clear                   wfbdp             1
132780161114     c                   eval       SQLCOD = 0
132790161114     C/EXEC SQL
132800161115     C+ SELECT  'S' into :wfbdp
132810161115     C+   FROM  WFBDP00F   WHERE  BDPnpr = :v7cnpr
132820161114     C+    fetch first row only
132830161114     C/END-EXEC
132840161114     c* verifico se numero parcel presente in work file
132850161114     c                   if        (§vpofl1='S'
132860161026     c                             and %subst(v7cnpr:1:4)='1597'
132870161026     c                             and (
132880161026     c*                            vidrmo='ALL TIME EXPRESS LTD' or
132890161026     c*                            vidrmo='WINMORE LIMITED' or
132900161026     c*                            vidrmo='UNIVERSAL AIR EXPRESSLT'  or
132910161026     c*                            vidrmo='JUST IN TIME CONSULTING')
132920161026     c                             %scan('ALL TIME EXPRESS LTD':vidrmo)>0 or
132930161026     c                             %scan('WINMORE LIMITED':vidrmo)>0  or
132940161028     c                             %scan('UNIVERSAL AIR EXPRESS':vidrmo)>0 or
132950161114     c                             %scan('JUST IN TIME CONSULTING':vidrmo)>0 ))
132960161114     c                             or
132970161114     c                             sqlcod = 0 and wfbdp='S'
132980160829     c                   z-add     172           d_o95lna
132990160829     c                   clear                   d_o95znc
133000160829     c                   clear                   d_o952ln
133010160829     c                   z-add     90            d_o95znc
133020160829     c                   movel     'S'           vidffd
133030161028     c                   clear                   wemdest
133040161028     c                   clear                   wsms
133050161028     c                   clear                   sav_wemdest
133060161028     c                   clear                   sav_wsms
133070160829     c                   endif
133080161114     c                   endif
133090111201     c                   endif
133100160224
133110930409     C*
133120110217     C* L I N E A    D I    A R R I V O    N O N    I M M E S S A
133130110217     c*     I T A L I A    O    E U R O E X P R E S S
133140110217     C
133150940916     C*  LA PRENDO DA CAPPARIO
133160000121    3C     VIDLNA        IFLE      *ZEROS
133170000121     C     VIDDPD        ANDEQ     ' '
133180160224     c     w_aDpd        andne     'S'
133190000121    3C     VIDLNA        ORLE      *ZEROS
133200000121     C     WDESIE        ANDEQ     'I'
133210970711     C                   CLEAR                   WMSGLN
133220160726     C**                 CLEAR                   WMSGZO
133230970711     C**
133240060105     C                   MOVEL     d_o95lna      COMLNA
133250060105     C                   MOVEL     d_o952ln      W2LN
133260110217     c
133270111123     c* Controlli di base della linea di arrivo
133280110217     c                   movel     comlna        wlna
133290110217     c                   exsr      CTRLNA_Base
133300110217     c
133310110217     c                   if        *in90
133320110217     C                   GOTO      ENDC02
133330160411     c                   seton                                        40
133340110217     c                   endif
133350940916     C* Z O N A:
133360940916     C* 1) IMMISSIONE E DISK CLIENTI--> PRENDO SEMPRE
133370910801     C  N12
133380970704     COR 12
133390060105     C****AN 15              MOVEL     O95ZNC        VARZNC
133400060105     CAN 15              MOVEL     d_o95znc      VARZNC
133410940916     C* 2) MANUTENZIONE --> SE CAMBIATO CAP O FD O ZONA=0 RIPRENDO
133420940916     C   12
133430940916    4CANN15NOV           IFEQ      '1'
133440930402     C     VIDZNC        OREQ      0
133450060105     C                   MOVEL     d_o95znc      VARZNC
133460940916    4C                   END
133470910129     C*
133480940916   X3C                   ELSE
133490970711     C                   CLEAR                   WMSGLN
133500160726     C***                CLEAR                   WMSGZO
133510930401     C*
133520940916     C* L I N E A   D I   A R R I V O           I M M E S S A
133530110217     C*   N O N   C O N G R U E N T E  CON QUELLA DEL CAPPARIO ITALIA O EUROEXPR
133540110217     C*  OPPURE LINEA DI ARRIVO   D P D
133550110217     C*  OPPURE LINEA DI ARRIVO   F E D E X
133560110217     C
133570060105    4C     d_o95lna      IFNE      COMLNA
133580020204    5C     VIDDPD        OREQ      'D'
133590000222     C     WDESIE        ANDEQ     'E'
133600020319     C     A_§OGNTW      OREQ      'DPD'
133610160224     c     w_aDpd        oreq      'S'
133620020201    5C     VIDDPD        OREQ      'F'
133630020201     C     WDESIE        ANDEQ     'E'
133640020213     C     A_§OGntw      OREQ      'FED'
133650030516      * se linea di partenza 102 da conferma bolla clienti non devo
133660030516      * dare incongruenza
133670030516  5aac                   If        (vidlnp <> 102 and *in12 and *in15)
133680030516     c                             or not *in12 or not *in15
133690000222     C**
133700000120     C* SE FORZATA LNA DPD, NON DEVO DARE INCONGRUENZA
133710020204    5C     VIDDPD        IFEQ      'D'
133720000121     C     WDESIE        ANDEQ     'E'
133730020319     C     A_§OGNTW      OREQ      'DPD'
133740160224     C     w_aDpd        OREQ      'S'
133750020201     C     VIDDPD        oreq      'F'
133760020201     C     WDESIE        ANDEQ     'E'
133770020213     C     A_§OGntw      OREQ      'FED'
133780000218     C**
133790020204    6C     VIDDPD        IFEQ      'D'
133800020201     C     WDESIE        ANDEQ     'E'
133810020319     C     A_§OGNTW      OREQ      'DPD'
133820160224     C     w_aDpd        OREQ      'S'
133830000229     C* PER DPD IMPOSTO ZONA 00 PER RESI ZONA 80
133840000218     C     VIDFBR        IFEQ      'S'
133850000229     C                   MOVEL     80            VARZNC
133860000218     C                   ELSE
133870000218     C                   MOVEL     00            VARZNC
133880000218     C                   ENDIF
133890160224     c                   exsr      sr_tisie3
133900060703     c*SE ERRORE DA CAPPARIO DPD, verificare
133910060615     C     Osie3err      IFNE      ' '
133920060615     C                   MOVEL     ERR(189)      VIDMSG
133930061011     C                   EVAL      CAPPARIODPD='S'
133940061011     c                   movel     vidcad        savcapdpd
133950060615     C                   SETON                                        4090
133960060615     C                   ENDIF
133970070515     c*****              endif
133980020201   x6c                   else
133990060105     c                   movel     D_o95lna      comlna
134000060105     c                   movel     d_o95znc      varznc
134010020201    6c                   endif
134020110217     c
134030110217     c* Controlli di base della linea di arrivo
134040110217     c                   movel     comlna        wlna
134050110217     c                   exsr      CTRLNA_Base
134060110217     c
134070110217     c                   if        *in90
134080110217     C                   GOTO      ENDC02
134090110217     c                   seton                                        40
134100110217     c                   endif
134110110217     c
134120000120  X 5C                   ELSE
134130970711     C**
134140940916     C* NON E' FERMO DEPOSITO
134150010214    6C     VIDFFD        IFEQ      'N'
134160010220     C     VIDFFD        OREQ      ' '
134170000704     C* NON CONTROLLO PER BOLLE POSTE DISK B
134180020319   6Ac     §ogntw        IFNE      'PPT'
134190000704     C     §1BFG6        ORNE      'C'
134200000704     C     §1BFG2        ORNE      'S'
134210940916     C* NON SEGNALO ERRORE SE BOLLA DA DISP MITTENTE
134220000120    7C     WFPR          IFNE      'I'
134230970711     C     WMSGLN        ANDEQ     ' '
134240030627      * non segnalo errore se bolle di recupero
134250100209      * non segnalo errore se prima lo avevo dato per tipo servizio H
134260100209If  8c                   If        §3arbl <> 'R'  and (vidtsp='H' or
134270100209     c                             quah=0)
134280100208     c
134290100208     c* Messaggio diverso per tipo servizio "H"
134300100210     c                   if        vidtsp='H'  and  §1bfg6='C'
134310100210     C                   MOVEL     ERR(80)       VIDMSG
134320100210     C                   sub       1             QUA
134330100210     C                   add       1             QUAH
134340100210     c                   else
134350100208     C                   MOVEL     ERR(90)       VIDMSG
134360100210    8c                   EndIf
134370100208
134380940916     C                   SETON                                        4090
134390030627    8c                   EndIf
134400000120    7C                   END
134410920427     C                   ADD       1             QUA
134420000704   6AC                   END
134430930409     C*
134440000120    6C                   END
134450910801     C* AZZERO LA ZONA
134460910801     C  N12
134470930401     COR 12
134480930401     CAN 15              Z-ADD     0             VARZNC
134490060829     c                   if        wfpr = 'G'
134500060829     c                   z-add     vidznc        varznc
134510060829     c                   endif
134520940916     C* IN MANUTENZIONE: se HO variato i dati --> AZZERO LA ZONA
134530000120     C   12
134540000120    6CANN15NOV           IFEQ      '1'
134550930401     C                   Z-ADD     0             VARZNC
134560940916     C*
134570000120   x6C                   ELSE
134580940916     C* SE CAMBIATA SOLO LA LINEA             --> AZZERO LA ZONA
134590000120    7C     SAVLNA        IFNE      VIDLNA
134600930401     C                   Z-ADD     0             VARZNC
134610910801     C                   MOVEL     '1'           NOV
134620940916     C*
134630000120   X7C                   ELSE
134640940916     C* SE NON HO CAMBIATO NULLA             -->LASCIO QUELLA CHE C'ERA
134650930402     C                   Z-ADD     BLPZNC        VARZNC
134660930402     C                   MOVEL     ' '           NOV
134670000120    7C                   ENDIF
134680910801     C*
134690000120    6C                   ENDIF
134700980806     C**
134710980806     C* SE LNA ESTERA ANCHE SE FORZO LA LINEA INCONGRUENTE COL CAP
134720980806     C*  PRENDO LA ZONA
134730020319     c     A_§ogntw      ifeq      'EEX'
134740980806     C  N12
134750980806     COR 12
134760060105     CAN 15              Z-ADD     d_o95znc      VARZNC
134770980806     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
134780000120     C   12
134790000120    7CANN15NOV           IFEQ      '1'
134800980806     C     VIDZNC        OREQ      0
134810060105     C                   Z-ADD     d_o95znc      VARZNC
134820000120    7C                   END
134830000120    6C                   ENDIF
134840000120    5C                   ENDIF
134850970711     C* PER ERRORE ESCO
134860970711     C   90              GOTO      ENDC02
134870030516
134880030516  5aac                   endif
134890921029     C*
134900940928   X4C                   ELSE
134910940916     C*
134920110217     C* L I N E A   D I   A R R I V O           I M M E S S A
134930110217     c*     I T A L I A    O    E U R O E X P R E S S
134940940916     C*  LINEA     CONGRUENTE CON QUELLA DEL CAPPARIO --> PRENDO ZONA
134950960208     C* LINEA ORIGINALE SE SECONDA LINEA DISTRIBUZIONE
134960060105     C                   MOVEL     d_o952ln      W2LN              1
134970060829     C  N12
134980060829     COR 12
134990060829     CAN 15              Z-ADD     d_o95znc      VARZNC
135000060829     c                   if        *in12='1' and *in15='1' and
135010060829     c                                 wfpr='G' and vidznc>0
135020060829     C                   Z-ADD     vidznc        VARZNC
135030060829     c                   endif
135040930402     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
135050940916     C   12
135060940916    5CANN15NOV           IFEQ      '1'
135070930402     C     VIDZNC        OREQ      0
135080060105     C                   Z-ADD     d_o95znc      VARZNC
135090940916    5C                   END
135100970711     C* DISK CLI
135110970711     C                   MOVEL     'N'           WMSGLN            1
135120160726     C***                MOVEL     O95ZNC        WEMZNC
135130910801     C*
135140940916    4C                   ENDIF
135150940916    3C                   ENDIF
135160970618    2C                   ENDIF
135170940916     C*
135180020917     C* PER DISK CLI CON SERIE PRENDO ZONA DA FIVAB
135190950410     C* --> SEGNALO PERO' SE E' DISCORDANTE CON QUELLA CALCOLATA
135200950421     C*     SEMPRE SE NON SI TRATTA DI UNA ZONA PRESA DALL'OLTRE O FD
135210160726     c* Non segnalo più: il controllo non è più di nessuna utilità ed è scomodo
135220160726     c* in particolare per le bolle del mittente Amazon
135230970618     C   12
135240970618    2CAN 15VIDNRS        IFNE      0
135250950410     C*
135260160726    3C***  §LPZNC        IFNE      WEMZNC
135270160726     C***  §ogntw        ANDNE     'PPT'
135280160726     C***  QUI           ANDEQ     0
135290160726     C***  WMSGLN        ANDEQ     'N'
135300160726     C***  WMSGZO        ANDEQ     ' '
135310030515      * non controllo per linea di partenza 102
135320160726     c***  §lplnp        Andne     102
135330160726     C***                MOVEA     ERR(115)      K78
135340160726     C***                MOVEL     WEMZNC        W002A             2
135350160726     C***                MOVEA     W002A         K78(49)
135360160726     C***                MOVEL     §LPZNC        W002A             2
135370160726     C***                MOVEA     W002A         K78(13)
135380160726     C***                MOVEA     K78           VIDMSG
135390160726     C***                SETON                                        5790
135400160726     C***                MOVEL     1             QUI
135410160726     C***                GOTO      ENDC02
135420160726    3C***                ENDIF
135430950410     C*
135440930401     C                   Z-ADD     §LPZNC        VARZNC
135450970618    2C                   ENDIF
135460980410     C*
135470980410     C   12
135480980410    2CANN15§1BFG6        IFEQ      'C'
135490980410     C     §1BFG2        ANDEQ     'S'
135500980410     C     NOV           ANDEQ     '1'
135510980410     C*
135520160726    3C***  BLPZNC        IFNE      WEMZNC
135530160726     C***  §ogntw        ANDNE     'PPT'
135540160726     C***  QUI           ANDEQ     0
135550160726     C***  WMSGLN        ANDEQ     'N'
135560160726     C***  WMSGZO        ANDEQ     ' '
135570160726     C***                MOVEA     ERR(115)      K78
135580160726     C***                MOVEL     WEMZNC        W002A             2
135590160726     C***                MOVEA     W002A         K78(49)
135600160726     C***                MOVEL     BLPZNC        W002A             2
135610160726     C***                MOVEA     W002A         K78(13)
135620160726     C***                MOVEA     K78           VIDMSG
135630160726     C***                SETON                                        5790
135640160726     C***                MOVEL     1             QUI
135650160726     C***                GOTO      ENDC02
135660160726    3C***                ENDIF
135670980410     C*
135680980410     C                   Z-ADD     BLPZNC        VARZNC
135690980410    2C                   ENDIF
135700930402     C***
135710930402     C*** CONTROLLO ZONA IN MANUTENZIONE ***
135720930409     C* SE MODIFICATA E SE NON RICALCOLATA DEVE ESISTERE NELLA TAB. 03
135730940916     C   12
135740940916    2CANN15NOV           IFNE      '1'
135750930409     C     BLPZNC        ANDNE     VIDZNC
135760930409     C     VIDZNC        ANDGT     0
135770930402     C                   MOVEL     VIDZNC        VARZNC
135780930406     C*
135790930409     C                   MOVEL     '03'          COD
135800930409     C                   MOVEL     COMLNA        ALF5              5
135810930409     C                   MOVE      VIDZNC        ALF5
135820940919     C                   MOVEL(P)  ALF5          KEY
135830930409     C*
135840930708     C                   EXSR      CTABEL
135850940928    3C     *IN30         IFEQ      *ON
135860940916     C                   MOVEL     ERR(61)       VIDMSG
135870940922     C                   SETON                                        5790
135880940920     C                   GOTO      ENDC02
135890940916    3C                   ENDIF
135900940916    2C                   ENDIF
135910930406     C*
135920150414     c* Controlli per EXPO
135930151119     c*                  if        vidtc1='Z' or vidtc2='Z'
135940151119     c*                  move      comlna        w003a
135950151119     c*                  select
135960150414     c* Errore se bolla con C/A
135970151119     c*                  when      §3afca=1
135980151119     C*                  movel     ERR(360)      VIDmsg
135990151119     C*                  seton                                        90
136000150414     c* errore se non è bolla FRANCO
136010151119     c*                  when      flgtb1<>'F'
136020151119     C*                  movel     ERR(361)      VIDmsg
136030151119     C*                  seton                                        90
136040150414     c* errore se lna non in tabella
136050151119     c*                  when      %lookup(w003a:fil_expo)=0
136060151119     C*                  movel     ERR(362)      VIDmsg
136070151119     c*                  eval      vidmsg=%trim(vidmsg) + ' ' + w003a
136080151119     C*                  seton                                        90
136090151119     c*                  endsl
136100151119     c*                  if        *in90
136110151119     c*                  if        vidtc1='Z'
136120151119     c*                  seton                                        63
136130151119     c*                  else
136140151119     c*                  seton                                        64
136150151119     c*                  endif
136160151119     C*                  goto      ENDC02
136170151119     c*                  endif
136180151119     c*                  endif
136190960320     C***
136200960320     C*** PER LNA 102 OBBLIGATORIO IL C/S
136210000706    1C     COMLNA        IFEQ      102
136220960320     C     §3ARBL        ANDNE     'C'
136230960320     C                   SETON                                        4090
136240960320     C                   MOVEL     ERR(125)      VIDMSG
136250160303     C                   GOTO      ENDC02
136260000706    1C                   ENDIF
136270991206      **
136280110217      ** Aggancio AZORG di LNA per prednere dati
136290110217      ** Es: lo tolgo perchè lo fa già sopra avenfo unificato i controllo
136300110217      **     con la CTRLNA_Base non serrve più
136310110217      **
136320110217    1C**   VIDLNA        IFLE      *ZEROS
136330110217     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
136340110217     C**                 MOVEL     ORGDE3        A_OG143
136350110217     C**                 MOVEL     ORGDF0        A_OG150
136360110217    1C**                 ENDIF
136370991206      *
136380991206      * PER LNA DPD OBBLIGATORIO 1 COLLO
136390020319     C     A_§OGNTW      IFEQ      'DPD'
136400000120     C     VIDNCL        IFNE      1
136410991206     C                   SETON                                        4190
136420991206     C                   MOVEL     ERR(179)      VIDMSG
136430991206     C                   GOTO      ENDC02
136440991206     C                   ENDIF
136450000124     c* controllo numero parcel dpd doppio
136460000308     C*  NON LO CONTROLLO SE DA CTM NON HA SEGNACOLLI (PER BOLLA
136470000308     C*  RECUPERO O PER BOLLA LEGATA I CUI SEGNACOLLI SONO SULLA MAMMA)
136480000203     C     §1BFG8        IFEQ      'S'
136490060615     C                   move      V7CNPR        WNPR
136500000124     C                   EXSR      DPDDOP
136510000124     C     *IN90         IFEQ      *ON
136520000124     C                   SETON                                        41
136530000124     C                   MOVEL     ERR(190)      VIDMSG
136540000124     C                   GOTO      ENDC02
136550000124     C                   ENDIF
136560000203     C                   ENDIF
136570000120     C                   ENDIF
136580991213      * PER LNA O LNP DPD Massimo peso inseribile da tabella
136590020319     C     A_§OGNTW      IFEQ      'DPD'
136600020319     C     §OGNTW        OREQ      'DPD'
136610160411     c     *in44         andeq     *off
136620991214     C     V2CPKG        IFGT      §3IPKD
136630991213     C                   SETON                                        4290
136640991213     C                   MOVEA     ERR(180)      K78
136650991213     C                   MOVEL     §3IPKD        W006A             6
136660991213     C                   MOVEA     W006A         SKI(10)
136670991213     C                   Z-ADD     10            I                 3 0
136680991213     C                   EXSR      ABBL
136690991213     C                   MOVEA     SKI(10)       K78(53)
136700991213     C                   MOVE      §3IPKD        W001A
136710991213     C                   MOVEL     W001A         K78(60)
136720991213     C                   MOVEA     K78           VIDMSG
136730991213     C                   GOTO      ENDC02
136740991213     C                   ENDIF
136750991213     C                   ENDIF
136760991206      **
136770991203     C                   SETOFF                                       30
136780991203      *
136790991203     C                   SELECT
136800991203      *
136810060629      * IMPORT/EXPORT DPD  (import solo se in manutenzione e solo per
136820060629      * la visualizzazione)
136830991203      *  Premuto F18
136840020319     C     A_§OGNTW      WHENEQ    'DPD'
136850991203     C     *INKS         ANDEQ     *ON
136860060616     c     *in79         oreq      *on
136870060616     C     *INKS         ANDEQ     *ON
136880060616     c     *in12         andeq     *on
136890060616     c     *in15         andeq     *off
136900991203     C                   EXSR      GESD07
136910991203     C                   SETON                                        41
136920991203     C                   MOVEL     '1'           WEMFOR
136930161129     c
136940991203     C                   GOTO      ENDC02
136950991203      *
136960991203      * EXPORT DPD
136970000307      *  Non premuto F18 e PARCEL non inserito. ESCLUDO I RECUPERI
136980020319     C     A_§OGNTW      WHENEQ    'DPD'
136990991203     C     *INKS         ANDEQ     *OFF
137000151104     C     V7CNPR        ANDEQ     *blanks
137010000308     C     §3ARBL        ANDNE     'R'
137020991203     C                   SETON                                        4190
137030991203     C                   MOVEL     ERR(175)      VIDMSG
137040991203     C                   GOTO      ENDC02
137050991203      *
137060991203      * SPEDIZIONE non ESTERO SDI E MITTENTE CON OBBLIGO AWB e non DPD
137070991203      * Premuto F18
137080991203     C     *INKS         WHENEQ    *ON
137090991203     C                   MOVEL     ERR(89)       VIDMSG
137100991203     C                   SETON                                        4190
137110991203     C                   GOTO      ENDC02
137120991203      *
137130991203     C                   ENDSL
137140940825     C***
137150910829     C*** RIFERIMENTO MITTENTE NUMERICO ***
137160940916    1C     VIDRMN        IFEQ      0
137170940825     C                   MOVEL     ERR(47)       VIDMSG
137180940922     C                   SETON                                        4390
137190940920     C                   GOTO      ENDC02
137200991130    1C                   ENDIF
137210970328     C***
137220970328     C*** FLAG D D T     ******
137230970408     C* PAESE CON ATTRAVERSAMENTO DOGANA: OBBLIGATORIO SI DDT
137240970408    1C     VIDBAM        IFEQ      'N'
137250000321     C     WEFT          ANDNE     ' '
137260970408     C                   MOVEL     ERR(140)      VIDMSG
137270970408     C                   SETON                                        7790
137280970408     C                   GOTO      ENDC02
137290970408     C                   ENDIF
137300101105     C* per Fedex : obbligatorio SI DDT
137310120523     c                   if        vidbam='N' and  §3arbl <>'R' and
137320101108     c                             (VidDpd = 'F' or a_§OgNtw = 'FED' )
137330101105     C                   MOVEL     ERR(335)      VIDMSG
137340101105     C                   SETON                                        7790
137350101105     C                   GOTO      ENDC02
137360101105     C                   ENDIF
137370970408     C* SE BOLLA DI RECUPERO, OBBLIGATORIO NO BAM
137380970408    1C     VIDBAM        IFEQ      'S'
137390970408     C     §3ARBL        ANDEQ     'R'
137400000321     C     WEFT          ANDEQ     ' '
137410020513     c     vidcbo        andne     'FO'
137420970408     C                   MOVEL     ERR(138)      VIDMSG
137430970408     C                   SETON                                        7790
137440970408     C                   GOTO      ENDC02
137450970408     C                   ENDIF
137460020507     C* SE BOLLA DI RECUPERO per bolle firmate, obbligatorio SI DDT
137470020507    1C     VIDBAM        IFEQ      'N'
137480020513     c     vidcbo        andeq     'FO'
137490020507     C                   MOVEL     ERR(254)      VIDMSG
137500020507     C                   SETON                                        7790
137510020507     C                   GOTO      ENDC02
137520020507     C                   ENDIF
137530970703     C* bolle CON OBBLIGO DDT DA CAPPARIO: SE NON E' RECUPERO ERRORE
137540970703     C*  SE IMMESSO NODDT
137550970408    1C     VIDBAM        IFEQ      'N'
137560970703     C     DESGDD        ANDEQ     'S'
137570970408     C     §3ARBL        ANDNE     'R'
137580081127     c     savfpr        andne     'G'
137590081127     c     savfpr        andne     'P'
137600150302     c     savfpr        andne     'B'
137610970328     C                   MOVEL     ERR(139)      VIDMSG
137620970328     C                   SETON                                        7790
137630970328     C                   GOTO      ENDC02
137640970408    1C                   ENDIF
137650041109     c* bolla con vax (con estensione ddt del cliente) errore se SI DDT
137660050211     c* solo se nazione e/o cap non prevedono l'obbligo del ddt si
137670050211     c                   if        §1bf16 = 'S' and vidbam = 'S' and
137680050211     c                             weft = *blanks and desgdd <> 'S'
137690041109     C                   MOVEL     ERR(287)      VIDMSG
137700041109     C                   SETON                                        7790
137710041109     C                   GOTO      ENDC02
137720041109     c                   endif
137730950303     C***
137740950303     C*** RIFERIMENTO MITTENTE ALFABETICO ***
137750950303     C* SE DESTINATARIO ESTERO -->  OBBLIGATORIO
137760950303     C     WDESIE        IFEQ      'E'
137770000321     C     WEFT          ANDNE     *BLANKS
137780950303     C     VIDRMA        ANDEQ     *BLANKS
137790950303     C                   MOVEL     '1'           WEMFOR
137800950303     C                   SETON                                          5890
137810950303     C                   MOVEL     ERR(110)      VIDMSG
137820950303     C                   GOTO      ENDC02
137830950303    1C                   ENDIF
137840021209      * Obbligatorio se è una bolla con consegna supermercato
137850030303      * ma non se è DPD
137860021209     c                   If        (VidTc1 = 'S' or VidTc2 = 'S')
137870021209     c                              and VidRma = *Blanks
137880030304     c                              and Not *In79 and wrma = *Blanks
137890021209     c                   Eval      Wemfor = '1'
137900021209     c                   Movel     Err(266)      VidMsg
137910021209     c                   Eval      *In58 = *On
137920021209     c                   Eval      *In90 = *On
137930021209     c                   GoTo      EndC02
137940021209     c                   EndIf
137950961111     C***
137960961111     C*** FLAG BOLLA RIENTRO
137970961111     C***
137980060920     c* se linea di arrivo dpd valida solo per resi ci deve essere
137990060920     c*  il flag
138000060921     c     viddpd        ifeq      'D'
138010060921     c     comlna        andeq     *zeros
138020060921     c     A_§ogNTW      oreq      'DPD'
138030060921     c* se però c'e' reso non do errore
138040060921     c                   if        o14lad<=*zeros and desred='S' and vidfbr<>'S'
138050060920     C                   SETON                                            90
138060060920     c                   z-add     20            h2riga
138070060920     c                   z-add     67            h2colo
138080060920     C                   MOVEL     ERR(157)      VIDMSG
138090060920     C                   GOTO      ENDC02
138100060920     c                   endif
138110060921     c                   endif
138120060920     c
138130961111     C     VIDFBR        IFNE      SAVFBR
138140961111     C                   MOVEL     VIDFBR        SAVFBR
138150961111     C                   CLEAR                   SED
138160961111     C                   ENDIF
138170090901     c*
138180090921     c* controllo se tipo servizio H accettabile x  linea di arrivo della bolla
138190090901     c*   tenendo conto dei tempi di trazione
138200090901     c                   if        vidtsp='H'
138210090901     c
138220100219     c                   clear                   UsaCass
138230090901     c                   exsr      ClsE98
138240090901     c
138250090922     c                   if        d98tcc<>10
138260100119     C                   SETON                                            90
138270090901     C                   MOVEL     ERR(57)       VIDMSG
138280100319     c* Se vengo da ORRM --> cancello il tipo servizio
138290100319     c                   if        wesORE='S'
138300100319     c                   movel     'N'           wesore
138310100319     c                   endif
138320090901     C                   GOTO      ENDC02
138330090901     c                   endif
138340100322     c* Se eiste FNORE --> dico che si può utilizzare
138350100322     c                   else
138360100322     c                   if        WesORE='N'
138370100322     c                   movel     'S'           wesore
138380100322     c                   endif
138390090901     c                   endif
138400060920     c*
138410900604     C*
138420900621     C*** CONTROLLO SEGNACOLLI DAL - AL ***
138430910118     C* SE FLAG STAMPA BOLLA E' "D" O "I" E PER BOLLE DI RECUPERO
138440910118     C*  OBBLIGATORIA LA NON IMMISSIONE
138450910117     C*
138460910118     C                   SETOFF                                       30
138470940825     C                   CLEAR                   WNOSEG
138480921019     C* NO SEGNACOLLO
138490930402     C* SE VENGO DA DISK CLIENTI SOLO SE E' BOLLA SENZA MAMMA
138500930402     C*  NEGLI ALTRI CASI SEMPRE
138510940825    1C     §1BFG8        IFEQ      'N'
138520930402     C*
138530940825    2C     *IN12         IFEQ      '1'
138540930402     C     *IN15         ANDEQ     '1'
138550940825     C*
138560940825    3C     §3ABCM        IFEQ      ' '
138570940825     C                   MOVEL     '1'           WNOSEG            1
138580940825    3C                   END
138590940825     C*
138600940825   X2C                   ELSE
138610940825     C                   MOVEL     '1'           WNOSEG            1
138620940825    2C                   END
138630940825    1C                   END
138640910805     C* NON SEQUENZIALI
138650940825    1C   12VIDFNS        IFEQ      'S'
138660940825     C                   MOVEL     '1'           WNOSEG            1
138670940825    1C                   END
138680910118     C*
138690940825    1C     WNOSEG        IFEQ      '1'
138700940825    2C     VIDNCD        IFGT      0
138710940825     C                   MOVEL     ERR(51)       VIDMSG
138720940922     C                   SETON                                        4590
138730940920     C                   GOTO      ENDC02
138740940825    2C                   END
138750910118     C*
138760940825    2C     VIDNCA        IFGT      0
138770940825     C                   MOVEL     ERR(51)       VIDMSG
138780940922     C                   SETON                                        4690
138790940920     C                   GOTO      ENDC02
138800940825    2C                   END
138810940825    1C                   END
138820960805     C* SE C'E' IL DETTAGLIO COLLI NON LI POSSO MODIFICARE
138830960805    1C     §1BFG7        IFEQ      'S'
138840980410     C     §1BFG6        ANDEQ     'C'
138850960805    2C     VIDNCD        IFNE      WNSNCD
138860960805     C     VIDNCA        ORNE      WNSNCA
138870960805     C                   MOVEL     ERR(127)      VIDMSG
138880960805     C                   SETON                                        4590
138890960805     C                   GOTO      ENDC02
138900960805    2C                   ENDIF
138910960805     C*
138920960805    1C                   ENDIF
138930910118     C*
138940940216     C*CAMBIO PORTO DIROTTAMENTO --> NON DO QUESTO ERRORE
138950940825     C* (44 ON )                     PERCHE' SEGNACOLLI SULLA MAMMA
138960940825     C  N44
138970940825    1CANN25WNOSEG        IFEQ      ' '
138980940825     C*
138990940825    2C     VIDNCD        IFEQ      0
139000940825     C                   MOVEL     ERR(51)       VIDMSG
139010940922     C                   SETON                                        4590
139020940920     C                   GOTO      ENDC02
139030940825    2C                   END
139040940916     C***
139050910117     C*
139060940825    3C     VIDNCA        IFNE      0
139070020315     C     VIDNCA        SUB       VIDNCD        COMNCL            8 0
139080900502     C                   ADD       1             COMNCL
139090900508     C                   ELSE
139100900508     C                   Z-ADD     1             COMNCL
139110940825    3C                   END
139120940825     C*
139130940825     C* CONTROLLO DIFFERENZA SEGNACOLLO DAL-AL CON NUMERO COLLI
139140940825    3C     COMNCL        IFNE      VIDNCL
139150940825     C                   MOVEL     ERR(45)       VIDMSG
139160940922     C                   SETON                                        4190
139170940920     C                   GOTO      ENDC02
139180940825    3C                   END
139190910117     C*
139200940825    1C                   END
139210910208     C*
139220940825     C* SE DEVO ATTRIBUIRE I SEGNACOLLI CONTROLLO CHE CI SIA LA NUMERAZ
139230991209     C                   CLEAR                   AAS
139240910208     C                   Z-ADD     9             CNU
139250930120     C                   MOVE      VIDLNP        COMLIN
139260930120     C                   MOVE      COMLNA        LIV2
139270930629     C     KNUF2         CHAIN(N)  FLNUF                              30
139280910508     C*
139290940916    1C     *IN30         IFEQ      *ON
139300940916    2C     *IN25         IFEQ      *ON
139310940825     C                   MOVEL     ERR(41)       VIDMSG
139320940922     C                   SETON                                        4590
139330940920     C                   GOTO      ENDC02
139340940916    2C                   ENDIF
139350940825     C                   Z-ADD     0             NUFRIN
139360940825     C                   Z-ADD     0             NUFRFI
139370940916    1C                   ENDIF
139380910208     C*
139390910208     C                   SETOFF                                       30
139400941021     C*
139410960926     C* LINEA SEGNACOLLO:
139420950525     C* PER DISK CLIENTI KA LNP E SEMPRE QUELLA DEL DISK
139430950525     C* SOLO PERO' SE IL CTM E' DI UNA SOLUZIONE "B"
139440950525     C   12
139450950525     CAN 15§1BFG6        IFEQ      'C'
139460950525     C                   MOVEL     §LPLNP        WFLS
139461170113     c* se filiale segnacollo = 0 --> errore
139462170113     c                   if        wfls=0
139463170113     C                   SETON                                        90
139464170113     C                   MOVEL     ERR(366)      VIDMSG
139465170113     C                   GOTO      ENDC02
139466170113     c                   endif
139470950525     C                   ELSE
139480950525     C                   MOVEL     VIDLNP        WFLS
139490950525     C                   ENDIF
139500941021     C* PER IMMISSIONE E' LA LINEA DI PARTENZA
139510941021     C  N12              MOVEL     VIDLNP        WFLS
139520941021     C* PER MANUTENZIONE E' QUELLA GIA' MEMORIZZATA
139530941021     C   12
139540941021     CANN15              MOVEL     BLPFLS        WFLS
139550940825     C*
139560921006     C* SE SEGNACOLLI COMPRESI NEL RANGE DI QUELLI ASSEGNATI IN
139570921006     C*  AUTOMATICO  ERRORE
139580920203     C* NON CONTROLLO SE TIPO BOLLA CON MAMMA (§3ABCM=S)
139590950713    1C     §3ABCM        IFNE      'S'
139600950713    2C     VIDNCD        IFNE      0
139610921006     C*
139620921006     C* NON CONTROLLO IL RANGE SE SONO IN RECUPERO
139630950713     C   12
139640950713    3CAN 15§LPFPR        IFEQ      'R'
139650921006     C                   SETON                                        30
139660950713    3C                   END
139670921006     C*
139680990602    3C  N12PARTCH        IFEQ      'R'
139690921006     C                   SETON                                        30
139700950713    3C                   END
139710921006     C*
139720950713     C  N30
139730950713    3CANN25VIDNRS        IFEQ      0
139740910208     C*
139750950713    4C     VIDNCD        IFLT      NUFRIN
139760950713    5C     VIDNCA        IFGT      NUFRIN
139770940825     C                   MOVEL     ERR(51)       VIDMSG
139780940922     C                   SETON                                        4690
139790940920     C                   GOTO      ENDC02
139800950713    5C                   END
139810950713   X4C                   ELSE
139820950713    5C     VIDNCD        IFLE      NUFRFI
139830940825     C                   MOVEL     ERR(51)       VIDMSG
139840940922     C                   SETON                                        4590
139850940920     C                   GOTO      ENDC02
139860950713    5C                   END
139870950713    4C                   END
139880910208     C*
139890950713    3C                   END
139900950713    2C                   END
139910910208     C*
139920910208     C* S E G N A C O L L I   D O P P I
139930910117     C*
139940910208     C* IN MANUTENZIONE/DISK CLIENTI CONTROLLO SE NON CAMBIATA LNA
139950921006     C                   SETOFF                                       30
139960971211     C                   MOVEL     COMLNA        W003A
139970971211     C   12
139980971211    2CAN 25SAVLNA        IFNE      W003A
139990910208     C                   SETON                                        30
140000950713    2C                   ENDIF
140010950713     C*
140020910208     C*  E SE NON AUMENTATI SEGNACOLLI
140030940916     C   12
140040050113    2Can 25SAVNCL        iflt      V1CNCL
140050910208     C                   SETON                                        30
140060950713    3C                   ENDIF
140070950713     C*
140080950713     C* NON CONTROLLO SE DEVO ASSEGNARE IL PGM I SEGNACOLLI
140090950713    2C     §1BFG6        IFEQ      'D'
140100950713     C     §1BFG6        OREQ      'I'
140110950713     C     §1BFG6        OREQ      'N'
140120950713     C                   SETON                                        30
140130950713    2C                   ENDIF
140140000627     C* NON CONTROLLO IN CASO DI CHIAMATA PER CONTROLLO DI BOLLA
140150000627     C*  AUTOGENERATA  POSTE
140160000627     C     §LPFLG        IFEQ      'C'
140170000627     C     VIDSOP        ANDEQ     '&'
140180020319     c     §ogntw        andeq     'PPT'
140190000627     C                   SETON                                        30
140200000627    2C                   ENDIF
140210940916     C*
140220910826     C*
140230920123     C* PER DISK CLI  SE NON SONO SEQUENZIALI
140240141119     c*
140250141119     c* W_bldncd e W_bldnca servono per il controllo range segnacolli
140260141119     c* per serie parziale se segnacolli non sequenziali
140270141119     c* Li imposto solo in conferma bolle.
140280141119     c* In Immissione bolle e manutenzione LI LASCIO SEMPRE VUOTI in quanto
140290141119     c* non sono da controllare (TRULNRSR se vuoti non li controlla)
140300141119     c* - In immissione non è possibile bollettare con segnacolli non
140310141119     c*   sequenziali
140320141119     c* - In manutenzione non è possibile variare i dati sensibili per
140330141119     c*   il controllo range segnacolli (ccm, serie, fls, numeri segnacolli)
140340141118     c                   if        *in12 and *in15
140350080313     c                   z-add     *hival        w_bldncd
140360141118     c                   else
140370141118     c                   clear                   w_bldncd
140380141118     c                   endif
140390080313     c                   clear                   w_bldnca
140400940916     C   12
140410940916     CAN 15
140420940916    2CANN30VIDFNS        IFEQ      'S'
140430920123     C*
140440020917     C     KBLC          SETLL     FIVAD000
140450020917     C     KBLC          READE(N)  FIVAD000                               31
140460910826     C*
140470940916    3C     *IN31         DOWEQ     *OFF
140480941230     C                   Z-ADD     BLDNCD        COMSCD
140490080313     c* mi memorizzo in campi di comodo il numero più basso e quello più
140500080313     c* alto di segnacollo che mi servirà per il controllo range se
140510080313     c* cliente con serie parziale
140520080313    4c                   if        bldncd<w_bldncd
140530080313     C                   Z-ADD     BLDNCD        W_bldncd
140540080313    4c                   endif
140550080313    4c                   if        bldnca>0
140560080313    5c                   if        bldnca>W_bldnca
140570080313     C                   Z-ADD     BLDNCA        W_bldnca
140580080313    5c                   endif
140590080313   x4c                   else
140600080313    5c                   if        bldncd>w_bldnca
140610080313     C                   Z-ADD     BLDNCD        W_bldnca
140620080313    5c                   endif
140630080313    4c                   endif
140640120828     C     KBLT          CHAIN     FNBLT27L                           32
140650051102    4c                   if        *in32
140660120828     C     KBLT          CHAIN(N)  Fiars01L                           32
140670120828    5c                   if        not *in32
140680120828     c     kblt          chain     fnart27l                           32
140690051102     c* Se non trovato ART record presente x errore: lo cancello
140700120828     c   32kblt          delete    fiars01l
140710120828    5c                   endif
140720051102    4c                   endif
140730960319     C  N32              SETON                                        3190
140740020917     C   32KBLC          READE(N)  FIVAD000                               31
140750940916    3C                   ENDDO
140760940916     C*
140770940916    3C     *IN90         IFEQ      *ON
140780940916     C                   EXSR      PRPMSG
140790940920     C                   GOTO      ENDC02
140800940916    3C                   ENDIF
140810940916     C                   SETON                                        30
140820940916    2C                   ENDIF
140830910826     C*
140840920124     C* PER GLI ALTRI CASI
140850940916    2C  N30VIDFNS        IFEQ      ' '
140860910118     C                   Z-ADD     VIDNCD        CO2SCD            8 0
140870910118     C                   Z-ADD     VIDNCD        COMSCD            7 0
140880940916    3C     VIDNCA        IFEQ      0
140890900503     C                   Z-ADD     VIDNCD        COMSCA
140900900502     C                   ELSE
140910910118     C                   Z-ADD     VIDNCA        COMSCA            8 0
140920940916    3C                   END
140930900502     C*
140940940916    3C     CO2SCD        DOWLE     COMSCA
140950990318     C     CO2SCD        ANDGT     0
140960920124     C*
140970920124     C* PER IMMISSIONE  / DISK CLIENTI SEQUENZIALI
140980920124     C   12
140990920124     CAN 15
141000940916    4CORN12              DO
141010120828     C     KBLT          CHAIN     FNBLT27L                           32
141020051102     c
141030051102    5C   32§ogntw        IFne      'PPT'
141040120828     C     KBLT          CHAIN(N)  Fiars01L                           32
141050120828    6c                   if        not *in32
141060120828     c     kblt          chain     fnart27l                           32
141070051102     c* Se non trovato ART record presente x errore: lo cancello
141080120828     c   32kblt          delete    fiars01l
141090120828    6c                   endif
141100051102    5c                   endif
141110051102     c
141120051102     C  N32              SETON                                        90
141130940916     C*
141140001212     C* PREPARA MESSAGGIO DI ERRORE
141150100517     c
141160100517     C   90              EXSR      PRPMSG
141170100517    4C                   END
141180920124     C*
141190920124     C* PER MANUTENZIONE CONTROLLO ANCHE DI NON ESSERE ME STESSA
141200940916     C   12
141210940916    4CANN15              DO
141220120828     C     KBLT          SETLL     FNBLT27L
141230120828     C     KBLT          READE     FNBLT27L                               32
141240920124     C*
141250940916    5C     *IN32         DOWEQ     *OFF
141260940916    6C     VIDSPE        IFNE      BLPSPE
141270940916     C                   SETON                                        9032
141280920124     C                   ELSE
141290120828     C     KBLT          READE     FNBLT27L                               32
141300940916    6C                   ENDIF
141310940916    5C                   ENDDO
141320940916    4C                   ENDDO
141330940916     C* SEGNACOLLO DOPPIO --> PREPARA MESSAGGIO DI ERRORE
141340940916    4C     *IN90         IFEQ      *ON
141350940916     C                   EXSR      PRPMSG
141360940920     C                   GOTO      ENDC02
141370940916    4C                   ENDIF
141380920124     C*
141390910826     C* CONTROLLO ALTRO NUMERO
141400910826     C                   ADD       1             CO2SCD
141410910826     C                   ADD       1             COMSCD
141420940916    3C                   END
141430940916    2C                   END
141440920124     C*
141450940916    1C                   END
141460910220     C*
141470910220     C*** NUMERO SERIE ***
141480940826     C*
141490100517    2C     VIDNRS        IFNE      0
141500100517     c
141510940922     C*
141520940922     C* SE SERIE <> DA 0 E FLAG6 DEL CTM NON E' "C" ERRORE
141530940916    3C     §1BFG6        IFNE      'C'
141540940916     C                   MOVEL     ERR(49)       VIDMSG
141550940922     C                   SETON                                        5690
141560940920     C                   GOTO      ENDC02
141570940916    3C                   END
141580100517     c
141590100517     c                   clear                   trulnrsds
141600100517     c                   movel     wksc          inrsCCM
141610100517     c                   movel     vidnrs        inrsNRS
141620100517     c                   movel     wfls          inrsFLS
141630100517    3c                   if        vidfns='S'
141640100517     c                   movel     w_bldncd      inrsNCD
141650100517     c                   movel     w_bldnca      inrsNCA
141660100517     c                   else
141670100517     c                   movel     vidncd        inrsNCD
141680100517     c                   movel     vidnca        inrsNCA
141690100517    3c                   endif
141700100517     c
141710100517     c                   call      'TRULNRSR'
141720100517     c                   parm                    trulnrsds
141730100517     c
141740110902    3c****               select
141750110902    3c****               when      onrserr<>' ' and
141760110902     c****                         onrserr<>'N'
141770110902    3c                   if        onrserr<>' '
141780100517     C                   MOVEL     onrsmsg       VIDMSG
141790100517     C                   SETON                                        9056
141800100517     C                   GOTO      ENDC02
141810110902     c                   endif
141820100517     c
141830110902    3c*********          when      onrserr= 'N' and f_range=' '
141840080313      *
141850110902     c
141860110902     c******             eval      f_range='1'
141870110902     c*******            seton                                        90
141880110902     c******             exsr      escier
141890110902    4C**** §lpfpr        IFNE      '5'
141900080314     C* gestione window con errore forzabile
141910110902     c*****              setoff                                       90
141920100517     c* riempi i campi col messaggio
141930110902     c*****              eval      w3cpfl1=%subst(onrsmsg:1:24)
141940110902     c*****              eval      w3cpfl2=%subst(onrsmsg:25:38)
141950110902     c*****              eval      w3cpfl3=%subst(onrsmsg:63:16)
141960100517     c
141970110902    5c****               if        §lpfpr<>'V'
141980110902     c****               write     ls01d02
141990110902    5c****               endif
142000110902    5c****               dou       *inkf
142010110902     c****               exfmt     ls01w3cp
142020110902    5c****               enddo
142030110902     c****               eval      wemfor='1'
142040110902     c****               goto      endc02
142050110902   x4C***+               ELSE
142060110902     c***                seton                                        90
142070110902     C****               GOTO      ENDC02
142080110902    4C****               ENDIF
142090110902    3c******             ENDSL
142100910308     C*
142110940916   X2C                   ELSE
142120910308     C* SERIE =0 FLAG6 DEL CTM = "C" ERRORE
142130940916    3C     §1BFG6        IFEQ      'C'
142140940916     C                   MOVEL     ERR(49)       VIDMSG
142150940922     C                   SETON                                        5690
142160940920     C                   GOTO      ENDC02
142170940916    3C                   END
142180940916    2C                   END
142190921006     C*
142200940916     C* SE RECUPERO CONTROLLO NUM SPEDIZIONE DOPPIO
142210990602    1C  N12PARTCH        IFEQ      'R'
142220940915     C     KNSP          SETLL     FNBLP01L                               30
142230940928    2C     *IN30         IFEQ      *ON
142240940916     C                   MOVEL     ERR(50)       VIDMSG
142250940922     C                   SETON                                        5690
142260940920     C                   GOTO      ENDC02
142270940928    2C                   END
142280940928    1C                   END
142290940916     C***
142300900502     C*** NATURA MERCE ***
142310940928    1C  N27VIDNAS        IFEQ      *BLANKS
142320940928     C                   MOVEL     ERR(53)       VIDMSG
142330940922     C                   SETON                                        4890
142340940920     C                   GOTO      ENDC02
142350940928    1C                   END
142360970115     C*
142370970115     C* CONTROLLO QUALI DICITURE NON SONO AMMESSE E PER QULI BOLLE
142380970115     C                   Z-ADD     1             C
142390970115    1C     LDC(C)        DOWNE     *BLANKS
142400970115     C*
142410970115     C                   CLEAR                   WRICER
142420970115    2C     WDESIE        IFEQ      'E'
142430970115    3C     TBO(C)        IFEQ      ' '
142440970115     C     TBO(C)        OREQ      'E'
142450970115     C                   MOVEL     'S'           WRICER            1
142460970115    3C                   ENDIF
142470970115    2C                   ENDIF
142480970115    2C     WDESIE        IFEQ      'I'
142490970115    3C     TBO(C)        IFEQ      ' '
142500970115     C     TBO(C)        OREQ      'I'
142510970115     C                   MOVEL     'S'           WRICER            1
142520970115    3C                   ENDIF
142530970115    2C                   ENDIF
142540970115     C*
142550970115    2C     WRICER        IFEQ      'S'
142560970115     C                   MOVEL     TBO(C)        W003A
142570970115     C                   MOVE      LDC(C)        W003A
142580970115     C                   MOVEL     '3F'          COD
142590970115     C                   MOVEL(P)  W003A         KEY
142600970115     C     KTAB2         CHAIN     TABEL                              30
142610970115    3C     *IN30         IFEQ      *OFF
142620970115     C                   MOVEA     TBLUNI        K89
142630970115    3C                   ENDIF
142640970115     C                   MOVEL     LDC(C)        Z                 2 0
142650970115     C                   Z-ADD     1             Y                 3 0
142660970115     C*
142670970115    3C     Y             DOWLT     86
142680970115     C                   CLEAR                   W015A
142690970115     C                   MOVEA     K89(Y)        W015A            15
142700970115    4C     W015A         IFNE      *BLANKS
142710970115     C     W015A:Z       SCAN      VIDNAS                                 31
142720970115     C* ERRORE
142730970115    5C     *IN31         IFEQ      *ON
142740970115     C*
142750970115     C     WDESIE        IFEQ      'E'
142760970115     C                   MOVEA     ERR(135)      K78
142770970115     C                   ELSE
142780970115     C                   MOVEA     ERR(136)      K78
142790970115     C                   ENDIF
142800970115     C                   Z-ADD     11            YY                3 0
142810970115     C                   DO        Z
142820970115     C                   MOVEL     K89(Y)        K78(YY)
142830970115     C                   ADD       1             YY
142840970115     C                   ADD       1             Y
142850970115     C                   ENDDO
142860970115     C                   MOVEL     '"'           K78(YY)
142870970115     C                   MOVEA     K78           VIDMSG
142880970115     C*
142890970115     C                   SETON                                        4890
142900970115     C                   Z-ADD     89            Y
142910970115     C                   Z-ADD     29            C
142920970115    5C                   ENDIF
142930970115    4C                   ENDIF
142940970115     C*
142950970115     C                   ADD       Z             Y
142960970115    3C                   ENDDO
142970970115    2C                   ENDIF
142980970115     C*
142990970115     C                   ADD       1             C
143000970115    1C                   ENDDO
143010940930     C***
143020940930     C*** MITTENTE ORIGINALE ***
143030941103     C                   MOVEL     VIDRMO        WRMO
143040941103     C                   MOVEL     VIDCMO        WCMO
143050941108     C                   MOVEL     VIDNMO        WNAR
143060941103     C                   EXSR      CTRMO
143070941103     C                   MOVEL     WNAR          VIDNMO
143080941103     C     WEMFOR        IFEQ      '1'
143090941103     C                   GOTO      ENDC02
143100941103     C                   ENDIF
143110091008     c*** . . .obbligatorio per porti assegnati import
143120091008     c                   if        §3atb1='A2' and (§ogntw='FED' or
143130091008     c                             §ogntw='DPD' or §ogntw='EEX')
143140091008     c                             and (vidrmo=*blanks or vidcmo=*blanks)
143150091016     c                             and *in44=*off and vidfbr<>'S'
143160091008     C                   MOVEL     ERR(328)      VIDMSG
143170091008     C                   SETON                                        90
143180091008     c                   select
143190091008     c                   when      vidrmo=*blanks
143200091008     c                   seton                                        71
143210091008     c                   when      vidcmo=*blanks
143220091008     c                   seton                                        72
143230091008     c                   endsl
143240091008     C                   GOTO      ENDC02
143250091008     c                   endif
143260091008     c
143270940922     C***
143280940922     C*** CONTRASSEGNO ***
143290961204     c***
143300961204     C* PER BOLLE DI RESO NON SI PUO' INSERIRE
143310961204     C     VIDFBR        IFEQ      'S'
143320961204     C     §3AFCA        ANDGT     0
143330961204     C                   MOVEL     ERR(134)      VIDMSG
143340961204     C                   SETON                                        5090
143350961204     C                   GOTO      ENDC02
143360961204    1C                   ENDIF
143370940922     C* IN MANUTENZIONE: SE BOLLA CHE PREVEDE C/A MA E' CON MAMMA E
143380940922     C*  SI TRATTA DI UN TIPO BOLLA NON MANUTENZ, NON POSSO INSERIRE:
143390940922     C*  NE' TIPO INCASSO NE' C/ASSEGNO, MENTRE POSSO INSERIRE LE VARIE
143400940922     C*
143410940922    1C     *IN12         IFEQ      *ON
143420940922     C     *IN15         ANDEQ     *OFF
143430940922     C     *IN44         ANDEQ     *ON
143440940922     C     §3ABCM        ANDNE     ' '
143450940922     C     §3AFCA        ANDNE     0
143460940922     C*
143470940922    2C     VIDTIC        IFNE      *BLANKS
143480940922     C                   MOVEL     ERR(99)       VIDMSG
143490940922     C                   SETON                                        4990
143500940922    2C                   END
143510940922    2C  N90VIDCAS        IFNE      0
143520940922     C                   MOVEL     ERR(98)       VIDMSG
143530940922     C                   SETON                                        5090
143540940922    2C                   END
143550940922     C*
143560940922   X1C                   ELSE
143570940922     C*
143580940922     C* IN TUTTI GLI ALTRI CASI SI SEGUONO LE REGOLE CORRETTE
143590940922     C* NON C'E' FLAG C/ASSEGNO SU TIPO BOLLA
143600940922    2C     §3AFCA        IFEQ      0
143610940922     C*
143620940922    3C     VIDTIC        IFNE      *BLANKS
143630940922     C                   MOVEL     ERR(99)       VIDMSG
143640940922     C                   SETON                                        4990
143650940922    3C                   ENDIF
143660940922    3C  N90VIDCAS        IFNE      0
143670940922     C                   MOVEL     ERR(98)       VIDMSG
143680940922     C                   SETON                                        5090
143690940922    3C                   ENDIF
143700940922     C*
143710940922   X2C                   ELSE
143720940922     C*
143730940922     C*     C'E' FLAG C/ASSEGNO SU TIPO BOLLA
143740940922    3C     VIDCAS        IFEQ      0
143750940922     C                   MOVEL     ERR(98)       VIDMSG
143760940922     C                   SETON                                        5090
143770940922    3C                   ENDIF
143780011108     C  N90VIDVCA        IFEQ      *BLANKS
143790011108     C                   MOVEL     ERR(169)      VIDMSG
143800011108     C                   SETON                                        5190
143810011108     C                   ENDIF
143820940922    2C                   ENDIF
143830940922     C*
143840940922    1C                   ENDIF
143850940922     C* ERRORE
143860940922     C   90              GOTO      ENDC02
143870090622     c*
143880090622     c* Controllo tipo incasso C/A e relativa divisa
143890090622     c* richiamo pgm TRULTICR
143900090625    1c                   if        vidtic<>*blanks or vidcas>0
143910091211     c                   exsr      sr_trultic
143920091211     c                   exsr      sr_impochktic
143930090622     c
143940090625    2c                   if        oticric='T'
143950090624     c                   movel     otictic       vidtic
143960090624     c                   eval      wemfor='1'
143970090624     C                   GOTO      ENDC02
143980090625    2c                   endif
143990090625    2c                   if        oticric='D'
144000090624     c                   movel     oticdiv       vidvca
144010090624     C                   eval      wemfor='1'
144020090624     C                   GOTO      ENDC02
144030090625    2c                   endif
144040090622     c* Errore tipo incasso
144050091211     c* Se errore di tipo "C" lo segnalo solo se non c'è orm con
144060091211     c* triangolazione oppure se è stato già scelto il beneficiario
144070091211     c* del contrassegno
144080091211    2c                   if        oticerr='T' or (oticerr='C' and
144090091211     c                             (nochkticC=*off or (wcassel1='X'or
144100091211     c                             wcassel2='X')))
144110090624     C                   MOVEL     oticmsg       VIDMSG
144120090624     C                   SETON                                        4990
144130090624     C                   GOTO      ENDC02
144140091211    2C                   ENDIF
144150090622     c* Errore divisa
144160090625    2c                   if        oticerr='D'
144170090624     C                   MOVEL     oticmsg       VIDMSG
144180090624     C                   SETON                                        5190
144190090624     C                   GOTO      ENDC02
144200090624    2C                   ENDIF
144210090624     c* Ulteriori controlli non presenti in TRULTICR
144220090625
144230060707     c* se tipo incasso richiede il mittente originale controllo che
144240060707     c* sia stato immesso
144250090625    2c                   if        §1amro='S' and vidrmo=*blanks
144260060707     C                   MOVEL     ERR(304)      VIDMSG
144270060707     C                   SETON                                        7190
144280060707     C                   GOTO      ENDC02
144290090625    2c                   endif
144300090625      * Devo lo stesso agganciare tabella "TM" perchè serve poi nella
144310090625      * routine di registrazione
144320090625     C                   MOVEL     'TM'          COD
144330090625     C                   MOVEL(P)  WKSC          KEY
144340090625     C*
144350090625     C                   EXSR      CTABEL
144360090625     c  n30              movel     tbluni        dstm
144370090625     c   30              clear                   dstm
144380090625     c*
144390090625    1c                   endif
144400011108     C*
144410011108     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE IL C/A
144420011108     C* INDICATORE DI CHANGE 11 ON
144430011108    1C     VARVCA        IFNE      VIDVCA
144440011108    2C     WIN11         IFEQ      *BLANKS
144450011108     C     VIDCAS        ANDNE     0
144460011108     C                   MOVEL     ERR(105)      VIDMSG
144470011108     C                   SETON                                        5090
144480011108     C                   GOTO      ENDC02
144490011108    2C                   ENDIF
144500011108     C*
144510011108    1C                   ENDIF
144520011108     C*
144530011212      * pulisco il flag x la forzatura importo C/Assegno
144540011212     C     VIDCAS        IFNE      WARCAS
144550011212     C                   CLEAR                   FORCAS
144560011212     C                   Z-ADD     VIDCAS        WARCAS
144570011212     C                   ENDIF
144580011212     C                   CLEAR                   FCASAV
144590011211     C* Richiamo TRUL21R per controllo limiti importo C/Assegno
144600090921    1C     VIDCAS        IFGT      *ZEROS
144610011211     C                   CLEAR                   DSUL21
144620011211     C                   MOVEL     VIDCBO        I21CBO
144630090921    2C     VIDTSP        IFNE      *BLANKS
144640011211     C                   MOVEL     VIDTSP        I21TSP
144650011211     C                   ELSE
144660011211     C                   MOVEL     COMTSP        I21TSP
144670090921    2C                   ENDIF
144680011211     C                   Z-ADD     VIDLNP        I21LNP
144690011211     C                   MOVEL     VIDNZM        I21NZM
144700011211     C                   Z-ADD     COMLNA        I21LNA
144710011211     C                   MOVEL     VIDNZD        I21NZD
144720130826    2C**   *IN04         IFEQ      *ON
144730130826     C**                 Z-ADD     9999          I21KSC
144740130826     C**                 MOVEL     VIDLNP        I21KSC
144750130826   x2C**                 ELSE
144760130826     c* in I21ksc passo il mittente
144770011211     C                   Z-ADD     VIDCCM        I21KSC
144780090921    3C     VIDFLC        IFEQ      0
144790011211     C                   MOVEL     VIDLNP        I21KSC
144800090921   x3C                   ELSE
144810011211     C                   MOVEL     VIDFLC        I21KSC
144820090921    3C                   ENDIF
144830130826     c                   if        vidccm=9999
144840130826     c                   move      8888          i21ksc
144850130826     c                   endif
144860130826    2C**                 ENDIF
144870011211     C                   MOVEL     VIDCTR        I21CTR
144880011211     C                   MOVEL     VIDTIC        I21TIC
144890011211     C                   Z-ADD     VIDCAS        I21IMP
144900011211     C                   MOVEL     VIDVCA        I21DIV
144910011211     C                   MOVEL     KNMUS         I21UTE
144920011211     C                   MOVEL     NOMPGM        I21PGM
144930011211     C                   CALL      'TRUL21R'
144940011211     C                   PARM                    DSUL21
144950011212     C* Salvo il flag del limite di abilitazione C/A che mi servirà per
144960011212     C* il richiamo del pgm di stampa L.V.
144970011212     C                   MOVE      O21FCA        FCASAV
144980011211     C* IMPORTO MAGGIORE DEL LIMITE MAX
144990090921    2C     O21FX2        IFNE      *BLANKS
145000011211     C                   MOVEA     ERR(131)      K78
145010011212     C                   MOVE      O21LX2        WNUMED
145020011212     C* richiamo routine per editare il limite
145030011212     C                   EXSR      CALLXE
145040011211      * metto il numero editato nel campo del messaggio
145050011211     C                   MOVEA     W014A         SKII(1)
145060011211     C                   MOVEA     SKII(1)       K78(47)
145070011211     C*
145080011211     C                   MOVEA     K78           VIDMSG
145090011211     C                   SETON                                        5090
145100011211     C                   GOTO      ENDC02
145110090921    2C                   ENDIF
145120090921     c
145130011211     C* IMPORTO INFERIORE AL LIMITE MINIMO
145140090921    2C     O21FMN        IFNE      *BLANKS
145150011212     C                   MOVEA     ERR(236)      K78
145160011212     C                   MOVE      O21LMN        WNUMED
145170011212     C* richiamo routine per editare il limite
145180011212     C                   EXSR      CALLXE
145190011212      * metto il numero editato nel campo del messaggio
145200011212     C                   MOVEA     W014A         SKII(1)
145210011212     C                   MOVEA     SKII(1)       K78(31)
145220011212     C*
145230011212     C                   MOVEA     K78           VIDMSG
145240011212     C                   SETON                                        5090
145250011212     C                   GOTO      ENDC02
145260090921    2C                   ENDIF
145270090921     c
145280011211     C* IMPORTO MAGGIORE DEL LIMITE FORZABILE
145290090921    2C     O21FX1        IFNE      *BLANKS
145300011212     C     FORCAS        ANDEQ     *BLANKS
145310011212     C                   MOVEL     '1'           FORCAS            1
145320011212     C                   MOVEA     ERR(237)      K78
145330011212     C                   MOVE      O21LX1        WNUMED
145340011212     C* richiamo routine per editare il limite
145350011212     C                   EXSR      CALLXE
145360011212      * metto il numero editato nel campo del messaggio
145370011212     C                   MOVEA     W014A         SKII(1)
145380011212     C                   MOVEA     SKII(1)       K78(24)
145390011212     C                   MOVEA     K78           VIDMSG
145400011212     C                   SETON                                        5090
145410011212     C                   GOTO      ENDC02
145420090921    2C                   ENDIF
145430090921     c
145440090921     c* Tipo servizio H non ammesso er C/ASS da abilitare
145450090921     c                   if        fcasav<>*blanks  and  vidtsp='H'
145460090921     c                   SETON                                        5090
145470090921     C                   MOVEL     ERR(149)      VIDMSG
145480090921     C                   GOTO      ENDC02
145490090921     c                   endif
145500090921     c
145510090921    1C                   ENDIF
145520090625     C*
145530011108     C                   MOVEL     VIDVCA        VARVCA
145540011108     C                   CLEAR                   WIN11
145550940916     C***
145560961111     C*** N O T E    ***
145570990610     C* SONO OBBLIGATORIE SE BOLLA PREPAGATO PER TELEFONO E REFERENTE
145580990610     C*  RITIRO
145590990610    3C     PARTCH        IFEQ      'P'
145600990610     C     SES           ANDEQ     0
145610010306    3C     §LPFPR        OREQ      'O'
145620010306     C     SES           ANDEQ     0
145630990610     C                   MOVEL     ERR(159)      VIDMSG
145640990610     C                   MOVEL     1             SES
145650990610     C                   SETON                                        8690
145660990610     C                   GOTO      ENDC02
145670990610    3C                   END
145680990610     C*
145690990610    3C     VIDNT1        IFEQ      *BLANKS
145700990610     C     VIDNT2        ANDEQ     *BLANKS
145710990610     C     PARTCH        ANDEQ     'P'
145720010306    3C     VIDNT1        OREQ      *BLANKS
145730010306     C     VIDNT2        ANDEQ     *BLANKS
145740010306     C     §LPFPR        ANDEQ     'O'
145750990610     C                   MOVEL     ERR(159)      VIDMSG
145760990610     C                   SETON                                        8690
145770990610     C                   GOTO      ENDC02
145780990610    3C                   END
145790961111     C***
145800961111     C*** IMPORTO DA ASSICURARE ***
145810961111     C***
145820950120     C* SE VARIATO ME LO SALVO
145830950120     C     *IN89         IFEQ      *ON
145840950120     C                   MOVEL     '1'           WIN89             1
145850950120     C                   ENDIF
145860950104     C*
145870011112     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
145880011112     C     VIDIAS        IFGT      *ZEROS
145890011112     C     VIDVAS        ANDEQ     *BLANKS
145900011112     C                   MOVEL     ERR(169)      VIDMSG
145910011114     C                   SETON                                        8190
145920011112     C                   GOTO      ENDC02
145930011112     C                   ENDIF
145940011112     C*
145950950104     C                   MOVEL     VIDVAS        WVLT
145960950104     C                   Z-ADD     VIDIAS        W0133            13 3
145970950104     C* CONTROLLO LA DIVISA
145980950104     C                   EXSR      CTRVLT
145990950104     C                   MOVEL     WVLT          VIDVAS
146000950104     C* ERRORE
146010950104     C   90              SETON                                        81
146020950104     C*
146030950104     C     WEMFOR        IFEQ      '1'
146040950104     C                   GOTO      ENDC02
146050950104     C                   ENDIF
146060011113     C*
146070011113     C* CONTROLLO SCADENZA DIVISA
146080011113     C     BLPDSP        IFGT      §CVDLI
146090011113     C     VIDIAS        ANDNE     0
146100011113     C                   MOVEL     ERR(232)      VIDMSG
146110011114     C                   SETON                                        8190
146120011113     C                   GOTO      ENDC02
146130011113     C                   ENDIF
146140950104     C*
146150950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
146160950104     C* INDICATORE DI CHANGE 89 ON
146170950104     C     VIDVAS        IFNE      VARVAS
146180950120     C     WIN89         ANDEQ     *BLANKS
146190011112     C     VIDIAS        ANDNE     0
146200950104     C                   MOVEL     ERR(105)      VIDMSG
146210950104     C                   SETON                                        8090
146220950104     C                   GOTO      ENDC02
146230950104    2C                   ENDIF
146240950104     C*
146250950104     C                   MOVEL     VIDVAS        VARVAS
146260950120     C                   CLEAR                   WIN89
146270940922     C*
146280940922     C* LO PRENDO SOLO PER LE SPEDIZIONI IN FRANCO PERCHE' IN ASSEGNATO
146290940922     C*  LA MERCE E' FRANCO STABILIMENTO, PER CUI DIVENTA DEL DESTINAT
146300941103    1C     *IN04         IFEQ      *OFF
146310940922     C* SOLO SE IL MITTENTE HA TARIFFE
146320941108     C     WTKS          ANDEQ     'S'
146330950104     C*
146340950104     C* SE <> 0 CONTROLLO CHE NON SUPERI IL VALORE IN TARIFFA
146350011211    2C     VIDIAS        IFNE      VARIAS
146360950104     C     VIDNCL        ORNE      VARNCL
146370950104     C                   Z-ADD     0             DIE
146380991028    2C                   END
146390940922     C*
146400940922    2C     VIDIAS        IFGT      0
146410940922     C     DIE           ANDNE     NUMFOR
146420950215     C     TAMFIS        ORNE      '0'
146430011211     C                   Z-ADD     VIDIAS        VARIAS
146440940922     C                   MOVEL     VIDNCL        VARNCL
146450960209     C* NON CONTROLLA DA TARIFFA SE OBBLIG.SE TIPO BOLLA NON PREVISTO
146460960209     C     §3ATB1        LOOKUP    TBL                                    30
146470960209     C*
146480960209   2AC     *IN30         IFEQ      *ON
146490940922     C*
146500940922     C* SOLO SE E' ASSICURAZIONE ANCHE PER LE PARTENZE ( <> A )
146510990818     C     KTPT          CHAIN     TITPT000                           30
146520950220    3C     *IN30         IFEQ      *ON
146530950220     C     TPTATB        ORNE      ' '
146540950220     C     TPTAPL        ORNE      'A'
146550950215     C*
146560950215     C* TAMFIS=1 OBBLIGATORIO     FORZABILE --> CON ENTER PRENDO MAX
146570950215     C*                                         IMPORTO DA TARIFFA
146580950215    4C     TAMFIS        IFEQ      '1'
146590950215     C     CIN           ANDNE     NUMFOR
146600011211     C     VIDIAS        ANDEQ     0
146610950215     C                   MOVEL     ERR(93)       VIDMSG
146620950215     C                   SETON                                        8090
146630950215     C                   ADD       1             CIN
146640950215     C                   GOTO      ENDC02
146650950215    4C                   ENDIF
146660950215     C*
146670950215     C* TAMFIS=3 OBBLIGATORIO NON FORZABILE --> ERRORE SEMPRE
146680950215    4C     TAMFIS        IFEQ      '3'
146690011211     C     VIDIAS        ANDEQ     0
146700950215     C                   MOVEL     ERR(94)       VIDMSG
146710950215     C                   SETON                                        8090
146720950215     C                   GOTO      ENDC02
146730950215    4C                   ENDIF
146740950215     C*
146750950215     C* TAMFIS=2 NON INSERIBILE             --> ERRORE SEMPRE
146760950215    4C     TAMFIS        IFEQ      '2'
146770011211     C     VIDIAS        ANDNE     0
146780950215     C                   MOVEL     ERR(95)       VIDMSG
146790950217     C                   SETON                                        8090
146800950215     C                   GOTO      ENDC02
146810950215    4C                   ENDIF
146820950220    3C                   ENDIF
146830950215     C* SE C'E VALORE MERCE:
146840950220    3C  N30TPTATB        IFEQ      ' '
146850950220     C     TPTAPL        ANDNE     'A'
146860950220     C     TPTVLM        ANDGT     0
146870940922     C* VALORE A COLLO
146880950220    4C     TPTFVM        IFEQ      '1'
146890991028     C     VIDNCL        MULT      TPTVLM        W0133A           13 3
146900950220   X4C                   ELSE
146910950220    5C     TPTFVM        IFEQ      '2'
146920991028     C                   Z-ADD     TPTVLM        W0133A
146930950220   X5C                   ELSE
146940940922     C     V2CPKG        ADD       0,9           W0060             6 0
146950991028     C     W0060         MULT      TPTVLM        W0133A
146960950220    5C                   END
146970950220    4C                   END
146980991028     C**
146990991028     C* TRASFORMO L'IMPORTO DA ASSICURARE NELLA DIVISA DELLA TARIFFA
147000011113     C                   Z-ADD     VIDIAS        IASTAR
147010991028    5C     COMDIV        IFNE      VIDVAS
147020991028     C                   CLEAR                   DSYEUR
147030991028     C                   MOVEL     VIDVAS        YECDVI
147040991028     C                   MOVEL     COMDIV        YECDVO
147050991028     C                   Z-ADD     VIDIAS        YECIMI
147060011113     C                   MOVE      COMDEC        YECDCO
147070991028     C*
147080991028     C                   CALL      'YEURCO'
147090991028     C                   PARM                    DSYEUR
147100991028     C*
147110991028    6C     YECESI        IFEQ      ' '
147120011113     C                   Z-ADD     YECIMO        IASTAR           17 3
147130991028    6C                   ENDIF
147140991028    5C                   ENDIF
147150940922     C*
147160011113    4C     IASTAR        IFGT      W0133A
147170950217     C     DIE           ANDNE     NUMFOR
147180940922     C                   ADD       1             DIE
147190940922     C                   MOVEL     ERR(97)       VIDMSG
147200941231     C                   SETON                                        8090
147210940922     C                   GOTO      ENDC02
147220950220    4C                   ENDIF
147230940922     C*
147240950215    3C                   ENDIF
147250960209   2AC                   ENDIF
147260960209    2C                   ENDIF
147270940922    1C                   ENDIF
147280940916     C*
147290011211      * pulisco il flag x la forzatura importo da assicurare forzabile
147300011211     C     VIDIAS        IFNE      WARIAS
147310011211     C                   CLEAR                   FORIAS
147320011211     C                   Z-ADD     VIDIAS        WARIAS
147330011211     C                   ENDIF
147340011211     C*
147350011211     C* CONTROLLO LIMITI IMPORTO DA ASSICURARE
147360011211     C     VIDIAS        IFGT      0
147370011211     C                   CLEAR                   DSUL22
147380011211     C                   MOVEL     VIDCBO        I22CBO
147390011211     C     VIDTSP        IFNE      *BLANKS
147400011211     C                   MOVEL     VIDTSP        I22TSP
147410011211     C                   ELSE
147420011211     C                   MOVEL     COMTSP        I22TSP
147430011211     C                   ENDIF
147440011212     C                   Z-ADD     VIDLNP        I22LPS
147450011211     C                   MOVEL     VIDNZM        I22NZM
147460011211     C                   Z-ADD     COMLNA        I22LNS
147470011211     C                   MOVEL     VIDNZD        I22NZD
147480011211     C     *IN04         IFEQ      *ON
147490011211     C                   Z-ADD     9999          I22KSC
147500011211     C                   MOVEL     VIDLNP        I22KSC
147510011211     C                   ELSE
147520011211     C                   Z-ADD     VIDCCM        I22KSC
147530011211     C     VIDFLC        IFEQ      0
147540011211     C                   MOVEL     VIDLNP        I22KSC
147550011211     C                   ELSE
147560011211     C                   MOVEL     VIDFLC        I22KSC
147570011211     C                   ENDIF
147580011211     C                   ENDIF
147590011211     C                   MOVEL     VIDCTR        I22CTR
147600011211     C                   Z-ADD     VIDIAS        I22IMP
147610011211     C                   MOVEL     VIDVAS        I22DIV
147620011211     C                   MOVEL     KNMUS         I22UTE
147630011211     C                   MOVEL     NOMPGM        I22PGM
147640011211     C                   CALL      'TRUL22R'
147650011211     C                   PARM                    DSUL22
147660011211     C* IMPORTO DA ASSICUARE NON AMMESSO
147670011211     C     O22FMN        IFNE      *BLANKS
147680011211     C     O22FX1        ANDNE     *BLANKS
147690011211     C     O22FX2        ANDNE     *BLANKS
147700011211     C                   MOVEL     ERR(234)      VIDMSG
147710011211     C                   SETON                                        8090
147720011211     C                   GOTO      ENDC02
147730011211     C                   ENDIF
147740011211     C* IMPORTO DA ASSICURARE > DEL LIMITE IMPOSTO
147750011211     C     O22FX2        IFNE      *BLANKS
147760011211     C                   MOVEA     ERR(96)       K78
147770011212     C                   MOVE      O22LX2        WNUMED
147780011212     C* richiamo routine per editare il limite
147790011212     C                   EXSR      CALLXE
147800011211      * metto il numero editato nel campo del messaggio
147810011211     C                   MOVEA     W014A         SKII(1)
147820011211     C                   MOVEA     SKII(1)       K78(38)
147830011211     C                   MOVEA     K78           VIDMSG
147840011211     C                   SETON                                        8090
147850011211     C                   GOTO      ENDC02
147860011211     C                   ENDIF
147870011211     C* IMPORTO DA ASSICURARE INFERIORE DEL LIMITE DI LEGGE
147880011211     C     O22FMN        IFNE      *BLANKS
147890011211     C                   MOVEA     ERR(165)      VIDMSG
147900011211     C                   SETON                                        8090
147910011211     C                   GOTO      ENDC02
147920011211     C                   ENDIF
147930011211     C* IMPORTO DA ASSICURARE > DEL LIMITE FORZABILE
147940011211     C     O22FX1        IFNE      *BLANKS
147950011211     C     FORIAS        ANDEQ     *BLANKS
147960011211     C                   MOVEL     '1'           FORIAS            1
147970011211     C                   MOVEA     ERR(235)      K78
147980011212     C                   MOVE      O22LX1        WNUMED
147990011212     C* richiamo routine per editare il limite
148000011212     C                   EXSR      CALLXE
148010011211      * metto il numero editato nel campo del messaggio
148020011211     C                   MOVEA     W014A         SKII(1)
148030011211     C                   MOVEA     SKII(1)       K78(28)
148040011211     C                   MOVEA     K78           VIDMSG
148050011211     C                   SETON                                        8090
148060011211     C                   GOTO      ENDC02
148070011211     C                   ENDIF
148080011211     C                   ENDIF
148090950102     C***
148100950102     C*** QUANTITA' DA FATTURARE  ***
148110950102     C                   MOVEL     VIDCTR        W001A
148120950102     C*
148130950103     C* SE MODIFICATA, PULISCO IL FLAG DI CONTROLLO
148140950102     C     VIDQFT        IFNE      VARQFT
148150950102     C                   CLEAR                   UND
148160950102     C                   MOVEL     VIDQFT        VARQFT
148170950102     C                   ENDIF
148180950102     C*
148190950103     C* CONTROLLO LA Q.TA DA FATTURARE CON TARIFFE SOLO SE C'E'
148200950103     C*  TARIFFA E SE E' FRANCO, PER ASSEGNATO E' DEL DESTINATARIO
148210950102    1C     WTKS          IFEQ      'S'
148220950102     C     W001A         ANDEQ     '4'
148230950103     C     *IN04         ANDEQ     *OFF
148240950102     C*
148250950102    2C     VIDQFT        IFEQ      0
148260950102     C*
148270950102     C* TAMFVD = '1' ASSUMO VALORE DA ASSICURARE SE NON IMMESSO
148280950103    3C     TAMFVD        IFEQ      '1'
148290950103     C     UND           ANDEQ     0
148300950102     C                   MOVEL     ERR(106)      VIDMSG
148310950102     C                   SETON                                        8490
148320950102     C                   MOVEL     1             UND
148330950102     C                   GOTO      ENDC02
148340950103    3C                   ENDIF
148350961007     C* TAMFVD = '2' O '4'  INSERIRE IN BOLLETTAZIONE
148360950103    3C     TAMFVD        IFEQ      '2'
148370961007     C     TAMFVD        OREQ      '4'
148380950102     C                   MOVEL     ERR(107)      VIDMSG
148390950102     C                   SETON                                        8490
148400950102     C                   GOTO      ENDC02
148410950103    3C                   ENDIF
148420950102     C*
148430950102   X2C                   ELSE
148440950102     C* TAMFVD = '3' ASSUME SEMPRE IMPORTO DA ASSICURARE: DA NON INSER
148450950102    3C     TAMFVD        IFEQ      '3'
148460950102     C                   MOVEL     ERR(108)      VIDMSG
148470950102     C                   SETON                                        8490
148480950102     C                   GOTO      ENDC02
148490950102    3C                   ENDIF
148500950102    2C                   ENDIF
148510950102    1C                   ENDIF
148520950102     c* TARIFFA A QUANTITA'
148530950102     C     W001A         IFEQ      '5'
148540950102     C     VIDQFT        ANDEQ     0
148550950102     C                   MOVEL     ERR(109)      VIDMSG
148560950102     C                   SETON                                        8490
148570950102     C                   GOTO      ENDC02
148580950102    3C                   ENDIF
148590940922     C***
148600940922     C*** VALORE MERCE DICHIARATO ***
148610940922     C*
148620011113     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
148630011113     C     VIDVMD        IFGT      *ZEROS
148640011113     C     VIDVAD        ANDEQ     *BLANKS
148650011113     C                   MOVEL     ERR(169)      VIDMSG
148660011113     C                   SETON                                        6990
148670011113     C                   GOTO      ENDC02
148680011113     C                   ENDIF
148690021118
148700021118      * Se Spedizione Export EuroExpress con ddt "S"
148710021118      *  ---> Obbligatorio il valore merce
148720021118     c                   If        SavGdd = 'S' and VidVmd = *Zeros
148730021118     c                             and a_§OgNtw = 'EEX'
148740021118     c                   Movel     Err(259)      VidMsg
148750021118     c                   Eval      *In82 = *On
148760021118     c                   Eval      *In90 = *On
148770021118     c                   Goto      Endc02
148780021118     c                   EndIf
148790011113     C*
148800940922     C                   MOVEL     VIDVAD        WVLT
148810940922     C                   Z-ADD     VIDVMD        W0133            13 3
148820940922     C* CONTROLLO LA DIVISA
148830940922     C                   EXSR      CTRVLT
148840940922     C                   MOVEL     WVLT          VIDVAD
148850940922     C* ERRORE
148860950410     C   90              SETON                                        69
148870940922     C*
148880940928    1C     WEMFOR        IFEQ      '1'
148890940922     C                   GOTO      ENDC02
148900940928    1C                   ENDIF
148910011113     C*
148920011113     C* CONTROLLO SCADENZA DIVISA
148930011113     C     BLPDSP        IFGT      §CVDLI
148940011113     C     VIDVMD        ANDNE     0
148950011113     C                   MOVEL     ERR(232)      VIDMSG
148960011113     C                   SETON                                        6990
148970011113     C                   GOTO      ENDC02
148980011113     C                   ENDIF
148990941219     C*
149000950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
149010941219     C* INDICATORE DI CHANGE 88 ON
149020941219    2C     VARVAD        IFNE      VIDVAD
149030950120     C     WIN88         ANDEQ     *BLANKS
149040011113     C     VIDVMD        ANDNE     0
149050941220     C                   MOVEL     ERR(105)      VIDMSG
149060941231     C                   SETON                                        8290
149070941219     C                   GOTO      ENDC02
149080941219     C                   ENDIF
149090941219     C*
149100941219     C                   MOVEL     VIDVAD        VARVAD
149110950120     C                   CLEAR                   WIN88
149120011212      * pulisco il flag x la forzatura valore merce
149130011212     C     VIDVMD        IFNE      WARVMD
149140011212     C                   CLEAR                   FORVMD
149150050714     c                   Clear                   forzavmd          1
149160011212     C                   Z-ADD     VIDVMD        WARVMD
149170011212     C                   ENDIF
149180011212     C* CONTROLLO LIMITI
149190011212     C                   CLEAR                   DSUL23
149200011212     C                   MOVEL     VIDCBO        I23CBO
149210011212     C     VIDTSP        IFNE      *BLANKS
149220011212     C                   MOVEL     VIDTSP        I23TSP
149230011212     C                   ELSE
149240011212     C                   MOVEL     COMTSP        I23TSP
149250011212     C                   ENDIF
149260011212     C                   Z-ADD     VIDLNP        I23LNP
149270011212     C                   MOVEL     VIDNZM        I23NZM
149280011212     C                   Z-ADD     COMLNA        I23LNA
149290011212     C                   MOVEL     VIDNZD        I23NZD
149300011212     C     *IN04         IFEQ      *ON
149310011212     C                   Z-ADD     9999          I23KSC
149320011212     C                   MOVEL     VIDLNP        I23KSC
149330011212     C                   ELSE
149340011212     C                   Z-ADD     VIDCCM        I23KSC
149350011212     C     VIDFLC        IFEQ      0
149360011212     C                   MOVEL     VIDLNP        I23KSC
149370011212     C                   ELSE
149380011212     C                   MOVEL     VIDFLC        I23KSC
149390011212     C                   ENDIF
149400011212     C                   ENDIF
149410011212     C                   MOVEL     VIDCTR        I23CTR
149420011212     C                   Z-ADD     VIDVMD        I23IMP
149430011212     C                   MOVEL     VIDVAD        I23DIV
149440011212     C                   MOVEL     KNMUS         I23UTE
149450011212     C                   MOVEL     NOMPGM        I23PGM
149460011212     C                   CALL      'TRUL23R'
149470011212     C                   PARM                    DSUL23
149480011212     C* IMPORTO INFERIORE AL LIMITE MINIMO
149490011212    1C     O23FMN        IFNE      *BLANKS
149500011212     C* Il messaggio è diverso a seconda che l'importo passato sia 0
149510011212     C* O > 0
149520011212    2C     VIDVMD        IFEQ      *ZEROS
149530011212     C                   MOVEL     ERR(238)      VIDMSG
149540011212   x2C                   ELSE
149550011212     C                   MOVEA     ERR(239)      K78
149560011212     C                   MOVE      O23LMN        WNUMED
149570011212     C* richiamo routine per editare il limite
149580011212     C                   EXSR      CALLXE
149590011212      * metto il numero editato nel campo del messaggio
149600011212     C                   MOVEA     W014A         SKII(1)
149610011212     C                   MOVEA     SKII(1)       K78(37)
149620011212     C                   MOVEA     K78           VIDMSG
149630011212    2C                   ENDIF
149640011212     C                   SETON                                        8290
149650011212     C                   GOTO      ENDC02
149660011212    1C                   ENDIF
149670011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO BLOCCANTE
149680011212     C     O23FX2        IFNE      *BLANKS
149690011212     C                   MOVEA     ERR(240)      K78
149700011212     C                   MOVE      O23LX2        WNUMED
149710011212     C* richiamo routine per editare il limite
149720011212     C                   EXSR      CALLXE
149730011212      * metto il numero editato nel campo del messaggio
149740011212     C                   MOVEA     W014A         SKII(1)
149750011212     C                   MOVEA     SKII(1)       K78(53)
149760011212     C                   MOVEA     K78           VIDMSG
149770011212     C                   SETON                                        8290
149780011212     C                   GOTO      ENDC02
149790011212     C                   ENDIF
149800011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO FORZABILE
149810011212     C     O23FX1        IFNE      *BLANKS
149820011212     C     FORVMD        ANDEQ     *BLANKS
149830011212     C                   MOVE      '1'           FORVMD            1
149840011212     C                   MOVEA     ERR(241)      K78
149850011212     C                   MOVE      O23LX1        WNUMED
149860011212     C* richiamo routine per editare il limite
149870011212     C                   EXSR      CALLXE
149880011212      * metto il numero editato nel campo del messaggio
149890011212     C                   MOVEA     W014A         SKII(1)
149900011212     C                   MOVEA     SKII(1)       K78(30)
149910011212     C                   MOVEA     K78           VIDMSG
149920011212     C                   SETON                                        8290
149930011212     C                   GOTO      ENDC02
149940011212     C                   ENDIF
149950950410     C* SE IMP ASSICURARE E VAL MERCE HANNO STESSO IMPORTO--> DEVONO
149960950410     C*  AVERE  ANCHE STESSA DIVISA E VICEVERSA
149970050714      * msg forzabile
149980950410    1C     VIDVMD        IFGT      0
149990950410     C*
150000950410     C     VIDIAS        IFEQ      VIDVMD
150010950410     C     VIDVAD        ANDNE     VIDVAS
150020050714     c     forzavmd      andeq     *Blanks
150030050714     c                   Eval      vidmsg = ERR(122)
150040950410     C                   SETON                                        6990
150050050714     c                   Eval      forzavmd = '1'
150060950410     C                   GOTO      ENDC02
150070950410    2C                   ENDIF
150080950410     C     VIDVAD        IFEQ      VIDVAS
150090950410     C     VIDIAS        ANDGT     0
150100950410     C     VIDIAS        ANDNE     VIDVMD
150110050714     c     forzavmd      andeq     *Blanks
150120050714     c                   Eval      vidmsg = ERR(122)
150130950410     C                   SETON                                        8290
150140050714     c                   Eval      forzavmd = '1'
150150950410     C                   GOTO      ENDC02
150160950410    2C                   ENDIF
150170950410     C*
150180950410    1C                   ENDIF
150190940913     C***
150200930329     C*** CONSEGNA RICHISTA ***
150210090901     c*  non accetto la consegna richiesta se tipo servizio H
150220150202     c                   if        (viddcr>0 or vidhcr>0) and vidtsp='H'
150230090901     C                   MOVEL     ERR(60)       VIDMSG
150240090901     C                   SETON                                        5990
150250090901     c                   goto      endc02
150260090901     c                   endif
150270090901     c
150280941115     C                   Z-ADD     VIDDCR        WDCR
150290941115     C                   Z-ADD     VIDHCR        WHCR
150300941115     C                   Z-ADD     VIDMCR        WMCR
150310940913     C                   MOVEL     VIDTCR        WTCR
150320940913     C                   EXSR      CTRCR
150330940916     C                   MOVEL     WDCR          VIDDCR
150340940920     C   90              GOTO      ENDC02
150350101022     c
150360101022     c* Controllo se cade in giorno festivo col calendario arrivi
150370101022    1c                   if        vidtcr=' '  and viddcr>0
150380101022     c                   movel     comdcr        wdata
150390101022     c                   clear                   w0030
150400101022     C     KCLNa         CHAIN     AZCLN01L                           30
150410101022     C   30              CLEAR                   CLNPOM
150420101022     C                   MOVEA     CLNPOM        K31
150430101022     C                   MOVEL     K31(WGG)      WFEST
150440101022     c     wfest         lookup    S1Y                                    30
150450101022     c
150460101022     c                   if        *in30 and wfest<>' '
150470141124     c                   select
150480141124     c                   when      a_§ogntw<>'FED' and a_§ogntw<>'DPD'
150490141124     c                             and a_§ogntw<>'EEX'
150500101022     C                   MOVEL     ERR(197)      VIDMSG
150510101022     C                   SETON                                        5990
150520101022     C                   GOTO      ENDC02
150530141124     c                   when      comlna<>wforz_lna
150540141124     c                   eval      wforz_lna=comlna
150550141124     C                   MOVEL     ERR(197)      VIDMSG
150560141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
150570141124     C                   SETON                                        5990
150580141124     C                   GOTO      ENDC02
150590141124     c                   endsl
150600101022    2C                   ENDIF
150610101022    1C                   ENDIF
150620940916     C***
150630960319     C*** GIORNI DI CHIUSURA ***
150640960319     C                   MOVEL     VIDGC1        WGC1
150650960319     C                   MOVEL     VIDGC2        WGC2
150660960319     C                   EXSR      CTRGCH
150670960319     C   90              GOTO      ENDC02
150680940214     C*
150690100219     c
150700940919     C***
150710940919     C*** PARTICOLARITA' C/A ***
150720940919    1C     VIDGCA        IFNE      *BLANKS
150730941005     C     VIDGCR        ORNE      *BLANKS
150740031029      * salto questo controllo
150750031029      * xchè per ora la particolarità c/a non deve essere gestita
150760031029     c                   GoTo      DopoMsg
150770940922     C*
150780940922     C* non posso indicarla se tipo bolla non prevede C/Assegno
150790940928    2C     §3AFCA        IFEQ      0
150800941005     C     VIDGCA        ANDNE     *BLANKS
150810940922     C                   SETON                                        6590
150820940922     C                   MOVEL     ERR(103)      VIDMSG
150830940922     C                   GOTO      ENDC02
150840940922    2C                   ENDIF
150850031029     c     DopoMsg       Tag
150860940922     C*
150870941005     C* RICHIAMO IL PRG DI RICERCA
150880941005    2C     VIDGCR        IFEQ      '?'
150890031029      * non devo fare nessuna ricerca xchè per ora la particolarità c/a non
150900031029      * deve essere gestita
150910031029     c                   GoTo      DopoRicGca
150920941005     C                   CLEAR                   DS7PQR
150930941005     C                   MOVEL     'S'           DS7RIC
150940941005     C                   MOVEL     'V'           DS7GES
150950941005     C                   MOVEL     WKSC          DS7KSC
150960941005     C                   MOVEL     VIDGCA        DS7COD
150970941005     C                   MOVEL     DS7PQR        KPJBU
150980941005     C                   CALL      'TRTB72R'
150990941005     C                   PARM                    KPJBA
151000941005     C                   MOVEL     KPJBU         DS7PQR
151010111110     C***                CLEAR                   VIDGCR
151020941005     C*
151030941005     C     VIDGCA        IFEQ      *BLANKS
151040941005     C                   MOVEL     DS7COD        VIDGCA
151050941005    2C                   ENDIF
151060941005     C*
151070111110     c     DopoRicGca    Tag
151080111110     C                   CLEAR                   VIDGCR
151090960109     C                   SETON                                        65
151100941005     C                   MOVEL     '1'           WEMFOR
151110111110     c***  DopoRicGca    Tag
151120941005     C                   GOTO      ENDC02
151130941005    2C                   ENDIF
151140941005     C* CONTROLLO
151150031029      * non devo fare nessun controllo xchè per ora la particolarità c/a non
151160031029      * deve essere gestita
151170031029      * ma se immessa emetto un errore
151180031029     c                   Eval      VidMsg = Err(31)
151190031029     c                   Eval      *In65 = *On
151200031029     c                   Eval      *In90 = *On
151210031029     c                   Goto      EndC02
151220031029
151230941005     C                   CLEAR                   DS7PQR
151240941005     C                   MOVEL     'S'           DS7RIC
151250941005     C                   MOVEL     'C'           DS7GES
151260941005     C                   MOVEL     WKSC          DS7KSC
151270941005     C                   MOVEL     VIDGCA        DS7COD
151280941005     C                   MOVEL     DS7PQR        KPJBU
151290941005     C                   CALL      'TRTB72R'
151300941005     C                   PARM                    KPJBA
151310941005     C                   MOVEL     KPJBU         DS7PQR
151320941005     C* ERRORE
151330941005    2C     DS7ERR        IFEQ      '1'
151340941005     C                   MOVEL     DS7MSG        VIDMSG
151350941005     C                   SETON                                        6590
151360940920     C                   GOTO      ENDC02
151370940919    2C                   ENDIF
151380940922     C*
151390940922    1C                   ENDIF
151400940919     C***
151410940919     C*** PARTICOLARITA' GIACENZA ***
151420940919    1C     VIDGGA        IFNE      *BLANKS
151430941005     C     VIDGGR        ORNE      *BLANKS
151440941005     C*
151450941005     C* RICHIAMO IL PRG DI RICERCA
151460951120    2C     VIDGGR        IFEQ      '?'
151470941005     C                   CLEAR                   DS7PQR
151480941005     C                   MOVEL     'S'           DS7RIC
151490941005     C                   MOVEL     'V'           DS7GES
151500941005     C                   MOVEL     VIDGGA        DS7COD
151510941005     C                   MOVEL     DS7PQR        KPJBU
151520941005     C                   CALL      'TRTB69R'
151530941005     C                   PARM                    KPJBA
151540941005     C                   MOVEL     KPJBU         DS7PQR
151550960109     C                   CLEAR                   VIDGGR
151560941005     C*
151570941005     C     VIDGGA        IFEQ      *BLANKS
151580941005     C                   MOVEL     DS7COD        VIDGGA
151590941005    2C                   ENDIF
151600941005     C*
151610960109     C                   SETON                                        66
151620941005     C                   MOVEL     '1'           WEMFOR
151630941005     C                   GOTO      ENDC02
151640941005    2C                   ENDIF
151650941005     C* CONTROLLO
151660941005     C                   CLEAR                   DS7PQR
151670941005     C                   MOVEL     'S'           DS7RIC
151680941005     C                   MOVEL     'C'           DS7GES
151690941005     C                   MOVEL     WKSC          DS7KSC
151700941005     C                   MOVEL     VIDGGA        DS7COD
151710941005     C                   MOVEL     DS7PQR        KPJBU
151720941005     C                   CALL      'TRTB69R'
151730941005     C                   PARM                    KPJBA
151740941005     C                   MOVEL     KPJBU         DS7PQR
151750941005     C* ERRORE
151760941005    2C     DS7ERR        IFEQ      '1'
151770941005     C                   MOVEL     DS7MSG        VIDMSG
151780941005     C                   SETON                                        6690
151790940920     C                   GOTO      ENDC02
151800940919    2C                   ENDIF
151810940919    1C                   ENDIF
151820940919     C***
151830940919     C*** PARTICOLARITA' CONSEGNA ***
151840100218     c                   clear                   ds7r
151850940922    1C     VIDGMA        IFNE      *BLANKS
151860951120     C     VIDGMR        ORNE      *BLANKS
151870941005     C* RICHIAMO IL PRG DI RICERCA
151880941005    2C     VIDGMR        IFEQ      '?'
151890941005     C                   CLEAR                   DS7PQR
151900941005     C                   MOVEL     'S'           DS7RIC
151910941005     C                   MOVEL     'V'           DS7GES
151920941005     C                   MOVEL     VIDGMA        DS7COD
151930941005     C                   MOVEL     DS7PQR        KPJBU
151940941005     C                   CALL      'TRTB70R'
151950941005     C                   PARM                    KPJBA
151960941005     C                   MOVEL     KPJBU         DS7PQR
151970960109     C                   CLEAR                   VIDGMR
151980941005     C*
151990941005     C     VIDGMA        IFEQ      *BLANKS
152000941005     C                   MOVEL     DS7COD        VIDGMA
152010941005    2C                   ENDIF
152020941005     C*
152030960109     C                   SETON                                        67
152040941005     C                   MOVEL     '1'           WEMFOR
152050941005     C                   GOTO      ENDC02
152060941005    2C                   ENDIF
152070941005     C* CONTROLLO
152080941005     C                   CLEAR                   DS7PQR
152090941005     C                   MOVEL     'S'           DS7RIC
152100941005     C                   MOVEL     'C'           DS7GES
152110941005     C                   MOVEL     WKSC          DS7KSC
152120941005     C                   MOVEL     VIDGMA        DS7COD
152130941005     C                   MOVEL     DS7PQR        KPJBU
152140941005     C                   CALL      'TRTB70R'
152150941005     C                   PARM                    KPJBA
152160941005     C                   MOVEL     KPJBU         DS7PQR
152170941005     C* ERRORE
152180941005    2C     DS7ERR        IFEQ      '1'
152190100215     C                   MOVEL     DS7MSG        VIDMSG
152200941005     C                   SETON                                        6790
152210940920     C                   GOTO      ENDC02
152220940919    2C                   ENDIF
152230100215     c*
152240100215     c* Da tabella 7R verifico se prevede il calcolo della consegna
152250100215     c*  richeista (Tab DCR) e segnalo eventuali incongruenze
152260100215     C                   MOVEL     '7R'          COD
152270100215     C                   MOVEL(P)  VIDGMA        KEY
152280100215     C                   EXSR      CTABEL
152290100215     C                   MOVEL     TBLUNI        DS7R
152300100215     c
152310100215     c                   if        §7ratt ='S' and
152320100215     c                             (vidtsp='H' or vidtsp='E')
152330100215     C                   MOVEL     err(332)      VIDMSG
152340100215     C                   SETON                                        6790
152350100215     C                   GOTO      ENDC02
152360100215    2C                   ENDIF
152370100218     c
152380100224    1c                   if        §7ratt ='S' and
152390100217     c                             (vidore>0 or viddcr>0 )
152400100218     c* In manutenzione non do errore se la particolarità c'era
152410100218     c*  anche prima
152420100224     c* Se richiamato da pgm di cambio porto dirottamento non do errore
152430100224     c                   if        not *in44 and (not *in12 or *in15 or
152440100224     c                              blpgma<>vidgma)
152450100215     C                   MOVEL     err(333)      VIDMSG
152460100215     C                   SETON                                        6790
152470100215     C                   GOTO      ENDC02
152480100215    2C                   ENDIF
152490100224    1C                   ENDIF
152500100218     c
152510100224     c                   if        §7ratt ='S' and (§3arbl='R' or
152520100224     c                             §3arbl='C' and §3aucb=' ')
152530100217     C                   MOVEL     err(334)      VIDMSG
152540100217     C                   SETON                                        6790
152550141201c    C                   GOTO      ENDC02
152560100217    2C                   ENDIF
152570151015
152580151015     c* Particolarità consegna "RC"  non utilizzabile per bolle export
152590151015If  2c                   If        §7rRC = 'S'  and
152600151015     c                             (A_§ogntw='FED' or
152610151015     c                             a_§ogntw='EEX' or
152620151015     c                             a_§ogntw='DPD')
152630151015     c                   seton                                        6790
152640151015     C                   MOVEL     err(363)      VIDMSG
152650151015     c                   eval      %subst(vidmsg:25:2)=vidgma
152660151015     c                   GoTo      EndC02
152670151015     c                   endif
152680100215     c
152690030805      * Se la bolla prevede la particolarità consegne 'RC' devo controllare
152700030805      * che esista l'ORM da utilizzare per il ritiro contestuale alla consegna
152710030912      * solo se non sono chiamata da giacenze
152720100604If  2c**                 If        VidGma = 'RC' and
152730100604If  2c                   If        §7rRC = 'S'   and
152740030912If  2c                             savfpr <> 'G' and savfpr <> 'P'
152750150302     c                             and savfpr<>'B'
152760031217     c                   Eval      wope = 'C'
152770030805     c                   ExSr      Sr_RicOrm
152780030805If  3c                   If        *In90 = *On
152790030805     c                   GoTo      EndC02
152800030805    3c                   EndIf
152810030805    2c                   EndIf
152820940919    1C                   ENDIF
152830100219     c
152840141201     c* Controlli Congruenza fra PinCode e Codice Particolarità
152850141201     c* se bolla export errore forzabile se presente particolartià che
152860141201     c* prevede PIN Code
152870141201     c                   if        A_§ogntw='FED' or
152880141201     c                             a_§ogntw='EEX' or
152890141201     c                             a_§ogntw='DPD'
152900141201     c                   if        §7rpincode='S' and WforzPCExp=' '
152910141201     c                   eval      WforzPCExp='1'
152920141201     c                   seton                                        6790
152930141201     C                   MOVEL     err(352)      VIDMSG
152940141201     c                   GoTo      EndC02
152950141201     c                   endif
152960141201     c                   else
152970141201     c* Controlli per bolla NON Export
152980141202     c* non eseguo questi controlli se provengo da pgm giacenze
152990141202     c                   if        not *in44
153000141201     c                   select
153010141201     c                   when      wpincode<>*blanks and  (
153020141201     c                             (vidgma=*blanks) or
153030141201     c                             (vidgma<>*blanks and §7rpincode<>'S'))
153040141201     c                   seton                                        6790
153050141201     C                   MOVEL     err(353)      VIDMSG
153060141201     c                   GoTo      EndC02
153070141201     c                   when      wpincode=*blanks and vidgma<>*blanks
153080141201     c                             and §7rpincode='S'
153090141201     c                   seton                                        6790
153100141201     C                   MOVEL     err(354)      VIDMSG
153110141201     c                   GoTo      EndC02
153120141201     c                   endsl
153130141202     c* se provengo da pgm giacenze controllo che non si modifichi la particola-
153140141202     c* rità giacenza rispetto a quella passata da "pin code" a "no pin code"
153150141202     c* o viceversa
153160141202     c                   else
153170141202     c                   if        vidgma<>§lpgma and
153180141202     c                             w7rPC<>§7rpincode
153190141202     c                   seton                                        6790
153200141202     C                   MOVEL     err(357)      VIDMSG
153210141202     c                   GoTo      EndC02
153220141202     c                   endif
153230141202     c                   endif
153240141201     c                   endif
153250141201     c*
153260100219     C* DATA CONSEGNA NON PUO' ESSERE < DATA CONSEGNA TEORICA
153270100219     C* SE TIPO CONSEGNA E' ' ' O 'P' (IL O PRIMA DEL)
153280100219     C* (QUESTO CONTROLLO LO METTO DOPO I GIORNI CHIUSURA e dopo la partic.
153290100219     C*  consegna perchè mi SERVONO E CORRETTI)
153300100219     c* data consegna non puo' essere > data consegna teorica più i gio
153310100219     c* rni di tolleranza oltre delivery come da tabella vpo
153320100219    1C     VIDDCR        IFGT      0
153330100219     C* CALL AL TNSD99
153340100219     c                   clear                   UsaCass
153350100219     C                   EXSR      CLSE98
153360100219     c                   z-add     d98dce        s_d98dce
153370100219   1aC     VIDTCR        ifne      'D'
153380100219     C*
153390100219    2C     COMDCR        IFLT      D98DCE
153400100219     c* se tipo servizio "Distribuzione" richiamo nuovamente TNSD99R passand
153410100219     c* ogli tipo servizio corriere. Infatti se la data consegna richiesta
153420100219     c* è inferiore anche della data teorica per il servizio corriere l'erro
153430100219     c* re è bloccante altrimenti è forzabile
153440100219    3c                   if        d98tsp = 'D'
153450100219     c                   eval      d98tsp = 'C'
153460100219     C                   CALL      'TNSD99R'
153470100219     C                   PARM                    DSSD99
153480100219    4c     comdcr        ifge      d98dce
153490100219    5c     uno           ifne      '1'
153500100219     C                   MOVEL     ERR(62)       VIDMSG
153510100219     C                   seTON                                        5990
153520100219     C                   MOVEL     '1'           UNO
153530100219     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
153540100219     C                   GOTO      ENDC02
153550100219    5c                   endif
153560100219   x4c                   else
153570100219     C                   MOVEL     ERR(62)       VIDMSG
153580100219     C                   SETON                                        5990
153590100219     c                   goto      endc02
153600100219    4c                   endif
153610100219   x3c                   else
153620100219     C                   MOVEL     ERR(62)       VIDMSG
153630100219     C                   SETON                                        5990
153640100219     C                   GOTO      ENDC02
153650100219    3c                   endif
153660100219    2C                   ENDIF
153670100219   1aC                   ENDIF
153680100219     c** Aggiungo alla data consegna teorica i giorni previsti in tabella
153690100219      *  escludendo i festivi
153700100219      *  questo messaggio non lo do per particolarità di ATTESA
153710100219    2c                   if        vidgma= *blanks  or  §7rATT=' '
153720100219     c                   Clear                   Trul13ds
153730100219     c                   Eval      tI13Tla = 'L'
153740100219     c                   Eval      I13Mod = 'A'
153750100219     c                   Eval      I13Fil = comlna
153760100219     c                   Eval      I13Din = S_d98dce
153770100219     c                   Eval      I13gio = §vpodcrod
153780100219     c                   Call      'TRUL13R'
153790100219     c                   Parm                    Trul13ds
153800100219    3c                   If        tO13Err = *Blanks  and
153810100219     c                             comdcr > o13dfi and fordcr = *blanks
153820100219     c                   eval      vidmsg = err(294)
153830100219     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
153840100219     c                             %trim(%editc(§vpodcrod:'Z'))  +
153850100219     c                             ' giorni la data consegna teorica.' +
153860100219     c                             'ENTER x FORZ.'
153870100219     C                   SETON                                        5990
153880100219     c                   movel     '1'           fordcr
153890100219     C                   GOTO      ENDC02
153900100219    3c                   endif
153910100219    2C                   ENDIF
153920100219    1C                   ENDIF
153930100219     c
153940050415     c* Se particolarita varia = 'O' il controllo seguente l'ho già
153950050415     c* fatto prima del calcolo del volume automatico
153960150304     c****               if        %subst(vidgva:1:1)<>'O'
153970150304     c****               exsr      sr_CntPVBan
153980150304     c**** wemfor        ifeq      '1'
153990150304     c***                goto      endc02
154000150304     c****               endif
154010150304     c****               endif
154020040216
154030040216      * --> Telefono del destinatario
154040040216      *     (da immettere in prima videata)
154050040216      * x Spedizione con Appuntamento
154060040216      * x Spedizione con consegna a PRIVATI
154070040216if  1c                   If        VidTel = *Blanks and wforza1 = *Off and
154080150213     c                             wforza2 = *Off and not *in12
154090040216s   2c                   Select
154100040216     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
154110040216     c                   Eval      VidMsg = Err(267)
154120040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
154130040216     c                   Eval      *In90 = *On
154140170412     c****               When      %subst(VidGva:1:1) = 'P'
154150170412     c****               Eval      VidMsg = Err(58)
154160170412     c****               Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
154170170412     c****               Eval      *In90 = *On
154180040216    2c                   EndSl
154190040216if  2c                   If        *In90
154200040216     c                   Eval      wforza2 = *On
154210040216     c                   GoTo      EndC02
154220040216    2c                   EndIf
154230040216    1c                   EndIf
154240040610     C***
154250040610     C*** Tipo MERCE V-Valore ***
154260040610    1C     VIDbva        ifne      *BLANKS
154270040610     c     §1bfg8        andne     'S'
154280040610     C                   MOVEL     ERR(281)      VIDMSG
154290040610     C                   SETON                                        90
154300040610     c                   z-add     20            H2riga
154310040610     c                   z-add     80            H2colo
154320040610     C                   GOTO      ENDC02
154330040610    1C                   END
154340940919     C***
154350050309     c*
154360050309     c* Essendosi verificato un caso di bolla immessa senza il cod boll
154370050309     c* per sicurezza aggiungo il seguente controllo
154380050309     c     vidcbo        ifeq      *blanks
154390050309     C                   MOVEL     ERR(292)      VIDMSG
154400050309     C                   SETON                                        90
154410050309     C                   GOTO      ENDC02
154420050309     c                   endif
154430160511     c* Indirizzo email e numero di cellulare per invio SMS:
154440160512     c* non sono da memorizzare se bolla export NON DPD
154441170421     c* ora EEX come DPD
154450160511     c                   if        sav_wemdest<>*blanks
154460160511     c                   if            wdesie='E' and
154470170421     c                             a_§ogntw<>'DPD' and
154471170421     c                             a_§ogntw<>'EEX'
154480160511     c                   clear                   wemdest
154490160511     c                   else
154500160511     c* se hanno cambiato il newtork riprendo l'eventuale indirizzo email
154510160511     c                   eval      wemdest=sav_wemdest
154520160511     c                   endif
154530160511     c                   endif
154540160511     c* numero di cellulare per invio sms
154550160511     c                   if        sav_wsms<>*blanks
154560160511     c                   if        wdesie='E' and
154570170421     c                             a_§ogntw<>'DPD' and
154571170421     c                             a_§ogntw<>'EEX'
154580160511     c                   clear                   wsms
154590160511     c                   else
154600160511     c* se hanno cambiato il newtork riprendo l'eventuale numero di cell
154610160511     c                   eval      wsms=sav_wsms
154620160511     c                   endif
154630160511     c                   endif
154640940919     C*** FINE SUBROUTINE
154650940920     C     ENDC02        TAG
154660940826     C   90              MOVEL     '1'           WEMFOR
154670941021     C*
154680940826     C                   ENDSR
154690160224     C* Richiamo cappario dpd -----------------------------------
154700160224     c     sr_tisie3     begsr
154710160224     c                   clear                   tisie3ds
154720160224     c                   eval      isie3tla='E'
154730160224     c                   z-add     blpdsp        isie3dri
154740160224     C                   z-add     BLPDSP        Isie3dsp
154750160224     c                   time                    isie3hsp
154760160224     C                   MOVEL     VIDNZD        isie3nzd
154770160224     C                   MOVEL     VIDCAD        Isie3cad
154780160224     c                   movel     vidlod        isie3cty
154790160224     c                   z-add     vidlnp        isie3lnp
154800160224     C     VIDFBR        IFEQ      'S'
154810160224     c                   z-add     300           isie3srv
154820160224     c                   else
154830160224     c                   if        v2cpkg>§3ilmp
154840160224     c                   z-add     101           isie3srv
154850160224     c                   else
154860160224     c                   z-add     136           isie3srv
154870160224     c                   endif
154880160224     c                   endif
154890160224     c                   movel     'N'           isie3exc
154900160224     C                   CALL      'TISIE3R'
154910160224     C                   PARM                    tisie3ds
154920160224     c                   endsr
154930091211     C* Richiamo trulticr per controllo tipo incasso c/a e divisa  ---*
154940091211     c     sr_trultic    begsr
154950091211     c                   clear                   trulticds
154960091211     c                   clear                   ds1a
154970091211     c                   eval      iticTBO='P'
154980091211     c                   eval      iticlnp=vidlnp
154990091211     c                   eval      iticlna=comlna
155000091211     c                   eval      iticlnantw=A_§ogntw
155010091211     c                   eval      iticnzd=vidnzd
155020091211     c                   eval      iticprd=vidprd
155030091211     c                   eval      iticcad=vidcad
155040091211     c                   eval      iticlod=vidlod
155050091211     c                   eval      iticind=vidind
155060091211     c                   eval      iticrsd=vidrsd
155070091211     c                   eval      iticdsp=blpdsp
155080091211     c* se orm con triangolazione e beneficiario ordinante-->passo ordinante
155090091211     c* altrimenti sempre il mittente
155100091211     c                   if        nochkticC=*on and wcassel2='X'
155110091211     C                   eval      iticccm=ormksc
155120091211     c                   else
155130091211     C                   eval      iticccm=wksc
155140091211     c                   endif
155150091211
155160091211     c                   eval      itictic=vidtic
155170091211     c                   eval      iticdiv=vidvca
155180091211     c                   eval      iticcas=vidcas
155190091211     c                   eval      iticpgm='FNLS01R'
155200091211     c* 44 on = richiamato da pgm giacenze --> devo passare
155210091211     c*         l'info a trultic per far si che venga bypassato il
155220091211     c*         controllo su tabella "TM"
155230091211    2c                   if        *in44
155240091211     c                   eval      %subst(iticpgm:10:1)='1'
155250091211    2c                   endif
155260091211     c                   call      'TRULTICR'
155270091211     c                   parm                    TRULTICDS
155280091211     c                   parm                    ds1a
155290091211     c*
155300091211     c                   endsr
155310091211     c*
155320091211     C* Impostazinoe flag per controllo tic --------------------------*
155330091211     C     sr_impochktic BEGSR
155340091211     C*
155350091214     c                   eval      nochkticC=*off
155360091211     c                   if        dateu>=§vpocas
155370091211     c                   if        §3afca<>0 and flgfit<>'S' and ormpag='O'
155380091211     c                             and §1amro<>'S'
155390091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
155400091211     c                                 %editc(ormksc:'X')
155410091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
155420091211     c                                 %subst(%editc(ormcor:'X'):1:7)
155430091211     c                   eval      nochkticC=*on
155440091211     c                   endif
155450091211     c                   endif
155460091211     c                   endsr
155470940922     C*
155480940922     C* CONTROLLO DIVISA ---------------------------------------------*
155490940922     C     CTRVLT        BEGSR
155500940922     C*
155510940922     C                   MOVEL     'CV'          COD
155520940922     C* RICERCA
155530940922     C     '?'           SCAN      WVLT                                   30
155540940922     C     *IN30         IFEQ      *ON
155550940922     C                   EXSR      CX§TAB
155560940922     C                   MOVEL     §KEY          WVLT
155570940922     C                   GOTO      ENDVLT
155580940922     C                   ENDIF
155590940922     C*
155600940922     C* CONTROLLO DIVISA
155610940922     C                   MOVEL(P)  WVLT          KEY
155620940922     C                   EXSR      CTABEL
155630940922     C* ERRORE
155640940922    1C     *IN30         IFEQ      *ON
155650941110     C                   MOVEL     ERR(79)       VIDMSG
155660940922     C                   SETON                                        90
155670940922     C                   GOTO      ENDVLT
155680940922    1C                   ENDIF
155690940922     C                   MOVEL     TBLUNI        DSCV
155700940922     C*
155710940922     C* VEDO SE AMMESSI IMPORTI DECIMALI NELL'IMPORTO
155720940922    1C     §CVFDC        IFNE      'S'
155730940922     C                   MOVE      W0133         W0033             3 3
155740940922    2C     W0033         IFNE      0
155750941110     C                   MOVEL     ERR(78)       VIDMSG
155760940922    2C                   ENDIF
155770991025      *
155780991025   X1C                   ELSE
155790991025      * VERIFICO SE I DECIMALI INSERITI SONO QUELLLI AMMESSI
155800991025     C                   SELECT
155810991025     C     §CVDEC        WHENEQ    3
155820991025     C     §CVDEC        WHENEQ    2
155830991025     C                   MOVE      W0133         W0010             1 0
155840991025     C     W0010         IFNE      *ZEROS
155850991025     C                   MOVEL     ERR(171)      VIDMSG
155860991025     C                   ENDIF
155870991025     C     §CVDEC        WHENEQ    1
155880991025     C                   MOVE      W0133         W0020             2 0
155890991025     C     W0020         IFNE      *ZEROS
155900991025     C                   MOVEL     ERR(171)      VIDMSG
155910991025     C                   ENDIF
155920991025     C     §CVDEC        WHENEQ    0
155930991025     C                   ENDSL
155940991025      *
155950991025    1C                   ENDIF
155960991025      *
155970991025     C     VIDMSG        IFNE      *BLANKS
155980991025     C                   SETON                                        90
155990991025     C                   GOTO      ENDVLT
156000991025     C                   ENDIF
156010940922     C*
156020940922     C     ENDVLT        TAG
156030940922     C   90              MOVEL     '1'           WEMFOR
156040940922     C                   ENDSR
156050940916     C*
156060940916     C* PREPARA IL MESSAGGIO DI SEGNACOLLO DOPPIO -------------------*
156070940916     C     PRPMSG        BEGSR
156080940916     C* MUOVO LA SKIERA DELL ERRORE
156090940916     C                   MOVEA     ERR(92)       K78
156100940916     C*
156110940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL SEGNACOLLO
156120940916     C                   MOVEL     COMSCD        W007A             7
156130950718     C                   MOVEA     W007A         SKI(9)
156140950718     C                   Z-ADD     9             I                 3 0
156150950718     C                   EXSR      ABBL
156160940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
156170950718     C                   MOVEA     SKI(9)        K78(19)
156180940916     C* IMPOSTO L'ANNO
156190120828     C                   MOVE      BLTAAS        W004A             4
156200120828     C***                MOVE      ARTAAS        W004A             4
156210940916     C                   MOVEA     W004A         K78(52)
156220940916     C* LINEA DI PARTENZA
156230120828     C                   MOVEL     BLTLNP        W003A             3
156240120828     C***                MOVEL     ARTLNP        W003A             3
156250940916     C                   MOVEA     W003A         K78(57)
156260940916     C* SERIE
156270120828     C     BLTNRS        IFEQ      00
156280120828     C***  ARTNRS        IFEQ      00
156290940916     C                   MOVEA     '  '          K78(61)
156300940916     C                   ELSE
156310120828     C                   MOVEL     BLTNRS        W002A             2
156320120828     C***                MOVEL     ARTNRS        W002A             2
156330940916     C                   MOVEA     W002A         K78(61)
156340940916     C                   ENDIF
156350940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL NUM.SPEDIZIONE
156360120828     C                   MOVEL     BLTNSP        W007A
156370120828     C***                MOVEL     ARTNSP        W007A
156380950718     C                   MOVEA     W007A         SKI(9)
156390950718     C                   Z-ADD     9             I
156400950718     C                   EXSR      ABBL
156410940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
156420950718     C                   MOVEA     SKI(9)        K78(64)
156430940916     C* LINEA DI ARRIVO
156440120828     C                   MOVEL     BLTLNA        W003A             3
156450120828     C***                MOVEL     ARTLNA        W003A             3
156460940916     C                   MOVEA     W003A         K78(76)
156470940916     C*
156480940916     C* MUOVO LA SKIERA NEL MESSAGGIO
156490940916     C                   MOVEA     K78           VIDMSG
156500940922     C                   SETON                                        45
156510940916     C                   ENDSR
156520960318     C*
156530960318     C* CONTROLLO SE SPEDIZIONE CON COLLI > DEL PREVISTO-------------*
156540960318     C     CTRCRG        BEGSR
156550960318    1C     VIDNCL        IFGT      §3INCL
156560030704      * Se devo bancalare i colli emetto la finestra
156570030704     c                   Clear                   w03rig1
156580030704     c                   Clear                   w03rig2
156590030704     c                   Eval      w03rig1 =
156600030704     c                                      'Attenzione numero colli +
156610030704     c                                       superiore a'
156620030704     c                   Eval      w03rig1 =
156630030704     c                                      %trim(w03rig1) + ' ' +
156640030704     c                                      %trim(%editc(§3iNcl:'4'))
156650030704     c                   Eval      w03rig2 =
156660030704     c                                      'Bancalare i colli prima di +
156670030704     c                                       bollettare'
156680030704     c                   Eval      At3c01 = nodi
156690030704     c                   Eval      At3cor = ndpr
156700030704     c                   Eval      At3c02 = nodi
156710030704     c                   Eval      At3csf = ndpr
156720030704     c                   Eval      At3f12 = nodi
156730030704     c                   Do        *Hival
156740161202     c                   if        *in12 and not *in15
156750161202     c                   write     Ls01w03
156760161202     C                   read(E)   fnls01d
156770161202     c                   else
156780161202     c                   Exfmt     Ls01w03
156790161202     c                   endif
156800161202     c
156810161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
156820161202     c                   if        %error
156830161202     C                   MOVEL     '6'           §LPFPR
156840161202     c                   leave
156850161202     c                   endif
156860161202     c
156870030704     c                   Eval      *In41 = *On
156880030704     c                   Eval      wforw03 = '1'
156890030704     c   kf              Leave
156900030704     c                   EndDo
156910030704
156920960318    1C                   ENDIF
156930960318     C                   ENDSR
156940030704      *---------------------------------------------------------------*
156950030704      * Emetto window x colli originali + controlli
156960030704      *---------------------------------------------------------------*
156970030704     c     Sr_Over25     BegSr
156980030704
156990030704     c                   Clear                   w03rig1
157000030704     c                   Clear                   w03rig2
157010030704     c                   Eval      w03rig1 =
157020030704     c                             'Spedizione con colli bancalati'
157030030704     c                   If        *In12 and Not *In15
157040030704     c                   Eval      w03rig2 =
157050030704     c                             'Immettere i seguenti dati:'
157060030704     c                   EndIf
157070030704     c                   Clear                   At3c01
157080030704     c                   Clear                   At3cor
157090030704     c                   Clear                   At3c02
157100030704     c                   Clear                   At3csf
157110030704     c                   Clear                   At3f12
157120030708     c                   Clear                   H3riga
157130030708     c                   Clear                   H3colo
157140030718      * Salvo i comandi F8 e F9
157150030718     c                   Eval      savinkh = *Inkh
157160030718     c                   Eval      savinki = *Inki
157170030708      * Controllo il totale dei colli
157180030708     c                   If        wtotncl > *Zeros
157190030708      * deve essere uguale ai bancali + sfusi
157200030708     c                   If        wtotncl <> vidncl
157210030707     c                   Eval      At3csf = rimm
157220030707     c                   z-add     04            H3riga
157230030707     c                   z-add     37            H3colo
157240030707     c                   Eval      w03msg =
157250030708     c                             'sfusi+bancali diversi da colli bolla'
157260030707     c                   Eval      *In90 = *On
157270030708     c                   EndIf
157280040128      *  NON deve essere superiore ai colli originali
157290040128     c                   If        wtotncl > w03cor and Not *In90
157300030708     c                   Eval      At3cor = rimm
157310030708     c                   z-add     04            H3riga
157320030708     c                   z-add     18            H3colo
157330030708     c                   Eval      w03msg =
157340030708     c                             'Colli originali minori di sfusi+bancali'
157350030708     c                   Eval      *In90 = *On
157360030708     c                   EndIf
157370030707     c                   EndIf
157380030704
157390030704     c                   Do        *Hival
157400161202     c                   if        *in12 and not *in15
157410161202     c                   write     Ls01w03
157420161202     C                   read(E)   fnls01d
157430161202     c                   else
157440030704     c                   Exfmt     Ls01w03
157450161202     c                   endif
157460030704
157470030707     c                   Eval      *In90 = *Off
157480030704     c                   Clear                   w03msg
157490030704     c                   Clear                   At3c01
157500030704     c                   Clear                   At3cor
157510030704     c                   Clear                   At3c02
157520030704     c                   Clear                   At3csf
157530030704     c                   Clear                   At3f12
157540030704     c                   Clear                   H3riga
157550030704     c                   Clear                   H3colo
157560161202     c
157570161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
157580161202     c                   if        %error
157590161202     C                   MOVEL     '6'           §LPFPR
157600161202     c                   Movel     '1'           WEMFOR
157610161202     c                   leave
157620161202     c                   endif
157630030704
157640030708      * F12 Ritorno
157650030708     c                   If        *Inkl
157660030708     c                   Eval      w03cor = savw03cor
157670030708     c                   Eval      w03csf = savw03csf
157680030708     c                   If        w03csf = *Zeros
157690030708     c                   Clear                   wtotncl
157700030708     c                   Else
157710030708     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
157720030708     c                   EndIf
157730030718     c                   Movel     '1'           WEMFOR
157740030708     c                   Leave
157750030708     c                   EndIf
157760030708      * colli originali obbligatori
157770030704     c                   If        w03Cor = *zeros
157780030704     c                   Eval      At3cor = rimm
157790030704     c                   z-add     04            H3riga
157800030707     c                   z-add     18            H3colo
157810030704     c                   Eval      w03msg = 'Immettere i colli originali'
157820030704     c                   Eval      *In90 = *On
157830030704     c                   Iter
157840030704     c                   EndIf
157850030707
157860030707     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
157870040129      * il totale dei colli NON deve essere superiore ai colli originali
157880040129     c                   If        wtotncl > w03cor
157890030708     c                   Eval      At3cor = rimm
157900030708     c                   z-add     04            H3riga
157910030708     c                   z-add     18            H3colo
157920030708     c                   Eval      w03msg =
157930030708     c                             'Colli originali minori di sfusi+bancali'
157940030708     c                   Eval      *In90 = *On
157950030708     c                   Iter
157960030708     c                   EndIf
157970030708      * il totale dei colli deve essere uguali ai bancali + sfusi
157980030707     c                   If        wtotncl <> vidncl
157990030707     c                   Eval      At3csf = rimm
158000030707     c                   z-add     04            H3riga
158010030707     c                   z-add     37            H3colo
158020030707     c                   Eval      w03msg =
158030030708     c                             'sfusi+bancali diversi da colli bolla'
158040030707     c                   Eval      *In90 = *On
158050030707     c                   Iter
158060030707     c                   EndIf
158070030704
158080030704     c   kf              Leave
158090030704
158100030704     c                   EndDo
158110030718      * Ripristino i comandi F8 e F9
158120030718     c                   Eval      *Inkh = savinkh
158130030718     c                   Eval      *InKi = savinki
158140030704
158150030704     c                   EndSr
158160030805      *---------------------------------------------------------------*
158170030805      * Ricerco l'orm x fare il ritiro contestuale alla consegna
158180030805      *---------------------------------------------------------------*
158190030805     c     Sr_RicOrm     BegSr
158200030805
158210091006      * Preparo la ds x il richiamo a FNLS28R
158220091006      * Solo se richiamato FNLS28R x i controlli
158230031217if  1c                   If        wope = 'C'
158240091006     c                   Clear                   Fnls28ds
158250091006     c                   Eval      I28Ope = wope
158260091006     c                   Eval      I28ccm = wksc
158270080407     c                   if        *in12
158280091006     c                   Move      §lpaac        I28Aas
158290080407     c                   endif
158300120326      * passo sempre la lnp del video in quanto ad oggi dei traduttori
158310120326      * personalizzati per ORM RC non ce ne sono.
158320120326      * Attenzione che se dovessero esserci di nuovo dei traduttori
158330120326      * personalizzati il pgm prevede di controllare l'esistenza dell'ORM RC
158340120326      * e per collegare ORM con Bolla si fa tramite RFA dell'ORM = al n. bolla
158350120326      * memorizzato sul VAB di conseguenza la LNP del video non va più bene.
158360120326     c                   move      vidlnp        I28lnp
158370091006     c                   if        widspe <> 0
158380120326     c**!!!              Move      Widlnp        I28lnp
158390091006     c                   Move      Widnrs        I28nrs
158400091006     c                   Move      Widnsp        I28nsp
158410091006     c                   else
158420091006     c  n12              eval      i28aas = waas
158430120326     c**!!!              move      vidlnp        i28lnp
158440091006     c                   endif
158450091006     c                   Eval      I28Lna = comlna
158460091006     c                   Move      varznc        I28Znc
158470091006     c                   eval      i28rsd = vidrsd
158480091006     c                   eval      i28ind = vidind
158490091006     c                   eval      i28cad = vidcad
158500091006     c                   eval      i28lod = vidlod
158510091006     c                   eval      i28prd = vidprd
158520091006     c                   eval      i28nzd = vidnzd
158530091006     c                   eval      i28ncl = v1cncl
158540091006     c                   eval      i28pkb = vidpkg
158550091006      * Solo se richiamato FNLS28R x i aggiornare passo solo I28Ope
158560031217      * gli altri dati sono già impostati
158570031217   x1c                   Else
158580091006     c                   Eval      I28Ope = wope
158590040227      * se sono in conferma bolle da dischetto e il cliente non mantiene il
158600040227      * numero di spedizione devo aggiornare anche il riferimento sull'ORM
158610091006      * o immissione bolla
158620091006if  2c                   If        (*In12 and *In15 and BlpNsp <> WidNsp)
158630091006     c                              or not *in12
158640091006     c                   Eval      I28nAas = BlpAas
158650091006     c                   Eval      I28Lnp = BlpLnp
158660091006     c                   Eval      I28Nrs = BlpNrs
158670091006     c                   Eval      I28Nsp = BlpNsp
158680040227    2c                   EndIf
158690031217    1c                   EndIf
158700091006     c                   Call      'FNLS28R'
158710091006     c                   parm                    kpjba
158720091006     c                   Parm                    Fnls28ds
158730091006      * Solo se ho richiamato FNLS28R x i controlli verifico gli errori
158740031217if  1c                   If        wope = 'C'
158750031217      * Orm Non trovato
158760091006if  2c                   If        O28Err = 01
158770031217     c                   Eval      VidMsg = Err(150)
158780031217     c                   Eval      *In67 = *On
158790031217     c                   Eval      *In90 = *On
158800031217    2c                   EndIf
158810031217      * Altri errori sull'ORM
158820091006if  2c                   If        O28Err > *Zeros and O28Err <> 01
158830091006     c                   Eval      VidMsg = O28Msg
158840031217     c                   Eval      *In67 = *On
158850031217     c                   Eval      *In90 = *On
158860031217    2c                   EndIf
158870091124    1c                   EndIf
158880031217      * Ok ORM - imposto campi x memorizzarli in FIAR5 rcd 'RCC'
158890091006     c                   Eval      savOrmPoe = O28Poe
158900091006     c                   Eval      savOrmNsr = O28Nsr
158910091006     c                   Eval      savOrmNor = O28Nor
158920091006     c                   Eval      savOrmNrv = O28Nrv
158930030805
158940030805     c                   EndSr
158950960319     C*
158960960319     C* CONTROLLO GIORNI DI CHIUSURA --------------------------------*
158970960319     C     CTRGCH        BEGSR
158980960319     C*** 1° GIORNO CHIUSURA ***
158990960319    1C     WGC1          IFNE      *BLANKS
159000960319     C                   MOVEL     WGC1          ACOM              1
159010960319     C                   MOVE      WGC1          BCOM              1
159020960319     C                   Z-ADD     1             B                 3 0
159030960319     C     ACOM          LOOKUP    GGG(B)                                 30
159040960319     C* ERRORE
159050960319    2C     *IN30         IFEQ      *OFF
159060960319     C                   MOVEL     ERR(63)       VIDMSG
159070960319     C                   SETON                                        7490
159080960319     C                   GOTO      ENDGCH
159090960319    2C                   ENDIF
159100960319     C*
159110960319    2C     BCOM          IFNE      ' '
159120960319     C     BCOM          ANDNE     'P'
159130960319     C     BCOM          ANDNE     'M'
159140960319     C                   MOVEL     ERR(63)       VIDMSG
159150960319     C                   SETON                                        7490
159160960319     C                   GOTO      ENDGCH
159170960319    2C                   END
159180960319     C*
159190960319    1C                   END
159200960319     C***
159210960319     C*** 2° GIORNO CHIUSURA ***
159220960319    1C     WGC2          IFNE      *BLANKS
159230960319     C                   MOVEL     WGC2          ACOM              1
159240960319     C                   MOVE      WGC2          BCOM              1
159250960319     C                   Z-ADD     1             B
159260960319     C     ACOM          LOOKUP    GGG(B)                                 30
159270960319     C* ERRORE
159280960319    2C     *IN30         IFEQ      *OFF
159290960319     C                   MOVEL     ERR(63)       VIDMSG
159300960319     C                   SETON                                        6290
159310960319     C                   GOTO      ENDGCH
159320960319    2C                   ENDIF
159330960319     C*
159340960319    2C     BCOM          IFNE      ' '
159350960319     C     BCOM          ANDNE     'P'
159360960319     C     BCOM          ANDNE     'M'
159370960319     C                   MOVEL     ERR(63)       VIDMSG
159380960319     C                   SETON                                        6290
159390960319     C                   GOTO      ENDGCH
159400960319    2C                   END
159410960319     C*
159420960319     C* I GIORNI DI CHIUSURA NON POSSO ESSERE UGUALI
159430960319    2C     WGC1          IFEQ      WGC2
159440960319     C                   MOVEL     ERR(63)       VIDMSG
159450960319     C                   SETON                                        6290
159460960319     C                   GOTO      ENDGCH
159470960319    2C                   END
159480960319    1C                   END
159490960319     C* NON POSSONO ESSERE ' P' ' M'
159500960319    1C     WGC1          IFEQ      ' M'
159510960319     C     WGC1          OREQ      ' P'
159520960319    2C     WGC2          IFEQ      ' M'
159530960319     C     WGC2          OREQ      ' P'
159540960319     C                   MOVEL     ERR(63)       VIDMSG
159550960319     C                   SETON                                        6290
159560960319     C                   GOTO      ENDGCH
159570960319    2C                   END
159580960319    1C                   END
159590960319     C* personalizzazione
159600960319    2C     WPERSO        IFEQ      'P'
159610960319     C     WGC1          IFNE      '  '
159620960319     C     WGC2          ORNE      '  '
159630960319     C                   SETON                                        91
159640960319    2C                   ENDIF
159650960319    2C                   ENDIF
159660960319     C*
159670960319     C     ENDGCH        ENDSR
159680050415     C* CONTROLLO PARTICOLARITA' VARIE E BANCALI --------------------*
159690050415     c     sr_CntPVBan   begsr
159700050415     C***
159710050415     C*** PARTICOLARITA' VARIE    ***
159720050415     C*   PER ORA NON ESISTONO E SALTO COMPLETAMENTE IL CONTROLLO
159730050415     C*   SI PUO' SOLO IMMETTERE 'P ' CHE INDICA CONSEGNA A PRIVATI
159740050415      *   si può inserire anche 'B' bancali o 'O' bancali x over 25
159750050415    1C     VIDGVA        IFNE      *BLANKS
159760050415     C     VIDGVR        ORNE      *BLANKS
159770050415     C* RICHIAMO IL PRG DI RICERCA
159780050415    2C     VIDGVR        IFEQ      '?'
159790050415     C                   CLEAR                   DS7PQR
159800050415     C                   MOVEL     'S'           DS7RIC
159810050415     C                   MOVEL     'V'           DS7GES
159820050415     C                   MOVEL     WKSC          DS7KSC
159830050415     C                   MOVEL     VIDGVA        DS7COD
159840050415     C                   MOVEL     DS7PQR        KPJBU
159850050415     C                   CALL      'TRTB73R'
159860050415     C                   PARM                    KPJBA
159870050415     C                   MOVEL     KPJBU         DS7PQR
159880050415     C                   CLEAR                   VIDGVR
159890050415     C*
159900050415     C     VIDGVA        IFEQ      *BLANKS
159910050415     C                   MOVEL     DS7COD        VIDGVA
159920050415    2C                   ENDIF
159930050415     C*
159940050415     C                   MOVEL     '1'           WEMFOR
159950050415     C                   GOTO      ENDpvban
159960050415    2C                   ENDIF
159970050415     C* CONTROLLO
159980050415     C                   CLEAR                   DS7PQR
159990050415     C                   MOVEL     'S'           DS7RIC
160000050415     C                   MOVEL     'C'           DS7GES
160010050415     C                   MOVEL     WKSC          DS7KSC
160020050415     C                   MOVEL     VIDGVA        DS7COD
160030050415     C                   MOVEL     DS7PQR        KPJBU
160040050415     C                   CALL      'TRTB73R'
160050050415     C                   PARM                    KPJBA
160060050415     C                   MOVEL     KPJBU         DS7PQR
160070050415     C* ERRORE
160080050415    2C     DS7ERR        IFEQ      '1'
160090050415     C                   MOVEL     DS7MSG        VIDMSG
160100050415     C                   SETON                                        7590
160110050415     C                   GOTO      ENDpvban
160120050415    2C                   ENDIF
160130050415     c* controllo ambito di utilizzo particolarità varia
160140050415     C                   MOVEL     '7S'          COD
160150050415     C                   MOVEL(P)  vidgva        KEY
160160050415     c                   clear                   ds7s
160170050415     C                   EXSR      CTABEL
160180050415     C                   MOVEL     TBLUNI        DS7S
160190050415     c     §7suti        ifeq      'B'
160200050415     c     §ogntw        andeq     'PPT'
160210050415     c     §7suti        oreq      'P'
160220050415     c     §ogntw        andne     'PPT'
160230050415     C                   MOVEL     err(288)      VIDMSG
160240050415     C                   SETON                                        7590
160250050415     C                   GOTO      ENDpvban
160260050415     c                   endif
160270050415    1C                   ENDIF
160280050415      * B A N C A L I
160290050415      * tipo bancali
160300050415If  1c                   If        VidTba <> *Blanks and VidTba <> '00'
160310050415      * ricerca
160320050415     c     '?'           Scan      VidTba                                 30
160330050415If  2c                   If        *In30
160340050415     c                   Clear                   Dsbs02
160350050415     c                   Eval      T02Mod = 'R'
160360050415     c                   Eval      T02Sif = Knsif
160370050415     c                   Eval      T02Cod = 'TBA'
160380050415     c                   Call      'TIBS02R'
160390050415     c                   Parm                    Kpjba
160400050415     c                   Parm                    Dsbs02
160410050415     c                   Movel     T02Ke1        VidTba
160420050415     c                   Eval      Wemfor = '1'
160430050415     c                   z-add     23            H2riga
160440050415     c                   z-add     16            H2colo
160450050415     c                   GoTo      ENDpvban
160460050415    2c                   EndIf
160470050415      * controllo
160480050415     c                   Clear                   Dsbs02
160490050415     c                   Clear                   dTba
160500050415     c                   Eval      T02Mod = 'C'
160510050415     c                   Eval      T02Sif = Knsif
160520050415     c                   Eval      T02Cod = 'TBA'
160530050415     c                   Movel(p)  VidTba        T02Ke1
160540050415     c                   Call      'TIBS02R'
160550050415     c                   Parm                    Kpjba
160560050415     c                   Parm                    Dsbs02
160570050415If  2c                   If        T02Err <> *Blanks
160580050415     c                   Movel     Rimm          AtrTba
160590050415     c                   Eval      VidMsg = Err(269)
160600050415     c                   Eval      *In90 = *On
160610050415     c                   z-add     23            H2riga
160620050415     c                   z-add     16            H2colo
160630050415     c                   GoTo      ENDpvban
160640050415    2c                   EndIf
160650050415     c                   Movel     T02Uni        dTba
160660050415     c                   Z-Add     §TbaPkg       wTbaPkg1
160670050415     c                   Z-Add     §TbaVol       wTbaVol1
160680150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
160690150305     c                   exsr      sr_figlia
160700150305     c                   if        wfiglia=*blanks
160710150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
160720150226     c* sia utilizzabile per la varia B/O
160730150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
160740150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
160750150226     c                   Movel     Rimm          AtrTba
160760150226     c                   Eval      VidMsg = Err(358)
160770150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
160780150226     c                   Eval      *In90 = *On
160790150226     c                   z-add     23            H2riga
160800150226     c                   z-add     16            H2colo
160810150226     c                   GoTo      ENDpvban
160820150226    2c                   endif
160830150226     c* se inserita la particolarità varia B controllo che il cliente sia
160840150226     c* abilitato all'utilizzo del tipo bancale
160850150226    2c                   if        %subst(VidGva:1:1)='B'
160860150302     c                   move      vidtba        wtba
160870150226     c                   exsr      sr_callTisigar
160880150226     c                   if        ogaesito<>*blanks
160890150226     c                   Movel     Rimm          AtrTba
160900150226     c                   Eval      VidMsg = Err(359)
160910150226     c                   Eval      *In90 = *On
160920150226     c                   z-add     23            H2riga
160930150226     c                   z-add     16            H2colo
160940150226     c                   GoTo      ENDpvban
160950150226     c                   endif
160960150226    2c                   endif
160970150305     c                   endif
160980050415   x1c                   Else
160990050415If  2c                   If        VidNba > *Zeros
161000050415     c                   Movel     Rimm          AtrTba
161010050415     c                   Eval      VidMsg = Err(269)
161020050415     c                   Eval      *In90 = *On
161030050415     c                   z-add     23            H2riga
161040050415     c                   z-add     16            H2colo
161050050415     c                   GoTo      ENDpvban
161060050415    2c                   EndIf
161070050415    1c                   EndIf
161080050415      * numero bancali
161090050415If  1c                   If        VidNba = *Zeros and VidTba > *Zeros
161100050415     c                   Movel     Rimm          AtrNba
161110050415     c                   Eval      VidMsg = Err(268)
161120050415     c                   Eval      *In90 = *On
161130050415     c                   z-add     23            H2riga
161140050415     c                   z-add     22            H2colo
161150050415     c                   GoTo      ENDpvban
161160050415    1c                   EndIf
161170050415      * tipo bancali 2
161180050415If  1c                   If        VidTb2 <> *Blanks and VidTb2 <> '00'
161190050415      * ricerca
161200050415     c     '?'           Scan      VidTb2                                 30
161210050415If  2c                   If        *In30
161220050415     c                   Clear                   Dsbs02
161230050415     c                   Eval      T02Mod = 'R'
161240050415     c                   Eval      T02Sif = Knsif
161250050415     c                   Eval      T02Cod = 'TBA'
161260050415     c                   Call      'TIBS02R'
161270050415     c                   Parm                    Kpjba
161280050415     c                   Parm                    Dsbs02
161290050415     c                   Movel     T02Ke1        VidTb2
161300050415     c                   Eval      Wemfor = '1'
161310050415     c                   z-add     23            H2riga
161320050415     c                   z-add     32            H2colo
161330050415     c                   GoTo      ENDpvban
161340050415    2c                   EndIf
161350050415      * controllo
161360050415     c                   Clear                   Dsbs02
161370050415     c                   Clear                   dTba
161380050415     c                   Eval      T02Mod = 'C'
161390050415     c                   Eval      T02Sif = Knsif
161400050415     c                   Eval      T02Cod = 'TBA'
161410050415     c                   Movel(p)  VidTb2        T02Ke1
161420050415     c                   Call      'TIBS02R'
161430050415     c                   Parm                    Kpjba
161440050415     c                   Parm                    Dsbs02
161450050415If  2c                   If        T02Err <> *Blanks
161460050415     c                   Movel     Rimm          AtrTb2
161470050415     c                   Eval      VidMsg = Err(269)
161480050415     c                   Eval      *In90 = *On
161490050415     c                   z-add     23            H2riga
161500050415     c                   z-add     32            H2colo
161510050415     c                   GoTo      ENDpvban
161520050415    2c                   EndIf
161530050415     c                   Movel     T02Uni        dTba
161540050415     c                   Z-Add     §TbaPkg       wTbaPkg2
161550050415     c                   Z-Add     §TbaVol       wTbaVol2
161560150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
161570150305     c                   exsr      sr_figlia
161580150305     c                   if        wfiglia=*blanks
161590150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
161600150226     c* sia utilizzabile per la varia B/O
161610150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
161620150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
161630150226     c                   Movel     Rimm          AtrTb2
161640150226     c                   Eval      VidMsg = Err(358)
161650150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
161660150226     c                   Eval      *In90 = *On
161670150226     c                   z-add     23            H2riga
161680150226     c                   z-add     32            H2colo
161690150226     c                   GoTo      ENDpvban
161700150226    2c                   endif
161710150226     c* se inserita la particolarità varia B controllo che il cliente sia
161720150226     c* abilitato all'utilizzo del tipo bancale
161730150226    2c                   if        %subst(VidGva:1:1)='B'
161740150302     c                   move      vidtb2        wtba
161750150226     c                   exsr      sr_callTisigar
161760150226     c                   if        ogaesito<>*blanks
161770150226     c                   Movel     Rimm          AtrTb2
161780150226     c                   Eval      VidMsg = Err(359)
161790150226     c                   Eval      *In90 = *On
161800150226     c                   z-add     23            H2riga
161810150226     c                   z-add     32            H2colo
161820150226     c                   GoTo      ENDpvban
161830150226     c                   endif
161840150226    2c                   endif
161850150305     c                   endif
161860050415   x1c                   Else
161870050415If  2c                   If        VidNb2 > *Zeros
161880050415     c                   Movel     Rimm          AtrTb2
161890050415     c                   Eval      VidMsg = Err(269)
161900050415     c                   Eval      *In90 = *On
161910050415     c                   z-add     23            H2riga
161920050415     c                   z-add     32            H2colo
161930050415     c                   GoTo      ENDpvban
161940050415    2c                   EndIf
161950050415    1c                   EndIf
161960050415      * numero bancali 2
161970050415If  1c                   If        VidNb2 = *Zeros and VidTb2 > *Zeros
161980050415     c                   Movel     Rimm          AtrNb2
161990050415     c                   Eval      VidMsg = Err(268)
162000050415     c                   Eval      *In90 = *On
162010050415     c                   z-add     23            H2riga
162020050415     c                   z-add     38            H2colo
162030050415     c                   GoTo      ENDpvban
162040050415    1c                   EndIf
162050050415      * non si possono immettere 2 tipi bancali uguali
162060050415If  1c                   If        VidTba > *Zeros and VidTb2 > *Zeros
162070050415     c                             and VidTba = VidTb2
162080050415     c                   Movel     Rimm          AtrTb2
162090050415     c                   Eval      VidMsg = Err(270)
162100050415     c                   Eval      *In90 = *On
162110050415     c                   z-add     23            H2riga
162120050415     c                   z-add     32            H2colo
162130050415     c                   GoTo      ENDpvban
162140050415    1c                   EndIf
162150050415      * se inseriti i bancali la particolarità Varie "B" è obbligatoria
162160050415      * oppure la particolarità Varie "O"
162170050415If  1c                   If        (VidTba > *Zeros or VidTb2 > *Zeros) and
162180050415     c                              %Subst(VidGva:1:1) <> 'B' and
162190050415     c                              %Subst(VidGva:1:1) <> 'O'
162200050415     c                   Select
162210050415     c                   When      wgva = 'O'
162220050415     c                   Eval      VidMsg = Err(32)
162230050415     c                   When      wgva = 'B'
162240050415     c                   Eval      VidMsg = Err(35)
162250050415     c                   Other
162260050415     c                   Eval      VidMsg = Err(274)
162270050415     c                   EndSl
162280050415     c                   Eval      *In90 = *On
162290050415     c                   Eval      *In75 = *On
162300050415     c                   GoTo      ENDpvban
162310050415    1c                   EndIf
162320050415      * se inserita la particolarità Varie "B" sono obbligatori
162330050415      * oppure la particolarità Varie "O"
162340050415If  1c                   If        (%subst(VidGva:1:1) ='B' or
162350050415     c                              %subst(VidGva:1:1) ='O')  and
162360050415     c                             (VidTba = *Blanks or VidTba = '00') and
162370050415     c                             (VidTb2 = *Blanks or Vidtb2 = '00')
162380050415     c                   Movel     Rimm          AtrTba
162390050415     c                   Eval      VidMsg = Err(271)
162400050415     c                   Eval      *In90 = *On
162410050415     c                   z-add     23            H2riga
162420050415     c                   z-add     16            H2colo
162430050415     c                   GoTo      ENDpvban
162440050415    1c                   EndIf
162450050415      * msg info x n. colli inferiore al tot. bancali
162460050415     c                   Eval      wtotnba = VidNba + VidNb2
162470050415     c                   If        VidNcl < wtotnba and wtotnba > *Zeros
162480050415     c                             and wfornba = *Blanks
162490050415     c                   Eval      VidMsg = Err(27)
162500050415     c                   Eval      *In41 = *On
162510050415     c                   Eval      *In90 = *On
162520050415     c                   Eval      wfornba = '1'
162530050415     c                   GoTo      ENDpvban
162540050415     c                   EndIf
162550050415      * Manutenzione di bolla con bancali
162560050415      * Se viene modificato il numero di bancali
162570050415      * emetto un msg info
162580050415     c                   If        *In12 and Not *In15                      and
162590050415     c                             (VidNba <> SavNba or VidNb2 <> SavNb2)   and
162600110921     c                             wNba = *Blanks                           and
162610110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
162620050415     c                   Eval      wNba = '1'
162630050415     c                   Eval      VidMsg = Err(273)
162640050415     c                   If        VidNba <> SavNba
162650050415     c                   Movel     Rimm          AtrNba
162660050415     c                   z-add     23            H2riga
162670050415     c                   z-add     22            H2colo
162680050415     c                   EndIf
162690050415     c                   If        VidNb2 <> SavNb2
162700050415     c                   Movel     Rimm          AtrNb2
162710050415     c                   z-add     23            H2riga
162720050415     c                   z-add     38            H2colo
162730050415     c                   EndIf
162740050415     c                   Eval      *In90 = *On
162750050415     c                   GoTo      ENDpvban
162760050415     c                   EndIf
162770050415      * per Particolarità varie 'O'
162780050415      * questi controlli non li faccio se richiamato da giacenze
162790050415     c                   If        %subst(VidGva:1:1) = 'O'
162800050415      * se colli originali già immessi devo controllare il n. dei colli sfusi
162810050415      * con i bancali
162820050415     c                   If        w03Cor > *zeros
162830050415     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
162840050415     c                   EndIf
162850050415      * devo controllare se inseriti i colli originali
162860050415      * se non sono stati inseriti emetto la window per inserirli
162870050415     c                   If        w03cor = *Zeros     or
162880050415      * oppure se sono in manutenzione bolla e sono stati variati
162890050415      * o i bancali o il n. dei colli
162900050415      * emetto la window
162910050415     c                             (*In12 and Not *In15)                   or
162920050415     c                             (wtotncl > *Zeros  and
162930050415     c                             (wtotncl <> vidncl or
162940050415     c                             (wtotncl >= w03cor and w03cor > *Zeros)))
162950050415     c                   ExSr      Sr_Over25
162960050415     c                   EndIf
162970050415     c                   EndIf
162980050415     c     endpvban      tag
162990050415     C   90              MOVEL     '1'           WEMFOR
163000050415     c                   endsr
163010150305     c*---------------------------------------------------------------*
163020150305     C* verifica se bolla figlia
163030150305     c*---------------------------------------------------------------*
163040150305     c     sr_figlia     begsr
163050150305     c                   clear                   wfiglia
163060150305     c                   select
163070150305     c                   when       *in12 and *in15 and *in44
163080150305     c                   eval      wfiglia='S'
163090150305     c                   when       *in12 and not *in15
163100150305     c     kblp3         setll     fnlbl01l
163110150305     c                   if        %equal(fnlbl01l)
163120150305     c                   eval      wfiglia='S'
163130150305     c                   endif
163140150305     c                   endsl
163150150305     c                   endsr
163160150226     c*---------------------------------------------------------------*
163170150226     C* richiamo pgm di controllo abilitazione cliente al tipo bancale*
163180150226     c*---------------------------------------------------------------*
163190150226     c     sr_callTisigarbegsr
163200150226     c                   clear                   tisigads
163210150226     c                   if        dateu>=§vpobanc
163220150226     c                   z-add     vidccm        igaksc
163230150226     c                   if        vidflc=0
163240150226     c                   movel     vidlnp        igaksc
163250150226     c                   else
163260150226     c                   movel     vidflc        igaksc
163270150226     c                   endif
163280150226     c                   eval      IGADAT=blpdsp
163290150226     c                   eval      IGATSC='B'
163300150226     c                   eval      IGATBA=wtba
163310150226     c                   movel     tisigads      kpjbu
163320150226     c                   call      'TISIGAR'
163330150226     c                   parm                    kpjba
163340150226     c                   movel     kpjbu         tisigads
163350150226     c                   endif
163360150226     c                   endsr
163370940826     C*
163380940826     C* GESTIONE 3 VIDEATA ------------------------------------------*
163390940826     C     GESD03        BEGSR
163400991008      *
163410940928     C                   CLEAR                   WEMD03
163420971211     C                   MOVEL     COMLNA        V3CLNA
163430940826     C* DECODIFICA LNA
163440940826     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
163450971211     C  N30              MOVEL     ORGDES        V3DLNA
163460940923     C*
163470940923     C* SE TASSAZIONE CON TARIFFA MITTENTE, TASSO LA BOLLA
163480950125     C* SOLO PER GLI ASSEGNATI
163490950125     C   04SAVFTM        IFNE      ' '
163500940923     C     VIDFTM        ORNE      ' '
163510940923     C     VIDIMV        IFEQ      0
163520980506     C                   MOVEL     '1'           WBOL
163530011025      *
163540011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
163550011025      * varia 'N'
163560011025     C     FLGVRN        IFEQ      '1'
163570011115      * leggo il sbfl delle varie
163580011115     C                   DO        20            NRR
163590011115     C     NRR           CHAIN     LS01S03                            30
163600011115     C     V3CSV1        IFEQ      'N'
163610011115     C     V3CVA1        ANDEQ     88888888
163620011115     C                   EXSR      TASSAN
163630011115     C  N30              UPDATE    LS01S03
163640011115     C                   ENDIF
163650011115     C                   ENDDO
163660011025     C                   ENDIF
163670011025      *
163680151014     c                   clear                   PesVolPkcn
163690151014     c                   clear                   PesVolSpc
163700151014     c                   clear                   PesVolImv
163710940923     C                   EXSR      TASSAZ
163720151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
163730151014     c                   if        vidimv>0
163740151014     c                   eval      PesVolPkcn=taspkcn
163750151014     c                   eval      PesVolSpc=tasspc
163760151014     c                   eval      PesVolIMV=vidimv
163770151014     c                   endif
163780941219     C* SE TASSAZIONE RIUSCITA, MSG CHE E' TASSATA CON TARIFFA MITTEN
163790950504     C* IN CONFERMA BOLLE DA  CLIENTI NON LO DO'
163800941219     C     *IN90         IFEQ      *OFF
163810950504     C     *IN12         IFEQ      *OFF
163820950504     C     *IN15         OREQ      *OFF
163830950504     C     §LPFPR        OREQ      'V'
163840941110     C                   MOVEL     ERR(59)       VIDMSG
163850940923     C                   SETON                                        90
163860940923     C                   ENDIF
163870950504     C                   ENDIF
163880941219     C*
163890941219     C                   ENDIF
163900940923     C                   ENDIF
163910950504     C*
163920950504     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
163930950504     C*    AI CONTROLLI --> SE NON C'E' STATO UN ERRORE IN TASSAZIONE
163940950504     C  N90
163950950504     CAN 12
163960950504    2CAN 15§LPFPR        IFNE      'V'
163970950504     C                   GOTO      CT3TAG
163980950504    2C                   END
163990961111     C* EMETTO MSG CHE DEVO TASSARE IL PORTO SE FRANCO FRONTIERA
164000961111     C     VIDFBR        IFEQ      'F'
164010961111     C     SED           ANDEQ     0
164020961111     C                   MOVEL     ERR(129)      VIDMSG
164030961111     C                   SETON                                        9052
164040961111     C                   MOVEL     1             SED
164050961111     C                   ENDIF
164060940923     C*
164070940826     C     FOR03         TAG
164080941011     C                   Z-ADD     1             NRR
164090940826     C*
164100940923     C                   WRITE     LS01D04
164110161202     C*
164120161202     c                   if        *in12 and not *in15
164130161202     C                   write     LS01C03
164140161202     C                   read(E)   fnls01d
164150161202     c                   else
164160161202     C                   EXFMT     LS01C03
164170161202     c                   endif
164180161202
164190161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
164200161202     c                   if        %error
164210161202     C                   MOVEL     '6'           §LPFPR
164220161202     c                   goto      endd03
164230161202     c                   endif
164240950504     C*
164250950504     C     CT3TAG        TAG
164260941115     C*
164270941021     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
164280950126     C                   EXSR      OFFD03
164290940826     C*
164300990701     C* F22 - CALCOLO PROVVIGIONI DEL MITTENTE
164310940928    3C     *INKW         IFEQ      *ON
164320940919     C* SOLO SE SI TRATTA DI UN CODIFICATO
164330940919    4C     VIDCCM        IFNE      9999
164340940919    4C     VIDCCM        ANDNE     8888
164350940919     C* SOLO SE IL CLIENTE HA UNA TARIFFA ALMENO VALIDA
164360980608     C*  ALTRIMENTI USA LA TARIFFA DI CARTELLO IL PGM TNSF20R
164370980506     C                   MOVEL     '2'           WBOL              1
164380980506     C                   EXSR      TASSAZ
164390980506     C** IMPOSTO LA VARIA SE TROVATA IN VI2VA1
164400940826   X4C                   ELSE
164410940919     C* ERRORE PER 8888 O 9999
164420941110     C                   MOVEL     ERR(82)       VIDMSG
164430980608     C                   SETON                                        4090
164440940919    4C                   ENDIF
164450940919     C*
164460940826     C                   GOTO      FOR03
164470940919    3C                   ENDIF
164480941115     C*
164490940826     C* CONTROLLI
164500940826     C                   EXSR      CTRD03
164510940826     C* RIEMETTO FORMATO
164520950127     C     WEMFOR        IFEQ      '1'
164530950127     C                   EXSR      ESCIER
164540950127     C     §LPFPR        IFNE      '5'
164550000113     C  NKL              GOTO      FOR03
164560950127     C                   ELSE
164570950127     C                   GOTO      ENDD03
164580950127     C                   ENDIF
164590950127     C                   ENDIF
164600941115     C*
164610990701     C* F12 - RITORNO VIDEATA 2
164620941115     C     *INKL         IFEQ      *ON
164630990701     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA F9 QUESTA VIDEATA
164640941115     C     VIDPOR        IFNE      0
164650941115     C     WESVAR        ORNE      ' '
164660941115     C     VIDCEI        ORNE      ' '
164670040116     c     wesvar1       orne      *Blanks
164680941115     C     VI2CEI        ORNE      ' '
164690000113     C     WEMFOR        OREQ      '1'
164700941115     C                   MOVEL     'S'           WEMD03            1
164710000113     C                   CLEAR                   WEMFOR
164720000113     C                   CLEAR                   VIDMSG
164730000113     C                   SETOFF                                       90
164740941115     C                   ENDIF
164750941115     C                   GOTO      ENDD03
164760941115     C                   ENDIF
164770940826     C*
164780990630     C* F14 - TASSAZIONE BOLLA
164790990630     C     *INKN         IFEQ      *ON
164800990630     C                   MOVEL     '1'           WBOL
164810011025      *
164820011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
164830011025      * varia 'N'
164840011025     C     FLGVRN        IFEQ      '1'
164850011115      * leggo il sbfl delle varie
164860011115     C                   DO        20            NRR
164870011115     C     NRR           CHAIN     LS01S03                            30
164880011115     C     V3CSV1        IFEQ      'N'
164890011115     C     V3CVA1        ANDEQ     88888888
164900011025     C                   EXSR      TASSAN
164910011115     C  N30              UPDATE    LS01S03
164920011115     C                   ENDIF
164930011115     C                   ENDDO
164940011025     C                   ENDIF
164950011025      *
164960151014     c                   clear                   PesVolPkcn
164970151014     c                   clear                   PesVolSpc
164980151014     c                   clear                   PesVolImv
164990990630     C                   EXSR      TASSAZ
165000151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
165010151014     c                   if        vidimv>0
165020151014     c                   eval      PesVolPkcn=taspkcn
165030151014     c                   eval      PesVolSpc=tasspc
165040151014     c                   eval      PesVolIMV=vidimv
165050151014     c                   endif
165060990701     C*
165070990630     C* PER PREPAGATI CALCOLO IL TOTALE FATTURA
165080990701     C     *IN22         IFEQ      *ON
165090990716     C     VIDIMV        IFGT      0
165100060208     c* se sono in manutenzione ed è variato il totale imponibile
165110060208     c* errore se prepagato già incassato
165120070514     c***                if        *in12 = *on and *in15 = *off  and
165130070514     c***                          dateu >= §vpogpp
165140070514     c                   if        *in12 = *on and *in15 = *off
165150060208     c                   exsr      sr_callycow
165160060208     c                   if        prmesito <> 0
165170060208     C                   MOVEL     ERR(297)      VIDMSG
165180060208     C                   SETON                                        90
165190060208     C                   GOTO      FOR03
165200060208     c                   endif
165210060208     c                   endif
165220120105     c                   if        viddft>0
165230120105     C                   Z-ADD     viddft        G02DAT
165240120105     C                   MOVEL     *BLANK        G02ERR
165250120105     C                   CALL      'XSRDA8'
165260120105     C                   PARM                    WLBDAT
165270120105     C                   MOVEL     G02INV        comdft
165280120105     c                   else
165290990701     C                   Z-ADD     DATEU         COMDFT
165300120105     c                   endif
165310991014     C                   EXSR      TOTFAT
165320990701     C                   Z-ADD     D04IFT        VIDIFT
165330990701     C                   Z-ADD     D04IMV        VIDIMV
165340990701     C                   Z-ADD     D04POR        VIDPOR
165350990701     C                   Z-ADD     D04IMV        SAVIMV
165360991014     C                   Z-ADD     D04POR        MEMPOR
165370990701     C                   ENDIF
165380990716     C                   ENDIF
165390990630     C*
165400990630     C                   GOTO      FOR03
165410990630     C                   ENDIF
165420060207     c*
165430060207     c* MANUTENZIONE: GESTIONE MOTIVAZIONE PER PREPAGATI
165440060207     c* Se sono in manutenzione di un prepagato ed è stato variato il
165450060207     c* totale imponibile richiedo motivazione
165460060308     c*
165470060308     c                   movel     'TR'          wcvb
165480060308     c                   exsr      cls_lv85
165490060308     c*
165500060208     c                   clear                   ilv85cvb
165510060207     c                   if        *in12 = *on and *in15= *off and
165520070514     c****                         dateu >= §vpogpp  and
165530060208     c                             *in22 = *on and vidimv <> savimvo
165540060227     c                   movel     '7L'          cod
165550060227     C                   MOVEL(P)  'TR'          KEY
165560060227     C                   EXSR      CTABEL
165570060227     C                   MOVEL     TBLUNI        DS7L
165580060227     c                   if        §7lmtv = 'S'
165590060227     c                   clear                   fnlv85ds
165600060208     c                   eval      ilv85cvb = 'TR'
165610060209     c                   eval      ilv85tel = 'V'
165620060207     c                   movel     fnlv85ds      kpjbu
165630060207     c                   call      'FNLV85R'
165640060207     c                   parm                    kpjba
165650060210     c                   movel     kpjbu         fnlv85ds
165660060207     c* F12=Ritorno --> riemetto formato 03
165670060209     c                   if        olv85f12 = '1'
165680060207     c                   goto      for03
165690060207     c                   endif
165700060227     c                   endif
165710060207     c                   endif
165720940826     C*
165730940919     C* SE CONTO SERVIZIO IMMISSIONE PER CMD6
165740101104     c                   if        not *inkf and not *inkh
165750101104     C     WFPR          IFNE      'I'
165760940919     C     §3ARBL        ANDEQ     'C'
165770950410     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
165780950410    4C     VIDLNP        IFNE      102
165790950410     C     *IN12         OREQ      *OFF
165800950410     C     *IN15         OREQ      *OFF
165810940928     C                   MOVEL     ERR(40)       VIDMSG
165820940923     C                   SETON                                        90
165830940919     C                   GOTO      FOR03
165840900504     C                   END
165850950410     C                   END
165860101104     c                   endif
165870960318     C**
165880960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
165890960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
165900960805     C* NON LO FACCIO SE BOLLA DI RECUPERO
165910960805     C  NKF§3ARBL        IFNE      'R'
165920130927     c     wforw03       andeq     *Blanks
165930960805     C                   EXSR      CTRCRG
165940030704     c   41              GoTo      For03
165950960805     C                   ENDIF
165960940919     C*
165970940923     C     ENDD03        ENDSR
165980900507     C*
165990900507     C*--- CONTROLLO FORMATO 3 ---------------------------------------*
166000940826     C     CTRD03        BEGSR
166010991008      *
166020941004     C                   SETOFF                                       90
166030941115     C                   CLEAR                   VIDMSG
166040940826     C                   CLEAR                   WEMFOR
166050030623     C                   CLEAR                   WVAR3A            1
166060991028     C**
166070991028     C* CONTROLLO DIVISA SE MODIFICATA
166080991028    1C     VI2DIV        IFNE      *BLANKS
166090991028     C     VI2DIV        ANDNE     WDIV2
166100991028     C     WDIV2         ANDNE     *BLANKS
166110991028     C                   CLEAR                   DSLV16
166120991028     C                   CLEAR                   DTASV
166130991028     C                   MOVEL     'D'           D17FIM
166140991028     C                   MOVE      VI2DIV        D17DIV
166150991028     C                   Z-ADD     BLPDSP        D17DSP
166160991028     C                   CALL      'FNLV16R'
166170991028     C                   PARM                    DSLV16
166180991028     C                   PARM                    DTASV
166190991028     C                   MOVEL     D17DIV        VI2DIV
166200991028     C* ERRORE
166210991028    2C     O17ERR        IFNE      *BLANKS
166220991028     C                   SETON                                        43
166230991028    3C     O17MSG        IFNE      *BLANKS
166240991028     C                   MOVEL     O17MSG        VIDMSG
166250991028     C                   SETON                                        90
166260991028    3C                   ENDIF
166270991028     C                   GOTO      ENDC03
166280991028    2C                   ENDIF
166290991028     C**
166300991028      * SE VARIATA DIVISA DEVO CONVERTIRE GLI IMPORTI NON MODIFICATI
166310991028    2C     VI2VA1        IFEQ      VA2VA1
166320991028     C     VI2VA1        ANDGT     *ZEROS
166330991028     C                   CLEAR                   DSYEUR
166340991028     C                   MOVEL     WDIV2         YECDVI
166350991028     C                   Z-ADD     VI2VA1        YECIMI
166360991028     C                   MOVEL     VI2DIV        YECDVO
166370991028    3C     O17FDC        IFEQ      'S'
166380991028     C                   MOVEL     '3'           YECDCO
166390991028    3C                   ENDIF
166400991028     C**
166410991028     C                   CALL      'YEURCO'
166420991028     C                   PARM                    DSYEUR
166430991028     C**
166440991028    3C     YECESI        IFEQ      ' '
166450991028     C                   Z-ADD     YECIMO        VI2VA1
166460991028     C                   MOVEL     '1'           WEMFOR
166470991028    3C                   ENDIF
166480991028    2C                   ENDIF
166490040114      * Varia 2
166500040114    2c                   If        Vi2Va2 = Va2Va2 and Vi2Va2 > 0
166510040114     c                   Clear                   dsyeur
166520040114     c                   Movel     wdiv2         YecDvi
166530040114     c                   Z-add     Vi2va2        YecImi
166540040114     c                   Movel     Vi2Div        YecDvo
166550040114    3c                   If        O17fDc = 'S'
166560040114     c                   Movel     '3'           YecDco
166570040114    3c                   EndIf
166580040114     c                   Call      'YEURCO'
166590040114     c                   Parm                    dsyeur
166600040114    3c                   If        YecEsi = *Blanks
166610040114     c                   Z-add     YecImo        Vi2Va2
166620040114     c                   Eval      wemfor = '1'
166630040114    3c                   EndIf
166640040114    2c                   EndIf
166650040114      * Varia 3
166660040114    2c                   If        Vi2Va3 = Va2Va3 and Vi2Va3 > 0
166670040114     c                   Clear                   dsyeur
166680040114     c                   Movel     wdiv2         YecDvi
166690040114     c                   Z-add     Vi2va3        YecImi
166700040114     c                   Movel     Vi2Div        YecDvo
166710040114    3c                   If        O17fDc = 'S'
166720040114     c                   Movel     '3'           YecDco
166730040114    3c                   EndIf
166740040114     c                   Call      'YEURCO'
166750040114     c                   Parm                    dsyeur
166760040114    3c                   If        YecEsi = *Blanks
166770040114     c                   Z-add     YecImo        Vi2Va3
166780040114     c                   Eval      wemfor = '1'
166790040114    3c                   EndIf
166800040114    2c                   EndIf
166810040114      * Varia 4
166820040114    2c                   If        Vi2Va4 = Va2Va4 and Vi2Va4 > 0
166830040114     c                   Clear                   dsyeur
166840040114     c                   Movel     wdiv2         YecDvi
166850040114     c                   Z-add     Vi2va4        YecImi
166860040114     c                   Movel     Vi2Div        YecDvo
166870040114    3c                   If        O17fDc = 'S'
166880040114     c                   Movel     '3'           YecDco
166890040114    3c                   EndIf
166900040114     c                   Call      'YEURCO'
166910040114     c                   Parm                    dsyeur
166920040114    3c                   If        YecEsi = *Blanks
166930040114     c                   Z-add     YecImo        Vi2Va4
166940040114     c                   Eval      wemfor = '1'
166950040114    3c                   EndIf
166960040114    2c                   EndIf
166970041217      * Varia 5
166980041217    2c                   If        Vi2Va5 = Va2Va5 and Vi2Va5 > 0
166990041217     c                   Clear                   dsyeur
167000041217     c                   Movel     wdiv2         YecDvi
167010041217     c                   Z-add     Vi2va5        YecImi
167020041217     c                   Movel     Vi2Div        YecDvo
167030041217    3c                   If        O17fDc = 'S'
167040041217     c                   Movel     '3'           YecDco
167050041217    3c                   EndIf
167060041217     c                   Call      'YEURCO'
167070041217     c                   Parm                    dsyeur
167080041217    3c                   If        YecEsi = *Blanks
167090041217     c                   Z-add     YecImo        Vi2Va5
167100041217     c                   Eval      wemfor = '1'
167110041217    3c                   EndIf
167120041217    2c                   EndIf
167130041217      * Varia 6
167140041217    2c                   If        Vi2Va6 = Va2Va6 and Vi2Va6 > 0
167150041217     c                   Clear                   dsyeur
167160041217     c                   Movel     wdiv2         YecDvi
167170041217     c                   Z-add     Vi2va6        YecImi
167180041217     c                   Movel     Vi2Div        YecDvo
167190041217    3c                   If        O17fDc = 'S'
167200041217     c                   Movel     '3'           YecDco
167210041217    3c                   EndIf
167220041217     c                   Call      'YEURCO'
167230041217     c                   Parm                    dsyeur
167240041217    3c                   If        YecEsi = *Blanks
167250041217     c                   Z-add     YecImo        Vi2Va6
167260041217     c                   Eval      wemfor = '1'
167270041217    3c                   EndIf
167280041217    2c                   EndIf
167290040114
167300991028    1C                   ENDIF
167310991028      *
167320991028     C                   Z-ADD     VI2VA1        VA2VA1
167330040114     c                   Z-add     Vi2Va2        Va2Va2
167340040114     c                   Z-add     Vi2Va3        Va2Va3
167350040114     c                   Z-add     Vi2Va4        Va2Va4
167360041217     c                   Z-add     Vi2Va5        Va2Va5
167370041217     c                   Z-add     Vi2Va6        Va2Va6
167380040121     C                   Z-ADD     VI2VA1        VVA(1)
167390040121     c                   Z-add     Vi2Va2        Vva(2)
167400040121     c                   Z-add     Vi2Va3        Vva(3)
167410040121     c                   Z-add     Vi2Va4        Vva(4)
167420041217     c                   Z-add     Vi2Va5        Vva(5)
167430041217     c                   Z-add     Vi2Va6        Vva(6)
167440991028     C                   MOVEL     VI2DIV        WDIV2
167450991028     C* RIEMETTO VIDEATA
167460991028     C     WEMFOR        IFEQ      '1'
167470991028     C                   GOTO      ENDC03
167480991028    2C                   ENDIF
167490940826     C*
167500100119      * Gli altri controlli sono demandati al FNLV16
167510100119     C                   CLEAR                   Dlv1601
167520100119     C                   CLEAR                   DSLV16
167530100119     C                   CLEAR                   DTASV
167540100119
167550940920     C* 2 BOLLA --> CONTROLLO I CAMPI
167560991011    1C     VI2SV1        IFNE      *BLANKS
167570991011     C     VI2VA1        ORNE      *ZEROS
167580040114     c     Vi2Sv2        orne      *Blanks
167590040114     c     Vi2Va2        orne      *Zeros
167600040114     c     Vi2Sv3        orne      *Blanks
167610040114     c     Vi2Va3        orne      *Zeros
167620040114     c     Vi2Sv4        orne      *Blanks
167630040114     c     Vi2Va4        orne      *Zeros
167640041217     c     Vi2Sv5        orne      *Blanks
167650041217     c     Vi2Va5        orne      *Zeros
167660041217     c     Vi2Sv6        orne      *Blanks
167670041217     c     Vi2Va6        orne      *Zeros
167680991011     C     VI2DIV        ORNE      *BLANKS
167690100119     C                   MOVEL     'E'           D17FIM
167700100119   x1c                   else
167710100119     c* controllo solo il codice esenzione IVA
167720100119    2C     VI2CEI        ifne      *BLANKS
167730100119     C                   MOVEL     'I'           D17FIM
167740100119    2c                   endif
167750100119    1c                   endif
167760991026      *
167770100119    1c                   if        d17fim<>' '
167780991011     C                   MOVEL     'P'           D17TBO
167790991011     C                   MOVEL     WKSC          D17KSC
167800991028     C                   Z-ADD     BLPDSP        D17DSP
167810991011     C                   MOVEL     VIDLNP        D17LNP
167820991011     C                   MOVEL     VIDLNA        D17LNA
167830991011     C                   MOVEL     §3ATB2        D17TBL
167840991011     C                   MOVEL     §3ARBL        D17RBL
167850020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
167860040115     c                   Movel     §3asva        §d17Sva
167870040115      * passo che devo controllare la seconda bolla
167880040115     c                   Eval      §d17Tb2 = 'S'
167890100119     c                   Eval      §d17ctriso='S'
167900100119     c                   Eval      §d17iso=vidisd
167910100119
167920100119     c                   if        vidpid<>*blanks and vidisd=*blanks
167930100119     c                   eval      §d17iso='IT'
167940100119     c                   endif
167950100119
167960040115     c                   Movel     Dlv1601       D17Flo
167970991011     C                   MOVEL     VI2DIV        D17DIV
167980991011     C                   MOVEL     WDIV2         D17DVP
167990991011     C     §3AFCA        IFEQ      2
168000991011     C                   MOVEL     'S'           D17FCA
168010991011     C                   ENDIF
168020991011     C                   MOVEL     VI2CEI        D17CEI
168030991012     C                   MOVEL     VI2SV1        VSV(1)
168040991012     C                   MOVEL     VI2VA1        VVA(1)
168050040121     c                   Movel     Vi2Es1        ves(1)
168060040115     C                   MOVEL     VI2SV2        VSV(2)
168070040115     C                   Z-add     VI2VA2        VVA(2)
168080040121     c                   Movel     Vi2Es2        ves(2)
168090040115     C                   MOVEL     VI2SV3        VSV(3)
168100040115     C                   Z-add     VI2VA3        VVA(3)
168110040121     c                   Movel     Vi2Es3        ves(3)
168120040115     C                   MOVEL     VI2SV4        VSV(4)
168130040115     C                   Z-add     VI2VA4        VVA(4)
168140040121     c                   Movel     Vi2Es4        ves(4)
168150041217     C                   MOVEL     VI2SV5        VSV(5)
168160041217     C                   Z-add     VI2VA5        VVA(5)
168170041217     c                   Movel     Vi2Es5        ves(5)
168180041217     C                   MOVEL     VI2SV6        VSV(6)
168190041217     C                   Z-add     VI2VA6        VVA(6)
168200041217     c                   Movel     Vi2Es6        ves(6)
168210100119     c* In questo caso passo il codice iso della partita iva del destinatario
168220100119     c
168230991011      *
168240991011     C                   CALL      'FNLV16R'
168250991011     C                   PARM                    DSLV16
168260991012     C                   PARM                    DTASV
168270991011      *
168280991011     C                   MOVEL     D17CEI        VI2CEI
168290991011     C                   MOVEL     D17DIV        VI2DIV
168300991015     C                   MOVEL     O17FDC        WFDC2
168310991011     C                   MOVEL     O17DEI        V2DCEI
168320040115      * Ricarico le varie
168330040115     c                   Movel     Vsv(1)        Vi2Sv1
168340040115     c                   Z-add     Vva(1)        Vi2Va1
168350040121     c                   Movel     Ves(1)        Vi2Es1
168360040115     c                   Movel     Vsv(2)        Vi2Sv2
168370040115     c                   Z-add     Vva(2)        Vi2Va2
168380040121     c                   Movel     Ves(2)        Vi2Es2
168390040115     c                   Movel     Vsv(3)        Vi2Sv3
168400040115     c                   Z-add     Vva(3)        Vi2Va3
168410040121     c                   Movel     Ves(3)        Vi2Es3
168420040115     c                   Movel     Vsv(4)        Vi2Sv4
168430040115     c                   Z-add     Vva(4)        Vi2Va4
168440040121     c                   Movel     Ves(4)        Vi2Es4
168450041217     c                   Movel     Vsv(5)        Vi2Sv5
168460041217     c                   Z-add     Vva(5)        Vi2Va5
168470041217     c                   Movel     Ves(5)        Vi2Es5
168480041217     c                   Movel     Vsv(6)        Vi2Sv6
168490041217     c                   Z-add     Vva(6)        Vi2Va6
168500041217     c                   Movel     Ves(6)        Vi2Es6
168510991011      *
168520991011     C     O17ERR        IFNE      *BLANKS
168530991011      *
168540991011      *  Se errore riemetto videata con messaggio
168550991011     C     O17MSG        IFNE      *BLANKS
168560991011     C                   MOVEL     O17MSG        VIDMSG
168570991011     C                   SETON                                        90
168580991011      *  Se interrogazione riemetto videata
168590991011     C                   ELSE
168600991011     C                   MOVEL     '1'           WEMFOR            1
168610991011     C                   ENDIF
168620991011      *
168630991011     C                   SELECT
168640991011     C     O17ERR        WHENEQ    '1'
168650991011     C                   SETON                                        42
168660991011     C     O17ERR        WHENEQ    '6'
168670040116     c                   If        O17Erv = 1
168680991011     C                   SETON                                        40
168690040115     c                   EndIf
168700040116     c                   If        O17Erv = 2
168710040115     c                   z-add     09            H3riga
168720041217     c                   z-add     49            H3colo
168730040115     c                   EndIf
168740040116     c                   If        O17Erv = 3
168750041217     c                   z-add     09            H3riga
168760041217     c                   z-add     65            H3colo
168770040115     c                   EndIf
168780040116     c                   If        O17Erv = 4
168790040115     c                   z-add     10            H3riga
168800041217     c                   z-add     33            H3colo
168810040115     c                   EndIf
168820041217     c                   If        O17Erv = 5
168830041217     c                   z-add     10            H3riga
168840041217     c                   z-add     49            H3colo
168850041217     c                   EndIf
168860041217     c                   If        O17Erv = 6
168870041217     c                   z-add     10            H3riga
168880041217     c                   z-add     65            H3colo
168890041217     c                   EndIf
168900991011     C     O17ERR        WHENEQ    '7'
168910991011     C                   SETON                                        43
168920991011     C                   ENDSL
168930991011      *
168940991011     C   90              GOTO      ENDC03
168950991011     C                   ENDIF
168960991011      *
168970991011    1C                   ENDIF
168980040130      * salvo le varie in una sk per poterle poi riorganizzare al momento
168990040130      * della scrittura dei file FIAR6 e FIAR7
169000040130     c                   Eval      W2sv(1) = vi2sv1
169010040130     c                   Eval      W2va(1) = vi2va1
169020040130     c                   Eval      W2sv(2) = vi2sv2
169030040130     c                   Eval      W2va(2) = vi2va2
169040040130     c                   Eval      W2sv(3) = vi2sv3
169050040130     c                   Eval      W2va(3) = vi2va3
169060040130     c                   Eval      W2sv(4) = vi2sv4
169070040130     c                   Eval      W2va(4) = vi2va4
169080041217     c                   Eval      W2sv(5) = vi2sv5
169090041217     c                   Eval      W2va(5) = vi2va5
169100041217     c                   Eval      W2sv(6) = vi2sv6
169110041217     c                   Eval      W2va(6) = vi2va6
169120040130      * Controllo se caricata almeno una varia
169130041217do  1c                   Do        6             c
169140040130     c                   If        w2sv(c) <> *Blanks
169150040130     c                   Eval      wesvar1 = 'S'
169160040130     c                   EndIf
169170040130    1c                   EndDo
169180011212     C* CONTROLLO CHE LA L'IMPORTO NON SUPERI IL LIMITE FATTURABILE
169190040130     c                   xfoot     w2va          wsomts
169200040116if  1c                   If        wsomts > *Zeros
169210011212     C     VI2DIV        IFNE      §GEDCN
169220011212     C                   CLEAR                   DSYEUR
169230011212     C                   MOVEL     VI2DIV        YECDVI
169240011212     C                   MOVEL     §GEDCN        YECDVO
169250040114     c                   Z-add     wsomts        YecImi
169260011212     C                   MOVE      DECCN         YECDCO
169270011212     C                   CALL      'YEURCO'
169280011212     C                   PARM                    DSYEUR
169290011212     C     YECESI        IFEQ      ' '
169300011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
169310011212     C                   ENDIF
169320011212     C                   ENDIF
169330011212     C     WSOMTS        IFGT      IMFGEI
169340040115     c                   Movea     err(242)      k78
169350011212     C                   MOVE      IMFGEI        WNUMED
169360011212     C* richiamo routine per editare il limite
169370011212     C                   EXSR      CALLXE
169380011212      * metto il numero editato nel campo del messaggio
169390011212     C                   MOVEA     W014A         SKII(1)
169400040115     c                   Movea     skii(1)       k78(54)
169410040115     c                   Movea     §gedcn        k78(69)
169420011212     C*
169430011212     C                   MOVEA     K78           VIDMSG
169440011212     C                   SETON                                        4190
169450011212     C                   GOTO      ENDC03
169460011212     C                   ENDIF
169470040116    1C                   ENDIF
169480040126
169490040126     c                   Z-add     wsomts        Vi2Imv
169500991011      *
169510991012      * SE TASSAZIONE CON TARIFFA MITTENTE PROVO A RITASSARE
169520991012      * NON TASSO SE P.A. EXPORT
169530950127    1C   04SAVFTM        IFEQ      'S'
169540950127     C     VIDFTM        OREQ      'S'
169550950127    2C     VIDIMV        IFEQ      0
169560980506     C                   MOVEL     '1'           WBOL
169570151014     c                   clear                   PesVolPkcn
169580151014     c                   clear                   PesVolSpc
169590151014     c                   clear                   PesVolImv
169600950127     C                   EXSR      TASSAZ
169610151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
169620151014     c                   if        vidimv>0
169630151014     c                   eval      PesVolPkcn=taspkcn
169640151014     c                   eval      PesVolSpc=tasspc
169650151014     c                   eval      PesVolIMV=vidimv
169660151014     c                   endif
169670950127    2C                   END
169680950127    1C                   END
169690991012      *
169700991012      * SE VARIATA LA DIVISA: LA CONTROLLO, CONVERTO IMPORTI MODIFICATI
169710991012      *                       E RIEMETTO LA VIDEATA
169720991012     C     VIDDIV        IFNE      WDIV1
169730991015     C     VIDDIV        ANDNE     *BLANKS
169740991026     C     WDIV1         ANDNE     *BLANKS
169750991012     C                   EXSR      VARDIV
169760991028     C     WEMFOR        IFEQ      '1'
169770991012     C                   GOTO      ENDC03
169780991028     C                   ENDIF
169790991012     C                   ENDIF
169800991012      *
169810100119     C                   CLEAR                   Dlv1601
169820100119     C                   CLEAR                   DSLV16
169830991007     C                   CLEAR                   DTASV
169840941219     C                   MOVEL     'P'           D17TBO
169850991012      * PER PREPAGATI IMPOSTO IL FLAG APPOSITO
169860991012     C   22              MOVEL     'S'           D17PRP
169870991012     C  N04              MOVEL     WKSC          D17KSC
169880941219     C*
169890941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
169900991012    1C     SAVFTM        IFEQ      'S'
169910991012     C     *IN04         ANDEQ     *ON
169920941219     C     VIDFTM        OREQ      'S'
169930991012     C     *IN04         ANDEQ     *ON
169940941221     C                   MOVE      WKSC          D17KSC
169950941219     C                   MOVEL     'S'           D17FTM
169960991012      *
169970991012      * SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
169980941219   X2C                   ELSE
169990941221     C                   MOVEL     COMLNA        D17KSC
170000941221     C                   MOVE      9999          D17KSC
170010991012    1C                   ENDIF
170020991012      *
170030991012     C                   MOVEL     'C'           D17FIM
170040941219     C                   MOVEL     VIDLNP        D17LNP
170050941219     C                   MOVEL     VIDLNA        D17LNA
170060941219     C                   MOVEL     §3ATB1        D17TBL
170070941219     C                   MOVEL     §3ARBL        D17RBL
170080020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
170090020503     C                   MOVEL     §3ASVA        D17FLO
170100950103     C     §3AFCA        IFEQ      1
170110941219     C                   MOVEL     'S'           D17FCA
170120941219     C                   ENDIF
170130941219     C                   MOVEL     VIDIAS        D17IAS
170140941219     C                   MOVEL     VIDQFT        D17QFT
170150941219     C                   MOVEL     VIDPOR        D17POR
170160991014     C     COMDFT        IFGT      *ZEROS
170170991014     C                   Z-ADD     COMDFT        D17DSP
170180991012     C                   ELSE
170190991028     C                   Z-ADD     BLPDSP        D17DSP
170200991012     C                   ENDIF
170210941219     C                   MOVEL     VIDIMV        D17IMV
170220941219     C                   MOVEL     VIDCEI        D17CEI
170230941219     C                   MOVEL     VIDFIV        D17FIV
170240941219     C                   MOVEL     VIDNFT        D17NFT
170250941219     C                   MOVEL     VIDDFT        D17DFG
170260941219     C                   MOVEL     'S'           D17FFI
170270991012     C                   MOVEL     VIDDIV        D17DIV
170280991012     C                   MOVEL     WDIV1         D17DVP
170290100119     c
170300100119     c* Controllo codice esenzione iva con partita iva del "chi paga"
170310100120     c*  sempre se ASSEGNATO
170320100119
170330100119     c                   if        *in04
170340100120     c                   Eval      §d17ctriso='S'
170350100119     c                   Eval      §d17iso=vidisd
170360100119     c                   if        vidpid<>*blanks and vidisd=*blanks
170370100119     c                   eval      §d17iso='IT'
170380100119     c                   endif
170390100119
170400100119     c                   else
170410100120     c*  solo per prepagati se FRANCO
170420100120     c                   if        *in22
170430100120     c                   Eval      §d17ctriso='S'
170440100119     c                   Eval      §d17iso=vidism
170450100119     c                   if        vidpim<>*blanks and vidism=*blanks
170460100119     c                   eval      §d17iso='IT'
170470100119     c                   endif
170480100120     c                   endif
170490100120     c
170500100119     c                   endif
170510100119
170520100119     c                   Movel     Dlv1601       D17Flo
170530991012      *
170540991012      * CARICO SCHIERA VARIE
170550941219     C                   CLEAR                   C
170560941219     C                   DO        20            NRR
170570941219     C     NRR           CHAIN     LS01S03                            30
170580941219     C     *IN30         IFEQ      *OFF
170590970604     C**
170600941219     C                   ADD       1             C
170610941219     C                   MOVEL     V3CSV1        VSV(C)
170620991007     C                   Z-ADD     V3CVA1        VVA(C)
170630030623     C* MEMORIZZO SE C'E' LA VARIA DELLA BOLLA NEL CASO DI BOLLE CON SINGOLA VAR
170640030623     C                   IF        §3ASVA <> *BLANKS AND V3CSV1 = §3ASVA
170650030623     C                   MOVEL     'S'           WVAR3A            1
170660030623     C                   ENDIF
170670941219     C                   ENDIF
170680941219     C                   ENDDO
170690970604     C* ERRORE
170700970604     C   90              GOTO      ENDC03
170710990701     C**
170720941219     C** CALL
170730991008     C                   CALL      'FNLV16R'
170740991008     C                   PARM                    DSLV16
170750991007     C                   PARM                    DTASV
170760991012      *
170770991012     C                   MOVEL     D17DIV        VIDDIV
170780991015     C                   MOVEL     O17FDC        WFDC1
170790941219     C                   MOVEL     D17CEI        VIDCEI
170800991011     C                   MOVEL     O17DEI        DESCEI            8
170810991011     C                   MOVEL     O17DEI        V3DCEI
170820941219     C                   Z-ADD     D17DFG        VIDDFT
170830991011     C                   Z-ADD     O17DFA        COMDFT
170840991012      *
170850991012      * RICARICO LE VARIE
170860941219     C                   DO        20            NRR
170870941219     C     NRR           CHAIN     LS01S03                            30
170880941219     C                   MOVEL     VSV(NRR)      V3CSV1
170890941219     C                   MOVEL     VES(NRR)      V3CEV1
170900941223     C*
170910941223     C     VSV(NRR)      IFNE      *BLANKS
170920941223     C                   MOVEL     'S'           WESVAR            1
170930941223     C                   ENDIF
170940941219     C* SE C'E' ERRORE SU VARIA, ACCENDO INDICATORE DI POSIZIONAMENTO
170950991011     C     O17ERV        IFEQ      NRR
170960941219     C                   SETON                                        5090
170970991019     C                   MOVEL     O17MSG        VIDMSG
170980941219     C                   ELSE
170990941219     C                   SETOFF                                       50
171000941219     C                   ENDIF
171010991012      *
171020941219     C  N30              UPDATE    LS01S03
171030941219     C   30              WRITE     LS01S03
171040941219     C                   ENDDO
171050991012      *
171060991015     C   90              GOTO      ENDC03
171070991015      *
171080991012      * GESTIONE ERRORI
171090991011    1C     O17ERR        IFNE      *BLANKS
171100941219     C                   MOVEL     '1'           WEMFOR
171110941021     C*
171120991011    2C     O17MSG        IFNE      *BLANKS
171130991011     C                   MOVEL     O17MSG        VIDMSG
171140941219     C                   SETON                                        90
171150941021    2C                   ENDIF
171160941021     C**
171170941021     C* ESENZIONE IVA
171180991011    2C     O17ERR        IFEQ      '1'
171190950103     C                   SETON                                        46
171200940920     C                   GOTO      ENDC03
171210941021    2C                   ENDIF
171220941021     C**
171230941021     C* NUMERO FATTURA
171240991011     C     O17ERR        IFEQ      '2'
171250941219     C                   SETON                                        48
171260941021     C                   GOTO      ENDC03
171270941021    2C                   ENDIF
171280941021     C**
171290960926     C* REGISTRO IVA FATTURA
171300991011    2C     O17ERR        IFEQ      '3'
171310941219     C                   SETON                                        47
171320941021     C                   GOTO      ENDC03
171330941021    2C                   ENDIF
171340941021     C**
171350941021     C* DATA FATTURA
171360991011     C     O17ERR        IFEQ      '4'
171370941219     C                   SETON                                        49
171380941021     C                   GOTO      ENDC03
171390941021    2C                   ENDIF
171400941021     C**
171410941021     C* IMPONIBILE
171420991011     C     O17ERR        IFEQ      '5'
171430941219     C                   SETON                                        45
171440941021     C                   GOTO      ENDC03
171450941021    2C                   ENDIF
171460991012     C**
171470991012     C* DIVISA
171480991012     C     O17ERR        IFEQ      '7'
171490991012     C                   SETON                                        53
171500991012     C                   GOTO      ENDC03
171510991012    2C                   ENDIF
171520991012     C**
171530991012     C* PORTO
171540991012     C     O17ERR        IFEQ      '8'
171550991012     C                   SETON                                        52
171560991012     C                   GOTO      ENDC03
171570991012    2C                   ENDIF
171580941021     C*
171590941021    1C                   ENDIF
171600991104      *
171610991104      * MEMORIZZO GLI IMPORTI DI TASSAZIONE IN CAMPI DI COMODO PER CONFRONTI
171620011212     C* MENTRE MEMORIZZO FACCIO ANCHE LA SOMMA DEGLI IMPORTI PER POI
171630011212     C* CONTROLLARLA COL LIMITE FATTURABILE
171640991104     C                   Z-ADD     VIDPOR        MEMPOR
171650011212     C                   Z-ADD     VIDPOR        WSOMTS           17 3
171660991104     C                   MOVEL     VIDDIV        WDIV1
171670991104     C                   DO        20            NRR
171680991104     C     NRR           CHAIN     LS01S03                            30
171690991104     C                   Z-ADD     V3CVA1        V3HVA1
171700011219     C* Se è bolla di rientro non tassata fino all'imponibile con varia
171710011219     c* "N" 88888888 non la considero per il confronto con §geimf
171720011219     C     VIDFBR        IFEQ      'S'
171730011219     C     V3CSV1        ANDEQ     'N'
171740011219     C     V3CVA1        ANDEQ     88888888
171750011219     C     VIDIMV        ANDEQ     *ZEROS
171760030624     C* oppure varia & 8888888
171770030624     C     V3CSV1        OREQ      '&'
171780030624     C     V3CVA1        ANDEQ     88888888
171790030624     C     VIDIMV        ANDEQ     *ZEROS
171800011219     C                   ELSE
171810011212     C                   ADD       V3CVA1        WSOMTS
171820011219     C                   ENDIF
171830991104     C  N30              UPDATE    LS01S03
171840991104     C                   ENDDO
171850011212     C***
171860011212     C     VIDIMV        IFGT      *ZEROS
171870011212     C                   Z-ADD     VIDIMV        WSOMTS
171880011212     C                   ENDIF
171890011212     C* CONTROLLO CHE LA SOMMA DEGLI IMPORTI O IL TOTALE IMPONIBILE,
171900011212     C* SE PRESENTE, NON SUPERI IL LIMITE FATTURABILE
171910011212     C     WSOMTS        IFGT      *ZEROS
171920011212     C     VIDDIV        IFNE      §GEDCN
171930011212     C                   CLEAR                   DSYEUR
171940011212     C                   MOVEL     VIDDIV        YECDVI
171950011212     C                   MOVEL     §GEDCN        YECDVO
171960011212     C                   Z-ADD     WSOMTS        YECIMI
171970011212     C                   MOVE      DECCN         YECDCO
171980011212     C                   CALL      'YEURCO'
171990011212     C                   PARM                    DSYEUR
172000011212     C     YECESI        IFEQ      ' '
172010011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
172020011212     C                   ENDIF
172030011212     C                   ENDIF
172040011212     C     WSOMTS        IFGT      IMFGEI
172050011212     C                   MOVEA     ERR(242)      K78
172060011212     C                   MOVE      IMFGEI        WNUMED
172070011212     C* richiamo routine per editare il limite
172080011212     C                   EXSR      CALLXE
172090011212      * metto il numero editato nel campo del messaggio
172100011212     C                   MOVEA     W014A         SKII(1)
172110011212     C                   MOVEA     SKII(1)       K78(54)
172120011212     C                   MOVEA     §GEDCN        K78(69)
172130011212     C*
172140011212     C                   MOVEA     K78           VIDMSG
172150011212     C                   SETON                                        5290
172160011212     C                   GOTO      ENDC03
172170011212     C                   ENDIF
172180011212     C                   ENDIF
172190991012      *
172200991012     C* PER COD 8888 O 9999 CON VARIA "R" OBBLIGATORIO IMPORTO DA ASSICURARE
172210991012     C*  "S" IN O17FAS INDICA QUESTO TIPO DI ERRORE
172220991011    3C     O17FAS        IFEQ      'S'
172230940923     C* SE = 0 E FORZO CON ENTER PRENDO VALORE DA TARIFFA
172240941021    4C     SEI           IFNE      NUMFOR
172250941021     C                   MOVEL     ERR(9)        VIDMSG
172260940923     C                   SETON                                        5090
172270940923     C                   ADD       1             SEI
172280940923     C                   GOTO      ENDC03
172290940923    4C                   ENDIF
172300940923    3C                   ENDIF
172310940826     C*
172320950421     C* DATA FATTURA DEVE APPARTENERE ALLO STESSO MESE DELLA DATA SPEDI
172330990701    3C     VIDDFT        IFGT      0
172340990830     C     *IN22         ANDEQ     *OFF
172350950421     C                   MOVEL     VIDDFT        W0040             4 0
172360950421     C                   MOVE      W0040         W0020F            2 0
172370950421     C                   MOVEL     VIDDSP        W0040
172380950421     C                   MOVE      W0040         W0020S            2 0
172390990701    4C     W0020S        IFNE      W0020F
172400950421     C                   SETON                                        4990
172410950421     C                   MOVEL     ERR(116)      VIDMSG
172420950421     C                   GOTO      ENDC03
172430990701    4C                   ENDIF
172440990701    3C                   ENDIF
172450961111     C**
172460990830     C* SE LA DATA FATTURA <=10 DATA DI PARUT, IMPOSTO LA PRIMA DATA
172470000113     C*  DEL GIORNO, SE NON CAMBIA L'ANNO, ALTRIMENTI ERRORE
172480991011    2C   22O17DFA        IFLE      WDTU10
172490991011     C     O17DFA        ANDGT     0
172500000113     C                   MOVEL     O17DFA        W0040
172510000113     C     W0040         IFEQ      WAAUPI
172520990830     C* IMPOSTO WDTU10 + 1 E AVVISO
172530990830     C                   Z-ADD     WDTUPI        VIDDFT
172540990830     C                   SETON                                        4990
172550990830     C                   MOVEL     ERR(167)      VIDMSG
172560990830     C                   GOTO      ENDC03
172570000113     C                   ELSE
172580000113     C**
172590000113     C                   SETON                                        4990
172600000113     C                   MOVEL     ERR(182)      VIDMSG
172610000113     C                   GOTO      ENDC03
172620991012    2C                   ENDIF
172630000113    2C                   ENDIF
172640001121     C* SE DATA FATTURA < DATA SPEDIZIONE E CAMBIO MESE, NON POSSO
172650001121     C*  METTERE IN SOSPENSIONE LA BOLLA
172660000508    2C   22O17DFA        IFGT      WDTU10
172670000508     C     O17DFA        ANDGT     0
172680001121     C                   MOVEL     O17DFA        W0060F            6 0
172690001121     C                   MOVEL     BLPDSP        W0060S            6 0
172700000508     C     W0060F        IFLT      W0060S
172710000508     C     BLPDSP        ANDGT     DATEU
172720000508     C                   SETON                                        4990
172730000508     C                   MOVEL     ERR(193)      VIDMSG
172740000508     C                   GOTO      ENDC03
172750000508     C                   ENDIF
172760000508     C                   ENDIF
172770000113     C*
172780990610     C* SE FRANCO FRONTIERA SPECIFICARE IL PORTO
172790961111     C  NKLVIDPOR        IFEQ      0
172800961111     C     VIDFBR        ANDEQ     'F'
172810961111     C                   SETON                                        5290
172820961111     C                   MOVEL     ERR(129)      VIDMSG
172830961111     C                   GOTO      ENDC03
172840961111     C                   ENDIF
172850990610     C*
172860990610     C* SE PREPAGATO INSERIRE TASSAZIONE O F14 PER TASSARE
172870990701     C  NKL
172880990701    1CANNKN*IN22         IFEQ      *ON
172890990701    2C     VIDIMV        IFEQ      0
172900990614     C                   SETON                                        5290
172910990610     C                   MOVEL     ERR(160)      VIDMSG
172920990610     C                   GOTO      ENDC03
172930990701   X2C                   ELSE
172940990701    3C     VIDIMV        IFNE      SAVIMV
172950990716     C     VIDIMV        ANDGT     0
172960060207     c* se sono in manutenzione errore se già incassato
172970060208     c                   if        *in12 = *on and *in15 = *off and
172980070514     c****                         dateu >= §vpogpp and vidimv <> savimvo
172990070514     c                             vidimv <> savimvo
173000060208     c                   exsr      sr_callycow
173010060208     c                   if        prmesito <> 0
173020060208     C                   SETON                                        90
173030060208     C                   MOVEL     ERR(297)      VIDMSG
173040060208     C                   GOTO      ENDC03
173050060208     c                   endif
173060060207     c                   endif
173070120105     c                   if        viddft>0
173080120105     C                   Z-ADD     viddft        G02DAT
173090120105     C                   MOVEL     *BLANK        G02ERR
173100120105     C                   CALL      'XSRDA8'
173110120105     C                   PARM                    WLBDAT
173120120105     C                   MOVEL     G02INV        comdft
173130120105     c                   else
173140990630     C                   Z-ADD     DATEU         COMDFT
173150120105     c                   endif
173160990630     C                   EXSR      TOTFAT
173170990630     C                   Z-ADD     D04IFT        VIDIFT
173180990701     C                   Z-ADD     D04IMV        VIDIMV
173190990701     C                   Z-ADD     D04POR        VIDPOR
173200991014     C                   Z-ADD     D04POR        MEMPOR
173210990701     C                   MOVEL     '1'           WEMFOR
173220990701     C                   Z-ADD     VIDIMV        SAVIMV
173230990701    3C                   ENDIF
173240990701    2C                   ENDIF
173250990630     C* LIBRO IVA
173260990701    2C     *IN34         IFEQ      *ON
173270020725     C                   clear                   DSBS02
173280020725     C                   clear                   DYIV
173290020725     C                   movel     'C'           T02mod
173300020725     C                   movel     KNSIF         T02sif
173310020725     C                   movel     'YIV'         T02cod
173320020725     C                   movel     C_Soc         T02ke1
173330020725     C                   movel     VIDLNP        T02ke2
173340020725     C                   call      'TIBS02R'
173350020725     C                   parm                    KPJBA
173360020725     C                   parm                    DSBS02
173370020725     C                   IF        T02err = *blanks
173380020725     C                   movel     T02uni        DYIV
173390020725     C                   movel     §IVLVF        FIV
173400020725     C                   else
173410020725     C                   clear                   DYIV
173420020725     C                   movel     VIDLNP        FIV
173430020725     C                   endif
173440990630     C* NUMERO FATTURA
173450990630     C     KNUM          CHAIN(N)  CNNUM000                           30
173460990630     C* ERRORE : MANCA IL NUMERATORE DELLE FATTURE
173470990701    3C     *IN30         IFEQ      *ON
173480990630     C                   MOVEL     ERR(164)      VIDMSG
173490990630     C                   SETON                                        5290
173500990630     C                   GOTO      ENDC03
173510990701    3C                   ENDIF
173520990701    2C                   ENDIF
173530990701    1C                   ENDIF
173540011025      * Se è bolla di reso con varia 'N' 88888888 deve esserci la varia 'N'
173550011025     C                   SETOFF                                       50
173560011025    1C     FLGVRN        IFEQ      '1'
173570011025    2C                   DO        20            NRR
173580011025     C     NRR           CHAIN     LS01S03                            30
173590011025    3C     *IN32         IFEQ      *OFF
173600011025     C                   SETON                                        50
173610011025    4C     V3CSV1        IFEQ      'N'
173620011025     C                   SETOFF                                       50
173630011025     C                   LEAVE
173640011025    4C                   ENDIF
173650011025    3C                   ENDIF
173660011025    2C                   ENDDO
173670011025    2C     *IN50         IFEQ      '1'
173680011025     C     1             CHAIN     LS01S03                            30
173690011025     C  N30              UPDATE    LS01S03
173700011114     C                   MOVEL     ERR(233)      VIDMSG
173710011025     C                   SETON                                        90
173720011025     C                   GOTO      ENDC03
173730011025    2C                   ENDIF
173740011025    1C                   ENDIF
173750991012      *
173760940923     C     ENDC03        TAG
173770940928     C   90              MOVEL     '1'           WEMFOR            1
173780991012      *
173790940923     C                   ENDSR
173800060208     C* Richiamo pgm che verifca se prepagato incassato -------------*
173810060208     C     sr_callycow   BEGSR
173820060208     c                   z-add     §lpaas        prmaas
173830060208     c                   z-add     §lplnp        prmlnp
173840060208     c                   z-add     §lpnrs        prmnrs
173850060208     c                   z-add     §lpnsp        prmnsp
173860060208     c                   z-add     vidfiv        prmfiv
173870060208     c                   z-add     vidnft        prmnft
173880060208     c                   z-add     dftar6        prmdft
173890060209     c                   clear                   prmesito
173900060607     c                   call      'YCOW0121R1'
173910060208     C                   PARM                    prmaas
173920060208     C                   PARM                    prmLnp
173930060208     C                   PARM                    prmNrs
173940060208     C                   PARM                    prmNsp
173950060208     C                   PARM                    prmFiv
173960060208     C                   PARM                    prmDft
173970060208     C                   PARM                    prmNft
173980060208     C                   PARM                    prmEsito
173990060208     C                   ENDSR
174000971211     C*
174010971211     C* GESTIONE 6 VIDEATA ------------------------------------------*
174020081008     C**   GESD06        BEGSR
174030081008     C**                 MOVEL     COMLNA        V6CLNA
174040971211     C* DECODIFICA LNA
174050081008     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
174060081008     C**N30              MOVEL     ORGDES        V6DLNA
174070971211     C*
174080081008     C**   FOR06         TAG
174090971211     C*
174100081008     C**                 EXFMT     LS01D06
174110081008     C**                 SETOFF                                       4090
174120971211     C* CONTROLLO SE INSERITO NUMERO AWB: NON POSSO CANCELLARLO SE
174130971211     C*  C'ERA
174140081008     C** 12
174150081008    1C**ANN15V6CAWB        IFEQ      0
174160081008     C**   SAVAWB        ANDGT     0
174170081008     C**                 SETON                                        4090
174180081008     C**                 MOVEL     ERR(145)      VIDMSG
174190081008     C**                 GOTO      FOR06
174200081008    1C**                 ENDIF
174210971211     C*
174220081008     c**   A_§ogntw      ifeq      'EUP'
174230081008     C**                 MOVEL     WKSC          W007A
174240081008     C**   W007A         LOOKUP    KSS                                    30
174250081008    2C**   *IN30         IFEQ      *ON
174260971211     C**
174270971211     C* CONTROLLO CHECK DIGIT
174280081008    3C**   V6CAWB        IFGT      0
174290081008     C**                 MOVEL     V6CAWB        W0090             9 0
174300081008     C**   W0090         DIV       7             RISUL            10 0
174310081008     C**                 MVR                     RESTO             1 0
174320971211     C**
174330081008     C**                 MOVE      V6CAWB        W0010             1 0
174340081008    4C**   RESTO         IFNE      W0010
174350081008     C**                 SETON                                        4090
174360081008     C**                 MOVEA     ERR(147)      K78
174370081008     C**                 MOVEL     RESTO         K78(66)
174380081008     C**                 MOVEA     K78           VIDMSG
174390081008     C**                 GOTO      FOR06
174400081008    4C**                 ENDIF
174410081008    3C**                 ENDIF
174420081008    2C**                 ENDIF
174430081008    1C**                 ENDIF
174440971211     C**
174450081008     C**                 ENDSR
174460991203     C*
174470991203     C* GESTIONE 7 VIDEATA ------------------------------------------*
174480991203     C     GESD07        BEGSR
174490991203     C                   MOVEL     COMLNA        V7CLNA
174500991203     C* DECODIFICA LNA
174510991203     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
174520991203     C  N30              MOVEL     ORGDES        V7DLNA
174530991203     C*
174540991203     C     FOR07         TAG
174550991203     C*
174560161129     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
174570161129     c                   if        *in12 and not *in15
174580161129     C                   write     LS01D07
174590161129     C                   read(E)   fnls01d
174600161129     c                   else
174610161129     C                   exfmt     LS01D07
174620161129     c                   endif
174630161129     c
174640991203     C                   SETOFF                                       4090
174650161129
174660161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
174670161129     c                   if        %error
174680161129     C                   MOVEL     '6'           §LPFPR
174690161129     c                   leavesr
174700161129     c                   endif
174710161129
174720991203     C* CONTROLLO SE INSERITO NUMERO PARCEL: NON POSSO CANCELLARLO SE
174730991203     C*  C'ERA
174740991203     C   12
174750060616     CANN15V7CNPR        IFEQ      *blanks
174760060616     C     SAVNPR        ANDne     *blanks
174770991203     C                   SETON                                        4090
174780991203     C                   MOVEL     ERR(176)      VIDMSG
174790991203     C                   GOTO      FOR07
174800991203     C                   ENDIF
174810991203      **
174820991203      * CONTROLLO VALIDITA'
174830060616    1C     V7CNPR        IFne      *blanks
174840000308     C     §3ARBL        ANDNE     'R'
174850000124     C                   MOVEL     V7CNPR        WNPR
174860000124     C                   EXSR      DPDVAL
174870000124     C   90              SETON                                        40
174880000124     C   90              GOTO      FOR07
174890070323     c* Sped. export DPD:
174900070323     c* dal I° aprile non più ammessi parcel dpd lunghi 12
174910070326     C                   if        A_§OGNTW='DPD' and dateu >=20070401
174920070326     c                             and %subst(wnpr:14:1)=*blanks
174930070326     c                             and vidfbr<>'S'
174940070323     c                   seton                                        9040
174950070323     C                   MOVEL     ERR(299)      VIDMSG
174960070323     C                   GOTO      FOR07
174970070323     c                   endif
174980000124     C*
174990991227    1C                   ENDIF
175000070323     c
175010000124     C**
175020000124     C* CONTROLLO NUMERO PARCEL DPD DOPPIO
175030000308     C* IGNORO PER BOLLA SENZA SEGNACOLLI
175040000308     C     §1BFG8        IFEQ      'S'
175050060616     C                   movel     V7CNPR        WNPR
175060060616     c                   if        *in79=*on
175070060616     c                   exsr      dpddop_imp
175080060616     c                   else
175090000124     C                   EXSR      DPDDOP
175100060616     c                   endif
175110000124     C* ERRORE
175120000124     C   90              SETON                                        40
175130000124     C   90              GOTO      FOR07
175140060612     C                   ENDIF
175150991217     C**
175160060623     c* se import dpd metto il nuovo numero nel rmn se possibile
175170060623     c                   if        *in79='1' and *in13='0' and
175180060623     c                             wsolo_num=*blanks
175190060623     c                   clear                   vidrmn
175200060623     c                   if        %subst(v7cnpr:14:1) <> *blanks
175210060623     C                   move      VIDNRD        VIDRMN
175220060623     c                   else
175230060623     c                   eval      w012a=%subst(v7cnpr:1:12)
175240060623     c                   move      w012A         vidrmn
175250060623     c                   endif
175260060623     c
175270060623     c                   endif
175280000124     C                   ENDSR
175290000124     C**
175300000124     C* CONTROLLO VALIDITA' PARCEL DPD--------------------------------*
175310000124     C     DPDVAL        BEGSR
175320060613     c                   clear                   wsolo_num         1
175330060612     c                   select
175340060612     c* controllo parcel lungo 14 --> non devono esserci dei blanks
175350060613     c* e ammesso solo a partire da data in tabella "VPO" (per export)
175360060612     c                   when      %subst(wnpr:14:1) <> *blanks
175370070515     c***                if        *in79='0' and §vpodpd > dateu
175380070515     c***                          and vidfbr =' '
175390070515     C***                SETON                                        90
175400070515     C***                MOVEL     ERR(299)      VIDMSG
175410070515     c***                else
175420060612     c                   if        %scan(' ':wnpr) > 0
175430060612     C                   SETON                                        90
175440060612     C                   MOVEL     ERR(299)      VIDMSG
175450060613     c                   endif
175460070515     c****               endif
175470060613     c                   if        *in90='0'
175480060613     c* controllo se parcel lungo 14 contiene solo numeri
175490060619     c                   z-add     1             hh                2 0
175500061031     c                   z-add     0             hy                2 0
175510060613     c     hh            dowle     14
175520061031     c***  wsolo_num     andeq     *blanks
175530060619     c                   if        %subst(wnpr:hh:1) < '0'
175540060613     c                   eval      wsolo_num='N'
175550061031     c                   eval      hy=hh
175560060613     c                   endif
175570060613     c                   add       1             hh
175580060613     c                   enddo
175590061031     c* le lettere possono esserci solo nei primi 4 bytes dal quinto in poi
175600061031     c* devono essere solo numeri
175610061031     c                   if        wsolo_num='N' and hy >4
175620061031     C                   SETON                                        90
175630061031     C                   MOVEL     ERR(299)      VIDMSG
175640061031     c                   endif
175650061031     c
175660060613     c                   endif
175670060612     c* errore se parcel lungo 13
175680060612     c                   when      %subst(wnpr:13:1) <> *blanks
175690060612     C                   SETON                                        90
175700060612     C                   MOVEL     ERR(299)      VIDMSG
175710060612     c                   other
175720060612     c* controllo parcel lungo 12. Deve contenere solo numeri
175730060612     c                   z-add     1             hh
175740060612     c     hh            dowle     12
175750060612     c     *in90         andeq     '0'
175760060619     c                   if        %subst(wnpr:hh:1) < '0'
175770060612     C                   SETON                                        90
175780060612     C                   MOVEL     ERR(299)      VIDMSG
175790060612     c                   endif
175800060612     c                   add       1             hh
175810060612     c                   enddo
175820060612     c                   if        *in90 = '0'
175830060620     C                   movel     WNPR          DPDBRC
175840060619     C                   Z-ADD     DPDCHD        WDPDBR            1 0
175850061012     C                   CLEAR                   DPDCHD
175860000124     C                   EXSR      M1031
175870000124    3C     DPDCHD        IFNE      WDPDBR
175880000124     C                   SETON                                        90
175890060612     C                   MOVEL     ERR(299)      VIDMSG
175900060612    3C                   ENDIF
175910060612     C                   ENDIF
175920060612     c                   endsl
175930061012     c* Siccome i primi byte del numero parcel dpd corrispondono al
175940061012     c* depot dpd viene segnalato errore bloccante se il numero non
175950061012     c* è presente nell'archivio dei depot
175960061106     c                   if        *in90='0' and
175970061106     c                             ((*in79 and *in12='0') or *in79='0')
175980061012     c                   if        %subst(wnpr:14:1) <> *blanks
175990061012     c                   movel     wnpr          wdpc
176000061012     c                   else
176010061012     c                   eval      wdpc='0'+%subst(wnpr:1:3)
176020061012     c                   endif
176030061107     c                   clear                   truldepds
176040061107     c                   movel     wdpc          idepdpc
176050061107     c                   call      'TRULDEPR'
176060061107     c                   parm                    truldepds
176070061107     c                   if        odeperr='1'
176080061012     C                   SETON                                        90
176090061012     C                   MOVEL     ERR(306)      VIDMSG
176100061012     c                   endif
176110061012     c                   endif
176120060612      *se spedizione export devo anche controllare che numero parcel
176130060621      * inizi per '084' altrimenti errore forzabile
176140060626     c                   if        *in79='0' and *in90='0'
176150060621     c                   if        %subst(wnpr:14:1) <> *blanks
176160060621     c                   movel     wnpr          w0003a            3
176170060621     c     w0003a        ifne      '084'
176180060612     c     wnpr          andne     wnprpre
176190060612     C                   SETON                                        90
176200060621     C                   MOVEL     ERR(303)      VIDMSG
176210060612     c                   endif
176220060621     c                   else
176230060621     c                   movel     wnpr          w0020n            2 0
176240060621     c     w0020n        ifne      84
176250060621     c     wnpr          andne     wnprpre
176260060621     C                   SETON                                        90
176270060621     C                   MOVEL     ERR(289)      VIDMSG
176280060621     c                   endif
176290060621     c                   endif
176300060612     c                   move      wnpr          wnprpre
176310060612     c                   endif
176320000124     C                   ENDSR
176330000124      *
176340000124     C* CONTROLLO SE NUMERO PARCEL EXPORT DPD E' DOPPIO--------------*
176350000124     C     DPDDOP        BEGSR
176360070305     c* non eseguo controllo se pgm richiamato da giacenze
176370070305     c                   if        savfpr<>'G' and savfpr<>'P'
176380000124     C* NON DEVE ESSERE GIA' ESISTENTE
176390000124     C                   MOVEL(P)  WNPR          W030A            30
176400060601     c* tologo il check digit per ricercare il parcel number su fiar4
176410060615    1c                   if        %subst(wnpr:14:1) = *blanks
176420060601     c                   eval      %subst(w030a:12:1)= ' '
176430060616    1c                   endif
176440060601     C                   MOVEL     'I'           WTRC
176450060215     C     Kar4F         SETLL     Fiar403l
176460060215     C     WTRC          READE     fiar403l                               30
176470000124    1C     *IN30         DOWEQ     *OFF
176480000124    2C     *IN12         IFEQ      *OFF
176490000124     C     *IN15         OREQ      *ON
176500060215     C     ar4NRS        ORNE      §LPNRS
176510060215     C     ar4AAS        ORNE      §LPAAS
176520060215     C     ar4NSP        ORNE      §LPNSP
176530000124     C*
176540060615     C                   MOVEL     ar4N30        W014a
176550060615     c                   movel     wnpr          wnpr14           14
176560060707    1c                   if        %subst(wnpr:14:1) = *blanks
176570060707     c                   eval      %subst(wnpr14:12:1)= ' '
176580060707    1c                   endif
176590060615    3C     W014a         IFEQ      WNPR14
176600070305     C**   Kar4B         CHAIN(N)  FNBLT01L                           30
176610070305     C**SOLO SE LNA E LNP UGUALE DO ERRORE
176620070305    4C**N30BLTLNA        IFEQ      COMLNA
176630070305     C**   BLTLNP        ANDEQ     VIDLNP
176640000124     C                   MOVEL     ERR(181)      VIDMSG
176650000124     C                   SETON                                        90
176660000124     C                   GOTO      ENDDOP
176670070305    4C**                 ENDIF
176680000124    3C                   ENDIF
176690000124     C**
176700000203     C                   SETOFF                                       30
176710060615    3C     W014a         IFGT      WNPR14
176720000124     C                   SETON                                        30
176730000124    3C                   ENDIF
176740000124    2C                   ENDIF
176750000124     C*
176760060215     C  N30WTRC          READE     Fiar403l                               30
176770000124    1C                   ENDDO
176780070305     c                   endif
176790000124     C     ENDDOP        ENDSR
176800060613     C* CONTROLLO SE NUMERO PARCEL import DPD E' DOPPIO--------------*
176810060613     C     DPDDOP_imp    BEGSR
176820060613     C* NON DEVE ESSERE GIA' ESISTENTE
176830060613     C                   MOVEL(P)  vidnrd        W030A            30
176840060614     c* se immesso numero parcel lungo 12
176850060613     c* tolgo il check digit per ricercare il parcel number su fiar4
176860060614    1c                   if        %subst(vidnrd:14:1) = *blanks
176870060613     c                   eval      %subst(w030a:12:1)= ' '
176880060614    1c                   endif
176890060613     C                   MOVEL     'I'           WTRC
176900060613     C     Kar4F         SETLL     Fiar403l
176910060613     C     WTRC          READE     fiar403l                               30
176920060614    1C     *IN30         DOWEQ     *OFF
176930060613    2C     *IN12         IFEQ      *OFF
176940060613     C     *IN15         OREQ      *ON
176950060613     C     ar4NRS        ORNE      §LPNRS
176960060613     C     ar4AAS        ORNE      §LPAAS
176970060613     C     ar4NSP        ORNE      §LPNSP
176980060613     C*
176990060613     C                   MOVEL     ar4N30        W014a            14
177000060623     c                   movel     w030a         wnpr14           14
177010060613    3C     W014a         ifeq      WNPR14
177020060628     c     ar4lnp        andeq     vidlnp
177030060614     c
177040060613     c                   movel     dsblp0        savblp
177050061212     c     kblp4m        chain     fnblp01l
177060060614    4c                   if        %found(fnblp01l)
177070060614     C                   Z-ADD     BLPMGS        WDSP
177080060614     C                   MOVEL     BLPAAS        WDSP
177090060614    5C     WDSP          IFGE      DPDDSP
177100061012     c     blpcca        andne     '7'
177110060614     C                   MOVEL     ERR(181)      VIDMSG
177120060614     C                   SETON                                        3090
177130060614    5C                   ENDIF
177140060614    4c                   endif
177150060614     C                   MOVEL     SAVBLP        DSBLP0
177160060613    3C                   ENDIF
177170060613    3C     W014a         IFGT      WNPR14
177180060613     C                   SETON                                        30
177190060613    3C                   ENDIF
177200060613    2C                   ENDIF
177210060613     C*
177220060613     C  N30WTRC          READE     Fiar403l                               30
177230060614    1c                   ENDDO
177240060614     c*
177250060614     c
177260060613     C     ENDDOP_imp    ENDSR
177270991012      *
177280991012      *--- CONVERTO IMPORTI VIDEATA FATTURAZIONE NON MODIFICATI ------*
177290991104     C     VARDIV        BEGSR
177300991012      *
177310991012      * CONTROLLO DIVISA
177320991012     C                   CLEAR                   DSLV16
177330991012     C                   CLEAR                   DTASV
177340991012     C                   MOVEL     'D'           D17FIM
177350991014     C     COMDFT        IFGT      *ZEROS
177360991014     C                   Z-ADD     COMDFT        D17DSP
177370991012     C                   ELSE
177380991028     C                   Z-ADD     BLPDSP        D17DSP
177390991012     C                   ENDIF
177400991012     C                   MOVEL     VIDDIV        D17DIV
177410991012      *
177420991012     C                   CALL      'FNLV16R'
177430991012     C                   PARM                    DSLV16
177440991012     C                   PARM                    DTASV
177450991104      *
177460991104     C                   MOVEL     D17DIV        VIDDIV
177470991012      *
177480991012     C     O17ERR        IFEQ      '7'
177490991012     C                   SETON                                        53
177500991028     C                   MOVEL     '1'           WEMFOR
177510991012     C     O17MSG        IFNE      *BLANKS
177520991015     C                   MOVEL     O17MSG        VIDMSG
177530991012     C                   SETON                                        90
177540991012    2C                   ENDIF
177550991012     C                   GOTO      ENDDIV
177560991012    2C                   ENDIF
177570991012      *
177580991012     C                   CLEAR                   WCONVE
177590991012     C                   CLEAR                   DTASV
177600991012      *
177610991012      * PORTO
177620991012     C     VIDPOR        IFGT      *ZEROS
177630991012    3C     VIDPOR        ANDEQ     MEMPOR
177640991012     C                   CLEAR                   DSYEUR
177650991012     C                   MOVEL     WDIV1         YECDVI
177660991012     C                   Z-ADD     VIDPOR        YECIMI
177670991012     C                   MOVEL     VIDDIV        YECDVO
177680991012     C     O17FDC        IFEQ      'S'
177690991012     C                   MOVEL     '3'           YECDCO
177700991012     C                   ENDIF
177710991012     C                   CALL      'YEURCO'
177720991012     C                   PARM                    DSYEUR
177730991028    4C     YECESI        IFEQ      ' '
177740991012     C                   Z-ADD     YECIMO        VIDPOR
177750991015     C                   MOVEL     'S'           WCONVE            1
177760991028    4C                   ENDIF
177770991028    3C                   ENDIF
177780991012      *
177790991012      * VARIE
177800991012     C                   DO        20            NRR
177810991012     C     NRR           CHAIN     LS01S03                            30
177820991012     C     V3CVA1        IFGT      *ZEROS
177830991012    3C     V3CVA1        ANDEQ     V3HVA1
177840991012     C                   CLEAR                   DSYEUR
177850991012     C                   MOVEL     WDIV1         YECDVI
177860991012     C                   Z-ADD     V3CVA1        YECIMI
177870991012     C                   MOVEL     VIDDIV        YECDVO
177880991012     C     O17FDC        IFEQ      'S'
177890991012     C                   MOVEL     '3'           YECDCO
177900991012     C                   ENDIF
177910991012     C                   CALL      'YEURCO'
177920991012     C                   PARM                    DSYEUR
177930991028    4C     YECESI        IFEQ      ' '
177940991012     C                   Z-ADD     YECIMO        V3CVA1
177950991012     C                   Z-ADD     YECIMO        V3HVA1
177960991019     C                   UPDATE    LS01S03
177970991012     C                   MOVEL     'S'           WCONVE
177980991028    4C                   ENDIF
177990991028    3C                   ENDIF
178000991012     C                   Z-ADD     NRR           C
178010991012      * CARICO SCHIERA VARIE X RICALCOLO TOT FATTURA
178020991012     C     VIDIMV        IFGT      *ZEROS
178030991012     C                   MOVEL     V3CSV1        VSV(C)
178040991012     C                   Z-ADD     V3CVA1        VVA(C)
178050991015     C                   MOVEL     V3CEV1        VES(C)
178060991012     C                   ENDIF
178070991012     C                   ENDDO
178080991012      *
178090991012      * SE CONVERTITI IMPORTI ED è IMPOSTATO IL TOTALE FATTURA LO RICALCOLO
178100991012     C     WCONVE        IFEQ      'S'
178110991028     C                   MOVEL     '1'           WEMFOR
178120991028     C     VIDIMV        IFGT      *ZEROS
178130991012     C                   CLEAR                   DSLV16
178140991012     C                   MOVEL     'T'           D17FIM
178150991012     C                   Z-ADD     VIDPOR        D17POR
178160991012     C                   CALL      'FNLV16R'
178170991012     C                   PARM                    DSLV16
178180991012     C                   PARM                    DTASV
178190991012     C                   ENDIF
178200991028     C                   ENDIF
178210991012      *
178220991012     C     O17ERR        IFEQ      *BLANKS
178230991012     C                   Z-ADD     O17IMV        VIDIMV
178240991012     C                   ELSE
178250991012     C                   CLEAR                   VIDIMV
178260991012     C                   ENDIF
178270991012      *
178280991012     C                   MOVEL     VIDDIV        WDIV1
178290991012     C                   Z-ADD     VIDPOR        MEMPOR
178300991012      *
178310991012     C     ENDDIV        ENDSR
178320991012      *
178330930331     C*--- CALCOLO IL VOLUME -----------------------------------------*
178340930331     C     CALVOL        BEGSR
178350930331     C                   MLLZO     1             VIDNCL
178360930331     C                   MLLZO     1             VIDVOL
178370940825     C                   MLLZO     1             V2CPKG
178380930331     C*
178390930401     C                   Z-ADD     0             VARVOL
178400941230     C* SE DA DISK CLIENTI E' PASSATO IL VOLUME E NON E' STATO VARIATO
178410941230     C* PRENDO IL FLG VOLUME PASSATO SE C'E'
178420941230     C   12
178430941230    1CAN 15VIDVOL        IFNE      0
178440941230     C                   MOVEL     VIDVOL        VARVOL
178450941230     C*
178460941230     C     VIDVOL        IFEQ      §LPVLB
178470941230     C                   MOVEL     §LPFVB        VIDFVR
178480941230     C                   ELSE
178490941230     C                   MOVEL     'R'           VIDFVR
178500941230    1C                   END
178510941230    1C                   END
178520930331     C*
178530941230    1C  N12VIDVOL        IFNE      0
178540930331     C                   MOVEL     'R'           VIDFVR
178550930401     C                   MOVEL     VIDVOL        VARVOL
178560941108    1C                   END
178570930331     C*
178580941108     C   12
178590941108    1CANN15VIDVOL        IFNE      BLPVLB
178600941108    2C     VIDVOL        IFNE      0
178610930401     C                   MOVEL     VIDVOL        VARVOL
178620930331     C                   MOVEL     'R'           VIDFVR
178630941108    2C                   END
178640930331     C*
178650941108   X1C                   ELSE
178660930331     C*
178670941107     C* IN MANUTENZIONE SE NON E' GIA' VOLUME REALE, RICALCOLO
178680941108    2C     §7TRVL        IFEQ      'R'
178690941107     C                   MOVEL     VIDVOL        VARVOL
178700941108    2C                   END
178710941108    1C                   END
178720930331     C*
178730930331     C*  CALCOLO VOLUME AUTOMATICO SE A ZEROS
178740940923    1C     VARVOL        IFEQ      0
178750941025     C                   CLEAR                   DSLV18
178760941025     C                   MOVEL     §3ATB1        D18TBL
178770941025     C                   MOVEL     'P'           D18TBO
178780941025     C                   MOVEL     BLPDSP        D18AAS
178790941025     C                   MOVE      BLPDSP        D18MGS
178800941108     C                   MOVEL     V2CPKG        D18PKF
178810941025     C                   MOVEL     VIDNCL        D18NCL
178820050415     c* se previsti bancali passo il numero colli originali
178830050415     c                   if        %subst(vidgva:1:1)='O'
178840050415     c                   z-add     w03cor        d18ncl
178850050415     c                   endif
178860940923     C* SE NON C'E' TARIFFA CLIENTE USO TARIFFA CARTELLO
178870941108    2C     WTKS          IFEQ      ' '
178880160219     c                   clear                   trulc7ds
178890160224     c                   select
178900160224     c                   when      o27ntw='DPD'
178910160224     c                   eval      IC7tFIE = 'D'
178920160224     c                   when      o27ntw='FED'
178930160224     c                   eval      IC7tFIE = 'F'
178940160224     c                   when      o27ntw='EEX'
178950160224     c                   eval      IC7tFIE = 'E'
178960160224     c                   other
178970160224     c                   eval      IC7tFIE = 'I'
178980160224     c                   endsl
178990160219     c                   eval      IC7DTA  =  blpdsp
179000160219     c                   eval      IC7PKG  =  vidpkg
179010160219     c                   eval      IC7tip  =  i27tip
179020160219     c                   call      'TRULC7R'
179030160219     c                   parm                    trulc7ds
179040160219     C                   MOVEL     oc7KSCc       D18KSC
179050160219     C                   MOVEL     oc7PRGc       D18PRG
179060160219     C                   MOVEL     oc7CTRc       D18CTR
179070941025     C                   ELSE
179080941025     C                   MOVEL     WKSC          D18KSC
179090941025     C                   MOVEL     COMPRG        D18PRG
179100941025     C                   MOVEL     COMCTR        D18CTR
179110940923    2C                   ENDIF
179120020311     c     vidtsp        ifne      *blanks
179130020311     c                   movel     vidtsp        d18tsp
179140020311     c                   else
179150020311     c                   movel     comtsp        d18tsp
179160020311     c                   endif
179170020311     c     comlna        ifgt      *zeros
179180020311     c                   z-add     comlna        d18lna
179190020311     c                   else
179200020311     c                   movel     i27tln        d18tln
179210020311     c                   endif
179220020311     c                   z-add     vidlnp        d18lnp
179230020311     c
179240941025     C*
179250941025     C                   CALL      'FNLV18R'
179260941025     C                   PARM                    DSLV18
179270941025     C*
179280941108     C                   MOVEL     D18FVF        VIDFVR
179290941108     C                   MOVEL     D18VLF        VARVOL
179300930331     C                   END
179310941025     C*
179320941025     C* SE  VOLUME=0 IMPOSTO 0,001
179330930401     C     VARVOL        IFEQ      0
179340941024     C                   Z-ADD     0,001         VARVOL
179350930331     C                   END
179360930331     C                   ENDSR
179370940628     C*
179380940628     C* CALCOLO IL FLAG INOLTRO --------------------------------------*
179390940628     C     INOLTR        BEGSR
179400940628     C                   MOVEL     VIDFIN        WFIN
179410940628     C*
179420940628     C*   SE FERMO DEPOSITO E' SEMPRE ' '
179430940628    1C     VIDFFD        IFEQ      'S'
179440941110     C                   MOVEL     'C'           WFIN
179450940628     C*
179460940628   X1C                   ELSE
179470940628     C*
179480940628     C* CALCOLO  SE NON C'E' FORZATURA
179490940926    2C     WFIN          IFEQ      ' '
179500940919     C                   MOVEL     COMFIN        WFIN
179510940926    2C                   ENDIF
179520940926    1C                   ENDIF
179530940628     C                   ENDSR
179540000627     C*
179550000627     C* ASSEGNO NUMERO DI SEGNACOLLI ALLA BOLLA ----------------------*
179560000627     C     ASSSGN        BEGSR
179570000627     C* IN MANUTENZIONE  SE NUMERO COLLI < DIMINUISCO IL DAL
179580000627     C*  SE > RIASSEGNO I NUMERI
179590000627     C   12
179600000627     CANN15
179610000627    2CAN 25              DO
179620050428    3C     VIDNCL        IFLT      SAVNCL
179630000627     C     SAVNCL        SUB       VIDNCL        DIF               5 0
179640000627     C                   SUB       DIF           VIDNCA
179650000627     C* SE COLLO 1 AZZERO SEGNACOLLO AL
179660000627    4C     VIDNCA        IFEQ      VIDNCD
179670000627     C                   Z-ADD     0             VIDNCA
179680000627    4C                   END
179690000627    3C                   END
179700000627     C*
179710000627    3C     VIDNCL        IFGT      SAVNCL
179720000627    3C     SAVLNA        ORNE      VIDLNA
179730111026     c* Routine di memorizzazione vecchi segnacolli per scrittura R.A. prima
179740111026     c* di pulire VIDNCD e VIDNCA
179750111026     c                   exsr      sr_memRA
179760000627     C                   CLEAR                   VIDNCD
179770000627     C                   CLEAR                   VIDNCA
179780000627    3C                   END
179790000627    2C                   END
179800000627     C*
179810000627     C* SE SEGNACOLLI IMMESSI LI MEMORIZZO
179820000627     C*  SE DEVO STAMPARE SEGNACOLLO LI CALCOLO
179830000627    2C     VIDNCD        IFGT      0
179840000627     C                   MOVEL     VIDNCD        BLPNCD
179850000627     C                   MOVEL     VIDNCA        BLPNCA
179860000627   X2C                   ELSE
179870000627     C                   Z-ADD     0             BLPNCD
179880000627     C                   Z-ADD     0             BLPNCA
179890000627     C* PER CREAZIONE SEGNACOLLO
179900000627    3C     §1BFG8        IFEQ      'S'
179910000627    4C   25              DO
179920000627     C                   CLEAR                   AAS
179930000627     C                   Z-ADD     9             CNU
179940000627     C                   Z-ADD     VIDLNP        COMLIN
179950000627     C                   Z-ADD     COMLNA        LIV2
179960000627     C     KNUF2         CHAIN     FLNUF                              3031
179970000627     C*
179980000627     C   30              Z-ADD     0             BLPNCD
179990000627     C   30              Z-ADD     0             BLPNCA
180000000627     C*
180010000627     C     *IN31         IFEQ      *ON
180020000627     C                   SETON                                        90
180030000627     C                   MOVEL     ERR(42)       VIDMSG
180040000627     C                   MOVEL     '1'           WEMFOR
180050000627     C                   GOTO      ENDASS
180060000627     C                   ENDIF
180070000627     C*
180080000627    5C     *IN30         DOWEQ     *OFF
180090000627     C     NUFNUM        ADD       VIDNCL        BLPNCA
180100000627     C* SE SUPERO IL RANGE FINALE RICOMINCIO DA QUELLO INIZIALE
180110000627    6C     BLPNCA        IFGT      NUFRFI
180120000627     C                   Z-ADD     NUFRIN        NUFNUM
180130000627    6C                   END
180140000627     C*
180150000627     C     NUFNUM        ADD       1             COMSCD
180160000627     C     VIDNCL        ADD       NUFNUM        BLPNCA
180170000627     C*
180180000627     C* CONTROLLO SE ESISTONO GIA' SEGNACOLLI IN QUEL RANGE
180190000627     C*
180200000627    6C     COMSCD        DOWLE     BLPNCA
180210000627     C     COMSCD        ANDGT     0
180220120816     C***  KBLT          CHAIN     FNBLT27L                           30
180230120816     C***                if        not %found(fnblt27l)
180240120816     C     KBLT          CHAIN     FIART27L                           30
180250120816     C                   if        not %found(fIART27l)
180260080925     C     KBLT          CHAIN(N)  fiars01l                           30
180270120817     C**                 if        not %found(fiars01l)
180280120817     C**   KBLT          CHAIN     fnart27l                           30
180290120817     c**                 endif
180300080925     c                   endif
180310000627     C  N30              Z-ADD     COMSCD        NUFNUM
180320000627     C  N30              Z-ADD     BLPNCA        COMSCD
180330000627     C                   ADD       1             COMSCD
180340000627    6C                   END
180350000627     C*
180360000627     C   30NUFNUM        ADD       1             BLPNCD
180370000627     C   30              Z-ADD     BLPNCA        NUFNUM
180380000627     C   30              UPDATE    FLNUF
180390000627    5C                   END
180400000627     C*
180410000627     C* SE AL = DAL AZZERO IL CAMPO
180420000627    5C     BLPNCA        IFEQ      BLPNCD
180430000627     C                   Z-ADD     0             BLPNCA
180440000627    5C                   END
180450000627    4C                   END
180460000627     C*
180470000627   X3C                   ELSE
180480000627     C*
180490000627     C* PER BOLLE SENZA SEGNACOLLI
180500000627     C                   CLEAR                   BLPNCD
180510000627     C                   CLEAR                   BLPNCA
180520000627     C                   CLEAR                   BLPFLS
180530000627     C*
180540000627    3C                   END
180550000627    2C                   END
180560000627     C*
180570000627     C     ENDASS        ENDSR
180580000627     C*
180590000627     C* VEDO COME AGGIORNARE IL CAMPO AGGFST -------------------------*
180600000627     C     AGGFST        BEGSR
180610000627     C* ALLEGA BAM
180620000627     C** PER DISK CLIENTI VEDO SE DEVO STAMPARE LA BOLLA
180630000627     C                   EXSR      CTRSTA
180640000627     C**
180650000627     C*  S I    D D T
180660000627     C**
180670000627    1C     VIDBAM        IFEQ      'S'
180680000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
180690000627    2C     §1BFG3        IFEQ      'S'
180700000627     C                   MOVEL     'C'           BLPFST
180710000627     C                   ELSE
180720000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
180730000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
180740000627     C                   MOVEL     'S'           BLPFST
180750000627    2C                   ENDIF
180760000627     C*
180770000627   X1C                   ELSE
180780000627     C**
180790000627     C*  N O    D D T
180800000627     C**
180810000627     C                   SELECT
180820000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
180830000627    2C     §1BFG3        WHENEQ    'S'
180840000627     C                   MOVEL     'K'           BLPFST
180850000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
180860000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
180870000627    2C     §3ATB1        WHENEQ    'A3'
180880000627     C     WSTA          OREQ      ' '
180890000627     C     WSTA          OREQ      'S'
180900000627     C* SE BOLLA F3 FACCIO FINA CHE SIA STAMPATO MA IN REALTA' NON
180910000627     C*  LA STAMPO NEMMENO IN DIFFERITA PERCHE' NON SERVE
180920000627    2C     §3ATB1        OREQ      'F3'
180930000627     C                   MOVEL     'Y'           BLPFST
180940000627     C*
180950000627     C* SE E' BOLLA DPD IMPOSTO FLAG DI GIA' STAMPATO
180960140612     C***  A_§OGNTW      WHENEQ    'DPD'
180970000627     C* EXPORT NON DPD, GIA' STAMPATO
180980140612     c***  A_§ogntw      oreq      'EEX'
180990140612     c***  A_§ogntw      oreq      'EUP'
181000140612     c***  A_§ogntw      oreq      'FED'
181010000627     C* POSTE , GIA' STAMPATO
181020140612     c***  §ogntw        oreq      'PPT'
181030140612     c***  blpdsp        andlt     §vpoptl
181040140612     c                   when      A_§OGNTW='DPD'
181050160304     c****                         or (A_§ogntw='EEX'
181060160304     c****                         and (%lookup('999':sk_VPODIR)=0 and
181070160304     c****                             %lookup(%editc(blplnp:'X'):sk_VPODIR)=0))
181080000627     C                   MOVEL     'Y'           BLPFST
181090000627   X2C                   OTHER
181100000627     C*
181110000627     C* SE SONO IN VARIAZIONE BOLLA E NON HO MODIFICATO IL FLAG DDT
181120000627     C*  LASCIO QUELLO CHE C'ERA
181130000627     C                   MOVEL     'N'           BLPFST
181140000627    3C     *IN12         IFEQ      *ON
181150000627     C     *IN15         ANDEQ     *OFF
181160000627     C*
181170000627    4C     SAVBAM        IFEQ      'Y'
181180000627     C                   MOVEL     'Y'           BLPFST
181190000627    4C                   ENDIF
181200000627     C* SE ERA DPD E NON LO E' PIU', DEVO METTERE "N" PER FAR
181210000627     C*  STAMPARE LA BOLLA
181220020319    4C     SAVNTW        IFEQ      'DPD'
181230020319     C     A_§OGNTW      ANDNE     'DPD'
181240000627     C                   MOVEL     'N'           BLPFST
181250000627    4C                   ENDIF
181260000627     C* IN MANUTENZIONE DI UN PREPAGATO, IMPOSTO SEMPRE PER DDT NO,
181270000627     C*  DA STAMPARE
181280000627    4C     *IN22         IFEQ      *ON
181290000627     C                   MOVEL     'N'           BLPFST
181300000627    4C                   ENDIF
181310000627    3C                   ENDIF
181320000627     C**
181330000627    2C                   ENDSL
181340000627    1C                   ENDIF
181350000627     C                   ENDSR
181360900504     C*
181370900504     C*--- REGISTRAZIONE BOLLA ---------------------------------------*
181380090623     c     REGIS         begsr
181390940928     C* DPO LA PRIMA BOLLA MI POSIZIONO SEMPRE SUL MITTENTE
181400010222     C* SE ATTIVATA PROCEDURA ORM E SONO IN IMMISSIONE O MANUTENZIONE
181410010306     C* E NON SONO NEL GIRO DEI PREPAGATI MI POSIZIONO SEMPRE SUL N.ORM
181420010222     C     WORM          IFEQ      'S'
181430010222     C     PARTCH        ANDNE     'P'
181440010307     C     §LPFPR        ANDNE     'O'
181450010222     C     *IN12         ANDEQ     *OFF
181460010222     C     WORM          OREQ      'S'
181470010222     C     PARTCH        ANDNE     'P'
181480010307     C     §LPFPR        ANDNE     'O'
181490010222     C     *IN15         ANDEQ     *OFF
181500010222     C                   SETON                                        06
181510010222     C                   ELSE
181520940928     C                   SETON                                        07
181530010222     C                   ENDIF
181540010222     C*
181550950123     C                   CLEAR                   WRD2
181560900507     C* AZZERO CAMPI COMODO
181570940214     C                   CLEAR                   SAVFST
181580991014     C                   CLEAR                   DSLV04
181590991027     C                   CLEAR                   WSV1
181600991027     C                   CLEAR                   WVA1
181610991027     C                   CLEAR                   WSV2
181620991027     C                   CLEAR                   WVA2
181630991027     C                   CLEAR                   WSV3
181640991027     C                   CLEAR                   WVA3
181650001019     C                   CLEAR                   WSTSGN
181660070604     c                   clear                   wmsg_pda          1
181670070606     c                   clear                   w02pdr_p
181680111026     c                   clear                   RA_ncd
181690111026     c                   clear                   RA_nca
181700111026     c                   clear                   RA_ncl
181710111026     c                   clear                   RA_lna
181720941108     C*
181730930331     C*  VALORE POSITIVO DEI CAMPI NUMERI A VIDEO
181740920505     C                   MLLZO     1             VIDPOR
181750940926     C                   MLLZO     1             VIDNFT
181760940926     C                   MLLZO     1             VIDFIV
181770940926     C                   MLLZO     1             VIDRMN
181780940926     C                   MLLZO     1             VIDCAS
181790940825     C                   MLLZO     1             VIDIAS
181800940926     C                   MLLZO     1             VIDQFT
181810920505     C                   MLLZO     1             VIDNCD
181820920505     C                   MLLZO     1             VIDNCA
181830920505     C                   MLLZO     1             VIDHCR
181840940926     C                   MLLZO     1             VI2VA1
181850040116     c                   Mllzo     1             Vi2Va2
181860040116     c                   Mllzo     1             Vi2Va3
181870040116     c                   Mllzo     1             Vi2Va4
181880041217     c                   Mllzo     1             Vi2Va5
181890041217     c                   Mllzo     1             Vi2Va6
181900021218     c                   Mllzo     1             VidNba
181910021218     c                   Mllzo     1             VidNb2
181920060209     c* Le seguenti specifiche le ho spostate più sotto per permettere
181930060209     c* la storicizzazione delle variazioni dei prepagati, non potendo
181940060209     c* storicizzare ora dal momento che ci possono essere dei casi
181950060209     c* di uscita dalla routine senza registrare la bolla (v. goto
181960060209     c* endreg)
181970991006      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
181980991006      * IN FIAR700F
181990060209     C**   WAR7          IFEQ      'E'
182000060209     c**   war61         oreq      'E'
182010060209     c**   wkscsf1       andne     0000
182020060209     c**   wkscsf1       andne     9999
182030060209     C**                 MOVEL     '1'           WTRC
182040060209     C**   KBLP4         SETLL     FIAR7000
182050060209     C**   KBLP4         READE     FIAR7000                               30
182060991006      *
182070060209    2C**   *IN30         DOWEQ     *OFF
182080060209     C**                 DELETE    FIAR7000
182090060209     C**   KBLP4         READE     FIAR7000                               30
182100060209    2C**                 ENDDO
182110991006      *
182120060209     C**                 ENDIF
182130040116      * anche per la seconda bolla
182140060209if  1c****               If        War71 = 'E' or (war62 = 'E' and
182150060209     c****                         wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
182160060209     c****               Eval      Wtrc = '2'
182170060209     c**** Kblp4         Setll     Fiar7000
182180060209do  2c****               Do        *Hival
182190060209     c**** Kblp4         Reade     Fiar7000
182200060209     c****               If        %Eof(Fiar701l)
182210060209     c****               Leave
182220060209     c****               EndIf
182230060209     c****               Delete    Fiar7000
182240060209    2c****               EndDo
182250060209    1c****               EndIf
182260941115     C* PULISCO I FORMATI
182270060209     C***                CLEAR                   FIAR6000
182280060209     C***                CLEAR                   FIAR7000
182290051115     C                   CLEAR                   Fiar9000
182300900507     C*
182310900504     C                   Z-ADD     VIDLNP        BLPLNP
182320900504     C                   MOVEL     BLPDSP        BLPAAS
182330900504     C                   MOVE      VIDNRS        BLPNRS
182340940926     C                   MOVE      BLPDSP        BLPMGS
182350940926     C                   MOVEL     VIDCBO        BLPCBO
182369920410     C*
182370920410     C* DISK CLI: SE NON SI ASSEGNA NUMERAZ. SEGNAC. AZZERO SERIE
182380930628     C   12
182390930628    1CAN 15§1BFG2        IFEQ      'N'
182400980410     C     §1BFG6        ANDNE     'C'
182410910606     C                   Z-ADD     0             BLPNRS
182420950525     C* SE IL CTM ERA "%" --> IMPOSTO "§"
182430000214    2C     VIDSOP        IFEQ      '%'
182440950525     C                   MOVEL     '§'           VIDSOP
182450000214     C* SE E' DISK "C"    --> IMPOSTO ":"
182460050223     C     *IN79         IFEQ      *ON
182470050223    3C     WASDKC        ANDEQ     'S'
182480050223     C     §3CDKC        ANDEQ     'S'
182490000905     C     §1BF12        ORNE      'N'
182500001106     C     §1BF12        ANDNE     'E'
182510001106     C     §1BF12        OREQ      'E'
182520001106     C     WASDKC        ANDEQ     'S'
182530000214     C                   MOVEL     ':'           VIDSOP
182540000214    3C                   ENDIF
182550000214    2C                   ENDIF
182560950525    1C                   ENDIF
182570001013     C* SE VENGO DA CONFERMA DA DISCHETTO E NON È DISK B METTO SOP=: SE
182580001013     C* E' DISK C
182590001013     C   12
182600001013     CAN 15§1BFG1        IFNE      'S'
182610001013     C     WASDKC        ANDEQ     'S'
182620001013     C     §1BF12        ANDNE     'N'
182630001013     C                   MOVEL     ':'           VIDSOP
182640001013     C                   ENDIF
182650930624     C***
182660930624     C***   N U M E R O   S P E D I Z I O N E
182670920415     C                   SETOFF                                       30
182680921012     C* IN IMMISSIONE : SE NON E' BOLLA DI RECUPERO
182690990602    1C  N12PARTCH        IFEQ      'R'
182700921006     C                   Z-ADD     RECNSP        BLPNSP
182710930628   X1C                   ELSE
182720921006     C                   SETON                                        30
182730930628    1C                   END
182740921012     C*
182750921005     C* IN DISK CLI :  SE NON SI STAMPA LA BOLLA
182760921012     C*                O NON E' BOLLA DI RECUPERO
182770921012     C*                O NON MANTIENE NUM SPEDIZIONE
182780930628     C   12
182790930628    1CAN 15§1BFG3        IFNE      'S'
182800921005     C*
182810930628    2C     §3CFSP        IFEQ      'S'
182820921012     C     §1BFG2        ANDEQ     'S'
182830921012     C     §LPFPR        OREQ      'R'
182840971104     C**
182850971104    3C     VIDNSP        IFGT      0
182860921005     C                   Z-ADD     VIDNSP        BLPNSP
182870971104   X3C                   ELSE
182880971104     C** SE MANCA LO RIASSEGNO
182890971104     C** SE L'HO AZZERATO IN CARICAMENTO LO RIPRENDO DA DS
182900971104    4C     §LPNSP        IFGT      0
182910971104     C                   Z-ADD     §LPNSP        BLPNSP
182920971104     C                   ELSE
182930971104     C                   SETON                                        30
182940971104    4C                   ENDIF
182950971104    3C                   ENDIF
182960971104     C***
182970971104    3C     VIDNRS        IFEQ      0
182980971104     C                   Z-ADD     §LPNRS        BLPNRS
182990971104    3C                   ENDIF
183000971104     C**
183010930628   X2C                   ELSE
183020920415     C                   SETON                                        30
183030930628    2C                   END
183040921005     C*
183050930628   X1C                   ELSE
183060921005     C*
183070920421     C                   Z-ADD     VIDNSP        BLPNSP
183080930628    1C                   END
183090920415     C*
183100930628    1C     *IN30         IFEQ      *ON
183110951228     C                   MOVE      VIDDSP        AAS
183120910117     C                   Z-ADD     3             CNU
183130910117     C                   Z-ADD     VIDLNP        COMLIN
183140000509     C                   CLEAR                   WNUF2
183150000509     C* SE LNP POSTE METTO ANCHE LA SERIE ON CHIAVE
183160020319     C     §ogntw        IFEQ      'PPT'
183170000509     C                   Z-ADD     VIDNRS        WNUF2
183180000509     C                   ENDIF
183190921006     C* CHAIN FINO A QUANDO NON TROVO UN NUMERO LIBERO
183200930628    2C     *IN30         DOWEQ     '1'
183210000509     C     KNUFSP        CHAIN     FLNUF                              3031
183220951228     C* SE NON TROVATO IL NUMERATORE PROVO A CREARLO
183230000627     C*  NON LO FACCIO PER POSTE
183240020319     C     §ogntw        IFNE      'PPT'
183250000627     C     *IN30         ANDEQ     *ON
183260951228     C                   Z-ADD     CNU           PA4CNU
183270951228     C                   CALL      'FNLVCNR'
183280951228     C                   PARM                    PA4CNU
183290000509     C     KNUFSP        CHAIN     FLNUF                              3031
183300951228     C                   ENDIF
183310951228     C*
183320951228     C* SE ANCORA NON TROVATO ERRORE
183330940923     C   30              SETON                                        90
183340940923     C   30              MOVEL     ERR(39)       VIDMSG
183350020320     C* RECORD ALLOCATO
183360940923     C   31              SETON                                        90
183370940923     C   31              MOVEL     ERR(42)       VIDMSG
183380951228     C* PER ERRORE ESCO
183390950508     C   90              MOVEL     '1'           WEMFOR
183400921006     C   90              GOTO      ENDREG
183410921006     C*
183420900824     C                   ADD       1             NUFNUM
183430900824     C                   UPDATE    FLNUF
183440921006     C                   Z-ADD     NUFNUM        RECNSP
183450921006     C*
183460921006     C* 30 ON - SPED ESISTENTE FACCIO NUOVA CHAIN
183470940915     C     KNSP          SETLL     FNBLP01L                               30
183480040329      * devo controllare anche su titas che non ci sia già
183490040329      * una spedizione con lo stesso numero
183500040329     c                   If        Not *In30 and %Open(Titas30c)
183510040329     c     kNsp          Chain(n)  Titas30c
183520040329     c                   If        %Found(Titas30c)
183530040329     c                   Eval      *In30 = *On
183540040329     c                   EndIf
183550040329     c                   EndIf
183560040329
183570921006     C  N30              MOVEL     NUFNUM        BLPNSP
183580930628    2C                   ENDDO
183590040727   x1c                   Else
183600040727      * se bolla già presente su TITAS emetto errore bloccante
183610040727     c                   If        %Open(Titas30c)
183620040727     c                   Eval      recnsp = BlpNsp
183630040727     c     kNsp          Chain(n)  Titas30c
183640040727     c                   If        %Found(Titas30c)
183650040727     c                   Eval      VidMsg = Err(55)
183660040727     c                   Eval      *In90 = *On
183670040727     c                   Eval      wemfor = '1'
183680040727     c                   Goto      EndReg
183690040727     c                   EndIf
183700040727     c                   EndIf
183710930628    1C                   ENDIF
183720920410     C*
183730900827     C   12
183740900827     CANN15              MOVEL     VIDNSP        BLPNSP
183750940926     C*
183760940926     C* MEMORIZZO I CAMPI IMPOSTATI A VIDEO: SE BOLLA CON MAMMA
183770940926     C*  NON LI MEMORIZZO MA STAMPO SOLTANTO
183780051115     C                   MOVEL     VIDCAS        ar9CAS
183790011108     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO CONTRASSEGNO > 0
183800011108     C     VIDCAS        IFGT      *ZEROS
183810051115     C                   MOVEL     VIDVCA        ar9VCA
183820011113     C                   ELSE
183830051115     C                   CLEAR                   ar9VCA
183840011108     C                   ENDIF
183850050518     c* Se = *blanks, e forzabile da tabella TM --> forzo
183860051115     C                   MOVEL     VIDTIC        ar9TIC
183870091001     c                   clear                   w_ar5tic
183880111213     c                   if        vidcas>0
183890121022     c* per spedizioni export non valgono le seguenti forzature ma
183900121022     c* pilotano i tipi incasso abilitati come da tabella "1AX"
183910121022     c                             and a_§ogntw<>'DPD'
183920121022     c                             and a_§ogntw<>'EEX'
183930121022     c                             and a_§ogntw<>'FED'
183940071011     c                   select
183950071011     c                   when      vidtic=*blanks and §TMFTI<>*BLANKS
183960051115     C                   MOVEL     §TMfti        ar9tic
183970080625     C                   MOVEL     §TMfti        vidtic
183980090706     c* frozatura per destinatario particolare
183990111213     c                   when      vidtic=*blanks and
184000091002     c                             ot0err=*blanks and OT0X1TICF<>*blanks
184010090706     C                   MOVEL     OT0X1TICF     ar9tic
184020090706     C                   MOVEL     OT0X1TICF     vidtic
184030091001     c                   movel     ot0x1ticf     w_ar5tic
184040111213     c                   when      vidtic=*blanks
184050071008     c* Se = *blanks, e forzabile da tabella FSC --> forzo
184060090619     c* Se cliente abilitato da tabella CIC non devo forzare
184070090619     C                   CLEAR                   dsbs02
184080090619     C                   MOVEL     'C'           T02MOD
184090090619     C                   MOVEL     KNSIF         T02SIF
184100090619     C                   MOVEL     'CIC'         T02COD
184110090619     c                   if        vidflc=0
184120090622     c                   eval      t02ke1=%editc(vidlnp:'X')+%editc(vidccm:'X')
184130090619     c                   else
184140090619     c                   eval      t02ke1=%editc(vidflc:'X')+%editc(vidccm:'X')
184150090619     c                   endif
184160090619     C                   CALL      'TIBS02R'
184170090619     C                   PARM                    KPJBA
184180090619     C                   PARM                    dsbs02
184190090619      * Cliente non presente in tabella "CIC"
184200090619     c                   if        t02err<>*blanks
184210071008     C                   CLEAR                   dsbs02
184220071008     C                   MOVEL     'C'           T02MOD
184230071008     C                   MOVEL     KNSIF         T02SIF
184240071008     C                   MOVEL     'FSC'         T02COD
184250071008     c                   movel(P)  comlna        t02ke1
184260161229     c***                clear                   dfsc
184270071008     C                   CALL      'TIBS02R'
184280071008     C                   PARM                    KPJBA
184290071008     C                   PARM                    dsbs02
184300161229     c****               eval      dfsc=t02uni
184310071008    2C                   IF        T02ERR = *BLANKS and t02atb=*blanks
184320161229     c****               exsr      sr_impoDalAl
184330161229     c****               if        (wcadal=*zeros and wcaal=*zeros) or
184340161229     c****                         (ar9vca=§gedcn and vidcas >=wcadal and
184350161229     c*****                         vidcas<=wcaal)
184360071008     C                   movel     'SC'          ar9tic
184370080625     C                   movel     'SC'          vidtic
184380161229     c***                endif
184390071008    2C                   ENDIF
184400090619     c                   endif
184410071011     c                   endsl
184420111213     c                   endif
184430050518     c
184440941005     C***
184450941005     C***   N U M E R O   S E G N A C O L L I
184460941005     C                   MOVEL     WFLS          BLPFLS
184470971211     C                   MOVEL     COMLNA        VIDLNA
184480940926     C*
184490940926     C* MEMORIZZO SEGNACOLLI SE BOLLA SENZA MAMMA
184500940926    1C     §3ABCM        IFEQ      ' '
184510000627     C* ASSEGNO NUMERO DI SEGNACOLLI
184520000627     C                   EXSR      ASSSGN
184530000627     C     WEMFOR        IFEQ      '1'
184540000627     C                   GOTO      ENDREG
184550000627     C                   ENDIF
184560940926     C*
184570940926   X1C                   ELSE
184580940926     C* BOLLA CON MAMMA
184590950215     C                   CLEAR                   BLPFLS
184600940926     C                   CLEAR                   BLPNCD
184610940926     C                   CLEAR                   BLPNCA
184620051115     C                   CLEAR                   ar9TIC
184630051115     C                   CLEAR                   ar9CAS
184640051115     C                   CLEAR                   ar9VCA
184650940926    1C                   ENDIF
184660020320     c* Se bolla Export FedEx prelevo numeri AWB
184670020320     c     A_§ogntw      ifeq      'FED'
184680020320     c                   clear                   wawbini
184690020320     c* devo assegnare numeri awb fedex in immissione o conferma bolle
184700020320     c* SEMPRE oppure in manutenzione se è aumentato il numero dei colli
184710020320     c* oppure se è cambiata la linea di arrivo e la precedente era una
184720020320     c* linea non fedex
184730020320     c     *in12         ifeq      *off
184740020320     c     *in15         oreq      *on
184750020320     c     *in15         oreq      *off
184760020320     C     vidncl        andgt     savncl
184770020320     c     *in15         oreq      *off
184780020320     C     savntw        andne     'FED'
184790020320     c                   clear                   trul33ds
184800020320     c                   z-add     21            i33cnu
184810020320     c                   z-add     vidncl        i33num
184820020320     c                   movel     trul33ds      kpjbu
184830020320     c                   call      'TRUL33R'
184840020320     c                   PARM                    kpjba
184850020320     c                   movel     kpjbu         trul33ds
184860020320     c* se errore vado a fine routine
184870020320     c     o33err        ifgt      *zeros
184880020320     c                   seton                                        90
184890020320     c                   movel     '1'           wemfor
184900020320     c                   select
184910020320     c     o33err        wheneq    1
184920020320     c                   movel     err(250)      vidmsg
184930020320     c     o33err        wheneq    2
184940020320     c                   movel     err(251)      vidmsg
184950020320     c     o33err        wheneq    3
184960020320     c                   movel     err(252)      vidmsg
184970020320     c                   endsl
184980020320     c                   goto      endreg
184990020320     c                   endif
185000020320     c                   z-add     o33nri        wawbini
185010020320     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
185020051102     c* del ARS trk "F"
185030020320     c                   z-add     wawbini       wawb
185040020320     c                   endif
185050020320     c                   endif
185060010228     C* SE SONO IN IMMISSIONE DEI MIEI PREPAGATI RICHIAMO PGM DI IMM.
185070010227     C* ORM
185080010227     C     PARTCH        IFEQ      'P'
185090010227     C     VIDMAG        ANDNE     'S'
185100010307     C     WORM          ANDEQ     'S'
185110010713     C     §3ARBL        ANDNE     'R'
185120010227     C                   EXSR      RIEO05
185130010228     C                   CLEAR                   KPJBU
185140010227     C                   CALL      'FIOR05R'
185150010227     C                   PARM                    KPJBA
185160010228     C                   PARM                    DSOR05
185170010227     C* SE PREMUTO F3 VADO A FINE ROUTINE E RIEMETTO LA VIDEATA
185180010227     C     §RMERR        IFEQ      '3'
185190010227     C                   MOVEL     '1'           WEMFOR
185200010227     C                   GOTO      ENDREG
185210010227     C                   ENDIF
185220010227     C                   ENDIF
185230001024     C*
185240060215     C* SE ANNO SPEDIZIONE E ANNO DI VAD SONO <> SISTEMO Fiar4 E
185250970107     C*  EDRDE01L
185260060215     c* 15/02/2006: Non si deve più aggiornare ar4 perchè è stato
185270060215     c* sostituito dal vat. Bisogna però continuare ad aggiornare EDRDE
185280060215     c* per bolle import
185290060215     C*****              CLEAR                   WESRDE
185300970107     C   12
185310970107    1CAN 15§1BFG3        IFEQ      'S'
185320970107     C*
185330970107     C     §3CFSP        OREQ      'S'
185340970107     C     §1BFG2        ANDEQ     'S'
185350970107     C*
185360060216     C* SE NON C'E' IL VAD RICONTROLLO KAAS CON Fiar4
185370060216     c* non serve più: ora l'informazione viene passata col vat
185380970107     C*
185390970407    2C     §LPAAC        IFNE      §LPAAS
185400060215     C**   KBLC4         CHAIN     Fiar401L                           31
185410060215    3C**   *IN31         DOWEQ     *OFF
185420060215     C**                 Z-ADD     §LPAAS        ar4AAS
185430060215     C**                 UPDATE    Fiar4000
185440060215     C**                 MOVEL     'S'           WESRDE            1
185450060215     C***  KBLC4         READE     Fiar401L                               31
185460060215    3C**                 ENDDO
185470970107     C*
185480060215    3C**** WESRDE        IFEQ      'S'
185490060215    3c                   if        §ogntw = 'EEX' or §ogntw = 'FED' or
185500081008     c                             §ogntw = 'DPD'
185510970107     C**
185520970107    4C     WOPRDE        IFEQ      ' '
185530970107     C                   OPEN      EDRDE01L
185540970107     C                   MOVEL     'S'           WOPRDE            1
185550970107    4C                   ENDIF
185560970107     C**
185570970107     C     KBLC4         CHAIN     EDRDE01L                           31
185580970107    4C     *IN31         DOWEQ     *OFF
185590970107     C                   Z-ADD     §LPAAS        RDEAAS
185600970107     C                   UPDATE    EDRDE000
185610970107     C     KBLC4         READE     EDRDE01L                               31
185620970107    4C                   ENDDO
185630970107    3C                   ENDIF
185640970107    2C                   ENDIF
185650970107     C*
185660970107    1C                   ENDIF
185670060209     c*
185680060209     c* STORICIZZAZIONI PER PREPAGATI
185690060209     c* Se cvb <> *blanks significa che è stata richiesta una variazione
185700060209     c* da gestire
185710060209     c                   if        ilv85cvb <> *blanks
185720060209     c* -- Storicizzazione variazione --
185730060209     c                   if        §7lfsa = 'S'
185740060209     c* se variazione da storicizzare e si tratta di variazione di
185750060209     c* tassazione memorizzo fiar6 e fiar7 prima di cancellare
185760060209     c* La write verrà eseguita prima della write di fnblp
185770060209     c                   if        ilv85cvb = 'TR'
185780060209     c                   clear                   fiarbt00
185790060209     c                   movel     knmus         arbpru
185800060209     c                   z-add     dateu         arbdtv
185810060209     c                   time                    arborv
185820060209     c                   movel     ilv85cvb      arbcvb
185830060209     c                   movel     '1'           arbtrc
185840060209     c                   exsr      stoarb
185850060209     c                   endif
185860060209     c                   endif
185870060209     c* -- Storicizzazione motivo variazione --
185880060209     c                   if        §7lmtv = 'S'
185890070604     c*                  movel     'L'           ilv85tla
185900070604     c                   movel     ' '           ilv85tla
185910060209     c                   movel     'R'           ilv85tel
185920060209     c                   z-add     arbdtv        ilv85dac
185930060209     c                   z-add     arborv        ilv85orc
185940060209     c                   z-add     blpaas        ilv85aas
185950060209     c                   z-add     blplnp        ilv85lnp
185960060209     c                   z-add     blpnrs        ilv85nrs
185970060209     c                   z-add     blpnsp        ilv85nsp
185980060307     c                   movel     olv85mtv      ilv85mtv
185990060307     c                   movel     olv85nt1      ilv85nt1
186000060307     c                   movel     olv85nt2      ilv85nt2
186010060209     c                   movel     fnlv85ds      kpjbu
186020060209     c                   call      'FNLV85R'
186030060209     c                   parm                    kpjba
186040060210     c                   movel     kpjbu         fnlv85ds
186050060209     c                   endif
186060060209     c                   endif
186070060209      *
186080060209      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
186090060209      * IN FIAR700F
186100060209     C     WAR7          IFEQ      'E'
186110060209     c     war61         oreq      'E'
186120060209     c     wkscsf1       andne     0000
186130060209     c     wkscsf1       andne     9999
186140060209     C                   MOVEL     '1'           WTRC
186150060209     C     KBLP4         SETLL     FIAR7000
186160060209     C     KBLP4         READE     FIAR7000                               30
186170060209      *
186180060209    2C     *IN30         DOWEQ     *OFF
186190060209     C                   DELETE    FIAR7000
186200060209     C     KBLP4         READE     FIAR7000                               30
186210060209    2C                   ENDDO
186220060209      *
186230060209     C                   ENDIF
186240060209      * anche per la seconda bolla
186250060209if  1c                   If        War71 = 'E' or (war62 = 'E' and
186260060209     c                             wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
186270060209     c                   Eval      Wtrc = '2'
186280060209     c     Kblp4         Setll     Fiar7000
186290060209do  2c                   Do        *Hival
186300060209     c     Kblp4         Reade     Fiar7000
186310060209     c                   If        %Eof(Fiar701l)
186320060209     c                   Leave
186330060209     c                   EndIf
186340060209     c                   Delete    Fiar7000
186350060209    2c                   EndDo
186360060209    1c                   EndIf
186370060209     C* PULISCO I FORMATI
186380060209     C                   CLEAR                   FIAR6000
186390060209     C                   CLEAR                   FIAR7000
186400940926     C***
186410941108     C*
186420940926     C***  T O T A L E   F A T T U R A
186430940926    1C     VIDNFT        IFGT      0
186440990630     C     *IN34         OREQ      *ON
186450941108     C*
186460120109     c* Qui non viene impostato comdft prima di richiamare totfat
186470120109     c* In caso di immissione di un prepagato il comdft in questo
186480120109     c* momento è = 0 (viene azzerato all'uscita dal FNLV16R) e
186490120109     c* viene quindi passata data fattura=0 al pgm fnlv04r.
186500120109     c* Nei periodi a cavallo di cambio aliquota IVA non è comunque
186510120109     c* un problema visto che il pgm FNLV04R se riceve data fattura=0,
186520120109     c* sceglie l'aliquota iva per il calcolo in base alla data del giorno
186530990630     C                   EXSR      TOTFAT
186540941108     C*
186550941108     C* SE E' UN ASSEGNATO MEMORIZZO TUTTI I CAMPI DELLA TASSAZIONE
186560990629     C*  OPPURE SE E' UN PREPAGATO
186570941108     C     *IN04         IFEQ      *ON
186580990629     C     *IN34         OREQ      *ON
186590941108     C                   ADD       D04BOL        DB0ESE
186600941108     C                   Z-ADD     D04IFT        DB0IFT
186610990701     C                   Z-ADD     D04IVA        DB0IVA
186620990701     C                   Z-ADD     D04IMV        VIDIMV
186630991130     C                   Z-ADD     VIDIMV        DB0IMV
186640990630     C                   Z-ADD     D04POR        VIDPOR
186650991014     C                   Z-ADD     D04POR        MEMPOR
186660941108    2C                   ENDIF
186670990630     C**
186680990630     C* REPERISCO: PO IVA, NUMERO E DATA FATTURA
186690990630    2C     *IN34         IFEQ      *ON
186700990630     C     KNUM          CHAIN     CNNUM000                           30
186710990630    3C     *IN30         IFEQ      *OFF
186720990630     C                   ADD       1             NUMNUM
186730990630     C                   Z-ADD     NUMNUM        VIDNFT
186740990630     C                   MOVE      DATEU         NUMDTP
186750990630     C                   UPDATE    CNNUM000
186760990630   X3C                   ELSE
186770990630     C                   Z-ADD     0             VIDNFT
186780990630    3C                   ENDIF
186790990630     C                   Z-ADD     FIV           VIDFIV
186800990630     C                   Z-ADD     DATEU         COMDFT
186810990630    2C                   ENDIF
186820941108    1C                   ENDIF
186830940926     C*
186840940926     C* SE ESISTE ALMENO UNA VARIA LEGGO IL SFL E GIA' CHE CI SONO
186850940926     C*  IMPOSTO GIA' I CAMPI DELLA TASSAZIONE
186860940926     C                   Z-ADD     1             NRR
186870941108     C                   Z-ADD     1             C
186880991014    1C     WESVAR        IFNE      ' '
186890940926     C*
186900941108    2C                   DO        20            NRR
186910940926     C     NRR           CHAIN     LS01S03                            30
186920991014      *
186930941108    3C     *IN30         IFEQ      *OFF
186940941108     C     V3CSV1        ANDNE     ' '
186950991014      * ESENTE: SOMMO AL TOTALE FATTURA SE E' DA IMPOSTARE
186960940926    4C     V3CEV1        IFNE      ' '
186970940926     C     VIDNFT        ANDGT     0
186980941108     C                   ADD       V3CVA1        DB0ESE
186990991130     C                   SUB       V3CVA1        DB0IMV
187000940926    4C                   ENDIF
187010991014      * SCRIVO VARIE
187020991014     C                   EXSR      WRTVAR
187030940926    3C                   ENDIF
187040940926    2C                   ENDDO
187050991014      *
187060940926    1C                   ENDIF
187070991014      *
187080991014      * SE IMPOSTATA L'IVA SCRIVO VARIA
187090991014     C     D04IVA        IFGT      *ZEROS
187100991014     C                   MOVEL     §$2IVA        V3CSV1
187110991014     C                   Z-ADD     D04IVA        V3CVA1
187120991014     C                   EXSR      WRTVAR
187130991014     C                   ENDIF
187140991014      * SE IMPOSTATO IL BOLLO SCRIVO VARIA, IN DB0ESE è GIA' STATA SOMMATA
187150991014     C     D04BOL        IFGT      *ZEROS
187160991014     C                   MOVEL     §$2BOL        V3CSV1
187170991014     C                   Z-ADD     D04BOL        V3CVA1
187180991014     C                   EXSR      WRTVAR
187190991014     C                   ENDIF
187200991027      *
187210991027      * SE PIENA UNA VARIA O ANTICIPATA O NUMERO FATTURA O PORTO
187220991027      *  O INOLTRO O DIRITTO FISSO O ESENZ.IVA  --> SCRIVO FIAR600F
187230991006      *
187240991006      * Se agganciata precedentemente riaggancio file tassazione per 1a bolla
187250991006     C     WAR61         IFEQ      'E'
187260991006     C                   MOVEL     '1'           WTRC
187270050331     c* se presente cod.Segue fattura significa che era stata tassata
187280050331     c* in arrivo --> DELETO la tassazione dell'arrivo
187290050331     c                   if        wKSCsf1 <> 0000 and wKSCsf1 <> 9999
187300050331     c     kblp4         delete    fiar6000
187310050331     c                   clear                   war61
187320050331     c                   else
187330991006     C     KBLP4         CHAIN     FIAR6000                           30
187340050331     c                   endif
187350991006     C                   ENDIF
187360991006      *
187370941108    1C     VIDDFT        IFGT      0
187380051116     C     wsv1          ORNE      ' '
187390051116     C     wsv2          ORNE      ' '
187400051116     C     wsv3          ORNE      ' '
187410051116     C     VIDCEI        ORNE      ' '
187420940926     C     VIDPOR        ORNE      0
187430991202     C*          VIDANT    ORNE 0
187440991006     C                   MOVEL     '1'           AR6TRC
187450991006     C                   Z-ADD     BLPAAS        AR6AAS
187460991006     C                   Z-ADD     BLPLNP        AR6LNP
187470991006     C                   Z-ADD     BLPNRS        AR6NRS
187480991006     C                   Z-ADD     BLPNSP        AR6NSP
187490991006     C                   Z-ADD     VIDPOR        AR6POR
187500991006     C                   Z-ADD     VIDIMV        AR6IMV
187510991006     C                   MOVEL     VIDCEI        AR6CEI
187520991027      *
187530991027     C                   MOVEL     WSV1          AR6SV1
187540991027     C                   Z-ADD     WVA1          AR6VA1
187550991027     C                   MOVEL     WSV2          AR6SV2
187560991027     C                   Z-ADD     WVA2          AR6VA2
187570991027     C                   MOVEL     WSV3          AR6SV3
187580991027     C                   Z-ADD     WVA3          AR6VA3
187590991027      *
187600120104      * L'aliquota iva la memorizzo solo se presente numero fattura
187610991006      * SE ESENZIONE NON MEMORIZZO L'ALIQUOTA
187620120104     c                   if        vidnft>0
187630941108    2C     VIDCEI        IFEQ      *BLANKS
187640120109     c                   if        comdft>§qtdsa
187650991006     C                   Z-ADD     §QTALI        AR6ALI
187660120104     c                   else
187670120104     C                   Z-ADD     §QTALO        AR6ALI
187680120104     c                   endif
187690941108   X2C                   ELSE
187700991006     C                   MOVEL     *ZEROS        AR6ALI
187710941108    2C                   ENDIF
187720120104     c                   endif
187730991006     C                   Z-ADD     D04IFT        AR6IFT
187740991006     C                   Z-ADD     VIDFIV        AR6FIV
187750991006     C                   Z-ADD     VIDNFT        AR6NFT
187760991006     C                   Z-ADD     COMDFT        AR6DFT
187770991015     C                   MOVEL     VIDDIV        AR6DIV
187780991015      * IMPOSTO FLAG DI TOTALE IMPONIBILE INSERITO IN PARTENZA
187790991015     C     AR6IMV        IFGT      *ZEROS
187800991015     C                   MOVEL     'P'           AR6FIM
187810991015     C                   ELSE
187820991015     C                   CLEAR                   AR6FIM
187830991015     C                   ENDIF
187840991015      * PER ASSEGNATI IMPOSTO CODICE DI FATTURAZIONE
187850991015     C                   CLEAR                   AR6CTR
187860991015     C     *IN04         IFEQ      *ON
187870991022     C                   MOVE      9999          AR6KSC
187880991022     C                   MOVEL     AR6LNP        AR6KSC
187890991015     C                   ELSE
187900991015     C                   CLEAR                   AR6KSC
187910991015     C                   ENDIF
187920991006      *
187930991015      *
187940991006     C     WAR61         IFEQ      'E'
187950991006     C                   UPDATE    FIAR6000
187960940926     C                   ELSE
187970991006     C                   WRITE     FIAR6000
187980940926     C                   ENDIF
187990941108     C*
188000941108     C* DATI PER STAMPA
188010990629     C* PER ASEGNATO O FRANCO PREPAGATO
188020941108     C     *IN04         IFEQ      *ON
188030990629     C     *IN34         OREQ      *ON
188040941108     C                   MOVEL     VIDCEI        DB0CEI
188050991014     C                   MOVEL     V3DCEI        DB0DCE
188060991014     C                   MOVEL     VIDDIV        DB0DIV
188070991014     C                   MOVEL     WFDC1         DB0FDC
188080941108     C                   Z-ADD     VIDIMV        DB0IMV
188090941108     C                   ENDIF
188100021209      * Per prepagato stampo sempre i dati della fattura
188110021209     c                   If        *In34
188120941108     C                   Z-ADD     VIDNFT        DB0NFT
188130941108     C                   Z-ADD     COMDFT        DB0DFT
188140941108     C                   ENDIF
188150940926     C*
188160940926   X1C                   ELSE
188170991006     C* SE NON DEVO SCRIVERE IL RECORD FIAR6 E C'ERA --> DELETO
188180991006    2C     WAR61         IFEQ      'E'
188190991006     C                   DELETE    FIAR6000
188200940926    2C                   ENDIF
188210940926    1C                   ENDIF
188220930624     C***
188230940919     C***  F L A G   I N O L T R O
188240940628     C                   EXSR      INOLTR
188250940628     C                   MOVEL     WFIN          BLPFIN
188260930624     C***
188270930624     C***  L I N E A   D I   A R R I V O
188280160829     c* In conferma bolle (no resi/dirottamenti) se bolla import dpd
188290160829     c* con numero parcel che inizia per 1251 viene forzata la linea
188300160829     c* di arrivo 172 a il fermo deposito='S'
188310160829     c***                if        *in12  and *in15 and §ogntw='DPD'
188320160829     c***                          and §vpofl1='S'
188330160829     c**                           and not *in44
188340160829     c**                           and %subst(v7cnpr:1:4)='1251'
188350160829     c***                z-add     172           comlna
188360160829     C* TERMINAL DI ARRIVO
188370160829     C***                CLEAR                   DSLV55
188380160829     C***                MOVEL     'A'           D55TPT
188390160829     C***                MOVEL     VIDLNP        D55LNP
188400160829     C***                MOVEL     comlna        D55LIN
188410160829     C***                MOVEL     BLPDSP        D55DRF
188420160829     C***                CALL      'FNLV55R'
188430160829     C***                PARM                    DSLV55
188440160829     C***  D55ERR        IFEQ      ' '
188450160829     C***                MOVEL     D55TFA        COMTFA
188460160829     C***                ENDIF
188470160829     C*
188480160829     c***                movel     'S'           vidffd
188490160829     c***                z-add     90            varznc
188500160829     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
188510160829
188520160829     C**                 MOVEL     ORGDE3        A_OG143
188530160829     C***                MOVEL     ORGDF0        A_OG150
188540160829     c***                endif
188550160829
188560940628     C                   MOVEL     COMLNA        BLPLNA
188570930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
188580941107     C* CAMPI PER LA STAMPA BOLLA
188590941107     C                   MOVEL     ORGFAG        DB0FAG
188600941107     C                   MOVEL     ORGDES        DB0DLA
188610941107     C                   MOVEL     ORGIND        DB0INL
188620941107     C                   MOVEL     ORGLOC        DB0LOL
188630941107     C                   MOVEL     ORGPRO        DB0PRL
188640941107     C                   MOVEL     ORGTEL        DB0TEL
188650160422     C                   MOVEL     ORGdd2        DB0FAX
188660100319     c* Mancava l'impostazione del CAP db0CAL ma lo lascio vuoto perchè
188670100319     c*  così capiamo che si tratta di LVD stampata in partenza che
188680100319     c*  non dovrebbe mai essere usata per la consegna
188690941107     C*
188700910426     C* DESCRIZIONE LINEA ARRIVO PER SEGNACOLLO
188710930628    1C     ORGDE5        IFNE      *BLANKS
188720000208     C                   MOVEL     ORGDE5        WDLA
188730910426     C                   ELSE
188740000208     C                   MOVEL     ORGDES        WDLA
188750930628    1C                   END
188760001024     C                   MOVE      COMTFA        BLPTFA
188770971202     C* BLPFEA: TERMINAL DI PARTENZA DELLA LINEA DI ARRIVO
188780971202     C                   CLEAR                   DSLV55
188790971202     C                   MOVEL     'P'           D55TPT
188800971202     C                   MOVEL     COMLNA        D55LIN
188810971202     C                   MOVEL     BLPDSP        D55DRF
188820971202     C                   CALL      'FNLV55R'
188830971202     C                   PARM                    DSLV55
188840971202     C     D55ERR        IFEQ      ' '
188850971202     C                   MOVEL     D55TFP        BLPFEA
188860971202     C                   ELSE
188870971202     C                   MOVEL     COMLNA        BLPFEA
188880971202     C                   ENDIF
188890910201     C*
188900971202     C* TERMINAL DI PARTENZA
188910960130     C                   MOVEL     COMTFP        BLPTFP
188920111128     C                   MOVEL     comtfp        BLPFLE
188930940919     C***
188940940919     C***  M I T T E N T E
188950940919     C* SE ASSEGNATO SCRIVO 9999 NEL CODICE SPEDIZIONE
188960940919     C*  E IL MITTENTE, SE CODIFICATO, IN BLPCCM
188970940919     C                   CLEAR                   BLPCCM
188980940919    1C     *IN04         IFEQ      *ON
188990940919     C                   Z-ADD     9999          BLPKSC
189000940919     C                   MOVEL     BLPLNP        BLPKSC
189010940919     C*
189020940919    2C     VIDCCM        IFNE      9999
189030940919     C                   Z-ADD     VIDCCM        BLPCCM
189040940919     C*
189050940927    3C     VIDFLC        IFEQ      0
189060940919     C                   MOVEL     VIDLNP        BLPCCM
189070940919     C                   ELSE
189080940919     C                   MOVEL     VIDFLC        BLPCCM
189090940927    3C                   ENDIF
189100940927    2C                   ENDIF
189110940919    1C                   ENDIF
189120940919     C*
189130940919     C* SE FRANCO CODICE SEMPRE IL BLPKSC
189140941103     C     *IN04         IFEQ      *OFF
189150940919     C                   Z-ADD     VIDCCM        BLPKSC
189160940919     C     VIDFLC        IFEQ      0
189170940919     C                   MOVEL     VIDLNP        BLPKSC
189180940919     C                   ELSE
189190940919     C                   MOVEL     VIDFLC        BLPKSC
189200940919     C                   ENDIF
189210940919     C                   ENDIF
189220940919     C*
189230900504     C                   MOVEL     VIDRSM        BLPRSM
189240900504     C                   MOVEL     VIDINM        BLPINM
189250900504     C                   MOVEL     VIDCAM        BLPCAM
189260900504     C                   MOVEL     VIDLOM        BLPLOM
189270900504     C                   MOVEL     VIDPRM        BLPPRM
189280930202     C                   MOVEL     *BLANKS       BLPCPI
189290940919     C                   MOVEL     VIDNZM        BLPNZM
189300050114     c* flag unificazione spedizioni impostato solo se provengo da
189310050114     c* conferma bolle da cliente
189320130301     c  n12              clear                   blpxco
189330050114     c                   if        *in12 and *in15
189340050114     c                   eval      blpxco = wxco
189350050114     c                   endif
189360941221     C* MERCE PORTATA A MAGAZZINO
189370990915     C     *IN34         IFEQ      *ON
189380990915     C     VIDPDR        ANDLE     *ZEROS
189390001024     C                   MOVEL     VIDMAG        BLPFDN
189400990915     C                   ELSE
189410941221     C                   MOVEL     APDFCM        BLPFDN
189420990915     C                   ENDIF
189430950626     C* P A R T I T A   I V A
189440950626     C*
189450950626     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
189460950626     C*     NELLA P.IVA
189470950626     C     VIDISM        IFEQ      '$$'
189480950626     C     VIDCPM        ANDEQ     *BLANKS
189490950626     C                   MOVEL     'PRIVATO'     VIDCPM
189500950626     C                   ENDIF
189510950626     C     VIDISD        IFEQ      '$$'
189520950626     C     VIDCPD        ANDEQ     *BLANKS
189530950626     C                   MOVEL     'PRIVATO'     VIDCPD
189540950626     C                   ENDIF
189550950626     C*
189560941103     C  N04VIDISM        IFEQ      *BLANKS
189570940927     C                   MOVEL     VIDCPM        BLPCPI
189580940927     C                   ELSE
189590940927     C                   MOVEL     VIDPIM        BLPCPI
189600940927     C                   ENDIF
189610940927     C   04VIDISD        IFEQ      *BLANKS
189620940927     C                   MOVEL     VIDCPD        BLPCPI
189630940927     C                   ELSE
189640940927     C                   MOVEL     VIDPID        BLPCPI
189650940927     C                   ENDIF
189660950303     C*
189670950303     C* SE BOLLA DIRETTA ALL'ESTERO SCRIVO LE P.IVA
189680950303    1C     WDESIE        IFEQ      'E'
189690100119     c* Se c'e' esenzione IVA seconda bolla, memorizzo la partita IVA
189700100119     c     vi2cei        orne      ' '
189710100119     c* In manutenzione la devo cancellare se non è estero e non c'e' esenz.IVA
189720971230     C     *IN12         OREQ      *ON
189730971230     C     *IN15         ANDEQ     *OFF
189740971230     C     WDESIE        ANDNE     'E'
189750100119     C     vi2cei        andeq     ' '
189760950303     c*
189770971222     C                   CLEAR                   D19NT1
189780950303     C     VIDISD        IFEQ      *BLANKS
189790950303     C                   MOVEL     VIDCPD        W016A
189800950303     C                   ELSE
189810950303     C                   MOVEL     VIDPID        W016A            16
189820950303     C                   ENDIF
189830950303     C*
189840950303     C                   MOVE      W016A         D19NT1
189850950303     C*
189860950303     C     VIDISM        IFEQ      *BLANKS
189870950303     C                   MOVEL     VIDCPM        W016A
189880950303     C                   ELSE
189890950303     C                   MOVEL     VIDPIM        W016A            16
189900950303     C                   ENDIF
189910950303     C*
189920971222     C                   MOVEL     W016A         D19NT1
189930100119     c
189940100119     c                   if        *in12 and not *in15
189950100119     c                             and WDESIE<>'E' and vi2cei=' '
189960100119     C**   12
189970100119     C**ANN15WDESIE        IFNE      'E'
189980971230     C                   CLEAR                   D19NT1
189990971230     C                   ENDIF
190000060216     C                   MOVEL     'T'           D19ftr
190010950303     C                   MOVEL     BLPAAS        D19AAS
190020950303     C                   MOVEL     BLPLNP        D19LNP
190030950303     C                   MOVEL     BLPNRS        D19NRS
190040950303     C                   MOVEL     BLPNSP        D19NSP
190050950303     C                   MOVEL     'P'           D19TRC
190060950303     C                   CLEAR                   D19NT2
190070950303     C                   CALL      'FNLV19R'
190080950303     C                   PARM                    DSLV19
190090950303     C                   ENDIF
190100061110     c* Codice Fiscale mittente se inserito per prepagati non codificati
190110061110     c                   if        (*in34 and vidcdf<>*blanks) or
190120061110     c                             (not *in34 and *in22)
190130061110     C                   CLEAR                   D19NT1
190140061110     c                   movel     vidcdf        d19nt1
190150061110     C                   MOVEL     'T'           D19ftr
190160061110     C                   MOVEL     BLPAAS        D19AAS
190170061110     C                   MOVEL     BLPLNP        D19LNP
190180061110     C                   MOVEL     BLPNRS        D19NRS
190190061110     C                   MOVEL     BLPNSP        D19NSP
190200061110     C                   MOVEL     'Q'           D19TRC
190210061110     C                   CLEAR                   D19NT2
190220061110     C                   CALL      'FNLV19R'
190230061110     C                   PARM                    DSLV19
190240061110     C                   ENDIF
190250940919     C***
190260940919     C***  D E S T I N A T A R I O
190270900504     C                   MOVEL     VIDRSD        BLPRSD
190280950123     C                   MOVE      VIDRSD        WRD2             35
190290941025     C*
190300940919     C* SE SCRITTA ANCHE 2 RAGIONE SOCIALE DESTINATARIO
190310940919     C*  SCRIVO IL FILE DI ESTENSIONE DESCRIZIONI SE SUPERA IL MINIMO
190320940919     C*  CARATTERI PREVISTI  (CAMPO §7KMNC)
190330941025     C*  IN MANUTENZIONE VADO SEMPRE, PER IL RESTO SOLO SE IMMESSA
190340941025     C     *IN12         IFEQ      *ON
190350941025     C     *IN15         ANDEQ     *OFF
190360950123    2C     WRD2          ORNE      *BLANKS
190370060216     C                   MOVEL     'T'           D19ftr
190380941025     C                   MOVEL     BLPAAS        D19AAS
190390941025     C                   MOVEL     BLPLNP        D19LNP
190400941025     C                   MOVEL     BLPNRS        D19NRS
190410941025     C                   MOVEL     BLPNSP        D19NSP
190420941025     C                   MOVEL     'D'           D19TRC
190430971219     C                   MOVEL(P)  WRD2          D19NT1
190440941025     C                   CLEAR                   D19NT2
190450941025     C                   CALL      'FNLV19R'
190460941025     C                   PARM                    DSLV19
190470941025     C                   ENDIF
190480900504     C                   MOVEL     VIDIND        BLPIND
190490900504     C                   MOVEL     VIDCAD        BLPCAD
190500060705     c* se spedizione export DPD diretta in Portogallo devo aggiungere al
190510060705     c* cap immesso tanti 0 a dx quanti ne servono per arrivare ad una
190520060705     c* lunghezza di cap di 7 byte
190530060705     c                   if        a_§ogntw='DPD' and vidnzd = 'P  '
190540060705     c     ' '           checkr(e) blpcad:7      NN                1 0
190550060705     c                   if        %found
190560060705     c                   eval      %subst(blpcad:nn+1:7-nn)=*all'0'
190570060705     c                   endif
190580060705     c                   endif
190590900504     C                   MOVEL     VIDLOD        BLPLOD
190600900504     C                   MOVEL     VIDPRD        BLPPRD
190610940919     C                   MOVEL     VIDNZD        BLPNZD
190620140612     c* se spedizione export e presente la provincia la tengo solo se
190630140612     c* è obbligatoria come da tabella nazione
190640140612     c                   if        blpnzd<>*blanks
190650140612     C                   MOVEL     '15'          COD
190660140612     C                   MOVEL(P)  BLPNZD        KEY
190670140612     C                   EXSR      CTABEL
190680140612     C   30              CLEAR                   DS15
190690140612     C  N30              MOVEL     TBLUNI        DS15
190700140612     c                   if        §15sto<>'S'
190710140612     c                   clear                   blpprd
190720140612     c                   endif
190730140612     c                   endif
190740940919     C*
190750900504     C                   MOVEL     VIDGC1        BLPGC1
190760900504     C                   MOVEL     VIDGC2        BLPGC2
190770900504     C                   MOVEL     VIDCTR        BLPCTR
190780900613     C                   MOVEL     SAVCTS        BLPCTS
190790911008     C                   MOVEL     VIDFBR        BLPFBR
190800000627     C*
190810000627     C* ALLEGA BAM
190820000627     C                   EXSR      AGGFST
190830950127     C*
190840960118     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
190850951009     C                   CLEAR                   BLPFTM
190860950127     C   04SAVFTM        IFEQ      'S'
190870950127     C     VIDFTM        OREQ      'S'
190880950127     C                   MOVEL     'S'           BLPFTM
190890950127     C                   ENDIF
190900950127     C*
190910941230     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
190920941230    2C     APDFCM        IFNE      ' '
190930941230     C                   MOVEL     'C'           BLPFAP
190940941230     C                   ELSE
190950941230     C                   MOVEL     COMFAP        BLPFAP
190960941230    2C                   END
190970940922     C* SE NON IMMESSO TIPO SERVIZIO
190980940922     C     VIDTSP        IFNE      *BLANKS
190990940919    1C                   MOVEL     VIDTSP        BLPTSP
191000940922     C                   ELSE
191010940922     C* LO PRENDO DA TARIFFA
191020940922     C                   MOVEL     COMTSP        BLPTSP
191030940922     C                   ENDIF
191040020725     C*
191050940919     C                   MOVEL     VIDIAS        BLPIAS
191060011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO ASSICURARE > 0
191070011113     C     VIDIAS        IFGT      *ZEROS
191080011113     C                   MOVEL     VIDVAS        BLPVAS
191090011113     C                   ELSE
191100011113     C                   CLEAR                   BLPVAS
191110011113     C                   ENDIF
191120940919     C                   MOVEL     VIDVMD        BLPVMD
191130011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE VALORE MERCE > 0
191140011113     C     VIDVMD        IFGT      *ZEROS
191150011113     C                   MOVEL     VIDVAD        BLPVAD
191160011113     C                   ELSE
191170011113     C                   CLEAR                   BLPVAD
191180011113     C                   ENDIF
191190940919     C                   MOVEL     VIDQFT        BLPQFT
191200900504     C                   MOVEL     VIDNAS        BLPNAS
191210941115     C                   MOVEL     V1CNCL        BLPNCL
191220150304     C                   MOVEL     V2CPKG_i      BLPPKB
191230150304     C                   MOVEL     V2CPKG_i      BLPPKF
191240940919     C                   MOVEL     VIDFVR        BLPFVB
191250150304     C                   MOVEL     VARVOL_i      BLPVLB
191260940919     C                   MOVEL     VIDFVR        BLPFVF
191270150304     C                   MOVEL     VARVOL_i      BLPVLF
191280150304     c* Le istruzioni seguenti sono già state eseguite prima del calcolo
191290150304     c* dell'instradamento:
191300030204      * Immissione bolla
191310150304     c****               If        (*In12 and *In15) or Not *In12
191320030204      * Se sono stati impostati i bancali devo sommare al peso e al volume
191330030204      * il peso e il volume dei bancali
191340030922      * no x particolarità varia 'O'
191350150304     c***                If        %subst(VidGva:1:1) <> 'O'
191360150304     c***                If        VidNba > *Zeros and §cliban=*blanks
191370150304     c***                Clear                   w0071
191380150304     c**                 Clear                   w0053
191390150304     c***  wTbaPkg1      Mult      VidNba        w0071
191400150304     c***                Add       w0071         BlpPkb
191410150304     c***                Add       w0071         BlpPkf
191420150304     c***  wTbaVol1      Mult      VidNba        w0053
191430150304     c***                Add       w0053         BlpVlb
191440150304     c****               Add       w0053         BlpVlf
191450150304     c****               EndIf
191460150304     c****               If        VidNb2 > *Zeros
191470150304     c****               Clear                   w0071
191480150304     c****               Clear                   w0053
191490150304     c**** wTbaPkg2      Mult      VidNb2        w0071
191500150304     c***                Add       w0071         BlpPkb
191510150304     c***                Add       w0071         BlpPkf
191520150304     c**** wTbaVol2      Mult      VidNb2        w0053
191530150304     c***                Add       w0053         BlpVlb
191540150304     c***                Add       w0053         BlpVlf
191550150304     c***                EndIf
191560150304     c****               EndIf
191570150304     c****               EndIf
191580010214     C     VIDFFD        IFEQ      'N'
191590010214     C                   MOVEL     *BLANKS       BLPFFD
191600010214     C                   ELSE
191610940919     C                   MOVEL     VIDFFD        BLPFFD
191620010214     C                   ENDIF
191630940919     C                   MOVEL     COMDRT        BLPDRT
191640000308     C                   CLEAR                   BLPPDR
191650990630     C  N34              MOVEL     VIDLNP        BLPPDR
191660990630     C  N34              MOVE      VIDPDR        BLPPDR
191670940919     C                   MOVEL     VIDFPP        BLPFPP
191680940928     C                   MOVEL     VIDNRT        BLPNRT
191690940919     C                   MOVEL     VIDTCR        BLPTCR
191700940919     C                   MOVEL     COMDCR        BLPDCR
191710940919     C                   MOVEL     VIDHCR        BLPHCR
191720940919     C                   MOVE      VIDMCR        BLPHCR
191730030326      * Data consegna richiesta - Forzata su richiesta del cliente
191740030326      * in immissione bolla
191750030410      * e se non già impostata la data consegna richiesta
191760100219     c                   If        ((*In12 and *In15) or Not *In12)
191770100219     c                               and BlpDcr = *Zeros
191780030326     c                   ExSr      SrDcr
191790100217     c                   EndIf
191800100217     c
191810000214     C* SE E' UN DISK "C" MA NUMERAZIONE AUTOMATICA DPD,
191820000214     C* TRATTO COME DISK "A"
191830940919     C                   MOVEL     VIDSOP        BLPSOP
191840940919     C                   MOVEL     VIDRMN        BLPRMN
191850940919     C                   MOVEL     VIDRMA        BLPRMA
191860940919     C                   MOVEL     VIDRMO        BLPRMO
191870941005     C*
191880941005     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
191890941005     C     VIDCMO        IFNE      *BLANKS
191900941005     C                   MOVEL     VIDCMO        BLPCAM
191910941005     C                   MOVEL     VIDNMO        BLPNZM
191920941005     C                   ENDIF
191930941005     C*
191940160331     c* Forzatura zona di consegna per "VEDI PACCO DPD"  se prevista
191950160331     c                   if        w_vediP='1' and §NSDZNC<>*blanks
191960160331     c                   movel     §NSDZNC       VARZNC
191970160331     c                   endif
191980160421     c* In manutenzione verifico se si può aggiornare anche la zona di consegna
191990160421     c                   if        *in12 and not *in15
192000160421     c                   clear                   w_VariaZnc
192010160421     c                   exsr      sr_VariaZnc
192020160421     c                   endif
192030160421     c                   if        not *in12 or
192040160421     c                             (*in12 and *in15) or
192050160421     c                             (*in12 and not *in15 and w_VariaZnc=' ')
192060940919     C                   MOVEL     VARZNC        BLPZNC
192070160422     c                   else
192080160422     c                   movel     blpznc        varznc
192090160421     c                   endif
192100950303     C     §3ACTM        IFNE      *BLANKS
192110950303     C                   MOVEL     §3ACTM        BLPCTM
192120950303     C                   ELSE
192130940919     C                   MOVEL     VIDCTM        BLPCTM
192140950303     C                   ENDIF
192150941005     C     BLPCTM        IFEQ      *BLANKS
192160941005     C                   MOVEL     WCTM          BLPCTM
192170941005     C                   ENDIF
192180940919     C                   MOVEL     VIDTC1        BLPTC1
192190940919     C                   MOVEL     VIDTC2        BLPTC2
192200001205     C* SE MANUTENZIONE DI BOLLA POSTE E AGGIUNTA O TOLTA TC1/2 "F"
192210060215     C* DEVO AGGIORNARE ar4 TIPO RECORD J
192220140122     C** 12
192230140122     C**ANN15§ogntw        IFEQ      'PPT'
192240140122     C**                 CLEAR                   WTCP
192250140122     C**                 CLEAR                   WSVTCP
192260140122     C**   VIDTC1        IFEQ      'F'
192270140122     C**   VIDTC2        OREQ      'F'
192280140122     C**                 MOVEL     'F'           WTCP
192290140122     C**                 ENDIF
192300140122     C**   SAVTC1        IFEQ      'F'
192310140122     C**   SAVTC2        OREQ      'F'
192320140122     C**                 MOVEL     'F'           WSVTCP
192330140122     C**                 ENDIF
192340140122     C**                 SELECT
192350001205     C* SE NON E' STATA NE' AGGIUNTA NE' TOLTA LA "F" NON FACCIO NIENTE
192360140122     C**   VIDTC1        WHENNE    'F'
192370140122     C**   VIDTC2        ANDNE     'F'
192380140122     C**   SAVTC1        ANDNE     'F'
192390140122     C**   SAVTC2        ANDNE     'F'
192400140122     C**   WTCP          OREQ      'F'
192410140122     C**   WSVTCP        ANDEQ     'F'
192420140122     C**                 OTHER
192430140122     C**                 MOVEL     'J'           WTRC
192440140122     C**   KBLP4         CHAIN(N)  Fiar401L                           30
192450140122    3C**   *IN30         IFEQ      *OFF
192460140122     C**                 MOVEL     ar4NOT        DSBL4J
192470001205     C* TOLTO LA 'F'
192480140122    4C**   WTCP          IFEQ      *BLANKS
192490140122     C**   WSVTCP        ANDEQ     'F'
192500140122     C**                 CLEAR                   §B4BAI
192510140122   X4C**                 ELSE
192520001205     C* AGGIUNTA 'F'
192530140122    5C**   WTCP          IFEQ      'F'
192540140122     C**   WSVTCP        ANDEQ     *BLANKS
192550140122     C**                 MOVEL     'S'           §B4BAI
192560140122    5C**                 ENDIF
192570140122    4C**                 ENDIF
192580140122     C**                 CLEAR                   DSLV19
192590140122     C**                 MOVEL     DSBL4J        D19NT1
192600140122     c**                 movel     'T'           d19ftr
192610140122     C**                 MOVEL     BLPAAS        D19AAS
192620140122     C**                 MOVEL     BLPLNP        D19LNP
192630140122     C**                 MOVEL     BLPNRS        D19NRS
192640140122     C**                 MOVEL     BLPNSP        D19NSP
192650140122     C**                 MOVEL     'J'           D19TRC
192660140122     C**                 CLEAR                   D19NT2
192670140122     C**                 CALL      'FNLV19R'
192680140122     C**                 PARM                    DSLV19
192690140122   X3C**                 ELSE
192700001205     C* AGGIUNTA 'F' --> CREO RECORD "J"
192710140122    4C**   WTCP          IFEQ      'F'
192720140122     C**   WSVTCP        ANDEQ     *BLANKS
192730140122     C**                 CLEAR                   DSLV19
192740140122     C**                 CLEAR                   DSBL4J
192750140122     c**                 movel     'T'           d19ftr
192760140122     C**                 MOVEL     'S'           §B4BAI
192770140122     C**                 MOVEL     DSBL4J        D19NT1
192780140122     C**                 MOVEL     BLPAAS        D19AAS
192790140122     C**                 MOVEL     BLPLNP        D19LNP
192800140122     C**                 MOVEL     BLPNRS        D19NRS
192810140122     C**                 MOVEL     BLPNSP        D19NSP
192820140122     C**                 MOVEL     'J'           D19TRC
192830140122     C***                CLEAR                   D19NT2
192840140122     C**                 CALL      'FNLV19R'
192850140122     C***                PARM                    DSLV19
192860140122    4C***                ENDIF
192870140122    3C***                ENDIF
192880140122     C***                ENDSL
192890140122     C***                ENDIF
192900141201     c* se spedizione export non memorizzo nè il pin code se presente e nemmeno
192910141201     c* la particolarità consegna se prevede il PIN CODE
192920141201     c                   if        a_§ogntw='DPD' or
192930141201     c                             a_§ogntw='EEX' or
192940141201     c                             a_§ogntw='FED'
192950141201     c                   clear                   wpincode
192960141201     c                   if        §7rpincode='S'
192970141201     c                   clear                   vidgma
192980141201     c                   endif
192990141201     c                   endif
193000141201
193010940919     C                   MOVEL     VIDGGA        BLPGGA
193020940919     C                   MOVEL     VIDGMA        BLPGMA
193030141201
193040940919     C                   MOVEL     VIDGVA        BLPGVA
193050960208     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
193060960208     C* DELLE PARTICOLARITA' VARIE
193070970707     C     W2LN          IFEQ      'S'
193080960208     C                   MOVE      'D'           BLPGVA
193090960208     C                   ELSE
193100960208     C                   MOVE      ' '           BLPGVA
193110960208     C                   ENDIF
193120141201
193130141201
193140940919     C* C/ASSEGNO
193150051115    1C     ar9CAS        IFGT      0
193160940919     C     VIDGCA        ORNE      *BLANKS
193170051115     C                   MOVEL     BLPAAS        ar9AAS
193180051115     C                   MOVEL     BLPLNP        ar9LNP
193190051115     C                   MOVEL     BLPNRS        ar9NRS
193200051115     C                   MOVEL     BLPNSP        ar9NSP
193210051115     C                   MOVEL     VIDGCA        ar9GCA
193220051115     C                   MOVEL     dateu         ar9duv
193230940919     C*
193240051115     C     War9          IFEQ      'E'
193250051115     C                   UPDATE    Fiar9000
193260940926     C                   ELSE
193270051115     C                   WRITE     Fiar9000
193280940926     C                   ENDIF
193290940926     C*
193300940926     C                   ELSE
193310940926     C* SE C'ERA E ORA NON PIU' DELETO
193320051115     C     War9          IFEQ      'E'
193330051115     C                   DELETE    Fiar9000
193340940919     C                   ENDIF
193350940926     C                   ENDIF
193360900828     C*
193370941025     C* SE NO A BORDERO' METTO 99999 IN DATA BORDERO' E NUM.F.VIAGG
193380930628    1C     §1BFG4        IFEQ      'N'
193390900829     C                   MOVEL     DATEU         BLPDBR
193400900828     C                   MOVEL     *ALL'9'       BLPNFV
193410930628   X1C                   ELSE
193420930628    2C     *IN12         IFEQ      *ON
193430930628     C     *IN15         ANDEQ     *ON
193440930628     C     *IN12         OREQ      *OFF
193450930628     C                   MOVEL     *ZEROS        BLPDBR
193460930628     C                   MOVEL     *ZEROS        BLPNFV
193470930628    2C                   END
193480930628    1C                   END
193490910805     C  N12              MOVEL     *BLANKS       BLPFNS
193500910805     C   12              MOVEL     VIDFNS        BLPFNS
193510971212     C**
193520971215     C** SE BOLLA EXP/IMP SDI CON NUMERO AWB SCRITTO, LO MEMORIZZO
193530020211     c** SE BOLLA EXPORT FEDEX ASSEGNO IL NUMERO AWB
193540971217     C   12
193550971217     CAN 15
193560971217     CORN12              CLEAR                   DSBL4E
193570020213     c     A_§ogntw      ifeq      'FED'
193580020320     c     wawbini       andgt     *zeros
193590020211     C                   CLEAR                   DSBL4E
193600020228     c                   movel     wawbini       w0012a           12
193610020228     c* calcolo check digit
193620020228     c                   exsr      chkdgf
193630020228     c                   movel     w0012a        §b4erp
193640020211     C                   MOVEL     'A'           §B4EMA
193650020211     C                   MOVEL     'P'           §B4EAT
193660020212     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
193670051102     c* del ARS trk "F"
193680020208     c                   endif
193690081008    1C**   V6CAWB        IFEQ      0
193700081008     c**   A_§ogntw      andeq     'EUP'
193710971212     C* VEDO SE C'E' IL CONTATORE 19 - NUMERO AWB
193720081008     C***                CLEAR                   AAS
193730081008     C**                 Z-ADD     19            CNU
193740081008     C**                 Z-ADD     BLPTFP        COMLIN
193750081008     C**   KNUF          CHAIN     FLNUF01L                           30
193760081008    2C**   *IN30         IFEQ      *OFF
193770081008     C**                 ADD       1             NUFNUM
193780980623     C* SE SUPERA RANGE FINALE, RIPARTO DA QUELLO INIZIALE
193790081008     C**   NUFNUM        IFGT      NUFRFI
193800081008     C**                 Z-ADD     NUFRIN        NUFNUM
193810081008    6C**                 END
193820081008     C**                 UPDATE    FLNUF
193830081008     C**                 Z-ADD     NUFNUM        W0090
193840081008     C**                 MOVEL     §3IFAW        W0090
193850081008     C**   W0090         DIV       7             RISUL
193860081008     C**                 MVR                     RESTO
193870081008     C**                 MOVEL     W0090         W010A
193880081008     C**                 MOVE      RESTO         W010A
193890971217     C*
193900081008     C**                 CLEAR                   DSBL4E
193910081008     C**                 MOVEL     W010A         §B4ERP
193920081008     C**                 MOVEL     'A'           §B4EMA
193930081008     C**                 MOVEL     'P'           §B4EAT
193940971216     C* SE LA STAMPO IN IMMEDIATO METTO SUBITO LA S DI STAMPATO
193950081008    3C**   §1BFG6        IFEQ      'I'
193960971217     C*
193970081008     C**   §1BFG6        OREQ      'C'
193980081008     C**   §1BFG0        ANDEQ     'I'
193990971217     C*
194000081008     C**   §1BFG6        OREQ      'C'
194010081008     C**   §1BFG0        ANDEQ     'C'
194020081008     C**   §1BF11        ANDEQ     'I'
194030081008     C**                 MOVEL     'S'           §B4EST
194040081008     C**                 ELSE
194050081008     C**                 MOVEL     'N'           §B4EST
194060081008    3C**                 ENDIF
194070081008    2C**                 ENDIF
194080971212     C**
194090081008   X1C**                 ELSE
194100971217     C* IN MANUTENZIONE SOLO SE HO MODIFICATO IL NUMERO
194110971217     C*  ALTRIMENTI LASCIO QUELLO CHE C'E'
194120081008    2C**   V6CAWB        IFGT      0
194130980310     C* SOLO SE EXPORT SDI
194140081008     c**   A_§ogntw      ifeq      'EUP'
194150081008    4C**   SAVAWB        IFNE      V6CAWB
194160081008     C**   §B4EMA        OREQ      ' '
194170081008     C**                 CLEAR                   DSBL4E
194180081008     C**                 MOVEL     V6CAWB        §B4ERP
194190081008     C**                 MOVEL     'M'           §B4EMA
194200081008     C**                 MOVEL     'P'           §B4EAT
194210081008     C**                 MOVEL     'S'           §B4EST
194220081008    4C**                 ENDIF
194230081008    3C**                 ENDIF
194240081008    2C***                ENDIF
194250081008    1C**                 ENDIF
194260971230     C* SE MODIFICATA LA LNA E DIVENTATE ENTRAMBE IN ITALIA
194270060215     C*    AZZERO NUMERO AWB E CANCELLO Fiar4
194280971230    2C     *IN12         IFEQ      *ON
194290971230     C     *IN15         ANDEQ     *OFF
194300120302     C* PER LA LINEA DI PARTENZA VALE SOLO PER BRT
194310020211     c     §ogntw        ifne      'EEX'
194320020211     c     §ogntw        andne     'FED'
194330081008     c***  §ogntw        andne     'EUP'
194340020213     c     A_§ogntw      andne     'FED'
194350081008     c***  A_§ogntw      andne     'EUP'
194360020211     C                   MOVEL     'E'           WTRC
194370060215     C     KBLP4         DELETE    Fiar4000                           30
194380020211     C                   CLEAR                   §B4ERP
194390020211     c                   endif
194400971230    2C                   ENDIF
194410060216     C* SE C'E' NUMERO AWB SCRIVO RECORD E IN ar4
194420971212    1C     §B4ERP        IFNE      *BLANKS
194430971216     C     SAVAWB        ORNE      0
194440081008     c***  A_§ogntw      ifeq      'EUP'
194450081008     c     A_§ogntw      ifeq      'FED'
194460060215     C                   MOVEL     'T'           D19ftr
194470971212     C                   MOVEL     BLPAAS        D19AAS
194480971212     C                   MOVEL     BLPLNP        D19LNP
194490971212     C                   MOVEL     BLPNRS        D19NRS
194500971212     C                   MOVEL     BLPNSP        D19NSP
194510971212     C                   MOVEL     'E'           D19TRC
194520971212     C                   CLEAR                   D19NT1
194530971212     C                   MOVEL     DSBL4E        D19NT1
194540971212     C                   CLEAR                   D19NT2
194550971212     C                   CALL      'FNLV19R'
194560971212     C                   PARM                    DSLV19
194570020211     c                   endif
194580971212    1C                   ENDIF
194590031219      * se ho caricato il riferimento partner estero da FIVAT rcd 'C'
194600060216      * scrivo il Fiar4 rcd 'E'
194610031219    1c                   If        *In12 and *In15
194620080128     c                             and A_§ogntw<>'FED'
194630060215     c                   MOVEL     'T'           D19ftr
194640031219     C                   MOVEL     BLPAAS        D19AAS
194650031219     C                   MOVEL     BLPLNP        D19LNP
194660031219     C                   MOVEL     BLPNRS        D19NRS
194670031219     C                   MOVEL     BLPNSP        D19NSP
194680031219     C                   MOVEL     'E'           D19TRC
194690031219     C                   CLEAR                   D19NT1
194700031219     C                   MOVEL     wrifp         D19NT1
194710031219     C                   CLEAR                   D19NT2
194720031219     C                   CALL      'FNLV19R'
194730031219     C                   PARM                    DSLV19
194740031219    1c                   EndIf
194750141031     c* Memorizzo Pin Code se presente
194760141031    1c                   If        *In12 and *In15 and wPinCode<>*blanks
194770141031     c                   MOVEL     'T'           D19ftr
194780141103
194790141103     c                   clear                   dsbl4y
194800141103     C                   MOVEL     wPinCode      §b4pcd
194810141103
194820141031     C                   MOVEL     BLPAAS        D19AAS
194830141031     C                   MOVEL     BLPLNP        D19LNP
194840141031     C                   MOVEL     BLPNRS        D19NRS
194850141031     C                   MOVEL     BLPNSP        D19NSP
194860141031     C                   MOVEL     'Y'           D19TRC
194870141031     C                   CLEAR                   D19NT1
194880141103     c                   movel     dsbl4y        d19nt1
194890141031     C                   CLEAR                   D19NT2
194900141031     C                   CALL      'FNLV19R'
194910141031     C                   PARM                    DSLV19
194920141031    1c                   endif
194930991203      **
194940060216      ** SE EXPORT DPD CON NUMERO PARCEL SCRITTO, LO MEMORIZZO IN Fiar4
194950060509     c                   if        (*in12 and *in15) or *in12 = '0'
194960061003     C****               CLEAR                   DSBL4F
194970060509     C                   CLEAR                   DSBL4I
194980060509     C                   CLEAR                   DSBL4K
194990060509     c                   endif
195000991203      *
195010020319    1C     A_§OGNTW      IFEQ      'DPD'
195020060620     c*
195030991203      *
195040060616    2C     V7CNPR        IFne      *blanks
195050060620     c* Imposto dsbl4f solo se si utilizza ancora il cappario vecchio
195060061003     C****               CLEAR                   DSBL4F
195070061003    3c****               if        dateu < §vpodpd  AND
195080061003     c****                         %subst(v7cnpr:14:1)=*blanks
195090061003     C****               MOVEL     V7CNPR        §B4FNP
195100061003     C**** §1BF13        IFEQ      'A'
195110061003     C****               MOVEL     'A'           §B4FMA
195120061003     C****               ELSE
195130061003     C****               MOVEL     'M'           §B4FMA
195140061003     C****               ENDIF
195150061003     C****               MOVEL     'P'           §B4FAT
195160061003     C****               MOVEL     'S'           §B4FST
195170061003     C****               MOVEL     OD3NAZ        §B4NAZ
195180061003     C****               MOVEL     OD3RTN        §B4RTN
195190061003     C****               MOVEL     OD3ZON        §B4ZON
195200061003     C****               MOVEL     OD3COL        §B4FNR
195210061003    3c****               endif
195220060616     c* imposto dsbl4i/k
195230060509     c                   clear                   dsbl4i
195240060616     c                   clear                   dsbl4k
195250060509     C                   MOVEL     V7CNPR        §B4IPN
195260060616     c* tolgo il check digit dal parcel number se n. parcel lungo 12
195270060620     c                   if        %subst(§b4ipn:14:1) = *blanks
195280060509     c                   eval      %subst(§b4ipn:12:1)=' '
195290060620     c                   eval      §b4icd=%subst(v7cnpr:12:1)
195300060616     c                   else
195310060616     c* se parcel lungo 14 calcolo il check digit
195320060616     c                   clear                   trul28ds4
195330060616     c                   eval      i284cod=§b4ipn
195340060616     c                   call      'TRUL28R5'
195350060616     c                   parm                    trul28ds4
195360060616     c                   movel     o284ckd       §b4icd
195370060616     c                   endif
195380060616     c* Se ho usato il cappario dpd vecchio imposto dsbl4i con campi
195390060616     c* del cappario vecchio altrimenti perndo quelli del cappario nuov
195400070515     c***                if        dateu < §vpodpd  AND
195410070515     c***                          %subst(v7cnpr:14:1)=*blanks
195420060510     c* depot di arrivo --> muovo uno 0 in prima posizione
195430070515     c***                movel     '0'           §b4ida
195440070515     C***                MOVE      OD3RTN        §B4ida
195450070515     C***                MOVEL     OD3ZON        §B4iza
195460060509     c* imposto dsbl4k
195470070515     C***                MOVEL     OD3COL        §B4krt
195480070515     c***                else
195490060616     c                   movel     osie3dsrt     §b4ids
195500060616     c                   movel     osie3bidp     §b4ibi
195510060616     c                   movel     osie3ddep     §b4ida
195520060616     c                   move      isie3srv      §b4isc
195530061010     c                   movel     osie3iatad    §b4iat
195540061010     c                   movel     osie3ptyg     §b4ipy
195550070515     c***                endif
195560991203      *
195570991203    2C                   ENDIF
195580991203    1C                   ENDIF
195590050228     c*
195600050228    1C     *in79         IFEQ      *on
195610070605    1C     A_§OGNTW      andne     'DPD'
195620060616    2C     v7cnpr        IFne      *blanks
195630061003     C****               CLEAR                   DSBL4F
195640060621     c* solo se parcel lungo 11
195650061003     c****               if        %subst(v7cnpr:14:1) = *blanks
195660061003     c****               movel     v7cnpr        §b4fnp
195670061003     c***                endif
195680060510     c* imposto dsbl4i
195690060616     c                   movel     v7cnpr        §b4ipn
195700060621    3c                   if        %subst(§b4ipn:14:1) = *blanks
195710060616     c                   eval      %subst(§b4ipn:12:1)=' '
195720060619     c                   eval      §b4icd=%subst(v7cnpr:12:1)
195730060621   x3c                   else
195740060616     c* se parcel lungo 14 calcolo il check digit
195750060616     c                   clear                   trul28ds4
195760060616     c                   eval      i284cod=§b4ipn
195770060616     c                   call      'TRUL28R5'
195780060616     c                   parm                    trul28ds4
195790060616     c                   movel     o284ckd       §b4icd
195800060621    3c                   endif
195810060621     c* destination sort
195820060621     c                   move      §oghb1        §b4ids
195830060621     c                   move      a_§ogdp1      §b4ida
195840060621    3c                   select
195850060628     c* immissione o bolla di reso
195860060628     c                   when      *in12='0' or blpfbr = 'S'
195870060621     C                   CLEAR                   PTYPE             2
195880060621     c                   if        blppkb>§3ilmp
195890060621     c                   move      101           §b4isc
195900060621     c                   eval      ptype='01'
195910060621     c                   else
195920060621     c                   move      136           §b4isc
195930060928     c                   eval      ptype='02'
195940060621     c                   endif
195950060628     c                   if        blpfbr='S'
195960060628     c                   move      300           §b4isc
195970060628     c                   endif
195980060621     c                   move      '%'           §b4ibi
195990060621     c                   if        %subst(§b4ipn:14:1)=*blanks
196000060621     c                   eval      §b4krt='39' + %subst(blpcad:1:5)+
196010060621     c                             ptype
196020060621     c                   endif
196030060628     c* conferma da disk
196040060628     c                   when      *in12='1' and *in15='1'
196050160617     c                   if        savfpr='D'
196060160617     c                   eval      dblp01=§lpflo
196070160617     c                   move      §lpscd        §B4ISC
196080160916     c                   move      '%'           §b4ibi
196090160617     c                   else
196100060628     c                   move      §VATESCD      §B4ISC
196110060628     c                   move      §VATEbid      §b4ibi
196120060628    4c                   if        §vaterou <> *blanks
196130060628     c                   move      §vaterou      §b4krt
196140060628    4c                   endif
196150160617     c                   endif
196160060621    3c                   endsl
196170050228    2C                   ENDIF
196180160218     c* FLAG TRADUTTORE
196190160218     c                   select
196200150916     c* flag traduttore se in Conferma da disk
196210160218     c                   when      *in12 and *in15
196220150916     c                   eval      dblp01=§lpflo
196230160218     c* Metto quello che ricevo da chiamante
196240150916     c                   eval      §B4TRD=§LPTRD
196250160218     c* se non ho ricevuto nulla e sono richiamata da pgm giacenze per
196260160218     c* bolla di reso metto "R" si tratta di bolla di recupero:
196270160218     c                   if        §b4trd=*blanks and §3arbl<>'R' and *in44
196280160218     c                             and blpfbr='S'
196290160218     c                   eval      §b4trd='R'
196300160218     c                   endif
196310160218     c* Immissione bolle: metto "M"=Manuale se non è bolla di recupero
196320160218     c                   when      not *in12
196330160218     c                   if        §3arbl<>'R'
196340160218     c                   eval      §b4trd='M'
196350160218     c                   endif
196360160218     c
196370160218     c                   endsl
196380050228    1C                   ENDIF
196390991203      *
196400991203      * SE MODIFICATA LA LNA E NON È PIÙ DPD AZZERO IL NUMERO PARCEL
196410060215      *  E CANCELLO Fiar4
196420991203    2C     *IN12         IFEQ      *ON
196430991203     C     *IN15         ANDEQ     *OFF
196440020319     C     A_§OGNTW      ANDNE     'DPD'
196450050228     c     *in79         andne     *on
196460061003     C***                MOVEL     'F'           WTRC
196470061003     C***  KBLP4         DELETE    Fiar4000                           30
196480060626     C***                CLEAR                   §B4FNP
196490061003     C***                CLEAR                   dsbl4f
196500060510     C                   MOVEL     'I'           WTRC
196510060510     C     KBLP4         DELETE    Fiar4000                           30
196520060626     C                   CLEAR                   dsbl4i
196530060510     C                   MOVEL     'K'           WTRC
196540060510     C     KBLP4         DELETE    Fiar4000                           30
196550060626     C                   CLEAR                   dsbl4k
196560991203    2C                   ENDIF
196570991203      *
196580060620      * SE C'E' NUMERO PARCEL SCRIVO RECORD "I" IN ar4
196590060620     c* Tipo rekord F
196600061003     c***                if        §b4fnp<>*blanks or savfnp<>*blanks
196610061003     C***                MOVEL     'T'           D19ftr
196620061003     C***                MOVEL     BLPAAS        D19AAS
196630061003     C***                MOVEL     BLPLNP        D19LNP
196640061003     C***                MOVEL     BLPNRS        D19NRS
196650061003     C***                MOVEL     BLPNSP        D19NSP
196660061003     C***                MOVEL     'F'           D19TRC
196670061003     C***                MOVEL(P)  DSBL4F        D19NT1
196680061003     C***                CLEAR                   D19NT2
196690061003     C***                CALL      'FNLV19R'
196700061003     C***                PARM                    DSLV19
196710061003     c***                endif
196720060620     c* Tipo record K
196730060620     c                   if        §b4krt<>*blanks or savkrt<>*blanks
196740060620     C                   MOVEL     'T'           D19ftr
196750060620     C                   MOVEL     BLPAAS        D19AAS
196760060620     C                   MOVEL     BLPLNP        D19LNP
196770060620     C                   MOVEL     BLPNRS        D19NRS
196780060620     C                   MOVEL     BLPNSP        D19NSP
196790060620     C                   MOVEL     'K'           D19TRC
196800060620     C                   MOVEL(P)  DSBL4K        D19NT1
196810060620     C                   CLEAR                   D19NT2
196820060620     C                   CALL      'FNLV19R'
196830060620     C                   PARM                    DSLV19
196840060620     c                   endif
196850060620     c* Tipo record I
196860060510    1C     §B4IPN        IFNE      *BLANKS
196870060616     C     SAVNPR        ORNE      *blanks
196880060510     c*
196890060510     C                   MOVEL     'T'           D19ftr
196900060510     C                   MOVEL     BLPAAS        D19AAS
196910060510     C                   MOVEL     BLPLNP        D19LNP
196920060510     C                   MOVEL     BLPNRS        D19NRS
196930060510     C                   MOVEL     BLPNSP        D19NSP
196940060510     C                   MOVEL     'I'           D19TRC
196950060510     C                   MOVEL(P)  DSBL4I        D19NT1
196960060510     C                   CLEAR                   D19NT2
196970060510     C                   CALL      'FNLV19R'
196980060510     C                   PARM                    DSLV19
196990061106     c* se sono in conferma bolle import dpd scrivo depot su DPPDC
197000061106     c* se manca
197010061107     c                   if        §b4ipn<>*blanks and *in79  and *in12
197020061107     c                             and *in15
197030061106     c                   clear                   truldepds
197040061106     c
197050061106     c                   if        %subst(§b4ipn:14:1) <> *blanks
197060061106     c                   movel     §b4ipn        idepdpc
197070061106     c                   else
197080061106     c                   eval      idepdpc='0'+%subst(§b4ipn:1:3)
197090150918     c                   endif
197100150918     c* Memorizzo il depot solo se numerico
197110150918     c* (E' capitato un depot AA00 che è poi stato utilizzato erroneamente
197120150918     c*  per un parcel number di una bolla export dpd e il collo è poi stato
197130150918     c*  smarrito)
197140150918     c                   if        %check(digits:idepdpc)=0
197150061106     c                   call      'TRULDEPR'
197160061106     c                   parm                    truldepds
197170061106     c                   if        odeperr='1'
197180151112     c     idepdpc       chain     dppdc01l
197190151112     c                   if        %found(dppdc01l)
197200151112     c                   z-add     20401231      pdcdsc
197210151112     c                   z-add     dateu         pdcdtv
197220151112     c                   time                    pdcorv
197230151112     c                   update    dppdc000
197240151112     c                   else
197250061106     c                   clear                   dppdc000
197260061106     c                   eval      pdcdpc=idepdpc
197270151112     c                   z-add     19900101      pdcdde
197280151112     c******             z-add     dateu         pdcdde
197290061106     c                   z-add     20391231      pdcdsc
197300061106     c                   z-add     dateu         pdcdtv
197310061107     c                   time                    pdcorv
197320061106     c                   movel     'FNLS01R'     pdcpru
197330061106     c                   write     dppdc000
197340151112     c                   endif
197350061106     c                   endif
197360150918     c                   endif
197370061106     c                   endif
197380991214     C**
197390991214     C* SCRIVO IL NUMERO DI PARCEL ANCHE NELLE NOTE
197400991214     C*
197410050405     c* se import dpd non lo devo fare lo faccio solo per export
197420060616     c                   clear                   dpdsta
197430060616     c                   clear                   dpdsta14         27
197440050405    2c     *in79         ifeq      *off
197450060626     c     §b4ipn        ifne      *blanks
197460060510     C***                MOVEL     §B4FNP        DPDPAR
197470060616     c                   if        %subst(§b4ipn:14:1)=*blanks
197480060510     c                   movel     §b4ipn        dpdpar
197490060510     c                   move      §b4icd        dpdpar
197500991214     C                   MOVEL     DPD1          DPDS1
197510991214     C                   MOVEL     DPD2          DPDS2
197520991214     C                   MOVEL     DPD3          DPDS3
197530991214     C                   MOVEL     CDPD          DPDCOS
197540060616     c                   else
197550060616     c                   eval      dpdsta14=cdpd+%subst(§b4ipn:1:4)+
197560060616     c                             ' '+%subst(§b4ipn:5:10)
197570060616     c                   endif
197580060626     c                   endif
197590991217     C* IN MANUTENZIONE CONTROLLO SE LE NOTE SONO QUELLE MESSE IN AUTOM
197600991217     C*  DEL PARCEL
197610991217     C     *IN12         IFEQ      *ON
197620991217     C     *IN15         ANDEQ     *OFF
197630991217     C                   MOVEL     VIDNT1        W012A            12
197640991217     C*
197650991217     C     W012A         IFEQ      CDPD
197660991217     C                   CLEAR                   VIDNT1
197670991217     C                   ENDIF
197680991217     C                   ENDIF
197690991217     C*
197700060626     c                   if        dpdsta<>*blanks or dpdsta14<>*blanks
197710060626    3C     VIDNT1        IFEQ      *BLANKS
197720060626    4c                   if        dpdsta<>*blanks
197730991214     C                   MOVEL(P)  DPDSTA        VIDNT1
197740060616     c                   else
197750060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
197760060626    4c                   endif
197770060626   x3C                   ELSE
197780991214     C                   MOVEL     VIDNT1        VIDNT2
197790060626    4c                   if        dpdsta<>*blanks
197800991214     C                   MOVEL(P)  DPDSTA        VIDNT1
197810060616     c                   else
197820060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
197830060626    4c                   endif
197840060626    3C                   ENDIF
197850060626     c                   endif
197860050405    2c                   endif
197870991203    1C                   ENDIF
197880991117      *
197890010502      * SE BOLLA CON LNP DPD E NUM. DISTINTA NON IMPOSTATO DEVO:
197900991130      *  - RICAVARE IL NUMERO DISTINTA E MEMORIZZARLO IN RMA
197910000218      *  - CREARE IL FILE EVENTI DPD TRANNE PER BOLLE DI RECUPERO
197920060619     C     *IN79         IFEQ      *ON
197930160908     C     §3ARBL        andne     'R'
197940080304     C***  BLPRMA        ANDEQ     *BLANKS
197950060619     c* solo per parcel number lungo 14 continuo a scrivere n.distinta
197960080304     c                   if        %subst(§b4ipn:14:1)=*blanks
197970080304     c                             and blprma=*blanks
197980060619     C                   EXSR      SPEDPD
197990060619     C                   MOVEL     DPDBRC        BLPRMA
198000060619     c                   endif
198010160908     C***  §3ARBL        IFNE      'R'
198020060619     C                   EXSR      EVEDPD
198030160908     C***                ENDIF
198040060619     C                   ENDIF
198050010502     C*
198060010924      * MEMORIZZO IL RIF. ORM NEL RIF. MITTENTE ALFANUMERICO
198070010924      *  - SEMPRE SE QUELLO IN BOLLA E' VUOTO
198080010924      *  - SE ENTRAMBI PIENI SOLO SE IMPOSTATO L'APPOSITO FLAG SULL'ORM
198090010924      *  - MAI SE BOLLA DPD
198100040226if  1c                   If        worm = 'S' and
198110040226     c                             (Not *In79 or wrifm = *Off)
198120010924      *  PREPAGATO
198130010502    2C     PARTCH        IFEQ      'P'
198140010924      *
198150010502    3C     VIDMAG        IFNE      'S'
198160010924     C     BLPRMA        ANDEQ     *BLANKS
198170010502     C                   MOVEL     §RMRFA        BLPRMA
198180010502    3C                   ENDIF
198190010924      *
198200010502   X2C                   ELSE
198210010924      *  NO PREPAGATO
198220010502    3C     FLGFIT        IFNE      'S'
198230010924    4C     BLPRMA        IFEQ      *BLANKS
198240010502     C                   MOVEL     ORMRFA        BLPRMA
198250010924   X4C                   ELSE
198260010924    5C     ORMRFA        IFNE      *BLANKS
198270010924     C     §ORMFR        ANDEQ     'S'
198280010924     C                   MOVEL     ORMRFA        BLPRMA
198290010924    5C                   ENDIF
198300010924    4C                   ENDIF
198310010924    3C                   ENDIF
198320010924      *
198330010502    2C                   ENDIF
198340010924      *
198350010502    1C                   ENDIF
198360991214     C***
198370991214     C***  N O T E
198380060216     C                   MOVEL     'T'           D19ftr
198390991214     C                   MOVEL     BLPAAS        D19AAS
198400991214     C                   MOVEL     BLPLNP        D19LNP
198410991214     C                   MOVEL     BLPNRS        D19NRS
198420991214     C                   MOVEL     BLPNSP        D19NSP
198430991214     C                   MOVEL     VIDNT1        D19NT1
198440991214     C                   MOVEL     VIDNT2        D19NT2
198450991214     C     VIDNT1        IFNE      *BLANKS
198460991214     C     VIDNT2        ORNE      *BLANKS
198470991214     C                   MOVEL     '8'           D19TRC
198480991214     C                   CALL      'FNLV19R'
198490991214     C                   PARM                    DSLV19
198500991214     C                   ENDIF
198510991214     C**
198520991214     C* REIMPOSTO LE NOTE IN MANUTENZIONE
198530991214     C   12
198540991214     CANN15              MOVEL     D19NT1        VIDNT1
198550991214     C   12
198560991214     CANN15              MOVEL     D19NT2        VIDNT2
198570991214     C**
198580991214     C* IN MANUTENZIONE SE IL PGM MI RESTITUISCE LA 2 RIGA VUOTA,
198590991214     C* LA DELETO PERCHE' POTEVA PRIMA ESISTERE
198600991214     C   12
198610991214    1CANN15D19ERR        IFEQ      *BLANKS
198620991214     C     D19NT1        ANDNE     *BLANKS
198630991214     C     D19NT2        ANDEQ     *BLANKS
198640991214     C                   MOVEL     '9'           D19TRC
198650991214     C                   CLEAR                   D19NT1
198660991214     C                   CLEAR                   D19NT2
198670991214     C                   CALL      'FNLV19R'
198680991214     C                   PARM                    DSLV19
198690991214    1C                   ENDIF
198700991214     C* SE TORNATO CODICE DI ERRORE RICHIAMO IL PGM 2 VOLTE
198710991214     C* UNA VOLTA PER NOTA
198720991214    2C     D19ERR        IFNE      *BLANKS
198730991214    1C     *IN12         OREQ      *ON
198740991214     C     *IN15         ANDEQ     *OFF
198750991214     C     VIDNT1        ANDEQ     *BLANKS
198760991214     C     VIDNT2        ANDEQ     *BLANKS
198770991214     C* NOTA 1
198780991214     C                   MOVEL     '8'           D19TRC
198790991214     C                   MOVEL     VIDNT1        D19NT1
198800991214     C                   CLEAR                   D19NT2
198810991214     C                   CALL      'FNLV19R'
198820991214     C                   PARM                    DSLV19
198830991214     C* NOTA 2
198840991214     C                   MOVEL     '9'           D19TRC
198850991214     C                   MOVEL     VIDNT2        D19NT1
198860991214     C                   CLEAR                   D19NT2
198870991214     C                   CALL      'FNLV19R'
198880991214     C                   PARM                    DSLV19
198890991214    1C                   ENDIF
198900000508     C* DATI POSTE SOLO IN CONFERMA
198910140122     C**   *IN12         IFEQ      *ON
198920140122     C***  *IN15         ANDEQ     *ON
198930140122     C***  §ogntw        ANDEQ     'PPT'
198940000509     C* SE CE' IAS O XCO
198950140122     C***  §B4IAS        IFGT      0
198960140122     C**   §B4XCO        ORNE      ' '
198970140122     C**   §B4DSC        ORNE      *BLANKS
198980140122     C**                 CLEAR                   DSLV19
198990140122     C**                 MOVEL     'T'           D19ftr
199000140122     C**                 MOVEL     BLPAAS        D19AAS
199010140122     C**                 MOVEL     BLPLNP        D19LNP
199020140122     C**                 MOVEL     BLPNRS        D19NRS
199030140122     C**                 MOVEL     BLPNSP        D19NSP
199040140122     C**                 MOVEL     DSBL4J        D19NT1
199050140122     C**                 MOVEL     'J'           D19TRC
199060140122     C**                 CALL      'FNLV19R'
199070140122     C**                 PARM                    DSLV19
199080140122     C***                ENDIF
199090140122     C***                ENDIF
199100000623     C*
199110000623     C* SE ESISTE TABELLA 3Q, CREO RECORD VUOTO W
199120060217     c* Se sono in manutenzione aggiorno (azzero la data) solo se cambi
199130060217     c* ato codice
199140000623    1C     WES3Q         IFEQ      'S'
199150060217     c
199160060217     c                   if        *in12 = *off or *in15 = *on or
199170060217     c                             wksc <> savmit
199180000623     C*
199190060217     C                   CLEAR                   DSBL4W
199200060223     C                   CLEAR                   DSLV19
199210000623     C**
199220060217     C                   MOVEL     DSBL4W        d19nt1
199230060217     C                   MOVEL     BLPAAS        d19AAS
199240060217     C                   MOVEL     BLPLNP        d19LNP
199250060217     C                   MOVEL     BLPNRS        d19NRS
199260060217     C                   MOVEL     BLPNSP        d19NSP
199270060217     C                   MOVEL     'W'           d19TRC
199280060223     c                   movel     'T'           d19ftr
199290060217     c                   clear                   d19nt2
199300060217     c* se sono in manutenzione richiamo fnlv19r solo se cambiato codice
199310060217     C                   CALL      'FNLV19R'
199320060217     C                   PARM                    DSLV19
199330060217     c                   endif
199340000623     C*
199350000623   X1C                   ELSE
199360000623     C* SE ESISTEVA MA ADESSO NON ESISTE PIU' DEVO CANCELLARE IL RECORD
199370000623    2C     WBL4W         IFEQ      'E'
199380060223     c                   clear                   dslv19
199390060217     C                   clear                   d19nt1
199400060217     C                   MOVEL     BLPAAS        d19AAS
199410060217     C                   MOVEL     BLPLNP        d19LNP
199420060217     C                   MOVEL     BLPNRS        d19NRS
199430060217     C                   MOVEL     BLPNSP        d19NSP
199440060217     C                   MOVEL     'W'           d19TRC
199450060223     c                   movel     'T'           d19ftr
199460060217     c                   clear                   d19nt2
199470060217     C                   CALL      'FNLV19R'
199480060217     C                   PARM                    DSLV19
199490000623    2C                   ENDIF
199500000623    1C                   ENDIF
199510090325     C* Impostazione campi cliente/tariffa per tassazione porti assegnati
199520090805     c                   clear                   w_ar5ass
199530090325     c                   if        *in04
199540090325     c                   exsr      riewdwcli
199550091027     c                   select
199560091027     c                   when      flgfit<>'S' and ormpag='O'
199570090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
199580090806     c                                 %editc(ormksc:'X')
199590090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
199600090806     c                                 %subst(%editc(ormcor:'X'):1:7)
199610090804     c                   eval      w_ar5ass='T'
199620091027     c                   when      *in12 and *in15 and §lpass='T'
199630091027     c                   eval      w_ar5ass='T'
199640091027     c                   endsl
199650090325     c                   endif
199660091214     c* impostazione campo codice benefeiciario contrassegno
199670091214     c                   clear                   w_ar5cdi
199680091214     c                   select
199690091214     c                   when      wcassel2='X' and wwdwcas='S'
199700091214     c                   eval      w_ar5cdi=wcascor
199710091214     c                   when      *in12 and *in15 and §lpcdi>0
199720091214     c                   eval      w_ar5cdi=§lpcdi
199730091214     c                   endsl
199740090325     c*
199750010215     C* SE ATTIVATA PROCEDURA O.R.M. E NUMERO O.R.M. NON FITTIZIO LO
199760060215     C* MEMORIZZO SU Fiar4 TIPO RECORD "M"
199770060215      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
199780010925      * TIPO RECORD "Z" PER RITORNO VAS
199790010925    1C     WORM          IFEQ      'S'
199800010220     C     PARTCH        ANDNE     'P'
199810010228     C     WORM          OREQ      'S'
199820010228     C     VIDMAG        ANDNE     'S'
199830010713     C     §3ARBL        ANDNE     'R'
199840010215     C                   CLEAR                   DSLV19
199850060215     C                   MOVEL     'T'           D19ftr
199860010215     C                   MOVEL     BLPAAS        D19AAS
199870010215     C                   MOVEL     BLPLNP        D19LNP
199880010215     C                   MOVEL     BLPNRS        D19NRS
199890010215     C                   MOVEL     BLPNSP        D19NSP
199900010925    2C     FLGFIT        IFNE      'S'
199910010228     C     PARTCH        OREQ      'P'
199920010215     C  N12
199930010215     COR 12
199940010215     CAN 15              CLEAR                   DSBL4M
199950010925    3C     PARTCH        IFEQ      'P'
199960010228     C                   Z-ADD     §RMPOO        §B4POE
199970010228     C                   Z-ADD     §RMNSO        §B4NSR
199980010228     C                   Z-ADD     §RMNOO        §B4NOR
199990010228     C                   Z-ADD     §RMNRO        §B4NRV
200000010925   X3C                   ELSE
200010010215     C                   Z-ADD     WOPOE         §B4POE
200020010222     C                   Z-ADD     WONSR         §B4NSR
200030010222     C                   Z-ADD     WONOR2        §B4NOR
200040010215     C                   Z-ADD     WONRV         §B4NRV
200050010925    3C                   ENDIF
200060090325     c*
200070090325     c                   if        *in04
200080090325     c                   eval      §b4clg=wclg
200090090325     c                   endif
200100151104     c* Se bolla abbinata ad orm manuale
200110151104     c* memorizzo che sarà da addebitare l'orm telefonico, l'addebito
200120151104     c* Se ad un ORM abbino più spedizioni SOLO su una bisogna
200130151104     c* memorizzare l'addebito
200140151104     c                   exsr      sr_b4ado
200150151117     c                   eval      §b4ado=w_§b4ado
200160010221     C*
200170010925     C                   MOVEL     'M'           D19TRC
200180010215     C                   MOVEL     DSBL4M        D19NT1
200190010215     C                   CALL      'FNLV19R'
200200010215     C                   PARM                    DSLV19
200210060216      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
200220010925      * TIPO RECORD "Z" PER RITORNO VAS
200230121123    3c                   if        not *in12 or *in15
200240121123    4C     §ORMKS        IFEQ      'S'
200250040319     C     ORMKSC        ANDGT     *ZEROS
200260010925     C                   MOVEL     'Z'           D19TRC
200270010925     C                   CLEAR                   D19NT1
200280010925     C                   CLEAR                   D19NT2
200290010925     C                   CLEAR                   D19ERR
200300010927     C                   CLEAR                   DSBL4Z
200310010925     C                   MOVEL     ORMKSC        §B4OKC
200320010925     C                   MOVEL     DSBL4Z        D19NT1
200330010925     C                   CALL      'FNLV19R'
200340010925     C                   PARM                    DSLV19
200350121123    4C                   ENDIF
200360121123   x3c                   else
200370121122     c* in manutenzione verifico se modificare cancellare o aggiungere ar4 trk Z
200380130219     c* . . . se situazione invariata non faccio nulla
200390130219     c                   clear                   wnoZ              1
200400130219    4c                   if        wesar4z='S' and §ormks='S'
200410130219     c                             and wkscz=ormksc
200420130219     c                   eval      wnoZ='N'
200430130219    4c                   endif
200440130219    4c                   if        wnoz=*blanks  and
200450130219     c                             (wesar4z='S' and wtrasmz='N' or
200460130219     c                             (§ormks='S' and ormksc>*zeros))
200470121123     C                   MOVEL     'Z'           D19TRC
200480121123     C                   CLEAR                   D19NT1
200490121123     C                   CLEAR                   D19NT2
200500121123     C                   CLEAR                   D19ERR
200510121123     C                   CLEAR                   DSBL4Z
200520121122
200530121123    5c                   select
200540121123     c* era presente tipo record "Z"  ma ora non più : cancella se non trasmesso
200550121123     c                   when      wesar4z='S' and §ormks<>'S'
200560121126     c* era presente tipo record "Z" prima e adesso ma cliente diverso: aggiorna
200570121126     c* a sflagga per la ritrasmissione
200580121123     c                   when      wesar4z='S' and §ormks='S' and ormksc>*zeros
200590121123     c                             and wkscz<>ormksc
200600121123     C                   MOVEL     ORMKSC        §B4OKC
200610121126     C                   clear                   §B4dtr
200620121123     C                   MOVEL     DSBL4Z        D19NT1
200630121123     c* non era presente tipo record "Z" e ora si: scrive nuovo "Z"
200640121123     c                   when      wesar4z<>'S'
200650121123     C                   MOVEL     ORMKSC        §B4OKC
200660121123     C                   MOVEL     DSBL4Z        D19NT1
200670121123    5c                   endsl
200680121123     C                   CALL      'FNLV19R'
200690121123     C                   PARM                    DSLV19
200700121123    4c                   endif
200710121123    3c                   endif
200720010925      *--
200730010925   X2C                   ELSE
200740010925      *--
200750010215     C* SE SONO IN MANUTENZIONE E N. O.R.M. FITTIZIO DEVO CANCELLARE
200760060215     C* ar4 CON TIPO RECORD "M" E "Z" SE PRESENTI
200770010925    3C     *IN12         IFEQ      *ON
200780010215     C     *IN15         ANDEQ     *OFF
200790010925     C                   MOVEL     'M'           D19TRC
200800010215     C                   CALL      'FNLV19R'
200810010215     C                   PARM                    DSLV19
200820121127     c* Record "Z" lo cancello solo se non trasmesso.
200830121127     c* Se invece era stato trasmesso non lo cancello per mantenere traccia di
200840121127     c* quello che era stato fatto
200850121127     c                   if        wesar4z='S' and wtrasmz='N'
200860010925     C                   MOVEL     'Z'           D19TRC
200870010925     C                   CALL      'FNLV19R'
200880010925     C                   PARM                    DSLV19
200890121127     c                   endif
200900040319      * cancello anche il record 'A'
200910040319      * ma solo se prima dell'ORM fittizio era impostato un ORM reale
200920040319      * e lo so testando il flag wmodorm impostato nella ctrorm
200930040319if  4c                   If        wmodorm = *On
200940040319     c                   Movel     'A'           d19trc
200950040319     c                   Call      'FNLV19R'
200960040319     c                   Parm                    dslv19
200970040319e   4c                   EndIf
200980010925    3C                   ENDIF
200990010925      *
201000010925    2C                   ENDIF
201010010925    1C                   ENDIF
201020090325     c*
201030090325     c* memorizzo ksc/ctr per p.assegnati
201040090325     c                   if        *in04
201050090325     c                   Clear                   dsbl4a
201060090325     c                   Clear                   dslv19
201070090325     C                   MOVEL     'T'           D19ftr
201080090325     C                   MOVEL     BLPAAS        D19AAS
201090090325     C                   MOVEL     BLPLNP        D19LNP
201100090325     C                   MOVEL     BLPNRS        D19NRS
201110090325     C                   MOVEL     BLPNSP        D19NSP
201120090325     c                   Movel     'A'           d19trc
201130090327     c                   if        wcliksc>0
201140090327     c                   z-add     wcliksc       §b4aks
201150090326     C                   IF        wclictr<>*blanks
201160090325     c                   move      wclictr       §b4act
201170090325     c                   endif
201180090325     c                   exsr      sr_fncls
201190090325     c                   move      wclsflo8      §b4af1
201200090325     c                   Movel     dsbl4a        d19nt1
201210090325     c                   Call      'FNLV19R'
201220090325     c                   Parm                    Dslv19
201230090325     c                   endif
201240090325     c                   endif
201250110706     c* memorizzo CUP/CIG se presenti
201260110706     c                   if        wcupcup<>*blanks or wcupcig<>*blanks
201270110706     c                   Clear                   dsbl44
201280110706     c                   Clear                   dslv19
201290110706     C                   MOVEL     'T'           D19ftr
201300110706     C                   MOVEL     BLPAAS        D19AAS
201310110706     C                   MOVEL     BLPLNP        D19LNP
201320110706     C                   MOVEL     BLPNRS        D19NRS
201330110706     C                   MOVEL     BLPNSP        D19NSP
201340110706     c                   Movel     '4'           d19trc
201350110706     c                   movel     wcupcup       §b44cup
201360110706     c                   movel     wcupcig       §b44cig
201370110706     c                   Movel     dsbl44        d19nt1
201380110706     c                   Call      'FNLV19R'
201390110706     c                   Parm                    Dslv19
201400110706     c                   else
201410110706     c                   if        *in12 and not *in15
201420110706     c                   Clear                   dslv19
201430110706     C                   MOVEL     'T'           D19ftr
201440110706     C                   MOVEL     BLPAAS        D19AAS
201450110706     C                   MOVEL     BLPLNP        D19LNP
201460110706     C                   MOVEL     BLPNRS        D19NRS
201470110706     C                   MOVEL     BLPNSP        D19NSP
201480110706     c                   Movel     '4'           d19trc
201490110706     c                   Call      'FNLV19R'
201500110706     c                   Parm                    Dslv19
201510110706     c                   endif
201520110706     c                   endif
201530150128
201540150128     c* Località normalizzata
201550150210     c                   if        blplod<>wLocNorm
201560150210     c                             or (*in12 and not *in15)
201570150128     c                   Clear                   dslv19
201580150128     C                   MOVEL     'T'           D19ftr
201590150128     C                   MOVEL     BLPAAS        D19AAS
201600150128     C                   MOVEL     BLPLNP        D19LNP
201610150128     C                   MOVEL     BLPNRS        D19NRS
201620150128     C                   MOVEL     BLPNSP        D19NSP
201630150128     c                   Movel     'X'           d19trc
201640150210     c                   if        blplod<>wlocnorm
201650150128     c                   movel     wLocNorm      d19nt1
201660150210     c                   else
201670150210     c                   clear                   d19nt1
201680150210     c                   endif
201690150128     c                   Call      'FNLV19R'
201700150128     c                   Parm                    Dslv19
201710150210     c                   endif
201720150128
201730130305     c* F I A R 8
201740130924     c                   eval      aggioAr8='S'
201750130924     c                   exsr      sr_gesar8
201760130305     c* F I A R 5
201770030805      * se bolla con bancali - part. varia "B"
201780021218      * scrivo o aggiorno il file estensione FIAR500F record "BAN"
201790030704     c                   If        %subst(VidGva:1:1) = 'B'
201800021218     c                   Clear                   DAr5Ban
201810030704     c                   Eval      Kar5Trd = 'BAN'
201820021218     c     KFiar5        Chain     Fiar501l
201830021218     c                   Move      Dateu         Ar5Dac
201840021218     c                   Movel     W0140         Ar5Orc
201850021218     c                   Movel     VidTba        §Ar5Tba
201860021218     c                   Eval      §Ar5Nba = VidNba
201870021218     c                   Movel     VidTb2        §Ar5Tb2
201880021218     c                   Eval      §Ar5Nb2 = VidNb2
201890021218     c                   Movel(p)  DAr5Ban       Ar5Uni
201900030704     c                   ExSr      Sr_wrtFiar5
201910021218     c                   EndIf
201920030805      * se bolla con bancali - part. varia "O"
201930030704      * scrivo o aggiorno il file estensione FIAR500F record "BNB"
201940030730      * se non richiamto da giacenze
201950031125     c                   If        %subst(VidGva:1:1) = 'O'
201960030704     c                   Clear                   DAr5Bnb
201970030704     c                   Eval      Kar5Trd = 'BNB'
201980030704     c     KFiar5        Chain     Fiar501l
201990030704     c                   Move      Dateu         Ar5Dac
202000030704     c                   Movel     W0140         Ar5Orc
202010030704     c                   Movel     VidTba        §Ar5bTba
202020030704     c                   Eval      §Ar5bNba = VidNba
202030030704     c                   Movel     VidTb2        §Ar5bTb2
202040030704     c                   Eval      §Ar5bNb2 = VidNb2
202050030704     c                   Eval      §Ar5bCor = w03cor
202060030704     c                   Eval      §Ar5bCsf = w03csf
202070030704     c                   Movel(p)  DAr5Bnb       Ar5Uni
202080030704     c                   ExSr      Sr_wrtFiar5
202090030704     c                   EndIf
202100030805      * se bolla con paricolarità consegna "RC"
202110030805      * scrivo o aggiorno il file estensione FIAR500F record "RCC"
202120030912      * solo se non sono richiamata da giacenze
202130100604     c**                 If        VidGma = 'RC' and
202140100604     c                   If        §7rRC  = 'S'  and
202150030912     c                             savfpr <> 'G' and savfpr <> 'P'
202160150302     c                             and savfpr <> 'B'
202170091124      * Aggiorno l'ORM se sono in immissione
202180091124     c                   If        Not *In12 or
202190091124     c                             (*In12 and *In15)
202200091221      * oppure aggiornamento ed inserito "RC"
202210100604     c                             or (*in12 and Not *in15 and w7rRC <> 'S')
202220091124     c                   Eval      wope = 'A'
202230091124     c                   ExSr      Sr_Ricorm
202240030805     c                   Clear                   DAr5Rcc
202250030805     c                   Eval      Kar5Trd = 'RCC'
202260030805     c     KFiar5        Chain     Fiar501l
202270030805     c                   Move      Dateu         Ar5Dac
202280030805     c                   Movel     W0140         Ar5Orc
202290030805     c                   Eval      §Ar5rPoe = savOrmPoe
202300030805     c                   Eval      §Ar5rNsr = savOrmNsr
202310030805     c                   Eval      §Ar5rNor = savOrmNor
202320030805     c                   Eval      §Ar5rNrv = savOrmNrv
202330030805     c                   Movel(p)  DAr5Rcc       Ar5Uni
202340030805     c                   ExSr      Sr_wrtFiar5
202350091221     c                   EndIf
202360030805     c                   EndIf
202370031113      * Se inseriti il referente o il n. di telefono devo memorizzarli
202380031113      * nel FIAR500F record "GEN"
202390040610      * Idem per tipo merce v-valore
202400090804      * Idem se bolla in assegnato con triangolazione
202410110527      * 27/05/11 Ci sarà sempre il record GEN, quindi chaino sempre e scrivo o
202420110527      *          aggiorno
202430110527if  1c****               If        VidRef <> *Blanks or VidTel <> *Blanks
202440110527     c****                         or vidbva <> *blanks  or w_ar5ass='T'
202450110527     c****                         or w_ar5tcp<>*blanks or w_ar5tic<>*blanks
202460110527     c****                         or ar9tic<>*blanks or
202470110527     c****                         w_ar5cdi>0 or not *in12 or *in15
202480031113     c                   Clear                   DAr5Gen
202490031113     c                   Eval      Kar5Trd = 'GEN'
202500031113     c     KFiar5        Chain     Fiar501l
202510031114if  2c                   If        Not %Found(Fiar501l)
202520160225     c***                Move      Dateu         Ar5Dac
202530160225     c***                Movel     W0140         Ar5Orc
202540160225     c                   eval      ar5dac=%dec(%date())
202550160225     c                   eval      ar5orc=%dec(%time())
202560110527     c                   eval      §ar5bpru=knmus
202570110527     c                   eval      §ar5bnmtd=knmtd
202580031114     c                   Eval      §Ar5Ref = VidRef
202590031114     c                   Eval      §Ar5Teld = VidTel
202600140416     c* se numero di telefono vuoto ma è presente l'sms, quest'ultimo lo copio
202610140416     c* anche in §arteld
202620150213     c***                if        §ar5teld=*blanks
202630150213     c***                eval      §Ar5Teld = wsms
202640150213     c***                endif
202650040610     c                   Eval      §Ar5bva = Vidbva
202660090804     c                   Eval      §Ar5ass = w_ar5ass
202670091001     c                   Eval      §Ar5tcp = w_ar5tcp
202680091001     c                   Eval      §Ar5tic = w_ar5tic
202690091104     c                   Eval      §Ar5tici =ar9tic
202700091214     c                   if        w_ar5cdi>0
202710091214     c                   Eval      §Ar5CDI  =%editc(w_ar5cdi:'X')
202720091119     c                   else
202730091119     c                   clear                   §ar5cdi
202740091118     c                   endif
202750130308     c                   eval      §ar5alx=w_allx
202760130408     c                   eval      §ar5alm=w_allm
202770130417     c                   eval      §ar5als=w_alls
202780140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
202790140407     c* nazione mittente italia
202800140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
202810140407     c                             blpnzm=*blanks
202820140403     c                   eval      §AR5PK2='S'
202830140403     c                   else
202840140403     c                   clear                   §AR5PK2
202850140403     c                   endif
202860160225     c                   if        w_aDpd='S'
202870160225     c                   eval      §ar5fdpd='S'
202880160225     c                   endif
202890031113     c                   Movel(p)  DAr5Gen       Ar5Uni
202900031113     c                   ExSr      Sr_wrtFiar5
202910031114   x2c                   Else
202920040610     c                   movel     ar5uni        DAr5Gen
202930031114     c                   Eval      §Ar5Ref = VidRef
202940031114     c                   Eval      §Ar5Teld = VidTel
202950040610     c                   eval      §ar5bva = vidbva
202960090804     c                   Eval      §Ar5ass = w_ar5ass
202970091001     c                   Eval      §Ar5tcp = w_ar5tcp
202980091001     c                   Eval      §Ar5tic = w_ar5tic
202990091104     c                   Eval      §Ar5tici =ar9tic
203000091214     c                   if        w_ar5cdi>0
203010091214     c                   Eval      §Ar5cdi  =%editc(w_ar5cdi:'X')
203020091119     c                   else
203030091119     c                   clear                   §ar5cdi
203040091118     c                   endif
203050140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
203060140407     c* nazione mittente italia
203070140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
203080140407     c                             blpnzm=*blanks
203090140403     c                   eval      §AR5PK2='S'
203100140403     c                   else
203110140403     c                   clear                   §AR5PK2
203120140403     c                   endif
203130031113     c                   Movel(p)  DAr5Gen       Ar5Uni
203140031113     c                   Update    Fiar5000
203150031114    2c                   EndIf
203160110527    1c****               EndIf
203170130918     c* Impostazione campo §ar5mmp - "S"=Invio mail per avviso merce partita
203180130923     c* In conferma bolle dipende da quello che ho ricevuto nel vat
203190130923    1c                   if        *in12 and *in15
203200130918     c                   clear                   wmmp_ar5
203210130923    2c                   if        wemdest <> *blanks  and
203220170428     c                             (wmmp<>'N' or (§ar5alm='S' and
203221170428     c                                            a_§ogntw<>'DPD' and
203222170428     c                                            a_§ogntw<>'EEX' and
203223170428     c                                            a_§ogntw<>'FED' ))
203224170428
203230130918     c                   eval      wmmp_ar5='S'
203240130923    2c                   endif
203250130923   x1c                   else
203260130923     c* In manutenzione bolle se eliminato indirizzo email abblenco campo per
203270130923     c* invio mail per avviso merce partita
203280130923    2c                   if        *in12 and not *in15
203290130923     c                             and wemdest=*blanks
203300130923     c                   clear                   wmmp_ar5
203310130923    2c                   endif
203320130923    1c                   endif
203330140424     c* Pulizia fla invo sms merce partita se manca numero cell.
203340160126     c* oppure se già previsto invio della mail purchè non sia espressamente
203350160126     c* richiesto il doppio invio (mail+sms) come da tab.cli
203360140424     c                   if        wsms=*blanks
203370160126     c                             or (wmmp_ar5='S' and §cliemsms<>'S')
203380140424     c                   clear                   wsmp
203390140424     c                   endif
203391161220     c* Se presenti blocchi per l'avviso di affidamento spedizione
203392161220     c* clearo campi relativi
203393170428     c* lo faccio anche se sono in manutenzione perchè potrebbe essere cambiata
203394170428     c* la lna da non EEX a EEX e in questo caso devo ricontrollare perchè
203395170428     c* l'addebito in questo caso potrebbe essere bloccato
203397170428     c***                if        *in12 and *in15
203398170428     c                   if        *in12
203399161220     c                   if        wsmp<>*blanks
203400161220     c                             or wmmp_ar5<>*blanks
203401161220     c                   clear                   fnlv84ds
203402161220     c                   eval      ILV84LNP=blplnp
203403161220     c                   eval      ILV84LNA=blplna
203404161220     c                   eval      ILV84TFP=blptfp
203405161220     c                   eval      ILV84TFA=blptfa
203406161220     c                   eval      ILV84TSP=blptsp
203407161220     c                   eval      ilv84drf=blpdsp
203408161220     c                   call      'FNLV84R'
203409161220     c                   parm                    fnlv84ds
203410170426     c                   if        olv84esito='1'
203411161220     c                   clear                   wsmp
203413161220     c                   clear                   wmmp_ar5
203415170421     c                   endif
203416161220     c                   endif
203417161220     c                   endif
203418110512      * Indirizzo email destinatario
203419110512      * scrivo o aggiorno il file estensione FIAR500F record "EMD"
203420130315     c                   If        wemdest <> *blanks  or wsms<>*blanks
203430110512     c                   Clear                   DAr5emd
203440110512     c                   Eval      Kar5Trd = 'EMD'
203450110512     c     KFiar5        Chain     Fiar501l
203460110613if  2c                   If        Not %Found(Fiar501l)
203470110512     c                   Move      Dateu         Ar5Dac
203480110512     c                   Movel     W0140         Ar5Orc
203490110512     c                   Movel     wemdest       §Ar5eml
203500130315     c                   movel     wsms          §ar5tel
203510130315     c                   movel     wsmp          §ar5smp
203520130918     c                   movel     wmmp_ar5      §ar5mmp
203530110512     c                   Movel(p)  DAr5emd       Ar5Uni
203540110512     c                   ExSr      Sr_wrtFiar5
203550110613     c                   else
203560110613     c                   movel     ar5uni        DAr5emd
203570110613     c                   Movel     wemdest       §Ar5eml
203580130315     c                   movel     wsms          §ar5tel
203590130315     c                   movel     wsmp          §ar5smp
203600130918     c                   movel     wmmp_ar5      §ar5mmp
203610111012     c                   Movel(p)  DAr5Emd       Ar5Uni
203620110613     c                   Update    Fiar5000
203630110613     c                   endif
203640110512     c                   EndIf
203650040610      * Se non sono inseriti il referente e il n. di telefono e v-valore
203660031114      * e sono in manutenzione cancello il FIAR500F record "GEN"
203670110527if  1c****               If        *In12 and Not *In15 and
203680110527     c*****                        VidRef = *Blanks and VidTel = *Blanks
203690110527     c*****                        and vidbva = *blanks
203700110527     c*****                        and w_ar5ass=*blanks
203710110527     c******                       and w_ar5tcp=*blanks
203720110527     c******                       and w_ar5tic=*blanks
203730110527     c******                       and ar9tic=*blanks
203740110527     c*****                        and w_ar5cdi=0
203750110527     c*****              Eval      Kar5Trd = 'GEN'
203760110527     c**** KFiar5        Chain     Fiar501l
203770110527     c****               If        %Found(Fiar501l)
203780110527     c****               Delete    Fiar5000
203790110527     c****               EndIf
203800110527    1c****               EndIf
203810030805      * se sono in manutenzione bolla e non c'è la particolarità
203820021218      * varie "B" controllo se c'è il record in FIAR500F record "BAN"
203830021218      * se c'è è da cancellare
203840030127     c                   If        *In12 and Not *In15 and
203850030704     c                             %Subst(BlpGva:1:1) <> 'B'
203860030704     c                   Eval      Kar5Trd = 'BAN'
203870021218     c     KFiar5        Chain     Fiar501l
203880021218     c                   If        %Found(Fiar501l)
203890021218     c                   Delete    Fiar5000
203900021218     c                   EndIf
203910021218     c                   EndIf
203920030805      * se sono in manutenzione bolla e non c'è la particolarità
203930030704      * varie "O" controllo se c'è il record in FIAR500F record "BNB"
203940030704      * se c'è è da cancellare
203950030704     c                   If        *In12 and Not *In15 and
203960030704     c                             %Subst(BlpGva:1:1) <> 'O'
203970030704     c                   Eval      Kar5Trd = 'BNB'
203980030704     c     KFiar5        Chain     Fiar501l
203990030704     c                   If        %Found(Fiar501l)
204000030704     c                   Delete    Fiar5000
204010030704     c                   EndIf
204020030704     c                   EndIf
204030030807      * se sono in manutenzione bolla e non c'è la particolarità
204040030807      * consegna "RC" controllo se c'è il record in FIAR500F record "RCC"
204050030807      * se c'è è da cancellare
204060030807     c                   If        *In12 and Not *In15 and
204070100604     c                             §7rRC  <> 'S'
204080100604     c***                          BlpGma <> 'RC'
204090030807     c                   Eval      Kar5Trd = 'RCC'
204100030807     c     KFiar5        Chain     Fiar501l
204110030807     c                   If        %Found(Fiar501l)
204120030807     c                   Delete    Fiar5000
204130030807     c                   EndIf
204140030807     c                   EndIf
204150110512      * In msanutenzine cancello fiar5 rcd EMD se è stato eliminato
204160150213if  1c*                  If        *In12 and Not *In15 and
204170150213     c*                            wemdest = *blanks  and atremd=*blanks
204180150213     c*                            and wsms=*blanks
204190150213     c*                  Eval      Kar5Trd = 'EMD'
204200150213     c*    KFiar5        Chain     Fiar501l
204210150213     c*                  If        %Found(Fiar501l)
204220150213     c*                  Delete    Fiar5000
204230150213     c*                  EndIf
204240150213    1c*                  EndIf
204250061213     c*
204260061213     C                   CLEAR                   WABLT
204270071221     C                   CLEAR                   WAgglna           1
204280071221    0c                   if        *in12 and not *in15
204290071221   0Ac                   if        §1bfg6='C' and savlna<>vidlna and
204300071221     c                             §clidkb='S'
204310071221     c                   eval      wagglna='S'
204320071221  x0Ac                   else
204330071221     C*  12
204340071221    1C*ANN15BLPFNS        IFEQ      ' '
204350071221    1c     blpfns        ifeq      ' '
204360061213     C     BLPNCD        ANDNE     0
204370061213     C     §1BFG8        ANDNE     'N'
204380061213     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
204390061213     C     §1BFG8        OREQ      'N'
204400061213     C**
204410061213     C* VEDO SE CANCELLARE LE SPUNTE ENTRATA:
204420061213     C* 1) SE FG8 = N SEMPRE
204430061213     C* 2) SE MODIFICATA LA LNA SEMPRE
204440061213     C* 3) SE AUMENTATO IL NUMERO DEI COLLI SOLO SE FG6 =D O I
204450061213     C* 4) SE DIMINUITO IL NUMERO DEI COLLI SOLO PER GLI ULTIMI
204460061213     C                   MOVEL     'S'           WDELBR            1
204470061213     C                   MOVEL     'S'           WABLT             1
204480061213    2C                   SELECT
204490061213     C     §1BFG8        WHENEQ    'N'
204500061213     C     SAVLNA        ORNE      VIDLNA
204510061213     C                   Z-ADD     99999         WCONTC            5 0
204520061213     C*
204530061213     C     SAVNCL        WHENLT    VIDNCL
204540061213     C     §1BFG6        ANDEQ     'D'
204550061213     C     SAVNCL        ORLT      VIDNCL
204560061213     C     §1BFG6        ANDEQ     'I'
204570061213     C                   Z-ADD     99999         WCONTC            5 0
204580061213     C*
204590061213     C     SAVNCL        WHENGT    VIDNCL
204600061213     C     §1BFG6        ANDEQ     'D'
204610061213     C     SAVNCL        ORGT      VIDNCL
204620061213     C     §1BFG6        ANDEQ     'I'
204630061213     C                   CLEAR                   WCONTC
204640061213     C     SAVNCD        WHENNE    BLPNCD
204650061213     C     SAVNCA        ORNE      BLPNCA
204660061213     C                   MOVEL     'N'           WDELBR            1
204670061213   X2C                   OTHER
204680061213     C                   MOVEL     'N'           WDELBR            1
204690061213     C                   MOVEL     'N'           WABLT
204700061213    2C                   ENDSL
204710061213    1c                   endif
204720071221   0Ac                   endif
204730071221    0c                   endif
204740061213     c* In manutenzione bolle , se riscrivo  fnblt devo clearare blpncr/ncp
204750061213    1c                   if        *in12 and not *in15
204760061213    2c                   if        wablt='S'
204770061213     c                   clear                   blpncr
204780061213     c                   clear                   blpncp
204790061213     c                   clear                   blpvlc
204800061213     c                   clear                   blppkc
204810061213   x2c                   else
204820061213     c* Se già calcolato volume cml devo reimpostarlo su VLF
204830061213    3c                   if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
204840061213     c                   clear                   dslv20
204850061213     C                   MOVEL     'P'           D20TBO
204860061213     C                   MOVEL     'C'           D20TVL
204870061213     c                   movel     'L'           d20tla
204880061213     C                   MOVEL     BLPvlc        D20vlu
204890061213     C                   MOVEL     BLPncr        D20ncr
204900061213     C                   MOVEL     BLPFVF        D20FVF
204910061213     C                   MOVEL     BLPVLF        D20VLF
204920061213     C                   MOVEL     BLPFVB        D20FVB
204930061213     C                   MOVEL     BLPVLB        D20VLB
204940061213     C                   MOVEL     BLPAAS        D20AAS
204950061213     C                   MOVEL     BLPLNP        D20LNP
204960061213     C                   MOVEL     BLPNRS        D20NRS
204970061213     C                   MOVEL     BLPNSP        D20NSP
204980061213     C                   MOVEL     BLPCBO        D20CBO
204990061213     C                   MOVEL     BLPNCL        D20NCL
205000061213    4C     BLPDBR        IFGT      *ZEROS
205010061213     C                   MOVE      BLPDBR        D20DTE
205020061213     C                   ELSE
205030061213     C                   MOVE      BLPMGS        D20DTE
205040061213     C                   MOVEL     BLPAAS        D20DTE
205050061213    4C                   END
205060061213     C                   MOVEL     DSLV20        KPJBU
205070061213     C*
205080061213     C                   CALL      'FNLV20R'
205090061213     C                   PARM                    KPJBA
205100061213     c                   parm      'N'           pwstor            1
205110061213     C*
205120061213     C                   MOVEL     KPJBU         DSLV20
205130061213     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
205140061213    4C     D20ERR        IFNE      '1'
205150061213     C                   MOVEL     D20FVF        BLPFVF
205160061213     C                   MOVEL     D20VLF        BLPVLF
205170061213E   4C                   ENDIF
205180061213    3c                   endif
205190061213    2c                   endif
205200061213    1c                   endif
205210070403     c*
205220070403     c                   exsr      sr_fiarg
205230070604     c*
205240070529     c* manutenzione di un prepagato ed è stato variato l'importo fattura
205250070529     c* eseguo operazioni per invio dati a PDA
205260070601    1c                   if        *in12 and *in15='0' and *in22
205270080213     c                             and vidimv<>savimvo and s_§ogpdaorm<>*blanks
205280070529     c                             and (ormfao=400 or ormfao=410)
205290070604     c                   exsr      sr_pda
205300070601    1c                   endif
205310111026     c* Richiamo pgm per scrittura R.A. in caso di manutenzione con
205320111026     c* riassegnazione segnacolli
205330111026     c                   if        RA_ncl>0
205340111026     c                   exsr      sr_wrtRA
205350111026     c                   endif
205360040601     c
205370151014     c* Se bolla tassata fino all'imponibile o eliminata precedente tassazione
205380151014     c* scrivo/aggiorno fiar5 record "FAT" in ambiente di sede
205390151014     c                   if        (vidimv>0 and vidimv<>savimv_fat) or
205400151014     c                             (vidimv=0 and war61='E')
205410151117     c                   if        %open(fiar531c)
205420151117     c                   exsr      regpesivol
205430151117     c                   endif
205440151015     c                   endif
205450151023     c* se bolla franco import DPD verifico cod. tariffa da utilizzare
205460151023     c                   if        not *in04 and §ogntw='DPD'
205470151023     c                   clear                   fieulpdds
205480151023     c                   eval      ILPDLNP   =blplnp
205490151023     c                   eval      ILPDLNA   =blplna
205500151023     c                   eval      ILPDPARCEL=§b4ipn
205510151023     c                   eval      ILPDHUBP  =§OGHB1
205520151023     c                   eval      ILPDDEPP  =§OGDP1
205530151023     c                   eval      ILPDHUBA  =a_§OGHB1
205540151023     c                   eval      ILPDDEPA  =a_§OGDP1
205550151023     c                   call      'FIEULPDR'
205560151023     c                   parm                    fieulpdds
205570151023     c                   eval      blpctr=OLPDTAR
205580151023
205590151023     c                   endif
205600950713     C**
205610950713     C* W R I T E   I N   F N B L P 0 0 F
205620950713     C   12
205630950713     CAN 15
205640950713     CORN12              WRITE     FNBLP000
205650950713     C* SE MANUTENZIONE AGGIORNO
205660950713     C   12
205670950713     CANN15              UPDATE    FNBLP000
205680081014     c                   if        *in12 and *in15 and §3cabd_s<>' '
205690081014     c                   clear                   trtc86drds
205700081020     c                   eval      i86mod='UV'
205710081020     c                   z-add     §fgs          i86fgsv
205720081020     c                   z-add     §lpaac        i86aasv
205730081014     c                   z-add     §lplnp        i86lnpv
205740081014     c                   z-add     §lpnrs        i86nrsv
205750081014     c                   z-add     §lpnsp        i86nspv
205760081014     c                   z-add     §lpccm        i86ccmv
205770081014     c                   z-add     §lprmn        i86rmnv
205780081014     c                   move      §lprma        i86rmav
205790081014     c                   z-add     blpaas        i86aasb
205800081014     c                   z-add     blplnp        i86lnpb
205810081014     c                   z-add     blpnrs        i86nrsb
205820081014     c                   z-add     blpnsp        i86nspb
205830081017     c                   if        blpccm>0
205840081014     c                   z-add     blpccm        i86ccmb
205850081017     c                   else
205860081017     c                   z-add     blpksc        i86ccmb
205870081017     c                   endif
205880081014     c                   z-add     blprmn        i86rmnb
205890081014     c                   move      blprma        i86rmab
205900081014     c                   call      'TRTC86DRR'
205910081014     c                   parm                    trtc86drds
205920081014     c                   endif
205930110902     c* Se valore di accorpamento spedizioni in consegna non valido invio
205940110902     c* email a CED
205950110902     c                   if        werrxco=*on
205960110902     c                   exsr      sr_mail
205970110902     c                   endif
205980971215     C**
205990971215     C** VERIFICO SE C'E' ETICHETTA ESTERA DA STAMPARE
206000081008     C**                 CLEAR                   WESTER
206010000204     C* ANCHE PER DPD
206020081008     C**   A_§OGNTW      IFEQ      'DPD'
206030040525     c* se ogsea = "S" significa che l'etichetta estera viene stampata in
206040040525     c* arrivo e quindi lascio wester = blanks
206050081008     c***  A_§ogsea      andne     'S'
206060081008     C***                MOVEL     'S'           WESTER
206070081008     C***                ENDIF
206080001024     C* MANUTENZIONE: SE MODIFICATA DATA SPEDIZIONE AGGIORNO LA DATA
206090001024     C*               ANCHE SU FISGN
206100001024     C   12
206110001024     CANN15BLPDSP        IFNE      WBDSP
206120001024     C     §3CDKC        IFEQ      'S'
206130001024     C     *IN79         ANDEQ     *ON
206140001024     C     §1BF12        ORNE      'N'
206150001106     C     §1BF12        ANDNE     'E'
206160001106     C     §1BF12        OREQ      'E'
206170001106     C     WASDKC        ANDEQ     'S'
206180001024     C     KBLP3         SETLL     FISGN05L
206190001024     C     KBLP3         READE     FISGN05L                               30
206200001024     C     *IN30         DOWEQ     *OFF
206210001024     C                   MOVE      BLPMGS        §LDMGS
206220010326     C                   Z-ADD     BLPTFA        §LDTNA
206230121213     c* Non serve più anzi crea problemi nel caso di fisgn duplicato su altro
206240121213     c* tfp.
206250121213     C***                Z-ADD     BLPTFP        SGNTNP
206260010116     C                   CLEAR                   SGNT6A
206270010116     C                   CLEAR                   SGNT6B
206280010116     C                   CLEAR                   SGNT6C
206290010116     C                   CLEAR                   SGNT6D
206300010116     C                   CLEAR                   SGNT6E
206310010116     C                   CLEAR                   SGNT6F
206320080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
206330001024     C                   UPDATE    FISGN005
206340001024     C     KBLP3         READE     FISGN05L                               30
206350001024     C                   ENDDO
206360001024     C                   ENDIF
206370001024     C                   ENDIF
206380000908     C*
206390000908     C* PER DISK C INSERITO CON DAL AL LO DEVO ESPLODERE
206400001009     C* (TEORICAMENTE DOVREI ESCLUDERE EXPORT DPD SE CHI SONO IMMESSO
206410001009     C* MANUALMENTE O DA RMN IN PRATICA ESCLUDO SEMPRE SE SI TRATTA
206420001009     C* DI EXPORT DPD DAL MOMENTO CHE LE SPEDIZIONI PER DPD SONO
206430001009     C* MONOCOLLO)
206440050224     c* per lo stesso motivo escludo anche le import dpd
206450000913    1C     §1BF12        IFNE      'N'
206460001011     C     WEXDPD        ANDNE     'S'
206470050223     c     *in79         andne     *on
206480000911     C     OZ1NCL        ANDGT     2
206490000908     C* I COD. CHI SONO CHE ESPLODO LI SCRIVO NEL SUBFILE IN AGGIUNTA
206500000908     C* PARTENDO DA NUMERO DI RECORD=NR8
206510000908     C* PRIMA DI CLEARARE LA DS MEMORIZZO IL DAL AL IMPOSTATI NEL
206520000908     C* RICHIAMO FATTO DURANTE I CONTROLLI
206530000911     C     OZ1MAX        IFEQ      '2'
206540000908     C                   MOVEL     IZ1CH1        CHIDAL
206550000908     C                   MOVEL     IZ1CH2        CHIAL
206560000911     C                   ELSE
206570000911     C                   MOVEL     IZ1CH2        CHIDAL
206580000911     C                   MOVEL     IZ1CH1        CHIAL
206590000911     C                   ENDIF
206600000908     C* FACCIO UN CICLO DI RICHIAMI A FNLSZ1R FINO AD ARRIVARE AL
206610000908     C* "CHI SONO" AL
206620000911     C                   MOVE      *ALL' '       WW               35
206630000911     C                   Z-ADD     1             IX
206640000911     C     WW            LOOKUP    CHI(IX)                                30
206650000908    2C     CHIDAL        DOWNE     CHIAL
206660000908     C                   CLEAR                   DSLSZ1
206670000908     C                   MOVEL     'E'           IZ1MOD
206680000908     C                   MOVEL     CHIDAL        IZ1CH1
206690000908     C                   Z-ADD     V8CKSC        IZ1CCM
206700000908     C                   MOVEL     BLPCTM        IZ1CTM
206710000908     C                   Z-ADD     BLPNRS        IZ1NRS
206720000908     C                   CALL      'FNLSZ1R'
206730010402     C                   PARM                    KPJBA
206740000908     C                   PARM                    DSLSZ1
206750000908     C                   PARM                    DS1B
206760000911     C     OZ1CHI        IFNE      CHIAL
206770000908     C                   MOVEL     OZ1CHI        V8CNOT
206780000908     C                   CLEAR                   V8CSCE
206790000908     C                   CLEAR                   V8HDKC
206800000908     C                   CLEAR                   V8HESG
206810000915     C                   CLEAR                   V8HST2
206820000915     C                   CLEAR                   V8HFLS
206830000915     C                   CLEAR                   V8HLNA
206840000915     C                   CLEAR                   V8HNRS
206850000915     C                   CLEAR                   V8HNSC
206860000921     C                   CLEAR                   V8HPRE
206870000911     C                   ADD       1             NR8
206880000911     C                   MOVEL     OZ1CHI        CHI(IX)
206890000911     C                   Z-ADD     NR8           POS(IX)
206900000918     C                   ADD       1             IX
206910000908     C                   WRITE     LS01S08
206920000911     C                   ENDIF
206930000908     C                   MOVEL     OZ1CHI        CHIDAL
206940000908    2C                   ENDDO
206950000908    1C                   ENDIF
206960070322     c* se sono in immissione/conferma bolla di sped export dpd
206970070322     c* con numero parcel lungo 12 carico vidnrd nel subfile
206980070322     c                   if        (*in12='0' or *in15='1') and
206990070322     c                             wexdpd='S' and wparcel='12'
207000070322     c                             and §1bf13<>'A'
207010070326     C* PULIZIA SFL
207020070326     C                   SETON                                        35
207030070326     C                   WRITE     LS01C08
207040070326     C                   SETOFF                                       357833
207050070326     c*
207060070322     c                   z-add     0             nr8
207070070322     C                   MOVEL     vidnrd        V8CNOT
207080070322     C                   MOVEL     *BLANKS       V8CSCE
207090070322     C                   MOVE      *BLANKS       V8HDKC
207100070322     C                   MOVE      *BLANKS       V8HESG
207110070322     C                   MOVE      *ZEROS        V8HST2
207120070322     C                   clear                   V8HFLS
207130070322     C                   clear                   V8HLNA
207140070322     C                   clear                   V8HNRS
207150070322     C                   clear                   V8HNSC
207160070322     C* SCRIVO SUBFILE
207170070322     C                   ADD       1             NR8
207180070322     C                   WRITE     LS01S08
207190070322     c                   endif
207200000204     C**
207210000204     C** PER SI DISK "C" --> CHAIN   F I S G N 0 0 F
207220000204    1C     §3CDKC        IFEQ      'S'
207230070323     c     *IN79         ANDEQ     *ON
207240000907     C     §1BF12        ORNE      'N'
207250001106     C     §1BF12        ANDNE     'E'
207260001106     C     §1BF12        OREQ      'E'
207270001106     C     WASDKC        ANDEQ     'S'
207280000204     C                   CLEAR                   WESSGN
207290000929     C                   CLEAR                   WSGNR
207300000208     C                   CLEAR                   FISGN000
207310000919     C                   MOVEL     'S'           WDKC              1
207320000204     C                   SELECT
207330000204     C* IMPORT DPD --> RIF.MITTENTE
207340060622     C     *IN79         WHENEQ    *ON
207350050301     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
207360050301     C                   CLEAR                   V8HCOL
207370060619    4C     savnpr        IFNE      v7cnpr
207380060623     c     savnpr        andne     *blanks
207390060622     C****               move      savnpr        W0120            12 0
207400060622     C****               MOVEL(P)  W0120         KWHO
207410060622     C     Kblp3         setll     FISGN05L
207420060622    5C                   do        *hival
207430060622     C     Kblp3         reade     FISGN05L
207440060622     c                   if        %eof(fisgn05l)
207450060622     c                   leave
207460060622     c                   endif
207470050301     C                   EXSR      ANNSGN
207480060622    5C                   ENDdo
207490050301     C                   ELSE
207500050301     C                   MOVE      *HIVAL        V8HCOL
207510050301    4C                   ENDIF
207520060621     c* Il chi sono per chainare fisgn lo compongo come segue:
207530060621     c* 1) se ho il barcode id -> barcodeId+CapDest+n.parcel+serv.code+iso N
207540060621     c* 2) se non ho il barcode id --> numero parcel lungo 11+1
207550060622    4c                   if        §b4ibi<>*blanks
207560060623     c* se sono in conferma bolle o in immissione o in manutenzione di
207570060623     c* bolla immessa a mano (no disk)
207580060623     c* compongo il chi sono con i dati che ho
207590060623    5c                   if        *in12='0' or *in15='1'
207600060623     c                             or  *in13='0'
207610090511    6c                   if        *in15='1'
207620090511    7c                   if        §lpcad<>*blanks
207630060622     c                   eval      §lpcad_w=§lpcad
207640090511   x7c                   else
207650060622     c                   eval      §lpcad_w=blpcad
207660090511    7c                   endif
207670090514     c                   else
207680090514     c                   eval      §lpcad_w=blpcad
207690090511    6c                   endif
207700060621     c                   clear                   outcapdpd
207710060621     c                   call      'XCAPDPD'
207720060622     c                   parm                    §lpcad_w
207730060621     c                   parm                    outcapdpd         7
207740060621     c                   eval      kwho=§b4ibi+outcapdpd
207750060621     c* se parcel lungo 12 lo trucco con 0 e 99
207760060622    6c                   if        %subst(§b4ipn:14:1)=*blanks
207770060621     c                   eval      kwho=%trim(kwho)+'0'
207780060621     c                             +%subst(§b4ipn:1:3)
207790060621     c                             +'99' + %subst(§b4ipn:4:8)
207800060622   x6c                   else
207810060621     c                   eval      kwho=%trim(kwho)+§b4ipn
207820060622    6c                   endif
207830060621     C                   MOVEL     '15'          COD
207840060621     C                   MOVEL(P)  BLPNZD        KEY
207850060621     C                   EXSR      CTABEL
207860060621     C   30              CLEAR                   DS15
207870060621     C  N30              MOVEL     TBLUNI        DS15
207880060621     c                   movel     §15cie        §15ciea           3
207890060621     c                   eval      kwho=%trim(kwho)+§b4isc+§15ciea
207900060622   x5c                   else
207910060623     c* altrimenti se sono in manutenzione di bolla ricevuta da cliente
207920060623     c* (DISK A) il chi sono lo reperisco chainando fisgn per key
207930060623     c* spedizione
207940060622     c     kblp3         chain(N)  fisgn05l
207950060622     c                   eval      kwho=sgnwho
207960060622    5c                   endif
207970060622   x4c                   else
207980060710     C                   clear                   kwho
207990060710     C                   movel     §b4ipn        kwho
208000060621     C                   eval      %subst(kwho:12:1)=§b4icd
208010060622    4c                   endif
208020000908     C                   EXSR      CTRSGN
208030050221     C* EXPORT DPD --> da vat O DIGITATO, DA CTM
208040001011    2C     WEXDPD        WHENEQ    'S'
208050140714     C     §1BF13        ANDNE     'A'
208060160225     c     w_aDpd        andne     'S'
208070070322     c     wparcel       andne     '12'
208080140715     c     §1bf12        andne     'B'
208090000204     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
208100001009     C                   CLEAR                   V8HCOL
208110001009    4C     SAVNPR        IFNE      V7CNPR
208120001009     C                   MOVEL(P)  SAVNPR        KWHO
208130010116     C     KSGN          CHAIN     FISGN01L                           30
208140001009    5C     *IN30         IFEQ      *OFF
208150001009     C                   EXSR      ANNSGN
208160001009    5C                   ENDIF
208170001009     C                   ELSE
208180001009     C                   MOVE      *HIVAL        V8HCOL
208190001009    4C                   ENDIF
208200000209     C*
208210001009     C                   MOVEL(P)  V7CNPR        KWHO
208220001009     C                   EXSR      CTRSGN
208230000915     C* DISK C NO DPD: RICHIAMO CTRSGN PER OGNI RECORD DEL SUBFILE
208240001002     C     §1BF12        WHENNE    'N'
208250000908     C                   Z-ADD     1             NR8
208260000908     C                   MOVE      *BLANKS       SAVDKC            1
208270000915     C                   MOVE      *ZEROS        JJ                3 0
208280000908     C     NR8           CHAIN     LS01S08                            30
208290000908    3C     *IN30         DOWEQ     *OFF
208300000908     C* Escludo record annullati
208310000908    4C     V8CSCE        IFEQ      *BLANKS
208320000908     C                   MOVEL(P)  V8CNOT        KWHO
208330000908     C                   CLEAR                   WESSGN
208340000908     C* Controllo file fisgn
208350000908     C                   EXSR      CTRSGN
208360000908     C                   MOVE      WDKC          V8HDKC
208370000919    5C     WESSGN        IFEQ      'S'
208380000908     C                   MOVEL     'S'           V8HESG
208390000915     C                   Z-ADD     SGNST2        V8HST2
208400000919   X5C                   ELSE
208410000920     C                   CLEAR                   V8HESG
208420000915     C                   CLEAR                   V8HST2
208430000919    5C                   ENDIF
208440000908     C                   UPDATE    LS01S08
208450000920     C* Tratto la spedizione come diskC (scrittura di fisgn) se almeno
208460000920     C* un collo lo tratto come DISK C
208470000919    5C     WDKC          IFEQ      'S'
208480000908     C                   MOVE      WDKC          SAVDKC
208490000919    5C                   ENDIF
208500000908     C                   MOVEL     'S'           WDKC
208510000919   X4C                   ELSE
208520051102     C* MEMORIZZO IN SCHIERA ANNULLATI SE LEGATO A ARS
208530000920    5C     V8HCOL        IFGT      *ZEROS
208540000915     C                   ADD       1             JJ
208550000915     C                   Z-ADD     V8HCOL        ANN(JJ)
208560000919     C* SE RECORD ANNULLATO ANNULLO FISGN
208570010116     C     KSGN8         CHAIN     FISGN01L                           30
208580000920    6C     *IN30         IFEQ      *OFF
208590000921     C* Se annullato con A non lo potrò più riattivare perchè ormai i
208600000921     C* dati memorizzati su fisgn non sono più aggiornati correttamente
208610000921     c* Se annullato con A e progressivo = 0 significa che non ci sono
208620000921     c* più bolle manutenzionabili con questo cod. chi sono e quindi
208630000921     c* annullo con *
208640000921     C                   EXSR      ANNSGN
208650000920    6C                   ENDIF
208660000920    5C                   ENDIF
208670000920    4C                   ENDIF
208680000911     C                   ADD       1             NR8
208690000908     C     NR8           CHAIN     LS01S08                            30
208700000908    3C                   ENDDO
208710000908     C     SAVDKC        IFEQ      'S'
208720000908     C                   MOVE      'S'           WDKC
208730000908     C                   ENDIF
208740000204     C                   OTHER
208750000204     C                   MOVEL     'N'           WDKC
208760000204    2C                   ENDSL
208770000204     C*
208780000929   X1C                   ELSE
208790010515     C* 15/05/01: FISGN NON DEVE PIU' ESSERE SCRITTO PER LA RISTAMPA
208800001106     C                   MOVEL     'N'           WDKC
208810000204    1C                   ENDIF
208820980409     C*
208830980409     C* ABBLENCO CAMPO DI COMODO USATO IN ROUTINE CRTBLD PER SAPERE
208840980409     C* SE RISTAMAPRE O MENO L'ETICHETTA SEGNACOLLO
208850980409     C* (WPRT = ' '--> SI RISTAMPA; WPRT= 'N' --> NO RISTAMPA)
208860980409     C                   MOVE      *BLANKS       WPRT              1
208870950713     C**
208880940914     C* F N V A D 0 0 F : DETTAGLIO SEGNACOLLI
208890910807     C** DISK CLI:  CONTROLLO SE SE SONO RECORD NON SEQUENZIALI
208900000919     C   12
208910000919     CAN 15§1BFG7        IFEQ      'S'
208920980410     C     §1BFG6        ANDEQ     'C'
208930980219     C                   SETOFF                                       3130
208940020917     C     KBLC          SETLL     FIVAD000
208950020917     C     KBLC          READE     FIVAD000                               30
208960001002     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
208970001002     C  N30WSGNR         IFEQ      'S'
208980081008     C***  WESTER        IFEQ      'S'
208990081008     C***                MOVEL     'ALL'         §DETST
209000081008     C***                ELSE
209010001106     C                   MOVEL     'ITA'         §DETST
209020040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
209030040506     c* etichetta Italia con dati esteri
209040040506     C     A_§ogntw      IFEQ      'EEX'
209050040506     C                   MOVEL     'EEX'         §DETSE
209060040506     c                   else
209070040506     c                   clear                   §detse
209080040506     C                   ENDIF
209090081008     C***                ENDIF
209100001005     C                   CLEAR                   WSTSEG
209110001002     C                   EXSR      RIESEG
209120001002     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
209130001002     C                   CLEAR                   DSBLD7
209140150202     C                   MOVE      BLPfls        §LCLNP
209150001002     C                   MOVE      BLPLNA        §LCLNA
209160001002     C                   MOVE      BLPNRS        §LCNRS
209170001002     C                   MOVE      BLPZNC        §LCZSC
209180001002     C                   MOVE      DSBLD         WWBLD
209190001002     C                   MOVE      DSBLDE        WWBLDE
209200001002     C                   ENDIF
209210930930     C*
209220930930     C* SE NON SEQUENZIALI MEMORIZZO IL PRIMO SEGNACOLLO
209230971215    2C  N30BLPFNS        IFEQ      'S'
209240941230     C                   MOVEL     BLDNCD        VIDNCD
209250951019     C                   Z-ADD     1             BLDNC1
209260971215    2C                   ENDIF
209270910802     C*
209280971215    2C     *IN30         DOWEQ     '0'
209290001002     C*
209300001002     C     WSGNR         IFEQ      'S'
209310001002     C                   MOVE      WWBLD         DSBLD
209320001002     C                   MOVE      WWBLDE        DSBLDE
209330001002     C                   ENDIF
209340001002     C*
209350980403     C                   MOVEL     BLDNCD        SV1NCD
209360980319     C*
209370980319    3C     BLDNCA        IFEQ      0
209380980319     C                   Z-ADD     BLDNCD        BLDNCA
209390980319    3C                   ENDIF
209400000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
209410051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
209420000915     C     §1BF12        IFNE      'N'
209430000915     C                   Z-ADD     1             NR8
209440000915     C                   ENDIF
209450000929     C*
209460000929     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
209470000929     C     WSGNR         IFEQ      'S'
209480000929     C                   MOVE      BLDCDP        §LDCDP
209490000929     C                   ENDIF
209500980319     C*
209510980319    3C     BLDNCD        DOWLE     BLDNCA
209520990318     C     BLDNCD        ANDGT     0
209530980319     C*
209540980319     C                   MOVEL     BLDNCD        WNSC
209550000929     C                   EXSR      CRTBLT
209560001003     C* No disk c: scrittura fisgn in ristampa
209570010404     C* N.B.: Scrittura fisgn per ristampa --> REGOLA: viene effettua
209580010404     C*       ta al momento della creazione del dettaglio colli (CRTBLT
209590010404     c*       ). Non viene fatta nell routine stasci o stascd come per
209600010404     c*       la scrittura di fisgn per §1bf12<>"N" o per import dpd
209610010404     c*       in quanto queste routine non vengono sempre richiamate
209620010404     c*       (per esempio in conferma bolle da disk quando fg6='S')
209630020917     c*       ECCEZIONE: Se cliente con fivad e fg6="D" l'fisgn viene
209640010404     C*       creato dentro stascd per non perdere il codice prodotto
209650010404     c*       Idem se sono in manutenzione
209660001002     C     WSGNR         IFEQ      'S'
209670000929     C                   ADD       1             §LDNC1
209680001002     C                   Z-ADD     WNSC          §LDNCD
209690001002     C                   Z-ADD     WNSC          §LCNCD
209700001002     C                   EXSR      M10
209710001002     C                   MOVEA     §CA           V8CNOT
209720010404     C                   EXSR      EUREXP
209730010306     C                   MOVEL     DSBLD         WSBLD
209740010306     C                   MOVEL     DSBLDE        WSBLDE
209750010306     C     KSGN8         CHAIN     FISGN01L                           30
209760010306     C                   MOVEL     WSBLD         DSBLD
209770010306     C                   MOVEL     WSBLDE        DSBLDE
209780010306     C   30              EXSR      WRTSGN
209790010306     C  N30              EXSR      UPDSGN
209800001002     C                   ENDIF
209810980319     C*
209820980319     C                   ADD       1             BLDNCD
209830980319    3C                   ENDDO
209840001002     C*
209850001002     C                   MOVE      DSBLD         WWBLD
209860001002     C                   MOVE      DSBLDE        WWBLDE
209870980319     C*
209880980403     C* REIMPOSTO NUMERO SEGNACOLLO CHE SI E' SPORCATO NEL CICLO
209890980403     C* DI CREAZIONE DEL BLT
209900980403     C                   Z-ADD     SV1NCD        BLDNCD
209910980403    3C     BLDNCA        IFEQ      BLDNCD
209920980319     C                   MOVE      *ZEROS        BLDNCA
209930980319    3C                   ENDIF
209940951019     C* CREO FNBLD PER SEGNACOLLI NON SEQUENZIALI
209950971215    3C     BLPFNS        IFEQ      'S'
209960971215     C**
209970971215    4C     §1BFG9        IFEQ      'S'
209980971217     C*
209990081008     C**   §1BFG0        OREQ      'D'
210000081008     C**   §1BFG6        ANDEQ     'C'
210010081008     C**   WESTER        ANDEQ     'S'
210020971217     C*
210030081008     C**   §1BF11        OREQ      'D'
210040081008     C**   §1BFG0        ANDEQ     'C'
210050081008     C**   WESTER        ANDEQ     'S'
210060951019     C                   Z-ADD     BLDNCD        COMSCD
210070951019     C                   Z-ADD     BLDNCL        VARNCL
210080971224     C                   MOVEL     BLDCDP        VARCDP
210090951019     C                   EXSR      ROTCDP
210100971215    4C                   ENDIF
210110971215     C**
210120971215     C** STAMPA LA SOLA ETICHETTA DELL'ESTERO IN IMMEDIATO
210130120302     C**  PER SDI SEMPRE, PER BRT SOLO SE IN IMMEDIATO
210140081008    4C**   WESTER        IFEQ      'S'
210150081008     C**   §1BFG9        ANDNE     'S'
210160971217     C*
210170081008    5C**   §1BFG0        IFEQ      'I'
210180081008     C**   §1BFG6        ANDEQ     'C'
210190971217     C*
210200081008     C**   §1BF11        OREQ      'I'
210210081008     C**   §1BFG0        ANDEQ     'C'
210220081008     C**                 MOVEL     'EST'         §DETST
210230971215     C**
210240971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
210250081008     C**                 Z-ADD     BLDNCD        CO2SCD
210260081008    6C**   BLDNCA        IFEQ      0
210270081008     C**                 Z-ADD     BLDNCD        STANCA
210280081008     C**                 ELSE
210290081008     C**                 Z-ADD     BLDNCA        STANCA
210300081008    6C**                 END
210310971215     C**
210320081008     C**                 EXSR      STASCI
210330081008    5C**                 ENDIF
210340081008    4C**                 ENDIF
210350971215    3C                   ENDIF
210360951019     C*
210370910802     C* CANCELLO FLBLD
210380020917     C                   DELETE    FIVAD000
210390910802     C* RILEGGO
210400020917     C     KBLC          READE     FIVAD000                               30
210410971215    2C                   ENDDO
210420971215    1C                   ENDIF
210430910802     C*
210440921006     C* CREO FLBLT SEQUENZIALE PER:
210450921006     C*         DISK CLI CON SEGNAC SEQUENZIALI
210460921006     C*         MANUTENZIONE BOLLE SE SEQUENZIALI
210470921006     C*         IMMISSIONE BOLLE
210480921016     C                   SETOFF                                       30
210490960404     C   12
210500960404    1CAN 15§3ABCM        IFEQ      ' '
210510941221     C* SE IL CTM PREVEDE SEGNACOLLI --> LI CREO
210520941221     C     §1BFG8        ANDEQ     'S'
210530960404    2C     §1BFG7        IFNE      'S'
210540980410     C     §1BFG6        ORNE      'C'
210550921006     C                   SETON                                            30
210560960404    2C                   END
210570960404    1C                   END
210580921006     C*
210590071221     c                   if        *in12 and not *in15
210600071221     c                   if        wagglna='S'
210610071221     c     kblp3         setll     fnblt01l
210620071221     c     kblp3         reade     fnblt01l
210630071221     c                   dow       not %eof(fnblt01l)
210640071221     c                   eval      bltlna=blplna
210650071221     c                   if        wsbord='S' and bltdfv=0
210660071221     c                   clear                   bltnfv
210670071221     c                   endif
210680071221     c                   update    fnblt000
210690071221     c     kblp3         reade     fnblt01l
210700071221     c                   enddo
210710120814     c* Ripeto lo stesso aggiornamento anche per fiart
210720120814     c     kblp3         setll     fiart01l
210730120814     c     kblp3         reade     fiart01l
210740120814     c                   dow       not %eof(fiart01l)
210750120814     c                   eval      artlna=blplna
210760120814     c                   if        wsbord='S' and bltdfv=0
210770120814     c                   clear                   artnfv
210780120814     c                   endif
210790120814     c                   update    fiart000
210800120814     c     kblp3         reade     fiart01l
210810120814     c                   enddo
210820071221     c                   else
210830071221     C** 12
210840071221    1C**ANN15BLPFNS        IFEQ      ' '
210850071221     c     blpfns        ifeq      ' '
210860921016     C     BLPNCD        ANDNE     0
210870921019     C     §1BFG8        ANDNE     'N'
210880950504     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
210890950504     C     §1BFG8        OREQ      'N'
210900960404     C*
210910980407   2AC     WABLT         IFEQ      'S'
210920960404     C                   MOVEL     5             KNPG
210930960404     C                   MOVEL     SIMFEL        KFLE
210940980320     C*
210950980320     C                   MOVE      *BLANKS       WCRT
210960960404     C*
210970940915     C     KBLP3         SETLL     FNBLT000
210980960404    2C     *IN30         DOWEQ     *OFF
210990051124     C     KBLP3         READE     FNBLT000                               30
211000960404     C*
211010980407    4C  N30WCONTC        IFNE      99999
211020960404     C                   ADD       1             WCONTC
211030960404    4C                   ENDIF
211040960404     C* CANCELLO LE SPUNTE ENTRATA SOLO SE C'E' 'S' E SE WCONTC
211050960404     C*  > DEL NUMERO DEI COLLI
211060980407    3C  N30WDELBR        IFEQ      'S'
211070980407     C     WCONTC        ANDGT     BLPNCL
211080070123     C     KBRV          CHAIN     FNBRV000                           31
211090960404    4C     *IN31         DOWEQ     *OFF
211100051124     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
211110051124     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
211120051124     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
211130051124     c* no anomalie da cancellare create a fronte della spunta entrata
211140051124     c**                 z-add     brvnfv        wrvnfv
211150051124     c**                 movel     param2        kpjbu
211160051124     C**                 CALL      'FNLSA8R'
211170051124     C**                 PARM                    KPJBA
211180070123     C                   DELETE    FNBRV000
211190070123     C     KBRV          READE     FNBRV000                               31
211200960404    4C                   ENDDO
211210040415     c*
211220040415    3C                   ENDIF
211230040415     c*
211240040415     c* cancello dalle spunte entrata il peso e volume se c'e' S e
211250040415     c*  se WCONT <= del numero dei colli
211260040415    3C  N30WDELBR        IFEQ      'S'
211270040415     C     WCONTC        ANDle     BLPNCL
211280070123     C     KBRV          CHAIN     FNBRV000                           31
211290040415    4C     *IN31         DOWEQ     *OFF
211300040415     c                   clear                   brvvuc
211310040415     c                   clear                   brvpuc
211320070123     C                   update    FNBRV000
211330070123     C     KBRV          READE     FNBRV000                               31
211340040415    4C                   ENDDO
211350960404     C*
211360960404    3C                   ENDIF
211370960404     C*
211380000915    3C     *IN30         IFEQ      *OFF
211390980320     C                   MOVE      'S'           WCRT              1
211400051124     C  N30              DELETE    FNBLT000
211410120814     c     kfiart        delete    fiart000                           31
211420980323     C                   MOVEL     'E'           WTRC
211430051102     C     KARS1         CHAIN     FIARS01L                           31
211440051102     C  N31              DELETE    FIARS000
211450020212     C                   MOVEL     'F'           WTRC
211460051102     C     KARS1         CHAIN     FIARS01L                           31
211470020212     c     *in31         ifeq      *off
211480020212     c* Se ho diminuito il numero dei colli oppure ho variato la linea di
211490020212     c* arrivo non devo riassegnare i numeri awb per il segnacollo fedex
211500051102     c* quindi memorizzo il primo numero awb prima di cancellare il ARS
211510020212     c* 'erchè mi servirà per ricrearlo
211520020212     c     wawbini       ifeq      *zeros
211530051102     c                   movel     ARSnot        wawbini
211540020212     c                   z-add     wawbini       wawb
211550020212     c                   endif
211560051102     C                   DELETE    FIARS000
211570020212     c                   endif
211580000915     C                   MOVEL     'C'           WTRC
211590051102     C     KARS1         CHAIN     FIARS01L                           31
211600000920    4C     *IN31         IFEQ      *OFF
211610000921     C* SE HO ELIMINATO SEGNACOLLI DOVREI ANNULLARE EVENTUALE FISGN
211620001003     C* MA NON LO FACCIO PERCHE' QUESTO CASO NON DOVREBBE MAI VERIFI-
211630000921     C* CARSI DAL MOMENTO CHE IN MANUTENZIONE BOLLE NON E' POSSIBILE
211640000921     C* CAMBIARE IL CODICE TRATTAMENTO MERCE
211650051102     C                   DELETE    FIARS000
211660000920    4C                   ENDIF
211670980320    3C                   ENDIF
211680960404    2C                   ENDDO
211690980320     C* SE HO CANCELLATO IL DETTAGLIO COLLI LO RICREO
211700980320     C     §1BFG8        IFEQ      'S'
211710980320     C     WCRT          ANDEQ     'S'
211720980320     C                   Z-ADD     BLPNCD        CO2SCD
211730980320     C     BLPNCA        IFEQ      0
211740980320     C                   Z-ADD     BLPNCD        BLPNCA
211750980320     C                   END
211760000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
211770051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
211780000915     C     §1BF12        IFNE      'N'
211790000915     C                   Z-ADD     1             NR8
211800000915     C                   ENDIF
211810980320     C*
211820980320     C     CO2SCD        DOWLE     BLPNCA
211830000915     C     CO2SCD        ANDGT     0
211840980320     C                   Z-ADD     CO2SCD        WNSC
211850980320     C                   EXSR      CRTBLT
211860980320     C                   ADD       1             CO2SCD
211870980320     C                   END
211880980320     C                   END
211890980408  X2AC                   ELSE
211900980408     C* SE HO SBORDERIZZATO LA BOLLA ELIMINO BLTNFV SU DETT. COLLI
211910980408    2C     WSBORD        IFEQ      'S'
211920980409     C                   EXSR      SBORD
211930980408    2C                   ENDIF
211940980320   2AC                   ENDIF
211950950713     C*
211960960404   X1C                   ELSE
211970950713     C* SE SEGNACOLLI NON SEQUENZIALI E HO SBORDERIZZATO IN AUTOMATICO
211980950713     C*  LA BOLLA --> ELIMINO BLTNFV SU DETT COLLI
211990960404    2C     BLPFNS        IFEQ      'S'
212000950713     C     WSBORD        ANDEQ     'S'
212010980409     C                   EXSR      SBORD
212020960404    2C                   ENDIF
212030950713     C*
212040960404    1C                   ENDIF
212050071221    1C                   endif
212060071221    1C                   endif
212070000915     C* SE SONO IN MANUTENZIONE E NON SONO AUMENTATI O DIMINUITI I
212080051102     C* COLLI E NON E' VARIATA LA LNA DEVO AGGIORNARE ARS PER
212090000915     C* EVENTUALI ANNULLAMENTI E AGGIUNTE SU SUBFILE COD CHI SONO
212100000915     C                   MOVEL     *BLANKS       WUPDSG            1
212110001009    1C     *IN12         IFEQ      *ON
212120001009     C     *IN15         ANDEQ     *OFF
212130001009     C     WABLT         ANDNE     'S'
212140071221     C     WAgglna       ANDNE     'S'
212150001009    2C                   SELECT
212160050228     c* IMPORT DPD                                                     cel
212170050228     c     *in79         wheneq    *on
212180050228     c     §1bf12        andne     'N'
212190060619     c     savnpr        andne     v7cnpr
212200050228     C                   MOVEL     'C'           WTRC
212210051102     C     KARS1P        CHAIN     FIARS01L                           31
212220060622     C**N31              move      v7cnpr        w0120
212230060622     C**N31              movel     w0120         ARSNOT
212240060622     c  n31              movel     v7cnpr        arsnot
212250051114     C  N31              movel     dateu         ARSduv
212260051102     C  N31              UPDATE    FIARS000
212270050228     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
212280050228     C  N31              MOVEL     'S'           WUPDSG
212290001009     C* EXPORT DPD
212300001009     C     §1BF12        WHENNE    'N'
212310001011     C     WEXDPD        ANDEQ     'S'
212320160225     c     w_aDpd        andne     'S'
212330140714     C     §1BF13        ANDNE     'A'
212340140715     c     §1bf12        andne     'B'
212350070323     c     wparcel       andne     '12'
212360001009     C     SAVNPR        ANDNE     V7CNPR
212370001009     C                   MOVEL     'C'           WTRC
212380051102     C     KARS1P        CHAIN     FIARS01L                           31
212390051102     C  N31              MOVEL     V7CNPR        ARSNOT
212400051114     C  N31              MOVEL     dateu         ARSduv
212410051102     C  N31              UPDATE    FIARS000
212420001009     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
212430001009     C  N31              MOVEL     'S'           WUPDSG
212440001009     C     §1BF12        WHENNE    'N'
212450050224     c     *in79         andeq     *off
212460000915     C     ANN(1)        ANDGT     *ZEROS
212470000915     C                   Z-ADD     1             NR8
212480000915     C                   Z-ADD     1             JJ
212490000915     C     NR8           CHAIN     LS01S08                            31
212500001009   2AC     *IN31         DOWEQ     *OFF
212510001003    3C     V8HCOL        IFEQ      *ZEROS
212520000915     C     V8CSCE        ANDEQ     *BLANKS
212530000915     C                   MOVE      ANN(JJ)       KANNUL
212540000915     C                   MOVEL     'C'           WTRC
212550051102     C     KARS1K        CHAIN     FIARS01L                           31
212560051102     C  N31              MOVEL     V8CNOT        ARSNOT
212570051114     C  N31              MOVEL     dateu         ARSduv
212580051102     C  N31              UPDATE    FIARS000
212590000915     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
212600000915     C  N31              MOVEL     'S'           WUPDSG
212610020212    4C     §ogntw        IFEQ      'EEX'
212620000915     C                   MOVEL     'E'           WTRC
212630051102     C     KARS1K        CHAIN     FIARS01L                           31
212640051102     C  N31              MOVEL     V8CNOT        ARSNOT
212650051114     C  N31              MOVEL     dateu         ARSduv
212660051102     C  N31              UPDATE    FIARS000
212670001003    4C                   ENDIF
212680000915     C                   ADD       1             JJ
212690001003    3C                   ENDIF
212700000915     C                   ADD       1             NR8
212710000915     C     NR8           CHAIN     LS01S08                            31
212720001009   2AC                   ENDDO
212730070323     C     §1BF12        WHENNE    'N'
212740070323     C     WEXDPD        ANDEQ     'S'
212750070323     c     v7cnpr        andne     savnpr
212760070323     C                   MOVEL     'S'           WUPDSG
212770001009    2C                   ENDSL
212780001009    1C                   ENDIF
212790921006     C*
212800921006     C  N12BLPNCD        IFGT      0
212810921006     C                   SETON                                        30
212820921006     C                   END
212830921006     C* CREO FLBLT
212840980320     C   12
212850980320     CAN 15
212860980320     CAN 30
212870980320     CORN12
212880980320     CAN 30              DO
212890910827     C                   Z-ADD     BLPNCD        CO2SCD
212900910826     C     BLPNCA        IFEQ      0
212910910826     C                   Z-ADD     BLPNCD        BLPNCA
212920910826     C                   END
212930000908     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
212940051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
212950000908     C     §1BF12        IFNE      'N'
212960000908     C                   Z-ADD     1             NR8
212970000908     C                   ENDIF
212980001003     C*
212990001003     C     WSGNR         IFEQ      'S'
213000001005     C     §1BFG6        ANDNE     'M'
213010001003     C     §1BFG6        IFNE      'D'
213020001003     C     §1BFG7        ORNE      'S'
213030081008     C**   WESTER        IFEQ      'S'
213040081008     C**                 MOVEL     'ALL'         §DETST
213050081008     C**                 ELSE
213060001003     C                   MOVEL     'ITA'         §DETST
213070040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
213080040506     c* etichetta Italia con dati esteri
213090040506     C     A_§ogntw      IFEQ      'EEX'
213100040506     C                   MOVEL     'EEX'         §DETSE
213110040506     c                   else
213120040506     c                   clear                   §detse
213130040506     C                   ENDIF
213140081008     C***                ENDIF
213150001005     C                   CLEAR                   WSTSEG
213160001003     C                   EXSR      RIESEG
213170001003     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
213180001003     C                   CLEAR                   DSBLD7
213190150202     C                   MOVE      BLPfls        §LCLNP
213200001003     C                   MOVE      BLPLNA        §LCLNA
213210001003     C                   MOVE      BLPNRS        §LCNRS
213220001003     C                   MOVE      BLPZNC        §LCZSC
213230001003     C                   ENDIF
213240001003     C                   ENDIF
213250000908     C*
213260910827     C     CO2SCD        DOWLE     BLPNCA
213270990318     C     CO2SCD        ANDGT     0
213280940926     C                   Z-ADD     CO2SCD        WNSC
213290910802     C                   EXSR      CRTBLT
213300001003     C* No disk c: scrittura fisgn in ristampa
213310001003     C* Se la stampa segnacolli è in differita e il cliente mi passa
213320020917     C* fivad non creo qui fisgn ma lo creo quando scrivo fnbld perchè
213330001003     C* in questo caso devo memorizzare su fisgn anche il codice prodot
213340001003     C     WSGNR         IFEQ      'S'
213350001005     C     §1BFG6        ANDNE     'M'
213360001003     C     §1BFG6        IFNE      'D'
213370001003     C     §1BFG7        ORNE      'S'
213380001003     C                   ADD       1             §LDNC1
213390001003     C                   Z-ADD     WNSC          §LDNCD
213400001003     C                   Z-ADD     WNSC          §LCNCD
213410001003     C                   EXSR      M10
213420001003     C                   MOVEA     §CA           V8CNOT
213430010404     C                   EXSR      EUREXP
213440010306     C                   MOVEL     DSBLD         WSBLD
213450010306     C                   MOVEL     DSBLDE        WSBLDE
213460010306     C     KSGN8         CHAIN     FISGN01L                           30
213470010306     C                   MOVEL     WSBLD         DSBLD
213480010306     C                   MOVEL     WSBLDE        DSBLDE
213490010306     C  N30              EXSR      UPDSGN
213500010306     C   30              EXSR      WRTSGN
213510001003     C                   ENDIF
213520001003     C                   ENDIF
213530910827     C                   ADD       1             CO2SCD
213540910805     C                   END
213550910802     C                   END
213560910802     C*
213570910826     C     BLPNCA        IFEQ      BLPNCD
213580910826     C                   Z-ADD     0             BLPNCA
213590910826     C                   END
213600950504     C* PER ELIMINAZIONE DEI SEGNACOLLI, CANCELLO ANCHE FNBLD
213610950504     C   12
213620950504     CANN15§1BFG8        IFEQ      'N'
213630950504     C     KBLP3         SETLL     FNBLD000                               30
213640950504     C     *IN30         IFEQ      *ON
213650950504     C*
213660950504     C     KBLP3         READE     FNBLD000                               30
213670950504     C     *IN30         DOWEQ     *OFF
213680950504     C                   DELETE    FNBLD000
213690950504     C     KBLP3         READE     FNBLD000                               30
213700950504     C                   ENDDO
213710950504     C                   ENDIF
213720950504     C                   ENDIF
213730980320     C*
213740980320     C* LE SEGUENTI ISTRUZIONI SI COLLOCAVANO, PER ANALOGIA, DOPO
213750980320     C* LA CREAZIONE DEL BLD PER I SEGNACOLLI NON SEQUENZIALI.
213760980320     C* SONO STATE SPOSTATE QUI AFFINCHE' IN OGNI CASO IL DETTAGLIO
213770980320     C* COLLI SIA GIA' STATO CREATO PER POTER PERMETTERE LA STAMPA
213780980320     C* DELLE ETICHETTE ESTERE
213790980320     C*
213800980320     C* SE FG9='S' CREO 1 RECORD IN FNBLD  SE SEGNACOLLI SEQUENZIALI
213810980320     C   12
213820980320    1CAN 15BLPFNS        IFEQ      ' '
213830980320     C*
213840980320    2C     §1BFG6        IFEQ      'C'
213850980320     C     §1BFG9        ANDEQ     'S'
213860980320     C*
213870081008     C**   §1BFG0        OREQ      'D'
213880081008    2C**   §1BFG6        ANDEQ     'C'
213890081008     C**   WESTER        ANDEQ     'S'
213900980320     C*
213910081008     C**   §1BF11        OREQ      'D'
213920081008     C**   §1BFG0        ANDEQ     'C'
213930081008     C**   WESTER        ANDEQ     'S'
213940980320     C                   Z-ADD     BLPNCD        BLDNCD
213950980320     C                   Z-ADD     BLPNCA        BLDNCA
213960980320     C                   Z-ADD     VIDNCL        BLDNCL
213970980320     C                   Z-ADD     1             BLDNC1
213980980320     C                   EXSR      CRTBLD
213990980320    2C                   ENDIF
214000980320     C** STAMPA ETICHETTA IN IMMEDIATO SE ESTERA LA LNA
214010081008    2C**   WESTER        IFEQ      'S'
214020081008     C**   §1BFG9        ANDNE     'S'
214030980320     C*
214040081008    3C**   §1BFG0        IFEQ      'I'
214050081008     C**   §1BFG6        ANDEQ     'C'
214060980320     C*
214070081008     C**   §1BF11        OREQ      'I'
214080081008     C**   §1BFG0        ANDEQ     'C'
214090081008     C**                 MOVEL     'EST'         §DETST
214100980320     C**
214110980320     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
214120081008     C**                 Z-ADD     BLPNCD        CO2SCD
214130081008    4C**   BLPNCA        IFEQ      0
214140081008     C**                 Z-ADD     BLPNCD        STANCA
214150081008     C**                 ELSE
214160081008     C**                 Z-ADD     BLPNCA        STANCA
214170081008    4C**                 END
214180980320     C**
214190081008     C**                 EXSR      STASCI
214200081008    3C**                 ENDIF
214210081008    2C**                 ENDIF
214220980320    1C                   ENDIF
214230910805     C*
214240910805     C* E S T E N S I O N E   B O L L A
214250991006      *
214260991006      * Se agganciata precedentemente riaggancio file tassazione per 2a bolla
214270991006     C     WAR62         IFEQ      'E'
214280991006     C                   MOVEL     '2'           WTRC
214290050331     c                   if        wKSCsf2 <> 0000 and wKSCsf2 <> 9999
214300050331     c     kblp4         delete    fiar6000
214310050331     c                   clear                   war62
214320050331     c                   else
214330991006     C     KBLP4         CHAIN     FIAR6000                           30
214340050331     c                   endif
214350991006     C                   ENDIF
214360991006      *
214370040116if  1c                   If        *In05 and
214380040116     c                             (wesvar1 <> *Blanks or Vi2Cei <> *Blanks)
214390040116      * Carico le varie
214400040116if  2c                   If        wesvar1 <> *Blanks
214410040116     c                   Clear                   wsv1
214420040116     c                   Clear                   wva1
214430040116     c                   Clear                   wsv2
214440040116     c                   Clear                   wva2
214450040116     c                   Clear                   wsv3
214460040116     c                   Clear                   wva3
214470040116     c                   Eval      ContaSv = 1
214480041217do  3c                   Do        6             c
214490040116     c                   If        w2sv(c) <> *Blanks
214500040116     c                   Exsr      Wrtvar1
214510040116     c                   EndIf
214520040116    3c                   EndDo
214530040116    2c                   EndIf
214540991006      *
214550991006     C                   CLEAR                   FIAR6000
214560991006      *
214570991006     C                   MOVEL     '2'           AR6TRC
214580991006     C                   MOVEL     BLPAAS        AR6AAS
214590991006     C                   MOVEL     BLPLNP        AR6LNP
214600991006     C                   MOVEL     BLPNRS        AR6NRS
214610991006     C                   MOVEL     BLPNSP        AR6NSP
214620991006     C                   MOVEL     VI2CEI        AR6CEI
214630040116     c                   Movel     wsv1          Ar6Sv1
214640040116     c                   Z-add     wva1          Ar6Va1
214650040116     c                   Movel     wsv2          Ar6Sv2
214660040116     c                   Z-add     wva2          Ar6Va2
214670040116     c                   Movel     wsv3          Ar6Sv3
214680040116     c                   Z-add     wva3          Ar6Va3
214690991015     C                   MOVEL     VI2DIV        AR6DIV
214700991022     C                   MOVE      9999          AR6KSC
214710991022     C                   MOVEL     AR6LNP        AR6KSC
214720040126     c                   Z-add     Vi2Imv        Ar6Imv
214730991022     C     AR6IMV        IFGT      *ZEROS
214740991022     C                   MOVEL     'P'           AR6FIM
214750991022     C                   ELSE
214760991022     C                   CLEAR                   AR6FIM
214770991022     C                   ENDIF
214780991014     C* DATI PER STAMPA SOLO SE NON è PREPAGATO
214790991014     C     *IN34         IFEQ      *OFF
214800040116     c                   Z-add     Ar6Imv        Db0Imv
214810941108     C                   MOVEL     VI2CEI        DB0CEI
214820991014     C                   MOVEL     V2DCEI        DB0DCE
214830991015     C                   MOVEL     VI2DIV        DB0DIV
214840991014     C                   MOVEL     WFDC2         DB0FDC
214850991014     C                   ENDIF
214860900507     C*
214870991006     C     WAR62         IFEQ      'E'
214880991006     C                   UPDATE    FIAR6000
214890940926     C                   ELSE
214900991006     C                   WRITE     FIAR6000
214910940926     C                   ENDIF
214920930624     C*
214930940920   X1C                   ELSE
214940940926     C*  C'ERA MA ELIMINATA LA ESTENSIONE BOLLA
214950991006    2C     WAR62         IFEQ      'E'
214960991006     C                   DELETE    FIAR6000
214970930624    2C                   ENDIF
214980930624    1C                   ENDIF
214990940926     C***
215000930331     C*** L E G A M E   B O L L A
215010930331     C   12
215020930331     CANN15VIDLNA        IFNE      SAVLNA
215030940915     C     KBLP3         CHAIN     FNLBL000                           30
215040930331     C  N30              Z-ADD     BLPLNA        LBLLAN
215050940928     C  N30              MOVEL     ' '           LBLFT1
215060940928     C  N30              MOVEL     ' '           LBLFT2
215070940915     C  N30              UPDATE    FNLBL000
215080930331     C                   END
215090910117     C***
215100910125     C* IMMISSIONE:
215110910411     C* NO STAMPA SEGNACOLLO IN  D I F F E R I T A:
215120910220     C     §1BFG6        IFNE      'D'
215130951019     C   12
215140951019     CAN 15              EXSR      DELVAD
215150910220     C                   ELSE
215160960805     C*    STAMPA SEGNACOLLO IN DIFFERITA: CREO FNBLD00F
215170910128     C  N12              DO
215180910128     C                   SETON                                        30
215190910128     C                   Z-ADD     BLPNCD        BLDNCD
215200910128     C                   Z-ADD     BLPNCA        BLDNCA
215210910506     C                   Z-ADD     VIDNCL        BLDNCL
215220910128     C                   EXSR      CRTBLD
215230910128     C                   END
215240910129     C* MANUTENZIONE / DISK CLIENTI:
215250910129     C   12              DO
215260910521     C*** DISK CLIENTI NO DETTAGLIO COLLI DA CLIENTE:
215270910411     C   15§1BFG7        IFNE      'S'
215280040618     c     §1bf12        oreq      'B'
215290910411     C                   Z-ADD     BLPNCD        BLDNCD
215300910411     C                   Z-ADD     BLPNCA        BLDNCA
215310910506     C                   Z-ADD     VIDNCL        BLDNCL
215320910521     C                   Z-ADD     1             BLDNC1
215330910411     C                   EXSR      CRTBLD
215340020917     C* DELETO FIVAD SE C'ERA
215350960805     C                   EXSR      DELVAD
215360910411     C*
215370910411     C                   ELSE
215380910411     C*
215390910521     C*** DISK CLIENTI SI DETTAGLIO COLLI DA CLIENTE:
215400020917     C     KBLC          SETLL     FIVAD000
215410020917     C     KBLC          READE     FIVAD000                               30
215420910411     C*
215430940214     C                   Z-ADD     BLPNCD        COMSCD
215440940214     C                   MOVEL     BLDCDP        VARCDP
215450910411     C                   Z-ADD     1             BLDNC1
215460940214     C                   CLEAR                   VARNCL
215470910411     C*
215480930628     C     *IN30         DOWEQ     *OFF
215490940214     C*
215500960805     C* CREO RECORD IN FNBLD00 PER ROTTURA COD PRODOTTO
215510940214     C     BLDCDP        IFNE      VARCDP
215520001018     C* SE DEVO SCRIVERE FISGN IN RISTAMPA IMPOSTO WSGNR = 'B' PER
215530001018     C* RICHIAMARE STASCD (SCRITTURA DI FISGN AL MOMENTO DELLA SCRITTU-
215540001018     C* DI FNBLD)
215550001018     C     WSGNR         IFEQ      'S'
215560010515     C                   MOVEL     'B'           WSGNR             1
215570001018     C                   ENDIF
215580940214     C                   EXSR      ROTCDP
215590940214     C                   ENDIF
215600940214     C*
215610940214     C* SE CODICE PRODOTTO NON MODIFICATO, SOMMO INSIEME I 2 RECORD
215620940214     C                   ADD       BLDNCL        VARNCL
215630940214     C*
215640910411     C* CANCELLO IL RECORD DAL FLBLD DI PASSAGGIO
215650020917     C                   DELETE    FIVAD000
215660910411     C*
215670020917     C     KBLC          READE     FIVAD000                               30
215680940214     C                   ENDDO
215690940214     C* ULTIMA ROTTURA
215700001018     C     WSGNR         IFEQ      'S'
215710001018     C                   MOVEL     'B'           WSGNR
215720001018     C                   ENDIF
215730940214     C                   EXSR      ROTCDP
215740940214     C*
215750910411     C                   END
215760910411     C*
215770910411     C*** MANUTENZIONE BOLLE:
215780910411     C  N15              DO
215790001003     C*
215800001003     C*
215810910201     C                   SETOFF                                       3132
215820910411     C     SAVLNA        COMP      VIDLNA                             3131
215830910411     C  N31VIDNCL        COMP      SAVNCL                             3132
215840910125     C*
215850940214     C*  L I N E A   A R R I V O   > <   O   N C L   A U M E N T A T O
215860910411     C   31              DO
215870000915     C     KBLP3         CHAIN     FNBLD000                           33
215880940214     C*
215890000915     C     *IN33         IFEQ      *OFF
215900940214     C                   Z-ADD     BLPNCD        COMSCD
215910940214     C                   MOVEL     BLDFST        SAVFST
215920940214     C*
215930940214     C     SAVNCL        IFNE      VIDNCL
215940940214     C                   Z-ADD     VIDNCL        BLDNCL
215950940214     C                   ENDIF
215960940214     C                   ENDIF
215970910128     C*
215980001019     C                   CLEAR                   WSTSGN
215990001019     C*
216000000915     C     *IN33         DOWEQ     '0'
216010001018     C     WSGNR         IFEQ      'S'
216020001018     C                   MOVEL     'B'           WSGNR
216030001018     C                   ENDIF
216040940224     C                   Z-ADD     BLDNCL        VARNCL
216050940224     C                   MOVEL     BLDCDP        VARCDP
216060940224     C*
216070940224     C                   EXSR      ROTCDP
216080940214     C*
216090960404     C* SE PUO' AVERE PIU' CODICI PRODOTTO (FLAG 7 = "S") RILEGGO
216100960404     C*  ALTRIMENTI ESCO DALLA LETTURA DI FNBLD00F, PERCHE' SE HO
216110940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
216120940907     C     §1BFG7        IFEQ      'S'
216130000915     C     KBLP3         READE     FNBLD000                               33
216140940907     C                   ELSE
216150000915     C                   SETON                                        33
216160940907     C                   END
216170940907     C*
216180940214     C                   ENDDO
216190910128     C*
216200910128     C                   END
216210910128     C*
216220910405     C** ALTRE MODIFICHE DELLA MANUTENZIONE BOLLE
216230910405     C*
216240940214     C* D I M I N U Z I O N E   N U M E R O   D E I   C O L L I
216250910411     C  N31*IN32         IFEQ      '1'
216260001019     C                   CLEAR                   WSTSGN
216270000915     C     KBLP3         CHAIN     FNBLD000                           33
216280910405     C*
216290910405     C                   Z-ADD     BLPNCD        BLDNCD
216300910405     C                   Z-ADD     BLPNCA        BLDNCA
216310910506     C                   Z-ADD     VIDNCL        BLDNCL
216320000915     C  N33              MOVEL     BLDFST        SAVFST
216330001018     C     WSGNR         IFEQ      'S'
216340001018     C                   MOVEL     'B'           WSGNR
216350001018     C                   ENDIF
216360910405     C                   EXSR      CRTBLD
216370910405     C*
216380910405     C                   ELSE
216390910405     C*
216400910405     C*                    MODIFICHE CON   AGGIORNAMENTO FLBLD
216410940214     C*
216420940921     C     SAVMIT        IFNE      WKSC
216430960926     C     SAVPDR        ORNE      VIDPDR
216440940214     C     SAVRSD        ORNE      VIDRSD
216450910411     C* CODICE PRODOTTO DA RIF ALFABETICO
216460940214     C     §1BFG7        ORNE      'S'
216470940922     C     SAVRMA        ANDNE     VIDRMA
216480940214     C                   SETON                                        31
216490980409     C* Memorizzo di non ristampare l'etichetta
216500050422     c* (solo se non ho variato campi per cui devo ristampare)
216510050422     C     SAVTSP        IFeq      BLPTSP
216520050422     C     SAVCAD        andeq     VIDCAD
216530050422     C     SAVZNC        andeq     VARZNC
216540050422     C     SAVbva        andeq     vidbva
216550980409     C                   MOVE      'N'           WPRT              1
216560050422     c                   endif
216570940214     C                   ENDIF
216580910411     C*
216590910405     C*                    MODIFICHE SENZA AGGIORNAMENTO FLBLD
216600980409     C  N31SAVTSP        IFNE      BLPTSP
216610940214     C     SAVCAD        ORNE      VIDCAD
216620940214     C     SAVZNC        ORNE      VARZNC
216630050421     C     SAVbva        ORNE      vidbva
216640910405     C                   SETON                                        3132
216650930402     C                   END
216660120302     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BRT
216670051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
216680980409     C     SAVCAD        IFNE      VIDCAD
216690051102     C                   EXSR      AGGARS
216700980409     C                   END
216710000915     C* SE HO VARIATO SOLO COD.CHI SONO DEVO ANDARE IN WRITE SU FISGN
216720000915     C     *IN31         IFEQ      *OFF
216730000915     C     *IN32         ANDEQ     *OFF
216740000915     C     WUPDSG        ANDEQ     'S'
216750000915     C                   SETON                                        3132
216760000915     C                   ENDIF
216770940214     C* --> VARIO FLBLD
216780971230     C     *IN31         IFEQ      *ON
216790001019     C                   CLEAR                   WSTSGN
216800000915     C     KBLP3         CHAIN     FNBLD000                           33
216810000915     C  N33              MOVEL     BLDFST        SAVFST
216820941108     C*
216830000915     C     *IN33         DOWEQ     *OFF
216840001018     C     WSGNR         IFEQ      'S'
216850001018     C                   MOVEL     'B'           WSGNR
216860001018     C                   ENDIF
216870980410     C* VARIAZIONE FLBLD00F E STAMPA
216880971230     C     *IN32         IFEQ      *OFF
216890940214     C                   EXSR      CRTBLD
216900971230     C                   ELSE
216910001005     C* RICHIAMO STASCD PER SCRITTURA FISGN IN RISTAMPA
216920001005     C     WSGNR         IFEQ      'B'
216930001005     C                   EXSR      STASCD
216940001005     C                   MOVEL     'S'           WSGNR
216950001005     C                   ENDIF
216960940214     C* SOLO STAMPA
216970971217     C*  NON VENGONO RISTAMPATI I SAGNACOLLI SE SONO SOLO ESTERO
216980971230     C     SAVFST        IFEQ      'S'
216990980319     C                   EXSR      STASCD
217000081008     C**   *IN12         IFEQ      *ON
217010081008     C**   *IN15         ANDEQ     *OFF
217020081008     c**   A_§ogntw      andeq     'EUP'
217030081008     C**                 MOVEL     'E'           WTRC
217040081008     C**   KBLP4         CHAIN     Fiar4000                           90
217050081008     C**   *IN90         IFEQ      *OFF
217060081008     C**                 MOVEL     ar4NOT        DSBL4E
217070081008     C**                 MOVEL     'S'           §B4EST
217080081008     C**                 MOVEL     DSBL4E        ar4NOT
217090081008     C**                 UPDATE    Fiar4000
217100081008     C**                 ENDIF
217110081008     C**                 SETOFF                                       90
217120081008     C**                 ENDIF
217130971230     C                   ENDIF
217140040603     c* disalloco record di fnbld
217150040603     c                   unlock    fnbld01l
217160971230     C                   ENDIF
217170940907     C*
217180940907     C* SE PUO' AVERE PIU' CODICI PORDOTTO (FLAG 7 = "S") RILEGGO
217190940907     C*  ALTRIMENTI ESCO DALLA LETTURA DI FLBLD50F, PERCHE' SE HO
217200940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
217210971230     C     §1BFG7        IFEQ      'S'
217220000915     C     KBLP3         READE     FNBLD000                               33
217230940907     C                   ELSE
217240000915     C                   SETON                                        33
217250971230     C                   END
217260940907     C*
217270940214     C                   ENDDO
217280940214     C                   ENDIF
217290910417     C                   END
217300910128     C*
217310910128     C                   END
217320910411     C                   END
217330910201     C                   END
217340910411     C*
217350910411     C* STAMPA SEGNACOLLO IN  I M M E D I A T O
217360910131     C     §1BFG6        IFEQ      'I'
217370910208     C* PER DISK CLIENTI O IMMISSIONE BOLLE STAMPO SUBITO
217380910208     C                   MOVEL     *BLANKS       §LDRST
217390081008     C**   WESTER        IFEQ      'S'
217400081008     C**                 MOVEL     'ALL'         §DETST
217410081008     C**                 ELSE
217420971215     C                   MOVEL     'ITA'         §DETST
217430040505     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
217440040505     c* etichetta Italia con dati esteri
217450040505     C     A_§ogntw      IFEQ      'EEX'
217460040505     C                   MOVEL     'EEX'         §DETSE
217470040506     c                   else
217480040506     c                   clear                   §detse
217490040505     C                   ENDIF
217500081008     C**                 ENDIF
217510971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
217520971215     C                   Z-ADD     BLPNCD        CO2SCD
217530971215     C     BLPNCA        IFEQ      0
217540971215     C                   Z-ADD     BLPNCD        STANCA
217550971215     C                   ELSE
217560971215     C                   Z-ADD     BLPNCA        STANCA
217570971215     C                   END
217580910131     C   12
217590910131     CAN 15
217600910201     CORN12              EXSR      STASCI
217610910131     C*
217620910405     C* IN MANUTENZIONE STAMPO SOLO SE CAMBIATI:
217630910131     C   12
217640910131     CANN15              DO
217650001005     C     WSGNR         IFEQ      'S'
217660001005     C                   MOVEL     'B'           WSGNR
217670001005     C                   ENDIF
217680980320     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BAR (MA NON LA LNA)
217690051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
217700980409     C     SAVCAD        IFNE      VIDCAD
217710051102     C                   EXSR      AGGARS
217720980409     C                   END
217730000922     C* SE DISK C DEVO RICHIAMARE STASCI ANCHE PER LE SEGUENTI VARIAZ.
217740050228     C***  §1BF12        IFNE      'N'
217750050228     C***  §1BF12        ANDNE     'E'
217760050228     C***  §1BF12        OREQ      'E'
217770050228     C***  WASDKC        ANDEQ     'S'
217780050228     C***  WSGNR         OREQ      'B'
217790050228     C***  SAVMIT        IFNE      WKSC
217800050228     C***  SAVPDR        ORNE      VIDPDR
217810050228     C***  SAVRSD        ORNE      VIDRSD
217820050228     C***  §1BFG7        ORNE      'S'
217830050228     C***  SAVRMA        ANDNE     VIDRMA
217840050228     C***                MOVEL     'S'           WUPDSG
217850050228     C***                ENDIF
217860050228     C***                ENDIF
217870980320     C*
217880001018     C                   CLEAR                   WNOPRT
217890940214     C     SAVLNA        IFNE      VIDLNA
217900940214     C     SAVNCL        ORNE      VIDNCL
217910940214     C     SAVCAD        ORNE      VIDCAD
217920930930     C     SAVZNC        ORNE      VIDZNC
217930941230     C     SAVTSP        ORNE      BLPTSP
217940050421     C     SAVbva        ORNE      vidbva
217950910405     C*
217960930930     C                   EXSR      STASCI
217970001018     C                   ELSE
217980050228     c     wdkc          ifeq      'S'
217990050228     c     wsgnr         oreq      'B'
218000050228     C     SAVMIT        IFNE      WKSC
218010050228     C     SAVPDR        ORNE      VIDPDR
218020050228     C     SAVRSD        ORNE      VIDRSD
218030050228     C     §1BFG7        ORNE      'S'
218040050228     C     SAVRMA        ANDNE     VIDRMA
218050050228     c     wupdsg        oreq      'S'
218060001018     C                   MOVEL     '1'           WNOPRT            1
218070001018     C                   EXSR      STASCI
218080001018     C                   ENDIF
218090050228     c                   endif
218100930930     C                   ENDIF
218110910131     C                   END
218120910117     C                   END
218130910312     C*
218140910129     C* PER DISK CLIENTI SE CAMBIATO CTM E PRIMA ERA "D" CANCELLO
218150020917     C*   IN FIVAD01L I RECORD
218160940222     C     *IN12         IFEQ      *ON
218170940222     C     *IN15         ANDEQ     *ON
218180970328     C* FLAG DI RISTAMPA BOLLA
218190970328     C                   MOVEL     WSTA          CMD8
218200940222     C                   ENDIF
218210161115     C* PER DISK CLIENTI: cancellazione file
218220980406     C     *IN12         IFEQ      *ON
218230980406     C     *IN15         ANDEQ     *ON
218240980406     C                   EXSR      DELVAT
218250040601     C                   EXSR      DELVAX
218260161115     c                   if        §ogntw='DPD' and wfbdp='S'
218270161115     C/EXEC SQL
218280161115     C+ DELETE FROM WFBDP00F WHERE BDPNPR=:v7cnpr
218290161115     C/END-EXEC
218300161115     c                   endif
218310980406     C                   END
218320940920     C***
218330940216     C* S T A M P A    B O L L A
218340940920     C***
218350020619     C* ESCLUDO SEMPRE BOLLE DI RECUPERO (TRANNE LE BOLLE FO-ASSEGNATO
218360020619     c* RECUPERO BOLLE firmate perchè in questo caso la bolla firmata
218370020619     c* deve partire con allegata la bolla di recupero)
218380040701     C* ESCLUDO SEMPRE BOLLE EXPORT DPD, BOLLE POSTE (solo se data
218390040701     c* spedizione < data in tabella "VPO" trk "PPT"
218400000121     C*
218410940920     C* 1) SE FLG STAMPA BOLLA CLIENTE NON E' "S" (STAMPATA DAL CLIENT)
218420940920     C*                              E NON E' "B" (DA STAMPARE COL PGM
218430940920     C*                                            DI RISTAMPA BOLLA)
218440940920     C*                                MA  E' "N" (DA STAMPARE IN IMMIS
218450940920     C*                                            SIONE BOLLE)
218460940920     C* IN MANUTENZIONE SI PUO' RISTAMPARE SEMPRE
218470970407     C* 2) SE IN MANUT. SE PREMUTO CMD8  (CMD8= 1)
218480941230     C* 3) SE DA DISK CLIENTI SOLO SE LNP >< DA LNA   PER "G"
218490960321     C* 4) SE DA DISK CLIENTI MAI                     PER "P"
218500970407     C* 5) SE IN MANUT. SE ERA NO DDT E DIVENTA SI DDT STAMPO SUBITO
218510000121     C* 6) SE IN MANUT. SE ERA SI DDT DPD E DIVENTA SI DDT NON DPD
218520000121     C*                                                STAMPO SUBITO
218530940216     C*
218540000121     C* 7) RESI E DIROTTAMENTI SEMPRE SUBITO
218550000121     C* 8) SE BOLLA A3 NON SI PUO' MAI STAMPARE
218560000121     C* 9) SE BOLLA F3 NON SI PUO' STAMPARE IN IMMISSIONE
218570000509     C*10) SE MANUTENZIONE DI PREPAGATO, RISTAMPO SEMPRE SE E' DDT SI
218580000121     C*11) SE IMMISSIONE   DI PREPAGATO, STAMPO SEMPRE
218590960321    0C     §3ATB1        IFNE      'A3'
218600020319     C     A_§OGNTW      ANDNE     'DPD'
218610020319     C     §ogntw        ANDNE     'PPT'
218620020619     c     §3atb1        oreq      'A3'
218630020619     c     blpcbo        andeq     'FO'
218640020319     C     §ogntw        OREQ      'PPT'
218650000713     C     BLPNRS        ANDEQ     0
218660040701     c     §ogntw        oreq      'PPT'
218670040729     c     blpdsp        andge     §vpoptl
218680000218     C* PER I PREPAGATI STAMPO LA BOLLA CHE E'LA FATTURA
218690000218     C     *IN34         OREQ      *ON
218700960321     C*
218710941110    1C     *IN12         IFEQ      *OFF
218720970128     C     BLPFST        ANDEQ     'S'
218730940216     C*
218740940216     C     *IN12         OREQ      *ON
218750940216     C     CMD8          ANDEQ     '1'
218760970404     C     BLPFST        ANDNE     'N'
218770970404     C*
218780970404     C     *IN12         OREQ      *ON
218790970404     C     *IN15         ANDEQ     *OFF
218800970404     C     SAVBAM        ANDNE     'S'
218810970404     C     SAVBAM        ANDNE     'C'
218820970404     C     BLPFST        ANDEQ     'S'
218830970407     C*
218840970407     C     *IN12         OREQ      *ON
218850970407     C     *IN15         ANDEQ     *ON
218860970407     C     CMD8          ANDEQ     'S'
218870990630     C*
218880990630     C     *IN12         OREQ      *ON
218890990701     C     *IN15         ANDEQ     *OFF
218900990630     C     BLPFST        ANDEQ     'S'
218910990701     C     *IN22         ANDEQ     *ON
218920990701     C     *IN12         OREQ      *OFF
218930990701     C     *IN34         ANDEQ     *ON
218940000121     C*
218950000121     C     *IN12         OREQ      *ON
218960000121     C     *IN15         ANDEQ     *OFF
218970020319     C     SAVNTW        ANDEQ     'DPD'
218980020319     C     A_§OGNTW      ANDNE     'DPD'
218990000121     C     BLPFST        ANDEQ     'S'
219000900514     C                   EXSR      STAMPA
219010940216    1C                   END
219020960321    0C                   END
219030911031     C*
219040911031     C* PASSO IL NUMERO DI SPEDIZIONE AL PGM RICHIAMATO
219050911031     C   12              Z-ADD     BLPNSP        §LPNSP
219060921006     C* SE RECUPERO ADDIZIONO 1 AL NUMERO
219070921006     C  N12
219080921006     CAN 98              ADD       1             RECNSP
219090900504     C*
219100040415     c* In manutenzione bolle , se riscritto fnblt devo clearare blpncr/ncp
219110061213    1c*                  if        *in12 and not *in15
219120061213    2c*                  if        wablt='S'
219130061213     c*    blpnrr        chain     fnblp000                           90
219140061213     c*                  clear                   blpncr
219150061213     c*                  clear                   blpncp
219160061213     c*                  clear                   blpvlc
219170061213     c*                  clear                   blppkc
219180061213     c* n90              update    fnblp000
219190061213   x2c*                  else
219200050502     c* Se già calcolato volume cml devo reimpostarlo su VLF
219210061213    3c*                  if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
219220061213     c*    blpnrr        chain     fnblp000                           90
219230061213     c*                  clear                   dslv20
219240061213     C*                  MOVEL     'P'           D20TBO
219250061213     C*                  MOVEL     'C'           D20TVL
219260061213     c*                  movel     'L'           d20tla
219270061213     C*                  MOVEL     BLPvlc        D20vlu
219280061213     C*                  MOVEL     BLPncr        D20ncr
219290061213     C*                  MOVEL     BLPFVF        D20FVF
219300061213     C*                  MOVEL     BLPVLF        D20VLF
219310061213     C*                  MOVEL     BLPFVB        D20FVB
219320061213     C*                  MOVEL     BLPVLB        D20VLB
219330061213     C*                  MOVEL     BLPAAS        D20AAS
219340061213     C*                  MOVEL     BLPLNP        D20LNP
219350061213     C*                  MOVEL     BLPNRS        D20NRS
219360061213     C*                  MOVEL     BLPNSP        D20NSP
219370061213     C*                  MOVEL     BLPCBO        D20CBO
219380061213     C*                  MOVEL     BLPNCL        D20NCL
219390061213    4C*    BLPDBR        IFGT      *ZEROS
219400061213     C*                  MOVE      BLPDBR        D20DTE
219410061213     C*                  ELSE
219420061213     C*                  MOVE      BLPMGS        D20DTE
219430061213     C*                  MOVEL     BLPAAS        D20DTE
219440061213    4C*                  END
219450061213     C*                  MOVEL     DSLV20        KPJBU
219460050502     C*
219470061213     C*                  CALL      'FNLV20R'
219480061213     C*                  PARM                    KPJBA
219490061213     c*                  parm      'N'           pwstor            1
219500050502     C*
219510061213     C*                  MOVEL     KPJBU         DSLV20
219520050502     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
219530061213    4C*    D20ERR        IFNE      '1'
219540061213     C*                  MOVEL     D20FVF        BLPFVF
219550061213     C*                  MOVEL     D20VLF        BLPVLF
219560061213E   4C*                  ENDIF
219570061213     c*                  update    fnblp000
219580061213    3c*                  endif
219590061213    2c*                  endif
219600061213    1c*                  endif
219610070601     c                   if        wmsg_pda='S'
219620070606     c* decodifico l'aut.
219630070606     C                   move      w02pdr_p      kpdpdr
219640070606     C                   move      'A'           kpdtip
219650070606     c                   clear                   w02rsc_p
219660070606     c     kfapd         chain     fiapd01l
219670070606     c                   if        %found(fiapd01l)
219680070606     c                   movel     apdrsc        w02rsc_p
219690070606     c                   endif
219700070601     c                   exfmt     ls01w02pda
219710070601     c                   endif
219720040408     c
219730080603     c* disalloco fisgn01l: Se manutneziono bolla export dpd senza
219740080603     c* modificare nulla, nella routine CTRSGN viene allocato fisgn
219750080603     c* e non viene poi pèiù disallocato
219760080603     c                   unlock    fisgn01l
219770081111     c* in manutenzione se cambiata data ritiro verifico se rielaborare
219780081121     c* statistica partito e a terra
219790090330     c* devo rielaborare anche in immissione se la data ritiro è inferiore
219800090330     c* a udate
219810090330    1c                   if        (*in12 and not *in15 and blpdrt<>s_drtblpi)
219820090330     c                             or ((*in12='0' or *in15) and blpdrt>0)
219830090330     c                   z-add     blpncl        st2ncl
219840090330    2c                   If        blpdrt <= §SdfParU
219850081111     C                   MOVE      blpdrt        SA2DTS            8 0
219860081111     C                   MOVE      'P'           SA2TRC            1
219870090330     C                   exsr      sr_callsa2r3
219880090330    2c                   endif
219890090330    2c                   If        s_drtblpi <= §SdfParU
219900081121     c                             and s_drtblpi > 0
219910081111     C                   MOVE      s_drtblpi     SA2DTS            8 0
219920081111     C                   MOVE      'P'           SA2TRC            1
219930090330     C                   exsr      sr_callsa2r3
219940090330    2c                   endif
219950090330    2c                   If        blpdrt <= §SdfterU
219960081121     C                   MOVE      blpdrt        SA2DTS            8 0
219970081121     C                   MOVE      'T'           SA2TRC            1
219980090330     C                   exsr      sr_callsa2r3
219990090330    2c                   endif
220000090330    2c                   If        s_drtblpi <= §SdfTerU
220010081121     c                             and s_drtblpi > 0
220020081121     C                   MOVE      s_drtblpi     SA2DTS            8 0
220030081121     C                   MOVE      'T'           SA2TRC            1
220040090330     C                   exsr      sr_callsa2r3
220050090330    2c                   endif
220060090330    1c                   endif
220070130308     c* invio messagio a ced se cliente fornisce pdf senza abilitazione
220080130313     c* e nel caso in cui la bolla sia stata confermata senza (hanno
220090130313     c* cambiato il CTM a video)
220100130313     c                   if        wvatpe='S' and §1bf16<>'S'
220110130308     c                   exsr      ced_alert
220120130308     c                   endif
220130080603
220140040408     C     ENDREG        ENDSR
220150160727      *--------------------------------------------------------------*
220160160727      * Valorizzaz. campi di work limiti C/A dal/al come da tabella "FSC"
220170160727      *--------------------------------------------------------------*
220180161229     c***  sr_impoDalAl  BegSr
220190161229     c***                monitor
220200161229     c***                eval      wcadal=§fscdal
220210161229     c***                on-error
220220161229     c***                clear                   wcadal
220230161229     c***                endmon
220240161229     c***                monitor
220250161229     c***                eval      wcaal =§fscal
220260161229     c***                on-error
220270161229     c***                clear                   wcaal
220280161229     c***                endmon
220290161229     c***                endsr
220300090330      *--------------------------------------------------------------*
220310090330      * Richiamo pgm per rielaborazione statistiche partito e a terra
220320090330      *--------------------------------------------------------------*
220330090330     c     sr_callsa2r3  BegSr
220340090330     C                   CALL      'FNLSA2R3'
220350090330     C                   PARM                    SA2TLA            1
220360090330     C                   PARM                    SA2TRC
220370090330     C                   PARM                    SA2DTS
220380090330     C                   PARM                    WWLNA             3 0
220390090330     C                   PARM                    st2ncl            5 0
220400090330     c                   endsr
220410160421      *--------------------------------------------------------------*
220420160422      * Verifica se aggiornare la zona di consegna su blp
220430160421      *--------------------------------------------------------------*
220440160421     c     sr_VariaZnc   BegSr
220450160422     c* Se già presente una spunta reale, allo scarico spunte
220460160422     c* è stata aggiornata la zona su blp con la zona della spunta se <>
220470160422     c* In questi casi questo pgm non deve più modificare la zona di consegna
220480160422     c* della bolla
220490160421     c                   if        blplna=lna_sav   and
220500160422     c                             blpncl<=savncl
220510160422     C     Kblt1         SETLL     fiart01l
220520160422     C     kblt1         READE(n)  fiart01l
220530160421    2C                   DOW       not %eof(fiart01l)
220540160421     C*
220550160421     c                   exsr      sr_zona
220560160421     c                   if        wokzona='1'
220570160421     c* verifico se presente una spunta
220580160421     c                   eval      w_VariaZnc='N'
220590160421     c                   leavesr
220600160421     c                   endif
220610160422     C     kblt1         READE(n)  fiart01l
220620160421     c                   enddo
220630160422     c                   endif
220640160421     c                   endsr
220650060209      *--------------------------------------------------------------*
220660060209      * Storicizzazione variazione di tassazione prepagato
220670060209      *--------------------------------------------------------------*
220680060209     c     Stoarb        BegSr
220690060209     c*
220700060209     c                   open      fiarbt0f
220710060209     c                   open      fiarbu0f
220720060209     c*
220730060209     c                   movel     '1'           wtrc
220740060209     C     KBLP4         CHAIN     FIAR6000
220750060209     c*
220760060209     c                   z-add     blpaas        arbaas
220770060209     c                   z-add     blplnp        arblnp
220780060209     c                   z-add     blpnrs        arbnrs
220790060209     c                   z-add     blpnsp        arbnsp
220800060209     C                   MOVEL     AR6DIV        ARBDIV
220810060209     C                   MOVEL     AR6POR        ARBPOR
220820060209     C                   MOVEL     AR6SV1        ARBSV1
220830060209     C                   MOVEL     AR6VA1        ARBVA1
220840060209     C                   MOVEL     AR6SV2        ARBSV2
220850060209     C                   MOVEL     AR6VA2        ARBVA2
220860060209     C                   MOVEL     AR6SV3        ARBSV3
220870060209     C                   MOVEL     AR6VA3        ARBVA3
220880060209     C                   MOVEL     AR6IMV        ARBIMV
220890060209     C                   MOVEL     AR6ALI        ARBALI
220900060209     C                   MOVEL     AR6CEI        ARBCEI
220910060209     C                   MOVEL     AR6IFT        ARBIFT
220920060209     C                   MOVEL     AR6DFT        ARBDFT
220930060209     C                   MOVEL     AR6NFT        ARBNFT
220940060209     C                   MOVEL     AR6FIV        ARBFIV
220950060209     C                   MOVEL     AR6FIM        ARBFIM
220960060209     c                   z-add     blpksc        arbksc
220970060209     c                   z-add     blpctr        arbctr
220980060209     c                   move      blpcbo        arbcbo
220990060209      *
221000060209      * Metto nell'ultimo byte del campo arbpru che la bolla aggiornata
221010060209      * è in partenza 'P'
221020060209     C                   MOVE      'P'           ARBPRU
221030060209      *
221040060209     C                   WRITE     FIARBT00
221050060209     C*
221060060209     C* SE HO DELLE ATRE VARIE LE STORICIZZO NEL FILE FIARBU0F
221070060209    1C     WAR7          IFEQ      'E'
221080060209     C     Kblp4         SETLL     FIAR7000
221090060209     C     Kblp4         READE     FIAR7000                               30
221100060209     C*
221110060209    2C     *IN30         DOWEQ     *OFF
221120060209     C                   MOVEL     AR7SVN        ARBSVN
221130060209     C                   MOVEL     AR7VAN        ARBVAN
221140060209     C                   WRITE     FIARBU00
221150060209     C*
221160060209     C     Kblp4         READE(N)  FIAR7000                               30
221170060209    2C                   ENDDO
221180060209     C                   ENDIF
221190060209     C*
221200060209     c                   close     fiarbt0f
221210060209     c                   close     fiarbu0f
221220060209     C*
221230060209     c                   endsr
221240060209
221250050209      *--------------------------------------------------------------*
221260050209      * Chaino fncls per codice ass. per impostazione §b4af1
221270050209      *--------------------------------------------------------------*
221280050209     c     Sr_fncls      BegSr
221290050209     c                   clear                   WCLSflo8
221300050209     c     §b4aks        chain     fncls01l
221310050209     c                   if        %found(fncls01l)
221320050209     c                   eval      wclsflo8 = %SUBST(clsflo:8:1)
221330050209     c                   endif
221340050209     c                   endsr
221350030704
221360030704      *--------------------------------------------------------------*
221370030704      * Scrivo/Aggiorno Fiar5
221380030704      *--------------------------------------------------------------*
221390030704     c     Sr_wrtFiar5   BegSr
221400030704
221410030704     c                   If        %Found(Fiar501l)
221420030704     c                   Update    Fiar5000
221430030704     c                   Else
221440030704     c                   Eval      Ar5Aas = BlpAas
221450030704     c                   Eval      Ar5Lnp = BlpLnp
221460030704     c                   Eval      Ar5Nrs = BlpNrs
221470030704     c                   Eval      Ar5Nsp = BlpNsp
221480030704     c                   Eval      Ar5Trd = KAr5Trd
221490030704     c                   Eval      Ar5Ft1 = 'T'
221500030704     c                   Eval      Ar5Dt1 = *All'9'
221510030704     c                   Eval      Ar5Ft2 = 'T'
221520030704     c                   Eval      Ar5Dt2 = *All'9'
221530030704     c                   Write     Fiar5000
221540030704     c                   EndIf
221550030704
221560030704     c                   EndSr
221570030326
221580030326      *--------------------------------------------------------------*
221590030326      * Forzo la data consegna richiesta
221600030326      *--------------------------------------------------------------*
221610030326     c     SrDcr         BegSr
221620111206     c* questa DS mi serve per controllare la data calcolata con i giorni
221630111206     c*  di chiusura, solo in caso di partciolarità di attesa
221640111206     c*  richiamerò non il TRUL13 ma il TRUL13R1
221650111206     c                   clear                   trul13ds1
221660100218     c
221670100218    1c                   select
221680030409      * Se non ho le ore da aggiungere alla delivery
221690100218If  1c                   when      VidOre > *Zeros
221700100218     c
221710100218     c                   Eval      wwtcr = 'P'
221720100218     c                   Eval      wore = VidOre
221730100218     c                   if        blptsp='C' or blptsp='E'
221740100218     c                   eval      wore=wore+24
221750100218     c                   endif
221760100218     c                   if        blptsp<>'H'
221770100218     c                   Exsr      CalDcr
221780100218     c                   endif
221790100218     c
221800100218     c* Se ho la particolarità, cerco con particolarità
221810100218    1c                   when      vidgma<>'  ' and §7ratt='S'
221820100218     c                   Clear                   dDcr
221830100218     c                   Clear                   dsbs02
221840100218     c                   Eval      T02Mod = 'C'
221850100218     c                   Eval      T02Sif = Knsif
221860100218     c                   Eval      T02Cod = 'DCR'
221870100218     c                   Movel     wksc          T02Ke1
221880100218     c                   Movel     'TTR'         t02ke2
221890100218     c                   Call      'TIBS02R'
221900100218     c                   Parm                    Kpjba
221910100218     c                   Parm                    Dsbs02
221920100218     c
221930100218      * se il cliente è codificato in tabella calcolo la nuova data
221940100218      * consegna richiesta
221950100218If  2c                   If        T02Err = *Blanks
221960100218     c                   Movel     T02Uni        dDcr
221970100218     c                   Eval      wore = §DcrOre
221980100218     c                   Eval      wwtcr = §DcrTcr
221990111206     c* Imposto i giorni di chiusura
222000111206     c                   eval      i13gc1=vidgc1
222010111206     c                   eval      i13gc2=vidgc2
222020111206     c                   eval      i13tcr=wwtcr
222030100218     c                   Exsr      CalDcr
222040100218     c                   endif
222050100218     c
222060100218   x1c                   other
222070100218      * Forzo la data consegna richiesta con tabella DCR se:
222080100218      * 1) non è una bolla di recupero o un conto servizi
222090100218      * 2) non è un tipo serivizio "H"=Consegna ore 10:30
222100100218      * 3) non è un tipo serivizio "E"=priority
222110100218      *  se trovo la tabella DCR con cliente/tariffa o solo cliente
222120100218     c
222130100218If  2c                   If        §3arbl = 'N' and blptsp<>'H'
222140100217     c                             and blptsp<>'E'
222150100215
222160030326     c                   Clear                   dDcr
222170030326     c                   Clear                   dsbs02
222180030326     c                   Eval      T02Mod = 'C'
222190030326     c                   Eval      T02Sif = Knsif
222200030326     c                   Eval      T02Cod = 'DCR'
222210100215     c                   Movel     wksc          T02Ke1
222220100218     c                   Movel     VidCtr        t02ke2
222230030326     c                   Call      'TIBS02R'
222240030326     c                   Parm                    Kpjba
222250030326     c                   Parm                    Dsbs02
222260030326      * se il cliente è codificato in tabella calcolo la nuova data
222270030326      * consegna richiesta
222280100218If  3c                   If        T02Err <>*Blanks
222290100218     c                   Eval      T02Mod = 'C'
222300100218     c                   Eval      T02Sif = Knsif
222310100218     c                   Eval      T02Cod = 'DCR'
222320100218     c                   Movel     wksc          T02Ke1
222330100218     c                   clear                   t02ke2
222340100218     c                   Call      'TIBS02R'
222350100218     c                   Parm                    Kpjba
222360100218     c                   Parm                    Dsbs02
222370100218    3c                   endif
222380100218     c
222390100218If  3c                   If        T02Err = *Blanks
222400030326     c                   Movel     T02Uni        dDcr
222410030409     c                   Eval      wore = §DcrOre
222420030409     c                   Eval      wwtcr = §DcrTcr
222430030409     c                   Exsr      CalDcr
222440100218    3c                   EndIf
222450100218    2c                   EndIf
222460100218    1c                   Endsl
222470030326
222480030326     c                   EndSr
222490030409
222500030409      *--------------------------------------------------------------*
222510030409      * Calcolo le ore da aggiungere alla delivery
222520030409      *--------------------------------------------------------------*
222530030409     c     CalDcr        BegSr
222540100222     c* Se 24 ore per IL o  48 per PRIMA DDEL
222550100219     c*   devo aggiungere alla delivery anche i tempi
222560100219     c*   del C/ass altrimenti non servono (48 ore le ho comunque)
222570100222     c                   if        (wwTCR= ' ' and  wore>24)
222580100222     c                             or (wwTCR='P' and wore>48)
222590100222     c                             or wwTCR='D'
222600100219     c                   eval      UsaCass='N'
222610100219     c                   endif
222620100219     c
222630030409      * CALL AL TNSD99 x calcolare la data consegna teorica
222640030409     c                   ExSr      CLSE98
222650100219     c
222660100219      * Richiamo pgm che calcola la prima data lavorativa disponibile
222670030409     c                   Clear                   Trul13ds
222680030409     c                   Eval      tI13Tla = 'L'
222690030409     c                   Eval      I13Mod = 'A'
222700030409     c                   Eval      I13Fil = BlpLna
222710030409     c                   Eval      I13Din = d98dce
222720030409     c                   Eval      I13Hin = d98hce
222730030409     c                   Eval      I13Ore = wore
222740111206     c
222750111206     c* se impostati i giorni di chiusura, richiamo trul13r1
222760111206     c                   if        i13gc1<>*blanks or i13gc2<>*blanks
222770111206     c                   Call      'TRUL13R1'
222780111206     c                   Parm                    Trul13ds
222790111206     c                   Parm                    Trul13ds1
222800111206     c                   else
222810030409     c                   Call      'TRUL13R'
222820030409     c                   Parm                    Trul13ds
222830111206     c                   endif
222840111206     c
222850111206     c                   If        tO13Err = *Blanks and o13dfi>0
222860030409     c                   Eval      BlpTcr = wwtcr
222870030409     c                   Eval      BlpDcr = O13Dfi
222880030409     c                   EndIf
222890030409
222900030409     c                   EndSr
222910000209     C*
222920000209     C* CONTROLLO FILE FISGN00F -------------------------------------*
222930000209     C     CTRSGN        BEGSR
222940010116     C     KSGN          CHAIN     FISGN01L                           30
222950000209    3C     *IN30         IFEQ      *OFF
222960000209     C* SE NON E' LA STESSA SPEDIZIONE, ANNULLO
222970000209    4C     §LDAAS        IFNE      BLPAAS
222980000209     C     SGNLNP        ORNE      BLPLNP
222990000209     C     §LDNRS        ORNE      BLPNRS
223000000209     C     SGNNSP        ORNE      BLPNSP
223010000919    5C     SGNATB        IFNE      '*'
223020000920     C* Se il chi sono non è di nuova immissione non devo incrementare
223030000920     C* il progressivo ed in generale non è necessario updatare fisgn
223040000920     C* perchè in questo caso risulta già annullato
223050000920    6C     V8HCOL        IFEQ      *ZEROS
223060000209     C                   MOVEL     'A'           SGNATB
223070010116     C                   CLEAR                   SGNT6A
223080010116     C                   CLEAR                   SGNT6B
223090010116     C                   CLEAR                   SGNT6C
223100010116     C                   CLEAR                   SGNT6D
223110010116     C                   CLEAR                   SGNT6E
223120010116     C                   CLEAR                   SGNT6F
223130080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
223140000920    7C     SGNFL1        IFEQ      *BLANKS
223150000920     C                   MOVE      *ZEROS        WSGPRG            1 0
223160000920     C                   ELSE
223170000920     C                   MOVE      SGNFL1        WSGPRG
223180000920    7C                   ENDIF
223190000920     C                   ADD       1             WSGPRG
223200000920     C                   MOVE      WSGPRG        SGNFL1
223210000209     C                   UPDATE    FISGN000
223220150701     c                   exsr      sr_CalSgn
223230000921   X6C                   ELSE
223240001009     C     *IN79         IFEQ      *OFF
223250001011     C     WEXDPD        ANDNE     'S'
223260160225     c     w_adpd        andne     'S'
223270001009     C                   UNLOCK    FISGN01L
223280001009     C                   ENDIF
223290000920    6C                   ENDIF
223300000209     C                   MOVEL     'N'           WDKC
223310000919   x5C                   ELSE
223320000919     C* altra spedizione ma sgnatb='*' --> posso andare in update
223330000919     C                   MOVEL     'S'           WESSGN            1
223340000921     C                   CLEAR                   SGNST2
223350000920     C     *IN79         IFEQ      *OFF
223360001011     C     WEXDPD        ANDNE     'S'
223370160225     c     w_adpd        andne     'S'
223380000919     C                   UNLOCK    FISGN01L
223390000919    5C                   ENDIF
223400000920    5C                   ENDIF
223410000209   X4C                   ELSE
223420000209     C*
223430000921     C* MEMORIZZO CHE ESISTE FISGN --> VADO IN UPDATE
223440000921     C* SE PERO' E' ANNULLATO IL COLLO NON DEVO TRATTARLO COME DISK C
223450000921     C     SGNATB        IFEQ      'A'
223460000921     C                   MOVEL     'N'           WDKC
223470000921     C                   ELSE
223480000209     C                   MOVEL     'S'           WESSGN            1
223490000921     C                   ENDIF
223500000918     C     *IN79         IFEQ      *OFF
223510001011     C     WEXDPD        ANDNE     'S'
223520160225     c     w_adpd        andne     'S'
223530000918     C                   UNLOCK    FISGN01L
223540000918     C                   ENDIF
223550000209    4C                   ENDIF
223560000209     C*
223570000209   X3C                   ELSE
223580000209     C* IMMISSIONE
223590000919     C                   CLEAR                   SGNATB
223600000209     C                   MOVEL(P)  KWHO          SGNWHO
223610000211     C                   Z-ADD     §3ISEA        SGNSEA
223620000209     C                   MOVEL     'S'           SGNST1
223630000921     C                   CLEAR                   SGNST2
223640000921     C                   MOVE      '0'           SGNFL1
223650000211     C     BLPCCM        IFGT      0
223660000211     C                   MOVEL     BLPCCM        SGNKSC
223670000211     C                   ELSE
223680000211     C                   MOVEL     BLPKSC        SGNKSC
223690000908    4C                   ENDIF
223700000921     C                   MOVEL     BLPLNP        SGNLNP
223710000921     C                   MOVEL     BLPNSP        SGNNSP
223720010116     C                   CLEAR                   SGNT6A
223730010116     C                   CLEAR                   SGNT6B
223740010116     C                   CLEAR                   SGNT6C
223750010116     C                   CLEAR                   SGNT6D
223760010116     C                   CLEAR                   SGNT6E
223770010116     C                   CLEAR                   SGNT6F
223780080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
223790000922     C                   CLEAR                   SGNRST
223800000211    3C                   ENDIF
223810000211     C**
223820000209     C                   ENDSR
223830000921     C* ANNULLO FILE FISGN00F -------------------------------------*
223840000921     C     ANNSGN        BEGSR
223850000921    1C     SGNATB        IFEQ      'A'
223860000921    2C     SGNFL1        IFEQ      *BLANKS
223870000921     C                   MOVE      *ZEROS        WSGPRG
223880000921   X2C                   ELSE
223890000921     C                   MOVE      SGNFL1        WSGPRG
223900000921    2C                   ENDIF
223910000921    2C     WSGPRG        IFEQ      0
223920000921     C                   MOVE      '*'           SGNATB
223930000921   X2C                   ELSE
223940000921     C                   SUB       1             WSGPRG
223950000921     C                   MOVE      WSGPRG        SGNFL1
223960000921    2C                   ENDIF
223970000921   X1C                   ELSE
223980000921    2C     SGNATB        IFEQ      *BLANKS
223990000921     C                   MOVEL     '*'           SGNATB
224000000921    2C                   ENDIF
224010000921    1C                   ENDIF
224020010116     C                   CLEAR                   SGNT6A
224030010116     C                   CLEAR                   SGNT6B
224040010116     C                   CLEAR                   SGNT6C
224050010116     C                   CLEAR                   SGNT6D
224060010116     C                   CLEAR                   SGNT6E
224070010116     C                   CLEAR                   SGNT6F
224080080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
224090001005     C     WSGNR         IFEQ      'B'
224100060622     c     *in79         oreq      *on
224110001005     C                   UPDATE    FISGN005
224120001005     C                   ELSE
224130000921     C                   UPDATE    FISGN000
224140150701     c                   exsr      sr_CalSgn
224150001005     C                   ENDIF
224160000921     C                   ENDSR
224170991014      *
224180991014      * AGGIORNO VARIE IN FNBLP E IN FIAR7 -------------------------*
224190991014     C     WRTVAR        BEGSR
224200991014      *
224210991014     C                   SELECT
224220991026    4C     C             WHENGT    3
224230991014     C                   Z-ADD     BLPAAS        AR7AAS
224240991014     C                   Z-ADD     BLPLNP        AR7LNP
224250991014     C                   Z-ADD     BLPNRS        AR7NRS
224260991014     C                   Z-ADD     BLPNSP        AR7NSP
224270991014     C                   MOVEL     '1'           AR7TRC
224280991014     C                   MOVEL     V3CSV1        AR7SVN
224290991014     C                   Z-ADD     V3CVA1        AR7VAN
224300991014     C                   WRITE     FIAR7000
224310991014    4 *
224320991014    4C     C             WHENEQ    3
224330991027     C                   MOVEL     V3CSV1        WSV3
224340991027     C                   Z-ADD     V3CVA1        WVA3
224350991014     C                   ADD       1             C
224360991014    4 *
224370991014    4C     C             WHENEQ    2
224380991027     C                   MOVEL     V3CSV1        WSV2
224390991027     C                   Z-ADD     V3CVA1        WVA2
224400991014     C                   ADD       1             C
224410991014    4 *
224420991014    4C     C             WHENEQ    1
224430991027     C                   MOVEL     V3CSV1        WSV1
224440991027     C                   Z-ADD     V3CVA1        WVA1
224450991014     C                   ADD       1             C
224460991014    4C                   ENDSL
224470991014      *
224480991014     C                   ENDSR
224490040116      *
224500040116      *-------------------------------------------------------------*
224510040116      * Aggiorno le varie della seconda bolla
224520040116      *-------------------------------------------------------------*
224530040116     c     WrtVar1       BegSr
224540040116
224550040116s   1c                   Select
224560040116     c                   When      ContaSv > 3
224570040116     c                   Eval      Ar7Aas = BlpAas
224580040116     c                   Eval      Ar7Lnp = BlpLnp
224590040116     c                   Eval      Ar7Nrs = BlpNrs
224600040116     c                   Eval      Ar7Nsp = BlpNsp
224610040116     c                   Eval      Ar7Trc = '2'
224620040116     c                   Eval      Ar7Svn = w2sv(c)
224630040116     c                   Eval      Ar7Van = w2va(c)
224640040116     c                   Write     Fiar7000
224650040116
224660040116     c                   When      ContaSv = 3
224670040116     c                   Movel     w2sv(c)       wsv3
224680040116     c                   Z-add     w2va(c)       wva3
224690040116     c                   Add       1             ContaSv
224700040116
224710040116     c                   When      ContaSv = 2
224720040116     c                   Movel     w2sv(c)       wsv2
224730040116     c                   Z-add     w2va(c)       wva2
224740040116     c                   Add       1             ContaSv
224750040116
224760040116     c                   When      ContaSv = 1
224770040116     c                   Movel     w2sv(c)       wsv1
224780040116     c                   Z-add     w2va(c)       wva1
224790040116     c                   Add       1             ContaSv
224800040116    1c                   EndSl
224810040116
224820040116     c                   EndSr
224830991014     C*
224840991014     C* CONTROLLO SE BOLLA DA STAMPARE O MNEO ----------------------*
224850991014     C     CTRSTA        BEGSR
224860970328     C                   MOVEL     '1'           WSTA
224870970328     C* SOLO PER RICHIAMO DA CONFERMA BOLLA
224880970328     C*  SE NON E' DA STAMPARE FACCIO FINTA CHE SIA STAMPA STAMPATA
224890970328     C     *IN12         IFEQ      *ON
224900970328     C     *IN15         ANDEQ     *ON
224910970328     C*
224920970407     C                   SELECT
224930970407     C     WFPR          WHENEQ    'G'
224940970328     C     BLPLNP        ANDEQ     BLPLNA
224950970328     C                   MOVEL     ' '           WSTA
224960970328     C* SE NON E' DA STAMPARE, NON STAMPO
224970970407     C     §1BFG3        WHENNE    'N'
224980970328     C                   MOVEL     ' '           WSTA
224990970328     C* SE FLAG "P" NON STAMPO MAI
225000970407     C     WFPR          WHENEQ    'P'
225010970328     C                   MOVEL     ' '           WSTA              1
225020970407     C**
225030970407     C* SE NON VENGO DA CONFERMA BOLLE STAMPO SEMPRE SUBITO
225040140612     C***  §LPRIC        WHENNE    'C'
225050160304     c***                when      §lpric<>'C'
225060160304     c***                          and (%lookup('999':sk_VPODIR)=0 and
225070160304     c***                               %lookup(%editc(blplnp:'X'):sk_VPODIR)=0)
225080160304     C***                MOVEL     'S'           WSTA
225090970407     C                   ENDSL
225100970328     C*
225110970328     C                   ENDIF
225120970328     C                   ENDSR
225130970328     C*
225140020917     C*--- CANCELLO RECORD FIVAD00F ----------------------------------*
225150951019     C     DELVAD        BEGSR
225160020917     C     KBLC          SETLL     FIVAD000                               30
225170910220     C   30              DO        *HIVAL
225180020917     C     KBLC          READE     FIVAD000                               30
225190020917     C  N30              DELETE    FIVAD000
225200910220     C  N30              END
225210910220     C*
225220910220     C                   ENDSR
225230020917     C*--- CANCELLO RECORD FIVAT00F ----------------------------------*
225240980406     C     DELVAT        BEGSR
225250020917     C     KBLC          SETLL     FIVAT000                               30
225260980406     C   30              DO        *HIVAL
225270020917     C     KBLC          READE     FIVAT000                               30
225280020917     C  N30              DELETE    FIVAT000
225290980406     C  N30              END
225300980406     C*
225310980406     C                   ENDSR
225320040601     c*
225330040601     C*--- CANCELLO RECORD FIVAX00F ----------------------------------*
225340040601     C     DELVAX        BEGSR
225350040601     C     KBLC          SETLL     FIVAX000                               30
225360040601     C   30              DO        *HIVAL
225370040601     C     KBLC          READE     FIVAX000                               30
225380040601     C  N30              DELETE    FIVAX000
225390040601     C  N30              END
225400040601     C*
225410040601     C                   ENDSR
225420940214     C*
225430940214     C* ROTTURA CODICE PRODOTT DA DETTAGLIO COLLI CLIENTE -----------*
225440940214     C     ROTCDP        BEGSR
225450940214     C*
225460940214     C                   Z-ADD     COMSCD        BLDNCD
225470940214     C     BLDNCD        ADD       VARNCL        BLDNCA
225480940214     C                   SUB       1             BLDNCA
225490940214     C                   ADD       VARNCL        COMSCD
225500940214     C     BLDNCA        IFEQ      BLDNCD
225510940214     C                   Z-ADD     0             BLDNCA
225520940214     C                   END
225530000426     C                   MOVEL     BLDNCL        SA2NCL
225540000426     C                   MOVE      BLDCDP        SA2CDP
225550000426     C                   MOVEL     VARNCL        BLDNCL
225560000426     C                   MOVE      VARCDP        BLDCDP
225570940224     C* CREA O AGGIORNA SEGNACOLLI
225580940214     C                   EXSR      CRTBLD
225590001002     C*
225600000426     C                   MOVEL     SA2NCL        BLDNCL
225610000426     C                   MOVE      SA2CDP        BLDCDP
225620940214     C                   ADD       VARNCL        BLDNC1
225630940214     C                   MOVEL     BLDCDP        VARCDP
225640940214     C                   CLEAR                   VARNCL
225650940214     C                   ENDSR
225660991117     C*
225670991117     C*--- IMPOSTO NUMERO DISTINTA PER SPED DPD ----------------------*
225680991117     C     SPEDPD        BEGSR
225690991117      *
225700991117     C                   CLEAR                   DPDBRC
225710991117      *
225720060510     C                   MOVE      §OGDP1        DPDLNP
225730991117      *
225740991117     C                   MOVEL     BLPMGS        W0020
225750991117     C                   MOVE      W0020         DPDGMS
225760991117     C                   MOVE      BLPMGS        W0020
225770991117     C                   MOVEL     W0020         DPDGMS
225780991117      * Aggancio numeratore 190 per progressivo distinta
225790991117     C                   CLEAR                   NUFNUM
225800991117     C                   EXSR      DPDNUM
225810991117     C                   Z-ADD     NUFNUM        DPDNDS
225820991117      * Calcolo CHECK DIGIT
225830991117     C                   EXSR      M1031
225840991117      *
225850991117     C                   ENDSR
225860991117      *
225870991117      ** CALCOLA CHECK DIGIT -----------------------------
225880991117     C     M1031         BEGSR
225890991117      *
225900991117     C                   MOVE      *ZERO         §TT2              3 0
225910991117     C                   CLEAR                   W0030
225920991117     C                   CLEAR                   W0010
225930991117      *
225940991117      * TOTALIZZO I VALORI, QUELLI NELLE POSIZIONI DISPARI PER 3
225950991117     C                   DO        11            XX                2 0
225960991117      *
225970991117     C     XX            DIV       2             §CTR              3 0
225980991117     C                   MVR                     §RST              3 030
225990991117      *
226000991117     C     *IN30         IFEQ      '1'
226010991117     C     §11(XX)       MULT      3             §CTR
226020991117     C                   ELSE
226030991117     C                   Z-ADD     §11(XX)       §CTR
226040991117     C                   ENDIF
226050991117      *
226060991117     C                   ADD       §CTR          W0030
226070991117     C                   ENDDO
226080991117      *
226090991117     C     W0030         ADD       9             §TT2
226100991117     C                   MOVE      0             §TT2
226110991117     C     §TT2          SUB       W0030         DPDCHD
226120991117      *
226130991117     C                   ENDSR
226140991117      *
226150991117      *--- NUMERO DISTINTA DPD ---------------------------------------*
226160991117     C     DPDNUM        BEGSR
226170991117      *
226180991117     C                   Z-ADD     BLPMGS        DATA6
226190991117     C                   MOVE      BLPAAS        W0020
226200991117     C                   MOVEL     W0020         DATA6
226210991117     C                   Z-ADD     190           CNU
226220991117      *
226230991118     C     KNUF3         CHAIN     FLNUF2                             30
226240991117      * SE NON TROVATO IL NUMERATORE PROVO A CREARLO
226250991117     C     *IN30         IFEQ      *ON
226260991117     C                   CLEAR                   FLNUF2
226270991117     C                   Z-ADD     CNU           NUFCNU
226280991117     C                   Z-ADD     DATA6         NUFDAT
226290991117     C                   WRITE     FLNUF2
226300991118     C     KNUF3         CHAIN     FLNUF2                             30
226310991118     C                   ENDIF
226320991117      *
226330991117     C     *IN30         IFEQ      *OFF
226340991117     C                   ADD       1             NUFNUM
226350991117     C                   UPDATE    FLNUF2
226360991117     C                   ENDIF
226370991117      *
226380991117     C                   ENDSR
226390991130      *
226400991130      *--- EVENTI DPD ------------------------------------------------*
226410991130     C     EVEDPD        BEGSR
226420991130      *
226430060619     C                   MOVE      'S'           WEU12             1
226440991130      *
226450060619     C                   CLEAR                   fieu12ds
226460060619     C                   Z-ADD     BLPAAS        i12AAS
226470060619     C                   Z-ADD     BLPLNP        i12LNP
226480060619     C                   Z-ADD     BLPNRS        i12NRS
226490060619     C                   Z-ADD     BLPNSP        i12NSP
226500060619     C                   Z-ADD     BLPLNA        i12LNA
226510060619     C                   movel     v7cnpr        i12parcel
226520060619     c                   movel     'I'           i12ie
226530991130      *
226540060619     C                   CALL      'FIEU12R'
226550991130     C                   PARM                    KPJBA
226560060619     C                   PARM                    fieu12ds
226570991130      *
226580991130     C                   ENDSR
226590991117      *
226600991117      *--- STAMPA BOLLE ----------------------------------------------*
226610900508     C     STAMPA        BEGSR
226620941107     C*
226630941107     C                   MOVEL     'P'           DB0TBO
226640110323     C                   MOVEL     'B'           DB0GES
226650990610     C* STAMPO DI UN FRANCO PREPAGATO
226660990610     C     PARTCH        IFEQ      'P'
226670010307     C     §LPFPR        OREQ      'O'
226680990610     C                   MOVEL     '8'           DB0TBO
226690110323     c* Per la stampa di un prepagato
226700110323     c* non va più bene richiamare con "B" perchè non c'è la possibilità
226710110323     c* di passare l'importo del bollo (bisognerebbe modificare la fnlsb5ds
226720110323     c* ma per il momento non è il caso mentre non va bene il campo db0ese pechè
226730110323     c* è stato pensato per contenere la somma degli importi esenti..)
226740110323     c* Quindi richiamo con DB0GES=' ': in questo modo il pgm di stampa
226750110323     c* reperisce autonomamente i dati della bolla incluso il bollo se presente
226760110323     C                   MOVEL     ' '           DB0GES
226770990610     C                   ENDIF
226780941108     C*
226790941108     C* SE SONO IN MANUTENZIONE SI TRATTA DI RISTAMPA
226800941108    1C     *IN12         IFEQ      *ON
226810941108     C     *IN15         ANDEQ     *OFF
226820941108     C                   MOVEL     'R'           DB0RIS
226830941108    1C                   ENDIF
226840941107     C*
226850941107     C                   MOVEL     BLPCBO        DB0CBO
226860941107     C                   MOVEL     §3ATB1        DB0TB1
226870941107     C                   MOVEL     §3ATB2        DB0TB2
226880990610     C* DE NON E' PREPAGATO STAMPO LA DECODIFICA DEL TIPO BOLLA
226890990628     C     PARTCH        IFNE      'P'
226900010307     C     §LPFPR        ANDNE     'O'
226910990610     C                   MOVEL(P)  §3ADES        DB0DCB
226920990610     C                   ELSE
226930990610     C                   MOVEL(P)  CPREPA        DB0DCB
226940990610     C                   ENDIF
226950990610     C**
226960941107     C                   MOVEL     BLPTSP        DB0TSP
226970941107     C                   Z-ADD     1             C
226980941107     C     BLPTSP        LOOKUP    TSP(C)                                 30
226990941107     C   30              MOVEL     DTS(C)        DB0DTS
227000941115     C   30              MOVEL     STS(C)        DB0FST
227010941107     C*
227020941107     C                   MOVEL     BLPAAS        DB0AAS
227030941107     C                   MOVEL     BLPMGS        DB0MGS
227040941107     C                   MOVEL     BLPLNP        DB0LNP
227050941107     C                   MOVEL     BLPNRS        DB0NRS
227060941107     C                   MOVEL     BLPNSP        DB0NSP
227070941107     C                   MOVEL     BLPTC1        DB0TC1
227080941107     C                   MOVEL     BLPTC2        DB0TC2
227090941107     C                   MOVEL     BLPFNS        DB0FNS
227100941107     C                   MOVEL     BLPRMN        DB0RMN
227110941107     C                   MOVEL     BLPRMA        DB0RMA
227120941107     C                   MOVEL     BLPIAS        DB0IAS
227130941107     C                   MOVEL     BLPVAS        DB0VAS
227140941107     C                   MOVEL     BLPVMD        DB0VMD
227150941107     C                   MOVEL     BLPVAD        DB0VAD
227160961007     C     TAMFVD        IFNE      '4'
227170941107     C                   MOVEL     BLPQFT        DB0QFT
227180961007     C                   ENDIF
227190941107     C                   MOVEL     VIDTIC        DB0TIC
227200980806     C* SE L'IMPORTO DEL C/A E' OLTRE IL LIMITE PRENDO DESCRIZIONE OLTR
227210980806     C                   MOVEL     §1ADES        DB0DTI
227220980806     C**
227230980806     C     §1ADEO        IFNE      *BLANKS
227240980806     C** DESCRIZIONE OLTRE LIMITE
227250011212     C     FCASAV        IFNE      *BLANKS
227260980806     C                   MOVEL     §1ADEO        DB0DTI
227270980806     C                   ENDIF
227280980806     C                   ENDIF
227290980806     C**
227300950208     C                   MOVEL     §1AUCM        DB0UCM
227310950208     C                   MOVEL     §1ASTE        DB0STE
227320941107     C                   MOVEL     VIDCAS        DB0CAS
227330941107     C                   MOVEL     VIDVCA        DB0VCA
227340941107     C                   MOVEL     VIDGCA        DB0GCA
227350941107     C                   MOVEL     BLPLNA        DB0LNA
227360941107     C                   MOVEL     BLPZNC        DB0ZNC
227370941107     C* CODICE MITENTE PIENO
227380941108    1C     BLPCCM        IFGT      0
227390941107     C                   Z-ADD     BLPCCM        DB0CCM
227400941108   X1C                   ELSE
227410941107     C* SE NON E' ASSEGNO LO IMPOSTO DA KSC
227420941108    2C     *IN04         IFEQ      *OFF
227430941107     C                   MOVEL     BLPKSC        DB0CCM
227440950125     C* SOLO SE BOLLA FRANCO PASSO LA P.IVA
227450061110     C***                MOVEL     BLPCPI        DB0CPI
227460061110     c* Adesso nel campo della partita iva ci passo il codice fiscale per
227470061110     c*  la stampa
227480061110     c                   movel     vidcdf        db0cpi
227490941108    2C                   ENDIF
227500941108    1C                   ENDIF
227510941107     C*
227520941107     C* ASSEGNATO O 2 BOLLA: CODICE DESTINATARIO LNA9999
227530941108    1C     §3ATB2        IFNE      *BLANKS
227540941108     C     *IN04         OREQ      *ON
227550941107     C                   Z-ADD     9999          DB0CCD
227560941107     C                   MOVEL     BLPLNA        DB0CCD
227570941108    1C                   ENDIF
227580941107     C                   MOVEL     BLPRSM        DB0RSM
227590941107     C                   MOVEL     BLPINM        DB0INM
227600941107     C                   MOVEL     BLPLOM        DB0LOM
227610941107     C                   MOVEL     BLPCAM        DB0CAM
227620941107     C                   MOVEL     BLPFAP        DB0FAP
227630941107     C                   MOVEL     BLPNZM        DB0NZM
227640941107     C                   MOVEL     BLPPRM        DB0PRM
227650941107     C*
227660941107     C                   MOVEL     BLPRSD        DB0RSD
227670950123     C                   MOVE      WRD2          DB0RD2
227680941107     C                   MOVEL     BLPIND        DB0IND
227690941107     C                   MOVEL     BLPLOD        DB0LOD
227700941107     C                   MOVEL     BLPCAD        DB0CAD
227710941107     C                   MOVEL     BLPFIN        DB0FIN
227720941107     C                   MOVEL     BLPNZD        DB0NZD
227730941107     C                   MOVEL     BLPPRD        DB0PRD
227740941107     C                   MOVEL     BLPRMO        DB0RMO
227750941107     C                   MOVEL     BLPGC1        DB0GC1
227760941107     C                   MOVEL     BLPGC2        DB0GC2
227770941107     C                   MOVEL     BLPNAS        DB0NAS
227780941107     C                   MOVEL     BLPNCL        DB0NCL
227790941107     C                   MOVEL     BLPPKF        DB0PKF
227800941107     C                   MOVEL     BLPVLF        DB0VLF
227810941115     C                   MOVEL     BLPFVF        DB0FVF
227820941107     C                   MOVEL     BLPFLS        DB0FLS
227830941107     C                   MOVEL     BLPNCD        DB0NCD
227840941107     C                   MOVEL     BLPNCA        DB0NCA
227850941107     C                   MOVEL     BLPXCO        DB0XCO
227860941107     C                   MOVEL     VIDNT1        DB0NT1
227870941107     C                   MOVEL     VIDNT2        DB0NT2
227880941107     C                   MOVEL     BLPFFD        DB0FFD
227890941107     C                   MOVEL     BLPDCR        DB0DCR
227900941107     C                   MOVEL     BLPTCR        DB0TCR
227910941107     C                   MOVEL     BLPHCR        DB0HCR
227920941107     C                   MOVEL     BLPFBR        DB0FBR
227930941107     C                   MOVEL     BLPGGA        DB0GGA
227940941107     C                   MOVEL     BLPGMA        DB0GMA
227950960208     C                   MOVEL     VIDGVA        DB0GVA
227960950125     C                   MOVEL     BLPSOP        DB0SOP
227970950626     C                   MOVEL     BLPCTR        DB0CTR
227980990628     C                   MOVEL     BLPDRT        DB0DRT
227990990628     C                   MOVEL     BLPNRT        DB0NRT
228000990628     C                   MOVEL     BLPPDR        DB0PDR
228010990628     C                   MOVEL     BLPFPP        DB0FPP
228020950102     C   12
228030950102     CANN15              MOVEL     'V'           DB0RIS
228040970206     C*
228050970206     C* ALLEGA BAM
228060970206     C     BLPFST        IFEQ      'S'
228070970206     C     BLPFST        OREQ      'C'
228080970206     C                   MOVEL     'S'           DB0BAM
228090970206     C                   ENDIF
228100970206     C*
228110030611     C                   CALL      WD90PSL
228120030626     C                   PARM                    fnlsb5DS
228130130318     c                   parm                    FNLSB6ds1
228140941108     C*
228150941108     C                   Z-ADD     1             I100
228160941107     C**
228170900508     C                   ENDSR
228180900511     C*
228190990701     C*--- CARICO RECORD DI MANUTENZIONE -----------------------------*
228200010215     C     CARBLP        BEGSR
228210990630     C                   SETOFF                                       22
228220990701     C                   CLEAR                   SAVNFT
228230070918     c                   clear                   s_drt
228240950206     C                   Z-ADD     KCI           CCC
228250011025      *
228260011025     C                   CLEAR                   FLGVRN
228270030204     c                   Clear                   wPkg
228280030204     c                   Clear                   wNba
228290070322     c                   clear                   wparcel
228300091221     c                   clear                   wvidgma
228310100604     c                   clear                   w7rRC
228320011025      *
228330900511     C* CHAIN
228340061212     C     KBLP3         CHAIN     FNBLP01l
228350061212     c                   if        %found(fnblp01l)
228360061218     c                   z-add     blpnrr        savnrr
228370061212     c     blpnrr        chain     fnblp00f                           90
228380950102     C     *IN90         IFEQ      *OFF
228390940927     C*
228400940927     C* DATA SPEDIZIONE
228410930414     C                   Z-ADD     BLPMGS        BLPDSP
228420930414     C                   MOVEL     BLPAAS        BLPDSP
228430000104     C                   Z-ADD     BLPMGS        WBDSP             8 0
228440000104     C                   MOVEL     BLPAAS        WBDSP
228450940927     C* DATA RITIRO MERCE
228460940927     C                   Z-ADD     BLPDRT        VIDDRT
228470081111     C                   Z-ADD     BLPDRT        s_drtblpi
228480940927     C* DATA CONSEGNA RICHIESTA
228490940927     C                   Z-ADD     BLPDCR        VIDDCR
228500940927     C*
228510960926     C* AUTOTRASPORTATORE
228520950126     C                   MOVE      BLPPDR        SAVPDR
228530990915     C                   MOVE      BLPPDR        SAVPD4
228540940928     C                   MOVE      BLPPDR        VIDPDR
228550010220     C                   MOVE      BLPPDR        PREPDR
228560990915     C                   MOVE      BLPFPP        VIDFPP
228570010220     C                   MOVE      BLPFPP        PREFPP
228580991001     C* SE ERA PREPAGATO, FACCIO ALMENO VEDERE SE MERCE PORTATA A MAG
228590991001     C                   MOVEL     BLPFDN        VIDMAG
228600900511     C*
228610900516     C                   MOVE      BLPNSP        VIDNSP
228620900511     C                   MOVEL     BLPNRS        VIDNRS
228630900511     C                   MOVEL     BLPLNP        VIDLNP
228640910805     C                   MOVEL     BLPFNS        VIDFNS            1
228650040506
228660040506      * Imposto la ds di comodo del n. spedizione
228670040506     c                   Z-add     BlpNsp        WidNsp
228680040506     c                   Z-add     BlpNrs        WidNrs
228690040506     c                   Z-add     BlpLnp        WidLnp
228700040506
228710970128     C* ALLEGA BAM
228720970128     C     BLPFST        IFEQ      'S'
228730970128     C     BLPFST        OREQ      'C'
228740970128     C                   MOVEL     'S'           VIDBAM
228750970128     C                   ELSE
228760970128     C                   MOVEL     'N'           VIDBAM
228770970128     C                   ENDIF
228780970404     C                   MOVEL     BLPFST        SAVBAM
228790940920     C* CODICE BOLLA
228800940920     C                   MOVEL     BLPCBO        VIDCBO
228810081023     C                   MOVEL     BLPCBO        cbo_blp
228820940920     C* SIGLA OPERATORE
228830940920     C                   MOVEL     BLPSOP        VIDSOP
228840900511     C* LINEA ARRIVO E DECODIFICA
228850900511     C                   MOVEL     BLPLNA        VIDLNA
228860070404     C                   MOVEL     BLPLNA        lna_sav
228870960926     C* PUNTO OPERATIVO CLIENTE
228880940927     C     BLPCCM        IFGT      0
228890940927     C                   MOVEL     BLPCCM        W0030
228900940927     C                   MOVE      BLPCCM        VIDCCM
228910940927     C                   MOVEL     BLPCCM        WKSC
228920940927     C                   ELSE
228930940927     C                   MOVEL     BLPKSC        W0030
228940940927     C                   MOVE      BLPKSC        VIDCCM
228950940927     C                   MOVEL     BLPKSC        WKSC
228960940927     C                   ENDIF
228970940927     C* SALVO IL CODICE MITTENTE
228980060515     C                   MOVEL     WKSC          bolksc
228990060515     C                   MOVEL     WKSC          SAVMIT
229000941115     C                   MOVEL     VIDCCM        WCCMS
229010940927     C* PARTITA IVA
229020940927     C                   MOVEL     BLPCPI        WPIVA
229030940929     C*
229040940929     C* VEDO SE C'E' TASSAZIONE
229050991006     C                   MOVEL     '1'           WTRC
229060991006     C     KBLP4         CHAIN     FIAR6000                           30
229070940929    1C     *IN30         IFEQ      *OFF
229080050331     c                   move      ar6ksc        wKSCsf1
229090991006     C                   MOVEL     'E'           WAR61             1
229100050331     c* se c'è cod. S.F. significa che bolla tassata in arrivo:NON DEVO
229110050331     c* CARICARLA
229120050331   1ac                   if        wKSCsf1 = 0000 or wKSCsf1 = 9999
229130940929     C*
229140991012     C                   MOVEL     AR6POR        VIDPOR
229150991012     C                   MOVEL     AR6POR        MEMPOR
229160991006     C                   MOVEL     AR6IMV        VIDIMV
229170991006     C                   MOVEL     AR6IMV        SAVIMV
229180060208     C                   MOVEL     AR6IMV        SAVIMVO
229190151014     C                   MOVEL     AR6IMV        SAVIMV_fat
229200991006     C                   MOVEL     AR6CEI        VIDCEI
229210991008     C                   MOVEL     AR6DIV        VIDDIV
229220991011     C                   MOVEL     AR6DIV        WDIV1
229230940929     C*
229240991006     C                   MOVEL     AR6NFT        SAVNFT
229250991006     C                   MOVEL     AR6NFT        VIDNFT
229260991006     C                   MOVEL     AR6FIV        VIDFIV
229270991006     C                   MOVEL     AR6DFT        VIDDFT
229280060208     C                   MOVEL     AR6DFT        DFTar6
229290991006     C     AR6NFT        IFGT      0
229300991006     C     AR6NFT        ANDLT     §QTNFT
229310990630     C                   SETON                                        22
229320991006     C                   Z-ADD     AR6IFT        VIDIFT
229330990630     C                   ENDIF
229340991027      *
229350940929     C                   Z-ADD     0             NRR
229360011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
229370011025     C     BLPFBR        IFEQ      'S'
229380011025     C                   SELECT
229390011025     C     AR6SV1        WHENEQ    'N'
229400011025     C     AR6VA1        ANDEQ     88888888
229410011025     C                   MOVEL     '1'           FLGVRN            1
229420011025     C     AR6SV2        WHENEQ    'N'
229430011025     C     AR6VA2        ANDEQ     88888888
229440011025     C                   MOVEL     '1'           FLGVRN
229450011025     C     AR6SV3        WHENEQ    'N'
229460011025     C     AR6VA3        ANDEQ     88888888
229470011025     C                   MOVEL     '1'           FLGVRN
229480011025     C                   ENDSL
229490011025     C                   ENDIF
229500991027      *
229510991027     C                   MOVEL     AR6SV1        WSVN
229520991027     C                   Z-ADD     AR6VA1        WVAN
229530940929     C                   EXSR      CARVAR
229540991027      *
229550991027     C                   MOVEL     AR6SV2        WSVN
229560991027     C                   Z-ADD     AR6VA2        WVAN
229570940929     C                   EXSR      CARVAR
229580991027      *
229590991006    2C     AR6SV3        IFNE      ' '
229600991027     C                   MOVEL     AR6SV3        WSVN
229610991027     C                   Z-ADD     AR6VA3        WVAN
229620940929     C                   EXSR      CARVAR
229630941021     C*
229640940929     C* VISTO CHE C'E' LA 3 VARIA VEDO SE CE NE SONO ANCORA
229650991006     C                   MOVEL     '1'           WTRC
229660991006     C     KBLP4         SETLL     FIAR7000
229670991006     C     KBLP4         READE     FIAR7000                               30
229680940929    3C     *IN30         DOWEQ     *OFF
229690011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
229700011025     C     BLPFBR        IFEQ      'S'
229710011025     C     FLGVRN        ANDNE     '1'
229720011025     C     AR7SVN        ANDEQ     'N'
229730011025     C     AR7VAN        ANDEQ     88888888
229740011025     C                   MOVEL     '1'           FLGVRN
229750011025     C                   ENDIF
229760011025      *
229770991006     C                   MOVEL     'E'           WAR7              1
229780991027     C                   MOVEL     AR7SVN        WSVN
229790991027     C                   MOVEL     AR7VAN        WVAN
229800940929     C                   EXSR      CARVAR
229810991006     C     KBLP4         READE     FIAR7000                               30
229820940929    3C                   ENDDO
229830940929    2C                   ENDIF
229840940929     C*
229850941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
229860941020     C     VIDPOR        IFNE      0
229870941020     C     NRR           ORNE      0
229880941020     C     VIDCEI        ORNE      ' '
229890941020     C                   MOVEL     'S'           WEMD03            1
229900941020     C                   ENDIF
229910991006      *
229920991006     C                   CLEAR                   FIAR6000
229930050331   1ac                   endif
229940940929    1C                   ENDIF
229950941107     C* TIPO SERVIZIO
229960941107     C                   MOVEL     BLPTSP        VIDTSP
229970941107     C                   MOVEL     BLPTSP        SAVTSP
229980941115     C                   MOVEL     BLPTSP        VARTSP
229990941115     C* CONSEGNE PARTICOLARI
230000941115     C                   MOVEL     BLPTC1        VIDTC1
230010941115     C                   MOVEL     BLPTC2        VIDTC2
230020091001     c                   movel     blptc1        sav_tc1
230030091001     c                   movel     blptc2        sav_tc2
230040001205     C                   MOVEL     BLPTC1        SAVTC1
230050001205     C                   MOVEL     BLPTC2        SAVTC2
230060140122     C****               MOVEL     BLPTC1        WSVTCP
230070140122     C****               MOVEL     BLPTC1        WTCP
230080940929     C*
230090940929     C* D E C O D I F I C H E
230100940927     C                   EXSR      DECBOL
230110120926     c* se cod.bolla franco recupero e bolla presente su giacenze in part
230120120926     c* per il recupero delle spese devo disabilitare F16=Annullamento
230130120926     c* Se non voglio più addebitare le spese devono stornare la bolla
230140120926     c* dalla manutenzione bolle di sede
230150120926     c                   if        savrbl='R' and  savtb1='F'
230160120926     C/exec sql
230170120927     c+ Select gcpagc into :wagc
230180120926     c+   from tigcp00f
230190120926     c+   where GCPLPW = :BLPLNP AND GCPASW=:BLPAAS AND GCPNSW=:BLPNRS
230200120927     c+     and GCPNBW = :BLPNSP AND GCPSEDE=' '
230210120926     C/end-exec
230220120926     c                   if        SqlCOD < 0 or sqlCOD = 100
230230120926     c                   else
230240120926      * se qui : ha trovato la giacenza E DISATTIVO QUINDI F16
230250120927     c                   movel     nodi          atrann
230260120926     c                   end
230270120926     c                   endif
230280990702     C* E MANCA LA DATA RITIRO O COD PADR, MI POSIZIONO SULLA DATA
230290990702     C*  RITIRO
230300990702     C     BLPPDR        IFEQ      0
230310990702     C     BLPDRT        OREQ      0
230320990702     C                   SETOFF                                       07
230330040909     c                   z-add     09            h1riga
230340040909     c                   z-add     20            h1colo
230350990702     C                   ENDIF
230360940929     C*
230370950125     C* SALVO LA DECODIFICA DEL TIPO SPEDIZIONE
230380950125     C                   MOVEL     V1DTSP        WDETSP           10
230390940928     C* VEDO SE CARICARE IL MITTENTE O NO
230400941005     C                   MOVEL     *BLANKS       VIDFAP
230410941005    1C     VIDCCM        IFEQ      8888
230420940928     C     VIDCCM        OREQ      9999
230430940928     C                   MOVEL     BLPRSM        VIDRSM
230440940928     C                   MOVEL     BLPINM        VIDINM
230450940928     C                   MOVEL     BLPLOM        VIDLOM
230460940928     C                   MOVEL     BLPCAM        VIDCAM
230470940928     C                   MOVEL     BLPPRM        VIDPRM
230480940928     C                   MOVEL     BLPNZM        VIDNZM
230490941005     C*
230500941005   X1C                   ELSE
230510941005     C*
230520941005     C* CHAIN SU CNACO PER VEDERE SE CAP E NAZIONE DIVERSI
230530941005     C     KACO          CHAIN     CNIND000                           30
230540941005     C*
230550941005    2C     *IN30         IFEQ      *OFF
230560941005    3C     INDCAE        IFNE      BLPCAM
230570941005     C     INDSTA        ORNE      BLPNZM
230580941005     C                   MOVEL     BLPCAM        VIDCMO
230590941005     C                   MOVEL     BLPNZM        VIDNMO
230600941005    3C                   ENDIF
230610941005    2C                   ENDIF
230620941005    1C                   ENDIF
230630910429     C*
230640941005     C* CHAIN PER VEDERE SE ESISTE LA 2 DESCRIZIONE DESTINATARIO
230650940927     C                   MOVEL     'D'           WTRC
230660060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
230670940927     C* TROVATA
230680940927     C     *IN30         IFEQ      *OFF
230690060215     C                   MOVE      ar4NOT        VIDRSD
230700060215     C                   MOVE      ar4NOT        SAVRSD
230710940927     C                   ENDIF
230720900511     C                   MOVEL     BLPRSD        VIDRSD
230730910405     C                   MOVEL     BLPRSD        SAVRSD
230740900511     C                   MOVEL     BLPIND        VIDIND
230750070404     C                   MOVEL     BLPIND        savIND
230760900511     C                   MOVEL     BLPPRD        VIDPRD
230770070404     C                   MOVEL     BLPPRD        savPRD
230780910405     C                   MOVEL     BLPCAD        SAVCAD
230790910405     C                   MOVEL     BLPCAD        VIDCAD
230800940930     C                   MOVEL     BLPCAD        VARCAD
230810900511     C                   MOVEL     BLPLOD        VIDLOD
230820070404     C                   MOVEL     BLPLOD        savLOD
230830940927     C                   MOVEL     BLPNZD        VIDNZD
230840020122     C                   MOVEL     BLPNZD        NZDINI
230850911031     C                   MOVEL     BLPCTS        SAVCTS
230860941107     C* CONTROLLO SE IL CLIENTE E' ITALIA O ESTERO
230870941107     C                   MOVEL     BLPNZD        WNAR
230880941107     C                   EXSR      CTRNAR
230890941107     C* NAZIONE CORRETTA
230900941107     C     WEMFOR        IFNE      '1'
230910941107     C     §15ITA        IFEQ      'I'
230920941108     C                   MOVEL     'I'           WDESIE
230930941107     C                   ELSE
230940941108     C                   MOVEL     'E'           WDESIE
230950941107     C                   ENDIF
230960941107     C*
230970941107     C* NAZIONE ERRATA: IMPOSTO SEMPRE "I"
230980941107     C                   ELSE
230990941108     C                   MOVEL     'I'           WDESIE
231000941107     C                   ENDIF
231010941107     C*
231020941107     C* VEDO SE BOLLA ITALIANA O ESTERA
231030971216     C     BLPLNP        CHAIN     AZORG01L      UNIORG               30
231040991203     C                   MOVEL     ORGDE3        OG143
231050000121     C* MEMORIZZO TELEFONO E FAX
231060000121     C                   MOVEL     ORGTEL        LNPTEL           15
231070000121     C                   MOVEL     ORGFAX        LNPFAX           15
231080971210     C**
231090160302     c****               clear                   trul27ds1
231100160302     c****               z-add     BlpPkf        I27Pkg
231110160302     c****               move      BlpCtr        I27Ctb
231120160302     c****               exsr      riccar
231130160302     c****               movel     o27fie        savfie
231140160302     c***                movel     o27ntw        s_27ntw
231150970407     C* MI SERVE PER IL CONFRONTO PER CARICARE I CODICI TARIFFA
231160970407     C     VIDCCM        IFNE      9999
231170940927     C                   MOVEL     WKSC          SAVCCM
231180970407     C                   ELSE
231190970407     C                   CLEAR                   SAVCCM
231200970407     C                   ENDIF
231210940927     C*
231220900607     C                   MOVEL     BLPCTR        VIDCTR
231230060515     C                   MOVEL     BLPCTR        BolCTR
231240150427     C                   MOVEL     blpctr        SAVCTR
231250971210     C* VEDO SE ESISTE NUMERO AWB SOLO PER IMPORTO SDI O EXPORT SDI
231260081008    1c**   §ogntw        ifeq      'EUP'
231270081008     c**   A_§ogntw      oreq      'EUP'
231280081008     C**                 MOVEL     'E'           WTRC
231290081008     C**   KBLP4         CHAIN(N)  Fiar4000                           30
231300081008    2C**   *IN30         IFEQ      *OFF
231310081008     C**                 MOVEL     ar4NOT        DSBL4E
231320081008     C**                 MOVEL     §B4ERP        W010A            10
231330971210     C**
231340081008    3C**   W010A         IFGT      *ZEROS
231350081008     C**                 MOVEL     §B4ERP        V6CAWB
231360081008     C**                 MOVEL     §B4ERP        SAVAWB
231370081008    3C**                 ENDIF
231380971210     C** INSERIMENTO MANUALE
231390081008     C**   §B4EMA        IFEQ      'M'
231400081008     C**                 MOVEL     'MANUALE'     V6CINS
231410081008     C**                 ENDIF
231420971210     C** INSERIMENTO AUTOMATICO
231430081008     C**   §B4EMA        IFEQ      'A'
231440081008     C**                 MOVEL     'AUTOMATI'    V6CINS
231450081008     C**                 MOVE      'CO'          V6CINS
231460081008     C**                 ENDIF
231470971210     C* STAMPATO S/N
231480081008     C**   §B4EST        IFEQ      'S'
231490081008     C**                 MOVEL     'SI'          V6CSTA
231500081008     C**                 ENDIF
231510081008    3C**   §B4EST        IFEQ      'N'
231520081008     C**                 MOVEL     'NO'          V6CSTA
231530081008    3C**                 ENDIF
231540081008    2C**                 ENDIF
231550971210     C**
231560081008    1C**                 ENDIF
231570991203      *
231580060620      * VEDO SE ESISTE NUMERO PARCEL PER IMPORT/EXPORT DPD
231590160323     c                   clear                   w_vediP
231600020319    1C     A_§OGNTW      IFEQ      'DPD'
231610060619    1C     §ogntw        oreq      'DPD'
231620060620     c*
231630061003     C***                MOVEL     'F'           WTRC
231640061003     C***  KBLP4         CHAIN(N)  Fiar4000                           30
231650061003    2C***  *IN30         IFEQ      *OFF
231660061003     C***                MOVEL     ar4NOT        DSBL4F
231670061003     C***                MOVEL     §B4FNP        savfnp
231680061003    2C***                ENDIF
231690060620     c*
231700060620     C                   MOVEL     'K'           WTRC
231710060620     C     KBLP4         CHAIN(N)  Fiar4000                           30
231720060620     C     *IN30         IFEQ      *OFF
231730060620     C                   MOVEL     ar4NOT        DSBL4K
231740060620     C                   MOVEL     §B4krt        savkrt
231750060620     C                   ENDIF
231760060620     c***
231770060605     C                   MOVEL     'I'           WTRC
231780060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
231790991203      *
231800991203    2C     *IN30         IFEQ      *OFF
231810060605     C                   MOVEL     ar4NOT        DSBL4I
231820991203      *
231830060619     c                   if        §b4ipn<>*blanks
231840060605     C                   MOVEL     §B4ipn        V7CNPR
231850060619     c* se parcel number lungo 11 aggiungo a video anche il check digit
231860060619     c                   if        %subst(§b4ipn:14:1)=*blanks
231870060619     c                   eval      %subst(v7cnpr:12:1)=§b4icd
231880060619     c                   endif
231890060619     C                   MOVEL     v7cnpr        SAVNPR
231900991203    3C                   ENDIF
231910160331     c                   if        §b4trd='1'
231920160331     c                   eval      w_vediP='1'
231930160331     c                   endif
231940991203      *
231950991203    2C                   ENDIF
231960991203    1C                   ENDIF
231970941115     C*
231980941115     C* CARICO LE NOTE
231990941115     C                   MOVEL     '8'           WTRC
232000060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232010941115     C* TROVATA
232020941115     C     *IN30         IFEQ      *OFF
232030060215     C                   MOVEL     ar4NOT        VIDNT1
232040941115     C*
232050941115     C                   MOVEL     '9'           WTRC
232060060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232070941115     C* TROVATA
232080941115     C     *IN30         IFEQ      *OFF
232090060215     C                   MOVEL     ar4NOT        VIDNT2
232100941115     C                   ENDIF
232110000124     C                   ENDIF
232120000124     C**
232130000124     C* SE LA PRIMA NOTA E' MESSA IN AUTOMATICO, LA CLEARO
232140000124     C                   MOVEL     VIDNT1        W012A            12
232150000124     C*
232160000124     C     W012A         IFEQ      CDPD
232170000124     C                   CLEAR                   VIDNT1
232180000124     C     VIDNT2        IFNE      *BLANKS
232190000124     C                   MOVEL     VIDNT2        VIDNT1
232200000124     C                   CLEAR                   VIDNT2
232210000124     C                   ENDIF
232220000124     C                   ENDIF
232230000623     C***
232240060216     C* VEDO SE CE' RECORD ar4 W
232250000623     C                   MOVEL     'W'           WTRC
232260060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232270000623     C  N30              MOVEL     'E'           WBL4W             1
232280121123     C***
232290121123     C* VEDO SE CE' RECORD ar4 Z
232300121123     c                   clear                   wesar4z
232310121123     c                   clear                   wtrasmz
232320121123     c                   clear                   wkscz
232330121123     C                   MOVEL     'Z'           WTRC
232340121123     C     KBLP4         CHAIN(N)  Fiar4000                           30
232350121123     c                   if        not *in30
232360121123     C                   MOVEL     'S'           Wesar4z           1
232370121123     C                   MOVEL     AR4NOT        DSBL4Z
232380121123     c                   if        §B4DTR=0
232390121123     C                   EVAL      WTRASMz='N'
232400121123     C                   ENDIF
232410121123     c                   move      §b4okc        wkscz
232420121123     c                   endif
232430061110     c*
232440061110     C* CARICO il codice fiscale se presente
232450061110     C                   MOVEL     'Q'           WTRC
232460061110     C     KBLP4         CHAIN(N)  Fiar4000                           30
232470061110     C     *IN30         IFEQ      *OFF
232480061110     c                   movel     ar4not        vidcdf
232490061110     c                   endif
232500141201
232510141201     C* CARICO il PIN CODE se presente
232520141201     C                   MOVEL     'Y'           WTRC
232530141201     C     KBLP4         CHAIN(N)  Fiar4000                           30
232540141201     C     *IN30         IFEQ      *OFF
232550141201     c                   movel     ar4not        dsbl4y
232560141201     c                   eval      wpincode=§B4PCD
232570141201     c                   endif
232580950410     c*
232590950410     C* CARICO LE P.IVA MITTENTE E DESTINATARIO
232600950410     C                   MOVEL     'P'           WTRC
232610060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232620950410     C     *IN30         IFEQ      *OFF
232630950410     C*
232640060215     C                   MOVEL     ar4NOT        WPIVA
232650050921     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
232660050921     c                   select
232670050921     c* solo numeri
232680050921     c* "PRIVATO senza iso
232690050921     c     *in30         wheneq    *off
232700050921     c     wiso          andge     *zeros
232710050921     c     *in30         oreq      *on
232720050921     c     posiz         andlt     3
232730050921     c                   movel     wpiva         vidcpm
232740050921     c* iso + numeri
232750050921     c* iso + "PRIVATO"
232760050921     c     *in30         wheneq    *off
232770050921     c     posiz         orgt      2
232780050921     c                   movel     wpiva         vidpim
232790050921     c                   endsl
232800050921     c
232810950410     C*
232820060215     C                   MOVE      ar4NOT        WPIVA
232830050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
232840050921     c                   select
232850050921     c* solo numeri
232860050921     c* "PRIVATO senza iso
232870050921     c     *in30         wheneq    *off
232880050921     c     wiso          andge     *zeros
232890050921     c     *in30         oreq      *on
232900050921     c     posiz         andlt     3
232910050921     c                   movel     wpiva         vidcpd
232920050921     c* iso + numeri
232930050921     c* iso + "PRIVATO"
232940050921     c     *in30         wheneq    *off
232950050921     c     posiz         orgt      2
232960050921     c                   movel     wpiva         vidpid
232970050921     c                   endsl
232980950410     C*
232990950410     C                   ENDIF
233000900607     C*
233010900604     C* FLAG INOLTRO PULISCO SE NON E' UNA ISOLA
233020900604     C                   MOVEL     ' '           VIDFIN
233030941115     C                   MOVEL     BLPFBR        VIDFBR
233040941115     C                   MOVEL     BLPGC1        VIDGC1
233050900511     C                   MOVEL     BLPGC2        VIDGC2
233060900511     C                   MOVEL     BLPFTM        VIDFTM
233070940927     C                   MOVEL     BLPIAS        VIDIAS
233080940927     C                   MOVEL     BLPVAS        VIDVAS
233090950410     C                   MOVEL     BLPVAS        VARVAS
233100940927     C                   MOVEL     BLPVMD        VIDVMD
233110940927     C                   MOVEL     BLPVAD        VIDVAD
233120950410     C                   MOVEL     BLPVAD        VARVAD
233130940927     C                   MOVEL     BLPQFT        VIDQFT
233140940928     C                   MOVEL     BLPGGA        VIDGGA
233150940928     C                   MOVEL     BLPGMA        VIDGMA
233160091221     c                   eval      wvidgma = blpgma
233170100604     c* Verifico se c'e' ritiro contestuale alla consegna
233180100604     c                   clear                   ds7r
233190100604     C                   MOVEL     '7R'          COD
233200100604     C                   MOVEL(P)  blpGMA        KEY
233210100604     C                   EXSR      CTABEL
233220100604     C  n30              MOVEL     TBLUNI        DS7R
233230100604     c                   eval      w7rRC = §7rRC
233240100604     c
233250960208     C                   CLEAR                   VIDGVA
233260960208     C                   MOVEL     BLPGVA        W001A
233270960208     C                   MOVEL     W001A         VIDGVA
233280900511     C                   MOVEL     BLPNAS        VIDNAS
233290900511     C                   MOVEL     BLPNCL        VIDNCL
233300940819     C                   MOVEL     BLPNCL        V1CNCL
233310930331     C                   MOVEL     BLPNCL        SAVNCL
233320980408     C                   MOVE      BLPNCD        SAVNCD
233330980408     C                   MOVE      BLPNCA        SAVNCA
233340940927     C                   MOVEL     BLPPKB        VIDPKG
233350940927     C                   MOVEL     BLPPKB        V2CPKG
233360980402     C                   MOVEL     BLPPKB        SAVPKG
233370940927     C                   MOVEL     BLPVLB        VIDVOL
233380980402     C                   MOVEL     BLPVLB        SAVVOL
233390090609     c                   movel     blppkb        wpes_pre
233400090609     c                   movel     blpvlb        wvol_pre
233410090609     C                   MOVEL     BLPNCL        wncl_pre
233420930512     C* VEDO RAGGRUPPAMENTO DEL VOLUME
233430940928     C                   MOVEL     BLPFVB        VIDFVR            1
233440930512     C                   MOVEL     '7T'          COD
233450940928     C                   MOVEL(P)  BLPFVB        KEY
233460930708     C                   EXSR      CTABEL
233470930512     C  N30              MOVEL     TBLUNI        DS7T
233480930708     C   30              CLEAR                   DS7T
233490910125     C*
233500900511     C                   MOVEL     BLPRMN        VIDRMN
233510060619     C******             MOVEL     BLPRMN        savrmn
233520940825     C                   MOVEL     BLPRMA        VIDRMA
233530940922     C                   MOVEL     BLPRMA        SAVRMA
233540900511     C                   MOVEL     BLPRMO        VIDRMO
233550900511     C                   MOVEL     BLPNCD        VIDNCD
233560900511     C                   MOVEL     BLPNCA        VIDNCA
233570960808     C                   MOVEL     BLPNCD        WNSNCD
233580960808     C                   MOVEL     BLPNCA        WNSNCA
233590900511     C                   MOVEL     BLPZNC        VIDZNC
233600930401     C                   MOVEL     BLPZNC        VARZNC
233610930402     C                   MOVEL     BLPZNC        SAVZNC
233620900511     C                   MOVEL     BLPCTM        VIDCTM
233630900511     C                   MOVEL     BLPFFD        VIDFFD
233640930401     C                   MOVEL     BLPFFD        VARFFD
233650010214     C     BLPFFD        IFEQ      *BLANKS
233660010214     C                   MOVEL     'N'           VIDFFD
233670010214     C                   MOVEL     'N'           VARFFD
233680010214     C                   ENDIF
233690910114     C*
233700900516     C                   MOVEL     BLPNFV        VIDNFV
233710910114     C                   MOVEL     BLPTCR        VIDTCR
233720940927     C                   MOVEL     BLPHCR        VIDHCR
233730940927     C                   MOVE      BLPHCR        VIDMCR
233740900516     C* GIRO DATA BORDERO
233750940927     C                   CLEAR                   WLBDAT
233760950107     C                   MOVEL     '3'           G02ERR
233770940927     C                   Z-ADD     BLPDBR        G02INV
233780940927     C                   CALL      'XSRDA8'
233790940927     C                   PARM                    WLBDAT
233800940927     C                   Z-ADD     G02DAT        VIDDBR
233810940928     C* VEDO SE ESISTE C/A
233820940928     C     §3AFCA        IFNE      0
233830051115     C     KBLP3         CHAIN     Fiar9000                           30
233840940928     C     *IN30         IFEQ      *OFF
233850051115     C                   MOVEL     'E'           War9              1
233860051115     C                   Z-ADD     ar9CAS        VIDCAS
233870051115     C                   MOVEL     ar9TIC        VIDTIC
233880051115     C                   MOVEL     ar9GCA        VIDGCA
233890051115     C                   MOVEL     ar9VCA        VIDVCA
233900051115     C                   MOVEL     ar9VCA        VARVCA
233910940928     C                   ENDIF
233920940928     C                   ENDIF
233930940928     C*
233940900517     C* SE ESISTE AGGANCIO 2° BOLLA
233950991006     C                   MOVEL     '2'           WTRC
233960991006     C     KBLP4         CHAIN     FIAR6000                           30
233970940927    1C     *IN30         IFEQ      *OFF
233980050331     c                   move      ar6ksc        wKSCsf2
233990991006     C                   MOVEL     'E'           WAR62             1
234000040114
234010050331   1ac                   if        wKSCsf2 = 0000 or wKSCsf2 = 9999
234020040114     c                   Z-add     Ar6Va1        Vi2Va1
234030040116     c                   Z-add     Ar6Va1        Va2va1
234040991006     C                   MOVEL     AR6SV1        VI2SV1
234050040114     c                   Z-add     Ar6Va2        Vi2Va2
234060040114     c                   Z-add     Ar6Va2        Va2Va2
234070040114     c                   Movel     Ar6Sv2        Vi2Sv2
234080040114     c                   Z-add     Ar6Va3        Vi2Va3
234090040114     c                   Z-add     Ar6Va3        Va2Va3
234100040114     c                   Movel     Ar6Sv3        Vi2Sv3
234110040126     c                   Z-add     Ar6Imv        Vi2Imv
234120040114      * Vedo se ci sono altre varie su FIAR7
234130040114     c                   Eval      wtrc = '2'
234140041217     c                   clear                   contasv
234150040114     c     Kblp4         Setll     Fiar7000
234160040114     c                   Do        *Hival
234170040114     c     Kblp4         Reade     Fiar7000
234180040114     c                   If        %Eof(Fiar701l)
234190040114     c                   Leave
234200040114     c                   EndIf
234210040114     c                   Eval      war71 = 'E'
234220041217     c                   select
234230041217     c                   when      contasv = 0
234240040114     c                   Movel     Ar7Svn        Vi2Sv4
234250040114     c                   Z-add     Ar7Van        Vi2Va4
234260040114     c                   Z-add     Ar7Van        Va2Va4
234270041217     c                   add       1             contasv
234280041217     c                   when      contasv = 1
234290041217     c                   Movel     Ar7Svn        Vi2Sv5
234300041217     c                   Z-add     Ar7Van        Vi2Va5
234310041217     c                   Z-add     Ar7Van        Va2Va5
234320041217     c                   add       1             contasv
234330041217     c                   when      contasv = 2
234340041217     c                   Movel     Ar7Svn        Vi2Sv6
234350041217     c                   Z-add     Ar7Van        Vi2Va6
234360041217     c                   Z-add     Ar7Van        Va2Va6
234370040114     c                   Leave
234380041217     c                   endsl
234390040114     c                   EndDo
234400040114
234410991006     C                   MOVEL     AR6CEI        VI2CEI
234420991008     C                   MOVEL     AR6DIV        VI2DIV
234430991011     C                   MOVEL     AR6DIV        WDIV2
234440940927     C* SE ESISTE ESENZIONE IVA DECODIFICO
234450991006    2C     VI2CEI        IFNE      *BLANKS
234460940927     C                   MOVEL     'EI'          COD
234470940927     C                   MOVEL(P)  VI2CEI        KEY
234480940927     C                   EXSR      CTABEL
234490940927     C  N30              MOVEL     TBLUNI        V2DCEI
234500940927    2C                   ENDIF
234510980120     C**
234520050407     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
234530050407     C     VI2imv        IFNE      0
234540050407     C     vi2va1        ORNE      0
234550050407     C     vi2va2        ORNE      0
234560050407     C     vi2va3        ORNE      0
234570050407     C     vi2va4        ORNE      0
234580050407     C     vi2va5        ORNE      0
234590050407     C     vi2va6        ORNE      0
234600050407     C     VI2CEI        ORNE      ' '
234610050407     C                   MOVEL     'S'           WEMD03            1
234620050407     C                   ENDIF
234630050407     c*
234640991006     C                   CLEAR                   FIAR6000
234650050331   1ac                   endif
234660940927    1C                   ENDIF
234670941011     C*
234680941011     C* METTO IL NUMERO DI SPEDIZIONE IN 1 VIDEATA
234690941011     C                   Z-ADD     BLPNRS        PRENRS
234700941011     C                   Z-ADD     BLPNSP        PRENSP
234710941011     C                   MOVEL     BLPLNA        PRELNA
234720941011     C                   Z-ADD     BLPRMN        PRERMN
234730941011     C                   Z-ADD     BLPZNC        PREZNC
234740160225
234750160225      * Aggancio file estensione Fiar500f record "GEN" per recuperare
234760160225      * il referente e il telefono e v-valore
234770160225     c                   Clear                   DAr5Gen
234780160225     c                   clear                   w_ar5tcp
234790160225     c                   clear                   w_ar5als
234800160225     c                   clear                   w_ar5alx
234810160225     c                   clear                   w_aDpd
234820160225     c                   Eval      kAr5Trd = 'GEN'
234830160225     c     KFiar5        Chain(n)  Fiar501l
234840160225     c                   If        %Found(Fiar501l)
234850160225     c                   Movel     Ar5Uni        DAr5Gen
234860160225     c                   EndIf
234870160225     c                   Eval      VidRef = §Ar5Ref
234880160225     c                   Eval      VidTel = §Ar5Teld
234890160225     c                   Eval      Vidbva = §Ar5bva
234900160225     c                   eval      savbva = §ar5bva
234910160225     c                   eval      w_ar5tcp=§ar5tcp
234920160225     c                   eval      w_ar5als=§ar5als
234930160225     c                   eval      w_ar5alx=§ar5alx
234940160301     c                   eval      w_aDpd=§ar5fDpd
234950000913     C*
234960000913     C* SE DISK C CARICO COD.CHI SONO NEL SUBFILE
234970000913     C                   SETOFF                                       96
234980000918     C* PRENDO CTM
234990000918     C                   MOVE      '1B'          COD
235000000918     C                   MOVEL(P)  VIDCTM        KEY
235010000918     C                   EXSR      CTABEL
235020000918     C  N30              MOVEL     TBLUNI        DS1B
235030000918     C   30              CLEAR                   DS1B
235040000918     C*
235050160302     c                   clear                   wtip
235060160226     c* Disk "C" no DPD
235070160226     c                   if        (§1bf12<>'N' and
235080160226     c                              A_§OGNTW<>'DPD' and §ogntw<>'DPD' )
235090160226     c                             or
235100160226     c* Disk C export dpd con numero parce automatico (da f13 o forzatura instra
235110160226     c* damento)
235120160226     c                             (§1BF12<>'N' and A_§OGNTW='DPD' and
235130160226     c                              (§1bf13='A' or w_adpd='S'))
235140160226     c                             or
235150160226     c                             (§1bf12='B' and A_§OGNTW='DPD')
235160000913     C* Attivo F22=Manutenzione cod."Chi Sono"
235170000913     C                   SETON                                        96
235180000913     C                   MOVEL     'C'           WTRC
235190000913     C                   Z-ADD     0             NR8
235200120817     C**   KBLT1         SETLL     FNBLT01L
235210120817     C**   KBLT1         READE(N)  FNBLT01L                               30
235220120817     C     KBLT1         SETLL     FIART01L
235230120817     C     KBLT1         READE(N)  FIART01L                               30
235240000913    3C     *IN30         DOWEQ     *OFF
235250120817     C***  KARS1         CHAIN(N)  FIARS01L                           30
235260120817     C     KARS1A        CHAIN(N)  FIARS01L                           30
235270051102     C  N30              EXSR      CARARS
235280120817     C**   KBLT1         READE(N)  FNBLT01L                               30
235290120817     C     KBLT1         READE(N)  FIART01L                               30
235300000913    3C                   ENDDO
235310000913     C     NR8           IFGT      0
235320000913     C                   SETON                                        78
235330000913     C                   ENDIF
235340000918     C                   Z-ADD     NR8           SAVNR8
235350000913    2C                   ENDIF
235360070322     c* se bolla export dpd con numero parcel non automatico verifico
235370070322     c* se chi sono diverso dal numero parcel ed in questo caso memoriz
235380070323     c* zo nel subfile ma non abilito l'f22
235390070322     C     §1BF12        ifNE      'N'
235400070322     C     A_§OGNTW      ANDEQ     'DPD'
235410070322     C     §1BF13        ANDne     'A'
235420140715     C     §1BF12        ANDne     'B'
235430160225     c     w_aDpd        andne     'S'
235440070322     C                   Z-ADD     0             NR8
235450070322     C                   MOVEL     'C'           WTRC
235460120817     C***  KBLT1         chain(N)  FNBLT01L
235470120817     c***                if        %found(fnblt01l)
235480120817     C***  KARS1         CHAIN(N)  FIARS01L
235490120817     C     KBLT1         chain(N)  FIART01L
235500120817     c                   if        %found(fiart01l)
235510120817     C     KARS1A        CHAIN(N)  FIARS01L
235520070322     c                   if        %found(fiars01l)
235530070322     c                             and arsnot<>v7cnpr
235540070322     c                   exsr      carars
235550070322     c                   eval      wparcel='12'
235560070322     C                   SETON                                        78
235570070322     c                   endif
235580070322     c                   endif
235590070322     C                   Z-ADD     NR8           SAVNR8
235600070322     c                   endif
235610160302     c* Determino il fie
235620160302     c                   clear                   trul27ds1
235630160302     c                   z-add     BlpPkf        I27Pkg
235640160302     c                   movel     vidtsp        i27tsp
235650160302     c                   z-add     vidlnp        i27lnp
235660160302     c                   z-add     comlna        i27lna
235670160302     c                   z-add     savmit        i27cli
235680160302     c* tipo tariffa per export FED
235690160302     c                   if        wtip='FM' or wtip='FD'
235700160302     c                   move      wtip          i27tip
235710160302     c                   endif
235720160302     c                   call      'TRUL27R1'
235730160302     c                   parm                    trul27ds1
235740160302     c                   movel     o27fie        savfie
235750160302     c                   movel     o27ntw        s_27ntw
235760010209     C* PRENDO NUMERO ORM SE PRESENTE
235770010209     C                   MOVEL     'M'           WTRC
235780060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
235790060215     C  N30              MOVEL     ar4NOT        DSBL4M
235800010209     C   30              CLEAR                   DSBL4M
235810061122     c                   movel     dsbl4m        S_dsbl4m
235820010209     C                   Z-ADD     §B4POE        VIDPOE
235830010222     C                   MOVEL     §B4NSR        VIDNOR
235840010222     C                   MOVE      §B4NOR        VIDNOR
235850010209     C                   Z-ADD     §B4NRV        VIDNRV
235860010215     C                   MOVEL     VIDORM        W01ORM
235870011126     C                   MOVEL     '1'           WOVUO
235880070427     C                   MOVEL     '1'           WOVUO1
235890011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
235900011126     C                   Z-ADD     VIDPOE        WOPOE
235910011126     C                   Z-ADD     VIDNOR        WONOR
235920011126     C                   Z-ADD     VIDNRV        WONRV
235930091008
235940011126     C                   CLEAR                   DORM01
235950090327     c                   clear                   s_ormksc
235960090327     c                   clear                   s_ormctr
235970011126     C     KORM          CHAIN     FNORM01L                           30
235980011126     C  N30              MOVEL     ORMFLO        DORM01
235990090327     c  n30              z-add     ormksc        s_ormksc
236000090327     c  n30              move      ormctr        s_ormctr
236010011126     C     §ORMFD        IFEQ      'S'
236020011126     C                   MOVEL     PROT          ATRDES
236030011126     C                   ELSE
236040011126     C                   CLEAR                   ATRDES
236050011126     C                   ENDIF
236060021218      * Aggancio file estensione Fiar500f record "BAN" per recuperare i
236070021218      * bancali
236080030704     c                   If        %subst(VidGva:1:1) = 'B'
236090021218     c                   Clear                   DAr5Ban
236100030704     c                   Eval      kAr5Trd = 'BAN'
236110021218     c     KFiar5        Chain(n)  Fiar501l
236120021218     c                   If        %Found(Fiar501l)
236130021218     c                   Movel     Ar5Uni        DAr5Ban
236140021218     c                   EndIf
236150021220     c                   If        §Ar5Tba > *Zeros
236160021218     c                   Movel     §Ar5Tba       VidTba
236170021220     c                   EndIf
236180021218     c                   Eval      VidNba = §Ar5Nba
236190030204     c                   Eval      SavNba = §Ar5Nba
236200021220     c                   If        §Ar5Tb2 > *Zeros
236210021220     c                   Movel     §Ar5Tb2       VidTb2
236220021220     c                   EndIf
236230021218     c                   Eval      VidNb2 = §Ar5Nb2
236240030204     c                   Eval      SavNb2 = §Ar5Nb2
236250030704     c                   EndIf
236260030704
236270030704      * Aggancio file estensione Fiar500f record "BNB" per recuperare i
236280030704      * bancali e i colli originali
236290030704     c                   If        %subst(VidGva:1:1) = 'O'
236300030704     c                   Clear                   DAr5Bnb
236310030704     c                   Eval      kAr5Trd = 'BNB'
236320030704     c     KFiar5        Chain(n)  Fiar501l
236330030704     c                   If        %Found(Fiar501l)
236340030704     c                   Movel     Ar5Uni        DAr5Bnb
236350030704     c                   EndIf
236360030704     c                   If        §Ar5bTba > *Zeros
236370030704     c                   Movel     §Ar5bTba      VidTba
236380030704     c                   EndIf
236390030704     c                   Eval      VidNba = §Ar5bNba
236400030704     c                   Eval      SavNba = §Ar5bNba
236410030704     c                   If        §Ar5bTb2 > *Zeros
236420030704     c                   Movel     §Ar5bTb2      VidTb2
236430030704     c                   EndIf
236440030704     c                   Eval      VidNb2 = §Ar5bNb2
236450030704     c                   Eval      SavNb2 = §Ar5bNb2
236460030704     c                   Eval      w03cor = §Ar5bCor
236470030704     c                   Eval      w03csf = §Ar5bCsf
236480030708     c                   Eval      savw03cor = §Ar5bCor
236490030708     c                   Eval      savw03csf = §Ar5bCsf
236500030704     c                   EndIf
236510031113      * Aggancio file estensione Fiar500f record "GEN" per recuperare
236520040610      * il referente e il telefono e v-valore
236530160225     c* Spostate prima delle considerazioni Disk C perchè mi serviva
236540160225     c* flag FORZATURA INSTRADAMENTO DA EEX A DPD §ar5fdpd
236550160225     c*                  Clear                   DAr5Gen
236560160225     c*                  clear                   w_ar5tcp
236570160225     c*                  clear                   w_ar5als
236580160225     c*                  clear                   w_ar5alx
236590160225     c*                  clear                   w_aDpd
236600160225     c*                  Eval      kAr5Trd = 'GEN'
236610160225     c*    KFiar5        Chain(n)  Fiar501l
236620160225     c*                  If        %Found(Fiar501l)
236630160225     c*                  Movel     Ar5Uni        DAr5Gen
236640160225     c*                  EndIf
236650160225     c*                  Eval      VidRef = §Ar5Ref
236660160225     c*                  Eval      VidTel = §Ar5Teld
236670160225     c*                  Eval      Vidbva = §Ar5bva
236680160225     c*                  eval      savbva = §ar5bva
236690160225     c*                  eval      w_ar5tcp=§ar5tcp
236700160225     c*                  eval      w_ar5als=§ar5als
236710160225     c*                  eval      w_ar5alx=§ar5alx
236720160225     c*                  eval      §ar5fDpd=w_aDpd
236730091211     c                   eval      nochkticC=*off
236740091112     c* window scelta beneficiario contrassegno: se presente codice su
236750091112     c* fiar5 rek gen imposto opportunamente campo scelta beneficiario C/A
236760091118     c                   if        dateu>=§vpocas
236770091119     c                   if        §ar5cdi<>*blanks
236780091112     c                   eval      wcassel2='X'
236790091211     c                   eval      nochkticC=*on
236800091112     c                   else
236810091127     C                   CLEAR                   DS1a
236820091127     c                   if        vidtic<>*blanks
236830091127     C                   MOVEL     '1A'          COD
236840091127     C                   MOVEL(P)  vidtic        KEY
236850091127     C                   EXSR      CTABEL
236860091127     C  N30              MOVEL     TBLUNI        DS1a
236870091127     c                   endif
236880091112     c                   if        §3afca<>0 and *in04 and widor1>0
236890091112     c                             and ormpag='O'
236900091204     c                             and §1amro<>'S'
236910091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
236920091112     c                                 %editc(ormksc:'X')
236930091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
236940091112     c                                 %subst(%editc(ormcor:'X'):1:7)
236950091112     c                   eval      wcassel1='X'
236960091211     c                   eval      nochkticC=*on
236970091112     c                   endif
236980091112     c                   endif
236990091118     c                   endif
237000110512      * Aggancio file estensione Fiar500f record "EMD" per recuperare indirizzo
237010130315      * email destinatario e numero di telefono per sms
237020110512     c                   Clear                   DAr5emd
237030110512     c                   Eval      kAr5Trd = 'EMD'
237040110512     c     KFiar5        Chain(n)  Fiar501l
237050110512     c                   If        %Found(Fiar501l)
237060110512     c                   Movel     Ar5Uni        DAr5Emd
237070110512     c                   Eval      wemdest = §Ar5eml
237080160511     c                   Eval      sav_wemdest = §Ar5eml
237090130918     c* Per il momento e fino ache non ci sarà la storicicazione di
237100130918     c* varizioni di email destinatario impedisco la variazione se
237110130918     c* già inviata email
237120150213     c***                if        wemdest<>*blanks and §ar5dto=*blanks
237130150213     c***                clear                   atremd
237140150213     c***                clear                   atrwemd
237150150213     c***                endif
237160130315     c                   Eval      wsms    = §Ar5tel
237170160511     c                   Eval      sav_wsms    = §Ar5tel
237180140423     c* Per il momento e fino ache non ci sarà la storicicazione di
237190140423     c* varizioni di tel destinatario impedisco la variazione se
237200140423     c* già inviato sms
237210150213     c***                if        wsms   <>*blanks and §ar5dos=*blanks
237220150213     c***                clear                   atremd
237230150213     c***                clear                   atrwtel
237240150213     c****               endif
237250130315     c                   Eval      wsmp    = §Ar5smp
237260130923     c                   Eval      wmmp_ar5= §Ar5mmp
237270110512     c                   EndIf
237280110706     C* Aggancio fiar4 record "4" perr recuperare codici cup e cig
237290110706     C                   MOVEL     '4'           WTRC
237300110706     C     KBLP4         CHAIN(N)  Fiar4000                           30
237310110706     C  N30              MOVEL     ar4NOT        DSBL44
237320110706     C   30              CLEAR                   DSBL44
237330110706     c                   if        §b44cup<> *blanks or §b44cig<>*blanks
237340110706     c                   movel     §b44cup       wcupcup
237350110706     c                   movel     §b44cig       wcupcig
237360110706     c                   endif
237370090326     C* Manutenzione bolle: se sono in manutenzione bolle devo eventualmente
237380090326     c* completare la videata prendendo ksc/ctr memorizzati su data base
237390090326     c* se bolla avente sigla operatore presente in tabella 3M proteggo sempre
237400090326     c* perchè potebbe trattarsi di codici inseriti in automatico in fase di
237410090326     c* bolettazione in quanto passati da chiamante
237420090326     c                   if        *in04
237430090326     c                   exsr      sr_daar4a
237440130918     c                   endif
237450091112     c
237460160126     c* Verifico se presenti disposizioni per la consegna (variazioni o R.A.)
237470160126     c* da segnalare
237480160120     c                   clear                   wf10
237490160126     c                   eval      at0fva=nodi
237500160126     c                   clear                   wf16
237510160126     c                   eval      at0fra=nodi
237520160120     C     Kblp3         SETLL     FiARBF2C
237530160120     c                   if        %equal(fiarbf2c)
237540160126     c* Presenti variazioni --> attivo F10 e verifico se presente R.A.
237550160126     c                   clear                   at0fva
237560160120     c                   eval      wf10='S'
237570160126     c                   eval      wdna2lnp = §lplnp
237580160126     c                   eval      wdna2nrs = §lpnrs
237590160126     c                   eval      wdna2nsp = §lpnsp
237600160126     c                   eval      wdna2aas = §lpaas
237610160126     c                   eval      TGDtor  = 'S'
237620160126     c                   eval      TGDogg  = ds_OggSped
237630160126     c     K02TGD02      setll     FITGD000
237640160303     c                   if        %equal(fitgd32l)
237650160126     c                   clear                   at0fra
237660160126     c                   eval      wf16='S'
237670160126     c                   endif
237680160126     c                   else
237690160126     c* non sono presenti variazioni: verifico se presenti dispo di
237700160126     c* consegna --> se richiesto dirottamento c'è R.A. senza variazioni
237710160126     c* N.B.: non si può attivare l'F16=R.A. a prescindere dalla presenza o
237720160203     c* meno di variazioni/dispo di consegna in quanto le
237730160126     c* R.A. si possono generare anche in partenza a fronte di variazione
237740160126     c* colli o lna  (v.di routine sr_wrtRA ) e queste non sono da considerare
237750160126     c* disposizioni per la consegna
237760160126     c     kblp3         setll     tiidc01l
237770160203     c     kblp3         reade     tiidc01l
237780160203     c                   dow       not %eof(tiidc01l)  and wf16=' '
237790160203     c* solo se dispo aperta chaino relativa r.a. e solo se aperta anche
237800160203     c* quest'ultima attivo f16
237810160203     c                   if        idceladata=0
237820160203     c     ktgd01        chain     fitgd01l
237830160203     c                   if        %found(fitgd01l) and TGDDCD=0
237840160126     c                   clear                   at0fra
237850160126     c                   eval      wf16='S'
237860160203     c                   endif
237870160203     c                   endif
237880160203     c     kblp3         reade     tiidc01l
237890160203     c                   enddo
237900160120     c                   endif
237910000913     C*
237920950102     C                   ENDIF
237930061212     C                   ENDIF
237940900511     C                   ENDSR
237950011025     C*
237960011025      *--- TASSAZIONE VARIA 'N' --------------------------------------*
237970011025     C     TASSAN        BEGSR
237980011025      *
237990011025     C                   CLEAR                   DTAS
238000011025     C                   CLEAR                   DTASV
238010011025     C                   Z-ADD     BLPKSC        TASKSC
238020011025     C                   Z-ADD     BLPCTR        TASCTR
238030011025     C                   Z-ADD     BLPPKF        TASPKF
238040160530     C                   Z-ADD     BLPPKb        TASPKb
238050011025     C                   MOVEL     BLPLNP        TASLNP
238060011025     C                   MOVEL     BLPCTS        TASCTS
238070011025     C                   MOVEL     BLPDSP        TASDSP
238080011025     C                   MOVEL     BLPDSP        TASDCT
238090011025     C                   MOVEL     BLPVLF        TASVLF
238100160530     C                   MOVEL     BLPfvF        TASfvF
238110011025     C                   MOVEL     BLPTSP        TASTSP
238120011025     C     WBOL          IFEQ      '1'
238130011025     C                   MOVEL     §3ATB1        TASTBL
238140011025     C                   ELSE
238150011025     C                   MOVEL     §3ATB2        TASTBL
238160011025     C                   ENDIF
238170011025     C                   MOVEL     BLPLNA        TASLNA
238180011025     C                   MOVEL     BLPNCL        TASNCL
238190160530     C                   MOVEL     BLPNCL        TASNCLb
238200011025     C                   MOVEL     BLPQFT        TASQFT
238210011025     C     WBOL          IFEQ      '1'
238220011025     C     §3AFCA        ANDEQ     1
238230011025     C     WBOL          OREQ      '2'
238240011025     C     §3AFCA        ANDEQ     2
238250051115     C                   MOVEL     ar9CAS        TASCAS
238260051115     C                   MOVEL     ar9VCA        TASVCA
238270051115     C                   MOVEL     ar9TIC        TASTIC
238280011025     C                   ENDIF
238290011025     C                   MOVEL     BLPIAS        TASIAS
238300011025     C                   MOVEL     BLPVAS        TASVAS
238310011025     C                   MOVEL     BLPCAD        TASCAD
238320011025     C                   MOVEL     BLPNZD        TASNZD
238330011025     C                   MOVEL     BLPFIN        TASFIN
238340011025     C                   MOVEL     BLPCAM        TASCAM
238350011025     C                   MOVEL     BLPNZM        TASNZM
238360011025     C                   MOVEL     BLPFAP        TASFAP
238370011025     C                   MOVEL     BLPTC1        TASTC1
238380011025     C                   MOVEL     BLPTC2        TASTC2
238390011025     C     BLPFST        IFEQ      'S'
238400011025     C     BLPFST        OREQ      'C'
238410011025     C                   MOVEL     'S'           TASDDT
238420011025     C                   ELSE
238430011025     C                   MOVEL     'N'           TASDDT
238440011025     C                   ENDIF
238450061002     c*****              movel     blpfbr        §tasflo
238460061002     c* Passo nella DTAS01 il blpfbr
238470061002     c                   clear                   dtas01
238480061002     c                   movel     blpfbr        §asfbr
238490061002     c                   movel(P)  dtas01        §tasflo
238500011025      **
238510011025      * SE BOLLA EXPORT--> NON PASSO MAI IL FLAG CONSEGNA A MAGAZZINO
238520011025      *                    IN MODO CHE TASSI SEMPRE LA VARIA 'U'
238530020219     C     A_§ogntw      ifeq      'COR'
238540020219     c     A_§ogntw      oreq      'MES'
238550020219     c     A_§ogntw      oreq      'PPT'
238560011025     C                   MOVEL     BLPFDN        TASFDN
238570011025     C                   ENDIF
238580011025      **
238590011025      * CHAIN SU CAPPARIO PER PRENDERE COD TASSAZIONE MITTENTE
238600011025     C                   CLEAR                   DSSI95
238610011025     C                   MOVEL     BLPLOM        I95LOC
238620011025     C                   MOVEL     BLPCAM        I95CAP
238630011025     C                   MOVEL     BLPNZM        I95NAR
238640011025     C                   MOVEL     '3'           I95TCN
238650011025     C                   MOVEL     BLPDSP        I95DAT
238660011025     C     §3AFCA        IFNE      0
238670011025     C                   MOVEL     'S'           I95FCA
238680011025     C                   ENDIF
238690011025     C                   MOVEL     §3ATB1        I95TPO
238700020305     c* se network fedex passo flag apposito per dire di prendere i dati
238710020305     c* dalla tabella della nazione
238720020305     c     §ogntw        ifeq      'FED'
238730020305     c                   movel     'S'           i95fi1
238740020305     c                   endif
238750011025     C                   CALL      'TISI95R'
238760011025     C                   PARM                    DSSI95
238770011025     C     O95ERR        IFEQ      *BLANKS
238780011025     C                   MOVEL     O95CTS        TASMCT
238790011025     C                   ENDIF
238800011025     C                   MOVEL     'S'           WCAL13            1
238810020218      * ELABORO E CHIUDO CON RT IL PGM
238820011025     C                   MOVEL     ' '           TASTLA
238830011212     C* DATA TASSAZIONE = 0    : SE STO TASSANDO LA VARIA "N" NON E'
238840011121     C*                          POSSIBILE CHE LA BOLLA SIA GIA' FATTU-
238850011121     C*                          RATA
238860021002     c* imposto peso vdl e colli rilevati
238870030204     c                   z-add     blpncp        Tasncp
238880030204     c                   z-add     blppkc        Taspkc
238890030204      * Bancali
238900030205If  1c                   If        %Subst(VidGva:1:1) ='B'
238910030204     c                   Eval      TasBan = VidNba + VidNb2
238920030205     c                   EndIf
238930030728      * Colli originali
238940030728If  1c                   If        %Subst(VidGva:1:1) ='O'
238950030728     c                   Eval      TasNcl = W03Cor
238960030728     c                   EndIf
238970011025      *
238980011025     C                   CALL      'TNSF20R'
238990011025     C                   PARM                    KPJBA
239000011025     C                   PARM                    DTAS
239010011025     C                   PARM                    DTASV
239020011025      *
239030011025      * Tassazione andata buon fine
239040011025     C     TASERR        IFEQ      *BLANKS
239050011025      *
239060011025      * Controllo la divisa della tassazione con la divisa del video
239070011025      * se non corrispondono devo convertire la varia 'N' nella divisa
239080011025      * del video
239090011025     C     TASDIV        IFNE      VIDDIV
239100011025      * aggancio la tabella CV per sicurezza
239110011025     C                   CLEAR                   DSCV
239120011025     C                   MOVEL     'CV'          COD
239130011025     C                   MOVEL(P)  VIDDIV        KEY
239140011025     C                   EXSR      CTABEL
239150011025     C  N30              MOVEL     TBLUNI        DSCV
239160011025      *
239170011025     C                   CLEAR                   DSYEUR
239180011025     C                   MOVEL     TASDIV        YECDVI
239190011025     C                   MOVEL     VIDDIV        YECDVO
239200011025     C                   Z-ADD     TASIMV        YECIMI
239210011025     C     §CVFDC        IFEQ      'S'
239220011025     C                   MOVE      '3'           YECDCO
239230011025     C                   ELSE
239240011025     C                   MOVE      '0'           YECDCO
239250011025     C                   ENDIF
239260011025     C                   CALL      'YEURCO'
239270011025     C                   PARM                    DSYEUR
239280011025     C     YECESI        IFEQ      ' '
239290011025     C                   Z-ADD     YECIMO        TASIMV
239300011025     C                   ELSE
239310011025     C                   Z-ADD     88888888      TASIMV
239320011025     C                   ENDIF
239330011025     C                   ENDIF
239340011025      *
239350011025     C                   Z-ADD     TASIMV        V3CVA1
239360011025     C                   ENDIF
239370011025      *
239380011025     C                   ENDSR
239390901031     C*
239400901031     C*--- TASSAZIONE BOLLA ------------------------------------------*
239410901031     C     TASSAZ        BEGSR
239420991012      *
239430991007     C                   CLEAR                   DTAS
239440020503     C                   CLEAR                   WTASSA            1
239450030623     C                   CLEAR                   WTASSAD           1
239460030623     C                   CLEAR                   ITASSA           11 3
239470941219     C*
239480941219     C                   MOVEL     VIDCTR        TASCTR
239490990701     C* SE E' FRANCO CODIFICATO SEMPRE CODICE CLIENTE
239500941219    1C     *IN04         IFEQ      *OFF
239510941219     C                   MOVEL     WKSC          TASKSC
239520990701     C* PER 8888 IMPOSTO LA TARIFFA DI TASSAZIONE DEI PREPAGATI
239530990701   1AC     VIDCCM        IFEQ      8888
239540990610     C*
239550990610     C* PER PREPAGATI CERCO LA TARIFFA GIUSTA
239560020117      *
239570020117      * Non più, prendere sempre la tariffa di cartello
239580990610     C**
239590160219     c***                z-add     o27ksc        tasksc
239600160219     c***                z-add     o27ctr        tasctr
239610160322     c***                z-add     oc7kscc       tasksc
239620160322     c***                z-add     oc7ctrc       tasctr
239630990610     C**
239640990701   1AC                   ENDIF
239650990701    1C                   ENDIF
239660941219     C*
239670941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
239680941219    1C     *IN04         IFEQ      *ON
239690991007      *
239700941219    2C     SAVFTM        IFEQ      'S'
239710941219     C     VIDFTM        OREQ      'S'
239720941219     C                   MOVE      WKSC          TASKSC
239730941219   X2C                   ELSE
239740941219     C*
239750941219     C* SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
239760941219     C                   MOVEL     COMLNA        TASKSC
239770941219     C                   MOVE      9999          TASKSC
239780941219     C                   Z-ADD     0             TASCTR
239790941219    2C                   END
239800941219    1C                   END
239810941219     C                   MOVEL     VIDCAM        TASCAM
239820991014     C                   MOVEL     VIDNZM        TASNZM
239830990610    1C     APDFCM        IFNE      ' '
239840941230     C                   MOVEL     'C'           TASFAP
239850941230     C                   ELSE
239860941230     C                   MOVEL     COMFAP        TASFAP
239870990610    1C                   END
239880941219     C*
239890941219     C* FLAG INOLTRO
239900990610     C*
239910941219     C                   EXSR      INOLTR
239920941219     C                   MOVEL     WFIN          TASFIN
239930941219     C                   MOVEL     VIDCAD        TASCAD
239940991014     C                   MOVEL     VIDNZD        TASNZD
239950941219     C*
239960160530     C                   movel     vidfvr        tasfvf
239970160530     C                   Z-ADD     V2CPKG_i      TASPKF
239980160530     C                   Z-ADD     V2CPKG_i      TASPKb
239990941219     C                   MOVEL     VIDLNP        TASLNP
240000941219     C                   MOVEL     SAVCTS        TASCTS
240010941219     C*
240020941219     C                   MOVEL     BLPDSP        TASDSP
240030970414     C                   MOVEL     BLPDSP        TASDCT
240040941219     C                   MOVEL     VARVOL        TASVLF
240050941219     C     VIDTSP        IFNE      *BLANKS
240060941219    1C                   MOVEL     VIDTSP        TASTSP
240070941219     C                   ELSE
240080941219     C* LO PRENDO DA TARIFFA
240090941219     C                   MOVEL     COMTSP        TASTSP
240100941219    1C                   ENDIF
240110941219     C* SE E' ANCORA VUOTO, IMPOSTO "C"
240120941219    1C     TASTSP        IFEQ      ' '
240130941219     C                   MOVEL     'C'           TASTSP
240140941219    1C                   ENDIF
240150980512     C     WBOL          IFEQ      '1'
240160980512     C                   MOVEL     §3ATB1        TASTBL
240170980512     C                   ELSE
240180980512     C                   MOVEL     §3ATB2        TASTBL
240190020503    1C                   ENDIF
240200941219     C*
240210950116     C* SOLO SE C/A SULLA 1 BOLLA
240220020503    1C     WBOL          IFEQ      '1'
240230980506     C     §3AFCA        ANDEQ     1
240240980506     C     WBOL          OREQ      '2'
240250980506     C     §3AFCA        ANDEQ     2
240260941219     C                   MOVEL     VIDCAS        TASCAS
240270941219     C                   MOVEL     VIDVCA        TASVCA
240280941219     C                   MOVEL     VIDTIC        TASTIC
240290020503    1C                   ENDIF
240300941219     C*
240310941219     C                   MOVEL     COMLNA        TASLNA
240320941219     C                   MOVEL     VIDNCL        TASNCL
240330160530     C                   MOVEL     VIDNCL        TASNCLB
240340040127      * passo il porto se sto tassando la prima bolla
240350040127     c                   If        wbol = '1'
240360941219     C                   MOVEL     VIDPOR        TASPOR
240370040127     c                   EndIf
240380941219     C                   MOVEL     VIDIAS        TASIAS
240390941219     C                   MOVEL     VIDVAS        TASVAS
240400941219     C                   MOVEL     VIDTC1        TASTC1
240410941219     C                   MOVEL     VIDTC2        TASTC2
240420941219     C                   MOVEL     VIDQFT        TASQFT
240430020503    1C     VIDBAM        IFEQ      'S'
240440970411     C                   MOVEL     'S'           TASDDT
240450020503    1C                   ENDIF
240460061002     c*vidfbr            movel     vidfbr        §tasflo
240470061002     c* Passo nella DTAS01 il blpfbr
240480061002     c                   clear                   dtas01
240490061002     c                   movel     vidfbr        §asfbr
240500130926     c***                if        wemdest<>*blanks
240510130926     c***                movel     'S'           §asemd
240520130926     c***                endif
240530130926     c                   clear                   w_emd
240540140424     c                   clear                   w_smp
240550130926     c* verifico presenza richiesta avviso mail merce partita
240560130926     c                   select
240570130926     c* manutenzione
240580130926     c                   when      *in12 and not *in15
240590130926     c                             and wmmp_ar5='S' and wemdest<>*blanks
240600130926     c                   eval      w_emd = 'S'
240610130926     c* conferma bolle da cliente
240620130926     c                   when      *in12 and *in15
240630130930     c                   if        wmmp='N'
240640130926     c                   eval      aggioAr8=' '
240650130926     c                   exsr      sr_gesar8
240660130926     c                   endif
240670130926     c                   if        wemdest<>*blanks  and
240680170428     c                             (wmmp<>'N' or (w_allm='S' and
240681170428     c                                            a_§ogntw<>'DPD' and
240682170428     c                                            a_§ogntw<>'EEX' and
240683170428     c                                            a_§ogntw<>'FED' ))
240690130926     c                   eval      w_emd = 'S'
240700130926     c                   endif
240710130926     c                   endsl
240720140424     c                   if        wsms<>*blanks and wsmp='S'
240730140424     c                   eval      w_smp='S'
240740140424     c                   endif
240750140424     c
240752170428     c* se W_emd/w_smp= 'S' devo anche verificare che non siano presenti blocchi
240753170428     c* (per es non tutte le lna EEX fanno il servizio di invio mail/sms
240754170428     c* oppure potrebbero esserci blocchi su richiesta della Guardia di Finanza)
240755170428     c                   if        *in12
240756170428     c                   if        w_emd='S' or W_smp='S'
240757170428     c                   clear                   fnlv84ds
240758170428     c                   eval      ILV84LNP=vidlnp
240759170428     c                   eval      ILV84LNA=comlna
240762170428     c                   eval      ILV84TSP=tastsp
240763170428     c                   eval      ilv84drf=tasdsp
240764170428     c                   call      'FNLV84R'
240765170428     c                   parm                    fnlv84ds
240766170428     c                   if        olv84esito='1'
240767170428     c                   clear                   w_smp
240769170428     c                   clear                   w_emd
240770170428     c                   endif
240771170428     c                   endif
240772170428     c                   endif
240773130926
240774130926     c                   select
240780150324     c***                when      w_emd='S' and w_smp=' '
240790150324     c                   when      w_emd='S'
240800130926     c                   eval      §asemd='S'
240810140424     c                   when      w_emd='S' and w_smp='S'
240820130926     c                   eval      §asemd='E'
240830140424     c                   when      w_smp='S'
240840130926     c                   eval      §asemd='X'
240850130926     c                   endsl
240860150107     c* PIN CODE
240870150107     c                   if        wpincode<>*blanks
240880150107     c                   eval      §aspin='S'
240890150107     c                   endif
240900130926     c
240910061002     c                   movel(P)  dtas01        §tasflo
240920151127
240930151127     c* Packing list e orm telefonici solo per la prima bolla in quanto la secon
240940151127     c* è solo per tassare una specifica varia
240950151127     c                   if        wbol='1'
240960151117     c* PACKING LIST
240970151117     c                   select
240980151117     c* manutenzione
240990151117     c                   when      *in12 and not *in15
241000151117     c                   if        w_ar5alx='S' or w_ar5als='S'
241010151117     c                   eval      tasspl='S'
241020151117     c                   endif
241030151117     c* conferma bolle
241040151117     c* in questa fase non so ancora se packing list pdf  in quanto
241050151117     c* lo so solo dopo il trattamento del pdf che viene eseguito da
241060151117     c* altro pgm. quindi qui gestisco solo il packing list da fivax
241070151117     c                   when      *in12 and *in15
241080151117     c                   if        wvax='S'
241090151117     c                   eval      tasspl='S'
241100151117     c                   endif
241110151117     c                   endsl
241120151117     c* ADDEBITO ORM TELEFONICI (diritto di chiamata)
241130151117     c                   exsr      sr_b4ado
241140151117     c                   if        w_§b4ado='S'
241150151117     c                   movel     'S'           tasprt
241160151117     c                   endif
241170151127     c                   endif
241180941219     C* LEGGO IL SFL PER PRENDERE LE VARIE
241190980506     C* SOLO PER 1 BOLLA ESISTE TASSAZIONE COMPLETA
241200991007     C                   CLEAR                   DTASV
241210980506    1C     WBOL          IFEQ      '1'
241220941219     C                   Z-ADD     1             NRR
241230941219     C                   Z-ADD     1             C
241240941219     C*
241250980506    2C                   DO        20            NRR
241260941219     C     NRR           CHAIN     LS01S03                            30
241270941219     C*
241280980506    3C     *IN30         IFEQ      *OFF
241290020503     c* se devo tassare una specifica varia(da tabella 3A) e c'e' gia'
241300020503     c*  non richiamo la tassazione
241310020503     c                   if        §3asva<>*blanks and v3csv1=§3asva
241320020503     c                   eval      wtassa='N'
241330030623      * mi salvo l'importo della varia
241340030623     c                   eval      itassa=v3cva1
241350020503     c                   endif
241360030623     c* se esiste già la varia "D" non la ricalcolo
241370030623     c*
241380030623     c                   if        v3csv1='D'
241390030623     c                   eval      wtassad='N'
241400030623     c                   endif
241410030624      * SE ESISTE LA VARIA "&" CON TUTTI 8888888 NON LA PASSO AL TNSF20R
241420030624      * MA PASSO UN FLAG  DI RICHIESTA CALCOLO VARIA "&"
241430030624     C                   IF        V3CSV1 = '&' AND V3CVA1 = 88888888
241440030624     C                   EVAL      TASFCAA = 'S'
241450030624     C                   ELSE
241460941219     C                   MOVEL     V3CSV1        VSV(C)
241470991007     C                   Z-ADD     V3CVA1        VVA(C)
241480030624     c                   ENDIF
241490941219     C                   ADD       1             C
241500980506    3C                   ENDIF
241510980506    2C                   ENDDO
241520980506     C**
241530991019     C                   MOVEL     VIDDIV        TASDIV
241540991019     C**
241550980506     C** 2 BOLLA: IMPOSTO LA VARIA "G"
241560980506   X1C                   ELSE
241570991019     C                   MOVEL     VI2DIV        TASDIV
241580980608     C     VI2VA1        IFGT      0
241590980608     C                   MOVEL     VI2SV1        VSV(1)
241600991007     C                   Z-ADD     VI2VA1        VVA(1)
241610040121     c                   Movel     Vi2Es1        Ves(1)
241620980608     C                   ENDIF
241630040115     c                   If        Vi2Va2 > *Zeros
241640040115     c                   Movel     Vi2Sv2        Vsv(2)
241650040115     c                   Z-add     Vi2Va2        Vva(2)
241660040121     c                   Movel     Vi2Es2        Ves(2)
241670040115     c                   EndIf
241680040115     c                   If        Vi2Va3 > *Zeros
241690040115     c                   Movel     Vi2Sv3        Vsv(3)
241700040115     c                   Z-add     Vi2Va3        Vva(3)
241710040121     c                   Movel     Vi2Es3        Ves(3)
241720040115     c                   EndIf
241730040115     c                   If        Vi2Va4 > *Zeros
241740040115     c                   Movel     Vi2Sv4        Vsv(4)
241750040115     c                   Z-add     Vi2Va4        Vva(4)
241760040121     c                   Movel     Vi2Es4        Ves(4)
241770040115     c                   EndIf
241780041217     c                   If        Vi2Va5 > *Zeros
241790041217     c                   Movel     Vi2Sv5        Vsv(5)
241800041217     c                   Z-add     Vi2Va5        Vva(5)
241810041217     c                   Movel     Vi2Es5        Ves(5)
241820041217     c                   EndIf
241830041217     c                   If        Vi2Va6 > *Zeros
241840041217     c                   Movel     Vi2Sv6        Vsv(6)
241850041217     c                   Z-add     Vi2Va6        Vva(6)
241860041217     c                   Movel     Vi2Es6        Ves(6)
241870041217     c                   EndIf
241880980608     C                   MOVEL     'G'           TASSVA
241890040115     c                   Eval      TascVag = 'S'
241900980506    1C                   ENDIF
241910990915     C* MERCE PORTATA A MAGAZZINO DAL COD.AUTOTRASPORTATORE
241920990915     C*  PER I PREPAGATI LA RICHIESTA VIENE FATTA A VIDEO
241930990915     C     VIDPDR        IFLE      *ZEROS
241940990915     C     *IN22         ANDEQ     *ON
241950001024     C                   MOVEL     VIDMAG        TASFDN
241960990915     C                   ELSE
241970990915     C                   MOVEL     APDFCM        TASFDN
241980990915     C                   ENDIF
241990020220     c* se bolla in assegnato export faccio sempre pagare la varia U
242000020220     c     *in04         ifeq      *on
242010020220     c     A_§ogntw      ifeq      'EEX'
242020081008     c***  A_§ogntw      oreq      'EUP'
242030020220     c     A_§ogntw      oreq      'DPD'
242040020220     c     A_§ogntw      oreq      'FED'
242050020220     c                   clear                   tasfdn
242060020220     c                   endif
242070020220     c                   endif
242080941219     C*
242090970708     C                   MOVEL     MITCTS        TASMCT
242100021002     c**
242110030204
242120030204      * Bancali
242130030205If  1c                   If        %Subst(VidGva:1:1) ='B'
242140030204     c                   Eval      TasBan = VidNba + VidNb2
242150030205     c                   EndIf
242160030728      * Colli originali
242170030728If  1c                   If        %Subst(VidGva:1:1) ='O'
242180030728     c                   Eval      TasNcl = W03Cor
242190030728     c                   EndIf
242200030204
242210020503     c                   if        wtassa=' '
242220020503     c* se devo tassare solo una varia, da tipo bolla, la imposto
242230020503     c                   if        §3asva<>*blanks
242240020503     c                   eval      tassva=§3asva
242250020503     c                   endif
242260030623      *
242270030623     c                   endif
242280030623      * per prepagato passo al TNSF20R la varia  "D" e l'importo del dir.fat.
242290030623      * da sommare che prendo CNIND (INDSIN)
242300030623      *
242310030623     c                   if        *in34  or *in22
242320030623      * recupero le spese incasso
242330030623     c     kaco          chain     cnind00f
242340030623     c                   if        %found(cnind00f)
242350031007      * se diritto di fatturazione a zero con calcolo la varia D
242360031007     c                   if        indsin = 0
242370031007     c                   eval      wtassad='N'
242380031007      *
242390031007     c                   else
242400030623     c                   move      indsin        tasivdf
242410030623     c                   eval      tassvdf = 'D'
242420031007     c                   endif
242430031007      *
242440030623     c                   endif
242450030623      *
242460030623     c                   if        wtassa='N' and wtassad = ' '
242470030623     c* se ho già tassata la singola varia devo sommare il solo diritto di fattu
242480030623     c* maggiore di zero oppure se imponibile a zero ho la singola varia valoriz
242490030623     c                   if        tasimv > 0  or (tasimv = 0 and itassa > 0)
242500030623     c                   eval      tassva='D'
242510030623     c                   else
242520030623     c                   eval      wtassad = 'N'
242530030623     c                   endif
242540030623     c                   endif
242550030623     c**
242560030623     c                   if        wtassa = 'N' and wtassad = 'N'
242570030623     c                   goto      endtas
242580030623     c                   endif
242590040115      * no prepagato
242600040115     c                   Else
242610040115     c                   if        wtassa = 'N'
242620040115     c                   goto      endtas
242630040115     c                   endif
242640040115     c                   endif
242650030623     c*
242660990701     C                   CLEAR                   WFIAS
242670990701     C                   MOVEL     PARAMF        KPJBU
242680991014      *
242690941219     C                   CALL      'TNSF20R'
242700941221     C                   PARM                    KPJBA
242710991007     C                   PARM                    DTAS
242720991007     C                   PARM                    DTASV
242730941219     C*
242740941219     C                   Z-ADD     0             NRR
242750941219     C                   Z-ADD     1             C
242760991014      *
242770991014      * PRIMA BOLLA
242780980506    1C     WBOL          IFEQ      '1'
242790991014     C* IMPOSTO LE VARIE
242800941219    2C                   DO        20            C
242810991027     C                   MOVEL     VSV(C)        WSVN
242820991027     C                   Z-ADD     VVA(C)        WVAN
242830941219     C                   MOVEL     VES(C)        WEV1
242840941219     C                   EXSR      CARVAR
242850941219    2C                   ENDDO
242860991025     C*
242870991025     C                   ADD       1             NRR
242880991025     C     NRR           DO        20            NRR
242890991025     C     NRR           CHAIN     LS01S03                            30
242900991025     C                   CLEAR                   V3CSV1
242910991025     C                   CLEAR                   V3CVA1
242920991025     C                   CLEAR                   V3HVA1
242930991025     C                   CLEAR                   V3CEV1
242940991025     C   30              WRITE     LS01S03
242950991025     C  N30              UPDATE    LS01S03
242960991025     C                   ENDDO
242970930415     C*
242980980506    2C     TASERR        IFEQ      *BLANKS
242990901031     C                   MOVEL     TASPOR        VIDPOR
243000991015     C                   MOVEL     TASPOR        MEMPOR
243010950220     C                   Z-ADD     TASQFT        VIDQFT
243020991014     C                   MOVEL     TASIMV        VIDIMV
243030991015     C                   MOVEL     TASDIV        VIDDIV
243040991015     C                   MOVEL     TASDIV        WDIV1
243050991015      *
243060991015   X2C                   ELSE
243070991015     C     TASMSG        IFEQ      *BLANKS
243080991015     C                   MOVEL     ERR(104)      VIDMSG
243090991015     C                   ELSE
243100991015     C                   MOVEL(P)  TASMSG        VIDMSG
243110991015     C                   ENDIF
243120991015     C                   SETON                                        9052
243130991015    2C                   ENDIF
243140991014      *
243150991014      * 2 BOLLA
243160980506   X1C                   ELSE
243170040115     c                   Clear                   ContaSv
243180040115      * carico le varie
243190040115Do  2c                   Do        20            c
243200040115If  3c                   If        Vsv(c) <> §$2Iva and
243210040115     c                             Vsv(c) <> §$2Bol
243220040115     c                   Add       1             ContaSv
243230040115S   4c                   Select
243240040115     c                   When      ContaSv = 1
243250040115     c                   Movel     Vsv(c)        Vi2Sv1
243260040115     c                   Z-add     Vva(c)        Vi2Va1
243270040121     c                   Movel     Ves(c)        Vi2Es1
243280040115     c                   When      ContaSv = 2
243290040115     c                   Movel     Vsv(c)        Vi2Sv2
243300040115     c                   Z-add     Vva(c)        Vi2Va2
243310040121     c                   Movel     Ves(c)        Vi2Es2
243320040115     c                   When      ContaSv = 3
243330040115     c                   Movel     Vsv(c)        Vi2Sv3
243340040115     c                   Z-add     Vva(c)        Vi2Va3
243350040121     c                   Movel     Ves(c)        Vi2Es3
243360040115     c                   When      ContaSv = 4
243370040115     c                   Movel     Vsv(c)        Vi2Sv4
243380040115     c                   Z-add     Vva(c)        Vi2Va4
243390040121     c                   Movel     Ves(c)        Vi2Es4
243400041217     c                   When      ContaSv = 5
243410041217     c                   Movel     Vsv(c)        Vi2Sv5
243420041217     c                   Z-add     Vva(c)        Vi2Va5
243430041217     c                   Movel     Ves(c)        Vi2Es5
243440041217     c                   When      ContaSv = 6
243450041217     c                   Movel     Vsv(c)        Vi2Sv6
243460041217     c                   Z-add     Vva(c)        Vi2Va6
243470041217     c                   Movel     Ves(c)        Vi2Es6
243480040115    4c                   EndSl
243490040115    3c                   EndIf
243500040115    2c                   EndDo
243510991014      *
2435209806080   2C     TASERR        IFEQ      ' '
243530040115     C                   MOVEL     TASDIV        VI2DIV
243540040115     C                   MOVEL     TASDIV        WDIV2
243550040126     c                   Movel     TasImv        Vi2Imv
243560980506     C**
243570980506   X2C                   ELSE
243580980506     C* MANCA TARIFFA
243590980608     C     TASMSG        IFEQ      *BLANKS
243600980506     C                   MOVEL     ERR(104)      VIDMSG
243610980608     C                   ELSE
243620980608     C                   MOVEL(P)  TASMSG        VIDMSG
243630980608     C                   ENDIF
243640980506     C                   SETON                                        9041
243650980506    2C                   ENDIF
243660980506    1C                   ENDIF
243670940923     C*
243680940919     C     ENDTAS        ENDSR
243690990630     C*
243700990630     C* CALCOLO IL TOTALE FATTURA ------------------------------------*
243710990630     C     TOTFAT        BEGSR
243720991014      *
243730991015      *  RECUPERO L'ARROTONDAMENTO
243740991102     C                   CLEAR                   DSBS02
243750991102     C                   MOVEL     'C'           T02MOD
243760991102     C                   MOVEL     KNSIF         T02SIF
243770991102     C                   MOVEL     'GEI'         T02COD
243780991102     C                   MOVEL     VIDDIV        T02KE1
243790991102      *
243800991102     C                   CALL      'TIBS02R'
243810991102     C                   PARM                    KPJBA
243820991102     C                   PARM                    DSBS02
243830991102      *
243840991102     C     T02ERR        IFEQ      *BLANKS
243850991102     C                   MOVEL     T02UNI        DGEI
243860991102     C                   ELSE
243870991102     C                   CLEAR                   DGEI
243880991102     C                   ENDIF
243890991015      *
243900990630     C     VIDIMV        IFGT      0
243910991014     C                   CLEAR                   DSLV04
243920990630     C                   Z-ADD     COMDFT        D04DFT
243930991014     C                   Z-ADD     VIDIMV        D04IMV
243940991014     C                   MOVEL     VIDDIV        D04DIV
243950990630     C                   MOVEL     VIDCEI        D04CEI
243960991014     C                   MOVEL     VIDTIC        D04TIC
243970990630     C                   Z-ADD     VIDCAS        D04CAS
243980990630     C                   MOVEL     VIDVCA        D04VCA
243990990630     C                   Z-ADD     VIDPOR        D04POR
244000990701     C     *IN22         IFEQ      *ON
244010991015     C                   MOVEL     §GEAED        D04AED
244020991015     C                   Z-ADD     §GEAVL        D04VAR
244030990701     C                   ENDIF
244040991014     C     *IN04         IFEQ      *ON
244050991014     C                   MOVEL     '1'           D04SPE
244060991014     C                   ELSE
244070991014     C                   MOVEL     '8'           D04SPE
244080991014     C                   ENDIF
244090991014     C                   MOVEL     §3ATB1        D04TBL
244100991014      *
244110991014     C                   CALL      'FNLV04R'
244120991014     C                   PARM                    DSLV04
244130991007     C                   PARM                    DTASV
244140990630     C                   ENDIF
244150991014      *
244160990630     C                   ENDSR
244170930915     C*
244180930915     C* ANNULLAMENTO BOLLA -------------------------------------------*
244190930915     C     ANNULL        BEGSR
244200930915     C                   SETOFF                                       90
244210060307     C                   clear                   wf12              1
244220970408     C* NON POSSO ANNULLARE MAI UNA BOLLA LEGATA
244230940915     C     KBLP3         CHAIN     FNLBL01L                           30
244240930915     C*
244250930915    1C     *IN30         IFEQ      *OFF
244260941020     C                   MOVEL     ERR(65)       VIDMSG
244270941020     C                   SETON                                        90
244280970408    1C                   ENDIF
244290040614     c* Non posso annullare mai una bolla £ se lnp=lna
244300040611     C  N90BLPCBO        ifeq      '£ '
244310040611     C     BLPLNP        ANDeq     BLPLNA
244320040611     C                   MOVEL     ERR(282)      VIDMSG
244330040611     C                   SETON                                        90
244340040611     c                   endif
244350061127     c* Non posso annullare bolla con C.A.
244360141202     c                   if        not *in90
244370061127     c                   clear                   fidn12ds
244380061127     c                   eval      dn_i12aas = §LPAAS
244390061127     c                   eval      dn_i12lnp = §LPLNP
244400061127     c                   eval      dn_i12nrs = §LPNRS
244410061127     c                   eval      dn_i12nsp = §LPNSP
244420061127     c                   eval      dn_i12fel = 'E'
244430061127     c                   eval      dn_i12fan = 'E'
244440061127     c                   call      'FIDN12R'
244450061127     c                   parm                    fidn12ds
244460061127     c* se numero di CA trovate maggiore di zero
244470061127     c                   if        dn_o12nca > 0
244480061127     C                   MOVEL     ERR(310)      VIDMSG
244490061127     C                   SETON                                        90
244500061127     c                   endif
244510141202     c                   endif
244520110321     c* avviso se sono presenti spunte entrata
244530141202     c                   if        not *in90
244540110321     c                   if        wforzbrv=*off
244550110321     c                   eval      wcheck=*on
244560110321     c                   exsr      sr_gesbranm
244570110321     c                   if        *in90
244580110321     C                   MOVEL     ERR(336)      VIDMSG
244590110321     c                   endif
244600110321     c                   eval      wforzbrv=*on
244610110321     c                   endif
244620141202     c                   endif
244630060210     c* ANNULLAMENTO DI UN PREPAGATO
244640060210     c* verifico se in caso di annullamento prepagati devo richiedere
244650060210     c* la motivazione
244660060308     c                   movel     'KM'          wcvb
244670060308     c                   exsr      cls_lv85
244680060210     c                   clear                   ilv85cvb
244690070514     c**n90              if        *in22 = *ON and dateu >= §vpogpp
244700070514     c  n90              if        *in22 = *ON
244710060213     c*  Prima di tutto controllo che il prepagato non sia già stato incassa
244720060213     c*  to
244730060213     c                   exsr      sr_callycow
244740060213     c                   if        prmesito <> 0
244750060213     C                   MOVEL     ERR(297)      VIDMSG
244760060213     C                   SETON                                        90
244770060213     c                   else
244780110419     c*  Poi controllo che l'ORM non sia in distinta
244790110419     c                   if        ormndc>0
244800110419     c                   seton                                        90
244810110419     c*        errore: ORM già ritirato
244820110419     c                   if        ormfao=600
244830110419     C                   MOVEL     ERR(337)      VIDMSG
244840110419     c                   else
244850110419     c*        errore: per annullare togliere l'orm dalla distinta
244860110419     C                   MOVEL     ERR(338)      VIDMSG
244870110419     c                   endif
244880110419     c                   else
244890060227     c                   movel     '7L'          cod
244900060227     C                   MOVEL(P)  'KM'          KEY
244910060227     C                   EXSR      CTABEL
244920060227     C                   MOVEL     TBLUNI        DS7L
244930060227     c                   if        §7lmtv = 'S'
244940060210     c                   clear                   fnlv85ds
244950060210     c                   eval      ilv85cvb = 'KM'
244960060210     c                   eval      ilv85tel = 'V'
244970060309     c                   z-add     5             ilv85row
244980060210     c                   movel     fnlv85ds      kpjbu
244990060210     c                   call      'FNLV85R'
245000060210     c                   parm                    kpjba
245010060227     c*****              parm                    ds7l
245020060210     c                   movel     kpjbu         fnlv85ds
245030060210     c* F12=Ritorno --> riemetto formato 01
245040060210     c                   if        olv85f12 = '1'
245050060307     c                   eval      wf12   = '1'
245060060307     c                   goto      fannull
245070060210     c                   endif
245080060227     c                   endif
245090060213     c                   endif
245100060210     c                   endif
245110110419     c                   endif
245120060125
245130060125      * Richiamo il pgm per annullare l'ORM legato alla bolla RC
245140100604     c***                If        blpgma = 'RC'
245150110321     c  n90              If        w7rRC  = 'S'
245160060125     c                   Clear                   fnls25ds
245170060125     c                   If        blpccm > *Zeros
245180060125     c                   Eval      i25Ksc = blpccm
245190060125     c                   Else
245200060125     c                   Eval      i25ksc = blpksc
245210060125     c                   EndIf
245220060125     c                   Move      blpaas        i25aas
245230060125     c                   Eval      i25spe = %editc(blplnp:'X') +
245240060125     c                                      %editc(blpnrs:'X') +
245250060125     c                                      %editc(blpnsp:'X')
245260060125     c                   Call      'FNLS25R'
245270060125     c                   Parm                    Fnls25ds
245280060125     c                   EndIf
245290061122     c* se annullamento di un prepagato richiamo il seguente pgm per
245300061122     c* chiudere l'orm. No considero eventuali errori ricevuti dal
245310061122     c* pgm in quanto ininfluenti per questa operazione
245320070627     c  n90              if        *in22=*on and S_§b4fit<>*all'9'
245330061122     c                   clear                   fior51ds
245340061122     c                   z-add     s_§b4poe      i51poe
245350061122     c                   z-add     s_§b4nsr      I51NSR
245360061122     c                   z-add     s_§b4nor      I51NOR
245370061122     c                   z-add     s_§b4nrv      I51NRV
245380061122     c                   z-add     999           i51far
245390061122     c                   movel     '80'          i51car
245400061122     c                   call      'FIOR51R'
245410061122     c                   parm                    fior51ds
245420061122     c                   endif
245430060125
245440970408     C****
245450930915     C* CANCELLAZIONE FISICA FILES
245460930915     C  N90              EXSR      DELBLP
245470941020     C* PASSO NEL FALG PROVENIENZA '1' PER INDICARE CHE LA BOLLA E'
245480941011     C*  STATA ANNULLATA
245490941020     C                   MOVEL     '1'           §LPFPR
245500930915     C*
245510060307     C     fannull       ENDSR
245520901031     C*
245530930915     C*--- CANCELLAZIONE FISICA BOLLA IN TUTTI I SUOI FILES ----------*
245540930915     C     DELBLP        BEGSR
245550950410     C*
245560930915     C* SCRIVO RECORD IN FLBLA
245570070514     c***                if        *in22 = *off or dateu < §vpogpp
245580070514     c                   if        *in22 = *off
245590900511     C                   MOVEL     BLPLNP        BLALNP
245600900511     C                   MOVEL     BLPAAS        BLAAAS
245610900511     C                   MOVEL     BLPMGS        BLAMGS
245620900511     C                   MOVEL     BLPNRS        BLANRS
245630900511     C                   MOVEL     BLPNSP        BLANSP
245640900511     C                   MOVEL     BLPLNA        BLALNA
245650080904     C                   MOVEL     §3atb1        BLATBL
245660900511     C                   MOVEL     DATEU         BLADAN
245670170214     C                   MOVEL     simfel_s      BLAfle
245680110411     C                   MOVEL     blpcbo        BLAcbo
245690110411     c                   time                    blaoan
245700110411     c                   movel     knmus         blapru
245710110411     c                   movel     knmtd         blamtd
245720110411     c                   if        blpccm>0
245730110411     c                   z-add     blpccm        blaccm
245740110411     c                   else
245750110411     c                   if        not *in04
245760110411     c                   z-add     blpksc        blaccm
245770110411     c                   endif
245780110411     c                   endif
245790110411     c                   z-add     blprmn        blarmn
245800110411     c                   movel     blprma        blarma
245810110411     c                   movel     blprsm        blarsm
245820110411     c                   movel     blpinm        blainm
245830110411     c                   movel     blpcam        blacam
245840110411     c                   movel     blplom        blalom
245850110411     c                   movel     blpprm        blaprm
245860110411     c                   movel     blpnzm        blanzm
245870110411     c                   movel     blprsd        blarsd
245880110411     c                   movel     blpcad        blacad
245890110411     c                   movel     blplod        blalod
245900110411     c                   movel     blpprd        blaprd
245910110411     c                   movel     blpnzd        blanzd
245920110411     c                   movel     blpctm        blactm
245930110411     c                   z-add     blpncl        blancl
245940110411     c                   z-add     blppkb        blapkb
245950110411     c                   z-add     blpfls        blafls
245960110411     c                   z-add     blpncd        blancd
245970110411     c                   z-add     blpnca        blanca
245980080904     C                   WRITE     TNBLA000
245990060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
246000060210     c* anomalie
246010110321     c                   eval      wcheck=*off
246020060210     c                   exsr      sr_gesbranm
246030060210     c                   endif
246040060210     C* DISALLOCAZIONE FILES
246050001130      *
246060061212     C                   UNLOCK    FNBLP00F
246070051115     C                   UNLOCK    Fiar901L
246080001211     C                   UNLOCK    FIAR601L
246090001211     C                   UNLOCK    FIAR701L
246100060215     C                   UNLOCK    Fiar401L
246110001211     C                   UNLOCK    FNBLT01L
246120051102     C                   UNLOCK    FIARS01L
246130120814     C                   UNLOCK    FIART01L
246140060210     c*
246150070514     c* OPERAZIONI PER PREPAGATI
246160070514     c****               if        *in22 = *on and dateu >= §vpogpp
246170070514     c                   if        *in22 = *on
246180060210     c* richiamo fnlr48r per storicizzare la variazione
246190060210     c* ed effettuare altri eventuali aggiornamenti su file contrassegni
246200060210     c* e tassazione seconda bolla. L'aggiornamento della testata bolla
246210060210     c* viene effettuato in questo pgm al compimento di tutti gli aggiornam.
246220060303     c                   clear                   fnlr48ds
246230060210     C                   MOVEL     'L'           D48TLA
246240060210     C                   z-add     blplnp        D48FGS
246250060210     C                   z-add     blpaas        D48AAS
246260060210     C                   MOVE      blpLNP        D48LNP
246270060210     C                   MOVE      blpNRS        D48NRS
246280060210     C                   MOVE      blpNSP        D48NSP
246290060210     C                   MOVE      blpcbo        D48CBO
246300060210     C                   MOVEL     'KM'          D48CVB
246310060210     C                   MOVEL     'K'           D48TRC
246320060210     C                   MOVEL     'E'           D48FFR
246330060210     C                   MOVEL     ' '           D48ERR
246340060210     C                   MOVEL     *BLANK        D48MSG
246350060210     C                   MOVEL     'P'           D48TBO
246360060303     c                   movel     'N'           d48mct
246370060307     c                   eval      d48mtv = olv85mtv
246380060307     c                   movel     olv85nt1      d48not
246390060307     c                   move      olv85nt2      d48not
246400060210     c                   clear                   dsarbk
246410060210     C                   MOVEL     'M'           §BKcbn
246420060210     C                   MOVEL     fnlr48ds      KPJBU
246430060210     C                   CALL      'FNLR48R'
246440060210     C                   PARM                    KPJBA
246450060210     C                   PARM                    DSARBD
246460060210     C                   PARM                    DSARBK
246470060210     C                   PARM                    DARBT
246480060210     C                   PARM                    DSARBG
246490060210     C                   PARM                    trul90ds
246500060210     C                   MOVEL     KPJBU         fnlr48ds
246510060210     C     D48ERR        IFne      *BLANK
246520060210     c                   seton                                        90
246530060213     c                   movel     D48msg        vidmsg
246540060210     c                   goto      e_del
246550060210     C                   END
246560060210     c* rialloco fnblp
246570061218     C     savnrr        CHAIN     FNBLP000                           90
246580060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
246590060210     c* anomalie
246600110321     c                   eval      wcheck=*off
246610060210     c                   exsr      sr_gesbranm
246620060210     c                   endif
246630001211     C*
246640160202     c* Chiudo Dispo per la consegna e R.A. se presenti
246650160202     c                   exsr      sr_chiuDispoRa
246660060210     C* RICHIAMO PROGRAMMA DI CANCELLAZIONE
246670060210     C*
246680001130     C                   MOVE      KPJBU         WA256           256
246690001130     C                   CLEAR                   DSLS63
246700060213     c* se è un prepagato lo richiamo in modalità "P" per cancellare solo
246710060213     c* il dettaglio colli e suoi file legati
246720070514     c****               if        *in22 = *on and dateu >= §vpogpp
246730070514     c                   if        *in22 = *on
246740060210     c                   movel     'P'           i63mod
246750060210     c                   endif
246760001130     C                   MOVE      BLPAAS        I63AAS
246770001130     C                   MOVE      BLPLNP        I63LNP
246780001130     C                   MOVE      BLPNRS        I63NRS
246790001130     C                   MOVE      BLPNSP        I63NSP
246800001130     C                   MOVEL     DSLS63        KPJBU
246810001130     C                   CALL      'FNLS63R'
246820001130     C                   PARM                    KPJBA
246830001130     C                   MOVE      WA256         KPJBU
246840081020     c                   clear                   trtc86drds
246850081020     c* richiamo pgm per cancellare eventuali record su firab
246860081020     c                   eval      i86mod='DC'
246870081020     c                   z-add     blpaas        i86aasb
246880081020     c                   z-add     blplnp        i86lnpb
246890081020     c                   z-add     blpnrs        i86nrsb
246900081020     c                   z-add     blpnsp        i86nspb
246910081020     c                   call      'TRTC86DRR'
246920081020     c                   parm                    trtc86drds
246930060210     c*
246940070514     c* OPERAZIONI PER PREPAGATI
246950070514     c****               if        *in22 = *on and dateu >= §vpogpp
246960070514     c                   if        *in22 = *on
246970060210     C                   exsr      sr_aggblp
246980060210     c                   endif
246990910807     C*
247000060210     C     e_del         ENDSR
247010060210     C*--- Operazioni su spunte e anomalie a fronte di f16=Annullam --*
247020060210     C     sr_gesbranm   BEGSR
247030060210     C* LEGGO FNBLT SE ESISTE
247040060210     C                   MOVEL     5             KNPG
247050060210     C                   MOVEL     SIMFEL        KFLE
247060060210     C*
247070120817     C***  KBLP3         SETLL     FNBLT000                               30
247080120817     C     KBLP3         SETLL     FIART000                               30
247090060210    1C     *IN30         IFEQ      *ON
247100120817     C***  KBLP3         READE(N)  FNBLT000                               30
247110120817     C     KBLP3         READE(N)  FIART000                               30
247120060210    2C     *IN30         DOWEQ     *OFF
247130110321   2ac                   if        wcheck=*on
247140120817     C***  KBRV          setll     FNBRV000
247150120817     C     KBRVA         setll     FNBRV000
247160110321     c                   if        %equal(fnbrv09l)
247170110321     c                   seton                                        90
247180110321     c                   leavesr
247190110321     c                   endif
247200110321  x2ac                   else
247210060210     C* SPUNTE ENTRATA
247220120817     C***  KBRV          CHAIN     FNBRV000                           31
247230120817     C     KBRVA         CHAIN     FNBRV000                           31
247240060210    3C     *IN31         DOWEQ     *OFF
247250060210     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
247260060210     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
247270060210     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
247280060210     c* no anomalie da cancellare create a fronte della spunta entrata
247290060210     c**                 z-add     brvnfv        wrvnfv
247300060210     c**                 movel     param2        kpjbu
247310060210     C**                 CALL      'FNLSA8R'
247320060210     C**                 PARM                    KPJBA
247330070123     C                   DELETE    FNBRV000
247340120817     C***  KBRV          READE     FNBRV000                               31
247350120817     C     KBRVA         READE     FNBRV000                               31
247360060210    3C                   ENDDO
247370060210     c* se presenti anomalie con key segnacollo aventi anche la spedizione
247380060210     C* le aggiorno togliendo i dati della spedizione se invece si tratta
247390060210     c* di anomalie  con key spedizione aventi anche il segnacollo le deleto
247400060210     c     kanm2         setll     fnanm02l
247410060210    3c                   do        *hival
247420060210     c     kanm2         reade     fnanm02l
247430060210    4c                   if        %eof(fnanm02l)
247440060210     c                   leave
247450060210    4c                   endif
247460060210     c                   movel     '7C'          cod
247470060210     c                   movel(p)  anmcaa        key
247480060210     C                   EXSR      CTABEL
247490060210     C                   MOVEL     TBLUNI        DS7C
247500060210    4c                   if        §7ckey = 'S'
247510060210     c                   clear                   anmaas
247520060210     c                   clear                   anmlnp
247530060210     c                   clear                   anmnsp
247540060210     c                   update    fnanm000
247550060210   x4c                   else
247560060210     c                   delete    fnanm000
247570060210    4c                   endif
247580060210    3c                   enddo
247590060210     C*
247600110321   2ac                   endif
247610110321     c*
247620120817     C***  KBLP3         READE(N)  FNBLT000                               30
247630120817     C     KBLP3         READE(N)  FIART000                               30
247640060210    2C                   ENDDO
247650060210    1C                   ENDIF
247660060210     c* leggo eventuali anomalie rimaste con key spedizione e se ce ne sono
247670060210     c* le deleto
247680110321     c                   if        wcheck=*off
247690060210     c     kanm1         setll     fnanm01l
247700060210    1c                   do        *hival
247710060210     c     kanm1         reade     fnanm01l
247720060210     c                   if        %eof(fnanm01l)
247730060210     c                   leave
247740060210     c                   endif
247750060210     c                   delete    fnanm01
247760060210    1c                   enddo
247770110321     c                   endif
247780060210     c                   endsr
247790060210     C*--- Operazioni aggiornamento fnblp  a fronte di f16 su prepagato
247800060210     C     sr_aggblp     BEGSR
247810060210     c                   z-add     dateu         blpdrt
247820060210     c                   z-add     999           blppdr
247830060210     C                   eval      BLPFPP = 'P'
247840060214     c                   movel     'N'           blpft1
247850060214     c                   movel     'N'           blpft2
247860060210     C                   MOVEL     *ALL'9'       BLPNFV
247870060210     C                   MOVEL     '4 '          BLPctm
247880060210     c                   movel     'M '          blpcbo
247890060303     c* azzero importo da assicurare altrimenti in ricezione bolle in sede
247900060303     c* scrive fiar4 trk "c" e fiarbt0e
247910060303     c                   clear                   blpias
247920060303     c                   clear                   blpvas
247930060210     c                   update    fnblp000
247940060210     c                   endsr
247950900824     C*
247960900824     C*--- CARICO RECORD BOLEL DA DISK CLIENTI -----------------------*
247970900824     C     CARBLC        BEGSR
247980100319     c                   clear                   WesORE            1
247990100319     c                   clear                   DoreGEN
248000140122     C***                CLEAR                   DSBL4J
248010980115     C                   MOVEL     CMAIUS        MA               26
248020980115     C                   MOVEL     CMINUS        MI               26
248030000124     C* SPIEGO IL SIGNIFICATO DEL FLAG §LPFPR:
248040950419     C* - SE "V" - VISUALIZZO SEMPRE LA BOLLA CHE CONFERMO
248050950419     C* - SE "X" - VISUALIZZO SOLO SE C'E' ERRORE
248060950419     C* - SE "W" - NON VISUALIZZO MAI MA PASSO CODICE DI ERRORE
248070950419     C*
248080930630     C                   MOVEL     *OFF          *INKL
248090930630     C                   MOVEL     *OFF          *INKC
248100930630     C                   MOVEL     *OFF          *INKI
248110930630     C                   MOVEL     *OFF          *INKF
248120940927     C*
248130940921     C                   Z-ADD     0             WKSC
248140091221     c                   clear                   wvidgma
248150100604     c                   clear                   w7rRC
248160141202     c                   clear                   w7rPC
248170160225     c                   clear                   w_adpd
248180940927     C* D A T E
248190910702     C* DATA SPEDIZIONE
248200940926     C                   Z-ADD     §LPMGS        BLPDSP
248210940926     C                   MOVEL     §LPAAS        BLPDSP
248220970512     C*
248230970512     C* LA LINEA DI PARTENZA E' QUELLA DEL CODICE AUTOTRASP.
248240970512     C                   MOVEL     §LPPDR        VIDLNP
248250971216     C     VIDLNP        IFNE      BLCLNP
248260971216     C                   Z-ADD     VIDLNP        W0030
248270971216     C     W0030         CHAIN     AZORG01L      UNIORG               30
248280000508     C                   MOVEL     ORGDE3        OG143
248290971216     C                   MOVEL     VIDLNP        BLCLNP
248300971216     C                   ENDIF
248310941011     C*
248320940927     C* DATA CONSEGNA RICHIESTA
248330940927     C                   Z-ADD     §LPDCR        VIDDCR
248340941011     C* SIGLA OPERATORE VIDEO
248350941011     C                   MOVEL     §LPSOP        VIDSOP
248360960926     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
248370941011     C                   Z-ADD     §LPDRT        VIDDRT
248380940927     C                   MOVEL     §LPNRT        VIDNRT
248390940927     C                   MOVEL     §LPFPP        VIDFPP
248400010220     C                   MOVEL     §LPFPP        PREFPP
248410900824     C*
248420941011     C                   MOVEL     §LPPDR        W0030
248430960927     C     W0030         IFNE      VIDLNP
248440941011     C                   CLEAR                   VIDPDR
248450010220     C                   CLEAR                   PREPDR
248460941011     C                   ELSE
248470941011     C                   MOVE      §LPPDR        VIDPDR
248480010220     C                   MOVE      §LPPDR        PREPDR
248490941011     C                   ENDIF
248500010212     C* NUMERO O.R.M.
248510010220     C* SE RICHIAMATO DA PGM GIACENZE IMPOSTO NUMERO ORM FITTIZIO
248520020522     c* idem se richiamato da pgm ritiri annullati
248530150302     c* idem se richiamato da Gestione Bancali
248540010220     C     §LPFPR        IFEQ      'G'
248550010220     C     §LPFPR        OREQ      'I'
248560010220     C     §LPFPR        OREQ      'P'
248570020522     C     §LPFPR        OREQ      'T'
248580150302     C     §LPFPR        OREQ      'B'
248590010220     C                   MOVEL     §LPPDR        W0030             3 0
248600010220     C     W0030         CHAIN     AZORG01L      UNIORG               30
248610010220     C  N30              MOVEL     ORGDE8        OG148
248620010220     C   30              CLEAR                   OG148
248630060926     c* faccio finta che abbia sempre la procedura ORM attiva
248640060926     c                   eval      §ogorm='S'
248650060926     c
248660010220     C     §OGORM        IFEQ      'S'
248670010220     C                   MOVEL     §LPPDR        VIDPOE
248680010220     C                   MOVE      *ALL'9'       VIDNOR
248690010220     C                   MOVE      *ALL'9'       VIDNRV
248700010220     C                   ELSE
248710010220     C                   MOVE      *ZEROS        VIDPOE
248720010220     C                   MOVE      *ZEROS        VIDNOR
248730010220     C                   MOVE      *ZEROS        VIDNRV
248740010220     C                   ENDIF
248750011126     C                   CLEAR                   ATRDES
248760150303     c*
248770150303     c                   if        §lpfpr='B'
248780150303     c                   movel     prot          atrdes
248790150303     c                   endif
248800010220     C                   ELSE
248810010212     C                   Z-ADD     §LPPOE        VIDPOE
248820010222     C                   MOVEL     §LPNSR        VIDNOR
248830010222     C                   MOVE      §LPNOR        VIDNOR
248840010212     C                   Z-ADD     §LPNRV        VIDNRV
248850011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
248860011126     C                   Z-ADD     VIDPOE        WOPOE
248870011126     C                   Z-ADD     VIDNOR        WONOR
248880011126     C                   Z-ADD     VIDNRV        WONRV
248890011126     C                   Z-ADD     VIDLNP        WOLNP
248900011126     C                   CLEAR                   DORM01
248910011126     C     KORM          CHAIN     FNORM01L                           30
248920011126     C  N30              MOVEL     ORMFLO        DORM01
248930011126     C     §ORMFD        IFEQ      'S'
248940011126     C                   MOVEL     PROT          ATRDES
248950011126     C                   ELSE
248960011126     C                   CLEAR                   ATRDES
248970011126     C                   ENDIF
248980111209     c* se sull'orm sono presenti le note le visualizzo subito
248990111209     c                   if        not *in30 and
249000111209     c                             (ormno1<> *blanks or ormno2<>*blanks)
249010111209     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
249020120127     c                   movel     ormno1        vidno1
249030120127     c                   movel     ormno2        vidno2
249040120127     c                   movel     'NoteOrm'     viddno
249050111209     c                   endif
249060010220     C                   ENDIF
249070100319     c
249080010212     C                   MOVEL     VIDORM        W01ORM
249090940927     C* CODICE BOLLA
249100940926     C                   MOVEL     §LPCBO        VIDCBO
249110940929     C* PARTITA IVA
249120940929     C                   MOVEL     §LPCPI        WPIVA
249130011206     C*
249140011206     C* IMPOSTO IL CODICE CLIENTE MITTENTE
249150011206     C                   MOVE      §LPCCN        WKSC
249160011206     C                   MOVE      §LPCCN        VIDCCM
249170011206     C                   MOVE      §LPCCN        WCCMS
249180011206     C                   MOVEL     §LPCCN        W0030
249190011206     C* CODICE TRATTAMENTO MERCE
249200011206     C                   MOVEL     §LPCTM        VIDCTM
249210011206     C                   MOVEL     VIDCTM        WCTM
249220011206     C                   EXSR      CTRCTM
249230011206     C* SE TROVATO ERRORE DOPO LO FACCIO RICONTROLLARE
249240011206     C     *IN90         IFEQ      *ON
249250120903     c     vidctm        oreq      *blanks
249260011206     C                   SETOFF                                       90
249270011206     C                   CLEAR                   SAVCTM
249280011206     C                   CLEAR                   DS1B
249290011206     C                   ENDIF
249300940927     C* LINEA ARRIVO
249310020621     C     §1BFG1        IFeq      'S'
249320140506     C     §1BF12        andne     'B'
249330020320     c     §1bf14        oreq      'S'
249340140506     C     §1BF12        andne     'B'
249350980126     C     §LPFPR        OREQ      'G'
249360980126     C     §LPFPR        OREQ      'P'
249370980126     C     §LPFPR        OREQ      'I'
249380150302     C     §LPFPR        OREQ      'B'
249390011206     C* SE DISK "C" EX DISK "B" LNA E ZNC DEVONO RIMANERE = 0
249400140506     C***  §1BF12        IFNE      'B'
249410911031     C                   MOVEL     §LPLNA        VIDLNA
249420980126     C                   MOVEL     §LPZNC        VIDZNC
249430140506     C***                ENDIF
249440980126     C                   ENDIF
249450970512     C*
249460970512     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
249470970512     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
249480970512     C     W0030         IFNE      VIDLNP
249490970512     C                   SETON                                        1438
249500970512     C                   MOVEL     W0030         VIDFLC
249510970512     C                   ENDIF
249520940929     C* DATI FATTURA
249530940929     C                   MOVEL     §LPCEI        VIDCEI
249540940929     C                   MOVEL     §LPNFT        VIDNFT
249550940929     C                   MOVEL     §LPFIV        VIDFIV
249560940929     C                   Z-ADD     §LPDFT        VIDDFT
249570080327     C* TIPO SERVIZIO: lo carichiamo solo se inseribile dal bollettista/clie
249580080327     C                   MOVEL     §LPTSP        VIDTSP
249590080327     C                   Z-ADD     1             C
249600080327     C     vidtsp        LOOKUP    TSP(C)                                 30
249610080327     c                   if        not *in30 or uts(C)<>'S'
249620080327     c                   clear                   vidtsp
249630080327     c                   endif
249640080327     c
249650941115     C* CONSEGNE PARTICOLARI
249660941115     C                   MOVEL     §LPTC1        VIDTC1
249670941115     C                   MOVEL     §LPTC2        VIDTC2
249680091001     C                   MOVEL     §LPTC1        sav_tc1
249690091001     C                   MOVEL     §LPTC2        sav_tc2
249700091001     c                   clear                   w_ar5tcp
249710940929     C*
249720940929     C* D E C O D I F I C H E   BOLLA
249730940927     C                   EXSR      DECBOL
249740030303
249750030303      * Controllo se proteggere o meno il campo del rif. mitt. alf.
249760080331      * Bolla non manutenzionabile proteggo (solo se rma <> blanks)
249770080331     c                   If        §3aucb = 'N'
249780080331     c                   if        §lprma<>*blanks
249790030304     c                   Movel     Prot1         AtrRma
249800030304     c                   Eval      wrma = 's'
249810080331     c                   endif
249820030303     c                   Else
249830030303      * Provengo da giacenze e il p.o. del cliente è DPD proteggo
249840030303     c                   If        (§lpfpr = 'P' or §lpfpr = 'G')
249850060627     C                   MOVEL     OG143         SAV143
249860030303     c                   Clear                   og143
249870060627     c     w0030         Chain     Azorg01l      uniorg
249880030303     c                   If        %Found(Azorg01l)
249890030303     c                   Movel     orgde3        og143
249900030303     c                   Endif
249910030303     c                   If        §Ogntw = 'DPD'
249920030304     c                   Movel     Prot1         AtrRma
249930030304     c                   Eval      wrma = 's'
249940030303     c                   EndIf
249950060627     C                   MOVEL     SAV143        OG143
249960030303     c                   Endif
249970030303     c                   Endif
249980081014     C** Memorizzo se per il cliente del vab si gestisce il raggruppamento
249990081014     c** bolle
250000081014     C                   CLEAR                   DS3C
250010081014     C                   MOVEL     '3C'          COD
250020081014     C                   MOVEL(P)  §lpccm        KEY
250030081014     C                   EXSR      CTABEL
250040081014     C  N30              MOVEL     TBLUNI        DS3C
250050081014     c                   eval      §3cabd_s=§3cabd
250060980310     C* CARICO LA DS3C DEL CLIENTE PER VEDERE SE MANTIENE IL NUMERO
250070060216     C*  DI SPEDIZIONE PER VEDERE SE CHAINARE RECORD E DI ar4
250080980310     C                   CLEAR                   DS3C
250090980310     C                   MOVEL     '3C'          COD
250100980310     C                   MOVEL(P)  WKSC          KEY
250110980310     C*
250120980310     C                   EXSR      CTABEL
250130980310     C  N30              MOVEL     TBLUNI        DS3C
250140971222     C* VEDO SE ESISTE NUMERO AWB SEMPRE PERCHE' POTREBBE ESSERE SBAGLI
250150971222     C*  ATA LA LNA SULLA BOLLA
250160980310     C     §3CFSP        IFEQ      'S'
250170060216     C     KBLC4         CHAIN(N)  Fiar4000                           30
250180971216     C     *IN30         IFEQ      *OFF
250190060216     C                   MOVEL     ar4NOT        DSBL4E
250200971216     C                   MOVEL     §B4ERP        W010A            10
250210971216     C**
250220971216     C     W010A         IFGT      *ZEROS
250230020208     C                   MOVEL     §B4ERP        v6cawb
250240971216     C                   MOVEL     §B4ERP        SAVAWB
250250971216     C                   ENDIF
250260971222     C                   ENDIF
250270980310     C                   ENDIF
250280110818     c* FLAG ACCORPAMENTO SPEDIZIONI in consegna
250290110818     c* Se cliente abilitato al passaggio del flag accorpamento sped.
250300110818     c* verifico in tabella XCO se flag valido:
250310110818     c* - memorizzo errore, se flag non valido
250320110818     c* - memorizzo il dato nel campo wxco, se flag valido
250330110901     c* - memorizzo se si devee inviare messaggio al ced
250340050114     c                   clear                   wxco
250350110818     c                   eval      werrxco=*off
250360050114    1c                   if        §lpxco <> *blanks
250370050114    2c                   if        §3caus = 'S'
250380050114     C                   CLEAR                   dsbs02
250390110818     c                   clear                   dxco
250400050114     C                   MOVEL     'C'           T02MOD
250410050114     C                   MOVEL     KNSIF         T02SIF
250420110818     C                   MOVEL     'XCO'         T02COD
250430110818     c                   movel(P)  'XCO'         t02ke1
250440050114     c                   call      'TIBS02R'
250450050114     C                   PARM                    KPJBA
250460050114     C                   PARM                    dsbs02
250470050114    3C                   IF        T02ERR = *BLANKS
250480110818     C                   MOVEL     T02uni        dxco
250490050114    3C                   ENDIF
250500110901     c* Se valore non presente in tabella:
250510110901     c* memorizzo che devo inviare email a CED
250520110818    3c                   if        %lookup(§lpxco:vaa)=0
250530160108     c****               eval      werrxco=*on
250540110901     c* e se il valore è numerico>0 lo mantengo comunque
250550110901     c                   if        §lpxco>'0'
250560160108     c****               eval      wxco = §lpxco
250570110901     c                   endif
250580110818     c                   else
250590110901     c* Se valore presente in tabella  ---> tutto ok
250600110818     c                   eval      wxco = §lpxco
250610110818    3c                   endif
250620050114    2c                   endif
250630050114    1c                   endif
250640050114     c*
250650000214     C* VEDO SE DISK 'C'
250660911031     C*
250670940926     C* MITTENTE
250680020507     C* SE 8888 O 9999
250690941010    1C     VIDCCM        IFEQ      8888
250700940926     C     VIDCCM        OREQ      9999
250710980115     C                   MOVEL     §LPRSM        VIDRSM
250720911031     C                   MOVEL     §LPINM        VIDINM
250730911031     C                   MOVEL     §LPLOM        VIDLOM
250740911031     C                   MOVEL     §LPCAM        VIDCAM
250750920130     C                   MOVEL     §LPPRM        VIDPRM
250760940926     C                   MOVEL     §LPNZM        VIDNZM
250770941010     C*
250780941010   X1C                   ELSE
250790941010     C*
250800941010     C* SE CODIFICATO E §LPCAM E §LPNZM SONO PIENI, CONTROLLO CON CNIND
250810941010    2C     §LPCAM        IFNE      *BLANKS
250820941010     C     §LPNZM        ORNE      *BLANKS
250830950529     C                   Z-ADD     KCI           CCC
250840941010     C     KACO          CHAIN     CNIND000                           30
250850941010     C*
250860941010    3C     *IN30         IFEQ      *OFF
250870941010    4C     INDCAE        IFNE      §LPCAM
250880941010     C     INDSTA        ORNE      §LPNZM
250890941010     C                   MOVEL     §LPCAM        VIDCMO
250900941010     C                   MOVEL     §LPNZM        VIDNMO
250910941010    4C                   ENDIF
250920941010    3C                   ENDIF
250930941010    2C                   ENDIF
250940941010     C*
250950941010    1C                   ENDIF
250960941010     C*
250970940926     C                   MOVEL     *BLANKS       VIDFAP
250980940927     C                   MOVEL     *BLANKS       VIDFIN
250990911031     C*
251000980115     C                   MOVEL     §LPRSD        VIDRSD
251010980115     C                   MOVE      §LPRD2        VIDRSD
251020980115     C     MI:MA         XLATE     VIDRSD        VIDRSD
251030980115     C     MI:MA         XLATE     §LPIND        VIDIND
251040980115     C     MI:MA         XLATE     §LPPRD        VIDPRD
251050980115     C     MI:MA         XLATE     §LPCAD        VIDCAD
251060980115     C     MI:MA         XLATE     §LPLOD        VIDLOD
251070980115     C     MI:MA         XLATE     §LPNZD        VIDNZD
251080160112     c* eseguo routine per eliminare caratteri non ammessi come da tabella "CSP"
251090160112     c* nella località
251100140211     c                   eval      wtxt=vidlod
251110160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
251120160112     c                   eval      ElencoChar=charnook
251130160112     c                   eval      TipoElenco='1'
251140160112     c                   clear                   UpperCase
251150160112     c                   exsr      sr_chk
251160160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
251170160112     c* alla  fine
251180140211     c                   exsr      chkstringa
251190140211     c                   movel     wtxt          vidlod
251200070404     c                   movel     vidrsd        savrsd
251210070404     c                   movel     vidind        savind
251220070404     c                   movel     vidprd        savprd
251230070404     c                   movel     vidcad        savcad
251240070404     c                   movel     vidlod        savlod
251250070404     c                   movel     vidnzd        nzdini
251260910204     C*
251270940927     C                   MOVEL     §LPCCN        SAVMIT
251280900824     C*
251290980115     C     MI:MA         XLATE     §LPGC1        VIDGC1
251300980115     C     MI:MA         XLATE     §LPGC2        VIDGC2
251310911031     C                   MOVEL     §LPFTM        VIDFTM
251320940927     C                   MOVEL     §LPQFT        VIDQFT
251330940927     C                   MOVEL     §LPIAS        VIDIAS
251340940926     C                   MOVEL     §LPVAS        VIDVAS
251350950517     C                   MOVEL     §LPVAS        VARVAS
251360940926     C                   MOVEL     §LPVMD        VIDVMD
251370940926     C                   MOVEL     §LPVAD        VIDVAD
251380950517     C                   MOVEL     §LPVAD        VARVAD
251390911031     C                   MOVEL     §LPNAS        VIDNAS
251400040610     C                   MOVEL     §LPbva        VIDbva
251410940819     C                   MOVEL     §LPNCL        V1CNCL
251420930401     C                   MOVEL     §LPNCL        SAVNCL
251430930401     C                   MOVEL     §LPNCL        VIDNCL
251440940926     C                   Z-ADD     §LPPKB        VIDPKG
251450940926     C                   Z-ADD     §LPPKB        V2CPKG
251460980402     C                   Z-ADD     0             SAVPKG
251470940926     C                   Z-ADD     §LPVLB        VIDVOL
251480980402     C                   Z-ADD     0             SAVVOL
251490940926     C                   MOVEL     §LPCAS        VIDCAS
251500110519     C     mi:ma         xlate     §LPVCA        VIDVCA
251510110519     C     mi:ma         xlate     §LPVCA        VARVCA
251520911031     C                   MOVEL     §LPTIC        VIDTIC
251530900824     C*
251540911031     C                   MOVEL     §LPRMN        VIDRMN
251550940926     C                   MOVEL     §LPRMA        VIDRMA
251560911031     C                   MOVEL     §LPRMO        VIDRMO
251570091008     C                   MOVEL     '1'           WOVUO1
251580060627     c* se lnp dpd metto rmn in nrd
251590060628     c                   if        §ogntw='DPD' and §3arbl <> 'R'
251600060628     c                   movel     §lpnpr        vidnrd
251610060628     c                   endif
251620900824     C* CONTROLLO SE POSIZIONARMI SU SEGNACOLLO O SU VOLUME
251630911031     C     §LPNCD        IFEQ      0
251640931123     C                   SETOFF                                       36
251650900824     C                   ELSE
251660900827     C                   SETON                                        36
251670900824     C                   END
251680940926     C                   MOVEL     §LPNOT        VIDNT1
251690940926     C                   MOVEL     §LPNT2        VIDNT2
251700910129     C* CODICE TRATTAMENTO MERCE
251710011206     C* QUESTE SPECIFICHE LE HO SPOSTATE PRIMA DELL'IMPOSTAZIONE DI VID
251720011206     C* LNA PERCHE' MI SERVIVA IL CONTENUTO DI §1BF12
251730950504     C*
251740910805     C                   MOVEL     *ZEROS        VIDNCD
251750910805     C                   MOVEL     *ZEROS        VIDNCA
251760921005     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
251770920203     C     §LPFPR        IFEQ      'G'
251780941230     C                   MOVEL     §LPFPR        WFPR              1
251790920203     C                   MOVEL     §LPNCD        VIDNCD
251800920203     C                   MOVEL     §LPNCA        VIDNCA
251810920203     C                   MOVEL     'V'           §LPFPR
251820950420     C                   SETON                                        8744
251830011029     C                   MOVEL     PROT          ATRFTM
251840970328     C     §LPBAM        IFEQ      ' '
251850970328     C                   MOVEL     'S'           §LPBAM
251860920203     C                   END
251870970328     C                   END
251880941230     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
251890941230     C* IN QUESTO CASO NON MI FERMO SULLA BOLLA E NON LA STAMPO
251900941230     C     §LPFPR        IFEQ      'P'
251910941230     C                   MOVEL     §LPFPR        WFPR              1
251920941230     C                   MOVEL     §LPNCD        VIDNCD
251930941230     C                   MOVEL     §LPNCA        VIDNCA
251940941230     C                   MOVEL     'X'           §LPFPR
251950950420     C                   SETON                                        8744
251960011029     C                   MOVEL     PROT          ATRFTM
251970970328     C     §LPBAM        IFEQ      ' '
251980970328     C                   MOVEL     'S'           §LPBAM
251990970328     C                   END
252000941230     C                   END
252010921029     C* CREO BOLLA PER INVIO DISPOSIZIONI MITTENTE AI CLIENTI
252020921029     C     §LPFPR        IFEQ      'I'
252030921029     C                   MOVEL     'X'           §LPFPR
252040940222     C                   MOVEL     'I'           WFPR
252050011029     C                   SETON                                        87
252060011029     C                   MOVEL     PROT          ATRFTM
252070921029     C                   END
252080020522     C     §LPFPR        IFEQ      'T'
252090030609      * se sto creando una bolla "FT" x ORM commissionati
252100030609      * devo impostare §lpfpr = 'X' e proteggere la lna
252110030609    2c                   If        §lpCbo = 'FT'
252120030609     c                   Eval      §lpFpr = 'X'
252130030609     c                   Movel     Prot1         AtrLna
252140030609    xc                   Else
252150020522     C                   MOVEL     'V'           §LPFPR
252160030609    2c                   EndIf
252170020522     c                   endif
252180150302     C* SE PROGRAMMA VIENE DA Gest.Bancali
252190150302     C     §LPFPR        IFEQ      'B'
252200150302     C                   SETON                                        44
252210150302     C                   MOVEL     PROT          ATRFTM
252220150302     C                   MOVEL     PROT          ATRnt1
252230150302     C                   MOVEL     PROT          ATRnt2
252240150302     C                   MOVEL     PROT          ATRncl
252250150302     C                   MOVEL     PROT          ATRpkg
252260150302     C                   MOVEL     PROT          ATRncl2
252270150302     C                   MOVEL     PROT          ATRpkg2
252280150302     C                   MOVEL     'V'           §LPFPR
252290150302     C                   END
252300160613     C* SE PROGRAMMA VIENE DA creazione in Batch "VEDI PACCO DPD"
252310160613     C     §LPFPR        IFEQ      'D'
252320160613     C                   MOVEL     'W'           §LPFPR
252330160613     C                   END
252340910208     C* SOLO CON FLAG6=C PRENDO I SEGNACOLLI SE NO COMUNQUE LI AZZERO
252350910208     C     §1BFG6        IFEQ      'C'
252360911031     C                   MOVEL     §LPNCD        VIDNCD
252370911031     C                   MOVEL     §LPNCA        VIDNCA
252380920204     C                   END
252390910805     C* SE FLAG7=S ABILITO TASTO PER GESTIONE DETT. STAMPA SEGNACOLLI
252400910805     C     §1BFG7        IFEQ      'S'
252410020917     C* Se DISKC non devo abilitare l'F21 di manutenzione fivad
252420001016     C     §1BF12        IFEQ      'N'
252430001106     C     §1BF12        OREQ      'E'
252440001106     C     WASDKC        ANDNE     'S'
252450910805     C                   SETON                                        94
252460001016     C                   ENDIF
252470910805     C* SE VI3FNS=S -> C'E' SEGNACOLLO E NON CODICE PRODOTTO
252480020917     C     KBLC          SETLL     FIVAD000
252490020917     C     KBLC          READE(N)  FIVAD000                               31
252500910805     C  N31BLDNCD        IFGT      0
252510920204     C     BLDCDP        ANDEQ     *BLANKS
252520910805     C                   MOVEL     'S'           VI3FNS
252530910805     C                   END
252540910805     C                   END
252550910220     C*
252560120903     C***  §1BFG2        IFNE      'N'
252570120903     C***  §LPFPR        OREQ      'R'
252580120903     C     §1BFG2        IFeq      'S'
252590921005     C                   MOVEL     §LPNSP        VIDNSP
252600921005     C                   MOVEL     §LPNRS        VIDNRS
252610921005     C                   ELSE
252620910129     C                   Z-ADD     0             VIDNSP
252630910129     C                   Z-ADD     0             VIDNRS
252640000829     C                   END
252650050222     C* SE NAZIONE DESTINATARIO ESTERA,
252660050222     C* CONTROLLO IL COD.TARIFFA PER SAPERE SE E' TRAFFICO DPD
252670050222     C                   MOVEL     '15'          COD
252680050222     C                   MOVEL(P)  VIDNZD        KEY
252690050222     C                   EXSR      CTABEL
252700050222     C   30              CLEAR                   DS15
252710050222     C  N30              MOVEL     TBLUNI        DS15
252720050222     C*
252730050222    1C     §15ITA        IFNE      'I'
252740050222     C                   MOVE      WKSC          W0040
252750050222     C*
252760050222     C* SE CLIENTE CODIFICATO, FACCIO COME ADESSO
252770050222     C* SE CLIENTE NON CODIFICATO MA COD.TRATTAMENTO MERCE PER DPD,
252780050222     C*   E LNA DPD, CONSIDERO LO STESSO IL RIF.MITTENTE
252790050222   1AC     W0040         IFEQ      8888
252800050222     C     W0040         OREQ      9999
252810050222     C     VIDLNA        IFGT      *ZEROS
252820050222     C     A_§OGNTW      ANDEQ     'DPD'
252830050222     C                   MOVEL     'D'           VIDDPD
252840050222     C*
252850050222     c                   select
252860050222    5C     §1BF13        wheneq    'R'
252870060628     c                   movel     §lpnpr        vidnrd
252880050222    5C     §1BF13        wheneq    *blanks
252890050222     c                   exsr      sr_vatdpd
252900060612     c                   movel     w014a         vidnrd
252910050222     C                   ENDsl
252920050222     c                   else
252930050222     c     vidlna        ifgt      *zeros
252940050222     c     A_§ogntw      andeq     'FED'
252950050222     c                   movel     'F'           viddpd
252960050222     c                   endif
252970050222     C                   ENDIF
252980050222     C*
252990050222  X1AC                   ELSE
253000050222     C*
253010050921     c                   clear                   fnlv59ds
253020050921     C                   MOVEL     'P'           ilv59tbo
253030050222      * se bolla monovaria pulisco il tipo bolla
253040050222     C                   IF        §3ASVA <> *BLANK
253050050921     C                   CLEAR                   ilv59tbo
253060050921     C                   movel     'P'           ilv59prp
253070050222     C                   ENDIF
253080050222
253090050921     C                   MOVEL     WKSC          ilv59KSC
253100050921     C                   MOVEL     KCI           ilv59KCI
253110050921     C                   MOVEL     BLPDSP        ilv59DSP
253120050921     C                   MOVEL     VIDTSP        ilv59TSP
253130050921     C                   MOVEL     §LPCTR        ilv59CTR
253140050921     C                   MOVEL     'S'           ilv59RIC
253150050921     C                   MOVEL     'S'           ilv59CON
253160050222     C* CONTROLLO TRA LE TARIFFE ESTERE E ITALIADPD
253170050921     C                   MOVEL     'S'           ilv59FIE
253180150415
253190150415     c                   if        savfpr<>' '
253200150415     C                   EVAL      ILV59blo='S'
253210150415     c                   endif
253220150415
253230050921     C                   CALL      'FNLV59R'
253240050921     C                   PARM                    fnlv59ds
253250050222     C*
253260050222     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDOPRG
253270050921    2C     olv59err      IFEQ      ' '
253280050921     C     olv59tks      ANDEQ     'S'
253290050921     C                   MOVEL     olv59prg      COMPRG
253300050222     C                   MOVEL     §LPCTR        COMCTR
253310050222     C     KTAM2         CHAIN     TNTAM000                           30
253320050222     C* TARIFFA VALIDA
253330050222    3C     *IN30         IFEQ      *OFF
253340050222     C     TAMATB        ANDEQ     ' '
253350050222     C                   MOVEL     TAMFLO        DSTA01
253360050222     C* TARIFFA DPD
253370050222    4C     §TADPD        IFEQ      'S'
253371170228     c                   if        comlna=0 or a_§ogntw='DPD'
253380050222     C                   MOVEL     'D'           VIDDPD
253390050222     c                   select
253400050222    5C     §1BF13        wheneq    'R'
253410060628     c                   movel     §lpnpr        vidnrd
253420050222    5C     §1BF13        wheneq    *blanks
253430050222     c                   exsr      sr_vatdpd
253440060612     c                   movel     w014a         vidnrd
253450050222    5C                   endsl
253451170228     c                   endif
253460050222     c                   else
253470050222     c* tariffa fedex
253480050222     c     §tafed        ifeq      'S'
253490050222     c                   movel     'F'           viddpd
253500050222     c                   endif
253510050222    4C                   ENDIF
253520050222    3C                   ENDIF
253530050222    2C                   ENDIF
253540050222   1AC                   ENDIF
253550050222    1C                   ENDIF
253560000831     C* PER NO DISK "B" CONTROLLO SE DISK "C"
253570000904     C* Spengo indicatore per attivazione tasto funzionale di gestione
253580000904     c* cod. CHI SONO
253590000901     C                   SETOFF                                       96
253600000901    1C     §1BFG1        IFNE      'S'
253610000831     C     WASDKC        ANDEQ     'S'
253620000831     C* SE IMPORT DPD O COD.TRATTAMENTO MERCE CHE PREVEDE IL DISK C
253630000901    2C     §1BF12        IFNE      'N'
253640001013     C     §1BF12        ANDNE     ' '
253650020319     C     §OGNTW        OREQ      'DPD'
253660000919     C     §3CDKC        ANDEQ     'S'
253670000214     C                   MOVEL     ':'           VIDSOP
253680000901     C* Carico subfile prendendo il chi sono dal VAT oppure dal VAB/VAD
253690000901     C* in base al tipo di DISKC
253700050222     c* Non devo caricare il subfile se:
253710050222     c* 1) spedizione export dpd e numero parcel dpd = codice chi sono
253720050222     c* 2) spedizione import dpd
253730050222     c* in questi due casi infatti il cod.chi sono coincide col numero
253740050222     c* parcel dpd che viene già inserito in altro modo
253750051102     c* Sarà il pgm a tenerne conto per la scrittura di fisgn e FIARS
253760000901    3C     §1BF12        IFEQ      'E'
253770050222     c     viddpd        andne     'D'
253780050222     c     §ogntw        andne     'DPD'
253790050222     c     §1bf12        oreq      'E'
253800050222     c     viddpd        andeq     'D'
253810050222     c     §1bf13        andne     *blanks
253820030321      * se non ho superato i 500 colli
253830050222     c     V1cNcl        ifle      500
253840000829     C                   EXSR      CARVAT
253850000901     C                   SETON                                        96
253860000911     C     NR8           IFGT      0
253870000911     C                   SETON                                        78
253880000911     C                   ENDIF
253890050222     c                   endif
253900000901   X3C                   ELSE
253910000901    4C     §1BF12        IFEQ      'B'
253920030321      * se non ho superato i 500 colli
253930030321     c     V1cNcl        andle     500
253940140506     c* se vengo da dirottamenti carico da FIART altrimenti dal VAB
253950140506     c                   if        §lpnspm>0
253960140506     c                   exsr      CARART
253970140506     c                   else
253980000901     C                   EXSR      CARVAB
253990140506     c                   endif
254000000911     C     NR8           IFGT      0
254010000911     C                   SETON                                        78
254020000911     C                   ENDIF
254030000901     C                   SETON                                        96
254040050222     c                   else
254050050222     c* se import dpd e numero parcel nel fivat lo metto nel rmn
254060050222     c     §1bf12        ifeq      'E'
254070050222     c     §ogntw        andeq     'DPD'
254080050222     c                   exsr      sr_vatdpd
254090060612     c                   movel     w014a         vidnrd
254100060616     c                   seton                                        79
254110050222     c                   endif
254120000901    4C                   ENDIF
254130000901    3C                   ENDIF
254140000901    2C                   ENDIF
254150000901    1C                   ENDIF
254160001106     C*
254170001106     C* SE FLAG 12 = 'E' MA AS400 NON ABILITATO A DISK C CARICO LO
254180020917     C* STESSO SUBFILE PRENDENDO I DATI DA FIVAT
254190001106    1C     §1BFG1        IFNE      'S'
254200001106     C     WASDKC        ANDNE     'S'
254210001106     C     §1BF12        ANDEQ     'E'
254220030321      * se non ho superato i 500 colli
254230030321     c     V1cNcl        andle     500
254240050222     c     viddpd        ifne      'D'
254250050222     c     §ogntw        andne     'DPD'
254260050222     c     viddpd        oreq      'D'
254270050222     c     §1bf13        andne     *blanks
254280001106     C                   EXSR      CARVAT
254290001106     C                   SETON                                        96
254300001106     C     NR8           IFGT      0
254310001106     C                   SETON                                        78
254320001106     C                   ENDIF
254330050222     c                   endif
254340001106     C                   ENDIF
254350000831     C*
254360911031     C                   MOVEL     §LPFFD        VIDFFD
254370010214     C     §LPFFD        IFEQ      *BLANKS
254380010214     C                   MOVEL     'N'           VIDFFD
254390010214     C                   ENDIF
254400911031     C                   MOVEL     §LPTCR        VIDTCR
254410940927     C                   MOVEL     §LPHCR        VIDHCR
254420940927     C                   MOVE      §LPHCR        VIDMCR
254430150202     c* non tengo l'ora consegna richiesta del cliente
254440150202     c* se < 8:00 o > 20:00
254450150203     c* se h 10:30 se < 0800 o > 1030
254460150202     c                   if        §lphcr<0800 or
254470150203     c                             (vidtsp='H' and §lphcr>1030) or
254480150202     c                             §lphcr>2000
254490150202     c                   clear                   vidhcr
254500150202     c                   clear                   vidmcr
254510150202     c                   endif
254520150203     c
254530940927     C* MI SERVONO PER IL CONFRONTO PER SAPERE SE CAMBIARE O NO I CAMPI
254540940927     C   04              Z-ADD     §LPCCN        SAVCCM
254550941103     C  N04              Z-ADD     1             SAVCCM
254560920123     C*
254570920123     C                   MOVEL     §LPFBR        VIDFBR
254580031029     c                   Clear                   VidGca
254590940927     C                   MOVEL     §LPGGA        VIDGGA
254600940927     C                   MOVEL     §LPGMA        VIDGMA
254610091221     c                   eval      wvidgma = §lpgma
254620100604     c* Verifico se c'e' ritiro contestuale alla consegna
254630100604     c                   clear                   ds7r
254640100604     C                   MOVEL     '7R'          COD
254650100604     C                   MOVEL(P)  §lpGMA        KEY
254660100604     C                   EXSR      CTABEL
254670100604     C  n30              MOVEL     TBLUNI        DS7R
254680100604     c                   eval      w7rRC = §7rRC
254690141202     c                   eval      w7rPC = §7rpincode
254700100604     c
254710940927     C                   MOVEL     §LPGVA        VIDGVA
254720031029     c                   move      ' '           VidGva
254730920123     C                   MOVEL     §LPPOR        VIDPOR
254740940927     C                   MOVEL     §LPIMV        VIDIMV
254750991026     C                   MOVEL     §LPDIV        VIDDIV
254760970326     C* FLAG DDT S/N
254770970326     C     §LPBAM        IFNE      ' '
254780970328     C     §LPBAM        IFEQ      'S'
254790970328     C     §LPBAM        OREQ      'C'
254800060609     C     §LPBAM        OREQ      'P'
254810060609     C     §LPBAM        OREQ      'Q'
254820991007     C                   MOVEL     'S'           VIDBAM
254830970328     C                   ELSE
254840970328     C                   MOVEL     'N'           VIDBAM
254850970326     C                   ENDIF
254860970328     C                   ENDIF
254870020102     C* SE SONO RICHIAMATA DA PGM DELLE GIACENZE E HO DEGLI IMPORTI DI
254880020102     C* TASSAZIONE SENZA NUMERO FATTURA E LA DIVISA E' DIVERSA DA GE
254890020102     C* DCN MEMORIZZO CHE DEVO CARICARE LA VIDEATA CON GLI IMPORTI CON-
254900020102     C* VERTITI NELLA DIVISA DI CONTO DAL MOMENTO CHE PER §LPFPR = "G",
254910020102     C* "I" O "P" I DATI DI TASSAZIONE SONO PROTETTI ED IN CASO DI
254920020102     C* ERRORE DI DIVISA SCADUTA L'YENTE NON PUO' IN ALCUN MODO INTERVE
254930020102     C* NIRE PER CAMBIARE LA DIVISA
254940020102     C                   CLEAR                   WCONV
254950020102     C     WFPR          IFEQ      'G'
254960020102     C     WFPR          OREQ      'I'
254970020102     C     WFPR          OREQ      'P'
254980020102     C     VIDNFT        IFEQ      0
254990020102     C     VIDDIV        ANDNE     *BLANKS
255000020102     C     VIDDIV        ANDNE     §GEDCN
255010020102     C                   MOVEL     '1'           WCONV             1
255020020102     C                   ENDIF
255030020102     C                   ENDIF
255040940927     C* CARICO LE VARIE
255050940927     C                   Z-ADD     0             NRR
255060941108     C                   DO        20            C
255070991027     C                   MOVEL     VSV(C)        WSVN
255080991027     C                   Z-ADD     VVA(C)        WVAN
255090940927     C                   EXSR      CARVAR
255100020102      * CARICO SCHIERA VARIE X RICALCOLO TOT.IMPONIBILE
255110020102     C     WCONV         IFEQ      '1'
255120020102     C     VIDIMV        ANDGT     *ZEROS
255130020102     C                   MOVEL     V3CSV1        VSV(C)
255140020102     C                   Z-ADD     V3CVA1        VVA(C)
255150020102     C                   MOVEL     V3CEV1        VES(C)
255160020102     C                   ENDIF
255170941108     C                   ENDDO
255180020102     C* CONVERTO ANCHE PORTO E RICALCOLO EVENTUALMENTE IL TOTALE IMPO-
255190020102     C* NIBILE
255200020102    1C     WCONV         IFEQ      '1'
255210020102     C* PORTO
255220020102    2C     VIDPOR        IFGT      *ZEROS
255230020102     C                   CLEAR                   DSYEUR
255240020102     C                   MOVEL     VIDDIV        YECDVI
255250020102     C                   Z-ADD     VIDPOR        YECIMI
255260020102     C                   MOVEL     §GEDCN        YECDVO
255270020102     C     COMFDC        IFEQ      'S'
255280020102     C                   MOVEL     '3'           YECDCO
255290020102     C                   ELSE
255300020102     C                   MOVEL     '0'           YECDCO
255310020102     C                   ENDIF
255320020102     C                   CALL      'YEURCO'
255330020102     C                   PARM                    DSYEUR
255340020102    3C     YECESI        IFEQ      ' '
255350020102     C                   Z-ADD     YECIMO        VIDPOR
255360020102    3C                   ENDIF
255370020102    2C                   ENDIF
255380020102     C* TOTALE IMPONIBILE
255390020102    2C     VIDIMV        IFGT      *ZEROS
255400020102     C                   CLEAR                   DSLV16
255410020102     C                   MOVEL     'T'           D17FIM
255420020102     C                   Z-ADD     VIDPOR        D17POR
255430020102     C                   CALL      'FNLV16R'
255440020102     C                   PARM                    DSLV16
255450020102     C                   PARM                    DTASV
255460020102     C                   Z-ADD     O17IMV        VIDIMV
255470151014     C                   Z-ADD     O17IMV        savIMV_fat
255480020102    2C                   ENDIF
255490020102     C* DIVISA
255500020102     C                   MOVE      §GEDCN        VIDDIV
255510020102    1C                   ENDIF
255520020102     C                   CLEAR                   WCONV
255530940927     C*
255540940927     C* NUM TENTATIVI PER SUPERARE CONTROLLI FORZATI
255550940927     C     §LPFPR        IFNE      'V'
255560941021     C                   Z-ADD     1             NUMFOR
255570940927     C                   ELSE
255580940927     C                   Z-ADD     1             NUMFOR
255590940927     C                   ENDIF
255600941020     C*
255610941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
255620941020     C     VIDPOR        IFNE      0
255630941020     C     NRR           ORNE      0
255640941020     C     VIDCEI        ORNE      ' '
255650941020     C     VI2SV1        ORNE      ' '
255660040114     c     Vi2Sv2        orne      *Blanks
255670040114     c     Vi2Sv3        orne      *Blanks
255680040114     c     Vi2Sv4        orne      *Blanks
255690941020     C     VI2CEI        ORNE      ' '
255700941020     C                   MOVEL     'S'           WEMD03            1
255710941020    1C                   ENDIF
255720941011     C*
255730941011     C* VISUALIZZO IL NUMERO DI SPEDIZIONE CHE STO CONFERMANDO
255740941011     C                   Z-ADD     §LPNRS        PRENRS
255750941011     C                   Z-ADD     §LPNSP        PRENSP
255760941011     C                   MOVEL     §LPLNA        PRELNA
255770941011     C                   Z-ADD     §LPRMN        PRERMN
255780941011     C                   Z-ADD     §LPZNC        PREZNC
255790040506
255800040506      * Imposto la ds di comodo del n. spedizione
255810060222     c****               Z-add     VidLnp        WidLnp
255820060222     c                   Z-add     §lplnp        WidLnp
255830040506     c                   Z-add     §lpNrs        WidNrs
255840040506     c                   Z-add     §lpNsp        WidNsp
255850000124     C*
255860000508     C*
255870050114     C* SE LNP POSTE, MEMORIZZO A PARTE IAS, PER
255880060216     C*  MEMORIZZARLO NEL ar4 RECORD "J"
255890140122     C**   §ogntw        IFEQ      'PPT'
255900140122     C**                 Z-ADD     VIDIAS        §B4IAS
255910140122     C**                 MOVEL     VIDVAS        §B4VAS
255920140122     C**                 MOVEL     §LPDSK        §B4DSC
255930140122     c**                 clear                   §b4xco
255940140122     C**                 CLEAR                   VIDIAS
255950140122     C**                 CLEAR                   VIDVAS
255960140122     C**                 ENDIF
255970031125
255980021218      * Carico i dati relativi ai bancali
255990021220     c                   If        §LpTba > *Zeros
256000021218     c                   Movel     §LpTba        VidTba
256010021220     c                   EndIf
256020021218     c                   Eval      VidNba = §LpNba
256030030704     c                   Eval      SavNba = §LpNba
256040030224     c                   If        §LpTb2 > *Zeros
256050021218     c                   Movel     §LpTb2        VidTb2
256060021220     c                   EndIf
256070021218     c                   Eval      VidNb2 = §LpNb2
256080030704     c                   Eval      SavNba = §LpNb2
256090031125      * più quelli relativi ai colli sfusi e originali
256100031125     c                   Eval      w03Cor = §LpCor
256110031125     c                   Eval      w03Csf = §LpCsf
256120030409
256130030409      * Ore da sommare alla delivery
256140030409     c                   Move      §ore          VidOre
256150031125
256160031125      * carico i dati del telefono e del referente
256170031125     c                   Eval      VidRef = §LpRef
256180031125     c                   Eval      VidTel = §LpTel
256190031125
256200031125      * Imposto i campi dal FIVAT no record 'E'
256210031125     c                   ExSr      Sr_CarVat
256220031125      * Controllo quali dati dei bancali devo tenere
256230031126      * se non sono richiamta da giacenze
256240031126     c                   If        (savfpr <> 'P' and savfpr <> 'G')
256250031125     c                   ExSr      Sr_CtrBancali
256260031126     c                   EndIf
256270160323     c* Se spedizione import DPD memorizzo se si tratta di "VEDI PACCO"
256280160323     c                   clear                   w_vediP           1
256290160323     c                   if        §ogntw='DPD'
256300160323     c                   eval      dblp01=§lpflo
256310160323     c                   if        §lptrd='1'
256320160323     c                   eval      w_vediP='1'
256330160323     c                   endif
256340160323     c                   endif
256350021218
256360900824     C                   ENDSR
256370010301     C*
256380010301     C*--- CARICO RECORD BOLLE DA CONFERMA ORM PREPAGATI -------------*
256390010301     C     CARBLO        BEGSR
256400010301     C                   Z-ADD     §LPPOE        VIDPOE
256410010301     C                   MOVEL     §LPNSR        VIDNOR
256420010301     C                   MOVE      §LPNOR        VIDNOR
256430010301     C                   Z-ADD     §LPNRV        VIDNRV
256440010301     C                   Z-ADD     VIDORM        WIDORM
256450010924     C                   CLEAR                   DORM01
256460010301     C     KORM          CHAIN     FNORM01L                           30
256470010301     C                   Z-ADD     ORMPOR        VIDLNP
256480010301     C                   MOVEL     '1'           VIDCBO
256490010924     C                   MOVEL     ORMFLO        DORM01
256500011121     C* Proteggo i campi a video relativi il destinatario se devo forza
256510011121     C* re il destinatario da orm
256520011121     C     §ORMFD        IFEQ      'S'
256530011121     C                   MOVEL     PROT          ATRDES
256540011121     C                   ELSE
256550011121     C                   CLEAR                   ATRDES
256560011121     C                   ENDIF
256570010301     C                   EXSR      PRPOR1
256580010307     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
256590010307     C* ANDRO' A PROPORRE NELLE NOTE
256600010307     C     'TEL.:'       CAT       ORMTER        W021A            21
256610010307     C     W021A         CAT(P)    ORMRER:1      WTELRF           70
256620010307     C                   MOVE      WTELRF        WTELR2           35
256630010301     C                   ENDSR
256640000627     C*
256650000627     C*--- RISCRIVO AGGIORNATA LA DBLP -------------------------------*
256660000627     C     AGDBLP        BEGSR
256670000627     C* DATA SPEDIZIONE
256680000627     C                   Z-ADD     BLPDSP        §LPMGS
256690000627     C                   MOVEL     BLPDSP        §LPAAS
256700000627     C* DATA CONSEGNA RICHIESTA
256710000627     C                   Z-ADD     COMDCR        §LPDCR
256720000627     C                   MOVEL     VIDSOP        §LPSOP
256730000627     C                   MOVEL     VIDRMN        §LPRMN
256740000627     C                   MOVEL     VIDRMA        §LPRMA
256750000627     C                   MOVEL     VIDRMO        §LPRMO
256760000627     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
256770000627     C                   Z-ADD     COMDRT        §LPDRT
256780000627     C                   MOVEL     VIDNRT        §LPNRT
256790000627     C                   MOVEL     VIDFPP        §LPFPP
256800000627     C                   MOVEL     VIDLNP        §LPPDR
256810000627     C                   MOVE      VIDPDR        §LPPDR
256820000627     C*
256830000627     C* CODICE BOLLA
256840000627     C                   MOVEL     VIDCBO        §LPCBO
256850000627     C                   Z-ADD     VIDCAS        §LPCAS
256860011113     C     VIDCAS        IFGT      *ZEROS
256870011113     C                   MOVEL     VIDVCA        §LPVCA
256880011113     C                   ELSE
256890011113     C                   CLEAR                   §LPVCA
256900011113     C                   ENDIF
256910000627     C                   MOVEL     VIDTIC        §LPTIC
256920000627     C                   MOVEL     VIDGCA        §LPGCA
256930011113     C                   CLEAR                   §LPCMB
256940000627     C* SEGNACOLLI
256950000627    1C     §3ABCM        IFEQ      ' '
256960000627     C                   EXSR      ASSSGN
256970000627     C     WEMFOR        IFEQ      ' '
256980000627     C                   MOVEL     BLPNCD        §LPNCD
256990000627     C                   MOVEL     BLPNCA        §LPNCA
257000000627     C                   ENDIF
257010000627     C                   ELSE
257020000627     C                   CLEAR                   §LPNCD
257030000627     C                   CLEAR                   §LPNCA
257040000627     C                   ENDIF
257050000627     C* TASSAZIONE
257060000627     C                   Z-ADD     VIDPOR        §LPPOR
257070000627     C                   Z-ADD     VIDIMV        §LPIMV
257080000627     C                   MOVEL     VIDCEI        §LPCEI
257090000627     C                   MOVEL     VIDDIV        §LPDIV
257100000627     C* MANCANO LE VARIE E DATI FATTURA !!
257110000627     C**
257120000627     C                   MOVEL     COMLNA        §LPLNA
257130000627     C                   MOVEL     VIDRSM        §LPRSM
257140000627     C                   MOVEL     VIDINM        §LPINM
257150000627     C                   MOVEL     VIDCAM        §LPCAM
257160000627     C                   MOVEL     VIDLOM        §LPLOM
257170000627     C                   MOVEL     VIDPRM        §LPPRM
257180000627     C                   MOVEL     VIDNZM        §LPNZM
257190000627     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
257200000627     C     VIDCMO        IFNE      *BLANKS
257210000627     C                   MOVEL     VIDCMO        §LPCAM
257220000627     C                   MOVEL     VIDNMO        §LPNZM
257230000627     C                   ENDIF
257240000627     C*
257250000627     C                   MOVEL     VARZNC        §LPZNC
257260000627     C     §3ACTM        IFNE      *BLANKS
257270000627     C                   MOVEL     §3ACTM        §LPCTM
257280000627     C                   ELSE
257290000627     C                   MOVEL     VIDCTM        §LPCTM
257300000627     C                   ENDIF
257310000627     C     BLPCTM        IFEQ      *BLANKS
257320000627     C                   MOVEL     WCTM          §LPCTM
257330000627     C                   ENDIF
257340000627     C                   MOVEL     VIDTC1        §LPTC1
257350000627     C                   MOVEL     VIDTC2        §LPTC2
257360000627     C                   MOVEL     VIDGGA        §LPGGA
257370000627     C                   MOVEL     VIDGMA        §LPGMA
257380000627     C                   MOVEL     VIDGVA        §LPGVA
257390000627     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
257400000627     C* DELLE PARTICOLARITA' VARIE
257410000627     C     W2LN          IFEQ      'S'
257420000627     C                   MOVE      'D'           §LPGVA
257430000627     C                   ELSE
257440000627     C                   MOVE      ' '           §LPGVA
257450000627     C                   ENDIF
257460000627     C* P A R T I T A   I V A
257470000627     C*
257480000627     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
257490000627     C*     NELLA P.IVA
257500000627     C     VIDISM        IFEQ      '$$'
257510000627     C     VIDCPM        ANDEQ     *BLANKS
257520000627     C                   MOVEL     'PRIVATO'     VIDCPM
257530000627     C                   ENDIF
257540000627     C     VIDISD        IFEQ      '$$'
257550000627     C     VIDCPD        ANDEQ     *BLANKS
257560000627     C                   MOVEL     'PRIVATO'     VIDCPD
257570000627     C                   ENDIF
257580000627     C*
257590000627     C  N04VIDISM        IFEQ      *BLANKS
257600000627     C                   MOVEL     VIDCPM        §LPCPI
257610000627     C                   ELSE
257620000627     C                   MOVEL     VIDPIM        §LPCPI
257630000627     C                   ENDIF
257640000627     C   04VIDISD        IFEQ      *BLANKS
257650000627     C                   MOVEL     VIDCPD        §LPCPI
257660000627     C                   ELSE
257670000627     C                   MOVEL     VIDPID        §LPCPI
257680000627     C                   ENDIF
257690000627     C**
257700000627     C                   MOVEL     VIDRSD        §LPRSD
257710000627     C                   MOVE      VIDRSD        §LPRD2
257720000627     C                   MOVEL     VIDIND        §LPIND
257730000627     C                   MOVEL     VIDCAD        §LPCAD
257740000627     C                   MOVEL     VIDLOD        §LPLOD
257750000627     C                   MOVEL     VIDPRD        §LPPRD
257760000627     C                   MOVEL     VIDNZD        §LPNZD
257770000627     C                   MOVEL     VIDGC1        §LPGC1
257780000627     C                   MOVEL     VIDGC2        §LPGC2
257790000627     C                   MOVEL     VIDCTR        §LPCTR
257800000627     C                   MOVEL     SAVCTS        §LPCTS
257810000627     C                   MOVEL     VIDFBR        §LPFBR
257820000627     C* ALLEGA BAM
257830000627     C                   EXSR      AGGFST
257840000627     C                   MOVEL     BLPFST        §LPBAM
257850000627     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
257860000627     C                   CLEAR                   §LPFTM
257870000627     C   04SAVFTM        IFEQ      'S'
257880000627     C     VIDFTM        OREQ      'S'
257890000627     C                   MOVEL     'S'           §LPFTM
257900000627     C                   ENDIF
257910000627     C* SE NON IMMESSO TIPO SERVIZIO
257920000627     C     VIDTSP        IFNE      *BLANKS
257930000627    1C                   MOVEL     VIDTSP        §LPTSP
257940000627     C                   ELSE
257950000627     C* LO PRENDO DA TARIFFA
257960000627     C                   MOVEL     COMTSP        §LPTSP
257970000627     C                   ENDIF
257980000627     C                   MOVEL     VIDIAS        §LPIAS
257990011113     C     VIDIAS        IFGT      *ZEROS
258000011113     C                   MOVEL     VIDVAS        §LPVAS
258010011113     C                   ELSE
258020011113     C                   CLEAR                   §LPVAS
258030011113     C                   ENDIF
258040000627     C                   MOVEL     VIDVMD        §LPVMD
258050011113     C     VIDVMD        IFGT      *ZEROS
258060011113     C                   MOVEL     VIDVAD        §LPVAD
258070011113     C                   ELSE
258080011113     C                   CLEAR                   §LPVAD
258090011113     C                   ENDIF
258100000627     C                   MOVEL     VIDQFT        §LPQFT
258110000627     C                   MOVEL     VIDNAS        §LPNAS
258120000627     C                   MOVEL     V1CNCL        §LPNCL
258130000627     C                   MOVEL     V2CPKG        §LPPKB
258140000627     C                   MOVEL     VIDFVR        §LPFVB
258150000627     C                   MOVEL     VARVOL        §LPVLB
258160000627     C                   MOVEL     VIDFFD        §LPFFD
258170010214     C     VIDFFD        IFEQ      'N'
258180010214     C                   MOVE      *BLANKS       §LPFFD
258190010214     C                   ENDIF
258200000627     C                   MOVEL     VIDTCR        §LPTCR
258210000627     C                   MOVEL     COMDCR        §LPDCR
258220000627     C                   MOVEL     VIDHCR        §LPHCR
258230000627     C                   MOVE      VIDMCR        §LPHCR
258240000627     C*
258250000627     C                   MOVEL     VIDNT1        §LPNOT
258260000627     C                   MOVEL     VIDNT2        §LPNT2
258270000627     C***
258280000627     C***  F L A G   I N O L T R O
258290000627     C                   EXSR      INOLTR
258300000627     C                   MOVEL     WFIN          §LPFIN
258310000627     C*
258320000627     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
258330000627    2C     APDFCM        IFNE      ' '
258340000627     C                   MOVEL     'C'           §LPFAP
258350000627     C                   ELSE
258360000627     C                   MOVEL     COMFAP        §LPFAP
258370000627    2C                   END
258380050114     c* flag unificazione spedizioni
258390050114     c                   if        *in12 and *in15
258400050114     c                   eval      §lpxco = wxco
258410050114     c                   endif
258420000627     C**
258430000627     C                   ENDSR
258440940927     C*
258450940927     C* CARICAMENTO BOLLE: DECODIFICHE -------------------------------*
258460940927     C     DECBOL        BEGSR
258470961007     C                   SETOFF                                       0413
258480950410     C                   SETOFF                                       131487
258490940927     C                   SETOFF                                       364494
258500940928     C*
258510940928     C* SE EMETTO 1 VIDEATA MI POSIZIONO SEMPRE SUL MITTENTE
258520010222     C* O SUL NUMERO ORM SE ATTIVATA PROCEDURA E SONO IM MANUTENZIONE
258530961007     C                   SETON                                        0730
258540940927     C*
258550940927     C* M I T T E N T E
258560960926     C* LNP CODICE <> LNP BOLLA: IMPOSTO P.O. CLIENTE
258570950103     C     W0030         IFNE      VIDLNP
258580950103     C                   MOVEL     W0030         VIDFLC
258590950103     C                   SETON                                        14
258600940927     C                   ENDIF
258610950103     C*
258620940927     C* C O D I C E   B O L L A
258630940927     C                   MOVEL     '3A'          COD
258640940927     C                   MOVEL(P)  VIDCBO        KEY
258650940927     C                   EXSR      CTABEL
258660940927     C  N30              MOVEL     TBLUNI        DS3A
258670940927     C  N30              MOVEL     §3ATB1        FLGTB1
258680940927     C   30              MOVEL     'F'           FLGTB1
258690070427     c                   move      flgtb1        savtb1
258700120926     c   30              clear                   savrbl
258710120926     c  n30              movel     §3arbl        savrbl
258720940927     C*
258730940927     C     FLGTB1        IFEQ      'A'
258740940927     C                   SETON                                        04
258750940927     C                   END
258760940927     C*
258770940927     C* CODICE BOLLA NON MANUTENZIONABILE
258780940927     C     §3AUCB        IFEQ      'N'
258790940927     C                   SETON                                        44
258800940927     C                   END
258810051123     c* Proteggo il codice bolla se in manutenzione o conferma bolle
258820051123     c* e bolla monovaria
258830051123     c                   if        *in12 = *on and §3asva <> *blanks
258840051123     c                   Movel     Prot1         AtrCbo
258850051123     c                   endif
258860940927     C* P A R T I T A   I V A
258870050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
258880050921     c                   select
258890050921     c* solo numeri
258900070427     c* "PRIVATO senza iso
258910050921     c     *in30         wheneq    *off
258920050921     c     wiso          andge     *zeros
258930050921     c     *in30         oreq      *on
258940050921     c     posiz         andlt     3
258950050921     c  n04              movel     wpiva         vidcpm
258960050921     c   04              movel     wpiva         vidcpd
258970050921     c* iso + numeri
258980050921     c* iso + "PRIVATO"
258990050921     c     *in30         wheneq    *off
259000050921     c     posiz         orgt      2
259010050921     c  n04              movel     wpiva         vidpim
259020050921     c   04              movel     wpiva         vidpid
259030050921     c                   endsl
259040050921     C***  *IN30         IFEQ      *ON
259050050921     C***  WISO          ORGE      *ZEROS
259060050921     C**N04              MOVEL     WPIVA         VIDCPM
259070050921     C** 04              MOVEL     WPIVA         VIDCPD
259080050921     C**                 ELSE
259090050921     C**N04              MOVEL     WPIVA         VIDPIM
259100050921     C** 04              MOVEL     WPIVA         VIDPID
259110050921     C**                 ENDIF
259120940927     C*
259130940927     C* L I N E A   D I   A R R I V O
259140941011     C                   MOVEL     VIDLNA        SAVLNA
259150940927     C     VIDLNA        IFGT      *ZEROS
259160941011     C                   MOVEL     VIDLNA        COMLNA
259170940927     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
259180940927     C  N30              MOVEL     ORGDES        V1DLNA
259190940927     C   30              MOVEL     *BLANKS       V1DLNA
259200020213     C                   MOVEL     ORGDE3        A_OG143
259210060707     C                   MOVEL     a_§ogntw      savaogntw
259220040525     C                   MOVEL     ORGDF0        A_OG150
259230020215     c                   movel     A_§ogntw      savntw
259240940927     C                   ENDIF
259250940927     C*
259260941011     C* C O D I C E   P A D R O N C I N O
259270990702     C                   CLEAR                   V1DPDR
259280941011     C     VIDPDR        IFGT      *ZEROS
259290941011     C                   MOVEL     VIDLNP        W0070
259300941011     C                   MOVE      VIDPDR        W0070
259310021204     C                   move      w0070         kpdpdr
259320021203     C                   move      'A'           kpdtip
259330021203     C     kfapd         chain     fiapd01l                           30
259340941011     C  N30              MOVEL     APDRSC        V1DPDR
259350940927     C   30              CLEAR                   V1DPDR
259360941011     C                   ENDIF
259370941107     C*
259380941107     C* T I P O   S E R V I Z I O
259390941107     C     VIDTSP        IFNE      ' '
259400941107     C                   Z-ADD     1             C
259410941107     C     VIDTSP        LOOKUP    TSP(C)                                 30
259420090604     C**!30              MOVEL     DTS(C)        V1DTSP
259430090604     C   30              MOVEL     DTS08(C)      V1DTSP
259440941107     C                   ENDIF
259450941115     C*
259460941115     C* C O N S E G N E   P A R T I C O L A R I
259470941115     C                   MOVEL     '1P'          COD
259480941115     C     VIDTC1        IFNE      *BLANKS
259490941115     C                   MOVEL(P)  VIDTC1        KEY
259500941115     C                   EXSR      CTABEL
259510941115     C  N30              MOVEL     TBLUNI        V2DTC1
259520941115     C                   ENDIF
259530941115     C     VIDTC2        IFNE      *BLANKS
259540941115     C                   MOVEL(P)  VIDTC2        KEY
259550941115     C                   EXSR      CTABEL
259560941115     C  N30              MOVEL     TBLUNI        V2DTC2
259570941115     C                   ENDIF
259580940927     C*
259590940927     C* S I G L A   O P E R A T O R E
259600940927     C* SE E' IN TABELLA  3M  SIGNIFICA CHE NON SI PUO' MANUTENZIONARE
259610940927     C                   MOVEL     '3M'          COD
259620940927     C                   MOVEL(P)  VIDSOP        KEY
259630940927     C                   EXSR      CTABEL
259640940927     C* SE TROVATA IN TABELLA --> PROTEGGO IL CAMPO
259650940927     C     *IN30         IFEQ      *OFF
259660940927     C                   SETON                                        13
259670940927     C                   END
259680940929     C* E S E N Z I O N E   I V A
259690940929     C     VIDCEI        IFNE      ' '
259700940929     C                   MOVEL     'EI'          COD
259710940929     C                   MOVEL(P)  VIDCEI        KEY
259720940929     C                   EXSR      CTABEL
259730940929     C  N30              MOVEL     TBLUNI        V3DCEI
259740940929     C                   ENDIF
259750940927     C* G I R O   D A T E
259760940927     C                   CLEAR                   WLBDAT
259770940927     C                   MOVE      BLPDSP        G02INV
259780940927     C                   MOVEL     '3'           G02ERR
259790940927     C                   CALL      'XSRDA8'
259800940927     C                   PARM                    WLBDAT
259810940927     C                   MOVEL     G02DAT        VIDDSP
259820940927     C* LA CONTROLLO SEMPRE LA DATA RITIRO
259830940927     C                   CLEAR                   SAVDRT
259840940927     C*
259850940927     C                   CLEAR                   WLBDAT
259860940927     C                   Z-ADD     VIDDRT        G02INV
259870940927     C                   MOVEL     '3'           G02ERR
259880940927     C                   CALL      'XSRDA8'
259890940927     C                   PARM                    WLBDAT
259900940927     C                   MOVEL     G02DAT        VIDDRT
259910010221     C                   Z-ADD     VIDDRT        PREDRT
259920070829     C                   Z-ADD     VIDDRT        s_drtblp
259930940927     C*
259940940927     C                   CLEAR                   WLBDAT
259950940927     C                   Z-ADD     VIDDCR        G02INV
259960940927     C                   MOVEL     '3'           G02ERR
259970940927     C                   CALL      'XSRDA8'
259980940927     C                   PARM                    WLBDAT
259990940927     C                   MOVEL     G02DAT        VIDDCR
260000940929     C*
260010940929     C                   CLEAR                   WLBDAT
260020940929     C                   Z-ADD     VIDDFT        G02INV
260030941115     C                   MOVEL     '3'           G02ERR
260040940929     C                   CALL      'XSRDA8'
260050940929     C                   PARM                    WLBDAT
260060940929     C                   Z-ADD     G02DAT        VIDDFT
260070940927     C                   ENDSR
260080910117     C*
260090910117     C*--- CREO RECORD PER STAMPA BOLLA ------------------------------*
260100910117     C     CRTBLD        BEGSR
260110910129     C  N12              MOVEL     *BLANKS       BLDATB
260120910201     C                   MOVEL     BLPLNP        BLDLNP
260130910117     C                   MOVEL     BLPAAS        BLDAAS
260140910117     C                   MOVEL     BLPNSP        BLDNSP
260150910117     C                   MOVEL     BLPNRS        BLDNRS
260160940214     C*
260170991201     C* RIFERIMENTO MITTENTE ALFABETICO, SE LNP DPD SCRIVO NUMERICO
260180910411     C     §1BFG7        IFNE      'S'
260190020319     C     §OGNTW        IFNE      'DPD'
260200940825     C                   MOVEL     BLPRMA        BLDCDP
260210991201     C                   ELSE
260220060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
260230060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
260240060622     c* in ogni caso non lo prendo più dal rmn
260250060622     c                   if        %subst(§b4ipn:14:1)=*blanks
260260060622     C                   eval      bldcdp=%subst(§b4ipn:1:3) + ' ' +
260270060622     c                             %subst(§b4ipn:4:8) + ' ' +
260280060622     c                             §b4icd
260290060622     c                   else
260300060622     c                   eval      bldcdp=§b4ipn
260310060622     c                   endif
260320991201     C                   ENDIF
260330940214     C                   ENDIF
260340940214     C*
260350910201     C  N12              MOVEL     *BLANKS       BLDFST
260360910220     C  N12              Z-ADD     1             BLDNC1
260370971215     C   12
260380971215     CAN 15              SELECT
260390971215     C* DEVO RISTAMPARE ENTRAMBE LE ETICHETTE
260400971215     C     §1BFG9        WHENEQ    'S'
260410951019     C     §1BFG6        ANDEQ     'C'
260420951019     C                   MOVEL     'S'           BLDFST
260430971215     C* DEVO STAMPARE SOLO ETICHETTA ESTERA
260440971215     C     §1BFG0        WHENEQ    'D'
260450971215     C     §1BFG6        ANDEQ     'C'
260460971215     C                   MOVEL     'E'           BLDFST
260470971217     C     §1BFG0        WHENEQ    'C'
260480971217     C     §1BFG6        ANDEQ     'C'
260490971217     C     §1BF11        ANDEQ     'D'
260500971217     C                   MOVEL     'E'           BLDFST
260510971215     C                   OTHER
260520951019     C                   MOVEL     ' '           BLDFST
260530971215     C                   ENDSL
260540971215     C*
260550971215     C                   MOVEL     BLPPDR        BLDPDR
260560910205     C                   MOVEL     BLPLNA        BLDLNA
260570910205     C                   MOVEL     BLPTFA        BLDTFA
260580910405     C                   MOVEL     BLPRSD        BLDRSD
260590910412     C                   MOVEL     BLPRSM        BLDRSM
260600910117     C     BLPCCM        IFGT      0
260610910117     C                   MOVEL     BLPCCM        BLDCCM
260620910117     C                   ELSE
260630910117     C                   MOVEL     BLPKSC        BLDCCM
260640910117     C                   END
260650000204     C**
260660000204     C* SE DEVO CREARE IL FILE METTO LA "S" DI STAMPATO
260670000204     C     WDKC          IFEQ      'S'
260680001003     C     WSGNR         OREQ      'B'
260690000211     C                   EXSR      STASCD
260700001005     C* Reimposto a "S" flag per scrittura fisgn in ristampa perchè
260710001005     C* se viene richiamato deve essere lanciato il pgm di stampa e non
260720001005     C* deve più scrivere fisgn
260730001005     C     WSGNR         IFEQ      'B'
260740001005     C                   MOVEL     'S'           WSGNR
260750001005     C                   ENDIF
260760000914     C                   ENDIF
260770000211     C*
260780000914     C* SE DISK C FLAGGO COME STAMPATO BLDFST
260790020917     C* SE FLAG 12 = E (DISK A CON FIVAT) FLAGGO SOLO SE AS400 ABILITA-
260800001106     C* TO AL DISK C
260810000914     C     *IN79         IFEQ      *ON
260820000925     C     §3CDKC        ANDEQ     'S'
260830000914     C     §1BF12        ORNE      'N'
260840001106     C     §1BF12        ANDNE     'E'
260850001106     C     §1BF12        OREQ      'E'
260860001106     C     WASDKC        ANDEQ     'S'
260870000204     C                   MOVEL     'S'           BLDFST
260880000211     C                   ENDIF
260890910117     C*
260900910204     C   15
260910000911     CORN12
260920000915     COR 12
260930000915     CANN15
260940000915     CAN 33              WRITE     FNBLD000
260950000915     C   12
260960000915     CANN15
260970000915     CANN33              UPDATE    FNBLD000
260980940214     C*
260990940214     C* SE LI AVEVO GIA' STAMPATI LI RISTAMPO SUBITO
261000971217     C*  NON VENGONO RISTAMPATI SE SONO SOLO ESTERO
261010980409     C*  NON RISTAMPO ANCHE SE E' UNA SOLUZIONE A E NON HANNO VARIATO
261020980409     C*  NESSUNO DEI CAMPI CHE INTERESSANO (N.COLLI,LNA,ZONA,CAP DEST.,
261030980409     C*  TSP.) --> WPRT = "N"
261040971217     C     SAVFST        IFEQ      'S'
261050980409     C     WPRT          ANDEQ     ' '
261060001003     C* PER DISK C STASCD L'HO GIA' RICHIAMATA
261070000915     C     WDKC          IFNE      'S'
261080940214     C                   EXSR      STASCD
261090000915     C                   ENDIF
261100060216     C* SE C'E' Fiar4 PER LNA ESTERO SDI AGGIORNO IL FLAG DI STAMPA
261110081008     C**   *IN12         IFEQ      *ON
261120081008     C**   *IN15         ANDEQ     *OFF
261130081008     c**   A_§ogntw      andeq     'EUP'
261140081008     C**                 MOVEL     'E'           WTRC
261150081008     C**   KBLP4         CHAIN     Fiar4000                           90
261160081008    2C**   *IN90         IFEQ      *OFF
261170081008     C**                 MOVEL     ar4NOT        DSBL4E
261180081008     C**                 MOVEL     'S'           §B4EST
261190081008     C**                 MOVEL     DSBL4E        ar4NOT
261200081008     C**                 UPDATE    Fiar4000
261210081008     C**                 ENDIF
261220081008     C**                 SETOFF                                       90
261230081008     C**                 ENDIF
261240971230     C                   ENDIF
261250910117     C*
261260910117     C                   ENDSR
261270940927     C*
261280940927     C* CARICO LA VARIA IN SFL ---------------------------------------*
261290940927     C     CARVAR        BEGSR
261300991012      *
261310991027     C     WSVN          IFNE      ' '
261320950418     C     *IN87         OREQ      *ON
261330991027      *
261340991027     C     WSVN          IFNE      §$2IVA
261350991027     C     WSVN          ANDNE     §$2BOL
261360991027      *
261370940927     C                   ADD       1             NRR
261380940927     C     NRR           CHAIN     LS01S03                            30
261390991027     C                   MOVEL     WSVN          V3CSV1
261400991027     C                   Z-ADD     WVAN          V3CVA1
261410991027     C                   Z-ADD     WVAN          V3HVA1
261420020102    3C     WCONV         IFEQ      '1'
261430020102     C     WVAN          ANDGT     0
261440020102    4C     VIDIMV        IFGT      *ZEROS
261450020102     C     WSVN          ORNE      'N'
261460020102     C     WVAN          ORNE      88888888
261470020102     C                   CLEAR                   DSYEUR
261480020102     C                   MOVEL     VIDDIV        YECDVI
261490020102     C                   MOVEL     §GEDCN        YECDVO
261500020102     C                   Z-ADD     WVAN          YECIMI
261510020102     C     COMFDC        IFEQ      'S'
261520020102     C                   MOVEL     '3'           YECDCO
261530020102     C                   ELSE
261540020102     C                   MOVEL     '0'           YECDCO
261550020102     C                   ENDIF
261560020102     C                   CALL      'YEURCO'
261570020102     C                   PARM                    DSYEUR
261580020102    5C     YECESI        IFEQ      ' '
261590020102     C                   Z-ADD     YECIMO        V3CVA1
261600020102     C                   Z-ADD     YECIMO        V3HVA1
261610020102    5C                   ENDIF
261620020102    4C                   ENDIF
261630020102    3C                   ENDIF
261640941021     C                   MOVEL     WEV1          V3CEV1
261650940927     C   30              WRITE     LS01S03
261660940927     C  N30              UPDATE    LS01S03
261670991027      *
261680940927     C                   ENDIF
261690991027     C                   ENDIF
261700991012      *
261710940927     C                   ENDSR
261720910117     C*
261730971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO ----------------------------*
261740910201     C     STASCI        BEGSR
261750000121     C                   MOVEL     'I'           WSTSEG            1
261760000121     C                   EXSR      RIESEG
261770971215     C**
261780971215     C**  SOLO SE DEVO STAMPARE QUALCHE COSA
261790971215     C     §DETST        IFNE      *BLANKS
261800001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
261810001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
261820001005     C   12
261830001005     CANN15WSGNR         IFEQ      'B'
261840001005     C     KBLP3         SETLL     FISGN05L
261850001005     C                   ENDIF
261860971215     C     CO2SCD        DOWLE     STANCA
261870990318     C     CO2SCD        ANDGT     0
261880980320     C* Routine per segnacolli euroexpress: imposta §DEEUR e §LDCDP
261890980320     C                   EXSR      EUREXP
261900980319     C*
261910910208     C                   ADD       1             §LDNC1
261920911119     C                   Z-ADD     CO2SCD        §LDNCD
261930910201     C*
261940000914     C* SE DISK C NON STAMPO MAI IN IMMEDIATO
261950001018     C* ANCHE SE SCRIVO FISGN SOLO PER RISTAMPA E HO VBARIATO CAMPI
261960001018     C* PER I QUALI NON È NECESSARIO RISTAMPARE IMMEDIATAMENTE L'ETICH.
261970050302     C     *IN79         IFEQ      *OFF
261980050302     C     §1BF12        ANDEQ     'N'
261990050302     C     WNOPRT        ANDNE     '1'
262000001107     C*
262010050302     C     §1BF12        oreq      'E'
262020050302     C     WASDKC        ANDNE     'S'
262030050302     C     WNOPRT        ANDNE     '1'
262040001107     C*
262050050302     C     §1BF12        OREQ      'N'
262060050302     C     *IN79         ANDEQ     *ON
262070050302     C     §3CDKC        ANDNE     'S'
262080050302     C     WNOPRT        ANDNE     '1'
262090001107     C*
262100030611     C                   CALL      WD90pss
262110910201     C                   PARM                    DSBLD
262120971216     C                   PARM                    DSBLDE
262130001005     C                   ENDIF
262140001107     C* SCRITTURA/AGGIORNAMENTO FISGN00F: PER DISKC O PER SOLA RISTAMP
262150050302     C     §1BF12        IFNE      'N'
262160050302     C     §1BF12        ANDNE     'E'
262170050302     C     §1BF12        OREQ      'E'
262180050302     C     WASDKC        ANDEQ     'S'
262190050302     C     *IN79         OREQ      *ON
262200050302     C     §3CDKC        ANDEQ     'S'
262210001005     C     WSGNR         OREQ      'B'
262220000225     C*
262230000225     C* PULISCO PERCHE' HO AGGIORNATO
262240000913    3C                   SELECT
262250050225     c* import dpd (ctm disk c)
262260050225     c     §1bf12        whenne    'N'
262270050225     c     *in79         andeq     *on
262280050302     c     wdkc          ifeq      'S'
262290050225     C     WESSGN        IFEQ      'S'
262300050225     C                   EXSR      UPDSGN
262310050225     C                   ELSE
262320050225     C                   Z-ADD     COMTFP        SGNTNP
262330050225     C                   WRITE     FISGN000
262340050225     C                   ENDIF
262350060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
262360060622     c* anche fisgn con key composta dal solo numero parcel
262370060622     c                   if        §b4ibi<>*blanks
262380060622     c                             and %subst(§b4ipn:14:1)=*blanks
262390060622     c                   clear                   kwho
262400060622     C                   movel     §b4ipn        kwho
262410060622     C                   eval      %subst(kwho:12:1)=§b4icd
262420060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
262430060623     c* serviranno per la seconda scrittura
262440060623     C                   MOVEL     DSBLD         WSBLD
262450060623     C                   MOVEL     DSBLDE        WSBLDE
262460060622     C                   CLEAR                   WESSGN
262470060622     C                   CLEAR                   WSGNR
262480060622     C                   CLEAR                   FISGN000
262490060622     C                   MOVEL     'S'           WDKC              1
262500060622     C                   EXSR      CTRSGN
262510060622     C     WDKC          IFEQ      'S'
262520060623     C                   MOVEL     WSBLD         dsbld
262530060623     C                   MOVEL     WSBLDE        dsblde
262540060622     C     WESSGN        IFEQ      'S'
262550060622     C                   EXSR      UPDSGN
262560060622     C                   ELSE
262570060622     C                   Z-ADD     COMTFP        SGNTNP
262580060622     C                   WRITE     FISGN000
262590060622     C                   ENDIF
262600060622     C                   ENDIF
262610060622     c                   endif
262620050302     C                   ENDIF
262630050221     C* EXPORT DPD DA VAT O MANUALE
262640001009     C     §1BF12        WHENNE    'N'
262650001011     C     WEXDPD        ANDEQ     'S'
262660160225     c     w_aDpd        andne     'S'
262670140714     C     §1BF13        ANDNE     'A'
262680140715     c     §1bf12        andne     'B'
262690070323     c     wparcel       andne     '12'
262700050302     C     WDKC          IFEQ      'S'
262710001009     C     WESSGN        IFEQ      'S'
262720001009     C                   EXSR      UPDSGN
262730001009     C                   ELSE
262740010116     C                   Z-ADD     COMTFP        SGNTNP
262750001009     C                   WRITE     FISGN000
262760001009     C                   ENDIF
262770050302     C                   ENDIF
262780000912     C     §1BF12        WHENNE    'N'
262790000911     C                   Z-ADD     CO2SCD        WO2SCD
262800000911     C                   MOVEL     'C'           WTRC
262810051102     C     KARS01        CHAIN(N)  FIARS01L                           30
262820000913    4C     *IN30         IFEQ      *OFF
262830000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
262840000911     C                   Z-ADD     1             IX
262850051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
262860000911     C     POS(IX)       CHAIN     LS01S08                            30
262870000204     C*
262880000204     C* SCRITTURA DEL FILE  PER DISK "C"
262890000913    5C     V8HDKC        IFEQ      'S'
262900000913    6C     V8HESG        IFEQ      'S'
262910000919     C                   MOVEL     DSBLD         WSBLD
262920000919     C                   MOVEL     DSBLDE        WSBLDE
262930010116     C     KSGN8         CHAIN     FISGN01L                           30
262940000919     C                   MOVEL     WSBLD         DSBLD
262950000919     C                   MOVEL     WSBLDE        DSBLDE
262960000921     C                   EXSR      UPDSGN
262970000913   X6C                   ELSE
262980000929     C                   EXSR      WRTSGN
262990000913    6C                   ENDIF
263000000913    5C                   ENDIF
263010000913    4C                   ENDIF
263020050225     C* IMPORT DPD (ctm no diskc)
263030000912     C     *IN79         WHENEQ    *ON
263040000912     C     WESSGN        IFEQ      'S'
263050000921     C                   EXSR      UPDSGN
263060000912     C                   ELSE
263070010116     C                   Z-ADD     COMTFP        SGNTNP
263080000912     C                   WRITE     FISGN000
263090000912     C                   ENDIF
263100001005     C* SCRIVO O UPDATO FISGN PER RISTAMPA
263110001005     C     WSGNR         WHENEQ    'B'
263120001005     C                   MOVEL     DSBLD         WSBLD
263130001005     C                   MOVEL     DSBLDE        WSBLDE
263140001005     C     KBLP3         READE     FISGN05L                               30
263150001013     C                   MOVE      *IN30         WIN30
263160001005     C                   MOVEL     WSBLD         DSBLD
263170001005     C                   MOVEL     WSBLDE        DSBLDE
263180001013     C                   CLEAR                   DSBLD7
263190001013     C                   MOVE      §LDLNP        §LCLNP
263200001013     C                   MOVE      §LDLNA        §LCLNA
263210001013     C                   MOVE      §LDNRS        §LCNRS
263220001013     C                   MOVE      §LDZSC        §LCZSC
263230001013     C                   MOVE      §LDNCD        §LCNCD
263240001013     C                   EXSR      M10
263250001013     C                   MOVEA     §CA           SGNWHO
263260001013     C                   MOVEA     §CA           V8CNOT
263270001013     C                   MOVE      WIN30         *IN30
263280001005     C     *IN30         IFEQ      *OFF
263290001005     C                   EXSR      UPDSGN
263300001005     C                   ELSE
263310001005     C                   EXSR      WRTSGN
263320001005     C                   ENDIF
263330000913    3C                   ENDSL
263340000204     C                   ENDIF
263350910201     C*
263360910827     C                   ADD       1             CO2SCD
263370910201     C*
263380971215     C                   ENDDO
263390001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
263400001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
263410001005     C   12
263420001005     CANN15WSGNR         IFEQ      'B'
263430001005     C     VIDNCL        ANDLT     SAVNCL
263440001005     C     KBLP3         READE     FISGN05L                               30
263450001005     C     *IN30         DOWEQ     *OFF
263460001005     C                   EXSR      ANNSGN
263470001005     C     KBLP3         READE     FISGN05L                               30
263480001005     C                   ENDDO
263490001005     C                   ENDIF
263500971215     C                   ENDIF
263510910404     C*
263520910117     C                   ENDSR
263530000121     C*
263540000121     C* RIEMPO DS PER STAMPA SEGNACOLLI ------------------------------*
263550000121     C     RIESEG        BEGSR
263560000124     C                   CLEAR                   §DEEUR
263570000124     C                   CLEAR                   §DEAWB
263580000124     C                   CLEAR                   §DEFCA
263590040506     C                   CLEAR                   §DEISA
263600000124     C                   CLEAR                   §DESIA
263610000201     C                   CLEAR                   §DESSE
263620010302     C                   CLEAR                   SAVCDP
263630000124     C*
263640000121     C     WSTSEG        IFEQ      'I'
263650000929     C* WSGNR = 'S' --> Scrivo fisgn per eventuale ristampa
263660001107     C* (Se provengo da manutenzione non devo azzerare nc1 prechè in
263670001107     C*  questo caso devo richiamare pgm di stampa e non scrittura di
263680001107     C*  fisgn. Se azzerassi, la stampa del progressivo sull'etichetta
263690001107     C*  partirebbe da 0 anzichè da 1)
263700000929     C     WSGNR         OREQ      'S'
263710001107     C     *IN12         ANDEQ     *OFF
263720001107     C     WSGNR         OREQ      'S'
263730001107     C     *IN15         ANDEQ     *ON
263740000121     C                   Z-ADD     0             §LDNC1
263750000121     C                   ELSE
263760000121     C                   Z-ADD     BLDNC1        §LDNC1
263770000121     C                   ENDIF
263780000208     C*
263790000208     C                   MOVEL     WDLA          §LDDLA
263800000208     C                   MOVEL     BLPFLS        §LDLNP
263810000121     C     BLPFLS        CHAIN     AZORG01L      UNIORG               30
263820000121     C  N30              MOVEL     ORGDES        §LDDLP
263830000121     C   30              MOVEL     *BLANKS       §LDDLP
263840000121     C     WSTSEG        IFEQ      'D'
263850000121     C                   MOVEL     BLDCDP        §LDCDP
263860000121     C                   ELSE
263870000121      * RIFERIMENTO MITTENTE ALFABETICO
263880000121     C                   MOVEL     BLPRMA        §LDCDP
263890000121     C                   ENDIF
263900000121      *
263910000121      * SE LNP DPD SCRIVO NUMERICO
263920020319     C     §OGNTW        IFEQ      'DPD'
263930060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
263940060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
263950060622     c* in ogni caso non lo prendo più dal rmn
263960060622     c                   if        %subst(§b4ipn:14:1)=*blanks
263970060622     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
263980060622     c                             %subst(§b4ipn:4:8) + ' ' +
263990060622     c                             §b4icd
264000060622     c                   else
264010060622     c                   eval      §ldcdp=§b4ipn
264020060622     c                   endif
264030000121     C                   ENDIF
264040000121      *
264050000121      * PER EXPORT DPD SCRIVO NUMERO PARCEL
264060020319    1C     A_§OGNTW      IFEQ      'DPD'
264070060510    2C     §B4ipn        ANDNE     *BLANKS
264080010302     C* Se RMA diverso da blanks lo devo stampare, allineato a dx,
264090120302     C* nella prima riga di stampa dell'etichetta brt andando
264100010302     C* a coprire in parte la ragione sociale del mittente
264110010302     C* In questo punto mi salvo quindi il rma che andrò a muovere
264120010302     c* nela campo della ragione sociale se <> da blank (v.sotto)
264130060510     c* ATTENZIONE: per numero parcel lungo 14 continuiamo a stamparlo
264140120302     c* sull'etichetta brt ma non più distanziato in quanto
264150060510     c* §ldcdp non è abbastanza lungo
264160010302     C                   MOVE      §LDCDP        SAVCDP
264170060626     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
264180060626     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
264190060626     c                   if        %subst(§b4ipn:14:1)=*blanks
264200060626     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
264210060626     c                             %subst(§b4ipn:4:8) + ' ' +
264220060626     c                             §b4icd
264230060626     c                   else
264240060626     c                   eval      §ldcdp=§b4ipn
264250060626     c                   endif
264260000121    2C                   ENDIF
264270020211     c*
264280020211      * PER EXPORT FEDEX SCRIVO AWB
264290020213    1C     A_§ogntw      IFEQ      'FED'
264300020211     C                   MOVEL     §B4ERP        §LDCDP
264310020211    1C                   ENDIF
264320000201     C*
264330000201     C* ALTRI DATI ETICHETTA ESTERA
264340000201     C                   EXSR      ETIEST
264350000121     C*
264360000121     C                   MOVEL     BLPNRS        §LDNRS
264370000121     C                   MOVEL     BLPLNA        §LDLNA
264380000121     C                   MOVEL     BLPTFA        §LDTNA
264390000121     C                   MOVE      BLPPDR        §LDCPD
264400000121     C                   MOVEL     BLPTSP        §LDTSP
264410000121     C                   MOVEL     BLPZNC        §LDZSC
264420000121     C                   MOVE      BLPNCL        §LDNC2
264430000121     C                   MOVEL     BLPRSM        §LDRSM
264440010302     C* SOLO PER SEGNACOLLI EXPORT DPD:
264450010302     C* MUOVO ALLINEATO, A SX DELLA RSM, IL RMA SE <> DA BLANKS
264460010302     C* E LO COMPATTO PERDENDO CIOÈ I BLANK NON SIGNIFICATIVI
264470010302     C     SAVCDP        IFNE      *BLANKS
264480010302     C                   CLEAR                   W35
264490010302     C                   MOVEA     SAVCDP        W35
264500010302     C     ' '           CHECKR    SAVCDP        §Z                2 0
264510010302     C                   ADD       2             §Z
264520010302     C                   MOVEA     BLPRSM        W35(§Z)
264530010302     C                   MOVEA     W35           §LDRSM
264540010302     C                   ENDIF
264550000121     C                   MOVEL     BLPPRM        §LDPRM
264560000121     C                   MOVEL     BLPRSD        §LDRSD
264570000121     C                   MOVEL     BLPCAD        §LDCAD
264580000121     C                   MOVEL     BLPLOD        §LDLOD
264590000121     C                   MOVEL     BLPIND        §LDIND
264600000121     C                   MOVE      BLPPRD        §LDPRD
264610000121     C                   MOVEL     *ZEROS        §LDNCP
264620000121     C                   MOVEL     *ZEROS        §LDNCU
264630000121     C                   MOVEL     BLPFVF        §LDFVR
264640000121     C                   MOVEL     BLPVLF        §LDVOL
264650000121     C                   MOVEL     BLPPKF        §LDPKG
264660000121     C                   MOVEL     BLPAAS        §LDAAS
264670000121     C                   MOVEL     BLPMGS        §LDMGS
264680050422     c                   clear                   §ldrst
264690050422     c* in conferma o in immissione imposto "V" di valore se collo
264700050422     c* di valore
264710050422     c                   if        (*in12 = *off or *in15 = *on) and
264720050422     c                             vidbva <> *blanks
264730050422     c                   eval      §ldrst = 'V'
264740050422     c                   endif
264750050422     c* in manutenzione metto "M" se modificato no collo di valore
264760050422     c*                 metto "W" se modificato    collo di valore
264770050422     C     *IN12         IFEQ      *ON
264780050422     C     *IN15         ANDEQ     *OFF
264790050422     c     vidbva        ifeq      *blanks
264800050422     c* Se è un disk c non ha senso stampare l'etichetta con la "M" in
264810050422     c* quanto questa esce solo quando il collo passa sull'impianto
264820050422     c     wdkc          ifne      'S'
264830050422     c     wsgnr         andne     'B'
264840050422     C                   MOVEL     'M'           §LDRST
264850050422     c                   endif
264860050422     c                   else
264870050422     c     wdkc          ifne      'S'
264880050422     c     wsgnr         andne     'B'
264890050422     c                   movel     'W'           §ldrst
264900050422     c                   else
264910050422     c                   movel     'V'           §ldrst
264920050422     c                   endif
264930050422     c                   endif
264940050422     c                   endif
264950000121     C                   ENDSR
264960000929     C*
264970971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO COME RISTAMPA DEL "D" ------*
264980910201     C     STASCD        BEGSR
264990910201     C* RICHIAMO DIRETTAMENTE IL PROGRAMMA DI STAMPA SEGNACOLLO
265000910827     C                   Z-ADD     BLDNCD        CO2SCD
265010910201     C     BLDNCA        IFEQ      0
265020910201     C                   Z-ADD     BLDNCD        BLDNCA
265030910201     C                   END
265040040506     C* IMPOSTO DSBLDE
265050081008     C**   WESTER        IFEQ      'S'
265060081008     C**                 MOVEL     'ALL'         §DETST
265070081008     C**                 ELSE
265080040506     C                   MOVEL     'ITA'         §DETST
265090040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
265100040506     c* etichetta Italia con dati esteri
265110040506     C     A_§ogntw      IFEQ      'EEX'
265120040506     C                   MOVEL     'EEX'         §DETSE
265130040506     c                   else
265140040506     c                   clear                   §detse
265150040506     C                   ENDIF
265160081008     C***                ENDIF
265170000121     C* RIEMPO LE DS
265180060622     C                   MOVEL     'D'           WSTSEG
265190000121     C                   EXSR      RIESEG
265200000211     C**
265210000919     C*
265220001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
265230001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
265240001005     C   12
265250001005     CANN15WSGNR         IFEQ      'B'
265260001019     C     WSTSGN        ANDEQ     *BLANKS
265270001005     C     KBLP3         SETLL     FISGN05L
265280001019     C                   MOVE      '1'           WSTSGN            1
265290001005     C                   ENDIF
265300980320     C*
265310000908     C     CO2SCD        DOWLE     BLDNCA
265320990318     C     CO2SCD        ANDGT     0
265330980320     C* Routine per impostazione campi segnacollo euroexpress di dsblde
265340980320     C                   EXSR      EUREXP
265350911122     C                   Z-ADD     CO2SCD        §LDNCD
265360910201     C*
265370000204     C     WDKC          IFNE      'S'
265380001003     C     WSGNR         ANDNE     'B'
265390030611     C                   CALL      WD90pss
265400910201     C                   PARM                    DSBLD
265410971216     C                   PARM                    DSBLDE
265420000913     C                   ELSE
265430000225     C*
265440000225     C* PULISCO PERCHE' HO AGGIORNATO
265450000912    3C                   SELECT
265460050224     C* IMPORT DPD
265470050224     c     §1bf12        whenne    'N'
265480050224     C     *IN79         andeq     *ON
265490050224     C     WDKC          IFEQ      'S'
265500050224     C     WESSGN        IFEQ      'S'
265510050224     C                   EXSR      UPDSGN
265520050224     C                   ELSE
265530050224     C                   Z-ADD     COMTFP        SGNTNP
265540050224     C                   WRITE     FISGN000
265550050224     C                   ENDIF
265560050224     C                   ENDIF
265570060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
265580060622     c* anche fisgn con key composta dal solo numero parcel
265590060622     c                   if        §b4ibi<>*blanks
265600060622     c                             and %subst(§b4ipn:14:1)=*blanks
265610060622     c                   clear                   kwho
265620060622     C                   movel     §b4ipn        kwho
265630060622     C                   eval      %subst(kwho:12:1)=§b4icd
265640060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
265650060623     c* serviranno per la seconda scrittura
265660060623     C                   MOVEL     DSBLD         WSBLD
265670060623     C                   MOVEL     DSBLDE        WSBLDE
265680060622     C                   CLEAR                   WESSGN
265690060622     C                   CLEAR                   WSGNR
265700060622     C                   CLEAR                   FISGN000
265710060622     C                   MOVEL     'S'           WDKC              1
265720060622     C                   EXSR      CTRSGN
265730060622     C     WDKC          IFEQ      'S'
265740060623     C                   MOVEL     WSBLD         dsbld
265750060623     C                   MOVEL     WSBLDE        dsblde
265760060622     C     WESSGN        IFEQ      'S'
265770060622     C                   EXSR      UPDSGN
265780060622     C                   ELSE
265790060622     C                   Z-ADD     COMTFP        SGNTNP
265800060622     C                   WRITE     FISGN000
265810060622     C                   ENDIF
265820060622     C                   ENDIF
265830060622     c                   endif
265840050221     C* DISK C EXPORT DPD DA vat O MANUALE
265850001009     C     §1BF12        WHENNE    'N'
265860001011     C     WEXDPD        ANDEQ     'S'
265870160225     c     w_aDpd        andne     'S'
265880140714     C     §1BF13        ANDNE     'A'
265890140715     c     §1bf12        andne     'B'
265900070323     C     wparcel       ANDNE     '12'
265910001009     C     WDKC          IFEQ      'S'
265920001009     C     WESSGN        IFEQ      'S'
265930001009     C                   EXSR      UPDSGN
265940001009     C                   ELSE
265950010116     C                   Z-ADD     COMTFP        SGNTNP
265960001009     C                   WRITE     FISGN000
265970001009     C                   ENDIF
265980001009     C                   ENDIF
265990000912     C     §1BF12        WHENNE    'N'
266000000911     C                   Z-ADD     CO2SCD        WO2SCD
266010000911     C                   MOVEL     'C'           WTRC
266020051102     C     KARS01        CHAIN(N)  FIARS01L                           30
266030000912    4C     *IN30         IFEQ      *OFF
266040000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
266050000911     C                   Z-ADD     1             IX
266060051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
266070000911     C     POS(IX)       CHAIN     LS01S08                            30
266080000204     C*
266090000204     C* SCRITTURA DEL FILE  PER DISK "C"
266100000912    5C     V8HDKC        IFEQ      'S'
266110000912    6C     V8HESG        IFEQ      'S'
266120000919     c* prima di chainare fisgn mi salvo la ds
266130000919     C                   MOVEL     DSBLD         WSBLD
266140000919     C                   MOVEL     DSBLDE        WSBLDE
266150010116     C     KSGN8         CHAIN     FISGN01L                           30
266160000919     C                   MOVEL     WSBLD         DSBLD
266170000919     C                   MOVEL     WSBLDE        DSBLDE
266180000912     C                   EXSR      UPDSGN
266190000912   X6C                   ELSE
266200000929     C                   EXSR      WRTSGN
266210000912    6C                   ENDIF
266220000912    5C                   ENDIF
266230000912    4C                   ENDIF
266240050224     C* IMPORT DPD (ctm no disk c)
266250000912     C     *IN79         WHENEQ    *ON
266260000912     C     WESSGN        IFEQ      'S'
266270000912     C                   EXSR      UPDSGN
266280000912     C                   ELSE
266290010116     C                   Z-ADD     COMTFP        SGNTNP
266300000912     C                   WRITE     FISGN000
266310000912     C                   ENDIF
266320001003     C* FISGN IN RISTAMPA
266330001003     C     WSGNR         WHENEQ    'B'
266340001005     c* prima di leggere fisgn mi salvo la ds
266350001005     C                   MOVEL     DSBLD         WSBLD
266360001005     C                   MOVEL     DSBLDE        WSBLDE
266370001005     C     KBLP3         READE     FISGN05L                               30
266380001013     C                   MOVE      *IN30         WIN30             1
266390001005     C                   MOVEL     WSBLD         DSBLD
266400001005     C                   MOVEL     WSBLDE        DSBLDE
266410001013     C                   CLEAR                   DSBLD7
266420001013     C                   MOVE      §LDLNP        §LCLNP
266430001013     C                   MOVE      §LDLNA        §LCLNA
266440001013     C                   MOVE      §LDNRS        §LCNRS
266450001013     C                   MOVE      §LDZSC        §LCZSC
266460001013     C                   MOVE      §LDNCD        §LCNCD
266470001013     C                   EXSR      M10
266480001013     C                   MOVEA     §CA           SGNWHO
266490001013     C                   MOVEA     §CA           V8CNOT
266500001013     C                   MOVE      WIN30         *IN30
266510001005     C     *IN30         IFEQ      *OFF
266520001005     C                   EXSR      UPDSGN
266530001005     C                   ELSE
266540001003     C                   EXSR      WRTSGN
266550001005     C                   ENDIF
266560000912    3C                   ENDSL
266570000911     C                   ENDIF
266580910201     C*
266590910827     C                   ADD       1             CO2SCD
266600910313     C                   ADD       1             §LDNC1
266610910201     C*
266620910201     C                   END
266630001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
266640001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
266650001005     C   12
266660001005     CANN15WSGNR         IFEQ      'B'
266670001005     C     VIDNCL        ANDLT     SAVNCL
266680001005     C     KBLP3         READE     FISGN05L                               30
266690001005     C     *IN30         DOWEQ     *OFF
266700001005     C                   EXSR      ANNSGN
266710001005     C     KBLP3         READE     FISGN05L                               30
266720001005     C                   ENDDO
266730001005     C                   ENDIF
266740910201     C                   ENDSR
266750910805     C*
266760910805     C*--- CREO FLBLT00F ---------------------------------------------*
266770910805     C     CRTBLT        BEGSR
266780940926     C                   CLEAR                   FNBLT000
266790910805     C                   MOVEL     BLPAAS        BLTAAS
266800940926     C                   MOVEL     BLPLNP        BLTLNP
266810910805     C                   MOVEL     BLPNRS        BLTNRS
266820000921     C                   MOVEL     BLPNSP        BLTNSP
266830910828     C                   MOVEL     BLPLNA        BLTLNA
266840910828     C                   MOVEL     BLPFLS        BLTFLS
266850060622     C                   MOVEL     BLPNFV        BLTNFV
266860920910     C                   MOVEL     BLPFLP        BLTFLP
266870940926     C                   MOVEL     WNSC          BLTNSC
266880940915     C                   WRITE     FNBLT000
266890120817     c* richiamo creazione dettaglio colli unico
266900120817     c                   exsr      crtFIART
266910980318     C*
266920000908     C* RICHIAMO CREAZIONE ESTENSIONE DETTAGLIO SEGNACOLLO
266930000908     C* PER MEMORIZZAZIONE COD. "CHI SONO"
266940051102     C                   EXSR      CRTARS
266950910805     C*
266960910805     C                   ENDSR
266970120814     C*--- CREO FIART00F ---------------------------------------------*
266980120814     C     crtFIART      BEGSR
266990120814     C                   CLEAR                   FIART000
267000120814     C                   MOVEL     BLPAAS        ARTAAS
267010120814     C                   MOVEL     BLPLNP        ARTLNP
267020120814     C                   MOVEL     BLPNRS        ARTNRS
267030120814     C                   MOVEL     BLPNSP        ARTNSP
267040120814     C                   MOVEL     BLPLNA        ARTLNA
267050120814     C                   MOVEL     BLPFLS        ARTFLS
267060120814     C                   MOVEL     BLPNFV        ARTNFV
267070120814     C                   MOVEL     BLPFLP        ARTFLP
267080120814     C                   MOVEL     WNSC          ARTNSC
267090120814     C                   WRITE     FIART000
267100120814     c                   endsr
267110051102     C*--- CREO FIARS00F ---------------------------------------------*
267120051102     C     CRTARS        BEGSR
267130001009     C*
267140001013    1C                   SELECT
267150050221     C* DISK C EXPORT DPD DA vat O MANUALE
267160001011     C     WEXDPD        WHENEQ    'S'
267170140714     C     §1BF13        ANDNE     'A'
267180160225     C     w_aDpd        ANDNE     'S'
267190001009     C     §1BF12        ANDNE     'N'
267200140715     C     §1BF12        ANDNE     'B'
267210070322     c     wparcel       andne     '12'
267220051102     C                   CLEAR                   FIARS000
267230120817     C***                MOVE      BLTFLS        ARSFLS
267240120817     C***                MOVE      BLTLNA        ARSLNA
267250120817     C***                MOVE      BLTNRS        ARSNRS
267260120817     C***                MOVE      BLTNSC        ARSNSC
267270120817     C                   MOVE      ARTFLS        ARSFLS
267280120817     C                   MOVE      ARTLNA        ARSLNA
267290120817     C                   MOVE      ARTNRS        ARSNRS
267300120817     C                   MOVE      ARTNSC        ARSNSC
267310051102     C                   MOVEL     'C'           ARSTRC
267320051102     C                   MOVEL     V7CNPR        ARSNOT
267330051114     C                   MOVEL     dateu         ARSduv
267340051102     C                   WRITE     FIARS000
267350050224     c* Disk C import DPD
267360050224     c     *in79         wheneq    *on
267370050224     c     §1bf12        andne     'N'
267380051102     C                   CLEAR                   FIARS000
267390120817     C***                MOVE      BLTFLS        ARSFLS
267400120817     C***                MOVE      BLTLNA        ARSLNA
267410120817     C***                MOVE      BLTNRS        ARSNRS
267420120817     C***                MOVE      BLTNSC        ARSNSC
267430120817     C                   MOVE      ARTFLS        ARSFLS
267440120817     C                   MOVE      ARTLNA        ARSLNA
267450120817     C                   MOVE      ARTNRS        ARSNRS
267460120817     C                   MOVE      ARTNSC        ARSNSC
267470051102     C                   MOVEL     'C'           ARSTRC
267480060622     c***                z-add     blprmn        w0120
267490060622     C***                MOVEL     w0120         ARSNOT
267500060622     c                   movel     v7cnpr        arsnot
267510051114     C                   MOVEL     dateu         ARSduv
267520051102     C                   WRITE     FIARS000
267530980318     C*
267540000908     C* DISK C
267550000608     C*
267560000908     C     §1BF12        WHENNE    'N'
267570000908     C     NR8           CHAIN     LS01S08                            30
267580000908     C     *IN30         DOWEQ     *OFF
267590000908     C     V8CSCE        ANDEQ     'A'
267600000908     C                   ADD       1             NR8
267610000908     C     NR8           CHAIN     LS01S08                            30
267620000908     C                   ENDDO
267630000908     C     *IN30         IFEQ      *OFF
267640051102     C                   CLEAR                   FIARS000
267650120817     C***                MOVE      BLTFLS        ARSFLS
267660120817     C***                MOVE      BLTLNA        ARSLNA
267670120817     C***                MOVE      BLTNRS        ARSNRS
267680120817     C***                MOVE      BLTNSC        ARSNSC
267690120817     C                   MOVE      ARTFLS        ARSFLS
267700120817     C                   MOVE      ARTLNA        ARSLNA
267710120817     C                   MOVE      ARTNRS        ARSNRS
267720120817     C                   MOVE      ARTNSC        ARSNSC
267730051102     C                   MOVEL     'C'           ARSTRC
267740051102     C                   MOVEL     V8CNOT        ARSNOT
267750051114     C                   MOVEL     dateu         ARSduv
267760051102     C                   WRITE     FIARS000
267770000911     C                   ADD       1             NR8
267780000908     C                   ENDIF
267790120302     C* SE IMPORT BRT DEVO MEMORIZZARE SEMPRE SU ARS ANCHE
267800000911     C* RECORD TIPO 'E' PER SEGNACOLLO EUROEXPRESS
267810020211     c     §ogntw        ifeq      'EEX'
267820000911     C     §1BF12        ANDEQ     'E'
267830051102     C                   CLEAR                   FIARS000
267840120817     C***                MOVE      BLTFLS        ARSFLS
267850120817     C***                MOVE      BLTLNA        ARSLNA
267860120817     C***                MOVE      BLTNRS        ARSNRS
267870120817     C***                MOVE      BLTNSC        ARSNSC
267880120817     C                   MOVE      ARTFLS        ARSFLS
267890120817     C                   MOVE      ARTLNA        ARSLNA
267900120817     C                   MOVE      ARTNRS        ARSNRS
267910120817     C                   MOVE      ARTNSC        ARSNSC
267920051102     C                   MOVEL     'E'           ARSTRC
267930051102     C                   MOVEL     V8CNOT        ARSNOT
267940051114     C                   MOVEL     dateu         ARSduv
267950051102     C                   WRITE     FIARS000
267960000911     C                   ENDIF
267970000908    1C                   ENDSL
267980051020     c*
267990051020     c                   select
268000120302     C* EXPORT BRT
268010051020     c     A_§ogntw      wheneq    'EEX'
268020051102     C                   CLEAR                   FIARS000
268030120817     C***                MOVE      BLTFLS        ARSFLS
268040120817     C***                MOVE      BLTLNA        ARSLNA
268050120817     C***                MOVE      BLTNRS        ARSNRS
268060120817     C***                MOVE      BLTNSC        ARSNSC
268070120817     C                   MOVE      ARTFLS        ARSFLS
268080120817     C                   MOVE      ARTLNA        ARSLNA
268090120817     C                   MOVE      ARTNRS        ARSNRS
268100120817     C                   MOVE      ARTNSC        ARSNSC
268110051102     C                   MOVEL     'E'           ARSTRC
268120051020     c                   clear                   dsbld7
268130120817     c***                eval      §lclnp=bltfls
268140120817     c***                eval      §lclna=bltlna
268150120817     c***                eval      §lcnrs=bltnrs
268160120817     c***                eval      §lcncd=bltnsc
268170120817     c                   eval      §lclnp=artfls
268180120817     c                   eval      §lclna=artlna
268190120817     c                   eval      §lcnrs=artnrs
268200120817     c                   eval      §lcncd=artnsc
268210051020     c                   eval      §lczsc=blpznc
268220051020     c                   exsr      m10
268230051102     C                   MOVEA     §CA           ARSnot
268240051114     C                   MOVEL     dateu         ARSduv
268250051020     C*
268260051102     C                   WRITE     FIARS000                             30
268270051020     C* EXPORT FEDEX
268280051020     c     A_§ogntw      wheneq    'FED'
268290051102     C                   CLEAR                   FIARS000
268300120817     C***                MOVE      BLTFLS        ARSFLS
268310120817     C***                MOVE      BLTLNA        ARSLNA
268320120817     C***                MOVE      BLTNRS        ARSNRS
268330120817     C***                MOVE      BLTNSC        ARSNSC
268340120817     C                   MOVE      ARTFLS        ARSFLS
268350120817     C                   MOVE      ARTLNA        ARSLNA
268360120817     C                   MOVE      ARTNRS        ARSNRS
268370120817     C                   MOVE      ARTNSC        ARSNSC
268380051102     C                   MOVEL     'F'           ARSTRC
268390051020     c                   movel     wawb          w0012a           12
268400051020     c* calcolo check digit
268410051020     c                   exsr      chkdgf
268420051102     c                   movel     w0012a        ARSnot
268430051114     C                   MOVEL     dateu         ARSduv
268440051020     C*
268450051102     C                   WRITE     FIARS000
268460051020     c                   add       1             wawb
268470051020     C                   ENDsl
268480980318     C                   ENDSR
268490980320     C*--- COMPATTO IL CAP TOGLIENDO TUTTI I BLANK -------------------*
268500980320     C     WRKCAP        BEGSR
268510011120     C     WNO55L        IFEQ      *BLANKS
268520980320     C* Compongo il segnacollo Euroexpress
268530980320     C                   MOVE      *ZEROS        §Y                2 0
268540980320     C                   MOVE      *BLANKS       §S9
268550980320     C                   MOVE      *BLANK        §O9
268560980320     C                   MOVEA     WRKCAD        §S9
268570980320     C* Compatto il cap togliendo tutti i blank
268580980320    2C                   DO        9             §X1               2 0
268590980320    3C     §S9(§X1)      IFNE      *BLANKS
268600980320     C                   ADD       1             §Y
268610980320     C                   MOVE      §S9(§X1)      §O9(§Y)
268620980320    3C                   END
268630980320    2C                   END
268640011120     C                   ENDIF
268650980320     C* Prendo codice iso della nazione
268660980320     C                   MOVEL     '15'          COD
268670980320     C                   MOVEL(P)  BLPNZD        KEY
268680980320     C                   EXSR      CTABEL
268690980320     C   30              CLEAR                   DS15
268700980320     C  N30              MOVEL     TBLUNI        DS15
268710980320     C* Unisco il cap compattato alla nazione
268720980320     C                   MOVEL     §15COD        W15COD            2
268730980320     C                   ENDSR
268740051102     C*--- AGGIORNO FIARS00F -----------------------------------------*
268750051102     C     AGGARS        BEGSR
268760040514     c                   clear                   jf                2 0
268770980320     C                   MOVEL     'E'           WTRC
268780020213    1C     A_§ogntw      IFEQ      'EEX'
268790120817     C***  KBLT1         SETLL     FNBLT01L
268800120817     C***  KBLT1         READE(N)  FNBLT01L                               30
268810120817     C     KBLT1         SETLL     FIART01L
268820120817     C     KBLT1         READE(N)  FIART01L                               30
268830980320    2C     *IN30         DOWEQ     *OFF
268840120817     C***  KARS1         CHAIN     FIARS01L                           30
268850120817     C     KARS1A        CHAIN     FIARS01L                           30
268860980320    3C     *IN30         IFEQ      *OFF
268870051102     c                   eval      jf=%scan(wjut:ARSnot)
268880040514    4c     jf            ifgt      *zeros
268890051102     C                   MOVEL     ARSNOT        DSEEX
268900980320     C* Compatto il cap nuovo e prendo cod.iso
268910980320     C                   MOVEL     VIDCAD        WRKCAD
268920980320     C                   EXSR      WRKCAP
268930011120     C     WNO55L        IFEQ      *BLANKS
268940980320     C                   MOVEA     §O9           WCAD
268950980320     C* Unisco il cap compattato alla nazione salvata
268960980408     C                   CLEAR                   WCADN
268970980320     C     WCAD          CAT       W15COD:0      WCADN
268980011107     C                   ELSE
268990011107     C                   CLEAR                   WCADN
269000011126     C                   CLEAR                   W55L
269010011120     C                   MOVEL     W15COD        W15C
269020011107     C                   ENDIF
269030980320     C*
269040051102     C                   MOVEL     DSEEX         ARSNOT
269050051114     C                   MOVEL     dateu         ARSduv
269060051102     C                   UPDATE    FIARS000
269070040514    4c                   endif
269080980320    3C                   END
269090040514     c     jf            ifgt      *zeros
269100120817     C**** KBLT1         READE(N)  FNBLT01L                               30
269110120817     C     KBLT1         READE(N)  FIART01L                               30
269120040514     c                   else
269130040514     c                   seton                                        30
269140040514     c                   endif
269150980320    2C                   ENDDO
269160980320    1C                   END
269170980320     C                   ENDSR
269180980320     C*--- IMPOSTO CAMPI SEGNAC.EUROEX DA PASSARE A PGM DI STAMPA ----*
269190980320     C     EUREXP        BEGSR
269200040505     C     §ogntw        ifeq      'EEX'
269210980320     C                   MOVEL     'E'           WTRC
269220980320     C                   Z-ADD     CO2SCD        WO2SCD            7 0
269230051102     C     KARS01        CHAIN(N)  FIARS01L                           30
269240980320    2C     *IN30         IFEQ      *OFF
269250980320     C* PASSO AL PGM DI STAMPA ETICHETTE IL N. SEGNACOLLO EUROEXPRESS
269260051102     C                   MOVEL     ARSNOT        §DEEUR
269270120302     C* SE IMPORT BRT METTO NEL CODICE PRODOTTO DELL'ETICHETTA
269280980320     C* ITALIA IL N.SEGNACOLLO EUROEXPRESS
269290000209     C*
269300051102     C                   MOVEA     ARSNOT        W35
269310980330     C                   Z-ADD     1             BB                2 0
269320980330     C     ' '           LOOKUP    W35(BB)                                30
269330980330     C   30              MOVEA     *BLANKS       W35(BB)
269340980330     C                   MOVEA     W35(6)        §LDCDP
269350980320    2C                   ENDIF
269360980320    1C                   ENDIF
269370020212     c* EXPORT FEDEX
269380020213    1C     A_§ogntw      IFEQ      'FED'
269390020212     C                   MOVEL     'F'           WTRC
269400020212     C                   Z-ADD     CO2SCD        WO2SCD            7 0
269410051102     C     KARS01        CHAIN(N)  FIARS01L                           30
269420020212    2C     *IN30         IFEQ      *OFF
269430020212     C* METTO NEL CODICE PRODOTTO DELL'ETICHETTA ITALIA il n.segnac. FEDEX
269440051102     C                   MOVEL     ARSNOT        §ldcdp
269450020212    2C                   ENDIF
269460020212    1C                   ENDIF
269470980320     C                   ENDSR
269480980409     C*
269490980409     C*--- SBORDERIZZAZIONE ------------------------------------------*
269500980409     C     SBORD         BEGSR
269510981020     C                   SETOFF                                       30
269520980409     C     KBLP3         SETLL     FNBLT000
269530980409    1C     *IN30         DOWEQ     *OFF
269540980409     C     KBLP3         READE     FNBLT000                               30
269550980409     C* SOLO SE NON C'E' GIA' LA DATA DI PARTENZA
269560980409    2C  N30BLTDFV        IFEQ      0
269570980409     C                   CLEAR                   BLTNFV
269580980409     C                   UPDATE    FNBLT000
269590120814     c     kfiart        chain     fiart01l
269600120814     c                   if        %found(fiart01l)
269610120814     C                   CLEAR                   ARTNFV
269620120814     C                   UPDATE    FIART000
269630120814     c                   endif
269640980409    2C                   ENDIF
269650980409    1C                   ENDDO
269660980409     C                   ENDSR
269670940916     C*
269680930708     C*--- CHAIN TABEL00F --------------------------------------------*
269690930708     C     CTABEL        BEGSR
269700930708     C     KTAB2         CHAIN     TABEL                              30
269710930708     C  N30TBLFLG        IFNE      ' '
269720930708     C                   SETON                                        30
269730930708     C                   END
269740930708     C                   ENDSR
269750930708     C*
269760930708     C*--- READ  TABEL00F --------------------------------------------*
269770930708     C     RTABEL        BEGSR
269780930708     C     KTAB3         READE     TABEL                                  30
269790930708     C                   ENDSR
269800940214     C*
269810940214     C*--- PASSO DATI PER CALCOLARE CONSEGNA TEORICA -----------------*
269820940214     C     CLSE98        BEGSR
269830970925     C                   CLEAR                   DSSD99
269840940214     C*
269850941230     C     VIDTSP        IFNE      *BLANKS
269860940214     C                   MOVEL     VIDTSP        D98TSP
269870941230     C                   ELSE
269880941230     C                   MOVEL     COMTSP        D98TSP
269890941230     C                   ENDIF
269900940214     C                   MOVEL     VIDCAD        D98CAD
269910970925     C                   MOVEL     VIDLOD        D98LOD
269920950102     C                   MOVEL     VIDNZD        D98NZD
269930940628     C* CALCOLO FLAG INOLTRO
269940940628     C                   EXSR      INOLTR
269950940628     C                   MOVEL     WFIN          D98FIN
269960940214     C*
269970001031     C* TERMINAL DI PARTENZA
269980960130     C                   MOVEL     COMTFP        D98TFP
269990940214     C*
270000001031     C* TERMINAL DI ARRIVO
270010970925     C                   CLEAR                   DSLV55
270020970925     C                   MOVEL     'A'           D55TPT
270030001031     C                   MOVEL     VIDLNP        D55LNP
270040001031     C*
270050970925     C                   MOVEL     COMLNA        D55LIN
270060970925     C                   MOVEL     BLPDSP        D55DRF
270070970925     C                   CALL      'FNLV55R'
270080970925     C                   PARM                    DSLV55
270090970925     C*
270100001031    1C     D55ERR        IFEQ      ' '
270110970925     C                   MOVEL     D55TFA        D98TFA
270120970925     C                   ELSE
270130970925     C                   MOVEL     COMLNA        D98TFA
270140001031    1C                   ENDIF
270150960927     C*
270160970925     C                   MOVEL     VIDLNP        D98LNP
270170970925     C                   MOVEL     COMLNA        D98LNA
270180940214     C                   MOVEL     BLPDSP        D98DSP
270190950102     C                   MOVE      BLPDSP        D98MGS
270200160315     c                   if        vidgc1<>' P' and vidgc1<>' M'
270210940214     C                   MOVEL     VIDGC1        D98GC1
270220160315     c                   endif
270230160315     c                   if        vidgc2<>' P' and vidgc2<>' M'
270240940214     C                   MOVEL     VIDGC2        D98GC2
270250160315     c                   endif
270260950102     C                   MOVEL     §3ATB1        D98TBL
270270950102     C                   MOVEL     WKSC          D98KSC
270280130826     c                   if        %subst(%editc(wksc:'X'):4:4)='9999'
270290130826     c                   move      8888          d98ksc
270300130826     c                   endif
270310100219     c* In alcuni casi, per la delivery, non devo tenere conto dei tempi
270320100219     c*  del C/Ass e fermo deposito
270330100219     c                   if        UsaCass=' '
270340010823     C                   Z-ADD     VIDCAS        D98CAS
270350010823     C                   MOVEL     VIDVCA        D98VCA
270360940214     C                   MOVEL     VIDTIC        D98TIC
270370940214     C                   MOVEL     VIDFFD        D98FFD
270380010214     C     D98FFD        IFEQ      'N'
270390010214     C                   MOVE      *BLANKS       D98FFD
270400010214     C                   ENDIF
270410100219     C                   ENDIF
270420950102     C*
270430970925     C                   CALL      'TNSD99R'
270440970925     C                   PARM                    DSSD99
270450940214     C* FLAG CHE TENGO MEMORIZZATO PER POI CHIUDERE I FILES
270460940214     C                   MOVEL     '1'           WCL98             1
270470940214     C*
270480100219     c                   clear                   UsaCass
270490900427     C                   ENDSR
270500950126     C*
270510950126     C* SPENGO INDICATORI DELLA 1 VIDEATA ---------------------------*
270520950126     C     OFFD01        BEGSR
270530950126     C                   SETOFF                                       404142
270540000313     C                   SETOFF                                       614356
270550950126     C                   SETOFF                                       455150
270560950126     C                   SETOFF                                       626346
270570950126     C                   SETOFF                                       474849
270580950126     C                   SETOFF                                       646566
270590950126     C                   SETOFF                                       676869
270600950126     C                   SETOFF                                       701090
270610950303     C                   SETOFF                                       553871
270620000120     C                   SETOFF                                       5257
270630010222     C                   CLEAR                   H1RIGA
270640010222     C                   CLEAR                   H1COLO
270650010214     C                   CLEAR                   H0RIGA
270660010214     C                   CLEAR                   H0COLO
270670071107     c****               if        dateu<§vpodrt
270680071107     C****               CLEAR                   ATRDRT
270690071107     c****               endif
270700010214     C                   CLEAR                   ATRPDR
270710010214     C                   CLEAR                   ATRCCM
270720010214     C                   CLEAR                   ATRFFD
270730010214     C                   CLEAR                   ATRFPP
270740010220     C                   CLEAR                   ATRLNA
270750010305     C                   CLEAR                   ATRNCL
270760010305     C                   CLEAR                   ATRPKG
270770100319     C                   CLEAR                   ATRTSP
270780950126     C                   ENDSR
270790950126     C*
270800950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE -------------*
270810950126     C     OFFD02        BEGSR
270820950126     C                   SETOFF                                       929399
270830950126     C                   SETOFF                                       414243
270840961111     C                   SETOFF                                       454686
270850950126     C                   SETOFF                                       474849
270860950126     C                   SETOFF                                       505152
270870950126     C                   SETOFF                                       535455
270880950126     C                   SETOFF                                       565759
270890950126     C                   SETOFF                                       606162
270900950126     C                   SETOFF                                       636465
270910950410     C                   SETOFF                                       586667
270920950410     C                   SETOFF                                       686970
270930950126     C                   SETOFF                                       717273
270940950126     C                   SETOFF                                       109040
270950950126     C                   SETOFF                                       808182
270960950126     C                   SETOFF                                       839784
270970961111     C                   SETOFF                                       747586
270980991117     C                   SETOFF                                       77
270990040610     c     atrbva        ifne      prri
271000040610     c                   movel     hiul          atrbva
271010040610     c                   endif
271020040216
271030040301     c                   Eval      wkk = *Off
271040021217
271050021218     c                   Clear                   H2riga
271060021218     c                   Clear                   H2colo
271070021217
271080950126     C                   ENDSR
271090950126     C*
271100950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE 3 VIDEATA-----*
271110950126     C     OFFD03        BEGSR
271120991025     C                   SETOFF                                       404142
271130991025     C                   SETOFF                                       434546
271140991025     C                   SETOFF                                       474849
271150991025     C                   SETOFF                                       505152
271160991025     C                   SETOFF                                       5390
271170040116     c                   Clear                   Atrsv2
271180040116     c                   Clear                   Atrsv3
271190040116     c                   Clear                   Atrsv4
271200041217     c                   Clear                   Atrsv5
271210041217     c                   Clear                   Atrsv6
271220950126     C                   ENDSR
271230950126     C*
271240950126     C* SE DISK CLIENTI CON "X" ESCO DAL PGM ED EMETTO NUOVA BOLLA----*
271250091111     C     ESCIER        BEGSR
271260950126     C*
271270161202     c                   if        §lpfpr<>'6'
271280161202     c*
271290091111     c* devo entrare se presente errore (90 on) oppure se devo per forza
271300091111     c* emettere una videata
271310020123     c     *in90         ifeq      *on
271320091111     c     wvidobb       oreq      '1'
271330020123     C     §LPFPR        IFEQ      'V'
271340950419     C     §LPFPR        OREQ      'X'
271350950126     C     *IN12         OREQ      *OFF
271360950126     C     *IN15         OREQ      *OFF
271370010305     C     §LPFPR        IFNE      'O'
271380950126     C  N12
271390950126     COR 12
271400950126     CANN15              CLEAR                   §LPFPR
271410070307     C                   ENDIF
271420950126     C*
271430950126     C                   ELSE
271440950126     C*
271450950126     C                   MOVEL     '5'           §LPFPR
271460950126     C                   ENDIF
271470020123     C                   ENDIF
271480161202     c
271490161202     c                   endif
271500161202     c
271510950126     C                   ENDSR
271520161202     c* ----------------------------------------------------------------------
271530950127     C* SE E' STATA BATTUTA UNA CHIAVE RICERCA
271540950127     C*          E NON E STATO IMMESSO CODICE-01 ON ABILITATA LA RICERC
271550950127     C     RICALF        BEGSR
271560950127    1C   01WCCM          IFEQ      0
271570950127     C     PAXDMT        ANDNE     *BLANKS
271580950127     C* DESCRIZIONE AZIENDA
271590950127     C                   MOVEL     VIDDSA        PAXDUT           30
271600950127     C* PAXSTA=9 ESCLUDO ANNULLATI
271610950127     C                   Z-ADD     9             PAXSTA
271620950127     C* CAPOCONTO CLIENTI
271630950127     C                   Z-ADD     KCI           PAXCCC
271640950127     C* CODICE DA RICERCARE: SE IMMESSA LNP CERCO SOLO AL SUO INTERNO
271650000207     C                   MOVEL(P)  WFLC          PAXFLR
271660980929     C                   CLEAR                   PAXDIT
271670000121     C                   Z-ADD     1             PAXNUM
271680950127     C*
271690000121     C                   CALL      'XALFA3BR'
271700950127     C                   PARM                    PAXDUT
271710950127     C                   PARM                    CODUT
271720950127     C                   PARM                    PAXDMT
271730950127     C                   PARM                    PAXCCC
271740950127     C                   PARM                    PAXSTA            1 0
271750961016     C                   PARM                    PAXFLR           90
271760980701     C                   PARM                    PAXDIT            3
271770000121     C                   PARM                    PAXNUM            2 0
271780000121     C                   PARM                    PAXKCM           80
271790000121     C                   PARM                    PAXKSM          140
271800000121     C                   PARM                    PAXKDM           60
271810950127     C*
271820950127     C                   MOVEL     '1'           WEMFOR
271830950127     C* NON TROVATO O PREMUTO CMD12
271840950127    2C     PAXSTA        IFGT      -1
271850950127     C* CODICE SELEZIONATO: IMPOSTO A VIDEO
271860000127     C                   MOVEL     PAXKSM        W0070             7 0
271870000127     C                   MOVE      W0070         WCCM
271880000127     C                   MOVEL     W0070         W0030
271890950127     C                   SETON                                        50
271900950127     C*
271910950127     C* SE LA LINEA DEL CODICE NON CORRISPONDE ALLA LINEA PARTENZA
271920960926     C*  IMPOSTO ANCHE IL PUNTO OPEATIVO CLIENTE
271930950127     C     W0030         IFNE      WLNP
271940950127     C                   MOVEL     W0030         WFLC
271950950127     C                   SETON                                        14
271960950127     C                   ENDIF
271970950127    2C                   ENDIF
271980950127    1C                   ENDIF
271990950127     C                   ENDSR
272000950104     C**************************************************************************
272010950104     C*  ABBLANCA ZERO NON SIGNIFICATIVI
272020950104     C**************************************************************************
272030950104     C     ABBL          BEGSR
272040950104     C*
272050950104     C     SKI(I)        DOWEQ     '0'
272060950717     C     I             ANDLT     15
272070950104     C                   MOVEL     ' '           SKI(I)
272080950104     C                   ADD       1             I
272090950717     C                   ENDDO
272100950104     C*
272110950104     C                   ENDSR
272120950717     C**************************************************************************
272130950717     C*  CONTROLLO SEGNACOLLO DOPPIO ALL'INTERNO DELLA STESSA BOLLA
272140950717     C**************************************************************************
272150950717     C     VADDOP        BEGSR
272160020917     C     KBLC          SETLL     FIVAD000
272170020917     C     KBLC          READE(N)  FIVAD000                               30
272180950717     C                   CLEAR                   WNCD
272190950717     C*
272200950717     C     *IN30         DOWEQ     *OFF
272210950717     C*
272220950717     C     WNCD          IFNE      BLDNCD
272230950717     C                   MOVEL     BLDNCD        WNCD
272240020917     C     KBLC          READE(N)  FIVAD000                               30
272250950717     C                   ELSE
272260950717     C                   SETON                                        629030
272270950717     C                   ENDIF
272280950717     C*
272290950717     C                   ENDDO
272300950717     C* PREPARO MESSAGGIO
272310950717     C     *IN90         IFEQ      *ON
272320950717     C                   MOVEA     ERR(120)      K78
272330950717     C                   MOVEL     WNCD          W007A
272340950717     C                   MOVEA     W007A         SKI(9)
272350950717     C                   Z-ADD     9             I                 3 0
272360950717     C                   EXSR      ABBL
272370950717     C                   MOVEA     SKI(9)        K78(37)
272380950717     C                   MOVEA     K78           VIDMSG
272390950717     C                   ENDIF
272400950717     C*
272410950717     C                   ENDSR
272420001031     C**
272430120302     C* STAMPA ETICHETTA ESTERA SDI O BRT ----------------------------*
272440971215     C     ETIEST        BEGSR
272450971215     C*
272460040506     c* entro in questa routine anche per la stampa dell'etichetta Ita
272470040506     c* lia se segnacollo export Euroexpress per impostare la nazione
272480040506     c* §defca viene impostato ma per il momento non utilizzato nel
272490040506     c* pgm di stampa
272500040506     c*
272510081008    1C***  WESTER        IFEQ      'S'
272520081008     c     §detse        ifeq      'EEX'
272530971215     C                   MOVEL     DESCOD        §DEISA
272540971215     C**
272550971215    3C                   SELECT
272560971215     C     FLGTB1        WHENEQ    'A'
272570971215     C     §3AFCA        ANDEQ     0
272580971215     C                   MOVEL     'A'           §DEFCA
272590971215     C     FLGTB1        WHENEQ    'A'
272600971215     C     §3AFCA        ANDNE     0
272610971215     C                   MOVEL     'X'           §DEFCA
272620971215     C     §3AFCA        WHENNE    0
272630971215     C                   MOVEL     'S'           §DEFCA
272640971215    3C                   ENDSL
272650971215    1C                   ENDIF
272660971215     C**
272670971215     C                   ENDSR
272680000901     C*****************************************************
272690000901     C* CALCOLA CIFRA DI CONTROLLO SECONDO IL MODULO 10 IBM
272700000901     C*****************************************************
272710000901     C     M10           BEGSR
272720000901     C                   MOVE      *ZERO         §TT               3 0
272730000906     C                   MOVE      *ZERO         §TT2              3 0
272740000901     C                   MOVE      *ZERO         §1                1 0
272750000901     C                   Z-ADD     18            §S                2 0
272760000901     C                   DO        17            §N                2 0
272770000901     C                   SUB       1             §S
272780000901     C* INTANTO SPOSTO DA UNA SCHIERA AL CAMPO COD.BARRE
272790000901     C                   MOVE      §C(§N)        §CB(§N)
272800000901     C     §N            DIV       2             §CTR              3 0
272810000901     C                   MVR                     §RST              3 030
272820000901     C     *IN(30)       IFEQ      '1'
272830000901     C     §C(§S)        MULT      2             §N2               2 0
272840000901     C                   MOVE      §N2           §A2               2
272850000901     C                   MOVEA     §A2           §2A
272860000901     C                   XFOOT     §2            §CTR
272870000901     C                   ELSE
272880000901     C                   Z-ADD     §C(§S)        §CTR
272890000901     C                   END
272900000901     C                   ADD       §CTR          §TT
272910000901     C                   END
272920000901     C*
272930000901     C     §TT           ADD       9             §TT2
272940000901     C                   MOVE      0             §TT2
272950000901     C     §TT2          SUB       §TT           §1
272960000901     C*
272970000901     C                   MOVE      §1            §CB(18)
272980000901     C                   ENDSR
272990000901     C**************************************************************************
273000020917     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIVAT
273010000901     C**************************************************************************
273020000901     C     CARVAT        BEGSR
273030000905     C* CAMPI SFL CONTROL
273040000912     C                   MOVE      §LPCCN        V8CKSC
273050000905     C                   Z-ADD     KCI           CCC
273060000905     C     KACO          CHAIN     CNACO000                           30
273070000905     C  N30              MOVEL     ACORAG        V8DKSC
273080000905     C   30              MOVEL     *BLANKS       V8DKSC
273090000905     C*
273100000901     C                   Z-ADD     0             NR8
273110000901     C                   MOVEL     'E'           WTRC
273120020917     C     KVAT          SETLL     FIVAT000
273130061010     C     KVAT          READE(N)  FIVAT000                               30
273140000901     C     *IN30         DOWEQ     *OFF
273150000901     C                   MOVEL     *BLANKS       V8CSCE
273160040302     c                   Eval      wtxt = VatNot
273170041117     c                   eval      uppercase = '1'
273180141202     c                   clear                   ElencoChar
273190160112     c                   clear                   TipoElenco
273200040302     c                   ExSr      Sr_Chk
273210040302     c                   Movel     wtxt          V8cNot
273220000908     C                   MOVE      *BLANKS       V8HDKC
273230000908     C                   MOVE      *BLANKS       V8HESG
273240000915     C                   MOVE      *ZEROS        V8HST2
273250000915     C                   CLEAR                   V8HFLS
273260000915     C                   CLEAR                   V8HLNA
273270000915     C                   CLEAR                   V8HNRS
273280000915     C                   CLEAR                   V8HNSC
273290000921     C                   CLEAR                   V8HPRE
273300000901     C* SCRIVO SUBFILE
273310040617     c* potrebbe succcedere che il cliente ci passi più di 500 record
273320040617     c* di vat ma sul vab il numero colli è inferiore a 500
273330040617     c* In questo caso ne carico al max 500
273340040617     c     nr8           ifeq      500
273350040617     c                   seton                                        30
273360040617     c                   else
273370000901     C                   ADD       1             NR8
273380000901     C                   WRITE     LS01S08
273390061010     C     KVAT          READE(N)  FIVAT000                               30
273400040617     c                   endif
273410000901     C                   ENDDO
273420000918     C                   Z-ADD     NR8           SAVNR8
273430000901     C*
273440000901     C                   ENDSR
273450050221     C**************************************************************************
273460050221     C*  CARICAMENTO numero parcel dpd
273470050221     C**************************************************************************
273480050221     C     sr_vatdpd     BEGSR
273490050221     C                   MOVEL     'E'           WTRC
273500050221     c                   clear                   werrvat           1
273510060612     c                   clear                   w014a
273520050221     C     KVAT          SETLL     FIVAT000
273530061010     C     KVAT          READE(N)  FIVAT000                               30
273540050221     C     *IN30         DOWEQ     *OFF
273550050221     c     werrvat       andeq     *blanks
273560060612     c     w014a         ifeq      *blanks
273570060612     c                   if        §ogntw = 'DPD'
273580060612     c                   movel     vatnot        dvate
273590060612     c                   movel     §VATEPRN      w014a
273600060612     c                   else
273610060612     c                   movel     vatnot        w014a
273620060612     c                   endif
273630050221     c                   else
273640050221     c                   eval      werrvat = '1'
273650050221     c                   endif
273660061010     C     KVAT          READE(N)  FIVAT000                               30
273670050221     c                   enddo
273680050221     c                   endsr
273690000901     C**************************************************************************
273700020917     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIVAB O FIVAD
273710000901     C**************************************************************************
273720000901     C     CARVAB        BEGSR
273730000901     C                   Z-ADD     0             NR8
273740000905     C* CAMPI SFL CONTROL
273750000912     C                   MOVE      §LPCCN        V8CKSC
273760000905     C                   Z-ADD     KCI           CCC
273770000905     C     KACO          CHAIN     CNACO000                           30
273780000905     C  N30              MOVEL     ACORAG        V8DKSC
273790000905     C   30              MOVEL     *BLANKS       V8DKSC
273800000901     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
273810000901     C                   CLEAR                   DSBLD7
273820000901     C                   MOVE      §LPLNP        §LCLNP
273830000901     C                   MOVE      §LPLNA        §LCLNA
273840000901     C                   MOVE      §LPNRS        §LCNRS
273850000901     C                   MOVE      §LPZNC        §LCZSC
273860020917     C* SEGNACOLLI SEQUENZIALI: CARICO CHI SONO DA FIVAB
273870000901    1C     §1BFG7        IFNE      'S'
273880000901     C                   MOVE      §LPNCD        §LCNCD
273890000901     C* Calcolo il check digit
273900000901     C                   EXSR      M10
273910000911     C                   MOVEA     §CA           V8CNOT
273920000901     C                   MOVEL     *BLANKS       V8CSCE
273930000908     C                   MOVE      *BLANKS       V8HDKC
273940000908     C                   MOVE      *BLANKS       V8HESG
273950000915     C                   MOVE      *ZEROS        V8HST2
273960000915     C                   CLEAR                   V8HFLS
273970000915     C                   CLEAR                   V8HLNA
273980000915     C                   CLEAR                   V8HNRS
273990000915     C                   CLEAR                   V8HNSC
274000000921     C                   CLEAR                   V8HPRE
274010000901     C                   ADD       1             NR8
274020000901     C                   WRITE     LS01S08
274030101217     c                   movel     v8cnot        chidal
274040000901    2C     §LPNCA        IFGT      *ZEROS
274050001016     C     §LPNCA        ANDNE     §LPNCD
274060101217     C                   MOVE      §LPNCA        §LCNCD
274070101217     C* Calcolo il check digit
274080101217     C                   EXSR      M10
274090101217     C                   MOVEA     §CA           V8CNOT
274100101217     C                   MOVEL     *BLANKS       V8CSCE
274110101217     C                   ADD       1             NR8
274120101217     C                   WRITE     LS01S08
274130101217     c                   movel     v8cnot        chial
274140101217     c     chidal        downe     chial
274150101216     C                   CLEAR                   DSLSZ1
274160101216     C                   MOVEL     'E'           IZ1MOD
274170101216     C                   MOVEL     CHIDAL        IZ1CH1
274180101216     C                   Z-ADD     V8CKSC        IZ1CCM
274190101216     C                   MOVEL     wctm          IZ1CTM
274200101216     C                   Z-ADD     §lpnrs        IZ1NRS
274210101216     C                   CALL      'FNLSZ1R'
274220101216     C                   PARM                    KPJBA
274230101216     C                   PARM                    DSLSZ1
274240101216     C                   PARM                    DS1B
274250101217     c     oz1chi        ifne      chial
274260101216     C                   MOVEL     OZ1CHI        V8CNOT
274270000901     C                   MOVEL     *BLANKS       V8CSCE
274280000901     C                   ADD       1             NR8
274290000901     C                   WRITE     LS01S08
274300000901    2C                   ENDIF
274310101217     c                   eval      chidal=oz1chi
274320101217     c                   enddo
274330101217     c                   endif
274340000918     C                   Z-ADD     NR8           SAVNR8
274350000901   X1C                   ELSE
274360020917     C* ALTRIMENTI LI CARICO DA FIVAD
274370020917     C     KBLC          SETLL     FIVAD000
274380020917     C     KBLC          READE     FIVAD000                               30
274390000904    2C     *IN30         DOWEQ     *OFF
274400000904    3C     BLDNCA        IFEQ      0
274410000904     C                   Z-ADD     BLDNCD        BLDNCA
274420000904    3C                   ENDIF
274430000904     C*
274440000904    3C     BLDNCD        DOWLE     BLDNCA
274450000904     C     BLDNCD        ANDGT     0
274460000904     C                   MOVE      BLDNCD        §LCNCD
274470000904     C* Calcolo il check digit
274480000904     C                   EXSR      M10
274490000911     C                   MOVEA     §CA           V8CNOT
274500000901     C                   MOVEL     *BLANKS       V8CSCE
274510000908     C                   MOVE      *BLANKS       V8HDKC
274520000908     C                   MOVE      *BLANKS       V8HESG
274530000915     C                   MOVE      *ZEROS        V8HST2
274540000915     C                   CLEAR                   V8HFLS
274550000915     C                   CLEAR                   V8HLNA
274560000915     C                   CLEAR                   V8HNRS
274570000915     C                   CLEAR                   V8HNSC
274580000921     C                   CLEAR                   V8HPRE
274590000901     C* SCRIVO SUBFILE
274600000901     C                   ADD       1             NR8
274610000901     C                   WRITE     LS01S08
274620000904     C                   ADD       1             BLDNCD
274630000904    3C                   ENDDO
274640020917     C     KBLC          READE     FIVAD000                               30
274650000904    2C                   ENDDO
274660000918     C                   Z-ADD     NR8           SAVNR8
274670000904     C*
274680000904    1C                   ENDIF
274690000901     C*
274700000901     C                   ENDSR
274710140506     C**************************************************************************
274720140506     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIART (dirottamenti)
274730140506     C**************************************************************************
274740140506     C     CARART        BEGSR
274750140506     C                   Z-ADD     0             NR8
274760140506     C* CAMPI SFL CONTROL
274770140506     C                   MOVE      §LPCCN        V8CKSC
274780140506     C                   Z-ADD     KCI           CCC
274790140506     C     KACO          CHAIN     CNACO000                           30
274800140506     C  N30              MOVEL     ACORAG        V8DKSC
274810140506     C   30              MOVEL     *BLANKS       V8DKSC
274820140506     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
274830140506     C                   CLEAR                   DSBLD7
274840140506     c     kbolm         chain     fnarb01l
274850140506     c                   if        %found(fnarb01l)
274860140710     C                   MOVE      arbfls        §LCLNP
274870140506     C                   MOVE      arbnrs        §LCNRS
274880140716     C                   MOVE      arbZNC        §LCZSC
274890140506     C                   MOVE      arbLNA        §LCLNA
274900140506     c                   endif
274910140506     C*
274920140506     C     Kbolm         SETLL     fiart01l
274930140506     C     kbolm         READE(n)  fiart01l
274940140506    2C                   DOW       not %eof(fiart01l)
274950140506     C*
274960140506     C                   MOVE      artnsc        §LCNCD
274970140716     c* Prendo zona dall'ultima spunta fatta. Se non trovo spunte
274980140716     c* tengo la zona della bolla
274990140716     c                   exsr      sr_zona
275000140716     c                   if        wokzona='1'
275010140716     C                   MOVE      wznbrv        §LCZSC
275020140716     c                   else
275030140716     C                   MOVE      arbZNC        §LCZSC
275040140716     c                   endif
275050140506     C* Calcolo il check digit
275060140506     C                   EXSR      M10
275070140506     C                   MOVEA     §CA           V8CNOT
275080140506     C                   MOVEL     *BLANKS       V8CSCE
275090140506     C                   MOVE      *BLANKS       V8HDKC
275100140506     C                   MOVE      *BLANKS       V8HESG
275110140506     C                   MOVE      *ZEROS        V8HST2
275120140506     C                   CLEAR                   V8HFLS
275130140506     C                   CLEAR                   V8HLNA
275140140506     C                   CLEAR                   V8HNRS
275150140506     C                   CLEAR                   V8HNSC
275160140506     C                   CLEAR                   V8HPRE
275170140506     C* SCRIVO SUBFILE
275180140506     C                   ADD       1             NR8
275190140506     C                   WRITE     LS01S08
275200140506     C     kbolm         READE(n)  fiart01l
275210140506    2C                   ENDDO
275220140506     C                   Z-ADD     NR8           SAVNR8
275230140506     C*
275240140506     C*
275250140506     C                   ENDSR
275260140716     C**************************************************************************
275270140716     C*  determinazinoe zona segnacollo da spunta
275280140716     C**************************************************************************
275290140716     C     sr_zona       BEGSR
275300140716     c
275310140716     c                   clear                   wznbrv
275320140716     c                   clear                   wokzona
275330140716     c     kbrv7z        setll     fnbrv07l
275340140716     c     kbrv7z        reade     fnbrv07l
275350140716     c                   dow       not %eof(fnbrv07l)
275360140716     c* scarto se categoria 8 o manca la data caricamento (spunta autogenerata)
275370140716     c                   if        brvnpg<>8 and brvdcs>0
275380140716     c                   if        wokzona=*blanks or
275390140716     c                             brvdfs>wdfs or
275400140716     c                             (brvdfs=wdfs and brvhms>whms)
275410140716     c                   z-add     brvznc        wznbrv
275420140716     c                   eval      wokzona='1'
275430140716     c                   z-add     brvdfs        wdfs
275440140716     c                   z-add     brvhms        whms
275450140716     c                   endif
275460140716     c                   endif
275470140716     c     kbrv7z        reade     fnbrv07l
275480140716     c                   enddo
275490140716     c                   endsr
275500000913     C**************************************************************************
275510051102     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIARS
275520000913     C**************************************************************************
275530051102     C     CARARS        BEGSR
275540000913     C* CAMPI SFL CONTROL
275550000913     C                   MOVE      WKSC          V8CKSC
275560000913     C                   Z-ADD     KCI           CCC
275570000913     C     KACO          CHAIN     CNACO000                           30
275580000913     C  N30              MOVEL     ACORAG        V8DKSC
275590000913     C   30              MOVEL     *BLANKS       V8DKSC
275600000913     C*
275610000913     C                   MOVEL     *BLANKS       V8CSCE
275620051102     C                   MOVEL     ARSNOT        V8CNOT
275630000913     C                   MOVE      *BLANKS       V8HDKC
275640000913     C                   MOVE      *BLANKS       V8HESG
275650000915     C                   MOVE      *ZEROS        V8HST2
275660051102     C                   Z-ADD     ARSFLS        V8HFLS
275670051102     C                   Z-ADD     ARSLNA        V8HLNA
275680051102     C                   Z-ADD     ARSNRS        V8HNRS
275690051102     C                   Z-ADD     ARSNSC        V8HNSC
275700000913     C* SCRIVO SUBFILE
275710000913     C                   ADD       1             NR8
275720000913     C                   WRITE     LS01S08
275730160302
275740160302     c                   if        a_§ogntw='FED'
275750160302     c                   eval      wtip=%subst(arsnot:1:2)
275760160302     c                   endif
275770000913     C*
275780000913     C                   ENDSR
275790031114      *------------------------------------------------------------------------*
275800031114      *  CARICAMENTO DATI DA FIVAT00F
275810031114      *------------------------------------------------------------------------*
275820031114     c     Sr_CarVat     BegSr
275830110818     c**
275840110818     c** N.B: l'elenco dei tipi record del fivat e le relative descrizioni
275850110818     c**      sono interrogabili sulla tabella "VAT"
275860110818     c**
275870031125     c                   Clear                   dVato
275880161019     c                   clear                   w_unoI
275890161019     c                   clear                   w_unoJ
275900031125
275910031114      * Leggo FIVAT00f
275920031114     c     kVat1         Setll     Fivat01l
275930031114     c                   Do        *Hival
275940061010     c     kVat1         Reade(N)  Fivat01l
275950031114     c                   If        %Eof(Fivat01l)
275960031114     c                   Leave
275970031114     c                   EndIf
275980031114      * Escludo i record "E"
275990031114     c                   If        VatTrc = 'E'
276000031114     c                   Iter
276010031114     c                   EndIf
276020040302
276030040302      * Controllo i dati inviati dal cliente, tranne il rcd 'O' xchè è tutto
276040040302      * numerico
276050141202      * per tipo record "Y"  - PIN CODE i controlli non li devo fare in
276060141202      * questo momento
276070141202     c                   If        VatTrc <> 'O' and
276080141202     c                             VatTrc <>'Y'
276090040302     c                   Eval      wtxt = VatNot
276100131003     c                   clear                   uppercase
276110141202     c                   clear                   ElencoChar
276120160112     c                   clear                   TipoElenco
276130040302     c                   ExSr      Sr_Chk
276140040302     c                   Movel     wtxt          VatNot
276150040302     c                   EndIf
276160031114      * Imposto i campi in base al tipo record
276170031114     c                   Select
276180031114      * Referente
276190031114     c                   When      VatTrc = 'A'
276200031114     c                   Eval      VidRef = VatNot
276210031114      * Telefono
276220031114     c                   When      VatTrc = 'B'
276230031114     c                   Eval      VidTel = VatNot
276240031125      * Bancali x particolarità varia 'O'
276250031125     c                   When      VatTrc = 'O'
276260031125     c                   Movel     VatNot        dVato
276270031219      * Riferimento partener estero
276280031219     c                   When      VatTrc = 'C'
276290031219     c                   Movel     VatNot        wrifp
276300110510      * E-mail al destinatario - indirizzo
276310161019     c                   When      VatTrc = 'I' and w_unoI=' '
276320161019     c                   eval      w_unoI='1'
276330150213     c*                  Clear                   atremd
276340150213     c*                  Clear                   atrwemd
276350110510     c                   Movel     VatNot        wemdest
276360161019     c                   When      VatTrc = 'J' and W_unoJ=' '
276370161019     c                   eval      w_unoJ='1'
276380150213     c*                  Clear                   atremd
276390150213     c*                  Clear                   atrwemd
276400110512     c                   if        wemdest<>*blanks
276410110512     c                   eval      wemdest=%trimr(wemdest) + vatnot
276420110512     c                   else
276430110512     c                   Movel     VatNot        wemdest
276440110512     c                   endif
276450110704      * codici CUP e CIG per tracciabilità flussi finanziari
276460110704     c                   when      VatTrc='4'
276470110704     c                   movel     vatnot        dvat4
276480120606     c                   exsr      impocupcig
276490120606     c***                eval      Wcupcup=§vat4cup
276500120606     c***                eval      Wcupcig=§vat4cig
276510130315     c* numero di telefono per invio sms
276520130918     c* flag per negare l'invio di mail per merce partita
276530130315     c                   when      VatTrc='S'
276540130315     c                   Movel     VatNot        dVats
276550130403     c                   eval      wsms=§vatstel
276560150213     c*                  if        wsms<>*blanks
276570150213     c*                  clear                   atremd
276580150213     c*                  clear                   atrwtel
276590150213     c*                  endif
276600130930     c                   clear                   wsmp
276610130930     c                   if        wsms<>*blanks and §vatssmp<>'N'
276620130930     c                   eval      wsmp='S'
276630130930     c                   endif
276640130918     c                   eval      wmmp=§vatsmmp
276650141031      * PIN CODE
276660141031     c                   when      VatTrc='Y'
276670141031     c                   Movel     VatNot        wPinCode
276680141202     c* memorizzo la lunghezza del PIN ricevuto dal cliente
276690141202     c                   eval      lenPC=%checkr(' ':vatnot)
276700031219      * Altri record non li carico
276710031219     c                   Other
276720031219     c                   Iter
276730031114
276740031114     c                   EndSl
276750031114
276760031114     c                   EndDo
276770150213
276780161102     c* se ho il numero di cell., se errato lo clearo
276790161102     c                   if        wsms<>*blanks
276800150216      /free
276810150216       pInCell = %trim(wsms);
276820161102       pInCellOpz = '2';
276830150216       pOutErr = *blanks;
276840161102      // Il numero deve essere normalizzato conservando eventuale "+"
276850161102      // davanti al prefisso
276860161102       if UBCHKCEL_Check(pInCell:pOutCell:pOutErr:pInCellOpz)
276870161102                                   < 0 OR pOutErr= 'E';
276880150216           // Numero di cellulare KO
276890150216           clear wsms;
276900150216       else;
276910161102           wsms=pOutCell;
276920150216       endif;
276930150216      /end-free
276940161102     c                   endif
276950161102     c* Se ho il numero di cellulare lo metto anche nel Tel.Dest. se manca
276960161102     c                   if        wsms<>*blanks and vidtel=*blanks
276970161102     c                   eval      vidtel=wsms
276980150213     c                   endif
276990160510     c* se ho l'indirizzo e-mail, se errato lo clearo
277000160510     c                   if        wemdest<>*blanks
277010160510     c                   exsr      sr_chkemd
277020160510      * Errore
277030161019if  3c                   If        §emlerro <> '0' and §EMLINDO=*blanks
277040160510     c                   clear                   wemdest
277050160510     c                   else
277060160510     c                   Eval      wemdest = §emlindo
277070160510     c                   endif
277080160510     c                   endif
277090160511     c                   eval      sav_wemdest=wemdest
277100160511     c                   eval      sav_wsms   =wsms
277110031114
277120031114     c                   EndSr
277130040302      *---------------------------------------------------------
277140040302      * Controllo i caratteri dei campi alfanumerici
277150040302      *---------------------------------------------------------
277160040302     c     Sr_Chk        BegSr
277170040302
277180040302     c                   Eval      TxtInOut = wtxt
277190040302     c                   Call      'XCHKCHAR'
277200040302     c                   Parm                    TxtInOut
277210040302     c                   Parm                    ElencoChar
277220040302     c                   Parm                    TipoElenco
277230040302     c                   Parm                    CharSost
277240040302     c                   Parm                    UpperCase
277250040302     c                   Parm                    ChkNull
277260040302     c                   Parm                    CharNull
277270040302     c                   Parm                    Esito
277280040302     c                   If        Esito = '1'
277290040302     c                   Move      TxtInOut      wtxt
277300040302     c                   EndIf
277310040302
277320040302     c                   EndSr
277330140110      *---------------------------------------------------------
277340140110      * Controllo caratteri di punteggiatura precedenti e seguenti
277350140110      *---------------------------------------------------------
277360140110     c     chkstringa    BegSr
277370140110
277380140110     c* trovo la prima posizione "buona" da utilizzare
277390160112     c                   eval      posl=%check(charnooki:wtxt)
277400140207     c* trovo l'ultima posizione "buona" da utilizzare (escludo il ".")
277410140207     c                   eval      posr=%checkr(charnookf:wtxt)
277420140207     c                   if        posl=0
277430140207     c                   clear                   wtxt
277440140207     c                   else
277450140110     c* determino la lunghezza della stringa "buona"
277460140110     c                   eval      lung=(posr-posl)+1
277470140207     c                   eval      wtxt=%subst(wtxt:posl:lung)
277480140110     c                   endif
277490140110
277500140110     c                   EndSr
277510120606      *---------------------------------------------------------
277520120606      * Verifica e impostazione CUP e  CIG ricevuti dal cliente
277530120606      *---------------------------------------------------------
277540120606     c     impocupcig    BegSr
277550120606     c                   clear                   wstringa
277560120606     c     '0':' '       xlate     §vat4cup      wstringa
277570120606     c                   if        wstringa<>*blanks
277580120606     c                   eval      Wcupcup=§vat4cup
277590120606     c                   endif
277600120606     c                   clear                   wstringa
277610120606     c     '0':' '       xlate     §vat4cig      wstringa
277620120606     c                   if        wstringa<>*blanks
277630120606     c                   eval      Wcupcig=§vat4cig
277640120606     c                   endif
277650120606     c                   EndSr
277660110512      *---------------------------------------------------------
277670110512      * Controllo indirizzo email destinatario
277680110512      *---------------------------------------------------------
277690110512     c     Sr_Chkemd     BegSr
277700110512     c                   Clear                   dsemail
277710110512     c                   Eval      §emlindi = wemdest
277720110512     c                   Call      'XEMAIL'
277730110512     c                   Parm                    dsemail
277740110512     c                   EndSr
277750031125      *------------------------------------------------------------------------*
277760031125      *  CONTROLLO CHE DATI TENERE PER I BANCALI
277770031125      *------------------------------------------------------------------------*
277780031125     c     Sr_CtrBancali BegSr
277790031125
277800031125     c                   Clear                   wgva
277810031125
277820031126     c                   Select
277830031126      * particolarità varia 'O'
277840031126w   1c                   When      %subst(VidGva:1:1) = 'O'
277850031126      * dati trovati in FIVAT rcd 'O'
277860031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
277870031126      * carico i dati del FIVAT
277880031126     c                   Clear                   VidTba
277890031126     c                   If        §VatoTba > *Zeros
277900031126     c                   Movel     §VatoTba      VidTba
277910031126     c                   EndIf
277920031126     c                   Eval      VidNba = §VatoNba
277930031126     c                   Eval      SavNba = §VatoNba
277940031126     c                   Clear                   VidTb2
277950031126     c                   If        §VatoTb2 > *Zeros
277960031126     c                   Movel     §VatoTb2      VidTb2
277970031126     c                   EndIf
277980031126     c                   Eval      VidNb2 = §VatoNb2
277990031126     c                   Eval      SavNba = §VatoNb2
278000031126     c                   Eval      w03Cor = §VatoCor
278010031126     c                   Eval      w03Csf = §VatoCsf
278020031126      * dati non trovati in FIVAT rcd 'O'
278030031126   x2c                   Else
278040031126      * pulisco i campi del video
278050031126     c                   Clear                   VidTba
278060031126     c                   Clear                   VidNba
278070031126     c                   Clear                   SavNba
278080031126     c                   Clear                   VidTb2
278090031126     c                   Clear                   VidNb2
278100031126     c                   Clear                   SavNba
278110031126    2c                   EndIf
278120031126
278130031126      * particolarità varia 'B'
278140031126w   1c                   When      %subst(VidGva:1:1) = 'B'
278150031126      * dati trovati in FIVAT rcd 'O'
278160031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
278170031126      * pulisco i dati del FIVAT
278180031126     c                   Clear                   dVato
278190031126    2c                   EndIf
278200031126
278210031126      * particolarità varia = ' '
278220031126w   1c                   When      %subst(VidGva:1:1) = ' '
278230031126      * dati trovati in FIVAT rcd 'O'
278240031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
278250031126      * carico i dati del FIVAT
278260031126     c                   Clear                   VidTba
278270031126     c                   If        §VatoTba > *Zeros
278280031126     c                   Movel     §VatoTba      VidTba
278290031126     c                   EndIf
278300031126     c                   Eval      VidNba = §VatoNba
278310031126     c                   Eval      SavNba = §VatoNba
278320031126     c                   Clear                   VidTb2
278330031126     c                   If        §VatoTb2 > *Zeros
278340031126     c                   Movel     §VatoTb2      VidTb2
278350031126     c                   EndIf
278360031126     c                   Eval      VidNb2 = §VatoNb2
278370031126     c                   Eval      SavNba = §VatoNb2
278380031126     c                   Eval      w03Cor = §VatoCor
278390031126     c                   Eval      w03Csf = §VatoCsf
278400031126      * imposto un flag per emettere un msg mirato in seconda videata
278410031126     c                   Eval      wgva = 'O'
278420031126      * dati non trovati in FIVAT rcd 'O'
278430031126   x2c                   Else
278440031126      * se ho i bancali
278450031126if  3c                   If        §LpNba > *Zeros or §LpNb2 > *Zeros
278460031126      * imposto un flag per emettere un msg mirato in seconda videata
278470031126     c                   Eval      wgva = 'B'
278480031126    3c                   EndIf
278490031126    2c                   EndIf
278500031126
278510031126   o1c                   other
278520031126      * dati trovati in FIVAT rcd 'O'
278530031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
278540031126      * pulisco i dati del FIVAT
278550031126     c                   Clear                   dVato
278560031126      * dati non trovati in FIVAT rcd 'O'
278570031126   x2c                   Else
278580031126      * pulisco i campi del video
278590031126     c                   Clear                   VidTba
278600031126     c                   Clear                   VidNba
278610031126     c                   Clear                   SavNba
278620031126     c                   Clear                   VidTb2
278630031126     c                   Clear                   VidNb2
278640031126     c                   Clear                   SavNba
278650031126    2c                   EndIf
278660031126
278670031126    1c                   EndSl
278680031125
278690031125     c                   EndSr
278700000904     C**************************************************************************
278710000904     C*  GESTIONE VIDEATA MANUTENZIONE COD. CHI SONO
278720000904     C**************************************************************************
278730000904     C     GESD08        BEGSR
278740000905     C  N90              Z-ADD     1             V8CNBR
278750000904     C                   CLEAR                   V8ZMSG
278760000905     C   90              MOVEL     W08MSG        V8ZMSG
278770000928     C* SE DSIK C EX DISK BI ACCENDO 33 PER DISABILITARE F9-AGGIUNTA
278780000928     C     §1BF12        IFEQ      'B'
278790000928     C                   SETON                                        33
278800000928     C                   ENDIF
278810000904     C* EMISSIONE VIDEATA
278820000904     C     EMD08         TAG
278830000904     C                   WRITE     LS01Z08
278840161129     c                   if        *in12 and not *in15
278850161129     C                   write     LS01C08
278860161129     C                   read(E)   fnls01d
278870161129     c                   else
278880161129     C                   EXFMT     LS01C08
278890161129     c                   endif
278900161129     c
278910000911     C                   SETOFF                                       6190
278920000904     C                   CLEAR                   V8ZMSG
278930161129     c
278940161129     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
278950161129     c                   if        %error
278960161129     C                   MOVEL     '6'           §LPFPR
278970161129     c                   leavesr
278980161129     c                   endif
278990161129     c
279000000904     C     *INKL         CABEQ     *ON           ENDD08
279010010504     C* CONTROLLO EVENTUALI RECORD ANNULLATI E LI TOLGO DALLA SCHIERA
279020010504     C* DI WORK
279030010504     C                   EXSR      CTRS8A
279040000904     C* F9=AGGIUNTA CODICI
279050000904     C     *INKI         IFEQ      *ON
279060000904     C                   EXSR      GESD09
279070161202     c
279080161202     c                   if        §lpfpr='6'
279090161202     c                   goto      endd08
279100161202     c                   endif
279110161202     c
279120000914     C     *INKL         CABEQ     *ON           ENDD08
279130000904     C                   ENDIF
279140010504     C* CONTROLLO DATI
279150010504     C                   EXSR      CTRS08
279160010504     C   90              MOVEL     W08MSG        V8ZMSG
279170010504     C  NKF
279180010504     COR 90              GOTO      EMD08
279190000904     C     ENDD08        ENDSR
279200000830     C**************************************************************************
279210000830     C*  GESTIONE VIDEATA INSERIMENTO COD. CHI SONO
279220000830     C**************************************************************************
279230000904     C     GESD09        BEGSR
279240000905     C* QUESTA ROUTINE POTREBBE ESSERE RICHIAMATA DURANTE LA MANUTENZIO
279250000905     C* NE DEL SUBFILE: IN QUESTO CASO DEVO MANTENERE IL POSIZIONAMENTO
279260000905     C* NEL SUBFILE CHE C'È GIA'
279270000904     C     V8CNBR        IFEQ      0
279280000830     C                   Z-ADD     1             V8CNBR
279290000904     C                   ENDIF
279300000918     C                   Z-ADD     SAVNR8        NR8
279310051121     c                   write     ls01d08
279320000904     C     EMD09         TAG
279330000830     C                   WRITE     LS01C08
279340000830     C                   EXFMT     LS01D09
279350161202     c
279360000904     C                   SETOFF                                       61
279370000921     C* SCRIVO SUBFILE (SE CHI SONO GIA' IMMESSO NON LO RICARICO E NON
279380000921     C* DO ERRORE)
279390000830     C     V9CNOT        IFNE      *BLANKS
279400000921     C     V9CNOT        LOOKUP    CH2                                    31
279410000921     C     *IN31         IFEQ      *OFF
279420000830     C                   ADD       1             NR8
279430000830     C                   Z-ADD     NR8           V8CNBR
279440000911     C                   MOVEL     V9CNOT        V8CNOT
279450000830     C                   CLEAR                   V8CSCE
279460000908     C                   CLEAR                   V8HDKC
279470000908     C                   CLEAR                   V8HESG
279480000915     C                   CLEAR                   V8HST2
279490000915     C                   CLEAR                   V8HFLS
279500000915     C                   CLEAR                   V8HLNA
279510000915     C                   CLEAR                   V8HNRS
279520000915     C                   CLEAR                   V8HNSC
279530000921     C                   CLEAR                   V8HPRE
279540000830     C                   WRITE     LS01S08
279550000921     C                   SETON                                        78
279560000921     C                   ADD       1             I2                3 0
279570000921     C                   MOVE      V9CNOT        CH2(I2)
279580000921     C                   ENDIF
279590000911     C                   CLEAR                   V9CNOT
279600000830     C                   ENDIF
279610000918     C                   Z-ADD     NR8           SAVNR8
279620000905     C* PER F6 ESCO DALLA VIDEATA DI IMMISSIONE "CHI SONO"
279630000914     C     *INKF         IFEQ      *OFF
279640000914     C     *INKL         ANDEQ     *OFF
279650000914     C                   GOTO      EMD09
279660000914     C                   ENDIF
279670000830     C                   ENDSR
279680000830     C**************************************************************************
279690000830     C*   CONTROLLO SUBFILE CHI SONO
279700000905     C**************************************************************************
279710000830     C     CTRS08        BEGSR
279720000830     C                   CLEAR                   CHI
279730000907     C                   CLEAR                   POS
279740021119     c                   Clear                   Prefisso
279750000830     C                   CLEAR                   W08MSG
279760000830     C                   Z-ADD     0             IX                4 0
279770000911    0C     *IN78         IFEQ      *ON
279780000830     C                   Z-ADD     1             NR8
279790000921     C                   SETOFF                                       9061
279800000830     C     NR8           CHAIN     LS01S08                            31
279810000831    1C     *IN31         DOWEQ     *OFF
279820000904     C* IGNORO CODICE SE ANNULLATO
279830000904   1AC     V8CSCE        IFEQ      ' '
279840000904     C* IL CODICE CHI SONO NON DEVE ESSERE RIPETUTO ALL'INTERNO
279850000904     C* DEL SUBFILE
279860000830     C     V8CNOT        LOOKUP    CHI                                    31
279870000831    2C     *IN31         IFEQ      *ON
279880000830     C* SE IL CODICE È DOPPIO ERRORE - ESCO DAL CICLO MEMORIZZANDO IL
279890000830     C* NRR IN ERRORE
279900000905     C                   Z-ADD     NR8           V8CNBR
279910000905     C                   SETON                                        9061
279920000911     C     WC01FG        IFEQ      'C'
279930000831     C                   MOVEL     ERR(205)      W08MSG
279940000911     C                   ELSE
279950000911     C                   MOVEA     ERR(205)      K78
279960000911     C                   MOVEA     *BLANKS       K78(44)
279970000911     C                   MOVEA     K78           W08MSG
279980000911     C                   ENDIF
279990000905     C                   UPDATE    LS01S08
280000000831     C                   GOTO      ENDS08
280010000831    2C                   ENDIF
280020021119      * Controllo prefisso chi sono
280030021119     c                   Movel     V8cNot        Wpre
280040080307     c     digits        check     v8cnot:3      wy
280050021119      * prefisso "FD" o "FM possibile solo per bolle FedEx
280060080307      * (se è seguito da 12 cifre)
280070021119     c                   If        (Wpre = 'FD' or Wpre = 'FM')
280080021119     c                              and A_§OgNtw <> 'FED' and
280090021119     c                                   VidDpd <> 'F'
280100080307     c                              and wy=15
280110021119     c                   Z-Add     Nr8           V8cNbr
280120021119     c                   Eval      *In90 = *On
280130021119     c                   Eval      *In61 = *On
280140021119     c                   Movel     Err(261)      W08Msg
280150021119     c                   Update    Ls01s08
280160021119     c                   GoTo      EndS08
280170021119     c                   EndIf
280180021119      * solo per bolle FedEx
280190021119If  2c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED')
280200021119     c                              and ix > 1
280210021119      * immesso prefisso "FM" o "FD"
280220021119      * tutti i segnacolli devono avere lo stesso prefisso
280230021119If  3c                   If        (Wpre = 'FD' or Wpre = 'FM')
280240021119     c     Wpre          Lookup    Prefisso                               30
280250021119      * Deve essere lo stesso prefisso già inserito
280260021119If  4c                   If        Not *In30
280270021119     c                   Z-Add     Nr8           V8cNbr
280280021119     c                   Eval      *In90 = *On
280290021119     c                   Eval      *In61 = *On
280300021119     c                   Movel     Err(260)      W08Msg
280310021119     c                   Update    Ls01s08
280320021119     c                   GoTo      EndS08
280330021119    4c                   EndIf
280340021119   x3c                   Else
280350021119      * immesso altro prefisso
280360021119      * non devono essere stati inseriti prefissi "FD" o "FM"
280370021119     c     'FD'          Lookup    Prefisso                               30
280380021119If  4c                   If        *In30
280390021119     c                   Z-Add     Nr8           V8cNbr
280400021119     c                   Eval      *In90 = *On
280410021119     c                   Eval      *In61 = *On
280420021119     c                   Movel     Err(260)      W08Msg
280430021119     c                   Update    Ls01s08
280440021119     c                   GoTo      EndS08
280450021119    4c                   EndIf
280460021119     c     'FM'          Lookup    Prefisso                               30
280470021119If  4c                   If        *In30
280480021119     c                   Z-Add     Nr8           V8cNbr
280490021119     c                   Eval      *In90 = *On
280500021119     c                   Eval      *In61 = *On
280510021119     c                   Movel     Err(260)      W08Msg
280520021119     c                   Update    Ls01s08
280530021119     c                   GoTo      EndS08
280540021119    4c                   EndIf
280550021119    3c                   EndIf
280560021119    2c                   EndIf
280570020308     c* Richiamo routine per controllare che cod. chi sono non sia
280580020308     c* doppio su fisgn e su blp (se segnacollo euroexpress)
280590020308     c                   eval      w8hcol = v8hcol
280600020308     c                   eval      w8cnot = v8cnot
280610020308     c                   eval      wnopos = ' '
280620020308     c                   exsr      ctrchidop
280630020308     c   90              goto      ends08
280640020308     C* SE NON C'È ERRORE MEMORIZZO IN SCHIERA
280650020308     C                   ADD       1             IX
280660020308     C                   MOVE      V8CNOT        CHI(IX)
280670020308     C                   Z-ADD     NR8           POS(IX)
280680021119      * Mi carico un Sk con solo il prefisso dei chi sono
280690021119     c                   Movel     Chi(ix)       Prefisso(ix)
280700000904   1AC                   ENDIF
280710000921     C                   UPDATE    LS01S08
280720000830     C                   ADD       1             NR8
280730000830     C  N90NR8           CHAIN     LS01S08                            31
280740000831    1C                   ENDDO
280750000911     C   31              SUB       1             NR8
280760000911    0C                   ENDIF
280770000907     C     IX            IFEQ      *ZEROS
280780000905     C                   SETON                                        90
280790000911     C     WC01FG        IFEQ      'C'
280800000905     C                   MOVEL     ERR(152)      W08MSG
280810000911     C                   ELSE
280820000911     C                   MOVEA     ERR(152)      K78
280830000911     C                   MOVEA     *BLANKS       K78(27)
280840000911     C                   MOVEA     K78           W08MSG
280850000911     C                   ENDIF
280860000911     C                   GOTO      ENDS08
280870000905     C                   ENDIF
280880000907     C* Richiamo pgm controllo Cod."CHI SONO"
280890010306     C* Se inseriti solo 2 codici E NUMERO COLLI A VIDEO > DI 2
280900000918     C* si potrebbe trattare di un dal/al
280910000907     C* e quindi richiamo pgm una volta sola passando entrambi i codici
280920000907    1C     IX            IFEQ      2
280930010306     C     V1CNCL        ANDGT     2
280940000907     C                   CLEAR                   DSLSZ1
280950000907     C                   MOVEL     'C'           IZ1MOD
280960000911     C                   MOVEL     WCTM          IZ1CTM
280970000907     C                   Z-ADD     V8CKSC        IZ1CCM
280980000907     C     §1BF12        IFEQ      'B'
280990000907     C                   Z-ADD     §LPNRS        IZ1NRS
281000000907     C                   ENDIF
281010000907     C                   MOVEL     CHI(1)        IZ1CH1
281020000907     C                   MOVEL     CHI(2)        IZ1CH2
281030000907     C                   CALL      'FNLSZ1R'
281040010402     C                   PARM                    KPJBA
281050000907     C                   PARM                    DSLSZ1
281060000907     C                   PARM                    DS1B
281070000907    2C     OZ1ERR        IFNE      ' '
281080000907    3C     OZ1ECH        IFEQ      '1'
281090000907     C                   Z-ADD     POS(1)        V8CNBR
281100000907   X3C                   ELSE
281110000907     C                   Z-ADD     POS(2)        V8CNBR
281120000907    3C                   ENDIF
281130000918     C     V8CNBR        CHAIN     LS01S08                            31
281140000907     C                   SETON                                        9061
281150000911     C     WC01FG        IFEQ      'C'
281160000907     C                   MOVEL     ERR(208)      W08MSG
281170000911     C                   ELSE
281180000911     C                   MOVEA     ERR(208)      K78
281190000911     C                   MOVEA     *BLANKS       K78(45)
281200000911     C                   MOVEA     K78           W08MSG
281210000911     C                   ENDIF
281220000907     C                   UPDATE    LS01S08
281230000911     C                   GOTO      ENDS08
281240000908     C                   ELSE
281250000908     C* SE NO ERRORE MEMORIZZO IL NUMERO DEI COLLI
281260000908     C                   Z-ADD     OZ1NCL        IX
281270020308    3c     oz1ncl        ifgt      2
281280020308     c                   movel     dslsz1        sav_dslsz1
281290020308     c* se numero dei colli > 2 si tratta di un dal/al
281300020308     c* devo quindi esplodere i codici per controllare che anche
281310020308     c* quelli all'interno del range non siano già presenti su fisgn
281320020308    4C     OZ1MAX        IFEQ      '2'
281330020308     C                   MOVEL     IZ1CH1        CHIDAL
281340020308     C                   MOVEL     IZ1CH2        CHIAL
281350020308   x4C                   ELSE
281360020308     C                   MOVEL     IZ1CH2        CHIDAL
281370020308     C                   MOVEL     IZ1CH1        CHIAL
281380020308    4C                   ENDIF
281390030214      * Prima di esplodere (per evitare giri inutili) controllo che il
281400030214      * n. dei cod. CHI SONO coincida con il n. dei colli immesso in
281410030214      * prima videata
281420030214If  4c                   If        Ix <> V1cNcl
281430030214     c                   Eval      *In90 = *On
281440030214If  5c                   If        Wc01Fg = 'C'
281450030214     c                   Eval      w08msg = Err(154)
281460030214   x5c                   Else
281470030214     c                   Movea     Err(154)      K78
281480030214     c                   Movea     *Blanks       K78(54)
281490030214     c                   Movea     K78           w08msg
281500030214    5c                   EndIf
281510030214     c                   GoTo      EndS08
281520030214    4c                   EndIf
281530020308    4C     CHIDAL        DOWNE     CHIAL
281540020308     C                   CLEAR                   DSLSZ1
281550020308     C                   MOVEL     'E'           IZ1MOD
281560020308     C                   MOVEL     CHIDAL        IZ1CH1
281570020308     C                   Z-ADD     V8CKSC        IZ1CCM
281580020308     C                   MOVEL     WCTM          IZ1CTM
281590020308     C     §1BF12        IFEQ      'B'
281600020308     C                   Z-ADD     §LPNRS        IZ1NRS
281610020308     C                   ENDIF
281620020308     C                   CALL      'FNLSZ1R'
281630020308     C                   PARM                    KPJBA
281640020308     C                   PARM                    DSLSZ1
281650020308     C                   PARM                    DS1B
281660020308    5C     OZ1CHI        IFNE      CHIAL
281670020308     c                   clear                   w8hcol
281680020308     c                   movel     '1'           wnopos
281690020308     c                   eval      w8cnot = oz1chi
281700020308     c                   exsr      ctrchidop
281710020308     c   90              movel     sav_dslsz1    dslsz1
281720020308     c   90              goto      ends08
281730020308    5c                   endif
281740020308     C                   MOVEL     OZ1CHI        CHIDAL
281750020308    4C                   ENDDO
281760020308     c                   movel     sav_dslsz1    dslsz1
281770020308    3c                   endif
281780000907    2C                   ENDIF
281790000907   X1C                   ELSE
281800010306     C* Se codici inseriti diverso da 2 O NUMERO COLLI <= 2
281810000918     C* li controllo una alla volta
281820001031     C                   Z-ADD     1             II                4 0
281830000907    2C     II            DOWLE     IX
281840000907     C                   CLEAR                   DSLSZ1
281850000907     C                   MOVEL     'C'           IZ1MOD
281860000911     C                   MOVEL     WCTM          IZ1CTM
281870000907     C                   Z-ADD     V8CKSC        IZ1CCM
281880000907     C     §1BF12        IFEQ      'B'
281890000907     C                   Z-ADD     §LPNRS        IZ1NRS
281900000907     C                   ENDIF
281910000907     C                   MOVEL     CHI(II)       IZ1CH1
281920000907     C                   CALL      'FNLSZ1R'
281930010402     C                   PARM                    KPJBA
281940000907     C                   PARM                    DSLSZ1
281950000907     C                   PARM                    DS1B
281960000907    3C     OZ1ERR        IFNE      ' '
281970000907     C                   Z-ADD     POS(II)       V8CNBR
281980000918     C     V8CNBR        CHAIN     LS01S08                            31
281990000907     C                   SETON                                        9061
282000000911     C     WC01FG        IFEQ      'C'
282010000907     C                   MOVEL     ERR(208)      W08MSG
282020000911     C                   ELSE
282030000911     C                   MOVEA     ERR(208)      K78
282040000911     C                   MOVEA     *BLANKS       K78(45)
282050000911     C                   MOVEA     K78           W08MSG
282060000911     C                   ENDIF
282070000907     C                   UPDATE    LS01S08
282080000911     C                   GOTO      ENDS08
282090000907    3C                   ENDIF
282100000911     C                   ADD       1             II
282110000907    2C                   ENDDO
282120000907    1C                   ENDIF
282130000908     c* Controllo che numero cod.chi sono corrisponda con numero colli
282140000908     c* in prima videata
282150000908     C     IX            IFNE      V1CNCL
282160000908     C                   SETON                                        90
282170000911     C     WC01FG        IFEQ      'C'
282180000908     C                   MOVEL     ERR(154)      W08MSG
282190000911     C                   ELSE
282200000911     C                   MOVEA     ERR(154)      K78
282210000911     C                   MOVEA     *BLANKS       K78(54)
282220000911     C                   MOVEA     K78           W08MSG
282230000911     C                   ENDIF
282240000908     C                   ENDIF
282250000911     C     ENDS08        TAG
282260000911     C                   MOVE      *BLANKS       WC01FG
282270000911     C                   ENDSR
282280020308     C**************************************************************************
282290020308     C*   Controllo se cod. chi sono già esistente
282300020308     C**************************************************************************
282310020308     C     CTRCHIDOP     BEGSR
282320020308     C* Se segnac. EUROEX controllo che non sia doppio in altra bolla
282330040505    1c     §ogntw        ifeq      'EEX'
282340020308     C     W8HCOL        ANDEQ     *ZEROS
282350020308     C                   MOVEL     'E'           WTRC
282360170131     C     KARS2         SETLL     FIARS03L                               31
282370020308    2C     *IN31         IFEQ      *ON
282380020308    3c     wnopos        ifeq      *blanks
282390020308     C                   Z-ADD     NR8           V8CNBR
282400020308     c                   seton                                        61
282410020308    3c                   endif
282420020308     C                   SETON                                        90
282430020308     C                   MOVEA     ERR(155)      K78
282440020308     C                   MOVEL     w8CNOT        W030A            30
282450020308     C                   MOVEA     W030A         K78(18)
282460020308     C                   MOVEA     K78           W08MSG
282470020308    3c     wnopos        ifeq      *blanks
282480020308     C                   UPDATE    LS01S08
282490020308    3c                   endif
282500020308     C                   GOTO      ENDCDOP
282510020308    2C                   ENDIF
282520020308    1C                   ENDIF
282530020308     C* MSG FORZABILE SE CHI SONO GIA' PRESENTE SU FISGN
282540020308     C* (SOLO SE RECORD E' DI NUOVA IMMISSIONE)
282550020308     C* 02/05/01: RENDO ERRORE BLOCCANTE SU RICHIESTA DELLA LORENA
282560020308    1C     W8HCOL        IFEQ      *ZEROS
282570020308     C     KSGN88        CHAIN(N)  FISGN01L                           31
282580020308    2C     *IN31         IFEQ      *OFF
282590020308     C     SGNATB        ANDNE     '*'
282600020308    3c     wnopos        ifeq      *blanks
282610020308     C                   Z-ADD     NR8           V8CNBR
282620020308     c                   seton                                        61
282630020308    3c                   endif
282640020308     C                   SETON                                        90
282650020308     c                   eval      w08msg = %trim(err(209)) + ' '
282660020308     c                             + %trim(w8cnot)
282670020308     c                             + ' presente in altra bolla'
282680020308    3c     wnopos        ifeq      *blanks
282690020308     C                   UPDATE    LS01S08
282700020308    3c                   endif
282710020308     C                   GOTO      ENDCDOP
282720020308    2C                   ENDIF
282730020308    1C                   ENDIF
282740020308     c     ENDCDOP       endsr
282750010504     C**************************************************************************
282760010504     C*   ELIMINAZIONE CHI SONO ANNULLATI DA SUBFILE
282770010504     C**************************************************************************
282780010504     C     CTRS8A        BEGSR
282790010504    0C     *IN78         IFEQ      *ON
282800010504     C                   Z-ADD     1             NR8
282810010504     C     NR8           CHAIN     LS01S08                            31
282820010504    1C     *IN31         DOWEQ     *OFF
282830010504     C* SE RECORD ANNULLATO DEVO TOGLIERLO DA CH2
282840010504     C     V8CSCE        IFEQ      'A'
282850010504     C                   Z-ADD     1             WK                3 0
282860010504     C     V8CNOT        LOOKUP    CH2(WK)                                31
282870010504     C   31              MOVE      *BLANKS       CH2(WK)
282880010504     C                   UPDATE    LS01S08
282890010504     C                   ENDIF
282900010504     C                   ADD       1             NR8
282910010504     C  N90NR8           CHAIN     LS01S08                            31
282920010504    1C                   ENDDO
282930010504     C   31              SUB       1             NR8
282940010504    0C                   ENDIF
282950010504     C                   ENDSR
282960000912     C**************************************************************************
282970000912     C*   AGGIORNAMENTO FILE FISGN00F
282980000912     C**************************************************************************
282990000912     C     UPDSGN        BEGSR
283000000921     C* QUESTO CAMPO NON CREDO CHE SIA UTILIZZATO ADOGNI MODI MI SEMBRA
283010000921     C* GIUSTO IN QUESTO CASO ABBLENCARLO
283020000921     C     SGNATB        IFEQ      '*'
283030000921     C                   CLEAR                   SGNSQU
283040000921     C                   ENDIF
283050000921     C*
283060000919     C                   CLEAR                   SGNATB
283070000921     C                   Z-ADD     §3ISEA        SGNSEA
283080000921     C                   MOVEL     'S'           SGNST1
283090160226     c* disk "C" no dpd
283100160226     c                   if        (§1bf12<>'N' and wexdpd<>'S' and *in79=*off)
283110160226     c                             or
283120160226     c* disk "C" export dpd con numero parcel automatico (da §1bf13 o instradame
283130160226     c* nto forzato a dpd oppure numero parcel lungo 12 che uso come disk "C" ma
283140160226     c* assegno parcel dpd automatico
283150160226     c                             (§1bf12<>'N' and wexdpd='S' and
283160160226     c                              (§1bf13='A' or w_adpd='S' or wparcel='12'))
283170160226     c                             or
283180160226     c* Disk "B" che diventa "C" export DPD anche se parcel non automatico
283190160226     c                             (§1bf12='B' and wexdpd='S')
283200090624      *
283210000925     C                   Z-ADD     V8HST2        SGNST2
283220000925     C                   ENDIF
283230000921     C                   MOVE      '0'           SGNFL1
283240000912     C     BLPCCM        IFGT      0
283250000912     C                   MOVEL     BLPCCM        SGNKSC
283260000912     C                   ELSE
283270000912     C                   MOVEL     BLPKSC        SGNKSC
283280000912     C                   ENDIF
283290000921     C                   Z-ADD     BLPLNP        SGNLNP
283300000921     C                   Z-ADD     BLPNSP        SGNNSP
283310010116     C                   CLEAR                   SGNT6A
283320010116     C                   CLEAR                   SGNT6B
283330010116     C                   CLEAR                   SGNT6C
283340010116     C                   CLEAR                   SGNT6D
283350010116     C                   CLEAR                   SGNT6E
283360010116     C                   CLEAR                   SGNT6F
283370080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
283380000922     C                   CLEAR                   SGNRST
283390001005     C     WSGNR         IFEQ      'B'
283400001005     C                   UPDATE    FISGN005
283410001005     C                   ELSE
283420000912     C                   UPDATE    FISGN000
283430150701     c                   exsr      sr_CalSgn
283440001005     C                   ENDIF
283450000912     C                   ENDSR
283460000929     C**************************************************************************
283470000929     C*   SCRITTURA     FILE FISGN00F
283480000929     C**************************************************************************
283490000929     C     WRTSGN        BEGSR
283500000929     C                   CLEAR                   SGNATB
283510000929     C                   MOVEL(P)  V8CNOT        SGNWHO
283520000929     C                   Z-ADD     §3ISEA        SGNSEA
283530000929     C                   MOVEL     'S'           SGNST1
283540001002     C     WSGNR         IFEQ      *BLANKS
283550000929     C                   CLEAR                   SGNST2
283560001002     C                   ELSE
283570001002     C                   Z-ADD     1             SGNST2
283580010405     C* SGNFL2 = N SIGNIFICA CHE SI TRATTA DI FISGN SCRITTO PER SOLA
283590010405     C* RISTAMPA --> NON E' UN REALE DISK C
283600010405     C                   MOVEL     'N'           SGNFL2
283610001002     C                   ENDIF
283620000929     C                   MOVE      '0'           SGNFL1
283630000929     C                   MOVEL     BLPLNP        SGNLNP
283640000929     C                   MOVEL     BLPNSP        SGNNSP
283650000929     C     BLPCCM        IFGT      0
283660000929     C                   MOVEL     BLPCCM        SGNKSC
283670000929     C                   ELSE
283680000929     C                   MOVEL     BLPKSC        SGNKSC
283690000929    4C                   ENDIF
283700010116     C                   CLEAR                   SGNT6A
283710010116     C                   CLEAR                   SGNT6B
283720010116     C                   CLEAR                   SGNT6C
283730010116     C                   CLEAR                   SGNT6D
283740010116     C                   CLEAR                   SGNT6E
283750010116     C                   CLEAR                   SGNT6F
283760080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
283770000929     C                   CLEAR                   SGNRST
283780010116     C                   Z-ADD     COMTFP        SGNTNP
283790001005     C     WSGNR         IFEQ      'B'
283800001005     C                   WRITE     FISGN005
283810001005     C                   ELSE
283820001005     C                   WRITE     FISGN000
283830001005     C                   ENDIF
283840001005     C*
283850000929     C                   ENDSR
283860010209     C**************************************************************************
283870010209     C*   VERIFICO SE ATTIVATA PROCEDURA O.R.M.
283880011121     C**************************************************************************
283890010209     C     ATTORM        BEGSR
283900010209     C                   MOVE      *BLANKS       WORM              1
283910010220     C   12
283920010220     CAN 15VIDPOE        IFGT      *ZEROS
283930010209     C                   MOVEL     'S'           WORM
283940010209     C                   ENDIF
283950010305     C     §LPFPR        IFNE      'O'
283960010215     C     *IN12         IFEQ      *OFF
283970010215     C     *IN15         OREQ      *OFF
283980010219     C                   MOVE      WLNPO         W0030
283990010215     C     W0030         CHAIN     AZORG01L      UNIORG               30
284000010209     C  N30              MOVEL     ORGDE8        OG148
284010010209     C   30              CLEAR                   OG148
284020060926     c                   eval      §ogorm='S'
284030010209     C     §OGORM        IFEQ      'S'
284040010209     C                   MOVEL     'S'           WORM
284050010209     C                   ENDIF
284060010215     C                   ENDIF
284070010305     C                   ELSE
284080010301     C                   MOVEL     'S'           WORM
284090010301     C                   ENDIF
284100010209     C* IMPOSTO INDICATORI PER NON VISUALIZZARE KEY ORM SE P.O. NON
284110010209     C* ABILITATO
284120010209     C     WORM          IFEQ      *BLANKS
284130010223     C                   SETOFF                                       37
284140010209     C                   MOVEL     NDPR          ATRPOE
284150010215     C                   MOVEL     NDPR          ATRORM
284160010219     C                   MOVEL     NODI          ATRDOR
284170010209     C                   CLEAR                   VIDPOE
284180010209     C                   CLEAR                   VIDNOR
284190010209     C                   CLEAR                   VIDNRV
284200010209     C* Campi della videata di personalizzazione
284210010209     C                   MOVEL     NDPR          AT0POE
284220010215     C                   MOVEL     NDPR          AT0ORM
284230010219     C                   MOVEL     NODI          AT0DOR
284240010209     C                   CLEAR                   V0CPOE
284250010209     C                   CLEAR                   V0CNOR
284260010209     C                   CLEAR                   V0CNRV
284270010222     C* Questa routine viene richiamata anche in immissione bolle
284280010222     C* tutte le volte che variano la linea di partenza.
284290010222     C* Se si passa da lnp attivata a proc. ORM ad una NON attivata
284300010222     C* bisogna spegnere indicatore 06 di posiz. cursore su N. ORM
284310010222     C* se è acceso e al suo posto bisogna accendere lo 07
284320010222     C  N12*IN06         IFEQ      *ON
284330010222     C                   SETOFF                                       06
284340010222     C                   SETON                                        07
284350010222     C                   ENDIF
284360010209     C                   ELSE
284370010209     C* PROCEDURA ORM ATTIVA
284380010409     C* Chaino tabella DFT per prendere il massimo peso in KG per la
284390010409     C* richiesta note obbligatoria
284400010409     C* Provo prima con key = p.o. ritiro
284410010409     c* Se record non trovato chaino record 999
284420010409     C                   CLEAR                   WTRDFT
284430010409     C                   CLEAR                   DSBS02
284440010409     C                   MOVEL     'C'           T02MOD
284450010409     C                   MOVEL     KNSIF         T02SIF
284460010409     C                   MOVEL     'DFT'         T02COD
284470010409     C                   MOVEL(P)  WLNPO         T02KE1
284480010409     C     WTRDFT        DOWEQ     *BLANKS
284490010409      *
284500010409     C                   CALL      'TIBS02R'
284510010409     C                   PARM                    KPJBA
284520010409     C                   PARM                    DSBS02
284530010409      *
284540010409     C     T02ERR        IFEQ      *BLANKS
284550010409     C     T02KE1        OREQ      '999'
284560010409     C                   MOVEL     '1'           WTRDFT            1
284570010409     C     T02ERR        IFEQ      *BLANKS
284580010409     C                   MOVEL     T02UNI        DDFT
284590010409     C                   ELSE
284600010409     C                   CLEAR                   DDFT
284610010409     C                   ENDIF
284620010409     C                   ELSE
284630010409     C                   MOVEL     '999'         T02KE1
284640010409     C                   CLEAR                   T02ERR
284650010409     C                   ENDIF
284660010409     C                   ENDDO
284670010409     C*
284680010209     C                   CLEAR                   ATRPOE
284690010215     C                   CLEAR                   ATRORM
284700010219     C                   CLEAR                   ATRDOR
284710010209     C* Campi della videata di personalizzazione
284720010209     C                   CLEAR                   AT0POE
284730010215     C                   CLEAR                   AT0ORM
284740010219     C                   CLEAR                   AT0DOR
284750010209     C* IN IMMISSIONE PREPAGATI  MIEI KEY ORM = ND + PR
284760010220     C     PARTCH        IFEQ      'P'
284770010220     C                   MOVEL     NDPR          ATRPOE
284780010220     C                   MOVEL     NDPR          ATRORM
284790010220     C                   MOVEL     NODI          ATRDOR
284800010220     C                   MOVEL     NDPR          AT0POE
284810010220     C                   MOVEL     NDPR          AT0ORM
284820010220     C                   MOVEL     NODI          AT0DOR
284830010220     C                   ENDIF
284840010209     C* IN IMMISSIONE PREPAG.NON MIEI KEY ORM =      PR
284850010301     C     §LPFPR        IFEQ      'O'
284860010209     C* IN CONFERMA                   KEY ORM =      PR
284870010301     C     *IN12         OREQ      *ON
284880010301     C     *IN15         ANDEQ     *ON
284890010301     C                   MOVEL     PROT          ATRPOE
284900010301     C                   MOVEL     PROT          ATRORM
284910010301     C                   ENDIF
284920010213     C*
284930010213     C* INIZIALIZZO ANCHE CAMPI DI CMODO CHE MI SERVONO NELLA ROUTINE
284940010213     C* DEI CONTROLLI SE PROCEDURA ORM ATTIVATA
284950010220     C     *IN12         IFEQ      *OFF
284960010301     C     §LPFPR        ANDNE     'O'
284970010213     C                   CLEAR                   PREDRT
284980010214     C                   CLEAR                   PREPDR
284990010214     C                   CLEAR                   PREFPP
285000010214     C                   CLEAR                   PRECCM
285010010214     C                   CLEAR                   PREFFD
285020010222     C* Questa routine viene richiamata anche in immissione bolle
285030010222     C* tutte le volte che variano la linea di partenza.
285040010222     C* Se si passa da lnp non attivata a proc. ORM ad una attivata
285050010222     C* bisogna spegnere indicatore 07 di posiz. cursore su cod mitt
285060010222     C* se è acceso e al suo posto bisogna accendere lo 06
285070010222     C     *IN07         IFEQ      *ON
285080010222     C                   SETOFF                                       07
285090010222     C                   SETON                                        06
285100010222     C                   ENDIF
285110010220     C                   ENDIF
285120010215     C                   CLEAR                   WORMMD
285130010220     C                   CLEAR                   WPRIMV
285140040319     c                   Eval      wmodorm = *Off
285150010222     C* SE SONO IN MANUTENZIONE DEVO POSIZIONARE IL CURSORE SUL
285160010222     C* NUMERO ORM
285170010222     C     *IN12         IFEQ      *ON
285180010222     C     *IN15         ANDEQ     *OFF
285190040323      * ma se bolla di recupero o bolla 'FW' devo proteggere il n. ORM
285200040323if  3c                   If        §3arbl = 'R' or vidcbo = 'FW'
285210040323     c                   Movel     prot          atrpoe
285220040323     c                   Movel     prot          atrorm
285230040324     c                   Eval      *In06 = *Off
285240040323     c                   GoTo      Endattorm
285250040323e   3c                   EndIf
285260040323      * o se bolla legata devo proteggere il n. ORM
285270040323     c     kBlp3         Setll     Fnlbl01l
285280040323if  3c                   If        %Equal(Fnlbl01l)
285290040323     c                   Movel     prot          atrpoe
285300040323     c                   Movel     prot          atrorm
285310040324     c                   Eval      *In06 = *Off
285320040323     c                   GoTo      Endattorm
285330040323    3c                   EndIf
285340010222     C                   SETOFF                                       07
285350010222     C                   SETON                                        06
285360010222     C                   ENDIF
285370010209     C                   ENDIF
285380011121     C*
285390040323     C     endattorm     ENDSR
285400010228     C**************************************************************************
285410010228     C*   RIEMPIMENTO CAMPI DI PASSAGGIO A PGM FIOR05R
285420010228     C**************************************************************************
285430010228     C     RIEO05        BEGSR
285440010228     C                   CLEAR                   DSOR05
285450010228     C*
285460010228     C                   MOVEL     '2'           §RMTLA
285470010228     C                   MOVEL     'B'           §RMFPR
285480010228     C                   Z-ADD     VIDLNP        §RMPOE
285490010228     C                   Z-ADD     VIDLNP        §RMPOR
285500010228     C                   MOVEL     'P'           §RMTOR
285510010228     C                   MOVEL     'P'           §RMTCO
285520010305     C                   Z-ADD     VIDCCM        W0070             7 0
285530010228     C     VIDFLC        IFEQ      0
285540010228     C                   MOVEL     VIDLNP        W0070
285550010228     C                   ELSE
285560010228     C                   MOVEL     VIDFLC        W0070
285570010228     C                   ENDIF
285580010228     C                   CLEAR                   §RMCRA
285590010228     C     VIDCCM        IFNE      8888
285600010228     C                   MOVEL     W0070         §RMCRA
285610010228     C                   ENDIF
285620010228     C                   MOVEL     VIDRSM        §RMRSR
285630010228     C                   MOVEL     VIDINM        §RMINR
285640010228     C                   MOVEL     VIDCAM        §RMCAR
285650010228     C                   MOVEL     VIDLOM        §RMLOR
285660010228     C                   MOVEL     VIDPRM        §RMPRR
285670010228     C                   MOVEL     VIDNZM        §RMNAR
285680010228     C                   MOVEL     VIDRSD        §RMRSC
285690010228     C                   MOVEL     VIDIND        §RMINC
285700010228     C                   MOVEL     VIDCAD        §RMCAC
285710010228     C                   MOVEL     VIDLOD        §RMLOC
285720010228     C                   MOVEL     VIDPRD        §RMPRC
285730010228     C                   MOVEL     VIDNZD        §RMNAC
285740010228     C     VIDFFD        IFEQ      'N'
285750010228     C                   MOVEL     *BLANKS       §RMFFD
285760010228     C                   ELSE
285770010228     C                   MOVEL     VIDFFD        §RMFFD
285780010228     C                   ENDIF
285790010228     C                   MOVEL     VIDNAS        §RMNAM
285800010228     C                   Z-ADD     VIDNCL        §RMNCL
285810010228     C                   Z-ADD     VIDPKG        §RMPKG
285820010228     C                   Z-ADD     VIDVOL        §RMVLM
285830010228     C                   MOVEL     'M'           §RMPAG
285840010228     C                   MOVEL     VIDNT1        §RMNO1
285850010228     C                   MOVEL     VIDNT2        §RMNO2
285860010228     C                   MOVEL     VIDRMA        §RMRFA
285870160216     C                   z-add     comlna        §RMPOC
285880010228     C                   ENDSR
285890011212     C**************************************************************************
285900011212     C*   RICHIAMO PGM DI UTILITA' PER EDITARE CAMPO NUMERICO
285910011212     C**************************************************************************
285920011212     C     CALLXE        BEGSR
285930011212     C                   CLEAR                   DSEDIT
285940011212     C                   CLEAR                   W014A
285950011212     C                   MOVE      WNUMED        IEDNUM
285960011212     C                   Z-ADD     3             IEDNRD
285970011212     C                   MOVE      '4'           IEDEDT
285980011212     C                   Z-ADD     14            IEDLEN
285990011212     C                   CALL      'XEDIT'
286000011212     C                   PARM                    DSEDIT
286010011212     C     OEDFLG        IFEQ      *OFF
286020011212     C                   MOVEL     OEDNUM        W014A            14
286030011212     C                   ENDIF
286040011212     C                   ENDSR
286050020212     C**************************************************************************
286060020212     C*   Calcolo check digit AWB FEDEX
286070020212     C**************************************************************************
286080020212     C     CHKDGF        BEGSR
286090020212      * Il check digit del codice a barre di FedEx va colcolato moltiplicando
286100020212      * il numero del codice a barre (partendo dall'undicesimo e andando a
286110020212      * a ritroso) per un valore alternato (1 - 3 - 7) e sommati tra loro, il
286120020212      * totale va diviso per 11 e il resto è i check digit
286130020212      * se il resto è 10 o 0 il check digit deve essere 0
286140020212      * Esempio:
286150020212      * codice a barre 0 1  2 3 4  5  6 7  8  9 8
286160020212      * valore         3 1  7 3 1  7  3 1  7  3 1
286170020212      * totale         0 1 14 9 4 35 18 7 56 27 8 = 179
286180020212      * check digit    179 / 11 = 16 resto 3
286190020212     c                   move      w0012a        fedexbrc
286200020214     c                   clear                   totale
286210020212
286220020212      * Carico 1 - 3 - 7 in una schiera di comodo 'base'
286230020212
286240020212     c                   eval      base(1) = 1
286250020212     c                   eval      base(2) = 3
286260020212     c                   eval      base(3) = 7
286270020212
286280020212     c                   eval      zw = 0
286290020212
286300020212      * parto dall'undicesimo numero
286310020212     c     11            do        11            xw
286320020212      * andando all'indietro il contatore arriva a 0 e devo uscire dal ciclo
286330020212     c                   if        xw = 0
286340020212     c                   leave
286350020212     c                   endif
286360020212     c                   eval      zw = zw + 1
286370020212     c                   eval      totale = totale + (fbrc(xw) * base(zw))
286380020212
286390020212     c                   if        zw = 3
286400020212     c                   eval      zw = 0
286410020212     c                   endif
286420020212      * torno indietro
286430020212     c                   enddo     -1
286440020212
286450020212     c     totale        div       11            intero
286460020212     c                   mvr                     restof
286470020212
286480020212     c                   if        restof = 0 or restof = 10
286490020212     c                   move      '0'           fchd
286500020212     c                   else
286510020212     c                   move      restof        fchd
286520020212     c                   endif
286530020212
286540020212     c                   move      fedexbrc      w0012a
286550020212     c                   ENDSR
286560040601     C**************************************************************************
286570040601     C*   Scrittura fiar8
286580040601     C**************************************************************************
286590040601     C     SR_fiar8      BEGSR
286600040601     c     kblc          setll     fivax01l
286610040601     c                   do        *hival
286620061010     c     kblc          reade(N)  fivax01l
286630040601     c                   if        %eof(fivax01l)
286640040601     c                   leave
286650040601     C                   endif
286660040601     c                   clear                   fiar8000
286670040601     c                   Eval      Ar8Aas = BlpAas
286680040601     c                   Eval      Ar8Lnp = BlpLnp
286690040601     c                   Eval      Ar8Nrs = BlpNrs
286700040601     c                   Eval      Ar8Nsp = BlpNsp
286710040601     c                   eval      ar8tmd = vaxtmd
286720040601     c                   eval      ar8prr = vaxprr
286730040601     c                   eval      ar8trk = vaxtrk
286740050913     c                   eval      ar8uni = %trimr(vaxdtt)
286750130924     c                   if        aggioAr8='S'
286760040601     c                   write     fiar8000
286770130924     c                   endif
286780130308     c                   eval      w_allx='S'
286790040601     c                   enddo
286800040601     c                   endsr
286810130304     C**************************************************************************
286820130304     C*   Scrittura fiar8 da fivat tipo record "P"
286830130304     C**************************************************************************
286840130304     C     SR_fiar8_vatp BEGSR
286850130304     c                   clear                   w_prr
286860130304     c                   clear                   w_pdfn
286870130304     C                   MOVEL     'P'           WTRC
286880130304     c     kvat          setll     fivat01l
286890130305    1c                   do        *hival
286900130304     c     kvat          reade(N)  fivat01l
286910130305    2c                   if        %eof(fivat01l)
286920130304     c                   leave
286930130305    2C                   endif
286940130304     c                   movel(P)  vatnot        dvatp
286950130305    2c                   if        §vatppdfn=*blanks
286960130304     c                             or §vatppdfn=w_pdfn
286970130304     C                   iter
286980130305    2c                   endif
286990130304     c                   movel     §vatppdfn     w_pdfn
287000130304     c                   eval      w_prr+=1
287010130304     c                   clear                   fiar8000
287020130304     c                   Eval      Ar8Aas = BlpAas
287030130304     c                   Eval      Ar8Lnp = BlpLnp
287040130304     c                   Eval      Ar8Nrs = BlpNrs
287050130304     c                   Eval      Ar8Nsp = BlpNsp
287060130304     c                   eval      ar8tmd = '§PDF'
287070130304     c                   eval      ar8prr = w_prr
287080130304     c                   clear                   dar8§pdf
287090130304     c                   eval      §AR8PIDZ=§VATPIDZ
287100130306     c                   eval      §AR8PPDFP=§clipdfp
287110130306     c                   eval      §AR8PPDFn=§VATPPDFN
287120130311     c* se non prevista la stampa imposto a "N" il flag per il trattamento
287130130311     c* dell'allegato (su richiesta di FG)
287140130315     c                   if        %subst(§ar8pidz:1:1)<>'1'
287150130311     c                   eval      §ar8ptrt='N'
287160130315     c                   endif
287170130408     c* se non prevista la mail   imposto a "N" il flag per invio email
287180130408     c                   if        %subst(§ar8pidz:2:1)<>'1'
287190130408     c                   eval      §ar8peml='N'
287200130408     c                   else
287210130408     c                   eval      w_allm='S'
287220130408     c                   endif
287230130304     c                   eval      ar8uni = %trimr(dar8§pdf)
287240130924     c                   if        aggioAr8='S'
287250130304     c                   write     fiar8000
287260130924     c                   endif
287270130305    1c                   enddo
287280130304     c                   endsr
287290060308     C**************************************************************************
287300060308     C*   Richiamo lv85r per chiusura in LR
287310060308     C**************************************************************************
287320060308     C     CLS_lv85      BEGSR
287330060308     c*   ATTENZIONE: Il pgm fnlv85r serve per gestire richiesta, controllo
287340060308     c*               registrazione su data base del motivo variazione
287350060308     c*
287360060308     c*               Per ora il pgm di bollettazione richiama l'lv85
287370060308     c*               in due casi diversi di variazione bolla:
287380060308     c*               1)variazione totale imponibile di un prepagato (cvb TR
287390060308     c*               2)annullamento di un prepagato (cvb KM)
287400060308     c*
287410060308     c*               Quando fnlv85r viene richiamato in modalità "V"
287420060308     c*               (richiesta e controllo della motivazione)
287430060308     c*               viene passato tipo lancio (ilv85tla) = blanks
287440060308     c*               per chiudere in return.
287450060308     c*               In questo modo la window di richiesta motivazione
287460060308     c*               non viene pulita ed in caso di F12=Ritorno e successi-
287470060308     c*               va riconferma della variazione la window viene ripropo
287480060308     c*               sta con i dati precedentemente immessi.
287490060308     c*               Il pgm deve però essere chiuso con LR se la window
287500060308     c*               precedente era stata emessa a fronte di una causale
287510060308     c*               diversa dalla quale si era usciti con f12 anzichè
287520060308     c*               con f6=Conferma. Questa routine serve proprio per
287530060308     c*               chiudere con LR se cambiata la causale variazione
287540060308     c*               al fine di emettere la window pulita.
287550060308     c*
287560060308     c                   if        ilv85cvb <> *blanks and ilv85cvb <> wcvb
287570060308     c                   clear                   fnlv85ds
287580060308     c                   eval      ilv85tla = 'C'
287590060308     c                   movel     fnlv85ds      kpjbu
287600060308     c                   call      'FNLV85R'
287610060308     c                   parm                    kpjba
287620060308     c                   endif
287630060308     c                   endsr
287640060427     C**************************************************************************
287650060427     C*   Forzature per orm esteri con triangolazione
287660060427     C**************************************************************************
287670060427     C     sr_FOrmEst    BEGSR
287680060427      * Forzo che deve essere un porto franco
287690060427     c                   Eval      §OrPfb = 'F'
287700060427      * Flag di appoggio per portare l'ordinante nel mittente
287710060427      * e il mittente orm nel mittente originale
287720060427     c                   Eval      wforpf = '1'
287730060427if 1ac                   if        wnoccm = '1'
287740130212     c                   clear                   wnoccm
287750060427      * Ksc da ORM
287760060427if  2c                   If        OrmKsc > *Zeros
287770060427      * propongo il ksc dell'ORM
287780060427     c                   Move      OrmKsc        vidccm
287790060427     c                   Movel     OrmKsc        w0030
287800130212     c                   Z-add     w0030         vidflc
287810060427      * SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
287820060427      *  BOLLA --> ABILITA LA FILIALE CLIENTE
287830060427if  3C                   If        w0030 <> vidlnp
287840130212     c****               Z-add     w0030         vidflc
287850060427     c                   Seton                                        14
287860060427    3c                   EndIf
287870060427      * no Ksc da ORM
287880060427   x2c                   Else
287890060427      * propongo la ragione sociale dell'ordinante nella ricerca alfabetica
287900060427     c                   Movel     OrmRso        viddmt
287910060427     c                   clear                   vidccm
287920060427if  3c                   If        viddmt <> *Blanks
287930060427     c***                Seton                                        0138
287940060427     c                   Seton                                        01
287950060427    3c                   EndIf
287960060427    2c                   EndIf
287970060427   1ac                   endif
287980060427     c                   endsr
287990070403     C**************************************************************************
288000070403     C*   Aggiornamento/scrittura numero giro
288010070403     C**************************************************************************
288020070403     C     sr_FIARG      BEGSR
288030070404     c                   clear                   wupd              1
288040100323     c                   clear                   wFGI              1
288050100323     c                   clear                   wAggioARG
288060100323     c* Verifico se per il cliente mittente è presente una forzatura GIRO
288070100323     c*  nel file azfgi
288080100323     c                   eval      kksc=wksc
288090100323     c                   eval      klnp=blplnp
288100100323     c                   eval      klna=blplna
288110100323     c                   exsr      LeggiFGI
288120100323     c
288130100323    1c                   if        wfgi=*blanks
288140100323     c                   eval      klnp=999
288150100323     c                   exsr      LeggiFGI
288160100323    1c                   endif
288170100323     c
288180100323    1c                   select
288190070405     c* conferma bolla di reso
288200070405     c                   when      *in12='1' and *in15='1' and
288210070405     c                             vidfbr='S' and *in44='1'
288220070705     c*                  if        §lpcgi<>*blanks and
288230070705     c*                            vidrsd=savrsd and
288240070705     c*                            vidind=savind and
288250070705     c*                            vidprd=savprd and
288260070705     c*                            vidcad=savcad and
288270070705     c*                            vidlod=savlod and
288280070705     c*                            vidnzd=nzdini
288290100323    2c                   if        §lpcgi<>*blanks
288300070405     c                   eval      w_cgi=§lpcgi
288310070405     c                   exsr      ges_arg
288320100323    2c                   endif
288330100323
288340100323     c* Immissione oppure conferma bolla NON di reso
288350100323    1c                   when      *in12='0' or *in15='1'
288360160323     c*  Se Vedi pacco dpd imposto il giro forzato come da tabella
288370160323     c                   if        w_vediP='1'
288380160323     c                   eval      w_cgi=§NSDCGI
288390160323     c                   exsr      ges_arg
288400160323     c                   else
288410100323     c*  Se c'e' AZFGI --> vince sui destinatari
288420100323    2c                   if        wfgi='S'
288430100323     c                   eval      w_cgi=fgicgi
288440100323     c                   exsr      ges_arg
288450100323   x2c                   else
288460100323    3c                   if        ot0err=*blanks and ot0x1cgi<>*blanks
288470070924     c                             and comlna=ot0x1pog
288480070924     c                   eval      w_cgi=ot0x1cgi
288490070404     c                   exsr      ges_arg
288500160323     c                   endif
288510100323    3c                   endif
288520100323    2c                   endif
288530100323     c* Manutenzione bolla
288540160323     c*  Solo se non si tratta di VEDI PACCO
288550160324    1c                   when      *in12='1' and *in15='0' and W_vediP<>'1'
288560100323     c* Se modificato il mittente ed il nuovo ha il giro forzato --> vince
288570100323    2c                   if        wksc<>savmit  or
288580100323     c                             blplna<>lna_sav
288590100323     c                   clear                   wupd              1
288600100323     c     kblp3         chain     fiarg01l
288610100323    3c                   if        %found(fiarg01l)
288620100323     c                   eval      wupd='1'
288630100323    3c                   endif
288640100323     c
288650100323    3c                   if        wFGI='S'
288660160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
288670160129     c* la linea di arrivo
288680160129     c                   if        wupd=' '
288690160129     c                             or argcgi<>'DIR'
288700160129     c                             or blplna<>lna_sav
288710160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
288720160129    7c                   if        wupd='1' and argcgi='DIR'
288730160129     c                   exsr      sr_chiuDispoRA
288740160129    7c                   endif
288750100323     c                   eval      w_cgi=fgicgi
288760100323     c                   exsr      ges_arg
288770160129     c                   else
288780160129     c                   if        wupd='1'
288790160129     c                   unlock    fiarg01l
288800160129     c                   endif
288810160129     c                   endif
288820100323   x3c                   else
288830100323     c
288840100323     c* Se non ha il giro ed il vecchio ce lo aveva, cancello FIARG
288850100323     c*  e poi proseguo con gli altri controlli
288860100323     c
288870100323    4c                   if        %found(fiarg01l)
288880100323     c                   eval      klna=lna_sav
288890100323     c                   eval      kksc=savmit
288900100323     c                   eval      klnp=blplnp
288910100323     c                   exsr      LeggiFGI
288920100323     c
288930100323    5c                   if        wfgi=*blanks
288940100323     c                   eval      klnp=999
288950100323     c                   exsr      LeggiFGI
288960100323    5c                   endif
288970100323     c
288980100323    5c                   if        wfgi='S' and fgicgi=argcgi
288990100323     c                   delete    fiarg000
289000100323    5c                   endif
289010100323    4c                   endif
289020100323    3c                   endif
289030100323    2c                   endif
289040100323     c
289050100323    2c                   if        vidrsd<>savrsd or
289060070404     c                             blpind<>savind or
289070070404     c                             blpprd<>savprd or
289080070404     c                             blpcad<>savcad or
289090070404     c                             blplod<>savlod or
289100070404     c                             blpnzd<>savnzd or
289110100323     c                             blplna<>lna_sav or
289120100323     c                             wksc<>savmit
289130100323     c
289140100323     c* non Faccio nulla se ho già aggiornato FIARG col nuovo mittente o
289150100323     c*  nuova linea di arrivo
289160100323    3c                   if        WaggioARG=' '
289170100323     c
289180100323    4c                   if        ot0err=*blanks and
289190071010     c                             ot0x1cgi<>*blanks and comlna=ot0x1pog
289200070924     c                   eval      w_cgi=ot0x1cgi
289210100323     c                   clear                   wupd              1
289220070404     c     kblp3         chain     fiarg01l
289230100323    5c                   if        %found(fiarg01l)
289240070404     c                   eval      wupd='1'
289250100323    5c                   endif
289260160129
289270160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
289280160129     c* la linea di arrivo
289290160129     c                   if        wupd=' '
289300160129     c                             or argcgi<>'DIR'
289310160129     c                             or blplna<>lna_sav
289320160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
289330160129    7c                   if        wupd='1' and argcgi='DIR'
289340160129     c                   exsr      sr_chiuDispoRA
289350160129    7c                   endif
289360070404     c                   exsr      ges_arg
289370160129     c                   else
289380160129     c                   if        wupd='1'
289390160129     c                   unlock    fiarg01l
289400160129     c                   endif
289410160129     c                   endif
289420100323   x4c                   else
289430160129     c* Non posso cancellare a prescindere.
289440160129     c* Cancello solo se il giro non è "DIR" oppure se è cambiata la
289450160129     c* linea di arrivo
289460160129     c***  kblp3         delete(e) fiarg01l
289470160129     c     kblp3         chain     fiarg01l
289480160129    5c                   if        %found(fiarg01l)
289490160129    6c                   if        argcgi<>'DIR' or blplna<>lna_sav
289500160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
289510160129    7c                   if        argcgi='DIR'
289520160129     c                   exsr      sr_chiuDispoRA
289530160129    7c                   endif
289540160129     c                   delete    fiarg000
289550160129   x6c                   else
289560160129     c                   unlock    fiarg01l
289570160129    6c                   endif
289580160129    5c                   endif
289590100323    4c                   endif
289600100323    3c                   endif
289610100323    2c                   endif
289620100323    1c                   endsl
289630070403     c
289640070403     c                   endsr
289650070404     C**************************************************************************
289660070404     C*   Aggiornamento/scrittura numero giro
289670070404     C**************************************************************************
289680070404     C     ges_arg       BEGSR
289690100323     c                   clear                   WaggioARG         1
289700070404     c                   if        wupd=*blanks
289710070404     c                   clear                   fiarg000
289720070404     c                   z-add     blpaas        argaas
289730070404     c                   z-add     blplnp        arglnp
289740070404     c                   z-add     blpnrs        argnrs
289750070404     c                   z-add     blpnsp        argnsp
289760070404     c                   endif
289770070404     c                   z-add     blplna        arglna
289780070404     c* p.o. di consegna capofila della £6 del p.o. di arrivo
289790070404     c                   clear                   dslv55
289800070404     c                   eval      d55tpt = '6'
289810070404     c                   z-add     blplna        d55lin
289820070404     c                   z-add     blpdsp        d55drf
289830070404     c                   call      'FNLV55R'
289840070404     c                   parm                    dslv55
289850070404     c                   z-add     d55tfa        argpoc
289860070404     c                   movel     'M'           argtgi
289870070404     c                   movel     w_cgi         argcgi
289880070404     c                   if        wupd=*blanks
289890070404     c                   write     fiarg000
289900070404     c                   else
289910070404     c                   update    fiarg000
289920070404     c                   endif
289930100323     c
289940100323     c                   eval      wAggioARG='S'
289950070404     c                   endsr
289960100323     C**************************************************************************
289970100323     c* Lettura file forzatura giro di consegna
289980100323     C**************************************************************************
289990100323     c     LeggiFGI      BEGSR
290000100323     c     kfgi          setll     azfgi01l
290010100323     c     kfgi          reade     azfgi01l
290020100323     c
290030100323     c                   dow       not %eof(azfgi01l)
290040100323     c                   if        blpdsp>=fgidde and blpdsp<=fgidsc
290050100323     c                             and fgiatb=' '  and klna = fgipog
290060100323     c                   eval      wfgi='S'
290070100323     c                   leave
290080100323     c                   endif
290090100323     c
290100100323     c     kfgi          reade     azfgi01l
290110100323     c                   enddo
290120100323
290130100323     c                   ENDSR
290140160129     C**************************************************************************
290150160201     C*   Chiusura dispo di Dirottamento/Reso e R.A. relativa
290160160129     C**************************************************************************
290170160129     C     sr_chiuDispoRABEGSR
290180160201     c                   clear                   wfine
290190160201     c     kblp3         setll     tiidc01l
290200160201     c     kblp3         reade     tiidc01l
290210160129     c                   dow       not  %eof(tiidc01l) and Wfine=*blanks
290220160201     c                   if        idcfla<>' '
290230160129     c*  CHIUSURA NOTE R.A.
290240160129     c                   exsr      sr_noteRa
290250160129     c*  Aggiorno il record TIIDC
290260160129     c                   eval      IDCELAUTE=KNMUS
290270160201     c*****              eval      IDCELADATA=%int( %subst( %char( %dec( +
290280160201     c*****                        %timestamp() ) ) :1 :14 ) )
290290160201      /free
290300160201              IDCELADATA=%int( %subst( %char( %dec( %timestamp() ) )
290310160201                                 :1 :14 ) );
290320160201      /end-free
290330160129     c                   update    tiidc000
290340160129     c                   eval      wfine='1'
290350160129     c                   endif
290360160201     c     kblp3         reade     tiidc01l
290370160129     c                   enddo
290380160129     c                   endsr
290390160129     c**********************************************************************
290400160129     c* CHIUSURA  Note R.A.
290410160129     c**********************************************************************
290420160129     C     sr_noteRa     BEGSR
290430160129     c                   clear                   fidna7ds
290440160129     C                   EVAL      IDNA7ANT=IDCANT
290450160129     C                   EVAL      IDNA7NUT=IDCNUT
290460160129     C                   EVAL      IDNA7PDT=IDCPDT
290470160201     C                   EVAL      IDNA7PCT=simPOU
290480160129     C                   EVAL      IDNA7utc=knmus
290490160129     c***????            eval      IDNA7NOT=wnot
290500160129     c                   call      'FIDNA7R'
290510160129     c                   parm                    fidna7ds
290520160129     c
290530160129     C                   ENDSR
290540070604     C**************************************************************************
290550070604     C*   Aggiornamento dati per PDA
290560070604     C**************************************************************************
290570070604     C     Sr_pda        BEGSR
290580070604     c* verifico se già estratti orm per pda
290590080111     C****               CLEAR                   dsbs02
290600080111     c****               clear                   dpdo
290610080111     C****               MOVEL     'C'           T02MOD
290620080111     C****               MOVEL     KNSIF         T02SIF
290630080111     C****               MOVEL     'PDO'         T02COD
290640080111     c****               movel(P)  g_ormpor      t02ke1
290650080111     C****               CALL      'TIBS02R'
290660080111     C****               PARM                    KPJBA
290670080111     C****               PARM                    dsbs02
290680080111    2C****               IF        T02ERR = *BLANKS
290690080111     C****               MOVEL     T02uni        dpdo
290700080111    2C****               ENDIF
290710080111     c****               clear                   aggpda            1
290720080111    1c****               if        d§pdodata>0
290730080111    2c****               if        ormddc<> d§pdodata
290740070604     c     kfnorf        chain     fnorf01l
290750070604    3c                   if        %found(fnorf01l)
290760080221     c**!!!kfipdo        chain     fipdo01t
290770080111    4c****               if        not %found(fipdo01t)
290780080221    4c**!!!              if        %found(fipdo01t)
290790080111     c****               eval      aggpda='N'
290800080111    4c****               endif
290810080111    3c****               endif
290820080111    2c****               endif
290830080111    2c****               if        aggpda=' '
290840070604     c                   clear                   fior56ds
290850070604     c                   eval      or56tla = 'O'
290860070604     c                   eval      or56poe = ormpoe
290870070604     c                   eval      or56nsr = ormnsr
290880070604     c                   eval      or56nor = ormnor
290890070604     c                   eval      or56nrv = ormnrv
290900080111     c                   eval      or56fgs = orffgs
290910080111     c                   eval      or56ndcd = orfndc
290920080111     c                   eval      or56ndca = orfndc
290930080111     c                   eval      or56ddc = orfddc
290940140121     c                   eval      or56cmd  = 'V'
290950140121     c                   eval      or56var = 'I'
290960070604     c                   call      'FIOR56R'
290970070604     c                   parm                    kpjbu
290980070604     c                   parm                    fior56ds
290990070604     c* se effettuato scarico memorizzo di avvisare dell'avvenuto sca-
291000070604     c* rico a PDA
291010070604    3c                   if        or56err=*blanks
291020070604     c                   eval      wmsg_pda='S'
291030070606     c                   exsr      sr_dst
291040070606     c                   move      dstpdr        w02pdr_p
291050070604    3c                   endif
291060080221    2c**!!!              endif
291070070604    1c                   endif
291080070604     c                   endsr
291090071023     C**************************************************************************
291100071023     C*   Impostazione campo partita iva mittente
291110071023     C**************************************************************************
291120071023     C     Sr_wpiva      BEGSR
291130071023     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
291140071023     c                   select
291150071023     c* solo numeri
291160071023     c* "PRIVATO senza iso
291170071023     c     *in30         wheneq    *off
291180071023     c     wiso          andge     *zeros
291190071023     c     *in30         oreq      *on
291200071023     c     posiz         andlt     3
291210071023     c                   movel     wpiva         vidcpm
291220071023     c* iso + numeri
291230071023     c* iso + "PRIVATO"
291240071023     c     *in30         wheneq    *off
291250071023     c     posiz         orgt      2
291260071023     c                   movel     wpiva         vidpim
291270071023     c                   endsl
291280071023     c                   endsr
291290071218     C**************************************************************************
291300071218     C*   Reperimento dati tabella cli
291310071218     C**************************************************************************
291320071218     C     Sr_dcli       BEGSR
291330071218     C                   CLEAR                   dsbs02
291340071218     c                   clear                   dcli
291350071218     C                   MOVEL     'C'           T02MOD
291360071218     C                   MOVEL     KNSIF         T02SIF
291370071218     C                   MOVEL     'CLI'         T02COD
291380071221     c                   movel(P)  wksc          t02ke1
291390071218     C                   CALL      'TIBS02R'
291400071218     C                   PARM                    KPJBA
291410071218     C                   PARM                    dsbs02
291420071218    2C                   IF        T02ERR = *BLANKS
291430071218     C                   MOVEL     T02uni        dcli
291440071218    2C                   ENDIF
291450131003     c* Personalizzazione instradamento merce:
291460131003     c* se pieni, sposto peso e volume medio in campi numerici
291470131003     c                   clear                   n_§clipsm
291480131003     c                   clear                   n_§clivlm
291490131003     c                   testn                   §clipsm              30
291500131003     c                   if        *in30 and %subst(§clipsm:7:1)>='0'
291510131003     c                   move      §clipsm       n_§clipsm
291520131003     c                   endif
291530131003     c                   testn                   §clivlm              30
291540131003     c                   if        *in30 and %subst(§clivlm:5:1)>='0'
291550131003     c                   move      §clivlm       n_§clivlm
291560131003     c                   endif
291570131003     c
291580071218     c                   endsr
291590071220     C**************************************************************************
291600071220     C*   Controlli per abilitazione modifica lna di sped. disk B
291610071220     C**************************************************************************
291620071220     C     Sr_chkabilna  BEGSR
291630120817     c***  kblt1         setll     fnblt01l
291640120817     c***  kblt1         reade(N)  fnblt01l
291650120817     c***                dow       not %eof(fnblt01l)
291660120817     c     kblt1         setll     fiart01l
291670120817     c     kblt1         reade(N)  fiart01l
291680120817     c                   dow       not %eof(fiart01l)
291690120817     c     kanm2         setll     fnbrv07l
291700071220     c* - presenti spunte dei segnacolli con la vecchia lna
291710071220     c                   if        %equal(fnbrv07l)
291720071220     c                   seton                                        4790
291730071221     c                   movel     err(315)      vidmsg
291740071220     c                   goto      f_chkabilna
291750071220     c                   endif
291760071220     c* - non presenti spunte dei segnacolli con la nuova lna
291770071221     c     kbrv7         setll     fnbrv07l
291780071220     c                   if        not %equal(fnbrv07l)
291790071220     c                   seton                                        4790
291800071221     c                   movel     err(316)      vidmsg
291810071220     c                   goto      f_chkabilna
291820071220     c                   endif
291830071220     c* - segnacolli doppi sulla nuova lna
291840120829     c* - Non controlla presenza su fiars perchè in questa situazione ars non c'
291850120829     c*   è
291860120817     c**   kbrv7         setll     fnblt27l
291870120817     c**                 if        %equal(fnblt27l)
291880120817     c**   kbrv7         chain     fnblt27l
291890120817     c     kbrv7         setll     fiart27l
291900120817     c                   if        %equal(fiart27l)
291910120817     c     kbrv7         chain     fiart27l
291920071221     c                   seton                                        4790
291930071221     c                   clear                   vidmsg
291940080103     c                   eval      vidmsg='SEGNACOLLO'
291950071221     c                   eval      vidmsg=%trim(vidmsg) + ' ' +
291960120817     c                             %char(artnsc)
291970071221     c                   eval      vidmsg=%trim(vidmsg)+
291980080103     c                             ' DOPPIO: presente su spedizione '
291990120817     c                             + %char(artlnp)
292000120817     c                   eval      vidmsg=%trim(vidmsg)+ ' ' + %char(artnrs)
292010080103     c                             + '-'
292020080103     c                   eval      vidmsg=%trim(vidmsg) +
292030120817     c                             %char(artnsp) +' ' + %char(artaas)
292040071221     c                   goto      f_chkabilna
292050071221     c                   endif
292060120817     c***  kblt1         reade(N)  fnblt01l
292070120817     c     kblt1         reade(N)  fiart01l
292080071220     c                   enddo
292090071220     c* - nuova lna è estera
292100100210     c                   if        a_§ogntw<>'COR' and a_§ogntw<>'MES'
292110100210     c                   seton                                        4790
292120100210     c                   movel     err(317)      vidmsg
292130100210     c                   goto      f_chkabilna
292140100210     c                   endif
292150071220     c     f_chkabilna   endsr
292160080313     C**************************************************************************
292170080313     C*   Verifica se cliente con serie parziale
292180080313     C**************************************************************************
292190100517     C**   Sr_parz       BEGSR
292200100517     c**                 clear                   wparz
292210100517     c**                 clear                   wparz_d
292220100517     c**                 clear                   wparz_a
292230100517    1c**                 if        vidnrs>0
292240100517     c**                 eval      k_tbecod = '3CP'
292250100517     c**                 movel(p)  wksc          k_tbeke1
292260100517     c**   ktbe1         setll     tntbe01l
292270100517    2c**                 do        *hival
292280100517     c**   ktbe1         reade(N)  tntbe01l
292290100517    3c**                 if        %eof(tntbe01l)
292300100517     c**                 leave
292310100517    3c**                 endif
292320100517    3c**                 if        tbeatb='A'
292330100517     c**                 iter
292340100517    3c**                 endif
292350100517     c**                 movel     tbeuni        d3cp
292360100517     c**                 clear                   w007a             7
292370100517     c**                 eval      w007a  = %subst(tbeke2: 3: 7)
292380100517     c**                 move      w007a         wparz_d
292390100517     c**                 z-add     §3cpal        wparz_a
292400100517     c**                 eval      wparz = 'S'
292410100517    2c**                 enddo
292420100517    1c**                 endif
292430100517     c**                 endsr
292440090327     C**************************************************************************
292450090327     C*    PULIZIA CAMPI window cliente/tariffa tassazione porti assegnati
292460090327     C**************************************************************************
292470090327     C     sr_inzwdwcli  BEGSR
292480090327     c                   clear                   wcliksc
292490090327     c                   clear                   wclidks
292500090327     c                   clear                   wclictr
292510090327     c                   clear                   atrwksc
292520090327     c                   clear                   atrwctr
292530090327     c                   endsr
292540090323     C**************************************************************************
292550090323     C*   Gestione window per immissione/modifica cli/tariffa per tassaz. p.a.
292560090323     C**************************************************************************
292570090323     C     geswdw_clitar BEGSR
292580090323     c                   exsr      riewdwcli
292590090325     c                   clear                   hcliriga
292600090325     c                   clear                   hclicolo
292610090327     c                   eval      s_wcliksc=wcliksc
292620090326     c                   eval      s_wclictr=wclictr
292630090324     c                   eval      $fine='0'
292640090323     c*
292650090323     c                   dow       $fine='0'
292660161202
292670161202     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
292680161202     c                   if        *in12 and not *in15
292690161202     c                   write     ls01wcli
292700161202     C                   read(E)   fnls01d
292710161202     c                   else
292720161202     c                   exfmt     ls01wcli
292730161202     c                   endif
292740161202
292750161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
292760161202     c                   if        %error
292770161202     C                   MOVEL     '6'           §LPFPR
292780161202     c                   leave
292790161202     c                   endif
292800161202     c
292810090325     c                   eval      *in90='0'
292820090325     c                   clear                   hcliriga
292830090325     c                   clear                   hclicolo
292840090323     c                   select
292850090323     c* f12=Ritorno
292860090323     c                   when      *inkl='1'
292870090323     c                   eval      $fine='1'
292880090327     c                   eval      wcliksc=s_wcliksc
292890090326     c                   eval      wclictr=s_wclictr
292900090323     c                   other
292910090323     c* f6=conferma o enter
292920090323     c                   exsr      ctrwdwcli
292930090323     c                   if        *inkf and not *in90
292940090326     c                   eval      $fine='1'
292950090323     c                   endif
292960090323     c                   endsl
292970090323     c                   enddo
292980090323     c*
292990090323     c                   endsr
293000090324     C**************************************************************************
293010090324     C* Riempimento campi window cliente/tariffa per tassazione porti assegnati
293020090324     C**************************************************************************
293030090325     C     riewdwcli     BEGSR
293040090324
293050090324     c                   select
293060090324     c* DA ORM
293070090324     c                   when      partch<>'P' and flgfit<>'S'
293080090325     c                   exsr      sr_clearing
293090090324      * Se ORM richiede la bolla in porto assegnato e bolla in porto assegnato
293100090324      * memorizzo il codice cliente che servirà in arrivo in tassazione
293110090324      * porti assegnati. Memorizzo il codice cliente anche nel caso
293120090324      * di bolla in p.a. che fa parte del clearing dpd
293130090324if  2c                   If         ((§OrPfb = 'A' or wforpf = '1') and *In04
293140090324     c                              and Ormksc > *Zeros) or *in04 and wclg='S'
293150090324    3c                   if        wclg=' '
293160090327     c                   Z-add     OrmKsc        wcliksc
293170090325     c                   eval      atrwksc=prot
293180090327     c                   if        ormctr<>*blanks
293190090324     c                   Move      OrmCtr        wclictr
293200090325     c                   eval      atrwctr=prot
293210090324     c                   endif
293220090324   x3c                   else
293230090324     c* se spedizione che va nel clearing il codice cliente è da
293240090324     c* reperire su EDTAB tab 'PU'
293250090324     c                   eval      kedcod='PU'
293260090324     c                   clear                   kedkey
293270090324     c                   move      wopoe         com003a           3
293280090324     c                   eval      kedkey='DPD'+com003a
293290090324     c     kedtab        chain     edtab01l
293300090324    4c                   if        %found(edtab01l)
293310090324     c                   movel     tabuni        edidspu
293320090324     c                   if        §puormaksc>*zeros
293330090327     c                   move      §PUORMAKSC    wcliksc
293340090325     c                   eval      atrwksc=prot
293350090324     c                   endif
293360090327     c                   if        §puormactr<>*blanks
293370090324     c                   move      §PUORMACTR    wclictr
293380090325     c                   eval      atrwctr=prot
293390090324     c                   endif
293400090324    4c                   endif
293410090324    3c                   endif
293420090324e   2c                   EndIf
293430090324     c* DA PGM CHIAMANTE
293440090327     c                   when      *in12 and *in15 and *in04 and vidcbo<>'FW'
293450090325    1c                   if        §lpksca>*zeros
293460090325     c                   eval      w_§lpksca=§lpksca
293470090325     c                   eval      w_§lpctra=§lpctra
293480090325   x1c                   else
293490090325    2c                   if        savfpr='T' or savfpr='P'
293500090325     c                   z-add     §lpccm        w0040
293510090325     c                   if        w0040<> 9999
293520090325     c                   move      §lpccm        w_§lpksca
293530090325     c                   if        §lpctr<>999
293540090325     c                   move      §lpctr        w_§lpctra
293550090325     c                   endif
293560090325     c                   endif
293570090325    2c                   endif
293580090325    1c                   endif
293590090325    1c                   if        w_§lpksca>*zeros
293600090327     c                   movel     w_§lpksca     wcliksc
293610090324     c                   eval      atrwksc=prot
293620090327    2c                   if        w_§lpctra<>*blanks
293630090325     c                   move      w_§lpctra     wclictr
293640090324     c                   eval      atrwctr=prot
293650090325    2c                   endif
293660090325    1c                   endif
293670090324     c* DA CONFERMA BOLLE PER BOLLE "FW"
293680090324     c                   when      *in12 and *in15 and vidcbo='FW'
293690090324     c                             and (%Subst(§lpNot:1:18) = wnotfw
293700090324     c                             or   %Subst(§lpNt2:1:18) = wnotfw)
293710090324     c                   Clear                   w007a
293720090324     c                   If        %Subst(§lpNot:1:18) = wnotfw
293730090324     c                   Eval      w007a = %Subst(§lpNot:20:7)
293740090324     c                   Else
293750090324     c                   Eval      w007a = %Subst(§lpNt2:20:7)
293760090324     c                   EndIf
293770090324      * verifico che siano tutti numeri
293780090324     c                   if        %check(digits:w007a)=0
293790090327     c                   Move      w007a         wcliksc
293800090324     c                   eval      atrwksc=prot
293810090324     c                   EndIf
293820090325     c                   endsl
293830090326     c*
293840090327     c                   if        wcliksc>0
293850090326     C                   clear                   TIBS69DS
293860090327     C                   z-add     wcliksc       I69kac
293870090326     C                   call      'TIBS69R'
293880090326     C                   parm                    tibs69DS
293890090326     C                   parm                    ds_cnaco
293900090326     C                   parm                    ds_cnind
293910090326     C                   parm                    ds_cnclp
293920090326     C                   parm                    ds_fncls
293930090515     c                   eval      wclidks=BS_acorag
293940090326     c                   endif
293950090324     c
293960090324     c                   endsr
293970090325     C**************************************************************************
293980090325     C* Controllo window cliente/tariffa per tassazione porti assegnati
293990090325     C**************************************************************************
294000090325     C     ctrwdwcli     BEGSR
294010090327     c                   if        wcliksc=0
294020090326     c                   clear                   wclidks
294030090326     c                   endif
294040090325     c* codice cliente
294050090326     c                   if        atrwksc=*blanks
294060090327     c                   if        wcliksc>0
294070090326     c                   clear                   wclidks
294080090325     C                   clear                   TIBS69DS
294090090327     C                   z-add     wcliksc       I69kac
294100090327     C                   z-add     wcliksc       I69kin
294110090325     C                   call      'TIBS69R'
294120090325     C                   parm                    tibs69DS
294130090325     C                   parm                    ds_cnaco
294140090325     C                   parm                    ds_cnind
294150090325     C                   parm                    ds_cnclp
294160090325     C                   parm                    ds_fncls
294170090515     c                   eval      wclidks=BS_acorag
294180090325     C* ERRORE
294190090325     c     O69Err        Ifeq      '1'
294200090515     c     BS_acoflg     Orne      *Blanks
294210090325     C     wcliksc       OREQ      8888
294220090325     c                   eval      *in90=*on
294230090325     C                   MOVEL     err(319)      wclimsg
294240090325     c                   z-add     04            Hcliriga
294250090325     c                   z-add     18            Hclicolo
294260090325     c                   goto      endwcli
294270090325    2C                   ENDIF
294280130312    2C***  BS_Acoabl     IFEQ      '8'
294290130312    2C***  BS_acoabl     OREQ      '*'
294300130312    2C     BS_Acoabl     IFne      *blanks
294310090325     c                   eval      *in90=*on
294320090325     C                   MOVEL     err(320)      wclimsg
294330090325     c                   z-add     04            Hcliriga
294340090325     c                   z-add     18            Hclicolo
294350090325     c                   goto      endwcli
294360090325    2C                   END
294370090325     c                   endif
294380090325     c                   endif
294390090325     c* codice tariffa
294400090326     c                   if        atrwctr=*blanks and wclictr<>*blanks
294410090325     c* errore se manca il codice cliente
294420090327     c                   if        wcliksc=*zeros
294430090325     c                   eval      *in90=*on
294440090325     C                   MOVEL     err(319)      wclimsg
294450090325     c                   z-add     04            Hcliriga
294460090325     c                   z-add     18            Hclicolo
294470090325     c                   goto      endwcli
294480090325     c                   endif
294490090325     c*
294500090325     c                   eval      s_fnlv59ds=fnlv59ds
294510090325     C                   CLEAR                   fnlv59ds
294520090325     C                   MOVEL     'A'           ilv59tbo
294530090325      * Se bolla monovaria carico tutte le tariffe ma propongo la partenza
294540090325     C                   IF        §3ASVA <> *BLANK
294550090325     C                   movel     ' '           ilv59tbo
294560090325     C                   movel     'P'           ilv59prp
294570090325     C                   ENDIF
294580090325      *
294590090327     C                   MOVEL     wcliksc       ilv59KSC
294600090325     C                   MOVEL     KCI           ilv59KCI
294610090325     C                   MOVEL     WFIE          ilv59FIE
294620090325     C                   MOVEL     blpdsp        ilv59DSP
294630090325     C                   MOVEL     vidtsp        ilv59TSP
294640090325     C                   MOVEL     'S'           ilv59RIC
294650090325     c                   move      wclictr       ilv59ctr
294660090325     C*
294670090325     C                   CALL      'FNLV59R'
294680090325     C                   PARM                    fnlv59ds
294690090325     C* ERRORE
294700090325     C     olv59msg      IFNE      *BLANKS
294710090325     C                   MOVEL     olv59msg      wclimsg
294720090325     C                   eval      *in90='1'
294730090325     c                   z-add     05            Hcliriga
294740090325     c                   z-add     18            Hclicolo
294750090325     c                   eval      fnlv59ds=s_fnlv59ds
294760090325     C                   GOTO      endwcli
294770090325     C                   ENDIF
294780090325     c*
294790090325     c                   eval      fnlv59ds=s_fnlv59ds
294800090325     c                   endif
294810090325     c     endwcli       endsr
294820090324     C**************************************************************************
294830090324     C* Verifica se spedizione che va nel clearing
294840090324     C**************************************************************************
294850090324     C     sr_clearing   BEGSR
294860090324     c                   clear                   wclg
294870090324    1c                   if        *in12 and *in15='0' and
294880090324     c                             s_§b4poe=wopoe and
294890090324     c                             s_§b4nsr=wonsr and
294900090324     c                             s_§b4nor=wonor2 and
294910090324     c                             s_§b4nrv=wonrv
294920090324     c                   eval      wclg=§b4clg
294930090324   x1c                   else
294940090324     c* se spedizione commissionata da dpd con orm automatico
294950090324     c* verifico se
294960090324     c* sono presenti altre bolle aventi lo stesso orm per l'impostazione
294970090324     c* del flag §b4clg
294980090324     C
294990090324    2c                   if        ormrfa<>*blanks and %subst(ormrfa:1:
295000090324     c                             3)='DPD'
295010090324     c                   eval      kdpodep=%subst(ormrfa:4:4)
295020090324     c                   eval      w006a=%subst(ormrfa:8:6)
295030090324     c                   move      w006a         kdpoord
295040090324     c     kdpo          setll     fidpo03l
295050090324    3c                   if        %equal(fidpo03l)
295060090324     c                   eval      wclg='S'
295070090324     c                   movel     'M'           kar4trc
295080090324     c                   movel     widorm        kar4n14
295090160209     c     kar403        setll     fiar405l
295100090324    4c                   do        *hival
295110160209     c     kar403        reade     fiar405l
295120090324     c* fine file
295130160209    5c                   if        %eof(fiar405l)
295140090324     c                   leave
295150090324    5c                   endif
295160090324     c*
295170090324     c                   eval      wclg=' '
295180090324    4c                   enddo
295190090324    3c                   endif
295200090324    2c                   endif
295210090324    1c                   endif
295220090324     c                   endsr
295230090326     C**************************************************************************
295240090326     C* Carico cliente/tariffa per tassazione p.a. da fiar4 trk 'A'
295250090326     C**************************************************************************
295260090326     C     sr_daar4a     BEGSR
295270090326     C                   MOVEL     'A'           WTRC
295280090326     c     kblp4         chain(N)  fiar401l
295290090326     c                   if        %found(fiar401l)
295300090326     c                   movel     ar4not        dsbl4a
295310090326     C                   MOVEL     '3M'          COD
295320090326     C                   MOVEL(P)  Vidsop        KEY
295330090326     C                   EXSR      CTABEL
295340090327     c                   if        §b4aks>0
295350090327     c                   z-add     §b4aks        wcliksc
295360090327     c                   if        s_ormksc>0  or not *in30
295370090326     c                   eval      atrwksc=prot
295380090326     c                   endif
295390090327     c                   if        §b4act<>*blanks
295400090326     c                   move      §b4act        wclictr
295410090327     c                   if        (s_ormksc>0 and s_ormctr<>*blanks)
295420090327     c                             or (not *in30 and s_ormksc=0)
295430090326     c                   eval      atrwctr=prot
295440090326     c                   endif
295450090327     c                   else
295460090327     c* se cod.tariffa non presente ma bolla non da orm proteggo comunque se
295470090327     c* ksc impostato altrimenti poi se fosse sprotetto non avrebbero più
295480090327     c* la possibiltà di correggerlo in caso di errore
295490090327     c                   if        not *in30 and wcliksc>0 and s_ormksc=0
295500090327     c                   eval      atrwctr=prot
295510090327     c                   endif
295520090326     c                   endif
295530090326     c                   endif
295540090326     c                   endif
295550090326     c                   endsr
295560110512     C**************************************************************************
295570110512     C*   Gestione window per manutenzione indirizzo email destinatario
295580110512     C**************************************************************************
295590150213     C*    sr_geswdwemd  BEGSR
295600150213     c*                  clear                   hemdriga
295610150213     c*                  clear                   hemdcolo
295620150213     c*                  eval      $fine='0'
295630150213     c*                  eval      s_wemdest=wemdest
295640150213     c*                  eval      s_wsms   =wsms
295650110512     c*
295660150213     c*                  dow       $fine='0'
295670150213     c*                  exfmt     ls01wemd
295680150213     c*                  eval      *in90='0'
295690150213     c*                  clear                   hemdriga
295700150213     c*                  clear                   hemdcolo
295710150213     c*                  clear                   wemdmsg
295720150213     c*                  select
295730110512     c* f12=Ritorno
295740150213     c*                  when      *inkl='1'
295750150213     c*                  eval      $fine='1'
295760150213     c*                  eval      wemdest=s_wemdest
295770150213     c*                  eval      wsms=s_wsms
295780150213     c*                  other
295790110512     c* f6=conferma o enter
295800150213     c*                  if        wemdest<>*blanks
295810150213     c*                  if        wdesie='E'
295820150213     c*                  Eval      *In90 = *On
295830150213     c*                  Eval      wemdmsg = err(342)
295840150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
295850150213     c*                            ':eliminare Indir.'
295860150213     c*                  eval      hemdriga=3
295870150213     c*                  eval      hemdcolo=7
295880150213     c*                  else
295890150213     c*                  exsr      Sr_Chkemd
295900110512      * Errore
295910150213if  3c*                  If        §emlerro <> '0'
295920150213     c*                  Eval      *In90 = *On
295930150213     c*                  Eval      wemdmsg = err(340)
295940150213     c*                  eval      hemdriga=3
295950150213     c*                  eval      hemdcolo=7
295960150213   x3c*                  else
295970150213     c*                  Eval      wemdest = §emlindo
295980150213    3c*                  EndIf
295990150213     c*                  EndIf
296000150213     c*                  endif
296010150213     c*                  if        wsms<>*blanks
296020150213     c*                  if        wdesie='E'
296030150213     c*                  Eval      *In90 = *On
296040150213     c*                  Eval      wemdmsg = err(342)
296050150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
296060150213     c*                            ':eliminare Cell.'
296070150213     c*                  eval      hemdriga=5
296080150213     c*                  eval      hemdcolo=7
296090150213     c*                  else
296100140423      /free
296110150216       //pinCell = %trim(wsms);
296120150216       //pOutErr = *blanks;
296130150213       //if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
296140140423
296150140423           // Numero di cellulare KO
296160150213       //   *In90 = *On;
296170150213       //   wemdmsg = err(351);
296180150213       //   hemdriga=5;
296190150213       //   hemdcolo=7;
296200150213    3  //EndIf;
296210140423      /end-free
296220150213     c*                  EndIf
296230150213     c*                  endif
296240150213     c*                  if        *inkf and not *in90
296250150213     c*                  eval      $fine='1'
296260150213     c*                  endif
296270150213     c*                  endsl
296280150213     c*                  enddo
296290110512     c*
296300150213     c*                  endsr
296310110705     C**************************************************************************
296320110705     C*   Gestione window per codici CUP e CIG
296330110705     C**************************************************************************
296340110705     C     sr_geswdwcup  BEGSR
296350110705     c                   eval      $fine='0'
296360110705     c                   eval      s_wcupcup=wcupcup
296370110705     c                   eval      s_wcupcig=wcupcig
296380110705     c*
296390110705     c                   dow       $fine='0'
296400110705     c                   exfmt     ls01wcup
296410110705     c                   eval      *in90='0'
296420110705     c                   select
296430110705     c* f12=Ritorno
296440110705     c                   when      *inkl='1'
296450110705     c                   eval      $fine='1'
296460110705     c                   eval      wcupcup=s_wcupcup
296470110705     c                   eval      wcupcig=s_wcupcig
296480110705     c                   other
296490110705     c* f6=conferma
296500110705     c                   if        *inkf
296510110705     c                   eval      $fine='1'
296520110705     c                   endif
296530110705     c                   endsl
296540110705     c                   enddo
296550110705     c*
296560110705     c                   endsr
296570090608     C**************************************************************************
296580090608     C* Carico limiti (peso/colli/volume) per tipo servizio
296590090608     C**************************************************************************
296600090608     C     sr_limtsp     BEGSR
296610090609     c                   clear                   wmsgtsp
296620090608     c                   clear                   trul73ds
296630090608     c                   if        vidtsp<>*blanks
296640090608     c                   eval      i73tsp=vidtsp
296650090608     c                   else
296660090608     c                   eval      i73tsp=comtsp
296670090608     c                   endif
296680111026     c* campi per la forzatura del messaggio di errore --> pulizia a cambio di
296690111026     c* tipo servizio
296700111026     c                   if        i73tsp<>savtsp73
296710111026     c                   clear                   wncl_pre
296720111026     c                   clear                   wpes_pre
296730111026     c                   clear                   wvol_pre
296740111026     c                   eval      savtsp73=i73tsp
296750111026     c                   endif
296760090619     c* Esco dalla routine senza effettuare il controllo se non ho il tipo
296770090619     c* servizio e provengo da controlli della prima videata:
296780090619     c* è successo che abbiano fatto un dirottamento ma il codice tariffa
296790090619     c* della bolla mamma utilizzato non è uno dei codici presenti per il
296800090619     c* cliente della bolla di dirottamento e quindi il tipo serivizio in
296810090619     c* questi casi è vuoto. In seconda videata poi saranno costretti a
296820090619     c* modificare il codice tariffa e di conseguenza i controlli limiti per
296830090619     c* tipo servizio verranno eseguiti correttamente
296840090619     c                   if        wvid='1' and i73tsp=*blanks
296850090619     c                   leavesr
296860090619     c                   endif
296870090609     c                   z-add     1             c
296880090609     c     i73tsp        lookup    tsp(c)                                 30
296890090609     c                   eval      i73psk=wpes
296900090608     c                   eval      i73vmc=wvol
296910090608     c                   eval      i73ncl=wncl
296920090608     c                   call      'TRUL73R'
296930090608     c                   parm                    trul73ds
296940090608     c                   select
296950090608     c                   when      o73err='E'
296960090608     c                   seton                                        90
296970090609     c                   eval      wmsgtsp=err(324)
296980090609     c                   eval      %subst(wmsgtsp: 40: 8)=dts08(c)
296990090609     c* colli bloccante
297000090608     c                   when      o73fclm='1'
297010090608     c                   seton                                        90
297020090609     c                   if        wvid='1'
297030090609     c                   seton                                        62
297040090609     c                   else
297050090609     c                   seton                                        41
297060090609     c                   endif
297070090609     c                   eval      wmsgtsp=err(325)
297080090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297090090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclm:'4')
297100090609     c* peso kg bloccante
297110090608     c                   when      O73FKGM='1'
297120090608     c                   seton                                        90
297130090609     c                   if        wvid='1'
297140090609     c                   seton                                        63
297150090609     c                   else
297160090609     c                   seton                                        42
297170090609     c                   endif
297180090609     c                   eval      wmsgtsp=err(326)
297190090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297200090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgm:'4')
297210090609     c*volume mc bloccante
297220090608     c                   when      O73FMCM='1'
297230090609     c                   seton                                        9047
297240090609     c                   eval      wmsgtsp=err(327)
297250090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297260090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcm:'4')
297270090609     c* colli forzabile
297280090608     c                   when      O73FCLF='1' and wncl<>wncl_pre
297290090608     c                   seton                                        90
297300090609     c                   if        wvid='1'
297310090609     c                   seton                                        62
297320090609     c                   else
297330090609     c                   seton                                        41
297340090609     c                   endif
297350090609     c                   eval      wmsgtsp=err(325)
297360090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297370090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclf:'4')
297380090610     c                   eval      wmsgtsp=%trim(wmsgtsp)+ '. ENTER per forzare'
297390090609     c                   eval      wncl_pre=wncl
297400090609     c* peso kg forzabile
297410090609     c                   when      O73Fkgf='1' and wpes<>wpes_pre
297420090608     c                   seton                                        90
297430090609     c                   if        wvid='1'
297440090609     c                   seton                                        63
297450090609     c                   else
297460090609     c                   seton                                        42
297470090609     c                   endif
297480090609     c                   eval      wmsgtsp=err(326)
297490090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297500090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgf:'4')
297510090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
297520090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
297530090609     c                   eval      wpes_pre=wpes
297540090609     c* volume mc forzabile
297550090608     c                   when      O73FmcF='1' and wvol<>wvol_pre
297560090609     c                   seton                                        9047
297570090609     c                   eval      wmsgtsp=err(327)
297580090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
297590090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcf:'4')
297600090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
297610090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
297620090609     c                   eval      wvol_pre=wvol
297630090608     c                   endsl
297640090608     c                   endsr
297650091111     C**************************************************************************
297660091111     C*   Gestione window per scelta beneficiario contrassegno
297670091111     C**************************************************************************
297680091111     C     geswdw_cas    BEGSR
297690091111     c                   exsr      riewdwcas
297700091111     c                   clear                   hcasriga
297710091111     c                   clear                   hcascolo
297720091111     c                   eval      $fine='0'
297730091111     c*
297740091111     c                   dow       $fine='0'
297750091111     c                   exfmt     ls01wcas
297760091111     c                   eval      *in90='0'
297770091111     c                   clear                   hcasriga
297780091111     c                   clear                   hcascolo
297790091111     c                   select
297800091111     c* f12=Ritorno
297810091111     c                   when      *inkl='1'
297820091111     c                   eval      $fine='1'
297830091111     c                   other
297840091111     c* f6=conferma o enter
297850091111     c                   exsr      ctrwdwcas
297860091111     c                   if        *inkf and not *in90
297870091111     c                   eval      $fine='1'
297880091111     c                   endif
297890091111     c                   endsl
297900091111     c                   enddo
297910091111     c*
297920091111     c                   endsr
297930091111     C**************************************************************************
297940091111     C* Riempimento campi window scelta beneficiario contrassegno
297950091111     C**************************************************************************
297960091111     C     riewdwcas     BEGSR
297970091111     c* mittente spedizione
297980091111     c                   eval      wcasmit=vidrsm
297990091111     c* ordinante O.R.M.
298000091117     c                   eval      wcascor=ormksc
298010091112     c* ..ragione sociale da cnaco
298020091112     C                   clear                   TIBS69DS
298030091112     C                   z-add     ormksc        I69kac
298040091112     C                   call      'TIBS69R'
298050091112     C                   parm                    tibs69DS
298060091112     C                   parm                    ds_cnaco
298070091112     C                   parm                    ds_cnind
298080091112     C                   parm                    ds_cnclp
298090091112     C                   parm                    ds_fncls
298100091112     c                   eval      wcasord=BS_acorag
298110091112     c*
298120091111     c* destinatario spedizione
298130091111     c                   eval      wcasdest=v2crsd
298140091111     c                   endsr
298150091111     C**************************************************************************
298160091111     C* Controllo window scelta beneficiario contrassegno
298170091111     C**************************************************************************
298180091111     C     ctrwdwcas     BEGSR
298190091111     c                   select
298200091111     c* Effettuare alemno una selazione
298210091111     c                   when      wcassel1=*blanks and wcassel2=*blanks
298220091111     c                   z-add     15            Hcasriga
298230091111     c                   z-add     36            Hcascolo
298240091112     C                   MOVEL     err(329)      wcasmsg
298250091112     c                   seton                                        90
298260091111     c* Selezionare o mittente o ordinante
298270091111     c                   when      wcassel1='X' and wcassel2='X'
298280091111     c                   z-add     15            Hcasriga
298290091111     c                   z-add     36            Hcascolo
298300091112     C                   MOVEL     err(330)      wcasmsg
298310091112     c                   seton                                        90
298320091211     c* ricontrollo il tipo incasso in base alla scelta effettuata
298330091211     c                   other
298340091211     c                   exsr      sr_trultic
298350091211     c                   if        oticerr='T' or  oticerr='C'
298360091211     C                   MOVEL     err(331)      wcasmsg
298370091214     c* eccendo anche indicatore per posizionamento su tic in seconda videata
298380091214     c                   seton                                        9049
298390091211     c                   endif
298400091111     c                   endsl
298410091111     c                   endsr
298420091119     C**************************************************************************
298430091119     C* Inizializzazione campi window scelta beneficiario D/A
298440091127     C**************************************************************************
298450091119     C     inzwdwcas     BEGSR
298460091119     c                   clear                   wcasmit
298470091119     c                   clear                   wcascor
298480091119     c                   clear                   wcasord
298490091119     c                   clear                   wcasdest
298500091119     c                   clear                   wcassel1
298510091119     c                   clear                   wcassel2
298520091211     c                   eval      nochkticC=*off
298530091119     c                   endsr
298540110516     C**************************************************************************
298550110516     C* Window per richiesta conferma annullamento
298560110516     C**************************************************************************
298570110516     C     sr_geswdwconf BEGSR
298580110516     c                   clear                   wvann
298590110516     c                   eval      $fine='0'
298600110516     c*
298610110516     c                   dow       $fine='0'
298620161202
298630161215     c* SOLO in manutenzione gestisco l'errore dopo 50 sec
298640161215     c                   if        *in12 and not *in15
298650161202     c                   write     ls01wann
298660161202     c                   read(e)   fnls01d
298670161215     c                   else
298680161215     c                   exfmt     ls01wann
298690161215     c                   endif
298700161202     c
298710161202     c* Passato tempo max 50 secondi di attesa videata: torno al sfl
298720161202     c                   if        %error
298730161202     C                   MOVEL     '6'           §LPFPR
298740161202     c                   leave
298750161202     c                   endif
298760161202
298770110516     c                   if        *inkf
298780110516     c                   eval      $fine='1'
298790110516     c                   endif
298800110516     c                   enddo
298810110516     c                   endsr
298820110519     C**************************************************************************
298830110519     C* Controllo presenza bolle da confermare
298840110519     C**************************************************************************
298850110519     C     sr_chkvab     BEGSR
298860110519    4c                   if        s_wksc<>wksc
298870110519     c                   eval      wfvab=*off
298880110519    4c                   endif
298890110519     c     wksc          setll     fivab01l
298900110519     c     wksc          setll     edivab1l
298910110519    4c                   if        (%equal(fivab01l) or %equal(edivab1l) )
298920110519     c                             and (s_wksc<>wksc or wfvab=*off)
298930110519     c                   movel     '1'           wemfor
298940110519     c                   eval      wms1=err(341)
298950110519     c                   eval      wfvab=*on
298960110519    5c*                  select
298970110519     c*                  when      %equal(fivab01l) and
298980110519     c*                            %equal(edivab1l)
298990110519     c*                  eval      wms1=err(341)
299000110519     c*                  eval      wfvab=*on
299010110519     c*                  when      %equal(fivab01l)
299020110519     c*                  eval      wms1=err(341)
299030110519     c*                  eval      wfvab=*on
299040110519     c*                  when      %equal(edivab1l)
299050110519     c*                  eval      wfvab=*on
299060110519     c*                  eval      wms1=err(341)
299070110519    5c*                  endsl
299080110519     c                   eval      $fine='0'
299090110519     c                   dow       $fine='0'
299100110519     c                   exfmt     ls01wvab
299110110519     c* f12=Ritorno
299120110519     c                   if        *inkl='1'
299130110519     c                   eval      $fine='1'
299140110519     c                   endif
299150110519     c                   enddo
299160110519     c*
299170110519    4c                   endif
299180110519     c                   eval      s_wksc=wksc
299190110519     c                   endsr
299200110902     C**************************************************************************
299210110902     C* Invio email a CED per errore valore accorpamento spedizioni in consegna
299220110902     C**************************************************************************
299230110902     C     sr_mail       BEGSR
299240110902     C* Inizializzo variabili
299250110902     C                   movel     *blanks       wrkEmlTo        253
299260110902     C                   movel     *blanks       wrkEmlCc        253
299270110902     C                   movel     *blanks       wrkMsg         5000
299280110902     C                   movel     *blanks       wrkOgg           44
299290110902     C                   movel     *blanks       wrkesito          1
299300120302     C* Valorizzo i campi della @-mail
299310120302     C                   eval      wrkEmlTo='ced@brt.it'
299320110902     c                   eval      wrkEmlCc = *blank
299330110902     C                   eval      wrkOgg='PERFECT ORDER WURTH'
299340110902     C                   eval      wrkMsg='Valore di accorpamento "'   +
299350110902     c                             §lpxco                              +
299360110902     C                             '" non presente in tabella "XCO"'   +':/N'+
299370110902     C                             ' '                                 +':/N'+
299380110902     C                             'SPEDIZIONE: ' +%editc(blplnp:'X')  +
299390110902     c                             ' ' +%editc(blpnrs:'Z') + ' '       +
299400110902     c                             %editc(blpnsp:'Z') +' '             +
299410110902     c                             %editc(blpaas:'X')                  +':/N'+
299420110902     C                             'RMN: '+%editc(blprmn:'Z')          +':/N'+
299430110902     C                             'RMA: '+blprma                      +':/N'+
299440110902     c                             ' '                                 +':/N'+
299450110902     c                             ' '
299460110902     C*
299470110902     C                   call(e)   'TIS701C1'
299480110902     C                   parm                    wrkEmlto
299490110902     C                   parm                    wrkEmlCc
299500110902     C                   parm                    wrkOgg
299510110902     C                   parm                    wrkMsg
299520110902     C                   parm                    wrkesito
299530110902     c                   endsr
299540111026     C**************************************************************************
299550111026     C* Memorizzazione dati vecchi colli per scrittura R.A.
299560111026     C**************************************************************************
299570111026     C     sr_memRA      BEGSR
299580111026     c* devo memorizzare il numero dei colli e il range dal/al prima della
299590111026     c* riassegnazione per poi poterli memorizzare nel file delle R.A.
299600111026     c* Devo memorizzare anche se si tratta di variazione di lna o di
299610111026     c* aumento colli
299620111026     c                   eval      RA_ncd=vidncd
299630111026     c                   eval      RA_nca=vidnca
299640111026     c                   eval      RA_ncl=savncl
299650111026     c                   eval      RA_lna=savlna
299660111026     c
299670111026     c                   endsr
299680111026     C**************************************************************************
299690111026     C* Richiamo pgm di scrittura R.A. per bolla modificata con riass.segnacolli
299700111026     C**************************************************************************
299710111026     C     sr_wrtRA      BEGSR
299720140507     c                   clear                   fidna6ds
299730140507     c                   eval      ida06mad=' 30'
299740140507     c                   eval      ida06tor='S'
299750140507     c                   eval      ida06ogg=%editc(blplnp:'X') +
299760140507     c                             %editc(blpnrs:'X')+
299770111026     c                             %editc(blpnsp:'X')+%editc(blpaas:'X')
299780111026     c                   move      RA_lna        wRA_lna
299790111026     c                   if        wRa_lna<>blplna
299800140507     c                   eval      ida06no2='Ex LNA'
299810140507     c                   eval      ida06no2=%trim(ida06no2)+' '+RA_lna
299820140507     c                   eval      ida06no2=%trim(ida06no2)+' colli'
299830111026     c                   else
299840140507     c                   eval      ida06no2='Ex Nr. colli'
299850111026     c                   endif
299860140507     c                   eval      ida06no2=%trim(ida06no2)+
299870140507     c                             ' '+%editc(RA_ncl:'Z')
299880140507     c                   eval      %subst(ida06no2:36:13)='Segnacolli da'
299890140507     c                   eval      ida06no2=%trim(ida06no2)+
299900140507     c                             ' '+%editc(RA_ncd:'2')
299910111026     c                   if        RA_nca>0
299920140507     c                   eval      ida06no2=%trim(ida06no2)+
299930140507     c                             ' a '+%editc(RA_nca:'2')
299940111026     c                   endif
299950140507     c                   eval      ida06ute=knmus
299960140507     c                   eval      ida06fil=simpou
299970140507     c                   call      'FIDNA6R'
299980140507     c*****              parm                    kpjba
299990140507     c                   parm                    fidna6ds
300000111026     c                   endsr
300010130304     C* CONTROLLO SE nome file PDF doppio ---------------------------*
300020130304     C     pdfdop        BEGSR
300030130307     c                   movel     dsblp0        savblp
300040130304     c     kvat          reade(N)  fivat01l
300050130304    1c                   dow       not  %eof(fivat01l)
300060130304     c                   movel     vatnot        dvatp
300070130304    2c                   if        §vatppdfn<>*blanks
300080130306     c     kar8§pdf      setll     fiar802l
300090130306     c     kar8§pdf      reade     fiar802l
300100130304    3c                   dow       not %eof(fiar802l)
300110130304     c     kblpar8       chain     fnblp01l
300120130304    4c                   if        %found(fnblp01l)
300130130304     C                   Z-ADD     BLPMGS        WDSP
300140130304     C                   MOVEL     BLPAAS        WDSP
300150130305    5C     WDSP          IFGE      datapdf
300160130304     c     blpcca        andne     '7'
300170130304     C                   MOVEL     ERR(348)      VIDMSG
300180130304     C                   SETON                                        90
300190130307     C                   MOVEL     SAVBLP        DSBLP0
300200130304     c                   leavesr
300210130304     c                   endif
300220130304     c                   endif
300230130306     c     kar8§pdf      reade     fiar802l
300240130304    3c                   enddo
300250130304    2c                   endif
300260130304     c     kvat          reade(n)  fivat01l
300270130304    1c                   enddo
300280130307     C                   MOVEL     SAVBLP        DSBLP0
300290130304     c*
300300130304     C                   ENDSR
300310130308     C* Invio messagio a Ced se cliente fornisce pdf ma non abilitato*
300320130308     C     ced_alert     BEGSR
300330130311     c                   eval      wrkEmlTo = 'CedAlert@brt.it'
300340130308     c                   eval      wrkEmlcc = *blank
300350130312     c                   eval      wrkOgg = 'PDF del cliente ' +
300360130312     c                                      %editc(§lpccn:'X') +
300370130313     c                                      ' NON ELABORATO'
300380130313     C                   eval      wrkMsg = 'Il cliente ha trasmesso FIVAT' +
300390130313     c                                      ' Tipo Rek "P" ma non è abilitato.'
300400130308     c
300410130308     C                   CALL      'TIS701C1'
300420130308     C                   PARM                    wrkEmlTo        253
300430130308     C                   PARM                    wrkEmlCc        253
300440130308     C                   PARM                    wrkOgg           44
300450130308     C                   PARM                    wrkMsg         5000
300460130308     C                   PARM                    wrkesito          1
300470130308     c                   endsr
300480130924
300490130924     C* Scrittura Fiar8 + impostazione campi per fiar5 record GEN  --*
300500130924     c     sr_gesar8     begsr
300510130924     c* Se sono in conferma bolle da dischetto e ctm che prevede fivax
300520130924     c* scrivo fiar8
300530130924     c                   clear                   w_allx
300540130924     c                   clear                   w_allm
300550130924     c                   clear                   w_alls
300560130924     c                   If        *In12 and *In15
300570130924     c                             and §1bf16 = 'S'
300580130924     c                   if        wvax='S'
300590130924     c                   exsr      sr_fiar8
300600130924     c                   endif
300610130924     c                   if        wvatp='S'
300620130924     c                   exsr      sr_fiar8_vatp
300630130924     c                   endif
300640130924     c                   endif
300650130924     c* se richiamato da pgm "Wanda" vedo se creare fiar8 oer la nuova
300660130924     c* bolla copiando i dati dal fiar8 della bolla mamma
300670130924     c   12
300680130924    1can 15savfpr        ifeq      'G'
300690130924     c     savfpr        oreq      'P'
300700130924    2c     §lpar8        ifeq      'S'
300710130924     c     kbolm         setll     fiar801l
300720130924    3c                   do        *hival
300730150929     c     kbolm         reade     fiar801l
300740130924    4c                   if        %eof(fiar801l)
300750130924     c                   leave
300760130924    4c                   endif
300770130924     c                   Eval      Ar8Aas = BlpAas
300780130924     c                   Eval      Ar8Lnp = BlpLnp
300790130924     c                   Eval      Ar8Nrs = BlpNrs
300800130924     c                   Eval      Ar8Nsp = BlpNsp
300810130924     c                   if        aggioAr8='S'
300820130924     c                   write     fiar8000
300830130924     c                   endif
300840130924    4c                   if        ar8tmd<>'§PDF'
300850130924     c                   eval      w_allx='S'
300860130924     c                   else
300870130924     c                   eval      dar8§pdf=ar8uni
300880130924     c* il secondo byte è per la mail  ('1'=invia mail)
300890130924    5c                   if        %subst(§ar8pidz:2:1)='1'
300900130924     c                   eval      w_allm='S'
300910130924    5c                   endif
300920130924     c*
300930130924    5c                   if        %subst(§ar8pidz:1:1)='1' and
300940130924    5c                             (§ar8ptrt='S' or §ar8ptrt='X')
300950130924     c                   eval      w_alls='S'
300960130924    5c                   endif
300970130924     c*
300980130924    4c                   endif
300990130924    3c                   enddo
301000130924    2c                   endif
301010130924    1c                   endif
301020130924     c                   endsr
301030150701     C**************************************************************************
301040150701     C* Richiamo pgm di aggiornamento record fisgn duplicati su altro terminal
301050150701     C**************************************************************************
301060150701     C     sr_CalSgn     BEGSR
301070150701     c* Lo faccio solo per manutenzione perchè in immissione/conferma
301080150701     c* bolle, se updato fisgn perchè lo riutilizzo (se aveva  atb= "*" )
301090150701     c* è il  gufo che gestisce la cancellazione e la duplica per eventuale
301100150701     C* altro terminal di partenza
301110150701     c                   if        *in12 and not *in15
301120150701     c                   clear                   fnlssgnds
301130150701     c                   eval      isgntnp=sgntnp
301140150701     c                   eval      isgnwho=sgnwho
301150150701     c                   call      'FNLSSGNR1'
301160150701     c                   parm                    fnlssgnds
301170150701     c                   endif
301180150701     c                   endsr
301190151014     C*--- Registro peso e volume usati perfatturaz. in FIAR5 --------*
301200151014     C     REGPesivol    BEGSR
301210151014     c                   clear                   dar5fat
301220151014     c                   Eval      kar5trd='FAT'
301230151014     c     kfiar5        Chain     Fiar531c
301240151014     c                   If        %Found(Fiar531c)
301250151014     c                   Movel     ar5uni        dar5fat
301260151014     c                   endif
301270151014     c* Se tassata
301280151014    1c                   if        vidimv>0
301290151014     c* Volume
301300151014     c                   movel     blpvlf        §ar5vltas
301310151014     c                   movel     blpfvf        §ar5fvtas
301320151014     c* Peso
301330151014     c                   movel     blppkf        §ar5pktas
301340151014     c                   movel     'R'           §ar5fptas
301350151014     c
301360151016     c* NON Gestisco lA possibilità di memorizzare il peso vdl
301370151016     c* in quanto al tnsf20r non viene mai passato il taspkc
301380151014     c                   eval      §AR5DATAS=%dec(%date())
301390151014     c                   eval      §AR5HMTAS=%dec(%time())
301400151014     c                   eval      §AR5PRTAS=knmus
301410151014     c                   eval      §AR5NJTAS=knmtd
301420151014     c*
301430151014    1c                   endif
301440151014     c
301450151014      * aggiorno Fiar5 record "FAT"
301460151014if  1c                   If        %Found(Fiar531c)
301470151014     c* Se ho eliminato la tassazione  deleto
301480151014     c                   if        vidimv=0
301490151014     c                   delete    fiar500s
301500151014     c                   else
301510151014     c                   Movel(p)  dar5fat       Ar5uni
301520151014     c                   eval      ar5dac=%dec(%date())
301530151014     c                   eval      ar5orc=%dec(%time())
301540151014     c                   Update    Fiar500s
301550151014     c                   endif
301560151014      * scrivo   Fiar5 record "FAT"
301570151014   x1c                   Else
301580151014    2c                   if        vidimv>0
301590151014     c                   Clear                   Fiar500s
301600151014     c                   Eval      Ar5Aas = blpAas
301610151014     c                   Eval      Ar5Lnp = blpLnp
301620151014     c                   Eval      Ar5Nrs = blpNrs
301630151014     c                   Eval      Ar5Nsp = blpNsp
301640151014     c                   Eval      Ar5Trd = 'FAT'
301650151014     c                   Movel(p)  dar5fat       Ar5uni
301660151014     c                   eval      ar5dac=%dec(%date())
301670151014     c                   eval      ar5orc=%dec(%time())
301680151014     c                   Eval      AR5FT1='T'
301690151014     c                   Eval      AR5DT1=99999999
301700151014     c                   Eval      AR5FT2='T'
301710151014     c                   Eval      AR5DT2=99999999
301720151014     c                   Eval      AR5FT3='T'
301730151014     c                   Eval      AR5DT3=99999999
301740151014     c                   Write     Fiar500s
301750151014    2c                   EndIf
301760151014    1c                   EndIf
301770151014     c
301780151014     c                   ENDSR
301790151104     C*--- Memorizzazione flag per addebito ORM telefonico -----------*
301800151104     C     sr_b4ado      BEGSR
301810151117     c                   clear                   w_§b4ado
301820160210     C* ** Solo se:  non è un prepagato
301830160210     C*              orm non è fittizio **
301840160210     c*              no import
301850160210    1C                   if        not *in22      and
301860160210     c                             flgfit<>'S'    and
301870160210     c                             §ogntw<>'DPD' and §ogntw<>'EEX' and
301880160210     c                             §ogntw<>'FED'
301890160210
301900151104     c* Se Orm telefonico, di default imposto flag = 'S'
301910160210    2c                   if        (ORMTCO='M' or ormtco='E')
301920160209     c                             and (not *in04 or ormpag='O')
301930151117     c                   eval      w_§b4ado='S'
301940151104     c* Pulisco il flag se:
301950151104     c* già presente altra bolla abbinata allo stesso ORM che prevede
301960151104     c* l'addebito
301970151104     c                   movel     'M'           kar4trc
301980151104     c                   movel     widorm        kar4n14
301990160209     c     kar403        setll     fiar405l
302000160209     c     kar403        reade     fiar405l
302010160210    3c                   dow       not %eof(fiar405l) and w_§b4ado='S'
302020151104     c*
302030160209     c                   eval      a_dsbl4m=ar4not
302040160210    4c                   if        a_§b4ado='S' and
302050160210     c                             ((not *in12 or *in15) or
302060160210     c                              (§lpaas<>ar4aas or §lplnp<>ar4lnp or
302070160210     c                               §lpnrs<>ar4nrs or §lpnsp<>ar4nsp) )
302080151117     c                   clear                   w_§b4ado
302090160210    4c                   endif
302100160209     c     kar403        reade     fiar405l
302110160210    3c                   enddo
302120160210    2c                   endif
302130160210    1c                   endif
302140151104     c                   endsr
302150161202     c
302160160120     C*--- Gestione window per interrogazione variaizoni fatte da arrivo
302170160120     C     sr_WdwF10     BEGSR
302180160120     c****               write     ls01d01
302190160120     c                   dow       $finef10='0'
302200160120     c                   write     ls01d01
302210160120     c                   exfmt     ls01wf10
302220160120     c                   select
302230160120     c* F10 = Visualizza variazioni
302240160120     c                   when      *inkj=*on
302250160120     C                   MOVEL     'P'           PA1TBO
302260160120     c                   eval      PA1AAS=§LPAAS
302270160120     c                   eval      PA1LNP=§LPLNP
302280160120     c                   eval      PA1NRS=§LPnrs
302290160120     c                   eval      PA1NSP=§LPNsp
302300160120     C                   MOVEL     PARAM1        KPJBU
302310160120     C                   CALL      'FNLR75R'
302320160120     C                   PARM                    KPJBA
302330160125     c* F16 = Visualizza R.A.
302340160125     c                   when      *inkq=*on
302350160126     c                   eval      wdna2lnp  = §lplnp
302360160126     c                   eval      wdna2nrs  = §lpnrs
302370160126     c                   eval      wdna2nsp  = §lpnsp
302380160126     c                   eval      wdna2aas = §lpaas
302390160125     c                   reset                   FIDNA2ds
302400160125     c                   eval      IA2ogg  = ds_OggSped
302410160125     c                   call      'FIDNA2R'
302420160125     c                   parm                    KPJBA
302430160125     c                   parm                    FIDNA2ds
302440160120     c* F12 = Ritorno
302450160120     c                   when      *inkl=*on
302460160120     c                   eval      $finef10='1'
302470160120     c                   endsl
302480160120     c                   enddo
302490160120     c                   endsr
302500160215     C*--- Verifica requisiti bolla export per instradare in DPD
302510160215     C     sr_InstrADPD  BEGSR
302520160406     c*
302530160224     c                   eval      w_aDpd='S'
302540160310     c
302550160310     c                   if        %lookup('999':sk_VPODPD)=0 and
302560160310     c                             %lookup(%editc(vidlnp:'X'):sk_VPODPD)=0
302570160310     c                   eval      w_aDpd='N'
302580160310     c                   leavesr
302590160310     c                   endif
302600160226     c* Peso bolla
302610160226    1c                   if        not*in12
302620160226     c                   z-add     vidpkg        pkgbolla
302630160226     c                   else
302640160226     c                   z-add     v2cpkg        pkgbolla
302650160226    1c                   endif
302660160226     c*
302670160226    1c                   if        deslad<=0 or
302680160226     c                             v1cncl<>1 or
302690160226     c                             pkgbolla>§3ipkd
302700160226     c                   eval      w_aDpd='N'
302710160226     c                   leavesr
302720160226    1c                   endif
302730160226
302740160406     c* recupero eventuale limite di peso e volume per nazione su tabella "16"
302750160226     C                   MOVEL     '16'          COD
302760160226     C                   MOVEL(P)  VIDNZD        KEY
302770160226     c                   clear                   ds16
302780160226     C                   EXSR      CTABEL
302790160226     C  n30              MOVEL     TBLUNI        DS16
302800160226     C   30              z-add     *hival        §16pkd
302810160406     C   30              z-add     *hival        §16vld
302820160226     c
302830160406     c* N.B: Il controllo di limite del volume verrà eseguito anche dopo
302840160406     c*      il calcolo del volume automatico (dopo l'esecuzione della routine
302850160406     c*      CALVOL)
302860160406     c                   if        pkgbolla > §16pkd  or
302870160406     c                             vidvol   > §16vld
302880160226     c                   eval      w_aDpd='N'
302890160226     c                   leavesr
302900160226     c                   endif
302910160226
302920160226     c* verifico eventuali blocchi per instradare a dpd  - TAB "IED"
302930160226     c                   clear                   fnlvdpds
302940160226     c                   eval      idplna=o95lna
302950160226     c                   eval      idpnaz=vidnzd
302960160226     c                   eval      idpccm=wksc
302970160226     c                   movel     fnlvdpds      kpjbu
302980160226     c                   call      'FNLVDPR'
302990160226     c                   parm                    kpjba
303000160226     c                   movel     kpjbu         fnlvdpds
303010160226     c                   if        odpesito='0'
303020160226     c                   eval      w_aDpd='N'
303030160226     c                   leavesr
303040160226     c                   endif
303050160226     c
303060160223     c* verifico eventuali blocchi cappario utilizzi particolari
303070160223     c                   eval      d_i97ntw='DPD'
303080160223     c                   call      'TISI97R'
303090160223     c                   parm                    dssi95
303100160223     c                   parm                    d_tisi97ds
303110160226    1c                   select
303120160224     c                   when      d_o97err<>*blanks
303130160224     c                   eval      w_aDpd='N'
303140160224     c                   leavesr
303150160224     c                   when      d_o97uti='N'
303160160224     c                   movel     d_o97flo      dcppflo
303170160226    2c                   if        §cppall='S'  or
303180160223     c                             (§cppcas='S' and i95fca='S') or
303190160223     c                             (§cpppas='S' and i95tpo='A') or
303200160223     c                             (§cpppas='O' and i95tpo='A' and
303210160223     c                              (flgfit='S' or i97ntw<>poentw))
303220160224     c                   eval      w_aDpd='N'
303230160224     c                   leavesr
303240160226    2c                   endif
303250160226    1c                   endsl
303260160222     c
303270160215     c                   endsr
303272170214     C*------------------------------------------------------------
303273170214     C*--- Impostazione SIMFEL
303274170214     C*------------------------------------------------------------
303276170214     C     sr_Simfel     BEGSR
303277170214     c* Ricevuta una LNP per cui bollettare
303278170214    1c                   if        %parms>=5 and ParLnpB>0
303279170214     c* eseguo le operazioni a cambio di LnpB
303280170214     c                   if        Parlnpb<>s_ParLnpB
303281170214     c                   eval      s_ParLnpB=ParLnpB
303282170214     c* determino il terminal di partenza che verrà assunto come SIMFEL
303284170214     C                   clear                   dslv55
303286170214     c                   eval      d55tpt='P'
303287170214     C                   move      ParLnpB       d55lin
303288170214     C                   move      dateu         d55drf
303289170214     C                   call      'FNLV55R'
303290170214     C                   parm                    dslv55
303291170214     c                   eval      simfel=d55tfp
303292170214     c                   eval      simpou=ParLnpB
303293170214     c                   if        simfel<>simpou
303294170214     c                   eval      simtpp='2'
303295170214     c                   else
303296170214     c                   eval      simtpp='1'
303297170214     c                   endif
303298170214     c                   exsr      sr_xSimfel
303299170214     c                   endif
303300170214     c                   eval      wCarSimfel='S'
303301170214   x1c                   else
303302170214     c* Non ricevuta nessuna LNP per cui bollettare
303303170214     c                   if        wCarSimfel='S'
303304170214     c                   clear                   wCarSimfel
303305170214     c                   eval      simfel=simfel_s
303306170214     c                   eval      simpou=simpou_s
303307170214     c                   eval      simtpp=simtpp_s
303308170214     c                   exsr      sr_xSimfel
303309170214     c                   endif
303310170214    1c                   endif
303311170214     c                   endsr
303312170214     C*------------------------------------------------------------
303313170214     C*--- Caricamento campi legati a SIMFEL
303314170214     C*------------------------------------------------------------
303315170214     C     sr_xSimfel    BEGSR
303316170214     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
303317170214     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
303318170214     C* PER I PREPAGATI
303319170214     C                   Z-ADD     1             X
303320170215     c                   z-add     salvatgi      g02tgi
303321170214    1C     X             DOWLE     §3IGGS
303322170214     C     PARTCH        ANDNE     'P'
303323170214     C     §LPFPR        ANDNE     'O'
303324170214    1C     X             ORLE      §3IGGP
303325170214     C     PARTCH        ANDEQ     'P'
303326170214    1C     X             ORLE      §3IGGP
303327170214     C     §LPFPR        ANDEQ     'O'
303328170214     C*
303329170214     C                   MOVEL     'F'           WFEST             1
303330170214     C*
303331170214    2C     WFEST         DOWNE     ' '
303332170214     C     G02TGI        ADD       1             GIOTGI
303333170214     C                   ADD       1             G02TGI
303334170214     C                   CALL      'XSRGI8'
303335170214     C                   PARM                    WGIDAT
303336170214     C*
303337170214     C                   Z-ADD     GIOINV        DATAPA            8 0
303338170214     C                   MOVEL     GIODAT        DATAPG            8
303339170214     C*
303340170214     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
303341170214     C                   Z-ADD     GIOINV        WDATA
303342170214     C                   CLEAR                   W0030
303343170214     C* CHAIN SUL CALENDARIO BRT
303344170214     C     KCLN          CHAIN     AZCLN01L                           30
303345170214     C   30              CLEAR                   CLNPOM
303346170214     C                   MOVEA     CLNPOM        K31
303347170214     C                   MOVEL     K31(WGG)      WFEST
303348170214     c* Se non è festivo pulisco il campo WFEST
303349170214     c     wfest         lookup    S1Y                                    30
303350170214     c                   if        not *in30
303351170214     c                   clear                   wfest
303352170214     c                   endif
303353170214     c
303354170214    2C                   ENDDO
303355170214     C*
303356170214     C                   ADD       1             X
303357170214    1C                   ENDDO
303358170214     c* trovo primo giorno lavorativo minore di oggi per bollettare in
303359170214     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
303360170214     C                   TIME                    orapgm            6 0
303361170214    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
303362170214     C                   MOVEL     'F'           WFEST             1
303363170214     c                   z-add     salvatgi      giotgi
303364170214     C*
303365170214    1C     WFEST         DOWNE     ' '
303366170214     C     salvatgi      sub       1             GIOTGI
303367170214     C                   sub       1             salvatgi
303368170214     C                   CALL      'XSRGI8'
303369170214     C                   PARM                    WGIDAT
303370170214     C*
303371170214     C                   Z-ADD     GIOINV        DATAmeno1         8 0
303372170214     C                   MOVEL     GIODAT        DATgmeno1         8 0
303373170214     C*
303374170214     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
303375170214     C                   Z-ADD     GIOINV        WDATA
303376170214     C                   CLEAR                   W0030
303377170214     C* CHAIN SUL CALENDARIO BRT
303378170214     C     KCLN          CHAIN     AZCLN01L                           30
303379170214     C   30              CLEAR                   CLNPOM
303380170214     C                   MOVEA     CLNPOM        K31
303381170214     C                   MOVEL     K31(WGG)      WFEST
303382170214     c* Se non è festivo pulisco il campo WFEST
303383170214     c     wfest         lookup    S1Y                                    30
303384170214     c                   if        not *in30
303385170214     c                   clear                   wfest
303386170214    2C                   ENDif
303387170214     c
303388170214    1C                   ENDDO
303389170214   x0c                   else
303390170214     C*
303391170214     C                   Z-ADD     dateu         DATAmeno1
303392170214     C                   MOVEL     wdtgio        DATgmeno1
303393170214    0c                   endif
303394170214     C***
303395170214     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
303396170214     C***
303397170214     C                   CLEAR                   DSUL06
303398170214     C                   MOVE      '£1'          D06COD
303399170214     C                   MOVEL     SIMFEL        D06KEY
303400170214     C                   MOVEL     'L'           D06TLA
303401170214     C                   MOVEL     DSUL06        KPJBU
303402170214     C*
303403170214     C                   CALL      'TRUL06R'
303404170214     C                   PARM                    KPJBA
303405170214     C                   MOVEL     KPJBU         DSUL06
303406170214     C                   MOVEA     LIN           L1
303407170214     C***
303408170214     C* CARICO £6
303409170214     C***
303410170214     C                   CLEAR                   DSUL06
303411170214     C                   MOVE      '£6'          D06COD
303412170214     C                   movel     SImpou        D06KEY
303413170214     C                   MOVEL     'L'           D06TLA
303414170214     C                   MOVEL     DSUL06        KPJBU
303415170214     C*
303416170214     C                   CALL      'TRUL06R'
303417170214     C                   PARM                    KPJBA
303418170214     C                   MOVEL     KPJBU         DSUL06
303419170214     C                   MOVEA     LIN           L6
303420170214      * Recupero le date delle statistiche
303421170214     c                   Clear                   dsbs02
303422170214     c                   Clear                   dSdf
303423170214     c                   Eval      T02Mod = 'C'
303424170214     c                   Eval      T02Sif = Knsif
303425170214     c                   Eval      T02Cod = 'SDF'
303426170214     c                   Movel(p)  Simfel        T02Ke1
303427170214     c                   Call      'TIBS02R'
303428170214     c                   Parm                    Kpjba
303429170214     c                   Parm                    dsbs02
303430170214     c                   If        T02Err = *Blanks
303431170214     c                   Movel     T02Uni        dSdf
303432170214     c                   EndIf
303433170214
303434170214     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
303435170214     C                   Z-ADD     SIMFEL        W0030
303436170214     C     W0030         CHAIN     AZORG01L      UNIORG               30
303437170214     C                   MOVEL     ORGFEL        WASFEL            3 0
303438170214     C                   MOVEL     ORGDF0        OG150
303439170214     C                   MOVEL     §OGDKC        WASDKC            1
303442170214     C*
303443170214     C***
303444170214     C* VEDO SE SONO SIMFEL O REMOTO
303445170214     C***
303446170214     C                   MOVEL     SIMFEL        CDU               3 0
303447170214     C*
303448170214     c     simtpp        ifeq      '2'
303449170214     c     simtpp        oreq      *blanks
303450170214     c                   movel     simpou        cdu
303451170214     C                   END
303452170214     C* LINEA DI PARTENZA --> IMPOSTO
303453170214     C  N12              MOVEL     CDU           VIDLNP
303454170214     c                   if        not *in12 or *in15
303455170214     C                   MOVEL     CDU           BLPFLB
303470170214     c                   endif
303484170214     C* VEDO SE IN L1 PRESENTE P.O. DPD
303485170214     C                   CLEAR                   WSIDPD
303486170214     C                   Z-ADD     1             II
303487170214     C     II            DOWLE     30
303488170214     C     WSIDPD        ANDEQ     *BLANKS
303489170214     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
303490170214     C  N30              MOVEL     ORGDE3        OG143
303491170214     C   30              CLEAR                   OG143
303492170214     C     §OGntw        IFEQ      'DPD'
303493170214     C                   MOVEL     'S'           WSIDPD            1
303494170214     C                   ENDIF
303495170214     C                   ADD       1             II
303496170214     C                   ENDDO
303497170214     c                   endsr
303498941221     OFNLV22P   T    LRNLR
303499011212**   GGG
3035009006111234567
303501900511**   VAR
303502941011 ** IMMISSIONE  BOLLE  PARTENZE **
303503941011 ** MANUTENZIONE BOLLE PARTENZE **
303504941011 ** CONFERMA  BOLLE  DA CLIENTI **
303505941011 ** RECUPERO  IMMISSIONE  BOLLE **
303506941011 ** RECUPERO   CONFERMA   BOLLE **
303507990602 **   IMMISSIONE   PREPAGATI    **
303508030409** RigW  Max lung.67                                             67
303509030409              Spedizione da affidare a network FedEx
303510030409         Spedizione relativa ad ORM Commissionato da FedEx
303511030409- Indicare la NATURA DELLA MERCE in lingua inglese
303512030409- Indicare PESO e VOLUME reali
303513030409- Allegare COPIA della fattura alla lettera di vettura (DDT=SI)
303514030520- Allegare ai colli gli altri documenti ritirati dal cliente
303515030409- Indicare AWB FedEx nel Riferimento mittente numerico
303516030520- Allegare alla LDV TUTTI i documenti ritirati dal cliente (DDT=SI)
303517060110       Destinatario con obbligo del DDT in fase di consegna
303518060110Allegare alla LDV l'originale del documento di trasporto (DDT=SI)
303519151015        ATTENZIONE: Spedizione con Attraversamento Doganale.
303520151015Verificare che la NATURA MERCE sia conforme alla merce riportata
303521151015sul DDT
303522040329** cmdt
303530040329OVRDBF FILE(TITAS30C) TOFILE(
303540151014OVRDBF FILE(FIAR531C) TOFILE(
303550030409** ERR
303560030417Data cons. richiesta superiore a 1 mese dalla data odierna. ENTER x forzare   01
303570950920Data Spedizione formalmente errata  o  superiore a data sospensione xx/xx/xx
303580941020L'anno di spedizione non si puo' variare
303590941020Per le bolle di RECUPERO la Data Spedizione non puo' essere minore di 3 Giorni
303600061221Data Spedizione -per Spedizioni non di Recupero- non minore del xx/xx/xxxx
303610941020Data Ritiro Merce Errata
303620960926Data Ritiro Merce Errata:già confermati i conteggi autotrasp. in questa data
303630941020Linea di PARTENZA Errata
303640941021Immessa Varia "R" per 8888 o 9999 :obbligatorio l'imp.Assicur.Se 0 da tariffa 09
303650941020Codice Bolla Errato o non utilizzabile                                        10
303660941020Discordanza tra codice bolla e codice cliente mittente
303670110217Linea di Arrivo errata o annullata o bloccata                                 12
303680941020Non si puo' variare la linea di arrivo se bolla da cliente
303690941020Immettere la linea di arrivo
303700941110Tipo Servizio Errato o non inseribile dal bollettista                         15
303710941102Codice Trattamento Merce errato
303720950125ATTENZIONE!! TIPO SERVIZIO da x-xxxxxxxx   diventa  x-xxxxxxxx
303730030415Immettere il codice cliente se immessi i dati della Consegna Richiesta        18
303740941020Data Consegna Richiesta Errata
303750150202Ora Consegna richiesta Errata o non gestibile                                 20
303760960926Codice Autotrasportatore errato
303770941020Cliente Errato o Annullato
303780941020Codice inutilizzabile: cliente che non spedisce
303790941020Se immessa"Tassazione con Tariffa Mittente" inserire anche codice cliente mitt
303800941021Se immessa la Descrizione del Mittente indicare anche il codice: 8888 o 9999  25
303810980623ATTENZIONE! Spedizione di volume > xx,xxx mc. Avvisare ROM. ENTER per forzare 26
303820030728ATTENZIONE! Il numero colli è inferiore ai bancali inseriti                   27
303830940822Nazione Errata
303840950713Sigla Operatore non utilizzabile o non immessa
303850030905L'ORM richiede la bolla in Porto xxxxxxxxx                                    30
303860031029Non immettere la particolarità C/Assegno                                      31
303870031125Immettere la particolarità varia "O" per spedizione con bancali               32
303880941020Numero Spedizione gia' esistente o non immesso
303890941020Manca Numero COLLI
303900031125Immettere la particolarità varia "B" per spedizione con bancali               35
303910040216Referente e Telefono obbligatori per bolla Export con C/A. ENTER X FORZARE    36
303920941020Manca Dettaglio colli: inserirlo con F21 !!!
303930941021PESO Errato o diverso da precedente videata
303940941020MANCA NUMERATORE BOLLE: telefonare in Sede !!!!!!!
303950941020CONTO SERVIZIO : F6  per l'Immissione !!!                                     40
303960941020MANCA NUMERATORE PER STAMPA SEGNACOLLI: Telefonare in Sede !!!!!!
303970991117NUMERATORE BOLLE/SEGNACOLLI non disponibile: RITENTARE  NUOVAMENTE !!!
303980941102Se immesso tipo immettere anche la data o l'ora Consegna Richiesta
303990941020Inoltro Forzato:  F6  per Confermare l'Immissione
304000941102Numero Colli errato o diverso dalla prima videata                             45
304010980402Immettere il peso
304020941020Manca Riferimento Mittente Numerico
304030030805Serie ORM xx non gestita - AVVISARE IL CED                                    48
304040941020Serie incongruente con codice trattamento Merce
304050941020Numero Spedizione indicato in prima videata gia' esistente
304060941020Segnacollo Errato
304070980623ATTENZIONE! Spedizione di peso > xxxxxx,x kg. Avvisare ROM. ENTER per forzare 52
304080941020Manca natura merce
304090040216Referente e Tel. obbligatori per bolla EXPORT in P.Assegnato. ENTER X FORZARE 54
304100040727Spedizione già esistente!!!! Non è possibile confermare la bolla.             55
304110040213Bolla Export FedEx inserire il Telefono del destinatario. ENTER X FORZARE     56
304120090901T.Servizio "H" non ammesso per i tempi di trazione della bolla:F12 x corregg. 57
304130040216Spedizione con consegna a PRIVATI ins. il Telefono del dest.                  58
304140941110T A S S A Z I O N E   C O N   T A R I F F A   M I T T E N T E !!!!            59
304150090901Consegna richiesta non ammessa per tipo servizio "H"                          60
304160941020Zona digitata inesistente per la linea di arrivo della bolla
304170051007Consegna richiesta MINORE della data consegna teorica.
304180941020Giorno Chiusura Errato
304190030411§§Consegna particolare errata                                                 64
304200970408Impossibile annullare bolla LEGATA                                            65
304210030411§§dice Tariffa immesso ha TIPO SERVIZIO x-xxxxxxxx, diverso da quello in bolla66
304220100517Spedizione da cliente,impossibile modificare cod.Cliente Mittente:SERIE DIVERS67
304230030411§§Importo obbligatorio se immessa la sigla varia                              68
304240050429Non si puo' variare: bolla da disk clienti
304250030411§§Per bolla con C/Assegno e' obbligatoria la varia "G"                        70
304260100319ORM non inseribile: Tipo Servizio personalizzato o da disk"B" diverso dall'ORM71
304270100208Cod.Trattam.Merce "xx" non utilizzabile:forzato da"ConfermaBolle"in 1°videata 72
304280100319ORM non inseribile: linea Arrivo personalizzata o da disk"B" diversa dall'ORM
304290100319Forzata linea di arrivo e tipo servizio come da O.R.M.                        74
304300100319Forzato Tipo Servizio come da O.R.M.                                          75
304310100319Tipo Servizio diverso da quello definito sull'O.R.M.                          76
304320030411§§bligatorio dichiarare VALORE MERCE se destinat.estero con attraversam.dogana77
304330950410Non ammessi importi con decimali per la divisa indicata
304340950410Divisa errata                                                                 79
304350100210CAP Destin.Incongruente con L.Arrivo/PESO/VOLM:correggere T.Servizio"H" in "E"80
304360960926Codice non ammesso se cliente di altro punto operativo
304370941110Impossibile usare tariffa cliente per calcolare varia "G":tariffa inesistente
304380970724Bolla legata: impossibile impostare linea di arrivo uguale a linea di partenza83
304390950208Il cliente non presenta tariffe per la bolla ITALIA o ESTERO:ENTER per forzare84
304400950220La bolla presenta un numero segnacollo = 0 : verificare con F21               85
304410940909La serie non e' quella del cliente
304420940909Totale colli del dettaglio segnacolli non corrisponde
304430160303P.IVA obbligatoria se bolla Export con attraversam. dogana                    88
304440980310Non e' possibile inserire il numero AWB                                       89
304450970415CAP Destin.Incongruente con L.Arrivo/PESO/VOLM: ENTR x forzare; F12 x corregg.90
304460030904§§CAP Destinatario incongruente con Linea Arrivo:x spediz.in F.DEP. non si forza
304470941011SEGNACOLLO DOPPIO xxxxxxx  presente su  spedizione xxxx xxx xx xxxxxxx per xxx
304480940916Importo da Assicurare = 0 : ENTER per prendere il massimo importo da Tariffa
304490940916Importo da Assicurare obbligatorio, come indicato nella tariffa del cliente
304500011211Importo da Assicurare da non immettere, come indicato nella tariffa del clien.
304510011211Importo da Ass. > DEL LIMITE IMPOSTO XXXXXXXXXX,XXX EUR:TEL.IN SEDE X AUTORIZ.96
304520940916Importo da Assicurare superiore al mandato esposto in tariffa:ENTER x Forzare
304530940919Importo C/Assegno Errato
304540941110Tipo Incasso C/Assegno inesistente o non e' da indicare
304550110217Se immesso CAP o Nazione Mit.Originale immettere tutti 3 i campi:CAP NAZ e MIT
304560090921Fermo Deposito non ammesso per tipo servizio "H"                              01
304570940919Consegna Particolare inesistente o non utilizzabile
304580940919Particolarita' C/A errata,non ammessa o non utilizzabile x il cliente indicato
304590941219Errori in Tassazione                                                           4
304600001106Se modificata la divisa, ridigitare il relativo importo
304610950102Q.ta'da fatturare = 0 per tariffa a valore:ENTER per prendere importo da assic 6
304620950103Inserire la quantita' fatturare  per tariffa a valore
304630950102Q.ta'da fatturare non inseribile per tariffa a valore:assunto importo da assic 8
304640950103Q.ta'da fatturare = 0 per tariffa a quantita'
304650950525Riferimento mitt.alfabetico obbligatorio se destin.estero con attravers.dogana
304660950410Se Imp.Assicurare e Val.Merce uguali, devono anche avere la stessa divisa     11
304670950410Se stessa divisa, importo da Assicurare e Valore Merce devono essere uguali
304680030411§§IMPOSSIBILE ANNULLARE BOLLA: gia' consegnata                                13
304690030411§§IMPOSSIBILE ANNULLARE BOLLA: bolla in consegna                              14
304700950421Zona arrivo xx da bolla cliente diversa da zona xx risultante dal Cappario    15
304710950421Data fattura prepagato deve essere dello stesso mese della data spedizione    16
304720950525Impossibile forzare LINEA ARRIVO ITALIA se destinatario estero                17
304730950525Impossibile forzare LINEA ARRIVO ESTERA se destinatario italiano              18
304740950717"Tassazione con Tariffa Mittente"ammessa solo per assegnati con mittente codif19
304750951027Bolla non confermabile: segnacollo  xxxxxxx  presente piu' volte in bolla     20
304760951027Le consegne particolari non possono essere uguali                             21
304770050714Attenzione!! Verificare Importo da Assicurare e Valore Merce. ENTER X FORZARE 22
304780960213Fermo Deposito errato                                                         23
304790960319Spedizione legata a bolla precedente: non si puo' modificare il codice bolla
304800960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio: F12 x corregg
304810960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio
304820960805Bolla cliente con dettaglio colli: impossibile modificare il numero segnacolli27
304830970704Manca provincia del Mittente in anagrafica: INSERIRLA!!!!                     28
304840961111Se "FRANCO FRONTIERA" tassare la spedizione fino a Milano indicando il PORTO  29
304850080327Tipo Servizio immesso DIVERSO da tariffa e non forzabile                      30
304860011211Importo C/Assegno SUPERIORE al limite imposto XXXXXXXXXX,XXX EUR              31
304870030411§§Per porti assegnati EXPORT, impossibile inserire l'importo da assicurare    32
304880030411§§Per bolle IMPORT, impossibile inserire l'importo da assicurare              33
304890961204Per bolle di RESO  impossibile inserire il C/Assegno
304900970115Dicitura "                non ammessa nella natura merce per bolla ESTERO     35
304910970115Dicitura "                non ammessa nella natura merce per bolla ITALIA     36
304920970128Impossibile ristampare bolla non ancora stampata                              37
304930970328Bolle di recupero devono avere per forza  NO   D D T                          38
304940011212Il CAP prevede obbligatoriamente il documento di trasporto ( SI DDT )         39
304950970408Bolle dirette a nazione con attraversamento dogana devono avere   SI   D D T
304960970414Impossibile modificare linea di arrivo: bolla legata e legame gia' inviato
304970100118Non possono esserci bolle export con servizio XXXXXXXXXX                      42
304980970528Codice bolla non utilizzabile per bolle export                                43
304990030411§§Tassazione non ammessa per P.A. export. Accettata solo la varia N           44
305000971211Non e' possibile togliere il numero A.W.B.                                    45
305010980311Numero A.W.B. obbligatorio per questo codice mittente : F18 per inserirlo     46
305020971211Ultima cifra (CHECK DIGIT) del numero A.W.B. errata: deve essere x            47
305030030805Utilizzare codice bolla xx - ritiro contestuale a consegna.                   48
305040090921T.Servizio "H" non ammesso per C/Assegno da abilitare:F12 x correggere        49
305050030808Ritiro contestuale alla consegna: non trovato ORM abbinato. AVVISARE CED.     50
305060030411§§Impossibile variare il numero colli per bolle import etichettate EUROEXPRESS51
305070000904Codici "CHI SONO" mancanti: F22 per immetterli                                52
305080030411§§lla non confermabile:presenti in bolla segn.Euroexpress doppi.F22 X corregg.53
305090000904Il nr. colli non corrisponde al tot. cod."CHI SONO". F22 X CORREGGERE         54
305100980403Segn.EuroExpress XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX già presente in altra bolla   55
305110030411§§Impossibile selezionare cliente di altro Circuito                           56
305120060921Nazione destinatario valida per DPD soltanto per bolle di RESO!!              57
305130060922CAP inutilizzabile per il network xxx                                         58
305140990610Prepagato: Immettere nelle note il TELEFONO e REFERENTE del RITIRO            59
305150990610Prepagato: premere F14 per tassare o inserire tassazione fino all'imponibile
305160030411§§Non trovata tariffa per tassare i prepagati !!                              61
305170030411§§Per i prepagati i dati della fattura sono obbligatori                       62
305180990628Immettere la prestazione ritiro: mattina o pomeriggio                         63
305190990630MANCA NUMERATORE fatture Prepagati:impossibile confermare.Inserirlo in contab 64
305200060221Importo da assicurare INFERIORE a quanto previsto dalla legge                 65
305210030411§§Per i Prepagati, Numero fattura deve essere maggiore di XXXXXX              66
305220990830Data fattura modificata perche' gia' bloccata per contabilizzazione           67
305230990915Cod.Autotrasport.incongruente con indicazione di merce a magazzino.ENTR forza 68
305240991011E' obbligatorio indicare la divisa                                            69
305250030411§§Prepagati: cliente non codificato o senza tariffa obbligatoria la divisa xxx70
305260991026Numero di decimali errato per la divisa immessa                               71
305270030411§§Prepagati: utilizzare la divisa della tariffa del cliente, xxx              72
305280991026Codice bolla non valido per prepagati                                         73
305290991130Rif.Mittente numerico contiene PARCEL DPD non valido                          74
305300991203Numero PARCEL obbligatorio per EXPORT DPD : F18 per inserirlo                 75
305310991203Non e' possibile togliere il numero PARCEL DPD                                76
305320991203Il numero PARCEL DPD inserito non è corretto                                  77
305330991206Se linea di partenza DPD la spedizione deve essere di 1 collo                 78
305340991206Se linea di arrivo DPD la spedizione deve essere di 1 collo                   79
305350991213Spedizione D.P.D. : non ammesso un peso superiore a xxxxxx,x kg.              80
305360991214Numero  PARCEL D.P.D.  gia' presente                                          81
305370000113Data fattura errata perche'gia'contabilizzata ma impossibile il cambio d'anno!82
305380020214Linea di arrivo errata: non e' una linea prevista per il network              83
305390020214Numero DPD inseribile soltanto se richiesto il network DPD per l'estero       84
305400000120Numero DPD non inseribile: attribuito in modo automatico                      85
305410060612Manca il numero DPD. Inserirlo!!                                              86
305420061030Per network xxxxxx non ammesse spedizioni con C/Assegno per la nazione indicat
305430020214Non trovate tariffe DPD per il cliente: IMPOSSIBILE utilizzare il network DPD 88
305440061011CAP no trovato su cappario D.P.D:F12 x attivazione automatica int.Cappario DPD
305450000124Numero  PARCEL D.P.D.inserito in prima videata, gia' presente !!              90
305460060109Non si posso fare bolle export DPD per clienti soluzioni "B"
305470020214Per la nazione del destinatario non è previsto il network DPD                 92
305480000508Per corretta contabilizzazione,impossibile bollettare la fattura in SOSPENSION93
305490020201Tipo servizio non ammesso per la linea di partenza indicata                   94
305500000509Se linea di partenza POSTE la spedizione deve essere di 1 collo               95
305510000509Spedizione POSTE : peso superiore a xxxxxx,x kg.  Enter per forzare!          96
305520101022Data consegna richiesta immessa errata: cade in giorno festivo                97
305530000509Consegna particolare non ammessa per spedizione POSTE                         98
305540000509Sono ammesse solo spedizioni in  FRANCO  per le  POSTE
305550000509Ammessi soltanto clienti POSTE per spedizioni POSTE                           00
305560000622CAP o localita' inutilizzabili perche' obsoleti                               01
305570000622In conferma di bolle autogenerate POSTE non si puo'cambiare la linea di arrivo
305580000627Impossibile stampare la bolla:dati in controllo e non in aggiornamento!       03
305590000725Bolle poste: utilizzabili solo cod.trattamento merce soluzioni "B"            04
305600000830Presenti in bolla codici "CHI SONO" doppi. F22 PER CORREGGERE                 05
305610000904Terminal di partenza non abilitato all'uso del DISK C                         06
305620030904§§Cliente non abilitato all'uso del DISK C                                    07
305630000918Presenti in bolla codici "CHI SONO" errati. F22 PER CORREGGERE                08
305640020308ATTENZIONE:cod."CHI SONO"                                                     09
305650161215Immettere un autotrasportatore esistente per interrogare l'O.R.M.             10
305660001024Non trovato terminal di partenza della linea di partenza. TELEFONARE IN SEDE  11
305670001024Non trovato terminal di arrivo della linea di arrivo.     TELEFONARE IN SEDE  12
305680110217
305690001220SEGNAC.DOPPIO: presente su spedizione xxxx xxx xx xxxxxxx per xxx.ENTR x FORZ.
305700150929Cliente DPD: la linea di partenza deve corrispondere ad un p.o. DPD
305710010212Immettere il numero O.R.M.                                                    16
305720010212O.R.M. inesistente                                                            17
305730010220Immettere un  O.R.M. avente p.o. ritiro uguale alla linea di partenza bolla
305740010212O.R.M. in fase non bollettabile. ENTER PER FORZARE
305750010213Forzata linea di arrivo come da O.R.M.                                        20
305760010221Dati diversi rispetto a quelli definiti sull'O.R.M. ENTER PER FORZARE         21
305770010214Il numero O.R.M. non deve essere un prepagato                                 22
305780010214Il numero O.R.M. deve essere un prepagato                                     23
305790010215Codice tariffa diverso da quello definito sull'O.R.M.                         24
305800100319Linea di arrivo diversa da quella definita sull'O.R.M.                        25
305810100319ATTENZIONE:MODIFICATO O.R.M. - Alcuni dati potrebbero aver subito variazioni  26
305820010313La bolla presenta,nel dettaglio colli,un tot.colli errato: verificare con F21 27
305830010409O.R.M. annullato
305840020207Bolla Export       in p.ass.: immettere O.R.M. reale commiss. da p.o.         29
305850010504O.R.M. utilizzabile solo in "Conferma bolle da clienti". F20 PER FORZARE
305860090921Per tipo servizio "H" non ammesse consegne per APPUNTAMENTO o SUPERMERCATI    31
305870011112Divisa scaduta                                                                32
305880011114Manca la varia 'N'                                                            33
305890011211Importo da assicurare non ammesso                                             34
305900011212Importo da assicurare > di XXXXXXXXXX,XXX EUR: VERIFICARE. ENTER PER FORZARE  35
305910011212Importo C/Assegno INFERIORE a xxxxxxxxxx,xxx EUR                              36
305920011212Importo C/Assegno > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE       37
305930011212Valore merce dichiarato obbligatorio                                          38
305940011212Valore merce dichiarato INFERIORE a xxxxxxxxxx,xxx EUR                        39
305950011212Valore merce dichiarato SUPERIORE al limite imposto xxxxxxxxxx,xxx EUR        40
305960011212Valore merce dichiarato > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE 41
305970011212Gli importi inseriti SUPERANO il limite fatturabile, xxxxxxxxxx,xxx xxx       42
305980040116§§ orto varia SUPERA il limite fatturabile, xxxxxxxxxx,xxx xxx                43
305990020214Per la nazione del destinatario non è previsto il network FedEx               44
306000030221Bolla export FedEx: non ammesse spedizioni in C/Servizio                      45
306010020214Non trovate tariffe FedEx x il cliente:IMPOSSIBILE utilizzare il network FedEx46
306020020228Per la nazione del destinatario non è previsto il network Euroexpress         47
306030020319Non trovato il progressivo della tariffa di cartello: TELEFONARE IN SEDE      48
306040020320Linea di arrivo non manutenzionabile                                          49
306050020320Manca il numeratore per l'assegnazione dell'AWB FedEx:TELEFONARE IN SEDE      50
306060020320Numeratore AWB FedEx non disponibile: RITENTARE NUOVAMENTE !!!                51
306070020320Numeratore AWB FedEx oltre il massimo del range previsto: TELEFONARE IN SEDE  52
306080020417Non ammesso cliente mittente non codificato per P.A. Euroexpress              53
306090020507Bolle di recupero per bolle firmate devono avere  per forza  SI   D D T       54
306100040608Destinatario                 :immettere la relativa consegna particolare      55
306110020611C/servizio non ammesso per un prepagato                                       56
306120020731Non è possibile indicare contemporaneamente consegne particolari 'S' e 'X'    57
306130021111Spedizione xxxx xxx xx xxxxxxx per xxx già consegnata                         58
306140021118Valore merce dichiarato obbligatorio per territori Extra CEE                  59
306150021119Se immesso prefisso "FD" o "FM" tutti i segnacolli devo avere lo stesso pref. 60
306160021119Prefisso segnacollo valido solo per bolle FedEx                               61
306170021120Immettere codice tariffa della relativa cartello FedEx                        62
306180030904§§Non ammessa tariffa FedEx Documenti: peso superiore a Kg. xxxxxx,x          63
306190021120Peso incongruente con Bolla FedEx tipo Documenti                              64
306200030904§§Peso incongruente con Bolla FedEx tipo Merci                                65
306210021209Immettere il rif.mittente alfabetico, bolla con cons.particolare Supermercati 66
306220040213Spedizione con APPUNTAMENTO inserire il Telefono del destin.                  67
306230030114Immettere il n. bancali                                                       68
306240021218Tipo bancale errato                                                           69
306250021218Non ammesso stesso tipo bancale                                               70
306260030805Immettere il tipo e il n. bancali x particolarità varie "B" o "O"             71
306270030204Spedizione con bancali, verificare peso e volume                              72
306280030204Modificato il numero dei bancali, verificare peso e volume                    73
306290030805Immettere la particolarità varie "B" o "O" per spedizione con bancali         74
306300030321Bolla con più di 500 colli non è possibile bollettare "DISK C"                75
306310030411Immettere o i dati della consegna richiesta o il numero delle ore             76
306320051215Data consegna richiesta non ammessa: oltre                                    77
306330030415Le ore da aggiungere alla delivery devono essere:  24 - 48 - 72               78
306340130312Mancano dati per la gestione del Packing List/PDF del cliente                 79
306350040603Presenti progressivi riga duplicati nei dati per stampa DDT del cliente
306360040610Bolla senza colli: tipo merce V=valore non ammesso                            81
306370040614Impossibile annullare questa bolla "£ " --> già presente anche in arrivo      82
306380040917Attenzione: inserito mittente estero, VERIFICARE. Enter per continuare        83
306390040930Codice cliente non utilizzabile                                               84
306400041012Particolarità Varie='U':consegna per Appuntamento o a Supermercati non ammessa85
306410041013Per l'O.R.M. immesso già presenti altre bolle con diverso autotrasportatore   86
306420041110Spedizione che prevede la stampa del DDT nella LdV: obbligatorio NO DDT       87
306430041126Codice particolarità varie non utilizzabile per questa linea di partenza bolla88
306440041117ATTENZIONE! Il numero parcel DPD non inizia per 84. ENTER per FORZARE         89
306450041210ATTENZIONE! Manca il logo                                                     90
306460050221Presenti numeri parcel dpd da cliente ripetuti o in numero maggiore di 1      91
306470050309ATTENZIONE: manca il codice bolla. Telefonare IMMEDIATAMENTE in sede          92
306480050914Volume obbligatorio                                                           93
306490051214Consegna richiesta supera di                                                  94
306500060103Bolla in P.Assegnato diretta a destinatario che richiede il SI DDT.ENTER x FOR95
306510060109Bolla export DPD "Disk B":codice trattamento merce errato."Chi Sono" non Autom96
306520060208Prepagato già incassato: impossibile variare totale imponibile                97
306530060324Consegna part. per Appuntamento non valida: presente data consegna "Tassativa"98
306540060612Numero Parcel DPD non valido
306550060613Manca il numeratore per l'assegnazione del Parcel DPD:TELEFONARE IN SEDE      00
306560060613Numeratore Parcel DPD non disponibile: RITENTARE NUOVAMENTE !!!               01
306570060613Numeratore Parcel DPD oltre il massimo del range previsto: TELEFONARE IN SEDE 02
306580060621ATTENZIONE! Il numero parcel DPD non inizia per 084. ENTER per FORZARE        03
306590060707Per il Tipo Incasso C/Assegno richiesto immettere anche il Mittente Originale 04
306600060707Non è possibile variare Linea Arr. passando da network NON DPD a network DPD  05
306610061109Parcel DPD errato:i caratteri iniziali non corrispondono a un Depot esistente 06
306620090827Località non servita per il tipo servizio indicato                            07
306630061109Codice Fiscale obbligatorio per Prepagato non codificato: ENTER per forzare
306640061121O.R.M. commissionato da DPD: selezionare network "DPD"                        09
306650061127Presente C.A.: impossibile annullare                                          10
306660070307Linea di Arrivo     non ammessa per un prepagato di mitt. non codificato      11
306670070620Preapagato: numero O.R.M. non modificabile
306680070806Completare l'indirizzo del destinatario                                       13
306690071023P.Iva/Cd.Fiscale obbligatori per Prepagato non codificato: ENTER per forzare  14
306700071221Linea di arrivo non modificabile:presenti spunte sulla vecchia linea di arrivo15
306710071221Per la linea di arrivo richiesta mancano le spunte: modifica non ammessa      16
306720071221Linea di arrivo estera: non utilizzabile per manutenzione bolla cliente diskB 17
306730081110Codice bolla non valido per un codice trattamento merce di recupero           18
306740090325Codice cliente errato o inesistente                                           19
306750090325Codice cliente non utilizzabile: bloccato in Piano dei Conti                  20
306760090326Attenzione:cambiando l'ORM potrebbe cambiare il cliente/tariffa per tassazione21
306770090326Tasto funzionale non abilitato                                                22
306780090429ORM commissionato da DPD: la spedizione deve essere di 1 collo                23
306790090609Manca tabella Limiti per Tipo Servizio          - TELEFONARE IN SEDE          24
306800090901ATTENZIONE! Sped."   " di n.colli > xxxxx  non ammessa                        25
306810090901ATTENZIONE! Sped."   " di peso > xxxxxx,x Kg. non ammessa                     26
306820090901ATTENZIONE! Sped."   " di volume > xx,xxx mc. non ammessa                     27
306830091008Dato obbligatorio per Porto Assegnato Import                                  28
306840091112Effettuare almeno una selezione                                               29
306850091211Selezionare il mitt. OPPURE l'ordinante ORM                                   30
306860091211Tp.incasso C/A errato --> F12 x correggere                                    31
306870100215Particolarità CONSEGNA incongruente con tipo servizio della bolla             32
306880100217Particolarità CONSEGNA non ammessa se presente consegna richiesta             33
306890100217Particolarità CONSEGNA non ammessa per bolle di recupero o in C/servizio      34
306900101105Bolle dirette a  FEDEX  devono avere   SI   D D T                             35
306910110321ATTENZIONE! Presenti spunte entrata: F16 per forzare                          36
306920110419IMPOSSIBILE ANNULLARE IL PREPAGATO: O.R.M. già ritirato                       37
306930110419O.R.M. ASSEGNATO: disassegnare l'ORM per poter annullare il prepagato         38
306940110422ATTENZIONE: inserita data ritiro più vecchia di xx gg lavorativi.ENTERxFORZARE39
306950110516Presenti errori nell'indirizzo Email Destinatario                             40
306960110519Presenti bolle da VAS non confermate per il cliente mittente: VERIFICARE      41
306970110613Avviso al destinatario non previsto per bolla export                          42
306980130131Inserire la P.Iva o il Codice Fiscale.                                        43
306990151109P.Iva obbligatoria                                                            44
307000120508P.Iva "$$" non ammessa per prepagato                                          45
307010120515Bolla con attraversamento dogana: inserire la P.Iva o Cod.Fiscale se privato  46
307020120926Non si può trasformare un franco recupero in una bolla non di recupero        47
307030130312Nome PDF per gestione DDT del cliente già presente in altra bolla.Avvisare CED48
307040130313Cliente non abilitato al PDF.                                                 49
307050140114Presenti caratteri di punteggiatura all'Inizio e/o alla Fine della Località   50
307060140417Presenti errori nel numero di cellulare del destinatario                      51
307070141203Particolarità CONSEGNA con PIN CODE non gestita per Export:non sarà registrata52
307080141201Spedizione con PIN CODE: inserire una particolarità CONSEGNA con PIN CODE     53
307090141201Particolarità CONSEGNA con PIN CODE non valida per spedizione senza PIN CODE  54
307100141202Presente PIN CODE più lungo del massimo previsto: impossibile confermare      55
307110141202Presente PIN CODE con caratteri non ammessi: impossibile confermare           56
307120141203Non è possibile modificare la Particolarità Consegna: presente PIN CODE       57
307130150226Tipo Bancale non utilizzabile per particolarità varia "                       58
307140150226Cliente non abilitato all'utilizzo del tipo bancale per particolarità varia B 59
307150150413Spedizione per EXPO: non ammesso il Contrassegno                              60
307160150414Spedizione per EXPO possibile solo per bolle Franco                           61
307170150414Spedizione per EXPO non ammessa per la linea di arrivo                        62
307180151014Particolarità CONSEGNA "  " non ammessa per spedizioni export                 63
307190151106Codice Fiscale obbligatorio.                                                  64
307200160513O.R.M. commissionato da "EEX": la spedizione deve essere instradata a "EEX"   65
307300170113Bolla disk "B" non confermabile:manca Fil.Segnac. Verificare i dati ricevuti  66
