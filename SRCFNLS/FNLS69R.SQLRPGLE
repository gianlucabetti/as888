000100080215      *PARMS CLOSQLCSR(*ENDMOD) DBGVIEW(*SOURCE) DYNUSRPRF(*OWNER)
000200080215      *PARMS OPTION(*NOXREF)
000300080215      //---------------------------------------------------------------
000400080215      //?Cancellazione records di FIVAB00F
000500080215      //?con codice cliente mittente (VABCCM) inesistente in CNACO00F
000600080215      //---------------------------------------------------------------
000700080215
000800080215     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000900080215     h alwnull(*inputonly)
001000080215
001100080215      //---------------------------------------------------------------
001200080215      //?Dichiarazione file.
001300080215      //---------------------------------------------------------------
001400080215
001500080215
001600080215      //---------------------------------------------------------------
001700080215      //?Definizione costanti.
001800080215      //---------------------------------------------------------------
001900080215
002000080215
002100080215      //---------------------------------------------------------------
002200080215      //?Definizione schiere.
002300080215      //---------------------------------------------------------------
002400080215
002500080215
002600080215      //---------------------------------------------------------------
002700080215      //?Definizione aree dati.
002800080215      //---------------------------------------------------------------
002900080215
003000080215      // - Dati utente
003100080215     d §AzUte        e ds                  extname(AZUTE00F)
003200080215     d                                     dtaara
003300080215     d §DatiUte      e ds                  extname(dDatiUte)
003400080215     d                                     dtaara
003500080215
003600080215      //---------------------------------------------------------------
003700080215      //?Definizione strutture dati.
003800080215      //---------------------------------------------------------------
003900080215
004000080215      // - Reperimento dati utente
004100080215     d TIBS34ds      e ds
004200080215
004300080215      //---------------------------------------------------------------
004400080215      //?Definizione variabili globali.
004500080215      //---------------------------------------------------------------
004600080215
004700080215      // - Strainga SQL da eseguire
004800080215     d wrkSQLstr       s            512a   varying        inz
004900080215
005000080215      //---------------------------------------------------------------
005100080215      //?Definizione procedure usate.
005200080215      //---------------------------------------------------------------
005300080215
005400080215      // - Reperimento dati utente
005500080215     d tibs34r         pr                  extpgm('TIBS34R')
005600080215     d  tibs34ds                           likeds(TIBS34ds)
005700080215
005800080215      //---------------------------------------------------------------
005900080215      //?Definizione key-list.
006000080215      //---------------------------------------------------------------
006100080215
006200080215
006300080215      //---------------------------------------------------------------
006400080215      //?Riepilogo indicatori utilizzati.
006500080215      //---------------------------------------------------------------
006600080215      //---------------------------------------------------------------
006700080215
006800080215
006900080215      //---------------------------------------------------------------
007000080215      //?M A I N - L I N E
007100080215      //---------------------------------------------------------------
007200080215
007300080215      /free
007400080215
007500080215       // Operazioni iniziali
007600080215       exsr RoutInz;
007700080215
007800080215       // Cancellazione da FIVAB00F records con codice cliente mittente
007900080215       //   (VABCCM) errato - inesistente in CNACO00F
008000080215       exsr ExecSQL;
008100080215
008200080215       // Operazioni finali
008300080215       exsr RoutEnd;
008400080215
008500080215       //--------------------------------------------------------------
008600080215       //?Operazioni iniziali.
008700080215       //--------------------------------------------------------------
008800080215       BEGSR RoutInz;
008900080215
009000080215       // Reperimento dati job
009100080215         exsr DatiJob;
009200080215
009300080215       // Impostazione opzioni per SQL
009400080215         exec SQL   set option   DynUsrPrf = *owner,
009500080215                                 CloSqlCsr = *endmod;
009600080215
009700080215       ENDSR;
009800080215
009900080215       //--------------------------------------------------------------
010000080215       //?Reperimento Dati del job (Utente/Operativi).
010100080215       //--------------------------------------------------------------
010200080215       BEGSR DatiJob;
010300080215
010400080215         in(E) §AzUte;
010500080215         if NOT %error;
010600080215           in(E) §DatiUte;
010700080215         endif;
010800080215         if %error or RSut = *blanks;
010900080215           clear TIBS34ds;
011000080215           tibs34r(tibs34ds);
011100080215           in §AzUte;
011200080215           in §DatiUte;
011300080215         endif;
011400080215
011500080215       ENDSR;
011600080215
011700080215       //--------------------------------------------------------------
011800080215       //?Cancellazione records di FIVAB00F con campo VABCCM errato
011900080215       //--------------------------------------------------------------
012000080215       BEGSR ExecSQL;
012100080215
012200080215         wrkSQLstr = 'DELETE from FIVAB00F +
012300080215                      where  VABccm  NOT IN  (+
012400080215                      select ACOksc +
012500080215                      from   CNACO00F +
012600080215                      where  ACOkut = 1 +
012700080215                        and  ACOflg = '' '' +
012800080215                        and  ACOkcc = '
012900080215                   + %char(DUTkci)
013000080215                   + ')';
013100080215
013200080215         exec SQL   execute immediate :wrkSQLstr;
013300080215
013400080215         if  sqlCode < *zero;
013500080215           dump(a);
013600080215           exsr RoutEnd;
013700080215         endif;
013800080215
013900080215       ENDSR;
014000080215
014100080215       //--------------------------------------------------------------
014200080215       //?Operazioni finali.
014300080215       //--------------------------------------------------------------
014400080215       BEGSR RoutEnd;
014500080215
014600080215         *inLR = *on;
014700080215         return;
014800080215
014900080215       ENDSR;
015000080215
015100080215      /end-free
