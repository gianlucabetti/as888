000100101206       //==============================================================
000200101206       //?STATISTICA NUMERO PAGINE DI DDT IN LDV PER CLIENTE           ?
000300101206       //==============================================================
000400101206
000500101206       //--------------------------------------------------------------
000600101206       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700101206       //--------------------------------------------------------------
000800101206
000900101206     /*PRM dbgview(*source)
001000101206     /*END
001100101206
001200101206       //--------------------------------------------------------------
001300101206       //?Specifiche di controllo.                                     ?
001400101206       //--------------------------------------------------------------
001500101206
001600101206     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700101206     h alwnull(*inputonly)
001800101206     h dftactgrp(*no) bnddir('UBBNDDIR')
001900101206
002000101206       //--------------------------------------------------------------
002100101206       //?Dichiarazione file.                                          ?
002200101206       //--------------------------------------------------------------
002300101206
002400101206       // -?Tabella "5A"/"SEDE1"?
002500101206     fTABEL00F  if   e           k disk
002600101206
002700101206       //--------------------------------------------------------------
002800101206       //?Definizione costanti.                                        ?
002900101206       //--------------------------------------------------------------
003000101206
003100101206       // -?Costanti per la definizione delle schiere con i nomi?
003200101206       //  ?degli iSeries da elaborare e delle relative librerie?
003300101206     d c_NrSyst        c                   const(2)
003400101206     d c_NrLibr        c                   const(2)
003500101206
003600101206       //--------------------------------------------------------------
003700101206       //?Definizione schiere.                                         ?
003800101206       //--------------------------------------------------------------
003900101206
004000101206       // -?iSeries & Librerie in cui gestire i files?
004100101206     d $iSystem        s                   like(currSysNetA)
004200101206     d                                     dim(c_NrSyst)
004300101206     d                                     ctdata   perrcd( 1)
004400101206     d $Libraries      s                   like(ds_Libr)
004500101206     d                                     dim(c_NrSyst)
004600101206     d                                     alt($iSystem)
004700101206
004800101206       //--------------------------------------------------------------
004900101206       //?Definizione aree dati.                                       ?
005000101206       //--------------------------------------------------------------
005100101206
005200101206       // -?Dati utente?
005300101206     d §AzUte        e ds                  extname(AZUTE00F)
005400101206     d                                     dtaara
005500101206     d §DatiUte      e ds                  extname(dDatiUte)
005600101206     d                                     dtaara
005700101206
005800101206       //--------------------------------------------------------------
005900101206       //?Definizione strutture dati.                                  ?
006000101206       //--------------------------------------------------------------
006100101206
006200101206       // -?Status ds?
006300101206     d Status         sds
006400101206     d  SDSpgm           *proc
006500101206     d  SDSprm           *parms
006600101206
006700101206       // -?Tab. "5A"/"SEDE1"?
006800101206     d ds5AS1        e ds                  inz
006900101206
007000101206       // -?Ridefinizione elenco librerie in elaborare le tabelle?
007100101206     d ds_Libr         ds                  inz
007200101206     d  $Libr                        10    dim(c_NrLibr) inz
007300101206
007400101206       //--------------------------------------------------------------
007500101206       //?Definizione variabili globali.                               ?
007600101206       //--------------------------------------------------------------
007700101206
007800101206       // -?Stringa SQL da eseguire?
007900101206     d wSQL            s           5000    inz  varying
008000101206
008100101206       // -?Nome del sistema?
008200101206     d currSysNeta     s              8a   inz
008300101206
008400101206       // -?Nome esteso Libreria/File del file tabella?
008500101206     d wLibFile        s             21a   inz
008600101206
008700101206       // -?Campi di comodo?
008800101206     d w_iSystem       s              1  0 inz
008900101206     d w_SisInf        s              3  0 inz
009000101206
009100101206       //--------------------------------------------------------------
009200101206       //?Definizione prototipi procedure.                             ?
009300101206       //--------------------------------------------------------------
009400101206
009500101206       // -?Reperimento NETA sistema AS/400 corrente?
009600101206      /copy gaitrasrc/srcProtoPr,UBRTVNETA
009700101206
009800101206       //--------------------------------------------------------------
009900101206       //?Definizione key-list.                                        ?
010000101206       //--------------------------------------------------------------
010100101206
010200101206       // -?File TABEL00F?
010300101206     d k03tabel00    e ds                  extname(TABEL00F : *key)
010400101206     d                                     prefix(k_)   inz
010500101206
010600101206       //--------------------------------------------------------------
010700101206       //?Riepilogo indicatori utilizzati.                             ?
010800101206       //--------------------------------------------------------------
010900101206       //--------------------------------------------------------------
011000101206
011100101206       //--------------------------------------------------------------
011200101206       //?M A I N - L I N E                                            ?
011300101206       //--------------------------------------------------------------
011400101206
011500101206      /free
011600101206
011700101206       // -?Operazioni iniziali?
011800101206       exsr  sr_RoutInz;
011900101206
012000101206       // -?Pulizia work-file WFPDL10F?
012100101206       exsr  sr_DelWfPDL;
012200101206
012300101206       // -?Operazioni finali?
012400101206       exsr sr_RoutEnd;
012500101206
012600101206       //--------------------------------------------------------------
012700101206       //?Operazioni iniziali.                                         ?
012800101206       //--------------------------------------------------------------
012900101206       BEGSR  sr_RoutInz;
013000101206
013100101206         *inLR = *on;
013200101206
013300101206         // -?Impostazione opzioni per SQL?
013400101206         exec sql   set  option  DynUsrPrf = *Owner,
013500101206                                 CloSqlCsr = *EndMod;
013600101206
013700101206         // -?Verifica del sistema AS/400 corrente?
013800101206         if  UBRTVNETA_Rtv(currSysNeta) <> *zero;
013900101206           exsr  sr_RoutEnd;
014000101206         endif;
014100101206         // -?Impostazione elenco librerie in stanno i files da gestire?
014200101206         //  ?(a seconda del sistema in cui si stà lavorando)?
014300101206         w_iSystem = %lookup ( %subst ( currSysNeta : 1 : 6 ) : $iSystem );
014400101206         if  w_iSystem = *zero;
014500101206           exsr  sr_RoutEnd;
014600101206         endif;
014700101206         // -?Impostazione libreria e nome esatto del work-file?
014800101206         ds_Libr  = $Libraries(w_iSystem);
014900101206         wLibFile = %trimr( $Libr(1) ) + '/WFPDL10F';
015000101206
015100101206       ENDSR;
015200101206
015300101206       //--------------------------------------------------------------
015400101206       //?Pulizia work-file WFPDL10F.                                  ?
015500101206       //--------------------------------------------------------------
015600101206       BEGSR  sr_DelWfPDL;
015700101206
015800101206         // -?Reperimento tab. "5A/SEDE1"?
015900101206         k_TBLkut = 1;
016000101206         k_TBLcod = '5A';
016100101206         k_TBLkey = 'SEDE1';
016200101206         chain  %kds(k03tabel00)  TABEL;
016300101206         if  %found(TABEL00F);
016400101206           ds5AS1 = TBLuni;
016500101206         else;
016600101206           leavesr;
016700101206         endif;
016800101206
016900101206         // -?Cancellazione vecchi record dal work-file?
017000101213         wSQL = 'DELETE from ' + %trim(wLibFile)
017100101206              + ' where WPDedt < '
017200101206              + %subst( %char( %dec( %timestamp() -
017300101206                                     %months(§5AS1pdl) ) )
017400101206                        : 1 : 8 );
017500101206
017600101206         exec SQL   execute immediate :wSQL;
017700101206
017800101206       ENDSR;
017900101206
018000101206       //--------------------------------------------------------------
018100101206       //?Operazioni finali.                                           ?
018200101206       //--------------------------------------------------------------
018300101206       BEGSR  sr_RoutEnd;
018400101206
018500101206         // -?"Chiusura" pgm?
018600101206         return;
018700101206
018800101206       ENDSR;
018900101206
019000101206       //--------------------------------------------------------------
019100101206       //?S C H I E R E   A   T E M P O   D I   C O M P I L A Z I O N E?
019200101206       //--------------------------------------------------------------
019300101206
019400101213** -?$iSystem / $Libraries:?Sistemi AS/400 & Librerie di WrkF e TABEL.?
019500101206SETRAS  GAITRAAZM FILTRA201
019600101206AS888   GAITRAAZP FILTRAPRD
