000100110620     /*PRM dbgview(*source)
001000040107      *---------------------------------------------------------------*
001100130515      * ELENCO FOGLI VIAGGIO PARTENZA IN ARRIVO     - FILTRO -        *
001200040107      *---------------------------------------------------------------*
001300040107
001400040108     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001600040107
001700040107      *---------------------------------------------------------------*
001800040107
002001130515     ffnlst7d   cf   E             workstn
002700040112      *
002800040107      *---------------------------------------------------------------*
003400040107      *
003500040107      *   S C H I E R E   - - - - - - - - - - - - - - - - - - - - - - *
003600040107      *
003703130515     d err             s             79    dim(1) ctdata perrcd(1)
004700040107      *
004800040107      *   D S   - - - - - - - - - - - - - - - - - - - - - - - - - - - *
004900040107      *
004901130515     d fnlst8ds      e ds
004902130515     d Tibs34ds      e ds                  inz
004903130515     d §azute        e ds                  Extname(Azute00f)
004904130515     d                                     dtaara
004905130515     d §Datiute      e ds                  EXTname(ddatiute)
004906130515     d                                     dtaara
006100090828
006200040107     d KPJBA         e ds
008200040123      *
008900040109      *
009200090409
009300040107      *
009400040107      *   V A R I A B I L I   - - - - - - - - - - - - - - - - - - - - *
011000040109      *
011100040109      * - Campi di comodo
011202130515     d vidTRZinv       s                   like(vidTRZ)
011206111205     d dataiso         s               d   datfmt(*iso)
011207111205     d dataeur         s               d   datfmt(*eur)
011209111205     d datacur         s               d   datfmt(*iso)
011210130515     d datacur1        s               d   datfmt(*iso)
011212111205     d flerr           s              1
011213111202      // - Campi associati al video
011214111206     d $Video          s              2    inz('D1')
018500090828      *
018600090828      * - Flags booleani
018700090828     d $Finerec        s              1    inz(*off)
018701111202     d $Fine           s               n   inz(*off)
018702111207     d $End            s               n   inz(*off)
018703111202     d $InzD01         s               n   inz(*on)
018705111205
018800081023
018801130515     d bch10           pr                  extpgm('BCH10')
018802130515     d  kpjba                              likeds(kpjba)
018803130515
018900090402      // ? PROTOTIPI ?
019000090402      /copy gaitrasrc/srcprotopr,tibs34r
019001111206
019500040107
019600040107      *===============================================================*
019700040107      *  RIEPILOGO INDICATORI                                         *
019800040107      *---------------------------------------------------------------*
019900090827      *  XX    -
020000040107      *===============================================================*
020100040107
020200040107     c     *Entry        plist
020300040107     c                   parm                    KPJBA
020400090827     c
020600040123      *
020700090331      /free
020801111202       //?Gestione video
020802111202       DOW $Fine = *off;
020805111202             exsr GesD01;
020813111202       ENDDO;
020900090610
026100090827       eval *inlr=*on;
026101111206       //-------------------------------------------------------------*
026102111206       //                                                             *
026103111206       //-------------------------------------------------------------*
026104111206       Begsr Gesd01;
026105111206       // Inizializzazione videata
026106111206          if $inzd01;
026107111206              clear vidmsg;
026108130515              clear vidtrz;
026109130515              vidtrz=%dec(datacur1 :*eur);
026110111206              *in28=*off;
026111111206              $InzD01  = *off;
026112111206          endif;
026114130515             exfmt lst7d01;
026115111206             clear vidmsg;
026116111206             *in28=*off;
026117111206             *in90=*off;
026118111206             select;
026119111206             // F3=Fine
026120111206                when *inkc;
026121111206                   $fine=*on;
026122111206                   leavesr;
026123111206                other;
026124111206                   exsr ctrd01;
026125111206                   if *in90;
026126111206                      leavesr;
026127111206                   endif;
026128111206                   if *inkf or *inkh;
026129130515                      clear fnlst8ds;
026130130515                      lst8dal=vidtrzinv;
026131130515                      lst8al=vidtrzinv;
026132130515                      kpjbu=fnlst8ds;
026133130515                      kcoaz='LST8';
026134130515                      bch10(kpjba);
026135130515                      $fine=*on;
026136130515                      leavesr;
026137111206                   endif;
026138111206             endsl;
026139111206       endsr;
026140111206       //-------------------------------------------------------------*
026141111206       // Controllo prima videata                                     *
026142111206       //-------------------------------------------------------------*
026143111206       Begsr ctrd01  ;
026144130515       if %subst(%editc(vidtrz:'X'):1:2)='00';
026145130515          test(DE) *dmy vidtrz;
026146120102          if %error;
026147120102             *in90=*on;
026148120102             *in28=*on;
026149120102             vidmsg=err(1);
026150120102             leavesr;
026151120102          else;
026152130515             dataiso=%date(vidtrz:*dmy);
026153120102          endif;
026154120102       else;
026155130515          test(DE) *eur vidtrz;
026156120102          if %error;
026157120102             *in90=*on;
026158120102             *in28=*on;
026159120102             vidmsg=err(1);
026160120102             leavesr;
026161120102          else;
026162130515             dataiso=%date(vidtrz:*eur);
026163120102          endif;
026164120102       endif;
026174111206          dataeur=dataiso;
026175130515          vidtrz=%dec(dataeur);
026176130515          vidtrzinv=%dec(dataiso);
026193111206
026194111206       endsr;
026414090402       //-------------------------------------------------------------*
026415090402       //Routine Iniziale                                             *
026500090402       //-------------------------------------------------------------*
026600090414       begsr *inzsr;
026700090402
026800090402       //Reperisco dati job
026900090917         exsr datijob;
030300090402
030400090402       EndSr;
030500040108
034400090402       //-------------------------------------------------------------*
034500090402       //Reperimento Dati del job (Utente/Operativi)                  *
034600090402       //-------------------------------------------------------------*
034700090918       Begsr DatiJob;
034800090403
034900090917          in(e) §azute;
035000090917          if not %error;
035100090917           in(e) §datiute;
035200090917          endif;
035300090917          if %error or rsut = *blanks;
035400090917           tibs34r(tibs34ds);
035500090917           in §azute;
035600090917           in §datiute;
035700090917          endif;
035701111205
035702111205       // Reperisco la data corrente
035703111205          datacur=(%date());
035704130515          datacur1=datacur +%days(1);
036000090917         endsr;
036100040108
155300111205**
155500130515Data mancante o errata                                                        01
