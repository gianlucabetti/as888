000100090929      //---------------------------------------------------------------
000200090929      //?FNLV46R - Stampa Filiali Italia
000300090929      //---------------------------------------------------------------
000400090929
000500090929     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600090929
000700090929      //---------------------------------------------------------------
000800090929      //?Dichiarazione file.
000900090929      //---------------------------------------------------------------
001000090930     fazorg04l  if   e           k disk
001100090930     ftabel00f  if   e           k disk
001200090929     ffnlv46p   o    e             printer oflind(*in99)
001300090929
001400090929      //---------------------------------------------------------------
001500090929      //?Definizione aree dati.
001600090929      //---------------------------------------------------------------
001700090929
001800090929      // - Dati utente
001900090929     d §AzUte        e ds                  extname(AZUTE00F)
002000090929     d                                     dtaara
002100090929     d §DatiUte      e ds                  extname(dDatiUte)
002200090929     d                                     dtaara
002300090929
002400090929      //---------------------------------------------------------------
002500090929      //?Definizione strutture dati.
002600090929      //---------------------------------------------------------------
002700090929
002800090929      // - Parametri ricevuti
002900090929     d fnlv45ds      e ds
003000090929     d KPJBA         e ds
003100090929
003200090929      // - Reperimento dati utente
003300090929     d TIBS34ds      e ds
003400090930
003500090930      // - Dati organigramma
003600090930     d og148         e ds
003700090930
003800090930      // - Tabella regioni
003900090930     d ds14          e ds
004000090930
004100090930      //---------------------------------------------------------------
004200090930      //?Definizione variabili globali.
004300090930      //---------------------------------------------------------------
004400090930
004500090930      // - Flags booleani
004600090930     d $stp            s               n   inz(*off)
004700090930
004800090930      // - Campi di comodo
004900090930     d key_org         s                   like(orgcre) inz
005000090930     d pdesreg         s            120
005100090930     d sav_orgcre      s                   like(orgcre) inz
005200090930
005300090930      //---------------------------------------------------------------
005400090930      //?Definizione key-list.
005500090930      //---------------------------------------------------------------
005600090930
005700090930       // - File TABEL00F
005800090930     d k03tabel      e ds                  extname(TABEL00F:*key)
005900090930     d                                     prefix(k_)
006000090930     d                                     inz
006100090929
006200090929      //---------------------------------------------------------------
006300090929      //?Definizione procedure esterne.
006400090929      //---------------------------------------------------------------
006500090929
006600090929      // - Reperimento dati utente
006700090929     d tibs34r         pr                  extpgm('TIBS34R')
006800090929     d  tibs34ds                           likeds(TIBS34ds)
006900090929
007000090929      //---------------------------------------------------------------
007100090929      //?Riepilogo indicatori.
007200090929      //---------------------------------------------------------------
007300090929
007400090929      // 99    : Overflow
007500090929
007600090929      //---------------------------------------------------------------
007700090929      //?M A I N - L I N E
007800090929      //---------------------------------------------------------------
007900090929
008000090929     c     *Entry        plist
008100090929     c                   parm                    KPJBA
008200090929     c                   parm                    fnlv45ds
008300090929
008400090929      /free
008500090929
008600090929       //?Operazioni iniziali
008700090929       exsr sr_RoutInz;
008800090930
008900090930       //?Stampo testata
009000090930       write lv46t01;
009100090930       write lv46t02;
009200090930
009300090930       //?Leggo organigramma
009400090930       setll key_org azorg04l;
009500090930       read azorg04l;
009600090930
009700090930       DOW  not %eof;
009800090930
009900090930       //?escludo annullati e varie
010000090930         IF  orgfva = *blanks and orgfag <> 'V';
010100090930       //?escludo le filiali non attive e le estere
010200090930           og148 = orgde8;
010300090930           IF  §ogbd1 = 'S' and §ogbd2 = 'S';
010400090930
010500090930       //?stampo regione a rottura
010600090930             IF  orgcre <> sav_orgcre;
010700090930       //?decodifico regione
010800090930               clear ds14;
010900090930               k_tblkut = 1;
011000090930               k_tblcod = '14';
011100090930               k_tblkey = %editc(orgcre:'X');
011200090930               chain  %kds(K03tabel) TABEL00F;
011300090930               IF  not %found( TABEL00F ) or TBLflg <> *blanks;
011400090930                 clear pdesreg;
011500090930               ENDIF;
011600090930
011700090930               ds14 = TBLuni;
011800090930               pdesreg = §14des;
011900090930               sav_orgcre = orgcre;
012000090930               write lv46r01;
012100090930             ENDIF;
012200090930
012300090930         IF *in99;
012400090930       //?Salto pagina
012500090930           write lv46t01;
012600090930           write lv46r01;
012700090930           *in99 = *off;
012800090930         ENDIF;
012900090930
013000090930       //?stampo dettaglio
013100090930             write lv46d01;
013200090930             $stp = *on;
013300090930           ENDIF;
013400090930         ENDIF;
013500090930
013600090930         read azorg04l;
013700090930       ENDDO;
013800090930
013900090930       //?stampo riga finale
014000090930       IF  $stp;
014100090930         write lv46f01;
014200090930       ENDIF;
014300090929
014400090929       //?Operazioni finali
014500090929       exsr sr_RoutEnd;
014600090929
014700090929       //--------------------------------------------------------------
014800090929       //?Operazioni iniziali.
014900090929       //--------------------------------------------------------------
015000090929       BEGSR sr_RoutInz;
015100090929
015200090929         //?Reperimento dati job
015300090929         exsr sr_DatiJob;
015400090929
015500090929       ENDSR;
015600090929
015700090929       //--------------------------------------------------------------
015800090929       //?Reperimento Dati del job (Utente/Operativi).
015900090929       //--------------------------------------------------------------
016000090929       BEGSR sr_DatiJob;
016100090929
016200090929         in(E) §AzUte;
016300090929         IF  NOT %error;
016400090929           in(E) §DatiUte;
016500090929         ENDIF;
016600090929         IF  %error or RSut = *blanks;
016700090929           clear TIBS34ds;
016800090929           tibs34r(tibs34ds);
016900090929           in §AzUte;
017000090929           in §DatiUte;
017100090929         ENDIF;
017200090929
017300090929       ENDSR;
017400090929
017500090929       //--------------------------------------------------------------
017600090929       //?Operazioni finali.
017700090929       //--------------------------------------------------------------
017800090929       BEGSR sr_RoutEnd;
017900090929
018000090929         *inLR = *on;
018100090929         return;
018200090929
018300090929       ENDSR;
