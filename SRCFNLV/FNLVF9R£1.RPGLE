000100161213      //---------------------------------------------------------------
000200161213      //?FNLVF9R - Controllo se Autista accreditato alla data
000300161213      //---------------------------------------------------------------
000400161213     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500161213
000600161213      //---------------------------------------------------------------
000700161213      //?Dichiarazione file.
000800161213      //---------------------------------------------------------------
000900161213      // - Certificazioni Autisti
001000161213     fAITRA03L  if   e           k disk
001100161213
001200161213      //---------------------------------------------------------------
001300161213      //?Definizione costanti.
001400161213      //---------------------------------------------------------------
001500161213
001600161213      //---------------------------------------------------------------
001700161213      //?Definizione schiere.
001800161213      //---------------------------------------------------------------
001900161213      // - Messaggi di errore
002000161213     d Msg             s             78    dim(11) ctdata perrcd(1)
002100161213
002200161213      //---------------------------------------------------------------
002300161213      //?Definizione aree dati.
002400161213      //---------------------------------------------------------------
002500161213      // - Dati utente
002600161213     d §AzUte        e ds                  extname(AZUTE00F)
002700161213     d                                     dtaara
002800161213     d §DatiUte      e ds                  extname(dDatiUte)
002900161213     d                                     dtaara
003000161213
003100161213      //---------------------------------------------------------------
003200161213      //?Definizione strutture dati.
003300161213      //---------------------------------------------------------------
003400161213      // - Status
003500161213     d Psds           sds
003600161213     d   SDSpgm          *proc
003700161213
003800161213      // - Parametri ricevuti
003900161213     d KPJBA         e ds
004000161213     d FNLVF9DS      e ds                  qualified
004100161213
004200161213      //---------------------------------------------------------------
004300161213      //?Definizione variabili globali.
004400161213      //---------------------------------------------------------------
004500161213      // - Flags booleani
004600161213     d Accreditato     s               n   inz(*off)
004700161213     d ErrGrave        s               n   inz(*off)
004800161213     d Fine            s               n   inz(*off)
004900161213
005000161213      //---------------------------------------------------------------
005100161213      //?Definizione procedure esterne.
005200161213      //---------------------------------------------------------------
005300161213
005400161213      //---------------------------------------------------------------
005500161213      //?Definizione prototipi utilizzati.
005600161213      //---------------------------------------------------------------
005700161213
005800161213      //---------------------------------------------------------------
005900161213      //?Definizione key-list.
006000161213      //---------------------------------------------------------------
006100161213
006200161213      //---------------------------------------------------------------
006300161213      //?Riepilogo indicatori.
006400161213      //---------------------------------------------------------------
006500161213
006600161213      //---------------------------------------------------------------
006700161213      //?M A I N - L I N E
006800161213      //---------------------------------------------------------------
006900161213     c     *ENTRY        plist
007000161213     c                   parm                    FNLVF9DS
007100161213
007200161213      /free
007300161213
007400161213       //?Operazioni iniziali
007500161213       exsr RoutInz;
007600161213
007700161213       //?Controllo
007800161213       exsr Controlla;
007900161213
008000161213       //?Operazioni finali
008100161213       exsr RoutEnd;
008200161213
008300161213       //--------------------------------------------------------------
008400161213       //?Operazioni iniziali.
008500161213       //--------------------------------------------------------------
008600161213       BEGSR RoutInz;
008700161213
008800161214         clear fnlvf9ds.OLVF9ok;
008900161213         clear fnlvf9ds.OLVF9err;
009000161213         clear fnlvf9ds.OLVF9msg;
009100161214
009200161214       //?Se non è stata passata la data la imposto = oggi
009300161214         IF  fnlvf9ds.ILVF9data = 0;
009400161214           fnlvf9ds.ILVF9data = %dec(%date());
009500161214         ENDIF;
009600161213
009700161213       ENDSR;
009800161213
009900161213       //--------------------------------------------------------------
010000161213       //?Controllo se Autista Accreditato alla data.
010100161213       //--------------------------------------------------------------
010200161213       BEGSR Controlla;
010300161213
010400161213         chain (fnlvf9ds.ILVF9pdr) AITRA03L;
010500161213       //?Non lo trovo vuol dire che non è accreditato
010600161213         IF  not %found(AITRA03L);
010700161213           fnlvf9ds.OLVF9ok = *off;
010800161213           leavesr;
010900161213         ENDIF;
011000161213       //?Deve essere accreditato alla data
011100161213         IF  TRAdfi > 0 or
011200161213            (TRAdfi = 0 and fnlvf9ds.ILVF9data < TRAdin);
011300161213           setgt  (fnlvf9ds.ILVF9pdr) AITRA03L;
011400161213           readpe (fnlvf9ds.ILVF9pdr) AITRA03L;
011500161213           DOW  not %eof(AITRA03L);
011600161213             IF  fnlvf9ds.ILVF9data >= TRAdin and
011700161213                 fnlvf9ds.ILVF9data <= TRAdfi;
011800161213               fnlvf9ds.OLVF9ok = *on;
011900161213               leave;
012000161213             ENDIF;
012100161213             readpe (fnlvf9ds.ILVF9pdr) AITRA03L;
012200161213           ENDDO;
012300161214           IF  fnlvf9ds.OLVF9ok = *on;
012400161214             leavesr;
012500161214           ENDIF;
012600161214           fnlvf9ds.OLVF9ok = *off;
012700161213         ENDIF;
012800161213
012900161213       ENDSR;
013000161213
013100161213       //--------------------------------------------------------------
013200161213       //?Operazioni finali.
013300161213       //--------------------------------------------------------------
013400161213       BEGSR RoutEnd;
013500161213
013600161213         *inLR = *on;
013700161213         return;
013800161213
013900161213       ENDSR;
014000161213
014100161213      /end-free
