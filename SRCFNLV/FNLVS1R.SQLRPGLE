000100121205      //---------------------------------------------------------------
000200121205      //?FNLVS1R - DETTAGLIO ERRORI INDIRIZZI IP
000300121205      //---------------------------------------------------------------
000400121205
000500121205     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000600121205
000700121205      //---------------------------------------------------------------
000800121205      //?Dichiarazione file.
000900121205      //---------------------------------------------------------------
001000121205     fFNLVS1D   cf   e             workstn
001100121205     f                                     sfile(LVS1S02 : S02nrr)
001200121205     f                                     indds(IndDspF)
001300121205     f                                     infds(InfDspF)
001400121205
001500121205      //---------------------------------------------------------------
001600121205      //?Definizione costanti.
001700121205      //---------------------------------------------------------------
001800121205
001900121205      // - Tasti funzionali a video
002000121205     d c_F01           c                   const(x'31')
002100121205     d c_F02           c                   const(x'32')
002200121205     d c_F03           c                   const(x'33')
002300121205     d c_F04           c                   const(x'34')
002400121205     d c_F05           c                   const(x'35')
002500121205     d c_F06           c                   const(x'36')
002600121205     d c_F07           c                   const(x'37')
002700121205     d c_F08           c                   const(x'38')
002800121205     d c_F09           c                   const(x'39')
002900121205     d c_F10           c                   const(x'3A')
003000121205     d c_F11           c                   const(x'3B')
003100121205     d c_F12           c                   const(x'3C')
003200121205     d c_F13           c                   const(x'B1')
003300121205     d c_F14           c                   const(x'B2')
003400121205     d c_F15           c                   const(x'B3')
003500121205     d c_F16           c                   const(x'B4')
003600121205     d c_F17           c                   const(x'B5')
003700121205     d c_F18           c                   const(x'B6')
003800121205     d c_F19           c                   const(x'B7')
003900121205     d c_F20           c                   const(x'B8')
004000121205     d c_F21           c                   const(x'B9')
004100121205     d c_F22           c                   const(x'BA')
004200121205     d c_F23           c                   const(x'BB')
004300121205     d c_F24           c                   const(x'BC')
004400121205     d c_Enter         c                   const(x'F1')
004500121205
004600121205     d Digits          c                   const('0123456789')
004700121205
004800121205      //---------------------------------------------------------------
004900121205      //?Definizione schiere.
005000121205      //---------------------------------------------------------------
005100121205      // - Messaggi di errore
005200121205     d wMsg            s             78    dim(30) ctdata perrcd(1)
005300121205
005400121205      //---------------------------------------------------------------
005500121205      //?Definizione aree dati.
005600121205      //---------------------------------------------------------------
005700121205      // - Dati utente
005800121205     d §AzUte        e ds                  extname(AZUTE00F)
005900121205     d                                     dtaara
006000121205     d §DatiUte      e ds                  extname(dDatiUte)
006100121205     d                                     dtaara
006200121205
006300121205      //---------------------------------------------------------------
006400121205      //?Definizione strutture dati.
006500121205      //---------------------------------------------------------------
006600121205      // - Status
006700121205     d Psds           sds
006800121205     d   SDSpgm          *proc
006900121205
007000121205      // - InfDS
007100121205     d InfDspF         ds
007200121205     d  dsp_aid              369    369a
007300121205     d  dsp_rig              370    370
007400121205     d  dsp_col              371    371
007500121205
007600121205      // - Indicatori su DspF
007700121205     d IndDspF         ds
007800121205        // - Indicatori di gestione del subfile
007900121205     d  SflDsp_N                      1n   overlay(IndDspF : 30)
008000121205     d  SflDspCtl_N                   1n   overlay(IndDspF : 31)
008100121205     d  SflEnd                        1n   overlay(IndDspF : 32)
008200121205        // - Indicatori di errore
008300121205     d  ErrMessage                    1n   overlay(IndDspF : 28)
008400121205        // - Indicatore di pozionamento cursore
008500121205     d  PosCurDAL                     1n   overlay(IndDspF : 50)
008600121205     d  PosCurAL                      1n   overlay(IndDspF : 51)
008700121205        // - Indicatori di errore generico
008800121205     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008900121205
009000121205
009100121205      // Campi di comodo per gestione indicatori a video
009200121205     d WindDspF        ds                  inz
009300121205     d   WindDspFa             1     49    inz(*zero)
009400121205     d   WindDspFb            50     99    inz(*zero)
009500121205
009600121205      // - Controllo data
009700121205     d wlbdat          ds                  inz
009800121205     d  g02dat                 1      8  0
009900121205     d  g02inv                 9     16  0
010000121205     d  g02err                17     17
010100121205     d  g02tgi                18     22  0
010200121205
010300121205      // - Parametri ricevuti
010400121205     d KPJBA         e ds
010500121205
010600121205      // - Reperimento dati utente
010700121205     d TIBS34ds      e ds
010800121205
010900121205      //---------------------------------------------------------------
011000121205      //?Definizione variabili globali.
011100121205      //---------------------------------------------------------------
011200121205
011300121205      // - Flags booleani
011400121205     d wFine           s               n   inz(*off)
011500121205     d wEoF            s               n   inz(*off)
011600121205     d wErrGrave       s               n   inz(*off)
011700121205     d wInzD01         s               n   inz(*on)
011800121205     d wInzS02         s               n   inz(*off)
011900121205
012000121205      // - Indici di schiera
012100121205     d xx              s              3  0 inz
012200121205
012300121205      // - Campi associati al video
012400121205     d wVideo          s              2    inz('D1')
012500121205     d S02nrr          s              4  0 inz
012600121205
012700121205      // - Campi di comodo data
012800121205     d wDataEUR        s               d   datfmt(*eur)
012900121205     d wDataISO        s               d   datfmt(*iso)
013000121205     d wData           s              8  0 inz
013100121205     d wDatadal        s              8  0 inz
013200121205     d wDataal         s              8  0 inz
013300121205     d wOggi           s              8  0 inz
013400121205
013500121205       // - Stringa SQL da eseguire
013600121205     d StringaSQL      s           2048    varying        inz
013700121205
013800121205      // - Campi di comodo
013900121205     d wconta          s             10i 0
014000121205     d wfilusr         s              3a
014100121205     d wfilip          s              3a
014200121205
014300121205      //---------------------------------------------------------------
014400121205      //?Definizione procedure usate.
014500121205      //---------------------------------------------------------------
014600121205
014700121205      //---------------------------------------------------------------
014800121205      //?Definizione prototipi.
014900121205      //---------------------------------------------------------------
015000121205      /copy gaitrasrc/srcprotopr,tibs34r
015100121205      /copy gaitrasrc/srcprotopr,xsrda8
015200121205
015300121205      //---------------------------------------------------------------
015400121205      //?Definizione key-list.
015500121205      //---------------------------------------------------------------
015600121205
015700121205      //---------------------------------------------------------------
015800121205      //?Riepilogo indicatori.
015900121205      //---------------------------------------------------------------
016000121205
016100121205
016200121205      //---------------------------------------------------------------
016300121205      //?M A I N - L I N E
016400121205      //---------------------------------------------------------------
016500121205
016600121205     c     *Entry        plist
016700121205     c                   parm                    KPJBA
016800121205
016900121205      /free
017000121205
017100121205       //?Operazioni iniziali
017200121205       exsr RoutInz;
017300121205
017400121205       exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
017500121205
017600121205       //?Gestione video
017700121205       DOW not wFine;
017800121205         SELECT;
017900121205           WHEN wVideo = 'D1';
018000121205             exsr GesD01;
018100121205           WHEN wVideo = 'S2';
018200121205             exsr GesS02;
018300121205           OTHER;
018400121205             wFine = *on;
018500121205         ENDSL;
018600121205       ENDDO;
018700121205
018800121205       //?Operazioni finali
018900121205       exsr RoutEnd;
019000121205
019100121205       //--------------------------------------------------------------
019200121205       //?Operazioni iniziali.
019300121205       //--------------------------------------------------------------
019400121205       BEGSR RoutInz;
019500121205
019600121205       //?Reperimento dati job
019700121205         exsr DatiJob;
019800121205
019900121205       //?Imposto la data del giorno
020000121205         wOggi = %dec(%date());
020100121205         wDataISO = %date(wOggi:*iso);
020200121205         wDataEUR = wDataISO;
020300121205         wData = %dec(wDataEUR);
020400121205
020500121205       ENDSR;
020600121205
020700121205       //--------------------------------------------------------------
020800121205       //?Reperimento Dati del job (Utente/Operativi).
020900121205       //--------------------------------------------------------------
021000121205       BEGSR DatiJob;
021100121205
021200121205         in(E) §AzUte;
021300121205         IF not %error;
021400121205           in(E) §DatiUte;
021500121205         ENDIF;
021600121205         IF %error or RSut = *blanks;
021700121205           clear TIBS34ds;
021800121205           tibs34r(tibs34ds);
021900121205           in §AzUte;
022000121205           in §DatiUte;
022100121205         ENDIF;
022200121205
022300121205       ENDSR;
022400121205
022500121205       //--------------------------------------------------------------
022600121205       //?Gestione videata D01.
022700121205       //--------------------------------------------------------------
022800121205       BEGSR GesD01;
022900121205
023000121205       //?Inizializzazione videata
023100121205         IF  wInzD01;
023200121205           exsr InzD01;
023300121205           wInzD01 = *off;
023400121205         ENDIF;
023500121205
023600121205       //?Emissione videata
023700121205         write LVS1T01;
023800121205         exfmt LVS1D01;
023900121205         ErrMessage  = *off;
024000121205         ErrGenerico = *off;
024100121205         clear V01msg;
024200121205
024300121205         SELECT;
024400121205
024500121205       //?F03 = Fine
024600121205           WHEN dsp_aid = c_F03;
024700121205             exsr F03D01;
024800121205             leavesr;
024900121205
025000121205       //?F06 = Conferma
025100121205           WHEN dsp_aid = c_F06;
025200121205             exsr CtrD01;
025300121205             IF  ErrGenerico;
025400121205               leavesr;
025500121205             ENDIF;
025600121205             exsr F06D01;
025700121205
025800121205       //?Enter
025900121205           OTHER;
026000121205         //?Controllo i dati
026100121205             exsr CtrD01;
026200121205             IF  ErrGenerico;
026300121205               leavesr;
026400121205             ENDIF;
026500121205         ENDSL;
026600121205
026700121205       ENDSR;
026800121205
026900121205       //--------------------------------------------------------------
027000121205       //?Inizializzazione videata D01.
027100121205       //--------------------------------------------------------------
027200121205       BEGSR InzD01;
027300121205
027400121205         V01datadal = wData;
027500121205         V01dataal  = wData;
027600121205         V01pgm = SDSpgm;
027700121205
027800121205       ENDSR;
027900121205
028000121205       //--------------------------------------------------------------
028100121205       //?Controllo videata D01.
028200121205       //--------------------------------------------------------------
028300121205       BEGSR CtrD01;
028400121205
028500121205         WindDspF = IndDspF;
028600121205         reset WindDspFb;
028700121205         IndDspF  = WindDspF;
028800121205
028900121205       //?Data dal
029000121205         IF  V01datadal = 0;
029100121205           ErrMessage   = *on;
029200121205           ErrGenerico  = *on;
029300121205           PosCurDAL    = *on;
029400121205           V01msg       = wMsg(01);
029500121205           leavesr;
029600121205         ENDIF;
029700121205
029800121205         clear wlbdat;
029900121205         G02dat = V01datadal;
030000121205         xsrda8(wlbdat);
030100121205         IF  G02err = '1';
030200121205           ErrMessage  = *on;
030300121205           ErrGenerico = *on;
030400121205           PosCurDAL   = *on;
030500121205           V01msg      = wMsg(01);
030600121205           leavesr;
030700121205         ENDIF;
030800121205
030900121205         V01datadal = G02dat;
031000121205         wDatadal   = G02inv;
031100121205
031200121205       //?Data al
031300121205         IF  V01dataal = 0;
031400121205           ErrMessage  = *on;
031500121205           ErrGenerico = *on;
031600121205           PosCurAL    = *on;
031700121205           V01msg      = wMsg(01);
031800121205           leavesr;
031900121205         ENDIF;
032000121205
032100121205         clear wlbdat;
032200121205         G02dat = V01dataal;
032300121205         xsrda8(wlbdat);
032400121205         IF  G02err = '1';
032500121205           ErrMessage  = *on;
032600121205           ErrGenerico = *on;
032700121205           PosCurAL    = *on;
032800121205           V01msg      = wMsg(01);
032900121205           leavesr;
033000121205         ENDIF;
033100121205
033200121205         V01dataal = G02dat;
033300121205         wDataal   = G02inv;
033400121205
033500121205       //?Data congruente
033600121205         IF  wDatadal > wDataal;
033700121205           ErrMessage  = *on;
033800121205           ErrGenerico = *on;
033900121205           PosCurDAL   = *on;
034000121205           V01msg      = wMsg(02);
034100121205           leavesr;
034200121205         ENDIF;
034300121205
034400121205       ENDSR;
034500121205
034600121205       //--------------------------------------------------------------
034700121205       //?Gestione tasto funzionale F3 da videata D01.
034800121205       //?F3=Fine
034900121205       //--------------------------------------------------------------
035000121205       BEGSR F03D01;
035100121205
035200121205         //?Chiusura del programma
035300121205         wFine = *on;
035400121205
035500121205       ENDSR;
035600121205
035700121205       //--------------------------------------------------------------
035800121205       //?Gestione tasto funzionale F06 da videata D01.
035900121205       //?F06=Conferma
036000121205       //--------------------------------------------------------------
036100121205       BEGSR F06D01;
036200121205
036300121205       //?Imposto i dati per la videata sucessiva
036400121205         wvideo  = 'S2';
036500121205         winzS02 = *on;
036600121205
036700121205       ENDSR;
036800121205
036900121205       //--------------------------------------------------------------
037000121205       //?Gestione videata S02.
037100121205       //--------------------------------------------------------------
037200121205       BEGSR GesS02;
037300121205
037400121205       //?Inizializzazione videata
037500121205         IF  wInzS02;
037600121205           exsr InzS02;
037700121205           wInzS02 = *off;
037800121205         ENDIF;
037900121205
038000121205       //?Visualizzazione del SFL (se ci sono dati)
038100121205         SflDsp_N = (S02nrr <= *zeros);
038200121205
038300121205       //?Posizionamento cursore al 1° rcd della pagina
038400121205         IF  V02csr > *zero;
038500121205           V02rcd = V02csr;
038600121205         ELSE;
038700121205           V02rcd = 1;
038800121205         ENDIF;
038900121205
039000121205         V02csr = V02rcd;
039100121205
039200121205       //?Emissione Testata e Piede con tasti funzionali abilitati
039300121205         write  LVS1T01;
039400121205         write  LVS1Z02;
039500121205
039600121205       //?Emissione videata
039700121205         exfmt  LVS1C02;
039800121205         reset ErrMessage;
039900121205         reset ErrGenerico;
040000121205         clear V02msg;
040100121205
040200121205         SELECT;
040300121205
040400121205       //?- F03=Fine
040500121205           WHEN  dsp_aid = c_F03;
040600121205             exsr F03D01;
040700121205
040800121205       //?- F12=Ritorno
040900121205           WHEN  dsp_aid = c_F12;
041000121205             exsr F12S02;
041100121205
041200121205       //?Invio
041300121205           OTHER;
041400121205
041500121205         ENDSL;
041600121205
041700121205       ENDSR;
041800121205
041900121205       //--------------------------------------------------------------
042000121205       //?Inizializzazione videata S02.
042100121205       //--------------------------------------------------------------
042200121205       BEGSR InzS02;
042300121205
042400121205       //?Pulisco il subfile
042500121205         SflDsp_N    = *on;
042600121205         SflDspCtl_N = *on;
042700121205         write LVS1C02;
042800121205         SflDspCtl_N = *off;
042900121205         SflEnd      = *off;
043000121205
043100121205         clear V02rcd;
043200121205         clear V02csr;
043300121205         clear S02nrr;
043400121205         clear V02msg;
043500121205         ErrMessage  = *off;
043600121205         ErrGenerico = *off;
043700121205
043800121205         WindDspF    = IndDspF;
043900121205         reset WindDspFb;
044000121205         IndDspF     = WindDspF;
044100121205
044200121205         wEoF = *off;
044300121205
044400121205       //?Carico i dati nel subfile
044500121205         exec sql
044600121205           DECLARE PSL cursor for
044700121205           SELECT substr(PSLusr, 3, 3),
044800121205                  substr(PSLindip, 4, 3),
044900121205                  count(*) as conta
045000121205           FROM FILTRA201/FIPSL00F
045100121205           WHERE PSLerr = 'I' and
045200121205                 substr(PSLusr, 3, 3) <>
045300121205                 substr(PSLindip, 4, 3) and
045400121205                 substr(PSldtorar, 1, 8) between
045500121205                 :wDatadal and :wDataal
045600121205           GROUP BY substr(PSLusr, 3, 3),
045700121205                    substr(PSLindip, 4, 3);
045800121205
045900121205       //?Apertura del cursore
046000121205         exec sql
046100121205           open PSL;
046200121205
046300121205         IF sqlcode < 0;
046400121205           wEoF = *on;
046500121205         ENDIF;
046600121205
046700121205         DOW not wEoF;
046800121205           exec sql
046900121205             FETCH next from PSL into :wfilusr, :wfilip, :wconta;
047000121205
047100121205           IF sqlcod = 100 or sqlcod < 0;
047200121205             wEof = *on;
047300121205             leave;
047400121205           ENDIF;
047500121205
047600121205       //?Carico il subfile
047700121205           V02filusr = wfilusr;
047800121205           V02filip  = wfilip;
047900121205           V02nrerr  = wconta;
048000121205           S02nrr += 1;
048100121205           write LVS1S02;
048200121205
048300121205         ENDDO;
048400121205
048500121205         exec sql
048600121205           close PSL;
048700121205
048800121205         SflEnd = *on;
048900121205
049000121205       ENDSR;
049100121205
049200121205       //--------------------------------------------------------------
049300121205       //?Gestione tasto funzionale F12 da videata S02.
049400121205       //?F12=Ritorno
049500121205       //--------------------------------------------------------------
049600121205       BEGSR F12S02;
049700121205
049800121205       //?Ritorno alla prima videata
049900121205         wVideo  = 'D1';
050000121205         wInzD01 = *on;
050100121205
050200121205       ENDSR;
050300121205
050400121205
050500121205       //--------------------------------------------------------------
050600121205       //?Operazioni finali.
050700121205       //--------------------------------------------------------------
050800121205       BEGSR RoutEnd;
050900121205
051000121205         *inLR = *on;
051100121205         return;
051200121205
051300121205       ENDSR;
051400121205
051500121205      /end-free
051600121205       //--------------------------------------------------------------
051700121205       //?Schiere a tempo di compilazione.
051800121205       //--------------------------------------------------------------
051900121205
052000121205** - wMSG -------------------------------------------------------------------*
052100121205Data errata                                                                   01
052200121205Data DAL maggiore di data AL                                                  02
