000100130726     H DECEDIT('0,') DATEDIT(*DMY.)   datfmt(*iso)
000200130726     H CVTOPT(*VARCHAR)  DFTACTGRP(*NO) ACTGRP('QILE')
000300131122
000301131122     D cmd             S            200A
000302131122     D/COPY GAITRASRC/SRCPROTOPR,SYSTEM
000401131122
000402131122     C*    *ENTRY        PLIST
000403131122     C*                  PARM                    kpjba
000404131122
005200130726      /free
005201131122
007000131122           exec sql
007100131122              DROP TABLE QTEMP/XCDC;
007101131122
007102131122           exec sql
007103131122             CREATE TABLE QTEMP/XCDC AS (
007104131122               SELECT CHAR ( CDC.ENTSOCIETA CONCAT ' ' -- SOCIETA
007105131122               CONCAT 'XCDC' -- SEGM
007106131122               CONCAT LEFT(CDC.ENTENTITA, 3) CONCAT REPEAT(' ', 17) -- CODICE1
007107131122               CONCAT REPEAT(' ', 20) -- CODICE2
007108131122               CONCAT REPEAT(' ', 20) -- CODICE3
007109131122               CONCAT 'A' -- FLPROVE
007110131122               CONCAT SUBSTR(CDC.ENTDESCR, 1, 40) -- DESCR1
007111131122               CONCAT REPEAT(' ', 40) -- DESCR2
007112131122               CONCAT CASE CDC.ENTDTIN WHEN '1940-01-01' THEN REPEAT(' ', 8)
007113131122               ELSE REPLACE(CHAR(CDC.ENTDTIN, ISO), '-', '') END -- DATAINI
007114131122               CONCAT CASE CDC.ENTDTFIN WHEN '0001-01-01' THEN REPEAT(' ', 8)
007115131122               ELSE REPLACE(CHAR(CDC.ENTDTFIN, ISO), '-', '') END -- DATAFIN
007116131122               CONCAT REPEAT(' ', 410), 575) AS XCDC
007117131122               FROM ANENT00F AS CDC
007118131122               JOIN ANSIF00F ON CDC.ENTSOCIETA = SIFSOCIETA
007119131122               WHERE CDC.ENTTPRIFAN = 'CDC' AND SIFSOCFITT = '0'
007120131122               AND SIFDTFIVL = '01.01.0001'
007121131122               ORDER BY CDC.ENTSOCIETA, CDC.ENTTPRIFAN, CDC.ENTENTITA
007122131122               ) WITH DATA;
007129131122
007130131122                IF SQLCOD < 0 ;
007131131122                  DUMP(A);
007132131122                  RETURN;
007133131122                ENDIF;
007134131122
007135131122
007136131122
007137131122               cmd = 'CPYTOIMPF FROMFILE(QTEMP/XCDC) +
007138131122                 TOSTMF(''/Bartolini/Piteco/anag/XCDC.TXT'') +
007139131122                 MBROPT(*REPLACE) STMFCCSID(*PCASCII) +
007140131122                 RCDDLM(*CRLF) DTAFMT(*FIXED)';
007141131122
007142131122
007143131122               IF executeCommand(cmd) <> 0;
007144131122              // rpyEsito = -1;
007145131122              // rpyOpCode = exceptionMessageID;
007146131122                  DUMP(A);
007147131122                  RETURN;
007148131122               ENDIF;
007150131122
007151131122
007152131122
007153131122
007154131122             // if sqlState > '03';
007155131122             //   DUMP(A);
007156131122             //   logTxt = 'ERRORE SQL ' + sqlState;
007157131122             //   EXCEPT log;
007158131122             //   ExecuteCommand('DSPJOBLOG OUTPUT(*PRINT)');
007159131122             //     RETURN;
007160131122
007161131122
007162131122           exec sql
007163131122              DROP TABLE QTEMP/XCDC;
007164131122                IF SQLCOD < 0 ;
007165131122                  DUMP(A);
007166131122                  RETURN;
007167131122                ENDIF;
007168131122
007169131122
007170131122
007171131122
007172131122
007173131122
007174131122
007175131122
007176131122
007177131122
007178131122
007179131122
013800130806               *inlr = *on;
013900130806               return;
014000130806      /end-free
