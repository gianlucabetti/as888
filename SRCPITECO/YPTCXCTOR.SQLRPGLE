000100130726     H DECEDIT('0,') DATEDIT(*DMY.)   datfmt(*iso)
000200130726     H CVTOPT(*VARCHAR)  DFTACTGRP(*NO) ACTGRP('QILE')
000300131122
000301131122     D cmd             S            200A
000302131122     D/COPY GAITRASRC/SRCPROTOPR,SYSTEM
005201131122
005202170529       *inlr = *on;
005203170529
007000170529       EXEC SQL DROP TABLE QTEMP/XCTO;
007101131122
007102170529       exec sql
007103170529         CREATE TABLE QTEMP/XCTO AS (
007104170529         SELECT CHAR ( KSC.RCOSOCIETA CONCAT ' ' -- SOCIETA
007105170529         CONCAT 'XCTO' -- SEGM
007106170529         CONCAT KSC.RCOKCC CONCAT '/' CONCAT KSC.RCOKSC
007107170529         CONCAT REPEAT(' ', 5) -- CODICE1
007108170529         CONCAT REPEAT(' ', 20) -- CODICE2
007109170529         CONCAT REPEAT(' ', 20) -- CODICE3
007110170529         CONCAT 'A' -- FLPROVE
007111170529         CONCAT SUBSTR(KSC.PDCDESCR, 1, 40) -- DESCR1
007112170529         CONCAT SUBSTR(KCC.PDCDESCR, 1, 40) -- DESCR2
007113170529         CONCAT REPEAT(' ', 8) -- DATAINI
007114170529         CONCAT CASE KSC.RCODTANN WHEN '0001-01-01' THEN REPEAT(' ', 8)
007115170529         ELSE REPLACE(CHAR(KSC.RCODTANN, ISO), '-', '') END -- DATAFIN
007116170529         CONCAT REPEAT(' ', 112)
007117170529         CONCAT REPEAT('0', 5) -- CAP
007118170529         CONCAT REPEAT(' ', 194)
007119170529         CONCAT REPEAT('0', 5) -- CAPAPP
007120170529         CONCAT REPEAT(' ', 94)
007121170529         , 575) AS XCTO
007122170529         FROM ANRCO99J AS KSC
007123170529         JOIN ANSIF99V  ON KSC.PDCSOCIETA = SIFSOCIETA
007124170529         JOIN ANPDC00F AS KCC ON KSC.PDCSOCIETA = KCC.PDCSOCIETA
007125170529         AND KSC.PDCKCC = KCC.PDCKCC AND '' = KCC.PDCKSC
007126170529         WHERE KSC.PDCKSC <> '' AND KSC.RCOMOVIMLE = '1'
007127170529         AND KSC.RCOTPCONTO = 'CG' AND KSC.RCOSNATURA NOT IN ('C','F')
007128170529         ) WITH DATA;
007129131122
007130170529       IF SQLCOD < 0 ;
007131170529         DUMP(A);
007132170529         RETURN;
007133170529       ENDIF;
007134170529
007135170529       // Aggiungo clienti e fornitori infragruppo.
007136170529
007137170529       EXEC SQL
007138170529         INSERT INTO QTEMP/XCTO
007139170529         SELECT CHAR ( RCOSOCIETA CONCAT ' ' -- SOCIETA
007140170529         CONCAT 'XCTO' -- SEGM
007141170529         CONCAT RCOKCC CONCAT '/' CONCAT RCOKSC
007142170529         CONCAT REPEAT(' ', 5) -- CODICE1
007143170529         CONCAT REPEAT(' ', 20) -- CODICE2
007144170529         CONCAT REPEAT(' ', 20) -- CODICE3
007145170529         CONCAT 'A' -- FLPROVE
007146170529         CONCAT SUBSTR(SOGDES, 1, 40) -- DESCR1
007147170529         CONCAT REPEAT(' ', 40) -- DESCR2
007148170529         CONCAT REPEAT(' ', 8) -- DATAINI
007149170529         CONCAT CASE RCODTANN WHEN '0001-01-01' THEN REPEAT(' ', 8)
007150170529         ELSE REPLACE(CHAR(RCODTANN, ISO), '-', '') END -- DATAFIN
007151170529         CONCAT REPEAT(' ', 112)
007152170529         CONCAT REPEAT('0', 5) -- CAP
007153170529         CONCAT REPEAT(' ', 194)
007154170529         CONCAT REPEAT('0', 5) -- CAPAPP
007155170529         CONCAT REPEAT(' ', 94)
007156170529         , 575) AS XCTO
007157170529         FROM ANRCO98J
007158170529         WHERE RCOSOCIETA IN (SELECT SIFSOCIETA FROM ANSIF99V)
007159170529           AND RCOSNATURA IN ('C','F') AND RCOUNITA = '500';
007162170529
007163170529       IF SQLCOD < 0 ;
007164170529         DUMP(A);
007165170529         RETURN;
007166170529       ENDIF;
007167131122
007168170529       cmd = 'CPYTOIMPF FROMFILE(QTEMP/XCTO) +
007169170529         TOSTMF(''/Bartolini/Piteco/anag/XCTO.TXT'') +
007170170529         MBROPT(*REPLACE) STMFCCSID(*PCASCII) +
007171170529         RCDDLM(*CRLF) DTAFMT(*FIXED)';
007172131122
007173170529       IF executeCommand(cmd) <> 0;
007174170529         DUMP(A);
007175170529         RETURN;
007176170529       ENDIF;
007177131122
007178170529       EXEC SQL DROP TABLE QTEMP/XCTO;
007179170529
007180170529       IF SQLCOD < 0 ;
007181170529         DUMP(A);
007182170529         RETURN;
007183170529       ENDIF;
007184131122
013900170529       RETURN;
