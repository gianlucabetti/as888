000100130726     H DECEDIT('0,') DATEDIT(*DMY.)   datfmt(*iso)
000200130726     H CVTOPT(*VARCHAR)  DFTACTGRP(*NO) ACTGRP('QILE')
000300131122
000301131122     D cmd             S            200A
000302131122     D/COPY GAITRASRC/SRCPROTOPR,SYSTEM
000401131122
000402131122     C*    *ENTRY        PLIST
000403131122     C*                  PARM                    kpjba
000404131122
005200130726      /free
005201131122
007000131122           exec sql
007100131122              DROP TABLE QTEMP/XCTO;
007101131122
007102131122           exec sql
007103131122             CREATE TABLE QTEMP/XCTO AS (
007104131122             SELECT CHAR ( KSC.RCOSOCIETA CONCAT ' ' -- SOCIETA
007105131122             CONCAT 'XCTO' -- SEGM
007106131122             CONCAT KSC.RCOKCC CONCAT '/' CONCAT KSC.RCOKSC
007107131122             CONCAT REPEAT(' ', 5) -- CODICE1
007108131122             CONCAT REPEAT(' ', 20) -- CODICE2
007109131122             CONCAT REPEAT(' ', 20) -- CODICE3
007110131122             CONCAT 'A' -- FLPROVE
007111131122             CONCAT SUBSTR(KSC.PDCDESCR, 1, 40) -- DESCR1
007112131122             CONCAT SUBSTR(KCC.PDCDESCR, 1, 40) -- DESCR2
007113131122             CONCAT REPEAT(' ', 8) -- DATAINI
007114131122             CONCAT CASE KSC.RCODTANN WHEN '0001-01-01' THEN REPEAT(' ', 8)
007115131122             ELSE REPLACE(CHAR(KSC.RCODTANN, ISO), '-', '') END -- DATAFIN
007116131122             CONCAT REPEAT(' ', 112)
007117131122             CONCAT REPEAT('0', 5) -- CAP
007118131122             CONCAT REPEAT(' ', 194)
007119131122             CONCAT REPEAT('0', 5) -- CAPAPP
007120131122             CONCAT REPEAT(' ', 94)
007121131122             , 575) AS XCTO
007122131122             FROM ANRCO99J AS KSC
007123131122             JOIN ANSIF99V  ON KSC.PDCSOCIETA = SIFSOCIETA
007124131122             JOIN ANPDC00F AS KCC ON KSC.PDCSOCIETA = KCC.PDCSOCIETA
007125131122             AND KSC.PDCKCC = KCC.PDCKCC AND '' = KCC.PDCKSC
007126131122             WHERE KSC.PDCKSC <> '' AND KSC.RCOMOVIMLE = '1'
007127131122             AND KSC.RCOTPCONTO = 'CG' AND KSC.RCOSNATURA NOT IN ('C','F')
007128131122             ) WITH DATA;
007129131122
007130131122                IF SQLCOD < 0 ;
007131131122                  DUMP(A);
007132131122                  RETURN;
007133131122                ENDIF;
007134131122
007135131122
007136131122
007137131122               cmd = 'CPYTOIMPF FROMFILE(QTEMP/XCTO) +
007138131122                 TOSTMF(''/Bartolini/Piteco/anag/XCTO.TXT'') +
007139131122                 MBROPT(*REPLACE) STMFCCSID(*PCASCII) +
007140131122                 RCDDLM(*CRLF) DTAFMT(*FIXED)';
007141131122
007142131122
007143131122               IF executeCommand(cmd) <> 0;
007144131122                  DUMP(A);
007146131122                  RETURN;
007147131122              // rpyEsito = -1;
007150131122              // rpyOpCode = exceptionMessageID;
007152131122               ENDIF;
007154131122
007155131122
007156131122
007157131122
007158131122             // if sqlState > '03';
007159131122             //   DUMP(A);
007160131122             //   logTxt = 'ERRORE SQL ' + sqlState;
007161131122             //   EXCEPT log;
007162131122             //   ExecuteCommand('DSPJOBLOG OUTPUT(*PRINT)');
007163131122             //     RETURN;
007164131122
007165131122
007166131122           exec sql
007167131122              DROP TABLE QTEMP/XCTO;
007168131122                IF SQLCOD < 0 ;
007169131122                  DUMP(A);
007170131122                  RETURN;
007171131122                ENDIF;
007172131122
007173131122
007174131122
007175131122
007176131122
007177131122
007178131122
007179131122
007180131122
007181131122
007182131122
007183131122
013800130806               *inlr = *on;
013900130806               return;
014000130806      /end-free
