000100040603     H*PARMS OPTION(*NOXREF *NODEBUGIO)
000200040603     H*PARMS DFTACTGRP(*NO) BNDDIR(PJXBND) ACTGRP(QILE)
000300040603     H*PARMS CVTOPT(*NONE)
000400040603      **********************************************************************
000500040603     H DECEDIT('0,') DATEDIT(*DMY.)
000600040603      **********************************************************************
000700040603      *
000800040603      *            Mod. 770 Tipi record A/B/Z
000900040603      *           ----------------------------
001000040603      *
001100040603      **********************************************************************
001200040603      *------------
001300040621D1630X****ND77099F  UF   E             DISK
001400040621D1630FND77099F  UF   E             DISK    USROPN
001500040608     F                                     INFDS(RRNPFDS)                       *
001600040603      *------------
001700040603     FNDCR85D   CF   E             WORKSTN
001800040603     F                                     RENAME(CR85D1:FMTD1)
001900040603     F                                     RENAME(CR85DA1:FMTDA1)
002000040603     F                                     RENAME(CR85DA2:FMTDA2)
002100040603     F                                     RENAME(CR85DA3:FMTDA3)
002200040603     F                                     RENAME(CR85DB1:FMTDB1)
002300040603     F                                     RENAME(CR85DB2:FMTDB2)
002400040603     F                                     RENAME(CR85DB3:FMTDB3)
002500040603     F                                     RENAME(CR85DB4:FMTDB4)
002600060621C1943F                                     RENAME(CR85DB5:FMTDB5)
002700040603     F                                     RENAME(CR85DZ1:FMTDZ1)
002800040603     F                                     RENAME(CR85DZ2:FMTDZ2)
002900040603     F                                     RENAME(CR85DZ3:FMTDZ3)
003000040603     F                                     RENAME(CR85T1:FMTT1)
003100040603     F                                     RENAME(CR85Z1:FMTZ1)
003200040608     F                                     RENAME(CR85Z2:FMTZ2)
003300040609     F                                     INFDS(DSFMT)
003400040603      **********************************************************************
003500040603      *Tipo operazione (da mettere sotto il titolo)
003600040603      * numero tipo operaz
003700040603     D $OZ             S              2    DIM(5) CTDATA PERRCD(1)
003800040603      * percorso IdMsg x tipo operaz.
003900040603     D $ID             S             27    DIM(5) ALT($OZ)
004000040603      *----------------------------------------------------*
004100040603      *Schiere tasti funzione generiche
004200040603      * percorso IdMsg
004300040603     D $FM             S             27    DIM(24)
004400040603      *  testo msg
004500040603     D $FX             S             50    DIM(24)
004600040603      * abilitazione ('0'/'1')
004700040603     D $FC             S              1    DIM(24)
004800040603      *  tipo abilitazione ('S'/'N')
004900040603     D $FR             S              1    DIM(24)
005000040608      *----------------------------------------------------*
005100040608      * Tasti funzione D1
005200040608     D $FM1            S             27    DIM(24) CTDATA PERRCD(1)
005300040608     D $FX1            S             50    DIM(24) ALT($FM1)
005400040608     D $FC1            S              1    DIM(24) CTDATA PERRCD(1)
005500040608     D $FR1            S              1    DIM(24) ALT($FC1)
005600040603      *----------------------------------------------------*
005700040608      * Tasti funzione A1-2-3/B1-2-3-4/Z1-2-3
005800040608     D $FM2            S             27    DIM(24) CTDATA PERRCD(1)
005900040608     D $FX2            S             50    DIM(24) ALT($FM2)
006000040608     D $FC2            S              1    DIM(24) CTDATA PERRCD(1)
006100040608     D $FR2            S              1    DIM(24) ALT($FC2)
006200040603      *----------------------------------------------------*
006300040603      * Schiera contente i nomi dei programmi da richiamare con i tasti
006400040603      * funzione personalizzati
006500040603     D $PGF1           S             10    DIM(25)
006600040603      *----------------------------------------------------*
006700040608      * dimensioni variabili che conterranno i tasti D1
006800040603     D $D1L01          S              3  0
006900040603     D $D1L02          S              3  0
007000040608      * dimensioni variabili che conterranno i tasti An/Bn/Zn
007100040608     D $DxL01          S              3  0
007200040608     D $DxL02          S              3  0
007300040603      *----------------------------------------------------*
007400040603    > * Inserire qui la definizione di altre variabili per reperire
007500040603    > * la lunghezza di altre videate che usano un piede diverso da
007600040603    > * STD
007700040603      *----------------------------------------------------*
007800040603      * Passaggio Parametri
007900040603     D KPJBA         E DS
008000040603      *----------------------------------------------------*
008100040603      * DS Esterna gestione messaggi
008200040603     D XMSGDS        E DS
008300040603     D  STS          E                     EXTFLD(MSGSTS)
008400040603     D                                     DIM(333)
008500040603     D  JBA          E                     EXTFLD(MSGJBA)
008600040603     D                                     DIM(502)
008700040603      *----------------------------------------------------*
008800040603      * Reperimento Autorizzazioni
008900040603     D AUTDS         E DS                  EXTNAME(XCHKAUTDS)
009000040603      *------
009100040603      * Passaggio Autorizzazioni
009200040603     D DSAUT           DS           512
009300040603      *----------------------------------------------------*
009400040603      * Maschera dati autorizzazioni
009500040603    >D*______DS      E DS
009600040603      *----------------------------------------------------*
009700040603      * Reperimento nome PGM
009800040603     D STATUS         SDS           333
009900040603     D  DSPGM            *PROC
010000040603     D  PARMS            *PARMS
010100040603      *----------------------------------------------------*
010200040603      * Dati di ambiente ottenuti da XSOC
010300040603     D SOC001        E DS                  EXTNAME(XSOC001DS)
010400040603      *-------------
010500040603      * DS Interna per dati di output di XSOC
010600040603     D XSOCDS          DS          1000
010700040603      *----------------------------------------------------*
010800040603      * Passaggio Parametri
010900040603     D NDCR85DS      E DS
011000040603      *----------------------------------------------------*
011100040603      * campo di salvataggio per la DS d'ingresso durante la chiamata
011200040603      * alla funzione personalizzata
011300040603     D $SaveDS         S                   like(NDCR85DS)
011400040603      *----------------------------------------------------*
011500040603     D DSFMT           DS
011600040603     D  $TASTO               369    369
011700040603     D  NRG                  370    370
011800040603     D  NCL                  371    371
011900040603      *----------------------------------------------------*
012000040603      * DS per UserExit
012100040603     D XUKDS         E DS                  EXTNAME(XUSRKEYDS) inz
012200040603      *----------------------------------------------------*
012300040603      * posizione cursore
012400040603     D CURSOR          DS
012500040603     D  RIRI                   1      2B 0 INZ
012600040603     D  R$$                    2      2
012700040603     D  COCO                   3      4B 0 INZ
012800040603     D  C$$                    4      4
012900040603      *----------------------------------------------------*
013000040603      * Costanti
013100040603      *----------------------------------------------------*
013200040603      * Tasti di funzione
013300040603     D F01             C                   CONST(X'31')
013400040603     D F02             C                   CONST(X'32')
013500040603     D F03             C                   CONST(X'33')
013600040603     D F04             C                   CONST(X'34')
013700040603     D F05             C                   CONST(X'35')
013800040603     D F06             C                   CONST(X'36')
013900040603     D F07             C                   CONST(X'37')
014000040603     D F08             C                   CONST(X'38')
014100040603     D F09             C                   CONST(X'39')
014200040603     D F10             C                   CONST(X'3A')
014300040603     D F11             C                   CONST(X'3B')
014400040603     D F12             C                   CONST(X'3C')
014500040603     D F13             C                   CONST(X'B1')
014600040603     D F14             C                   CONST(X'B2')
014700040603     D F15             C                   CONST(X'B3')
014800040603     D F16             C                   CONST(X'B4')
014900040603     D F17             C                   CONST(X'B5')
015000040603     D F18             C                   CONST(X'B6')
015100040603     D F19             C                   CONST(X'B7')
015200040603     D F20             C                   CONST(X'B8')
015300040603     D F21             C                   CONST(X'B9')
015400040603     D F22             C                   CONST(X'BA')
015500040603     D F23             C                   CONST(X'BB')
015600040603     D F24             C                   CONST(X'BC')
015700040603     D ENTER           C                   CONST(X'F1')
015800040603     D ROLDWN          C                   CONST(X'F4')
015900040603     D ROLLUP          C                   CONST(X'F5')
016000040603      *----------------------------------------------------*
016100040603      * Sottotitolo di testata
016200040603     D SOTTIT          C                   CONST(' ')
016300040603      *----------------------------------------------------*
016400040603      * Variabili per gestione videate
016500040603     D $Gest           S              2A
016600040603     D $Fine           S              1A
016700040603     D $InzDX          S              1A
016800040609     D $InzD1          S              1A
016900040603     D $LastG          S              2A
017000040603     D $LastV          S              2A
017100040603      *----------------------------------------------------*
017200040603      * Variabili appoggio sempre presenti in tutte le anagrafiche
017300040603     D CurR            S              2S 0
017400040603     D CurC            S              2S 0
017500040603     D Win             S             99A
017600040603      *----------------------------------------------------*
017700040603      * Variabili appoggio specifiche della singola anagrafica
017800040603      *----------------------------------------------------*
017900040603      *  Indici
018000040603     D X               S              3S 0
018100040603     D Y               S              3S 0
018200040603      *----------------------------------------------------*
018300040603      * Indice della schiera tasti funzione
018400040603     D PosFun          S              2  0
018500040608      *----------------------------------------------------*
018600040608      * OpzR85 usato in parzializzazione
018700040608      * e WOpzR85 valorizzato dalla parzializzazione per manutenzione
018800040608     D WOpzR85         S                   like(OpzR85)
018900040609      *----------------------------------------------------*
019000040609     D $RecOk          S              1a
019100040608      *----------------------------------------------------*
019200040608      * Nr rec ND77099F  per aggiornarlo
019300040608     D  RrnPfDs        DS           512                                         *
019400040608     D   RrnPf               397    400B 0                                      *
019500040608      *----------------------------------------------------*
019600040608      * Tipo record "A"
019700040608      *----------------------------------------------------*
019800040609     D TpRecADS        DS
019900040609      *A1
020000040610     D  DA00101A
020100040610     D  DA00101
020200040609     D  DA00201
020300040609     D  DA00202
020400040609     D  DA00203
020500040609     D  DA00204
020600040609     D  DA00205
020700040609     D  DA00206
020800040609     D  DA00207
020900040609     D  DA00301
021000040609     D  DA00401
021100040609     D  DA00402
021200040609      *A2
021300040609     D  DA00501
021400040609     D  DA00502
021500040609     D  DA00503
021600040609     D  DA00504
021700040609     D  DA00505
021800040609     D  DA00506
021900040609     D  DA00507
022000040609     D  DA00508
022100040609     D  DA00509
022200040609     D  DA00510
022300040609     D  DA00511
022400040609     D  DA00512
022500040609     D  DA00513
022600040609     D  DA00514
022700040609      *A3
022800040609     D  DA00515
022900040609     D  DA00516
023000040609     D  DA00517
023100040609     D  DA00518
023200040609     D  DA00519
023300040609     D  DA00619
023400050704C1846X*****------------------------------------
023500050704  "  X***** Tipo record "B"
023600050704  "  X*****------------------------------------
023700050704  "  X**** TpRecBDS        DS
023800050704  "  X*****B1
023900050704  "  X****  DB00101B
024000050704  "  X****  DB00101
024100050704  "  X****  DB00102
024200050704  "  X****  DB00201
024300050704  "  X****  DB00301
024400050704  "  X****  DB00401
024500050704  "  X****  DB00402
024600050704  "  X****  DB00403
024700050704  "  X****  DB00404
024800050704  "  X****  DB00501
024900050704  "  X*****B2
025000050704  "  X****  DB00601
025100050704  "  X****  DB00602
025200050704  "  X****  DB00603
025300050704  "  X****  DB00604
025400050704  "  X****  DB00605
025500050704  "  X****  DB00701
025600050704  "  X****  DB00702
025700050704  "  X****  DB00703
025800050704  "  X****  DB00704
025900050704  "  X****  DB00705
026000050704  "  X****  DB00706
026100050704  "  X*****B3
026200050704  "  X****  DB00801
026300050704  "  X****  DB00802
026400050704  "  X****  DB00803
026500050704  "  X****  DB00804
026600050704  "  X****  DB00805
026700050704  "  X****  DB00901
026800050704  "  X****  DB01001
026900050704  "  X****  DB01101
027000050704  "  X*B4
027100050704  "  X****  DB01201
027200050704  "  X****  DB01301
027300050704  "  X****  DB01401
027400050704  "  X****  DB01402
027500050704  "  X****  DB01403
027600050704  "  X****  DB01404
027700050704  "  X****  DB01501
027800050704C1846X****  DB01601
027900060621C1943X*ex C1846  *------------------------------------
028000060621  "  X*ex C1846  * Tipo record "B" - 2005
028100060621  "  X*ex C1846  *------------------------------------
028200060621  "  X*ex C1846  TpRecBDS        DS
028300060621  "  X*ex C1846  B1
028400060621  "  X*ex C1846  DB00101B
028500060621  "  X*ex C1846  DB00101
028600060621  "  X*ex C1846  DB00102
028700060621  "  X*ex C1846  DB00201
028800060621  "  X*ex C1846  DB00301
028900060621  "  X*ex C1846  DB00401
029000060621  "  X*ex C1846  DB00402
029100060621  "  X*ex C1846  DB00403
029200060621  "  X*ex C1846  DB00404
029300060621  "  X*ex C1846  DB00501
029400060621  "  X*ex C1846  B2
029500060621  "  X*ex C1846  DB00601
029600060621  "  X*ex C1846  DB00602
029700060621  "  X*ex C1846  DB00603
029800060621  "  X*ex C1846  DB00604
029900060621  "  X*ex C1846  DB00605
030000060621  "  X*ex C1846  DB00701
030100060621  "  X*ex C1846  DB00702
030200060621  "  X*ex C1846  DB00703
030300060621  "  X*ex C1846  DB00704
030400060621  "  X*ex C1846  DB00705
030500060621  "  X*ex C1846  B3
030600060621  "  X*ex C1846  DB00801
030700060621  "  X*ex C1846  DB00802
030800060621  "  X*ex C1846  DB00803
030900060621  "  X*ex C1846  DB00804
031000060621  "  X*ex C1846  DB00805
031100060621  "  X*ex C1846  DB00806
031200060621  "  X*ex C1846  DB00901
031300060621  "  X*ex C1846  DB01001
031400060621  "  X*ex C1846  B4
031500060621  "  X*ex C1846  DB01101
031600060621  "  X*ex C1846  DB01102
031700060621  "  X*ex C1846  DB01201
031800060621  "  X*ex C1846  DB01301
031900060621  "  X*ex C1846  DB01302
032000060621  "  X*ex C1846  DB01303
032100060621  "  X*ex C1846  DB01401
032200060621  "  X*ex C1846  DB01501
032300060621C1943X*ex C1846  DB01601
032400070423c2014x*------------------------------------
032500070423  "  x* Tipo record "B" - 2006     ex c1943
032600070423  "  x*------------------------------------
032700070423  "  x*TpRecBDS        DS
032800070423  "  x*B1
032900070423  "  x* DB00101B
033000070423  "  x* DB00101
033100070423  "  x* DB00102
033200070423  "  x* DB00201
033300070423  "  x* DB00301
033400070423  "  x* DB00401
033500070423  "  x* DB00402
033600070423  "  x* DB00403
033700070423  "  x* DB00404
033800070423  "  x* DB00501
033900070423  "  x*B2
034000070423  "  x* DB00601
034100070423  "  x* DB00602
034200070423  "  x* DB00603
034300070423  "  x* DB00701
034400070423  "  x* DB00702
034500070423  "  x* DB00703
034600070423  "  x* DB00704
034700070423  "  x* DB00705
034800070423  "  x* DB00706
034900070423  "  x*B3
035000070423  "  x* DB00801
035100070423  "  x* DB00802
035200070423  "  x* DB00803
035300070423  "  x* DB00804
035400070423  "  x* DB00805
035500070423  "  x* DB00806
035600070423  "  x* DB00807
035700070423  "  x* DB00901
035800070423  "  x* DB01001
035900070423  "  x* DB01101
036000070423  "  x*B4
036100070423  "  x* DB01201
036200070423  "  x* DB01202
036300070423  "  x* DB01301
036400070423  "  x* DB01401
036500070423  "  x* DB01402
036600070423  "  x* DB01403
036700070423  "  x* DB01501
036800070423  "  x* DB01601
036900070423  "  x*B5
037000070423  "  x* DB01701
037100070423  "  x* DB01801
037200070423C2014x* DB01901
037300160607R218 X*** ex C2014  *------------------------------------
037400160607  "  X*** ex C2014  * Tipo record "B" - 2007
037500160607  "  X*** ex C2014  *------------------------------------
037600160607  "  X*** ex C2014 TpRecBDS        DS
037700160607  "  X*** ex C2014 *B1
037800160607  "  X*** ex C2014 DB00101B
037900160607  "  X*** ex C2014 DB00101
038000160607  "  X*** ex C2014 DB00102
038100160607  "  X*** ex C2014 DB00201
038200160607  "  X*** ex C2014 DB00301
038300160607  "  X*** ex C2014 DB00401
038400160607  "  X*** ex C2014 DB00402
038500160607  "  X*** ex C2014 DB00403
038600160607  "  X*** ex C2014 DB00404
038700160607  "  X*** ex C2014 DB00501
038800160607  "  x*** ex C2014 *B2
038900160607  "  X*** ex C2014 DB00601
039000160607  "  X*** ex C2014 DB00602
039100160607  "  X*** ex C2014 DB00701
039200160607  "  X*** ex C2014 DB00702
039300160607  "  X*** ex C2014 DB00703
039400160607  "  X*** ex C2014 DB00704
039500160607  "  X*** ex C2014 DB00801
039600160607  "  X*** ex C2014 DB00901
039700160607  "  X*** ex C2014*B4
039800160607  "  X*** ex C2014 DB01201
039900160607  "  X*** ex C2014 DB01301
040000160607  "  X*** ex C2014 DB01401
040100160607  "  X*** ex C2014 DB01402
040200160607  "  X*** ex C2014 DB01403
040300160607  "  X*** ex C2014 DB01404
040400160607  "  X*** ex C2014 DB01405
040500160607  "  X*** ex C2014 DB01501
040600160607  "  X*** ex C2014 DB01502
040700160607  "  X*** ex C2014 DB01503
040800160607  "  X*** ex C2014 DB01504
040900160607R218 X*** ex R110  DB01505
041000110413R055 D*** ex C2014  DB01505
041100160607R218 X*** ex C2014 *B5
041200130219R110 D*** ex C2014  DB01506
041300160607C2014X*** ex C2014 DB01701
041400160607  "  X*** ex C2014 DB01702
041500160607  "  X*** ex C2014 DB01703
041600160607  "  X*** ex C2014 DB01704
041700160607  "  X*** ex C2014 DB01705
041800160607  "  X*** ex R148  DB01706
041900160607  "  X*** ex C2014 DB01801
042000160607  "  X*** ex C2014 DB01901
042100160607  "  X*** ex C2014 DB01902
042200160607  "  X*** ex C2014 DB02001
042300160607R218 X*** ex C2014 DB02101
042400160607R218  *------------------------------------
042500160607  "   * Tipo record "B" - 2016
042600160607  "   *------------------------------------
042700160607  "  D TpRecBDS        DS
042800160607  "   *B1
042900160607  "  D  DB00101B
043000160607  "  D  DB00101
043100160607  "  D  DB00102
043200160607  "  D  DB00201
043300160607  "  D  DB00301
043400160607  "  D  DB00401
043500160607  "  D  DB00402
043600160607  "  D  DB00501
043700160607  "  D  DB00601
043800160607  "   *B2
043900160607  "  D  DB00603
044000160607  "  D  DB00604
044100160607  "  D  DB00605
044200160607  "  D  DB00606
044300160607  "  D  DB00701
044400160607  "  D  DB00702
044500160607  "  D  DB00703
044600160607  "  D  DB00704
044700160607  "  D  DB00705
044800160607  "  D  DB00801
044900160607  "  D  DB00802
045000160607  "   *B4
045100160607  "  D  DB00803
045200160607  "  D  DB00804
045300160608  "  D  DB00805
045400160607  "  D  DB00901
045500160607  "  D  DB00902
045600160607  "  D  DB01001
045700160607  "  D  DB01002
045800160607  "  D  DB01101
045900160607  "  D  DB01102
046000160607  "  D  DB01103
046100160607  "  D  DB01104
046200160607  "   *B5
046300160607  "  D  DB01105
046400160607  "  D  DB01106
046500160607  "  D  DB01107
046600160607  "  D  DB01108
046700160607  "  D  DB01201
046800160607  "  D  DB01301
046900160607  "  D  DB01401
047000160607  "  D  DB01402
047100160607  "  D  DB01501
047200160607R218 D  DB01601
047300040608      *------------------------------------
047400040608      * Tipo record "Z"
047500040608      *------------------------------------
047600040608     D TpRecZDS        DS
047700040608      *Z1
047800040610     D  DZ00101Z
047900040610     D  DZ00101
048000100512     D  DZ00102
048100100512     D  DZ00103
048200100512     D  DZ00104
048300100512     D  DZ00105
048400160607R218 X***  DZ00106
048500160607R218 X***  DZ00107
048600160607R218 X***  DZ00108
048700160607R218 X***  DZ00109
048800100512     D  DZ00110
048900100512     D  DZ00111
049000100512     D  DZ00112
049100100512     D  DZ00113
049200100512     D  DZ00114
049300040609      *Z2
049400040609     D  DZ00115
049500040609     D  DZ00116
049600040609     D  DZ00117
049700040609     D  DZ00118
049800040609     D  DZ00119
049900040609     D  DZ00120
050000040609     D  DZ00121
050100040609     D  DZ00122
050200040609     D  DZ00123
050300040609     D  DZ00124
050400040609     D  DZ00125
050500040609     D  DZ00126
050600040609     D  DZ00127
050700040609     D  DZ00128
050800040609      *Z3
050900100512R024 D  DZ00129
051000100512  "  D  DZ00130
051100100512  "  D  DZ00131
051200100512  "  D  DZ00132
051300100512  "  D  DZ00133
051400120502R024 D  DZ00134
051500120502R102 D  DZ00135
051600100512     D  DZ00201
051700160608R218 D* Valori assunti (salvataggio e recupero dati)
051800160608  "  D XMPEDS        E DS                  INZ
051900160608  "  D XMPEDS1       E DS                  INZ
052000160608  "  D $Cont           S              1S 0
052100160608  "  D $ContA          S              1
052200160608  "  D $Trovato        S              1
052300160621  "  D SavRecBST       S              1
052400160621  "  D SavRecBSY       S              1
052500160621  "  D SavNrecB        S                   like(DZ00102)
052600160621  "  D SavNrecD        S                   like(DZ00103)
052700160621  "  D SavNrecI        S                   like(DZ00103)
052800160608R218 D $SkDati         S                   Like(DsMpePar) dim(8)
052900040608      ******************************************************
053000040603      *                MAIN LINE PROGRAM                   *
053100040603      ******************************************************
053200040603      *
053300040603      * inizializzazione variabili
053400040603     C                   EXSR      INZVAR
053500040603      *
053600040603     C     $FINE         DOWEQ     *OFF
053700040603     C     $GEST         CASEQ     'D1'          GESD1
053800040603     C     $GEST         CASEQ     'A1'          GESDA1
053900040603     C     $GEST         CASEQ     'A2'          GESDA2
054000040603     C     $GEST         CASEQ     'A3'          GESDA3
054100040603     C     $GEST         CASEQ     'B1'          GESDB1
054200040603     C     $GEST         CASEQ     'B2'          GESDB2
054300040603     C     $GEST         CASEQ     'B3'          GESDB3
054400040603     C     $GEST         CASEQ     'B4'          GESDB4
054500060621C1943C     $GEST         CASEQ     'B5'          GESDB5
054600040603     C     $GEST         CASEQ     'Z1'          GESDZ1
054700040603     C     $GEST         CASEQ     'Z2'          GESDZ2
054800040603     C     $GEST         CASEQ     'Z3'          GESDZ3
054900040603     C                   ENDCS
055000040603     C                   ENDDO
055100040603      *
055200040603      * fine programma
055300040603     C                   EXSR      ENDPGM
055400040603      ************************************************************
055500040603      * Fine Programma
055600040603      ************************************************************
055700040603     C     ENDPGM        BEGSR
055800040603      *
055900040608      * disallocazione rcd
056000040603     C                   UNLOCK    ND77099F                             22
056100040603      *
056200040603      * passaggio dati al pgm chiamante
056300040608     C                   MOVEL     NDCR85DS      KPJBU
056400040603      *
056500040603      * Se pgm Guida non è stato richiamato posso chiudere in LR
056600040608     C                   if        OpzR85 = *blank
056700040608     C                   eval      *inLR = *on
056800040603     C* altrimenti chiudo in RT
056900040608     C                   else
057000040608     C                   eval      *inRT = *on
057100040608     C                   endif
057200040603      *
057300040603     C                   RETURN
057400040603      *
057500040603      *
057600040603     C     XEndPgm       ENDSR
057700040603      ************************************************************
057800040603      * GESTIONE EMISSIONE TASTI FUNZIONE
057900040603      ************************************************************
058000040603     C     GESPIE        BEGSR
058100040603      *
058200040603     C                   SELECT
058300040603      *
058400040603     C     $GEST         WHENEQ    'D1'
058500040603     C     $ULKD1        IFEQ      0
058600040603     C                   EXSR      F24D1
058700040603     C                   ELSE
058800040603     C                   WRITE     FMTZ1
058900040603     C                   ENDIF
059000040603      *
059100040603      *A---
059200040603     C     $GEST         WHENEQ    'A1'
059300040603     C     $GEST         oreq      'A2'
059400040603     C     $GEST         oreq      'A3'
059500040603     C     $GEST         oreq      'B1'
059600040603     C     $GEST         oreq      'B2'
059700040603     C     $GEST         oreq      'B3'
059800040603     C     $GEST         oreq      'B4'
059900060621C1943C     $GEST         oreq      'B5'
060000040603     C     $GEST         oreq      'Z1'
060100040603     C     $GEST         oreq      'Z2'
060200040603     C     $GEST         oreq      'Z3'
060300040608     C     $ULKDx        IFEQ      0
060400040603     C                   EXSR      F24Dx
060500040603     C                   ELSE
060600040608     C                   WRITE     FMTZ2
060700040603     C                   ENDIF
060800040603      *
060900040603     C                   ENDSL
061000040603      *
061100040603     C     XGesPie       ENDSR
061200040608D1****************************************************************
061300040608      * GESTIONE PARZIALIZZAZIONI
061400040608      ************************************************************
061500040608     C     GESD1         BEGSR
061600040608      * inizializzazione videata
061700040608     C     $INZD1        IFEQ      *ON
061800040608     C                   EXSR      INZD1
061900040608     C                   MOVE      *OFF          $INZD1
062000040608     C                   ENDIF
062100040608      * emissione piede videata se proveniente da altra
062200040608      * salvataggio valore formato di provenienza
062300040608     C     $LASTV        IFNE      'D1'
062400040608     C                   WRITE     FMTT1
062500040608     C                   EXSR      GESPIE
062600040608     C                   MOVE      $LASTV        $LASTG
062700040608     C                   MOVE      'D1'          $LASTV
062800040608     C                   ENDIF
062900040608      *
063000040608      * se esistono errori sulla videata
063100040608      * emetto la write del formato a indicatori spenti per vedere
063200040608      * le eventuali decodifiche
063300040608     C     *IN99         IFEQ      *ON
063400040608     C                   MOVEA     *IN           WIN
063500040608     C                   MOVE      *ALL'0'       IN5098           49
063600040608     C                   MOVEA     IN5098        *IN(50)
063700040608     C                   WRITE     FMTD1
063800040608     C                   MOVEA     WIN           *IN
063900040608     C                   ENDIF
064000040608      *
064100040608     C                   EXFMT     FMTD1
064200040608      *
064300040608      * azzero la posizione del cursore
064400040608     C                   Z-ADD     0             H1RIGA
064500040608     C                   Z-ADD     0             H1COLO
064600040608      *
064700040608      * CONTROLLO ABILITAZIONE TASTI VIDEATA D1
064800040608      * INPUT
064900040608      * $FC1 = Abilitazioni videata D1
065000040608      * OUTPUT
065100040608      * *IN97 + *IN99 Errori
065200040608     C                   MOVEA     $FC1          $FC
065300040609     C                   EXSR      CTRKD1
065400040608      *
065500040608     C     *IN99         IFEQ      *OFF
065600040608      *
065700040608     C                   SELECT
065800040608      * F2=Decodifica
065900040608     C     $TASTO        WHENEQ    F02
066000040608     C                   EXSR      F02D1
066100040608      * F3=Fine
066200040608     C     $TASTO        WHENEQ    F03
066300040608     C                   EXSR      F03D1
066400040608      * F5=Refresh
066500040608     C     $TASTO        WHENEQ    F05
066600040608     C                   EXSR      F05D1
066700040608      * F12=Ritorno
066800040608     C     $TASTO        WHENEQ    F12
066900040608     C                   EXSR      F12D1
067000040608      * F24=Altri tasti
067100040608     C     $TASTO        WHENEQ    F24
067200040608     C                   EXSR      F24D1
067300040608      *
067400040608     C                   OTHER
067500040608     C                   EXSR      CTRD1
067600040609      *
067700040609      * richiamo dettaglio se non ci sono errori in parzializzazione
067800040609     C                   if        *in99 = *off
067900040609     C                   exsr      GesDx
068000040609     C                   endif
068100040608      *
068200040608     C                   ENDSL
068300040608      *
068400040608     C                   ENDIF
068500040608      *
068600040608     C     XGesD1        ENDSR
068700040609      ************************************************************
068800040609      * Carico e passo alle videate da manutenere
068900040609      ************************************************************
069000040609     C     GesDx         Begsr
069100040609      *
069200040609     C                   move      '02'          WOpzR85
069300040609      *
069400040609     C                   move      *on           $InzDx
069500040609     C                   exsr      InzDx
069600040609     C                   move      *off          $InzDx
069700040609      *
069800040609      *  se reperito rec richiesto
069900040609     C                   if        *in99 = *off
070000040609      *
070100040609      *  passo a dettaglio richiesto
070200040609     C                   select
070300040609     C                   when      D1TpRec='A'
070400040609     C                   move      'A1'          $Gest
070500040609     C                   when      D1TpRec='B'
070600040609     C                   move      'B1'          $Gest
070700040609     C                   when      D1TpRec='Z'
070800040609     C                   move      'Z1'          $Gest
070900040609     C                   endsl
071000040609      *
071100040609     C                   endif
071200040609      *
071300040609     C     XGesDx        Endsr
071400040608      ************************************************************
071500040608      * INIZIALIZZAZIONE VIDEATA PARZIALIZZAZIONI
071600040608      ************************************************************
071700040608     C     INZD1         BEGSR
071800040608      *
071900040608     C                   CLEAR                   FMTD1
072000040608      *
072100040608      * Se pgm  richiamato con parametri forniti , li imposto nelle
072200040608      * parzializzazioni
072300040608     C                   select
072400040608      * il pgm è richiamato e
072500040608      * sono stati passati dei valori di parzializzazione ma non
072600040608      * la chiave univoca
072700040608     C                   when      OpzR85 <> *blank
072800040608      * imposto i valori passati sui campi a video
072900040608     C                   move      TpRecR85      D1TpRec
073000040608      * il pgm non è richiamato
073100040608     C                   when      OpzR85 =  *blank
073200040608      * imposto dei valori di default
073300040608     C                   move      *blank        D1TpRec
073400040608     C                   endsl
073500040608      *
073600040608     C     XInzD1        ENDSR
073700040608      ************************************************************
073800040608      * GESTIONE F02 VIDEO D1
073900040608      ************************************************************
074000040608     C     F02D1         BEGSR
074100040608      *
074200040608      * per decodificare la videata richiamo la routine dei ctrl
074300040608      * e poi disattivo gli eventuali messaggi di errore
074400040608     C                   EXSR      CTRD1
074500040608      *
074600040608     C                   MOVE      *ALL'0'       IN5098
074700040608     C                   MOVEA     IN5098        *IN(50)
074800040608      *
074900040608     C     XF02D1        ENDSR
075000040608      ************************************************************
075100040608      * GESTIONE F03 VIDEO D1
075200040608      ************************************************************
075300040608     C     F03D1         BEGSR
075400040608      *
075500040608     C                   MOVE      *ON           $FINE
075600040608     C                   MOVE      '1'           RETR85
075700040608      * fine programma
075800040608     C                   EXSR      ENDPGM
075900040608      *
076000040608     C     XF03D1        ENDSR
076100040608      ************************************************************
076200040608      * GESTIONE F05 VIDEO D1
076300040608      ************************************************************
076400040608     C     F05D1         BEGSR
076500040608      *
076600040608     C                   MOVE      *ON           $INZD1
076700040608      *
076800040608     C     XF05D1        ENDSR
076900040608      ************************************************************
077000040608      * GESTIONE F12 VIDEO D1
077100040608      ************************************************************
077200040608     C     F12D1         BEGSR
077300040608      *
077400040608      *  torno a menu
077500040608     C                   MOVE      *ON           $FINE
077600040608     C                   MOVE      '2'           RETR85
077700040608      *
077800040608     C     XF12D1        ENDSR
077900040608      ************************************************************
078000040608      * GESTIONE F24 VIDEO D1
078100040608      * input
078200040608      * $ULKD1 = Ultimo tasto funzione emesso per video D1
078300040608      * $FX1 =Testi tasti funzione
078400040608      * $FC1 = Abilitazioni
078500040608      * $FR1 = Inversioni di fondo
078600040608      ************************************************************
078700040608     C     F24D1         BEGSR
078800040608      *
078900040608     C                   MOVEA     $FX1          $FX
079000040608     C                   MOVEA     $FC1          $FC
079100040608     C                   MOVEA     $FR1          $FR
079200040608     C                   Z-ADD     $ULKD1        $ULK
079300040608     C                   Z-ADD     $D1L01        $L01
079400040608     C                   Z-ADD     $D1L02        $L02
079500040608     C                   EXSR      RIEKEY
079600040608     C                   Z-ADD     $ULK          $ULKD1            3 0
079700040608     C                   MOVEA     $FC           $FC1
079800040608     C                   MOVEL     $KEY1         Z1KE1
079900060224C1913C                   MOVEL     $ALLFUNCT     H1ALLFUNCT
080000040608     C                   MOVEL     $KEY2         Z1KE2
080100040608     C                   WRITE     FMTZ1
080200040608      *
080300040608     C     XF24D1        ENDSR
080400040608      ************************************************************
080500040608      * CONTROLLO VIDEATA PARZIALIZZAZIONI
080600040608      * non usare i seguenti indicatori (perchè relativi a D1MSG):
080700040608      * 93 94 96 97 98
080800040608      ************************************************************
080900040608     C     CTRD1         BEGSR
081000040608      *
081100040608     C                   SETOFF                                       99
081200040609     C                   if        D1Tprec = *blank
081300040609     C                   eval      *in99 = *on
081400040609     C                   endif
081500040608      *
081600040608     C     XCtrD1        ENDSR
081700040609      ************************************************************
081800040609      * CONTROLLO ABILITAZIONE TASTI VIDEATA D1
081900040609      ************************************************************
082000040609     C     CTRKD1        BEGSR
082100040609      *
082200040609     C                   SETOFF                                       99
082300040609     C                   MOVEA     $FC1          $FC
082400040609     C                   EXSR      CTRKEY
082500040609     C     *IN99         IFEQ      *ON
082600040609     C                   SETON                                        97
082700040609     C                   ENDIF
082800040609      *
082900040609     C     XCtrKD1       ENDSR
083000040608Dx****************************************************************
083100040603      * Chiamata programma con tasto personalizzato
083200040603      ************************************************************
083300040603     C     FPerDx        BEGSR
083400040603      *
083500040603      * salvo la DS di ingresso
083600040603     C                   MOVEL     NDCR85DS      $SaveDS
083700040603      *
083800040603     C                   MOVE      xscsoc        SocietaR85
083900040603      * passare nei campi appositi della DS STDR85DS il valore
084000040603      * della chiave della VL univoca
084100040608     C                   MOVEL     D1TpRec       TpRecR85
084200040603      *
084300040603     C                   MOVEL     NDCR85DS      KPJBU
084400040603     C                   CALL      $PGF1(PosFun)                        22
084500040603     C                   PARM                    KPJBA
084600040603     C                   PARM                    NOMPGM
084700040603      *
084800040603      * ripristino la DS di ingresso
084900040603     C                   MOVEL     $SaveDS       NDCR85DS
085000040603      *
085100040603     C     XFPerDx       ENDSR
085200040603      ************************************************************
085300040603      * CONTROLLO ABILITAZIONE TASTI VIDEATE
085400040603      ************************************************************
085500040603     C     CTRKDx        BEGSR
085600040603      *
085700040603     C                   SETOFF                                       99
085800040609     C                   MOVEA     $FC2          $FC
085900040603     C                   EXSR      CTRKEY
086000040603     C     *IN99         IFEQ      *ON
086100040603     C                   SETON                                        97
086200040603     C                   ENDIF
086300040603      *
086400040603     C     XCtrKDx       ENDSR
086500040603      ************************************************************
086600040603      * INIZIALIZZAZIONE VIDEATA DATI
086700040603      ************************************************************
086800040608     C     INZDx         BEGSR
086900040603      *
087000040608      * In base al tipo record scelto, utilizzo diverse videate:
087100040608      *  ---------------------------------
087200040608      * |Record di Tipo | Record Video    |
087300040608      * |---------------------------------|
087400040608      * |    "A"        | DA1 DA2 DA3     |
087500060621C1943X***** |    "B"        | DB1 DB2 DB3 DB4 |
087600070423C2014x*****  "B"        | DB1 DB2 DB3 DB4 DB5 |
087700070423C2014 * |    "B"        | DB1 DB2 DB4 DB5     |
087800040608      * |    "Z"        | DZ1 DZ2 DZ3     |
087900040608      *  ---------------------------------
088000040608      *
088100040603     C                   select
088200040603     C                   when      D1TpRec='A'
088300040603     C                   clear                   FmtDA1
088400040603     C                   clear                   FmtDA2
088500040603     C                   clear                   FmtDA3
088600040603     C                   when      D1TpRec='B'
088700040603     C                   clear                   FmtDB1
088800040603     C                   clear                   FmtDB2
088900040603     C                   clear                   FmtDB3
089000040603     C                   clear                   FmtDB4
089100060621C1943C                   clear                   FmtDB5
089200040603     C                   when      D1TpRec='Z'
089300040603     C                   clear                   FmtDZ1
089400040603     C                   clear                   FmtDZ2
089500040603     C                   clear                   FmtDZ3
089600040603     C                   endsl
089700040608      *
089800040608      *
089900040608      * NON IMMISSIONE
090000040608     C                   if        WOpzR85 <> '01'
090100040608      *
090200040608      *  LETTURA
090300040608     C                   exsr      RedAna
090400040608      *
090500040608      *  DOPO LETTURA
090600040608     C                   select
090700040608      *   NON TROVATO tipo rec richiesto oppure allocato
090800040608     C                   when      $RecOk = *off
090900040608     C                   move      'D1'          $GEST
091000040608     C                   move      '1'           ERRR85
091100040608      *    errore da emettere in parzializzaione
091200040608      *    PRO0007-(F1) La funzione richiamata si è chiusa in errore
091300040608     C                   eval      *in93 = *on
091400040608     C                   eval      *in99 = *on
091500040608      *
091600040608      *   TROVATO tp rec da gestire
091700040608     C                   when      $RecOk = *on
091800040608      *
091900040608      *    riempio videata tp rec richiesto
092000040608      *    e richiamo ctrl per decodifica
092100040608     C                   select
092200040608     C                   when      D1TpRec='A'
092300040609     C                   eval      TpRecADS = Mfrec
092400040608     C                   exsr      CtrDA1
092500040608     C                   exsr      CtrDA2
092600040608     C                   exsr      CtrDA3
092700040608     C                   when      D1TpRec='B'
092800040609     C                   eval      TpRecBDS = Mfrec
092900040608     C                   exsr      CtrDB1
093000040608     C                   exsr      CtrDB2
093100040608     C                   exsr      CtrDB3
093200040608     C                   exsr      CtrDB4
093300060621C1943C                   exsr      CtrDB5
093400040608     C                   when      D1TpRec='Z'
093500040609     C                   eval      TpRecZDS = Mfrec
093600040608     C                   exsr      CtrDZ1
093700040608     C                   exsr      CtrDZ2
093800040608     C                   exsr      CtrDZ3
093900040608     C                   endsl
094000040608     C                   move      *all'0'       In5098
094100040608     C                   movea     In5098        *in(50)
094200040608      *
094300040608     C                   endsl
094400040608      *
094500040608     C                   endif
094600040608      *
094700040603     C     XInzDX        ENDSR
094800040608      ************************************************************
094900040608      * Gegstione elttura rec da caricare per modifica
095000040608      ************************************************************
095100040608     C     RedAna        Begsr
095200040608      *
095300040608      * REPERISCO NRR DA LEGGERE
095400040608      *  cerco il n°relativo rec contenente il tipo rec richiesto
095500040608     C                   eval      $RecOk = *off
095600040608      *
095700040609     C     1             setll     ND77099F
095800040608     C                   read(n)   ND77099F                               21
095900040608     C                   dow       *in21 = *off
096000040608      *
096100040608     C                   if        %subst(MfRec: 1 : 1)=D1TpRec
096200040608     C                   eval      $RecOk = *on
096300040608     C                   leave
096400040608     C                   endif
096500040608      *
096600040608     C                   read(n)   ND77099F                               21
096700040608     C                   enddo
096800040608      *
096900040608      *
097000040608      * LETTURA
097100040608      *  trovato tipo rec richiesto
097200040608     C                   if        $RecOk = *on
097300040608      *
097400040608      *  provo a leggere il rec fino a quando il rec non è allocato
097500040608      *  oppure l'utente vuole Ritentare a leggere il rec allocato
097600040608     C                   dou       *in22 = *off
097700040608     C                             or MsgRtn <> 'R'
097800040608      *  alloco se Modifica/Annullamento
097900040608    >C                   if        WOpzR85='02' or WOpzR85='04'
098000040608     C     RrnPf         chain     ND77099F                           2122
098100040608      *  NON alloco se Copia/Visualizzazione
098200040608     C                   else
098300040608     C     RrnPf         chain(n)  ND77099F                           2122
098400040608     C                   endif
098500040608      *
098600040608      *  Gestione RCD allocato
098700040608     C                   if        *in22 = *on
098800040608    >C                   movel     'ND77099F'    MsgFil
098900040608     C                   exsr      MsgPgm
099000040608     C                   endif
099100040608      *
099200040608     C                   enddo
099300040608      *
099400040608      * rcd allocato da altro pgm: memorizzo errore
099500040608     C                   if        *in22 = *on
099600040608     C                   eval      $RecOk = *off
099700040608     C                   endif
099800040608      *
099900040608     C                   endif
100000040608      *
100100040608     C     XRedAna       Endsr
100200040603      ************************************************************
100300040603      * GESTIONE F24 VIDEI
100400040603      ************************************************************
100500040608     C     F24Dx         BEGSR
100600040603      *
100700040609     C                   MOVEA     $FX2          $FX
100800040609     C                   MOVEA     $FC2          $FC
100900040609     C                   MOVEA     $FR2          $FR
101000040608     C                   Z-ADD     $ULKDx        $ULK
101100040608     C                   Z-ADD     $DxL01        $L01
101200040608     C                   Z-ADD     $DxL02        $L02
101300040603     C                   EXSR      RIEKEY
101400040608     C                   Z-ADD     $ULK          $ULKDx            3 0
101500040609     C                   MOVEA     $FC           $FC2
101600040608     C                   MOVEL     $KEY1         Z2KE1
101700060224C1913C                   MOVEL     $ALLFUNCT     H2ALLFUNCT
101800040608     C                   MOVEL     $KEY2         Z2KE2
101900040608     C                   WRITE     FMTZ2
102000040603      *
102100040608     C     XF24Dx        ENDSR
102200160608R218 C/EJECT
102300160608 "   C************************************************************
102400160608 "   C* Reperimento dati salvati
102500160608 "   C************************************************************
102600160608R218 C     RepDatiSav    BEGSR
102700160608     C*
102800160608     C* preparo i parametri di chiamata al driver
102900160608     C                   Movel     *off          $Trovato
103000160608     C                   Clear                   $SkDati
103100160608     C                   Clear                   XMPEDS
103200160608     C                   EVAL      TpChiamata = '01'
103300160608     C                   EVAL      NChiavi = 5
103400160608     C                   EVAL      VLogica = 2
103500160621     C* Salvo i campi calcolati
103600160621     C                   If        D1tprec = 'B'
103700160621     C                   eval      SavRecBST= %Subst(DB00901: 18: 1)
103800160621     C                   eval      SavRecBSY= %Subst(DB00901: 21: 1)
103900160621     C                   Endif
104000160621     C*
104100160621     C                   If        D1tprec = 'Z'
104200160621     C                   eval      SavNrecB = DZ00102
104300160621     C                   eval      SavNrecD = DZ00103
104400160621     C                   eval      SavNrecI = DZ00104
104500160621     C                   Endif
104600160608     C*
104700160608     C* recupero tutta la ds del record gestito
104800160608     C                   Do        8             $Cont
104900160608     C                   Clear                   XMPEDS1
105000160608     C                   Move      $Cont         $Conta
105100160608     C                   Eval      DSMPEPGM = 'NDCR85R' +
105200160608     C                             D1tprec  +  $conta
105300160608     C* preparo le chiavi per la chiamata al driver
105400160608     C                   MoveL     XSCSOC        DSMPESOC
105500160608     C                   MoveL     *Blanks       DSMPEPRF
105600160608     C* Si reperiscono i dati di default a seconda delle modalità con
105700160608     C* cui il pgm è usato
105800160608     C* MPETIP = 'PX'  pgm richiamato come lista (CMD4)
105900160608     C* MPETIP = 'PV'  pgm richiamato da menù
106000160608     C* MPETIP = 'PB'  x lancio Batch
106100160608     C                   MoveL     'PV'          DSMPETIP
106200160608     C*
106300160608     C                   CALLB     'XMPE'
106400160608     C                   PARM                    XMPEDS
106500160608     C                   PARM                    XMPEDS1
106600160608     C*
106700160608     C     Risultato     IfEq      '0'
106800160608     C                   Movel     *on           $Trovato
106900160608     C                   MoveL     DSMPEPAR      $SkDati($Cont)
107000160608     C                   endif
107100160608     C*
107200160608     C                   Enddo
107300160608     C*
107400160608     C                   If        $Trovato = *ON
107500160608     C                   Select
107600160608     C                   When      D1TPrec = 'A'
107700160608     C                   Movea     $SkDati       TpRecAds
107800160608     C                   When      D1TPrec = 'B'
107900160608     C                   Movea     $SkDati       TpRecBds
108000160621     C                   eval      %Subst(DB00901: 18: 1) = SavRecBST
108100160621     C                   eval      %Subst(DB00901: 21: 1) = SavRecBSY
108200160608     C                   When      D1TPrec = 'Z'
108300160608     C                   Movea     $SkDati       TpRecZds
108400160621     C                   eval      DZ00102 = SavNrecB
108500160621     C                   eval      DZ00103 = SavNrecD
108600160621     C                   eval      DZ00104 = SavNrecI
108700160608     C                   EndSl
108800160608     C                   EndIf
108900160608     C*
109000160608R218 C                   Endsr
109100160608R218 C/EJECT
109200160608 "   C************************************************************
109300160608 "   C* Salvataggio dati da salvare per prossime elaborazioni
109400160608 "   C************************************************************
109500160608R218 C     AggDatiSav    BEGSR
109600160608     C*
109700160608     C* preparo i parametri di chiamata al driver
109800160608     C                   Select
109900160608     C                   When      D1tprec  = 'A'
110000160608     C                   Movea     TpRecADS      $SkDati
110100160608     C                   When      D1tprec  = 'B'
110200160608     C                   Movea     TpRecBDS      $SkDati
110300160608     C                   When      D1tprec  = 'Z'
110400160608     C                   Movea     TpRecZDS      $SkDati
110500160608     C                   EndSl
110600160608     C                   Clear                   XMPEDS
110700160608     C                   EVAL      TpChiamata = '03'
110800160608     C                   EVAL      NChiavi = 5
110900160608     C                   EVAL      VLogica = 2
111000160608     C*
111100160608     C* recupero tutta la ds del record gestito
111200160608     C                   Do        8             $Cont
111300160608     C                   Clear                   XMPEDS1
111400160608     C                   Move      $Cont         $Conta
111500160608     C                   Eval      DSMPEPGM = 'NDCR85R' +
111600160608     C                             D1tprec + $Conta
111700160608     C* preparo le chiavi per la chiamata al driver
111800160608     C                   MoveL     XSCSOC        DSMPESOC
111900160608     C                   MoveL     *Blanks       DSMPEPRF
112000160608     C* Si reperiscono i dati di default a seconda delle modalità con
112100160608     C* cui il pgm è usato
112200160608     C* MPETIP = 'PX'  pgm richiamato come lista (CMD4)
112300160608     C* MPETIP = 'PV'  pgm richiamato da menù
112400160608     C* MPETIP = 'PB'  x lancio Batch
112500160608     C                   MoveL     'PV'          DSMPETIP
112600160608     C*
112700160608     C                   Movel     $SkDati($Cont)DSMPEPAR
112800160608     C*
112900160608     C                   CALLB     'XMPE'
113000160608     C                   PARM                    XMPEDS
113100160608     C                   PARM                    XMPEDS1
113200160608     C*
113300160608     C                   Enddo
113400160608     C*
113500160608R218 C                   Endsr
113600160608R218 C/EJECT
113700040603A*****************************************************************
113800040603      * GESTIONE VIDEO RECORD DA1
113900040603      ************************************************************
114000040603     C     GESDA1        BEGSR
114100040603      * inizializzazione videata
114200040603     C     $INZDX        IFEQ      *ON
114300040603     C                   EXSR      INZDX
114400040603     C                   MOVE      *OFF          $INZDX
114500040603     C                   ENDIF
114600040603      * emissione piede videata se proveniente da altra
114700040603      * salvataggio valore formato di provenienza
114800040603     C     $LASTV        IFNE      'A1'
114900040603     C                   WRITE     FMTT1
115000040603     C                   EXSR      GESPIE
115100040603     C                   MOVE      $LASTV        $LASTG
115200040603     C                   MOVE      'A1'          $LASTV
115300040603     C                   ENDIF
115400040603      *
115500040603      * se esistono errori sulla videata
115600040603      * emetto la write del formato a indicatori spenti per vedere
115700040603      * le eventuali decodifiche
115800040603     C     *IN99         IFEQ      *ON
115900040603     C     $GEST         ANDEQ     'A1'
116000040603     C                   MOVEA     *IN           WIN
116100040603     C                   MOVE      *ALL'0'       IN5098           49
116200040603     C                   MOVEA     IN5098        *IN(50)
116300040603     C                   WRITE     FMTDA1
116400040603     C                   MOVEA     WIN           *IN
116500040603     C                   ENDIF
116600040603      * Inizializzazione indice tasti funzione personalizzati
116700040603     C                   Eval      PosFun = 25
116800040603      *
116900040603     C                   SELECT
117000040603      * Annullamento
117100040608     C     WOpzR85       WHENEQ    '04'
117200040603      * Visualizzazione
117300040608     C     WOpzR85       OREQ      '05'
117400040603     C                   WRITE     FMTDA1
117500040603     C                   EXFMT     PROTECT
117600040603      * Immissione/Modifica/Copia
117700040603     C                   OTHER
117800040603     C                   EXFMT     FMTDA1
117900040603     C                   ENDSL
118000040603      *
118100040603      * azzero la posizione del cursore
118200040603     C                   Z-ADD     0             H1RIGA
118300040603     C                   Z-ADD     0             H1COLO
118400040603      *
118500040603      * controllo abilitazione tasti funzione
118600040603     C                   EXSR      CTRKDx
118700040603      *
118800040603     C     *IN99         IFEQ      *OFF
118900040603      *
119000040603     C                   SELECT
119100040603      * ROLLUP
119200040603     C     $TASTO        WHENEQ    ROLLUP
119300040603     C                   MOVE      'A2'          $GEST
119400040603      * F3=Fine
119500040603     C     $TASTO        WHENEQ    F03
119600040603     C                   EXSR      F03DA1
119700040603      * F5=Refresh
119800040603     C     $TASTO        WHENEQ    F05
119900040603     C                   EXSR      F05DA1
120000040603      * F12=Ritorno
120100040603     C     $TASTO        WHENEQ    F12
120200040603     C                   EXSR      F12DA1
120300160608R218  * F19=Recupera dati salvati
120400160608  "  C     $TASTO        WHENEQ    F19
120500160608R218 C                   EXSR      F19DX
120600040603      * F24=Altri tasti
120700040603     C     $TASTO        WHENEQ    F24
120800040609     C                   EXSR      F24Dx
120900040603      * Personalizzata
121000040603     C     $PGF1(PosFun) WHENNE    *BLANK
121100040603     C                   EXSR      FPerDx
121200040603      *
121300040603     C                   OTHER
121400040603     C                   EXSR      CTRDA1
121500040603     C     *IN99         IFEQ      *OFF
121600040603     C                   EXSR      CTRDA2
121700040603     C     *IN99         IFEQ      *ON
121800040603     C                   EXSR      CTRDA3
121900040603     C                   ENDIF
122000040608     C* Spengo gli indicatori di errore perchè, nel caso si siano usati
122100040608     C* indicatori uguali in videate differenti, genererei conflitti
122200040603     C     *IN99         IFEQ      *ON
122300040608     C                   MOVE      *ALL'0'       IN5098           49
122400040603     C                   MOVEA     IN5098        *IN(50)
122500040603     C                   SETON                                        9996
122600040603     C                   ENDIF
122700040603     C                   ENDIF
122800040603      *
122900040608      * eseguo aggiornamento
123000040603     C     $TASTO        IFEQ      F06
123100040603     C     *IN99         ANDEQ     *OFF
123200040603     C                   EXSR      AGGANA
123300040603     C                   ENDIF
123400040603      *
123500040603     C                   ENDSL
123600040603      *
123700040603     C                   ENDIF
123800040603      *
123900040603     C     XGesDA1       ENDSR
124000040603      ************************************************************
124100040603      * GESTIONE F03 VIDEO DA1
124200040603      ************************************************************
124300040603     C     F03DA1        BEGSR
124400040603      *
124500040603     C                   MOVE      *ON           $FINE
124600040603     C                   MOVE      '1'           RETR85
124700040603      * fine programma
124800040603     C                   EXSR      ENDPGM
124900040603      *
125000040603     C     XF03DA1       ENDSR
125100040603      ************************************************************
125200040603      * GESTIONE F05 VIDEO DA1
125300040603      ************************************************************
125400040603     C     F05DA1        BEGSR
125500040603      *
125600040603     C                   MOVE      *ON           $INZDX
125700040603      *
125800040603     C     XF05DA1       ENDSR
125900040603      ************************************************************
126000040603      * GESTIONE F12 VIDEO DA1
126100040603      ************************************************************
126200040603     C     F12DA1        BEGSR
126300040603      *
126400040603     C                   MOVE      'D1'          $GEST
126500040603      *
126600040603     C     XF12DA1       ENDSR
126700160608R218  ************************************************************
126800160608  "   * GESTIONE F19 VIDEO DA1
126900160608  "   ************************************************************
127000160608R218 C     F19DX         BEGSR
127100160608      *
127200160608     C                   Exsr      RepDatiSav
127300160608      *
127400160608R218 C                   ENDSR
127500040603      ************************************************************
127600040603      * CONTROLLO VIDEATA
127700040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
127800040603      * 95 96 97 98
127900040603      ************************************************************
128000040603     C     CTRDA1        BEGSR
128100040603      *
128200040603     C                   SETOFF                                       99
128300040603      *
128400040603     C     XCtrDA1       ENDSR
128500040603      ************************************************************
128600040603      * GESTIONE VIDEO RECORD  DA2
128700040603      ************************************************************
128800040603     C     GESDA2        BEGSR
128900040603      * emissione piede videata se proveniente da altra
129000040603      * salvataggio valore formato di provenienza
129100040603     C     $LASTV        IFNE      'A2'
129200040603     C                   WRITE     FMTT1
129300040603     C                   EXSR      GESPIE
129400040603     C                   MOVE      $LASTV        $LASTG
129500040603     C                   MOVE      'A2'          $LASTV
129600040603     C                   ENDIF
129700040603      *
129800040603      * se esistono errori sulla videata
129900040603      * emetto la write del formato a indicatori spenti per vedere
130000040603      * le eventuali decodifiche
130100040603     C     *IN99         IFEQ      *ON
130200040603     C     $GEST         ANDEQ     'A2'
130300040603     C                   MOVEA     *IN           WIN
130400040603     C                   MOVE      *ALL'0'       IN5098           49
130500040603     C                   MOVEA     IN5098        *IN(50)
130600040603     C                   WRITE     FMTDA2
130700040603     C                   MOVEA     WIN           *IN
130800040603     C                   ENDIF
130900040603      * Inizializzazione indice tasti funzione personalizzati
131000040603     C                   Eval      PosFun = 25
131100040603      *
131200040603     C                   SELECT
131300040603      * Annullamento
131400040608     C     WOpzR85       WHENEQ    '04'
131500040603      * Visualizzazione
131600040608     C     WOpzR85       OREQ      '05'
131700040603     C                   WRITE     FMTDA2
131800040603     C                   EXFMT     PROTECT
131900040603      * Immissione/Modifica/Copia
132000040603     C                   OTHER
132100040603     C                   EXFMT     FMTDA2
132200040603     C                   ENDSL
132300040603      *
132400040603      * azzero la posizione del cursore
132500040603     C                   Z-ADD     0             H1RIGA
132600040603     C                   Z-ADD     0             H1COLO
132700040603      *
132800040603      * controllo abilitazione tasti funzione
132900040603     C                   EXSR      CTRKDx
133000040603      *
133100040603     C     *IN99         IFEQ      *OFF
133200040603     C                   SELECT
133300040603      * ROLLUP
133400040603     C     $TASTO        WHENEQ    ROLLUP
133500040603     C                   MOVE      'A3'          $GEST
133600040603      * ROLDOWN
133700040603     C     $TASTO        WHENEQ    ROLDWN
133800040603     C                   MOVE      'A1'          $GEST
133900040603      * F3=Fine
134000040603     C     $TASTO        WHENEQ    F03
134100040603     C                   EXSR      F03DA1
134200040603      * F5=Refresh
134300040603     C     $TASTO        WHENEQ    F05
134400040603     C                   EXSR      F05DA1
134500040603      * F12=Ritorno
134600040603     C     $TASTO        WHENEQ    F12
134700040603     C                   EXSR      F12DA1
134800160608R218  * F19=Altri tasti
134900160608  "  C     $TASTO        WHENEQ    F19
135000160608R218 C                   EXSR      F19Dx
135100040603      * F24=Altri tasti
135200040603     C     $TASTO        WHENEQ    F24
135300040609     C                   EXSR      F24Dx
135400040603      * Personalizzata
135500040603     C     $PGF1(PosFun) Whenne    *BLANK
135600040603     C                   EXSR      FperDx
135700040603      *
135800040603     C                   OTHER
135900040603     C                   EXSR      CTRDA2
136000040603     C     *IN99         IFEQ      *OFF
136100040603     C                   EXSR      CTRDA1
136200040603     C     *IN99         IFEQ      *ON
136300040603     C                   EXSR      CTRDA3
136400040603     C                   ENDIF
136500040608      * Spengo gli indicatori di errore per il controllo su altri schermi
136600040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
136700040608      * videate
136800040603     C     *IN99         IFEQ      *ON
136900040603     C                   MOVE      *ALL'0'       IN5098           49
137000040603     C                   MOVEA     IN5098        *IN(50)
137100040603     C                   SETON                                        9996
137200040603     C                   ENDIF
137300040603     C                   ENDIF
137400040603      *
137500040608      * eseguo aggiornamento
137600040608     C     $TASTO        IFEQ      F06
137700040608     C     *IN99         ANDEQ     *OFF
137800040608     C                   EXSR      AGGANA
137900040608     C                   ENDIF
138000040603      *
138100040603     C                   ENDSL
138200040603      *
138300040603     C                   ENDIF
138400040603      *
138500040603     C     XGesDA2       ENDSR
138600040603      ************************************************************
138700040603      * CONTROLLO VIDEATA  D2
138800040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
138900040603      * 95 96 97 98
139000040603      ************************************************************
139100040603     C     CTRDA2        BEGSR
139200040603      *
139300040603     C                   SETOFF                                       99
139400040608      *
139500040603     C     XCtrDA2       ENDSR
139600040603      ************************************************************
139700040603      * GESTIONE VIDEO RECORD  DA3
139800040603      ************************************************************
139900040603     C     GESDA3        BEGSR
140000040603      * emissione piede videata se proveniente da altra
140100040603      * salvataggio valore formato di provenienza
140200040603     C     $LASTV        IFNE      'A3'
140300040603     C                   WRITE     FMTT1
140400040603     C                   EXSR      GESPIE
140500040603     C                   MOVE      $LASTV        $LASTG
140600040603     C                   MOVE      'A3'          $LASTV
140700040603     C                   ENDIF
140800040603      *
140900040603      * se esistono errori sulla videata
141000040603      * emetto la write del formato a indicatori spenti per vedere
141100040603      * le eventuali decodifiche
141200040603     C     *IN99         IFEQ      *ON
141300040603     C     $GEST         ANDEQ     'A3'
141400040603     C                   MOVEA     *IN           WIN
141500040603     C                   MOVE      *ALL'0'       IN5098           49
141600040603     C                   MOVEA     IN5098        *IN(50)
141700040603     C                   WRITE     FMTDA3
141800040603     C                   MOVEA     WIN           *IN
141900040603     C                   ENDIF
142000040603      * Inizializzazione indice tasti funzione personalizzati
142100040603     C                   Eval      PosFun = 25
142200040603      *
142300040603     C                   SELECT
142400040603      * Annullamento
142500040608     C     WOpzR85       WHENEQ    '04'
142600040603      * Visualizzazione
142700040608     C     WOpzR85       OREQ      '05'
142800040603     C                   WRITE     FMTDA3
142900040603     C                   EXFMT     PROTECT
143000040603      * Immissione/Modifica/Copia
143100040603     C                   OTHER
143200040603     C                   EXFMT     FMTDA3
143300040603     C                   ENDSL
143400040603      *
143500040603      * azzero la posizione del cursore
143600040603     C                   Z-ADD     0             H1RIGA
143700040603     C                   Z-ADD     0             H1COLO
143800040603      *
143900040603      * controllo abilitazione tasti funzione
144000040603     C                   EXSR      CTRKDx
144100040603      *
144200040603     C     *IN99         IFEQ      *OFF
144300040603      *
144400040603     C                   SELECT
144500040603      * ROLDOWN
144600040603     C     $TASTO        WHENEQ    ROLDWN
144700040603     C                   MOVE      'A2'          $GEST
144800040603      * F3=Fine
144900040603     C     $TASTO        WHENEQ    F03
145000040603     C                   EXSR      F03DA1
145100040603      * F5=Refresh
145200040603     C     $TASTO        WHENEQ    F05
145300040603     C                   EXSR      F05DA1
145400040603      * F12=Ritorno
145500040603     C     $TASTO        WHENEQ    F12
145600040603     C                   EXSR      F12DA1
145700160608R218  * F19=Altri tasti
145800160608  "  C     $TASTO        WHENEQ    F19
145900160608R218 C                   EXSR      F19Dx
146000040603      * F24=Altri tasti
146100040603     C     $TASTO        WHENEQ    F24
146200040609     C                   EXSR      F24Dx
146300040603      * Personalizzata
146400040603     C     $PGF1(PosFun) Whenne    *BLANK
146500040603     C                   EXSR      FperDx
146600040603      *
146700040603     C                   OTHER
146800040603     C                   EXSR      CTRDA3
146900040603     C     *IN99         IFEQ      *OFF
147000040608     C                   EXSR      CTRDA1
147100040603     C     *IN99         IFEQ      *ON
147200040608     C                   EXSR      CTRDA2
147300040603     C                   ENDIF
147400040608      * Spengo gli indicatori di errore per il controllo su altri schermi
147500040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
147600040608      * videate
147700040608     C     *IN99         IFEQ      *ON
147800040608     C                   MOVE      *ALL'0'       IN5098           49
147900040608     C                   MOVEA     IN5098        *IN(50)
148000040608     C                   SETON                                        9996
148100040608     C                   ENDIF
148200040608     C                   ENDIF
148300040608      *
148400040608      * eseguo aggiornamento
148500040608     C     $TASTO        IFEQ      F06
148600040608     C     *IN99         ANDEQ     *OFF
148700040608     C                   EXSR      AGGANA
148800040608     C                   ENDIF
148900040603      *
149000040603     C                   ENDSL
149100040603      *
149200040603     C                   ENDIF
149300040603      *
149400040603     C     XGesDA3       ENDSR
149500040603      ************************************************************
149600040603      * CONTROLLO VIDEATA  a3
149700040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
149800040603      * 95 96 97 98
149900040603      ************************************************************
150000040603     C     CTRDA3        BEGSR
150100040603      *
150200040603     C                   SETOFF                                       99
150300040603      *
150400040603     C     XCtrDA3       ENDSR
150500040603B*****************************************************************
150600040603      * GESTIONE VIDEO RECORD DA1
150700040603      ************************************************************
150800040603     C     GESDB1        BEGSR
150900040603      * inizializzazione videata
151000040603     C     $INZDX        IFEQ      *ON
151100040603     C                   EXSR      INZDX
151200040603     C                   MOVE      *OFF          $INZDX
151300040603     C                   ENDIF
151400040603      * emissione piede videata se proveniente da altra
151500040603      * salvataggio valore formato di provenienza
151600040603     C     $LASTV        IFNE      'B1'
151700040603     C                   WRITE     FMTT1
151800040603     C                   EXSR      GESPIE
151900040603     C                   MOVE      $LASTV        $LASTG
152000040603     C                   MOVE      'B1'          $LASTV
152100040603     C                   ENDIF
152200040603      *
152300040603      * se esistono errori sulla videata
152400040603      * emetto la write del formato a indicatori spenti per vedere
152500040603      * le eventuali decodifiche
152600040603     C     *IN99         IFEQ      *ON
152700040603     C     $GEST         ANDEQ     'B1'
152800040603     C                   MOVEA     *IN           WIN
152900040603     C                   MOVE      *ALL'0'       IN5098           49
153000040603     C                   MOVEA     IN5098        *IN(50)
153100040603     C                   WRITE     FMTDB1
153200040603     C                   MOVEA     WIN           *IN
153300040603     C                   ENDIF
153400040603      * Inizializzazione indice tasti funzione personalizzati
153500040603     C                   Eval      PosFun = 25
153600040603      *
153700040603     C                   SELECT
153800040603      * Annullamento
153900040608     C     WOpzR85       WHENEQ    '04'
154000040603      * Visualizzazione
154100040608     C     WOpzR85       OREQ      '05'
154200040603     C                   WRITE     FMTDB1
154300040603     C                   EXFMT     PROTECT
154400040603      * Immissione/Modifica/Copia
154500040603     C                   OTHER
154600040603     C                   EXFMT     FMTDB1
154700040603     C                   ENDSL
154800040603      *
154900040603      * azzero la posizione del cursore
155000040603     C                   Z-ADD     0             H1RIGA
155100040603     C                   Z-ADD     0             H1COLO
155200040603      *
155300040603      * controllo abilitazione tasti funzione
155400040603     C                   EXSR      CTRKDx
155500040603      *
155600040603     C     *IN99         IFEQ      *OFF
155700040603      *
155800040603     C                   SELECT
155900040603      * ROLLUP
156000040603     C     $TASTO        WHENEQ    ROLLUP
156100040603     C                   MOVE      'B2'          $GEST
156200040603      * F3=Fine
156300040603     C     $TASTO        WHENEQ    F03
156400040603     C                   EXSR      F03DA1
156500040603      * F5=Refresh
156600040603     C     $TASTO        WHENEQ    F05
156700040603     C                   EXSR      F05DA1
156800040603      * F12=Ritorno
156900040603     C     $TASTO        WHENEQ    F12
157000040603     C                   EXSR      F12DA1
157100160608R218  * F19=Altri tasti
157200160608  "  C     $TASTO        WHENEQ    F19
157300160608R218 C                   EXSR      F19Dx
157400040603      * F24=Altri tasti
157500040603     C     $TASTO        WHENEQ    F24
157600040603     C                   EXSR      F24Dx
157700040603      * Personalizzata
157800040603     C     $PGF1(PosFun) WHENNE    *BLANK
157900040603     C                   EXSR      FPerDx
158000040603      *
158100040603     C                   OTHER
158200040603     C                   EXSR      CTRDB1
158300040603     C     *IN99         IFEQ      *OFF
158400040603     C                   EXSR      CTRDB2
158500060622C1943X***  *IN99         IFEQ      *ON
158600060622C1943C     *IN99         IFEQ      *Off
158700040603     C                   EXSR      CTRDB3
158800060622C1943X***  *IN99         IFEQ      *ON
158900060622C1943C     *IN99         IFEQ      *Off
159000040603     C                   EXSR      CTRDB4
159100060622C1943C     *IN99         IFEQ      *OFF
159200060621  "  C                   EXSR      CTRDB5
159300060621C1943C                   ENDIF
159400040603     C                   ENDIF
159500040603     C                   ENDIF
159600040608      * Spengo gli indicatori di errore per il controllo su altri schermi
159700040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
159800040608      * videate
159900040608     C     *IN99         IFEQ      *ON
160000040608     C                   MOVE      *ALL'0'       IN5098           49
160100040608     C                   MOVEA     IN5098        *IN(50)
160200040608     C                   SETON                                        9996
160300040608     C                   ENDIF
160400040608     C                   ENDIF
160500040608      *
160600040608      * eseguo aggiornamento
160700040608     C     $TASTO        IFEQ      F06
160800040608     C     *IN99         ANDEQ     *OFF
160900040608     C                   EXSR      AGGANA
161000040608     C                   ENDIF
161100040603      *
161200040603     C                   ENDSL
161300040603      *
161400040603     C                   ENDIF
161500040603      *
161600040603     C     XGesDB1       ENDSR
161700040603      ************************************************************
161800040603      * CONTROLLO VIDEATA
161900040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
162000040603      * 95 96 97 98
162100040603      ************************************************************
162200040603     C     CTRDB1        BEGSR
162300040603      *
162400040603     C                   SETOFF                                       99
162500040603      *
162600040603     C     XCtrDB1       ENDSR
162700040603      ************************************************************
162800040603      * GESTIONE VIDEO RECORD  DA2
162900040603      ************************************************************
163000040603     C     GESDB2        BEGSR
163100040603      * emissione piede videata se proveniente da altra
163200040603      * salvataggio valore formato di provenienza
163300040603     C     $LASTV        IFNE      'B2'
163400040603     C                   WRITE     FMTT1
163500040603     C                   EXSR      GESPIE
163600040603     C                   MOVE      $LASTV        $LASTG
163700040603     C                   MOVE      'B2'          $LASTV
163800040603     C                   ENDIF
163900040603      *
164000040603      * se esistono errori sulla videata
164100040603      * emetto la write del formato a indicatori spenti per vedere
164200040603      * le eventuali decodifiche
164300040603     C     *IN99         IFEQ      *ON
164400040603     C     $GEST         ANDEQ     'B2'
164500040603     C                   MOVEA     *IN           WIN
164600040603     C                   MOVE      *ALL'0'       IN5098           49
164700040603     C                   MOVEA     IN5098        *IN(50)
164800040603     C                   WRITE     FMTDB2
164900040603     C                   MOVEA     WIN           *IN
165000040603     C                   ENDIF
165100040603      * Inizializzazione indice tasti funzione personalizzati
165200040603     C                   Eval      PosFun = 25
165300040603      *
165400040603     C                   SELECT
165500040603      * Annullamento
165600040608     C     WOpzR85       WHENEQ    '04'
165700040603      * Visualizzazione
165800040608     C     WOpzR85       OREQ      '05'
165900040603     C                   WRITE     FMTDB2
166000040603     C                   EXFMT     PROTECT
166100040603      * Immissione/Modifica/Copia
166200040603     C                   OTHER
166300040603     C                   EXFMT     FMTDB2
166400040603     C                   ENDSL
166500040603      *
166600040603      * azzero la posizione del cursore
166700040603     C                   Z-ADD     0             H1RIGA
166800040603     C                   Z-ADD     0             H1COLO
166900040603      *
167000040603      * controllo abilitazione tasti funzione
167100040603     C                   EXSR      CTRKDx
167200040603      *
167300040603     C     *IN99         IFEQ      *OFF
167400040603      *
167500040603     C                   SELECT
167600040603      * ROLLUP
167700040603     C     $TASTO        WHENEQ    ROLLUP
167800070423c2014x***                MOVE      'B3'          $GEST
167900070423c2014c                   MOVE      'B4'          $GEST
168000040603      * ROLDOWN
168100040603     C     $TASTO        WHENEQ    ROLDWN
168200040603     C                   MOVE      'B1'          $GEST
168300040603      * F3=Fine
168400040603     C     $TASTO        WHENEQ    F03
168500040603     C                   EXSR      F03DA1
168600040603      * F5=Refresh
168700040603     C     $TASTO        WHENEQ    F05
168800040603     C                   EXSR      F05DA1
168900040603      * F12=Ritorno
169000040603     C     $TASTO        WHENEQ    F12
169100040603     C                   EXSR      F12DA1
169200160608R218  * F19=Altri tasti
169300160608  "  C     $TASTO        WHENEQ    F19
169400160608R218 C                   EXSR      F19Dx
169500040603      * F24=Altri tasti
169600040603     C     $TASTO        WHENEQ    F24
169700040603     C                   EXSR      F24Dx
169800040603      * Personalizzata
169900040603     C     $PGF1(PosFun) Whenne    *BLANK
170000040603     C                   EXSR      FperDx
170100040603      *
170200040603     C                   OTHER
170300040603     C                   EXSR      CTRDB2
170400040603     C     *IN99         IFEQ      *OFF
170500040603     C                   EXSR      CTRDB1
170600060622C1943X***  *IN99         IFEQ      *ON
170700060622C1943C     *IN99         IFEQ      *Off
170800040603     C                   EXSR      CTRDB3
170900060622C1943X***  *IN99         IFEQ      *ON
171000060622C1943C     *IN99         IFEQ      *Off
171100040603     C                   EXSR      CTRDB4
171200060622C1943C     *IN99         IFEQ      *Off
171300060621  "  C                   EXSR      CTRDB5
171400060621C1943C                   ENDIF
171500040603     C                   ENDIF
171600040603     C                   ENDIF
171700040608      * Spengo gli indicatori di errore per il controllo su altri schermi
171800040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
171900040608      * videate
172000040608     C     *IN99         IFEQ      *ON
172100040608     C                   MOVE      *ALL'0'       IN5098           49
172200040608     C                   MOVEA     IN5098        *IN(50)
172300040608     C                   SETON                                        9996
172400040608     C                   ENDIF
172500040608     C                   ENDIF
172600040608      *
172700040608      * eseguo aggiornamento
172800040608     C     $TASTO        IFEQ      F06
172900040608     C     *IN99         ANDEQ     *OFF
173000040608     C                   EXSR      AGGANA
173100040608     C                   ENDIF
173200040603      *
173300040603     C                   ENDSL
173400040603      *
173500040603     C                   ENDIF
173600040603      *
173700040608     C     XGesDB2       ENDSR
173800040603      ************************************************************
173900040603      * CONTROLLO VIDEATA  D2
174000040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
174100040603      * 95 96 97 98
174200040603      ************************************************************
174300040603     C     CTRDB2        BEGSR
174400040603      *
174500040603     C                   SETOFF                                       99
174600040603      *
174700040603     C     XCtrDB2       ENDSR
174800040603      ************************************************************
174900040603      * GESTIONE VIDEO RECORD  DB3
175000040603      ************************************************************
175100040603     C     GESDB3        BEGSR
175200040603      * emissione piede videata se proveniente da altra
175300040603      * salvataggio valore formato di provenienza
175400040603     C     $LASTV        IFNE      'B3'
175500040603     C                   WRITE     FMTT1
175600040603     C                   EXSR      GESPIE
175700040603     C                   MOVE      $LASTV        $LASTG
175800040603     C                   MOVE      'B3'          $LASTV
175900040603     C                   ENDIF
176000040603      *
176100040603      * se esistono errori sulla videata
176200040603      * emetto la write del formato a indicatori spenti per vedere
176300040603      * le eventuali decodifiche
176400040603     C     *IN99         IFEQ      *ON
176500040603     C     $GEST         ANDEQ     'B3'
176600040603     C                   MOVEA     *IN           WIN
176700040603     C                   MOVE      *ALL'0'       IN5098           49
176800040603     C                   MOVEA     IN5098        *IN(50)
176900040603     C                   WRITE     FMTDB3
177000040603     C                   MOVEA     WIN           *IN
177100040603     C                   ENDIF
177200040603      * Inizializzazione indice tasti funzione personalizzati
177300040603     C                   Eval      PosFun = 25
177400040603      *
177500040603     C                   SELECT
177600040603      * Annullamento
177700040608     C     WOpzR85       WHENEQ    '04'
177800040603      * Visualizzazione
177900040608     C     WOpzR85       OREQ      '05'
178000040603     C                   WRITE     FMTDB3
178100040603     C                   EXFMT     PROTECT
178200040603      * Immissione/Modifica/Copia
178300040603     C                   OTHER
178400040603     C                   EXFMT     FMTDB3
178500040603     C                   ENDSL
178600040603      *
178700040603      * azzero la posizione del cursore
178800040603     C                   Z-ADD     0             H1RIGA
178900040603     C                   Z-ADD     0             H1COLO
179000040603      *
179100040603      * controllo abilitazione tasti funzione
179200040603     C                   EXSR      CTRKDx
179300040603      *
179400040603     C     *IN99         IFEQ      *OFF
179500040603      *
179600040603     C                   SELECT
179700040603      * ROLDOWN
179800040603     C     $TASTO        WHENEQ    ROLDWN
179900040603     C                   MOVE      'B2'          $GEST
180000040603      * ROLLUP
180100040603     C     $TASTO        WHENEQ    ROLLUP
180200040603     C                   MOVE      'B4'          $GEST
180300040603      * F3=Fine
180400040603     C     $TASTO        WHENEQ    F03
180500040603     C                   EXSR      F03DA1
180600040603      * F5=Refresh
180700040603     C     $TASTO        WHENEQ    F05
180800040603     C                   EXSR      F05DA1
180900040603      * F12=Ritorno
181000040603     C     $TASTO        WHENEQ    F12
181100040603     C                   EXSR      F12DA1
181200160608R218  * F19=Altri tasti
181300160608  "  C     $TASTO        WHENEQ    F19
181400160608R218 C                   EXSR      F19Dx
181500040603      * F24=Altri tasti
181600040603     C     $TASTO        WHENEQ    F24
181700040609     C                   EXSR      F24Dx
181800040603      * Personalizzata
181900040603     C     $PGF1(PosFun) Whenne    *BLANK
182000040603     C                   EXSR      FperDx
182100040603      *
182200040603     C                   OTHER
182300040603     C                   EXSR      CTRDB3
182400040603     C     *IN99         IFEQ      *OFF
182500040608     C                   EXSR      CTRDB1
182600060622C1943X***  *IN99         IFEQ      *ON
182700060622C1943C     *IN99         IFEQ      *Off
182800040608     C                   EXSR      CTRDB2
182900060622C1943X***  *IN99         IFEQ      *ON
183000060622C1943C     *IN99         IFEQ      *Off
183100040603     C                   EXSR      CTRDB4
183200060622C1943C     *IN99         IFEQ      *Off
183300060621  "  C                   EXSR      CTRDB5
183400060621C1943C                   ENDIF
183500040603     C                   ENDIF
183600040603     C                   ENDIF
183700040608      * Spengo gli indicatori di errore per il controllo su altri schermi
183800040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
183900040608      * videate
184000040608     C     *IN99         IFEQ      *ON
184100040608     C                   MOVE      *ALL'0'       IN5098           49
184200040608     C                   MOVEA     IN5098        *IN(50)
184300040608     C                   SETON                                        9996
184400040608     C                   ENDIF
184500040608     C                   ENDIF
184600040608      *
184700040608      * eseguo aggiornamento
184800040608     C     $TASTO        IFEQ      F06
184900040608     C     *IN99         ANDEQ     *OFF
185000040608     C                   EXSR      AGGANA
185100040608     C                   ENDIF
185200040603      *
185300040603     C                   ENDSL
185400040603      *
185500040603     C                   ENDIF
185600040603      *
185700040608     C     XGesDB3       ENDSR
185800040603      ************************************************************
185900040603      * CONTROLLO VIDEATA  D3
186000040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
186100040603      * 95 96 97 98
186200040603      ************************************************************
186300040603     C     CTRDB3        BEGSR
186400040603      *
186500040603     C                   SETOFF                                       99
186600040603      *
186700040603     C     XCtrDB3       ENDSR
186800040603      ************************************************************
186900040603      * GESTIONE VIDEO RECORD  DB4
187000040603      ************************************************************
187100040603     C     GESDB4        BEGSR
187200040603      * emissione piede videata se proveniente da altra
187300040603      * salvataggio valore formato di provenienza
187400040603     C     $LASTV        IFNE      'B4'
187500040603     C                   WRITE     FMTT1
187600040603     C                   EXSR      GESPIE
187700040603     C                   MOVE      $LASTV        $LASTG
187800040603     C                   MOVE      'B4'          $LASTV
187900040603     C                   ENDIF
188000040603      *
188100040603      * se esistono errori sulla videata
188200040603      * emetto la write del formato a indicatori spenti per vedere
188300040603      * le eventuali decodifiche
188400040603     C     *IN99         IFEQ      *ON
188500040603     C     $GEST         ANDEQ     'B4'
188600040603     C                   MOVEA     *IN           WIN
188700040603     C                   MOVE      *ALL'0'       IN5098           49
188800040603     C                   MOVEA     IN5098        *IN(50)
188900040603     C                   WRITE     FMTDB4
189000040603     C                   MOVEA     WIN           *IN
189100040603     C                   ENDIF
189200040603      * Inizializzazione indice tasti funzione personalizzati
189300040603     C                   Eval      PosFun = 25
189400040603      *
189500040603     C                   SELECT
189600040603      * Annullamento
189700040608     C     WOpzR85       WHENEQ    '04'
189800040603      * Visualizzazione
189900040608     C     WOpzR85       OREQ      '05'
190000040603     C                   WRITE     FMTDB4
190100040603     C                   EXFMT     PROTECT
190200040603      * Immissione/Modifica/Copia
190300040603     C                   OTHER
190400040603     C                   EXFMT     FMTDB4
190500040603     C                   ENDSL
190600040603      *
190700040603      * azzero la posizione del cursore
190800040603     C                   Z-ADD     0             H1RIGA
190900040603     C                   Z-ADD     0             H1COLO
191000040603      *
191100040603      * controllo abilitazione tasti funzione
191200040603     C                   EXSR      CTRKDx
191300040603      *
191400040603     C     *IN99         IFEQ      *OFF
191500040603      *
191600040603     C                   SELECT
191700060621C1943 * ROLLUP
191800060621  "  C     $TASTO        WHENEQ    ROLLUP
191900060621C1943C                   MOVE      'B5'          $GEST
192000040603      * ROLDOWN
192100040603     C     $TASTO        WHENEQ    ROLDWN
192200070423C2014X***                MOVE      'B3'          $GEST
192300070423C2014C                   MOVE      'B2'          $GEST
192400040603      * F3=Fine
192500040603     C     $TASTO        WHENEQ    F03
192600040603     C                   EXSR      F03DA1
192700040603      * F5=Refresh
192800040603     C     $TASTO        WHENEQ    F05
192900040603     C                   EXSR      F05DA1
193000040603      * F12=Ritorno
193100040603     C     $TASTO        WHENEQ    F12
193200040603     C                   EXSR      F12DA1
193300160608R218  * F19=Altri tasti
193400160608  "  C     $TASTO        WHENEQ    F19
193500160608R218 C                   EXSR      F19Dx
193600040603      * F24=Altri tasti
193700040603     C     $TASTO        WHENEQ    F24
193800040609     C                   EXSR      F24Dx
193900040603      * Personalizzata
194000040603     C     $PGF1(PosFun) Whenne    *BLANK
194100040603     C                   EXSR      FperDx
194200040603      *
194300040603     C                   OTHER
194400040603     C                   EXSR      CTRDB4
194500040603     C     *IN99         IFEQ      *OFF
194600040608     C                   EXSR      CTRDB1
194700060622C1943X***  *IN99         IFEQ      *ON
194800060622C1943C     *IN99         IFEQ      *Off
194900040603     C                   EXSR      CTRDB2
195000060622C1943X***  *IN99         IFEQ      *ON
195100060622C1943C     *IN99         IFEQ      *Off
195200040608     C                   EXSR      CTRDB3
195300060622C1943C     *IN99         IFEQ      *Off
195400060621  "  C                   EXSR      CTRDB5
195500060621C1943C                   ENDIF
195600040603     C                   ENDIF
195700040603     C                   ENDIF
195800040608      * Spengo gli indicatori di errore per il controllo su altri schermi
195900040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
196000040608      * videate
196100040608     C     *IN99         IFEQ      *ON
196200040608     C                   MOVE      *ALL'0'       IN5098           49
196300040608     C                   MOVEA     IN5098        *IN(50)
196400040608     C                   SETON                                        9996
196500040608     C                   ENDIF
196600040608     C                   ENDIF
196700040608      *
196800040608      * eseguo aggiornamento
196900040608     C     $TASTO        IFEQ      F06
197000040608     C     *IN99         ANDEQ     *OFF
197100040608     C                   EXSR      AGGANA
197200040608     C                   ENDIF
197300040603      *
197400040603     C                   ENDSL
197500040603      *
197600040603     C                   ENDIF
197700040603      *
197800040608     C     XGesDB4       ENDSR
197900040603      ************************************************************
198000040603      * CONTROLLO VIDEATA  D4
198100040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
198200040603      * 95 96 97 98
198300040603      ************************************************************
198400040603     C     CTRDB4        BEGSR
198500040603      *
198600040603     C                   SETOFF                                       99
198700040603      *
198800040603     C     XCtrDB4       ENDSR
198900060621C1943 ************************************************************
199000060621  "   * GESTIONE VIDEO RECORD  DB5
199100060621  "   ************************************************************
199200060621C1943C     GESDB5        BEGSR
199300060621      * emissione piede videata se proveniente da altra
199400060621      * salvataggio valore formato di provenienza
199500060621     C     $LASTV        IFNE      'B5'
199600060621     C                   WRITE     FMTT1
199700060621     C                   EXSR      GESPIE
199800060621     C                   MOVE      $LASTV        $LASTG
199900060621     C                   MOVE      'B5'          $LASTV
200000060621     C                   ENDIF
200100060621      *
200200060621      * se esistono errori sulla videata
200300060621      * emetto la write del formato a indicatori spenti per vedere
200400060621      * le eventuali decodifiche
200500060621     C     *IN99         IFEQ      *ON
200600060621     C     $GEST         ANDEQ     'B5'
200700060621     C                   MOVEA     *IN           WIN
200800060621     C                   MOVE      *ALL'0'       IN5098           49
200900060621     C                   MOVEA     IN5098        *IN(50)
201000060621     C                   WRITE     FMTDB5
201100060621     C                   MOVEA     WIN           *IN
201200060621     C                   ENDIF
201300060621      * Inizializzazione indice tasti funzione personalizzati
201400060621     C                   Eval      PosFun = 25
201500060621      *
201600060621     C                   SELECT
201700060621      * Annullamento
201800060621     C     WOpzR85       WHENEQ    '04'
201900060621      * Visualizzazione
202000060621     C     WOpzR85       OREQ      '05'
202100060621     C                   WRITE     FMTDB5
202200060621     C                   EXFMT     PROTECT
202300060621      * Immissione/Modifica/Copia
202400060621     C                   OTHER
202500060621     C                   EXFMT     FMTDB5
202600060621     C                   ENDSL
202700060621      *
202800060621      * azzero la posizione del cursore
202900060621     C                   Z-ADD     0             H1RIGA
203000060621     C                   Z-ADD     0             H1COLO
203100060621      *
203200060621      * controllo abilitazione tasti funzione
203300060621     C                   EXSR      CTRKDx
203400060621      *
203500060621     C     *IN99         IFEQ      *OFF
203600060621      *
203700060621     C                   SELECT
203800060621      * ROLDOWN
203900060621     C     $TASTO        WHENEQ    ROLDWN
204000060621     C                   MOVE      'B4'          $GEST
204100060621      * F3=Fine
204200060621     C     $TASTO        WHENEQ    F03
204300060621     C                   EXSR      F03DA1
204400060621      * F5=Refresh
204500060621     C     $TASTO        WHENEQ    F05
204600060621     C                   EXSR      F05DA1
204700060621      * F12=Ritorno
204800060621     C     $TASTO        WHENEQ    F12
204900060621     C                   EXSR      F12DA1
205000160608R218  * F19=Altri tasti
205100160608  "  C     $TASTO        WHENEQ    F19
205200160608R218 C                   EXSR      F19Dx
205300060621      * F24=Altri tasti
205400060621     C     $TASTO        WHENEQ    F24
205500060621     C                   EXSR      F24Dx
205600060621      * Personalizzata
205700060621     C     $PGF1(PosFun) Whenne    *BLANK
205800060621     C                   EXSR      FperDx
205900060621      *
206000060621     C                   OTHER
206100060621     C                   EXSR      CTRDB5
206200060621     C     *IN99         IFEQ      *OFF
206300060621     C                   EXSR      CTRDB1
206400060621     C     *IN99         IFEQ      *ON
206500060621     C                   EXSR      CTRDB2
206600060621     C     *IN99         IFEQ      *ON
206700060621     C                   EXSR      CTRDB3
206800060621     C     *IN99         IFEQ      *ON
206900060621     C                   EXSR      CTRDB4
207000060621     C                   ENDIF
207100060621     C                   ENDIF
207200060621     C                   ENDIF
207300060621      * Spengo gli indicatori di errore per il controllo su altri schermi
207400060621      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
207500060621      * videate
207600060621     C     *IN99         IFEQ      *ON
207700060621     C                   MOVE      *ALL'0'       IN5098           49
207800060621     C                   MOVEA     IN5098        *IN(50)
207900060621     C                   SETON                                        9996
208000060621     C                   ENDIF
208100060621     C                   ENDIF
208200060621      *
208300060621      * eseguo aggiornamento
208400060621     C     $TASTO        IFEQ      F06
208500060621     C     *IN99         ANDEQ     *OFF
208600060621     C                   EXSR      AGGANA
208700060621     C                   ENDIF
208800060621      *
208900060621     C                   ENDSL
209000060621      *
209100060621     C                   ENDIF
209200060621      *
209300060621C1943C     XGesDB5       ENDSR
209400060621C1943 ************************************************************
209500060621  "   * CONTROLLO VIDEATA  D5
209600060621  "   * non usare i seguenti indicatori (perchè relativi a D1MSG):
209700060621  "   * 95 96 97 98
209800060621  "   ************************************************************
209900060621C1943C     CTRDB5        BEGSR
210000060621      *
210100060621     C                   SETOFF                                       99
210200060621      *
210300060621C1943C     XCtrDB5       ENDSR
210400040603Z*****************************************************************
210500040603      * GESTIONE VIDEO RECORD DZ1
210600040603      ************************************************************
210700040603     C     GESDZ1        BEGSR
210800040603      * inizializzazione videata
210900040603     C     $INZDX        IFEQ      *ON
211000040603     C                   EXSR      INZDX
211100040603     C                   MOVE      *OFF          $INZDX
211200040603     C                   ENDIF
211300040603      * emissione piede videata se proveniente da altra
211400040603      * salvataggio valore formato di provenienza
211500040603     C     $LASTV        IFNE      'Z1'
211600040603     C                   WRITE     FMTT1
211700040603     C                   EXSR      GESPIE
211800040603     C                   MOVE      $LASTV        $LASTG
211900040603     C                   MOVE      'Z1'          $LASTV
212000040603     C                   ENDIF
212100040603      *
212200040603      * se esistono errori sulla videata
212300040603      * emetto la write del formato a indicatori spenti per vedere
212400040603      * le eventuali decodifiche
212500040603     C     *IN99         IFEQ      *ON
212600040603     C     $GEST         ANDEQ     'Z1'
212700040603     C                   MOVEA     *IN           WIN
212800040603     C                   MOVE      *ALL'0'       IN5098           49
212900040603     C                   MOVEA     IN5098        *IN(50)
213000040603     C                   WRITE     FMTDZ1
213100040603     C                   MOVEA     WIN           *IN
213200040603     C                   ENDIF
213300040603      * Inizializzazione indice tasti funzione personalizzati
213400040603     C                   Eval      PosFun = 25
213500040603      *
213600040603     C                   SELECT
213700040603      * Annullamento
213800040608     C     WOpzR85       WHENEQ    '04'
213900040603      * Visualizzazione
214000040608     C     WOpzR85       OREQ      '05'
214100040603     C                   WRITE     FMTDZ1
214200040603     C                   EXFMT     PROTECT
214300040603      * Immissione/Modifica/Copia
214400040603     C                   OTHER
214500040603     C                   EXFMT     FMTDZ1
214600040603     C                   ENDSL
214700040603      *
214800040603      * azzero la posizione del cursore
214900040603     C                   Z-ADD     0             H1RIGA
215000040603     C                   Z-ADD     0             H1COLO
215100040603      *
215200040603      * controllo abilitazione tasti funzione
215300040603     C                   EXSR      CTRKDx
215400040603      *
215500040603     C     *IN99         IFEQ      *OFF
215600040603      *
215700040603     C                   SELECT
215800040603      * ROLLUP
215900040603     C     $TASTO        WHENEQ    ROLLUP
216000040603     C                   MOVE      'Z2'          $GEST
216100040603      * F3=Fine
216200040603     C     $TASTO        WHENEQ    F03
216300040603     C                   EXSR      F03DA1
216400040603      * F5=Refresh
216500040603     C     $TASTO        WHENEQ    F05
216600040603     C                   EXSR      F05DA1
216700040603      * F12=Ritorno
216800040603     C     $TASTO        WHENEQ    F12
216900040603     C                   EXSR      F12DA1
217000160608R218  * F19=Altri tasti
217100160608  "  C     $TASTO        WHENEQ    F19
217200160608R218 C                   EXSR      F19Dx
217300040603      * F24=Altri tasti
217400040603     C     $TASTO        WHENEQ    F24
217500040603     C                   EXSR      F24Dx
217600040603      * Personalizzata
217700040603     C     $PGF1(PosFun) WHENNE    *BLANK
217800040603     C                   EXSR      FPerDx
217900040603      *
218000040603     C                   OTHER
218100040603     C                   EXSR      CTRDZ1
218200040603     C     *IN99         IFEQ      *OFF
218300040603     C                   EXSR      CTRDZ2
218400040603     C     *IN99         IFEQ      *ON
218500040603     C                   EXSR      CTRDZ3
218600040603     C                   ENDIF
218700040608      * Spengo gli indicatori di errore per il controllo su altri schermi
218800040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
218900040608      * videate
219000040608     C     *IN99         IFEQ      *ON
219100040608     C                   MOVE      *ALL'0'       IN5098           49
219200040608     C                   MOVEA     IN5098        *IN(50)
219300040608     C                   SETON                                        9996
219400040608     C                   ENDIF
219500040608     C                   ENDIF
219600040608      *
219700040608      * eseguo aggiornamento
219800040608     C     $TASTO        IFEQ      F06
219900040608     C     *IN99         ANDEQ     *OFF
220000040608     C                   EXSR      AGGANA
220100040608     C                   ENDIF
220200040603      *
220300040603     C                   ENDSL
220400040603      *
220500040603     C                   ENDIF
220600040603      *
220700040603     C     XGesDZ1       ENDSR
220800040603      ************************************************************
220900040603      * CONTROLLO VIDEATA
221000040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
221100040603      * 95 96 97 98
221200040603      ************************************************************
221300040603     C     CTRDZ1        BEGSR
221400040603      *
221500040603     C                   SETOFF                                       99
221600040603      *
221700040603     C     XCtrDZ1       ENDSR
221800040603      ************************************************************
221900040603      * GESTIONE VIDEO RECORD  DZ2
222000040603      ************************************************************
222100040603     C     GESDZ2        BEGSR
222200040603      * emissione piede videata se proveniente da altra
222300040603      * salvataggio valore formato di provenienza
222400040603     C     $LASTV        IFNE      'Z2'
222500040603     C                   WRITE     FMTT1
222600040603     C                   EXSR      GESPIE
222700040603     C                   MOVE      $LASTV        $LASTG
222800040603     C                   MOVE      'Z2'          $LASTV
222900040603     C                   ENDIF
223000040603      *
223100040603      * se esistono errori sulla videata
223200040603      * emetto la write del formato a indicatori spenti per vedere
223300040603      * le eventuali decodifiche
223400040603     C     *IN99         IFEQ      *ON
223500040603     C     $GEST         ANDEQ     'Z2'
223600040603     C                   MOVEA     *IN           WIN
223700040603     C                   MOVE      *ALL'0'       IN5098           49
223800040603     C                   MOVEA     IN5098        *IN(50)
223900040603     C                   WRITE     FMTDZ2
224000040603     C                   MOVEA     WIN           *IN
224100040603     C                   ENDIF
224200040603      * Inizializzazione indice tasti funzione personalizzati
224300040603     C                   Eval      PosFun = 25
224400040603      *
224500040603     C                   SELECT
224600040603      * Annullamento
224700040608     C     WOpzR85       WHENEQ    '04'
224800040603      * Visualizzazione
224900040608     C     WOpzR85       OREQ      '05'
225000040603     C                   WRITE     FMTDZ2
225100040603     C                   EXFMT     PROTECT
225200040603      * Immissione/Modifica/Copia
225300040603     C                   OTHER
225400040603     C                   EXFMT     FMTDZ2
225500040603     C                   ENDSL
225600040603      *
225700040603      * azzero la posizione del cursore
225800040603     C                   Z-ADD     0             H1RIGA
225900040603     C                   Z-ADD     0             H1COLO
226000040603      *
226100040603      * controllo abilitazione tasti funzione
226200040603     C                   EXSR      CTRKDx
226300040603      *
226400040603     C     *IN99         IFEQ      *OFF
226500040603      *
226600040603     C                   SELECT
226700040603      * ROLLUP
226800040603     C     $TASTO        WHENEQ    ROLLUP
226900040603     C                   MOVE      'Z3'          $GEST
227000040603      * ROLDOWN
227100040603     C     $TASTO        WHENEQ    ROLDWN
227200040603     C                   MOVE      'Z1'          $GEST
227300040603      * F3=Fine
227400040603     C     $TASTO        WHENEQ    F03
227500040603     C                   EXSR      F03DA1
227600040603      * F5=Refresh
227700040603     C     $TASTO        WHENEQ    F05
227800040603     C                   EXSR      F05DA1
227900040603      * F12=Ritorno
228000040603     C     $TASTO        WHENEQ    F12
228100040603     C                   EXSR      F12DA1
228200160608R218  * F19=Altri tasti
228300160608  "  C     $TASTO        WHENEQ    F19
228400160608R218 C                   EXSR      F19Dx
228500040603      * F24=Altri tasti
228600040603     C     $TASTO        WHENEQ    F24
228700040603     C                   EXSR      F24Dx
228800040603      * Personalizzata
228900040603     C     $PGF1(PosFun) Whenne    *BLANK
229000040603     C                   EXSR      FperDx
229100040603      *
229200040603     C                   OTHER
229300040603     C                   EXSR      CTRDZ2
229400040603     C     *IN99         IFEQ      *OFF
229500040603     C                   EXSR      CTRDZ1
229600040603     C     *IN99         IFEQ      *ON
229700040603     C                   EXSR      CTRDZ3
229800040603     C                   ENDIF
229900040608      * Spengo gli indicatori di errore per il controllo su altri schermi
230000040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
230100040608      * videate
230200040608     C     *IN99         IFEQ      *ON
230300040608     C                   MOVE      *ALL'0'       IN5098           49
230400040608     C                   MOVEA     IN5098        *IN(50)
230500040608     C                   SETON                                        9996
230600040608     C                   ENDIF
230700040608     C                   ENDIF
230800040608      *
230900040608      * eseguo aggiornamento
231000040608     C     $TASTO        IFEQ      F06
231100040608     C     *IN99         ANDEQ     *OFF
231200040608     C                   EXSR      AGGANA
231300040608     C                   ENDIF
231400040603      *
231500040603     C                   ENDSL
231600040603      *
231700040603     C                   ENDIF
231800040603      *
231900040603     C     XGesDZ2       ENDSR
232000040603      ************************************************************
232100040603      * CONTROLLO VIDEATA  D2
232200040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
232300040603      * 95 96 97 98
232400040603      ************************************************************
232500040603     C     CTRDZ2        BEGSR
232600040603      *
232700040603     C                   SETOFF                                       99
232800040603      *
232900040603     C     XCtrDZ2       ENDSR
233000040603      ************************************************************
233100040603      * GESTIONE VIDEO RECORD  DZ3
233200040603      ************************************************************
233300040603     C     GESDZ3        BEGSR
233400040603      * emissione piede videata se proveniente da altra
233500040603      * salvataggio valore formato di provenienza
233600040603     C     $LASTV        IFNE      'Z3'
233700040603     C                   WRITE     FMTT1
233800040603     C                   EXSR      GESPIE
233900040603     C                   MOVE      $LASTV        $LASTG
234000040603     C                   MOVE      'Z3'          $LASTV
234100040603     C                   ENDIF
234200040603      *
234300040603      * se esistono errori sulla videata
234400040603      * emetto la write del formato a indicatori spenti per vedere
234500040603      * le eventuali decodifiche
234600040603     C     *IN99         IFEQ      *ON
234700040603     C     $GEST         ANDEQ     'Z3'
234800040603     C                   MOVEA     *IN           WIN
234900040603     C                   MOVE      *ALL'0'       IN5098           49
235000040603     C                   MOVEA     IN5098        *IN(50)
235100040603     C                   WRITE     FMTDZ3
235200040603     C                   MOVEA     WIN           *IN
235300040603     C                   ENDIF
235400040603      * Inizializzazione indice tasti funzione personalizzati
235500040603     C                   Eval      PosFun = 25
235600040603      *
235700040603     C                   SELECT
235800040603      * Annullamento
235900040608     C     WOpzR85       WHENEQ    '04'
236000040603      * Visualizzazione
236100040608     C     WOpzR85       OREQ      '05'
236200040603     C                   WRITE     FMTDZ3
236300040603     C                   EXFMT     PROTECT
236400040603      * Immissione/Modifica/Copia
236500040603     C                   OTHER
236600040603     C                   EXFMT     FMTDZ3
236700040603     C                   ENDSL
236800040603      *
236900040603      * azzero la posizione del cursore
237000040603     C                   Z-ADD     0             H1RIGA
237100040603     C                   Z-ADD     0             H1COLO
237200040603      *
237300040603      * controllo abilitazione tasti funzione
237400040603     C                   EXSR      CTRKDx
237500040603      *
237600040603     C     *IN99         IFEQ      *OFF
237700040603      *
237800040603     C                   SELECT
237900040603      * ROLDOWN
238000040603     C     $TASTO        WHENEQ    ROLDWN
238100040603     C                   MOVE      'Z2'          $GEST
238200040603      * F3=Fine
238300040603     C     $TASTO        WHENEQ    F03
238400040603     C                   EXSR      F03DA1
238500040603      * F5=Refresh
238600040603     C     $TASTO        WHENEQ    F05
238700040603     C                   EXSR      F05DA1
238800040603      * F12=Ritorno
238900040603     C     $TASTO        WHENEQ    F12
239000040603     C                   EXSR      F12DA1
239100160608R218  * F19=Altri tasti
239200160608  "  C     $TASTO        WHENEQ    F19
239300160608R218 C                   EXSR      F19Dx
239400040603      * F24=Altri tasti
239500040603     C     $TASTO        WHENEQ    F24
239600040609     C                   EXSR      F24Dx
239700040603      * Personalizzata
239800040603     C     $PGF1(PosFun) Whenne    *BLANK
239900040603     C                   EXSR      FperDx
240000040603      *
240100040603     C                   OTHER
240200040603     C                   EXSR      CTRDZ3
240300040603     C     *IN99         IFEQ      *OFF
240400040608     C                   EXSR      CTRDZ1
240500040603     C     *IN99         IFEQ      *ON
240600040608     C                   EXSR      CTRDZ2
240700040603     C                   ENDIF
240800040608      * Spengo gli indicatori di errore per il controllo su altri schermi
240900040608      * per evitare il conflitto fra gli stessi indicatori usati in divers  e
241000040608      * videate
241100040608     C     *IN99         IFEQ      *ON
241200040608     C                   MOVE      *ALL'0'       IN5098           49
241300040608     C                   MOVEA     IN5098        *IN(50)
241400040608     C                   SETON                                        9996
241500040608     C                   ENDIF
241600040608     C                   ENDIF
241700040608      *
241800040608      * eseguo aggiornamento
241900040608     C     $TASTO        IFEQ      F06
242000040608     C     *IN99         ANDEQ     *OFF
242100040608     C                   EXSR      AGGANA
242200040608     C                   ENDIF
242300040603      *
242400040603     C                   ENDSL
242500040603      *
242600040603     C                   ENDIF
242700040603      *
242800040603     C     XGesDZ3       ENDSR
242900040603      ************************************************************
243000040603      * CONTROLLO VIDEATA  D3
243100040603      * non usare i seguenti indicatori (perchè relativi a D1MSG):
243200040603      * 95 96 97 98
243300040603      ************************************************************
243400040603     C     CTRDZ3        BEGSR
243500040603      *
243600040603     C                   SETOFF                                       99
243700040603      *
243800040603     C     XCtrDZ3       ENDSR
243900040603******************************************************************
244000040603      * AGGIORNAMENTO ANAGRAFICA
244100040603      ************************************************************
244200040603     C     AGGANA        BEGSR
244300040603      *
244400040609      *-------------------------------------------
244500040609     C                   select
244600040609    >C                   when      WOpzR85 ='02'
244700040609     C                   exsr      RieAna
244800160608R218 C                   exsr      AggDatiSav
244900040609    >C                   update    M77099
245000040609     C                   endsl
245100040603      *
245200040609      *-------------------------------------------
245300040603      * richiama pgm User Exit
245400040603     C     USRERR        IFEQ      *BLANK
245500040603      * passa opzione ricevuta a user exit
245600040608    >C                   MOVEL     WOpzR85       XUKOPZ
245700040603      * imposta chiave univoca  per user exit
245800040603     C                   MOVE      XSCSOC        XUKSOC
245900040603     C                   MOVE      XSCDUN        XUKDUN
246000040603     C                   MOVEL     DSPGM         XUKPGM
246100040609    >C                   MOVEL     D1TpRec       XUKFL1
246200040609    > * ho fino a 6 campi chiave passabili
246300040603     C                   MOVEL     XUKDS         KPJBU
246400040603     C     DSPGM         CAT       'U':0         USREXT           10
246500040603     C                   CALL      USREXT                               21
246600040603     C                   PARM                    KPJBA
246700040603     C     *IN21         IFEQ      *ON
246800040603     C                   MOVE      *ON           USRERR            1
246900040603     C                   ENDIF
247000040603     C                   ENDIF
247100040603      *
247200040608      *-------------------------------------------
247300040608      * eseguo operazioni del dopo-aggiornamento
247400040608     C                   if        *in99 = *off
247500040608      * segnalo al pgm chiamante l'avvenuta conferma
247600040608     C                   MOVE      *ON           OPRR85
247700040608      * segnalo al pgm chiamante l'aver premuto l'F6
247800040608     C                   MOVE      '0'           RETR85
247900040608      * ritorno alla PARZIALIZZAZIONE
248000040608     C                   move      'D1'          $GEST
248100040608     C                   endif
248200040608      *
248300040603     C     XAggAna       ENDSR
248400040603      ************************************************************
248500040603      * RIEMPIMENTO FILE IN AGGIORNAMENTO
248600040603      ************************************************************
248700040603     C     RIEANA        BEGSR
248800040603      *
248900040609     C                   select
249000040609     C                   when      D1TpRec='A'
249100040609     C                   eval      Mfrec = TpRecADS
249200040609     C                   when      D1TpRec='B'
249300040609     C                   eval      Mfrec = TpRecBDS
249400040609     C                   when      D1TpRec='Z'
249500040609     C                   eval      Mfrec = TpRecZDS
249600040609     C                   endsl
249700040603      *
249800040603     C     XRieAna       ENDSR
249900040603      ************************************************************
250000040603      * CONTROLLO ABILITAZIONE TASTI
250100040603      ************************************************************
250200040603     C     CTRKEY        BEGSR
250300040603      *
250400040603     C                   SELECT
250500040603     C     $TASTO        WHENEQ    F01
250600040603     C                   Z-ADD     01            PosFun
250700040603     C     $FC(1)        IFEQ      '0'
250800040603     C                   SETON                                        99
250900040603     C                   ENDIF
251000040603     C     $TASTO        WHENEQ    F02
251100040603     C                   Z-ADD     02            PosFun
251200040603     C     $FC(2)        IFEQ      '0'
251300040603     C                   SETON                                        99
251400040603     C                   ENDIF
251500040603     C     $TASTO        WHENEQ    F03
251600040603     C                   Z-ADD     03            PosFun
251700040603     C     $FC(3)        IFEQ      '0'
251800040603     C                   SETON                                        99
251900040603     C                   ENDIF
252000040603     C     $TASTO        WHENEQ    F04
252100040603     C                   Z-ADD     04            PosFun
252200040603     C     $FC(4)        IFEQ      '0'
252300040603     C                   SETON                                        99
252400040603     C                   ENDIF
252500040603     C     $TASTO        WHENEQ    F05
252600040603     C                   Z-ADD     05            PosFun
252700040603     C     $FC(5)        IFEQ      '0'
252800040603     C                   SETON                                        99
252900040603     C                   ENDIF
253000040603     C     $TASTO        WHENEQ    F06
253100040603     C                   Z-ADD     06            PosFun
253200040603     C     $FC(6)        IFEQ      '0'
253300040603     C                   SETON                                        99
253400040603     C                   ENDIF
253500040603     C     $TASTO        WHENEQ    F07
253600040603     C                   Z-ADD     07            PosFun
253700040603     C     $FC(7)        IFEQ      '0'
253800040603     C                   SETON                                        99
253900040603     C                   ENDIF
254000040603     C     $TASTO        WHENEQ    F08
254100040603     C                   Z-ADD     08            PosFun
254200040603     C     $FC(8)        IFEQ      '0'
254300040603     C                   SETON                                        99
254400040603     C                   ENDIF
254500040603     C     $TASTO        WHENEQ    F09
254600040603     C                   Z-ADD     09            PosFun
254700040603     C     $FC(09)       IFEQ      '0'
254800040603     C                   SETON                                        99
254900040603     C                   ENDIF
255000040603     C     $TASTO        WHENEQ    F10
255100040603     C                   Z-ADD     10            PosFun
255200040603     C     $FC(10)       IFEQ      '0'
255300040603     C                   SETON                                        99
255400040603     C                   ENDIF
255500040603     C     $TASTO        WHENEQ    F11
255600040603     C                   Z-ADD     11            PosFun
255700040603     C     $FC(11)       IFEQ      '0'
255800040603     C                   SETON                                        99
255900040603     C                   ENDIF
256000040603     C     $TASTO        WHENEQ    F12
256100040603     C                   Z-ADD     12            PosFun
256200040603     C     $FC(12)       IFEQ      '0'
256300040603     C                   SETON                                        99
256400040603     C                   ENDIF
256500040603     C     $TASTO        WHENEQ    F13
256600040603     C                   Z-ADD     13            PosFun
256700040603     C     $FC(13)       IFEQ      '0'
256800040603     C                   SETON                                        99
256900040603     C                   ENDIF
257000040603     C     $TASTO        WHENEQ    F14
257100040603     C                   Z-ADD     14            PosFun
257200040603     C     $FC(14)       IFEQ      '0'
257300040603     C                   SETON                                        99
257400040603     C                   ENDIF
257500040603     C     $TASTO        WHENEQ    F15
257600040603     C                   Z-ADD     15            PosFun
257700040603     C     $FC(15)       IFEQ      '0'
257800040603     C                   SETON                                        99
257900040603     C                   ENDIF
258000040603     C     $TASTO        WHENEQ    F16
258100040603     C                   Z-ADD     16            PosFun
258200040603     C     $FC(16)       IFEQ      '0'
258300040603     C                   SETON                                        99
258400040603     C                   ENDIF
258500040603     C     $TASTO        WHENEQ    F17
258600040603     C                   Z-ADD     17            PosFun
258700040603     C     $FC(17)       IFEQ      '0'
258800040603     C                   SETON                                        99
258900040603     C                   ENDIF
259000040603     C     $TASTO        WHENEQ    F18
259100040603     C                   Z-ADD     18            PosFun
259200040603     C     $FC(18)       IFEQ      '0'
259300040603     C                   SETON                                        99
259400040603     C                   ENDIF
259500040603     C     $TASTO        WHENEQ    F19
259600040603     C                   Z-ADD     19            PosFun
259700040603     C     $FC(19)       IFEQ      '0'
259800040603     C                   SETON                                        99
259900040603     C                   ENDIF
260000040603     C     $TASTO        WHENEQ    F20
260100040603     C                   Z-ADD     20            PosFun
260200040603     C     $FC(20)       IFEQ      '0'
260300040603     C                   SETON                                        99
260400040603     C                   ENDIF
260500040603     C     $TASTO        WHENEQ    F21
260600040603     C                   Z-ADD     21            PosFun
260700040603     C     $FC(21)       IFEQ      '0'
260800040603     C                   SETON                                        99
260900040603     C                   ENDIF
261000040603     C     $TASTO        WHENEQ    F22
261100040603     C                   Z-ADD     22            PosFun
261200040603     C     $FC(22)       IFEQ      '0'
261300040603     C                   SETON                                        99
261400040603     C                   ENDIF
261500040603     C     $TASTO        WHENEQ    F23
261600040603     C                   Z-ADD     23            PosFun
261700040603     C     $FC(23)       IFEQ      '0'
261800040603     C                   SETON                                        99
261900040603     C                   ENDIF
262000040603     C     $TASTO        WHENEQ    F24
262100040603     C                   Z-ADD     24            PosFun
262200040603     C     $FC(24)       IFEQ      '0'
262300040603     C                   SETON                                        99
262400040603     C                   ENDIF
262500040603     C                   ENDSL
262600040603      *
262700040603     C     XCtrKey       ENDSR
262800040603      ******************************************************
262900040603      * PGM PER GESTIONE MESSAGGI ERRORE                   *
263000040603      ******************************************************
263100040603     C     MSGPGM        BEGSR
263200040603      *
263300040603     C                   Z-ADD     2             MSGMSG
263400040603     C                   MOVEL     'S'           MSGRSP
263500040603     C                   MOVEL     'CR'          MSGTPR
263600040603     C                   MOVEL     'S'           MSGEMV
263700040603     C                   Z-ADD     10            MSGRGP
263800040603     C                   MOVEL     'S'           MSGLCK
263900040603     C                   MOVEA     STATUS        STS
264000040603     C                   MOVEL     'N'           MSGCNL
264100040603     C                   MOVEL     'N'           MSGVID
264200040603     C                   MOVEL     'N'           MSGOPE
264300040603     C                   MOVEL     'N'           MSGSTP
264400040603     C                   CALL      'XMSGR'
264500040603     C                   PARM                    XMSGDS
264600040603      *
264700040603     C     XMsgPgm       ENDSR
264800040603      ************************************************************
264900040603      * OPERAZIONI INIZIALI
265000040603      ************************************************************
265100040603     C     *INZSR        BEGSR
265200040603      *
265300040603      * Reperimento parametri
265400040603     C     *ENTRY        PLIST
265500040603     C                   PARM                    KPJBA
265600040603     C                   PARM                    DSAUT
265700040603      *
265800040603      * Reperimento dati società
265900040603     C                   MOVEL     'SOC001'      TIPXSC
266000040603     C                   MOVEL     *BLANK        SOCXSC
266100040603     C                   EXSR      REPSOC
266200040603      *
266300040603      * Controlli dati società
266400040603     C     RTNXSC        IFNE      '1'
266500040603     C                   MOVEL     XSOCDS        SOC001
266600040603     C                   ELSE
266700040603     C                   MOVE      '1'           ErrR85
266800040603     C                   MOVE      *on           $Fine
266900040603     C                   EXSR      EndPgm
267000040603     C                   ENDIF
267100040603      *
267200040603      * testo se sono stati passati i dati di autorizzazione
267300040603     C     PARMS         IFLT      2
267400040603     C                   MOVE      *BLANK        AUTDS
267500040603     C                   ELSE
267600040603     C                   MOVEL     DSAUT         AUTDS
267700040603     C                   ENDIF
267800040603      *
267900040603      * reperisco le dimensioni delle variabili che conterranno i tasti
268000040603     C                   EVAL      $D1L01 = %Size(Z1Ke1)
268100040603     C                   EVAL      $D1L02 = %Size(Z1Ke2)
268200040608     C                   EVAL      $DxL01 = %Size(Z2Ke1)
268300040608     C                   EVAL      $DxL02 = %Size(Z2Ke2)
268400040603      *
268500040603      * Reperimento tasti di funzione
268600040603     C                   EXSR      REPKEY
268700040603      *
268800040603      * Richiamo routine per aggiunta tasti funzione personalizzati
268900040603     C                   CAllb     'X46USREXT'
269000040603     C                   PARM                    *omit
269100040603     C                   PARM                    *omit
269200040603     C                   PARM                    *omit
269300040603     C                   PARM                    *omit
269400040603     C                   PARM                    *omit
269500040603     C                   PARM                    $FX1
269600040603     C                   PARM                    $FC1
269700040603     C                   PARM                    $PGF1
269800040603     C                   PARM                    DsPgm
269900040603     C                   PARM                    xsccut
270000040603     C                   PARM                    xscgrp
270100040603      *
270200040603     C     XInzSr        ENDSR
270300040603      ************************************************************
270400040603      * REPERIMENTO TASTI DI FUNZIONE
270500040603      ************************************************************
270600040603     C     REPKEY        BEGSR
270700040603      *
270800040603     C                   MOVEA     $FM1          $FM
270900040603     C                   MOVEA     $FC1          $FC
271000040603     C                   EXSR      REPKKK
271100040603     C                   MOVEA     $FX           $FX1
271200040608      *
271300040608     C                   MOVEA     $FM2          $FM
271400040608     C                   MOVEA     $FC2          $FC
271500040608     C                   EXSR      REPKKK
271600040608     C                   MOVEA     $FX           $FX2
271700040603      *
271800040603     C     XRepKey       ENDSR
271900040603      ************************************************************
272000040603      * REPERIMENTO TASTI DI FUNZIONE
272100040603      ************************************************************
272200040603     C     REPKKK        BEGSR
272300040603      *
272400040603     C                   CLEAR                   $FX
272500040603     C     1             DO        24            X
272600040603      *
272700040603     C     $FM(X)        IFNE      *BLANK
272800040603     C     $FC(X)        ANDNE     '0'
272900040603      *
273000040603     C                   MOVEL     $FM(X)        IDMSG
273100040603     C                   CALLB     'XRTVM'
273200040603     C                   PARM                    IDMSG            27
273300040603     C                   PARM                    TXTMSG          100
273400040603     C                   PARM                    ERRMSG            1
273500040603      *
273600040603     C     ERRMSG        IFNE      *ON
273700040603     C                   MOVEL     TXTMSG        $FX(X)
273800040603     C                   ELSE
273900040603     C                   MOVEL     *ALL' '       $FX(X)
274000040603     C                   ENDIF
274100040603      *
274200040603     C                   ENDIF
274300040603      *
274400040603     C                   ENDDO
274500040603      *
274600040603     C     XRepKKK       ENDSR
274700040603      ************************************************************
274800040603      * INIZIALIZZAZIONE VARIABILI
274900040603      ************************************************************
275000040603     C     INZVAR        BEGSR
275100040603      *
275200040603      * Dati da PGM guida
275300040603     C                   MOVEL     KPJBU         NDCR85DS
275400040603      *
275500040603      * Se società diversa da quella impostata nella *inzsr, rieseguo
275600040603      * reperimento dati società
275700040603     C                   If        SocietaR85 <> xscsoc    and
275800040603     C                             OpzR85 <> *blank
275900040603     C                   MOVEL     'SOC001'      TIPXSC
276000040603     C                   MOVEL     SocietaR85    SOCXSC
276100040603     C                   EXSR      REPSOC
276200040603     C     RTNXSC        IFNE      '1'
276300040603     C                   MOVEL     XSOCDS        SOC001
276400040603     C                   ELSE
276500040603     C                   MOVE      '1'           ErrR85
276600040603     C                   MOVE      *on           $Fine
276700040603     C                   EXSR      EndPgm
276800040603     C                   ENDIF
276900040603     C                   endif
277000040621D1630C*
277100040621D1630C                   EXSR      OvrND770
277200040603      *
277300040603      * Reperimento autorizzazioni
277400040603      *
277500040603    > *  nel caso l'anagrafica non gestisse le autorizzazioni
277600040603    > *   asteriscare la chiamata alla subroutine REPAUT
277700040603      * le autorizzazioni potrebbero essere già state passate,
277800040603      * nel qual caso non vanno reperite
277900040603    >C*    AUTDS         IFEQ      *BLANK
278000040603    >C*                  EXSR      REPAUT
278100040603    >C*                  ELSE
278200040603    >C*                  MOVEL     XCADDS        ______DS
278300040603    >C*                  ENDIF
278400040603      *
278500040603      * Ctrl se l'opzione con cui è stato richiamato è congruente con
278600040603      * le autorizzazione
278700040603      *
278800040603    > *  nel caso l'anagrafica non gestisse le autorizzazioni
278900040603    > *   asteriscare la chiamata alla subroutine TSTAUT
279000040603    >C*                  EXSR      TSTAUT
279100040603      *
279200040603      * Definizione dei tasti funzione utilizzabili a pgm
279300040603     C                   EXSR      DEFOPZ
279400040603      *
279500040603      * Variabili per gestione videate
279600040603     C                   MOVE      'D1'          $GEST
279700040603     C                   MOVE      *OFF          $FINE
279800040609     C                   MOVE      *Off          $INZDX
279900040609     C                   MOVE      *ON           $INZD1
280000040603     C                   MOVE      *BLANK        $LASTG
280100040603     C                   MOVE      *BLANK        $LASTV
280200040603     C                   Z-ADD     0             $ULKD1            3 0
280300040608     C                   Z-ADD     0             $ULKDx            3 0
280400040603      * azzero la posizione del cursore
280500040603     C                   Z-ADD     0             H1RIGA
280600040603     C                   Z-ADD     0             H1COLO
280700040603      *
280800040603      * Variabili appoggio
280900040603     C                   Z-ADD     0             CURR
281000040603     C                   Z-ADD     0             CURC
281100040603      *
281200040603      * Valorizzazione campi univoci testate
281300040603     C                   CLEAR                   FMTT1
281400040603     C                   MOVEL     KNSIF         NOMSIF
281500040603     C                   MOVEL     XSCDSI        NOMDIT
281600040603     C                   MOVEL     DSPGM         NOMPGM
281700040603      * recupero il sottotitolo (se c'è)
281800040603     C                   MOVEL     *BLANK        T1TIT
281900040603     C     SOTTIT        IFNE      *BLANK
282000040603     C                   MOVEL     SOTTIT        IDMSG
282100040603     C                   CALLB     'XRTVM'
282200040603     C                   PARM                    IDMSG            27
282300040603     C                   PARM                    TXTMSG          100
282400040603     C                   PARM                    ERRMSG            1
282500040603     C                   PARM      *ON           CTRMSG            1
282600040603     C                   PARM      30            LENMSG            3 0
282700040603     C     ERRMSG        IFNE      *ON
282800040603     C                   MOVEL     TXTMSG        T1TIT
282900040603     C                   ELSE
283000040603     C                   MOVEL     *ALL'?'       T1TIT
283100040603     C                   ENDIF
283200040603     C                   ENDIF
283300040603      * recupero il tipo operazione
283400040603     C                   Z-ADD     1             X
283500040603     C     OPZR85        LOOKUP    $OZ(X)                                 21
283600040603     C     *IN21         IFEQ      *ON
283700040603     C                   MOVEL     $ID(X)        IDMSG
283800040603     C                   CALLB     'XRTVM'
283900040603     C                   PARM                    IDMSG            27
284000040603     C                   PARM                    TXTMSG          100
284100040603     C                   PARM                    ERRMSG            1
284200040603     C                   PARM      *ON           CTRMSG            1
284300040603     C                   PARM      30            LENMSG            3 0
284400040603     C     ERRMSG        IFNE      *ON
284500040603     C                   MOVEL     TXTMSG        T1OPE
284600040603     C                   ELSE
284700040603     C                   MOVEL     *ALL'?'       T1OPE
284800040603     C                   ENDIF
284900040603     C                   ENDIF
285000040603      *
285100040603      * Inizializzazione/Decodifica prima videata
285200040603     C                   EXSR      INZD1
285300040603     C                   MOVE      *OFF          $INZD1
285400040603      *
285500040603     C     XInzVar       ENDSR
285600040603      ************************************************************
285700040603      * REPERIMENTO DATI SOCIETA'
285800040603      ************************************************************
285900040603     C     REPSOC        BEGSR
286000040603      *
286100040603     C                   CALLB     'XSOC'
286200040603     C                   PARM                    TIPXSC            6
286300040603     C                   PARM                    SOCXSC            3
286400040603     C                   PARM                    CDSXSC            9 0
286500040603     C                   PARM                    MODXSC            3
286600040603     C                   PARM      *BLANKS       RTNXSC            1
286700040603     C                   PARM                    XSOCDS
286800040603     C                   PARM                    KPJBA
286900040603      *
287000040603     C     XRepSoc       ENDSR
287100040621D1630C************************************************************
287200040621  "  C* Sovrascrivo il membro con il nome del file
287300040621  "  C************************************************************
287400040621D1630C     OvrND770      BEGSR
287500040621     C*
287600040621     C                   Eval      Cmd         =
287700040621     C                             'OVRDBF     FILE(ND77099F) ' +
287800040621     C                             'TOFILE(*LIBL/ND77099F) '    +
287900040621     C                             'MBR(SOCIETA' + XScSoc + ')'
288000040621     C*
288100040621     C                   Call      'QCMDEXC'                            21
288200040621     C                   Parm                    Cmd             120
288300040621     C                   Parm      120           Len              15 5
288400040621     C*
288500040621     C                   if        *In21       = *On
288600040621     C                   MOVE      '1'           ERRR85
288700040621     C                   MOVE      *On           $Fine
288800040621     C                   EXSR      ENDPGM
288900040621     C                   endif
289000040621     C*
289100040621     C                   OPEN      ND77099F
289200040621     C*
289300040621D1630C                   ENDSR
289400040621D1630C/Eject
289500040603      ************************************************************
289600040603      * DEFINIZIONE TASTI FUNZIONE UTILIZZABILI A PGM
289700040603      ************************************************************
289800040603     C     DEFOPZ        BEGSR
289900040603      *
290000040603      * Questa routine deve valorizzare la schiera $FC1/$FR1
290100040603      * con S o N a seconda della utilizzabilità o meno
290200040603      * del tasto funzione correlato
290300040603      *
290400040603      * Inizialmente ripristino le abilitazioni come da schiera a tempo
290500040603      * di compilazione
290600040603     C                   RESET                   $FC1
290700040603     C                   RESET                   $FR1
290800040603      *
290900040603      * Dopodichè, a seconda del richiamo e delle autorizzazioni
291000040603      * invalido alcune opzioni
291100040603     C                   SELECT
291200040603      * Se pgm richiamato in interrogazione disattivo :
291300040608     C     OPZR85        WHENEQ    '05'
291400040603      * F2=Decodifica
291500040603     C                   Z-ADD     2             X
291600040603     C                   MOVE      '0'           $FC1(X)
291700040603      * F4=Ricerca
291800040603     C                   Z-ADD     4             X
291900040603     C                   MOVE      '0'           $FC1(X)
292000040603      * F5=Ripristino
292100040603     C                   Z-ADD     5             X
292200040603     C                   MOVE      '0'           $FC1(X)
292300040603      * F6=Conferma
292400040603     C                   Z-ADD     06            X
292500040603     C                   MOVE      '0'           $FC1(X)
292600040603      * Se pgm richiamato in annullamento disattivo :
292700040608     C     OPZR85        WHENEQ    '04'
292800040603      * F2=Decodifica
292900040603     C                   Z-ADD     2             X
293000040603     C                   MOVE      '0'           $FC1(X)
293100040603      * F4=Ricerca
293200040603     C                   Z-ADD     4             X
293300040603     C                   MOVE      '0'           $FC1(X)
293400040603      * F5=Ripristino
293500040603     C                   Z-ADD     5             X
293600040603     C                   MOVE      '0'           $FC1(X)
293700040603      *
293800040603     C                   OTHER
293900040603      *
294000040603     C                   ENDSL
294100040603      *
294200040608     C     XDefOpz       ENDSR
294300040603      ************************************************************
294400040603      * DEFINIZIONE KLIST
294500040603      ************************************************************
294600040603     C     DefKlist      BEGSR
294700040603      *
294800040603      * klist
294900040603      *
295000040603     C     XdefKList     ENDSR
295100040603      ************************************************************
295200040603      * RIEMPIMENTO TASTI FUNZIONE
295300040603      ************************************************************
295400040603     C     RIEKEY        BEGSR
295500040603      *
295600040603      * Input :
295700040603      * - $FX = schiera con tutti i testi disponibili
295800040603      * - $FC = schiere con i flag di validità associati ai testi
295900040603      * - $FR = schiere con i flag di REVERSE IMAGE
296000040603      * - $ULK = ultimo testo caricato
296100040603      * - $L01 = Lunghezza prima riga
296200040603      * - $L02 = Lunghezza seconda riga
296300040603      * Output :
296400040603      * - $ULK
296500040603      * - $KEY1= 1° riga di tasti funzione
296600040603      * - $KEY2= 2° riga di tasti funzione
296700040603      *
296800040603     C                   CALLB     'XKEYMSG'
296900040603      * input
297000040603     C                   PARM                    $FX
297100040603     C                   PARM                    $FC
297200040603     C                   PARM                    $FR
297300040603     C                   PARM                    $ULK              3 0
297400040603      * output
297500040603     C                   PARM                    $KEY1            79
297600040603     C                   PARM                    $KEY2            79
297700040603      * input
297800040603     C                   PARM                    $L01              3 0
297900040603     C                   PARM                    $L02              3 0
298000060227     C*
298100060227C1913C                   PARM                    $ALLFUNCT       480
298200040603      *
298300040603     C     XRieKey       ENDSR
298400040603      ************************************************************
298500040603** $OZ / $ID
29860004060301PROMSG    *LIBL     COS0001
29870004060302PROMSG    *LIBL     COS0002
29880004060303PROMSG    *LIBL     COS0003
29890004060304PROMSG    *LIBL     COS0004
29900004060305PROMSG    *LIBL     COS0005
299100040603** TASTI DI FUNZIONE  D1 : $FM1 / $FX1
299200040603PROMSG    *LIBL     KEY0001  01
299300040603PROMSG    *LIBL     KEY0002  02
299400040603PROMSG    *LIBL     KEY0003  03
299500040603PROMSG    *LIBL     KEY0004  04
299600040603PROMSG    *LIBL     KEY0005  05
299700040603PROMSG    *LIBL     KEY0006  06
299800040603PROMSG    *LIBL     KEY0007  07
299900040603PROMSG    *LIBL     KEY0008  08
300000040603PROMSG    *LIBL     KEY0009  09
300100040603PROMSG    *LIBL     KEY0010  10
300200040603PROMSG    *LIBL     KEY0011  11
300300040603PROMSG    *LIBL     KEY0012  12
300400040603PROMSG    *LIBL     KEY0013  13
300500040603PROMSG    *LIBL     KEY0014  14
300600040603PROMSG    *LIBL     KEY0015  15
300700040603PROMSG    *LIBL     KEY0016  16
300800040603PROMSG    *LIBL     KEY0017  17
300900040603PROMSG    *LIBL     KEY0018  18
301000040603PROMSG    *LIBL     KEY0019  19
301100040603PROMSG    *LIBL     KEY0020  20
301200040603PROMSG    *LIBL     KEY0021  21
301300040603PROMSG    *LIBL     KEY0022  22
301400040603PROMSG    *LIBL     KEY0023  23
301500040603PROMSG    *LIBL     KEY0024  24
301600040603**  ABILITAZIONE D1 : $FC1 / $FR1
3017000406030N  01
3018000406030N  02
3019000406031N  03
3020000406030N  04
3021000406031N  05
3022000406080N  06
3023000406030N  07
3024000406030N  08
3025000406030N  09
3026000406030N  10
3027000406030N  11
3028000406031N  12
3029000406030N  13
3030000406030N  14
3031000406030N  15
3032000406030N  16
3033000406030N  17
3034000406030N  18
3035000406030N  19
3036000406030N  20
3037000406030N  21
3038000406030N  22
3039000406030N  23   Impostare a '1' se si utilizzano opzioni
3040000406031N  24   Lasciare sempre impostata a '1' il valore della riga 24
304100040608** TASTI DI FUNZIONE  A/B/Z : $FM2 / $FX2
304200040608PROMSG    *LIBL     KEY0001  01
304300040608PROMSG    *LIBL     KEY0002  02
304400040608PROMSG    *LIBL     KEY0003  03
304500040608PROMSG    *LIBL     KEY0004  04
304600040608PROMSG    *LIBL     KEY0005  05
304700040608PROMSG    *LIBL     KEY0006  06
304800040608PROMSG    *LIBL     KEY0007  07
304900040608PROMSG    *LIBL     KEY0008  08
305000040608PROMSG    *LIBL     KEY0009  09
305100040608PROMSG    *LIBL     KEY0010  10
305200040608PROMSG    *LIBL     KEY0011  11
305300040608PROMSG    *LIBL     KEY0012  12
305400040608PROMSG    *LIBL     KEY0013  13
305500040608PROMSG    *LIBL     KEY0014  14
305600040608PROMSG    *LIBL     KEY0015  15
305700040608PROMSG    *LIBL     KEY0016  16
305800040608PROMSG    *LIBL     KEY0017  17
305900040608PROMSG    *LIBL     KEY0018  18
306000160608SDGMSG    *LIBL     SDK0024  19                      ** R218 **
306100040608PROMSG    *LIBL     KEY0020  20
306200040608PROMSG    *LIBL     KEY0021  21
306300040608PROMSG    *LIBL     KEY0022  22
306400040608PROMSG    *LIBL     KEY0023  23
306500040608PROMSG    *LIBL     KEY0024  24
306600040608**  ABILITAZIONE A/B/Z : $FC2 / $FR2
3067000406080N  01
3068000406080N  02
3069000406081N  03
3070000406080N  04
3071000406081N  05
3072000406081N  06
3073000406080N  07
3074000406080N  08
3075000406080N  09
3076000406080N  10
3077000406080N  11
3078000406081N  12
3079000406080N  13
3080000406080N  14
3081000406080N  15
3082000406080N  16
3083000406080N  17
3084000406080N  18
3085001606081N  19                                               ** R218 **
3086000406080N  20
3087000406080N  21
3088000406080N  22
3089000406080N  23   Impostare a '1' se si utilizzano opzioni
3090000406081N  24   Lasciare sempre impostata a '1' il valore della riga 24
