000100100407       //==============================================================
000200100407       //?TIBS28R - Cancellazione Profili di massa (filtro)           ?
000300100407       //==============================================================
000400100407
000500100407       //--------------------------------------------------------------
000600100407       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700100407       //--------------------------------------------------------------
000800100407
000900100407     /*PRM dbgview(*source)
001000100407     /*END
001100100407
001200100407       //--------------------------------------------------------------
001300100407       //?Specifiche di controllo.                                     ?
001400100407       //--------------------------------------------------------------
001500100407
001600100407     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700100407     h dftactgrp(*no)
001800100407
001900100407       //--------------------------------------------------------------
002000100407       //?Dichiarazione file.                                          ?
002100100407       //--------------------------------------------------------------
002200100407
002300100407       // -?Video Gestione?
002400100407     fTIBS28D   cf   e             workstn
002500100407     f                                     indds(IndDspF)
002600100407     f                                     infds(InfDspF)
002700100407
002800100407       //--------------------------------------------------------------
002900100407       //?Definizione costanti.                                        ?
003000100407       //--------------------------------------------------------------
003100100407
003200100407       // -?Tasti funzionali a video?
003300100407     d c_F01           c                   const(x'31')
003400100407     d c_F02           c                   const(x'32')
003500100407     d c_F03           c                   const(x'33')
003600100407     d c_F04           c                   const(x'34')
003700100407     d c_F05           c                   const(x'35')
003800100407     d c_F06           c                   const(x'36')
003900100407     d c_F07           c                   const(x'37')
004000100407     d c_F08           c                   const(x'38')
004100100407     d c_F09           c                   const(x'39')
004200100407     d c_F10           c                   const(x'3A')
004300100407     d c_F11           c                   const(x'3B')
004400100407     d c_F12           c                   const(x'3C')
004500100407     d c_F13           c                   const(x'B1')
004600100407     d c_F14           c                   const(x'B2')
004700100407     d c_F15           c                   const(x'B3')
004800100407     d c_F16           c                   const(x'B4')
004900100407     d c_F17           c                   const(x'B5')
005000100407     d c_F18           c                   const(x'B6')
005100100407     d c_F19           c                   const(x'B7')
005200100407     d c_F20           c                   const(x'B8')
005300100407     d c_F21           c                   const(x'B9')
005400100407     d c_F22           c                   const(x'BA')
005500100407     d c_F23           c                   const(x'BB')
005600100407     d c_F24           c                   const(x'BC')
005700100407     d c_Enter         c                   const(x'F1')
005800100407     d c_RollDown      c                   const(x'F4')
005900100407     d c_RollUp        c                   const(x'F5')
006000100407
006100100407       //--------------------------------------------------------------
006200100407       //?Definizione schiere.                                         ?
006300100407       //--------------------------------------------------------------
006400100407
006500100407
006600100407       //--------------------------------------------------------------
006700100407       //?Definizione aree dati.                                       ?
006800100407       //--------------------------------------------------------------
006900100407
007000100407       // -?Dati utente?
007100100407     d §AzUte        e ds                  extname(AZUTE00F)
007200100407     d                                     dtaara
007300100407     d §DatiUte      e ds                  extname(dDatiUte)
007400100407     d                                     dtaara
007500100407
007600100407       //--------------------------------------------------------------
007700100407       //?Definizione strutture dati.                                  ?
007800100407       //--------------------------------------------------------------
007900100407
008000100407       // -?Status ds?
008100100407     d Status         sds
008200100407     d  SDSpgm           *proc
008300100407
008400100407       // -?InfDS?
008500100407     d InfDspF         ds
008600100407     d   dsp_aid             369    369a
008700100407
008800100407       // -?Indicatori su DspF?
008900100407     d IndDspF         ds                  inz
009000100407         // -?Emissione messaggio di errore?
009100100407     d   ErrMessage                    n   overlay(IndDspF : 28)
009200100407         // -?Posizionamento cursore & Segnalazione errore?
009300100407     d   PosCurDSC                     n   overlay(IndDspF : 51)
009400100408     d   PosCurLST                     n   overlay(IndDspF : 52)
009500100407         //   -?Riemissione videata?
009600100407     d   ErrGenerico                   n   overlay(IndDspF : 99)
009700100407
009800100407       // -?Parametri per controllo data e transform in giorni - XSRDA8 -?
009900100407     d WLBdat          ds                  inz
010000100407     d  G08dat                        8  0 inz
010100100407     d  G08inv                        8  0 inz
010200100407     d  G08err                        1    inz('3')
010300100407     d  G08tgi                        5  0 inz
010400100407
010500100407       // -?Parametri per *pgm batch?
010600100407     d TIBS29ds        ds                  inz
010700100408     d   D29dsc                       8  0 inz
010800100408     d   D29lst                            inz  like(V1Clst)
010900100408     d   D29dlt                            inz  like(V1Cdlt)
011000100407
011100100407       // -?Parametri ricevuti?
011200100407     d KPJBA         e ds
011300100407
011400100407       // -?Parametri per Reperimento dati utente?
011500100407     d TIBS34ds      e ds                  inz
011600100407
011700100407       //--------------------------------------------------------------
011800100407       //?Definizione variabili globali.                               ?
011900100407       //--------------------------------------------------------------
012000100407
012100100407       // -?Flags booleani?
012200100407     d $Fine           s              1    inz(*off)
012300100407     d $InzD01         s              1    inz(*on)
012400100407
012500100407       // -?Altri campi?
012600100407     d W1Cdsc          s              8  0 inz
012700100407
012800100407       //--------------------------------------------------------------
012900100407       //?Definizione prototipi procedure.                             ?
013000100407       //--------------------------------------------------------------
013100100407
013200100407       // -?Reperimento dati utente?
013300100407      /copy gaitrasrc/srcProtoPR,TIBS34R
013400100407
013500100407       // -?Controllo/Inversione date?
013600100407      /copy gaitrasrc/srcProtoPR,XSRDA8
013700100407
013800100407       // -?Sottomissione lavoro batch?
013900100407      /copy gaitrasrc/srcprotopr,BCH10
014000100407
014100100407       // -?Richiamo diretto della procedura batch?
014200100407     d tibs29r         pr                  extpgm('TIBS29R')
014300100407     d   kpjba                             likeds(KPJBA)
014400100407
014500100407       //--------------------------------------------------------------
014600100407       //?Definizione key-list.                                        ?
014700100407       //--------------------------------------------------------------
014800100407
014900100407
015000100407       //--------------------------------------------------------------
015100100407       //?M A I N - L I N E                                            ?
015200100407       //--------------------------------------------------------------
015300100407
015400100407     c     *Entry        plist
015500100407     c                   parm                    KPJBA
015600100407
015700100407      /free
015800100407
015900100407       // -?Operazioni iniziali?
016000100407       exsr  sr_RoutInz;
016100100407
016200100407       // -?Gestione videate?
016300100407       DoW  $Fine = *off;
016400100407         exsr  sr_GesD01;
016500100407       EndDo;
016600100407
016700100407       // -?Operazioni finali?
016800100407       exsr sr_RoutEnd;
016900100407
017000100407       //--------------------------------------------------------------
017100100407       //?Operazioni iniziali.                                         ?
017200100407       //--------------------------------------------------------------
017300100407       BEGSR  sr_RoutInz;
017400100407
017500100407         *inLR = *on;
017600100407
017700100407         // -?Reperimento dati job?
017800100407         exsr  sr_DatiJob;
017900100407
018000100407         // -?Impostazione nome programma a video?
018100100407         V1Tpgm = SDSpgm;
018200100407
018300100407       ENDSR;
018400100407
018500100407       //--------------------------------------------------------------
018600100407       //?Reperimento Dati del job (Utente/Operativi).                 ?
018700100407       //--------------------------------------------------------------
018800100407       BEGSR  sr_DatiJob;
018900100407
019000100407         in(e) §AzUte;
019100100407         if NOT %error;
019200100407           in(e) §DatiUte;
019300100407         endif;
019400100407         if %error or RSut = *blank;
019500100407           tibs34r ( tibs34ds );
019600100407           in §AzUte;
019700100407           in §DatiUte;
019800100407         endif;
019900100407
020000100407       ENDSR;
020100100407
020200100407       //--------------------------------------------------------------
020300100407       //?Gestione videata D01.                                        ?
020400100407       //--------------------------------------------------------------
020500100407       BEGSR  sr_GesD01;
020600100407
020700100407         // -?Inizializzazione videata?
020800100407         if  $InzD01 = *on;
020900100407           exsr  sr_InzD01;
021000100407           $InzD01 = *off;
021100100407         endif;
021200100407
021300100407         // -?Emissione Testata?
021400100407         write  BS28T01;
021500100407
021600100407         // -?Emissione videata (con piede)?
021700100407         exfmt  BS28D01;
021800100407
021900100407         clear  V1Dmsg;
022000100407         reset  ErrMessage;
022100100407         reset  ErrGenerico;
022200100407
022300100407         SELECT;
022400100407
022500100407           // -?F3=Fine?
022600100407           WHEN  dsp_aid = c_F03;
022700100407             $Fine = *on;
022800100407
022900100407           // -?Invio/F6=Conferma?
023000100407           OTHER;
023100100407             exsr sr_CtrD01;
023200100407             if  ErrGenerico;
023300100407               leavesr;
023400100407             endif;
023500100407             // ·?F6=Conferma?
023600100407             if  dsp_aid = c_F06;
023700100407               exsr  sr_SbmJob;
023800100407             endif;
023900100407
024000100407         ENDSL;
024100100407
024200100407       ENDSR;
024300100407
024400100407       //--------------------------------------------------------------
024500100407       //?Inizializzazione videata D01.                                ?
024600100407       //--------------------------------------------------------------
024700100407       BEGSR  sr_InzD01;
024800100407
024900100407         clear  BS28D01;
025000100407
025100100407         // -?Data scadenza limite?
025200100407         V1Cdsc = *date;
025300100407
025400100407       ENDSR;
025500100407
025600100407       //--------------------------------------------------------------
025700100407       //?Controllo dati immessi nella videata D01.                    ?
025800100407       //--------------------------------------------------------------
025900100407       BEGSR  sr_CtrD01;
026000100407
026100100407         %subst(IndDspF : 50) = *off;
026200100407
026300100407         // -?Controllo formale data?
026400100407         clear  WLBdat;
026500100407         G08dat = V1Cdsc;
026600100407         xsrDA8 ( WLBdat );
026700100407         if  G08err = *on;
026800100407           PosCurDSC   = *on;
026900100407           ErrMessage  = *on;
027000100407           ErrGenerico = *on;
027100100407           V1Dmsg = 'Data errata';
027200100407           leavesr;
027300100407         endif;
027400100407         V1Cdsc = G08dat;
027500100407         W1Cdsc = G08inv;
027600100408
027700100408         // -?Controllo selezione da fare (lista e/o cancellazione)?
027800100408         if  V1Clst = *blank   and   V1Cdlt = *blank;
027900100408           PosCurlst   = *on;
028000100408           ErrMessage  = *on;
028100100408           ErrGenerico = *on;
028200100408           V1Dmsg = 'Selezionare lista e/o cancellazione';
028300100408           leavesr;
028400100408         endif;
028500100407
028600100407       ENDSR;
028700100407
028800100407       //--------------------------------------------------------------
028900100407       //?Gestione tasto funzionale F6 da videata D01                  ?
029000100407       //--------------------------------------------------------------
029100100407       BEGSR  sr_SbmJob;
029200100407
029300100407         // -?Impostazione parametri?
029400100407         clear  TIBS29ds;
029500100407         D29dsc  = W1Cdsc;
029600100408         D29lst  = V1Clst;
029700100408         D29dlt  = V1Cdlt;
029800100407
029900100407         // -?Sottomissione del lavoro batch?
030000100407         KCoAz = 'BS29';
030100100407         KPJbu = TIBS29ds;
030200100407         if  KNmUs = *all'1';
030300100407           tibs29r ( kpjba );
030400100407         else;
030500100407           bch10 ( kpjba );
030600100407         endif;
030700100407
030800100407         // -?Chiusura del programma?
030900100407         $Fine = *on;
031000100407
031100100407       ENDSR;
031200100407
031300100407       //--------------------------------------------------------------
031400100407       //?Operazioni finali.                                           ?
031500100407       //--------------------------------------------------------------
031600100407       BEGSR  sr_RoutEnd;
031700100407
031800100407         return;
031900100407
032000100407       ENDSR;
032100100407
032200100407      /end-free
