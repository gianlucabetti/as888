000100071212      //---------------------------------------------------------------
000200090403      //?TIBS38R - Pulizia file LOG mod. password utenti di rete
000300071212      //---------------------------------------------------------------
000400071213     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500071212
000600071212      //---------------------------------------------------------------
000700071212      //?Dichiarazione file.
000800071212      //---------------------------------------------------------------
000900071219
001000090403     ftabel00f  if   e           k disk
001100090403
001200071212      //---------------------------------------------------------------
001300071212      //?Definizione strutture dati.
001400071212      //---------------------------------------------------------------
001500090403     d ds5as1        e ds
001600071221     d kpjba         e ds
001700071218
001800071212      //---------------------------------------------------------------
001900071212      //?Definizione variabili globali.
002000071212      //---------------------------------------------------------------
002100090403     d codut           s                   like(tblkut) inz(1)
002200090403     d wdata           s              8  0
002300090403     d wdataiso        s               d
002400071212
002500071212      //---------------------------------------------------------------
002600071212      //?Definizione key-list.
002700071212      //---------------------------------------------------------------
002800071212
002900071212      //---------------------------------------------------------------
003000071212      //?Main.
003100071212      //---------------------------------------------------------------
003200071212     c     *Entry        plist
003300071221     c                   parm                    KPJBA
003400071212
003500071212      /free
003600090403
003700090403       // Reperimento tab. "5A" rcd. "SEDE1"
003800090403         clear ds5as1;
003900090403         tblkey = 'SEDE1';
004000090403         chain (codut : '5A' : tblkey) tabel00f;
004100090403         if %found(tabel00f);
004200090403           ds5as1 = tbluni;
004300090403         endif;
004400090403
004500090403       // da oggi tolgo i gg. di pulizia
004600090403         wdataiso = %date() - %days(§5as1psw);
004700090403         wdata = %dec(wdataiso);
004800071212
004900090403         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
005000090403
005100090403         exec sql
005200090403           delete from wflpr00f
005300090403            where
005400090403            lprdata <= :wdata;
005500090403
005600090403         exec sql
005700090403           delete from tibs3700f
005800090403            where
005900090403            bs37dat <= :wdataiso;
006000090403
006100090403         *inlr = *on;
