000100091228       //==============================================================
000200160301       // Pgm per aggiornamento flag operativi con data
000300091228       //==============================================================
000400091228
000500091228       //--------------------------------------------------------------
000600121106       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700091228       //--------------------------------------------------------------
000800091228
000900091228
001000091228       //--------------------------------------------------------------
001100121106       // Specifiche di controllo.
001200091228       //--------------------------------------------------------------
001300091223
001400091223     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001500100325     h dftactgrp(*no)
001600091223     h alwnull(*inputonly)
001700100325     h bnddir('UBBNDDIR')
001800091223
001900091223       //--------------------------------------------------------------
002000121106       // Dichiarazione file.
002100091223       //--------------------------------------------------------------
002200100112
002300091223
002400091223       //--------------------------------------------------------------
002500121106       // Definizione costanti.
002600091223       //--------------------------------------------------------------
002700100302
002800091223
002900091223       //--------------------------------------------------------------
003000121106       // Definizione schiere.
003100091223       //--------------------------------------------------------------
003200091223
003300091223
003400091223       //--------------------------------------------------------------
003500121106       // Definizione aree dati.
003600091223       //--------------------------------------------------------------
003700091223
003800091223
003900091223       //--------------------------------------------------------------
004000121106       // Definizione strutture dati.
004100091223       //--------------------------------------------------------------
004200110516
004300121106       // - Status
004400110516     d Psds           sds
004500110516     d   SDSpgm          *proc
004600121106     d   JobName             244    253                                         Job name
004700121106     d   JobUser             254    263                                         User name
004800121106     d   JobNumber           264    269s 0                                      Job number
004900091223
005000091223       //--------------------------------------------------------------
005100121106       // Definizione variabili.
005200091223       //--------------------------------------------------------------
005300091223
005400121106       // - Parametri ricevuti:
005500160301     d KPJBA         e ds
005600091223
005700121106       // Stringa SQL da eseguire
005800100325     d wSQL            s           2048    inz  varying
005900121106
006000121106       // Campi di comodo
006100160301     d wNrGG           s              5a   inz
006200091223
006300091223       //--------------------------------------------------------------
006400121106       // Definizione prototipi procedure.
006500091223       //--------------------------------------------------------------
006600100325
006700091223
006800091223       //--------------------------------------------------------------
006900121106       // Definizione key-list.
007000091223       //--------------------------------------------------------------
007100091223
007200091223
007300091223       //--------------------------------------------------------------
007400121107       // Definizione parametri procedura.
007500091223       //--------------------------------------------------------------
007600091223
007700091223     c     *Entry        plist
007800160301     c                   parm                    kpjba
007900091223
008000091223      /free
008100091223
008200091223       //--------------------------------------------------------------
008300121106       // M A I N - L I N E
008400091223       //--------------------------------------------------------------
008500091223
008600121106       // Operazioni iniziali?
008700091223       exsr sr_RoutInz;
008800160301
008900160301       // Eseguo
009000160301       exsr sr_Esegui;
009100091223
009200121106       // Operazioni finali?
009300091223       exsr sr_RoutEnd;
009400091223
009500091223       //--------------------------------------------------------------
009600121107       // Operazioni iniziali.
009700091223       //--------------------------------------------------------------
009800091223       BEGSR  sr_RoutInz;
009900091223
010000160301         exec sql  set option  dynusrprf = *owner,
010100160301                               closqlcsr = *endmod;
010200091223
010300091223         *inLR = *on;
010400100112
010500160301         // inizializzo i dati
010600160301
010700160301         // Reperimento nr giorni da sottrarre
010800160301         wNrGG = %subst(kpjbu:1:5);
010900091223
011000091223       ENDSR;
011100160301
011200160301       //--------------------------------------------------------------
011300160301       // Eseguo attività
011400160301       //--------------------------------------------------------------
011500160301       BEGSR  sr_Esegui;
011600160301
011700160301         // aggiorno TIVIRE0F
011800160301         wSQL =
011900160301          'update TIVIRE0F +
012000160301           set VIREFLO = +
012100160301           substr(char(date(DAYS(CURDAte())-' +
012200160301            wNrGG + ') , ISO) , 1 , 4) concat +
012300160301           substr(char(date(DAYS(CURDAte())-' +
012400160301            wNrGG + ') , ISO) , 6 , 2) concat +
012500160301           substr(char(date(DAYS(CURDAte())-' +
012600160301            wNrGG + ') , ISO) , 9 , 2) +
012700160301           where +
012800160301           VIREKSC = ''*DATLOAD'' and +
012900160301           VIRETIP = ''**'' and +
013000160301           VIREDTI = 0 and +
013100160301           VIRETRC = ''VA''';
013200160301
013300160301         exec sql   execute immediate  :wSQL;
013400160301
013500160301         // testo il risultato
013600160301         if sqlcod <> 0;
013700160301           // non c'è bisogno di rollback perché non siamo sotto transazione
013800160301           exsr sr_RoutEnd;
013900160301         endif;
014000160301
014100160301       ENDSR;
014200121106
014300091223       //--------------------------------------------------------------
014400121107       // Operazioni finali.
014500091223       //--------------------------------------------------------------
014600091223       BEGSR  sr_RoutEnd;
014700091223
014800121107         // Chiusura pgm
014900091223         return;
015000091223
015100091223       ENDSR;
015200091223
015300091223      /end-free
