000100051109     ***********************************************************************************************
000200051109     **?
000300051109     **?Controlla se è possibile immettere disposizioni per una giacenza.
000400051109     **?Riceve il codice cliente unificante e l'id giacenza e restituisce l'esito del controllo:
000500051109     **?
000600051109     **? ESITO < 0  Elaborazione non riuscita.
000700051109     **? ESITO = 0  E' possibile immettere disposizioni.
000800051109     **? ESITO > 0  Non è possibile immettere disposizioni.
000900051109     **?
001000051109     ***********************************************************************************************
001100050921     H DFTACTGRP(*NO) ACTGRP(*CALLER)
001200050902
001300050902     ***********************************************************************************************
001400050902     **?
001500050902     **?Definizione strutture dati.
001600050902     **?
001700050902     ***********************************************************************************************
001800051109     D cnDizion      E DS
001900051108     D                                     BASED(nullPtr)
002000051109     D                                     PREFIX(diz)
002100051109     D anDiz00f      E DS
002200051109     D                                     BASED(nullPtr)
002300051109     D                                     PREFIX(pjz)
002400050902
002500050902     ***********************************************************************************************
002600050902     **?
002700050902     **?Definizione variabili.
002800050902     **?
002900050902     ***********************************************************************************************
003000051108     D ksu             S
003100051109     D                                     LIKE(pjzKsc)
003200051108     D agc             S
003300051109     D                                     LIKE(diz$aa4)
003400051108     D fgc             S
003500051109     D                                     LIKE(diz$fil)
003600051108     D ngc             S
003700051109     D                                     LIKE(diz$ngc)
003800051108     D esito           S             10I 0
003900051108     D count           S             10I 0
004000051109     D fas             S
004100051109     D                                     LIKE(diz$fas)
004200051108     D nullPtr         S               *
004300050831
004400050902     ***********************************************************************************************
004500050902     **?
004600050902     **?Definizione parametri.
004700050902     **?
004800050902     ***********************************************************************************************
004900050902     C     *ENTRY        PLIST
005000051109     C                   PARM                    ksu
005100051109     C                   PARM                    agc
005200051109     C                   PARM                    fgc
005300051109     C                   PARM                    ngc
005400050902     C                   PARM                    esito
005500050902
005600050902     ***********************************************************************************************
005700050902     **?
005800050902     **?Main.
005900050902     **?
006000050902     ***********************************************************************************************
006100050902     C                   EXSR      chkParm
006200051109     C                   EXSR      chkFase20
006300051109     C                   EXSR      chkTivpi
006400050902     C                   EXSR      uscita
006500050902
006600050902     ***********************************************************************************************
006700050902     **?
006800050902     **?Operazioni iniziali.
006900050902     **?
007000050902     ***********************************************************************************************
007100050902     C     *INZSR        BEGSR
007200050902
007300050902
007400050902     C                   ENDSR
007500050902
007600050902     ***********************************************************************************************
007700050902     **?
007800050902     **?Controllo parametri ricevuti.
007900050902     **?
008000050902     ***********************************************************************************************
008100050902     C     chkParm       BEGSR
008200051108
008300051108     **?Pulisco i parametri di output.
008400051108     C                   CLEAR                   esito
008500050902
008600051108     **?Parametri obbligatori.
008700051109     C                   IF        agc = 0 OR fgc = 0 OR ngc = 0
008800051108     C                   EVAL      esito = -1
008900051108     C                   EXSR      uscita
009000051108     C                   ENDIF
009100050902
009200050902     C                   ENDSR
009300051109
009400051109     ***********************************************************************************************
009500051109     **?
009600051109     **?Controllo fase 20 giacenza.
009700051109     **?
009800051109     ***********************************************************************************************
009900051109     C     chkFase20     BEGSR
010000051109
010100051109     C/EXEC SQL
010200051109     C+ SELECT GCPFAS INTO :fas FROM TIGCP00F WHERE GCPAGC = :agc AND
010300051109     C+ GCPFGC = :fgc AND GCPNGC = :ngc AND GCPFRG = 0 AND GCPATB = ' '
010400051110     C+ AND GCPFAS <> 20
010500051109     C/END-EXEC
010600051109
010700051109     C                   SELECT
010800051109     C                   WHEN      sqlCod = 100
010900051109     C                   WHEN      sqlCod < 0
011000051109     C                   EVAL      esito = sqlCod
011100051110     C                   OTHER
011200051110     C                   EVAL      esito = fas
011300051109     C                   ENDSL
011400051109
011500051109     C                   IF        esito <> 0
011600051109     C                   EXSR      uscita
011700051109     C                   ENDIF
011800051109
011900051109     C                   ENDSR
012000051109
012100051109     ***********************************************************************************************
012200051109     **?
012300051109     **?Controllo disposizioni giacenza esistenti in TIVPI00F.
012400051109     **?
012500051109     ***********************************************************************************************
012600051109     C     chkTivpi      BEGSR
012700051109
012701170317     C                   RESET                   count
012800051109     C/EXEC SQL
012900051109     C+ SELECT COUNT(*) INTO :count FROM TIVPI00F WHERE VPITIP = 'TR' AND
013000051109     C+ VPIKSU = :ksu AND SUBSTR(VPIDTA, 22, 4) = DIGITS(:agc) AND
013100051109     C+ SUBSTR(VPIDTA, 27, 3) = DIGITS(:fgc) AND SUBSTR(VPIDTA, 31, 7) =
013200051109     C+ DIGITS(:ngc)
013300051109     C/END-EXEC
013500051109     C                   IF        sqlCod < 0
013600051109     C                   EVAL      esito = sqlCod
013601170317     C                   DUMP(A)
013602170317     C                   EXSR      uscita
013900051109     C                   ENDIF
013901170317
013902170317     C                   IF        count = 0
013903170317     C/EXEC SQL
013904170317     C+ SELECT COUNT(*) INTO :count FROM TIVPI00F WHERE VPITIP = 'TR'
013905170317     C+ AND SUBSTR(VPIDTA, 22, 4) = DIGITS(:agc) AND
013906170317     C+ SUBSTR(VPIDTA, 27, 3) = DIGITS(:fgc) AND SUBSTR(VPIDTA, 31, 7) =
013907170317     C+ DIGITS(:ngc)
013908170317     C/END-EXEC
013909170317     C                   IF        sqlCod < 0
013910170317     C                   EVAL      esito = sqlCod
013911170317     C                   DUMP(A)
013912170317     C                   EXSR      uscita
013913170317     C                   ENDIF
013914170317     C                   ENDIF
013915170317
013916170317     C                   EVAL      esito = count
013917170317
014100051109     C                   IF        esito <> 0
014200051109     C                   EXSR      uscita
014300051109     C                   ENDIF
014400051109
014500051109     C                   ENDSR
014600050902
014700050902     ***********************************************************************************************
014800050902     **?
014900050902     **?Operazioni finali.
015000050902     **?
015100050902     ***********************************************************************************************
015200050902     C     uscita        BEGSR
015300050902
015400050902     C                   RETURN
015500050902
015600050902     C                   ENDSR
