000100090914      *PARMS dftactgrp(*no) actgrp('QILE') bnddir('UBBNDDIR')
000200090914       //--------------------------------------------------------------
000300090914       //?TEST - VERIFICA COMPETENZA GESTIONE GIACENZE                 ?
000400090914       //--------------------------------------------------------------
000500090914
000600090914     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700090914     h dftactgrp(*no) actgrp('QILE') bnddir('UBBNDDIR')
000800090914
000900090914       //--------------------------------------------------------------
001000090914       //?Dichiarazione file.                                          ?
001100090914       //--------------------------------------------------------------
001200090914
001300090914       // - Video
001400090914     fTIS7702TD cf   e             workstn
001500090914     f                                     indds(IndDspF)
001600090914     f                                     infds(InfDspF)
001700090914
001800090914       //--------------------------------------------------------------
001900090914       //?Definizione costanti.                                        ?
002000090914       //--------------------------------------------------------------
002100090914
002200090914       // - Tasti funzionali a video
002300090914     d c_F01           c                   const(x'31')
002400090914     d c_F02           c                   const(x'32')
002500090914     d c_F03           c                   const(x'33')
002600090914     d c_F04           c                   const(x'34')
002700090914     d c_F05           c                   const(x'35')
002800090914     d c_F06           c                   const(x'36')
002900090914     d c_F07           c                   const(x'37')
003000090914     d c_F08           c                   const(x'38')
003100090914     d c_F09           c                   const(x'39')
003200090914     d c_F10           c                   const(x'3A')
003300090914     d c_F11           c                   const(x'3B')
003400090914     d c_F12           c                   const(x'3C')
003500090914     d c_F13           c                   const(x'B1')
003600090914     d c_F14           c                   const(x'B2')
003700090914     d c_F15           c                   const(x'B3')
003800090914     d c_F16           c                   const(x'B4')
003900090914     d c_F17           c                   const(x'B5')
004000090914     d c_F18           c                   const(x'B6')
004100090914     d c_F19           c                   const(x'B7')
004200090914     d c_F20           c                   const(x'B8')
004300090914     d c_F21           c                   const(x'B9')
004400090914     d c_F22           c                   const(x'BA')
004500090914     d c_F23           c                   const(x'BB')
004600090914     d c_F24           c                   const(x'BC')
004700090914     d c_Enter         c                   const(x'F1')
004800090914     d c_RollDown      c                   const(x'F4')
004900090914     d c_RollUp        c                   const(x'F5')
005000090914
005100090914       //--------------------------------------------------------------
005200090914       //?Definizione schiere.                                         ?
005300090914       //--------------------------------------------------------------
005400090914
005500090914
005600090914       //--------------------------------------------------------------
005700090914       //?Definizione aree dati.                                       ?
005800090914       //--------------------------------------------------------------
005900090914
006000090914       // - Dati utente
006100090914     d §AzUte        e ds                  extname(AZUTE00F)
006200090914     d                                     dtaara
006300090914     d §DatiUte      e ds                  extname(dDatiUte)
006400090914     d                                     dtaara
006500090914
006600090914       //--------------------------------------------------------------
006700090914       //?Definizione strutture dati.                                  ?
006800090914       //--------------------------------------------------------------
006900090914
007000090914       // - Status ds
007100090914     d Status         sds
007200090914     d  SDSpgm           *proc
007300090914     d  SDSprm           *parms
007400090914     d  SDSusr               254    263
007500090914
007600090914       // - InfDS
007700090914     d InfDspF         ds
007800090914     d  dsp_aid              369    369a
007900090914
008000090914       // - Indicatori su DspF
008100090914     d IndDspF         ds
008200090914        // - Abilitazione tasti funzionali
008300090914     d  AbilitF06                     1n   overlay(IndDspF : 06)
008400090914     d  AbilitF12                     1n   overlay(IndDspF : 12)
008500090914        // - Indicatori di errore
008600090914     d  ErrMessage                    1n   overlay(IndDspF : 28)
008700090914     d  ErrGenerico                   1n   overlay(IndDspF : 99)
008800090914
008900090914       // - Parametri x Controllo profilo utenti
009000090914     d TIBS34ds      e ds
009100090914
009200090914       // - Parametri ricevuti
009300090914     d kpjba         e ds
009400090914
009500090914     d CnDizion      e ds                  qualified
009600090914     d                                     based(NullPtr)
009700090914
009800090914       //--------------------------------------------------------------
009900090914       //?Definizione variabili globali.                               ?
010000090914       //--------------------------------------------------------------
010100090914
010200090914       // - Flags booleani
010300090914     d $Fine           s               n   inz(*off)
010400090914     d $InzD01         s               n   inz(*on)
010500090914     d $InzD02         s               n   inz(*on)
010600090914
010700090914       // - Campi per la gestione del video
010800090914     d $Video          s              2a   inz('D1')
010900090914
011000090914       // - Campi di comodo
011100090914     d wEsito          s             10i 0 inz
011200090914
011300090914       //--------------------------------------------------------------
011400090914       //?Definizione prototipi procedure usate.                       ?
011500090914       //--------------------------------------------------------------
011600090914
011700090914       // - Reperimento dati utente
011800090914      /copy gaitrasrc/srcProtoPr,TIBS34R
011900090914
012000090914       // - Reperimento trk "GEN" da FIAR531C
012100090914      /copy gaitrasrc/srcProtoPr,TIS7702R
012200090914
012300090914       //--------------------------------------------------------------
012400090914       //?Definizione key-list.                                        ?
012500090914       //--------------------------------------------------------------
012600090914
012700090914
012800090914       //--------------------------------------------------------------
012900090914       //?Riepilogo indicatori.                                        ?
013000090914       //--------------------------------------------------------------
013100090914
013200090914
013300090914       //--------------------------------------------------------------
013400090914       //?M A I N - L I N E                                            ?
013500090914       //--------------------------------------------------------------
013600090914
013700090914     c     *entry        plist
013800090914     c                   parm                    KPJBA
013900090914
014000090914      /free
014100090914
014200090914       // - Start
014300090914       *inLR = *on;
014400090914
014500090914       // - Elab
014600090914       dow  $Fine = *off;
014700090914         select;
014800090914           when  $Video = 'D1';
014900090914             exsr sr_GesD01;
015000090914           when  $Video = 'D2';
015100090914             exsr sr_GesD02;
015200090914           other;
015300090914             $Fine = *on;
015400090914         endsl;
015500090914       enddo;
015600090914
015700090914       // - End
015800090914       return;
015900090914
016000090914       //--------------------------------------------------------------
016100090914       //?Operazioni iniziali                                          ?
016200090914       //--------------------------------------------------------------
016300090914       BEGSR  *InzSR;
016400090914
016500090914         // - Reperimento dati utente
016600090914         exsr sr_DatiJob;
016700090914
016800090914         // - Impostazione nome programma in testata a video
016900090914         V1Tpgm = SDSpgm;
017000090914
017100090914       ENDSR;
017200090914
017300090914       //--------------------------------------------------------------
017400090914       //?Reperimento Dati del job (Utente/Operativi).                 ?
017500090914       //--------------------------------------------------------------
017600090914       BEGSR  sr_DatiJob;
017700090914
017800090914         in(E) §AzUte;
017900090914         if NOT %error;
018000090914           in(E) §DatiUte;
018100090914         endif;
018200090914         if %error or RSut = *blanks;
018300090914           clear TIBS34ds;
018400090914           tibs34r(tibs34ds);
018500090914           in §AzUte;
018600090914           in §DatiUte;
018700090914         endif;
018800090914
018900090914       ENDSR;
019000090914
019100090914       //--------------------------------------------------------------
019200090914       //?Gestione videata D01                                         ?
019300090914       //--------------------------------------------------------------
019400090914       BEGSR  sr_GesD01;
019500090914
019600090914         // - Inizializzazione videata
019700090914         if  $InzD01 = *on;
019800090914           clear TIS7702d1;
019900090915           V1DOpCode = 'GETFLGGIAC';
020000090914           $InzD01 = *off;
020100090914         endif;
020200090915         AbilitF06 = *on;
020300090915         AbilitF12 = *off;
020400090914
020500090914         // - Emissione videata
020600090914         if  ErrMessage = *off;
020700090914           write TIS7702t1;
020800090914           write TIS7702z1;
020900090914         endif;
021000090914
021100090914         exfmt TIS7702d1;
021200090914
021300090914         reset ErrMessage;
021400090914         reset ErrGenerico;
021500090914         clear V1Dmsg;
021600090914
021700090914         SELECT;
021800090914
021900090914           // - F3=Fine
022000090914           WHEN  dsp_aid = c_F03;
022100090914             $Fine = *on;
022200090914
022300090914           // - Invio o F6=Conferma
022400090914           OTHER;
022500090914             exsr sr_CtrD01;
022600090914             select;
022700090914               // - rilevato errore
022800090914               when  ErrGenerico = *on;
022900090914               // - non premuto F6
023000090914               when  dsp_aid <> c_F06;
023100090914               // - premuto F6
023200090914               other;
023300090914                 $Video = 'D2';
023400090914                 reset  $InzD02;
023500090914             endsl;
023600090914
023700090914         ENDSL;
023800090914
023900090914       ENDSR;
024000090914
024100090914       //--------------------------------------------------------------
024200090914       //?Controllo dati in videata D01                                ?
024300090914       //--------------------------------------------------------------
024400090914       BEGSR sr_CtrD01;
024500090914
024600090914         %subst(IndDspF : 28) = *off;
024700090914
024800090914       ENDSR;
024900090914
025000090914       //--------------------------------------------------------------
025100090914       //?Gestione videata D02                                         ?
025200090914       //--------------------------------------------------------------
025300090914       BEGSR  sr_GesD02;
025400090914
025500090914         // - Inizializzazione videata
025600090914         if  $InzD02 = *on;
025700090914           clear  TIS7702d2;
025800090914           exsr  Call_Tis7702;
025900090914           $InzD02  = *off;
026000090914           AbilitF06  = *off;
026100090914           AbilitF12  = *on;
026200090914         endif;
026300090914
026400090914         // - Emissione videata
026500090914         if  ErrMessage = *off;
026600090914           write TIS7702t1;
026700090914           write TIS7702z1;
026800090914           write TIS7702d1;
026900090914           write Protect;
027000090914         endif;
027100090914
027200090914         exfmt TIS7702d2;
027300090914
027400090914         reset ErrMessage;
027500090914         reset ErrGenerico;
027600090914         clear V1Dmsg;
027700090914
027800090914         SELECT;
027900090914
028000090914           // - F3=Fine
028100090914           WHEN  dsp_aid = c_F03;
028200090914             $Fine = *on;
028300090914
028400090914           // - F12=Ritorno
028500090914           WHEN  dsp_aid = c_F12;
028600090914             $Video = 'D1';
028700090914             //reset $InzD01;
028800090914             reset $InzD02;
028900090914
029000090914           // - Invio
029100090914           OTHER;
029200090914
029300090914         ENDSL;
029400090914
029500090914       ENDSR;
029600090914
029700090914       //--------------------------------------------------------------
029800090914       //?Richiamo programma TIS7702                                   ?
029900090914       //--------------------------------------------------------------
030000090914       BEGSR Call_Tis7702;
030100090914
030200090914         clear wEsito;
030300090914
030400090914         Verifica_gestione_giacenza
030500090914             (V1dOpCode :
030600090914              V1dAas : V1dLnp : V1dNrs : V1dNsp :
030700090914              V1dTbl : V1dKsu : V1dSun : V1dFKscCcm :
030800090914              VidFlgGiac : wEsito );
030900090914
031000090914         VidEsito = wEsito;
031100090914
031200090914       ENDSR;
031300090914
031400090914      /end-free
