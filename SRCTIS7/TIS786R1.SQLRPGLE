000100170807     H DECEDIT('0,') DATEDIT(*DMY.)
000200170807     H DFTACTGRP(*NO) ACTGRP(*CALLER)
000300091223
000400091223       //--------------------------------------------------------------
000500121106       // Dichiarazione file.
000600091223       //--------------------------------------------------------------
000700170508
000800170508
000900170508       //--------------------------------------------------------------
001000170508       // Definizione prototipi
001100170508       //--------------------------------------------------------------
001200170803
001300160802
001400091223       //--------------------------------------------------------------
001500121106       // Definizione variabili.
001600091223       //--------------------------------------------------------------
001700121106
001800170803
001900170803     D wSQL            s           1024a   inz varying
002000170807     D wTotRCD         s              9s 0 inz
002100170807     D wMBR            s             10a   inz
002200170727
002300170801     D wApi            c                   const('''')
002400170801
002500091223
002600130307      /free
002700091223
002800091223       //--------------------------------------------------------------
002900121106       // M A I N - L I N E
003000091223       //--------------------------------------------------------------
003100170803
003200170803       exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
003300170807       exsr exeElimina;
003400170807       *inlr = *on;
003500170803
003600170803
003700170801
003800170807       BEGSR  exeElimina;
003900170818
004000170801         wSQL =
004100170807            ' SELECT MLNAME ' +
004200170816            ' FROM tivinmbr WHERE ' +
004300170807            ' MLFILE='+wApi+'TIVIN00R'+wApi+' and ' +
004400170818            ' MLNRCD = 0 and ' +
004500170818            ' date('+wApi+'20'+wApi +
004600170818            ' concat substr(MLCHGD, 1, 2) concat '+wApi+'-'+wApi +
004700170818            ' concat substr(MLCHGD, 3, 2) concat '+wApi+'-'+wApi +
004800170818            ' concat substr(MLCHGD, 5, 2)) < curdate() ' ;
004900170801
005000170801         // Dichiarazione cursore
005100170801         exec sql   prepare S0   from :wSQL;
005200170801         exec sql   declare C0   cursor   for S0;
005300170801
005400170801         // Apro il cursore
005500170801         exec sql open C0;
005600170801
005700170801         // Leggo i dati
005800170801         dow sqlcode = *zeros;
005900170818            clear wMBR;
006000170801            exec sql
006100170807                 fetch next from C0 into :wMBR ;
006200170818     C                   IF        wMBR <> *blanks
006300170816     C                   CALL      'TIS786C2'
006400170807     C                   PARM                    wMBR
006500170818     C                   ENDIF
006600170801         enddo;
006700170801
006800170801         // Chiusura cursore
006900170801         exec sql close C0;
007000170801
007100170801       ENDSR;
007200160802
007300091223      /end-free
