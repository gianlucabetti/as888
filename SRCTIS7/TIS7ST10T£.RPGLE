000100120223     ***************************************************************************
000200120223     **
000300120307     ** Tester di TIS7ST10R.
000400120223     **
000500120223     ***************************************************************************
000600120224     H DFTACTGRP(*NO) ACTGRP(*NEW)
000700120307     Ftis7st10d CF   E             WORKSTN
000800120223
000900120223     ***************************************************************************
001000120223     **
001100120223     ** Costanti.
001200120223     **
001300120223     ***************************************************************************
001400120223     D ESITO_ERROR...
001500120223     D                 C                   -1
001600120223     D ESITO_OK...
001700120223     D                 C                   0
001800120223     D RPYOPCODE_DONE...
001900120223     D                 C                   'DONE'
002000120223     D RPYOPCODE_ERROR...
002100120223     D                 C                   'ERROR'
002200120307     D RQSOPCODE_GETTAMCALC...
002300120307     D                 C                   'GETTAMCALC'
002400120223
002500120223     ***************************************************************************
002600120223     **
002700120223     ** Strutture dati.
002800120223     **
002900120223     ***************************************************************************
003000120307     D tis7st10i     E DS                  INZ(*EXTDFT) QUALIFIED
003100120314     D tis7st10o     E DS                  prefix(o10_)
003200120223
003300120223     ***************************************************************************
003400120223     **
003500120223     ** Campi.
003600120223     **
003700120223     ***************************************************************************
003800120223     D rqsOpCode       S             10A
003900120223     D rqsData         S           9999A
004000120223     D rqsDataLen      S              4P 0
004100120223     D rpyOpCode       S             10A
004200120223     D rpyData         S           9999A
004300120223     D rpyDataLen      S              4P 0
004400120223
004500120223     ***************************************************************************
004600120223     **
004700120223     ** Prototipi.
004800120223     **
004900120223     ***************************************************************************
005000120307     D Tis7st10r       PR                  EXTPGM('TIS7ST10R')
005100120224     D  rqsOpCode                    10A
005200120224     D  rqsData                    9999A
005300120224     D  rqsDataLen                    4P 0
005400120224     D  rpyOpCode                    10A
005500120224     D  rpyData                    9999A
005600120224     D  rpyDataLen                    4P 0
005700120223
005800120223     ***************************************************************************
005900120223     **
006000120223     ** Main.
006100120223     **
006200120223     ***************************************************************************
006300120223
006400120223      /FREE
006500120224
006600120224       *INLR = *ON;
006700120224
006800120323       cliente=0010083  ;
006900120312       tipocli='M' ;
007000120314       idtsp  ='C' ;
007100120315       spediz= '15032012' ;
007200120323       sun=31201  ;
007300120323       ksu='00010083'  ;
007400120312
007500120306 1     dow  not *inkc   ;
007600120306
007700120307       exfmt  s7st10d  ;
007800120306
007900120306 2     if not *inkc   ;
008000120305
008100120307       rqsOpCode = RQSOPCODE_GETTAMCALC     ;
008200120224
008300120307       RESET tis7st10i;
008400120306
008500120306
008600120307       tis7st10i.ksu = '0'+%editc(cliente:'X')  ;
008700120307       tis7st10i.idcliente = cliente;
008800120315       tis7st10i.ksu       = ksu    ;
008900120315       tis7st10i.sun       = sun    ;
009000120307       tis7st10i.dtspediz  = %subst(spediz:1:2)+'.' +
009100120306                             %subst(spediz:3:2)+'.' +
009200120306                             %subst(spediz:5:4) ;
009300120307       tis7st10i.idcodtar  = codtar ;
009400120307       tis7st10i.tipocli   = tipocli;
009500120307       tis7st10i.formato   = 'TIS7ST10I'  ;
009600120307       tis7st10i.LINISo2   = lingua      ;
009700120312       tis7st10i.idnetwork = ntw    ;
009800120312       tis7st10i.idlnp     = idlnp  ;
009900120312       tis7st10i.idnzm     = idnzm  ;
010000120312       tis7st10i.idcam     = idcam  ;
010100120312       tis7st10i.idlom     = idlom  ;
010200120312       tis7st10i.idnzd     = idnzd  ;
010300120312       tis7st10i.idcad     = idcad  ;
010400120312       tis7st10i.idlod     = idlod  ;
010500120312       tis7st10i.idtsp     = idtsp  ;
010600120312       tis7st10i.idffd     = idffd  ;
010700120312       tis7st10i.idddt     = idddt  ;
010800120312       tis7st10i.idricmag  = idricmag ;
010900120312       tis7st10i.idncl    = idncl    ;
011000120312       tis7st10i.idpkf    = idpkf    ;
011100120312       tis7st10i.idvlf    = idvlf    ;
011200120312       tis7st10i.idcas    = idcas    ;
011300120312       tis7st10i.idias    = idias    ;
011400120312       tis7st10i.idqta    = idqta    ;
011500120306
011600120306
011700120307         rqsData = tis7st10i;
011800120307         rqsDataLen = %SIZE(tis7st10i);
011900120224
012000120306 3       if   *inkf    ;
012100120307         Tis7st10r( rqsOpCode : rqsData : rqsDataLen
012200120224                  : rpyOpCode : rpyData : rpyDataLen
012300120224                  );
012400120224
012500120315         clear output  ;
012600120315         select   ;
012700120315 4       when rpyOpCode = 'LOGIN'        ;
012800120315 4       when rpyOpCode = RPYOPCODE_ERROR;
012900120306           output=rpydata   ;
013000120315 4       other;
013100120314         tis7st10o = rpyData;
013200120314         output='totale IMPONIBILE '+ %editc(o10_idtotimp:'2')+
013300120314                '  porto: ' +o10_descrporto +
013400120314         ' lnp: '+%editc(o10_idlnp:'X')+'-'+o10_descrlnp +
013500120314         ' nazMitt: '+o10_descrnzm +
013600120314         ' nazDEst: '+o10_descrnzd +
013700120314         ' Servizio '+o10_descrtsp   ;
013800120224
013900120315 4     endsl  ;
014000120306
014100120306       *in01=*on    ;
014200120307       exfmt  s7st10d  ;
014300120306
014400120306        clear output   ;
014500120306        clear rpyOpCode  ;
014600120306       *in01=*off ;
014700120306
014800120306 3         endif  ;
014900120306 2         endif  ;
015000120306
015100120306 1        enddo  ;
015200120224
015300120224      /END-FREE
