000100111128       //==============================================================
000200170207       // TIS7VMS8R - Finestra di forzatura
000300120405       //==============================================================
000400111128
000500111128       //--------------------------------------------------------------
000600120207       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700111128       //--------------------------------------------------------------
000800111128
000900111128     /*PRM  dbgview(*source)
001000111128     /*END
001100111128
001200111128       //--------------------------------------------------------------
001300120207       // Specifiche di controllo.                                     ?
001400111128       //--------------------------------------------------------------
001500111128
001600111128     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700120510     h dftactgrp(*no) bnddir('UBBNDDIR')
001800111128     h alwnull(*inputonly)
001900111128
002000111128       //--------------------------------------------------------------
002100120207       // Dichiarazione file.                                          ?
002200111128       //--------------------------------------------------------------
002300120215       // - Video
002400170207     fTIS7VMS8D cf   e             workstn
002500170208     f                                     indds(IndDspF)
002600120207     f                                     infds(InfDspF)
002700111128
002800111128
002900111128       //--------------------------------------------------------------
003000120207       // Definizione costanti.                                        ?
003100111128       //--------------------------------------------------------------
003200120207
003300120207       // - Tasti funzionali a video
003400120207     d c_F01           c                   const(x'31')
003500120207     d c_F02           c                   const(x'32')
003600120207     d c_F03           c                   const(x'33')
003700120207     d c_F05           c                   const(x'35')
003800120207     d c_F06           c                   const(x'36')
003900120207     d c_F07           c                   const(x'37')
004000120207     d c_F08           c                   const(x'38')
004100120207     d c_F09           c                   const(x'39')
004200120207     d c_F10           c                   const(x'3A')
004300120207     d c_F12           c                   const(x'3C')
004400120207     d c_F13           c                   const(x'B1')
004500120207     d c_F14           c                   const(x'B2')
004600120207     d c_F15           c                   const(x'B3')
004700120207     d c_F16           c                   const(x'B4')
004800120207     d c_F17           c                   const(x'B5')
004900120207     d c_F18           c                   const(x'B6')
005000120207     d c_F19           c                   const(x'B7')
005100120207     d c_F20           c                   const(x'B8')
005200120207     d c_F21           c                   const(x'B9')
005300120207     d c_F22           c                   const(x'BA')
005400120207     d c_F23           c                   const(x'BB')
005500120207     d c_F24           c                   const(x'BC')
005600120207     d c_Enter         c                   const(x'F1')
005700120207     d c_RollDown      c                   const(x'F4')
005800120207     d c_RollUp        c                   const(x'F5')
005900111128
006000111128
006100111128       //--------------------------------------------------------------
006200120207       // Definizione schiere.                                         ?
006300111128       //--------------------------------------------------------------
006400111128
006500111128
006600111128       //--------------------------------------------------------------
006700120207       // Definizione aree dati.                                       ?
006800111128       //--------------------------------------------------------------
006900111128
007000111128
007100111128       //--------------------------------------------------------------
007200120207       // Definizione strutture dati.                                  ?
007300111128       //--------------------------------------------------------------
007400120510
007500120510
007600111128       //--------------------------------------------------------------
007700120207       // Definizione variabili globali.                               ?
007800111128       //--------------------------------------------------------------
007900111128
008000120208       // - Stringa SQL da eseguire
008100111128     d wSQl            s           1024    inz  varying
008200111128
008300120208       // - Parametri SQL
008400120207
008500120207       // - InfDS
008600120207     d InfDspF         ds
008700120207     d   dsp_aid             369    369a                                        AID byte
008800120207
008900120207       // - Indicatori su DspF
009000170208     d IndDspF         ds                  inz
009100120207        // - Indicatori di errore
009200170208     d  ErrProc                        n   overlay(IndDspF : 50)
009300170208     d  ErrGenerico                    n   overlay(IndDspF : 99)
009400120404
009500120404     d KPJBA         e ds
009600120207
009700120207       // - Flags booleani
009800120207     d $Fine           s               n   inz(*off)
009900120510     d $InzW01         s               n   inz(*on)
010000120208     d ErrBlock        s               n   inz(*off)
010100120210     d Qcmd            s            500    inz
010200120207
010300120207       // - Campi associati al video
010400120510     d $Video          s              2    inz('W1')
010500120207
010600120207       // - Variabili di appoggio
010700120510     d wData08         s              8s 0
010800120405     d wX              s              5s 0
010900111128
011000111128       //--------------------------------------------------------------
011100120210       // Definizione procedure usate
011200111128       //--------------------------------------------------------------
011300120207
011400120210       // - Parametri API QCAPCMD (Process Commands)
011500120207      /copy qSysInc/qRpgleSrc,QCAPCMD
011600120207      /copy gaitrasrc/srcProtoPR,QCAPCMD
011700120207
011800120210       // - Parametri gestione errori API
011900120207      /copy qSysInc/qRpgleSrc,QUSEC
012000120404
012100170207     d TIS7VMS8R       pr
012200120404     d  Arch                        502
012300120620     d  Exfmt                         1
012400170207     d  Proc1                        10
012500170207     d  Proc2                        10
012600170207     d  ExecSQL                        n
012700120404
012800170207     d TIS7VMS8R       pi
012900120404     d  Arch                        502
013000120620     d  Exfmt                         1
013100170207     d  Proc1                        10
013200170207     d  Proc2                        10
013300170207     d  ExecSQL                        n
013400111128
013500111128       //--------------------------------------------------------------
013600120208       // Definizione key-list.                                        ?
013700111128       //--------------------------------------------------------------
013800111128
013900111128
014000111128       //--------------------------------------------------------------
014100120208       // M A I N - L I N E                                            ?
014200111128       //--------------------------------------------------------------
014300111128
014400111128      /free
014500111128
014600120208       // - Operazioni iniziali
014700111128       exsr  sr_RoutInz;
014800111128
014900120207       // - Gestione video
015000120207       DOW  $Fine = *off;
015100120207         select;
015200120510           when  $Video = 'W1';
015300120510             exsr  sr_GesW01;
015400120207           other;
015500120207             $Fine = *on;
015600120207         endsl;
015700120207       ENDDO;
015800120207
015900120208       // - Operazioni finali
016000111128       exsr  sr_RoutEnd;
016100111128
016200111128       //--------------------------------------------------------------
016300120208       // Operazioni iniziali
016400111128       //--------------------------------------------------------------
016500111128       BEGSR sr_RoutInz;
016600111128
016700120620         // Nel caso che, tra la passata chiamata a questo pgm e questa,
016800120620         // ci sia stata una emissione a video del pgm chiamante
016900120620         // chiudo e riapro il DSPF contenente la finestra
017000120620         // per evitare il permanere del primo sfondo sotto la finestra.
017100120620         if exfmt = *on;
017200170207           close TIS7VMS8D;
017300170207           open  TIS7VMS8D;
017400120620         endif;
017500120620
017600120620         *inRT = *on;
017700120620         $Fine = *off;
017800120620         $InzW01 = *on;
017900170208         IndDspF  = *off;
018000120404         KPJBA = Arch;
018100111128
018200120208         // - Impostazione opzioni per SQL
018300111128         exec SQL   set option   DynUsrPrf = *owner,
018400111128                                 CloSqlCsr = *endmod;
018500111128
018600111128       ENDSR;
018700120207
018800120207       //--------------------------------------------------------------
018900120510       // Gestione videata W01
019000120207       //--------------------------------------------------------------
019100120510       BEGSR  sr_GesW01;
019200120207
019300120207         // - Inizializzazione videata
019400120510         if  $InzW01   = *on;
019500120510           exsr  sr_InzW01;
019600120510           $InzW01  = *off;
019700120207         endif;
019800120207
019900120207         // - Emissione videata
020000170207         exfmt  S7M8W01;
020100120207
020200170208         reset  ErrGenerico;
020300120207
020400120207         SELECT;
020500120207
020600120207           // - F3=Fine
020700120207           WHEN  dsp_aid = c_F03;
020800120510             exsr sr_F03W01;
020900120207
021000120207           // - F12=Ritorno
021100120207           WHEN  dsp_aid = c_F12;
021200120510             exsr sr_F12W01;
021300120207
021400120207           // - Invio / F6=Conferma
021500120207           OTHER;
021600120510             exsr  sr_CtrW01;
021700120207             if  ErrGenerico = *on;
021800120207               leavesr;
021900120207             endif;
022000120207             if  dsp_aid = c_F06;
022100120510               exsr sr_F06W01;
022200120207             endif;
022300120207
022400120207         ENDSL;
022500120207
022600120207       ENDSR;
022700120207
022800120207       //--------------------------------------------------------------
022900120510       // Inizializzazione videata W01
023000120207       //--------------------------------------------------------------
023100120510       BEGSR  sr_InzW01;
023200120207
023300120207         // - Pulizia videata
023400170207         clear  S7M8W01;
023500120620
023600120620         // - Imposto i campi video con i dati in ingresso
023700120207
023800120207       ENDSR;
023900120207
024000120207       //--------------------------------------------------------------
024100120510       // Gestione tasto funzionale F3 da videata W01                  ?
024200120510       // F3=Fine                                                      ?
024300120207       //--------------------------------------------------------------
024400120510       BEGSR  sr_F03W01;
024500120207
024600120207         // - Chiusura del programma
024700120207         $Fine = *on;
024800170207         ExecSQL = *off;
024900120207
025000120207       ENDSR;
025100120207
025200120207       //--------------------------------------------------------------
025300120510       // Gestione tasto funzionale F6 da videata W01
025400120208       // F6=Conferma
025500120207       //--------------------------------------------------------------
025600120510       BEGSR  sr_F06W01;
025700120405
025800170208         Proc1 = w01Proc1;
025900170208         Proc2 = w01Proc2;
026000170207         ExecSQL = *on;
026100120215
026200120510         // Esco dal pgm (solo se non ho errori da mostrare)
026300170208         if ErrGenerico = *off;
026400120208           $Fine = *on;
026500120208         endif;
026600120207
026700120207       ENDSR;
026800120208
026900120207       //--------------------------------------------------------------
027000120510       // Gestione tasto funzionale F12 da videata W01
027100120208       // F12=Ritorno
027200120207       //--------------------------------------------------------------
027300120510       BEGSR  sr_F12W01;
027400120207
027500120207         // - Chiusura del programma
027600120207         $Fine = *on;
027700170207         ExecSQL = *off;
027800120207
027900120207       ENDSR;
028000120207
028100120207       //--------------------------------------------------------------
028200120510       // Controllo videata W01                                        ?
028300120207       //--------------------------------------------------------------
028400120510       BEGSR  sr_CtrW01;
028500120207
028600170208         IndDspF  = *off;
028700120208
028800170208         // entrambe le procedure vanno valorizzate
028900170208         if w01Proc1 = *blank or
029000170208            w01Proc2 = *blank;
029100170208           ErrProc = *on;
029200170208         endif;
029300120207
029400120207       ENDSR;
029500111128
029600111128       //--------------------------------------------------------------
029700120208       // Operazioni finali
029800111128       //--------------------------------------------------------------
029900111128       BEGSR  sr_RoutEnd;
030000111128
030100120208         // - Uscita
030200111128         return;
030300111128
030400111128       ENDSR;
030500111128
030600111128      /end-free
