000100091228       //==============================================================
000200140114       // Driver scrittura EDIVAD
000300091228       //==============================================================
000400091228
000500091228       //--------------------------------------------------------------
000600121106       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700091228       //--------------------------------------------------------------
000800091228
000900100325     /*PRM dbgview(*source)
001000091223     /*END
001100091228
001200091228       //--------------------------------------------------------------
001300121106       // Specifiche di controllo.
001400091228       //--------------------------------------------------------------
001500091223
001600091223     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700100325     h dftactgrp(*no)
001800091223     h alwnull(*inputonly)
001900091223
002000091223       //--------------------------------------------------------------
002100121106       // Dichiarazione file.
002200091223       //--------------------------------------------------------------
002300100112
002400140114     FEDIVADwr  O    E             DISK    usropn
002500091223
002600091223       //--------------------------------------------------------------
002700121106       // Definizione costanti.
002800091223       //--------------------------------------------------------------
002900100302
003000091223
003100091223       //--------------------------------------------------------------
003200121106       // Definizione schiere.
003300091223       //--------------------------------------------------------------
003400091223
003500091223
003600091223       //--------------------------------------------------------------
003700121106       // Definizione aree dati.
003800091223       //--------------------------------------------------------------
003900091223
004000091223
004100091223       //--------------------------------------------------------------
004200121106       // Definizione strutture dati.
004300091223       //--------------------------------------------------------------
004400110516
004500130307     D TIVLR00F      e ds
004600140114     D EDIVAD0F      e ds
004700130307     D dscmz         e ds                  inz
004800140114
004900121106       // - Status
005000110516     d Psds           sds
005100110516     d   SDSpgm          *proc
005200121106     d   JobName             244    253                                         Job name
005300121106     d   JobUser             254    263                                         User name
005400121106     d   JobNumber           264    269s 0                                      Job number
005500091223
005600091223       //--------------------------------------------------------------
005700121106       // Definizione variabili.
005800091223       //--------------------------------------------------------------
005900091223
006000121106       // - Parametri ricevuti:
006100130307     d pIn_Opz         s              1a
006200130307     d pOut_Esito      s              1a
006300121106
006400121106       // Campi di comodo
006500130307     d wEsito          s              1a
006600140114     d wHDL            s                   like(VLRHDL)
006700091223
006800091223       //--------------------------------------------------------------
006900121106       // Definizione prototipi procedure.
007000091223       //--------------------------------------------------------------
007100091223
007200140114     d TITVEVDC        pr                  extpgm('TITVEVDC')
007300130307     d  parccm                        8
007400130307     d  parmbr                       10
007500130307     d  paropz                        1
007600130307
007700130307     d TIS711C         pr                  extpgm('TIS711C')
007800130307     d  cmz711                      110
007900130307     d  esito711                      1
008000130307
008100091223       //--------------------------------------------------------------
008200121106       // Definizione key-list.
008300091223       //--------------------------------------------------------------
008400091223
008500091223
008600091223       //--------------------------------------------------------------
008700121107       // Definizione parametri procedura.
008800091223       //--------------------------------------------------------------
008900091223
009000091223     c     *Entry        plist
009100130307     c                   parm                    pIn_Opz
009200130307     c                   parm                    TIVLR00F
009300140114     c                   parm                    EDIVAD0F
009400130307     c                   parm                    pOut_Esito
009500091223
009600130307      /free
009700091223
009800091223       //--------------------------------------------------------------
009900121106       // M A I N - L I N E
010000091223       //--------------------------------------------------------------
010100130307
010200130307       // Operazioni iniziali?
010300130307       exsr sr_RoutInz;
010400130307
010500130307       // attività richiesta dal chiamante
010600130307       select;
010700130307         // OPEN
010800130307         when pIn_Opz = 'O';
010900130307         exsr sr_open;
011000130307         // WRITE
011100130307         when pIn_Opz = 'W';
011200130307         exsr sr_write;
011300130307         // CLOSE
011400130307         when pIn_Opz = 'C';
011500130307         exsr sr_close;
011600130307         // richiesta errata
011700130307         other;
011800130307         pOut_Esito = '2';
011900130307         exsr sr_RoutEnd;
012000130307       endsl;
012100091223
012200121106       // Operazioni finali?
012300091223       exsr sr_RoutEnd;
012400091223
012500091223       //--------------------------------------------------------------
012600121107       // Operazioni iniziali.
012700091223       //--------------------------------------------------------------
012800091223       BEGSR  sr_RoutInz;
012900130307
013000130307         pOut_Esito = '1';
013100091223
013200091223       ENDSR;
013300110523
013400110523       //--------------------------------------------------------------
013500130307       // OPEN
013600110523       //--------------------------------------------------------------
013700130307       BEGSR  sr_open;
013800110523
013900130318         wHDL = VLRHDL;
014000130318         %subst(wHDL:1:1) = 'P';
014100130307         wEsito = '1';
014200130307
014300130307         monitor;
014400140114           TITVEVDC(VLRKSC:wHDL:wEsito);
014500130307         on-error;
014600130307           pOut_Esito = '2';
014700130307           exsr sr_RoutEnd;
014800130307         endmon;
014900121106
015000121106       ENDSR;
015100130307
015200130307       //--------------------------------------------------------------
015300130307       // WRITE
015400130307       //--------------------------------------------------------------
015500130307       BEGSR  sr_write;
015600130307
015700130307         //scrittura
015800130307
015900140114         if not %open(edivadwr);
016000140114           open edivadwr;
016100130307         endif;
016200130307
016300140114         write edivad00;
016400130307
016500130307       ENDSR;
016600130307
016700130307       //--------------------------------------------------------------
016800130307       // CLOSE
016900130307       //--------------------------------------------------------------
017000130307       BEGSR  sr_close;
017100130318
017200130318         //chiudo il file
017300140114         if %open(edivadwr);
017400140114           close edivadwr;
017500130318         endif;
017600130307
017700130318         wHDL = VLRHDL;
017800130318         %subst(wHDL:1:1) = 'P';
017900130314         wEsito=*blank;
018000130307
018100130307         reset dscmz;
018200130307         cmzdst = %editc(VLRPOI:'X');
018300140114         cmzfld = 'EDIVADWR';
018400130318         cmzmbd = wHDL;
018500140114         cmzfla = 'EDIVAD0F';
018600140114         cmzmba = 'EDIVAD0F';
018700130307         cmznrr = *zeros;
018800130307         cmzlba = vlrfl1;
018900130307         monitor;
019000130307           TIS711C(dscmz:wEsito);
019100130307         on-error;
019200130307           pOut_Esito = '2';
019300130307           exsr sr_RoutEnd;
019400130307         endmon;
019500130307         if cmzerr = '1';
019600130307           pOut_Esito = '2';
019700130307           exsr sr_RoutEnd;
019800130307         endif;
019900130307
020000130307         // se tutto OK
020100130307         wEsito = '2';
020200140114         TITVEVDC(VLRKSC:wHDL:wEsito);
020300130307         if %error;
020400130307           pOut_Esito = '2';
020500130307           exsr sr_RoutEnd;
020600130307         endif;
020700130307
020800130307       ENDSR;
020900121106
021000091223       //--------------------------------------------------------------
021100121107       // Operazioni finali.
021200091223       //--------------------------------------------------------------
021300091223       BEGSR  sr_RoutEnd;
021400130109
021500130109         // Chiusura pgm
021600130307         if pIn_Opz = 'C' or pOut_Esito='2';
021700130307           *inlr = *on;
021800130307         else;
021900130307           *inrt = *on;
022000130307         endif;
022100130109         return;
022200091223
022300091223       ENDSR;
022400091223
022500091223      /end-free
