000100111128       //==============================================================
000200121024       // TIS7WST03R - Ripristino dati esistenti su WF
000300111128       //==============================================================
000400111128
000500120209
000600111128       //--------------------------------------------------------------
000700120207       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000800111128       //--------------------------------------------------------------
000900111128
001000111128     /*PRM  dbgview(*source)
001100111128     /*END
001200111128
001300111128       //--------------------------------------------------------------
001400120207       // Specifiche di controllo.                                     ?
001500111128       //--------------------------------------------------------------
001600111128
001700111128     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001800111128     h dftactgrp(*no)
001900111128     h alwnull(*inputonly)
002000111128
002100111128       //--------------------------------------------------------------
002200120207       // Dichiarazione file.                                          ?
002300111128       //--------------------------------------------------------------
002400111128
002500111128
002600111128       //--------------------------------------------------------------
002700120207       // Definizione costanti.                                        ?
002800111128       //--------------------------------------------------------------
002900120207
003000111128
003100111128
003200111128       //--------------------------------------------------------------
003300120207       // Definizione schiere.                                         ?
003400111128       //--------------------------------------------------------------
003500111128
003600111128
003700111128       //--------------------------------------------------------------
003800120207       // Definizione aree dati.                                       ?
003900111128       //--------------------------------------------------------------
004000111128
004100111128
004200111128       //--------------------------------------------------------------
004300120207       // Definizione strutture dati.                                  ?
004400111128       //--------------------------------------------------------------
004500111128
004600121016
004700121003     D*------------------
004800121003     D* DS X PASSAGGIO PARAMETRI
004900121003     D*------------------
005000121024     D*
005100121024     D*PARAM           DS                  INZ
005200121024     d*   wNrChia                     7s 0
005300121024     d*   wDAD                        8s 0
005400121024     d*   wDAA                        8s 0
005500121024     d*   wCCM                        7s 0
005600121024     d*   wSU                         1
005700121024     d*   wVerTrk                     1
005800121024     d*   wChkXml                     1
005900121024     d*   wTipExe                     4
006000121024     d*   wRmn                       15s 0
006100121024     d*   wRma                       15
006200121024     d*   wAAS                        4s 0
006300121024     d*   wLNP                        3s 0
006400121024     d*   wNRS                        2s 0
006500121024     d*   wNSP                        7s 0
006600121024     d*   wIdJob                     50    varying
006700120927
006800111128       //--------------------------------------------------------------
006900120207       // Definizione variabili globali.                               ?
007000111128       //--------------------------------------------------------------
007100111128
007200120208       // - Stringa SQL da eseguire
007300120928     d wSQl            s          11264    inz  varying
007400111128
007500120928       // - Parametri SQL
007600120207
007700120207       // - InfDS
007800120207
007900120207       // - Indicatori su DspF
008000120207
008100120207       // - Flags booleani
008200120207     d $Fine           s               n   inz(*off)
008300120207
008400120207       // - Campi associati al video
008500120207
008600120207       // - Variabili di appoggio
008700120928     d wX              s              8s 0
008800121002
008900111128       //--------------------------------------------------------------
009000120210       // Definizione procedure usate
009100111128       //--------------------------------------------------------------
009200120704
009300121024     d TIS7WST03R      pr
009400121024     d  Errore                        3s 0
009500121024
009600121024     d TIS7WST03R      pi
009700121024     d  Errore                        3s 0
009800111128
009900111128       //--------------------------------------------------------------
010000120208       // Definizione key-list.                                        ?
010100111128       //--------------------------------------------------------------
010200111128
010300111128
010400111128       //--------------------------------------------------------------
010500120208       // M A I N - L I N E                                            ?
010600111128       //--------------------------------------------------------------
010700111128
010800111128      /free
010900111128
011000120208       // - Operazioni iniziali
011100111128       exsr  sr_RoutInz;
011200111128
011300120928       // - Esecuzione SQL (e scrittura WF)
011400120927       exsr  eseguiSQL;
011500120207
011600120208       // - Operazioni finali
011700111128       exsr  sr_RoutEnd;
011800111128
011900111128       //--------------------------------------------------------------
012000120208       // Operazioni iniziali
012100111128       //--------------------------------------------------------------
012200111128       BEGSR sr_RoutInz;
012300111128
012400111128         *inLR = *on;
012500120927
012600120208         // - Impostazione opzioni per SQL
012700111128         exec SQL   set option   DynUsrPrf = *owner,
012800111128                                 CloSqlCsr = *endmod;
012900111128
013000111128       ENDSR;
013100120208
013200120208       //--------------------------------------------------------------
013300120927       // Reperisco i dati da scrivere
013400120208       //--------------------------------------------------------------
013500120928       BEGSR  eseguiSQL;
013600121016
013700121024         // - Creazione stringa SQL da eseguire
013800121024         exsr CreaStringaSQL;
013900121024
014000121024         exec sql  execute immediate: wSQL;
014100120208
014200120208       ENDSR;
014300120215
014400120215       //--------------------------------------------------------------
014500120927       // Creo la stringa SQL
014600120215       //--------------------------------------------------------------
014700120927       BEGSR  CreaStringaSQL;
014800120215
014900121016         wSQL = *blank;
015000120928
015100120927         wSQL =
015200121024          'UPDATE WFWST00F SET '  +
015300121024          'WFWPROGR    = 0 , '    +
015400121105          'WFWTHREAD   = -1 , '    +
015500121024          'WFWTIMEEXE  = 0 , '    +
015600121024          'WFWESIXML   ='' '' , ' +
015700121026          'WFWESIEXED  ='' '' , ' +
015800121105          'WFWTSINI   =''0001-01-01-00.00.00.000000'' , ' +
015900121105          'WFWTSFIN   =''0001-01-01-00.00.00.000000'' , ' +
016000121024          'WFWESIEXE   = 999 ';
016100120927
016200120927       ENDSR;
016300120928
016400111128       //--------------------------------------------------------------
016500120208       // Operazioni finali
016600111128       //--------------------------------------------------------------
016700111128       BEGSR  sr_RoutEnd;
016800111128
016900121024         // se ho avuto un errore nell'SQL, lo segnalo
017000121024         if SQLCod <> 0;
017100121024           errore = 1;
017200121024         endif;
017300121024
017400121024         // - Uscita
017500121024         return;
017600111128
017700111128       ENDSR;
