000100130131       //==============================================================
000200130830       //?Copia dati di UNA vers.cappario in AS888 da SETRAS - Filtro  ?
000300090617       //?         -=»> DA LANCIARE SU SETRAS <«=-                     ?
000400130131       //==============================================================
000500130131
000600130131       //--------------------------------------------------------------
000700130131       //?Specifiche di controllo.                                     ?
000800130131       //--------------------------------------------------------------
000900090617
001000141210     h dftactgrp(*yes)
001100090617     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001200090617
001300090617       //--------------------------------------------------------------
001400090617       //?Dichiarazione file.                                          ?
001500090617       //--------------------------------------------------------------
001600090617
001700090617       // - Video
001800090617     fTISIJ0D   cf   e             workstn
001900090617     f                                     indds(IndDspF)
002000090617     f                                     infds(InfDspF)
002100090617
002200090617       //--------------------------------------------------------------
002300090617       //?Definizione costanti.                                        ?
002400090617       //--------------------------------------------------------------
002500090617
002600090617       // - Tasti funzionali a video
002700090617     d c_F01           c                   const(x'31')
002800090617     d c_F02           c                   const(x'32')
002900090617     d c_F03           c                   const(x'33')
003000090617     d c_F05           c                   const(x'35')
003100090617     d c_F06           c                   const(x'36')
003200090617     d c_F07           c                   const(x'37')
003300090617     d c_F08           c                   const(x'38')
003400090617     d c_F09           c                   const(x'39')
003500090617     d c_F10           c                   const(x'3A')
003600090617     d c_F12           c                   const(x'3C')
003700090617     d c_F13           c                   const(x'B1')
003800090617     d c_F14           c                   const(x'B2')
003900090617     d c_F15           c                   const(x'B3')
004000090617     d c_F16           c                   const(x'B4')
004100090617     d c_F17           c                   const(x'B5')
004200090617     d c_F18           c                   const(x'B6')
004300090617     d c_F19           c                   const(x'B7')
004400090617     d c_F20           c                   const(x'B8')
004500090617     d c_F21           c                   const(x'B9')
004600090617     d c_F22           c                   const(x'BA')
004700090617     d c_F23           c                   const(x'BB')
004800090617     d c_F24           c                   const(x'BC')
004900090617     d c_Enter         c                   const(x'F1')
005000090617     d c_RollDown      c                   const(x'F4')
005100090617     d c_RollUp        c                   const(x'F5')
005200090617
005300090617       //--------------------------------------------------------------
005400090617       //?Definizione schiere.                                         ?
005500090617       //--------------------------------------------------------------
005600090617
005700090617       // - Elenco archivi elaborabili
005800130830     d sk_File         s             10    dim(13)  ctdata  perrcd(1)
005900090617
006000090617       // - Messaggi di errore
006100130131     d sk_Msg          s             78    dim( 6)  ctdata  perrcd(01)
006200090617
006300090617       //--------------------------------------------------------------
006400090617       //?Definizione aree dati.                                       ?
006500090617       //--------------------------------------------------------------
006600090617
006700090617       // - Dati utente
006800090617     d §AzUte        e ds                  extname(AZUTE00F)
006900090617     d                                     dtaara
007000090617     d §DatiUte      e ds                  extname(dDatiUte)
007100090617     d                                     dtaara
007200090617
007300090617       //--------------------------------------------------------------
007400090617       //?Definizione strutture dati.                                  ?
007500090617       //--------------------------------------------------------------
007600090617
007700090617       // - Status ds
007800090617     d Status         sds
007900090617     d  SDSpgm           *proc
008000090617
008100090617       // - InfDS
008200090617     d InfDspF         ds
008300090617     d   dsp_aid             369    369a
008400090617
008500090617       // - Indicatori su DspF
008600090617     d IndDspF         ds                  inz
008700090617         // - Emissione messaggio di errore
008800090617     d   ErrMessage                    n   overlay(IndDspF : 28)
008900090617         // - Posizionamento cursore & segnalazione errore
009000090617     d   PosCurVER                     n   overlay(IndDspF : 51)
009100090617     d   PosCurPF                      n   overlay(IndDspF : 52)
009200130131     d   PosCurUSR                     n   overlay(IndDspF : 53)
009300130131     d   PosCurPWD                     n   overlay(IndDspF : 54)
009400090617         // - Riemissione videata
009500090617     d   ErrGenerico                   n   overlay(IndDspF : 99)
009600090617
009700090617       // - Parametri
009800090617     d KPJBA         e ds
009900090617     d TISIJ1ds      e ds                  inz
010000090617
010100090617       // - Parametri x controllo profilo utenti
010200090617     d TIBS34ds      e ds
010300090617
010400090617       //--------------------------------------------------------------
010500090617       //?Definizione variabili globali.                               ?
010600090617       //--------------------------------------------------------------
010700090617
010800090617       // - Flags booleani
010900090617     d $Fine           s               n   inz
011000090617     d $InzD01         s               n   inz(*on)
011100090617
011200090617       // - Variabili per la gestione del video
011300090617     d $Video          s              2    inz('D1')
011400090617
011500090617       //--------------------------------------------------------------
011600090617       //?Definizione prototipi procedure.                             ?
011700090617       //--------------------------------------------------------------
011800090617
011900090617       // - Reperimento dati utente
012000090617      /copy gaitrasrc/srcprotopr,TIBS34R
012100090617
012200090617       // - Sottomissione lavoro batch
012300090617      /copy gaitrasrc/srcprotopr,BCH10
012400090617
012500090617       // - Richiamo diretto della procedura batch
012600090617     d tisiJ1r         pr                  extpgm('TISIJ1R')
012700090617     d   kpjba                             likeds(KPJBA)
012800090617
012900090617       //--------------------------------------------------------------
013000090617       //?Definizione key-list.                                        ?
013100090617       //--------------------------------------------------------------
013200090617
013300090617
013400090617       //--------------------------------------------------------------
013500090617       //?Riepilogo indicatori utilizzati.                             ?
013600090617       //--------------------------------------------------------------
013700090617       //--------------------------------------------------------------
013800090617
013900090617       //--------------------------------------------------------------
014000090617       //?M A I N - L I N E                                            ?
014100090617       //--------------------------------------------------------------
014200090617
014300090617     c     *Entry        plist
014400090617     c                   parm                    KPJBA
014500090617
014600090617      /free
014700090617
014800090617       //?Operazioni iniziali?
014900090617       exsr  sr_RoutInz;
015000090617
015100090617       //?Gestione video?
015200090617       DOW  $Fine = *off;
015300090617         select;
015400090617           // - Richiesta dei dati in stampa
015500090617           when  $Video = 'D1';
015600090617             exsr  sr_GesD01;
015700090617           other;
015800090617             $Fine = *on;
015900090617         endsl;
016000090617       ENDDO;
016100090617
016200090617       //?Operazioni finali?
016300090617       exsr  sr_RoutEnd;
016400090617
016500090617       //--------------------------------------------------------------
016600090617       //?Operazioni iniziali.                                         ?
016700090617       //--------------------------------------------------------------
016800090617       BEGSR  sr_RoutInz;
016900090617
017000090617         *inLR = *on;
017100090617
017200090617         //?Impostazione campi "fissi"?
017300090617         V1Cpgm = SDSpgm;
017400090617
017500090617         //?Reperimento dati job?
017600090617         exsr  sr_DatiJob;
017700090617
017800090617       ENDSR;
017900090617
018000090617       //--------------------------------------------------------------
018100090617       //?Reperimento Dati del job (Utente/Operativi).                 ?
018200090617       //--------------------------------------------------------------
018300090617       BEGSR  sr_DatiJob;
018400090617
018500090617         in(E) §AzUte;
018600090617         if NOT %error;
018700090617           in(E) §DatiUte;
018800090617         endif;
018900090617         if %error or RSut = *blanks;
019000090617           clear TIBS34ds;
019100090617           tibs34r ( tibs34ds );
019200090617           in §AzUte;
019300090617           in §DatiUte;
019400090617         endif;
019500090617
019600090617       ENDSR;
019700090617
019800090617       //--------------------------------------------------------------
019900090617       //?Gestione videata D01                                         ?
020000090617       //--------------------------------------------------------------
020100090617       BEGSR  sr_GesD01;
020200090617
020300090617         //?Inizializzazione videata?
020400090617         if  $InzD01 = *on;
020500090617           exsr  sr_InzD01;
020600090617           $InzD01 = *off;
020700090617         endif;
020800090617
020900090617         //?Emissione videata?
021000090617         write SIJ0T01;
021100090617         exfmt SIJ0D01;
021200090617
021300090617         reset ErrMessage;
021400090617         reset ErrGenerico;
021500090617         clear V1Dmsg;
021600090617
021700090617         SELECT;
021800090617
021900090617           //?F3=Fine?
022000090617           WHEN  dsp_aid = c_F03;
022100090617             $Fine = *on;
022200090617
022300090617           //?Invio / F6=Conferma?
022400090617           OTHER;
022500090617             exsr sr_CtrD01;
022600090617             if  ErrGenerico = *off   and   dsp_aid = c_F06;
022700090617               exsr  sr_SbmJob;
022800090617               $Fine = *on;
022900090617             endif;
023000090617
023100090617         ENDSL;
023200090617
023300090617       ENDSR;
023400090617
023500090617       //--------------------------------------------------------------
023600090617       //?Inizializzazione videata D01                                 ?
023700090617       //--------------------------------------------------------------
023800090617       BEGSR  sr_InzD01;
023900090617
024000090617         clear  SIJ0D01;
024100090617
024200090617         //?Test AS/400?
024300090617         if  %subst(KNSIF : 7 : 1) = 'P';
024400090617           ErrMessage  = *on;
024500090617           ErrGenerico = *on;
024600090617           V1Dmsg      = sk_Msg(01);
024700090617           $Fine       = *on;
024800090617           leavesr;
024900090617         endif;
025000090617
025100090617       ENDSR;
025200090617
025300090617       //--------------------------------------------------------------
025400090617       //?Controllo dati immessi nella videata D01                     ?
025500090617       //--------------------------------------------------------------
025600090617       BEGSR  sr_CtrD01;
025700090617
025800090617         %subst(IndDspF : 50) = *off;
025900090617
026000130131         //?Verifica sistema AS/400?
026100090617         if  %subst(KNSIF : 7 : 1) = 'P';
026200090617           ErrMessage  = *on;
026300090617           ErrGenerico = *on;
026400090617           V1Dmsg      = sk_Msg(01);
026500090617           $Fine       = *on;
026600090617           leavesr;
026700090617         endif;
026800090617
026900090617         //?Versione Cappario?
027000090617         select;
027100090617           when  V1Cver =  *zero;
027200090617             ErrMessage  = *on;
027300090617             ErrGenerico = *on;
027400090617             PosCurVER   = *on;
027500090617             V1Dmsg      = sk_Msg(02);
027600090617             leavesr;
027700090617           when  V1Cver <  *zero;
027800090617             ErrMessage  = *on;
027900090617             ErrGenerico = *on;
028000090617             PosCurVER   = *on;
028100090617             V1Dmsg      = sk_Msg(03);
028200090617             leavesr;
028300090617         endsl;
028400130131
028500130131         //?Utente (su AS888) e relativa password?
028600130131         select;
028700130131           when  V1Cusr = *blank;
028800130131             ErrMessage  = *on;
028900130131             ErrGenerico = *on;
029000130131             PosCurUSR   = *on;
029100130131             V1Dmsg      = sk_Msg(05);
029200130131             leavesr;
029300130131           when  V1Cpwd = *blank;
029400130131             ErrMessage  = *on;
029500130131             ErrGenerico = *on;
029600130131             PosCurPWD   = *on;
029700130131             V1Dmsg      = sk_Msg(06);
029800130131             leavesr;
029900130131         endsl;
030000090617
030100090617         //?Nome file?
030200090617         if  V1Cpf  <> *blank   and
030300090617             %lookup(V1Cpf : sk_File) = *zero;
030400090617           ErrMessage  = *on;
030500090617           ErrGenerico = *on;
030600090617           PosCurPF    = *on;
030700090617           V1Dmsg      = sk_Msg(04);
030800090617           leavesr;
030900090617         endif;
031000090617
031100090617       ENDSR;
031200090617
031300090617       //--------------------------------------------------------------
031400090617       //?Sottomissione lavoro batch                                   ?
031500090617       //--------------------------------------------------------------
031600090617       BEGSR  sr_SbmJob;
031700090617
031800090617         clear TISIJ1ds;
031900090617         ISIJ1ver  = V1Cver;
032000090617         ISIJ1file = V1Cpf;
032100130131         ISIJ1usr  = V1Cusr;
032200091204         ISIJ1pwd  = V1Cpwd;
032300090617
032400090617         kpjbu = TISIJ1ds;
032500090617         kcoaz = 'SIJ1';
032600090617
032700090617         if  knmus = *all'1';
032800090617           TISIJ1R ( kpjba );
032900090617         else;
033000090617           BCH10 ( kpjba );
033100090617         endif;
033200090617
033300090617       ENDSR;
033400090617
033500090617       //--------------------------------------------------------------
033600090617       //?Operazioni finali.                                           ?
033700090617       //--------------------------------------------------------------
033800090617       BEGSR  sr_RoutEnd;
033900090617
034000090617         //?"Chiusura" pgm?
034100090617         return;
034200090617
034300090617       ENDSR;
034400090617
034500090617      /end-free
034600090617
034700090617       //--------------------------------------------------------------
034800090617       //?Definizione schiere a tempo di compilazione                  ?
034900090617       //--------------------------------------------------------------
035000090617
035100090617** - sk_File
035200090617AZCAE00F    1
035300090617AZCPC00F    2
035400090617AZCPE00F    3
035500090617AZCPL00F    4
035600090617AZCPR00F    5
035700090617AZCPS00F    6
035800090618AZCPP00F    7
035900090618AZCPT00F    8
036000090618            9  AZCPV00F
036100090618AZCAS00F   10
036200090618AZCEP00F   11
036300090618AZCLN00F   12
036400130830AZCOS00F   13
036500090617** > sk_Msg -----------------------------------------------------------------*
036600090617Funzione eseguibile SOLO su SETRAS! Premere Invio per uscire dal programma     1
036700090617Versione cappario obbligatoria                                                 2
036800090617Versione cappario errata (negativa)                                            3
036900090617Nome singolo archivio NON tra quelli elaborabili                               4
037000130131Nome utente (su AS888) obbligatorio                                            5
037100130131Password dell'utente (su AS888) obbligatoria                                   6
