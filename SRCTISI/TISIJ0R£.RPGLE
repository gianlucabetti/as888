000100090617      *PARMS dftactgrp(*no) actgrp(*caller) dbgview(*source)
000200130131       //==============================================================
000300130830       //?Copia dati di UNA vers.cappario in AS888 da SETRAS - Filtro  ?
000400090617       //?         -=»> DA LANCIARE SU SETRAS <«=-                     ?
000500130131       //==============================================================
000600130131
000700130131       //--------------------------------------------------------------
000800130131       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000900130131       //--------------------------------------------------------------
001000130131
001100130131      *PRM  dftactgrp(*no) actgrp(*caller) dbgview(*source)
001200130131     /*END
001300130131
001400130131       //--------------------------------------------------------------
001500130131       //?Specifiche di controllo.                                     ?
001600130131       //--------------------------------------------------------------
001700090617
001800090617     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001900090617
002000090617       //--------------------------------------------------------------
002100090617       //?Dichiarazione file.                                          ?
002200090617       //--------------------------------------------------------------
002300090617
002400090617       // - Video
002500090617     fTISIJ0D   cf   e             workstn
002600090617     f                                     indds(IndDspF)
002700090617     f                                     infds(InfDspF)
002800090617
002900090617       //--------------------------------------------------------------
003000090617       //?Definizione costanti.                                        ?
003100090617       //--------------------------------------------------------------
003200090617
003300090617       // - Tasti funzionali a video
003400090617     d c_F01           c                   const(x'31')
003500090617     d c_F02           c                   const(x'32')
003600090617     d c_F03           c                   const(x'33')
003700090617     d c_F05           c                   const(x'35')
003800090617     d c_F06           c                   const(x'36')
003900090617     d c_F07           c                   const(x'37')
004000090617     d c_F08           c                   const(x'38')
004100090617     d c_F09           c                   const(x'39')
004200090617     d c_F10           c                   const(x'3A')
004300090617     d c_F12           c                   const(x'3C')
004400090617     d c_F13           c                   const(x'B1')
004500090617     d c_F14           c                   const(x'B2')
004600090617     d c_F15           c                   const(x'B3')
004700090617     d c_F16           c                   const(x'B4')
004800090617     d c_F17           c                   const(x'B5')
004900090617     d c_F18           c                   const(x'B6')
005000090617     d c_F19           c                   const(x'B7')
005100090617     d c_F20           c                   const(x'B8')
005200090617     d c_F21           c                   const(x'B9')
005300090617     d c_F22           c                   const(x'BA')
005400090617     d c_F23           c                   const(x'BB')
005500090617     d c_F24           c                   const(x'BC')
005600090617     d c_Enter         c                   const(x'F1')
005700090617     d c_RollDown      c                   const(x'F4')
005800090617     d c_RollUp        c                   const(x'F5')
005900090617
006000090617       //--------------------------------------------------------------
006100090617       //?Definizione schiere.                                         ?
006200090617       //--------------------------------------------------------------
006300090617
006400090617       // - Elenco archivi elaborabili
006500130830     d sk_File         s             10    dim(13)  ctdata  perrcd(1)
006600090617
006700090617       // - Messaggi di errore
006800130131     d sk_Msg          s             78    dim( 6)  ctdata  perrcd(01)
006900090617
007000090617       //--------------------------------------------------------------
007100090617       //?Definizione aree dati.                                       ?
007200090617       //--------------------------------------------------------------
007300090617
007400090617       // - Dati utente
007500090617     d §AzUte        e ds                  extname(AZUTE00F)
007600090617     d                                     dtaara
007700090617     d §DatiUte      e ds                  extname(dDatiUte)
007800090617     d                                     dtaara
007900090617
008000090617       //--------------------------------------------------------------
008100090617       //?Definizione strutture dati.                                  ?
008200090617       //--------------------------------------------------------------
008300090617
008400090617       // - Status ds
008500090617     d Status         sds
008600090617     d  SDSpgm           *proc
008700090617
008800090617       // - InfDS
008900090617     d InfDspF         ds
009000090617     d   dsp_aid             369    369a
009100090617
009200090617       // - Indicatori su DspF
009300090617     d IndDspF         ds                  inz
009400090617         // - Emissione messaggio di errore
009500090617     d   ErrMessage                    n   overlay(IndDspF : 28)
009600090617         // - Posizionamento cursore & segnalazione errore
009700090617     d   PosCurVER                     n   overlay(IndDspF : 51)
009800090617     d   PosCurPF                      n   overlay(IndDspF : 52)
009900130131     d   PosCurUSR                     n   overlay(IndDspF : 53)
010000130131     d   PosCurPWD                     n   overlay(IndDspF : 54)
010100090617         // - Riemissione videata
010200090617     d   ErrGenerico                   n   overlay(IndDspF : 99)
010300090617
010400090617       // - Parametri
010500090617     d KPJBA         e ds
010600090617     d TISIJ1ds      e ds                  inz
010700090617
010800090617       // - Parametri x controllo profilo utenti
010900090617     d TIBS34ds      e ds
011000090617
011100090617       //--------------------------------------------------------------
011200090617       //?Definizione variabili globali.                               ?
011300090617       //--------------------------------------------------------------
011400090617
011500090617       // - Flags booleani
011600090617     d $Fine           s               n   inz
011700090617     d $InzD01         s               n   inz(*on)
011800090617
011900090617       // - Variabili per la gestione del video
012000090617     d $Video          s              2    inz('D1')
012100090617
012200090617       //--------------------------------------------------------------
012300090617       //?Definizione prototipi procedure.                             ?
012400090617       //--------------------------------------------------------------
012500090617
012600090617       // - Reperimento dati utente
012700090617      /copy gaitrasrc/srcprotopr,TIBS34R
012800090617
012900090617       // - Sottomissione lavoro batch
013000090617      /copy gaitrasrc/srcprotopr,BCH10
013100090617
013200090617       // - Richiamo diretto della procedura batch
013300090617     d tisiJ1r         pr                  extpgm('TISIJ1R')
013400090617     d   kpjba                             likeds(KPJBA)
013500090617
013600090617       //--------------------------------------------------------------
013700090617       //?Definizione key-list.                                        ?
013800090617       //--------------------------------------------------------------
013900090617
014000090617
014100090617       //--------------------------------------------------------------
014200090617       //?Riepilogo indicatori utilizzati.                             ?
014300090617       //--------------------------------------------------------------
014400090617       //--------------------------------------------------------------
014500090617
014600090617       //--------------------------------------------------------------
014700090617       //?M A I N - L I N E                                            ?
014800090617       //--------------------------------------------------------------
014900090617
015000090617     c     *Entry        plist
015100090617     c                   parm                    KPJBA
015200090617
015300090617      /free
015400090617
015500090617       //?Operazioni iniziali?
015600090617       exsr  sr_RoutInz;
015700090617
015800090617       //?Gestione video?
015900090617       DOW  $Fine = *off;
016000090617         select;
016100090617           // - Richiesta dei dati in stampa
016200090617           when  $Video = 'D1';
016300090617             exsr  sr_GesD01;
016400090617           other;
016500090617             $Fine = *on;
016600090617         endsl;
016700090617       ENDDO;
016800090617
016900090617       //?Operazioni finali?
017000090617       exsr  sr_RoutEnd;
017100090617
017200090617       //--------------------------------------------------------------
017300090617       //?Operazioni iniziali.                                         ?
017400090617       //--------------------------------------------------------------
017500090617       BEGSR  sr_RoutInz;
017600090617
017700090617         *inLR = *on;
017800090617
017900090617         //?Impostazione campi "fissi"?
018000090617         V1Cpgm = SDSpgm;
018100090617
018200090617         //?Reperimento dati job?
018300090617         exsr  sr_DatiJob;
018400090617
018500090617       ENDSR;
018600090617
018700090617       //--------------------------------------------------------------
018800090617       //?Reperimento Dati del job (Utente/Operativi).                 ?
018900090617       //--------------------------------------------------------------
019000090617       BEGSR  sr_DatiJob;
019100090617
019200090617         in(E) §AzUte;
019300090617         if NOT %error;
019400090617           in(E) §DatiUte;
019500090617         endif;
019600090617         if %error or RSut = *blanks;
019700090617           clear TIBS34ds;
019800090617           tibs34r ( tibs34ds );
019900090617           in §AzUte;
020000090617           in §DatiUte;
020100090617         endif;
020200090617
020300090617       ENDSR;
020400090617
020500090617       //--------------------------------------------------------------
020600090617       //?Gestione videata D01                                         ?
020700090617       //--------------------------------------------------------------
020800090617       BEGSR  sr_GesD01;
020900090617
021000090617         //?Inizializzazione videata?
021100090617         if  $InzD01 = *on;
021200090617           exsr  sr_InzD01;
021300090617           $InzD01 = *off;
021400090617         endif;
021500090617
021600090617         //?Emissione videata?
021700090617         write SIJ0T01;
021800090617         exfmt SIJ0D01;
021900090617
022000090617         reset ErrMessage;
022100090617         reset ErrGenerico;
022200090617         clear V1Dmsg;
022300090617
022400090617         SELECT;
022500090617
022600090617           //?F3=Fine?
022700090617           WHEN  dsp_aid = c_F03;
022800090617             $Fine = *on;
022900090617
023000090617           //?Invio / F6=Conferma?
023100090617           OTHER;
023200090617             exsr sr_CtrD01;
023300090617             if  ErrGenerico = *off   and   dsp_aid = c_F06;
023400090617               exsr  sr_SbmJob;
023500090617               $Fine = *on;
023600090617             endif;
023700090617
023800090617         ENDSL;
023900090617
024000090617       ENDSR;
024100090617
024200090617       //--------------------------------------------------------------
024300090617       //?Inizializzazione videata D01                                 ?
024400090617       //--------------------------------------------------------------
024500090617       BEGSR  sr_InzD01;
024600090617
024700090617         clear  SIJ0D01;
024800090617
024900090617         //?Test AS/400?
025000090617         if  %subst(KNSIF : 7 : 1) = 'P';
025100090617           ErrMessage  = *on;
025200090617           ErrGenerico = *on;
025300090617           V1Dmsg      = sk_Msg(01);
025400090617           $Fine       = *on;
025500090617           leavesr;
025600090617         endif;
025700090617
025800090617       ENDSR;
025900090617
026000090617       //--------------------------------------------------------------
026100090617       //?Controllo dati immessi nella videata D01                     ?
026200090617       //--------------------------------------------------------------
026300090617       BEGSR  sr_CtrD01;
026400090617
026500090617         %subst(IndDspF : 50) = *off;
026600090617
026700130131         //?Verifica sistema AS/400?
026800090617         if  %subst(KNSIF : 7 : 1) = 'P';
026900090617           ErrMessage  = *on;
027000090617           ErrGenerico = *on;
027100090617           V1Dmsg      = sk_Msg(01);
027200090617           $Fine       = *on;
027300090617           leavesr;
027400090617         endif;
027500090617
027600090617         //?Versione Cappario?
027700090617         select;
027800090617           when  V1Cver =  *zero;
027900090617             ErrMessage  = *on;
028000090617             ErrGenerico = *on;
028100090617             PosCurVER   = *on;
028200090617             V1Dmsg      = sk_Msg(02);
028300090617             leavesr;
028400090617           when  V1Cver <  *zero;
028500090617             ErrMessage  = *on;
028600090617             ErrGenerico = *on;
028700090617             PosCurVER   = *on;
028800090617             V1Dmsg      = sk_Msg(03);
028900090617             leavesr;
029000090617         endsl;
029100130131
029200130131         //?Utente (su AS888) e relativa password?
029300130131         select;
029400130131           when  V1Cusr = *blank;
029500130131             ErrMessage  = *on;
029600130131             ErrGenerico = *on;
029700130131             PosCurUSR   = *on;
029800130131             V1Dmsg      = sk_Msg(05);
029900130131             leavesr;
030000130131           when  V1Cpwd = *blank;
030100130131             ErrMessage  = *on;
030200130131             ErrGenerico = *on;
030300130131             PosCurPWD   = *on;
030400130131             V1Dmsg      = sk_Msg(06);
030500130131             leavesr;
030600130131         endsl;
030700090617
030800090617         //?Nome file?
030900090617         if  V1Cpf  <> *blank   and
031000090617             %lookup(V1Cpf : sk_File) = *zero;
031100090617           ErrMessage  = *on;
031200090617           ErrGenerico = *on;
031300090617           PosCurPF    = *on;
031400090617           V1Dmsg      = sk_Msg(04);
031500090617           leavesr;
031600090617         endif;
031700090617
031800090617       ENDSR;
031900090617
032000090617       //--------------------------------------------------------------
032100090617       //?Sottomissione lavoro batch                                   ?
032200090617       //--------------------------------------------------------------
032300090617       BEGSR  sr_SbmJob;
032400090617
032500090617         clear TISIJ1ds;
032600090617         ISIJ1ver  = V1Cver;
032700090617         ISIJ1file = V1Cpf;
032800130131         ISIJ1usr  = V1Cusr;
032900091204         ISIJ1pwd  = V1Cpwd;
033000090617
033100090617         kpjbu = TISIJ1ds;
033200090617         kcoaz = 'SIJ1';
033300090617
033400090617         if  knmus = *all'1';
033500090617           TISIJ1R ( kpjba );
033600090617         else;
033700090617           BCH10 ( kpjba );
033800090617         endif;
033900090617
034000090617       ENDSR;
034100090617
034200090617       //--------------------------------------------------------------
034300090617       //?Operazioni finali.                                           ?
034400090617       //--------------------------------------------------------------
034500090617       BEGSR  sr_RoutEnd;
034600090617
034700090617         //?"Chiusura" pgm?
034800090617         return;
034900090617
035000090617       ENDSR;
035100090617
035200090617      /end-free
035300090617
035400090617       //--------------------------------------------------------------
035500090617       //?Definizione schiere a tempo di compilazione                  ?
035600090617       //--------------------------------------------------------------
035700090617
035800090617** - sk_File
035900090617AZCAE00F    1
036000090617AZCPC00F    2
036100090617AZCPE00F    3
036200090617AZCPL00F    4
036300090617AZCPR00F    5
036400090617AZCPS00F    6
036500090618AZCPP00F    7
036600090618AZCPT00F    8
036700090618            9  AZCPV00F
036800090618AZCAS00F   10
036900090618AZCEP00F   11
037000090618AZCLN00F   12
037100130830AZCOS00F   13
037200090617** > sk_Msg -----------------------------------------------------------------*
037300090617Funzione eseguibile SOLO su SETRAS! Premere Invio per uscire dal programma     1
037400090617Versione cappario obbligatoria                                                 2
037500090617Versione cappario errata (negativa)                                            3
037600090617Nome singolo archivio NON tra quelli elaborabili                               4
037700130131Nome utente (su AS888) obbligatorio                                            5
037800130131Password dell'utente (su AS888) obbligatoria                                   6
