000100090617      *PARMS dftactgrp(*no) actgrp(*caller) dbgview(*source)
000200090617       //--------------------------------------------------------------
000300090617       //?Copia dati di UNA vers.cappario in AS888 sa SETRAS - Filtro  ?
000400090617       //?         -=»> DA LANCIARE SU SETRAS <«=-                     ?
000500090617       //--------------------------------------------------------------
000600090617
000700090617     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000800090617
000900090617       //--------------------------------------------------------------
001000090617       //?Dichiarazione file.                                          ?
001100090617       //--------------------------------------------------------------
001200090617
001300090617       // - Video
001400090617     fTISIJ0D   cf   e             workstn
001500090617     f                                     indds(IndDspF)
001600090617     f                                     infds(InfDspF)
001700090617
001800090617       //--------------------------------------------------------------
001900090617       //?Definizione costanti.                                        ?
002000090617       //--------------------------------------------------------------
002100090617
002200090617       // - Tasti funzionali a video
002300090617     d c_F01           c                   const(x'31')
002400090617     d c_F02           c                   const(x'32')
002500090617     d c_F03           c                   const(x'33')
002600090617     d c_F05           c                   const(x'35')
002700090617     d c_F06           c                   const(x'36')
002800090617     d c_F07           c                   const(x'37')
002900090617     d c_F08           c                   const(x'38')
003000090617     d c_F09           c                   const(x'39')
003100090617     d c_F10           c                   const(x'3A')
003200090617     d c_F12           c                   const(x'3C')
003300090617     d c_F13           c                   const(x'B1')
003400090617     d c_F14           c                   const(x'B2')
003500090617     d c_F15           c                   const(x'B3')
003600090617     d c_F16           c                   const(x'B4')
003700090617     d c_F17           c                   const(x'B5')
003800090617     d c_F18           c                   const(x'B6')
003900090617     d c_F19           c                   const(x'B7')
004000090617     d c_F20           c                   const(x'B8')
004100090617     d c_F21           c                   const(x'B9')
004200090617     d c_F22           c                   const(x'BA')
004300090617     d c_F23           c                   const(x'BB')
004400090617     d c_F24           c                   const(x'BC')
004500090617     d c_Enter         c                   const(x'F1')
004600090617     d c_RollDown      c                   const(x'F4')
004700090617     d c_RollUp        c                   const(x'F5')
004800090617
004900090617       //--------------------------------------------------------------
005000090617       //?Definizione schiere.                                         ?
005100090617       //--------------------------------------------------------------
005200090617
005300090617       // - Elenco archivi elaborabili
005400090617     d sk_File         s             10    dim(12)  ctdata  perrcd(1)
005500090617
005600090617       // - Messaggi di errore
005700090617     d sk_Msg          s             78    dim( 4)  ctdata  perrcd(01)
005800090617
005900090617       //--------------------------------------------------------------
006000090617       //?Definizione aree dati.                                       ?
006100090617       //--------------------------------------------------------------
006200090617
006300090617       // - Dati utente
006400090617     d §AzUte        e ds                  extname(AZUTE00F)
006500090617     d                                     dtaara
006600090617     d §DatiUte      e ds                  extname(dDatiUte)
006700090617     d                                     dtaara
006800090617
006900090617       //--------------------------------------------------------------
007000090617       //?Definizione strutture dati.                                  ?
007100090617       //--------------------------------------------------------------
007200090617
007300090617       // - Status ds
007400090617     d Status         sds
007500090617     d  SDSpgm           *proc
007600090617
007700090617       // - InfDS
007800090617     d InfDspF         ds
007900090617     d   dsp_aid             369    369a
008000090617
008100090617       // - Indicatori su DspF
008200090617     d IndDspF         ds                  inz
008300090617         // - Emissione messaggio di errore
008400090617     d   ErrMessage                    n   overlay(IndDspF : 28)
008500090617         // - Posizionamento cursore & segnalazione errore
008600090617     d   PosCurVER                     n   overlay(IndDspF : 51)
008700090617     d   PosCurPF                      n   overlay(IndDspF : 52)
008800090617         // - Riemissione videata
008900090617     d   ErrGenerico                   n   overlay(IndDspF : 99)
009000090617
009100090617       // - Parametri
009200090617     d KPJBA         e ds
009300090617     d TISIJ1ds      e ds                  inz
009400090617
009500090617       // - Parametri x controllo profilo utenti
009600090617     d TIBS34ds      e ds
009700090617
009800090617       //--------------------------------------------------------------
009900090617       //?Definizione variabili globali.                               ?
010000090617       //--------------------------------------------------------------
010100090617
010200090617       // - Flags booleani
010300090617     d $Fine           s               n   inz
010400090617     d $InzD01         s               n   inz(*on)
010500090617
010600090617       // - Variabili per la gestione del video
010700090617     d $Video          s              2    inz('D1')
010800090617
010900090617       //--------------------------------------------------------------
011000090617       //?Definizione prototipi procedure.                             ?
011100090617       //--------------------------------------------------------------
011200090617
011300090617       // - Reperimento dati utente
011400090617      /copy gaitrasrc/srcprotopr,TIBS34R
011500090617
011600090617       // - Sottomissione lavoro batch
011700090617      /copy gaitrasrc/srcprotopr,BCH10
011800090617
011900090617       // - Richiamo diretto della procedura batch
012000090617     d tisiJ1r         pr                  extpgm('TISIJ1R')
012100090617     d   kpjba                             likeds(KPJBA)
012200090617
012300090617       //--------------------------------------------------------------
012400090617       //?Definizione key-list.                                        ?
012500090617       //--------------------------------------------------------------
012600090617
012700090617
012800090617       //--------------------------------------------------------------
012900090617       //?Riepilogo indicatori utilizzati.                             ?
013000090617       //--------------------------------------------------------------
013100090617       //--------------------------------------------------------------
013200090617
013300090617       //--------------------------------------------------------------
013400090617       //?M A I N - L I N E                                            ?
013500090617       //--------------------------------------------------------------
013600090617
013700090617     c     *Entry        plist
013800090617     c                   parm                    KPJBA
013900090617
014000090617      /free
014100090617
014200090617       //?Operazioni iniziali?
014300090617       exsr  sr_RoutInz;
014400090617
014500090617       //?Gestione video?
014600090617       DOW  $Fine = *off;
014700090617         select;
014800090617           // - Richiesta dei dati in stampa
014900090617           when  $Video = 'D1';
015000090617             exsr  sr_GesD01;
015100090617           other;
015200090617             $Fine = *on;
015300090617         endsl;
015400090617       ENDDO;
015500090617
015600090617       //?Operazioni finali?
015700090617       exsr  sr_RoutEnd;
015800090617
015900090617       //--------------------------------------------------------------
016000090617       //?Operazioni iniziali.                                         ?
016100090617       //--------------------------------------------------------------
016200090617       BEGSR  sr_RoutInz;
016300090617
016400090617         *inLR = *on;
016500090617
016600090617         //?Impostazione campi "fissi"?
016700090617         V1Cpgm = SDSpgm;
016800090617
016900090617         //?Reperimento dati job?
017000090617         exsr  sr_DatiJob;
017100090617
017200090617       ENDSR;
017300090617
017400090617       //--------------------------------------------------------------
017500090617       //?Reperimento Dati del job (Utente/Operativi).                 ?
017600090617       //--------------------------------------------------------------
017700090617       BEGSR  sr_DatiJob;
017800090617
017900090617         in(E) §AzUte;
018000090617         if NOT %error;
018100090617           in(E) §DatiUte;
018200090617         endif;
018300090617         if %error or RSut = *blanks;
018400090617           clear TIBS34ds;
018500090617           tibs34r ( tibs34ds );
018600090617           in §AzUte;
018700090617           in §DatiUte;
018800090617         endif;
018900090617
019000090617       ENDSR;
019100090617
019200090617       //--------------------------------------------------------------
019300090617       //?Gestione videata D01                                         ?
019400090617       //--------------------------------------------------------------
019500090617       BEGSR  sr_GesD01;
019600090617
019700090617         //?Inizializzazione videata?
019800090617         if  $InzD01 = *on;
019900090617           exsr  sr_InzD01;
020000090617           $InzD01 = *off;
020100090617         endif;
020200090617
020300090617         //?Emissione videata?
020400090617         write SIJ0T01;
020500090617         exfmt SIJ0D01;
020600090617
020700090617         reset ErrMessage;
020800090617         reset ErrGenerico;
020900090617         clear V1Dmsg;
021000090617
021100090617         SELECT;
021200090617
021300090617           //?F3=Fine?
021400090617           WHEN  dsp_aid = c_F03;
021500090617             $Fine = *on;
021600090617
021700090617           //?Invio / F6=Conferma?
021800090617           OTHER;
021900090617             exsr sr_CtrD01;
022000090617             if  ErrGenerico = *off   and   dsp_aid = c_F06;
022100090617               exsr  sr_SbmJob;
022200090617               $Fine = *on;
022300090617             endif;
022400090617
022500090617         ENDSL;
022600090617
022700090617       ENDSR;
022800090617
022900090617       //--------------------------------------------------------------
023000090617       //?Inizializzazione videata D01                                 ?
023100090617       //--------------------------------------------------------------
023200090617       BEGSR  sr_InzD01;
023300090617
023400090617         clear  SIJ0D01;
023500090617
023600090617         //?Test AS/400?
023700090617         if  %subst(KNSIF : 7 : 1) = 'P';
023800090617           ErrMessage  = *on;
023900090617           ErrGenerico = *on;
024000090617           V1Dmsg      = sk_Msg(01);
024100090617           $Fine       = *on;
024200090617           leavesr;
024300090617         endif;
024400090617
024500090617       ENDSR;
024600090617
024700090617       //--------------------------------------------------------------
024800090617       //?Controllo dati immessi nella videata D01                     ?
024900090617       //--------------------------------------------------------------
025000090617       BEGSR  sr_CtrD01;
025100090617
025200090617         %subst(IndDspF : 50) = *off;
025300090617
025400090617         //?Test AS/400?
025500090617         if  %subst(KNSIF : 7 : 1) = 'P';
025600090617           ErrMessage  = *on;
025700090617           ErrGenerico = *on;
025800090617           V1Dmsg      = sk_Msg(01);
025900090617           $Fine       = *on;
026000090617           leavesr;
026100090617         endif;
026200090617
026300090617         //?Versione Cappario?
026400090617         select;
026500090617           when  V1Cver =  *zero;
026600090617             ErrMessage  = *on;
026700090617             ErrGenerico = *on;
026800090617             PosCurVER   = *on;
026900090617             V1Dmsg      = sk_Msg(02);
027000090617             leavesr;
027100090617           when  V1Cver <  *zero;
027200090617             ErrMessage  = *on;
027300090617             ErrGenerico = *on;
027400090617             PosCurVER   = *on;
027500090617             V1Dmsg      = sk_Msg(03);
027600090617             leavesr;
027700090617         endsl;
027800090617
027900090617         //?Nome file?
028000090617         if  V1Cpf  <> *blank   and
028100090617             %lookup(V1Cpf : sk_File) = *zero;
028200090617           ErrMessage  = *on;
028300090617           ErrGenerico = *on;
028400090617           PosCurPF    = *on;
028500090617           V1Dmsg      = sk_Msg(04);
028600090617           leavesr;
028700090617         endif;
028800090617
028900090617       ENDSR;
029000090617
029100090617       //--------------------------------------------------------------
029200090617       //?Sottomissione lavoro batch                                   ?
029300090617       //--------------------------------------------------------------
029400090617       BEGSR  sr_SbmJob;
029500090617
029600090617         clear TISIJ1ds;
029700090617         ISIJ1ver  = V1Cver;
029800090617         ISIJ1file = V1Cpf;
029900091204         ISIJ1pwd  = V1Cpwd;
030000090617
030100090617         kpjbu = TISIJ1ds;
030200090617         kcoaz = 'SIJ1';
030300090617
030400090617         if  knmus = *all'1';
030500090617           TISIJ1R ( kpjba );
030600090617         else;
030700090617           BCH10 ( kpjba );
030800090617         endif;
030900090617
031000090617       ENDSR;
031100090617
031200090617       //--------------------------------------------------------------
031300090617       //?Operazioni finali.                                           ?
031400090617       //--------------------------------------------------------------
031500090617       BEGSR  sr_RoutEnd;
031600090617
031700090617         //?"Chiusura" pgm?
031800090617         return;
031900090617
032000090617       ENDSR;
032100090617
032200090617      /end-free
032300090617
032400090617       //--------------------------------------------------------------
032500090617       //?Definizione schiere a tempo di compilazione                  ?
032600090617       //--------------------------------------------------------------
032700090617
032800090617** - sk_File
032900090617AZCAE00F    1
033000090617AZCPC00F    2
033100090617AZCPE00F    3
033200090617AZCPL00F    4
033300090617AZCPR00F    5
033400090617AZCPS00F    6
033500090618AZCPP00F    7
033600090618AZCPT00F    8
033700090618            9  AZCPV00F
033800090618AZCAS00F   10
033900090618AZCEP00F   11
034000090618AZCLN00F   12
034100090617** > sk_Msg -----------------------------------------------------------------*
034200090617Funzione eseguibile SOLO su SETRAS! Premere Invio per uscire dal programma     1
034300090617Versione cappario obbligatoria                                                 2
034400090617Versione cappario errata (negativa)                                            3
034500090617Nome singolo archivio NON tra quelli elaborabili                               4
