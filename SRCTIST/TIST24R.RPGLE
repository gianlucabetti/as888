000100080206      //--------------------------------------------------------------
000200110117      //?TIST24R - Report Commerciale    - Parte 3^
000300080206      //--------------------------------------------------------------
000400080206
000500090407     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600090807     h dftactgrp(*no) actgrp(*caller)
000700080206
000800080206      //---------------------------------------------------------------
000900080206      //?Dichiarazione file.
001000080206      //---------------------------------------------------------------
001100110128     fWFRCA00F  if   e             disk
001200110117     fWFREP11L  uf   e           k disk
001300100310
001400080206      //---------------------------------------------------------------
001500090406      //?Definizione costanti.
001600080206      //---------------------------------------------------------------
001700080207
001800080206
001900080206      //---------------------------------------------------------------
002000080206      //?Definizione schiere.
002100080206      //---------------------------------------------------------------
002200100519
002300080206      //---------------------------------------------------------------
002400080206      //?Definizione aree dati.
002500080206      //---------------------------------------------------------------
002600100423
002700110127      // - Dati utente
002800110127     d §AzUte        e ds                  extname(AZUTE00F)
002900110127     d                                     dtaara
003000110127     d §DatiUte      e ds                  extname(dDatiUte)
003100110127     d                                     dtaara
003200080206
003300080206      //---------------------------------------------------------------
003400080206      //?Definizione strutture dati.
003500080206      //---------------------------------------------------------------
003600100310
003700100310     d PrtINFO         ds
003800100310     d  CurLine              367    368i 0
003900080206
004000110127     d Save_Kpjbu      ds
004100110127     d  Periodo_iniz           1      6  0
004200110128     d  Anno                   1      4  0
004300110128     d  Mese                   5      6  0
004400110127     d  Periodo_fine           7     12  0
004500110127     d
004600080206      // - Status
004700080206     d Psds           sds
004800080206     d   SDSpgm          *proc
004900080206
005000080206      // - Parametri ricevuti
005100080206     d KPJBA         e ds
005200100423     d Trmk88DS      e ds
005300090629
005400110127      // - Reperimento dati utente
005500110127     d TIBS34DS      e ds
005600110127
005700110128     d Rcanrawpfds     ds
005800110128     d   $NRAPF                       5s 0 inz  dim(30)
005900110128
006000110128     d Rcanrawptds     ds
006100110128     d   $NRAPT                       5s 0 inz  dim(30)
006200110128
006300110128     d Rcanrawcfds     ds
006400110128     d   $NRACF                       5s 0 inz  dim(30)
006500110128
006600110128     d Rcanrawctds     ds
006700110128     d   $NRACT                       5s 0 inz  dim(30)
006800110128
006900080206      //---------------------------------------------------------------
007000080206      //?Definizione variabili globali.
007100080206      //---------------------------------------------------------------
007200080206
007300080206      // - Flags booleani
007400100305     d $End            s               n   inz(*off)
007500100325
007600100325      // - Indici di schiera
007700080206
007800090401      // - Campi di comodo data
007900100305     d wDate_EUR       s               d   datfmt(*eur)
008000100305     d wDate_ISO       s               d   datfmt(*iso)
008100100305
008200100305      // - Campi di comodo
008300100519     d watcoii         s              6  0 inz
008400100519     d watcofi         s              6  0 inz
008500110128
008600110128      // - Campi di totale
008700110128     d totteles        s              9  0 inz
008800110128     d totatpf         s              8  0 inz
008900110128     d totatcf         s              8  0 inz
009000110128     d totatpt         s              8  0 inz
009100110128     d totatct         s              8  0 inz
009200110128     d tottepo         s              8  0 inz
009300110128     d tottepc         s              8  0 inz
009400110128     d tottepv         s              8  0 inz
009500110128     d totpcc          s              8  0 inz
009600110128     d totiatp         s              8  0 inz
009700100325
009800090508      //---------------------------------------------------------------
009900090807      //?Definizione procedure esterne.
010000090508      //---------------------------------------------------------------
010100100120
010200100120
010300100120      //---------------------------------------------------------------
010400100120      //?prototipi
010500100120      //---------------------------------------------------------------
010600090807
010700110127      /copy gaitrasrc/srcprotopr,tibs34r
010800110127
010900110127      // - file di lavoro reportistica attività commerciali
011000110127     d trmk88r         pr                  extpgm('TRMK88R')
011100110127     d  kpjba                              likeds(KPJBA)
011200110127
011300080206      //---------------------------------------------------------------
011400080206      //?Definizione key-list.
011500080206      //---------------------------------------------------------------
011600100325
011700080206
011800080206      //---------------------------------------------------------------
011900080206      //?Riepilogo indicatori.
012000080206      //---------------------------------------------------------------
012100100326
012200090807
012300080206      //---------------------------------------------------------------
012400080206
012500080206      //---------------------------------------------------------------
012600080206      //?M A I N - L I N E
012700080206      //---------------------------------------------------------------
012800080206
012900080206     c     *Entry        plist
013000080206     c                   parm                    KPJBA
013100080206
013200080206      /free
013300080206
013400090807       //?Operazioni iniziali
013500080206       exsr RoutInz;
013600100325
013700110128       //?Ciclo di aggiornamento dati sul WFREP
013800110128       exsr Agg_wfrep ;
013900100324
014000100325
014100090807       //?Operazioni finali
014200080206       exsr RoutEnd;
014300080206
014400080206       //--------------------------------------------------------------
014500080206       //?Operazioni iniziali.
014600080206       //--------------------------------------------------------------
014700080206       BEGSR RoutInz;
014800100329
014900110127         //?mi salvo la kpjbu
015000110127         save_kpjbu = kpjbu ;
015100100329         //?Imposto la ds con i dati della KPJBU
015200110127         clear trmk88ds  ;
015300110127         i88tcpe = 'C' ;
015400110127         i88deci = (Periodo_iniz * 100) ;
015500110127         i88decf = (Periodo_fine * 100) + 31 ;
015600110127
015700110127         clear kpjbu ;
015800110127         kpjbu = trmk88ds ;
015900110127         trmk88r (kpjba) ;
016000110127
016100110127         //?ripristino la vecchia kpjbu
016200110127         kpjbu = save_kpjbu ;
016300090807
016400090807         //?Reperimento dati job
016500090807         exsr DatiJob;
016600100610
016700080206       ENDSR;
016800110127
016900080206       //--------------------------------------------------------------
017000080206       //?Reperimento Dati del job (Utente/Operativi).
017100080206       //--------------------------------------------------------------
017200080206       BEGSR DatiJob;
017300080206
017400080206         in(E) §AzUte;
017500080206         if NOT %error;
017600080206           in(E) §DatiUte;
017700080206         endif;
017800080206         if %error or RSut = *blanks;
017900080206           clear TIBS34ds;
018000080206           tibs34r(tibs34ds);
018100080206           in §AzUte;
018200080206           in §DatiUte;
018300080206         endif;
018400100325
018500080206       ENDSR;
018600110128
018700110128       //--------------------------------------------------------------
018800110128       //?Aggiornamento WFREP00F
018900110128       //--------------------------------------------------------------
019000110128       BEGSR Agg_Wfrep ;
019100110128
019200110128         //?leggo il WFRCA00F
019300110128         Read Wfrca00f ;
019400110128         Dow not %eof(Wfrca00f) ;
019500110128             chain (RcaDiv:RcaAre:RcaFil:RcaRgf:Anno:Mese) Wfrep11l ;
019600110128             If %found(wfrep11l) ;
019700110519                repptr = Rcatelese;
019800110128                repmai = Rcaapptn ;
019900110128                update wfrep000 ;
020000110128             endif ;
020100110128             Read Wfrca00f ;
020200110128         Enddo ;
020300110128
020400110128       ENDSR ;
020500080206       //--------------------------------------------------------------
020600080206       //?Operazioni finali.
020700080206       //--------------------------------------------------------------
020800080206       BEGSR RoutEnd;
020900090521
021000080206         *inLR = *on;
021100080206         return;
021200080206
021300080206       ENDSR;
021400080206
021500080206      /end-free
