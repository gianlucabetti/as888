000100030325     H DECEDIT('0.') DATEDIT(*DMY.)
000200090323     H DFTACTGRP(*NO) ACTGRP(*CALLER)
000300991027
000400041015     FTNTBE01L  IF   E           K DISK
000500031103     FTITAS30C  IF   E           K DISK
000600090323     FTISTB02L  UF   E           K DISK    commit
000700090323     FTIVAWWWT  UF A E             DISK    commit
000800031103
000900031103     D*-----------
001000031103     D* SCHIERE A PROGRAMMA
001100031103     D*-----------
001200080618     D CAUBAR          S             10    DIM(90) CTDATA PERRCD(1)
001300080618     D CAUCLI          S             11    DIM(90) CTDATA PERRCD(1)
001400080618     D DESCLI          S             80    DIM(90) CTDATA PERRCD(1)
001500091222     D WDCTBAR         S              1    DIM(4)  CTDATA PERRCD(1)
001600091222     D WDCTCLI         S             10    DIM(4)  CTDATA PERRCD(1)
001700041015
001800041015     D*-----------
001900041015     D* SCHIERE
002000041015     D*-----------
002100041015     D skTADCod        S              2    DIM(500)
002200041015     D skTADRag        S              1    DIM(500)
002300041015     D jTAD            S              3  0 INZ(*zeros)
002400030924
002500041015     D*-----------
002600041015     D* VARIABILI D WRK
002700041015     D*-----------
002800031103     D prmppi          S             50
002900030924     D prmesito        S              1
003000030924     D wrkesito        S                   like(prmesito)
003100031103     D j               S              2  0
003200041015     D wTADCod         S              2
003300041015
003400041015     D*-----------
003500041015     D* DEFINIZIONE DS ESTERNE
003600041015     D*-----------
003700041015     D DTAD          E DS
003800031103
003900031103     D*-----------
004000031103     D* VARIABILI RIFERITE AL DATA-BASE
004100031103     D*-----------
004200080618     D wKstbKSU        S                   like(stbKSU)
004300080618     D wKstbFTR        S                   like(stbFTR)
004400030924
004500030924     D*-----------
004600030924     D* DEFINISCO LA DS DELLA STRUTTURA DELL'ARCHIVIO FATTURE DEL CLIENTE
004700030924     D*-----------
004800030925     D C_DS_Cli        DS
004900080618     D  C_NumSpedCli                 11    INZ(*blanks)
005000080618     D  C_RifInternaz                12    INZ(*blanks)
005100080618     D  C_NumSpedCorr                 9    INZ(*blanks)
005200080618     D  C_DataSped                    8    INZ(*blanks)
005300080618     D  C_DataEvento                  8    INZ(*blanks)
005400080618     D  C_EsitoCons                   1    INZ(*blanks)
005500080618     D  C_NumGiac                     6    INZ(*blanks)
005600080618     D  C_Firma                      20    INZ(*blanks)
005700080618     D  C_OraCons                     4    INZ(*blanks)
005800080618     D  C_CodEvento                   2    INZ(*blanks)
005900080618     D  C_DesEvento                  80    INZ(*blanks)
006000031103
006100031103     D*-----------
006200031103     D* RIDEFINIZIONE DATA BOLLA IN FORMATO ALFA
006300031103     D*-----------
006400031103     D                 DS
006500080618     D  dataAAS                1      4
006600080618     D  dataMGS                5      8
006700080618     D  dataMM                 5      6
006800080618     D  dataGG                 7      8
006900080618     D DS_DATA                 1      8
007000031103
007100031103     D*-----------
007200031103     D* RIDEFINIZIONE PARAMETRI "POST-TRADUZIONE"
007300031103     D*-----------
007400031103     D DSPPI           DS
007500080618     D  w§PPIKSU                      7  0
007600031103
007700031103     D*------------------
007800031103     D* DS "XSRDA8" - CONTROLLA DATA (8)
007900031103     D*------------------
008000031103     D WLBDA8          DS                  INZ
008100031103     D  G08DAT                 1      8  0
008200031103     D  G08INV                 9     16  0
008300031103     D  G08ERR                17     17
008400031103     D  G08TGI                18     22  0
008500030924
008600030325
008700030924     C* MAIN/
008800041015     C*
008900041015     C* Carica i dati tabellati
009000041015     C                   EXSR      cartab
009100041015     C*
009200041015     C* Esegue traduzione
009300991027     C                   EXSR      traduci
009400921023     C                   SETON                                        LR
009500041015
009600041015
009700041015
009800041015     C     cartab        BEGSR
009900041015     C*
010000041015     C* Caricamento tipi anomalia C/A
010100041015     C     'TAD'         SETLL     tntbe01l
010200041015     C                   IF        %equal(tntbe01l)
010300041015     C     'TAD'         READE     tntbe01l
010400041015     C                   DOW       not %eof(tntbe01l)
010500041015     C                   EVAL      DTAD = tbeUNI
010600041015     C                   ADD       1             jTAD
010700041015     C                   EVAL      skTADCod(jTAD) = tbeKE1
010800041015     C                   EVAL      skTADRag(jTAD) = §TADRAGR
010900041015     C     'TAD'         READE     tntbe01l
011000041015     C                   ENDDO
011100041015     C                   ENDIF
011200041015     C*
011300041015     C                   ENDSR
011400991027
011500030924
011600030924
011700991027     C     traduci       BEGSR
011800031103     C*
011900031103     C* Elaboro gli stati bolla ancora nn trasmessi al cliente, del cliente ricevuto nei parametri
012000031103     C* di traduzione (trattasi d "post-traduzione")
012100031104     C                   EVAL      wKstbKSU = w§PPIKSU
012200031103     C                   EVAL      wKstbFTR = *blanks
012300031103     C     KEYstb02P     SETLL     tistb02l
012400031103     C                   IF        %equal(tistb02l)
012500031103     C     KEYstb02P     READE     tistb02l
012600991027     C*
012700031103     C* Ciclo x tuttii record del cliente da trasmettere
012800031103     C                   DOW       not %eof(tistb02l)
012900031014     C*
013000030925     C* Inizializzo la DS d output con i valori di default della dichiarazione della struttura dati
013100031014     C                   RESET                   C_DS_Cli
013200080618     C*
013300080618     C                   SETON                                        50
013400031103     C*
013500031103     C* Effettuo le dovute considerazioni sullo stato della bolla in relazione all'output che si
013600031103     C* deve restituire al cliente nel file tradotto
013700031103     C                   IF        stbFTR = *blanks                             * ridondante
013800031103     C*
013900031103     C* Innanzitutto chaino la bolla direttamente su TITAS
014000031103     C     KEYtas30P     CHAIN     titas30c
014100031103     C                   IF        %found(titas30c)
014200031103     C*
014300080618     C* Gestisco solamente gli stati standard
014400080618     C                   IF        stbTIS = '1'
014500080618     C*
014600080618     C                   SETOFF                                       50
014700080618     C*
014800080618     C* Effettuo l'abbinamento tra causali Bartolini e causali cliente
014900031103     C                   Z-ADD     1             j
015000031103     C     stbCOS        LOOKUP    CAUBAR(j)                              55
015100080618     C                   IF        %found AND CAUCLI(j) <> 'NON INVIARE'
015200080618     C                   IF        CAUCLI(j) <> '*'
015300080618     C                   EVAL      C_CodEvento = CAUCLI(j)
015400080618     C                   EVAL      C_DesEvento = DESCLI(j)
015500080618     C                   ENDIF
015600031103     C                   ELSE
015700031103     C                   SETON                                        50
015800031103     C                   ENDIF
015900080618     C                   ENDIF
016000041015     C*
016100080618     C* X stati provenienti dai danni, se trattasi d tipi anomalia 'A' o 'M' o 'V'
016200080618     C                   IF        stbPRS =  '5'
016300080618     C*
016400080618     C                   SETOFF                                       50
016500080618     C*
016600080901     C* Effettuo l'abbinamento tra causali Bartolini e causali cliente
016700080618     C                   Z-ADD     1             jTAD
016800080618     C                   MOVEL(P)  stbCOS        wTADCod
016900080618     C     wTADCod       LOOKUP    skTADCod(jTAD)                         70
017000080618     C                   IF        %found
017100080618     C                   Z-ADD     1             j
017200080618     C     skTADRag(jTAD)LOOKUP    WDCTBAR(j)                             70
017300080618     C                   IF        %found
017400080618     C                   EVAL      C_CodEvento = WDCTCLI(j)
017500080618     C                   ELSE
017600080618     C                   SETON                                        50
017700080618     C                   ENDIF
017800080618     C                   ELSE
017900080618     C                   SETON                                        50
018000080618     C                   ENDIF
018100080618     C                   ENDIF
018200080618     C*
018300080618     C* Scarico il buffer d output
018400080618     C  N50              EXSR      WRIREC
018500031103     C*
018600031103     C* Aggiorno il flag d trasmissione a 'T'=TRASMESSO
018700031103     C                   EVAL      stbFTR = 'T'
018800031103     C                   UPDATE    tistb000
018900041015     C                   ENDIF
019000080618     C                   ENDIF
019100991027     C*
019200031103     C     KEYstb02P     READE     tistb02l
019300031103     C                   SETOFF                                       50
019400030325     C                   ENDDO
019500031103     C                   ENDIF
019600991027     C*
019700030325     C                   EVAL      wrkesito = '0'
019800991027     C*
019900910830     C                   ENDSR
020000031103
020100031103
020200031103
020300080618     C     wrirec        BEGSR
020400031103     C*
020500080618     C                   EVAL      C_NumSpedCli   = '0' + %trim(STBRMA)
020600080620     C     ' ':'0'       XLATE     C_NumSpedCli  C_NumSpedCli
020700080620     C                   EVAL      C_RifInternaz  = *all'0'
020800080620     C                   EVAL      C_NumSpedCorr  = *all'0'
020900080618     C                   MOVEL(P)  TASAAS        DS_DATA
021000080618     C                   MOVE      TASMGS        DS_DATA
021100080618     C                   EVAL      C_DataSped     = dataGG+dataMM+dataAAS
021200080618     C                   MOVEL(P)  STBDAS        DS_DATA
021300080618     C                   EVAL      C_DataEvento   = dataGG+dataMM+dataAAS
021400080618     C                   IF        %trim(STBCOS)  = 'CONSOK'
021500080618     C                   EVAL      C_EsitoCons    = 'S'
021600080618     C                   MOVE(P)   STBORS        C_OraCons
021700080618     C                   ELSE
021800080618     C                   EVAL      C_EsitoCons    = 'N'
021900080618     C                   EVAL      C_CodEvento    = C_CodEvento
022000080618     C                   EVAL      C_DesEvento    = C_DesEvento
022100080618     C                   ENDIF
022200080620     C                   MOVE      '.'           C_DesEvento
022300080620     C                   EVAL      C_NumGiac      = *all'0'
022400080618     C                   EVALR     C_Firma        = '0'
022500031103     C*
022600031103     C* Scarico il buffer della DS cliente nel campo dati del flat-file ASCII e scrivo
022700031103     C                   EVAL      VAWDTA = C_DS_Cli
022800031103     C                   WRITE     TIVAW000
022900031103     C*
023000031103     C                   ENDSR
023100031103
023200031103
023300991027
023400991027      /TITLE Operazioni iniziali.
023500991027     C     *inzsr        BEGSR
023600991027     C*
023700991027     C     *ENTRY        PLIST
023800031103     C                   parm                    prmppi
023900991027     C     wrkesito      parm      wrkesito      prmesito
024000031103     C*
024100031103     C* Ridefinisco subito i parametri d "post-traduzione" ricevuti in input
024200031103     C                   EVAL      DSPPI = prmppi
024300031103     C*
024400031103     C* Calcola la data corrente
024500031103     C                   time                    wn14             14 0
024600031103     C                   move      wn14          wn8               8 0          *DATA (8) IN G/M/AA
024700031103     C                   z-add     wn8           g08dat
024800031103     C                   z-add     *zeros        g08inv
024900031103     C                   movel     '0'           g08err
025000031103     C                   call      'XSRDA8'
025100031103     C                   parm                    wlbda8
025200031103     C                   z-add     g08inv        datcor            8 0          *DATA CORRENTE AA/M/
025300030709     C*
025400030709     C* Definizione chiavi
025500030924     C*
025600031103     C* Chiave su TISTB02L - Parziale
025700031103     C     KEYstb02P     KLIST
025800031104     C                   KFLD                    wKstbKSU
025900031103     C                   KFLD                    wKstbFTR
026000031103     C*
026100031103     C* Chiave su TITAS30C - Parziale
026200031103     C     KEYtas30P     KLIST
026300031103     C                   KFLD                    stbAAS
026400031103     C                   KFLD                    stbLNP
026500031103     C                   KFLD                    stbNRS
026600031103     C                   KFLD                    stbNSP
026700991027     C*
026800991027     C                   ENDSR
026900031103** CAUBAR - CAUSALI BARTOLINI
027000080618A
027100080618ARS
027200080618AVV
027300080618AV2
027400080618AV3
027500080618AV5
027600080618AV7
027700080618AV9
027800080618A16
027900080618A23
028000080618CPO
028100080618DAN
028200080618DIR
028300080618F
028400080618G
028500080618GEN
028600080618G02
028700080618G03
028800080618G05
028900080618G09
029000080618IDD
029100080618MAN
029200080618MIC
029300080618N
029400080618NAV
029500080618NIC
029600080618P
029700080618PAT
029800080618R
029900080618RDC
030000080618RFD
030100080618RFM
030200080618RIC
030300080618RIP
030400080618RS
030500080618T
030600080618WA
030700080618WAE
030800080618WM
030900080618WME
031000080618WV
031100080618WVE
031200080618ZAL
031300080618ZBS
031400080618ZFR
031500080618ZMM
031600080618ZMP
031700080618ZNV
031800080618ZSC
031900080618001
032000080618002
032100080618003
032200080618004
032300080618005
032400080618006
032500080618007
032600080618008
032700080618009
032800080618010
032900080618012
033000080618013
033100080618014
033200080618016
033300080618017
033400080618018
033500080618019
033600080618020
033700080618021
033800080618022
033900080618023
034000080618024
034100080618025
034200080618026
034300080618027
034400080618028
034500080618029
034600080618030
034700080618031
034800080618032
034900080618033
035000080618034
035100080618035
035200080618036
035300080618037
035400080618100
035500080618101
035600080618999
035700080618CONSOK
035800080618RESO
035900080618
036000080901** CAUCLI - CAUSALI CLIENTE
0361000806181
0362000806181
0363000806181
0364000806187
0365000806187
0366000806187
0367000806187
0368000806187
0369000806181
0370000806181
037100080618NON INVIARE
03720008061824
03730008061816
03740008061812
037500080618NON INVIARE
037600080618NON INVIARE
037700080618NON INVIARE
037800080618NON INVIARE
037900080618NON INVIARE
038000080618NON INVIARE
038100080618NON INVIARE
03820008061825
038300080618NON INVIARE
038400080618NON INVIARE
03850008061824
038600080618NON INVIARE
038700080618NON INVIARE
038800080618NON INVIARE
038900080618NON INVIARE
039000080618NON INVIARE
0391000806184
0392000806184
0393000806181
039400080618NON INVIARE
039500080618NON INVIARE
0396000806188
03970008061825
03980008061827
03990008061825
04000008061827
04010008061824
04020008061824
040300080618NON INVIARE
04040008061831
0405000806189
040600080618NON INVIARE
04070008061819
040800080618NON INVIARE
04090008061821
0410000806184
0411000806184
0412000806184
0413000806184
0414000806184
0415000806184
0416000806184
0417000806185
0418000806184
04190008061837
0420000806184
0421000806184
0422000806184
04230008061814
0424000806184
0425000806184
04260008061859
0427000806183
0428000806182
0429000806182
0430000806186
0431000806186
0432000806184
0433000806184
0434000806184
0435000806184
0436000806184
0437000806184
0438000806184
04390008061810
0440000806184
0441000806184
0442000806184
0443000806184
0444000806184
04450008061838
04460008061838
0447000806184
044800080618*
04490008061829
045000080618
045100080901** DESCLI - DESCRIZIONI CAUSALI CLIENTE
045200080618ASSENTE AL PRIMO PASSAGGIO
045300080618ASSENTE AL PRIMO PASSAGGIO
045400080618ASSENTE AL PRIMO PASSAGGIO
045500080618ASSENTE AL SECONDO PASSAGGIO
045600080618ASSENTE AL SECONDO PASSAGGIO
045700080618ASSENTE AL SECONDO PASSAGGIO
045800080618ASSENTE AL SECONDO PASSAGGIO
045900080618ASSENTE AL SECONDO PASSAGGIO
046000080618ASSENTE AL PRIMO PASSAGGIO
046100080618ASSENTE AL PRIMO PASSAGGIO
046200080618-
046300080618COLLO SCONDIZIONATO
046400080618INOLTRO AD ALTRA SEDE
046500080618RICHIESTO FERMO DEPOSITO
046600080618-
046700080618-
046800080618-
046900080618-
047000080618-
047100080618-
047200080618-
047300080618MANCA COLLO 1 AVVISO
047400080618-
047500080618-
047600080618COLLO SCONDIZIONATO
047700080618-
047800080618-
047900080618-
048000080618-
048100080618-
048200080618RIFIUTATO
048300080618RIFIUTATO
048400080618ASSENTE AL PRIMO PASSAGGIO
048500080618-
048600080618-
048700080618CHIUSO PER TURNO
048800080618MANCA COLLO 1 AVVISO
048900080618CONFERMA MANCANZA
049000080618MANCA COLLO 1 AVVISO
049100080618CONFERMA MANCANZA
049200080618COLLO SCONDIZIONATO
049300080618COLLO SCONDIZIONATO
049400080618-
049500080618INCIDENTE SUL PERCORSO
049600080618FESTIVITA' PATRONALE
049700080618-
049800080618IMPRATICBILITA' STRADE
049900080618-
050000080618MANIFESTAZIONI
050100080618RIFIUTATO
050200080618RIFIUTATO
050300080618RIFIUTATO
050400080618RIFIUTATO
050500080618RIFIUTATO
050600080618RIFIUTATO
050700080618RIFIUTATO
050800080618IMPORTO NON DISPONIBILE
050900080618RIFIUTATO
051000080618MANCANO ISTRUZIONI X INCASSO CONTRASSEGNO
051100080618RIFIUTATO
051200080618RIFIUTATO
051300080618RIFIUTATO
051400080618CONSEGNA CONCORDATA IL
051500080618RIFIUTATO
051600080618RIFIUTATO
051700080618CESSATA ATTIVITA'
051800080618TRASFERITO
051900080618SCONOSCIUTO INDIRIZZO ERRATO
052000080618SCONOSCIUTO INDIRIZZO ERRATO
052100080618CHIUSO PER FERIE
052200080618CHIUSO PER FERIE
052300080618RIFIUTATO
052400080618RIFIUTATO
052500080618RIFIUTATO
052600080618RIFIUTATO
052700080618RIFIUTATO
052800080618RIFIUTATO
052900080618RIFIUTATO
053000080618FERMO DEPOSITO NON RITIRATO
053100080618RIFIUTATO
053200080618RIFIUTATO
053300080618RIFIUTATO
053400080618RIFIUTATO
053500080618RIFIUTATO
053600080618CONSEGNA PROGRAMMATA
053700080618CONSEGNA PROGRAMMATA
053800080618RIFIUTATO
053900080618-
054000080618-
054100080618
054200041015** WDCTBAR - TIPI ANOMALIE C/A BARTOLINI
054300041015A
054400041015M
054500041015V
054600091222E
054700080901** WDCTCLI - CAUSALI CLIENTE
05480008061827
05490008061825
05500008061839
055100091222
