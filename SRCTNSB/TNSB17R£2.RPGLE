000100040511     h Decedit('0,') Datedit(*YMD.) Option(*nodebugio)
000200040511
000300040511      *------------------------------------------------------------------------*
000400050318      * Creazione bolle per addebito invio immagini a CLI
000500040511      *------------------------------------------------------------------------*
000600090303     ftilac02l  uf   e           k disk
000700090303     ffnrig00f  o    e             disk
000800040511      *------------------------------------------------------------------------*
000900040511      *   V A R I A B I L I
001000040511      *------------------------------------------------------------------------*
001100090303     d kela            s                   like(lacela)
001200050318     d wora            s              6  0
001300050318     d woggi           s              8  0
001400090303     d xx              s              2  0
001500090303     d s_lacela        s              3
001600090303     d $fine           s               n
001700050318      *------------------------------------------------------------------------*
001800050318      *   D S   I N T E R N E / E S T E R N E
001900050318      *------------------------------------------------------------------------*
002000050331     d kpjba         E DS
002100040511      *------------------------------------------------------------------------*
002200040511      *  RIEPILOGO INDICATORI
002300040511      *------------------------------------------------------------------------*
002400040511
002500040511      *------------------------------------------------------------------------*
002600090303
002700090303      /free
002800090303
002900090303       //?ciclo per lacela
003000090303        xx = 1;
003100090303        for xx by 1 to 9;
003200090303
003300090303          $fine = *off;
003400090303          kela = %editc(xx:'X');
003500090303
003600090303       //?leggo tilac00f
003700090303          setll kela tilac02l;
003800090303          dow not $fine;
003900090303            reade kela tilac02l;
004000090303       //?fine file
004100090303            if %eof(tilac02l);
004200090303              $fine = *on;
004300090303              leave;
004400090303            endif;
004500090303       //?se devo creare addebito scrivo FNRIG00F
004600090303            if lactad <> 'N';
004700090303              exsr wrtrig;
004800090303            endif;
004900090303       //?aggiorno il rcd di TILAC sempre
005000090303            exsr agglac;
005100090303          enddo;
005200090303
005300090303        endfor;
005400090303
005500090303      /end-free
005600040511
005700040511     c                   Eval      *InLr = *On
005800040511
005900040511      *------------------------------------------------------------------------*
006000040511      * Routine iniziale
006100040511      *------------------------------------------------------------------------*
006200040511     c     *Inzsr        BegSr
006300090303
006400090303     c     *entry        plist
006500090303     c                   parm                    kpjba
006600090303      * data/ora del job
006700090303     c                   Z-add     *date         woggi
006800090303     c                   Time                    wora
006900090303
007000040511     c                   EndSr
007100090303
007200050318      *------------------------------------------------------------------------*
007300090127      * Scrittura fnrig per addebito spese invio immagini
007400050318      *------------------------------------------------------------------------*
007500050318     c     wrtrig        BegSr
007600090127
007700090127     c                   clear                   fnrig000
007800050318     c                   z-add     2000          rigaas
007900050318     c                   move      lacaas        rigaas
008000050318     c                   movel     laclnp        riglnp
008100050318     c                   movel     lacnrs        rignrs
008200050318     c                   movel     lacnsp        rignsp
008300090312     c                   movel     'P'           rigcau
008400090303     c                   if        lactad = 'S'
008500090127     c                   eval      rigtas = 'T'
008600060419     c                   endif
008700090303     c                   if        lactad = 'V'
008800090127     c                   eval      rigtas = 'N'
008900060419     c                   endif
009000090303     c                   eval      rigncl = 1
009100090127     c                   movel     'N'           rigtra
009200090127     c                   movel     laclnp        rigfil
009300090127     c                   movel     'TILAC'       rigpru
009400090127     c                   z-add     woggi         rigdata
009500090127     c                   movel     wora          rigora
009600090127     c                   write     fnrig000
009700090303
009800050318     c                   endsr
009900090303      *------------------------------------------------------------------------*
010000090303      * Aggiorno tilac00f
010100090303      *------------------------------------------------------------------------*
010200090303     c     agglac        BegSr
010300090303
010400090303      * aggiorno stato da 01/02../09/ a 11/12../19
010500090303     c                   eval      S_lacela = %editw(xx+10:'0  ')
010600090303     c                   move      s_lacela      lacela
010700090303     c                   update    tilac000
010800090303
010900090303     c                   endsr
011000090303
