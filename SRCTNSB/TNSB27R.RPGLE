000100130116       //==============================================================
000200130116       //?Elenco clienti in tab. "3NN", ma SENZA spedizioni.           ?
000300130116       //==============================================================
000400130116
000500130116       //--------------------------------------------------------------
000600130116       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700130116       //--------------------------------------------------------------
000800130116
000900130116     /*PRM  dbgview(*source)
001000130116     /*END
001100130116
001200130116       //--------------------------------------------------------------
001300130116       //?Specifiche di controllo.                                     ?
001400130116       //--------------------------------------------------------------
001500130116
001600130116     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700130116     h dftactgrp(*no)
001800130116
001900130116       //--------------------------------------------------------------
002000130116       //?Dichiarazione file.                                          ?
002100130116       //--------------------------------------------------------------
002200130116
002300130117       // -?Video?
002400130116     fTNSB27D   cf   e             workstn
002500130116     f                                     indds(IndDspF)
002600130116     f                                     infds(InfDspF)
002700130116
002800130116       //--------------------------------------------------------------
002900130116       //?Definizione costanti.                                        ?
003000130116       //--------------------------------------------------------------
003100130116
003200130116       // -?Tasti funzionali a video?
003300130116     d c_F01           c                   const(x'31')
003400130116     d c_F02           c                   const(x'32')
003500130116     d c_F03           c                   const(x'33')
003600130116     d c_F04           c                   const(x'34')
003700130116     d c_F05           c                   const(x'35')
003800130116     d c_F06           c                   const(x'36')
003900130116     d c_F07           c                   const(x'37')
004000130116     d c_F08           c                   const(x'38')
004100130116     d c_F09           c                   const(x'39')
004200130116     d c_F10           c                   const(x'3A')
004300130116     d c_F11           c                   const(x'3B')
004400130116     d c_F12           c                   const(x'3C')
004500130116     d c_F13           c                   const(x'B1')
004600130116     d c_F14           c                   const(x'B2')
004700130116     d c_F15           c                   const(x'B3')
004800130116     d c_F16           c                   const(x'B4')
004900130116     d c_F17           c                   const(x'B5')
005000130116     d c_F18           c                   const(x'B6')
005100130116     d c_F19           c                   const(x'B7')
005200130116     d c_F20           c                   const(x'B8')
005300130116     d c_F21           c                   const(x'B9')
005400130116     d c_F22           c                   const(x'BA')
005500130116     d c_F23           c                   const(x'BB')
005600130116     d c_F24           c                   const(x'BC')
005700130116     d c_Enter         c                   const(x'F1')
005800130116     d c_RollDown      c                   const(x'F4')
005900130116     d c_RollUp        c                   const(x'F5')
006000130116
006100130116       //--------------------------------------------------------------
006200130116       //?Definizione schiere.                                         ?
006300130116       //--------------------------------------------------------------
006400130116
006500130116       // -?Messaggi di errore?
006600130116     d sk_Msg          s             78    dim( 1)  ctdata  perrcd( 1)
006700130116
006800130116       //--------------------------------------------------------------
006900130116       //?Definizione aree dati.                                       ?
007000130116       //--------------------------------------------------------------
007100130116
007200130116       // -?Dati utente?
007300130116     d §AzUte        e ds                  extname(AZUTE00F)
007400130116     d                                     dtaara
007500130116     d §DatiUte      e ds                  extname(dDatiUte)
007600130116     d                                     dtaara
007700130116
007800130116       //--------------------------------------------------------------
007900130116       //?Definizione strutture dati.                                  ?
008000130116       //--------------------------------------------------------------
008100130116
008200130116       // -?Status ds?
008300130116     d Status         sds
008400130116     d   SDSpgm          *proc
008500130116
008600130116       // -?InfDS?
008700130116     d InfDspF         ds
008800130116     d   dsp_aid             369    369a
008900130116
009000130116       // -?Indicatori su DspF?
009100130116     d IndDspF         ds                  inz
009200130116         // -?Emissione messaggio di errore?
009300130116     d   ErrMessage                    n   overlay(IndDspF : 28)
009400130116         // -?Posizionamento cursore & segnalazione errore?
009500130116     d   PosCurGGL                     n   overlay(IndDspF : 51)
009600130116         //   -?Riemissione videata?
009700130116     d   ErrGenerico                   n   overlay(IndDspF : 99)
009800130122
009900130122       // -?Parametri per batch?
010000130122     d TNSB28ds        ds                  inz
010100130122     d   D28ggl                       3s 0 inz
010200130122     d   D28dtl                       8s 0 inz
010300130116
010400130116       // -?Parametri ricevuti?
010500130116     d KPJBA         e ds
010600130116
010700130116       //--------------------------------------------------------------
010800130116       //?Definizione variabili globali.                               ?
010900130116       //--------------------------------------------------------------
011000130116
011100130116       // -?Flags booleani?
011200130116     d $Fine           s               n   inz
011300130116     d $InzD01         s               n   inz(*on)
011400130116
011500130116       // -?Variabili per la gestione del video?
011600130116     d $Video          s              2    inz('D1')
011700130116
011800130116       // -?Campi di comodo?
011900130116     d wDate_EUR       s               d   datfmt(*eur)   inz(*loval)
012000130116     d wDate_ISO       s               d   datfmt(*iso)   inz(*loval)
012100130116     d wDate           s              8  0 inz
012200130116
012300130116       //--------------------------------------------------------------
012400130116       //?Definizione prototipi procedure.                             ?
012500130116       //--------------------------------------------------------------
012600130116
012700130116       // -?Reperimento dati utente?
012800130116     d TIBS34ds      e ds
012900130116      /copy gaitrasrc/srcProtoPR,TIBS34R
013000130122
013100130122       // -?Sottomissione lavoro batch?
013200130122      /copy gaitrasrc/srcprotopr,BCH10
013300130122
013400130122       // -?Richiamo diretto della procedura batch?
013500130122     d tnsb28r         pr                  extpgm('TNSB28R')
013600130122     d   kpjba                             likeds(KPJBA)
013700130116
013800130116       //--------------------------------------------------------------
013900130116       //?Definizione key-list.                                        ?
014000130116       //--------------------------------------------------------------
014100130116
014200130116
014300130116       //--------------------------------------------------------------
014400130116       //?M A I N - L I N E                                            ?
014500130116       //--------------------------------------------------------------
014600130116
014700130116     c     *Entry        plist
014800130116     c                   parm                    KPJBA
014900130116
015000130116      /free
015100130116
015200130116       // -?Operazioni iniziali?
015300130116       exsr  sr_RoutInz;
015400130116
015500130116       // -?Ciclo di gestione del file video?
015600130116       DOW  $Fine = *off;
015700130116
015800130116         select;
015900130116
016000130116           // -?Filtro di lancio?
016100130116           when $Video = 'D1';
016200130116             exsr  sr_GesD01;
016300130116
016400130116           // -?? ? ??
016500130116           other;
016600130116             $Fine = *on;
016700130116
016800130116         endsl;
016900130116
017000130116       ENDDO;
017100130116
017200130116       // -?Operazioni finali?
017300130116       exsr  sr_RoutEnd;
017400130116
017500130116       //--------------------------------------------------------------
017600130116       //?Operazioni iniziali.                                         ?
017700130116       //--------------------------------------------------------------
017800130116       BEGSR  sr_RoutInz;
017900130116
018000130116         *inLR = *on;
018100130116
018200130116         // -?Reperimento dati job?
018300130116         exsr  sr_DatiJob;
018400130116
018500130116         // -?Impostazione nome programma a video?
018600130116         VT1pgm = SDSpgm;
018700130116
018800130116         // -?Reperimento data odierna?
018900130116         wDate = %int( %subst( %char( %dec( %timestamp() ) )
019000130116                               : 1 : 8 ) );
019100130116
019200130116       ENDSR;
019300130116
019400130116       //--------------------------------------------------------------
019500130116       //?Reperimento Dati del job (Utente/Operativi).                 ?
019600130116       //--------------------------------------------------------------
019700130116       BEGSR  sr_DatiJob;
019800130116
019900130116         in(E) §AzUte;
020000130116         if NOT %error;
020100130116           in(E) §DatiUte;
020200130116         endif;
020300130116         if %error or RSut = *blanks;
020400130116           clear TIBS34ds;
020500130116           tibs34r ( tibs34ds );
020600130116           in §AzUte;
020700130116           in §DatiUte;
020800130116         endif;
020900130116
021000130116       ENDSR;
021100130116
021200130116       //--------------------------------------------------------------
021300130116       //?Gestione videata D01.                                        ?
021400130116       //--------------------------------------------------------------
021500130116       BEGSR  sr_GesD01;
021600130116
021700130116         // -?Inizializzazione videata?
021800130116         if  $InzD01 = *on;
021900130116           exsr  sr_InzD01;
022000130116           $InzD01 = *off;
022100130116         endif;
022200130116
022300130116         // -?Emissione videata?
022400130116         write  SB27T01;
022500130116         write  SB27P01;
022600130116         exfmt  SB27D01;
022700130116
022800130116         clear  VIDmsg;
022900130116         reset  ErrMessage;
023000130116         reset  ErrGenerico;
023100130116
023200130116         SELECT;
023300130116
023400130116           // -?F3=Fine?
023500130116           WHEN  dsp_aid = c_F03;
023600130116             $Fine = *on;
023700130116
023800130116           // -?Invio, F6=Conferma?
023900130116           OTHER;
024000130116             exsr  sr_CtrD01;
024100130116             if  ErrGenerico = *off  and  dsp_aid = c_F06;
024200130122               exsr  sr_SbmJob;
024300130122               $Fine = *on;
024400130116             endif;
024500130116
024600130116         ENDSL;
024700130116
024800130116       ENDSR;
024900130116
025000130116       //--------------------------------------------------------------
025100130116       //?Inizializzazione videata D01.                                ?
025200130116       //--------------------------------------------------------------
025300130116       BEGSR  sr_InzD01;
025400130116
025500130116         clear  SB27D01;
025600130122         clear  TNSB28ds;
025700130116
025800130116         VD1ggl = 120;
025900130116
026000130118         exsr  sr_CtrD01;
026100130118         clear  VIDmsg;
026200130118         reset  ErrMessage;
026300130118         reset  ErrGenerico;
026400130116
026500130116       ENDSR;
026600130116
026700130116       //--------------------------------------------------------------
026800130116       //?Controllo dati immessi nella videata D01.                    ?
026900130116       //--------------------------------------------------------------
027000130116       BEGSR  sr_CtrD01;
027100130116
027200130116         // -?Spegnimento indicatori di posizionamento cursore?
027300130116         %subst(IndDspF : 28) = *off;
027400130116
027500130116         // -?Numero giorni inferiori a 1?
027600130116         if  VD1ggl <= 1;
027700130116           VIDmsg = sk_Msg(01);
027800130116           PosCurGGL   = *on;
027900130116           ErrMessage  = *on;
028000130116           ErrGenerico = *on;
028100130116           leavesr;
028200130116         endif;
028300130116
028400130116         wDate_Eur = %date( wDate : *iso ) - %days( VD1ggl );
028500130116         wDate_Iso = wDate_Eur;
028600130116         VD1dtl = %dec( wDate_Eur );
028700130122         D28dtl = %dec( wDate_Iso );
028800130116
028900130116       ENDSR;
029000130116
029100130116       //--------------------------------------------------------------
029200130122       //?Sottomissione laboro batch.                                  ?
029300130116       //--------------------------------------------------------------
029400130122       BEGSR  sr_SbmJob;
029500130116
029600130122         // -?Impostazione parametri?
029700130122         //clear  TNBS28ds;         (già fatto)
029800130122         D28ggl  = VD1ggl;
029900130122         //D28dtl  = D28dtl;        (già impostato)
030000130122
030100130122         // -?Sottomissione del lavoro batch?
030200130122         KCoAz = 'SB28';
030300130122         KPJbu = TNSB28ds;
030400130122         if  KNmUs = *all'1';
030500130122           tnsb28r ( kpjba );
030600130122         else;
030700130122           bch10 ( kpjba );
030800130122         endif;
030900130116
031000130116       ENDSR;
031100130116
031200130116       //--------------------------------------------------------------
031300130116       //?Operazioni finali.                                           ?
031400130116       //--------------------------------------------------------------
031500130116       BEGSR  sr_RoutEnd;
031600130116
031700130116         // -?Chiusura pgm?
031800130116         return;
031900130116
032000130116       ENDSR;
032100130116
032200130116      /end-free
032300130116
032400130116       //--------------------------------------------------------------
032500130116       //?Definizione schiere a tempo di compilazione                  ?
032600130116       //--------------------------------------------------------------
032700130116
032800130116** -?sk_Msg:?Messaggi di Errore?---------------------------------------------*
032900130116Il numero di giorni DEVE essere maggiore di 0 (zero)                            1
