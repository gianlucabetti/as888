000100081117     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000200081117      // ----------------------------------------------------------------------
000300081117      //
000400131023      //         trasmissione  bolle 102 a filiale
000500081117      //
000600081117      // ----------------------------------------------------------------------
000700081117      // ? DICHIARAZIONE DEI FILE ?
000800081117      // ----------------------------------------------------------------------
000900081119     ftabel00f  if   e           k disk
001000131023     ftnsd56d   cf   e             workstn
001100081117
001200081117      // ----------------------------------------------------------------------
001300081117      // ? RIEPILOGO INDICATORI ?
001400081117
001500081117      // ? V A R I A B I L I ?
001600131023     d wdataa          s              8  0
001700081119     d wdatamin        s              8  0
001800131023     d wdatamax        s              8  0
001900081117     d $fine           s               n   inz(*off)
002000081117
002100081117      // ? S C H I E R E ?
002200081117     d msg             s             78    dim(15) ctdata perrcd(1)
002300081117
002400081117      // ? D S   I N T E R N E / E S T E R N E ?
002500081117     d wlbdat          ds                  inz
002600081117     d  g02dat                 1      8  0
002700081117     d  g02inv                 9     16  0
002800081117     d  g02err                17     17
002900081117     d  g02tgi                18     22  0
003000081117
003100081119     d wgidat          ds                  inz
003200081119     d  giodat                 1      8  0
003300081119     d  gioinv                 9     16  0
003400081119     d  giotgi                17     21  0
003500081119
003600090223     d ds5a          e ds
003700081117     d kpjba         e ds
003800081117
003900081117      // ? COSTANTI ?
004000090223
004100090223      // ? PROCEDURE USATE NON NEI PROTOTIPI ?
004200081119     d xsrgi8          pr                  extpgm('XSRGI8')
004300081119     d  wgidat                             likeds(wgidat)
004400090223
004500131023     d tnsd57r         pr                  extpgm('TNSD57R')
004600090223     d  kpjba                              likeds(kpjba)
004700081119
004800081117      // ? PROTOTIPI ?
004900081117      /copy gaitrasrc/srcprotopr,xsrda8
005000081117
005100081117     c     *entry        plist
005200081117     c                   parm                    kpjba
005300131023     c                   eval      w1ctipo=%subst(kpjbu:20:3)
005400081117
005500081117      /free
005600081117
005700081119       //?operazioni iniziali
005800081119         exsr routinz;
005900081117
006000081117         dow not $fine;
006100081117       //?gestione prima videata
006200081117           exsr gesvid;
006300081117         enddo;
006400081117
006500081117         *inlr = *on;
006600081119
006700081119       // ----------------------------------------------------------------------
006800081119       //?Operazioni iniziali.
006900081119       // ----------------------------------------------------------------------
007000081119       begsr routinz;
007100081119
007200081119         $fine = *off;
007300081119
007400081119
007500090223       //?calcolo la data di pulizia spunte con anomalie
007600081119         clear wlbdat;
007700090223         g02inv = *date;
007800081119         g02err = '3';
007900081119         xsrda8(wlbdat);
008000081119
008100131023         giotgi = g02tgi + 3     ;
008200081119         xsrgi8(wgidat);
008300131023         wdatamax = gioinv;
008400131023
008500131023         giotgi = g02tgi - 3     ;
008600131023         xsrgi8(wgidat);
008700131023         wdatamin = gioinv;
008800081119
008900131023         w1cdataa =g02dat ;
009000081119       endsr;
009100081117
009200081117       // ----------------------------------------------------------------------
009300081117       //?Gestione videata
009400081117       // ----------------------------------------------------------------------
009500081117       begsr gesvid;
009600081117
009700081117       //?emetto la videata
009800131023          exfmt sd56w01;
009900081117
010000081117       //?spengo indicatori di comodo
010100081117          *in28 = *off;
010200081117       //?pulisco campo messaggi
010300081117          clear w1cmsg;
010400081117
010500081117       //?esecuzione comandi
010600081117         select;
010700081117
010800081117       //?f3=fine
010900081117          when *inkc;
011000081117           exsr sr_fine;
011100081117       //?f6=conferma
011200081117          when *inkf;
011300090223           exsr sr_contrdata;
011400090223           if *in28;
011500090223            leavesr;
011600090223           endif;
011700081117           exsr sr_elabora;
011800081117         other;
011900081117
012000081117       //?controllo la data
012100081117          exsr sr_contrdata;
012200081117          if *in28;
012300081117           leavesr;
012400081117          endif;
012500081117         endsl;
012600081117
012700081117       endsr;
012800081117
012900081117       // ----------------------------------------------------------------------
013000081117       //?Controllo data
013100081117       // ----------------------------------------------------------------------
013200081117       begsr sr_contrdata;
013300090223
013400090223       //?spengo indicatori di comodo
013500090223          *in40 = *off;
013600081117
013700081117       //?pulisco campi di comodo
013800090223         clear wdataa;
013900090223
014000090223       //?DATA AL
014100090223       //?è obbligatoria
014200090223         if w1cdataa = *zeros;
014300090223          *in28 = *on;
014400090223          *in41 = *on;
014500090223          w1cmsg = msg(01);
014600090223          leavesr;
014700090223         endif;
014800090223
014900090223       //?deve essere una data valida
015000090223         clear wlbdat;
015100090223         g02dat = w1cdataa;
015200090223         xsrda8(wlbdat);
015300090223         if g02err = '1';
015400090223          *in28 = *on;
015500090223          *in41 = *on;
015600090223          w1cmsg = msg(01);
015700090223          leavesr;
015800090223         endif;
015900090223
016000090223         w1cdataa = g02dat;
016100090223         wdataa = g02inv;
016200090223
016300131023       //?non deve essere > data massima
016400131023         if wdataa > wdatamax   ;
016500090223          *in28 = *on;
016600090223          *in41 = *on;
016700131023          w1cmsg = msg(03);
016800090223          leavesr;
016900090223         endif;
017000090223
017100131023       //?non deve essere < data minima
017200131023         if wdataa < wdatamin ;
017300090223          *in28 = *on;
017400090223          *in41 = *on;
017500131023          w1cmsg = msg(02);
017600090223          leavesr;
017700090223         endif;
017800081117
017900081117       endsr;
018000081117
018100081117       // ----------------------------------------------------------------------
018200081117       //?Elaborazione
018300081117       // ----------------------------------------------------------------------
018400081117       begsr sr_elabora;
018500081117
018600090223       //?richiamo il pgm di elaborazione
018700131023         kcoaz = 'SD57';
018800131023         %subst(kpjbu:1:8) = %char(wdataa);
018900131023         TNSD57R (kpjba);
019000081117
019100081117       //?finito di elaborare esco dal pgm
019200081117           exsr sr_fine;
019300081117
019400081117       endsr;
019500081117
019600081117       // ----------------------------------------------------------------------
019700081117       //?Fine programma
019800081117       // ----------------------------------------------------------------------
019900081117       begsr sr_fine;
020000081117
020100081117         *inlr = *on;
020200081117         return;
020300081117
020400081117       endsr;
020500081117
020600081117** MSG  Lungh. 30             *
020700131023Data errata
020800131023Non minore di 1 giorno lavorativo
020900131023Non maggiore di 1 giorno lavorativo
