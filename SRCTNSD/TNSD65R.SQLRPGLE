004002180213      //---------------------------------------------------------------
004003180213      // TNSD65R - Pulizia files per SEDE - TILAC00F               ?
004004180213      //---------------------------------------------------------------
004005180213     h decedit('0,') datedit(*dmy/) option(*nodebugio)
004006180213
004007180213      //---------------------------------------------------------------
004008180213      //?Definizione file.
004009180213      //---------------------------------------------------------------
004010180213     fTILAC02L  uf   e           k disk
004011180213
004012180213      //---------------------------------------------------------------
004013180213      //?Definizione aree dati.
004014180213      //---------------------------------------------------------------
004015180213      // - Dati utente
004016180213     d §AzUte        e ds                  extname(AZUTE00F)
004017180213     d                                     dtaara
004018180213     d §DatiUte      e ds                  extname(dDatiUte)
004019180213     d                                     dtaara
004020180213      //---------------------------------------------------------------
004021180213      //?Definizione strutture dati.
004022180213      //---------------------------------------------------------------
004023180213     d KPJBA         e ds
004024180213
004025180213      // - Parametri x Controllo profilo utenti
004026180213     d TIBS34DS      e ds                  inz
004027180213
004028180213      // - Parametri x Pulizia file TIDVD
004029180213     d TNSD61DS      e ds                  qualified inz
004030180213
004031180213      // - Parametri ricevuti
004032180213     d PARAM           ds
004033180213     d  DataLAC               25     32  0
004034180213
004035180213      //---------------------------------------------------------------
004036180213      //?Definizione variabili globali.
004037180213      //---------------------------------------------------------------
004038180213     d sav_idjob       s                   like(LACidjob)
004039180213     d wdata           s              8    inz('00000000')
004040180213     d wLACtim         s                   like(DataLAC)
004041180213
004042180213      //--------------------------------------------------------------
004043180213      //?Definizione procedure usate.                                 ?
004044180213      //--------------------------------------------------------------
004045180213      // pgm pulizia file TIDVD00F
004046180213     d TNSD61R         pr                  extpgm('TNSD61R')
004047180213     d  tnsd61ds                           likeds(tnsd61ds)
004048180213
004049180213      /copy gaitrasrc/srcProtoPR,TIBS34R
004050180213
004051180213      //---------------------------------------------------------------
004052180213      //?M A I N - L I N E
004053180213      //---------------------------------------------------------------
004054180213     c     *Entry        plist
004055180213     c                   parm                    KPJBA
004056180213
004057180213      //Operazioni Iniziali
004058180213       exsr Routinz;
004059180213
004060180213      //Pulizia file
004061180213       exsr Delete_TILAC;
004062180213
004063180213      //Operazioni Finali
004064180213       exsr RoutEnd;
004065180213
004066180213      //---------------------------------------------------------------
004067180213      // ?Operazioni Iniziali
004068180213      //---------------------------------------------------------------
004069180213        BEGSR RoutInz;
004070180213
004071180213         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
004072180213
004073180213        // Reperimento dati job
004074180213          exsr DatiJob;
004075180213
004076180213          param = kpjbu;
004077180213
004078180213        ENDSR;
004079180213
004080180213      //---------------------------------------------------------------
004081180213      // ?Reperimento Dati del job (Utente/Operativi)
004082180213      //---------------------------------------------------------------
004083180213        BEGSR DatiJob;
004084180213
004085180213         in(E) §AzUte;
004086180213         IF  NOT %error;
004087180213           in(E) §DatiUte;
004088180213         ENDIF;
004089180213         IF  %error or RSut = *blanks;
004090180213           clear TIBS34ds;
004091180213           tibs34r(tibs34ds);
004092180213           in §AzUte;
004093180213           in §DatiUte;
004094180213         ENDIF;
004095180213
004096180213       ENDSR;
004097180213
004098180213      //---------------------------------------------------------------
004099180213      // ?Cancellazione records
004100180213      //---------------------------------------------------------------
004101180213        BEGSR Delete_TILAC;
004102180213
004104180213          setll (wdata) TILAC02L;
004105180213          DOW not %eof(TILAC02L);
004106180213
004107180213            read TILAC02L;
004108180213
004109180213            wLACtim = %dec(%subst(LACtim:1:8):8:0);
004110180213            IF  wLACtim >= DataLAC;
004111180213              leave;
004112180213            ENDIF;
004113180213            IF  LACela = '00';
004114180213              iter;
004115180213            ENDIF;
004116180213
004117180213            DELETE tilac000;
004133180213
004134180213          ENDDO;
004135180213
004136180213       // Pulisco anche TIDVD00F
004137180213          clear TNSD61DS;
004138180213          tnsd61ds.IDTASK = 'POD';
004139180213          tnsd61ds.DATAPUL = DataLAC;
004140180213          TNSD61R (tnsd61ds);
004142180213
004143180213        ENDSR;
004144180213
004145180213      //---------------------------------------------------------------
004146180213      // ?Operazioni Finali
004147180213      //---------------------------------------------------------------
004148180213        BEGSR RoutEnd;
004149180213
004150180213          *inlr = *on;
004151180213          return;
004152180213
004153180213        ENDSR;
