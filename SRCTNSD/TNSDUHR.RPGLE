000100020325     H DECEDIT('0,') DATEDIT(*DMY.) option(*nodebugio)
000200020325      *------------------------------------------------------------------------*
000300020325      * CANCELLAZIONE MOVIMENTI UNITA' EDP - ESEGUE
000400020325      *------------------------------------------------------------------------*
000500020325
000600020325      *------------------------------------------------------------------------*
000700020325      * DATA BASE
000800020325      *------------------------------------------------------------------------*
000900971013     FUNMOV01L  UF   E           K DISK
001000020325
001100971013     D*------------------------------------------------------------------------*
001200971013     D* INPUT
001300971013     D*------------------------------------------------------------------------*
001400971013     D*--------------------
001500971013     D* DS PARAMETRI INPUT
001600971013     D*--------------------
001700971013     D PARAM           DS
001800971013     D  PARMDI                 1      8  0
001900971013     D  PARMDF                 9     16  0
002000971013     D  PARMAT                17     17
002100971013     D*--------------------
002200971013     D* ARCHITETTURA
002300971013     D*--------------------
002400971013     D KPJBA         E DS
002500020325
002600971013     C*------------------------------------------------------------------------*
002700971013     C* MAIN LINE
002800971013     C*------------------------------------------------------------------------*
002900971013     C*
003000971013     C* POSIZIONAMENTO E PRIMA LETTURA
003100971013     C                   EXSR      SETFIL
003200971013     C*
003300971013     C* CICLO FINO A FINE FILE
003400971013DO  1C     $FINE         DOWEQ     'N'
003500971013     C*
003600971013     C* CANCELLA IL RECORD
003700971013     C                   DELETE    UNMOV000
003800971013     C*
003900971013     C* LETTURA SUCCESSIVA
004000971013     C                   EXSR      LETFIL
004100971013E   1C                   ENDDO
004200971013     C*
004300971013     C                   SETON                                        LR
004400971013     C*------------------------------------------------------------------------*
004500971013     C* SETFIL - POSIZIONAMENTO E PRIMA LETTURA
004600971013     C*------------------------------------------------------------------------*
004700971013     C     SETFIL        BEGSR
004800971013     C*
004900971013     C     *LOVAL        SETLL     UNMOV01L                           99
005000971013IF  1C     *IN99         IFEQ      *ON                                          *FINE FILE
005100971013     C                   MOVEL     'S'           $FINE                          *FINE PGM
005200971013X   1C                   ELSE
005300971013     C                   EXSR      LETFIL                                       *LETTURA RECORD
005400971013E   1C                   ENDIF
005500971013     C*
005600971013     C                   ENDSR
005700971013     C*------------------------------------------------------------------------*
005800971013     C* LETFIL - LETTURA SUCCESSIVA RECORD
005900971013     C*------------------------------------------------------------------------*
006000971013     C     LETFIL        BEGSR
006100971013     C*
006200971013     C* LEGGO FINO A:
006300971013     C*     - FINE FILE
006400971013     C*     - TROVATO RECORD VALIDO
006500971013     C                   MOVEL     'N'           WRECOK
006600971013DO  1C     $FINE         DOWEQ     'N'
006700971013     C     WRECOK        ANDEQ     'N'
006800971013     C*
006900971013     C                   READ      UNMOV01L                               99
007000971013     C*
007100971013IF  2C     *IN99         IFEQ      *ON                                          *FINE FILE
007200971013     C                   MOVEL     'S'           $FINE                          *FINE PGM
007300971013X   2C                   ELSE
007400971013     C                   EXSR      CHKREC                                       *CONTROLLO RECORD
007500971013E   2C                   ENDIF
007600971013E   1C                   ENDDO
007700971013     C*
007800971013     C                   ENDSR
007900971013     C*------------------------------------------------------------------------*
008000971013     C* CHKREC - CONTROLLA VALIDITA' RECORD
008100971013     C*------------------------------------------------------------------------*
008200971013     C     CHKREC        BEGSR
008300971013     C*
008400971013     C                   MOVEL     'S'           WRECOK                         *RECORD VALIDO
008500971015     C*
008600971015     C* MOVIMENTO DI CARICO, ESCLUDE
008700971015IF  1C     UNMCAU        IFEQ      'CARI'
008800971015     C                   MOVEL     'N'           WRECOK                         *RECORD NON VALIDO
008900971015E   1C                   ENDIF
009000971013     C*
009100971013     C* PERIODO NON RICHIESTO, ESCLUDE
009200971013IF  1C     PARMDI        IFGT      *ZEROS
009300971013IF  2C     UNMDTM        IFGE      PARMDI
009400971013     C     UNMDTM        ANDLE     PARMDF
009500971013X   2C                   ELSE
009600971013     C                   MOVEL     'N'           WRECOK                         *RECORD NON VALIDO
009700971013E   2C                   ENDIF
009800971013E   1C                   ENDIF
009900971013     C*
010000971013     C* SOLO ANNULLATI, ESCLUDE RECOR VALIDO
010100971013IF  1C     PARMAT        IFEQ      'S'
010200971013IF  2C     UNMATB        IFEQ      *BLANKS
010300971013     C                   MOVEL     'N'           WRECOK                         *RECORD NON VALIDO
010400971013E   2C                   ENDIF
010500971013E   1C                   ENDIF
010600971013     C*
010700971013     C                   ENDSR
010800971013     C*------------------------------------------------------------------------*
010900971013     C* *INZSR - OPERAZIONI INIZIALI
011000971013     C*------------------------------------------------------------------------*
011100971013     C     *INZSR        BEGSR
011200971013     C*--------------------
011300971013     C* RICEVIMENTO PARAMETRI
011400971013     C*--------------------
011500971013     C     *ENTRY        PLIST
011600971013     C                   PARM                    KPJBA
011700971015     C                   MOVEL     KPJBU         PARAM
011800971013     C*--------------------
011900971013     C* DEFINIZIONE CAMPI DI CONTROLLO
012000971013     C*--------------------
012100971013     C                   MOVEL     'N'           $FINE             1            *FINE PGM
012200971013     C                   MOVEL     'N'           WRECOK            1            *RECORD VALIDO
012300971013     C*
012400971013     C                   ENDSR
