000100111128       //==============================================================
000200120620       // TRTC85R1 - Finestra di forzatura
000300120405       //==============================================================
000400111128
000500111128       //--------------------------------------------------------------
000600120207       // Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700111128       //--------------------------------------------------------------
000800111128
000900111128     /*PRM  dbgview(*source)
001000111128     /*END
001100111128
001200111128       //--------------------------------------------------------------
001300120207       // Specifiche di controllo.                                     ?
001400111128       //--------------------------------------------------------------
001500111128
001600111128     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700120510     h dftactgrp(*no) bnddir('UBBNDDIR')
001800111128     h alwnull(*inputonly)
001900111128
002000111128       //--------------------------------------------------------------
002100120207       // Dichiarazione file.                                          ?
002200111128       //--------------------------------------------------------------
002300120215       // - Video
002400120620     fTRTC85D1  cf   e             workstn
002500120620       //f                                     indds(IndDspF)
002600120207     f                                     infds(InfDspF)
002700111128
002800111128
002900111128       //--------------------------------------------------------------
003000120207       // Definizione costanti.                                        ?
003100111128       //--------------------------------------------------------------
003200120207
003300120207       // - Tasti funzionali a video
003400120207     d c_F01           c                   const(x'31')
003500120207     d c_F02           c                   const(x'32')
003600120207     d c_F03           c                   const(x'33')
003700120207     d c_F05           c                   const(x'35')
003800120207     d c_F06           c                   const(x'36')
003900120207     d c_F07           c                   const(x'37')
004000120207     d c_F08           c                   const(x'38')
004100120207     d c_F09           c                   const(x'39')
004200120207     d c_F10           c                   const(x'3A')
004300120207     d c_F12           c                   const(x'3C')
004400120207     d c_F13           c                   const(x'B1')
004500120207     d c_F14           c                   const(x'B2')
004600120207     d c_F15           c                   const(x'B3')
004700120207     d c_F16           c                   const(x'B4')
004800120207     d c_F17           c                   const(x'B5')
004900120207     d c_F18           c                   const(x'B6')
005000120207     d c_F19           c                   const(x'B7')
005100120207     d c_F20           c                   const(x'B8')
005200120207     d c_F21           c                   const(x'B9')
005300120207     d c_F22           c                   const(x'BA')
005400120207     d c_F23           c                   const(x'BB')
005500120207     d c_F24           c                   const(x'BC')
005600120207     d c_Enter         c                   const(x'F1')
005700120207     d c_RollDown      c                   const(x'F4')
005800120207     d c_RollUp        c                   const(x'F5')
005900111128
006000111128
006100111128       //--------------------------------------------------------------
006200120207       // Definizione schiere.                                         ?
006300111128       //--------------------------------------------------------------
006400111128
006500111128
006600111128       //--------------------------------------------------------------
006700120207       // Definizione aree dati.                                       ?
006800111128       //--------------------------------------------------------------
006900111128
007000111128
007100111128       //--------------------------------------------------------------
007200120207       // Definizione strutture dati.                                  ?
007300111128       //--------------------------------------------------------------
007400120510
007500120510
007600111128       //--------------------------------------------------------------
007700120207       // Definizione variabili globali.                               ?
007800111128       //--------------------------------------------------------------
007900111128
008000120208       // - Stringa SQL da eseguire
008100111128     d wSQl            s           1024    inz  varying
008200111128
008300120208       // - Parametri SQL
008400120207
008500120207       // - InfDS
008600120207     d InfDspF         ds
008700120207     d   dsp_aid             369    369a                                        AID byte
008800120207
008900120207       // - Indicatori su DspF
009000120620       //d IndDspF         ds
009100120207        // - Indicatori di errore
009200120620       //d  ErrMsg                        1n   overlay(IndDspF : 28)
009300120620       //d  ErrGenerico                   1n   overlay(IndDspF : 99)
009400120620     d  ErrMsg         s              1n
009500120620     d  ErrGenerico    s              1n
009600120404
009700120404     d KPJBA         e ds
009800120207
009900120207       // - Flags booleani
010000120207     d $Fine           s               n   inz(*off)
010100120510     d $InzW01         s               n   inz(*on)
010200120208     d ErrBlock        s               n   inz(*off)
010300120210     d Qcmd            s            500    inz
010400120207
010500120207       // - Campi associati al video
010600120510     d $Video          s              2    inz('W1')
010700120207
010800120207       // - Variabili di appoggio
010900120510     d wData08         s              8s 0
011000120405     d wX              s              5s 0
011100111128
011200111128       //--------------------------------------------------------------
011300120210       // Definizione procedure usate
011400111128       //--------------------------------------------------------------
011500120207
011600120210       // - Parametri API QCAPCMD (Process Commands)
011700120207      /copy qSysInc/qRpgleSrc,QCAPCMD
011800120207      /copy gaitrasrc/srcProtoPR,QCAPCMD
011900120207
012000120210       // - Parametri gestione errori API
012100120207      /copy qSysInc/qRpgleSrc,QUSEC
012200120404
012300120620     d TRTC85R1        pr
012400120404     d  Arch                        502
012500120620     d  Exfmt                         1
012600120620     d  Msg01                        60
012700120620     d  Msg02                        60
012800120620     d  Msg03                        60
012900120620     d  Forcing                       1
013000120404
013100120620     d TRTC85R1        pi
013200120404     d  Arch                        502
013300120620     d  Exfmt                         1
013400120620     d  Msg01                        60
013500120620     d  Msg02                        60
013600120620     d  Msg03                        60
013700120620     d  Forcing                       1
013800111128
013900111128       //--------------------------------------------------------------
014000120208       // Definizione key-list.                                        ?
014100111128       //--------------------------------------------------------------
014200111128
014300111128
014400111128       //--------------------------------------------------------------
014500120208       // M A I N - L I N E                                            ?
014600111128       //--------------------------------------------------------------
014700111128
014800111128      /free
014900111128
015000120208       // - Operazioni iniziali
015100111128       exsr  sr_RoutInz;
015200111128
015300120207       // - Gestione video
015400120207       DOW  $Fine = *off;
015500120207         select;
015600120510           when  $Video = 'W1';
015700120510             exsr  sr_GesW01;
015800120207           other;
015900120207             $Fine = *on;
016000120207         endsl;
016100120207       ENDDO;
016200120207
016300120208       // - Operazioni finali
016400111128       exsr  sr_RoutEnd;
016500111128
016600111128       //--------------------------------------------------------------
016700120208       // Operazioni iniziali
016800111128       //--------------------------------------------------------------
016900111128       BEGSR sr_RoutInz;
017000111128
017100120620         // Nel caso che, tra la passata chiamata a questo pgm e questa,
017200120620         // ci sia stata una emissione a video del pgm chiamante
017300120620         // chiudo e riapro il DSPF contenente la finestra
017400120620         // per evitare il permanere del primo sfondo sotto la finestra.
017500120620         if exfmt = *on;
017600120620           close TRTC85D1;
017700120620           open  TRTC85D1;
017800120620         endif;
017900120620
018000120620         *inRT = *on;
018100120620         $Fine = *off;
018200120620         $InzW01 = *on;
018300120620         //IndDspF  = *off;
018400120404         KPJBA = Arch;
018500111128
018600120208         // - Impostazione opzioni per SQL
018700111128         exec SQL   set option   DynUsrPrf = *owner,
018800111128                                 CloSqlCsr = *endmod;
018900111128
019000111128       ENDSR;
019100120207
019200120207       //--------------------------------------------------------------
019300120510       // Gestione videata W01
019400120207       //--------------------------------------------------------------
019500120510       BEGSR  sr_GesW01;
019600120207
019700120207         // - Inizializzazione videata
019800120510         if  $InzW01   = *on;
019900120510           exsr  sr_InzW01;
020000120510           $InzW01  = *off;
020100120207         endif;
020200120207
020300120207         // - Emissione videata
020400120620         exfmt  tc85W01;
020500120207
020600120208         reset  ErrMsg;
020700120207
020800120207         SELECT;
020900120207
021000120207           // - F3=Fine
021100120207           WHEN  dsp_aid = c_F03;
021200120510             exsr sr_F03W01;
021300120207
021400120207           // - F12=Ritorno
021500120207           WHEN  dsp_aid = c_F12;
021600120510             exsr sr_F12W01;
021700120207
021800120207           // - Invio / F6=Conferma
021900120207           OTHER;
022000120510             exsr  sr_CtrW01;
022100120207             if  ErrGenerico = *on;
022200120207               leavesr;
022300120207             endif;
022400120207             if  dsp_aid = c_F06;
022500120510               exsr sr_F06W01;
022600120207             endif;
022700120207
022800120207         ENDSL;
022900120207
023000120207       ENDSR;
023100120207
023200120207       //--------------------------------------------------------------
023300120510       // Inizializzazione videata W01
023400120207       //--------------------------------------------------------------
023500120510       BEGSR  sr_InzW01;
023600120207
023700120207         // - Pulizia videata
023800120620         clear  tc85W01;
023900120620
024000120620         // - Imposto i campi video con i dati in ingresso
024100120620         w01Msg01 = Msg01;
024200120620         w01Msg02 = Msg02;
024300120620         w01Msg03 = Msg03;
024400120207
024500120207       ENDSR;
024600120207
024700120207       //--------------------------------------------------------------
024800120510       // Gestione tasto funzionale F3 da videata W01                  ?
024900120510       // F3=Fine                                                      ?
025000120207       //--------------------------------------------------------------
025100120510       BEGSR  sr_F03W01;
025200120207
025300120207         // - Chiusura del programma
025400120207         $Fine = *on;
025500120620         Forcing = *off;
025600120207
025700120207       ENDSR;
025800120207
025900120207       //--------------------------------------------------------------
026000120510       // Gestione tasto funzionale F6 da videata W01
026100120208       // F6=Conferma
026200120207       //--------------------------------------------------------------
026300120510       BEGSR  sr_F06W01;
026400120405
026500120620         // Confermo forzatura
026600120620         Forcing = *on;
026700120215
026800120510         // Esco dal pgm (solo se non ho errori da mostrare)
026900120208         if ErrMsg = *off;
027000120208           $Fine = *on;
027100120208         endif;
027200120207
027300120207       ENDSR;
027400120208
027500120207       //--------------------------------------------------------------
027600120510       // Gestione tasto funzionale F12 da videata W01
027700120208       // F12=Ritorno
027800120207       //--------------------------------------------------------------
027900120510       BEGSR  sr_F12W01;
028000120207
028100120207         // - Chiusura del programma
028200120207         $Fine = *on;
028300120620         Forcing = *off;
028400120207
028500120207       ENDSR;
028600120207
028700120207       //--------------------------------------------------------------
028800120510       // Controllo videata W01                                        ?
028900120207       //--------------------------------------------------------------
029000120510       BEGSR  sr_CtrW01;
029100120207
029200120620         //IndDspF  = *off;
029300120208
029400120207
029500120207       ENDSR;
029600111128
029700111128       //--------------------------------------------------------------
029800120208       // Operazioni finali
029900111128       //--------------------------------------------------------------
030000111128       BEGSR  sr_RoutEnd;
030100111128
030200120208         // - Uscita
030300111128         return;
030400111128
030500111128       ENDSR;
030600111128
030700111128      /end-free
