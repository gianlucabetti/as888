000100080206      //--------------------------------------------------------------
000200100903      //?TNSDUPR - sblocca data area pgm immissione matriclle per
000300100903      //                       inVII GIORNALIERI UNITÀ EDP
000400080206      //--------------------------------------------------------------
000500080206
000600080206     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000700080206
000800080206      //---------------------------------------------------------------
000900080206      //?Dichiarazione file.
001000080206      //---------------------------------------------------------------
001100050704
001200100903     fTNSDUPD   cf   e             workstn indds(IndDspF)
001300080206     f                                     infds(InfDspF)
001400080206      //---------------------------------------------------------------
001500080207      // - Tasti funzionali a video
001600080207     d c_F01           c                   const(x'31')
001700080207     d c_F02           c                   const(x'32')
001800080207     d c_F03           c                   const(x'33')
001900080207     d c_F05           c                   const(x'35')
002000080207     d c_F06           c                   const(x'36')
002100080207     d c_F07           c                   const(x'37')
002200080207     d c_F08           c                   const(x'38')
002300080207     d c_F09           c                   const(x'39')
002400080207     d c_F10           c                   const(x'3A')
002500080207     d c_F12           c                   const(x'3C')
002600080207     d c_F13           c                   const(x'B1')
002700080207     d c_F14           c                   const(x'B2')
002800080207     d c_F15           c                   const(x'B3')
002900080207     d c_F16           c                   const(x'B4')
003000080207     d c_F17           c                   const(x'B5')
003100080207     d c_F18           c                   const(x'B6')
003200080207     d c_F19           c                   const(x'B7')
003300080207     d c_F20           c                   const(x'B8')
003400080207     d c_F21           c                   const(x'B9')
003500080207     d c_F22           c                   const(x'BA')
003600080207     d c_F23           c                   const(x'BB')
003700080207     d c_F24           c                   const(x'BC')
003800080207     d c_Enter         c                   const(x'F1')
003900080207     d c_RollDown      c                   const(x'F4')
004000080207     d c_RollUp        c                   const(x'F5')
004100080214
004200080214      // - Attributi di visualizzazione
004300080215      //  -  DspAtr() - Normale
004400080214     d C_dspatr_Norm   c                   const(x'20')
004500080215      //  -  DspAtr(RI)
004600080214     d C_dspatr_RI     c                   const(x'21')
004700080215      //  -  DspAtr(ND)
004800080214     d C_dspatr_ND     c                   const(x'27')
004900080215      //  -  DspAtr(BL) / Color(Red)
005000080214     d C_dspatr_BL     c                   const(x'28')
005100080206
005200080206      //---------------------------------------------------------------
005300080206      //?Definizione schiere.
005400080206      //---------------------------------------------------------------
005500100907     d MSG             s             78    dim(01) ctdata perrcd(1)
005600080206      //---------------------------------------------------------------
005700080206      //?Definizione aree dati.
005800080206      //---------------------------------------------------------------
005900080206      // - Dati utente
006000080206     d §AzUte        e ds                  extname(AZUTE00F)
006100080206     d                                     dtaara
006200080206     d §DatiUte      e ds                  extname(dDatiUte)
006300080206     d                                     dtaara
006400100903     d TNSDUO        e ds                  extname(TNSDUODS)
006500100903     d                                     dtaara
006600080206
006700080206      //---------------------------------------------------------------
006800080206      //?Definizione strutture dati.
006900080206      //---------------------------------------------------------------
007000080206      // - Status
007100080206     d Psds           sds
007200080206     d   SDSpgm          *proc
007300080206
007400080206      // - InfDS
007500080206     d InfDspF         ds
007600080207     d  dsp_aid              369    369a                                        AID byte
007700080207     d  sfl_rrn              376    377i 0                                      Subfile rrn
007800080207     d  min_nrr              378    379i 0                                      Subfile min rrn
007900080207     d  num_rcds             380    381i 0                                      Subfile num rcds
008000080206
008100080206      // - Indicatori su DspF
008200080208     d IndDspF         ds
008300080206        // - Indicatori di errore
008400080206     d  errMessage                    1n   overlay(IndDspF : 28)
008500080606     d  errGenerico                   1n   overlay(IndDspF : 99)
008600080627        // - Indicatori vari
008700100903     d  EmisSBLO                      1n   overlay(IndDspF : 01)
008800100315     d
008900080206
009000080206      // - Reperimento dati utente
009100080206     d TIBS34ds      e ds
009200080206     d dUte01        e ds
009300080702     d DLAT          e ds
009400080702
009500100901     d tnsdulds      e ds
009600100902     d KPJBA         e ds
009700080206
009800080206      // - Ricerca/Controllo tabelle
009900080206     d TIBS02ds      e ds                  inz
010000100316
010100100316
010200080206      //---------------------------------------------------------------
010300080206      //?Definizione variabili globali.
010400080206      //---------------------------------------------------------------
010500080206
010600080206      // - Flags booleani
010700080208     d $Fine           s               n   inz(*off)
010800080206
010900100901     d $Inzd01         s               n   inz(*on)
011000100312     d $Video          s              2    inz('D1')
011100100901     d Indx            s              3  0 inz
011200080414
011300100315     d Dataeur         s               d   datfmt(*eur)
011400100315     d Dataiso         s               d   datfmt(*iso)
011500080605     d Dataymd         s               d   datfmt(*ymd)
011600080605     d Datadmy         s               d   datfmt(*dmy)
011700100901     d Datasys         s               d   inz(*sys)
011800080604     d
011900081009     d
012000080206      //---------------------------------------------------------------
012100080206      //?Definizione procedure usate.
012200080206      //---------------------------------------------------------------
012300080414      /copy gaitrasrc/srcprotopr,tibs34r
012400080206
012500080206      //---------------------------------------------------------------
012600080206      //?Riepilogo indicatori.
012700080206      //---------------------------------------------------------------
012800080207      // - Comuni
012900080207      // 28    : Emissione messaggio di errore a video
013000080207      // - C01/S01
013100080207      // 30    : Condiziona SFLDSP    (*not)
013200080207      // 31    : Condiziona SFLDSPCTL (*not)
013300080207      // 30+31 : Condiziona SFLCLR
013400100824      // 32    : Condiziona SFLNXTCHG
013500080207      // 50    : Errore: Opzione errata
013600080207      // - D01
013700080207      // - Comuni
013800080207      // 99    : Generico di Errore
013900080206      //---------------------------------------------------------------
014000080206
014100080206      //---------------------------------------------------------------
014200080206      //?M A I N - L I N E
014300080206      //---------------------------------------------------------------
014400080206
014500080627     c     *Entry        plist
014600080206     c                   parm                    KPJBA
014700080702
014800080206      /free
014900080206
015000080206       // Operazioni iniziali
015100080206       exsr RoutInz;
015200081215
015300080206       // Gestione video
015400081215 3     DOW $Fine = *off;
015500081215 4       select;
015600080530
015700080530         // Videata di selezioni
015800100312           when $Video = 'D1';
015900100312             exsr GesD01;
016000080530
016100080702           other   ;
016200080206             $Fine = *on;
016300081215 4       endsl;
016400081215 3     ENDDO;
016500080206
016600080206       // Operazioni finali
016700080206       exsr RoutEnd;
016800080206
016900080206       //--------------------------------------------------------------
017000080206       //?Operazioni iniziali.
017100080206       //--------------------------------------------------------------
017200080206       BEGSR RoutInz;
017300100312       $inzd01=*on;
017400080703
017500080206         // Reperimento dati job
017600080206         exsr DatiJob;
017700100903         vscpgm='TNSDUPR'         ;
017800080703
017900080627         ENDSR;
018000080206
018100080206       //--------------------------------------------------------------
018200080206       //?Reperimento Dati del job (Utente/Operativi).
018300080206       //--------------------------------------------------------------
018400080206       BEGSR DatiJob;
018500080206
018600080206         in(E) §AzUte;
018700080206         if NOT %error;
018800080206           in(E) §DatiUte;
018900080206         endif;
019000080206         if %error or RSut = *blanks;
019100080206           clear TIBS34ds;
019200080206           tibs34r(tibs34ds);
019300080206           in §AzUte;
019400080206           in §DatiUte;
019500080206         endif;
019600080206
019700080206       ENDSR;
019800100901       //--------------------------------------------------------------
019900100901       //?Inizializzazione videata 01
020000100901       //--------------------------------------------------------------
020100100901       BEGSR Inzd01  ;
020200100901
020300100901         clear V1cmsg;
020400100901         errMessage  = *off;
020500100901         errGenerico = *off;
020600100903         in *lock   tnsduo ;
020700100903         if §sduodat=0 ;
020800100903         clear v1cdat  ;
020900100903         else                   ;
021000100903         dataiso=%date(§sduodat)  ;
021100100903         dataeur=dataiso  ;
021200100903         v1cdat=%dec(dataeur)  ;
021300100903         endif    ;
021400100903
021500100903         v1cute=§sduoute        ;
021600100907         v1cpgm=§sduopgm         ;
021700100903         v1csblo='NO'  ;
021800100901
021900100901         ENDSR    ;
022000100312       //--------------------------------------------------------------
022100100312       //?Gestione viodeata 01
022200100312       //--------------------------------------------------------------
022300100312       BEGSR Gesd01;
022400100312
022500100312         // Inizializzazione videata
022600100312         if  $Inzd01 = *on;
022700100312            exsr Inzd01;
022800100312            $Inzd01  = *off;
022900100312         endif;
023000100312
023100100312
023200100312         // Emissione Testata e Piede con tasti funzionali abilitati
023300100824         if  errMessage  = *off;
023400100903           write  SDUpT01;
023500100312         endif;
023600100312
023700100312         // Emissione videata
023800100903         exfmt  SDUpD01;
023900100312
024000100312         reset errMessage;
024100100312         reset errGenerico;
024200100903         clear V1cmsg    ;
024300100312
024400100312 1       SELECT;
024500100312
024600100312         // - F3=Fine
024700100312 1         WHEN  dsp_aid = c_F03;
024800100312            $Fine = *on;
024900100312
025000100824 x1      // Invio
025100100312           OTHER;
025200100316
025300100316           exsr CTRD01  ;
025400100901
025500100316
025600100901 2         if ErrGenerico=*ON    ;
025700100316                 leavesr;
025800100316 2             endif;
025900100901
026000100901 2         if    dsp_aid = c_F06;
026100100903 3         if v1csblo='SI'  and emisSBLO=*on  ;
026200100903         clear tnsduo  ;
026300100903         out tnsduo  ;
026400100903         $Fine = *on;
026500100903 3       endif ;
026600100903 2       endif ;
026700100312 1       ENDSL;
026800100312
026900100312       ENDSR;
027000100312
027100100316       //--------------------------------------------------------------
027200100316       //?controlli video 1
027300100316       //--------------------------------------------------------------
027400100316       BEGSR CTRD01  ;
027500100903
027600100907       // data area non bloccata
027700100907       if v1cpgm = *blanks  ;
027800100907       v1cmsg=msg(1)  ;
027900100907       errGenerico=*on  ;
028000100907       errMessage =*on  ;
028100100907       leavesr  ;
028200100907       endif  ;
028300100907
028400100903       if EmisSBLO=*off  ;
028500100903       EmisSblo=*on   ;
028600100903       errGenerico=*on  ;
028700100903       leavesr  ;
028800100903       endif  ;
028900100316
029000100903       if v1csblo ='NO' and  EmisSBLO=*on  ;
029100100903       EmisSBLO=*off  ;
029200100903       errGenerico=*on  ;
029300100903       leavesr  ;
029400100903       endif  ;
029500100708
029600100316       ENDSR  ;
029700080206       //--------------------------------------------------------------
029800080206       //?Operazioni finali.
029900080206       //--------------------------------------------------------------
030000080206       BEGSR RoutEnd;
030100080627
030200100903         unlock tnsduo  ;
030300080704
030400080206         *inLR = *on;
030500080704
030600080206         return;
030700080206
030800080206       ENDSR;
030900080206
031000080206      /end-free
031100100907**
031200100907Nessun blocco al momento attivo   !!
