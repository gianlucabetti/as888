000100160219      //---------------------------------------------------------------
000200160219      //?TNSF10R - Pulizia file WFVPD00F
000300160219      //---------------------------------------------------------------
000400160219     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500160219
000600160219      //---------------------------------------------------------------
000700160219      //?Dichiarazione file.
000800160219      //---------------------------------------------------------------
000900160219
001000160219      //---------------------------------------------------------------
001100160219      //?Definizione costanti.
001200160219      //---------------------------------------------------------------
001300160219
001400160219      //---------------------------------------------------------------
001500160219      //?Definizione schiere.
001600160219      //---------------------------------------------------------------
001700160219
001800160219      //---------------------------------------------------------------
001900160219      //?Definizione aree dati.
002000160219      //---------------------------------------------------------------
002100160219      // - Dati utente
002200160219     d §AzUte        e ds                  extname(AZUTE00F)
002300160219     d                                     dtaara
002400160219     d §DatiUte      e ds                  extname(dDatiUte)
002500160219     d                                     dtaara
002600160219
002700160219      //---------------------------------------------------------------
002800160219      //?Definizione strutture dati.
002900160219      //---------------------------------------------------------------
003000160219      // - Parametri ricevuti
003100160219     d KPJBA         e ds
003200160219
003300160219      // - Reperimento dati utente
003400160219     d TIBS34DS      e ds
003500160219
003600160219      // - Parametri pgm pulizia
003700160222     d ParmTNSF10      DS
003800160219     d  Libreria               1     10
003900160219     d  File                  11     20
004000160222     d  Data                  21     28  0
004100160219
004200160219      //---------------------------------------------------------------
004300160219      //?Definizione variabili globali.
004400160219      //---------------------------------------------------------------
004500160219      // - Campi di comodo data
004600160222     d Data_ISO        s               d   datfmt(*iso)
004700160219
004800160219      // - Campi di comodo
004900160219     d Oggi            s              8s 0
005000160219
005100160219      //---------------------------------------------------------------
005200160219      //?Definizione procedure esterne.
005300160219      //---------------------------------------------------------------
005400160219      // - Pulizia File
005500160222     d tnsf10c         pr                  extpgm('TNSF10C')
005600160219     d  kpjba                              likeds(kpjba)
005700160219
005800160219      //---------------------------------------------------------------
005900160219      //?Definizione prototipi.
006000160219      //---------------------------------------------------------------
006100160219      /copy gaitrasrc/srcprotopr,TIBS34R
006200160219
006300160219      //---------------------------------------------------------------
006400160219      //?Definizione key-list.
006500160219      //---------------------------------------------------------------
006600160219
006700160219      //---------------------------------------------------------------
006800160219      //?Main.
006900160219      //---------------------------------------------------------------
007000160219
007100160219     c     *Entry        plist
007200160219     c                   parm                    kpjba
007300160219
007400160219      /free
007500160219
007600160219      //?Operazioni iniziali
007700160219       exsr RoutInz;
007800160219
007900160219      //?Gestione video
008000160219       exsr Elabora;
008100160219
008200160219      //?Operazioni finali
008300160219       exsr RoutEnd;
008400160219
008500160219      //--------------------------------------------------------------
008600160219      //?Operazioni iniziali.
008700160219      //--------------------------------------------------------------
008800160219       BEGSR RoutInz;
008900160219
009000160219      //?Reperimento dati job
009100160219         exsr DatiJob;
009200160219
009300160219      //?Imposto la data del giorno
009400160222         Oggi = %dec(%date());
009500160219
009600160219       ENDSR;
009700160219
009800160219      //--------------------------------------------------------------
009900160219      //?Reperimento Dati del job (Utente/Operativi).
010000160219      //--------------------------------------------------------------
010100160219       BEGSR DatiJob;
010200160219
010300160219         in(E) §AzUte;
010400160219         IF  NOT %error;
010500160219           in(E) §DatiUte;
010600160219         ENDIF;
010700160219         IF  %error or RSut = *blanks;
010800160219           clear TIBS34ds;
010900160219           tibs34r(tibs34ds);
011000160219           in §AzUte;
011100160219           in §DatiUte;
011200160219         ENDIF;
011300160219
011400160219       ENDSR;
011500160219
011600160219      //--------------------------------------------------------------
011700160219      //?Elabora.
011800160219      //--------------------------------------------------------------
011900160219       BEGSR Elabora;
012000160219
012100160222      //?Imposto il file
012200160222         File = 'WFVPD00F';
012300160219
012400160219      //?Imposto la libreria
012500160219         IF  %subst(knsif:7:1) = 'P';
012600160219           Libreria = 'GAITRAAZP';
012700160219         ELSE;
012800160219           Libreria = 'GAITRAAZM';
012900160219         ENDIF;
013000160219
013100160222      //?Calcolo la data
013200160222      //?Oggi - 30 gg.
013300160222         Data_ISO = %date(Oggi);
013400160222         Data_ISO = Data_ISO - %days(30);
013500160222         Data = %dec(Data_ISO);
013600160219
013700160219      //?Lancio la pulizia
013800160222        kpjbu = parmTNSF10;
013900160222        tnsf10c (kpjba);
014000160219
014100160219       ENDSR;
014200160219
014300160219      //--------------------------------------------------------------
014400160219      //?Operazioni finali.
014500160219      //--------------------------------------------------------------
014600160219       BEGSR RoutEnd;
014700160219
014800160219         *inLR = *on;
014900160219         return;
015000160219
015100160219       ENDSR;
015200160219
015300160219      /end-free
