000100170405      //--------------------------------------------------------------
000200170712      //?TNSF26R - Manutenzione Straordinaria CLIENTI split payment
000300170405      //--------------------------------------------------------------
000400170405     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500170405     h dftactgrp(*no) actgrp(*caller)
000600170405
000700170405      //---------------------------------------------------------------
000800170405      //?Dichiarazione file.
000900170405      //---------------------------------------------------------------
001200170405
001300170712      // - Anagrafica Clienti
001400170713     fYBACL01L  uf   e           k disk
001500170406
001600170712      // - Anagrafica Clienti split payment
001700170712     fanspikcF  o    e             disk
003400170405
003500170405      //---------------------------------------------------------------
003600170405      //?Definizione costanti.
003700170405      //---------------------------------------------------------------
006800170405
006900170405      //---------------------------------------------------------------
007000170405      //?Definizione schiere.
007100170405      //---------------------------------------------------------------
008400170405
008500170405      //---------------------------------------------------------------
008600170405      //?Definizione aree dati.
008700170405      //---------------------------------------------------------------
008800170405      // - Dati utente
008900170405     d §AzUte        e ds                  extname(AZUTE00F)
009000170405     d                                     dtaara
009100170405     d §DatiUte      e ds                  extname(dDatiUte)
009200170405     d                                     dtaara
009300170405
009400170405      //---------------------------------------------------------------
009500170405      //?Definizione strutture dati.
009600170405      //---------------------------------------------------------------
014500170405
014600170405      // - Parametri ricevuti
014700170405     d KPJBA         e ds
014800170405
019300170405
019400170405      //---------------------------------------------------------------
019500170405      //?Definizione variabili globali.
019600170405      //---------------------------------------------------------------
019700170405      // - Flags booleani
020000170405     d Fine            s               n   inz(*off)
020100170405     d RecOK           s               n   inz(*off)
020300170405     d wEoF            s               n   inz(*off)
020500170405     d wEnd            s               n   inz(*off)
020501170712
020502170712      // campi di comodo
020503170712     d Societa         s              3    inz('201')
020504170712     d K_aclkcc        s                   like(aclkcc)
020505170712     d K_aclksc        s                   like(aclksc)
032200170405
032300170405      //---------------------------------------------------------------
032400170405      //?Definizione procedure usate.
032500170405      //---------------------------------------------------------------
037200170405
037300170405      //---------------------------------------------------------------
037400170405      //?Definizione Prototipi.
037500170405      //---------------------------------------------------------------
038500170405
038600170405      //---------------------------------------------------------------
038700170405      //?Definizione key-list.
038800170405      //---------------------------------------------------------------
039200170405
039300170405      //---------------------------------------------------------------
039400170405      //?M A I N - L I N E
039500170405      //---------------------------------------------------------------
039600170405     c     *Entry        plist
039700170405     c                   parm                    kpjba
039800170405
039900170405      /free
040000170405
040100170405       //?Operazioni iniziali
040200170405       exsr RoutInz;
040300170405
040400170405       //?Gestione video
040500170712       exsr Elabora;
041700170405
041800170405       //?Operazioni finali
041900170405       exsr RoutEnd;
042000170405
042100170405       //--------------------------------------------------------------
042200170405       //?Operazioni iniziali.
042300170405       //--------------------------------------------------------------
042400170405       BEGSR RoutInz;
042500170405
042600170405         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
042700170405
043700170405       //?Reperimento dati job
043800170405         exsr DatiJob;
051800170405
051900170405       ENDSR;
052000170405
052100170405       //--------------------------------------------------------------
052200170405       //?Reperimento Dati del job (Utente/Operativi).
052300170405       //--------------------------------------------------------------
052400170405       BEGSR DatiJob;
052500170405
052600170405         in(E) §AzUte;
052700170405         IF  NOT %error;
052800170405           in(E) §DatiUte;
052900170405         ENDIF;
053000170405         IF  %error or RSut = *blanks;
053100170405           clear TIBS34ds;
053200170405           tibs34r(tibs34ds);
053300170405           in §AzUte;
053400170405           in §DatiUte;
053500170405         ENDIF;
053600170405
053700170405       ENDSR;
053800170405
137701170712       //--------------------------------------------------------------
137702170712       //?Gestione elaborazione dati
137703170712       //--------------------------------------------------------------
137704170712       BEGSR Elabora;
137705170712
137900170405
138000170405         wEoF = *off;
138100170405
139000170405
139100170712       //?Leggo TUTTI i clienti che sono P.Iva o codice fiscale uguale a elenco soggetti
139101170712       //?SPLIT PAYMENT
139200170405         exec sql
139300170712         DECLARE CLIENTE cursor for
139400170712         SELECT indkcc , indksc        from anspi00F
139401170712         join cnind00f on spiiva = indiva or
139500170713         spiiva = indcdf ;
139800170405
139900170712         exec sql open CLIENTE;
140000170405
140100170405         IF  sqlcode < 0;
140200170405           wEoF = *on;
140300170712           exec sql close CLIENTE;
140400170405           leavesr;
140500170405         ENDIF;
140600170405
140700170405         DOW  not wEoF;
140800170405           exec sql
140900170712           fetch next from CLIENTE into :INDKCC, :INDKSC;
141000170405           IF  sqlcod = 100 or sqlcod < 0;
141100170405             wEoF = *on;
141200170405             leave;
141300170405           ENDIF;
141400170405
141500170712         //?Per ogni CLIENTE aggancio YBACL ed aggiorno
141600170405           exsr Leggo_Anagrafica;
141700170405
141800170405         ENDDO;
141900170405
142000170712         exec sql close CLIENTE;
142100170405
142200170405       ENDSR;
142300170405
142301170712
142302170712       //--------------------------------------------------------------
142303170712       //?Leggo Anagrafiche Clienti per aggiornare tipo fattura
142304170712       //--------------------------------------------------------------
142305170712       BEGSR Leggo_Anagrafica;
142306170712
218900170712           K_ACLKCC = *ALL-'0';
218901170712         //?Aggancio YBACL
218902170712           chain (CLPkut:CLPkcc:CLPksc) CNACO00F;
218903170712
219000170405       //--------------------------------------------------------------
219100170405       //?Operazioni finali.
219200170405       //--------------------------------------------------------------
219300170405       BEGSR RoutEnd;
219400170405
219500170405         *inLR = *on;
219600170405         return;
219700170405
219800170405       ENDSR;
219900170405
220000170405      /end-free
220100170405
