000100150727      //--------------------------------------------------------------
000200150727      //?TNTA030R - ELENCO CLIENTI ATTIVI SENZA MAIL x P.L.
000300150727      //--------------------------------------------------------------
000400150727
000500150727     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600150727
000700150727      //---------------------------------------------------------------
000800150727      //?Dichiarazione file.
000900150727      //---------------------------------------------------------------
001000150727
001100150727      // - Organigramma
001200150727     fAZORG01L  if   e           k disk
001300150727
001400150727      // - Video
001500150727     fTNTA030D  cf   e             workstn
001600150727     f                                     indds(IndDspF)
001700150727     f                                     infds(InfDspF)
001800150727
001900150727      //---------------------------------------------------------------
002000150727      //?Definizione costanti.
002100150727      //---------------------------------------------------------------
002200150727
002300150727      // - Tasti funzionali a video
002400150727     d c_F01           c                   const(x'31')
002500150727     d c_F02           c                   const(x'32')
002600150727     d c_F03           c                   const(x'33')
002700150727     d c_F04           c                   const(x'34')
002800150727     d c_F05           c                   const(x'35')
002900150727     d c_F06           c                   const(x'36')
003000150727     d c_F07           c                   const(x'37')
003100150727     d c_F08           c                   const(x'38')
003200150727     d c_F09           c                   const(x'39')
003300150727     d c_F10           c                   const(x'3A')
003400150727     d c_F11           c                   const(x'3B')
003500150727     d c_F12           c                   const(x'3C')
003600150727     d c_F13           c                   const(x'B1')
003700150727     d c_F14           c                   const(x'B2')
003800150727     d c_F15           c                   const(x'B3')
003900150727     d c_F16           c                   const(x'B4')
004000150727     d c_F17           c                   const(x'B5')
004100150727     d c_F18           c                   const(x'B6')
004200150727     d c_F19           c                   const(x'B7')
004300150727     d c_F20           c                   const(x'B8')
004400150727     d c_F21           c                   const(x'B9')
004500150727     d c_F22           c                   const(x'BA')
004600150727     d c_F23           c                   const(x'BB')
004700150727     d c_F24           c                   const(x'BC')
004800150727     d c_Enter         c                   const(x'F1')
004900150727     d c_RollDown      c                   const(x'F4')
005000150727     d c_RollUp        c                   const(x'F5')
005100150727
005200150727     d Digits          c                   const('0123456789')
005300150727
005400150727      //---------------------------------------------------------------
005500150727      //?Definizione schiere.
005600150727      //---------------------------------------------------------------
005700150727
005800150727      // - Messaggi di errore
005900150727     d Msg             s             78    dim(30) ctdata perrcd(1)
006000150727
006100150727      //---------------------------------------------------------------
006200150727      //?Definizione aree dati.
006300150727      //---------------------------------------------------------------
006400150727
006500150727      // - Dati utente
006600150727     d §AzUte        e ds                  extname(AZUTE00F)
006700150727     d                                     dtaara
006800150727     d §DatiUte      e ds                  extname(dDatiUte)
006900150727     d                                     dtaara
007000150727
007100150727      //---------------------------------------------------------------
007200150727      //?Definizione strutture dati.
007300150727      //---------------------------------------------------------------
007400150727
007500150727      // - Status
007600150727     d Psds           sds
007700150727     d   SDSpgm          *proc
007800150727
007900150727      // - InfDS
008000150727     d InfDspF         ds
008100150727     d  dsp_aid              369    369a
008200150727     d  sfl_rrn              376    377i 0
008300150727     d  min_nrr              378    379i 0
008400150727     d  num_rcds             380    381i 0
008500150727
008600150727      // - Indicatori su DspF
008700150727     d IndDspF         ds
008800150727        // - Indicatori di errore in videata
008900150727     d  ErrMessage                    1n   overlay(IndDspF : 28)
009000150727        // - Indicatori di errore
009100150727     d  PosCurFIL                     1n   overlay(IndDspF : 50)
009200150727        // - Indicatori di errore generico
009300150727     d  ErrGenerico                   1n   overlay(IndDspF : 99)
009400150727
009500150727     d WindDspF        ds                  inz
009600150727     d  WindDspFa              1     49    inz(*zero)
009700150727     d  WindDspFb             50     99    inz(*zero)
009800150727
009900150727      // - Parametri ricevuti
010000150727     d KPJBA         e ds
010100150727
010200150727      // - Reperimento dati utente
010300150727     d TIBS34DS      e ds
010400150727
010500150727      // - Controllo abilitazioni
010600150727     d TNTAA1DS      e ds                  inz
010700150727
010800150727      // - Stampa
010900150727     d TNTA03DS      e ds                  inz
011000150727
011100150727      // - Reperimento filiali gestite dall'utente
011200150727     d TRUL31DS      e ds
011300150727     d  POG                   10    759    DIM(250)
011400150727
011500150727      //---------------------------------------------------------------
011600150727      //?Definizione variabili globali.
011700150727      //---------------------------------------------------------------
011800150727
011900150727      // - Flags booleani
012000150727     d ErrGrave        s               n   inz(*off)
012100150727     d Fine            s               n   inz(*off)
012200150727     d wInzD02         s               n   inz(*off)
012300150727
012400150727      // - Indici di schiera
012500150727     d xx              s              4s 0 inz
012600150727
012700150727      // - Campi associati al video
012800150727     d Video           s              2a   inz('D2')
012900150727
013000150727      // - Campi di comodo
013100150727     d Oggi            s              8s 0 inz
013200150727     d wabi            s                   like(OTAA1cabi) inz
013300150727     d w003a           s              3a   inz
013400150727
013500150727      //---------------------------------------------------------------
013600150727      //?Definizione procedure usate.
013700150727      //---------------------------------------------------------------
013800150727
013900150727      // - Sottomissione lavoro batch
014000150727     d bch10           pr                  extpgm('BCH10')
014100150727     d  kpjba                              likeds(KPJBA)
014200150727
014300150727       // - Stampa
014400150727     d TNTA03R         pr                  extpgm('TNTA03R')
014500150727     d  kpjba                              likeds(kpjba)
014600150727
014700150727       // - Caricamento Filiali in gestione
014800150727     d TRUL31R         pr                  extpgm('TRUL31R')
014900150727     d  kpjba                              likeds(kpjba)
015000150727     d  trul31ds                           likeds(trul31ds)
015100150727
015200150727      //---------------------------------------------------------------
015300150727      //?Definizione Prototipi.
015400150727      //---------------------------------------------------------------
015500150727
015600150727      /copy gaitrasrc/srcprotopr,TIBS34R
015700150727      /copy gaitrasrc/srcprotopr,TNTAA1C
015800150727
015900150727      //---------------------------------------------------------------
016000150727      //?Definizione key-list.
016100150727      //---------------------------------------------------------------
016200150727
016300150727      //---------------------------------------------------------------
016400150727      //?M A I N - L I N E
016500150727      //---------------------------------------------------------------
016600150727
016700150727     c     *Entry        plist
016800150727     c                   parm                    kpjba
016900150727
017000150727      /free
017100150727
017200150727       //?Operazioni iniziali
017300150727       exsr RoutInz;
017400150727
017500150727       //?Gestione video
017600150727       DOW  Fine = *off;
017700150727         SELECT;
017800150727           WHEN  Video = 'D2';
017900150727             exsr GesD02;
018000150727           OTHER;
018100150727             Fine = *on;
018200150727         ENDSL;
018300150727       ENDDO;
018400150727
018500150727       //?Operazioni finali
018600150727       exsr RoutEnd;
018700150727
018800150727       //--------------------------------------------------------------
018900150727       //?Operazioni iniziali.
019000150727       //--------------------------------------------------------------
019100150727       BEGSR RoutInz;
019200150727
019300150727       //?Impostazione campi "fissi"
019400150727         V01pgm = SDSpgm;
019500150727         Video = 'D2';
019600150727         wInzD02 = *on;
019700150727
019800150727       //?Imposto oggi
019900150727         Oggi = %dec(%date());
020000150727
020100150727       //?Reperimento dati job
020200150727         exsr DatiJob;
020300150727
020400150727       //?Controllo abilitazione utente
020500150727         reset TNTAA1DS;
020600150727         ITAA1caut = '§utegtc';
020700150727         clear kpjbu;
020800150727         kpjbu = TNTAA1DS;
020900150727         tntaa1c (kpjba);
021000150727         TNTAA1DS = kpjbu;
021100150727
021200150727         IF  OTAA1fabi = 'N';
021300150727           ErrGrave = *on;
021400150727           leavesr;
021500150727         ENDIF;
021600150727         wabi = OTAA1cabi;
021700150727
021800150727       //?Carico le filiali abilitate all'utente
021900150727         clear TRUL31DS;
022000150727         I31abi = wabi;
022100150727         I31cdi = DUTdis;
022200150727         I31car = DUTare;
022300150727         I31cpo = DUTpou;
022400150727         TRUL31R (kpjba:trul31ds);
022500150727         IF O31pog <= *zeros;
022600150727           ErrGrave = *on;
022700150727           leavesr;
022800150727         ENDIF;
022900150727
023000150727       ENDSR;
023100150727
023200150727       //--------------------------------------------------------------
023300150727       //?Reperimento Dati del job (Utente/Operativi).
023400150727       //--------------------------------------------------------------
023500150727       BEGSR DatiJob;
023600150727
023700150727         in(E) §AzUte;
023800150727         IF  NOT %error;
023900150727           in(E) §DatiUte;
024000150727         ENDIF;
024100150727         IF  %error or RSut = *blanks;
024200150727           clear TIBS34ds;
024300150727           tibs34r(tibs34ds);
024400150727           in §AzUte;
024500150727           in §DatiUte;
024600150727         ENDIF;
024700150727
024800150727       ENDSR;
024900150727
025000150727       //--------------------------------------------------------------
025100150727       //?Gestione videata D02.
025200150727       //--------------------------------------------------------------
025300150727       BEGSR GesD02;
025400150727
025500150727       //?Inizializzazione videata
025600150727         IF  wInzD02;
025700150727           exsr InzD02;
025800150727           wInzD02 = *off;
025900150727         ENDIF;
026000150727
026100150727       //?Se errore grave emetto messaggio poi esco
026200150727         IF  ErrGrave;
026300150727           ErrMessage  = *on;
026400150727           ErrGenerico = *on;
026500150727           V02msg = Msg(01);
026600150727         ENDIF;
026700150727
026800150727       //?Emissione Testata
026900150727         write  TA030T01;
027000150727
027100150727       //?Emissione videata
027200150727         exfmt  TA030D02;
027300150727         reset ErrMessage;
027400150727         reset ErrGenerico;
027500150727         clear V02msg;
027600150727
027700150727         SELECT;
027800150727
027900150727       //?- Errore Grave esco
028000150727           WHEN  ErrGrave;
028100150727             Fine = *on;
028200150727
028300150727       //?- F03=Fine
028400150727           WHEN  dsp_aid = c_F03;
028500150727             exsr F03D02;
028600150727
028700150727       //?- F06=Conferma
028800150727           WHEN  dsp_aid = c_F06;
028900150727             exsr ContrD02;
029000150727             IF  ErrGenerico;
029100150727               leavesr;
029200150727             ENDIF;
029300150727             exsr F06D02;
029400150727
029500150727       //?Invio
029600150727           OTHER;
029700150727             exsr ContrD02;
029800150727             IF  ErrGenerico;
029900150727               leavesr;
030000150727             ENDIF;
030100150727
030200150727         ENDSL;
030300150727
030400150727       ENDSR;
030500150727
030600150727       //--------------------------------------------------------------
030700150727       //?Inizializzazione Videata D02.
030800150727       //--------------------------------------------------------------
030900150727       BEGSR InzD02;
031000150727
031100150727       //?Pulizia videata
031200150727         clear TA030D02;
031300150727
031400150727       //?Se errore grave non imposto più niente
031500150727         IF  ErrGrave;
031600150727           leavesr;
031700150727         ENDIF;
031800150727
031900150727       //?Filiale
032000150727         V02fil = DUTpou;
032100150727         exsr ContrFil;
032200150727
032300150727       ENDSR;
032400150727
032500150727       //--------------------------------------------------------------
032600150727       //?Gestione tasto funzionale F03 da videata D02
032700150727       //?F03=Fine
032800150727       //--------------------------------------------------------------
032900150727       BEGSR F03D02;
033000150727
033100150727       //?Chiusura del programma
033200150727         Fine = *on;
033300150727
033400150727       ENDSR;
033500150727
033600150727       //--------------------------------------------------------------
033700150727       //?Gestione tasto funzionale F06 da videata D02
033800150727       //?F06=Conferma
033900150727       //--------------------------------------------------------------
034000150727       BEGSR F06D02;
034100150727
034200150727         clear TNTA03DS;
034300150727         ITA03abi = wabi;
034400150727         ITA03fil = V02fil;
034500150727
034600150727         kcoaz = 'TA03';
034700150727         kpjbu = TNTA03DS;
034800150727         kbuff = *blanks;
034900150727
035000150727       //?Richiamo interattivo
035100150727         IF  knmus = *all'1';
035200150727           TNTA03R(kpjba);
035300150727       //?Richiamo batch
035400150727         ELSE;
035500150727           BCH10(kpjba);
035600150727         ENDIF;
035700150727
035800150727       //?Chiusura del programma
035900150727         Fine = *on;
036000150727
036100150727       ENDSR;
036200150727
036300150727       //--------------------------------------------------------------
036400150727       //?Controlla Videata D02.
036500150727       //--------------------------------------------------------------
036600150727       BEGSR ContrD02;
036700150727
036800150727         WindDspF = IndDspF;
036900150727         reset WindDspFb;
037000150727         IndDspF  = WindDspF;
037100150727
037200150727       //?Filiale
037300150727         IF  V02fil > 0 and V02fil <> 046;
037400150727           exsr ContrFil;
037500150727         ENDIF;
037600150727
037700150727       ENDSR;
037800150727
037900150727       //--------------------------------------------------------------
038000150727       //?Controllo Filiale.
038100150727       //--------------------------------------------------------------
038200150727       BEGSR ContrFil;
038300150727
038400150727       //?Deve essere una Filiale abilitata all'utente
038500150727         clear xx;
038600150727         w003a = %editc(V02fil:'X');
038700150727         xx = %lookup(w003a:POG);
038800150727         IF  xx = 0;
038900150727           ErrMessage  = *on;
039000150727           ErrGenerico = *on;
039100150727           PosCurFIL   = *on;
039200150727           V02msg = Msg(02);
039300150727           leavesr;
039400150727         ENDIF;
039500150727
039600150727         chain V02fil AZORG01L;
039700150727         IF  not %found(AZORG01L) or ORGfva <> *blanks;
039800150727           ErrMessage  = *on;
039900150727           ErrGenerico = *on;
040000150727           PosCurFIL   = *on;
040100150727           V02msg = Msg(03);
040200150727           leavesr;
040300150727         ENDIF;
040400150727
040500150727         V02fild = ORGdes;
040600150727
040700150727       ENDSR;
040800150727
040900150727       //--------------------------------------------------------------
041000150727       //?Operazioni finali.
041100150727       //--------------------------------------------------------------
041200150727       BEGSR RoutEnd;
041300150727
041400150727         *inLR = *on;
041500150727         return;
041600150727
041700150727       ENDSR;
041800150727
041900150727      /end-free
042000150727
042100150727       //--------------------------------------------------------------
042200150727       //?Schiere a tempo di compilazione.
042300150727       //--------------------------------------------------------------
042400150727
042500150727** -- MSG -------------------------------------------------------------------*
042600150727Utente non abilitato alla Funzione.                                            1
042700150727Filiale NON in gestione all'utente                                             2
042800150727Filiale errata                                                                 3
