000100150422      //--------------------------------------------------------------
000200150422      //?TNTA05R - ELENCO CLIENTI ATTIVI SENZA IBAN
000300150422      //--------------------------------------------------------------
000400150422
000500150422     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600150422
000700150422      //---------------------------------------------------------------
000800150422      //?Dichiarazione file.
000900150422      //---------------------------------------------------------------
001000150422
001100150422      // - Organigramma
001200150422     fAZORG01L  if   e           k disk
001300150422
001400150422      // - Video
001500150422     fTNTA05D   cf   e             workstn
001600150422     f                                     indds(IndDspF)
001700150422     f                                     infds(InfDspF)
001800150422
001900150422      //---------------------------------------------------------------
002000150422      //?Definizione costanti.
002100150422      //---------------------------------------------------------------
002200150422
002300150422      // - Tasti funzionali a video
002400150422     d c_F01           c                   const(x'31')
002500150422     d c_F02           c                   const(x'32')
002600150422     d c_F03           c                   const(x'33')
002700150422     d c_F04           c                   const(x'34')
002800150422     d c_F05           c                   const(x'35')
002900150422     d c_F06           c                   const(x'36')
003000150422     d c_F07           c                   const(x'37')
003100150422     d c_F08           c                   const(x'38')
003200150422     d c_F09           c                   const(x'39')
003300150422     d c_F10           c                   const(x'3A')
003400150422     d c_F11           c                   const(x'3B')
003500150422     d c_F12           c                   const(x'3C')
003600150422     d c_F13           c                   const(x'B1')
003700150422     d c_F14           c                   const(x'B2')
003800150422     d c_F15           c                   const(x'B3')
003900150422     d c_F16           c                   const(x'B4')
004000150422     d c_F17           c                   const(x'B5')
004100150422     d c_F18           c                   const(x'B6')
004200150422     d c_F19           c                   const(x'B7')
004300150422     d c_F20           c                   const(x'B8')
004400150422     d c_F21           c                   const(x'B9')
004500150422     d c_F22           c                   const(x'BA')
004600150422     d c_F23           c                   const(x'BB')
004700150422     d c_F24           c                   const(x'BC')
004800150422     d c_Enter         c                   const(x'F1')
004900150422     d c_RollDown      c                   const(x'F4')
005000150422     d c_RollUp        c                   const(x'F5')
005100150422
005200150422     d Digits          c                   const('0123456789')
005300150422
005400150422      //---------------------------------------------------------------
005500150422      //?Definizione schiere.
005600150422      //---------------------------------------------------------------
005700150422
005800150422      // - Messaggi di errore
005900150422     d Msg             s             78    dim(30) ctdata perrcd(1)
006000150422
006100150422      //---------------------------------------------------------------
006200150422      //?Definizione aree dati.
006300150422      //---------------------------------------------------------------
006400150422
006500150422      // - Dati utente
006600150422     d §AzUte        e ds                  extname(AZUTE00F)
006700150422     d                                     dtaara
006800150422     d §DatiUte      e ds                  extname(dDatiUte)
006900150422     d                                     dtaara
007000150422
007100150422      //---------------------------------------------------------------
007200150422      //?Definizione strutture dati.
007300150422      //---------------------------------------------------------------
007400150422
007500150422      // - Status
007600150422     d Psds           sds
007700150422     d   SDSpgm          *proc
007800150422
007900150422      // - InfDS
008000150422     d InfDspF         ds
008100150422     d  dsp_aid              369    369a
008200150422     d  sfl_rrn              376    377i 0
008300150422     d  min_nrr              378    379i 0
008400150422     d  num_rcds             380    381i 0
008500150422
008600150422      // - Indicatori su DspF
008700150422     d IndDspF         ds
008800150422        // - Indicatori di errore in videata
008900150422     d  ErrMessage                    1n   overlay(IndDspF : 28)
009000150422        // - Indicatori di errore
009100150422     d  PosCurFIL                     1n   overlay(IndDspF : 50)
009200150422        // - Indicatori di errore generico
009300150422     d  ErrGenerico                   1n   overlay(IndDspF : 99)
009400150422
009500150422     d WindDspF        ds                  inz
009600150422     d  WindDspFa              1     49    inz(*zero)
009700150422     d  WindDspFb             50     99    inz(*zero)
009800150422
009900150422      // - Parametri ricevuti
010000150422     d KPJBA         e ds
010100150422
010200150422      // - Reperimento dati utente
010300150422     d TIBS34DS      e ds
010400150422
010500150422      // - Controllo abilitazioni
010600150422     d TNTAA1DS      e ds                  inz
010700150422
010800150422      // - Stampa
010900150422     d TNTA06DS      e ds                  inz
011000150422
011100150422      // - Reperimento filiali gestite dall'utente
011200150422     d TRUL31DS      e ds
011300150422     d  POG                   10    759    DIM(250)
011400150422
011500150422      //---------------------------------------------------------------
011600150422      //?Definizione variabili globali.
011700150422      //---------------------------------------------------------------
011800150422
011900150422      // - Flags booleani
012000150422     d ErrGrave        s               n   inz(*off)
012100150422     d Fine            s               n   inz(*off)
012200150422     d wInzD02         s               n   inz(*off)
012300150422
012400150422      // - Indici di schiera
012500150422     d xx              s              4s 0 inz
012600150422
012700150422      // - Campi associati al video
012800150422     d Video           s              2a   inz('D2')
012900150422
013000150422      // - Campi di comodo
013100150422     d Oggi            s              8s 0 inz
013200150422     d wabi            s                   like(OTAA1cabi) inz
013300150422     d w003a           s              3a   inz
013400150422
013500150422      //---------------------------------------------------------------
013600150422      //?Definizione procedure usate.
013700150422      //---------------------------------------------------------------
013800150422
013900150422      // - Sottomissione lavoro batch
014000150422     d bch10           pr                  extpgm('BCH10')
014100150422     d  kpjba                              likeds(KPJBA)
014200150422
014300150422       // - Stampa
014400150422     d TNTA06R         pr                  extpgm('TNTA06R')
014500150422     d  kpjba                              likeds(kpjba)
014600150422
014700150422       // - Caricamento Filiali in gestione
014800150422     d TRUL31R         pr                  extpgm('TRUL31R')
014900150422     d  kpjba                              likeds(kpjba)
015000150422     d  trul31ds                           likeds(trul31ds)
015100150422
015200150422      //---------------------------------------------------------------
015300150422      //?Definizione Prototipi.
015400150422      //---------------------------------------------------------------
015500150422
015600150422      /copy gaitrasrc/srcprotopr,TIBS34R
015700150422      /copy gaitrasrc/srcprotopr,TNTAA1C
015800150422
015900150422      //---------------------------------------------------------------
016000150422      //?Definizione key-list.
016100150422      //---------------------------------------------------------------
016200150422
016300150422      //---------------------------------------------------------------
016400150422      //?M A I N - L I N E
016500150422      //---------------------------------------------------------------
016600150422
016700150422     c     *Entry        plist
016800150422     c                   parm                    kpjba
016900150422
017000150422      /free
017100150422
017200150422       //?Operazioni iniziali
017300150422       exsr RoutInz;
017400150422
017500150422       //?Gestione video
017600150422       DOW  Fine = *off;
017700150422         SELECT;
017800150422           WHEN  Video = 'D2';
017900150422             exsr GesD02;
018000150422           OTHER;
018100150422             Fine = *on;
018200150422         ENDSL;
018300150422       ENDDO;
018400150422
018500150422       //?Operazioni finali
018600150422       exsr RoutEnd;
018700150422
018800150422       //--------------------------------------------------------------
018900150422       //?Operazioni iniziali.
019000150422       //--------------------------------------------------------------
019100150422       BEGSR RoutInz;
019200150422
019300150422       //?Impostazione campi "fissi"
019400150422         V01pgm = SDSpgm;
019500150422         Video = 'D2';
019600150422         wInzD02 = *on;
019700150422
019800150422       //?Imposto oggi
019900150422         Oggi = %dec(%date());
020000150422
020100150422       //?Reperimento dati job
020200150422         exsr DatiJob;
020300150422
020400150422       //?Controllo abilitazione utente
020500150422         reset TNTAA1DS;
020600150422         ITAA1caut = '§utegtc';
020700150422         clear kpjbu;
020800150422         kpjbu = TNTAA1DS;
020900150422         tntaa1c (kpjba);
021000150422         TNTAA1DS = kpjbu;
021100150422
021200150422         IF  OTAA1fabi = 'N';
021300150422           ErrGrave = *on;
021400150422           leavesr;
021500150422         ENDIF;
021600150422         wabi = OTAA1cabi;
021700150422
021800150422       //?Carico le filiali abilitate all'utente
021900150422         clear TRUL31DS;
022000150422         I31abi = wabi;
022100150422         I31cdi = DUTdis;
022200150422         I31car = DUTare;
022300150422         I31cpo = DUTpou;
022400150422         TRUL31R (kpjba:trul31ds);
022500150422         IF O31pog <= *zeros;
022600150422           ErrGrave = *on;
022700150422           leavesr;
022800150422         ENDIF;
022900150422
023000150422       ENDSR;
023100150422
023200150422       //--------------------------------------------------------------
023300150422       //?Reperimento Dati del job (Utente/Operativi).
023400150422       //--------------------------------------------------------------
023500150422       BEGSR DatiJob;
023600150422
023700150422         in(E) §AzUte;
023800150422         IF  NOT %error;
023900150422           in(E) §DatiUte;
024000150422         ENDIF;
024100150422         IF  %error or RSut = *blanks;
024200150422           clear TIBS34ds;
024300150422           tibs34r(tibs34ds);
024400150422           in §AzUte;
024500150422           in §DatiUte;
024600150422         ENDIF;
024700150422
024800150422       ENDSR;
024900150422
025000150422       //--------------------------------------------------------------
025100150422       //?Gestione videata D02.
025200150422       //--------------------------------------------------------------
025300150422       BEGSR GesD02;
025400150422
025500150422       //?Inizializzazione videata
025600150422         IF  wInzD02;
025700150422           exsr InzD02;
025800150422           wInzD02 = *off;
025900150422         ENDIF;
026000150422
026100150422       //?Se errore grave emetto messaggio poi esco
026200150422         IF  ErrGrave;
026300150422           ErrMessage  = *on;
026400150422           ErrGenerico = *on;
026500150422           V02msg = Msg(01);
026600150422         ENDIF;
026700150422
026800150422       //?Emissione Testata
026900150422         write  TA05T01;
027000150422
027100150422       //?Emissione videata
027200150422         exfmt  TA05D02;
027300150422         reset ErrMessage;
027400150422         reset ErrGenerico;
027500150422         clear V02msg;
027600150422
027700150422         SELECT;
027800150422
027900150422       //?- Errore Grave esco
028000150422           WHEN  ErrGrave;
028100150422             Fine = *on;
028200150422
028300150422       //?- F03=Fine
028400150422           WHEN  dsp_aid = c_F03;
028500150422             exsr F03D02;
028600150422
028700150422       //?- F06=Conferma
028800150422           WHEN  dsp_aid = c_F06;
028900150422             exsr ContrD02;
029000150422             IF  ErrGenerico;
029100150422               leavesr;
029200150422             ENDIF;
029300150422             exsr F06D02;
029400150422
029500150422       //?Invio
029600150422           OTHER;
029700150422             exsr ContrD02;
029800150422             IF  ErrGenerico;
029900150422               leavesr;
030000150422             ENDIF;
030100150422
030200150422         ENDSL;
030300150422
030400150422       ENDSR;
030500150422
030600150422       //--------------------------------------------------------------
030700150422       //?Inizializzazione Videata D02.
030800150422       //--------------------------------------------------------------
030900150422       BEGSR InzD02;
031000150422
031100150422       //?Pulizia videata
031200150422         clear TA05D02;
031300150422
031400150422       //?Se errore grave non imposto più niente
031500150422         IF  ErrGrave;
031600150422           leavesr;
031700150422         ENDIF;
031800150422
031900150422       //?Filiale
032000150422         V02fil = DUTpou;
032100150422         exsr ContrFil;
032200150422
032300150422       ENDSR;
032400150422
032500150422       //--------------------------------------------------------------
032600150422       //?Gestione tasto funzionale F03 da videata D02
032700150422       //?F03=Fine
032800150422       //--------------------------------------------------------------
032900150422       BEGSR F03D02;
033000150422
033100150422       //?Chiusura del programma
033200150422         Fine = *on;
033300150422
033400150422       ENDSR;
033500150422
033600150422       //--------------------------------------------------------------
033700150422       //?Gestione tasto funzionale F06 da videata D02
033800150422       //?F06=Conferma
033900150422       //--------------------------------------------------------------
034000150422       BEGSR F06D02;
034100150422
034200150422         clear TNTA06DS;
034300150422         ITA06abi = wabi;
034400150422         ITA06fil = V02fil;
034500150422
034600150422         kcoaz = 'TA06';
034700150422         kpjbu = TNTA06DS;
034800150422         kbuff = *blanks;
034900150422
035000150422       //?Richiamo interattivo
035100150422         IF  knmus = *all'1';
035200150422           TNTA06R(kpjba);
035300150422       //?Richiamo batch
035400150422         ELSE;
035500150422           BCH10(kpjba);
035600150422         ENDIF;
035700150422
035800150422       //?Chiusura del programma
035900150422         Fine = *on;
036000150422
036100150422       ENDSR;
036200150422
036300150422       //--------------------------------------------------------------
036400150422       //?Controlla Videata D02.
036500150422       //--------------------------------------------------------------
036600150422       BEGSR ContrD02;
036700150422
036800150422         WindDspF = IndDspF;
036900150422         reset WindDspFb;
037000150422         IndDspF  = WindDspF;
037100150422
037200150422       //?Filiale
037300150423         IF  V02fil > 0 and V02fil <> 046;
037400150422           exsr ContrFil;
037500150422         ENDIF;
037600150422
037700150422       ENDSR;
037800150422
037900150422       //--------------------------------------------------------------
038000150422       //?Controllo Filiale.
038100150422       //--------------------------------------------------------------
038200150422       BEGSR ContrFil;
038300150422
038400150422       //?Deve essere una Filiale abilitata all'utente
038500150422         clear xx;
038600150422         w003a = %editc(V02fil:'X');
038700150422         xx = %lookup(w003a:POG);
038800150422         IF  xx = 0;
038900150422           ErrMessage  = *on;
039000150422           ErrGenerico = *on;
039100150422           PosCurFIL   = *on;
039200150422           V02msg = Msg(02);
039300150422           leavesr;
039400150422         ENDIF;
039500150422
039600150422         chain V02fil AZORG01L;
039700150422         IF  not %found(AZORG01L) or ORGfva <> *blanks;
039800150422           ErrMessage  = *on;
039900150422           ErrGenerico = *on;
040000150422           PosCurFIL   = *on;
040100150422           V02msg = Msg(03);
040200150422           leavesr;
040300150422         ENDIF;
040400150422
040500150422         V02fild = ORGdes;
040600150422
040700150422       ENDSR;
040800150422
040900150422       //--------------------------------------------------------------
041000150422       //?Operazioni finali.
041100150422       //--------------------------------------------------------------
041200150422       BEGSR RoutEnd;
041300150422
041400150422         *inLR = *on;
041500150422         return;
041600150422
041700150422       ENDSR;
041800150422
041900150422      /end-free
042000150422
042100150422       //--------------------------------------------------------------
042200150422       //?Schiere a tempo di compilazione.
042300150422       //--------------------------------------------------------------
042400150422
042500150422** -- MSG -------------------------------------------------------------------*
042600150422Utente non abilitato alla Funzione.                                            1
042700150422Filiale NON in gestione all'utente                                             2
042800150422Filiale errata                                                                 3
