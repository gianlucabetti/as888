000100141017       //==============================================================
000200141017       //?TEST - Controllo Singola Tariffa / Offerta                   ?
000300141017       //==============================================================
000400141017
000500141017       //--------------------------------------------------------------
000600141017       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700141017       //--------------------------------------------------------------
000800141017
000900141017     /*END
001000141017
001100141017       //--------------------------------------------------------------
001200141017       //?Specifiche di controllo.                                     ?
001300141017       //--------------------------------------------------------------
001400141017
001500141017     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001600141017     h dftactgrp(*no) actgrp('QILE')
001700141017
001800141017       //--------------------------------------------------------------
001900141017       //?Dichiarazione file.                                          ?
002000141017       //--------------------------------------------------------------
002100141017
002200141017       // -?Video?
002300141017     fTNTA48TSTDcf   e             workstn
002400141017     f                                     indds(IndDspF)
002500141017     f                                     infds(InfDspF)
002600141017
002700141017       //--------------------------------------------------------------
002800141017       //?Definizione costanti.                                        ?
002900141017       //--------------------------------------------------------------
003000141017
003100141017       // -?Tasti funzionali a video?
003200141017     d c_F01           c                   const(x'31')
003300141017     d c_F02           c                   const(x'32')
003400141017     d c_F03           c                   const(x'33')
003500141017     d c_F04           c                   const(x'34')
003600141017     d c_F05           c                   const(x'35')
003700141017     d c_F06           c                   const(x'36')
003800141017     d c_F07           c                   const(x'37')
003900141017     d c_F08           c                   const(x'38')
004000141017     d c_F09           c                   const(x'39')
004100141017     d c_F10           c                   const(x'3A')
004200141017     d c_F11           c                   const(x'3B')
004300141017     d c_F12           c                   const(x'3C')
004400141017     d c_F13           c                   const(x'B1')
004500141017     d c_F14           c                   const(x'B2')
004600141017     d c_F15           c                   const(x'B3')
004700141017     d c_F16           c                   const(x'B4')
004800141017     d c_F17           c                   const(x'B5')
004900141017     d c_F18           c                   const(x'B6')
005000141017     d c_F19           c                   const(x'B7')
005100141017     d c_F20           c                   const(x'B8')
005200141017     d c_F21           c                   const(x'B9')
005300141017     d c_F22           c                   const(x'BA')
005400141017     d c_F23           c                   const(x'BB')
005500141017     d c_F24           c                   const(x'BC')
005600141017     d c_Enter         c                   const(x'F1')
005700141017     d c_RollDown      c                   const(x'F4')
005800141017     d c_RollUp        c                   const(x'F5')
005900141017
006000141017       //--------------------------------------------------------------
006100141017       //?Definizione schiere.                                         ?
006200141017       //--------------------------------------------------------------
006300141017
006400141017       // -?Messaggi di errore?
006500141017     d sk_Msg          s             78    dim( 2) ctdata perrcd(1)
006600141017
006700141017       //--------------------------------------------------------------
006800141017       //?Definizione aree dati.                                       ?
006900141017       //--------------------------------------------------------------
007000141017
007100141017       // -?Dati utente?
007200141017     d §AzUte        e ds                  extname(AZUTE00F)
007300141017     d                                     dtaara
007400141017     d §DatiUte      e ds                  extname(dDatiUte)
007500141017     d                                     dtaara
007600141017
007700141017       //--------------------------------------------------------------
007800141017       //?Definizione strutture dati.                                  ?
007900141017       //--------------------------------------------------------------
008000141017
008100141017       // -?Status ds?
008200141017     d Status         sds
008300141017     d   SDSpgm          *proc
008400141017     d   SDSprm          *parms
008500141017     d   SDSusr              254    263
008600141017
008700141017       // -?InfDS?
008800141017     d InfDspF         ds
008900141017     d   dsp_aid             369    369a
009000141017
009100141017       // -?Indicatori su DspF?
009200141017     d IndDspF         ds
009300141017         // -?(Dis)Abilitazione tasti funzionali?
009400141017     d   AbilitF04                     n   overlay(IndDspF : 04)
009500141017     d   AbilitF05                     n   overlay(IndDspF : 05)
009600141017     d   AbilitF06                     n   overlay(IndDspF : 06)
009700141017     d   AbilitF12                     n   overlay(IndDspF : 12)
009800141017         // -?Indicatori di errore?
009900141017     d   ErrMessage                    n   overlay(IndDspF : 28)
010000141017     d   ErrGenerico                   n   overlay(IndDspF : 99)
010100141017
010200141017       // -?Parametri ricevuti?
010300141017     d KPJBA         e ds
010400141017
010500141017       //--------------------------------------------------------------
010600141017       //?Definizione variabili globali.                               ?
010700141017       //--------------------------------------------------------------
010800141017
010900141017       // -?Flags booleani?
011000141017     d $Fine           s               n   inz(*off)
011100141017     d $InzD01         s               n   inz(*on)
011200141017
011300141017       //--------------------------------------------------------------
011400141017       //?Definizione procedure usate.                                 ?
011500141017       //--------------------------------------------------------------
011600141017
011700141017       // -?Reperimento dati utente?
011800141017     d TIBS34ds      e ds
011900141017      /copy gaitrasrc/srcProtoPR,TIBS34R
012000141017
012100141017       // -?Interrogazione Trattative?
012200141017     d tnta87r         pr                  extpgm('TNTA87R')
012300141017     d   kpjba                             likeds(KPJBA)
012400141017       // -?Interrogazione Attività?
012500141017     d*// TRMK19ds      e ds                  inz
012600141017     d*// trmk21r         pr                  extpgm('TRMK21R')
012700141017     d*//   kpjba                             likeds(KPJBA)
012800141017     d*//   trmk19ds                          likeds(TRMK19ds)
012900141017
013000141017       // -?Interrogazione Tariffe?
013100141017     d tnta02r         pr                  extpgm('TNTA02R')
013200141017     d   kpjba                             likeds(KPJBA)
013300141017
013400141017       // -?Controllo Singola Tariffa / Offerta?
013500141017     d TNTA48ds      e ds                  inz
013600141017     d tnta48r         pr                  extpgm('TNTA48R')
013700141017     d   tnta48ds                          likeds(TNTA48ds)
013800141017
013900141017       //--------------------------------------------------------------
014000141017       //?Definizione key-list.                                        ?
014100141017       //--------------------------------------------------------------
014200141017
014300141017
014400141017       //--------------------------------------------------------------
014500141017       //?Riepilogo indicatori.                                        ?
014600141017       //--------------------------------------------------------------
014700141017
014800141017     c     *Entry        plist
014900141017     c                   parm                    KPJBA
015000141017
015100141017      /free
015200141017
015300141017       // -?Start?
015400141017       *inLR = *on;
015500141017
015600141017       // -?Elab?
015700141017       dow  Not $Fine;
015800141017         exsr  sr_GesD01;
015900141017       enddo;
016000141017
016100141017       // -?End?
016200141017       return;
016300141017
016400141017       //--------------------------------------------------------------
016500141017       //?Operazioni iniziali                                          ?
016600141017       //--------------------------------------------------------------
016700141017       BEGSR  *InzSR;
016800141017
016900141017         // -?Reperimento dati utente?
017000141017         exsr sr_DatiJob;
017100141017
017200141017         // -?Impostazione nome programma in testata a video?
017300141017         VTDpgm = SDSpgm;
017400141017
017500141017       ENDSR;
017600141017
017700141017       //--------------------------------------------------------------
017800141017       //?Reperimento Dati del job (Utente/Operativi).                 ?
017900141017       //--------------------------------------------------------------
018000141017       BEGSR  sr_DatiJob;
018100141017
018200141017         in(E) §AzUte;
018300141017         if NOT %error;
018400141017           in(E) §DatiUte;
018500141017         endif;
018600141017         if %error or RSut = *blanks;
018700141017           clear TIBS34ds;
018800141017           tibs34r(tibs34ds);
018900141017           in §AzUte;
019000141017           in §DatiUte;
019100141017         endif;
019200141017
019300141017       ENDSR;
019400141017
019500141017       //--------------------------------------------------------------
019600141017       //?Gestione videata D01                                         ?
019700141017       //--------------------------------------------------------------
019800141017       BEGSR  sr_GesD01;
019900141017
020000141017         // -?Inizializzazione videata?
020100141017         if  $InzD01 = *on;
020200141017           clear  TA48D01;
020300141017           $InzD01 = *off;
020400141017         endif;
020500141017
020600141017         AbilitF04 = *on;
020700141017         AbilitF05 = *on;
020800141017         AbilitF06 = *on;
020900141017         AbilitF12 = *off;
021000141017
021100141017         // -?Emissione videata?
021200141017         if  ErrMessage = *off;
021300141017           write  TA48T01;
021400141017           write  TA48Z01;
021500141017         endif;
021600141017
021700141017         exfmt  TA48D01;
021800141017
021900141017         reset  ErrMessage;
022000141017         reset  ErrGenerico;
022100141017         clear  V1Dmsg;
022200141017
022300141017         SELECT;
022400141017
022500141017           // -?F3=Fine?
022600141017           WHEN  dsp_aid = c_F03;
022700141017             $Fine = *on;
022800141017
022900141017           // -?F4=Interrogazione Tariffe?
023000141017           WHEN  dsp_aid = c_F04;
023100141017             exsr  sr_CallTNTA02R;
023200141017
023300141017           // -?F5=Interrogazione Offerte?
023400141017           WHEN  dsp_aid = c_F05;
023500141017             exsr  sr_CallTNTA87R;
023600141017
023700141017           // -?F12=Ritorno?
023800141017           WHEN  dsp_aid = c_F12;
023900141017             $Fine = *on;
024000141017
024100141017           // -?Invio o F6=Conferma?
024200141017           OTHER;
024300141017             exsr  sr_CtrD01;
024400141017             select;
024500141017               // -?rilevato errore?
024600141017               when  ErrGenerico = *on;
024700141017               // -?non premuto F6?
024800141017               when  dsp_aid <> c_F06;
024900141017               // -?selezionata una singola Tariffa/Offerta?
025000141017               other;
025100141017                 exsr  sr_CallTNTA48R;
025200141017             endsl;
025300141017
025400141017         ENDSL;
025500141017
025600141017       ENDSR;
025700141017
025800141017       //--------------------------------------------------------------
025900141017       //?Richiamo *pgm Interrogazione Tariffe.                        ?
026000141017       //--------------------------------------------------------------
026100141017       BEGSR  sr_CallTNTA02R;
026200141017
026300141017         clear  kpjbu;
026400141017
026500141017         tnta02r ( kpjba );
026600141017
026700141017       ENDSR;
026800141017
026900141017       //--------------------------------------------------------------
027000141017       //?Richiamo *pgm Gestione Trattative Commerciali.               ?
027100141017       //--------------------------------------------------------------
027200141017       BEGSR  sr_CallTNTA87R;
027300141017
027400141017         clear  kpjbu;
027500141017
027600141017         tnta87r ( kpjba );
027700141017
027800141017       ENDSR;
027900141017
028000141017       //--------------------------------------------------------------
028100141017       //?Richiamo *pgm Controllo Singola Tariffa / Offerta.           ?
028200141017       //--------------------------------------------------------------
028300141017       BEGSR  sr_CallTNTA48R;
028400141017
028500141017         tnta48r ( TNTA48ds );
028600141017
028700141017         AbilitF04 = *off;
028800141017         AbilitF05 = *off;
028900141017         AbilitF06 = *off;
029000141017         AbilitF12 = *on;
029100141017
029200141017         write  Protect;
029300141017         write  TA48Z01;
029400141017         exfmt  TA48D02;
029500141017
029600141017         // -?F3=Fine?
029700141017         if  dsp_aid = c_F03;
029800141017           $Fine = *on;
029900141017           leavesr;
030000141017         endif;
030100141017
030200141017       ENDSR;
030300141017
030400141017       //--------------------------------------------------------------
030500141017       //?Controllo dati in videata D01                                ?
030600141017       //--------------------------------------------------------------
030700141017       BEGSR  sr_CtrD01;
030800141017
030900141017         %subst( IndDspF : 50 ) = *off;
031000141017
031100141017       ENDSR;
031200141017
031300141017      /end-free
031400141017
031500141017       //--------------------------------------------------------------
031600141017       //?Schiere a tempo di compilazione.                             ?
031700141017       //--------------------------------------------------------------
031800141017
031900141017** -?sk_Msg:?Messaggi di Errore?---------------------------------------------*
032000141017Nessuna Tariffa inserita
032100141017Nessuna Offerta inserita
