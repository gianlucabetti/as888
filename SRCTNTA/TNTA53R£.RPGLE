000100110314      //---------------------------------------------------------------
000200110314      //?TNTA53R - Stampa testo lettera 54 - Blocco Cliente
000300110314      //---------------------------------------------------------------
000400110314     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500110314
000600110314      //---------------------------------------------------------------
000700110314      //?Dichiarazione file.
000800110314      //---------------------------------------------------------------
000900110314      // - File organigramma
001000110314     fAZORG01L  if   e           k disk
001100110314
001200110314      // - Printer file
001300110314     fTNTA53P   o    e             printer oflind(*in99)
001400110314
001500110314      //---------------------------------------------------------------
001600110314      //?Definizione costanti.
001700110314      //---------------------------------------------------------------
001800110314
001900110314      //---------------------------------------------------------------
002000110314      //?Definizione schiere.
002100110314      //---------------------------------------------------------------
002200110314
002300110314      //---------------------------------------------------------------
002400110314      //?Definizione aree dati.
002500110314      //---------------------------------------------------------------
002600110314      // - Dati utente
002700110314     d §AzUte        e ds                  extname(AZUTE00F)
002800110314     d                                     dtaara
002900110314     d §DatiUte      e ds                  extname(dDatiUte)
003000110314     d                                     dtaara
003100110314
003200110314      //---------------------------------------------------------------
003300110314      //?Definizione strutture dati.
003400110314      //---------------------------------------------------------------
003500110314      // - Parametri ricevuti
003600110314     d KPJBA         e ds
003700110314     d TNTA53ds      e ds
003800110314
003900110314      // - Reperimento dati utente
004000110314     d TIBS34ds      e ds
004100110314     d dUte01        e ds
004200110314
004300110314       // - Reperimento dati anagrafici
004400110314     d TIBS69ds      e ds
004500110314     d DS_cnaco      e ds                  inz extname(CNACO00F)
004600110314     d DS_cnind      e ds                  inz extname(CNIND00F)
004700110314     d DS_cnclp      e ds                  inz extname(CNCLP00F)
004800110314     d DS_fncls      e ds                  inz extname(FNCLS00F)
004900110314
005000110314      //---------------------------------------------------------------
005100110314      //?Definizione variabili globali.
005200110314      //---------------------------------------------------------------
005300110315      // - Campi di comodo
005400110315     d  codfil         s                   like(ORGfil)
005500110315     d  wdata          s              8  0
005600110314
005700110314      //---------------------------------------------------------------
005800110314      //?Definizione procedure esterne.
005900110314      //---------------------------------------------------------------
006000110314
006100110314      //---------------------------------------------------------------
006200110314      //?Prototipi.
006300110314      //---------------------------------------------------------------
006400110314      /copy gaitrasrc/srcprotopr,tibs34r
006500110314      /copy gaitrasrc/srcprotopr,tibs69r
006600110314
006700110314      //---------------------------------------------------------------
006800110314      //?Definizione key-list.
006900110314      //---------------------------------------------------------------
007000110314
007100110314      //---------------------------------------------------------------
007200110314      //?Riepilogo indicatori.
007300110314      //---------------------------------------------------------------
007400110314      // 99    : Salto pagina
007500110314
007600110314      //---------------------------------------------------------------
007700110314      //?Main.
007800110314      //---------------------------------------------------------------
007900110314
008000110314     c     *Entry        plist
008100110314     c                   parm                    KPJBA
008200110314     c                   parm                    TNTA53ds
008300110314
008400110314      /free
008500110314
008600110314       //?Operazioni iniziali
008700110314       exsr RoutInz;
008800110314
008900110314       //?Elaborazione
009000110314       exsr Elabora;
009100110314
009200110314       //?Operazioni finali
009300110314       exsr RoutEnd;
009400110314
009500110314       //--------------------------------------------------------------
009600110314       //?Operazioni iniziali.
009700110314       //--------------------------------------------------------------
009800110314       BEGSR RoutInz;
009900110314
010000110314       //?Reperimento dati job
010100110314         exsr DatiJob;
010200110314
010300110314       ENDSR;
010400110314
010500110314       //--------------------------------------------------------------
010600110314       //?Reperimento Dati del job (Utente/Operativi).
010700110314       //--------------------------------------------------------------
010800110314       BEGSR DatiJob;
010900110314
011000110314         in(E) §AzUte;
011100110314         IF  not %error;
011200110314           in(E) §DatiUte;
011300110314         ENDIF;
011400110314         IF  %error or RSut = *blanks;
011500110314           clear TIBS34ds;
011600110314           tibs34r(tibs34ds);
011700110314           in §AzUte;
011800110314           in §DatiUte;
011900110314         ENDIF;
012000110314
012100110314       ENDSR;
012200110314
012300110314       //--------------------------------------------------------------
012400110314       //?Elaborazione.
012500110314       //--------------------------------------------------------------
012600110314       BEGSR Elabora;
012700110315
012800110315       //?Data del giorno
012900110315         wdata = %dec(%date());
013000110314
013100110314       //?Recupero la filiale di appartenenza del cliente
013200110407         //codfil = %dec(%subst(%editc(DTA53ksc:'X'):1:3):3:0);
013300110407         chain DTA53fil AZORG01L;
013400110314         IF  %found(AZORG01L);
013500110315           desfil  = ORGdes;
013600110315           desfil1 = ORGdes;
013700110315           viafil  = ORGind;
013800110315           capfil  = ORGcpf;
013900110315           locfil  = ORGloc;
014000110315           prvfil  = ORGpro;
014100110315           telfil  = ORGtel;
014200110315           faxfil  = ORGfax;
014300110314         ENDIF;
014400110407         emafil = 'info' + %editc(DTA53fil:'X') + '@bartolini.it';
014500110315
014600110315       //?Recupero i dati del cliente
014700110314         clear  tibs69ds;
014800110314         I69kac = DTA53ksc;
014900110314         I69kin = DTA53ksc;
015000110314         I69kcp = DTA53ksc;
015100110314         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
015200110315         descli = ACOrag;
015300110315         viacli = INDvia;
015400110315         loccli = INDcit;
015500110315         prvcli = INDprv;
015600110315         capcli = %editc(INDcap:'X');
015700110315
015800110315         luogodata = %trim(orgdes) + ', lì ' +
015900110315         %subst(%editc(wdata:'X'):7:2) + '/' +
016000110315         %subst(%editc(wdata:'X'):5:2) + '/' +
016100110315         %subst(%editc(wdata:'X'):1:4);
016200110315
016300110315         write TA53P01;
016400110314
016500110314       ENDSR;
016600110314
016700110314       //--------------------------------------------------------------
016800110314       //?Operazioni finali.
016900110314       //--------------------------------------------------------------
017000110314       BEGSR RoutEnd;
017100110314
017200110314         *inLR = *on;
017300110314         return;
017400110314
017500110314       ENDSR;
017600110314
017700110314      /end-free
