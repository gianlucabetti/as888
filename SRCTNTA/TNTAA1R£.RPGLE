000100120808      //==============================================================
000200120808      //?TNTAA1R - Controlla Abilitazione Utente - Media
000300120808      //==============================================================
000400120808
000500120808     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600120808
000700120808      //---------------------------------------------------------------
000800120808      //?Dichiarazione file.
000900120808      //---------------------------------------------------------------
001000120808
001100120808      //---------------------------------------------------------------
001200120808      //?Definizione costanti.
001300120808      //---------------------------------------------------------------
001400120808
001500120808      //---------------------------------------------------------------
001600120808      //?Definizione schiere.
001700120808      //---------------------------------------------------------------
001800120808
001900120808      //---------------------------------------------------------------
002000120808      //?Definizione aree dati.
002100120808      //---------------------------------------------------------------
002200120808
002300120808       // -?Dati utente
002400120808     d §AzUte        e ds                  extname(AZUTE00F)
002500120808     d                                     dtaara
002600120808     d §DatiUte      e ds                  extname(dDatiUte)
002700120808     d                                     dtaara
002800120808
002900120808      //---------------------------------------------------------------
003000120808      //?Definizione strutture dati.
003100120808      //---------------------------------------------------------------
003200120808
003300120808       // -?Paremetri ricevuti
003400120808     d KPJBA         e ds
003500120808
003600120808      // -?Ricerca/Controllo tabelle
003700120808     d TIBS02ds      e ds                  inz
003800120808
003900120808      // -?Reperimento dati utente
004000120808     d TIBS34ds      e ds
004100120808
004200120808       // -?Controllo abilitazioni utente - Gestione tariffe
004300120808     d TNTAA1DS      e ds                  inz
004400120808
004500120808       // -?Tabella autorizzazioni LAT
004600120808     d dLAT          e ds                  inz
004700120808
004800120808      //---------------------------------------------------------------
004900120808      //?Definizione variabili globali.
005000120808      //---------------------------------------------------------------
005100120808
005200120808       // -?Campi di comodo
005300120808     d wABIpgm         s                   like(UteAut)
005400120808     d wABIprf         s                   like(UteAut)
005500120808     d wLATlivPGM      s                   like(§LATliv)
005600120808     d wLATlivPRF      s                   like(§LATliv)
005700120808
005800120808      //---------------------------------------------------------------
005900120808      //?Definizione procedure esterne.
006000120808      //---------------------------------------------------------------
006100120808
006200120808      //---------------------------------------------------------------
006300120808      //?Definizione prototipi.
006400120808      //---------------------------------------------------------------
006500120808
006600120808       // -?Reperimento tabell
006700120808      /copy gaitrasrc/srcprotopr,tibs02r
006800120808
006900120808       // -?Reperimento dati utente
007000120808      /copy gaitrasrc/srcprotopr,tibs34r
007100120808
007200120808      //---------------------------------------------------------------
007300120808      //?Definizione key-list.
007400120808      //---------------------------------------------------------------
007500120808
007600120808      //---------------------------------------------------------------
007700120808      //?Riepilogo indicatori.
007800120808      //---------------------------------------------------------------
007900120808
008000120808      //---------------------------------------------------------------
008100120808
008200120808      //---------------------------------------------------------------
008300120808      //?M A I N - L I N E
008400120808      //---------------------------------------------------------------
008500120808
008600120808     c     *Entry        plist
008700120808     c                   parm                    KPJBA
008800120808
008900120808      /free
009000120808
009100120808       //?Operazioni iniziali
009200120808       exsr RoutInz;
009300120808
009400120808       //?Elaborazione
009500120808
009600120808       clear dLAT;
009700120808       clear TIBS02ds;
009800120808       T02mod = 'C';
009900120808       T02cod = 'LAT';
010000120808       T02ke1 = wABIprf;
010100120808       T02sif = KNSIF;
010200120808             TNTBE_RicercaControllo  (kpjba : tibs02ds);
010300120808             IF  T02err = *blanks;
010400120808               V01conc1 = t02ke2;
010500120808             ENDIF;
010600120808
010700120808
010800120808       //?Operazioni finali
010900120808       exsr RoutEnd;
011000120808
011100120808       //--------------------------------------------------------------
011200120808       //?Operazioni iniziali.
011300120808       //--------------------------------------------------------------
011400120808       BEGSR RoutInz;
011500120808
011600120808       //?Reperimento dati job
011700120808         exsr DatiJob;
011800120808
011900120808         wUteAbi = OTAA1cabi;
012000120808
012100120808       ENDSR;
012200120808
012300120808       //--------------------------------------------------------------
012400120808       //?Reperimento Dati del job (Utente/Operativi).
012500120808       //--------------------------------------------------------------
012600120808       BEGSR DatiJob;
012700120808
012800120808         in(E) §AzUte;
012900120808         IF NOT %error;
013000120808           in(E) §DatiUte;
013100120808         ENDIF;
013200120808         IF %error or RSut = *blanks;
013300120808           clear TIBS34ds;
013400120808           tibs34r(tibs34ds);
013500120808           in §AzUte;
013600120808           in §DatiUte;
013700120808         ENDIF;
013800120808
013900120808     c                   Clear                   wabi
014000120808     c                   Clear                   dLat
014100120808
014200120808      * Verifica errori e autorità profilo
014300120808s   1c                   Select
014400120808      * se ho errori nei dati utente esco dal pgm
014500120808w   1c                   When      DutErr = 'E'
014600120808     c                   Eval      $errute = *On
014700120808     c                   GoTo      EndInz
014800120808      * se non sono in sede (filiale remota)
014900120808      * --> se 1° livello, abilitazioni al terminal
015000120808      *     se 2° livello, abilitazioni al punto operativo
015100120808w   1c                   When      UteAut = *Blanks
015200120808if  2c                   If        DutLpo = '1'
015300120808     c                   Eval      wabi   = 'TP'
015400120808e   2c                   EndIf
015500120808if  2c                   If        DutLpo = '2'
015600120808     c                   Eval      wabi   = 'PO'
015700120808e   2c                   EndIf
015800120808      * sono in sede carica le abilitazioni del profilo
015900120808x   1c                   Other
016000120808     c                   Eval      wabi = UteAut
016100120808e   1c                   EndSl
016200120808      * controllo se ok l'abilitazione dell'utente
016300120808     c                   Clear                   Tibs02ds
016400120808     c                   Eval      T02Mod = 'C'
016500120808     c                   Eval      T02Sif = knsif
016600120808     c                   Eval      T02Cod = 'LAT'
016700120808     c                   Movel(p)  wabi          T02Ke1
016800120808     c                   Call      'TIBS02R'
016900120808     c                   Parm                    kpjba
017000120808     c                   Parm                    Tibs02ds
017100120808if  1c                   If        T02Err = *Blanks
017200120808     c                   Eval      dLat = T02Uni
017300120808e   1c                   EndIf
017400120808if  1c                   If        T02Err <> *Blanks or §LatAbi = 'S'
017500120808     c                   Eval      $errute = *On
017600120808e   1c                   EndIf
017700120808
017800120808       ENDSR;
017900120808
018000120808       //--------------------------------------------------------------
018100120808       //?Operazioni finali.
018200120808       //--------------------------------------------------------------
018300120808       BEGSR RoutEnd;
018400120808
018500120808         *inLR = *on;
018600120808         return;
018700120808
018800120808       ENDSR;
018900120808
019000120808      /end-free
