000100160211       //==============================================================
000200160211       //?TEST - Controllo Singola Tariffa / Offerta                   ?
000300160211       //==============================================================
000400160211
000500160211       //--------------------------------------------------------------
000600160211       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700160211       //--------------------------------------------------------------
000800160211
000900160211     /*END
001000160211
001100160211       //--------------------------------------------------------------
001200160211       //?Specifiche di controllo.                                     ?
001300160211       //--------------------------------------------------------------
001400160211
001500160211     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001600160211     h dftactgrp(*no) actgrp('QILE')
001700160211
001800160211       //--------------------------------------------------------------
001900160211       //?Dichiarazione file.                                          ?
002000160211       //--------------------------------------------------------------
002100160211
002200160211       // -?Video?
002300160211     fTNTAT1TSTDcf   e             workstn
002400160211     f                                     indds(IndDspF)
002500160211     f                                     infds(InfDspF)
002600160211
002700160211       //--------------------------------------------------------------
002800160211       //?Definizione costanti.                                        ?
002900160211       //--------------------------------------------------------------
003000160211
003100160211       // -?Tasti funzionali a video?
003200160211     d c_F01           c                   const(x'31')
003300160211     d c_F02           c                   const(x'32')
003400160211     d c_F03           c                   const(x'33')
003500160211     d c_F04           c                   const(x'34')
003600160211     d c_F05           c                   const(x'35')
003700160211     d c_F06           c                   const(x'36')
003800160211     d c_F07           c                   const(x'37')
003900160211     d c_F08           c                   const(x'38')
004000160211     d c_F09           c                   const(x'39')
004100160211     d c_F10           c                   const(x'3A')
004200160211     d c_F11           c                   const(x'3B')
004300160211     d c_F12           c                   const(x'3C')
004400160211     d c_F13           c                   const(x'B1')
004500160211     d c_F14           c                   const(x'B2')
004600160211     d c_F15           c                   const(x'B3')
004700160211     d c_F16           c                   const(x'B4')
004800160211     d c_F17           c                   const(x'B5')
004900160211     d c_F18           c                   const(x'B6')
005000160211     d c_F19           c                   const(x'B7')
005100160211     d c_F20           c                   const(x'B8')
005200160211     d c_F21           c                   const(x'B9')
005300160211     d c_F22           c                   const(x'BA')
005400160211     d c_F23           c                   const(x'BB')
005500160211     d c_F24           c                   const(x'BC')
005600160211     d c_Enter         c                   const(x'F1')
005700160211     d c_RollDown      c                   const(x'F4')
005800160211     d c_RollUp        c                   const(x'F5')
005900160211
006000160211       //--------------------------------------------------------------
006100160211       //?Definizione schiere.                                         ?
006200160211       //--------------------------------------------------------------
006300160211
006400160211       // -?Messaggi di errore?
006500160211     d sk_Msg          s             78    dim( 2) ctdata perrcd(1)
006600160211
006700160211       //--------------------------------------------------------------
006800160211       //?Definizione aree dati.                                       ?
006900160211       //--------------------------------------------------------------
007000160211
007100160211       // -?Dati utente?
007200160211     d §AzUte        e ds                  extname(AZUTE00F)
007300160211     d                                     dtaara
007400160211     d §DatiUte      e ds                  extname(dDatiUte)
007500160211     d                                     dtaara
007600160211
007700160211       //--------------------------------------------------------------
007800160211       //?Definizione strutture dati.                                  ?
007900160211       //--------------------------------------------------------------
008000160211
008100160211       // -?Status ds?
008200160211     d Status         sds
008300160211     d   SDSpgm          *proc
008400160211     d   SDSprm          *parms
008500160211     d   SDSusr              254    263
008600160211
008700160211       // -?InfDS?
008800160211     d InfDspF         ds
008900160211     d   dsp_aid             369    369a
009000160211
009100160211       // -?Indicatori su DspF?
009200160211     d IndDspF         ds
009300160211         // -?(Dis)Abilitazione tasti funzionali?
009400160211     d   AbilitF04                     n   overlay(IndDspF : 04)
009500160211     d   AbilitF05                     n   overlay(IndDspF : 05)
009600160211     d   AbilitF06                     n   overlay(IndDspF : 06)
009700160211     d   AbilitF12                     n   overlay(IndDspF : 12)
009800160211         // -?Indicatori di errore?
009900160211     d   ErrMessage                    n   overlay(IndDspF : 28)
010000160211     d   ErrGenerico                   n   overlay(IndDspF : 99)
010100160211
010200160211       // -?Parametri ricevuti?
010300160211     d KPJBA         e ds
010400160211
010500160211       //--------------------------------------------------------------
010600160211       //?Definizione variabili globali.                               ?
010700160211       //--------------------------------------------------------------
010800160211
010900160211       // -?Flags booleani?
011000160211     d $Fine           s               n   inz
011100160211     d $InzD01         s               n   inz(*on)
011200160211
011300160211       //--------------------------------------------------------------
011400160211       //?Definizione procedure usate.                                 ?
011500160211       //--------------------------------------------------------------
011600160211
011700160211       // -?Reperimento dati utente?
011800160211     d TIBS34ds      e ds
011900160211      /copy gaitrasrc/srcProtoPR,TIBS34R
012000160211
012100160211       // -?Interrogazione Trattative?
012200160211     d tnta87r         pr                  extpgm('TNTA87R')
012300160211     d   kpjba                             likeds(KPJBA)
012400160211
012500160211       // -?Interrogazione Tariffe?
012600160211     d tnta02r         pr                  extpgm('TNTA02R')
012700160211     d   kpjba                             likeds(KPJBA)
012800160211
012900160211       // -?Controllo tipologia Singola Tariffa / Offerta?
013000160211     d TNTAT1ds      e ds                  inz
013100160211     d tntaT1r         pr                  extpgm('TNTAT1R')
013200160211     d   kpjba                             likeds(KPJBA)
013300160211
013400160211       //--------------------------------------------------------------
013500160211       //?Definizione key-list.                                        ?
013600160211       //--------------------------------------------------------------
013700160211
013800160211
013900160211       //--------------------------------------------------------------
014000160211       //?Riepilogo indicatori.                                        ?
014100160211       //--------------------------------------------------------------
014200160211
014300160211     c     *Entry        plist
014400160211     c                   parm                    KPJBA
014500160211
014600160211      /free
014700160211
014800160211       // -?Start?
014900160211       *inLR = *on;
015000160211
015100160211       // -?Elab?
015200160211       dow  Not $Fine;
015300160211         exsr  sr_GesD01;
015400160211       enddo;
015500160211
015600160211       // -?End?
015700160211       return;
015800160211
015900160211       //--------------------------------------------------------------
016000160211       //?Operazioni iniziali                                          ?
016100160211       //--------------------------------------------------------------
016200160211       BEGSR  *InzSR;
016300160211
016400160211         // -?Reperimento dati utente?
016500160211         exsr sr_DatiJob;
016600160211
016700160211         // -?Impostazione nome programma in testata a video?
016800160211         VTDpgm = SDSpgm;
016900160211
017000160211       ENDSR;
017100160211
017200160211       //--------------------------------------------------------------
017300160211       //?Reperimento Dati del job (Utente/Operativi).                 ?
017400160211       //--------------------------------------------------------------
017500160211       BEGSR  sr_DatiJob;
017600160211
017700160211         in(E) §AzUte;
017800160211         if NOT %error;
017900160211           in(E) §DatiUte;
018000160211         endif;
018100160211         if %error or RSut = *blanks;
018200160211           clear TIBS34ds;
018300160211           tibs34r(tibs34ds);
018400160211           in §AzUte;
018500160211           in §DatiUte;
018600160211         endif;
018700160211
018800160211       ENDSR;
018900160211
019000160211       //--------------------------------------------------------------
019100160211       //?Gestione videata D01                                         ?
019200160211       //--------------------------------------------------------------
019300160211       BEGSR  sr_GesD01;
019400160211
019500160211         // -?Inizializzazione videata?
019600160211         if  $InzD01 = *on;
019700160211           clear  TAT1D01;
019800160211           $InzD01 = *off;
019900160211         endif;
020000160211
020100160211         AbilitF04 = *on;
020200160211         AbilitF05 = *on;
020300160211         AbilitF06 = *on;
020400160211         AbilitF12 = *off;
020500160211
020600160211         // -?Emissione videata?
020700160211         if  ErrMessage = *off;
020800160211           write  TAT1T01;
020900160211           write  TAT1Z01;
021000160211         endif;
021100160211
021200160211         exfmt  TAT1D01;
021300160211
021400160211         reset  ErrMessage;
021500160211         reset  ErrGenerico;
021600160211         clear  V1Dmsg;
021700160211
021800160211         SELECT;
021900160211
022000160211           // -?F3=Fine?
022100160211           WHEN  dsp_aid = c_F03;
022200160211             $Fine = *on;
022300160211
022400160211           // -?F4=Interrogazione Tariffe?
022500160211           WHEN  dsp_aid = c_F04;
022600160211             exsr  sr_CallTNTA02R;
022700160211
022800160211           // -?F5=Interrogazione Offerte?
022900160211           WHEN  dsp_aid = c_F05;
023000160211             exsr  sr_CallTNTA87R;
023100160211
023200160211           // -?F12=Ritorno?
023300160211           WHEN  dsp_aid = c_F12;
023400160211             $Fine = *on;
023500160211
023600160211           // -?Invio o F6=Conferma?
023700160211           OTHER;
023800160211             exsr  sr_CtrD01;
023900160211             select;
024000160211               // -?rilevato errore?
024100160211               when  ErrGenerico = *on;
024200160211               // -?non premuto F6?
024300160211               when  dsp_aid <> c_F06;
024400160211               // -?selezionata una singola Tariffa/Offerta?
024500160211               other;
024600160211                 exsr  sr_CallTNTAT1R;
024700160211             endsl;
024800160211
024900160211         ENDSL;
025000160211
025100160211       ENDSR;
025200160211
025300160211       //--------------------------------------------------------------
025400160211       //?Richiamo *pgm Interrogazione Tariffe.                        ?
025500160211       //--------------------------------------------------------------
025600160211       BEGSR  sr_CallTNTA02R;
025700160211
025800160211         clear  kpjbu;
025900160211
026000160211         tnta02r ( kpjba );
026100160211
026200160211       ENDSR;
026300160211
026400160211       //--------------------------------------------------------------
026500160211       //?Richiamo *pgm Gestione Trattative Commerciali.               ?
026600160211       //--------------------------------------------------------------
026700160211       BEGSR  sr_CallTNTA87R;
026800160211
026900160211         clear  kpjbu;
027000160211
027100160211         tnta87r ( kpjba );
027200160211
027300160211       ENDSR;
027400160211
027500160211       //--------------------------------------------------------------
027600160211       //?Richiamo *pgm controllo Tipologia singola Tariffa/Offerta.   ?
027700160211       //--------------------------------------------------------------
027800160211       BEGSR  sr_CallTNTAT1R;
027900160211
028000160211         kpjbu    = tntaT1ds;
028100160211         tntaT1r ( KPJBA );
028200160211         tntaT1ds = kpjbu;
028300160211
028400160211         AbilitF04 = *off;
028500160211         AbilitF05 = *off;
028600160211         AbilitF06 = *off;
028700160211         AbilitF12 = *on;
028800160211
028900160211         write  Protect;
029000160211         write  TAT1Z01;
029100160211         exfmt  TAT1D02;
029200160211
029300160211         // -?F3=Fine?
029400160211         if  dsp_aid = c_F03;
029500160211           $Fine = *on;
029600160211           leavesr;
029700160211         endif;
029800160211
029900160211       ENDSR;
030000160211
030100160211       //--------------------------------------------------------------
030200160211       //?Controllo dati in videata D01                                ?
030300160211       //--------------------------------------------------------------
030400160211       BEGSR  sr_CtrD01;
030500160211
030600160211         %subst( IndDspF : 50 ) = *off;
030700160211
030800160211       ENDSR;
030900160211
031000160211      /end-free
031100160211
031200160211       //--------------------------------------------------------------
031300160211       //?Schiere a tempo di compilazione.                             ?
031400160211       //--------------------------------------------------------------
031500160211
031600160211** -?sk_Msg:?Messaggi di Errore?---------------------------------------------*
031700160211Nessuna Tariffa inserita
031800160211Nessuna Offerta inserita
