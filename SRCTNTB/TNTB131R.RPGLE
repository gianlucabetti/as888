000100110803      //--------------------------------------------------------------
000200110803      //?TNTB131R - Interrogazione tabella DCC
000300110803      //--------------------------------------------------------------
000400110803     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000500110803
000600110803      //---------------------------------------------------------------
000700110803      //?Dichiarazione file.
000800110803      //---------------------------------------------------------------
000900110803
001000110803      // - Tabelle
001100110808     fTNTBE01L  if   e           k disk
001200110803
001300110803      // - Video
001400110803     fTNTB131D  cf   e             workstn
001500110803
001600110803      //---------------------------------------------------------------
001700110803      //?Definizione costanti.
001800110803      //---------------------------------------------------------------
001900110803
002000110803      // - Tabella tipo trattativa
002100110803     d C_tab           c                   const('DCC')
002200110803
002300110803      //---------------------------------------------------------------
002400110803      //?Definizione schiere.
002500110803      //---------------------------------------------------------------
002600110803
002700110803      //---------------------------------------------------------------
002800110803      //?Definizione aree dati.
002900110803      //---------------------------------------------------------------
003000110803
003100110803      // - Dati utente
003200110803     d §AzUte        e ds                  extname(AZUTE00F)
003300110803     d                                     dtaara
003400110803     d §DatiUte      e ds                  extname(dDatiUte)
003500110803     d                                     dtaara
003600110803
003700110803      //---------------------------------------------------------------
003800110803      //?Definizione strutture dati.
003900110803      //---------------------------------------------------------------
004000110803
004100110803      // - Parametri ricevuti
004200110803     d KPJBA         e ds
004300110803     d TNTA61DS      e ds
004400110803
004500110803      // - Reperimento dati utente
004600110803     d TIBS34DS      e ds
004700110803
004800110803      // - Tabella DCC = Serie prefisso "CC" disk C
004900110803     d dDCC          e ds                  inz
005000110803
005100110803      //---------------------------------------------------------------
005200110803      //?Definizione variabili globali.
005300110803      //---------------------------------------------------------------
005400110803
005500110803      // - Flags booleani
005600110803     d $Fine           s               n   inz(*off)
005700110803     d $InzD01         s               n   inz(*on)
005800110803
005900110803      //---------------------------------------------------------------
006000110803      //?Definizione procedure esterne.
006100110803      //---------------------------------------------------------------
006200110803
006300110803      //---------------------------------------------------------------
006400110803      //?Prototipi.
006500110803      //---------------------------------------------------------------
006600110803
006700110803      /copy gaitrasrc/srcprotopr,tibs34r
006800110811      /copy gaitrasrc/srcprotopi,tibs69r
006900110803      /copy gaitrasrc/srcprotopr,tibs69r
007000110803
007100110803      //---------------------------------------------------------------
007200110803      //?Definizione key-list.
007300110803      //---------------------------------------------------------------
007400110803
007500110803      //---------------------------------------------------------------
007600110803      //?Riepilogo indicatori.
007700110803      //---------------------------------------------------------------
007800110803
007900110803      //---------------------------------------------------------------
008000110803
008100110803      //---------------------------------------------------------------
008200110803      //?M A I N - L I N E
008300110803      //---------------------------------------------------------------
008400110803
008500110803     c     *Entry        plist
008600110803     c                   parm                    KPJBA
008700110803     c                   parm                    TNTA61DS
008800110803
008900110803      /free
009000110803
009100110803       //?Operazioni iniziali
009200110803       exsr RoutInz;
009300110803
009400110803       //?Gestione video
009500110803       DOW $Fine = *off;
009600110803         exsr GesD01;
009700110803       ENDDO;
009800110803
009900110803       //?Operazioni finali
010000110803       exsr RoutEnd;
010100110803
010200110803       //--------------------------------------------------------------
010300110803       //?Operazioni iniziali.
010400110803       //--------------------------------------------------------------
010500110803       BEGSR RoutInz;
010600110803
010700110803         //?Reperimento dati job
010800110803         exsr DatiJob;
010900110805
011000110805         IF  TA61ksc <= *zeros;
011100110805           TA61err = *on;
011200110805           TA61msg = 'Richiesto il codice cliente';
011300110805           $Fine = *on;
011400110805         ENDIF;
011500110803
011600110803       ENDSR;
011700110803
011800110803       //--------------------------------------------------------------
011900110803       //?Reperimento Dati del job (Utente/Operativi).
012000110803       //--------------------------------------------------------------
012100110803       BEGSR DatiJob;
012200110803
012300110803         in(E) §AzUte;
012400110803         if NOT %error;
012500110803           in(E) §DatiUte;
012600110803         endif;
012700110803         if %error or RSut = *blanks;
012800110803           clear TIBS34ds;
012900110803           tibs34r(tibs34ds);
013000110803           in §AzUte;
013100110803           in §DatiUte;
013200110803         endif;
013300110803
013400110803       ENDSR;
013500110803
013600110803       //--------------------------------------------------------------
013700110803       //?Gestione videata.
013800110803       //--------------------------------------------------------------
013900110803       BEGSR GesD01;
014000110803
014100110803         //?Iniziallizazione videata
014200110803         IF $InzD01 = *on;
014300110803           exsr InzD01;
014400110803           $InzD01 = *off;
014500110803         ENDIF;
014600110803
014700110803       //?Emissione videata
014800110803         exfmt TB13D01;
014900110803
015000110803       //?F12 = Ritorno
015100110803         IF  *inkl;
015200110803           $fine = *on ;
015300110803           leavesr ;
015400110803         ENDIF;
015500110803
015600110803       ENDSR;
015700110803
015800110803       //--------------------------------------------------------------
015900110803       //?Caricamento videata D01.
016000110803       //--------------------------------------------------------------
016100110803       BEGSR InzD01;
016200110803
016300110803         clear V1dksc;
016400110812         clear V1Cser;
016500110803
016600110803         setll C_tab TNTBE01L;
016700110803         reade C_tab TNTBE01L;
016800110803         DOW not %eof(TNTBE01L);
016900110803
017000110803           IF  TBEatb = *blanks;
017100110803             dDCC       = TBEuni;
017200110803             IF  §DCCksc = TA61ksc;
017300110803               clear  tibs69ds;
017400110803               I69kac = TA61ksc;
017500110803               TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
017600110803               V1Cksc = TA61ksc;
017700110811               IF  O69err = *blanks;
017800110811                 V1Dksc = ACORag;
017900110811               ELSE;
018000110811                 V1Dksc = '? ? ? ? ? ?';
018100110811               ENDIF;
018200110803               V1Cser = TBEke1;
018300110803               leave;
018400110803             ENDIF;
018500110803           ENDIF;
018600110803
018700110803           reade C_tab TNTBE01L;
018800110803         ENDDO;
018900110803
019000110803       ENDSR;
019100110803
019200110803       //--------------------------------------------------------------
019300110803       //?Operazioni finali.
019400110803       //--------------------------------------------------------------
019500110803       BEGSR RoutEnd;
019600110803
019700110803         *inLR = *on;
019800110803         return;
019900110803
020000110803       ENDSR;
