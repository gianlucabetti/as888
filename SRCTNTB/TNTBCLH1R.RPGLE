000100171206      //------------------------------------------------------------------
000200171206      //?TNTBCLH1R - Termina Partenza abilitati su Cliente Special Sunday
000300171206      //------------------------------------------------------------------
000400171206     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000500171206
000600171206      //---------------------------------------------------------------
000700171206      //?Dichiarazione file.
000800171206      //---------------------------------------------------------------
000900171206     fAZORG01L  if   e           k disk
001000171206     fTNTBE01L  if   e           k disk
001100171206     fTNTBCLH1D cf   e             workstn
001200171206     f                                     sfile(TBCLHS01 : S01nrr)
001300171206     f                                     indds(IndDspF)
001400171206     f                                     infds(InfDspF)
001500171206
001600171206      //---------------------------------------------------------------
001700171206      //?Definizione costanti.
001800171206      //---------------------------------------------------------------
001900171206      // - Tasti funzionali a video
002000171206     d c_F01           c                   const(x'31')
002100171206     d c_F02           c                   const(x'32')
002200171206     d c_F03           c                   const(x'33')
002300171206     d c_F04           c                   const(x'34')
002400171206     d c_F05           c                   const(x'35')
002500171206     d c_F06           c                   const(x'36')
002600171206     d c_F07           c                   const(x'37')
002700171206     d c_F08           c                   const(x'38')
002800171206     d c_F09           c                   const(x'39')
002900171206     d c_F10           c                   const(x'3A')
003000171206     d c_F11           c                   const(x'3B')
003100171206     d c_F12           c                   const(x'3C')
003200171206     d c_F13           c                   const(x'B1')
003300171206     d c_F14           c                   const(x'B2')
003400171206     d c_F15           c                   const(x'B3')
003500171206     d c_F16           c                   const(x'B4')
003600171206     d c_F17           c                   const(x'B5')
003700171206     d c_F18           c                   const(x'B6')
003800171206     d c_F19           c                   const(x'B7')
003900171206     d c_F20           c                   const(x'B8')
004000171206     d c_F21           c                   const(x'B9')
004100171206     d c_F22           c                   const(x'BA')
004200171206     d c_F23           c                   const(x'BB')
004300171206     d c_F24           c                   const(x'BC')
004400171206     d c_Enter         c                   const(x'F1')
004500171206     d c_RollDown      c                   const(x'F4')
004600171206     d c_RollUp        c                   const(x'F5')
004700171206
004800171206      //---------------------------------------------------------------
004900171206      //?Definizione schiere.
005000171206      //---------------------------------------------------------------
005100171206      // - Terminal partenza abilitati
005200171206     d skFIL           s              3s 0 dim(999)
005300171206
005400171206      //---------------------------------------------------------------
005500171206      //?Definizione aree dati.
005600171206      //---------------------------------------------------------------
005700171206      // - Dati utente
005800171206     d §AzUte        e ds                  extname(AZUTE00F)
005900171206     d                                     dtaara
006000171206     d §DatiUte      e ds                  extname(dDatiUte)
006100171206     d                                     dtaara
006200171206
006300171206      //---------------------------------------------------------------
006400171206      //?Definizione strutture dati.
006500171206      //---------------------------------------------------------------
006600171206      // - Status
006700171206     d Psds           sds
006800171206     d   SDSpgm          *proc
006900171206
007000171206      // - InfDS
007100171206     d InfDspF         ds
007200171206     d  dsp_aid              369    369a
007300171206
007400171206      // - Indicatori su DspF
007500171206     d IndDspF         ds
007600171206        // - Indicatori di gestione del subfile
007700171206     d  SflDsp                        1n   overlay(IndDspF : 30)
007800171206     d  SflDspCtl                     1n   overlay(IndDspF : 31)
007900171206     d  SflEnd                        1n   overlay(IndDspF : 33)
008000171206
008100171206     d wCLHuni         ds
008200171206     d  skCLHksc               1    252    dim(36)
008300171206
008400171206      // - Parametri ricevuti
008500171206     d KPJBA         e ds
008600171206     d TNTA61DS      e ds                  qualified
008700171206
008800171206      // - Reperimento dati utente
008900171206     d TIBS34DS      e ds
009000171206
009100171206      //---------------------------------------------------------------
009200171206      //?Definizione variabili globali.
009300171206      //---------------------------------------------------------------
009400171206      // - Flags booleani
009500171206     d Fine            s               n   inz(*off)
009600171206     d wInzS01         s               n   inz(*on)
009700171206
009800171206      // - Indici di schiera
009900171206     d xx              s              4s 0 inz
010000171206
010100171206      // - Campi associati al video
010200171206     d Video           s              2    inz('S1')
010300171206     d S01nrr          s              4s 0 inz
010400171206
010500171206      //---------------------------------------------------------------
010600171206      //?Definizione Prototipi.
010700171206      //---------------------------------------------------------------
010800171206      /copy gaitrasrc/srcprotopr,tibs34r
010900171206      /copy gaitrasrc/srcprotopi,tibs69r
011000171206      /copy gaitrasrc/srcprotopr,tibs69r
011100171206
011200171206      //---------------------------------------------------------------
011300171206      //?M A I N - L I N E
011400171206      //---------------------------------------------------------------
011500171206     c     *ENTRY        plist
011600171206     c                   parm                    KPJBA
011700171206     c                   parm                    TNTA61DS
011800171206
011900171206       //?Operazioni iniziali
012000171206       exsr RoutInz;
012100171206
012200171206       //?Gestione video
012300171206       DOW  not Fine;
012400171206
012500171206         SELECT;
012600171206         WHEN Video = 'S1';
012700171206           exsr GesS01;
012800171206         OTHER;
012900171206           Fine = *on;
013000171206         ENDSL;
013100171206
013200171206       ENDDO;
013300171206
013400171206       //?Operazioni finali
013500171206       exsr RoutEnd;
013600171206
013700171206       //--------------------------------------------------------------
013800171206       //?Operazioni iniziali.
013900171206       //--------------------------------------------------------------
014000171206       BEGSR RoutInz;
014100171206
014200171206         Video = 'S1';
014300171206         wInzS01 = *on;
014400171206
014500171206       //?Reperimento dati job
014600171206         exsr DatiJob;
014700171206
014800171206       //?Impostazione campi "fissi"
014900171206         VT1pgm = SDSpgm;
015000171206
015100171206       ENDSR;
015200171206
015300171206       //--------------------------------------------------------------
015400171206       //?Reperimento Dati del job (Utente/Operativi).
015500171206       //--------------------------------------------------------------
015600171206       BEGSR DatiJob;
015700171206
015800171206         in(E) §AzUte;
015900171206         IF  NOT %error;
016000171206           in(E) §DatiUte;
016100171206         ENDIF;
016200171206         IF  %error or RSut = *blanks;
016300171206           clear TIBS34ds;
016400171206           tibs34r(tibs34ds);
016500171206           in §AzUte;
016600171206           in §DatiUte;
016700171206         ENDIF;
016800171206
016900171206       ENDSR;
017000171206
017100171206       //--------------------------------------------------------------
017200171206       //?Gestione videata S01
017300171206       //--------------------------------------------------------------
017400171206       BEGSR GesS01;
017500171206
017600171206       //?Inizializzazione videata
017700171206         IF  wInzS01;
017800171206           exsr InzS01;
017900171206           wInzS01  = *off;
018000171206         ENDIF;
018100171206
018200171206         IF  S01nrr > V01rcd;
018300171206           V01rcd = 1;
018400171206         ENDIF;
018500171206
018600171206       //?Emissione Testata e Piede con tasti funzionali abilitati
018700171206         write TBCLHT01;
018800171206         write TBCLHP01;
018900171206
019000171206       //?Emissione videata
019100171206         exfmt TBCLHC01;
019200171206
019300171206       //?- F12=Ritorno
019400171206         IF  dsp_aid = c_F12;
019500171206           exsr F12S01;
019600171206         ENDIF;
019700171206
019800171206       ENDSR;
019900171206
020000171206       //--------------------------------------------------------------
020100171206       //?Inizializzazione videata S01
020200171206       //--------------------------------------------------------------
020300171206       BEGSR InzS01;
020400171206
020500171206       //?Pulizia subfile
020600171206         exsr PulSfl;
020700171206
020800171206         V01ksc = tnta61ds.TA61ksc;
020900171206
021000171206       //Decodifico il cliente
021100171206         clear tibs69ds;
021200171206         I69kac = V01ksc;
021300171206         TIBS69R (tibs69ds:ds_cnaco:ds_cnind:ds_cnclp:ds_fncls);
021400171206         IF  O69err = *blanks;
021500171206           V01rag = ACOrag;
021600171206         ENDIF;
021700171206
021800171206       //?Caricamento dei dati da presentare nel sfl
021900171206         clear s01nrr;
022000171206         clear xx;
022100171206
022200171206       //?Leggo tabella CLH
022300171206         TBEcod = 'CLH';
022400171206         setll (TBEcod) TNTBE01L;
022500171206         reade (TBEcod) TNTBE01L;
022600171206         DOW not %eof(TNTBE01L);
022700171206           IF  TBEatb = *blanks;
022800171206             wCLHuni = TBEuni;
022900171206             IF  %subst(TBEke2:1:7) = %editc(V01ksc:'X') or
023000171206                 %lookup(%editc(V01ksc:'X'):skCLHksc) > 0;
023100171206               xx += 1;
023200171206               skFIL(xx) = %dec(%subst(TBEKE1:1:3):3:0);
023300171206             ENDIF;
023400171206           ENDIF;
023500171206           reade (TBEcod) TNTBE01L;
023600171206         ENDDO;
023700171206
023800171206         sorta skFIL;
023900171206         xx = 1;
024000171206         FOR xx by 1 to %elem(skFIL);
024100171206           IF  skFIL(xx) > 0;
024200171206             exsr RieS01;
024300171206           ENDIF;
024400171206         ENDFOR;
024500171206
024600171206       //?Visualizzazione del SFL (se ci sono dati)
024700171206         SflDsp = (S01nrr <= *zeros);
024800171206
024900171206       //?Attivazione (eventuale) del SFLEND
025000171206         SflEnd = *on;
025100171206
025200171206       //?Impaginazione subfile
025300171206       //?-> forza l'impaginazione sul 1° rec. del subfile
025400171206         IF  S01nrr > *zeros;
025500171206           V01rcd  = 1;
025600171206         ELSE;
025700171206           clear V01rcd;
025800171206         ENDIF;
025900171206
026000171206       ENDSR;
026100171206
026200171206       //--------------------------------------------------------------
026300171206       //?Pulizia Subfile.
026400171206       //--------------------------------------------------------------
026500171206       BEGSR PulSfl;
026600171206
026700171206       //?Pulizia subfile
026800171206         SflDsp    = *on;
026900171206         SflDspCtl = *on;
027000171206         write TBCLHC01;
027100171206         SflDspCtl = *off;
027200171206         SflEnd    = *off;
027300171206
027400171206         clear V01rcd;
027500171206         clear S01nrr;
027600171206
027700171206       ENDSR;
027800171206
027900171206       //--------------------------------------------------------------
028000171206       //?Caricamento singolo record nel SubFile S01
028100171206       //--------------------------------------------------------------
028200171206       BEGSR RieS01;
028300171206
028400171206         clear TBCLHS01;
028500171206
028600171206         VS1fil = skFIL(xx);
028700171206         chain (VS1fil) AZORG01L;
028800171206         IF  %found(AZORG01L);
028900171206           VS1des = ORGdes;
029000171206         ENDIF;
029100171206
029200171206         S01nrr += 1;
029300171206         write TBCLHS01;
029400171206
029500171206       ENDSR;
029600171206
029700171206       //--------------------------------------------------------------
029800171206       //?Gestione tasto funzionale F12 da videata S01
029900171206       //?F12=Ritorno
030000171206       //--------------------------------------------------------------
030100171206       BEGSR F12S01;
030200171206
030300171206       //?Chiusura del programma
030400171206         Fine = *on;
030500171206
030600171206       ENDSR;
030700171206
030800171206       //--------------------------------------------------------------
030900171206       //?Operazioni finali.
031000171206       //--------------------------------------------------------------
031100171206       BEGSR RoutEnd;
031200171206
031300171206         *inLR = *on;
031400171206         return;
031500171206
031600171206       ENDSR;
