000100091117     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000400020208      *--------------------------------------------------------------------------------------------*
000500130613      *     MANUTENZIONE TABELLA PPA Personalizzazioni partenze per tfp                            *
000600020208      *--------------------------------------------------------------------------------------------*
000700020208      * Data base                                                                                  *
000800020208      *--------------------------------------------------------------------------------------------*
000900091117     fAzOrg01l  if   e           k disk
001200130613     fTNTBE01L  uf A e           k disk
001700091117      *
001800130613     fTnTbppad  cf   e             workstn
001900091117
002000091117       //--------------------------------------------------------------
002100091117       //?Definizione costanti.                                        ?
002200091117       //--------------------------------------------------------------
002300091117
002800091117
002900091117       //--------------------------------------------------------------
003000091117       //?Definizione schiere.                                         ?
003100091117       //--------------------------------------------------------------
003200091117
004000020208      *---
004100020208      * Schiere memorizzazione dati correnti
004200020208      *---
004400130613     D msg             S             78    DIM(2) CTDATA PERRCD(1)              *Messaggi video
004500091117
004600091117       //--------------------------------------------------------------
004700091117       //?Definizione aree dati.                                       ?
004800091117       //--------------------------------------------------------------
004900091117
005000091117       // - Dati utente
005100091117     d §AzUte        e ds                  extname(AZUTE00F)
005200091117     d                                     dtaara
005300091117     d §DatiUte      e ds                  extname(dDatiUte)
005400091117     d                                     dtaara
005401130613
005402130613     d dppa          e ds
005500091117
005600091117       //--------------------------------------------------------------
005700091117       //?Definizione strutture dati.                                  ?
005800091117       //--------------------------------------------------------------
005900091117
007000091117       // - Parametri per Reperimento dati utente
007100091117     d TIBS34ds      e ds                  inz
007200091117
007700091117      *---
007800091117      * architettura
007900091117      *---
008000091117     D kpjba         E DS                                                       *architettura
008100091117
008500091117
008600091117       //--------------------------------------------------------------
008700091117       //?Definizione variabili globali.                               ?
008800091117       //--------------------------------------------------------------
008900091117
009000091117       // - Flags booleani
009100091117     d $Fine           s               n   inz(*off)
009400091117
009600091117
009700091117       // - Indici di schiera
009800020208     D i               S              5  0 INZ                                  *indice
011500091117
011600091117       //--------------------------------------------------------------
011700091117       //?Definizione prototipi procedure.                             ?
011800091117       //--------------------------------------------------------------
011900091117
012000091117       // - Reperimento dati utente
012100091117      /copy gaitrasrc/srcProtoPR,TIBS34R
012500091117
012600020208      *--------------------------------------------------------------------------------------------*
012700020208      * Main lines
012800020208      *--------------------------------------------------------------------------------------------*
012900020208      *
013000020208      * Operazioni iniziali
013100020208      *
013200020208     C                   EXSR      RutInz
013201130613     c                   dow       $fine=*off
013202130613     c                   exfmt     tbppv1
013203130613     c                   eval      *in28=*off
013204130613     c                   eval      v1cmsg=*blanks
013205130613     c                   select
013206130613     c* F3=Fine
013207130613     c                   when      *inkc=*on or dutpou<>simfel
013208130613     c                   eval      $fine=*on
013209130613     c* F5=Ripristino
013210130613     c                   when      *inke=*on
013211130613     c                   eval      *in22=*off
013213130613     c* F16=Annullamento
013214130613     c                   when      *inkq=*on and not *in80
013215130613     c                   eval      tbeatb='A'
013216130613     c                   update    tntbe000
013217130613     c                   eval      $fine=*on
013218130613     c                   other
013219130613     c                   if        not *in22
013220130613     c                   exsr      ctrv1
013221130613     c                   endif
013222130613     c                   if        not *in28 and *inkf
013223130613     C                   EXSR      GesAgg
013224130613     C                   endif
013225130613     c                   endsl
013226130613     c                   enddo
013500020208      *
013501130613     c                   seton                                        lr
014100020208      *
020400020208      *--------------------------------------------------------------------------------------------*
020500020208      * Controllo e decodifica prima videata
020600020208      *--------------------------------------------------------------------------------------------*
020700020208     C     CtrV1         BEGSR
020800020208      *
020900130613     C                   setoff                                       40
020901130613     c                   if        v1coaf=*blanks
020902130613     c                   seton                                        2840
020903130613     c                   eval      v1cmsg=msg(2)
020904130613     c                   endif
021900020208      *
149000020212      *
149100130613     C                   ENDSR
168900020208      *--------------------------------------------------------------------------------------------*
169000020208      * Scrittura/ Aggiornamenti
169100020208      *--------------------------------------------------------------------------------------------*
169200020208     C     GesAgg        BEGSR
169300091117      *
169301130613     c                   eval      §PPAETI=v1ceti
169302130613     c                   eval      §PPAOAF=v1coaf
169303130613
169304130613     c                   if        *in80
169305130613     c                   exsr      writbe
169306130613     c                   else
169307130613     c                   eval      tbeuni=dppa
169308130613     c                   clear                   tbeatb
169309130613     c                   update    tntbe000
169310130613     c                   endif
169311130613
179700091117     C                   eval      $Fine = *on
179800020212      *
179900020208     C                   ENDSR
213200020211      *--------------------------------------------------------------------------------------------*
213300020211      * WriTbe - Scrittura tabella
213400020211      *--------------------------------------------------------------------------------------------*
213500020211     C     WriTbe        BEGSR
213600020211      *
213700130613     C                   clear                   Tntbe000
214200130613     C                   move      'PPA'         TbeCod
214300130613     C                   movel(p)  simfel        TbeKe1
215700020211      *
215701130613     c                   eval      tbeuni=dppa
216900020211      *
217000130613     C                   write     Tntbe000
217100020211      *
217200020211     C                   ENDSR
228300020208      *--------------------------------------------------------------------------------------------*
228400020208      * RutInz - operazioni iniziali
228500020208      *--------------------------------------------------------------------------------------------*
228600020208     C     rutinz        BEGSR
228700020208      *
228800020208      * Ricevimento parametri
228900020208     C     *ENTRY        PLIST
229000020208     C                   PARM                    kpjba
229200091117
229300091117      /free
231000091117
231100091117         // -?Reperimento dati job?
231200091117         exsr  sr_DatiJob;
232000091117
232100091117      /end-free
233300020211      *
233400020211      * Reperisco testata tabella
233500020211     C                   movel     *blanks       Tbecod
233600130613     C                   move      *zeros        TbeKe1
233700130613     C                   move      'PPA'         TbeKe1
233800130613     C     K01Tbe2       chain     Tntbe01l
233900020211      *
234000091117      * Se non esiste la testata tabella: non faccio nulla
234001130613    1c                   if        not %found(tntbe01l)
234100130613     C                   eval      $Fine = *on
234101130613   x1c                   else
234102130613     c                   eval      v1ctfp=simfel
234103130613     c                   clear                   v1dtfp
234104130613     c     simfel        chain     azorg01l
234105130613     c                   if        %found(azorg01l)
234106130613     c                   eval      v1dtfp=orgdes
234107130613     c                   endif
234108130613     c                   eval      *in22=*off
234109130613     c                   eval      tbeke1=%editc(simfel:'X')
234110130613     c                   eval      tbecod='PPA'
234111130613     c     k01tbe2       chain     tntbe01l                           80
234112130613     c* trovato record per tfp --> manutenzione
234113130613    2c                   if        %found(tntbe01l)
234114130613     c                   eval      v1cmod='Manutenzione'
234115130613    3c                   if        tbeatb='A'
234116130613     c                   eval      *in22=*on
234117130613     c                   endif
234118130613     c                   eval      dppa=tbeuni
234119130613     c                   eval      v1ceti=§PPAETI
234120130613     c                   eval      v1coaf=§PPAOAF
234121130613   x3c                   else
234122130613     c* non trovato record per tfp --> immissione
234123130613     c                   eval      v1cmod='Immissione'
234124130613     c                   clear                   v1ceti
234125130613     c                   eval      v1coaf='D'
234126130613    2c                   endif
234127130613     c* se utente di filiale di secondo livello errore di tabella non
234128130613     c* manutenzionabile
234129130613     c                   if        dutpou<>simfel
234130130613     c                   eval      v1cmsg=msg(1)
234131130613     c                   eval      *in28=*on
234132130613     c                   endif
234133130613    1c                   endif
234200020211      *
234900020211      *
235000020211     C                   EndSr
235100020211      *--------------------------------------------------------------------------------------------*
235200020208      *
235300020208      * chiavi di lettura
236700020208      *
236800020211     C     k01tbe2       KLIST                                                  *tntbe01l
236900020211     C                   KFLD                    tbecod                          -tabella
237000020211     C                   KFLD                    tbeke1                          -chiave uno
237100020212      *
238300091117      /free
238400091117
238500091117       //--------------------------------------------------------------
238600091117       //?Reperimento Dati del job (Utente/Operativi).                 ?
238700091117       //--------------------------------------------------------------
238800091117       BEGSR  sr_DatiJob;
238900091117
239000091117         in(e) §AzUte;
239100091117         if NOT %error;
239200091117           in(e) §DatiUte;
239300091117         endif;
239400091117         if %error or RSut = *blank;
239500091117           tibs34r ( tibs34ds );
239600091117           in §AzUte;
239700091117           in §DatiUte;
239800091117         endif;
239900091117
240000091117       ENDSR;
240100091117
240200091117      /end-free
240300091117
240400091117       //--------------------------------------------------------------
240500091117       //?Schiere a tempo di compilazione.                             ?
240600091117       //--------------------------------------------------------------
240700091117
241100020212** Msg
241200130613Filiale utente non abilitata all'uso di questa funzione.Enter per terminare
241300130613Selezionare un ordinamento valido
