000100150424SET CURRENT SCHEMA EDPDCCUR
000110150424;
000120150424-- default -> contrassegni
000130150424INSERT INTO ANCBA00F
000140150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000150150424I.CBAENTITA, I.CBACLIFOR, 'CA', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000160150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000170150424FROM ANCBA00F AS I
000180150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000190150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'CA' = O.CBATPAPPO
000200150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = '' AND (I.CBAIBAN <> '' OR
000210150424I.CBABIC <> '')
000220150424;
000230150424-- nota accredito -> contrassegni
000240150424INSERT INTO ANCBA00F
000250150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000260150424I.CBAENTITA, I.CBACLIFOR, 'CA', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000270150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000280150424FROM ANCBA00F AS I
000290150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000300150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'CA' = O.CBATPAPPO
000310150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'NA' AND (I.CBAIBAN <> '' OR
000320150424I.CBABIC <> '')
000330150424;
000340150424-- nota accredito -> danni
000350150424INSERT INTO ANCBA00F
000360150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000370150424I.CBAENTITA, I.CBACLIFOR, 'DN', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000380150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000390150424FROM ANCBA00F AS I
000400150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000410150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'DN' = O.CBATPAPPO
000420150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'NA' AND (I.CBAIBAN <> '' OR
000430150424I.CBABIC <> '')
000440150424;
000450150424-- danni -> contrassegni
000460150424INSERT INTO ANCBA00F
000470150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000480150424I.CBAENTITA, I.CBACLIFOR, 'CA', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000490150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000500150424FROM ANCBA00F AS I
000510150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000520150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'CA' = O.CBATPAPPO
000530150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'DN' AND (I.CBAIBAN <> '' OR
000540150424I.CBABIC <> '')
000550150424;
000560150424-- danni -> note accredito
000570150424INSERT INTO ANCBA00F
000580150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000590150424I.CBAENTITA, I.CBACLIFOR, 'NA', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000600150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000610150424FROM ANCBA00F AS I
000620150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000630150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'NA' = O.CBATPAPPO
000640150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'DN' AND (I.CBAIBAN <> '' OR
000650150424I.CBABIC <> '')
000660150424;
000670150424-- contrassegni -> danni
000680150424INSERT INTO ANCBA00F
000690150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000700150424I.CBAENTITA, I.CBACLIFOR, 'DN', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000710150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000720150424FROM ANCBA00F AS I
000730150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000740150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'DN' = O.CBATPAPPO
000750150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'CA' AND (I.CBAIBAN <> '' OR
000760150424I.CBABIC <> '')
000770150424;
000780150424-- contrassegni -> note accredito
000790150424INSERT INTO ANCBA00F
000800150424SELECT I.CBASOCIETA, I.CBAKCC, I.CBAKSC, '', '01.01.0001', I.CBACCB, I.CBAABI, I.CBACAB,
000810150424I.CBAENTITA, I.CBACLIFOR, 'NA', CURRENT DATE, I.CBACDCTRL, I.CBAKCCNSBA, I.CBAKSCNSBA, I.CBAIBAN,
000820150424I.CBAFLAG, I.CBACIN, I.CBABIC, I.CBASTATO, I.CBABANK, I.CBABRANCH
000830150424FROM ANCBA00F AS I
000840150424EXCEPTION JOIN ANCBA00F AS O ON I.CBASOCIETA = O.CBASOCIETA AND I.CBACLIFOR = O.CBACLIFOR AND
000850150424I.CBAKCC = O.CBAKCC AND I.CBAKSC = O.CBAKSC AND I.CBAENTITA = O.CBAENTITA AND 'NA' = O.CBATPAPPO
000860150424WHERE I.CBASOCIETA = '201' AND I.CBACLIFOR = 'C' AND I.CBATPAPPO = 'CA' AND (I.CBAIBAN <> '' OR
000870150424I.CBABIC <> '')
000880150424;
000890150424-- tipo pagamento contrassegno = bonifico nazionale
000900150424UPDATE YBACL00F
000910150424SET ACLTPC = '2', ACLDPS = CASE WHEN ACLDPS BETWEEN 19000000 AND 19150000 THEN ACLDPS + 01000000
000920150424ELSE ACLDPS END
000930150424WHERE ACLSOCIETA = '201' AND ACLTPC = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F WHERE CBASOCIETA
000940150424 = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'CA' AND LEFT(CBAIBAN, 2) IN ('IT','SM'))
000950150424;
000960150424-- tipo pagamento contrassegno = bonifico estero.
000970150424UPDATE YBACL00F
000980150424SET ACLTPC = '6', ACLDPS = CASE WHEN ACLDPS BETWEEN 19000000 AND 19150000 THEN ACLDPS + 01000000
000990150424ELSE ACLDPS END
001000150424WHERE ACLSOCIETA = '201' AND ACLTPC = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F WHERE CBASOCIETA
001010150424 = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'CA' AND (LEFT(CBAIBAN, 2) NOT IN ('IT','SM','') OR
001020150424SUBSTR(CBABIC, 5, 2) NOT IN ('IT','SM','')) )
001030150424;
001040150424-- tipo pagamento danni = bonifico nazionale
001050150424UPDATE YBACL00F
001060150424SET ACLTIC = '2' CONCAT SUBSTR(ACLTIC, 2), ACLDPS = CASE WHEN ACLDPS BETWEEN 19000000 AND 19150000
001070150424THEN ACLDPS + 01000000 ELSE ACLDPS END
001080150424WHERE ACLSOCIETA = '201' AND SUBSTR(ACLTIC, 1, 1) = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F
001090150424WHERE CBASOCIETA = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'DN' AND LEFT(CBAIBAN, 2) IN
001100150424('IT','SM'))
001110150424;
001120150424-- tipo pagamento danni = bonifico estero.
001130150424UPDATE YBACL00F
001140150424SET ACLTIC = '6' CONCAT SUBSTR(ACLTIC, 2), ACLDPS = CASE WHEN ACLDPS BETWEEN 19000000 AND 19150000
001150150424THEN ACLDPS + 01000000 ELSE ACLDPS END
001160150424WHERE ACLSOCIETA = '201' AND SUBSTR(ACLTIC, 1, 1) = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F
001170150424WHERE CBASOCIETA = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'DN' AND (LEFT(CBAIBAN, 2) NOT IN
001180150424('IT','SM','') OR SUBSTR(CBABIC, 5, 2) NOT IN ('IT','SM','')) )
001190150424;
001200150424-- tipo pagamento nota accredito = bonifico nazionale
001210150424UPDATE YBACL00F
001220150424SET ACLTIC = SUBSTR(ACLTIC, 1, 1) CONCAT '2', ACLDPS = CASE WHEN ACLDPS BETWEEN 19000000 AND
00123015042419150000 THEN ACLDPS + 01000000 ELSE ACLDPS END
001240150424WHERE ACLSOCIETA = '201' AND SUBSTR(ACLTIC, 2, 1) = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F
001250150424WHERE CBASOCIETA = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'NA' AND LEFT(CBAIBAN, 2) IN
001260150424('IT','SM'))
001270150424;
001280150424-- tipo pagamento nota accredito = bonifico estero
001290150424UPDATE YBACL00F
001300150424SET ACLTIC = SUBSTR(ACLTIC, 1, 1) CONCAT '6', ACLDPS = CASE WHEN ACLDPS = 0 THEN 0 WHEN ACLDPS <
00131015042419150000 THEN ACLDPS + 01000000 ELSE ACLDPS END
001320150424WHERE ACLSOCIETA = '201' AND SUBSTR(ACLTIC, 2, 1) = '' AND ACLKSC IN (SELECT CBAKSC FROM ANCBA00F
001330150424WHERE CBASOCIETA = '201' AND CBACLIFOR = 'C' AND CBATPAPPO = 'NA' AND (LEFT(CBAIBAN, 2) NOT IN
001340150424('IT','SM','') OR SUBSTR(CBABIC, 5, 2) NOT IN ('IT','SM','')))
001350150424;
