000100120302     /*PRM dbgview(*source)
000110120302     /*CMD ovrdbf file(TITAS30C) tofile(GAITRAGRPS/TITAS30C) +
000120120302     /*CMD        ovrscope(*calllvl)
000130120302     /*CMD ovrdbf file(TNBLA00F) tofile(GAITRAGRPS/TNBLA00F) +
000140120302     /*CMD        ovrscope(*calllvl)
000150120302     /*END dltovr file(TITAS30C TNBLA00F) lvl(*)
000160120302     /*END
000170120302      *
000180000920     H DECEDIT('0,') DATEDIT(*DMY.)
000190140423     h dftactgrp(*no) actgrp(*caller) bnddir('UBBNDDIR')
000200940819     F* FNLS01R *-----------------------------------------------------*
000210900427     F*       IMMISSIONE BOLLE
000220040329      *
000230040329      * COMPILARE CON
000240040329      *               OVRDBF FILE(TITAS30C) TOFILE(GAITRAGRPS/TITAS30C)
000250050407      *
000260050407      * Annotazioni:
000270050407     c* La gest.del richiamo a fnls01r con §lpfpr='R'(recupero bolle DskCli)
000280050407     c* è rimasta nel pgm ma non viene più utilizzata. Non è stata tolta
000290050407     c* solo per comodità visto che è presente in più punti del pgm
000300000000     F*---------------------------------------------------------------*
000310160609     FFNLS01D   CF   E             WORKSTN usropn
000320940923     F                                     SFILE(LS01S03:NRR)
000330000829     F                                     SFILE(LS01S08:NR8)
000340021203     FFIAPD01L  IF   E           K DISK
000350950920     FAZCLN01L  IF   E           K DISK
000360990630     FCNNUM00F  UF   E           K DISK    USROPN
000370940822     FCNACO00F  IF   E           K DISK
000380900427     FCNIND00F  IF   E           K DISK
000390050209     Ffncls01l  IF   E           K DISK
000400080904     FTNBLA00F  O  A E           K DISK    USROPN extfile(WTNBLA)
000410930120     FFLNUF01L  UF   E           K DISK
000420991117     FFLNUF02L  UF A E           K DISK
000430991117     F                                     RENAME(FLNUF:FLNUF2)
000440940822     FTNTAM01L  IF   E           K DISK
000450990818     FTITPT01L  IF   E           K DISK
000460930629     FAZORG01L  IF   F 5000     2PIDISK    KEYLOC(4)
000470991117     FTABEL00F  IF   E           K DISK
000480941110     FFNBLD01L  UF A E           K DISK
000490020917     FFIVAD02L  UF   E           K DISK    USROPN
000500020917     FFIVAT01L  UF   E           K DISK    USROPN
000510040601     FFIVAX01L  UF   E           K DISK    USROPN
000520110518     FFIVAb01L  UF   E           K DISK    USROPN
000530110518     Fedivab1L  UF   E           K DISK    USROPN
000540940825     F*
000550061212     FFNBLP01L  IF   E           K DISK
000560061212     F                                     INFDS(FNBLP1)
000570061212     F                                     RENAME(FNBLP000:FNBLP001)
000580061212     FFNBLP00F  UF A E             DISK
000590940825     F*
000600140506     FFNarb01l  iF   E           k DISK
000610140506     f*
000620150929     FFIAR801L  IF A E           K DISK
000630130304     FFIAR802L  iF   E           K DISK    rename(fiar8000:fiar802)
000640940825     F* ESTENSIONE DESCRIZIONI
000650060216     FFiar401L  UF A E           K DISK
000660060215     FFiar403L  IF   E           K DISK
000670060215     F                                     RENAME(Fiar4000:Fiar4003)
000680160209     FFiar405l  IF   E           K DISK
000690060215     F                                     RENAME(fiar4000:Fiar4004)
000700021218     fFiar501l  uf a e           k Disk
000710940825     F*
000720991006     F* TASSAZIONE
000730991006     FFIAR701L  UF A E           K DISK
000740991006     FFIAR601L  UF A E           K DISK
000750940825     F*
000760940825     F* C/ASSEGNO
000770051115     FFiar901L  UF A E           K DISK
000780040603     F*
000790940825     F* DETTAGLIO COLLI
000800940825     FFNBLT01L  UF A E           K DISK
000810120814     FFIART01L  UF A E           K DISK
000820120817     FFIART27L  IF   E           K DISK
000830120817     F                                     RENAME(FIART000:FIART027)
000840120828     FFNBLT27L  IF   E           K DISK
000850120828     F                                     RENAME(FNBLT000:FNBLT027)
000860120816     F***FNBLT29L  IF   E           K DISK
000870120816     F***                                  RENAME(FNBLT000:FNBLT029)
000880120828     FFNART27L  IF   E           K DISK    prefix(BLT:3)
000890051102     FFIARS01L  UF A E           K DISK
000900051102     FFIARS02L  IF   E           K DISK
000910051102     F                                     RENAME(FIARS000:FIARS2)
000920940825     F*
000930940825     FFNLBL01L  UF   E           K DISK    USROPN
000940011126     FFIFTT02L  IF   E           K DISK
000950011126     FFIFST02L  IF   E           K DISK
000960011126     F                                     RENAME(FIFTT000:FIFST000)
000970070123     FFNBRV09L  UF   E           K DISK    USROPN
000980071221     FFNBRV07L  iF   E           K DISK    USROPN
000990071221     F                                     RENAME(Fnbrv000:Fnbrv007)
001000080313     F*TNTBE02L  UF A E           K DISK
001010080313     FTNTBE01L  IF   E           K DISK
001020970107     F* FILE DI EDI
001030970107     FEDRDE01L  UF   E           K DISK    USROPN
001040000204     FFISGN01L  UF A E           K DISK
001050001005     FFISGN05L  UF A E           K DISK
001060001005     F                                     RENAME(FISGN000:FISGN005)
001070010212     F*
001080010212     FFNORM01L  IF   E           K DISK
001090100319     FFNORE01L  IF   E           K DISK
001100120611     FFIDST01L  IF   E           K DISK
001110010214     FFNFVV01L  IF   E           K DISK
001120051123     FFNANM02L  UF   E           K DISK
001130051124     FFNANM01L  UF   E           K DISK
001140051124     F                                     RENAME(FNANM000:FNANM01)
001150151112     Fdppdc01l  uf a E           k DISK
001160040329      * Bolle sede
001170040329     fTitas30c  if   e           k Disk    UsrOpn
001180151014     ffiar531c  uf a e           k disk    usropn
001190151014     F                                     RENAME(Fiar5000:fiar500s)
001200151014     F                                     ignore(Fiar5p00)
001210060209      * STORICIZZAZIONE VARIAZIONI
001220060209     FFIARBT0F  O  A E             DISK    usropn
001230060209     FFIARBU0F  O  A E             DISK    usropn
001240070404     FFIARG01L  UF A E           K DISK
001250160120     F*.......... V A R I A Z I O N I   B O L L E
001260160120     FFiARBF2C  IF   E           K DISK    usropn
001270160120     f                                     rename(fnarbd00:fnarbd0c)
001280160120     f                                     rename(fnarbk00:fnarbk0c)
001290160120     f                                     rename(fnarbg00:fnarbg0c)
001300160120     f                                     rename(fiarbt00:fiarbt0c)
001310160120     f                                     rename(fnarbm00:fnarbm0c)
001320160120     f                                     rename(fnarbv00:fnarbv0c)
001330160120     f                                     rename(fnarbp00:fnarbp0c)
001340160120     f                                     rename(fnarbn00:fnarbn0c)
001350070530     F*
001360080221     f**!!!fipdo01t  if   e           k disk
001370070601     ffnorf01l  if   e           k disk
001380070612     FEDTAB01L  IF   E           K DISK
001390070626     ffidpo03l  if   e           k disk
001400100323     fazfgi01l  if   e           k disk
001410160201     ftiidc01l  uf   e           k disk
001420160125      *.......... T E L E F O N A T E   /   R E C L A M I
001430160303     fFITGD32L  if   e           k disk
001440160203     fFITGD01L  if   e           k disk    RENAME(Fitgd000:fitgd001)
001450970107     F*
001460941221     FFNLV22P   O    F  132        PRINTER
001470960926     D L1              S              3  0 DIM(30)
001480070807     D L6              S              3  0 DIM(30)
001490970925     D*
001500940922     D CPA             S              2    DIM(30)
001510970115     D*
001520970115     D TBO             S              1    DIM(30)
001530970115     D LDC             S              2    DIM(30)
001540941108     D*
001550941107     D TSP             S              1    DIM(10)
001560941107     D UTS             S              1    DIM(10)
001570941115     D STS             S              1    DIM(10)
001580941107     D DTS             S             15    DIM(10)
001590000509     D USO             S              1    DIM(10)
001600090604     D DTS08           S              8    DIM(10)
001610090609     D DTS03           S              3    DIM(10)
001620090827     D TSttc           S              5    DIM(10)
001630960209     D*
001640960209     D TBL             S              2    DIM(20)
001650101022     D S1Y             S              1    DIM(20)
001660940916     D*
001670940923     D K07             S              1    DIM(7)
001680940923     D K09             S              1    DIM(9)
001690940919     D K35             S              1    DIM(35)
001700950920     D K31             S              1    DIM(31)
001710940919     D K78             S              1    DIM(78)
001720970115     D K89             S              1    DIM(89)
001730950104     D SKI             S              1    DIM(15)
001740011211     D SKII            S              1    DIM(14)
001750001214     D KOL             S             10    DIM(20)
001760971211     D*
001770971211     D KSS             S              7    DIM(12)
001780940922     D*
001790900611     D GGG             S              1    DIM(8) CTDATA PERRCD(8)
001800990602     D DES             S             34    DIM(6) CTDATA PERRCD(1)
001810151015     d rigw            s             67    Dim(13) Ctdata Perrcd(1)
001820151014     d cmdt            s             60    dim(02) ctdata perrcd(1)
001830160513     D ERR             S             78    DIM(365) CTDATA PERRCD(1)
001840930611     D*
001850980318     D*  SCHIERE PER COMPORRE SEGNACOLLO EUROEXPRESS
001860980318     D §S9             S              1    DIM(9)
001870980318     D §O9             S              1    DIM(9)
001880980330     D W35             S              1    DIM(35)
001890991201      *  SCHIERA PER COMPORRE BARCODE SU LETTERA VETTURA DPD IMPORT
001900991201      *  SCHIERA PER COMPORRE RMN IN STAMPA SEGNACOLLO DPD IMPORT
001910991201     D W15             S              1    DIM(15)
001920991026      *
001930000830     D* COD. CHI SONO PER CONTROLLI DI RECORD DOPPIO
001940021104     D CHI             S             35    DIM(500)
001950021104     D POS             S              4  0 DIM(500)
001960021104     D ANN             S             15  0 DIM(500)
001970021104     D CH2             S             35    DIM(500)
001980021119     d Prefisso        s              2    Dim(500)
001990930629     D UNIORG        E DS          5000    EXTNAME(AZORG00F)
002000040116      * sk x gestire le varie della seconda bolla
002010041217     d w2sv            s              1    Dim(6)
002020041217     d w2va            s             11  3 DIm(6)
002030061011     d
002040061011     D CAP             S              1    DIM(9)
002050061011     D CAF             S              1    DIM(9)
002060020212     D*
002070130117
002080130117      // - Sk per Tabella OSR
002090130117     d skCLIosr        s              7  0 dim(900)
002100130117     d skLNPNRSosr     s              5    dim(900)
002110150414
002120150414      * filiali abilitate a cons.part "Z"=Expo
002130151119     d*fil_expo        s              3    dim(85)
002140130117
002150130117      // - Indici di schiera
002160130117     d osrxx           s              3  0 inz
002170130117
002180130117      // - Campo di comodo per Ordinante ORM lungo 7
002190130117     d wORMcor         s              7s 0 inz
002200130117
002210090827     d Wttc            s              5
002220090827     d WttcCAP         s              5
002230150929     d KoreTrc         s                   like(oretrc) inz('G')
002240100319     d KAr5Trd         s                   like(Ar5Trd)
002250060515     d Bolksc          s                   Like(blpksc)
002260060515     d Bolctr          s                   Like(vidctr)
002270110304     d savnot          s                   Like(tamnot)
002280020212     D wawb            s             11  0
002290020212     D wawbini         s             11  0
002300021119     d Wpre            s              2
002310030204     d wPkg            s              1
002320030204     d wNba            s              1
002330030204     d w0071           s              7  1
002340030204     d w0053           s              5  3
002350050119     d wsolo_prp       s              1
002360030204     d wTbaPkg1        s                   Like(§TbaPkg)
002370030204     d wTbaVol1        s                   Like(§TbaVol)
002380030204     d wTbaPkg2        s                   Like(§TbaPkg)
002390030204     d wTbaVol2        s                   Like(§TbaVol)
002400150302     d wTba            s                   Like(igatba)
002410030204     d SavNba          s                   Like(§Ar5Nba)
002420030204     d SavNb2          s                   Like(§Ar5Nb2)
002430090804     d w_ar5ass        s                   Like(§Ar5ass)
002440091001     d w_ar5tcp        s                   Like(§Ar5tcp)
002450151117     d w_ar5als        s                   Like(§Ar5als)
002460151117     d w_ar5alx        s                   Like(§Ar5alx)
002470151117     d w_§b4ado        s                   Like(§b4ado)
002480091001     d w_ar5tic        s                   Like(§Ar5tic)
002490091214     d w_ar5cdi        s                   Like(§lpcdi)
002500091001     d sav_tc1         s                   like(vidtc1)
002510091001     d sav_tc2         s                   like(vidtc1)
002520030304     d wrma            s              1    Inz
002530030409     d Dataiso         s               d   datfmt(*iso)
002540030415     d woggi5          s              8  0
002550051214     d*woggi1m         s              8  0
002560051214     d woggidcgm1      s              8  0
002570051214     d woggidcgm2      s              8  0
002580051214     d s_woggidcg      s                   like(woggidcgm1)
002590051214     d s_vpodcg        s                   like(§vpodcgm1)
002600080603     d datam40         s              8  0
002610130305     d datapdf         s              8  0
002620030409     d wwtcr           s              1
002630030409     d wflagore        s              1
002640030409     d wore            s              3  0
002650030409     d §ore            s              2  0
002660030417     d fordcr          s              1    Inz
002670060103     d savddt          s                   like(vidbam)
002680030520     d wnonum          s              1    Inz
002690030704     d wforw03         s              1    Inz
002700030704     d wtotncl         s              6  0
002710030708     d savw03cor       s                   Like(§Ar5bCor)
002720030708     d savw03csf       s                   Like(§Ar5bCsf)
002730030718     d savinkh         s              1
002740030718     d savinki         s              1
002750030728     d wfornba         s              1    Inz
002760030728     d wtotnba         s              3  0
002770031125     d wgva            s              1
002780030805     d wkosr           s              5  0
002790030805     d w012a           s             12
002800040608     d w016ad          s             16
002810031001     d wfortbo         s              1    Inz
002820031201     d wnoccm          s              1    Inz
002830031201     d wforpf          s              1    inz
002840091006     d wope            s                        Like(I28Ope)
002850031219     d wrifp           s                        Like(VatNot)
002860141031     d wPinCode        s             15
002870040114     d va2va2          s                        Like(Vi2Va2)
002880040114     d va2va3          s                        Like(Vi2Va3)
002890040114     d va2va4          s                        Like(Vi2Va4)
002900041217     d va2va5          s                        Like(Vi2Va5)
002910041217     d va2va6          s                        Like(Vi2Va6)
002920040603     d s_vaxprr        s                        Like(vaxprr)
002930050119     d s_vidorm        s                        Like(vidorm)
002940050315     d s_ormpers       s              1
002950040114     d war71           s              1
002960040116     d ContaSv         s              2  0
002970121123     d wesvar1         s              1
002980040216     d wforza1         s              1    inz(*off)
002990040216     d wforza2         s              1    inz(*off)
003000110321     d wforzbrv        s              1    inz(*off)
003010110422     d wforzadrt       s              1    inz(*off)
003020141124     d wforz_lna       s                   like(comlna)
003030141124     d wforz_lnap      s                   like(v0clna)
003040141201     d wForzPCExp      s              1
003050110321     d wcheck          s              1    inz(*off)
003060040226     d p26vol          s              8  3
003070040226     d wrifm           s              1    Inz(*Off)
003080040301     d wkk             s              1    Inz(*Off)
003090040319     d wmodorm         s              1    Inz(*Off)
003100040329     d LnpOgAs         s                   Like(§OgAs)
003110070529     d s_§ogpdaorm     s                   Like(§Ogpdaorm)
003120080111     d*g_ormpor        s                   Like(ormpor)
003130040329     d wlib            s             10
003140040329     d comman          s             80
003150040329     d lenght          s             15  5 inz(80)
003160040302
003170040302     d wtxt            S           2048
003180040302     d TxtInOut        S           2048
003190040302     d ElencoChar      S            256
003200040302     d TipoElenco      S              1
003210100219     d UsaCAss         S              1
003220040302     d CharSost        S              1
003230040302     d UpperCase       S              1
003240040302     d ChkNull         S              1    Inz('1')
003250040302     d CharNull        S              1
003260040302     d Esito           S              1
003270050209     D wclsflo8        S              1
003280081008     D w005a           S              5
003290050331     d wKSCsf1         s              4  0
003300050331     d wKSCsf2         s              4  0
003310051214     d s_d98dce        s                   like(d98dce)
003320061011     d savcapDPD       s                   like(vidcad)
003330061109     d savrsm          s                   like(vidrsm)
003340070827     d W_vidind        s                   like(vidind)
003350061109     d wcdf            s                   like(vidcdf)
003360071022     d wiva            s                   like(vidpim)
003370151106     d wCdfFlg         s                   like(xcfivaflg)
003380061221     d salvatgi        s                   like(g02tgi)
003390081014     d §3cabd_s        s                   like(§3cabd)
003400081023     d cbo_blp         s                   like(vidcbo)
003410061011     d Cappariodpd     S              1
003420120611     d w0050           S              5  0
003430080904     d WTNBLA          s             21    inz('GAITRAGRU /TNBLA00F')
003440091221     d wvidgma         s                   like(vidgma)
003450100604     d w7rRC           s                   like(§7rRC)
003460141202     d w7rPC           s                   like(§7rpincode)
003470100319     d Wofit           s             11  0 inz(99999999999)
003480100323     d kksc            s                   like(acoksc)
003490100323     d klnp            s                   like(blplnp)
003500100323     d klna            s                   like(blplnp)
003510110518     d s_wksc          s                   like(wksc) inz(0)
003520111122     d prelnp          s                   like(vidlnp)
003530111123     d pr0lnp          s                   like(v0clnp)
003540150304     d v2cpkg_i        s                   like(v2cpkg)
003550150304     d varvol_i        s                   like(varvol)
003560130308     d w_allx          s              1
003570130408     d w_allm          s              1
003580130417     d w_alls          s              1
003590130308     d wvatpe          s              1
003600130308     d wvatp           s              1
003610130306     d wvax            s              1
003620130403     d w_prr           s                   like(ar8prr)
003630140307     d w_pdfn          s                   like(§vatppdfn)
003640020212     D*
003650940930     D* PASSO A GESTIONE DETTAGLIO COLLI DA DISK CLIENTI-FNLS78R -
003660900511     D PARAM           DS
003670950321     D  PARCCM               101    107  0
003680941221     D  PARAAS               108    111  0
003690941221     D  PARLNP               112    114  0
003700941221     D  PARNRS               115    116  0
003710941221     D  PARNSP               117    123  0
003720941221     D  PARLNA               124    126  0
003730941221     D  VI3FNS               127    127
003740941221     D  KCI                  128    131  0
003750020917     D  PARFGS               132    134  0
003760160120      * PASSAGGIO A INTERROGAZIONE VARIAZIONI            - FNLR75R -
003770160120     D PARAM1          DS
003780160120     D  PA1AAS                14     17  0
003790160120     D  PA1LNP                18     20  0
003800160120     D  PA1NRS                21     22  0
003810160120     D  PA1NSP                23     29  0
003820160120      *  PREMUTO F3
003830160120     D  PA1F03                30     30
003840160120      *  FLG = "C" CHIUSURA FILES
003850160120     D  PA1FLG                31     31
003860160120     D  PA1PGM                32     41
003870160120     D  PA1DSA                42     61
003880160120     D  PA1GIA               144    144
003890160120     D  PA1FEL               145    147  0
003900160120     D  PA1TBO               148    148
003910160120      *
003920021203      * Ds esterna per ricerca codice padroncino
003930021203     D FNLV24DS      E DS
003940991008     D* STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO/PREPAGATI DA KPJBU
003950950118     D PARAM3          DS
003960950118     D  WPGMSS               246    255
003970990602     D  PARTCH               256    256
003980951228     D* PASSO A CREAZIONE NUMERATORI                   - FNLVCNR -
003990951228     D PARAM4          DS
004000951228     D  PA4CNU                 1      3  0
004010990701     D* PASSO A TASSAZIONE BOLLE                       - TNSF20R -
004020990701     D PARAMF          DS
004030990701     D  WFIAS                256    256
004040940822     D V0DMIT          DS
004050940822     D  V0CRSM                 1     35
004060940907     D  V0CINM                36     70
004070940907     D  V0CLOM                71    105
004080940907     D  V0CCAM               106    114
004090940907     D  V0CPRM               115    116
004100940907     D  V0CNZM               117    119
004110940825     D VIDMIT          DS
004120940825     D  VIDRSM                 1     35
004130940907     D  VIDINM                36     70
004140940907     D  VIDLOM                71    105
004150940907     D  VIDCAM               106    114
004160940907     D  VIDPRM               115    116
004170940907     D  VIDNZM               117    119
004180940824     D*
004190940824     D                 DS
004200940927     D  V0CISM                 1      2
004210940927     D  V0CCPM                 3     16
004220940927     D  V0CPIM                 1     16
004230940824     D                 DS
004240940927     D  VIDISM                 1      2
004250940927     D  VIDCPM                 3     16
004260940927     D  VIDPIM                 1     16
004270940824     D                 DS
004280940927     D  VIDISD                 1      2
004290940927     D  VIDCPD                 3     16
004300940927     D  VIDPID                 1     16
004310940824     D                 DS
004320940927     D  WISO                   1      2
004330940927     D  WCPI                   3     16
004340940927     D  WPIVA                  1     16
004350900427     D TCUDS           DS
004360000000     D  F1                     1      1
004370000000     D  F3                     3      3
004380000000     D  F2                     2      2
004390000000     D  F4                     4      4
004400000000     D  F56                    5      6
004410900514     D                 DS
004420900514     D  VIDLNP                 1      3  0
004430900514     D  VIDNRS                 4      5  0
004440900514     D  VIDNSP                 6     12  0
004450900514     D  VIDSPE                 1     12  0
004460040506     d                 DS
004470040506     d  widlnp                 1      3  0
004480040506     d  widnrs                 4      5  0
004490040506     d  widnsp                 6     12  0
004500040506     d  widspe                 1     12  0
004510900514     D                 DS
004520120828     D  BLTLNP                 1      3  0
004530120828     D  BLTNRS                 4      5  0
004540120828     D  BLTNSP                 6     12  0
004550120828     D**ARTLNP                 1      3  0
004560120828     D**ARTNRS                 4      5  0
004570120828     D**ARTNSP                 6     12  0
004580910829     D  BLPSPE                 1     12  0
004590940214     D                 DS
004600940214     D  VARNCL                 1      5  0
004610940214     D  VARCDP                 6     20
004620940214     D  VARCN                  1     20
004630950921     D                 DS
004640950921     D  WAA                    1      4  0
004650950921     D  WMM                    5      6  0
004660950921     D  WGG                    7      8  0
004670950921     D  WDATA                  1      8  0
004680991201      * PER SEGNACOLLO DPD
004690991214     D                 DS
004700991214     D  DPDSTA                 1     26
004710991214     D  DPDCOS                 1     12
004720991214     D  DPDSTP                13     26
004730991214     D  DPDS1                 13     15
004740991214     D  DPDV1                 16     16    INZ
004750991214     D  DPDS2                 17     24
004760991214     D  DPDV2                 25     25    INZ
004770991214     D  DPDS3                 26     26
004780991214     D                 DS
004790991214     D  DPDPAR                 1     12
004800991214     D  DPD1                   1      3
004810991214     D  DPD2                   4     11
004820991214     D  DPD3                  12     12
004830940819     D***
004840940819     D* PARAMETRI PER CONTROLLO DATA E TRASFORM IN GIORNI - XSRDA8 -
004850940819     D***
004860940819     D WLBDAT          DS                  INZ
004870940819     D  G02DAT                 1      8  0
004880940819     D  G02INV                 9     16  0
004890940819     D  G02ERR                17     17
004900940819     D  G02TGI                18     22  0
004910940819     D***
004920940819     D* PARAMETRI PER TRASFORM GIORNI IN DATA             - XSRDGI -
004930940819     D***
004940940819     D WGIDAT          DS                  INZ
004950940819     D  GIODAT                 1      8  0
004960940819     D  GIOINV                 9     16  0
004970940819     D  GIOTGI                17     21  0
004980000000     D KPJBA         E DS
004990991117      * CALCOLO DEL CHCK DIGIT PER BARCODE DPD
005000991117     D                 DS
005010991117     D  DPDLNP                 1      3  0
005020991117     D  DPDGMS                 4      7  0
005030010222     D  DPDNDS                 8     11  0
005040991117     D  §11                    1     11  0
005050991201     D                                     DIM(11)
005060991117     D  DPDCHD                12     12  0
005070991117     D  DPDBRC                 1     12  0
005080000915     D                 DS
005090000915     D  V8HFLS                 1      3  0
005100000915     D  V8HLNA                 4      6  0
005110000915     D  V8HNRS                 7      8  0
005120000915     D  V8HNSC                 9     15  0
005130000915     D  V8HCOL                 1     15  0
005140000915     D                 DS
005150000915     D  KFLSAN                 1      3  0
005160000915     D  KLNAAN                 4      6  0
005170000915     D  KNRSAN                 7      8  0
005180000915     D  KNSCAN                 9     15  0
005190000915     D  KANNUL                 1     15  0
005200010212     D                 DS
005210010213     D  WOPOE                  1      3  0
005220010222     D  WONSR                  4      5  0
005230010222     D  WONOR2                 6     12  0
005240010222     D  WONOR                  4     12  0
005250010213     D  WONRV                 13     14  0
005260010222     D  WIDOR1                 4     14  0
005270010215     D  WIDORM                 1     14  0
005280010215     D                 DS
005290010215     D  VIDPOE                 1      3  0
005300010222     D  VIDNOR                 4     12  0
005310010215     D  VIDNRV                13     14  0
005320010215     D  VIDORM                 1     14  0
005330010219     D                 DS
005340010219     D  V0CPOE                 1      3  0
005350010222     D  V0CNOR                 4     12  0
005360010219     D  V0CNRV                13     14  0
005370041220     D  V0CORM1                4     14  0
005380010219     D  V0CORM                 1     14  0
005390041220     D                 DS
005400041220     D  s_v0cpoe               1      3  0
005410041220     D  s_v0cnor               4     12  0
005420041220     D  s_v0cnrv              13     14  0
005430041220     D  s_v0corm               1     14  0
005440030805     d                 ds
005450030805     d  savOrmPoe              1      3  0
005460030805     d  savOrmNsr              4      5  0
005470030805     d  savOrmNor              6     12  0
005480030805     d  savOrmNrv             13     14  0
005490030805     d  savkeyorm              1     14  0
005500040227
005510040227     d  OrmRfa         ds
005520040227     d  wrmbolla               1      1
005530040227     d  wrmaas                 2      3
005540040227     d  wrmlnp                 4      6
005550040227     d  wrmnrs                 7      8
005560040227     d  wrmnsp                 9     15
005570030805
005580000901     D DSBLD7        E DS
005590000901     D  §C                     1     17  0
005600000901     D                                     DIM(17)
005610001012     D                 DS
005620000911     D  §CB                    1     18  0
005630000901     D                                     DIM(18)
005640000911     D  §CA                    1     18
005650000911     D                                     DIM(18)
005660001012     D                 DS
005670001012     D  §2                     1      2  0
005680000901     D                                     DIM(2)
005690001012     D  §2A                    1      2
005700000901     D                                     DIM(2)
005710991011     D* DS PER YEURCO - EURO CONVERTITORE
005720991011     D DSYEUR        E DS                  EXTNAME(YEURCODS)
005730061109     d
005740061109     d* Controllo codice fiscale
005750151106     d xcfiva1ds     e ds
005760061109     d
005770061110     D* DS PER YCO601R - RICERCA codice fiscale
005780061109     D YCO600DS      E DS
005790940819     D*
005800991007     D DS$2          E DS
005810991007     D OG148         E DS
005820000204     D OG150         E DS
005830000204     D OG143         E DS
005840020213     D A_og143       E DS                  EXTNAME(OG143)
005850020213     D                                     prefix(A_)
005860040525     D A_og150       E DS                  EXTNAME(OG150)
005870040525     D                                     prefix(A_)
005880080623     D edidspu       E DS
005890000623     D DSBL4W        E DS
005900140122     D*DSBL4J        E DS
005910010212     D DSBL4M        E DS
005920141103     D DSBL4Y        E DS
005930110706     D DSBL44        E DS
005940061122     D S_dsbl4m      E DS                  EXTNAME(dsbl4m)
005950061122     D                                     prefix(S_)
005960070620     D  s_§b4orm               1     14  0
005970070627     D  s_§b4fit               4     14  0
005980160209     D A_dsbl4m      E DS                  EXTNAME(dsbl4m)
005990160209     D                                     prefix(A_)
006000070620
006010020523     D DSBL4A        E DS
006020010925     D DSBL4Z        E DS
006030061003     D*DSBL4F        E DS
006040060509     D DSBL4I        E DS
006050060509     D DSBL4K        E DS
006060991203     D DSBL4E        E DS
006070971215     D DSBLDE        E DS
006080971215     D DSBLD         E DS
006090000627     D DBLP          E DS
006100150916     D DBLP01        E DS
006110991007     D DTAS          E DS
006120040329     d  §tasflo      e                     extfld(tasflo)
006130991007     D DTASV         E DS
006140941108     D  VSV                    1     20
006150941108     D                                     DIM(20)
006160991008     D  VVA                   21    140P 3
006170991007     D                                     DIM(20)
006180991007     D  VES                  141    160
006190941108     D                                     DIM(20)
006200971216     D DS1A          E DS
006210900529     D DS1B          E DS
006220940928     D DS1P          E DS
006230061030     d
006240940928     D DS15          E DS
006250080414     D*ds15x         E DS                  EXTNAME(ds15)
006260080414     d**                                   prefix(X_)
006270160224     D DS16          E DS
006280061030     d
006290101022     D DS1Y          E DS
006300101022     D DS3A          E DS
006310921217     D DS3C          E DS
006320100517     D** D3cp          E DS
006330940825     D DS3I          E DS
006340991213     D DS3IDP        E DS
006350000509     D DS3IPT        E DS
006360941102     D DS5E          E DS
006370980806     D DS7T          E DS
006380041126     D DS7S          E DS
006390051124     D DS7c          E DS
006400100217     D DS7R          E DS
006410921217     D DSCC          E DS
006420921217     D DSCT          E DS
006430940826     D DSCV          E DS
006440011108     D DSCW          E DS
006450020725     D DYIV          E DS
006460000124     D DSTA01        E DS
006470061002     d* campo §tasflo della DTAS
006480061002     D DTAS01        E DS
006490000124     D DSTB          E DS
006500940914     D DSQT1         E DS
006510921217     D DSTM          E DS
006520060208     D DS7L          E DS
006530991008     D DGED          E DS
006540991008     D DGEI          E DS
006550010924     D DORM01        E DS
006560010409     D DDFT          E DS
006570010409     D  §DFORA       E                     EXTFLD(D§DFTORA)
006580010409     D  §DFORR       E                     EXTFLD(D§DFTORR)
006590010409     D  §DFTOR       E                     EXTFLD(D§DFTTOR)
006600010409     D  §DFTCO       E                     EXTFLD(D§DFTTCO)
006610010409     D  §DFDDT       E                     EXTFLD(D§DFTDDT)
006620010409     D  §DFPAG       E                     EXTFLD(D§DFTPAG)
006630010409     D  §DFPKG       E                     EXTFLD(D§DFTPKG)
006640010409     D  §DFBNC       E                     EXTFLD(D§DFTBNC)
006650010409     D  §DFMAX       E                     EXTFLD(D§DFTMAXKG)
006660000120     D DCHI          E DS
006670010212     D DFAR          E DS
006680010215     D  §FARDS       E                     EXTFLD(D§FARDES)
006690010215     D  §FARFB       E                     EXTFLD(D§FARFFB)
006700010309     D  §FARNF       E                     EXTFLD(D§FARNONF)
006710010319     D  §FARMN       E                     EXTFLD(D§FARMAN)
006720010319     D  §FARST       E                     EXTFLD(D§FARSTP)
006730010319     D  §FARAF       E                     EXTFLD(D§FARAFVV)
006740010319     D  §FARCF       E                     EXTFLD(D§FARCFVV)
006750011025     D  §FAROO       E                     EXTFLD(D§FARNOO)
006760011025     D  §FARUV       E                     EXTFLD(D§FARUVA)
006770011025     D  §FARDV       E                     EXTFLD(D§FARDVA)
006780060103     d ddstflo       e ds
006790021120     D DDFE          E DS
006800021218     d Dar5Ban       e Ds
006810030704     d Dar5Bnb       e Ds
006820151015     d Dar5FAT       e Ds
006830130306     d Dar8§pdf      e Ds
006840030204     d dTba          e ds
006850030326     d dDcr          e ds
006860030805     d dAr5Rcc       e Ds
006870030805     d dOsr          e Ds
006880031113     d Dar5Gen       e Ds
006890100319     d DoreGen       e Ds
006900110512     d Dar5Emd       e Ds
006910031125     d dVato         e ds
006920110704     d dVat4         e ds
006930130306     d dVatP         e ds
006940130315     d dVats         e ds
006950040701     d dVpoppt       e ds
006960041217     d dVpo          e ds
006970060207     d dVpodeco      e ds
006980150304     d dVpotellus    e ds
006990121017     d ddgd          e ds
007000160323     d dnsd          e ds
007010081111      * Ds date statistiche
007020081111     d dSdf          e ds
007030110818     d*** dVUS          e ds
007040110818     d dxco          e ds
007050110818     D  vaa                    1     10    dim(10)
007060060612     d dVate         e ds
007070070529     d dPdo          e ds
007080071220     d dcli          e ds
007090090625     d trulticds     E DS
007100100517     d trulNRSds     E DS
007110061106     D TRULdepds     E DS
007120030610      * DS - PARAMETRI PER STAMPA BOLLE ED ETICHETTE
007130030610     D TRUL90DS      E DS
007140030611     D WTRUL90DS     E DS                  extname(TRUL90DS) prefix(W)
007150060619      * DS PER FIEU12R - CREAZIONE EVENTI FISSI DPD
007160060619     D fieu12ds      E DS
007170941005     D* DS PER TRTB69R - TRTB70R - TRTB72R - TRTB73R - INT E GEST PARTI
007180941005     D DS7PQR        E DS                  EXTNAME(DS7PQRS)
007190940919     D* DS PER TRUL06R - CARICAMENTO £X
007200940919     D DSUL06        E DS                  EXTNAME(TRUL06DS)
007210940919     D  LIN                    1     90  0
007220960926     D                                     DIM(30)
007230011211     D* DS PER TRUL21R - CONTROLLO LIMITI IMPORTO DA C/ASSEGNO
007240011211     D DSUL21        E DS                  EXTNAME(TRUL21DS)
007250011211     D* DS PER TRUL22R - CONTROLLO LIMITI IMPORTO DA ASSICURARE
007260011211     D DSUL22        E DS                  EXTNAME(TRUL22DS)
007270011211     D  I22TLS       E                     EXTFLD(I22TLA)
007280011211     D  I22LNS       E                     EXTFLD(I22LNA)
007290011212     D  I22LPS       E                     EXTFLD(I22LNP)
007300011212     D* DS PER TRUL23R - CONTROLLO LIMITI VALORE MERCE
007310011212     D DSUL23        E DS                  EXTNAME(TRUL23DS)
007320090608     D* DS PER TRUL73R - CONTROLLO LIMITI per tipo servizio
007330090608     D trul73ds      E DS
007340020320     D* DS PER TRUL33R - REPERIMENTO/AGGIORNAMENTO NUMERATORI SU AZNUM
007350020320     D TRUL33DS      E DS
007360991102     D* DS PER TIBS02R - GESTIONE TNTBE00F
007370991102     D DSBS02        E DS                  EXTNAME(TIBS02DS)
007380050502     D* DS PER FNLV20R - DS DEI CAMPI PER CALCOLO VOLUME DA FATTURARE
007390050502     D DSLV20        E DS                  EXTNAME(FNLV20DS)
007400030626     D* DS PER STAMPA BOLLA
007410030626     D fnlsb5DS      E DS
007420130315     d FNLSB6ds1     e ds                  inz
007430130419     d   DB6pdf      e                     inz('X')
007440991014     D* DS PER FNLV04R - CALCOLO TOTALE FATTURA SE IMMESSO NUMERO E DAT
007450991014     D DSLV04        E DS                  EXTNAME(FNLV04DS)
007460970707     D* DS PER FNLV13R - CONTROLLO DI UN CAP
007470970707     D DSLV13        E DS                  EXTNAME(FNLV13DS)
007480970707     D* DS PER FNLV14R - CONTROLLO DI INDIRIZZO COMPLETO  SENZA CAP
007490970707     D DSLV14        E DS                  EXTNAME(FNLV14DS)
007500970702     D* DS PER TISI95R - CONTROLLO DI CAP
007510970702     D DSSI95        E DS                  EXTNAME(TISI95DS)
007520060922     D TISI97DS      E DS
007530160223     D d_TISI97DS    E DS                  extname(tisi97ds)
007540160223     D                                     prefix(d_)
007550150731
007560150731     D DSSI00        E DS                  EXTNAME(TISI00DS)
007570150731     D tisi30ds      E DS
007580150731
007590060619     D* DS PER TISIE3R - CAPPARIO DPD  - NUOVO
007600060619     D TISIe3ds      E DS
007610061011     D* DS PER TISIE8R - interrogazione CAPPARIO DPD  - NUOVO
007620061011     D TISIe8ds      E DS
007630991008     D* DS PER FNLV16R - CONTROLLO TASSAZIONE
007640991008     D DSLV16        E DS                  EXTNAME(FNLV16DS)
007650040115     D DLV1601       E DS
007660941025     D* DS PER FNLV18R - CALCOLO DI UN VOLUME AUTOMATICO
007670941025     D DSLV18        E DS                  EXTNAME(FNLV18DS)
007680060215     D* DS PER FNLV19R - PER SCRITTURA Fiar400F
007690941028     D DSLV19        E DS                  EXTNAME(FNLV19DS)
007700050920     D* DS PER FNLV59R - CARICAMENTO E CONTROLLO TARIFFE DI 1 CLIENTE
007710050920     D fnlv59ds      E DS
007720970925     D* DS PER FNLV55R - RICERCA TERMINAL DI PARTENZA/ARRIVO
007730970925     D DSLV55        E DS                  EXTNAME(FNLV55DS)
007740970925     D* DS PER TNSD99R - CALCOLO  DELLA CONSEGNA TEORICA BOLLA
007750970925     D DSSD99        E DS                  EXTNAME(TNSD99DS)
007760000907     D* DS PER FNLSZ1R - CONTROLLO COD. "CHI SONO"
007770000907     D DSLSZ1        E DS                  EXTNAME(FNLSZ1DS)
007780020213     D* DS PER TRUL27R - Ricerca tarfiffa di cartello
007790160219     D*trul27ds      E DS
007800160219     D* DS PER TRUL27R1 - Ricerca network bolla
007810160219     D trul27ds1     E DS
007820160219     D* DS PER TRUC27R  - Ricerca tariffa di cartello
007830160219     D trulc7ds      E DS
007840051206     D* DS PER tntb51R - controllo se dati EDI trasferiti
007850051206     D tntb50ds      E DS
007860061122     D fior51ds      E DS
007870070604     D fior56ds      E DS
007880081014     D trtc86drds    E DS
007890150226     D tisigads      E DS
007900030326     d Trul13ds      e ds
007910030326     D  tI13Tla      e                     EXTFLD(I13Tla)
007920030326     D  tO13Err      e                     EXTFLD(O13Err)
007930030326     D  tO13Msg      e                     EXTFLD(O13Msg)
007940111206     d
007950111206     d Trul13ds1     e ds
007960090325
007970090325     D TIBS69DS      E DS
007980090515     D ds_cnaco      E DS                  extname(CNACO00F) prefix(BS_)
007990090515     D ds_cnind      E DS                  extname(CNIND00F) prefix(BS_)
008000090515     D ds_cnclp      E DS                  extname(CNCLP00F) prefix(BS_)
008010090515     D ds_fncls      E DS                  extname(FNCLS00F) prefix(BS_)
008020090325
008030980108     D CNCR80        E DS
008040900427     D UT§DSE        E DS                  EXTNAME(UT§DSE0F)
008050000000     D  TCU                  398    697
008060000000     D                                     DIM(50)
008070000000     D  KCU                  698    847P 0
008080000000     D                                     DIM(50)
008090000000     D                                     PACKEVEN
008100000000     D  DTU                  848    895P 0
008110000000     D                                     DIM(12)
008120000000     D                                     PACKEVEN
008130991214     D* DS DI BLP
008140000211     D DSBLP0        E DS                  EXTNAME(FNBLP00F)
008150000211     D DSBLD0        E DS                  EXTNAME(FNBLD00F)
008160000211     D DSSGN0        E DS                  EXTNAME(FISGN00F)
008170041019     D SAVBLP        E DS                  EXTNAME(FNBLP00F)
008180041019     D                                     prefix(x_)
008190001130     D* DS RICHIAMO PROGRAMMA CANCELLAZIONE BOLLA SINGOLA
008200001130     D DSLS63        E DS                  EXTNAME(FNLS63DS)
008210010216     D* DS RICHIAMO PROGRAMMA RICERCA O.R.M.
008220150928     D*DSOR04        E DS                  EXTNAME(FIOR04DS)
008230150928     D fior010ds     E DS
008240110419     D fior58ds      E DS
008250010228     D* DS RICHIAMO PROGRAMMA IMMISSIONE ORM PREPAGATO
008260010228     D DSOR05        E DS                  EXTNAME(FIOR05DS)
008270010228     D  §RMPOO       E                     EXTFLD(§RMPOEO)
008280010228     D  §RMNSO       E                     EXTFLD(§RMNSRO)
008290010228     D  §RMNOO       E                     EXTFLD(§RMNORO)
008300010228     D  §RMNRO       E                     EXTFLD(§RMNRVO)
008310980318     D* DS PER COMPOSIZIONE SEGNACOLLO EUROEXPRESS
008320980318     D                 DS
008330980318     D  WJUT                   1      3    INZ('JUT')
008340980318     D  WIT                    4      5    INZ('IT')
008350051102     D  ARSFLS                 6      8  0
008360051102     D  ARSNRS                 9     10  0
008370051102     D  ARSNSC                11     17  0
008380011120     D  W15C                  18     19
008390011107     D  W55L                  18     21
008400980408     D  WCADN                 22     32
008410980408     D  DSEEX                  1     32
008420010216     D*
008430010216     D* DS PER RICHIAMO FIOR07R PER VISUALIZZAZIONE ORM
008440010216     D FIOR07          DS
008450010216     D  D07POE                 1      3  0
008460010216     D  D07NOR                 4     10  0
008470010216     D  D07NSR                11     12  0
008480010216     D  D07NRV                13     14  0
008490010216     D  D07SCE                15     15
008500010216     D  D07FGS                16     18  0
008510010216     D  D07POR                19     21  0
008520010216     D  D07DTR                22     29  0
008530010216     D  D07MDB                30     39
008540010216     D  D07PRB                40     49
008550010216     D  D07DTS                50     57  0
008560010216     D  D07RMP                58     58
008570010216     D  D07BRC                59     59
008580010216     D  D07REF                60     61
008590010216     D  D07MIO                62     62
008600011108     D DSEDIT        E DS                  EXTNAME(XEDITDS)
008610011108     D  IEDNUM       E                     EXTFLD(IEDNUMERO)
008620011108     D  IEDNRD       E                     EXTFLD(IEDNRDEC)
008630011108     D  IEDEDT       E                     EXTFLD(IEDEDTCOD)
008640011108     D  IEDLEN       E                     EXTFLD(IEDLENFLD)
008650011108     D  OEDNUM       E                     EXTFLD(OEDNUMAN)
008660011108     D  OEDFLG       E                     EXTFLD(OEDFLGERR)
008670011108     D  OEDCOD       E                     EXTFLD(OEDCODERR)
008680020530     D*
008690060213     D DSARBD        E DS
008700060213     D DSARBG        E DS
008710060213     D DARBT         E DS
008720060213     D DSARBK        E DS
008730060213     D fnlr48ds      E DS
008740020530     D tisit0ds      E DS
008750070924     D tisit0x1ds    E DS
008760091006      * ds x richiamo pgm FNLS28R
008770091006     d Fnls28ds      e ds
008780040227      * ds x richiamo pgm FNLS26R
008790040227     d Fnls26ds      e ds
008800060125      * ds x richiamo pgm FNLS25R
008810060125     d Fnls25ds      e ds
008820060207      * ds x richiamo pgm FNLv85R
008830060207     d Fnlv85ds      e ds
008840060616     d trul28ds4     e ds
008850061127     d fidn12ds      e ds                  prefix(dn_)
008860110512     d dsemail       e ds
008870110517     d Fnls80ds      e ds
008880110517     d  dPog                   1     90  0 Dim(30)
008890140507     d fidna6ds      e ds
008900160129     d fidna7ds      e ds
008910160125     d FIDNA2ds      e ds                  inz
008920160125     d  IA2mod       e                     inz('I')
008930160125     d  IA2tor       e                     inz('S')
008940060208     D cndizion      E DS
008950060208     D                                     BASED(nullPtr)
008960060208     D                                     PREFIX(diz)
008970120615     d trulflbds     e ds
008980080109      * - Aggiunta/Sottrazione di n giorni lavorativi ad una data
008990080109     d TRUL52ds      e ds
009000151023
009010151023     d fieulpdds     e ds
009020151023
009030051123     d* Ds per richiamo fnlsa8r
009040051124     D*PARAM2          DS
009050051123     D* PARAM2: PASSAGGIO AD ANNULLAMENTO ANOMALIE E DATE
009060051124     D**wrvnfv                 2      6  0
009070051124     D**BRVNPG                 7      7  0
009080051124     D**BRVLNP                 8     10  0
009090051124     D**BRVLNA                11     13  0
009100051124     D**BRVNRS                14     15  0
009110051124     D**BRVNSC                16     22  0
009120051124     D**BRVCAN                23     23
009130051124     D**BRVVUC                24     30  6
009140051124     D**PARFLG                31     31
009150051124     D**PARFEL                92     94  0
009160051124     D**BRVNPS                95     96  0
009170051124     D**BRVFGS                97     99  0
009180051124     D**BRVFLE               100    102  0
009190051124     D**BRVpes               103    105  0
009200080410     D dcppflo       e ds
009210080410     D dntw          e ds
009220140121     D dspr          e ds
009230140612
009240140612     d TRULVPODS     e ds
009250160304     d** sk_VPODIR            16    765    inz   dim(250)
009260160310     d   sk_VPODPD            16    765    inz   dim(250)
009270150701     d* Aggiorna record di FISGN duplicati su altro Terminal di Partenza
009280150701     d fnlssgnds     e ds
009290160223      *
009300160223     d fnlvdpds      e ds
009310061212     d*
009320061212     D FNBLP1          DS
009330061212     D  BLPNRR               397    400B 0
009340160125      *?definizione oggetto reclamo come spedizione?
009350160125     d ds_OggSped      ds                  inz
009360160125     d  wdna2lnp                      3s 0 inz
009370160125     d  wdna2nrs                      2s 0 inz
009380160125     d  wdna2nsp                      7s 0 inz
009390160125     d  wdna2aas                      4s 0 inz
009400020212     d*
009410020212     d xw              s              2  0
009420020212     d zw              s              2  0
009430020212     d totale          s              3  0
009440020212     d intero          s              2  0
009450020212     d restof          s              2  0
009460021120     d Ksc8888         s              4  0
009470021120     d DueCtr          s              2  0
009480021120     d Wctr            s                   Like(VidCtr)
009490020212     d*
009500020212     d fedexbrc        ds
009510020212     d  fbrc                   1     11  0 dim(11)
009520020212     d  fchd                  12     12  0
009530020212     d*
009540020212     d base            s              1  0 dim(3)
009550020308     d*
009560020308     d sav_dslsz1      s                   like(dslsz1)
009570021118     d SavGdd          s                   Like(O95Gdd)
009580020308     d w8hcol          s                   like(v8hcol)
009590020308     d w8cnot          s                   like(v8cnot)
009600020308     d wnopos          s              1
009610020319     d clintw          s                   like(§ogntw)
009620081215     d ntwpor          s                   like(§ogntw)
009630020530     d wdisag          s                   like(ot0dos)
009640030305     d savdisag        s                   like(ot0dos)
009650070924     d savpart         s                   like(ot0dos)
009660080307     D WY              s              2  0
009670021203
009680021203     D kpdpdr          S                   LIKE(APDpdr)
009690021203     D kpdtip          S                   LIKE(APDtip)
009700060109     d d_o95lna        s                   like(o95lna)
009710060109     d d_o95znc        s                   like(o95znc)
009720060109     d d_o952ln        s                   like(o952ln)
009730060308     d wcvb            s                   like(ilv85cvb)
009740060522     d kfgs            s                   like(dstfgs)
009750060522     d w_pogest        s                   like(dstfgs)
009760060622     d §lpcad_w        s                   like(§lpcad)
009770060707     d savaogntw       s                   like(§ogntw)
009780061121     d poentw          s                   like(§ogntw)
009790061012     d wdpc            s                   like(pdcdpc)
009800060613     d wsolo_num       s              1
009810060614     d comnrd          s             14  0
009820061218     d savnrr          s                   like(blpnrr)
009830070322     d wparcel         s              2
009840070404     d w_cgi           s                   like(§lpcgi)
009850070404     d lna_sav         s                   like(blplna)
009860070427     d savtb1          s                   like(flgtb1)
009870120926     d savrbl          s                   like(§3arbl)
009880120927     d wagc            s                   like(blpaas)
009890070612     d kedcod          s                   like(tabcod)
009900070612     d kedkey          s                   like(tabkey)
009910070626     d kdpodep         s                   like(dpodep)
009920070626     d kdpoord         s                   like(dpoord)
009930070829     d s_drt           s                   like(viddrt)
009940070829     d s_drtblp        s                   like(viddrt)
009950081111     d s_drtblpi       s                   like(blpdrt)
009960071023     d w_callyco       s              1
009970080313     d k_tbecod        S                   LIKE(tbecod)
009980080313     d k_tbeke1        S                   LIKE(tbeke1)
009990100517     d** wparz           s              1
010000100517     d** wparz_d         s                   like(vidncd)
010010100517     d** wparz_a         s                   like(vidnca)
010020080314     d w_bldncd        s                   like(bldncd)
010030080314     d w_bldnca        s                   like(bldnca)
010040100517     d** no_range        s              1
010050080314     d f_range         s              1
010060090429     d wemznc          s              2  0
010070090429     d wmsgzo          s              1
010080090609     d wmsgtsp         s             78
010090090609     d wvid            s              1
010100090609     d wncl            s                   like(v1cncl)
010110090609     d wpes            s                   like(vidpkg)
010120090609     d wvol            s                   like(vidvol)
010130090609     d wncl_pre        s                   like(v1cncl)
010140090609     d wpes_pre        s                   like(vidpkg)
010150090609     d wvol_pre        s                   like(vidvol)
010160160219     d oc7prgc_        s                   like(tamprg)
010170160219     d s_27ntw         s                   like(o27ntw)
010180060208     d*
010190060208     D nullPtr         S               *
010200060208     D prmAas          S
010210060208     D                                     LIKE(diz$Aas)
010220060208     D prmLnp          S
010230060208     D                                     LIKE(diz$Lnp)
010240060208     D prmNrs          S
010250060208     D                                     LIKE(diz$Nrs)
010260060208     D prmNsp          S
010270060208     D                                     LIKE(diz$Nsp)
010280060208     D prmFiv          S
010290060208     D                                     LIKE(diz$Fiv)
010300060208     D prmDft          S
010310060208     D                                     LIKE(diz$Dft)
010320060208     D prmNft          S
010330060208     D                                     LIKE(diz$Nft)
010340060208     D prmEsito        S             10I 0
010350020212     d*
010360090325     d $Fine           s               n   inz(*off)
010370090326     d wclg            s                   like(§b4clg)
010380090326     d w_§lpksca       s                   like(§lpksca)
010390090326     d w_§lpctra       s                   like(§lpctra)
010400090326     d s_fnlv59ds      s                   like(fnlv59ds)
010410090326
010420090327     d s_wcliksc       s                   like(wcliksc)
010430090326     d s_wclictr       s                   like(wclictr)
010440090327     d s_ormksc        s                   like(ormksc)
010450090327     d s_ormctr        s                   like(ormctr)
010460140211     d ormloc_n        s                   like(ormloc)
010470110516     d s_wemdest       s                   like(wemdest)
010480140423     d s_wsms          s                   like(wsms)
010490160511     d sav_wemdest     s                   like(wemdest)
010500160511     d sav_wsms        s                   like(wsms)
010510130315     d wsms            s                   like(§vatstel)
010520130315     d wsmp            s                   like(§vatssmp)
010530130918     d wmmp            s                   like(§vatsmmp)
010540130918     d wmmp_ar5        s                   like(§ar5mmp)
010550110705     d s_wcupcup       s                   like(wcupcup)
010560110705     d s_wcupcig       s                   like(wcupcig)
010570110705
010580091211     d nochkticC       s               n   inz(*off)
010590110518     d wfvab           s               n   inz(*off)
010600110818     d werrxco         s               n   inz(*off)
010610111026     d RA_ncd          s                   like(vidncd)
010620111026     d RA_nca          s                   like(vidnca)
010630111026     d RA_ncl          s                   like(savncl)
010640111026     d RA_lna          s                   like(savlna)
010650111026     d wRA_lna         s                   like(blplna)
010660111026     d savtsp73        s                   like(i73tsp)
010670120606     d wstringa        s                   like(§VAT4CUP)
010680121123     d wesar4z         s              1
010690121123     d wtrasmz         s              1
010700121123     d wkscz           s                   like(§b4okc)
010710130219     d wnoZ            s              1
010720130924     d aggioAr8        s              1
010730130927     d w_emd           s              1
010740140424     d w_smp           s              1
010750131003     d n_§clipsm       s                   like(blppkb)
010760131003     d n_§clivlm       s                   like(blpvlb)
010770140110     d posl            s              2  0
010780140110     d posr            s              2  0
010790140110     d lung            s              2  0
010800141202     d lenPC           s              2  0
010810140212     d* Lunghezza di CHARNOOK deve essere:  lunghezza di tbeuni + 1
010820140212     d* Il +1 è necessario per assicurarmi che nella stringa sia sempre
010830140212     d* presente un blank
010840141202     d charnook        s            257
010850140212     d charnookf       s                   like(charnook)
010860160112     d charnooki       s                   like(charnook)
010870140403     d comgf2          s                   like(o95gf2)
010880140716     d wznbrv          s                   like(brvznc)
010890140716     d wdfs            s                   like(brvdfs)
010900140716     d whms            s                   like(brvhms)
010910140716     d wokzona         s              1
010920150202     d wLocNorm        s                   like(o95loc)
010930141202     d charPCok        s            256
010940150305     d wfiglia         s              1
010950150907     d wlv13           s              1
010960150907     d wlv13_giro2     s              1
010970151014     d PesVolpkcn      s                   Like(Taspkcn)
010980151014     d PesVolSpc       s                   Like(TasSpc)
010990151014     d PesVolIMV       s                   Like(Ar6IMV)
011000151014     d savimv_fat      s                   Like(vidimv)
011010160120     d $finef10        s              1
011020160120     d wf10            s              1
011030160126     d wf16            s              1
011040160201     d wfine           s              1
011050160223     d pkgbolla        s                   like(vidpkg)
011060160224     d w_aDpd          s              1
011070160302     d wtip            s                   like(i27tip)
011080160421     d w_VariaZnc      s              1
011090011211     D                SDS
011100011211     D  NOMPGM                 1     10
011110930629     D*
011120930629     D* DEFINIZIONE COSTANTI
011130930629     D*
011140990610     D CPREPA          C                   CONST('FRANCO PREPAGATO')
011150990610     D CNOSEQ          C                   CONST('NON SEQUENZIALI')
011160941011     D CULTSP          C                   CONST('ULTIMA SPEDIZIONE: ')
011170941011     D CVARIA          C                   CONST('S P E D I Z I O N E')
011180941011     D CCONFE          C                   CONST('BOLLA DA CONFERMARE')
011190941231     D CPDC            C                   CONST('su Piano dei Conti')
011200950303     D CPIVA           C                   CONST('Partita IVA:')
011210050427     D CAUT            C                   CONST('(AUT.       ) ENTER x FORZ.')
011220980115     D CMAIUS          C                   CONST('ABCDEFGHIJKLMNOPQRS-
011230980115     D                                     TUVWYXZ')
011240980115     D CMINUS          C                   CONST('abcdefghijklmnopqrs-
011250980115     D                                     tuvwyxz')
011260991214     D CDPD            C                   CONST('PARCEL DPD: ')
011270020726      * - Società chiave per tabella "YIV"
011280020725     D C_Soc           c                   const('201')
011290010209     D*
011300010209     D* CAMPO PER DSPATR "REVERSE IMAGE"        DEI CAMPI A VIDEO
011310010209     D RIMM            C                   CONST(X'21')
011320040610     D* CAMPO PER DSPATR "HI" + "UL"            DEI CAMPI A VIDEO
011330040610     D HIUL            C                   CONST(X'26')
011340040610     D* CAMPO PER DSPATR "RI" + "UL"            DEI CAMPI A VIDEO
011350040610     D RIUL            C                   CONST(X'25')
011360010209     D* CAMPO PER DSPATR "NO DISPLAY"+"PROTECT" DEI CAMPI A VIDEO
011370010209     D NDPR            C                   CONST(X'A7')
011380011122     D* CAMPO PER DSPATR "PROTECT" + "HI"       DEI CAMPI A VIDEO
011390011122     D PROT            C                   CONST(X'A2')
011400040609     D* CAMPO PER DSPATR "PROTECT" + "RI"       DEI CAMPI A VIDEO
011410040609     D PRRI            C                   CONST(X'A1')
011420010219     D* CAMPO PER DSPATR "NO DISPLAY"
011430010219     D NODI            C                   CONST(X'27')
011440070801     D* CAMPO PER DSPATR "Blinking"
011450111206     D*BLNK            C                   CONST(X'28')
011460111206     D BLNK            C                   CONST(X'2E')
011470061110     D* CAMPO PER DSPATR "UL"
011480061110     D ul              C                   CONST(X'24')
011490030304     D* CAMPO PER DSPATR "PROTECT"+ HI + UL     DEI CAMPI A VIDEO
011500030304     D PROT1           C                   CONST(X'A6')
011510030627      * testo x cliente tassazione bolle FW
011520030627     d wnotfw          c                   Const('cliente tassazione')
011530130117
011540130117      // - Tabella OSR
011550130117     d c_tabosr        c                   const('OSR')
011560080307
011570080307     D digits          c                   '0123456789'
011580130117
011590130117      // - Reperimento tabella
011600130117     d tibs02r         pr                  extpgm('TIBS02R')
011610130117     d  kpjba                              likeds(kpjba)    const
011620130117     d  dsbs02                             likeds(dsbs02)
011630140423
011640140423      // ? PROTOTIPI ?
011650140423      /copy gaitrasrc/srcprotopr,ubchkcel
011660140423      /copy gaitrasrc/srcprotopi,ubchkcel
011670130117
011680020917     IFIVAD000
011690020917     I              VADATB                      BLDATB
011700941230     I              VADCCM                      BLDCCM
011710941230     I              VADLNP                      BLDLNP
011720941230     I              VADAAS                      BLDAAS
011730941230     I              VADNRS                      BLDNRS
011740941230     I              VADNSP                      BLDNSP
011750941230     I              VADCDP                      BLDCDP
011760941230     I              VADNCL                      BLDNCL
011770941230     I              VADNCD                      BLDNCD
011780941230     I              VADNCA                      BLDNCA
011790000208     IFISGN000
011800000204     I              SGNFLS                      §LDLNP
011810000204     I              SGNDLP                      §LDDLP
011820000204     I              SGNCDP                      §LDCDP
011830000204     I              SGNNRS                      §LDNRS
011840000208     I              SGNNCD                      §LDNCD
011850000204     I              SGNLNA                      §LDLNA
011860000204     I              SGNDLA                      §LDDLA
011870000204     I              SGNTNA                      §LDTNA
011880000204     I              SGNTSP                      §LDTSP
011890000207     I              SGNZSC                      §LDZSC
011900000204     I              SGNNC1                      §LDNC1
011910000204     I              SGNNC2                      §LDNC2
011920000204     I              SGNRSM                      §LDRSM
011930000204     I              SGNPRM                      §LDPRM
011940000204     I              SGNRSD                      §LDRSD
011950000204     I              SGNCAD                      §LDCAD
011960000204     I              SGNIND                      §LDIND
011970000204     I              SGNLOD                      §LDLOD
011980000204     I              SGNPRD                      §LDPRD
011990000204     I              SGNCPD                      §LDCPD
012000000204     I              SGNNCP                      §LDNCP
012010000204     I              SGNNCU                      §LDNCU
012020050421     I              SGNRST                      §LDRST
012030000204     I              SGNVOL                      §LDVOL
012040000204     I              SGNPKG                      §LDPKG
012050000204     I              SGNFVR                      §LDFVR
012060000204     I              SGNAAS                      §LDAAS
012070000204     I              SGNMGS                      §LDMGS
012080000208     I              SGNTST                      §DETST
012090000208     I              SGNTSE                      §DETSE
012100000208     I              SGNSSE                      §DESSE
012110000208     I              SGNSIP                      §DESIP
012120000208     I              SGNSIA                      §DESIA
012130000208     I              SGNAWB                      §DEAWB
012140000208     I              SGNISA                      §DEISA
012150000208     I              SGNFCA                      §DEFCA
012160000208     I              SGNEUR                      §DEEUR
012170000208     I              SGNXX1                      §DEXX1
012180000208     I              SGNXX2                      §DEXX2
012190001005     IFISGN005
012200001005     I              SGNFLS                      §LDLNP
012210001005     I              SGNDLP                      §LDDLP
012220001005     I              SGNCDP                      §LDCDP
012230001005     I              SGNNRS                      §LDNRS
012240001005     I              SGNNCD                      §LDNCD
012250001005     I              SGNLNA                      §LDLNA
012260001005     I              SGNDLA                      §LDDLA
012270001005     I              SGNTNA                      §LDTNA
012280001005     I              SGNTSP                      §LDTSP
012290001005     I              SGNZSC                      §LDZSC
012300001005     I              SGNNC1                      §LDNC1
012310001005     I              SGNNC2                      §LDNC2
012320001005     I              SGNRSM                      §LDRSM
012330001005     I              SGNPRM                      §LDPRM
012340001005     I              SGNRSD                      §LDRSD
012350001005     I              SGNCAD                      §LDCAD
012360001005     I              SGNIND                      §LDIND
012370001005     I              SGNLOD                      §LDLOD
012380001005     I              SGNPRD                      §LDPRD
012390001005     I              SGNCPD                      §LDCPD
012400001005     I              SGNNCP                      §LDNCP
012410001005     I              SGNNCU                      §LDNCU
012420001005     I              SGNVOL                      §LDVOL
012430001005     I              SGNPKG                      §LDPKG
012440001005     I              SGNFVR                      §LDFVR
012450001005     I              SGNAAS                      §LDAAS
012460001005     I              SGNMGS                      §LDMGS
012470001005     I              SGNTST                      §DETST
012480001005     I              SGNTSE                      §DETSE
012490001005     I              SGNSSE                      §DESSE
012500001005     I              SGNSIP                      §DESIP
012510001005     I              SGNSIA                      §DESIA
012520001005     I              SGNAWB                      §DEAWB
012530001005     I              SGNISA                      §DEISA
012540001005     I              SGNFCA                      §DEFCA
012550001005     I              SGNEUR                      §DEEUR
012560001005     I              SGNXX1                      §DEXX1
012570001005     I              SGNXX2                      §DEXX2
012580930611     IAZORG01L  AA
012590000000     I/SPACE 3
012600900504     C****************************************************************
012610900504     C*  RIEPILOGO INDICATORI
012620011115     C* N.B.: IL 92,93 E 99 SONO RIUTILIZZABILI DOPO AVERLI TOLTI ANCHE
012630011115     C*       DAL FORMATO VIDEO
012640900504     C***************************************************************
012650990628     C* 01    - ON-RICERCA ANAGRAFICA ATTIVATA
012660940825     C* 02    - PROTEGGO MITTENTE IN 2 VIDEATA
012670941103     C* 03    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE ORIGINALE
012680900504     C* 04    - BOLLA ASSEGNATO
012690940920     C* 05    - ESISTE 2 BOLLA E NON E' TASSATO DESTINO
012700010222     C* 06    - POSIZIONAMENTO CURSORE SU NUMERO ORM DAL SECONDO GIRO
012710040915     C*         IN POI SE ATTIVATA PRCEDURA ORM
012720960926     C* 07    - IL PRIMO GIRO SI POSIZIONA SUL COD AUTOTRASPORTATORE
012730940928     C*         DAL 2 IN POI SUL MITTENTE
012740900507     C* 08    - TASSATO DESTINO
012750940922     C* 09    - EMETTO IL TIPO SERVIZIO IN "RI" SE DA TARIFFA
012760941004     C* 10    - EVIDENZIO IL CODICE ISO DELLA P.IVA SE IMPOSTATO DA NAZ
012770941219     C* 11    - CHANGE SU C/ASSEGNO
012780941219     C* 12    - PROVENGO DA MANUTENZIONE
012790940920     C* 13    - PROTEGGO IL CODICE OPERATORE QUANDO NON MODIFICABILE
012800991130     C*          E SE LNP DPD, *IN79=*ON, PROTEGGO RMN
012810940913     C* 14    - SPROTEGGO LA LNP CLIENTE E MI POSIZIONO
012820900824     C* 15    - PROVENGO DA CARICAMENTO BOLLE DA DISK CLIENTI
012830940825     C* 16    - IMMISS.  BOLLE - PERSONALIZ.DATA CONSEGNA RICHIESTA
012840940825     C* 17    - IMMISS.  BOLLE - PERSONALIZ.TIPO CONSEGNA RICHIESTA
012850930329     C* 18    - IMMISS.  BOLLE - PERSONALIZ.ESPRESSO
012860940825     C* 19    - IMMISS.  BOLLE - PERSONALIZ.MITTENTE
012870930329     C* 20    - IMMISS.  BOLLE - PERSONALIZ.LINEA ARRIVO
012880930329     C* 21    - IMMISS.  BOLLE - PERSONALIZ.CODICE BOLLA
012890990630     C* 22    - PROTEZIONE DATI FATTURA E VISUAL.TOT.FATTURA PER PREPAG
012900940920     C* 23    - IMMISS.  BOLLE - PERSONALIZ.ORA  CONSEGNA RICHIESTA
012910930329     C* 24    - IMMISS.  BOLLE - PERSONALIZ.DATA SPEDIZIONE
012920940826     C* 25    - CTM PER CREAZIONE SEGNACOLLI
012930930329     C* 26    - IMMISS.  BOLLE - PERSONALIZ.COD TRATTAM MERCE
012940940825     C* 27    - IMMISS.  BOLLE - PERSONALIZ. DELLA NATURA MERCE
012950930329     C* 28    - IMMISS.  BOLLE - PERSONALIZ.COD TARIFFA MITTENTE
012960930329     C* 29    - IMMISS.  BOLLE - PERSONALIZ.IL CODICE TARIFFA
012970900508     C* 30/32 - DI COMOD RIUTILIZZABILI
012980980219     C* 33    - PROTEGGO LA DIVISA DEL C/A
012990000928     C*         IN MANUTENZIONE MI SERVE PER AGGIORNAMENTO FNBLD
013000000928     C*         IN CONFERMA DISK (DISK C EX DISK B) LO ACCENDO PER
013010000928     C*         DISABILITARE AGGIUNTA COD.CHI SONO
013020990610     C* 34    - ELABORAZIONE PER PREPAGATI
013030940926     C* 35    - SFLDSP
013040940825     C* 36    - BOLLE DISK CLI - ON -POSIZIONAMENTO CURSORE SU VOLUME
013050931123     C*       - BOLLE DISK CLI - OFF-POSIZIONAMENTO CURSORE SU SEGNACOL
013060010222     C* 37    - IMMISS.  BOLLE - PERSONALIZ.NUMERO ORM
013070941020     C* 38    - POSIZIONAMENTO CURSORE STD SE SPENTO.
013080941020     C*         SE ACCESO SIGNIFICA CHE E' STATO ATTIVATO UN ALTRO POSZ
013090960319     C* 39    - PROTEGGO LA P.IVA DEL MITTENTE
013100960319     C* 40/84 - ERRORE
013110940826     C* 44    - BOLLE DISK CLI - SE DA GIACENZE O CAMBIO PORTO
013120930330     C*          E MANUT BOLLE -   NO VARIAZIONE DEL TIPO BOLLA
013130960319     C* 71/73 - ERRORE SU CAP/NAZIONE/RAGIONE SOCIAL MITTENTE ORIGINALE
013140980219     C* 76    - PROTEZIONE DEI CAMPI TIPO INCASSO C/A SE EXPORT
013150000905     C* 77    - ERRORE SU FLAG DDT
013160000830     C* 78    - INDICATORE SFLDSP PER SFL COD."CHI SONO"
013170991130     C* 79    - PROTEZIONE DEL RIF.ALFABETICO PER BOLLE DPD E SE CODICE
013180991130     C*          OPERATORE NON MODIFICABILE, *IN13=*ON, PROTEGGO RMN
013190950303     C* 85    - IMMISS.  BOLLE - PERSONALIZ.SOLO COD CLIENTE
013200961111     C* 86    - ERRORE SULLE NOTE
013210961111     C* 87    - PROTEZIONE DELLA TASSAZIONE SE PGM RICHIAMO DA GIACENZE
013220950410     C* 88    - change su VALORE MERCE DICHIARATO
013230941219     C* 89    - change su importo da assicurare
013240941219     C* 90    - SEGNALA LA PRESENZA DI ERRORI
013250960319     C* 91    - IMMISS.  BOLLE - PERSONALIZ.I GIORNI DI CHIUSURA
013260011115     C* 92    - EVIDENZIO DIVISA IMP ASSIC SE DA MITTENTE(E NON E' IT)
013270011115     C* 93    - EVIDENZIO DIVISA C/A       SE DA DESTINAT(E NON E' IT)
013280930414     C* 94    - BOLLE DISK CLI - ABILITO CM21 X GEST. DETT.STAMPA SEGN
013290940922     C* 95    - ABILITA INSERIM.SERIE PER BOLLETTAZIONE
013300940922     C*         CLIENTI CON SERIE CHE DANNO SOLO ETICH
013310980324     C* 96    - BOLLE DISK CLI - ABILITO F22 X GEST.ESTENS. DETT.COLLI
013320940922     C* 97    - EMETTO I CAMPI RIPRESI DA TARIFFA IN "RI"
013330940922     C* 98    - BOLLE DI RECUPERO
013340011115     C* 99    - EVIDENZIO DIVISA VAL MERCE SE DA MITTENTE(E NON E' IT)
013350900504     C*****************************************************************
013360930611     C     *ENTRY        PLIST
013370930611     C                   PARM                    KPJBA
013380991007     C                   PARM                    DBLP
013390991007     C                   PARM                    DTASV
013400030610     C                   PARM                    trul90ds
013410030610      *
013420030610      * Il numero dei parametri ricevuti è testato, in caso di modifica
013430030610      *  ricercare la stringa "%PARMS"
013440020917      *
013450021002      * Controllo se p.o. gestione numerico
013460021002     C                   IF        %subst(§lpfgs:1:1) < '0' or
013470021002     C                             %subst(§lpfgs:2:1) < '0' or
013480021002     C                             %subst(§lpfgs:3:1) < '0'
013490021002     C                   clear                   §fgs              3 0
013500021002     C                   ELSE
013510021002     C                   movel     §lpfgs        §FGS
013520021002     C                   ENDIF
013530030409      * controllo le ore
013540030409     c                   IF        %subst(§lpore:1:1) < '0' or
013550030409     c                             %subst(§lpore:2:1) < '0'
013560030409     c                   Clear                   §ore
013570030409     c                   Else
013580030409     c                   Move      §lpOre        §ore
013590030409     c                   EndIf
013600001219     C*
013610000000     C*----------------------------------------------------*
013620930628     C* §LPFPR = 'M' VENGO DA MANUTENZIONE   : CHIUDO IN RETRN
013630930628     C* §LPFPR = 'X' VENGO DA DISK CLI       : CHIUDO IN RETRN
013640930628     C* §LPFPR = 'V' VENGO DA DISK CLI       : CHIUDO IN RETRN
013650950419     C* §LPFPR = 'W' VENGO DA DISK CLI       : CHIUDO IN RETRN
013660050407     C* §LPFPR = 'R' VENGO DA REC BOL DSK CLI: CHIUDO IN RETRN --> OBSOLETO
013670010213     C* §LPFPR = 'O' VENGO DA CONFERMA O.R.M.: CHIUDO IN RETRN
013680990602     C* §LPFPR = 'G' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013690941230     C* §LPFPR = 'P' VENGO DA BOLLE GIACENZE : CHIUDO CON LR
013700941230     C*              NON DEVO STAMPARE LA BOLLA
013710930628     C* §LPFPR = 'I' VENGO DA INVIO DISPOSIZ : CHIUDO CON LR
013720150302     C* §LPFPR = 'B' VENGO DA GEST. BANCALI  : CHIUDO CON LR
013730020522     C* §LPFPR = 'T' VENGO DA RITIRI ANNULLATI:CHIUDO CON LR
013740030609      *                  o da ORM commissionati
013750930707     C* §LPFPR = 'C'                           CHIUDO CON LR
013760900511     C*
013770941020     C* CODICI DI RITORNO:
013780941020     C* §LPFPR = '1'                           BOLLA ANNULLATA
013790111007     C* §LPFPR = '2'                           Richiesto annullamento VAB...
013800000517     C* §LPFPR = '3'                           CMD03
013810941020     C* §LPFPR = '4'                           CMD12
013820941020     C* §LPFPR = '5'                           TROVATI ERRORI IN CONFER
013830000627     C*
013840000627     C* §LPFLG = 'C' - EFFETTUARE SOLO CONTROLLI RESTITUENDO DBLP
013850000627     C*                AGGIORNATA
013860930707    1C     §LPFPR        IFEQ      'C'
013870930628     C     §LPFPR        OREQ      'G'
013880930628     C     §LPFPR        OREQ      'I'
013890950102     C     §LPFPR        OREQ      'P'
013900020522     C     §LPFPR        OREQ      'T'
013910150302     C     §LPFPR        OREQ      'B'
013920930628     C                   SETON                                        LR
013930010103   X1C                   ENDIF
013940010103     C*
013950010103     C     *LIKE         DEFINE    §LPFPR        SAVFPR
013960010103     C                   CLEAR                   SAVFPR
013970010103    1C     §LPFPR        IFEQ      'G'
013980010103     C     §LPFPR        OREQ      'P'
013990020522     C     §LPFPR        OREQ      'T'
014000150302     C     §LPFPR        OREQ      'B'
014010010103     C                   MOVEL     §LPFPR        SAVFPR
014020010103     C                   ENDIF
014030011029      * PULISCO CAMPO DI ATTRIBUTI VISUALIZZAZIONE X 'FLAG TARIFFA MITTENTE'
014040011029     C                   CLEAR                   ATRFTM
014050030911      * pulisco ds di work del numero ORM
014060030911     c                   Clear                   widorm
014070040506      * pulisco ds di work del numero bolla da dsblp
014080040506     c                   Clear                   widspe
014090091221      * pulisco campo appoggio per particolarità consegna
014100091221     c                   clear                   wvidgma
014110100604     c                   clear                   w7rRC
014120141202     c                   clear                   w7rPC
014130111007     C* Attributo di visualizzazione F16=Annull:
014140111007     c* in conferma     è da visualizzare solo se richiamata con "X" o "V"
014150111007     c* in manutenzione sempre
014160111007     c                   clear                   atrann
014170111007     c                   if        *in15 and §lpfpr<> 'V' and §lpfpr <>'X'
014180111007     c                   movel     nodi          atrann
014190111007     c                   endif
014200900509     C* PULISCO CAMPI FOR02 E FOR03
014210941115    1C     §LPFPR        IFNE      'C'
014220000829     C                   EXSR      INZ08
014230991203     C                   EXSR      INZ07
014240991203     C                   EXSR      INZ06
014250971210     C                   EXSR      INZ03
014260941011     C                   EXSR      INZ02
014270940819     C                   EXSR      INZ01
014280930628     C*  MANUTENZIONE
014290950102     C   12
014300950102     CANN15              DO
014310950102     C                   EXSR      CARBLP
014320950102     C   90              GOTO      FINE
014330950102     C                   ENDDO
014340950126     C*
014350930628     C*  CARICAMENTO BOLLE DA DISK CLI
014360900824     C   12
014370900824     CAN 15              EXSR      CARBLC
014380010301     C*  CARICAMENTO DA CONFERMA ORM PREPAGATI
014390010301     C     §LPFPR        IFEQ      'O'
014400010301     C                   EXSR      CARBLO
014410010301     C                   ENDIF
014420010209     C*
014430010209     C*  HO CARICATO LA VIDEATA: VERIFICO SE ATTIVATA PROC. O.R.M.
014440010209     C*  SE PGM RICHIAMATO DA GIACENZE O CONFERMA BOLLE LA PROCED. ORM
014450010209     C*  NON E' ATTIVATA SE P.O. EMITTENTE = 0
014460010219     C                   Z-ADD     VIDLNP        WLNPO
014470010209     C*  NEGLI ALTRI CASI FACCIO CHAIN SU ORGANIGRAMMA
014480010209     C                   EXSR      ATTORM
014490010219     C* SE SONO IN MANUTENZIONE E ORM FITTIZIO IMPOSTO NUMERO ORM A VI-
014500010219     C* DEO
014510010219     C     WORM          IFEQ      'S'
014520010219     C     *IN12         ANDEQ     *ON
014530010219     C     *IN15         ANDEQ     *OFF
014540010219     C     VIDPOE        ANDEQ     *ZEROS
014550010219     C                   Z-ADD     VIDLNP        VIDPOE
014560010219     C                   MOVE      *ALL'9'       VIDNOR
014570010219     C                   MOVE      *ALL'9'       VIDNRV
014580010219     C                   MOVEL     VIDORM        W01ORM
014590070627     C                   MOVEL     VIDORM        s_dsbl4m
014600010219     C                   ENDIF
014610010502     C* IN IMMISSIONE E NO PREPAGATO E PROCEDURA ORM ATTIVA IL FLAG
014620010502     C* MATTINO/POMERIGGIO LO LASCIO VUOTO
014630010502     C     WORM          IFEQ      'S'
014640010502     C     *IN12         ANDEQ     *OFF
014650010502     C     PARTCH        ANDNE     'P'
014660010502     C     §LPFPR        ANDNE     'O'
014670010502     C                   CLEAR                   VIDFPP
014680010502     C                   ENDIF
014690010209     C*
014700910108     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
014710910108     C*    AI CONTROLLI
014720940214     C   12
014730940214    2CAN 15§LPFPR        IFNE      'V'
014740910108     C                   GOTO      CT1TAG
014750940214    2C                   END
014760900427     C*
014770900427     C     FOR01         TAG
014780121017      * Se la data del giorno è compresa nel range dal/al per blocco immiss.
014790121017      * prepagati (tabella DGD) --> ERRORE
014800041217     c                   If        (Partch = 'P' or §LpFpr = 'O') and
014810121017     c                              dateu>= §dgdbpd and dateu<=§dgdbpa
014820121017     c****                          Dateu = §vpodip
014830041217     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
014840041217     c                             spedizioni in Porto Prepagato'
014850041217     c                   Eval      *In90 = *On
014860041217     c                   EndIf
014870940825     C* V I D E O   1
014880050119     c                   z-add     VIDORM        S_VIDORM
014890160120     c* se sono in manutenzione e sono presenti variazioni effettuate
014900160120     c* dall'arrivo devo emmettere una finestra di avviso con gestione tasto
014910160120     c* funzionale per permettere di interrogare le variazioni presenti
014920160126     c* Idem se presenti R.A.
014930160126     c                   if        *in12 and not *in15 and (
014940160126     c                             (at0fva=*blanks and wF10='S')  or
014950160126     c                             (at0fra=*blanks and wf16='S'))
014960160120     c                   eval      $finef10='0'
014970160120     c                   exsr      sr_WdwF10
014980160120     c                   clear                   wf10
014990160126     c                   clear                   wf16
015000160120     c                   endif
015010940819     C                   EXFMT     LS01D01
015020941003     C*
015030941003     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
015040950126     C                   EXSR      OFFD01
015050900427     C* CMD3 - FINE LAVORO
015060920713     C   KL
015070920713     CAN 12
015080920713     CAN 15              MOVEL     '4'           §LPFPR
015090000518     C   KC
015100000518     CAN 12
015110000518     CAN 15              MOVEL     '3'           §LPFPR
015120010308     C* IDEM SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI (IN QUESTO
015130010308     C* CASO *IN12 = OFF
015140010308     C     §LPFPR        IFEQ      'O'
015150010308     C   KL              MOVEL     '4'           §LPFPR
015160010308     C   KC              MOVEL     '3'           §LPFPR
015170010308     C   KC
015180010308     COR KL              GOTO      FINE
015190010308     C                   ENDIF
015200940825     C   KC
015210940825     COR KL
015220940825     CAN 12              GOTO      FINE
015230121017      * Se la data del giorno è nel range dal/al per blocco immissione
015240121017      * prepagati (tabella DGD) ---> ERRORE
015250050215     c                   If        (Partch = 'P' or §LpFpr = 'O') and
015260121017     c                              dateu>=§dgdbpd and dateu<=§dgdbpa
015270121017     c****                          Dateu = §vpodip
015280050215     c                   Eval      VidMsg = 'Oggi non è possibile inserire +
015290050215     c                             spedizioni in Porto Prepagato'
015300050215     c                   Eval      *In90 = *On
015310050215     c                   goto      for01
015320050215     c                   EndIf
015330940819     C*
015340900427     C* CMD13 - PERSONALIZZAZIONE CAMPI
015350940819     C     *INKM         IFEQ      *ON
015360150722     c* per richiamo con "O" non abilito la personalizzazione che
015370150722     c* non ha senso e tra l'altro può generare errori (sul n. orm
015380150722     c* se imposto il fittizio, al ritorno in prima videata si perdono
015390150722     c* i 99999 in quanto la routine ctrorm non considera la personalizzazione
015400150722     c* per §lpfpr='O')
015410150722     c     §lpfpr        ifne      'O'
015420940819    2C                   EXSR      GESD00
015430150722     C** KC§LPFPR        IFEQ      'O'
015440150722     C**                 MOVEL     '3'           §LPFPR
015450150722     C**                 ENDIF
015460940819     C   KC              GOTO      FINE
015470040908     c* se personalizzato n. orm prima di riemettere la videata di
015480040908     c* bollettazione devo effettuare i controlli per poporre eventuali
015490040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
015500040908     c* porti allo stesso modo di quando dalla prima videata viene
015510040908     c* immesso il numero orm con la pistola (enter automatico)
015520041221     c***37              exsr      ctrd01
015530041221     c                   if        *in37 = *on
015540050119     c***                if        flgfit <> 'S' and s_v0corm <> V0corm
015550050119     c                   if        flgfit <> 'S'
015560050119     c* passo flag a ctrd01 per dire di riemettere la videata dopo aver
015570050119     c* elaborato eventuali proposte a prescindere dal fatto che vi siano
015580050119     c* dati da proporre o meno (serve per non dare errore sul n.colli blocc
015590050119     c* ando così la tastiera)
015600050119     c                   eval      wsolo_prp = '1'
015610041221     c                   exsr      ctrd01
015620041221     c                   else
015630041221     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
015640041221     c* (per uniformità: fa così anche per orm reale)
015650050117     c* Idem se orm non fittizio ma rimasto invariato
015660041221     c  n38              z-add     13            h1riga
015670041221     c  n38              z-add     20            h1colo
015680041221     c                   endif
015690041221     c                   endif
015700150722     c                   endif
015710940825     C                   GOTO      FOR01
015720940819     C                   ENDIF
015730930330     C**
015740051207     C* F16 - ANNULLAMENTO
015750111007    2C     *INKQ         IFEQ      *ON
015760111007    3c     atrann        ifeq      *blanks
015770110516     c* window per richiesta conferma
015780110516     c                   exsr      sr_geswdwconf
015790111007    4c                   select
015800111007   whc                   when      wvann='N'
015810110516     c                   goto      for01
015820111007   whc                   when      wvann='S'
015830111007     c* f16 in manutenzione --> cancello bolla da blp e file collegati
015840111007    5c                   if        *in15=*off
015850930915     C                   EXSR      ANNULL
015860111007    6C                   if        wf12 = '1' or *in90 = '1'
015870060307     c                   goto      for01
015880111007    6c                   endif
015890930915     C                   GOTO      FINE
015900111007   x5c                   else
015910111007     c* f16 in conferma --> ritorno al chiamante codice '2' per far cancellare
015920111007     c* vab e suoi collegati
015930111007     c                   eval      §lpfpr='2'
015940111007     C                   GOTO      FINE
015950111007    5c                   endif
015960111007    4c                   endsl
015970111007   x3c                   else
015980111007     c* se premuto f16 ma non è abilitato riemetto la videata
015990111007     c                   goto      for01
016000111007    3c                   endif
016010940214    2C                   END
016020010216     C**
016030051207     C* F8 - INTERROGAZIONE O.R.M.
016040010223     C     *INKH         IFEQ      *ON
016050010219     C     WORM          ANDEQ     'S'
016060010227     C     PARTCH        ANDNE     'P'
016070010220     C     VIDNOR        ANDEQ     *ZEROS
016080111122     c* se lnp import continuo a richiamare FIOR04R
016090111122     c*****              if        %lookup(vidlnp:fio)=0
016100111122     c****                         and %lookup(999:fio)=0
016110111122     c                   if        vidlnp<>prelnp
016120111122     c                   clear                   og143
016130111122     C     vidlnp        CHAIN     AZORG01L      UNIORG
016140111122     c                   if        %found(azorg01l)
016150111122     C                   MOVEL     ORGDE3        OG143
016160111122     c                   endif
016170111122     c                   eval      prelnp=vidlnp
016180111122     c                   endif
016190111122     c                   if        §ogntw='DPD' or §ogntw='EEX' or
016200111122     c                             §ogntw='FED'
016210150928     C***                CLEAR                   DSOR04
016220150928     C***                MOVEL     '1'           I04RIC
016230150928     C****               Z-ADD     VIDLNP        I04POR
016240150928     c                   clear                   fior010ds
016250150928     c                   eval      ior010ric='1'
016260150928     c                   eval      ior010por=vidlnp
016270051207     c
016280051207     c* Richiamo tnsb51r per vedere che p.o. ritiro passare
016290150929     c* non per DPD
016300150929     c                   if        *in12 and not *in15 and vidccm>0
016310150929     c                             and §ogntw<>'DPD'
016320150929     c                   clear                   tntb50ds
016330150929     C                   move      VIDCCM        b50ke2
016340051207     C*
016350150929    3C     VIDFLC        IFEQ      0
016360150929     C                   MOVEL     VIDLNP        b50ke2
016370150929     C                   ELSE
016380150929     C                   MOVEL     VIDFLC        b50ke2
016390150929    3C                   ENDIF
016400051207     c
016410150929     c                   movel     b50ke2        b50ke1
016420051207     c* controllo linea
016430150929     c                   movel     'C'           b50opz
016440150929     c                   movel     vidlnp        b50poa
016450150929     c                   call      'TNTB51R'
016460150929     c                   parm                    kpjba
016470150929     c                   parm                    tntb50ds
016480051207     c
016490150929     c                   if        b50err=' ' and b50ormreso>*zeros
016500150929     c***                movel     b50ormreso    i04por
016510150929     c                   movel     b50ormreso    ior010por
016520150929     c                   endif
016530150929     c                   endif
016540051207     c
016550150928     C***                CALL      'FIOR04R'
016560150928     C***                PARM                    KPJBA
016570150928     C***                PARM                    DSOR04
016580150928     C***  O04CM3        IFEQ      *BLANKS
016590150928     C***                Z-ADD     O04POE        VIDPOE
016600150928     C***                MOVEL     O04NSR        VIDNOR
016610150928     C***                MOVE      O04NOR        VIDNOR
016620150928     C***                Z-ADD     O04NRV        VIDNRV
016630150929     c                   call      'FIOR010R'
016640150928     c                   parm                    kpjba
016650150928     c                   parm                    fior010ds
016660150928     C     OOR010F03     IFEQ      *BLANKS
016670150928     C     OOR010F12     andeq     *BLANKS
016680150928     C     OOR010err     andeq     *BLANKS
016690150928     C                   Z-ADD     OOR010POE     VIDPOE
016700150928     C                   MOVEL     OOR010NSR     VIDNOR
016710150928     C                   MOVE      OOR010NOR     VIDNOR
016720150928     C                   Z-ADD     OOR010NRV     VIDNRV
016730050117     c                   eval      *inkh = '0'
016740050117     c                   else
016750010216     C                   GOTO      FOR01
016760050117     c                   endif
016770110419     c                   else
016780110419     c                   if        vidpdr<=*zeros
016790110419     c                   eval      *in90='1'
016800110419     c                   eval      *in56='1'
016810110419     c                   eval      vidmsg=err(210)
016820110419     c                   goto      for01
016830110419     c                   else
016840110419     c                   clear                   fior58ds
016850110419     c                   movel     vidlnp        ior58pdr
016860110419     c                   move      vidpdr        IOR58PDR
016870110419     C                   CALL      'FIOR58R'
016880110419     C                   PARM                    KPJBA
016890110419     C                   PARM                    fior58ds
016900110419     C     OOR58F03      IFEQ      *BLANKS
016910110419     C                   Z-ADD     OOR58POE      VIDPOE
016920110419     C                   MOVEL     OOR58NSR      VIDNOR
016930110419     C                   MOVE      OOR58NOR      VIDNOR
016940110419     C                   Z-ADD     OOR58NRV      VIDNRV
016950110419     c                   eval      *inkh = '0'
016960110419     c                   else
016970110419     C                   GOTO      FOR01
016980110419     c                   endif
016990110419     c                   endif
017000110419     c                   endif
017010010216     C                   ENDIF
017020010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
017030010227     C* SE NON SEMPRE VISUALIZZATO. SE NON ATTIVATA PROCEDURA ORM
017040010227     C* O SONO NEL GIRO DEI PREPAGATI MIEI RIEMETTO VIDEATA
017050010227     C   KHWORM          IFNE      'S'
017060010227     C     PARTCH        OREQ      'P'
017070010227     C                   GOTO      FOR01
017080010227     C                   ENDIF
017090930915     C*
017100910219     C* CMD21 - GESTIONE DETTAGLIO SEGNACOLLI (SOLO IN DISK CLI)
017110940214    2C   KV              DO
017120950321     C                   MOVEL     §LPCCM        PARCCM
017130991116     C                   MOVEL     §LPAAC        PARAAS
017140920204     C                   MOVEL     §LPNRS        PARNRS
017150911031     C                   MOVEL     §LPLNP        PARLNP
017160911031     C                   MOVEL     §LPLNA        PARLNA
017170911031     C                   MOVEL     §LPNSP        PARNSP
017180020917      * P.O DI GESTIONE
017190021002     C                   MOVEL     §FGS          PARFGS
017200910219     C                   MOVEL     PARAM         KPJBU
017210941230     C                   CALL      'FNLS78R'
017220910219     C                   PARM                    KPJBA
017230910219     C                   GOTO      FOR01
017240940214    2C                   END
017250990701     C* F22 - GESTIONE ESTENSIONE DETT. SEGNACOLLI (SOLO IN DISK CLI)
017260980325    2C   KW              DO
017270000904     C                   EXSR      GESD08
017280980325     C                   GOTO      FOR01
017290980325    2C                   END
017300110512     c* F17-Indirizzo Email destinatario
017310150213     c***                if        *inkr=*on
017320150213     c***                if        atremd=*blanks
017330150213     c***                exsr      sr_geswdwemd
017340150213     c***                endif
017350150213     C***                GOTO      FOR01
017360150213     c***                endif
017370110705     c* F5-Riepilogo bolle da confermare
017380110519     c                   if        *inke=*on
017390110517     c                   Clear                   Fnls80ds
017400110517     c                   Movea     l1            dpog
017410110517     c                   z-add     99            d80Nsr
017420110517     c                   if        vidccm>0
017430110517     C                   MOVE      VIDCCM        d80ccm
017440110517     C     VIDFLC        IFNE      0
017450110517     C                   movel     VIDFLC        d80ccm
017460110517     C                   ELSE
017470110517     C                   movel     VIDLNP        d80ccm
017480110517     C                   ENDIF
017490110517     c                   endif
017500110517     c                   if        vidlna>*zeros
017510110517     c                   Movel     Vidlna        d80lna
017520110517     c                   else
017530110517     c                   z-add     999           d80lna
017540110517     c                   endif
017550110517     c                   call      'FNLS80R'
017560110517     c                   parm                    kpjba
017570110517     c                   parm                    fnls80ds
017580110517     C                   GOTO      FOR01
017590110517     c                   endif
017600110705     c* F19-codici CUP/CIG per tacciabilità flussi finanziari
017610110705     c                   if        *inkt=*on
017620110705     c                   if        atrcup=*blanks
017630110705     c                   exsr      sr_geswdwcup
017640110705     c                   endif
017650110705     C                   GOTO      FOR01
017660110705     c                   endif
017670150731     c* F11-Cappario
017680150731     c                   if        *inkk=*on
017690150731     C                   CLEAR                   DSSI00
017700150731     C                   MOVEL     'L01'         D00OP0
017710150731     C                   MOVEL     vidlod        D00LOC
017720150731     C                   MOVEL     blpdsp        D00DRI
017730150731     c                   movel     'S'           i30flg
017740150731     c                   movel     vidcad        i30cap
017750150731     c                   movel     vidlod        i30loc
017760150731     c                   movel     vidprd        i30prv
017770150731     c                   movel     vidnzd        i30nar
017780150731     c                   call      'TISI30R'
017790150731     C                   PARM                    KPJBA
017800150731     C                   PARM                    DSSI00
017810150731     C                   PARM                    tisi30ds
017820150731     C* Se Selezione
017830150731    5C     D00CAP        IFNE      *BLANKS
017840150731     C                   MOVEL     D00CAP        vidcad
017850150731     C                   MOVEL     D00LOC        vidlod
017860150731     C                   MOVEL     D00NAR        vidnzd
017870150731     C                   MOVEL     D00PRV        vidprd
017880150731     c                   endif
017890150731     C                   GOTO      FOR01
017900150731     c                   endif
017910940825     C*
017920971211     C* F7  - ABILITO CAMPO PER RICERCA ALFABETICA
017930941021     C   KG              SETON                                        0138
017940900427     C   KG              GOTO      FOR01
017950971211     C* F10 - ABILITO CAMPO PUNTO OPERATIVO CLIENTE
017960941020     C   KJ              SETON                                        1438
017970940921     C   KJ              GOTO      FOR01
017980900427     C* CONTROLLI FORMATO1
017990900824     C     CT1TAG        TAG
018000050119     c* imposto flag per dire se fare solo eventuali proposte da orm
018010050119     c* e poi riemettere sempre la videata o se dopo le proposte even
018020050119     c* tuali continuare coi controlli
018030050119     c* Serve perchè se sono stati personalizzati tutti i campi proponi
018040050119     c* bili il pgm emetterebbe messaggio di errore su n.colli bloccand
018050050119     c* la tastiera senza aver dato il tempo al bollettista di inserire
018060050119     c* i dati mancanti
018070050209     c* lo faccio solo se sono in immissione bolle non lo faccio in
018080050209     c* conferma bolle e in manutenzione
018090050209     c                   eval      wsolo_prp = ' '
018100050209     c                   if        s_vidorm = *zeros and *in12 = *off
018110050119     c                   eval      wsolo_prp = '1'
018120050119     c                   endif
018130010216     C                   EXSR      CTRD01
018140950126     C*
018150950126     C* CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
018160950126     C* DI ERRORE
018170950126     C     WEMFOR        IFEQ      '1'
018180010816     C                   EXSR      ESCIER
018190950126     C     §LPFPR        IFNE      '5'
018200950127     C                   GOTO      FOR01
018210950127     C                   ELSE
018220950127     C                   GOTO      FINE
018230950126     C                   ENDIF
018240950126     C                   ENDIF
018250010215     C* RIEMETTO LA VIDEATA PER VISUALIZZARE CAMPI VIDEO DA ORM
018260010215     C     WEFORM        IFEQ      '1'
018270010215     C                   GOTO      FOR01
018280010215     C                   ENDIF
018290010214     C* ESEGUO CONTROLLI DI INCONGRUENZA CON CAMPI DELL'ORM
018300010214     C     WORM          IFEQ      'S'
018310010214     C                   EXSR      CNFOR1
018320010214     C     WEMFOR        IFEQ      '1'
018330010214     C                   EXSR      ESCIER
018340010214     C     §LPFPR        IFNE      '5'
018350010214     C                   GOTO      FOR01
018360010214     C                   ELSE
018370010214     C                   GOTO      FINE
018380010214     C                   ENDIF
018390010214     C                   ENDIF
018400010214     C                   ENDIF
018410020122     C* SE IMMESSA LA NAZIONE EMETTO WINDOW  PER RICHIESTA CONFERMA
018420020131     c* (Se si tratta di nazione per cui è richiesta forzatura (§15FFN="S"))
018430020122     C* IN MANUTENZIONE LA EMETTO SOLO SE È DIVERSA DA QUELLA CHE C'ERA
018440020122    2C     VIDNZD        IFNE      *BLANKS
018450020131     c     DESFFN        ANDEQ     'S'
018460030707      * e se non è una bolla di recupero
018470030707     c     §3arbl        andne     'R'
018480020123     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
018490020123     c* se devo emettere la window o ritornare al chiamante con errore
018500091111     c                   move      '1'           wvidobb           1
018510020123     c                   exsr      escier
018520091111     c                   move      ' '           wvidobb
018530020123    3c     §lpfpr        ifne      '5'
018540020122     C* Manutenzione
018550020123    4C     *IN12         IFEQ      *ON
018560020122     C     *IN15         ANDEQ     *OFF
018570020122     C     VIDNZD        ANDNE     NZDINI
018580020122     C* Immissione
018590020122     C     *IN12         OREQ      *OFF
018600020122     c* Conferma bolle
018610020122     C     *IN15         OREQ      *ON
018620020122     C                   MOVEL     '15'          COD
018630020122     C                   MOVEL(P)  VIDNZD        KEY
018640020122     C                   EXSR      CTABEL
018650020122     C                   MOVEL     TBLUNI        DS15
018660020123     c                   eval      w01nzd = %trim(vidnzd) + '-' + §15des
018670020123     c     §lpfpr        ifne      'V'
018680020123     c                   write     ls01d01
018690020123     c                   endif
018700020124     c     forw01        tag
018710020122     C                   EXFMT     LS01W01
018720020122     C* Se premuto F12 riemetto prima videata.
018730020123     C* Se pgm richiamato con "W" anzichè riemettere la prima videata ritorn
018740020123     c* l'errore al chiamante
018750020123     C   KL              goto      for01
018760020124     c  NKF              goto      forw01
018770020123    4C                   ENDIF
018780020123   x3c                   else
018790020123     c                   goto      fine
018800020123    3c                   endif
018810020122    2C                   ENDIF
018820900926     C*
018830000831     C* DISK C
018840000830     C* Emetto videata per inserimento del cod. CHI SONO" se DISK C
018850020917     C* in bollettazione o se diska senza fivat
018860160226     c*    Instradamento forzato a DPD: in immissione/conferma wexdpd conterrà
018870160226     c*    blanks e va bene così perchè in questo caso la richiesta del CHI
018880160226     c*    SONO sarà da fare solo in base al flag 12 (il parcel dpd in
018890160226     c*    questi casi sarà sempre automatico a prsecindere dal flag 13)
018900050223     c* Escludo:
018910050223     C* 1) Bolle export dpd disk c se chi sono non automatico perchè in
018920050223     c*    questo caso il chi sono non viene immesso da sfl
018930050223     c* 2) Bolle import dpd sempre perchè anche in questo caso il chi sono
018940050223     c*    non viene immesso da sfl
018950000913     C  N12
018960000913     COR 12
018970000913     CAN 15§1BF12        IFEQ      'S'
018980001011     C     WEXDPD        ANDNE     'S'
018990050223     c     *in79         andeq     *off
019000001009     C     §1BF12        OREQ      'S'
019010001011     C     WEXDPD        ANDEQ     'S'
019020001009     C     §1BF13        ANDEQ     'A'
019030030321      * se non ho superato i 500 colli
019040030321If  2c                   If        v1cncl <= 500
019050000911     C     FOR09         TAG
019060010816     C* IMPOSTO CAMPI SUBFILE CONTROL
019070010816     C                   MOVE      WKSC          V8CKSC
019080010816     C                   MOVEL     VIDDMT        V8DKSC
019090000904     C                   EXSR      GESD09
019100000914     C     *INKL         CABEQ     *ON           FOR01
019110000830     C* Controllo i dati immessi
019120000830     C                   EXSR      CTRS08
019130000830     C     *IN90         IFEQ      *ON
019140000830     C                   EXSR      ESCIER
019150000830     C     §LPFPR        IFNE      '5'
019160000904     c* Se errore riemetto videata subfile cod.chi sono per poterla
019170000904     c* manutenzionare
019180000904     C                   EXSR      GESD08
019190000904     C   KL              GOTO      FOR01
019200000830     C                   ELSE
019210000830     C                   GOTO      FINE
019220000830     C                   ENDIF
019230000830     C                   ENDIF
019240030321   x2c                   Else
019250030321     c                   Eval      VidMsg = Err(275)
019260030321     c                   Eval      *In90 = *On
019270030321     c                   Eval      *In62 = *On
019280030321     C                   EXSR      ESCIER
019290030321     C     §LPFPR        IFNE      '5'
019300030321     C                   GOTO      FOR01
019310030321     C                   ELSE
019320030321     C                   GOTO      FINE
019330030321     C                   ENDIF
019340030321    2c                   EndIf
019350000830     C                   ENDIF
019360021120
019370021120      * Solo x FedEx richiamo di nuovo il trul27 xchè in questo momento ho anche
019380021120      * il prefisso del segnacollo che mi serve per ricerare la cartello
019390021120      * FedEx giusta
019400021120     c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED') and
019410021120     c                             (Prefisso(1) = 'FD' or Prefisso(1) = 'FM')
019420160216     c                   Clear                   Trul27Ds1
019430021120     c                   Movel     Prefisso(1)   I27Tip
019440160322     c                   eval      wtip= Prefisso(1)
019450021120     c                   Exsr      TarCar
019460021120     c                   If        Not *In12
019470021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
019480021120      * a quanto indicato in tabella "DFE"
019490021120     c                   If        O27Fie = 'N' and VidPkg > §DfePkgD
019500021120     c                   Movel     Err(264)      VidMsg
019510021120     c                   Eval      *In90 = *On
019520021120     c                   Eval      *In63 = *On
019530021120     c                   EndIf
019540021120     c                   EndIf
019550021120      * Errori
019560021120     c                   If        *In90
019570021120      * CONTROLLO SE DEVO RIEMETTERE VIDEATA O USCIRE CON SEGNALAZ.
019580021120      * DI ERRORE
019590021120     C                   EXSR      ESCIER
019600021120     C     §LPFPR        IFNE      '5'
019610021120     C                   GOTO      FOR01
019620021120     C                   ELSE
019630021120     C                   GOTO      FINE
019640021120     C                   ENDIF
019650021120     c                   EndIf
019660021120     c                   EndIf
019670021120
019680011107     C* SE ATTIVATA PRCEDURA ORM E NUMERO ORM NON FITTIZIO DEVO
019690010215     C* PROPORRE I CAMPI DELLA SECONDA VIDEATA PRIMA DI EMETTERLA
019700010215     C* LO FACCIO SOLO SE NON SONO IN CONFERMA BOLLE DA DISCHETTO
019710010215     C     WORM          IFEQ      'S'
019720010215     C     FLGFIT        ANDNE     'S'
019730010215     C     PARTCH        ANDNE     'P'
019740070427     C     *IN12         IFEQ      *OFF
019750070427     C     *IN15         OREQ      *OFF
019760010215     C* in manutenzione propongo solo se variato il numero ORM
019770070427     C     WORMMD        ANDEQ     '1'
019780010215     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
019790010215     c* fine dell'immissione
019800010215     C                   EXSR      PRPOR2
019810010220     C* SE SONO IN MANUTENZIONE SEGNALO CHE POTREBBERO ESSERE VARIATI
019820010220     C* DEI DATI PRENDENDOLI DAL NUOVO N.ORM
019830010220     C   12
019840010220     CANN15WPRIMV        IFEQ      *BLANKS
019850010220     C                   SETON                                        90
019860010220     C                   MOVEL     ERR(226)      VIDMSG
019870010220     C                   MOVEL     '1'           WPRIMV            1
019880010220     C                   ENDIF
019890010215     C                   ENDIF
019900091008     c* se bolla import     porto assegnato abbinata ad orm devo proporre
019910070427     c* il mittente dell'orm nel mittente originale
019920091008     c***                if        *in79 and flgtb1='A'
019930091008     c                   if        flgtb1='A' and (§ogntw='EEX' or
019940091008     c                             §ogntw='FED' or §ogntw='DPD')
019950070427     c                   if        *in12='0' or *in15 or
019960070427     c                             (*in15='0' and (wormmd='1' or
019970070427     c                             (flgtb1='A' and flgtb1<>savtb1)))
019980070427     c                   exsr      prpor2_rmo
019990070427     c                   endif
020000070427     c                   endif
020010010215     C                   ENDIF
020020001020     C*
020030001020     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
020040001020     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
020050060113     C** 12
020060060113    2C**AN 15§LPFPR        IFNE      'V'
020070060113     C***                   GOTO      TAG02
020080060113    2C**                   END
020090040226
020100040227      * Salto il prossimo controllo se bolla con Lnp o Lna DPD
020110040227S   1c                   Select
020120040227     c                   When      *In79
020130160224     c                   When      VidDpd = 'D' or a_§OgNtw = 'DPD' or
020140160224     c                             w_aDpd='S'
020150040227     c                   Other
020160040226      * se orm con serie devo recuperare i riferimenti del mittente
020170040226      * immessi nella bolla originale legata al ritiro contestuale
020180040226      * se previsto da tabella 'OSR'
020190040227      * non forzo se bolla con Lna o Lnp DPD
020200040227if  2c                   If        wonsr > *Zeros and flgfit <> 'S' and
020210040227     c                             (d§OsrRmn = 'S' or d§OsrRma = 'S')
020220040226      * richiamo pgm x recupero dei riferimenti
020230040226     c                   Clear                   Fnls26ds
020240040227     c                   Move      wrmaas        I26Aas
020250040227     c                   Move      wrmlnp        I26Lnp
020260040227     c                   Move      wrmnrs        I26Nrs
020270040227     c                   Move      wrmnsp        I26Nsp
020280040226     c                   Call      'FNLS26R'
020290040226     c                   Parm                    Fnls26ds
020300040227if  3c                   If        O26Err = *Zeros
020310040227if  4c                   If        d§OsrRmn = 'S'
020320040227     c                   Eval      VidRmn = O26Rmn
020330040226      * proteggo il campo
020340040226     c                   Movel     Prot1         AtrRmn
020350040226     c                   Eval      wrifm = *On
020360040227    4c                   EndIf
020370040227if  4c                   If        d§OsrRma = 'S'
020380040226     c                   Eval      VidRma = O26Rma
020390040226      * proteggo il campo
020400040226     c                   Movel     Prot1         AtrRma
020410040226     c                   Eval      wrifm = *On
020420040227    4c                   EndIf
020430040227    3c                   EndIf
020440040227    2c                   EndIf
020450040227    1c                   EndSl
020460030409
020470030409      * Prima di procedere con la seconda videata devo emettere una finestra
020480030409      * se spedizione con lna FedEx o se spedizione relative ad ORM
020490030409      * commissionati da FedEx
020500030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
020510091111     c                   move      '1'           wvidobb           1
020520060113     c                   exsr      escier
020530091111     c                   move      ' '           wvidobb
020540060113    3c     §lpfpr        ifne      '5'
020550060113     c     §lpfpr        ifne      'V'
020560060113     c                   write     ls01d01
020570060113     c                   endif
020580091112     c                   eval      $fine='0'
020590091112     c                   Dow       $fine='0'
020600060110     c                   clear                   w02tes1
020610030409     c                   Eval      w02Tes = Rigw(1)
020620030409     c                   Eval      w02Rig1 = Rigw(3)
020630030409     c                   Eval      w02Rig2 = Rigw(4)
020640030409     c                   Eval      w02Rig3 = Rigw(5)
020650030409     c                   Eval      w02Rig4 = Rigw(6)
020660030409     c                   Exfmt     ls01w02
020670030409     c                   If        *InKl = *On
020680091112     c                   eval      $fine='1'
020690110309     c                   eval      *inkl=*off
020700030409     c                   EndIf
020710030409     c                   EndDo
020720060113   x3c                   else
020730060113     c                   goto      fine
020740060113    3c                   endif
020750030409     c                   EndIf
020760060113     c*
020770030409     c                   If        §orMic = 'F'
020780091111     c                   move      '1'           wvidobb           1
020790060113     c                   exsr      escier
020800091111     c                   move      ' '           wvidobb
020810060113    3c     §lpfpr        ifne      '5'
020820060113     c     §lpfpr        ifne      'V'
020830060113     c                   write     ls01d01
020840060113     c                   endif
020850091112     c                   eval      $fine='0'
020860091112     c                   Dow       $fine='0'
020870060110     c                   clear                   w02tes1
020880030409     c                   Eval      w02Tes = Rigw(2)
020890030409     c                   Eval      w02Rig1 = Rigw(7)
020900030409     c                   Eval      w02Rig2 = Rigw(4)
020910030409     c                   Eval      w02Rig3 = Rigw(8)
020920030409     c                   Clear                   w02Rig4
020930030409     c                   Exfmt     ls01w02
020940030409     c                   If        *InKl = *On
020950091112     c                   eval      $fine='1'
020960110309     c                   eval      *inkl=*off
020970030409     c                   EndIf
020980030409     c                   EndDo
020990060113   x3c                   else
021000060113     c                   goto      fine
021010060113    3c                   endif
021020030409     c                   EndIf
021030151015      * Prima di procedere con la seconda videata devo emettere una finestra
021040151015      * se spedizione export EEX con attraversamento doganale
021050151015     c                   if        ((wdesie='E' and viddpd=*blanks and
021060160303     c                               comlna=*zeros )
021070160224     c                              or A_§ogntw='EEX' )
021080151015     C                   MOVEL     '15'          COD
021090151015     C                   MOVEL(P)  VIDNZD        KEY
021100151015     C                   EXSR      CTABEL
021110151015     C                   MOVEL     TBLUNI        DS15
021120151015    2c                   if        §15dog<>*blanks
021130151015     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
021140151015     c* se devo emettere la window o ritornare al chiamante con errore
021150151015     c                   move      '1'           wvidobb           1
021160151015     c                   exsr      escier
021170151015     c                   move      ' '           wvidobb
021180151015    3c     §lpfpr        ifne      '5'
021190151015     c     §lpfpr        ifne      'V'
021200151015     c                   write     ls01d01
021210151015     c                   endif
021220151015     c                   eval      $fine='0'
021230151015    4c                   Dow       $fine='0'
021240151015     c                   clear                   w02tes
021250151015     c                   clear                   w02tes1
021260151015     c                   clear                   w02Rig2
021270151015     c                   Eval      w02rig1 = Rigw(11)
021280151015     c                   Eval      w02Rig3 = Rigw(12)
021290151015     c                   Eval      w02Rig4 = Rigw(13)
021300151015     c                   Exfmt     ls01w02
021310151015     c                   If        *InKl = *On
021320151015     c                   eval      $fine='1'
021330151015     c                   eval      *inkl=*off
021340151015     c                   EndIf
021350151015    4c                   EndDo
021360151015   x3c                   else
021370151015     c                   goto      fine
021380151015    3c                   endif
021390151015    2c                   endif
021400151015     c                   endif
021410151015      *
021420060113      * Prima di procedere con la seconda videata devo emettere una finestra
021430060113      * se spedizione in porto assegnato con destinatario con obbligo ddt in
021440060113      * fase di consegna (DDT=SI)
021450060113    2c                   If        Vidbam = 'S' and §dstddt = 'S' and
021460060113     c                             §3arbl <> 'R' and §1bf16 <> 'S' and
021470060113     c                             flgtb1 = 'A'
021480060113     c* richiamo routine escier per vedere,in base al richiamo,(§lpfpr)
021490060113     c* se devo emettere la window o ritornare al chiamante con errore
021500091111     c                   move      '1'           wvidobb           1
021510060113     c                   exsr      escier
021520091111     c                   move      ' '           wvidobb
021530060113    3c     §lpfpr        ifne      '5'
021540060113     c     §lpfpr        ifne      'V'
021550060113     c                   write     ls01d01
021560060113     c                   endif
021570091112     c                   eval      $fine='0'
021580091112    4c                   Dow       $fine='0'
021590060113     c                   clear                   w02tes
021600060113     c                   Eval      w02Tes1 = Rigw(9)
021610060113     c                   Eval      w02Rig2 = Rigw(10)
021620060113     c                   clear                   w02Rig1
021630060113     c                   clear                   w02Rig3
021640060113     c                   clear                   w02Rig4
021650060113     c                   Exfmt     ls01w02
021660060113     c                   If        *InKl = *On
021670091112     c                   eval      $fine='1'
021680110309     c                   eval      *inkl=*off
021690060113     c                   EndIf
021700060113    4c                   EndDo
021710060113   x3c                   else
021720060113     c                   goto      fine
021730060113    3c                   endif
021740060113    2c                   EndIf
021750090323     c
021760090323     c* tasto funzionale f15=cli/tar per tassazione porto assegnato
021770090323     c* Se la bolla non è in porto assegnato non è da visualizzare
021780090323     c                   if        flgtb1<>'A'
021790090323     c                   eval      atrf15=nodi
021800090323     c                   else
021810090323     c                   clear                   atrf15
021820090323     c                   endif
021830060113     c*
021840060113     C* PER DISK CLIENTI SE TUTTO OK SALTO FORMATO2
021850060113     C*     A MENO CHE NON SIA UNA BOLLA IN VARAZIONE
021860060113     C   12
021870060113    2CAN 15§LPFPR        IFNE      'V'
021880060113     C                   GOTO      TAG02
021890060113    2C                   END
021900941020     C*
021910941020     C* SE TUTTO OK EMETTO FORMATO2
021920941020     C     FOR02         TAG
021930940825     C* V I D E O   2
021940940819     C                   EXFMT     LS01D02
021950941003     C*
021960900926     C     TAG02         TAG
021970950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
021980950126     C                   EXSR      OFFD02
021990900926     C*
022000000905     C* CMD12 - RITORNO VIDEATA PRECEDENTE
022010000905     C     *INKL         IFEQ      *ON
022020000914     C* PER DISK C MANUTENZIONE RITORNO ALLA PRIMA VIDIEATA
022030000914     C* (IN QUESTO CASO INFATTI LA VIDEATA DI MANUTENZIONE COD CHI SONO
022040000914     C* DEVE ESSERE RICHIESTA CON F22 IN PRIMA VIDEATA)
022050160226
022060160226     c* Disk C da inserire in immissione/conferma no DPD
022070160226     c                   if        (§1bf12='S' and
022080160226     c                              Wexdpd<>'S' and
022090160226     c                              *in79 = *off and
022100160226     c                              (*in12 = *off or *in15))
022110160226     c                              OR
022120160226     c* Disk C da inserire in immissione/conferma Export DPD e numero parcel
022130160226     c* calcolato in automatico - (se bolla EEX da forzare in DPD WEXDPD non è
022140160226     c* a "S" - va bene così: in questo caso il chi sono non sarà mail numero
022150160226     c* parcel dpd e devo quindi trattarlo come una bolla non dpd)
022160160226     c                             (§1bf12='S' and
022170160226     c                              wexdpd='S' and
022180160226     c                              §1bf13='A' and
022190160226     c                              (*in12 = *off or *in15))
022200001009     C*
022210000905     C                   GOTO      FOR09
022220000905     C                   ELSE
022230000905     C                   GOTO      FOR01
022240000905     C                   ENDIF
022250000905     C                   ENDIF
022260010215     C* PRIMA DI FARE I CONTROLLI DELLA VIDEATA, SE ATTIATA PROC.ORM,
022270010215     C* E ORM NON FITTIZIO, PROPONGO EVENTUALI CAMPI SE A VIDEO SONO
022280010215     C* VUOTI
022290010215     C     WORM          IFEQ      'S'
022300010215     C     FLGFIT        ANDNE     'S'
022310010215     C     PARTCH        ANDNE     'P'
022320010215     C     *IN12         IFEQ      *OFF
022330010226     C     *IN15         OREQ      *OFF
022340010215     C                   EXSR      PRPOR2
022350010215     c* Se ho proposto dei campi non continuo i controlli ma devo
022360010215     c* riemettere videata per visualizzare i dati aggiunti
022370010215     C     WEFORM        IFEQ      '1'
022380010215     C                   GOTO      FOR02
022390010215     C                   ENDIF
022400010215     C                   ENDIF
022410091008     c****               if        *in79 and flgtb1='A'
022420091008     c                   if        flgtb1='A'  and (§ogntw='DPD' or
022430091008     c                             §ogntw='FED' or §ogntw='EEX')
022440070427     c                   exsr      prpor2_rmo
022450070427     C     weform        ifeq      '1'
022460070427     C                   goto      for02
022470070427     C                   endif
022480150414     c                   endif
022490010215     C                   ENDIF
022500040226
022510040226      * F11 - Calcolo volume
022520040226     c                   If        *Inkk = *On
022530040226     c                   Clear                   p26vol
022540040226     c                   Call      'TRUL36R'
022550040226     c                   Parm                    p26vol
022560040226     c                   Add       p26vol        VidVol
022570040226      * imposto wemfor per riemettere la videata
022580040301     c                   Eval      wkk = *On
022590040226     c                   EndIf
022600040226
022610900427     C* CONTROLLI
022620940825     C                   EXSR      CTRD02
022630040301
022640040301      * Se ho richiamato il calcolo del volume riemetto la videata
022650040301      * in modo da far vedere il volume calcolato in automatico
022660040301     c                   If        wkk = *On
022670040301     c                   Eval      wemfor = '1'
022680040301     c                   EndIf
022690940826     C* RIEMETTO FORMATO
022700950127     C     WEMFOR        IFEQ      '1'
022710950127     C                   EXSR      ESCIER
022720950127     C     §LPFPR        IFNE      '5'
022730950127     C                   GOTO      FOR02
022740950127     C                   ELSE
022750950127     C                   GOTO      FINE
022760950127     C                   ENDIF
022770950127     C                   ENDIF
022780010215     C* RICHIAMO ROUTINE DI CONTROLLO INCONGRUENZA COD.TARIFFA CON
022790010306     C* O.R.M.
022800010215     C     WORM          IFEQ      'S'
022810010215     C     FLGFIT        ANDNE     'S'
022820010215     C     PARTCH        ANDNE     'P'
022830010215     C     *IN12         IFEQ      *OFF
022840010301     C     *IN15         OREQ      *OFF
022850010215     C                   EXSR      CNFOR2
022860010215     C* RIEMETTO FORMATO
022870010215     C     WEMFOR        IFEQ      '1'
022880010215     C                   EXSR      ESCIER
022890010215     C     §LPFPR        IFNE      '5'
022900010215     C                   GOTO      FOR02
022910010215     C                   ELSE
022920010215     C                   GOTO      FINE
022930010215     C                   ENDIF
022940010215     C                   ENDIF
022950010215     C                   ENDIF
022960010215     C                   ENDIF
022970090323     c***
022980090323     C* F15=Cli/tariffa per tassazione porti assegnati
022990090323     c***
023000090323     c* emetto window solo se tasto di funzione è abilitato
023010090326     c                   if        *inkp='1'
023020090326     c                   if        atrf15=*blanks
023030090323     c                   exsr      geswdw_clitar
023040090326     c                   else
023050090326     c                   movel     err(322)      vidmsg
023060090326     c                   seton                                        90
023070090326     c                   endif
023080090323     c                   goto      for02
023090090326     c                   endif
023100941115     C***
023110941115     C* CMD8 - RISTAMPA BOLLA
023120941115     C***
023130000627     C* NON POSSO FARE RISTAMPA SE SONO SOLO NEI CONTROLLI
023140000627     C     §LPFLG        IFEQ      'C'
023150000627     C     *INKH         ANDEQ     *ON
023160000627     C                   MOVEL     ERR(203)      VIDMSG
023170000627     C                   SETON                                        90
023180000627     C                   GOTO      FOR02
023190000627     C                   ENDIF
023200000627     C**
023210970128     C* POSSO RISTAMPARE SOLTANTO SE ALLEGA BAM E' S
023220970128     C*  O NO MA LA BOLLA E' GIA' STATA STAMPATA
023230000112     C  N22*INKH         IFEQ      *ON
023240970128     C     VIDBAM        IFEQ      'N'
023250970128     C     BLPFST        IFEQ      'N'
023260970128     C     BLPFST        OREQ      'S'
023270970128     C* ERRORE
023280000627     C                   MOVEL     ERR(137)      VIDMSG
023290970128     C                   SETON                                        90
023300970128     C                   GOTO      FOR02
023310970128     C                   ENDIF
023320970128     C                   ENDIF
023330970128     C*
023340970128     C                   MOVEL     '1'           CMD8              1
023350970128     C                   ENDIF
023360091111
023370091111     c*** Gestione window per scelta Beneficiario Contrassegno
023380091124     c*** per spedizione con contrassegno legata ad orm che paga ordinante
023390091124     C*** (spedizione in assegnato con triangolazione)
023400091123     c                   clear                   wwdwcas           1
023410091211     c                   if        nochkticC=*on
023420091111     c                   eval      wvidobb='1'
023430091111     c                   exsr      escier
023440091111     c                   eval      wvidobb=' '
023450091111    2c                   if        §lpfpr<>'5'
023460091111    3c                   if        *in12 and *in15 and §lpfpr<>'V'
023470091111     c                   write     ls01d02
023480091111    3c                   endif
023490091111     c                   exsr      geswdw_cas
023500091123     c                   eval      wwdwcas='S'
023510091111     c   kl              goto      for02
023520091111   x2c                   else
023530091111     c                   goto      fine
023540091111    2c                   endif
023550091119     c                   endif
023560940920     C***
023570990610     C* F9  - ESTENSIONE BOLLA
023580940920     C***       VISUALIZZA LA 2 BOLLA SE ESISTE E LA TASSAZIONE
023590940923     C* SE TASSAZIONE CON TARIFFA MITTENTE CI VADO OBBLIGATORIAMENTE
023600940923     C* SE INSERITO ALMENO UN CAMPO E POI CMD12 CI RITORNO OBBLIGATOR
023610940826    2C     *INKI         IFEQ      *ON
023620940923     C     SAVFTM        ORNE      ' '
023630950125     C     *IN04         ANDEQ     *ON
023640940923     C     VIDFTM        ORNE      ' '
023650950125     C     *IN04         ANDEQ     *ON
023660961111     C* SE FRANCO FRONTIERA DEVO OBBLIGATORIAMENTE INDICARE IL PORTO
023670961111     C     VIDFBR        OREQ      'F'
023680940923     C     WEMD03        ORNE      ' '
023690990610     C* SE PREPAGATO CI VADO OBBLIGATORIAMENTE
023700990610     C     PARTCH        OREQ      'P'
023710010305     C     §LPFPR        OREQ      'O'
023720000112     C     *IN22         OREQ      *ON
023730940826     C                   EXSR      GESD03
023740940826     C   KL              GOTO      FOR02
023750941020     C*
023760950419     C* SE E' ERRORE E PGM DA DISK CLIENTI CHIAMATO CON "W" --> ESCO
023770950127     C     §LPFPR        IFEQ      '5'
023780950127     C                   GOTO      FINE
023790950127     C                   ENDIF
023800940923     C*
023810940923   X2C                   ELSE
023820940923     C*
023830101104     C* SE CONTO SERVIZIO IMMISSIONE PER F6   o F8
023840101104     c                   if        not *inkf and not *inkh
023850101104    3C     WFPR          IFNE      'I'
023860940923     C     §3ARBL        ANDEQ     'C'
023870950407     C*
023880950407     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
023890950410    4C     VIDLNP        IFNE      102
023900950407     C     *IN12         OREQ      *OFF
023910950407     C     *IN15         OREQ      *OFF
023920940923     C                   MOVEL     ERR(40)       VIDMSG
023930940923     C                   SETON                                        90
023940940923     C                   GOTO      FOR02
023950950410    4C                   ENDIF
023960950410    3C                   ENDIF
023970101104     c                   endif
023980960318     C**
023990960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
024000960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
024010960805     C* NON LO FACCIO PER LE SPEDIZIONI DI RECUPERO
024020960805     C  NKF§3ARBL        IFNE      'R'
024030030704     c     wforw03       andeq     *Blanks
024040121003     C                   EXSR      CTRCRG
024050121003     c   41              GoTo      For02
024060960805     C                   ENDIF
024070940923     C*
024080940923    2C                   ENDIF
024090940920     C***
024100900608     C* CMD8 - RISTAMPA BOLLA
024110940920     C***
024120970128     C     *INKH         IFEQ      *ON
024130970128     C     VIDBAM        IFEQ      'N'
024140970128     C     BLPFST        IFEQ      'N'
024150970128     C     BLPFST        OREQ      'N'
024160970128     C* ERRORE
024170970128     C                   MOVEL     ERR(137)      VIDMSG
024180970128     C                   SETON                                        90
024190970128     C                   GOTO      FOR02
024200970128     C                   ENDIF
024210970128     C                   ENDIF
024220970128     C*
024230970128     C                   MOVEL     '1'           CMD8              1
024240970128     C                   ENDIF
024250940920     C***
024260930930     C* SE VARIATA LIN.ARRIVO O DATA SPEDIZIONE DI UNA BOLLA BORDERIZZ.
024270930930     C* EMETTO IL MESSAGGIO E LA SBORDERIZZO (SONO ESCLUSI I RECUPERI)
024280940214     C   12
024290940214    2CANN15§1BFG4        IFEQ      'S'
024300940920     C     BLPDBR        ANDGT     0
024310940920     C*
024320940920    3C     COMLNA        IFNE      BLPLNA
024330940920     C     BLPDSP        ORGT      BLPDBR
024340930331     C* DECODIFICA LNA
024350930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
024360940928     C  N30              MOVEL     ORGDES        V1DLNA
024370930331     C*
024380940920     C                   EXFMT     LS01D05
024390940920     C                   CLEAR                   BLPNFV
024400940920     C                   CLEAR                   BLPDBR
024410940920     C                   CLEAR                   BLPFLP
024420950126     C* MEMORIZZO CHE HO SBORDERIZZATO LA BOLLA PER CANCELLARE ANCHE
024430950126     C* SUL DETTAGLIO COLLI IL NUMERO DI FOGLIO VIAGGIO
024440950126     C                   MOVEL     'S'           WSBORD            1
024450940920    3C                   ENDIF
024460940920    2C                   ENDIF
024470940920     C***
024480000627     C* SE SOLO CONTROLLI AGGIORNO LA DBLP CHE RESTITUISCO AL CHIAMANTE
024490940920     C***
024500000627     C     §LPFLG        IFEQ      'C'
024510000627     C                   EXSR      AGDBLP
024520000627     C                   ELSE
024530000627     C***
024540000627     C* REGISTRO BOLLA E STAMPO
024550000627     C***
024560900504     C                   EXSR      REGIS
024570000627     C                   ENDIF
024580000313     C*
024590000313     C* SE PGM RICHIAMATO PASSO INDIETRO IL FLAG DDT, CHE SERVE
024600000313     C* QUANDO SONO RICHIAMATO DA GIACENZE PER POI DECIDERE SE RISTAMPA
024610000313     C*  RE O MENO LA BOLLA
024620000627     C   12
024630000627     CAN 15§LPFLG        IFNE      'C'
024640000627     C                   MOVEL     VIDBAM        §LPBAM
024650000627     C                   ENDIF
024660950127     C* RIEMETTO FORMATO
024670950127     C     WEMFOR        IFEQ      '1'
024680950127     C                   EXSR      ESCIER
024690950127     C     §LPFPR        IFNE      '5'
024700950127     C                   GOTO      FOR02
024710950127     C                   ELSE
024720950127     C                   GOTO      FINE
024730950127     C                   ENDIF
024740950127     C                   ENDIF
024750900504     C*
024760900508     C* PULISCO CAMPI FOR01 E FOR02
024770940214    2C     *IN12         IFEQ      *OFF
024780010307     C     §LPFPR        ANDNE     'O'
024790940819     C                   EXSR      INZ01
024800940819     C                   EXSR      INZ02
024810941011     C                   EXSR      INZ03
024820971210     C                   EXSR      INZ06
024830991203     C                   EXSR      INZ07
024840000911     C                   EXSR      INZ08
024850040908     c* se personalizzato n. orm prima di riemettere la videata di
024860040908     c* bollettazione devo effettuare i controlli per poporre eventuali
024870040908     c* campi da ORM (simulo enter per fare in modo che il pgm si com
024880040908     c* porti allo stesso modo di quando dalla prima videata viene
024890040908     c* immesso il numero orm con la pistola (enter automatico)
024900041217     c* Non lo faccio se ORM fittizio in quanto non c'è nulla da proporre
024910041220     c                   if        *in37 = *on
024920041220     c                   if        flgfit <> 'S'
024930050119     c                   eval      wsolo_prp = '1'
024940041217     c                   exsr      ctrd01
024950041220     c                   else
024960041220     c* se orm fittizio riemetto la prima videata posizionandomi sul n.colli
024970041220     c* (per uniformità: fa così anche per orm reale)
024980041220     c                   z-add     13            h1riga
024990041220     c                   z-add     20            h1colo
025000041220     c                   endif
025010041217     c                   endif
025020930628     C                   GOTO      FOR01
025030940214    2C                   END
025040930628     C*
025050000000     C     FINE          TAG
025060940214     C*
025070930628     C  N12              SETON                                        LR
025080060308     c* Chiudo con LR pgm gestione motivazione variazione ad ogni bolla per
025090060308     c* pulire la videata
025100060308     c                   clear                   fnlv85ds
025110060308     c                   eval      ilv85tla = 'C'
025120060308     c                   movel     fnlv85ds      kpjbu
025130060308     c                   call      'FNLV85R'
025140060308     c                   parm                    kpjba
025150060222     c*
025160150929     c                   if        not *inlr
025170150929     C* DISALLOCAZIONE FILES
025180150929      *
025190150929     C                   UNLOCK    FNBLP00F
025200150929     C                   UNLOCK    Fiar901L
025210150929     C                   UNLOCK    FIAR601L
025220150929     C                   UNLOCK    FIAR701L
025230150929     C                   UNLOCK    Fiar401L
025240150929     C                   UNLOCK    FNBLT01L
025250150929     C                   UNLOCK    FIARS01L
025260150929     C                   UNLOCK    FIART01L
025270150929     c                   endif
025280130419     c  nlr              return
025290940214    1C                   ENDIF
025300940214     C* CHIUDO FILES
025310941108     C     *INLR         IFEQ      *ON
025320941108     C*
025330941108     C     WCL98         IFEQ      '1'
025340940214     C                   MOVEL     'C'           D98TLA
025350970925     C                   CALL      'TNSD99R'
025360970925     C                   PARM                    DSSD99
025370940214    1C                   ENDIF
025380970722     C**
025390991102     C                   CLEAR                   DSBS02
025400991102     C                   MOVEL     'C'           T02TLA
025410991102     C                   CALL      'TIBS02R'
025420991102     C                   PARM                    KPJBA
025430991102     C                   PARM                    DSBS02
025440991102     C**
025450970722     C                   MOVEL     'C'           I13TLA
025460970722     C                   CALL      'FNLV13R'
025470970722     C                   PARM                    KPJBA
025480970722     C                   PARM                    DSLV13
025490970722     C                   PARM                    DSSI95
025500061109     C**
025510061109     C                   MOVEL     'C'           ISIE3TLA
025520061109     C                   CALL      'TISIE3R'
025530061109     C                   PARM                    TISIE3DS
025540061109     c
025550151106     C                   MOVEL     'C'           XCFIVA1ds
025560151106     C                   CALL      'XCFIVAR1'
025570151106     C                   PARM                    XCFIVA1ds
025580991130     C**
025590060619    2C     WEU12         IFEQ      'S'
025600060619     C                   MOVEL     'C'           i12TLA
025610060619     C                   CALL      'FIEU12R'
025620991130     C                   PARM                    KPJBA
025630060619     C                   PARM                    fieu12ds
025640991130    3C                   ENDIF
025650011212     C*
025660011212     C                   CLEAR                   DSUL21
025670011212     C                   MOVEL     'C'           I21TLA
025680011212     C                   CALL      'TRUL21R'
025690011212     C                   PARM                    DSUL21
025700011212     C*
025710011212     C                   CLEAR                   DSUL22
025720011212     C                   MOVEL     'C'           I22TLS
025730011212     C                   CALL      'TRUL22R'
025740011212     C                   PARM                    DSUL22
025750011212     C*
025760011212     C                   CLEAR                   DSUL23
025770011212     C                   MOVEL     'C'           I23TLA
025780011212     C                   CALL      'TRUL23R'
025790011212     C                   PARM                    DSUL23
025800941108     C*
025810941108    2C     *IN12         IFEQ      *OFF
025820941108     C     *IN15         OREQ      *ON
025830941108     C*
025840941108    3C     I100          IFEQ      1
025850941108     C                   MOVEL     '*'           DB0GES
025860941108    3C                   ENDIF
025870941108    2C                   ENDIF
025880941108     C*
025890941108     C                   MOVEL     'C'           DB0TLA
025900030611     C                   CALL      WD90PSL
025910030626     C                   PARM                    fnlsb5DS
025920970925     C*
025930970925     C                   CLEAR                   DSLV55
025940970925     C                   MOVEL     'C'           D55TLA
025950970925     C                   CALL      'FNLV55R'
025960970925     C                   PARM                    DSLV55
025970000918     C*
025980000918     C                   CLEAR                   DSLSZ1
025990000918     C                   MOVEL     'C'           IZ1TLA
026000000918     C                   CALL      'FNLSZ1R'
026010010402     C                   PARM                    KPJBA
026020000918     C                   PARM                    DSLSZ1
026030000918     C                   PARM                    DS1B
026040020213     c*
026050160219     C                   CLEAR                   trul27ds1
026060020213     C                   MOVEL     'C'           I27TLA
026070160219     C                   CALL      'TRUL27R1'
026080160219     C                   PARM                    TRUL27DS1
026090020218     c*
026100160219     C                   CLEAR                   trulc7ds
026110160219     C                   MOVEL     'C'           Ic7TLA
026120160219     C                   CALL      'TRULC7R'
026130160219     C                   PARM                    TRULc7DS
026140160219
026150020218     c                   movel     'C'           tastla
026160020218     C                   CALL      'TNSF20R'
026170020218     C                   PARM                    KPJBA
026180020218     C                   PARM                    DTAS
026190020218     C                   PARM                    DTASV
026200020320     c*
026210020320     c                   clear                   trul33ds
026220020320     c                   movel     'C'           i33tla
026230020320     c                   movel     trul33ds      kpjbu
026240020320     C                   CALL      'TRUL33R'
026250020320     C                   PARM                    KPJBA
026260020531     c*
026270020531     c                   clear                   tisit0ds
026280071010     c                   clear                   tisit0x1ds
026290020531     c                   movel     'C'           it0tla
026300020531     C                   CALL      'TISIT5R'
026310020531     C                   PARM                    tisit0ds
026320071010     C                   PARM                    tisit0x1ds
026330031217
026340091006     c                   Clear                   Fnls28ds
026350091006     c                   Eval      I28Tla = 'C'
026360091006     c                   Call      'FNLS28R'
026370091006     c                   Parm                    kpjba
026380091006     c                   Parm                    Fnls28ds
026390040227
026400040227     c                   Clear                   Fnls26ds
026410040227     c                   Eval      I26Tla = 'C'
026420040227     c                   Call      'FNLS26R'
026430040227     c                   Parm                    Fnls26ds
026440061107     c*
026450061107     c                   Eval      Ideptla = 'C'
026460061107     c                   call      'TRULDEPR'
026470061107     c                   parm                    truldepds
026480061127     c* Richiamo il *pgm d utilità FIDN12R in modalità "solo chiusura"
026490061127     c                   clear                   fidn12ds
026500061127     c                   eval      dn_i12tla = 'C'
026510061127     c                   call      'FIDN12R'
026520061127     c                   parm                    fidn12ds
026530081111
026540081111     C                   MOVEL     'C'           SA2TLA
026550081111     C                   CALL      'FNLSA2R3'
026560081111     C                   PARM                    SA2TLA
026570081111     C                   PARM                    SA2TRC
026580081111     C                   PARM                    SA2DTS
026590081111     C                   PARM                    WWLNA             3 0
026600090626     c*
026610090626     c                   clear                   trulticds
026620090626     c                   eval      itictla='C'
026630090626     c                   call      'TRULTICR'
026640090626     c                   parm                    TRULTICDS
026650090626     c                   parm                    ds1a
026660120615     c*
026670120615     c                   clear                   trulflbds
026680120615     c                   eval      iflbtla='C'
026690120615     c                   call      'TRULFLBR'
026700120615     c                   parm                    TRULFLBDS
026710061107     c*
026720040329      * Chiudo Titas30c
026730040329     c                   If        %Open(Titas30c)
026740040329     c                   Close     Titas30c
026750040329     c                   EndIf
026760151014      * Chiudo fiar531c
026770151014     c                   If        %Open(fiar531c)
026780151014     c                   Close     fiar531c
026790151014     c                   EndIf
026800150302
026810150302     c                   clear                   tisigads
026820150302     c                   movel     'C'           igatla
026830150302     c                   movel     tisigads      kpjbu
026840150302     C                   CALL      'TISIGAR'
026850150302     C                   PARM                    KPJBA
026860150701
026870150701     c                   clear                   fnlssgnds
026880150701     c                   movel     'C'           isgntla
026890150701     C                   CALL      'FNLSSGNR1'
026900150701     C                   PARM                    fnlssgnds
026910160226
026920160226     c                   clear                   fnlvdpds
026930160226     c                   movel     'C'           idptla
026940160226     c                   movel     fnlvdpds      kpjbu
026950160226     C                   CALL      'FNLVDPR'
026960160226     C                   PARM                    kpjba
026970160120
026980160126     C                   IF        *in12 and *in15 and (at0fva=*blanks or
026990160126     c                             at0fra=*blanks)
027000160120     C                   MOVEL     'C'           PA1FLG
027010160120     C                   MOVEL     PARAM1        KPJBU
027020160120     C                   CALL      'FNLR75R'                            99
027030160120     C                   PARM                    KPJBA
027040160120     c                   endif
027050941108     C*
027060941108    1C                   ENDIF
027070991008      *----------------------------------------------------------------
027080991008      *--  OPERAZIONI INIZIALI   -------------------------------------*
027090991008      *----------------------------------------------------------------
027100940819     C     *INZSR        BEGSR
027110011114     C* N.B.: QUANDO NON SI VORRÀ PIÙ STAMPARE BLANK+55L+CAP DESTINO:
027120011114     C*       ASTERISCARE    "MOVE *BLANKS   WNO55L"
027130011114     C*       DISASTERISCARE "MOVE '1'       WNO55L"
027140020725     C***                MOVE      *BLANKS       WNO55L            1
027150011126     C                   MOVE      '1'           WNO55L            1
027160030610      * MEMORIZZO STAMPANTE SEGNACOLLI E FLAG BOLLE DI RECUPERO
027170950118     C                   MOVEL     KPJBU         PARAM3
027180030610      *
027190030610      * SE RICEVO TRUL90DS TENGO BUONO I PGM DELLA DS, in caso contrario
027200030610      *  quello della KPJBU + FNLSB0R
027210030610      * ....... modifica da togliere dopo aver eliminato TRUL01R
027220030610     C                   IF        %PARMS < 4
027230030611     C                   movel(P)  Wpgmss        WD90PSS
027240030611     C                   movel(P)  'FNLSB0R'     WD90PSL
027250030611     C                   ELSE
027260030611     C                   movel(P)  D90PSS        WD90PSS
027270030611     C                   movel(P)  D90PSL        WD90PSL
027280030610     c                   ENDIF
027290030610      *
027300011107     C     WNO55L        IFEQ      *BLANKS
027310011107     C                   MOVEL     ' 55L'        W55L
027320011107     C                   ELSE
027330011107     C                   CLEAR                   W55L
027340011107     C                   ENDIF
027350040329
027360040329      * Se sono in ambiente buono - GAITRAGRU
027370040329     c                   If        knsif = 'FILTRA201 '
027380040329     c                   Eval      wlib = 'GAITRAGRU '
027390040329      *  Se sono in ambiente di prova - GAITRAGRPS
027400040329     c                   Else
027410040329     c                   Eval      wlib = 'GAITRAGRPS'
027420040329     c                   EndIf
027430940819     C***
027440940819     C* KLIST
027450940819     C***
027460940819     C* ACCESSO   CNACO
027470940819     C     KACO          KLIST
027480940819     C                   KFLD                    CODUT
027490940819     C                   KFLD                    CCC
027500940909     C                   KFLD                    WKSC
027510990630     C     KNUM          KLIST
027520990630     C                   KFLD                    DATAAS            2 0
027530990630     C                   KFLD                    RGS               1 0
027540990630     C                   KFLD                    FIV               3 0
027550990630     C**
027560990630     C                   Z-ADD     2             RGS
027570990630     C**
027580950920     C* ACCESSO   AZCLN
027590950920     C     KCLN          KLIST
027600950920     C                   KFLD                    SIMFEL
027610950920     C                   KFLD                    W0030
027620950920     C                   KFLD                    WAA               4 0
027630950920     C                   KFLD                    WMM               2 0
027640101022     C     KCLNA         KLIST
027650101022     C                   KFLD                    w0030
027660101022     C                   KFLD                    comlna
027670101022     C                   KFLD                    WAA               4 0
027680101022     C                   KFLD                    WMM               2 0
027690940819     C* ACCESSO   TFTAM SENZA PROGRESSIVO
027700940819     C     KTAM2         KLIST
027710940909     C                   KFLD                    WKSC
027720940819     C                   KFLD                    COMCTR            3 0
027730940819     C                   KFLD                    COMPRG            3 0
027740940819     C* ACCESSO   TFTPT SENZA PROGRESSIVO
027750940819     C     KTPT          KLIST
027760940909     C                   KFLD                    WKSC
027770940819     C                   KFLD                    COMCTR            3 0
027780940819     C                   KFLD                    COMPRG            3 0
027790990818     C                   KFLD                    FTC               2
027800940819     C* ACCESSO   TFTAM TARIFFA DI CARTELLO
027810020208     c*
027820160216     C***  KCAR2         KLIST
027830160216     C**+                KFLD                    TARKSC
027840160216     C***                KFLD                    TARCTR            3 0
027850160216     C****               KFLD                    TARPRG            3 0
027860160216     C     KCAR2         KLIST
027870160216     C                   KFLD                    OC7KSCC
027880160216     C                   KFLD                    OC7CTRC
027890160219     C                   KFLD                    OC7PRGC_
027900940819     C* ACCESSO   TABEL
027910940819     C     KTAB2         KLIST
027920940819     C                   KFLD                    CODUT
027930940819     C                   KFLD                    COD               2
027940940819     C                   KFLD                    KEY               8
027950940819     C* ACCESSO   TABEL
027960940819     C     KTAB3         KLIST
027970940819     C                   KFLD                    CODUT
027980940819     C                   KFLD                    COD               2
027990000120     C     KTBE          KLIST
028000000120     C                   KFLD                    KTCOD
028010000120     C                   KFLD                    KTLIN
028020000120     C                   KFLD                    KTSIF
028030000120     C                   KFLD                    KTKE1
028040000120     C                   KFLD                    KTKE2
028050070612     C* ACCESSO   EDTAB
028060070612     C     KEDTAB        KLIST
028070070612     C                   KFLD                    Kedcod
028080070612     C                   KFLD                    kedkey
028090940819     C* ACCESSO   FILE DISCHETTO CLIENTI
028100940819     C     KBLC          KLIST
028110020917     C                   KFLD                    §FGS
028120020917     C                   KFLD                    §LPCCM
028130970407     C                   KFLD                    §LPAAC
028140940819     C                   KFLD                    §LPLNP
028150940819     C                   KFLD                    §LPNRS
028160940819     C                   KFLD                    §LPNSP
028170970107     C     KBLC4         KLIST
028180970407     C                   KFLD                    §LPAAC
028190970107     C                   KFLD                    §LPLNP
028200970107     C                   KFLD                    §LPNRS
028210970107     C                   KFLD                    §LPNSP
028220940819     C* ACCESSO   FILE BOLLE VISTA LOGICA 1
028230940819     C     KBLP3         KLIST
028240940819     C                   KFLD                    §LPAAS
028250940819     C                   KFLD                    §LPLNP
028260940819     C                   KFLD                    §LPNRS
028270940819     C                   KFLD                    §LPNSP
028280051124     C**   KBLP33        KLIST
028290051124     C**                 KFLD                    §LPAAS
028300051124     C**                 KFLD                    §LPLNP
028310051124     C**                 KFLD                    §LPNRS
028320051124     C**                 KFLD                    §LPNSP
028330051124     C**                 KFLD                    bltnsc
028340940926     C     KBLP4         KLIST
028350940926     C                   KFLD                    §LPAAS
028360940926     C                   KFLD                    §LPLNP
028370940926     C                   KFLD                    §LPNRS
028380940926     C                   KFLD                    §LPNSP
028390940926     C                   KFLD                    WTRC
028400041013     C     KBLP4M        KLIST
028410060215     c                   kfld                    ar4aas
028420060215     c                   kfld                    ar4lnp
028430060215     c                   kfld                    ar4nrs
028440060215     c                   kfld                    ar4nsp
028450001212     C* Usata per controllo segnacolli doppi bolle poste
028460120817     C***  KBLP1         KLIST
028470120817     C***                KFLD                    BLTAAS
028480120817     C***                KFLD                    BLTLNP
028490120817     C***                KFLD                    BLTNRS
028500120817     C***                KFLD                    BLTNSP
028510120814     C     Kfiart        KLIST
028520120814     C                   KFLD                    BLTAAS
028530120814     C                   KFLD                    BLTLNP
028540120814     C                   KFLD                    BLTNRS
028550120814     C                   KFLD                    BLTNSP
028560120814     C                   KFLD                    BLTNSC
028570120817     C***  KBLP4P        KLIST
028580120817     C***                KFLD                    BLTAAS
028590120817     C***                KFLD                    BLTLNP
028600120817     C***                KFLD                    BLTNRS
028610120817     C***                KFLD                    BLTNSP
028620120817     C***                KFLD                    WTRC
028630940819     C* KEY PER SEGNACOLLI DOPPI IN FLBLT
028640940819     C     KBLT          KLIST
028650940916     C                   KFLD                    WFLS
028660940819     C                   KFLD                    COMLNA
028670940819     C                   KFLD                    VIDNRS
028680940819     C                   KFLD                    COMSCD
028690120816     C***  KBLT29        KLIST
028700120816     C***                KFLD                    WFLS
028710120816     C***                KFLD                    VIDNRS
028720120816     C***                KFLD                    COMSCD
028730980320     C     KBLT1         KLIST
028740980320     C                   KFLD                    BLPAAS
028750980320     C                   KFLD                    BLPLNP
028760980320     C                   KFLD                    BLPNRS
028770980320     C                   KFLD                    BLPNSP
028780080103     C     KBRV          KLIST
028790960404     C                   KFLD                    KNPG
028800960404     C                   KFLD                    BLTFLS
028810960404     C                   KFLD                    BLTLNA
028820960404     C                   KFLD                    BLTNRS
028830960404     C                   KFLD                    BLTNSC
028840960404     C                   KFLD                    KFLE
028850120817     C     KBRVA         KLIST
028860120817     C                   KFLD                    KNPG
028870120817     C                   KFLD                    ARTFLS
028880120817     C                   KFLD                    ARTLNA
028890120817     C                   KFLD                    ARTNRS
028900120817     C                   KFLD                    ARTNSC
028910120817     C                   KFLD                    KFLE
028920940819     C* ACCESSO   FILE NUMERATORE
028930940819     C     KNUF          KLIST
028940940819     C                   KFLD                    AAS               2 0
028950940819     C                   KFLD                    CNU               3 0
028960940819     C                   KFLD                    COMLIN            3 0
028970940819     C     KNUF2         KLIST
028980940819     C                   KFLD                    AAS               2 0
028990940819     C                   KFLD                    CNU
029000940819     C                   KFLD                    COMLIN
029010940819     C                   KFLD                    LIV2              3 0
029020991117     C     KNUF3         KLIST
029030991117     C                   KFLD                    CNU
029040991118     C                   KFLD                    DATA6             6 0
029050000509     C     KNUFSP        KLIST
029060000509     C                   KFLD                    AAS               2 0
029070000509     C                   KFLD                    CNU               3 0
029080000509     C                   KFLD                    COMLIN            3 0
029090000509     C                   KFLD                    WNUF2             3 0
029100940819     C* PER CONTROLLO NUM DI SPEDIZIONE
029110940819     C     KNSP          KLIST
029120940916     C                   KFLD                    WAAS
029130940819     C                   KFLD                    VIDLNP
029140940819     C                   KFLD                    VIDNRS
029150940819     C                   KFLD                    RECNSP
029160940819     C     KFTT          KLIST
029170940819     C                   KFLD                    W01PDR
029180940819     C                   KFLD                    W01FVL
029190940819     C                   KFLD                    COMDRT
029200940819     C                   KFLD                    W01TSR
029210980318     C     KVAT          KLIST
029220020917     C                   KFLD                    §FGS
029230020917     C                   KFLD                    §LPCCM
029240980318     C                   KFLD                    §LPAAC
029250980318     C                   KFLD                    §LPLNP
029260980318     C                   KFLD                    §LPNRS
029270980318     C                   KFLD                    §LPNSP
029280980318     C                   KFLD                    WTRC
029290031114
029300031114     c     kVat1         Klist
029310031114     C                   Kfld                    §Fgs
029320031114     C                   Kfld                    §LpCcm
029330031114     C                   Kfld                    §LpAac
029340031114     C                   Kfld                    §LpLnp
029350031114     C                   Kfld                    §LpNrs
029360031114     C                   Kfld                    §LpNsp
029370031114
029380980320     C*
029390051102     C     KARS1         KLIST
029400980320     C                   KFLD                    BLTFLS
029410980320     C                   KFLD                    BLTLNA
029420980320     C                   KFLD                    BLTNRS
029430980320     C                   KFLD                    BLTNSC
029440980320     C                   KFLD                    WTRC
029450120817     C     KARS1A        KLIST
029460120817     C                   KFLD                    ARTFLS
029470120817     C                   KFLD                    ARTLNA
029480120817     C                   KFLD                    ARTNRS
029490120817     C                   KFLD                    ARTNSC
029500120817     C                   KFLD                    WTRC
029510051102     C     KARS1P        KLIST
029520050211     C                   KFLD                    BLpFLS
029530050211     C                   KFLD                    BLpLNA
029540050211     C                   KFLD                    BLpNRS
029550050211     C                   KFLD                    BLpNcd
029560050211     C                   KFLD                    WTRC
029570120817     C***  KARSD         KLIST
029580120817     C***                KFLD                    BLTFLS
029590120817     C***                KFLD                    BLTLNA
029600120817     C***                KFLD                    BLTNRS
029610120817     C***                KFLD                    BLTNSC
029620051102     C     KARS1K        KLIST
029630000915     C                   KFLD                    KFLSAN
029640000915     C                   KFLD                    KLNAAN
029650000915     C                   KFLD                    KNRSAN
029660000915     C                   KFLD                    KNSCAN
029670000915     C                   KFLD                    WTRC
029680051102     C     KARS01        KLIST
029690980320     C                   KFLD                    BLPFLS
029700980320     C                   KFLD                    BLPLNA
029710980320     C                   KFLD                    BLPNRS
029720980320     C                   KFLD                    WO2SCD
029730980320     C                   KFLD                    WTRC
029740051102     C     KARS2         KLIST
029750020308     C                   KFLD                    W8CNOT
029760980325     C                   KFLD                    WTRC
029770060215     C     Kar4F         KLIST
029780991217     C                   KFLD                    WTRC
029790991217     C                   KFLD                    W030A
029800060215     C     Kar4B         KLIST
029810060215     C                   KFLD                    ar4AAS
029820060215     C                   KFLD                    ar4LNP
029830060215     C                   KFLD                    ar4NRS
029840060215     C                   KFLD                    ar4NSP
029850060215     C     Kar403        KLIST
029860060215     C                   KFLD                    kar4trc
029870060215     C                   KFLD                    kar4n14
029880010116     C     KSGN          KLIST
029890010116     C                   KFLD                    COMTFP
029900010116     C                   KFLD                    KWHO
029910010116     C     KSGN8         KLIST
029920010116     C                   KFLD                    COMTFP
029930010116     C                   KFLD                    V8CNOT
029940020308     C     KSGN88        KLIST
029950020308     C                   KFLD                    COMTFP
029960020308     C                   KFLD                    W8CNOT
029970010212     C     KORM          KLIST
029980010212     C                   KFLD                    WOPOE
029990010212     C                   KFLD                    WONSR
030000010222     C                   KFLD                    WONOR2
030010010212     C                   KFLD                    WONRV
030020100319     C     KORME         KLIST
030030100319     C                   KFLD                    WOPOE
030040100319     C                   KFLD                    WONSR
030050100319     C                   KFLD                    WONOR2
030060100319     C                   KFLD                    WONRV
030070100319     C                   KFLD                    koretrc
030080010212     C     KDST          KLIST
030090120611     C                   KFLD                    ormnpg
030100120611     C                   KFLD                    ormndc
030110060522     C                   KFLD                    kfgs
030120010214     C     KFVV          KLIST
030130010214     C                   KFLD                    ORMNPG
030140010215     C                   KFLD                    W0050
030150060522     C                   KFLD                    kfgs
030160021203     C     Kfapd         klist
030170021203     C                   kfld                    kpdtip
030180021203     C                   kfld                    kpdpdr
030190021218     c     KFiar5        Klist
030200021218     c                   Kfld                    BlpAas
030210021218     c                   Kfld                    BlpLnp
030220021218     c                   Kfld                    BlpNrs
030230021218     c                   Kfld                    BlpNsp
030240021218     c                   Kfld                    KAr5Trd
030250040601     c     Kbolm         Klist
030260040601     c                   Kfld                    §lpaasm
030270040601     c                   Kfld                    §lplnpm
030280040601     c                   Kfld                    §lpNrsm
030290040601     c                   Kfld                    §lpNspm
030300130305     c     Kbolm5        Klist
030310130305     c                   Kfld                    §lpaasm
030320130305     c                   Kfld                    §lplnpm
030330130305     c                   Kfld                    §lpNrsm
030340130305     c                   Kfld                    §lpNspm
030350130305     c                   Kfld                    KAr5Trd
030360051123     c     Kanm2         Klist
030370120817     c***                Kfld                    bltfls
030380120817     c***                Kfld                    bltlna
030390120817     c***                Kfld                    bltnrs
030400120817     c***                Kfld                    bltnsc
030410120817     c                   Kfld                    artfls
030420120817     c                   Kfld                    artlna
030430120817     c                   Kfld                    artnrs
030440120817     c                   Kfld                    artnsc
030450051124     c     Kanm1         Klist
030460051125     C                   KFLD                    §LPAAS
030470051125     C                   KFLD                    §LPLNP
030480051125     C                   KFLD                    §LPNRS
030490051125     C                   KFLD                    §LPNSP
030500070601     c*
030510070601     c     kfnorf        klist
030520070601     c                   kfld                    ormpoe
030530070601     c                   kfld                    ormnsr
030540070601     c                   kfld                    ormnor
030550070601     c                   kfld                    ormnrv
030560070601     c                   kfld                    ormdfo
030570070601     c                   kfld                    ormofo
030580070601     c                   kfld                    ormfao
030590080221     c**!!!kfipdo        klist
030600080221     c**!!!              kfld                    orffgs
030610080221     c**!!!              kfld                    orfndc
030620080221     c**!!!              kfld                    orfpoe
030630080221     c**!!!              kfld                    orfnsr
030640080221     c**!!!              kfld                    orfnor
030650080221     c**!!!              kfld                    orfnrv
030660070613     c     kdpo          klist
030670070626     c                   kfld                    kdpodep
030680070626     c                   kfld                    kdpoord
030690071221
030700071221     c     Kbrv7         Klist
030710120817     c***                Kfld                    bltfls
030720120817     c***                Kfld                    comlna
030730120817     c***                Kfld                    bltnrs
030740120817     c***                Kfld                    bltnsc
030750120817     c                   Kfld                    artfls
030760120817     c                   Kfld                    comlna
030770120817     c                   Kfld                    artnrs
030780120817     c                   Kfld                    artnsc
030790140716     c     Kbrv7z        Klist
030800140716     c                   Kfld                    artfls
030810140716     c                   Kfld                    artlna
030820140716     c                   Kfld                    artnrs
030830140716     c                   Kfld                    artnsc
030840080313
030850080313     C     KTbe1         KLIST
030860080313     C                   KFLD                    k_tbecod
030870080313     C                   KFLD                    k_tbeke1
030880100323     C     Kfgi          KLIST
030890100323     C                   KFLD                    kksc
030900100323     C                   KFLD                    klnp
030910130304     C     Kblpar8       KLIST
030920130304     C                   KFLD                    ar8AAS
030930130304     C                   KFLD                    ar8LNP
030940130304     C                   KFLD                    ar8NRS
030950130304     C                   KFLD                    ar8NSP
030960130306     C     Kar8§pdf      KLIST
030970130306     C                   KFLD                    §clipdfp
030980130306     C                   KFLD                    §VATPPDFN
030990160303      * File FITGD32L
031000160125     c     K02TGD02      klist
031010160125     c                   kfld                    TGDtor
031020160125     c                   kfld                    TGDogg
031030160203     c     Ktgd01        klist
031040160203     c                   kfld                    idcant
031050160203     c                   kfld                    idcnut
031060160203     c                   kfld                    idcpdt
031070940819     C***
031080940819     C* DEFINIZIONE CAMPI
031090940819     C***
031100001031     C     *LIKE         DEFINE    BLPTFA        COMTFA
031110000508     C     *LIKE         DEFINE    DSBLD         WSBLD
031120000211     C     *LIKE         DEFINE    DSBLDE        WSBLDE
031130001002     C     *LIKE         DEFINE    DSBLD         WWBLD
031140001002     C     *LIKE         DEFINE    DSBLDE        WWBLDE
031150000211     C     *LIKE         DEFINE    DSBLD0        SAVBLD
031160000211     C     *LIKE         DEFINE    §LDDLA        WDLA
031170000208     C     *LIKE         DEFINE    SGNWHO        KWHO
031180000204     C     *LIKE         DEFINE    OG143         SAV143
031190000201     C     *LIKE         DEFINE    V7CNPR        WNPR
031200041116     C     *LIKE         DEFINE    V7CNPR        WNPRpre
031210051124     c     *LIKE         DEFINE    O14LAD        DESLAD
031220060920     c     *LIKE         DEFINE    O14red        DESred
031230080414     c**   *LIKE         DEFINE    §15cex        DEScaeex
031240080414     c**   *LIKE         DEFINE    §15cdp        DEScadpd
031250080414     c**   *LIKE         DEFINE    §15cfe        DEScafed
031260060613     C**** *LIKE         DEFINE    VIDNRD        COMNRD
031270000120     C     *LIKE         DEFINE    TBECOD        KTCOD
031280000120     C     *LIKE         DEFINE    TBELIN        KTLIN
031290000120     C     *LIKE         DEFINE    TBESIF        KTSIF
031300000120     C     *LIKE         DEFINE    TBEKE1        KTKE1
031310000120     C     *LIKE         DEFINE    TBEKE2        KTKE2
031320000120     C     *LIKE         DEFINE    BLPDSP        WDSP
031330020102     C     *LIKE         DEFINE    §CVFDC        COMFDC
031340011113     C     *LIKE         DEFINE    §CVDEC        COMDEC
031350991028     C     *LIKE         DEFINE    O17FDC        WFDC1
031360991015     C     *LIKE         DEFINE    O17FDC        WFDC2
031370991014     C     *LIKE         DEFINE    VIDPOR        MEMPOR
031380991012     C     *LIKE         DEFINE    VI2VA1        VA2VA1
031390991011     C     *LIKE         DEFINE    AR6DIV        WDIV1
031400991011     C     *LIKE         DEFINE    AR6DIV        WDIV2
031410990701     C     *LIKE         DEFINE    VIDNFT        SAVNFT
031420990701     C     *LIKE         DEFINE    VIDIMV        SAVIMV
031430060208     C     *LIKE         DEFINE    VIDIMV        SAVIMVO
031440990630     C     *LIKE         DEFINE    O95CZC        WCZC
031450980211     C     *LIKE         DEFINE    O95CZO        WCZO
031460980211     C     *LIKE         DEFINE    VIDLNP        BLCLNP
031470971216     C     *LIKE         DEFINE    BLPNCA        STANCA
031480971215     C     *LIKE         DEFINE    V6CAWB        SAVAWB
031490050228     C     *LIKE         DEFINE    V7CNPR        SAVNPR
031500061003     C***  *LIKE         DEFINE    §b4fnp        SAVfnp
031510060620     C     *LIKE         DEFINE    §b4krt        SAVkrt
031520060619     C***  *LIKE         DEFINE    vidrmn        savrmn
031530941104     C*  MI IMPOSTO IL FLAG I/E DELLE TARIFFE DA CARICARE
031540941104     C     *LIKE         DEFINE    TAMFIE        WFIE
031550941107     C* FLAG SALVATO DA MANUTENZIONE BOLLE
031560941117     C     *LIKE         DEFINE    TAMFIE        SAVFIE
031570020122     C     *LIKE         DEFINE    BLPNZD        NZDINI
031580061124     C     *LIKE         DEFINE    BLPNZD        savnzd
031590941107     C* =S CLIENTE CON TARIFFE VALIDE
031600050921     C     *LIKE         DEFINE    olv59tks      WTKS
031610980701     C* CAMPI DELLA PARAM PER RICERCA ALFABETICA
031620940928     C     *LIKE         DEFINE    ACOKCC        PAXCCC
031630940928     C     *LIKE         DEFINE    ACORAG        PAXDMT
031640940928     C     *LIKE         DEFINE    ACOKCC        CCC
031650940928     C* SALVO IL MITTENTE PER IL QUALE HO CARICATO LE TARIFFE: SE MODIF
031660940928     C*  RICARICO LE TARIFFE
031670940928     C     *LIKE         DEFINE    BLPKSC        SAVCCM
031680940928     C* SE MODIFICATO IL CODICE TARIFFA EMETTO I CAMPI PRESI DA TARIFFA
031690940928     C*  IN "RI"
031700940928     C     *LIKE         DEFINE    VIDCTR        SAVCTR
031710950504     C     *LIKE         DEFINE    VIDCTM        SAVCTM
031720941219     C     *LIKE         DEFINE    VIDVCA        VARVCA
031730941219     C     *LIKE         DEFINE    VIDVAS        VARVAS
031740941219     C     *LIKE         DEFINE    VIDVAD        VARVAD
031750970702     C     *LIKE         DEFINE    VIDLOD        VARLOD
031760970704     C     *LIKE         DEFINE    VIDLOM        VARLOM
031770940928     C*
031780940928     C     *LIKE         DEFINE    §15VLT        MITVLT
031790940922     C     *LIKE         DEFINE    §15VLT        DESVLT
031800940928     C     *LIKE         DEFINE    §15EFT        DESEFT
031810000321     C     *LIKE         DEFINE    §15EFD        DESEFD
031820020130     C     *LIKE         DEFINE    §15EFD        DESEFf
031830020131     C     *LIKE         DEFINE    §15ffn        DESffn
031840971215     C     *LIKE         DEFINE    §15COD        DESCOD
031850940922     C     *LIKE         DEFINE    BLDFST        SAVFST
031860950717     C     *LIKE         DEFINE    BLDNCD        WNCD
031870950321     C     *LIKE         DEFINE    BLPCCM        SAVMIT
031880000426     C     *LIKE         DEFINE    VARNCL        SA2NCL
031890000426     C     *LIKE         DEFINE    VARCDP        SA2CDP
031900940819     C     *LIKE         DEFINE    TBLKUT        §KUT
031910940819     C     *LIKE         DEFINE    TBLCOD        §COD
031920940819     C     *LIKE         DEFINE    TBLKEY        §KEY
031930940819     C     *LIKE         DEFINE    VIDINM        VI2INM
031940940819     C     *LIKE         DEFINE    VIDCAM        VI2CAM
031950940819     C     *LIKE         DEFINE    VIDPIM        VI2PIM
031960120817     C     *LIKE         DEFINE    ARTNSC        WNSC
031970940926     C     *LIKE         DEFINE    BLPAAS        WAAS
031980940926     C     *LIKE         DEFINE    BLPFIN        WFIN
031990940916     C     *LIKE         DEFINE    BLPFLS        WFLS
032000060216     C     *LIKE         DEFINE    ar4TRC        WTRC
032010060215     C     *LIKE         DEFINE    ar4TRC        kar4trc
032020060215     C     *LIKE         DEFINE    ar4n14        kar4n14
032030991006     C     *LIKE         DEFINE    AR6SV1        WSV1
032040991027     C     *LIKE         DEFINE    AR6VA1        WVA1
032050991027     C     *LIKE         DEFINE    AR6SV1        WSV2
032060991027     C     *LIKE         DEFINE    AR6VA1        WVA2
032070991027     C     *LIKE         DEFINE    AR6SV1        WSV3
032080991027     C     *LIKE         DEFINE    AR6VA1        WVA3
032090991027     C     *LIKE         DEFINE    AR6SV1        WSVN
032100991027     C     *LIKE         DEFINE    AR6VA1        WVAN
032110941021     C     *LIKE         DEFINE    §CCCEI        WEV1
032120950123     C     *LIKE         DEFINE    VIDRSD        SAVRSD
032130070404     C     *LIKE         DEFINE    VIDind        SAVind
032140070404     C     *LIKE         DEFINE    VIDprd        SAVprd
032150070404     C     *LIKE         DEFINE    VIDlod        SAVlod
032160010302     C     *LIKE         DEFINE    §LDCDP        SAVCDP
032170940930     C* CONTROLLO SE MODIFICATO CAP MITT E DESTIN PER RICONTROLLARE
032180940930     C     *LIKE         DEFINE    BLPCAD        VARCAD
032190940930     C     *LIKE         DEFINE    BLPCAM        VARCAM
032200940930     C     *LIKE         DEFINE    BLPCAM        VARCMO
032210950102     C     *LIKE         DEFINE    BLPQFT        VARQFT
032220940922     C* SALVO DA TARIFFA PER VEDERE COSA MEMORIZZARE SU COLLO
032230940922     C     *LIKE         DEFINE    BLPTSP        COMTSP
032240940922     C* SALVATO IN MANUTENZIONE PER VEDERE SE RISTAMPARE SEGNACOLLO
032250100209     C     *LIKE         DEFINE    BLPTSP        SA2TSP
032260100209     C     *LIKE         DEFINE    BLPTSP        SAVTSP
032270940819     C     *LIKE         DEFINE    BLPCAD        SAVCAD
032280050421     C     *LIKE         DEFINE    vidbva        SAVbva
032290940922     C     *LIKE         DEFINE    BLPRMA        SAVRMA
032300940819     C     *LIKE         DEFINE    BLPFTM        SAVFTM
032310961111     C     *LIKE         DEFINE    BLPFBR        SAVFBR
032320961122     C     *LIKE         DEFINE    BLPCBO        SAVCBO
032330970404     C     *LIKE         DEFINE    VIDBAM        SAVBAM
032340940922     C* CAMPI USATI NELLE ROUTINE DI CONTROLLO, UNICHE PER
032350960319     C*  VIDEATA PERSONALIZZAZIONE E 1 VIDEATA
032360960319     C     *LIKE         DEFINE    VIDGC1        WGC1
032370960319     C     *LIKE         DEFINE    VIDGC2        WGC2
032380960319     C     *LIKE         DEFINE    VIDTSP        WTSP
032390940928     C     *LIKE         DEFINE    VIDNZM        WNAR
032400941103     C     *LIKE         DEFINE    VIDCMO        WCMO
032410941103     C     *LIKE         DEFINE    VIDRMO        WRMO
032420940824     C     *LIKE         DEFINE    VIDLNA        WLNA
032430940824     C     *LIKE         DEFINE    VIDPDR        WPDR
032440940824     C     *LIKE         DEFINE    VIDCBO        WCBO
032450940824     C     *LIKE         DEFINE    VIDLNP        WLNP
032460940825     C     *LIKE         DEFINE    VIDFTM        WFTM
032470940825     C     *LIKE         DEFINE    VIDCCM        WCCM
032480940928     C     *LIKE         DEFINE    VIDCCM        WCCMS
032490940921     C     *LIKE         DEFINE    VIDFLC        WFLC
032500940922     C     *LIKE         DEFINE    COD           WCOD
032510940922     C     *LIKE         DEFINE    VIDVAS        WVLT
032520940928     C     *LIKE         DEFINE    VIDCTM        WCTM
032530940923     C     *LIKE         DEFINE    VIDIMV        COMIMV
032540940921     C     *LIKE         DEFINE    VIDCCM        SAVFLC
032550940928     C     *LIKE         DEFINE    VIDPDR        SAVPDR
032560990915     C     *LIKE         DEFINE    VIDPDR        SAVPD4
032570940819     C     *LIKE         DEFINE    VIDNCL        SAVNCL
032580940819     C     *LIKE         DEFINE    VIDFFD        VARFFD
032590010214     C     *LIKE         DEFINE    VIDFFD        COMFFD
032600011211     C     *LIKE         DEFINE    VIDIAS        VARIAS
032610011211     C     *LIKE         DEFINE    VIDIAS        WARIAS
032620011212     C     *LIKE         DEFINE    VIDCAS        WARCAS
032630011212     C     *LIKE         DEFINE    VIDVMD        WARVMD
032640940819     C     *LIKE         DEFINE    VIDVOL        VARVOL
032650980402     C     *LIKE         DEFINE    VIDVOL        SAVVOL
032660940819     C     *LIKE         DEFINE    VIDVOL        VA2VOL
032670940819     C     *LIKE         DEFINE    VIDPKG        VARPKG
032680980402     C     *LIKE         DEFINE    VIDPKG        SAVPKG
032690020531     C     *LIKE         DEFINE    VIDtc1        VARtc1
032700020531     C     *LIKE         DEFINE    VIDtc2        VARtc2
032710060110     C     *LIKE         DEFINE    VIDrsd        D_VARrsd
032720060110     C     *LIKE         DEFINE    VIDind        D_VARind
032730060110     C     *LIKE         DEFINE    VIDlod        D_VARlod
032740060110     C     *LIKE         DEFINE    VIDprd        D_VARprd
032750060110     C     *LIKE         DEFINE    VIDnzd        D_VARnzd
032760940819     C     *LIKE         DEFINE    VIDZNC        VARZNC
032770940819     C     *LIKE         DEFINE    VIDZNC        SAVZNC
032780940819     C     *LIKE         DEFINE    VIDPRD        VARPRD
032790940819     C     *LIKE         DEFINE    VIDDSP        SAVDSP
032800940819     C     *LIKE         DEFINE    VIDFAP        COMFAP
032810940919     C     *LIKE         DEFINE    VIDFIN        COMFIN
032820940819     C     *LIKE         DEFINE    VIDDRT        SAVDRT
032830940928     C     *LIKE         DEFINE    VIDDCR        WDCR
032840940913     C     *LIKE         DEFINE    VIDHCR        WHCR
032850940913     C     *LIKE         DEFINE    VIDMCR        WMCR
032860940913     C     *LIKE         DEFINE    VIDTCR        WTCR
032870941011     C     *LIKE         DEFINE    VIDLNA        SAVLNA
032880941011     C     *LIKE         DEFINE    BLPLNP        SAVLNP
032890940824     C     *LIKE         DEFINE    BLPLNA        COMLNA
032900940824     C     *LIKE         DEFINE    BLPLNA        CO2LNA
032910940819     C     *LIKE         DEFINE    BLPCTM        COMCTM
032920940819     C     *LIKE         DEFINE    BLPDRT        COMDRT
032930991006     C     *LIKE         DEFINE    AR6DFT        COMDFT
032940060208     C     *LIKE         DEFINE    AR6DFT        dftar6
032950940819     C     *LIKE         DEFINE    FTTPDR        W01PDR
032960940819     C     *LIKE         DEFINE    FTTTSR        W01TSR
032970940819     C     *LIKE         DEFINE    FTTFVL        W01FVL
032980941005     C* CAMPI DI CONFRONTO PER RICARICARE IL CODICE TARIFFA MITTENTE
032990941005     C     *LIKE         DEFINE    VIDTSP        VARTSP
033000960404     C     *LIKE         DEFINE    BRVFLE        KFLE
033010960404     C     *LIKE         DEFINE    BRVNPG        KNPG
033020960805     C* CAMPI che non devono essere modificati
033030960805     C     *LIKE         DEFINE    VIDNCD        WNSNCD
033040960805     C     *LIKE         DEFINE    VIDNCA        WNSNCA
033050960927     C*
033060980318     C     *LIKE         DEFINE    BLPCAD        WCAD
033070980320     C     *LIKE         DEFINE    BLPCAD        WRKCAD
033080980320     C     *LIKE         DEFINE    BLPNCA        SAVNCA
033090980320     C     *LIKE         DEFINE    BLPNCD        SAVNCD
033100980403     C     *LIKE         DEFINE    BLPNCD        SV1NCD
033110000830     C     *LIKE         DEFINE    V8CNBR        WNBR
033120000908     C     *LIKE         DEFINE    IZ1CH1        CHIDAL
033130000908     C     *LIKE         DEFINE    IZ1CH2        CHIAL
033140000911     C     *LIKE         DEFINE    V8CNBR        NR8
033150000911     C     *LIKE         DEFINE    V8ZMSG        W08MSG
033160000918     C     *LIKE         DEFINE    NR8           SAVNR8
033170001205     C     *LIKE         DEFINE    BLPTC1        SAVTC1
033180001205     C     *LIKE         DEFINE    BLPTC2        SAVTC2
033190140122     C***  *LIKE         DEFINE    BLPTC1        WTCP
033200140122     C***  *LIKE         DEFINE    BLPTC1        WSVTCP
033210010215     C* CAMPI PER O.R.M.
033220010215     C     *LIKE         DEFINE    VIDPDR        PREPDR
033230010215     C     *LIKE         DEFINE    VIDPDR        WDPDR
033240010215     C     *LIKE         DEFINE    VIDDRT        PREDRT
033250010215     C     *LIKE         DEFINE    VIDFPP        PREFPP
033260010215     C     *LIKE         DEFINE    ORMKSC        PRECCM
033270010215     C     *LIKE         DEFINE    VIDCTR        PRECTR
033280010215     C     *LIKE         DEFINE    VIDFFD        PREFFD
033290010305     C     *LIKE         DEFINE    V1CNCL        PRENCL
033300010305     C     *LIKE         DEFINE    VIDPKG        PREPKG
033310010215     C     *LIKE         DEFINE    VIDORM        W01ORM
033320010215     C     *LIKE         DEFINE    V0CLNP        WOLNP
033330010215     C     *LIKE         DEFINE    ORMKSC        WOCCM
033340010219     C     *LIKE         DEFINE    WLNP          WLNPO
033350010220     C     *LIKE         DEFINE    ORMFAO        PREFAO
033360010313     C     *LIKE         DEFINE    BLDNCD        WNCOL
033370010313     C     *LIKE         DEFINE    BLDNCD        WNCOA
033380011108     C*
033390011212     C     *LIKE         DEFINE    §CVDEC        DECCN
033400011212     C     *LIKE         DEFINE    O21FCA        FCASAV
033410011212     C     *LIKE         DEFINE    §GEIMF        IMFGEI
033420011205     C     *LIKE         DEFINE    §ORMFD        SORMFD
033430011212     C     *LIKE         DEFINE    IEDNUM        WNUMED
033440020211     C     *LIKE         DEFINE    tamksc        tarksc
033450020215     C     *LIKE         DEFINE    §ogntw        savntw
033460050114     C     *LIKE         DEFINE    §lpxco        wxco
033470940819     C***
033480940819     C* CAMPI CHE INIZIALIZZO SOLO ALL'ENTRATA DEL PROGRAMMA E BASTA
033490940819     C***
033500940819     C                   CLEAR                   VIDSOP
033510940819     C                   CLEAR                   VIDDRT
033520000104     C                   CLEAR                   WBDSP
033530990603     C* PER TIPO CHIAMATA PREPAGATO, NON IMPOSTO IL PADORNCINO
033540010301     C* NON LO IMPOSTO NEMMENO PER CHIAMATA DA CONFERMA ORM PREPAGATI
033550010301     C* DI ALTRO P.O.
033560990603     C     PARTCH        IFNE      'P'
033570010301     C     §LPFPR        ANDNE     'O'
033580941021     C                   MOVEL     '?   '        VIDPDR
033590990628     C                   MOVEL     'P'           VIDFPP
033600990603     C                   ENDIF
033610940819     C                   CLEAR                   VIDNRT
033620940819     C                   CLEAR                   VIDLNP
033630961016     C                   CLEAR                   PAXFLR
033640010212     C                   CLEAR                   VIDPOE
033650010212     C                   CLEAR                   VIDNOR
033660010212     C                   CLEAR                   VIDNRV
033670010212     C                   CLEAR                   W01ORM
033680941107     C**
033690930628     C                   Z-ADD     1             CODUT
033700930628     C                   CALL      'X§PARUT'
033710930628     C                   PARM                    UT§DSE
033720940819     C                   MOVEL     RAGUT         VIDDSA
033730930628     C                   MOVEL     REC80         CNCR80
033740930628     C*--- RICERCA CAPOCONTI
033750930628     C                   DO        50            X                 2 0
033760930628     C                   MOVE      TCU(X)        TCUDS
033770930628     C     F56           CABNE     'CG'          END1
033780930628     C     F4            COMP      '1'                                    21
033790930628     C     F4            COMP      '2'                                    22
033800930628     C     F4            COMP      '3'                                    23
033810930628     C     F4            COMP      '6'                                    27
033820930628     C** 1 CLIENTI   21
033830930628     C** 2 FORNITORI 22
033840930628     C** 3 AGENTI    23
033850930628     C     F3            COMP      '0'                                242425
033860930628     C     F3            COMP      'I'                                    26
033870930628     C** 0 ITALIA   25
033880930628     C** 1 ESTERO   24
033890930628     ** I CAPO CONTO IVA
033900930628     C   21
033910930628     CAN 24              Z-ADD     KCU(X)        KCE               4 0
033920930628     C   21
033930930628     CAN 25              Z-ADD     KCU(X)        KCI               4 0
033940930628     C   22
033950930628     CAN 24              Z-ADD     KCU(X)        KFE               4 0
033960930628     C   22
033970930628     CAN 25              Z-ADD     KCU(X)        KFI               4 0
033980930628     C   23
033990930628     CAN 24              Z-ADD     KCU(X)        KAE               4 0
034000930628     C   23
034010930628     CAN 25              Z-ADD     KCU(X)        KAI               4 0
034020930628     C   26              Z-ADD     KCU(X)        KIVA              4 0
034030930628     C   27              Z-ADD     KCU(X)        KBNA              4 0
034040930628     C     END1          TAG
034050930628     C                   END
034060940614     C                   SETOFF                                       212223
034070940614     C                   SETOFF                                       242526
034080940614     C                   SETOFF                                       27
034090991214     C                   CLEAR                   DSBLP0
034100950920     C***
034110950920     C* CARICO DATI VARIABILI PARTENZE
034120950920     C***
034130950920     C                   MOVEL     '3I'          COD
034140950920     C                   MOVEL     '1       '    KEY
034150950920     C                   EXSR      CTABEL
034160950920     C  N30              MOVEL     TBLUNI        DS3I
034170950920     C   30              CLEAR                   DS3I
034180991213     C***
034190991213     C* CARICO TABELLA DPD
034200991213     C***
034210991213     C                   MOVEL     '3I'          COD
034220991213     C                   MOVEL(P)  'DPD'         KEY
034230991213     C*
034240991213     C                   EXSR      CTABEL
034250991213     C  N30              MOVEL     TBLUNI        DS3IDP
034260991213     C   30              CLEAR                   DS3IDP
034270000509     C***
034280000509     C* CARICO TABELLA POSTE
034290000509     C***
034300000509     C                   MOVEL     '3I'          COD
034310000509     C                   MOVEL(P)  'POSTE'       KEY
034320000509     C*
034330000509     C                   EXSR      CTABEL
034340000509     C  N30              MOVEL     TBLUNI        DS3IPT
034350000509     C   30              CLEAR                   DS3IPT
034360971211     C***
034370971211     C* CARICO CODICI CLIENTI SDI PER I QUALI INSERISCO OBBLIGATORIAM
034380971211     C*  NUMERO AWB CON CONTROLLO CHECK DIGIT
034390971211     C***
034400971211     C                   MOVEL     '3I'          COD
034410971211     C                   MOVEL     'E       '    KEY
034420971211     C                   EXSR      CTABEL
034430971211     C  N30              MOVEA     TBLUNI        KSS
034440971212     C* 2 CIFRE INIZIALI FISSE PER NUMERO AWB
034450971212     C  N30              MOVE      TBLUNI        §3IFAW            2 0
034460971211     C   30              CLEAR                   KSS
034470971212     C   30              CLEAR                   §3IFAW
034480950920     C**
034490930401     C* CODICE PER ASSICURAZIONE PER CONTO
034500950920     C**
034510990818     C                   MOVEL     'C '          FTC
034520041217     c**
034530041217      * Aggancio tabella "VPO" per reperimento giorni per calcolo
034540041217      * max data consegna richiesta
034550041217     C                   CLEAR                   dsbs02
034560041217     c                   clear                   dvpo
034570041217     C                   MOVEL     'C'           T02MOD
034580041217     C                   MOVEL     KNSIF         T02SIF
034590041217     C                   MOVEL     'VPO'         T02COD
034600041217     c                   movel(P)  'VPO'         t02ke1
034610041217     C                   CALL      'TIBS02R'
034620041217     C                   PARM                    KPJBA
034630041217     C                   PARM                    dsbs02
034640041217    2C                   IF        T02ERR = *BLANKS
034650041217     C                   MOVEL     T02uni        dvpo
034660041217    2C                   ENDIF
034670121017      * Aggancio tabella "VPODECO"
034680060207     C                   CLEAR                   dsbs02
034690060207     c                   clear                   dvpodeco
034700060207     C                   MOVEL     'C'           T02MOD
034710060207     C                   MOVEL     KNSIF         T02SIF
034720060207     C                   MOVEL     'VPO'         T02COD
034730060207     c                   movel(P)  'DECO'        t02ke1
034740060207     C                   CALL      'TIBS02R'
034750060207     C                   PARM                    KPJBA
034760060207     C                   PARM                    dsbs02
034770060207    2C                   IF        T02ERR = *BLANKS
034780060207     C                   MOVEL     T02uni        dvpodeco
034790060207    2C                   ENDIF
034800150414      * Aggancio tabella "VPO" "EXPO"
034810151119     C*                  CLEAR                   dsbs02
034820151119     c*                  clear                   fil_expo
034830151119     C*                  MOVEL     'C'           T02MOD
034840151119     C*                  MOVEL     KNSIF         T02SIF
034850151119     C*                  MOVEL     'VPO'         T02COD
034860151119     c*                  movel(P)  'EXPO'        t02ke1
034870151119     C*                  CALL      'TIBS02R'
034880151119     C*                  PARM                    KPJBA
034890151119     C*                  PARM                    dsbs02
034900151119    2C*                  IF        T02ERR = *BLANKS
034910151119     C*                  MOVEa     T02uni        fil_expo
034920151119    2C*                  ENDIF
034930150304      * Aggancio tabella "VPO" "TELLUS"
034940150304     C                   CLEAR                   dsbs02
034950150304     c                   clear                   dvpotellus
034960150304     C                   MOVEL     'C'           T02MOD
034970150304     C                   MOVEL     KNSIF         T02SIF
034980150304     C                   MOVEL     'VPO'         T02COD
034990150304     c                   movel(P)  'TELLUS'      t02ke1
035000150304     C                   CALL      'TIBS02R'
035010150304     C                   PARM                    KPJBA
035020150304     C                   PARM                    dsbs02
035030150304    2C                   IF        T02ERR = *BLANKS
035040150304     C                   MOVEL     T02uni        dvpotellus
035050150304    2C                   ENDIF
035060121017      * Aggancio tabella "DGD"
035070121017     C                   CLEAR                   dsbs02
035080160321     c                   clear                   ddgd
035090121017     C                   MOVEL     'C'           T02MOD
035100121017     C                   MOVEL     KNSIF         T02SIF
035110121017     C                   MOVEL     'DGD'         T02COD
035120121017     c                   movel(P)  '1'           t02ke1
035130121017     C                   CALL      'TIBS02R'
035140121017     C                   PARM                    KPJBA
035150121017     C                   PARM                    dsbs02
035160121017    2C                   IF        T02ERR = *BLANKS
035170121017     C                   MOVEL     T02uni        ddgd
035180121017    2C                   ENDIF
035190160323      * Aggancio tabella "NSD"
035200160323     C                   CLEAR                   dsbs02
035210160323     c                   clear                   dnsd
035220160323     C                   MOVEL     'C'           T02MOD
035230160323     C                   MOVEL     KNSIF         T02SIF
035240160323     C                   MOVEL     'NSD'         T02COD
035250160323     c                   movel(P)  '1'           t02ke1
035260160323     C                   CALL      'TIBS02R'
035270160323     C                   PARM                    KPJBA
035280160323     C                   PARM                    dsbs02
035290160323    2C                   IF        T02ERR = *BLANKS
035300160323     C                   MOVEL     T02uni        dnsd
035310160323    2C                   ENDIF
035320140212      * Aggancio tabella "CSP"--> Caratteri Speciali per eliminazione
035330140212      *                           caratteri di punteggiatura da loc.dest.
035340160112     c*  Caratteri da togliere validi per TUTTO il campo  tab "CSP" "LOC_ALL"
035350140212     C                   CLEAR                   dsbs02
035360140212     C                   CLEAR                   charnook
035370140212     C                   MOVEL     'C'           T02MOD
035380140212     C                   MOVEL     KNSIF         T02SIF
035390140212     C                   MOVEL     'CSP'         T02COD
035400160112     c****               movel(P)  'LOC'         t02ke1
035410160112     c                   movel(P)  'LOC_ALL'     t02ke1
035420140212     C                   CALL      'TIBS02R'
035430140212     C                   PARM                    KPJBA
035440140212     C                   PARM                    dsbs02
035450140212    2C                   IF        T02ERR = *BLANKS
035460140212     C                   MOVEL     T02uni        charnook
035470140212    2C                   ENDIF
035480160112
035490160112     c*  Caratteri da togliere validi per la FINE del campo  tab "CSP" "LOC_F"
035500160112     C                   CLEAR                   dsbs02
035510160112     C                   CLEAR                   charnookf
035520160112     C                   MOVEL     'C'           T02MOD
035530160112     C                   MOVEL     KNSIF         T02SIF
035540160112     C                   MOVEL     'CSP'         T02COD
035550160112     c                   movel(P)  'LOC_F'       t02ke1
035560160112     C                   CALL      'TIBS02R'
035570160112     C                   PARM                    KPJBA
035580160112     C                   PARM                    dsbs02
035590160112    2C                   IF        T02ERR = *BLANKS
035600160112     C                   MOVEL     T02uni        charnookf
035610160112    2C                   ENDIF
035620160112     c*  Caratteri da togliere validi per l'INIZIO del campo  tab "CSP" "LOC_I"
035630160112     C                   CLEAR                   dsbs02
035640160112     C                   CLEAR                   charnooki
035650160112     C                   MOVEL     'C'           T02MOD
035660160112     C                   MOVEL     KNSIF         T02SIF
035670160112     C                   MOVEL     'CSP'         T02COD
035680160112     c                   movel(P)  'LOC_I'       t02ke1
035690160112     C                   CALL      'TIBS02R'
035700160112     C                   PARM                    KPJBA
035710160112     C                   PARM                    dsbs02
035720160112    2C                   IF        T02ERR = *BLANKS
035730160112     C                   MOVEL     T02uni        charnooki
035740160112    2C                   ENDIF
035750140212     c* imposto stringa contenente caratteri speciali per il controllo
035760140212     c* della parte finale (uguale alla charnook maa senza l'eventuale '.')
035770160112     c****               eval      charnookf=%xlate('.':' ':charnook)
035780141202      * Aggancio tabella "CSP"--> Caratteri ammessi per PIN CODE
035790141202     C                   CLEAR                   dsbs02
035800141202     C                   CLEAR                   charPCok
035810141202     C                   MOVEL     'C'           T02MOD
035820141202     C                   MOVEL     KNSIF         T02SIF
035830141202     C                   MOVEL     'CSP'         T02COD
035840141202     c                   movel(P)  'PINCODE'     t02ke1
035850141202     C                   CALL      'TIBS02R'
035860141202     C                   PARM                    KPJBA
035870141202     C                   PARM                    dsbs02
035880141202    2C                   IF        T02ERR = *BLANKS
035890141202     C                   MOVEL     T02uni        charPCok
035900141202    2C                   ENDIF
035910140612
035920140612     c* ricerca P.O. abilitati da tabella VPO per step di test
035930160304     c***                clear                   trulvpods
035940160304     c****               eval      ivpoke1 = 'DECOFIDIR'
035950160304     c***                call      'TRULVPOR'
035960160304     c***                parm                    trulvpods
035970140212     c
035980160310     c* ricerca P.O. abilitati da tabella VPO per progetto
035990160310     c* forzatura instradamento da eex a dpd
036000160310     c                   clear                   trulvpods
036010160310     c                   eval      ivpoke1 = 'DECOFIDPD'
036020160310     c                   call      'TRULVPOR'
036030160310     c                   parm                    trulvpods
036040111130     c
036050101022     C***
036060101022     C* CARICO TABELLA SIMBOLI CALENDARIO FESTIVI
036070101022     C***
036080101022     C                   MOVEL     '1Y'          COD
036090101022     C                   Z-ADD     1             C
036100101022     C     KTAB3         SETLL     TABEL
036110101022     C                   EXSR      RTABEL
036120101022     C*
036130101022     C     *IN30         DOWEQ     '0'
036140101022     C     TBLFLG        IFEQ      ' '
036150101022     C                   MOVEL     TBLUNI        DS1Y
036160101022     C     §1Yfec        IFEQ      'S'
036170101022     C                   MOVEL     TBLKEY        s1Y(C)
036180101022     C                   ADD       1             C
036190101022     C                   ENDIF
036200101022     C                   ENDIF
036210101022     C*
036220101022     C                   EXSR      RTABEL
036230101022     C                   ENDDO
036240930401     C*
036250950920     C* DATA BOLLETTAZIONE:  TRA UDATE E DATA GIORNO + §3IGGS
036260950920     C*  SOLO PER LE SPEDIZ.DI RECUPERO E' TRA DATA G. - 3  E  + §3IGGS
036270940920     C                   TIME                    W0140            14 0
036280940920     C* UDATE IN GGMMAAAA
036290940920     C                   MOVE      W0140         WDTGIO            8 0
036300990630     C                   MOVE      WDTGIO        DATAAS
036310940819     C*
036320940920     C* UDATE IN AAAAMMGG
036330940920     C                   Z-ADD     WDTGIO        G02DAT
036340910208     C                   MOVEL     *BLANK        G02ERR
036350940819     C                   CALL      'XSRDA8'
036360910208     C                   PARM                    WLBDAT
036370940819     C                   MOVEL     G02INV        DATEU             8 0
036380030409
036390030415      * Calcolo oggi + 5 gg.
036400051215     c****               Move      Dateu         Dataiso
036410051215     c****               Adddur    §vpodcg:*d    Dataiso
036420051215     c****               Move      Dataiso       woggi5
036430051215     c*
036440051215     c                   Move      Dateu         Dataiso
036450051215     c                   Adddur    §vpodcgm1:*d  Dataiso
036460051215     c                   Move      Dataiso       woggidcgm1
036470051215     c*
036480051215     c                   Move      Dateu         Dataiso
036490051215     c                   Adddur    §vpodcgm2:*d  Dataiso
036500051215     c                   Move      Dataiso       woggidcgm2
036510030416
036520051214      **Calcolo oggi + 1 mm.
036530051214     c**                 Move      Dateu         Dataiso
036540051214     c**                 Adddur    1:*m          Dataiso
036550051214     c**                 Move      Dataiso       woggi1m
036560030409
036570950921     C* SE NON FOSSE PERMESSO BOLLETTARE IN SOSPENSIONE
036580950921     C*  SI PUO' BOLLETTARE SOLO FINO A OGGI
036590950921     C                   Z-ADD     G02INV        DATAPA            8 0
036600950921     C                   MOVEL     G02DAT        DATAPG            8
036610950919     C* SOTTRAGGO  3
036620950919     C     G02TGI        SUB       3             GIOTGI
036630950919     C*
036640950919     C                   CALL      'XSRGI8'
036650950919     C                   PARM                    WGIDAT
036660950919     C*
036670950919     C                   Z-ADD     GIOINV        DATAM             8 0
036680080109     C* SOTTRAGGO  giorni per ottenere data minima per data ritiro
036690080109     c                   clear                   TRUL52ds
036700080109     c                   eval      d52gio=§3iggb
036710080109     c                   eval      d52sgn='-'
036720080109     c                   z-add     dateu         D52din
036730080109     c                   call      'TRUL52R'
036740080109     c                   parm                    TRUL52ds
036750080109     C*
036760080109     C                   Z-ADD     d52dfi        DATAmin           8 0
036770080603     c* sottraggo 40 gg. per otternere data minima per data ritiro per
036780080603     c* prepagati
036790080603     c                   move      dateu         dataiso
036800080603     c                   subdur    40:*d         dataiso
036810080603     c                   move      dataiso       datam40
036820080603     c
036830061220     c                   z-add     g02tgi        salvatgi
036840991214     C*
036850991214     C* SOTTRAGGO  I GIORNI PER LA DATA CONTROLLO OPPIO PARCEL DPD
036860991214     C     G02TGI        SUB       §3IGGU        GIOTGI
036870991214     C*
036880991214     C                   CALL      'XSRGI8'
036890991214     C                   PARM                    WGIDAT
036900991214     C*
036910991214     C                   Z-ADD     GIOINV        DPDDSP            8 0
036920130305     c* sottraggo i giorni per controllo pdf cliente doppio
036930130305     c                   move      dateu         dataiso
036940130305     c                   subdur    §vpogpdf:*d   dataiso
036950130305     c                   move      dataiso       datapdf
036960950919     C*
036970950919     C* ADDIZIONO 1 FINTANTO CHE NON TROVO IL PRIMO GIORNO LAVORATIVO
036980990602     C* PER LA BOLLETTAZIONE IN SOSPENSIONE, DIVERSI SONO I GG
036990990602     C* PER I PREPAGATI
037000950920     C                   Z-ADD     1             X
037010950920    1C     X             DOWLE     §3IGGS
037020990602     C     PARTCH        ANDNE     'P'
037030010301     C     §LPFPR        ANDNE     'O'
037040990602    1C     X             ORLE      §3IGGP
037050990602     C     PARTCH        ANDEQ     'P'
037060010301    1C     X             ORLE      §3IGGP
037070010301     C     §LPFPR        ANDEQ     'O'
037080950920     C*
037090950921     C                   MOVEL     'F'           WFEST             1
037100950920     C*
037110950920    2C     WFEST         DOWNE     ' '
037120950919     C     G02TGI        ADD       1             GIOTGI
037130950919     C                   ADD       1             G02TGI
037140940819     C                   CALL      'XSRGI8'
037150910208     C                   PARM                    WGIDAT
037160910221     C*
037170950920     C                   Z-ADD     GIOINV        DATAPA            8 0
037180950920     C                   MOVEL     GIODAT        DATAPG            8
037190950920     C*
037200950920     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
037210950921     C                   Z-ADD     GIOINV        WDATA
037220950920     C                   CLEAR                   W0030
037230120302     C* CHAIN SUL CALENDARIO BRT
037240950920     C     KCLN          CHAIN     AZCLN01L                           30
037250950920     C   30              CLEAR                   CLNPOM
037260950921     C                   MOVEA     CLNPOM        K31
037270950920     C                   MOVEL     K31(WGG)      WFEST
037280101022     c* Se non è festivo pulisco il campo WFEST
037290101022     c     wfest         lookup    S1Y                                    30
037300101022     c                   if        not *in30
037310101022     c                   clear                   wfest
037320101022     c                   endif
037330101022     c
037340950920    2C                   ENDDO
037350950920     C*
037360950920     C                   ADD       1             X
037370990602    1C                   ENDDO
037380061220     c
037390061220     c* trovo primo giorno lavorativo minore di oggi per bollettare in
037400061220     c*  data del giorno precedente se dalle 00:00 alle ore 06:00
037410061220     C                   TIME                    orapgm            6 0
037420061221    0c                   if        orapgm>=000000 and orapgm<§vpooradsp
037430061220     C                   MOVEL     'F'           WFEST             1
037440061220     c                   z-add     salvatgi      giotgi
037450061220     C*
037460061220    1C     WFEST         DOWNE     ' '
037470061221     C     salvatgi      sub       1             GIOTGI
037480061221     C                   sub       1             salvatgi
037490061220     C                   CALL      'XSRGI8'
037500061220     C                   PARM                    WGIDAT
037510061220     C*
037520061220     C                   Z-ADD     GIOINV        DATAmeno1         8 0
037530061221     C                   MOVEL     GIODAT        DATgmeno1         8 0
037540061220     C*
037550061220     C* IMPOSTO ANNO E MESE DELLA DATA TROVATA
037560061220     C                   Z-ADD     GIOINV        WDATA
037570061220     C                   CLEAR                   W0030
037580120302     C* CHAIN SUL CALENDARIO BRT
037590061220     C     KCLN          CHAIN     AZCLN01L                           30
037600061220     C   30              CLEAR                   CLNPOM
037610061220     C                   MOVEA     CLNPOM        K31
037620061220     C                   MOVEL     K31(WGG)      WFEST
037630101022     c* Se non è festivo pulisco il campo WFEST
037640101022     c     wfest         lookup    S1Y                                    30
037650101022     c                   if        not *in30
037660101022     c                   clear                   wfest
037670101022    2C                   ENDif
037680101022     c
037690061220    1C                   ENDDO
037700061220   x0c                   else
037710061220     C*
037720061221     C                   Z-ADD     dateu         DATAmeno1
037730061221     C                   MOVEL     wdtgio        DATgmeno1
037740061220    0c                   endif
037750941109     C***
037760941109     C* CARICO CAMPI FISSI PER TASSAZIONE/BOLLETTAZIONE
037770941109     C***
037780941109     C                   MOVEL     'QT'          COD
037790941109     C                   MOVEL     '1       '    KEY
037800941109     C                   EXSR      CTABEL
037810941109     C  N30              MOVEL     TBLUNI        DSQT1
037820941109     C   30              CLEAR                   DSQT1
037830930601     C*
037840920427     C* NUMERO PER FORZARE GLI ERRORI: 1 PER IMM E MANUT.BOLLE
037850920427     C*                                2 PER DISK CLI
037860920427     C                   Z-ADD     1             NUMFOR            1 0
037870940923     C***
037880940923     C* DTU,10 LA PORTO A 8 PER I CONTROLLO
037890940923     C***
037900940923     C                   CLEAR                   WLBDAT
037910940923     C                   Z-ADD     DTU(10)       G02INV
037920940923     C                   MOVEL     '3'           G02ERR
037930940923     C                   CALL      'XSRDA8'
037940940923     C                   PARM                    WLBDAT
037950940923     C                   MOVEL     G02INV        WDTU10            8 0
037960990830     C* ADDIZIONO  3
037970990830     C     G02TGI        ADD       1             GIOTGI
037980990830     C*
037990990830     C                   CALL      'XSRGI8'
038000990830     C                   PARM                    WGIDAT
038010990830     C*
038020990830     C                   Z-ADD     GIODAT        WDTUPI            8 0
038030000113     C                   MOVE      GIODAT        WAAUPI            4 0
038040990830     C*
038050941107     C***
038060960926     C* CARICO TABELLA PUNTI OPERATIVI GESTITI £1
038070941107     C***
038080941107     C                   CLEAR                   DSUL06
038090941107     C                   MOVE      '£1'          D06COD
038100941107     C                   MOVEL     SIMFEL        D06KEY
038110961003     C                   MOVEL     'L'           D06TLA
038120941107     C                   MOVEL     DSUL06        KPJBU
038130941107     C*
038140941107     C                   CALL      'TRUL06R'
038150941107     C                   PARM                    KPJBA
038160941107     C                   MOVEL     KPJBU         DSUL06
038170941107     C                   MOVEA     LIN           L1
038180070807     C***
038190070807     C* CARICO £6
038200070807     C***
038210070807     C                   CLEAR                   DSUL06
038220070807     C                   MOVE      '£6'          D06COD
038230070807     C                   movel     SImpou        D06KEY
038240070807     C                   MOVEL     'L'           D06TLA
038250070807     C                   MOVEL     DSUL06        KPJBU
038260070807     C*
038270070807     C                   CALL      'TRUL06R'
038280070807     C                   PARM                    KPJBA
038290070807     C                   MOVEL     KPJBU         DSUL06
038300070807     C                   MOVEA     LIN           L6
038310941107     C***
038320941107     C* CARICO TABELLA 5E : TIPI SERVIZIO
038330941107     C***
038340941107     C                   MOVEL     '5E'          COD
038350941107     C                   Z-ADD     1             C
038360941107     C     KTAB3         SETLL     TABEL
038370941107     C                   EXSR      RTABEL
038380941107     C*
038390941107     C     *IN30         DOWEQ     '0'
038400941107     C     TBLFLG        IFEQ      ' '
038410941107     C                   MOVEL     TBLKEY        TSP(C)
038420941108     C                   MOVEL     TBLUNI        DS5E
038430941107     C                   MOVEL     §5EDES        DTS(C)
038440941107     C                   MOVEL     §5EFUB        UTS(C)
038450941115     C                   MOVEL     §5EFST        STS(C)
038460000509     C                   MOVEL     §5EUSO        USO(C)
038470090604     c                   eval      dts08(c) = §5ed08
038480090609     c                   eval      dts03(c) = §5ed03
038490090827     c                   eval      tsTTC(c) = §5ettc
038500941107     C                   ADD       1             C
038510941107     C                   ENDIF
038520941107     C*
038530941107     C                   EXSR      RTABEL
038540941107     C                   ENDDO
038550960209     C***
038560960209     C* CARICO TABELLA TIPI BOLLA CHE PREVEDONO L'ASSICURAZIONE
038570960209     C***
038580960209     C                   MOVEL     'TB'          COD
038590960209     C                   Z-ADD     1             C
038600960209     C     KTAB3         SETLL     TABEL
038610960209     C                   EXSR      RTABEL
038620960209     C*
038630960209     C     *IN30         DOWEQ     '0'
038640960209     C     TBLFLG        IFEQ      ' '
038650960209     C                   MOVEL     TBLUNI        DSTB
038660960209     C     §TBFAS        IFEQ      '1'
038670960209     C                   MOVEL     TBLKEY        TBL(C)
038680960209     C                   ADD       1             C
038690960209     C                   ENDIF
038700960209     C                   ENDIF
038710960209     C*
038720960209     C                   EXSR      RTABEL
038730960209     C                   ENDDO
038740970115     C***
038750970115     C* CARICO TABELLA 3F : DICITURE NON AMMESSE NELLA NATURA MERCE
038760970115     C***
038770970115     C                   MOVEL     '3F'          COD
038780970115     C                   Z-ADD     1             C
038790970115     C     KTAB3         SETLL     TABEL
038800970115     C                   EXSR      RTABEL
038810970115     C*
038820970115     C     *IN30         DOWEQ     *OFF
038830970115     C     TBLFLG        IFEQ      ' '
038840970115     C                   MOVEL     TBLKEY        W003A
038850970115     C                   MOVEL     W003A         TBO(C)
038860970115     C                   MOVE      W003A         LDC(C)
038870970115     C                   ADD       1             C
038880970115     C                   ENDIF
038890970115     C*
038900970115     C                   EXSR      RTABEL
038910970115     C                   ENDDO
038920991007     c***
038930991007     c* CARICO TABELLA CODICI VARIE
038940991007     c***
038950991007     C                   MOVEL     '$2'          COD
038960991007     C                   MOVEL     *BLANKS       KEY
038970991007     C                   MOVEL     '1'           KEY
038980991007     C     KTAB2         CHAIN     TABEL                              30
038990991007     C     *IN30         IFEQ      *OFF
039000991007     C                   MOVEL     TBLUNI        DS$2
039010991007     C                   ELSE
039020991007     C                   CLEAR                   DS$2
039030991007     C                   ENDIF
039040991008      *
039050991102      * AGGANCIO TABELLA GED PER DIVISA DELLA MONETA DI CONTO
039060991102     C                   CLEAR                   DSBS02
039070000124     C                   MOVEL     'C'           T02MOD
039080991102     C                   MOVEL     KNSIF         T02SIF
039090991102     C                   MOVEL     'GED'         T02COD
039100991102     C                   MOVEL     '1'           T02KE1
039110991102      *
039120991102     C                   CALL      'TIBS02R'
039130991102     C                   PARM                    KPJBA
039140991102     C                   PARM                    DSBS02
039150991102      *
039160991102     C     T02ERR        IFEQ      *BLANKS
039170991102     C                   MOVEL     T02UNI        DGED
039180991008     C                   ELSE
039190991008     C                   CLEAR                   DGED
039200991008     C                   ENDIF
039210011108     c*
039220011108      * Tabella CV della moneta di conto
039230011212     C                   CLEAR                   DSCV
039240011212     C                   CLEAR                   DECCN
039250020102     C                   CLEAR                   COMFDC
039260011212     C                   MOVEL     'CV'          COD
039270011212     C                   MOVEL(P)  §GEDCN        KEY
039280011212     C                   EXSR      CTABEL
039290011212     C     *IN30         IFEQ      *OFF
039300011212     C                   MOVEL     TBLUNI        DSCV
039310011212     C                   MOVEL     §CVDEC        DECCN
039320020102     C                   MOVEL     §CVFDC        COMFDC
039330011212     C                   ENDIF
039340011108     C*
039350011212      * AGGANCIO TABELLA GEI PER LIMITE FATTURABILE
039360011212     C                   CLEAR                   DSBS02
039370011212     C                   MOVEL     'C'           T02MOD
039380011212     C                   MOVEL     KNSIF         T02SIF
039390011212     C                   MOVEL     'GEI'         T02COD
039400011212     C                   MOVEL     §GEDCN        T02KE1
039410011108      *
039420011212     C                   CALL      'TIBS02R'
039430011212     C                   PARM                    KPJBA
039440011212     C                   PARM                    DSBS02
039450011108      *
039460011212     C     T02ERR        IFEQ      *BLANKS
039470011212     C                   MOVEL     T02UNI        DGEI
039480011212     C                   ELSE
039490011212     C                   CLEAR                   DGEI
039500011212     C                   ENDIF
039510011212     C                   Z-ADD     §GEIMF        IMFGEI
039520000124      *
039530000124      * AGGANCIO TABELLA "CHI" PER TEL E FAX PER EXPORT DPD
039540040525     C***                CLEAR                   DSBS02
039550040525     C***                MOVEL     'C'           T02MOD
039560040525     C***                MOVEL     KNSIF         T02SIF
039570040525     C***                MOVEL     'CHI'         T02COD
039580040525     C***                MOVEL     'TELFAX'      T02KE1
039590000124      *
039600040525     C***                CALL      'TIBS02R'
039610040525     C***                PARM                    KPJBA
039620040525     C***                PARM                    DSBS02
039630000124      *
039640040525     C***  T02ERR        IFEQ      *BLANKS
039650040525     C***                MOVEL     T02UNI        TELFAX
039660040525     C***                ELSE
039670040525     C***                MOVEL     *ALL'?'       TELFAX
039680040525     C***                ENDIF
039690021120
039700021120      * Aggancio tabella default tariffe fedex
039710021120     c                   Clear                   Dsbs02
039720021120     c                   Movel     'C'           T02Mod
039730021120     c                   Movel     KNSIF         T02Sif
039740021120     c                   Movel     'DFE'         T02Cod
039750021120     c                   Movel     'FED'         T02Ke1
039760021120     c                   Call      'TIBS02R'
039770021120     c                   Parm                    Kpjba
039780021120     c                   Parm                    Dsbs02
039790021120     c                   If        T02Err = *Blanks
039800021120     c                   Movel     T02Uni        DDfe
039810021120     c                   Else
039820021120     c                   Clear                   DDfe
039830021120     c                   EndIf
039840040701      * Aggancio tabella "VPO" per reperimento data ultima fase poste
039850040701     C                   CLEAR                   dsbs02
039860040701     c                   clear                   dvpoppt
039870040701     C                   MOVEL     'C'           T02MOD
039880040701     C                   MOVEL     KNSIF         T02SIF
039890040701     C                   MOVEL     'VPO'         T02COD
039900040701     c                   movel(P)  'PPT'         t02ke1
039910040701     C                   CALL      'TIBS02R'
039920040701     C                   PARM                    KPJBA
039930040701     C                   PARM                    dsbs02
039940040701    2C                   IF        T02ERR = *BLANKS
039950040701     C                   MOVEL     T02uni        dvpoppt
039960040701    2C                   ENDIF
039970081111      * Recupero le date delle statistiche
039980081111     c                   Clear                   dsbs02
039990081111     c                   Clear                   dSdf
040000081111     c                   Eval      T02Mod = 'C'
040010081111     c                   Eval      T02Sif = Knsif
040020081111     c                   Eval      T02Cod = 'SDF'
040030081111     c                   Movel(p)  Simfel        T02Ke1
040040081111     c                   Call      'TIBS02R'
040050081111     c                   Parm                    Kpjba
040060081111     c                   Parm                    dsbs02
040070081111     c                   If        T02Err = *Blanks
040080081111     c                   Movel     T02Uni        dSdf
040090081111     c                   EndIf
040100021120
040110000202     C* MI MEMORIZZO L'AS PER NUMERATORE CHI SONO DPD
040120000202     C                   Z-ADD     SIMFEL        W0030
040130000202     C     W0030         CHAIN     AZORG01L      UNIORG               30
040140000202     C                   MOVEL     ORGFEL        WASFEL            3 0
040150000204     C                   MOVEL     ORGDF0        OG150
040160000204     C                   MOVEL     §OGDKC        WASDKC            1
040170040329     c                   Eval      Og143 = Orgde3
040180040329     c                   Eval      LnpOgAs = §OgAs
040190991008     C*
040200930628     C***
040210930628     C* VEDO SE SONO SIMFEL O REMOTO
040220930628     C***
040230930628     C                   MOVEL     SIMFEL        CDU               3 0
040240930628     C*
040250020513     c     simtpp        ifeq      '2'
040260020513     c     simtpp        oreq      *blanks
040270020513     c                   movel     simpou        cdu
040280930628     C                   END
040290941115     C**
040300941115     C* VEDO IL RICHIAMO
040310941115     C**
040320941115    1C     §LPFPR        IFNE      'C'
040330941115     C     §LPFPR        ANDNE     'G'
040340941115     C     §LPFPR        ANDNE     'I'
040350150302     C     §LPFPR        ANDNE     'B'
040360941115     C*
040370990602     C                   SELECT
040380990602     C* RECUPERO BOLLE
040390990602    2C     PARTCH        WHENEQ    'R'
040400941115     C                   MOVE      DES(4)        VIDTES
040410941115     C                   SETON                                        98
040420990602     C* PROCEDURA PREPAGATI
040430990602    2C     PARTCH        WHENEQ    'P'
040440010301     C     §LPFPR        OREQ      'O'
040450990602     C                   MOVE      DES(6)        VIDTES
040460990602   X2C                   OTHER
040470941115     C                   MOVE      DES(1)        VIDTES
040480990602    2C                   ENDSL
040490941115    1C                   ENDIF
040500941115     C*
040510941115     C* SE IMMISSIONE VISUALIZZO: ULTIMA SPEDIZIONE
040520941115     C                   MOVEL     CULTSP        PREDSS
040530941115     C*
040540941115    1C     §LPFPR        IFNE      'C'
040550941115     C* ESEGUO SOLO UNA VOLTA
040560941115    2C     RIC           IFEQ      ' '
040570941115    3C     §LPFPR        IFNE      ' '
040580010301     C     §LPFPR        ANDNE     'O'
040590941115     C*
040600941115     C* PROVENGO DA MANUTENZIONE
040610941115    4C     §LPFPR        IFEQ      'M'
040620941115     C                   SETON                                        12
040630941115     C                   MOVE      DES(2)        VIDTES
040640941115     C                   MOVEL     CVARIA        PREDSS
040650941115     C                   OPEN      FNLBL01L
040660070123     C                   OPEN      FNBRV09L
040670071221     C                   OPEN      FNBRV07L
040680080904     C                   OPEN(e)   TNBLA00F
040690160120     c                   open      fiarbf2c
040700080904     c
040710080904     c                   if        not %open(tnbla00f)
040720080904     c                   eval      %subst(WTNBLA:7:4)='GRPS'
040730080904     C                   OPEN      TNBLA00F
040740080904     c                   endif
040750941115     C*
040760941115   X4C                   ELSE
040770941115     C* PROVENGO DA CARICAMENTO BOLLE DA DISK
040780941115     C                   SETON                                        1215
040790941115     C                   MOVEL     CCONFE        PREDSS
040800020917     C                   OPEN      FIVAD02L
040810020917     C                   OPEN      FIVAT01L
040820040601     C                   OPEN      FIVAX01L
040830140716     C                   OPEN      FNBRV07L
040840941115     C     *IN98         IFEQ      *OFF
040850941115     C                   MOVE      DES(3)        VIDTES
040860941115     C                   ELSE
040870941115     C                   MOVE      DES(5)        VIDTES
040880941115     C                   ENDIF
040890941115     C*
040900941115    4C                   END
040910941115    3C                   END
040920941115    2C                   END
040930941115    1C                   END
040940110518     c*
040950110518     c                   if        not *in12
040960110518     c                   open      fivab01l
040970110518     c                   open      edivab1l
040980110518     c                   endif
040990940819     C*
041000940915     C* QUESTI 2 CAMPI UNA VOLTA IMPOSTATI NON LI TOCCO PIU':
041010070828     c* Non più: la data ritiro a nuova bolla la reimposterò sempre a udate
041020940915     C*
041030960926     C* LINEA DI PARTENZA --> IMPOSTO
041040940915     C  N12              MOVEL     CDU           VIDLNP
041050940915     C* DATA RITIRO       --> IMPOSTO DATA DEL GIORNO
041060990628     C  N12PARTCH        IFNE      'P'
041070010301     C     §LPFPR        ANDNE     'O'
041080070828     C                   MOVEL     WDTGIO        VIDDRT
041090990630     C                   ELSE
041100990630     C                   OPEN      CNNUM00F
041110990628     C                   ENDIF
041120940915     C*
041130930628     C* CAMPI CHE INIZIALIZZO SOLO IN IMMISSIONE BOLLE
041140930628     C*   E PER DISK CLIENTI
041150930628     C   12
041160930628     CAN 15
041170930628     CORN12              DO
041180930628     C                   MOVEL     *ZEROS        RECNSP
041190930628     C                   MOVEL     *ZEROS        VIDDBR
041200930628     C                   MOVEL     *ZEROS        VIDNFV
041210930628     C                   MOVEL     *ZEROS        VIDNSP
041220930628     C                   MOVE      *BLANKS       BLPATB
041230940915     C                   MOVEL     CDU           BLPFLB
041240111128     C****               MOVEL     SIMFEL        BLPFLE
041250940915     C                   MOVEL     *ZEROS        BLPDPC
041260940915     C                   MOVEL     *ZEROS        BLPDUC
041270940819     C                   MOVEL     *ZEROS        BLPFLP
041280930628     C                   MOVEL     *ZEROS        BLPDAM
041290930628     C                   MOVEL     *ZEROS        BLPDCM
041300930628     C                   MOVEL     *ZEROS        BLPHMC
041310930628     C                   MOVEL     *ZEROS        BLPDUT
041320930628     C                   MOVEL     *ZEROS        BLPDET
041330930628     C                   MOVEL     *ZEROS        BLPDSE
041340940915     C                   MOVEL     *ZEROS        BLPVLC
041350930628     C                   MOVEL     *ZEROS        BLPNCR
041360940915     C                   MOVEL     *ZEROS        BLPDT1
041370940915     C                   MOVEL     *ZEROS        BLPDT2
041380940915     C                   MOVEL     *ZEROS        BLPDT3
041390940915     C                   MOVEL     *BLANKS       BLPFT1
041400940915     C                   MOVEL     *BLANKS       BLPFT2
041410940915     C                   MOVEL     *BLANKS       BLPFT3
041420940915     C                   Z-ADD     DATEU         BLPDIM
041430940915     C                   CLEAR                   BLPFDN
041440940915     C                   CLEAR                   BLPNCP
041450940915     C                   CLEAR                   BLPPKC
041460940915     C                   CLEAR                   BLPDTI
041470940915     C                   CLEAR                   BLPHTI
041480940915     C                   CLEAR                   BLPDCE
041490940915     C                   CLEAR                   BLPNPI
041500940915     C                   CLEAR                   BLPNCI
041510940915     C                   CLEAR                   BLPNCR
041520940915     C                   CLEAR                   BLPNDC
041530940915     C                   CLEAR                   BLPDDC
041540940915     C                   CLEAR                   BLPDCP
041550940915     C                   CLEAR                   BLPCCA
041560940915     C                   CLEAR                   BLPTMC
041570040901     c                   clear                   blpscl
041580040329      * per immissione bolle o per conferma bolle da clienti
041590040329      * Se il p.o. è già su AS unico apro TITAS
041600040329     c                   If        LnpOgAs = 946
041610040329     c                             and Not %Open(Titas30c)
041620040329     c                   Clear                   comman
041630040329     c                   Movel(p)  cmdt(1)       comman
041640040329     c                   Eval      %Subst(comman:30:10) = wlib
041650040329     c                   Eval      comman =
041660040329     c                             %trim(comman) + '/TITAS30C)'
041670040329     c                   Call      'QCMDEXC'                            99
041680040329     c                   Parm                    comman
041690040329     c                   Parm                    lenght
041700040329     c  n99              Open      Titas30c
041710040329     c                   EndIf
041720940928     C                   ENDDO
041730151014      * Se il p.o. è già su AS unico apro FIAR5 di sede
041740151014     c                   If        LnpOgAs = 946
041750151014     c                             and Not %Open(fiar531c)
041760151014     c                   Clear                   comman
041770151015     c                   Movel(p)  cmdt(2)       comman
041780151014     c                   Eval      %Subst(comman:30:10) = wlib
041790151014     c                   Eval      comman =
041800151014     c                             %trim(comman) + '/FIAR531C)'
041810151014     c                   Call      'QCMDEXC'                            99
041820151014     c                   Parm                    comman
041830151014     c                   Parm                    lenght
041840151014     c  n99              Open      fiar531c
041850151014     c                   EndIf
041860930611     C*
041870930611     C* STAMPA DEI 3 ASTERISCHI ALLA FINE SE><0
041880930611     C                   Z-ADD     0             I100              1 0
041890930628     C*
041900930628     C                   MOVEL     'C'           RIC               1
041910940920     C* SIGLA OPERATORE:
041920940920     C* IN IMMISSIONE SEMPRE SPROTETTA
041930940920     C     *IN12         IFEQ      *OFF
041940940920     C                   SETOFF                                       13
041950940920     C                   ENDIF
041960940920     C*
041970940920     C* IN DISK CLIENTI SEMPRE PROTETTA
041980940920     C     *IN12         IFEQ      *ON
041990940920     C     *IN15         ANDEQ     *ON
042000940920     C                   SETON                                        13
042010940920     C                   ENDIF
042020940920     C* IN MANUTENZIONE SOLO SE E' UNA SIGNA NON UTILIZABILE:
042030940920     C* LO CONTROLLO BOLLA PER BOLLA QUINDI IN CARBLP LO FACCIO
042040941117     C                   CLEAR                   SAVFIE
042050160219     C                   CLEAR                   s_27ntw
042060971215     C* IMPOSTO LA DS ESTERA PER I CAMPI FISSI
042070971215     C                   CLEAR                   DSBLD
042080971215     C                   CLEAR                   DSBLDE
042090000120     C*
042100000120     C                   MOVEL     'CHI'         KTCOD
042110000202     C                   MOVEL     WASFEL        KTKE1
042120000120     C                   CLEAR                   KTLIN
042130000120     C                   CLEAR                   KTSIF
042140000120     C                   CLEAR                   KTKE2
042150010319     C* VEDO SE IN L1 PRESENTE P.O. DPD
042160010319     C                   CLEAR                   WSIDPD
042170010319     C                   Z-ADD     1             II
042180010319     C     II            DOWLE     30
042190010319     C     WSIDPD        ANDEQ     *BLANKS
042200010319     C     L1(II)        CHAIN     AZORG01L      UNIORG               30
042210010319     C  N30              MOVEL     ORGDE3        OG143
042220010319     C   30              CLEAR                   OG143
042230020319     C     §OGntw        IFEQ      'DPD'
042240010319     C                   MOVEL     'S'           WSIDPD            1
042250010319     C                   ENDIF
042260010319     C                   ADD       1             II
042270010319     C                   ENDDO
042280051124     c* imposto campi fissi da passare a fnlsa8r
042290051124     c**                 z-add     simfel        parfel
042300051124     c**                 movel     '1'           parflg
042310130117
042320130117      * Carico la tabella OSR
042330130117     c                   exsr      carosr
042331160609     c                   if        *in99 and not *in99
042332160609     c                   open      fnls01d
042333160609     c                   endif
042340130117
042350920220     C                   ENDSR
042360130117
042370130117      /free
042380130117       // ----------------------------------------------------------------------
042390130117       //?Carico tabella OSR.
042400130117       // ----------------------------------------------------------------------
042410130117       begsr carosr;
042420130117
042430130117         clear osrxx;
042440130117
042450130117       //?carico tutta la tabella OSR delle LNP/NRS ORM
042460130117         setll    c_tabosr tntbe01l;
042470130117         reade(n) c_tabosr tntbe01l;
042480130117
042490130117         dow not %eof(tntbe01l);
042500130122           IF  TBEatb = *blanks;
042510130117           dosr = tbeuni;
042520130117       //?carico in sk tutti i clienti che trovo
042530130117       //?skCLIosr = cliente
042540130117       //?skLNPNRSosr = LNP + serie (TBEke1)
042550130117           IF d§osrcli <> 0;
042560130117             osrxx = %lookup(d§OSRcli:skCLIosr);
042570130117             IF  osrxx = 0;
042580130117               osrxx = %lookup(*zeros:skCLIosr);
042590130117               IF  osrxx > 0;
042600130117                 skCLIosr(osrxx) = d§OSRcli;
042610130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
042620130117               ENDIF;
042630130117             ENDIF;
042640130117           ENDIF;
042650130117
042660130117           IF d§osrcl2 <> 0;
042670130117             osrxx = %lookup(d§OSRcl2:skCLIosr);
042680130117             IF  osrxx = 0;
042690130118               osrxx = %lookup(*zeros:skCLIosr);
042700130117               IF  osrxx > 0;
042710130117                 skCLIosr(osrxx) = d§OSRcl2;
042720130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
042730130117               ENDIF;
042740130117             ENDIF;
042750130117           ENDIF;
042760130117
042770130117           IF d§osrcl3 <> 0;
042780130117             osrxx = %lookup(d§OSRcl3:skCLIosr);
042790130117             IF  osrxx = 0;
042800130117               osrxx = %lookup(*zeros:skCLIosr);
042810130117               IF  osrxx > 0;
042820130117                 skCLIosr(osrxx) = d§OSRcl3;
042830130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
042840130117               ENDIF;
042850130117             ENDIF;
042860130117           ENDIF;
042870130117
042880130117           IF d§osrcl4 <> 0;
042890130117             osrxx = %lookup(d§OSRcl4:skCLIosr);
042900130117             IF  osrxx = 0;
042910130117               osrxx = %lookup(*zeros:skCLIosr);
042920130117               IF  osrxx > 0;
042930130117                 skCLIosr(osrxx) = d§OSRcl4;
042940130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
042950130117               ENDIF;
042960130117             ENDIF;
042970130117           ENDIF;
042980130117
042990130117           IF d§osrcl5 <> 0;
043000130117             osrxx = %lookup(d§OSRcl5:skCLIosr);
043010130117             IF  osrxx = 0;
043020130117               osrxx = %lookup(*zeros:skCLIosr);
043030130117               IF  osrxx > 0;
043040130117                 skCLIosr(osrxx) = d§OSRcl5;
043050130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043060130117               ENDIF;
043070130117             ENDIF;
043080130117           ENDIF;
043090130117
043100130117           IF d§osrcl6 <> 0;
043110130117             osrxx = %lookup(d§OSRcl6:skCLIosr);
043120130117             IF  osrxx = 0;
043130130117               osrxx = %lookup(*zeros:skCLIosr);
043140130117               IF  osrxx > 0;
043150130117                 skCLIosr(osrxx) = d§OSRcl6;
043160130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043170130117               ENDIF;
043180130117             ENDIF;
043190130117           ENDIF;
043200130117
043210130117           IF d§osrcl7 <> 0;
043220130117             osrxx = %lookup(d§OSRcl7:skCLIosr);
043230130117             IF  osrxx = 0;
043240130117               osrxx = %lookup(*zeros:skCLIosr);
043250130117               IF  osrxx > 0;
043260130117                 skCLIosr(osrxx) = d§OSRcl7;
043270130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043280130117               ENDIF;
043290130117             ENDIF;
043300130117           ENDIF;
043310130117
043320130117           IF d§osrcl8 <> 0;
043330130117             osrxx = %lookup(d§OSRcl8:skCLIosr);
043340130117             IF  osrxx = 0;
043350130117               osrxx = %lookup(*zeros:skCLIosr);
043360130117               IF  osrxx > 0;
043370130117                 skCLIosr(osrxx) = d§OSRcl8;
043380130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043390130117               ENDIF;
043400130117             ENDIF;
043410130117           ENDIF;
043420130117
043430130117           IF d§osrcl9 <> 0;
043440130117             osrxx = %lookup(d§OSRcl9:skCLIosr);
043450130117             IF  osrxx = 0;
043460130117               osrxx = %lookup(*zeros:skCLIosr);
043470130117               IF  osrxx > 0;
043480130117                 skCLIosr(osrxx) = d§OSRcl9;
043490130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043500130117               ENDIF;
043510130117             ENDIF;
043520130117           ENDIF;
043530130117
043540130117           IF d§osrcl10 <> 0;
043550130117             osrxx = %lookup(d§OSRcl10:skCLIosr);
043560130117             IF  osrxx = 0;
043570130117               osrxx = %lookup(*zeros:skCLIosr);
043580130117               IF  osrxx > 0;
043590130117                 skCLIosr(osrxx) = d§OSRcl10;
043600130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043610130117               ENDIF;
043620130117             ENDIF;
043630130117           ENDIF;
043640130117
043650130117           IF d§osrcl11 <> 0;
043660130117             osrxx = %lookup(d§OSRcl11:skCLIosr);
043670130117             IF  osrxx = 0;
043680130117               osrxx = %lookup(*zeros:skCLIosr);
043690130117               IF  osrxx > 0;
043700130117                 skCLIosr(osrxx) = d§OSRcl11;
043710130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043720130117               ENDIF;
043730130117             ENDIF;
043740130117           ENDIF;
043750130117
043760130117           IF d§osrcl12 <> 0;
043770130117             osrxx = %lookup(d§OSRcl12:skCLIosr);
043780130117             IF  osrxx = 0;
043790130117               osrxx = %lookup(*zeros:skCLIosr);
043800130117               IF  osrxx > 0;
043810130117                 skCLIosr(osrxx) = d§OSRcl12;
043820130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043830130117               ENDIF;
043840130117             ENDIF;
043850130117           ENDIF;
043860130117
043870130117           IF d§osrcl13 <> 0;
043880130117             osrxx = %lookup(d§OSRcl13:skCLIosr);
043890130117             IF  osrxx = 0;
043900130117               osrxx = %lookup(*zeros:skCLIosr);
043910130117               IF  osrxx > 0;
043920130117                 skCLIosr(osrxx) = d§OSRcl13;
043930130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
043940130117               ENDIF;
043950130117             ENDIF;
043960130117           ENDIF;
043970130117
043980130117           IF d§osrcl14 <> 0;
043990130117             osrxx = %lookup(d§OSRcl14:skCLIosr);
044000130117             IF  osrxx = 0;
044010130117               osrxx = %lookup(*zeros:skCLIosr);
044020130117               IF  osrxx > 0;
044030130117                 skCLIosr(osrxx) = d§OSRcl14;
044040130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044050130117               ENDIF;
044060130117             ENDIF;
044070130117           ENDIF;
044080130117
044090130117           IF d§osrcl15 <> 0;
044100130117             osrxx = %lookup(d§OSRcl15:skCLIosr);
044110130117             IF  osrxx = 0;
044120130117               osrxx = %lookup(*zeros:skCLIosr);
044130130117               IF  osrxx > 0;
044140130117                 skCLIosr(osrxx) = d§OSRcl15;
044150130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044160130117               ENDIF;
044170130117             ENDIF;
044180130117           ENDIF;
044190130117
044200130117           IF d§osrcl16 <> 0;
044210130117             osrxx = %lookup(d§OSRcl16:skCLIosr);
044220130117             IF  osrxx = 0;
044230130117               osrxx = %lookup(*zeros:skCLIosr);
044240130117               IF  osrxx > 0;
044250130117                 skCLIosr(osrxx) = d§OSRcl16;
044260130117                 skLNPNRSosr(osrxx) = %subst(TBEke1:1:5);
044270130117               ENDIF;
044280130117             ENDIF;
044290130117           ENDIF;
044300130122
044310130122           ENDIF;
044320130117
044330130117           reade(n) c_tabosr tntbe01l;
044340130117         enddo;
044350130117
044360130117       endsr;
044370130117      /end-free
044380900427     C*
044390900427     C*--- PULIZIA CAMPI FORMATO1 ------------------------------------*
044400940819     C     INZ01         BEGSR
044410950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
044420950126     C                   EXSR      OFFD01
044430900427     C*
044440991014     C                   CLEAR                   DSLV04
044450940222     C                   MOVE      ' '           UNO               1
044460940930     C                   MOVE      0             DUE               1 0
044470940930     C                   MOVE      0             TRE               1 0
044480920427     C                   MOVE      0             QUA               1 0
044490100209     C                   MOVE      0             QUAH              1 0
044500940930     C                   MOVE      0             CIN               1 0
044510940930     C                   MOVE      0             SEI               1 0
044520941020     C                   MOVE      0             SET               1 0
044530940930     C                   MOVE      0             OTT               1 0
044540910801     C                   MOVEL     ' '           NOV               1
044550940930     C                   MOVEL     0             DIE               1 0
044560950102     C                   MOVEL     0             UND               1 0
044570950410     C                   MOVEL     0             DOD               1 0
044580950410     C                   MOVEL     0             QUI               1 0
044590961111     C                   MOVEL     0             SED               1 0
044600040213     C**!!!              MOVEL     0             DIC               1 0
044610040213     C**!!!              MOVEL     0             VEN               1 0
044620990610     C                   MOVEL     0             SES               1 0
044630970702     C                   MOVEL     0             AAA               1 0
044640970702     C                   MOVEL     0             AAB               1 0
044650990915     C                   MOVEL     0             AAC               1 0
044660991213     C                   MOVEL     0             AAD               1 0
044670970704     C                   MOVEL     0             MMA               1 0
044680970704     C                   MOVEL     0             MMB               1 0
044690000622     C                   MOVEL     0             MMD               1 0
044700970704     C                   MOVEL     0             COMA              1 0
044710970704     C                   MOVEL     0             COMB              1 0
044720990915     C                   MOVEL     ' '           WFPR              1
044730000509     C                   MOVEL     ' '           WPT1              1
044740001025     C                   MOVEL     ' '           VIDMAG
044750010504     C                   MOVE      ' '           WFORZO
044760990915     C                   CLEAR                   SAVPD4
044770030417     c                   Clear                   fordcr
044780030704     c                   Clear                   wforw03
044790030728     c                   Clear                   wfornba
044800031001     c                   Clear                   wfortbo
044810031201     c                   Clear                   wnoccm
044820060515     c                   clear                   bolksc
044830060515     c                   clear                   bolctr
044840040216     c                   Eval      wforza1 = *Off
044850040216     c                   Eval      wforza2 = *Off
044860110321     c                   Eval      wforzbrv = *Off
044870110422     c                   Eval      wforzadrt = *Off
044880141124     c                   clear                   wforz_lna
044890141124     c                   clear                   wforz_lnap
044900041116     c                   clear                   wnprpre
044910060104     C                   MOVEL     *ZEROS        VARZNC
044920941107     C* PULISCO LA DS DI STAMPA
044930991007     C  N12              CLEAR                   DTAS
044940991007     C  N12              CLEAR                   DTASV
044950030626     C                   CLEAR                   fnlsb5DS
044960941115     C                   CLEAR                   WESVAR
044970950209     C                   CLEAR                   DS1A
044980950120     C                   CLEAR                   WIN11
044990950120     C                   CLEAR                   WIN88
045000940926     C*
045010940926     C* CAMPI CHE MI INDICATO SE E' PRESENTE UNA ESTENSIONE BOLLA
045020991006     C                   CLEAR                   WAR62
045030991006     C                   CLEAR                   WAR61
045040050331     C                   CLEAR                   WKSCsf1
045050050331     C                   CLEAR                   WKSCsf2
045060991006     C                   CLEAR                   WAR7
045070040114     c                   Clear                   war71
045080051115     C                   CLEAR                   War9
045090000623     C                   CLEAR                   WES3Q
045100000623     C                   CLEAR                   WBL4W
045110040116     c                   Clear                   wesvar1
045120940926     C*
045130950126     C                   CLEAR                   WSBORD
045140940930     C                   CLEAR                   VARCAD
045150940930     C                   CLEAR                   VARCAM
045160940926     C                   CLEAR                   SAVFTM
045170940921     C                   CLEAR                   SAVFLC
045180940922     C                   CLEAR                   SAVCTR
045190961111     C                   CLEAR                   SAVFBR
045200961122     C                   CLEAR                   SAVCBO
045210000211     C                   CLEAR                   WESSGN
045220100209     C                   CLEAR                   Sa2TSP
045230941005     C* CANCELLO I CAMPI DI CONFRONTO PER RICARICARE COD TARIFFA
045240941005     C                   CLEAR                   VARTSP
045250941107     C                   CLEAR                   WFIE
045260990610     C                   CLEAR                   WCOCCM
045270050926     c* pulizia campo per errore forzabile su volume in base alla tarif
045280050926     c* fa
045290050926     c                   clear                   fvol
045300941231     C**
045310941231     C* IL CAMPO SAVCCM MI SERVE PER IL CONFRONTO DEL CODICE CLI
045320941231     C*  PER CARICARE LE TARIFFE RELATIVE
045330941231     C                   Z-ADD     1             SAVCCM
045340940922     C* SPENGO INDICATORI DI ABILITAZIONE RICERCA MITTENTE E FIL CLIENT
045350941020     C                   SETOFF                                       0138
045360940922     C* INDICATORI DI "RI" PER CAMPI PRESI DA TARIFFA
045370941107     C                   SETOFF                                       97
045380040610     c     atrbva        ifne      prri
045390040610     c                   movel     hiul          atrbva
045400040610     c                   endif
045410990630     C* INDICATORI DI PTOTEZIONE DATI FATTURA E VISUL.TOT IMPONIBILE
045420990630     C                   SETOFF                                       22
045430000915     C* INDICATORE ABILITAZIONE TASTO F22-MANTUENZIONE COD.CHI SONO
045440000915     C                   SETOFF                                       96
045450051123     c* Protezione codice bolla
045460051123     C                   CLEAR                   ATRcbo
045470070801     c* imposto no display l'attributo della costante video:"Da ORM" che
045480070801     c* deve essere visualizzata quando la data ritiro viene modificata
045490070801     c* proponendola da ORM
045500070801     c                   movel     nodi          atrdaorm
045510070918     c                   clear                   s_drt
045520070831     c* data ritiro
045530070831     c                   exsr      inzdrt
045540111124     c*
045550111124     c                   clear                   vidno1
045560111124     c                   clear                   vidno2
045570111128     c                   clear                   viddno
045580940922     C*
045590940819     C* 24 ON - DATA SPEDIZIONE PERSONALIZZATA
045600940819     C     *IN24         IFEQ      *OFF
045610940819     C                   Z-ADD     WDTGIO        VIDDSP
045620940819     C                   ENDIF
045630010222     C* 37 ON - NUMERO O.R.M. PERSONALIZZATO
045640010222     C     *IN37         IFEQ      *OFF
045650040909     c                   clear                   vidpoe
045660010222     C                   CLEAR                   VIDNOR
045670010222     C                   CLEAR                   VIDNRV
045680011126     C                   CLEAR                   ATRDES
045690011205     C                   CLEAR                   SORMFD
045700010222     C                   ENDIF
045710940819     C* 21 ON - CODICE BOLLA   PERSONALIZZATO
045720940819     C     *IN21         IFEQ      *OFF
045730940819     C                   MOVEL     *BLANKS       VIDCBO
045740940819     C                   ENDIF
045750940819     C* 20 ON - LINEA DI ARRIVO PERSONALIZZATO
045760940819     C     *IN20         IFEQ      *OFF
045770950208     C                   Z-ADD     0             CO2LNA
045780950208     C                   Z-ADD     0             COMLNA
045790020213     C                   CLEAR                   A_OG143
045800040525     C                   CLEAR                   A_OG150
045810940819     C                   MOVEL     *BLANKS       VIDLNA
045820940920     C                   MOVEL     *BLANKS       V1DLNA
045830940819     C                   ENDIF
045840940819     C* 18 ON - TIPO SERVIZIO PERSONALIZZATO
045850940819     C     *IN18         IFEQ      *OFF
045860940819     C                   MOVEL     *BLANKS       VIDTSP
045870941005     C                   MOVEL     *BLANKS       V1DTSP
045880950303     C                   CLEAR                   V2DTSP
045890940819     C                   ENDIF
045900940819     C* 26 ON - CODICE TRATTAMENTO MERCE PERSONALIZZATO
045910940819     C     *IN26         IFEQ      *OFF
045920940819     C                   MOVEL     *BLANKS       VIDCTM
045930940920     C                   MOVEL     *BLANKS       V1DCTM
045940940819     C                   ENDIF
045950940920     C* 28 ON - TASSAZ TARIFFA MITTENTE PERSONALIZZATO
045960940819     C     *IN28         IFEQ      *OFF
045970940819     C                   MOVEL     *BLANKS       VIDFTM
045980940819     C                   ENDIF
045990940921     C* 19 ON - MITTENTE PERSONALIZZATO
046000950303     C* 85 ON - COD.MITTENTE PERSONALIZZATO
046010940921     C     *IN19         IFEQ      *OFF
046020950303     C*
046030950303     C     *IN85         IFEQ      *OFF
046040950123     C                   CLEAR                   WCCMS
046050941005     C                   CLEAR                   VIDFLC
046060941005     C                   CLEAR                   VIDCCM
046070950303     C                   CLEAR                   VIDDMT
046080950303     C                   ENDIF
046090950303     C                   CLEAR                   V2DTEL
046100940921     C                   CLEAR                   VIDRSM
046110940921     C                   CLEAR                   VIDINM
046120940921     C                   CLEAR                   VIDCAM
046130940921     C                   CLEAR                   VIDPRM
046140950303     C                   CLEAR                   VIDLOM
046150940921     C                   CLEAR                   VIDPIM
046160061109     C                   CLEAR                   VIDcdf
046170061109     c                   movel     hiul          atrcdf
046180080804     c                   clear                   forzcdf           1
046190120504     c                   clear                   forzcdf1          1
046200061109     c                   clear                   savrsm
046210940921     C                   CLEAR                   VIDNZM
046220940921     C                   CLEAR                   VIDFAP
046230941020     C                   SETOFF                                       14
046240940921     C                   ENDIF
046250940825     C* DESTINATARIO
046260940819     C                   MOVEL     *BLANKS       VIDRSD
046270940819     C                   MOVEL     *BLANKS       VIDIND
046280940819     C                   MOVEL     *BLANKS       VIDLOD
046290940819     C                   MOVEL     *BLANKS       VIDPRD
046300940819     C                   MOVEL     *BLANKS       VARPRD
046310940819     C                   MOVEL     *BLANKS       VIDNZD
046320940819     C                   CLEAR                   VIDCAD
046330940928     C                   CLEAR                   VIDPID
046340940819     C                   MOVEL     *BLANKS       VIDFIN
046350030305     c                   Clear                   savdisag
046360070924     c                   Clear                   savpart
046370050214     c                   Clear                   wdesie
046380940819     C*
046390940915     C* ULTIMA SPEDIZIONE        SE IMMISSIONE BOLLA (12 OFF)
046400940819     C     *IN12         IFEQ      *OFF
046410010301     C     §LPFPR        ANDNE     'O'
046420900427     C                   Z-ADD     BLPNRS        PRENRS
046430900427     C                   Z-ADD     BLPNSP        PRENSP
046440941011     C                   MOVEL     BLPLNA        PRELNA
046450900427     C                   Z-ADD     BLPRMN        PRERMN
046460910128     C                   Z-ADD     BLPZNC        PREZNC
046470940819     C                   ENDIF
046480940819     C*
046490900427     C                   Z-ADD     0             VIDPKG
046500980402     C                   Z-ADD     0             SAVPKG
046510940819     C                   Z-ADD     0             V1CNCL
046520090609     c                   clear                   wncl_pre
046530090609     c                   clear                   wpes_pre
046540111026     c                   clear                   savtsp73
046550971222     C* PULISCO I CAMPI DELL'EXPORT SDI
046560971222     C                   CLEAR                   DSBL4E
046570900502     C* PULISCO ALCUNI CAMPI DEL FOR02
046580900517     C                   Z-ADD     0             VIDZNC
046590930628     C     *IN12         IFEQ      *ON
046600930628     C                   CLEAR                   VIDTCR
046610930628     C                   CLEAR                   VIDDCR
046620930628     C                   CLEAR                   VIDHCR
046630030409     c                   Clear                   VidOre
046640930628     C                   CLEAR                   VIDMCR
046650930628     C                   CLEAR                   VIDCTR
046660930628     C                   CLEAR                   DEFCTR
046670930628     C                   CLEAR                   VIDNAS
046680040610     c                   clear                   vidbva
046690960319     C                   CLEAR                   VIDGC1
046700960319     C                   CLEAR                   VIDGC2
046710930628     C                   ELSE
046720940920     C  N17              MOVEL     ' '           VIDTCR
046730930628     C  N16              MOVEL     *ZEROS        VIDDCR
046740940920     C  N23              MOVEL     *ZEROS        VIDHCR
046750940920     C  N23              MOVEL     *ZEROS        VIDMCR
046760030409     c                   If        wflagore = *Blanks
046770030409     c                   Clear                   VidOre
046780030409     c                   EndIf
046790930628     C  N29              CLEAR                   VIDCTR
046800930628     C  N29              CLEAR                   DEFCTR
046810940825     C  N27              CLEAR                   VIDNAS
046820040610     c     atrbva        ifne      prri
046830040610     c                   clear                   vidbva
046840040610     c                   endif
046850960319     C  N91              CLEAR                   VIDGC1
046860960319     C  N91              CLEAR                   VIDGC2
046870960319     C                   ENDIF
046880990630     C* MEMORIZZO E PROTEGGO LA DATA PER I PREPAGATI
046890990630     C     PARTCH        IFEQ      'P'
046900010301     C     §LPFPR        OREQ      'O'
046910990630     C                   Z-ADD     WDTGIO        VIDDSP
046920990701     C                   SETON                                        2426
046930990630     C                   SETON                                        3422
046940990630     C* IMPOSTO FISSO IL CTM
046950990630     C                   MOVEL     §3ICTP        VIDCTM
046960990630     C* IMPOSTO IL COD MITTENTE --> 8888
046970990720     C* SOLO SE NON PERSONALIZZATO
046980010307     C     PARTCH        IFEQ      'P'
046990990720     C  N19
047000990720     CANN85              Z-ADD     8888          VIDCCM
047010010307     C                   ENDIF
047020990630     C                   ENDIF
047030050126     c* autotrasportatore
047040050426     c***  atrpdr        ifne      prri
047050050426     c***                clear                   vidpdr
047060050426     c***                clear                   v1dpdr
047070050426     c**n34              movel     '?'           vidpdr
047080050426     c***                endif
047090050126     c* flag mattino pomeriggio
047100050426     c***  atrfpp        ifne      prri
047110050426     c***                clear                   vidfpp
047120050426     c***                endif
047130031113     c                   Clear                   VidRef
047140031113     c                   Clear                   VidTel
047150031219     c                   Clear                   wrifp
047160141031     c                   Clear                   wPinCode
047170000120     C*
047180000120     C                   CLEAR                   VIDDPD
047190000120     C                   CLEAR                   VIDNRD
047200000120     C                   CLEAR                   COMNRD
047210050315     C                   MOVE      *BLANKS       VIDFFD
047220010223     C                   CLEAR                   WOVUO
047230070427     C                   CLEAR                   WOVUO1
047240010226     C                   CLEAR                   CHGORM
047250090327     C                   CLEAR                   CHGORM1
047260091120     C                   CLEAR                   CHGORM2
047270090327     C                   CLEAR                   w_fcli
047280110512     c* imposto no display l'attributo della costante video:"F17=ind.mail dest
047290110512     c* che deve essere visualizzata solo quando ricevo il dato da VAT
047300150213     c                   movel     nodi          atremd
047310150213     c***                movel     ndpr          atrwemd
047320150213     c***                movel     ndpr          atrwtel
047330110512     c                   clear                   wemdest
047340160511     c                   clear                   sav_wemdest
047350130315     c                   clear                   wsms
047360160511     c                   clear                   sav_wsms
047370130315     c                   clear                   wsmp
047380130918     c                   clear                   wmmp
047390130923     c                   clear                   wmmp_ar5
047400110705     c* visualizzazione f19=CUP/CIG solo da data attivazione
047410110705     C                   IF        DATEU < §VPOTFF
047420110705     c                   movel     nodi          atrCUP
047430110705     C                   ELSE
047440110705     c                   clear                   atrCUP
047450110705     C                   ENDIF
047460110706     c                   clear                   wcupcup
047470110706     c                   clear                   wcupcig
047480141201     c                   clear                   wpincode
047490130311
047500130311     c                   clear                   wvatpe
047510160323     c                   clear                   wtip
047520160323     c                   clear                   w_vediP
047530900427     C                   ENDSR
047540070831     C*
047550070831     C* inizializzazione campo data ritiro --------------------------*
047560070831     C     inzdrt        BEGSR
047570070831     c* data ritiro=udate se data ritiro non personalizzata
047580070831     C  N12PARTCH        IFNE      'P'
047590070831     C     §LPFPR        ANDNE     'O'
047600071107     c***  dateu         andge     §vpodrt
047610070831     c                   if        atrdrt<>prri or viddrt=0
047620070831     C                   MOVEL     WDTGIO        VIDDRT
047630070831     c                   endif
047640070831     c                   endif
047650070831     c                   endsr
047660940819     C*
047670940819     C* GESTIONE VIDEATA DI PERSONALIZZAZIONE -----------------------*
047680050118     C     GESD00        BEGSR
047690940824     C                   MOVEL     'P'           WPERSO            1
047700940819     C*
047710941230     C                   CLEAR                   V0CRSM
047720941230     C                   CLEAR                   V0CINM
047730941230     C                   CLEAR                   V0CCAM
047740941230     C                   CLEAR                   V0CLOM
047750941230     C                   CLEAR                   V0CPRM
047760941230     C                   CLEAR                   V0CNZM
047770941230     C                   CLEAR                   V0CPIM
047780061109     C                   CLEAR                   V0Ccdf
047790061109     c                   movel     hiul          atrcdf
047800941230     C                   CLEAR                   V0CFAP
047810941230     C                   CLEAR                   V0CLNA
047820941230     C                   CLEAR                   V0CCBO
047830941230     C                   CLEAR                   V0CTSP
047840941230     C                   CLEAR                   V0CCTM
047850941230     C                   CLEAR                   V0CCCM
047860941230     C                   CLEAR                   V0CFLC
047870941230     C                   CLEAR                   V0CCTR
047880941230     C                   CLEAR                   V0CNAS
047890040610     C                   CLEAR                   V0Cbva
047900941230     C                   CLEAR                   V0CTCR
047910941230     C                   CLEAR                   V0CDCR
047920941230     C                   CLEAR                   V0CHCR
047930941230     C                   CLEAR                   V0CMCR
047940941230     C                   CLEAR                   V0CRMO
047950941230     C                   CLEAR                   V0CNMO
047960941230     C                   CLEAR                   V0CCMO
047970960319     C                   CLEAR                   V0CGC1
047980960319     C                   CLEAR                   V0CGC2
047990010209     C                   CLEAR                   V0CNOR
048000010209     C                   CLEAR                   V0CNRV
048010030409     c                   Clear                   V0cOre
048020050426     c***                clear                   v0cpdr
048030050426     c***                clear                   v0cfpp
048040940819     C* MUOVO TUTTI I CAMPI DAL VIDEO 1 PER LA PERSONALIZZAIZONE
048050941230     C* SOLO SE LI AVEVO PERSONALI<ZZATI E QUELLI CHE RIMANGONO
048060941230     C*  SEMPRE IMPOSTATI
048070941230     C                   MOVEL     VIDSOP        V0CSOP
048080010502     C* NON IMPOSTO, NELLA VIDEATA DI PERSONALIZZAZIONE LA RICERCA ALFA
048090010502     C* BETICA SU PADRONCINO SE ATTIVATA PROCEDURA ORM
048100050426     c***  atrpdr        ifeq      prri
048110050426     C     WORM          IFNE      'S'
048120050426     C     VIDPDR        ORNE      '?   '
048130940819     C                   MOVEL     VIDPDR        V0CPDR
048140050426     c***                clear                   vidpdr
048150010502     C                   ENDIF
048160050426     c***  atrfpp        ifeq      prri
048170050126     C                   MOVEL     VIDFPP        V0CFPP
048180050426     c***                clear                   vidfpp
048190050426     c***                endif
048200940819     C                   MOVEL     VIDNRT        V0CNRT
048210940819     C                   MOVEL     VIDLNP        V0CLNP
048220010222     C                   Z-ADD     VIDPOE        V0CPOE
048230010222     C   37              Z-ADD     VIDNOR        V0CNOR
048240041108     C   37              Z-ADD     VIDNRV        V0CNRV
048250070828     c***37              movel     atrdaorm      at0daorm
048260070828     c                   movel     nodi          at0daorm
048270071107     c***                if        dateu>=§vpodrt
048280070828     c                   clear                   viddrt
048290071107     c***                endif
048300041220     c                   z-add     vidpoe        s_v0cpoe
048310041220     c                   z-add     vidnor        s_v0cnor
048320041220     c                   z-add     vidnrv        s_v0cnrv
048330050315     C   37              MOVE      'P'           s_ormpers
048340050315     C  N37              MOVE      ' '           s_ormpers
048350010222     C   37              CLEAR                   VIDPOE
048360010222     C   37              CLEAR                   VIDNOR
048370010222     C   37              CLEAR                   VIDNRV
048380941230     C   20              MOVEL     VIDLNA        V0CLNA
048390941231     C   20              CLEAR                   VIDLNA
048400941230     C   21              MOVEL     VIDCBO        V0CCBO
048410941231     C   21              CLEAR                   VIDCBO
048420941230     C   18              MOVEL     VIDTSP        V0CTSP
048430941231     C   18              CLEAR                   VIDTSP
048440941230     C   26              MOVEL     VIDCTM        V0CCTM
048450941231     C   26              CLEAR                   VIDCTM
048460950125     C     *IN19         IFEQ      *ON
048470950303     C     *IN85         OREQ      *ON
048480950125     C                   MOVEL     VIDCCM        V0CCCM
048490950125     C                   CLEAR                   VIDCCM
048500050120     c***                clear                   viddmt
048510950125     C                   MOVEL     VIDFLC        V0CFLC
048520950125     C                   CLEAR                   VIDFLC
048530950303     C                   ENDIF
048540941221     C* SE NON E' UN CODIFICATO, IMPOSTO IL MITTENTE COSI' COME E'
048550950303     C     *IN19         IFEQ      *ON
048560020507     C     V0CCCM        ifeQ      8888
048570950125     C     V0CCCM        OREQ      9999
048580940819     C                   MOVEL     VIDRSM        V0CRSM
048590940819     C                   MOVEL     VIDINM        V0CINM
048600940819     C                   MOVEL     VIDLOM        V0CLOM
048610940819     C                   MOVEL     VIDCAM        V0CCAM
048620940819     C                   MOVEL     VIDPRM        V0CPRM
048630940819     C                   MOVEL     VIDNZM        V0CNZM
048640940819     C                   MOVEL     VIDFAP        V0CFAP
048650940819     C                   MOVEL     VIDPIM        V0CPIM
048660061109     C                   MOVEL     VIDcdf        V0Ccdf
048670950125     C                   ENDIF
048680941231     C                   CLEAR                   VIDRSM
048690941231     C                   CLEAR                   VIDINM
048700941231     C                   CLEAR                   VIDLOM
048710941231     C                   CLEAR                   VIDCAM
048720941231     C                   CLEAR                   VIDPRM
048730941231     C                   CLEAR                   VIDNZM
048740941231     C                   CLEAR                   VIDFAP
048750941231     C                   CLEAR                   VIDPIM
048760061109     C                   CLEAR                   VIDcdf
048770941230     C                   ENDIF
048780941230     C   28              MOVEL     VIDFTM        V0CFTM
048790941231     C   28              CLEAR                   VIDFTM
048800941230     C   27              MOVEL     VIDNAS        V0CNAS
048810941231     C   27              CLEAR                   VIDNAS
048820040610     c     atrbva        ifeq      prri
048830040610     C                   MOVEL     VIDbva        V0Cbva
048840040610     C                   CLEAR                   VIDbva
048850040610     c                   endif
048860941230     C   17              MOVEL     VIDTCR        V0CTCR
048870941231     C   17              CLEAR                   VIDTCR
048880941230     C   16              MOVEL     VIDDCR        V0CDCR
048890941231     C   16              CLEAR                   VIDDCR
048900941230     C   23              MOVEL     VIDHCR        V0CHCR
048910941230     C   23              MOVEL     VIDMCR        V0CMCR
048920941231     C   23              CLEAR                   VIDHCR
048930941231     C   23              CLEAR                   VIDMCR
048940030409     c                   If        wflagore = '1'
048950030409     c                   Eval      V0cOre = VidOre
048960030409     c                   Clear                   VidOre
048970030409     c                   EndIf
048980941230     C   03              MOVEL     VIDRMO        V0CRMO
048990941230     C   03              MOVEL     VIDNMO        V0CNMO
049000941231     C   03              CLEAR                   VIDRMO
049010941231     C   03              CLEAR                   VIDNMO
049020941230     C   03              MOVEL     VIDCMO        V0CCMO
049030941231     C   03              CLEAR                   VIDCMO
049040950206     C   29              MOVEL     VIDCTR        V0CCTR
049050950206     C   29              CLEAR                   VIDCTR
049060960319     C     *IN91         IFEQ      *ON
049070960319     C                   MOVEL     VIDGC1        V0CGC1
049080960319     C                   CLEAR                   VIDGC1
049090960319     C                   MOVEL     VIDGC2        V0CGC2
049100960319     C                   CLEAR                   VIDGC2
049110960319     C                   ENDIF
049120050119     C                   MOVEL     *BLANKS       VIDDMT
049130940819     C*
049140990720     C* SPENGO GLI INDICATORI DI PROTEZIONE DELLA VIDEATA DELLE PERSON
049150990719     C*  CHE SERVONO PER LA PROCEDURA PREPAGATI
049160990719     C     PARTCH        IFNE      'P'
049170010307     C     §LPFPR        ANDNE     'O'
049180990720     C                   SETOFF                                       2426
049190990719     C                   ENDIF
049200990720     C                   SETOFF                                       19
049210041214     C* ABILITA LA RICERCA ALFABETICA
049220041214     C                   SETON                                        01
049230041214     C                   SETOFF                                       1438
049240990719     C**
049250940819     C     FORD00        TAG
049260041109     c****               z-add     v0cnrv        v0cnrvv
049270071107     c****               if        dateu>=§vpodrt
049280070828     c                   clear                   atrdrt
049290071107     c****               endif
049300940819     C                   EXFMT     LS01D00
049310041109     c****               z-add     v0cnrvv       v0cnrv
049320940819     C* CMD3 - FINE LAVORO
049330940819     C   KC              GOTO      ENDG00
049340010219     C* CMD14 - INTERROGAZIONE O.R.M.
049350010223     C     *INKH         IFEQ      *ON
049360010226     C     WORM          ANDEQ     'S'
049370010227     C     PARTCH        ANDNE     'P'
049380010220     C     V0CNOR        ANDEQ     *ZEROS
049390111123     c* se lnp import continuo a richiamare FIOR04R
049400111123     c****               if        %lookup(v0clnp:fio)=0
049410111123     c*****                        and %lookup(999:fio)=0
049420111123     c                   if        v0clnp>pr0lnp
049430111123     c                   clear                   og143
049440111123     C     v0clnp        CHAIN     AZORG01L      UNIORG
049450111123     c                   if        %found(azorg01l)
049460111123     C                   MOVEL     ORGDE3        OG143
049470111123     c                   endif
049480111123     c                   eval      pr0lnp=v0clnp
049490111123     c                   endif
049500111123     c                   if        §ogntw='DPD' or §ogntw='EEX' or
049510111123     c                             §ogntw='FED'
049520150928     C                   CLEAR                   fior010ds
049530150928     C                   MOVEL     '1'           Ior010ric
049540150928     C                   Z-ADD     V0CLNP        ior010por
049550051207     c
049560150928     C                   CALL      'FIOR010R'
049570150928     C                   PARM                    KPJBA
049580150928     C                   PARM                    fior010ds
049590150928     C     OOR010F03     IFEQ      *BLANKS
049600150928     C     OOR010F12     andeq     *BLANKS
049610150928     C     OOR010err     andeq     *BLANKS
049620150928     C                   Z-ADD     OOR010POE     V0CPOE
049630150928     C                   MOVEL     OOR010NSR     V0CNOR
049640150928     C                   MOVE      OOR010NOR     V0CNOR
049650150928     C                   Z-ADD     OOR010NRV     V0CNRV
049660050117     c                   eval      *inkh = '0'
049670050117     c                   else
049680010226     C                   GOTO      FORD00
049690050117     c                   endif
049700110419     c                   else
049710110419     c                   if        v0cpdr<=*zeros
049720110419     c                   eval      *in90='1'
049730110419     c                   eval      *in56='1'
049740110419     c                   eval      vidmsg=err(210)
049750110419     c                   goto      ford00
049760110419     c                   else
049770110419     c                   clear                   fior58ds
049780110419     c                   movel     v0clnp        ior58pdr
049790110419     c                   move      v0cpdr        IOR58PDR
049800110419     C                   CALL      'FIOR58R'
049810110419     C                   PARM                    KPJBA
049820110419     C                   PARM                    fior58ds
049830110419     C     OOR58F03      IFEQ      *BLANKS
049840110419     C                   Z-ADD     OOR58POE      V0cPOE
049850110419     C                   MOVEL     OOR58NSR      V0cNOR
049860110419     C                   MOVE      OOR58NOR      V0cNOR
049870110419     C                   Z-ADD     OOR58NRV      V0cNRV
049880110419     c                   eval      *inkh = '0'
049890110419     c                   else
049900110419     C                   GOTO      FORd00
049910110419     c                   endif
049920110419     c                   endif
049930110419     c                   endif
049940010226     C                   ENDIF
049950010227     C* PER MANCANZA DI INDICATORI L'F8 E' SEMPRE ABILITATO ANCHE
049960010227     C* SE NON SEMPRE VISUALIZZATO. PER CMD8 E PROCEDURA NON ATTIVATA
049970010227     C* O SONO NEL GIRO DEI MIEI PREPAGATI RIEMETTO SEMPRE LA VIDEATA
049980010227     C   KHWORM          IFNE      'S'
049990010227     C     PARTCH        OREQ      'P'
050000010227     C                   GOTO      FORD00
050010010227     C                   ENDIF
050020940819     C*
050030940819     C* CONTROLLO CAMPI PERSONALIZZATI
050040940819     C                   EXSR      CTRD00
050050940929     C     WEMFOR        IFEQ      '1'
050060040908     c* Se no Errori ma non premuto F6 riemetto la videata
050070040908     c     *inkf         oreq      *off
050080940929     C                   GOTO      FORD00
050090940929     C                   ENDIF
050100041220     c* SOLO SE CAMBIATO ORM:
050110041220     c* pulisco la prima videata per essere sicura che
050120041220     c* non rimangano impostati campi del precedente orm ma non giusti per i
050130041220     c* l nuovo ORM
050140050315     c                   if        s_v0corm <> v0corm and (v0corm1 > 0 or
050150050315     c                             s_ormpers='P')
050160041220     c                   exsr      inz01
050170041220     c                   endif
050180070831     c
050190070831     c* Se non è cambiato l'ORM ma la data ritiro è = 0 forzo comunque
050200070831     c* data ritiro=udate
050210070831     c                   if        viddrt=0
050220070831     c                   exsr      inzdrt
050230070831     c                   endif
050240070831     c
050250940819     C*
050260940819     C* MUOVO TUTTI I CAMPI CHE HO PERSONALIZZATO
050270041129     c*
050280940819     C                   MOVEL     V0CSOP        VIDSOP
050290050426     c***  atrpdr        ifeq      prri
050300940819     C                   MOVEL     V0CPDR        VIDPDR
050310050426     c***                endif
050320070806     c                   movel     at0daorm      atrdaorm
050330011122     C* SE SONO IN IMMISSIONE PREPAGATI NON DEVO METTERE "?" IN QUANTO
050340011122     C* IN QUESTO CASO IL CODICE AUTOTRASPORTATORE NON E' DA IMMETTERE
050350011122     C  N34V0CPDR        IFEQ      *BLANKS
050360010502     C     WORM          ANDEQ     'S'
050370010502     C                   MOVEL     '?   '        VIDPDR
050380050128     c                   clear                   v1dpdr
050390010502     C                   ENDIF
050400960926     C* SE HO GIA' INSERITO IL AUTOTRASPORTATORE MI POSIZIONO SOTTO
050410950206     C     V0CPDR        IFGT      *ZEROS
050420010222     C     WORM          IFEQ      'S'
050430010222     C     PARTCH        ANDNE     'P'
050440010307     C     §LPFPR        ANDNE     'O'
050450010222     C                   SETON                                        06
050460010222     C                   ELSE
050470950206     C                   SETON                                        07
050480010222     C                   ENDIF
050490950206     C                   ENDIF
050500940819     C                   MOVEL     V0CNRT        VIDNRT
050510050426     c***  atrfpp        ifeq      prri
050520940819     C                   MOVEL     V0CFPP        VIDFPP
050530050426     c***                endif
050540940819     C                   MOVEL     V0CLNP        VIDLNP
050550010222     C                   Z-ADD     V0CPOE        VIDPOE
050560010222     C   37              Z-ADD     V0CNOR        VIDNOR
050570010222     C   37              Z-ADD     V0CNRV        VIDNRV
050580941230     C   20              MOVEL     V0CLNA        VIDLNA
050590941230     C   21              MOVEL     V0CCBO        VIDCBO
050600941230     C   18              MOVEL     V0CTSP        VIDTSP
050610941230     C   26              MOVEL     V0CCTM        VIDCTM
050620941230     C*
050630941230     C     *IN19         IFEQ      *ON
050640950303     C     *IN85         OREQ      *ON
050650941230     C                   MOVEL     V0CCCM        VIDCCM
050660941230     C                   MOVEL     V0CFLC        VIDFLC
050670941011     C     V0CFLC        IFNE      0
050680941020     C                   SETON                                        14
050690941011     C                   ENDIF
050700950303     C                   ENDIF
050710940825     C*
050720940825     C* IMPOSTO I CAMPI DEL MITTENTE SE PERSONALIZZATO
050730061109    1C     *IN19         IFEQ      *ON
050740061109    2C     V0CINM        IFEQ      *BLANKS
050750940825     C                   MOVEL     ACORAG        VIDRSM
050760940825     C                   MOVEL     ACORAG        VIDDMT
050770940825     C                   MOVEL     INDVIA        VIDINM
050780941005     C                   MOVEL     INDCAE        VIDCAM
050790940825     C                   MOVEL     INDCIT        VIDLOM
050800940825     C                   MOVEL     INDPRV        VIDPRM
050810940825     C                   MOVEL     INDSTA        VIDNZM
050820940825     C                   MOVEL     INDIVA        WISO
050830950125     C     WISO          IFGE      '00'
050840940825     C                   MOVEL     INDIVA        VIDCPM
050850120504     C                   clear                   VIDism
050860940825     C                   ELSE
050870940825     C                   MOVEL     INDIVA        VIDPIM
050880940825     C                   ENDIF
050890120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
050900120508     c* in contabilità crea problemi
050910120508     c                   if        *in22 and wiso='$$'
050920120508     c                   clear                   vidpim
050930120508     c                   endif
050940061110     c   22              movel     indcdf        vidcdf
050950941230     C*
050960061109   x2C                   ELSE
050970941230     C*
050980941230     C                   MOVEL     V0CRSM        VIDRSM
050990941230     C                   MOVEL     V0CINM        VIDINM
051000941230     C                   MOVEL     V0CLOM        VIDLOM
051010941230     C                   MOVEL     V0CCAM        VIDCAM
051020941230     C                   MOVEL     V0CPRM        VIDPRM
051030941230     C                   MOVEL     V0CNZM        VIDNZM
051040941230     C                   MOVEL     V0CFAP        VIDFAP
051050941230     C                   MOVEL     V0CPIM        VIDPIM
051060061109     C                   CLEAR                   VIDcdf
051070071023     c                   eval      w_callyco=' '
051080071023     c* Codice fiscale: se non c'e' effettuo la ricerca
051090061110    3c   22              if        v0ccdf<>*BLANKS
051100061109     C                   MOVEL     V0Ccdf        VIDcdf
051110061109   x3C                   ELSE
051120061109    4c                   if        vidnzm=*blanks
051130061110     c* richiamo pgm di richiesta
051140071023     c****               EXSR      CAlLyco
051150071023     c                   eval      w_callyco='1'
051160061109     c
051170061109    4C                   endif
051180061109    3C                   endif
051190071023     c* Partita Iva: se non c'e' effettuo la ricerca
051200071023    3c   22              if        vidpim=*BLANKS and vidnzm=*blanks
051210071023     c* memorizzo di richiamare pgm di richiesta
051220071023     c                   eval      w_callyco='1'
051230071023    3C                   endif
051240071023
051250120503     c                   if        w_callyco='1'
051260120503     c                   exsr      CALLyco
051270120503     c                   endif
051280061109     c
051290061109    2C                   ENDIF
051300061109     c* proteggo il campo del codice fiscale
051310061109     c                   movel     riul          atrcdf
051320061109    1C                   ENDIF
051330941230     C* IMPOSTO SOLO QUELLI PESONALIZZATI, GLI ALTRI LI LASCIO
051340941230     C*  COME SONO
051350950206     C   29              MOVEL     V0CCTR        VIDCTR
051360950206     C   28              MOVEL     V0CFTM        VIDFTM
051370941230     C   27              MOVEL     V0CNAS        VIDNAS
051380040610     c     atrbva        ifeq      prri
051390040610     c                   movel     v0cbva        vidbva
051400040610     c                   endif
051410941230     C   17              MOVEL     V0CTCR        VIDTCR
051420941230     C   16              MOVEL     V0CDCR        VIDDCR
051430941230     C   23              MOVEL     V0CHCR        VIDHCR
051440941230     C   23              MOVEL     V0CMCR        VIDMCR
051450030409     c                   If        wflagore = '1'
051460030409     c                   Eval      VidOre = V0cOre
051470030409     c                   EndIf
051480941230     C   03              MOVEL     V0CRMO        VIDRMO
051490941230     C   03              MOVEL     V0CNMO        VIDNMO
051500941230     C   03              MOVEL     V0CCMO        VIDCMO
051510960319     C   91              MOVEL     V0CGC1        VIDGC1
051520960319     C   91              MOVEL     V0CGC2        VIDGC2
051530940824     C* FINE PERSONALIZZAZIONE
051540940921     C                   SETOFF                                       01
051550940824     C                   MOVEL     ' '           WPERSO            1
051560940819    2C     ENDG00        ENDSR
051570061110     c*
051580061110     c* RICHIAMO PGM DI RICERCA COD FISCALE X 8888 O 9999-----------------*
051590061110     c     CALLYCO       BEGSR
051600061110     c                   eval      i600ela='R'
051610071023     c                   if        vidcdf=*blanks
051620061110     c                   eval      i600aCF='SI'
051630071023     c                   endif
051640071023     c                   if        vidpim=*blanks
051650071023     c                   eval      i600api='SI'
051660071023     c                   endif
051670061110     c     *iso          movel     20000101      i600dti
051680061110     c     *iso          movel     29991231      i600dtf
051690061110     c                   eval      i600rsc=vidrsm
051700061110     c                   eval      i600ind=vidinm
051710061110     c                   eval      i600cap=vidcam
051720061110     c                   eval      i600loc=vidlom
051730061110     c                   eval      i600prv=vidprm
051740061110     c                   movel     yco600ds      kpjbu
051750061110     c                   call      'YCO601R'
051760061110     c                   parm                    kpjba
051770061110     c
051780061110     c                   movel     kpjbu         yco600ds
051790061110    5c                   if        o600err=*blanks
051800071023     c                   if        vidcdf=*blanks
051810061110     c                   movel     o600cdfi      vidcdf
051820071023     c                   endif
051830071023     c                   if        vidpim=*blanks
051840071023     c                   movel     o600piva      wpiva
051850071023     c                   exsr      sr_wpiva
051860120508     c* Se partita iva $$ la puilisco: crea problemi in contabilità
051870120508     c                   if        vidism='$$'
051880120508     c                   clear                   vidpim
051890120508     c                   endif
051900071023     c                   endif
051910061110    5c                   endif
051920061110     c                   ENDSR
051930900427     C*
051940900427     C*--- CONTROLLO CAMPI PERSONALIZZAZIONE -------------------------*
051950940819     C     CTRD00        BEGSR
051960941115     C                   CLEAR                   VIDMSG
051970941103     C                   CLEAR                   WCMO
051980941103     C                   CLEAR                   WNAR
051990940824     C                   CLEAR                   WCBO
052000940824     C                   CLEAR                   WLNP
052010940824     C                   CLEAR                   WPDR
052020940824     C                   CLEAR                   WLNA
052030940824     C                   CLEAR                   WCTM
052040940824     C                   CLEAR                   WCCM
052050940825     C                   CLEAR                   WFTM
052060940824     C                   CLEAR                   WTSP
052070960319     C                   CLEAR                   WGC1
052080960319     C                   CLEAR                   WGC2
052090940929     C                   SETOFF                                       90
052100941003     C* SPENGO GLI INDICATORI DI PERSONALIZZAZIONE
052110941004     C                   SETOFF                                       161710
052120941103     C                   SETOFF                                       181903
052130990720     C                   SETOFF                                       202123
052140941003     C                   SETOFF                                       272829
052150990720     C                   SETOFF                                       859119
052160010222     C                   SETOFF                                       37
052170030409     c                   Clear                   wflagore
052180040610     c                   movel     hiul          atrbva
052190050426     c****               clear                   atrpdr
052200050426     c****               clear                   atrfpp
052210070829     c                   clear                   atrdrt
052220990602     C* GLI INDICATORI DELLA DATA E CTM LI SPENGO SOLO SE
052230990602     C*  NON PROVENGO DA PREPAGATI
052240990602     C     PARTCH        IFNE      'P'
052250010307     C     §LPFPR        ANDNE     'O'
052260990720     C                   SETOFF                                       2426
052270990602     C                   ENDIF
052280940929     C* SPENGO GLI INDICATORI DI POSIZONAMENTO CURSORE
052290940929     C                   SETOFF                                       404142
052300940929     C                   SETOFF                                       435645
052310940929     C                   SETOFF                                       464748
052320940929     C                   SETOFF                                       495051
052330940929     C                   SETOFF                                       525354
052340940929     C                   SETOFF                                       556870
052350940929     C                   SETOFF                                       585960
052360960319     C                   SETOFF                                       616274
052370040611     c                   clear                   h0riga
052380040611     c                   clear                   h0colo
052390030411     c                   Clear                   At0Tcr
052400030415     c                   Clear                   At0Ore
052410940929     C                   CLEAR                   WEMFOR
052420950504     C                   CLEAR                   DS3A
052430950209     C***
052440950209     C*** RICERCA ALFABETICA
052450950209     C                   MOVEL     V0CLNP        WLNP
052460950209     C                   Z-ADD     V0CCCM        WCCM
052470950209    2C     V0CFLC        IFNE      0
052480950209     C                   Z-ADD     V0CFLC        WFLC
052490950209     C                   ELSE
052500950209     C                   Z-ADD     V0CLNP        WFLC
052510950209    2C                   ENDIF
052520950209     C                   MOVEL(P)  V0CRSM        PAXDMT
052530050119     C                   CLEAR                   VIDDMT
052540950209     C* ESEGUO RICERCA ALFABETICA
052550950209     C                   EXSR      RICALF
052560950209     C                   MOVE      WCCM          V0CCCM
052570950209     C     *IN14         IFEQ      *ON
052580950209     C                   MOVEL     WFLC          V0CFLC
052590950209     C                   ENDIF
052600940822     C***
052610910208     C*** DATA SPEDIZIONE ***
052620930708     C                   EXSR      CTRDSP
052630001031     C   90              GOTO      ENDC00
052640940920     C***
052650940920     C*** SIGLA OPERATORE ***
052660940920     C* CONTROLLO SOLO SE NON E' PROTETTO
052670940928    1C     *IN13         IFEQ      *OFF
052680940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
052690940920     C                   MOVEL     '3M'          COD
052700940920     C                   MOVEL(P)  V0CSOP        KEY
052710940920     C                   EXSR      CTABEL
052720940928    2C     *IN30         IFEQ      *OFF
052730950713     C     V0CSOP        OREQ      ' '
052740940920     C                   MOVEL     ERR(29)       VIDMSG
052750940920     C                   SETON                                        4290
052760940920     C                   GOTO      ENDC00
052770940928    2C                   ENDIF
052780940928    1C                   ENDIF
052790940822     C***
052800940824     C*** DATA RITIRO MERCE ***
052810070806     C***                EXSR      CTRDRT
052820070806     C***90              GOTO      ENDC00
052830940822     C***
052840940819     C*** LINEA PARTENZA ***
052850940928     C                   MOVEL     V0CLNP        WLNP
052860940824     C                   EXSR      CTRLNP
052870940824     C   90              GOTO      ENDC00
052880010213     C***
052890010213     C*** NUMERO O.R.M.
052900010213     C*
052910010213     C* Controllo solo se attivata procedura O.R.M.
052920010213     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
052930010213     c* fine dell'immissione
052940010213     C     WORM          IFEQ      'S'
052950010213     C     PARTCH        ANDNE     'P'
052960010213     C                   Z-ADD     V0CPOE        WOPOE
052970010213     C                   Z-ADD     V0CNOR        WONOR
052980010213     C                   Z-ADD     V0CNRV        WONRV
052990010213     C                   Z-ADD     V0CLNP        WOLNP
053000010222     C     WIDOR1        IFGT      *ZEROS
053010010213     C                   EXSR      CTRORM
053020010213     C   90              GOTO      ENDC00
053030010216     C     WEMFOR        IFEQ      '1'
053040010216     C                   GOTO      ENDC00
053050010216     C                   ENDIF
053060010222     C                   ENDIF
053070010213     C                   ENDIF
053080010227     C* SE PREMUTO F8 E SONO NEL GIRO DEI PREPAGATI DEVO RIEMETTERE LA
053090010227     C* VIDEATA
053100010227     C   KH              GOTO      ENDC00
053110070806     c***
053120070806     C*** DATA RITIRO MERCE ***
053130070806     c* se orm non fittizio forzo data ritiro prendendola da ORM
053140070806     c                   if        flgfit <> 'S' and widor1>*zeros
053150071107     c*****                        and dateu>=§vpodrt
053160070828     c                   clear                   weform
053170070806     c                   exsr      fordrt
053180070831     c                   if        weform='1'
053190070831     c                   eval      wemfor='1'
053200070828     c                   goto      endc00
053210070828     c                   endif
053220070806     c                   endif
053230070828     c* se orm fittizio non controllo la data ritiro se non immessa
053240070905     c***                if        flgfit='S' and widor1>*zeros and viddrt=0
053250070905     c***                          and dateu>=§vpodrt
053260070905     c***                else
053270070806     C                   EXSR      CTRDRT
053280070806     C   90              GOTO      ENDC00
053290070905     c***                endif
053300070831     c* se immesso orm  proteggo la data ritiro
053310070831     c                   if        widor1>*zeros and viddrt>0
053320071107     c****                         and dateu>=§vpodrt
053330070828     c                   eval      atrdrt=prri
053340070828     c                   endif
053350940822     c***
053360960926     C*** CODICE AUTOTRASPORTATORE ***
053370940928    1C     V0CPDR        IFNE      *BLANKS
053380940824     C     V0CPDR        ANDNE     *ZEROS
053390940824     C*
053400940928     C                   MOVE      V0CPDR        WPDR
053410940824     C                   EXSR      CTRPDR
053420940915     C                   MOVE      WPDR          V0CPDR
053430940928    2C     WEMFOR        IFEQ      '1'
053440940824     C                   GOTO      ENDC00
053450940928    2C                   ENDIF
053460050126     c*
053470050426     c***                movel     prri          atrpdr
053480940824     C*
053490940928    1C                   ENDIF
053500050126     c*** FLAG MATTINO/POMERIGGIO  ***
053510050426     c***  v0cfpp        ifne      *blanks
053520050426     c***                movel     prri          atrfpp
053530050426     c***                endif
053540940822     C***
053550940822     C*** CODICE BOLLA ***
053560940928    1C     V0CCBO        IFNE      *BLANKS
053570940824     C*
053580940824     C                   MOVEL     V0CCBO        WCBO
053590940824     C                   EXSR      CTRCBO
053600940824     C                   MOVEL     WCBO          V0CCBO
053610940928    2C     WEMFOR        IFEQ      '1'
053620940824     C                   GOTO      ENDC00
053630940928    2C                   ENDIF
053640940824     C*
053650940928    1C                   ENDIF
053660940822     C***
053670940822     C*** LINEA ARRIVO ***
053680940824     C                   MOVEL     V0CLNA        WLNA
053690110217     C                   EXSR      CTRLNA_vid
053700940824     C                   MOVEL     WLNA          V0CLNA
053710940928    1C     WEMFOR        IFEQ      '1'
053720940824     C                   GOTO      ENDC00
053730940928    1C                   ENDIF
053740940824     C***
053750940822     C*** TIPO SERVIZIO ***
053760940824     C                   MOVEL     V0CTSP        WTSP
053770940824     C                   EXSR      CTRTSP
053780940824     C                   MOVEL     WTSP          V0CTSP
053790940928    1C     WEMFOR        IFEQ      '1'
053800940824     C                   GOTO      ENDC00
053810940928    1C                   ENDIF
053820940824     C***
053830940822     C*** CODICE TRATTAMENTO MERCE ***
053840940928     C* CONTROLLO SOLO SE IMMESSO
053850950504    1C     V0CCTM        IFNE      *BLANKS
053860940824     C                   MOVEL     V0CCTM        WCTM
053870940824     C                   EXSR      CTRCTM
053880940824     C                   MOVEL     WCTM          V0CCTM
053890950504    2C     WEMFOR        IFEQ      '1'
053900940824     C                   GOTO      ENDC00
053910950504    2C                   ENDIF
053920040611     c                   ENDIF
053930040611     c*** TIPO MERCE V-VALORE
053940040611     c     v0cbva        ifne      *blanks
053950040611     c     v0cctm        ifne      *blanks
053960040611     c     §1bfg8        andeq     'N'
053970040611     c                   Eval      *In90 = *On
053980040611     c                   Eval      VidMsg = Err(281)
053990040611     c                   z-add     21            H0riga
054000040611     c                   z-add     73            H0colo
054010040611     c                   GoTo      EndC00
054020040611     c                   endif
054030040611     c                   movel     prri          atrbva
054040040611     c                   endif
054050040611     C* PERSONALIZZAZIONE CTM
054060040611    1C     V0CCTM        IFNE      *BLANKS
054070950504     C                   SETON                                        26
054080950504     C                   MOVEL     TBLUNI        V1DCTM
054090940928    1C                   ENDIF
054100940822     C*
054110940822     C*** CODICE CLIENTE ***
054120940928    1C     V0CCCM        IFNE      0
054130940824     C     V0CRSM        ORNE      *BLANKS
054140940824     C*
054150940825     C                   MOVEL     V0CFTM        WFTM
054160940915     C                   Z-ADD     V0CCCM        WCCM
054170940928    2C     V0CFLC        IFNE      0
054180940915     C                   Z-ADD     V0CFLC        WFLC
054190940921     C                   ELSE
054200940921     C                   Z-ADD     V0CLNP        WFLC
054210940928    2C                   ENDIF
054220940920     C                   MOVEL(P)  V0CRSM        PAXDMT
054230050120     C                   CLEAR                   VIDDMT
054240950127     C*
054250940824     C                   EXSR      CTRCCM
054260950127     C*
054270940915     C                   MOVE      WCCM          V0CCCM
054280941011     C     *IN14         IFEQ      *ON
054290941011     C                   MOVEL     WFLC          V0CFLC
054300941011     C                   ENDIF
054310941011     C*
054320940928    2C     WEMFOR        IFEQ      '1'
054330940824     C                   GOTO      ENDC00
054340940928    2C                   ENDIF
054350950303     C*
054360950303   X1C                   ELSE
054370940825     C*
054380940825     C* SE CLIENTE A 0 NON IMMETTERE NEMMENO IL MITTENTE PER ESTESO
054390940928    2C     V0DMIT        IFNE      *BLANKS
054400940825     C                   MOVEL     ERR(25)       VIDMSG
054410940920     C                   SETON                                        5090
054420940825     C                   GOTO      ENDC00
054430940928    2C                   ENDIF
054440940928    1C                   ENDIF
054450940825     C***
054460940822     C*** CODICE TARIFFA MITTENTE ***
054470940825     C     V0CFTM        IFEQ      'S'
054480940822     C* SE IMMESSO DEVE ESISTERE IL CODICE MITTENTE
054490940822     C     V0CCCM        IFEQ      *ZEROS
054500940822     C                   MOVEL     ERR(24)       VIDMSG
054510940920     C                   SETON                                        5090
054520940822     C                   GOTO      ENDC00
054530940822     C                   END
054540940822     C* PERSONALIZZAZIONE
054550940822     C                   SETON                                        28
054560940822     C                   END
054570940825     C***
054580940825     C*** MITTENTE ****
054590940822     C* SOLO SE 8888 O 9999 O NON IMMESSO CLIENTE POSSO INDICARE IL MIT
054600950303    0C     V0DMIT        IFNE      *BLANKS
054610950303     C*
054620940909    1C     WCCM          IFEQ      8888
054630940909     C     WCCM          OREQ      9999
054640950303     C*
054650970703     C                   MOVEL     V0CRSM        I14RSC
054660970703     C                   CLEAR                   I14RS2
054670970703     C                   MOVEL     V0CINM        I14IND
054680970703     C                   MOVEL     V0CLOM        E14LOC
054690970703     C                   MOVEL     V0CPIM        E14PIP
054700970703     C                   MOVEL     V0CPRM        E14PRV
054710970703     C                   MOVEL     V0CNZM        E14NAR
054720970703     C                   MOVEL     V0CCAM        E14CAP
054730970704     C                   MOVEL     'M'           WCLI
054740061109     C                   MOVEL     v0ccdf        Wcdf
054750071022     C                   MOVEL     v0cpim        Wiva
054760970704     C                   EXSR      CTRIND
054770941020     C*
054780941020     C* CAMPI CHE POSSO AVER IMPOSTATO
054790970703     C                   MOVEL     E14LOC        V0CLOM
054800970703     C                   MOVEL     E14PIP        V0CPIM
054810970703     C                   MOVEL     E14PRV        V0CPRM
054820970703     C                   MOVEL     E14NAR        V0CNZM
054830970703     C                   MOVEL     E14CAP        V0CCAM
054840970704     C*
054850061109     c* Se errore sulla partita iva , visualizzo messaggio
054860061109     c                   if        xcfivaflg < *zeros
054870120503     c*****              if        wiva=*blanks and dateu>=§vpopiv
054880120504     c                   if        wcdf=*blanks or %subst(wcdf:12:1)=' '
054890071023     c                   z-add     16            H0riga
054900071022     c                   else
054910071023     c                   z-add     17            H0riga
054920071022     c                   endif
054930061109     c                   z-add     64            H0colo
054940061109     c                   endif
054950061109     c
054960970704     C     WEMFOR        IFEQ      '1'
054970970704     C     *IN90         OREQ      *ON
054980970704     C                   GOTO      ENDC00
054990970704     C                   ENDIF
055000040917     c* Segnalazione se inserito mittente estero
055010040917     c     wmitie        ifeq      'E'
055020040917     c     wcontmit      andeq     *blanks
055030040917     c                   movel     '1'           wcontmit
055040040917     c                   seton                                        90
055050040917     c                   z-add     16            h0riga
055060040917     c                   z-add     49            h0colo
055070040917     c                   movel     ERR(283)      vidmsg
055080040917     c                   goto      endc00
055090040917     c                   endif
055100941020     C**
055110950303     C                   SETON                                        1902
055120941110     C                   MOVEL     V0CRSM        VIDDMT
055130940930     C*
055140940930     C                   ELSE
055150940930     C*
055160940930     C* SE NON IMNMESSO CLIENTE O E' UN CODIFICATO PULISCO IL CAMPO
055170940930     C*  DEL CONTROLLO CAP VARIATO
055180940930     C                   CLEAR                   VARCAM
055190940930     C                   CLEAR                   OTT
055200940930    1C                   ENDIF
055210950303    0C                   ENDIF
055220930329     C*
055230930329     C**** CODICE TARIFFA ****
055240941107    1C     V0CCTR        IFNE      *BLANKS
055250050920     C                   CLEAR                   fnlv59ds
055260050920     C                   MOVEL     'S'           ilv59cfo
055270050920     C                   MOVEL     V0CCTR        ilv59ctr
055280050920     C                   CALL      'FNLV59R'
055290050920     C                   PARM                    fnlv59ds
055300941107     C* ERRORE
055310050920    2C     olv59msg      IFNE      *BLANKS
055320050920     C                   MOVEL     olv59msg      VIDMSG
055330941107     C                   SETON                                        9058
055340941107     C                   MOVEL     '1'           WEMFOR
055350941107     C                   GOTO      ENDC00
055360941107    2C                   ENDIF
055370940819     C*
055380050921     C                   MOVEL     olv59dfs      DEFCTR
055390930329     C                   SETON                                        29
055400941107    1C                   ENDIF
055410941103     C*
055420941103     C*** MITTENTE ORIGINALE ***
055430941110     C     V0CRMO        IFNE      *BLANKS
055440941110     C     V0CCMO        ORNE      *BLANKS
055450941103     C                   MOVEL     V0CRMO        WRMO
055460941103     C                   MOVEL     V0CCMO        WCMO
055470941103     C                   MOVEL     V0CNMO        WNAR
055480941103     C                   EXSR      CTRMO
055490941103     C                   MOVEL     WNAR          V0CNMO
055500941103     C     WEMFOR        IFEQ      '1'
055510941103     C                   GOTO      ENDC00
055520941103     C                   ENDIF
055530941110     C                   ENDIF
055540030415      * I dati relativi alla consegna richiesta
055550030411      * possono essere immessi solo se è stato inserito il codice cliente
055560030411      * mittente (no 8888/9999)
055570030411     c                   If        (V0cCcm = *Zeros or
055580030411     c                              V0cCcm = 8888   or  V0cCcm = 9999)   and
055590030411     c                             (V0cTcr <> *Blanks or V0cDcr > *Zeros or
055600030411     c                              V0cHcr >  *Zeros  or V0cMcr > *Zeros or
055610030411     c                              V0cOre >  *Zeros)
055620030411     c                   Eval      *In50 = *On
055630030411     c                   Eval      *In90 = *On
055640030411     c                   Eval      VidMsg = Err(18)
055650030416     c                   GoTo      EndC00
055660030411     c                   EndIf
055670960319     C***
055680930329     C*** CONSEGNA RICHIESTA ***
055690940913     C                   MOVEL     V0CDCR        WDCR
055700940913     C                   MOVEL     V0CHCR        WHCR
055710940913     C                   MOVEL     V0CMCR        WMCR
055720940913     C                   MOVEL     V0CTCR        WTCR
055730940913     C                   EXSR      CTRCR
055740940916     C                   MOVEL     WDCR          V0CDCR
055750940913     C   90              GOTO      ENDC00
055760030410      * o data consegna richiesta o n. ore
055770030409     c                   If        V0cOre > *Zeros
055780030411     c                   If        V0cTcr <> *Blanks
055790030411     c                   Movel     Rimm          At0Tcr
055800030411     c                   Eval      *In90 = *On
055810030411     c                   Eval      VidMsg = Err(276)
055820030411     c                   z-add     21            H0riga
055830030411     c                   z-add     14            H0colo
055840030411     c                   GoTo      EndC00
055850030411     c                   EndIf
055860030409     c                   If        V0cDcr > *Zeros
055870030409     c                   Eval      *In59 = *On
055880030409     c                   Eval      *In90 = *On
055890030409     c                   Eval      VidMsg = Err(276)
055900030409     c                   GoTo      EndC00
055910030409     c                   EndIf
055920030411     c                   If        V0cHcr > *Zeros or V0cMcr > *Zeros
055930030411     c                   Eval      *In60 = *On
055940030411     c                   Eval      *In90 = *On
055950030411     c                   Eval      VidMsg = Err(276)
055960030411     c                   GoTo      EndC00
055970030411     c                   EndIf
055980030415      * Si possono immettere solo 24 48 72 ore
055990030415     c                   If        V0cOre <> 24 and V0cOre <> 48 and
056000030415     c                             V0cOre <> 72
056010030415     c                   Movel     Rimm          At0Ore
056020030415     c                   Eval      *In90 = *On
056030030415     c                   Eval      VidMsg = Err(278)
056040030415     c                   z-add     23            H0riga
056050030415     c                   z-add     31            H0colo
056060030415     c                   GoTo      EndC00
056070030415     c                   EndIf
056080030409     c                   Eval      wflagore = '1'
056090030411     c                   Eval      *In17 = *On
056100030411     c                   Eval      *In16 = *On
056110030411     c                   Eval      *In23 = *On
056120030409     c                   EndIf
056130960319     C***
056140960319     C*** GIORNI DI CHIUSURA ***
056150960319     C                   MOVEL     V0CGC1        WGC1
056160960319     C                   MOVEL     V0CGC2        WGC2
056170960319     C                   EXSR      CTRGCH
056180960319     C   90              GOTO      ENDC00
056190930413     C*** NATURA MERCE ***
056200950112     C     V0CNAS        IFNE      *BLANKS
056210940825     C                   SETON                                        27
056220930329     C                   END
056230940824     C*
056240940824     C     ENDC00        TAG
056250940824     C   90              MOVEL     '1'           WEMFOR
056260940824     C                   ENDSR
056270940922     C*
056280940922     C* CALL AL PGM DI RICERCA TABELLE X§TABER -----------------------*
056290940922     C     CX§TAB        BEGSR
056300990915     C                   CLEAR                   §KEY
056310940922     C                   CALL      'X§TABER'
056320940922     C                   PARM                    CODUT
056330940922     C                   PARM                    COD
056340940922     C                   PARM                    §KEY
056350940922     C                   PARM                    §DES             25
056360940922     C                   MOVEL     '1'           WEMFOR
056370940922     C                   ENDSR
056380940916     C*
056390940916     C* CONTROLLO DATA SPEDIZIONE ------------------------------------*
056400940916     C     CTRDSP        BEGSR
056410940916     C*
056420940916     C                   Z-ADD     VIDDSP        G02DAT
056430940916     C                   MOVEL     *BLANK        G02ERR
056440940916     C                   CALL      'XSRDA8'
056450940916     C                   PARM                    WLBDAT
056460940916     C* ERRATA
056470940916    1C     G02ERR        IFEQ      '1'
056480940920     C                   SETON                                        41  90
056490950920     C* PREPARO L'ERRORE
056500950920     C                   MOVEA     ERR(2)        K78
056510950920     C     2             SUBST     DATAPG:1      W002A
056520950920     C                   MOVEA     W002A         K78(69)
056530950920     C                   MOVEL     '/'           K78(71)
056540950920     C     2             SUBST     DATAPG:3      W002A
056550950920     C                   MOVEA     W002A         K78(72)
056560950920     C                   MOVEL     '/'           K78(74)
056570950920     C     2             SUBST     DATAPG:7      W002A
056580950920     C                   MOVEA     W002A         K78(75)
056590950920     C                   MOVEA     K78           VIDMSG
056600940916    1C                   ENDIF
056610940916     C*
056620940916     C* REIMPOSTO LA DATA SPEDIZIONEGGMMAA PRENDENDO L'ANNO A 4 SE NON
056630940916     C*  IMMESSO DA VIDEO
056640940916    1C     *IN90         IFEQ      *OFF
056650940928     C                   Z-ADD     G02DAT        VIDDSP
056660940916     C*
056670940916     C* IM MANUT O DISK NON SI PUO' CAMBIARE L'ANNO DI SPEDIZIONE
056680940916     C                   MOVE      VIDDSP        WAAS
056690940916    2C   12WAAS          IFNE      §LPAAS
056700940920     C                   SETON                                        4190
056710940916     C                   MOVEL     ERR(3)        VIDMSG
056720940916    2C                   ENDIF
056730940916    1C                   ENDIF
056740001121      *
056750001124      * SE SONO IN MANUTENZIONE DI UN PREPAGATO NON POSSO METTERE IN
056760001124      * SOSPENSIONE LA BOLLA SE CAMBIO MESE
056770001121    1C   22*IN90         IFEQ      *OFF
056780001124     C     PARTCH        ANDNE     'P'
056790010307     C     §LPFPR        ANDNE     'O'
056800001121     C                   MOVEL     BLPAAS        W0080             8 0
056810001121     C                   MOVE      BLPMGS        W0080
056820001121     C                   MOVEL     W0080         W0060             6 0
056830001121     C                   MOVEL     G02INV        W0060S            6 0
056840001121     C     W0060         IFLT      W0060S
056850001121     C                   SETON                                        4190
056860001121     C                   MOVEL     ERR(193)      VIDMSG
056870001121     C                   ENDIF
056880121017     c* Errore se data compresa nel range dal/al per blocco immissione
056890121017     c* prepagati (tabella "DGD")
056900121017     c***                if        *in90 = '0' and g02inv = §vpodip
056910121017     c                   if        *in90 = '0' and
056920121017     c                             g02inv>=§dgdbpd and g02inv<=§dgdbpa
056930050215     c                   Eval      VidMsg = 'Data non ammessa per spedizioni +
056940050215     c                             in Porto Prepagato'
056950050215     c                   seton                                        4190
056960050215     c                   endif
056970001121     C                   ENDIF
056980940916     C*
056990940916    1C     *IN90         IFEQ      *OFF
057000940916     C                   Z-ADD     G02INV        BLPDSP            8 0
057010950920     C* DATE SPEDIZIONE NO > DATA MAX DI SOSPENSIONE
057020950920    2C     BLPDSP        IFGT      DATAPA
057030940920     C                   SETON                                        4190
057040950920     C                   MOVEA     ERR(2)        K78
057050950920     C     2             SUBST     DATAPG:1      W002A
057060950920     C                   MOVEA     W002A         K78(69)
057070950920     C                   MOVEL     '/'           K78(71)
057080950920     C     2             SUBST     DATAPG:3      W002A
057090950920     C                   MOVEA     W002A         K78(72)
057100950920     C                   MOVEL     '/'           K78(74)
057110950921     C     2             SUBST     DATAPG:7      W002A
057120950920     C                   MOVEA     W002A         K78(75)
057130950920     C                   MOVEA     K78           VIDMSG
057140940916    2C                   ENDIF
057150940916    1C                   ENDIF
057160940916     C* PERSONALIZZAZIONE
057170940916    1C  N90WPERSO        IFEQ      'P'
057180940928     C     BLPDSP        ANDNE     DATEU
057190940916     C                   SETON                                        24
057200940916    1C                   ENDIF
057210940916     C*
057220940916     C                   ENDSR
057230940916     C*
057240970704     C* CONTROLLO INDIRIZZO COMPLETO MITT/DESTIN ---------------------*
057250970704     C     CTRIND        BEGSR
057260970710     C* LE DS SONO DA CLEARARE PRIMA ALTRIMENTI DANNO PROBLEMI IN CTRER
057270970710     C                   CLEAR                   DSLV13
057280970710     C                   CLEAR                   DSSI95
057290060922     C                   CLEAR                   tisi97ds
057300151106     c                   clear                   xcfiva1ds
057310970710     C*
057320970704     C                   CLEAR                   I14ISO
057330970714     C                   MOVEL     BLPDSP        I14DRI
057340020205     c                   movel     'S'           i14cnz
057350100115     c                   movel     'S'           i14forzait
057360080414     c***                clear                   ds15x
057370151106     c                   if        wcli='M' and *in22
057380151105     c                   eval      I14P88='8'
057390151105     c                   endif
057400970704     C                   CALL      'FNLV14R'
057410970707     C                   PARM                    KPJBA
057420970707     C                   PARM                    DSLV14
057430080414     C***                PARM                    ds15x
057440970707     C*
057450970707     C                   MOVEL     O14ERR        WERR              1
057460970707     C                   MOVEL     O14MSG        VIDMSG
057470150907     C                   eval      wlv13_giro2=' '
057480970707     C                   EXSR      CTRERR
057490970707     C**
057500970707     C     WEMFOR        IFEQ      '1'
057510970707     C                   GOTO      ENDIND
057520970707     C                   ENDIF
057530061109     c
057540151106     c* Controllo il codice fiscale
057550151106     c*****              if        wcdf<>*blanks
057560151106     c                   clear                   xcfiva1ds
057570061109     c                   clear                   xcfivamod
057580061109     c                   eval      xcfivapar = wcdf
057590061109     c                   eval      xcfivanar = e14nar
057600061109     c                   eval      xcfivaprv = e14prv
057610151106     c                   eval      xcfivacap = e14cap
057620151106     c                   eval      xcfivaloc = e14loc
057630151106     c                   eval      xcfivapiva= wiva
057640151106     c                   if        *in22=*on
057650151106     c                   eval      XCFIVAP88='8'
057660151106     c                   endif
057670151106     c                   call      'XCFIVAR1'
057680151106     c                   parm                    xcfiva1ds
057690061109     c*
057700061109     c                   if        xcfivaflg < *zeros
057710080904     c                   movel     xcfivamsg     vidmsg
057720061109     c                   seton                                        2890
057730061109     C                   GOTO      ENDIND
057740061109     c                   endif
057750151106     c                   eval      wCdfFlg=xcfivaflg
057760151106     c*****              endif
057770061109     c
057780061109     c* MITTENTE: COD FISCALE OBBLIGATORIO FORZABILE, SE prepagato 8888
057790071022     c*  22              if        Wcli='M' and wccm=8888  and
057800071022     c*                            wcdf=*blanks  and e14nar=*blanks
057810120503     c*  22              if        Wcli='M' and wccm=8888
057820120503     c*                            and e14nar=*blanks and (wcdf=*blanks
057830120503     c*                            or (wiva=*blanks and dateu>=§vpopiv))
057840120508     c* MITTENTE: PREPAGATO
057850120508    1c   22              if        Wcli='M' and e14nar=*blanks
057860120508     c* P.iva $$ sempre errore
057870120508    2c                   if        %scan('$$':wiva) >0
057880120508     c                   movel     err(345)      vidmsg
057890120508     c                   seton                                        702890
057900120508     C                   GOTO      ENDIND
057910120508    2c                   endif
057920120508     c* Prepagato 8888
057930120508   1ac                   if        wccm=8888
057940120503     c* errore forzabile: Codice fiscale o Partita iva
057950120504    2c                   if        wcdf=*blanks   and wiva=*blanks
057960120503     c* errore forzabile: se inserito codice fiscale lungo 11 inserire anche la
057970120503     c*                   P.IVA
057980120503     c                             or (wcdf<>*blanks and %subst(wcdf:12:1)=' '
057990120503     c                                 and wiva=*blanks)
058000061109     c* Se cambiato mittente ricontrollo
058010120504    3c                   if        i14rsc<>savrsm
058020120503     c                   clear                   forzcdf           1
058030120504     c                   clear                   forzcdf1          1
058040120503     c                   movel     i14rsc        savrsm
058050120504    3c                   endif
058060151106
058070151106     c                   clear                   xcfiva1ds
058080151106     c                   eval      xcfivamod = 'P'
058090151106     c                   eval      xcfivapar = wcdf
058100151106     c                   eval      xcfivanar = e14nar
058110151106     c                   eval      xcfivaprv = e14prv
058120151106     c                   eval      xcfivacap = e14cap
058130151106     c                   eval      xcfivaloc = e14loc
058140151106     c                   eval      xcfivapiva= wiva
058150151106     c                   eval      XCFIVAP88='8'
058160151106     c                   call      'XCFIVAR1'
058170151106     c                   parm                    xcfiva1ds
058180061109     c*
058190130131     c* 31/01/2013: Errori non più forzabili ma sempre bloccanti
058200120504    3c                   select
058210130131     c****               when      forzcdf=' ' and wcdf=*blanks
058220151106     c                   when      wcdf=*blanks
058230151106     c                   select
058240151106     c* entrambi inseribili --> chiedo uno o l'altro
058250151106     c                   when      wcdfflg<>9 and xcfivaflg<>9
058260151106     c                   movel     err(343)      vidmsg
058270151106     c* solo codice fiscale
058280151106     c                   when      wcdfflg<>9
058290151106     c                   movel     err(364)      vidmsg
058300151106     c* solo partita IVA
058310151106     c                   when      xcfivaflg<>9
058320151106     c                   movel     err(344)      vidmsg
058330151106     c                   endsl
058340151106     c                   if        wcdfflg<>9 or xcfivaflg<>9
058350120504     c                   movel     '1'           forzcdf
058360120504     c                   z-add     -1            xcfivaflg
058370120504     c                   seton                                        2890
058380120504     C                   GOTO      ENDIND
058390151106     c                   endif
058400130131     c****               when      forzcdf1=' ' and wcdf<>*blanks
058410151106     c                   when      wcdf<>*blanks and xcfivaflg<>9
058420120503     c                   movel     err(344)      vidmsg
058430120504     c                   movel     '1'           forzcdf1
058440120503     c                   z-add     -1            xcfivaflg
058450120503     c                   seton                                        2890
058460120503     C                   GOTO      ENDIND
058470120504    3c                   endsl
058480120504    2c                   endif
058490120508   1ac                   endif
058500120504    1c                   endif
058510061109     c
058520020207     c* DESTINATARIO
058530020207     c     WCLI          ifeq      'D'
058540020207     C* SE IMMESSA LINEA DI ARRIVO PER DPD DEVE ESSERE UNA LINEA
058550020207     C* DPD    -   STESSA COSA PER FED-EX
058560020207     C     VIDDPD        IFEQ      'D'
058570051028     C**   O14IE         ANDEQ     'E'
058580020207     C     COMLNA        andgt     0
058590020207     C     COMLNA        ANDNE     O14LAD
058600020319     C     A_§OGNTW      ANDNE     'DPD'
058610020207     C     VIDDPD        oreq      'F'
058620051028     C**   O14IE         ANDEQ     'E'
058630020207     C     COMLNA        andgt     0
058640020207     C     COMLNA        ANDNE     O14LAF
058650020213     C     A_§OGNTW      ANDNE     'FED'
058660020207     C*
058670020207     C                   MOVEa     ERR(183)      k78
058680020207     C                   SETON                                        4790
058690020207     c     viddpd        ifeq      'D'
058700020207     c                   eval      w005a = 'DPD  '
058710020207     c                   else
058720020207     c                   eval      w005a = 'FedEx'
058730020207     c                   endif
058740020214     c                   movea     w005a         k78(66)
058750020207     C                   MOVEA     K78           VIDMSG
058760020211     C                   GOTO      ENDind
058770020207     c*
058780020207     C                   ENDIF
058790020207     c*
058800020207     c                   select
058810020207     C* SE LNA DPD =000 NON C'E' IL SERVIZIO
058820020207     c     viddpd        wheneq    'D'
058830020207     C     o14lad        andle     *ZEROS
058840020213     c     comlna        andeq     *zeros
058850020319     c     A_§ogNTW      oreq      'DPD'
058860020207     c     o14lad        andle     *zeros
058870060921     c* se però c'e' reso non do errore
058880060921     c                   if        o14red=' ' or
058890060921     c                             (o14red='S' and vidfbr<>'S')
058900020207     C                   MOVEL     ERR(192)      VIDMSG
058910020207     C                   SETON                                        90
058920020207     c     viddpd        ifeq      'D'
058930020207     c                   z-add     21            h1riga
058940020207     c                   z-add     10            h1colo
058950020207     c                   else
058960020207     C                   SETON                                        47
058970020207     c                   endif
058980020207     C                   GOTO      ENDind
058990060921     c                   endif
059000060921     c
059010020207     C* SE LNA FEDEX=000 NON C'E' IL SERVIZIO
059020020207     c     viddpd        wheneq    'F'
059030020207     C     o14laf        andle     *ZEROS
059040020213     c     comlna        andeq     *zeros
059050020213     c     A_§ogntw      oreq      'FED'
059060020207     C     o14laf        andle     *ZEROS
059070020207     C                   MOVEL     ERR(244)      VIDMSG
059080020207     C                   SETON                                          90
059090020207     c     viddpd        ifeq      'F'
059100020207     c                   z-add     21            h1riga
059110020207     c                   z-add     10            h1colo
059120020207     c                   else
059130020207     c                   seton                                        47
059140020207     c                   endif
059150020207     C                   GOTO      ENDind
059160020207     c* se flag EuroExpress = blank non c'è il servizio
059170020207     c     viddpd        wheneq    ' '
059180020207     c     o14ie         andeq     'E'
059190020207     c     o14eex        andeq     *blanks
059200020213     c     comlna        andeq     *zeros
059210020213     c     A_§ogntw      oreq      'EEX'
059220020207     c     o14eex        andeq     *blanks
059230020214     C                   MOVEL     ERR(247)      VIDMSG
059240020207     C                   SETON                                          90
059250020213     c     A_§ogntw      ifeq      'EEX'
059260020212     c     *in12         oreq      *on
059270020212     c     *in15         andeq     *off
059280020207     c                   seton                                        47
059290020207     c                   else
059300020207     c                   z-add     21            h1riga
059310020207     c                   z-add     10            h1colo
059320020207     c                   endif
059330020207     C                   GOTO      ENDind
059340020207     c                   endsl
059350020207     c                   endif
059360970707     C*************
059370020214     C* CONTROLLO CAP -
059380160324     c*****              if        w_vediP=*blanks
059390970707     C                   MOVEL     '7'           I95TCN
059400160324     c****               else
059410160324     C****               MOVEL     '3'           I95TCN
059420160324     C****               eval      i13cng='S'
059430160324     c****               endif
059440970707     C                   MOVEL     E14CAP        I95CAP
059450970707     C                   MOVEL     E14LOC        I95LOC
059460970707     C                   MOVEL     E14PRV        I95PRV
059470970707     C                   MOVEL     E14NAR        I95NAR
059480970714     C                   MOVEL     BLPDSP        I95DAT
059490971201     C     §3AFCA        IFNE      0
059500971201     C                   MOVEL     'S'           I95FCA
059510971201     C                   ENDIF
059520971201     C                   MOVEL     FLGTB1        I95TPO
059530970707     C                   MOVEL     'S'           I13AF0
059540061122     c* per disk "B" non deve controllare la congruenza della località
059550061122     c* con il cap anche quando quest'ultimo ha eccezioni
059560160323     c* anche per vedi pacco dpd
059570160323     c                   if        (wcli='D' and §1bfg6='C'
059580160323     c                             and §1bfg2='S') or
059590160323     c                             w_vediP='1'
059600061122     C                   clear                   I13AF1
059610061122     c                   else
059620970707     C                   MOVEL     'S'           I13AF1
059630061122     c                   endif
059640061122     c
059650970707     C                   MOVEL     'S'           I13SZ2
059660140122     C* CAP CON VIARIO: NON CONTROLLO PER DISK B
059670160323     c* non controllo nemmeno per vedi pacco dpd
059680000704     C     §1BFG6        IFNE      'C'
059690160324     C     w_vediP       andne     '1'
059700140122     C**** §1BFG2        ORNE      'S'
059710150304     c                   if        §vpouttlls='N'
059720150623     c******                       and simpou<>28 and simpou<>50
059730150304     C                   MOVEL     'S'           I13CNV
059740150304     c                   else
059750150121     C                   MOVEL     'Y'           I13CNV
059760150123     c                   movel     vidind        i95ind
059770150304     c                   endif
059780000704     C                   ENDIF
059790970707     C                   MOVEL     'S'           I13SZV
059800140121     c                   if        wcli='D'
059810140121     c                   clear                   dspr
059820140121     C                   MOVEL     'PR'          COD
059830140121     C                   MOVEL(P)  i95prv        KEY
059840140121     c     ktab2         chain     tabel00f
059850140121     c                   if        %found(tabel00f)
059860140121     c                   eval      dspr=tbluni
059870140121     c                   endif
059880140121     c                   if        §prpla='S'
059890140121     c                   clear                   i13szv
059900140121     c                   endif
059910140121     c                   endif
059920991213     C* PER LNP DPD, CONTROLLO CONGRUENZA LOCALITA' CAP E PROVINCIA
059930160323     C*  E NON SOLO CAP E PROVINCIA
059940160323     c* Per Vedi pacco dpd non faccio mai questo controllo
059950160323     c     w_vediP       ifne      '1'
059960020319     C     §OGNTW        IFEQ      'DPD'
059970000622     C* CONTROLLO PER TUTTI TRANNE CHE PER DSK "B"
059980000622     C     §1BFG6        ORNE      'C'
059990000622     C     §1BFG2        ORNE      'S'
060000000314      * TESTIAMO CONTROLLO SU SPEDIZIONI DI VERONA 15/03/00
060010000322      * TESTIAMO CONTROLLO SU SPEDIZIONI DI TREVISO 22/03/00
0600209912139/12 C                   MOVEL     'S'           I13LA3
0600309912139/12 C                   MOVEL     'S'           I13SZ3
060040991213     C                   ENDIF
060050160323     C                   ENDIF
060060970707     C**
060070970708     C**  M I T T E N T E
060080970707    1C     WCLI          IFEQ      'M'
060090970707     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO : ERRORE FORZABILE
060100970707    2C     E14CAP        IFNE      VARCAM
060110970707     C                   CLEAR                   OTT
060120970707     C                   CLEAR                   MMA
060130970707     C                   CLEAR                   MMB
060140000622     C                   CLEAR                   MMD
060150970707     C                   MOVEL     E14CAP        VARCAM
060160970707    2C                   ENDIF
060170970707     C** MODIFICA LOCALITA'
060180970707    2C     E14LOC        IFNE      VARLOM
060190970707     C                   MOVEL     E14LOC        VARLOM
060200970707     C                   CLEAR                   MMA
060210970707     C                   CLEAR                   MMB
060220000622     C                   CLEAR                   MMD
060230970707    2C                   ENDIF
060240970708     C**
060250970707     C                   MOVEL     OTT           E13FZV
060260970707     C                   MOVEL     MMA           E13FZ1
060270970707     C                   MOVEL     MMB           E13FZ2
060280000622     C                   MOVEL     MMD           E13FZ3
060290020218     c* se network fedex passo flag apposito per dire di prendere i dati
060300020218     c* dalla tabella della nazione
060310020218     c     §ogntw        ifeq      'FED'
060320020218     c                   movel     'S'           i95fi1
060330020218     c                   endif
060340970708     C**
060350970708     C                   ELSE
060360970708     C**
060370970708     C**  D E S T I N A T A R I O
060380970708     C* SE CAMBIATO CAP CONTROLLO SE HA VIARIO
060390970708    2C     E14CAP        IFNE      VARCAD
060400970708     C                   CLEAR                   DIE
060410970708     C                   CLEAR                   SET
060420970708     C                   CLEAR                   AAA
060430970708     C                   CLEAR                   AAB
060440991213     C                   CLEAR                   AAD
060450970708     C*
060460970708     C* SE CAMBIATO MA IN MANUTENZIONE RIMESSO QUELLO DELLA BOLLA  -->
060470970708     C*  COME SE NON FOSSE CAMBIATO NULLA
060480970708    3C     *IN12         IFEQ      *ON
060490970708     C     *IN15         ANDEQ     *OFF
060500970708     C     E14CAP        ANDEQ     BLPCAD
060510970708     C                   CLEAR                   NOV
060520970708     C                   ELSE
060530970708     C                   CLEAR                   QUA
060540100209     C                   CLEAR                   QUAH
060550970708     C                   MOVEL     '1'           NOV
060560970708    3C                   ENDIF
060570970708     C* MEMORIZZO NUOVO CAP
060580970708     C                   MOVEL     E14CAP        VARCAD
060590970708    2C                   ENDIF
060600970708     C* MODIFICA LA LOCALITA'
060610970708    2C     E14LOC        IFNE      VARLOD
060620970708     C                   MOVEL     E14LOC        VARLOD
060630970708     C                   CLEAR                   AAA
060640970708     C                   CLEAR                   AAB
060650991213     C                   CLEAR                   AAD
060660970708    2C                   ENDIF
060670970708     C**
060680970708     C                   MOVEL     SET           E13FZV
060690970708     C                   MOVEL     AAA           E13FZ1
060700970708     C                   MOVEL     AAB           E13FZ2
060710991213     C                   MOVEL     AAD           E13FZ3
060720020212     c* se network fedex passo flag apposito per dire di prendere i dati
060730020212     c* dalla tabella della nazione
060740020213     c     A_§ogntw      ifeq      'FED'
060750020212     c     viddpd        oreq      'F'
060760020218     c     o14ie         andeq     'E'
060770020212     c                   movel     'S'           i95fi1
060780060922     c                   movel     'FED'         i97ntw
060790020212     c                   endif
060800060922     c*
060810060922     c     A_§ogntw      ifeq      'DPD'
060820060922     c     viddpd        oreq      'D'
060830060922     c     o14ie         andeq     'E'
060840060922     c                   movel     'DPD'         i97ntw
060850060922     c                   endif
060860060922     c* se non ancora impostato ed è estero, è euroexpress
060870060922     c                   if        (i97ntw=*blanks and o14ie='E') or
060880060922     c                             (i97ntw=*blanks and A_§ogntw='EEX')
060890060922     c                   movel     'EEX'         i97ntw
060900060922     c                   endif
060910970707    1C                   ENDIF
060920970722     C**
060930970722     C* SE RICHIAMO DALLA CONFERMA BOLLE SENZA FERMARSI SULLA BOLLA
060940970722     C*  IN CASO DI ERRORE NON DO L'INTERROGAZIONE LOCALITA' IN CASO
060950970722     C*  DI RESTITUZIONE AFFIDABILITA'=1
060960970722     C   12
060970970722     CAN 15§LPFPR        IFNE      'V'
060980970722     C     §LPFPR        ANDNE     'X'
060990970722     C                   MOVEL     1             E13FZ1
061000970722     C                   ENDIF
061010970707     C**
061020970707     C** CALL
061030150907     C                   eval      wlv13_giro2=' '
061040150907     c                   exsr      sr_LV13
061050970708     C**
061060970708     C     WEMFOR        IFEQ      '1'
061070970708     C                   GOTO      ENDIND
061080970708     C                   ENDIF
061090150907
061100150907     c                   if        wlv13='S'
061110150907     C                   MOVEL     E14CAP        I95CAP
061120150907     C                   eval      wlv13_giro2='S'
061130150907     c                   exsr      sr_lv13
061140150907     C     WEMFOR        IFEQ      '1'
061150150907     C                   GOTO      ENDIND
061160150907     C                   ENDIF
061170150907     c                   endif
061180080410     c* PORTI ASSEGNATI
061190080410     c* Se porto assegnato effettuabile solo a fronte di orm commissionato
061200080410     c* da p.o. del network verifico che il p.o. emittente sia quello del
061210080410     c* network
061220080410     c                   clear                   wnocont
061230080411    1c                   if        o97uti='N' and wcli='D'
061240080410     c* Se provengo da manutenzione di bolla di reso lo memorizzo
061250080410     c* per non effettuare il controllo seguente
061260080411    2c     *in12         ifeq      *on
061270080410     c     *in15         andeq     *off
061280080410     c     vidfbr        andeq     'S'
061290080410     c                   move      'N'           wnocont           1
061300080411    2c                   endif
061310080410     c                   movel     o97flo        dcppflo
061320080410     c* ricavo p.o. emittente
061330080411    2c                   if            §cpppas='O' and wnocont=*blanks
061340080410     c                             and i95tpo='A'
061350080410     c* non richiamato da giacenze o ritiri annullati
061360080410     c                             and savfpr<>'P' and savfpr<>'G'
061370080410     c                             and savfpr<>'T'
061380080410     c* orm fittizio oppure orm non commissionato da po del network
061390080411    3c                   if        flgfit='S' or i97ntw<>poentw
061400080411    4c                   if        wperso='P'
061410080410     C                   Z-ADD     05            H0RIGA
061420080410     C                   Z-ADD     20            H0COLO
061430080410     c                   else
061440080410     C                   Z-ADD     06            H1RIGA
061450080410     C                   Z-ADD     20            H1COLO
061460080411    4c                   endif
061470080410     c                   seton                                        90
061480080410     c* preparo il testo del messaggio
061490080410     c                   movel     err(229)      vidmsg
061500080411     C                   CLEAR                   dsbs02
061510080411     c                   clear                   dntw
061520080411     C                   MOVEL     'C'           T02MOD
061530080411     C                   MOVEL     KNSIF         T02SIF
061540080411     C                   MOVEL     'NTW'         T02COD
061550080411     c                   movel(P)  i97ntw        t02ke1
061560080411     C                   CALL      'TIBS02R'
061570080411     C                   PARM                    KPJBA
061580080411     C                   PARM                    dsbs02
061590080411    4C                   IF        T02ERR = *BLANKS
061600080411     C                   MOVEL     T02uni        dntw
061610080411    4C                   ENDIF
061620080411     c                   eval      %subst(vidmsg:14:5)=%subst(§ntwdes:1:5)
061630080411     c                   eval      %subst(vidmsg:71:5)=%subst(§ntwdes:1:5)
061640080410     C                   GOTO      ENDIND
061650080411    3c                   endif
061660080411    2c                   endif
061670080411    1c                   endif
061680090827     c*
061690090921     c* Per destinatario vedo se il tipo servizio prevede un codice tempo
061700090827     c*  consegna obbligato, anche parziale
061710100322     c* Se esiste FNORE --> dico che si può utilizzare
061720100322     c                   if        Wcli='D' and WesORE='N'
061730100322     c                   movel     'S'           wesore
061740100322     c                   endif
061750100322     c
061760100125    1c                   if        vidtsp<>' ' and wcli='D'
061770100322
061780090827     C                   Z-ADD     1             C
061790090827     C     vidtsp        LOOKUP    TSP(C)                                 30
061800090827    2C                   IF        *in30  and TSttc(c)<>*blanks
061810090827     c* controllo posizione per posizione escudendo le "x"
061820090827     c                   eval      Wttc=TSttc(c)
061830090827     c                   eval      WttcCAP=%editc(o95ttc:'X')
061840090827     c                   z-add     1             c
061850090921    3c                   do        5             c
061860090827     c                   if        %subst(wttc:c:1)<>'x'
061870090827     c                             and
061880090827     c                             %subst(wttc:c:1)<>%subst(wttcCAP:c:1)
061890090827     C                   MOVEL     ERR(307)      VIDMSG
061900090827     c                   seton                                        9048
061910090827     C                   MOVEL     '1'           WEMFOR
061920100319     c* Se vengo da ORM --> memorizzo di non considerare FNORE
061930100319     c*  perchè incongruente col CAP
061940100319     c                   if        wesORE='S'
061950100319     c                   movel     'N'           wesore
061960100319     c                   endif
061970100319
061980100319     C                   GOTO      ENDIND
061990090827     c                   endif
062000090921    3c                   enddo
062010090827     c
062020090921    2c                   endif
062030090921     c
062040090921     c* Se fermo deposito non accetto tipo servizio H
062050090921    2c                   if        vidtsp='H'  and vidffd='S'
062060090921     C                   MOVEL     ERR(101)      VIDMSG
062070090921     c                   seton                                        9048
062080090921     C                   MOVEL     '1'           WEMFOR
062090090921     C                   GOTO      ENDIND
062100090921    2c                   endif
062110090921    1c                   endif
062120080410     c
062130000622     C**
062140000622     C* SE SI TATTA DI CAP OBSOLETO, ERRORE NO FORZABILE
062150061010     C***  §1BFG6        IFNE      'C'
062160061010     C***  §1BFG2        ORNE      'S'
062170061010     C***  O95CF1        IFEQ      'O '
062180061010     C***  WCLI          IFEQ      'M'
062190061010     C***                SETON                                        5390
062200061010     C***                ELSE
062210061010     C***                SETON                                        6590
062220061010     C***                ENDIF
062230061010     C***                MOVEL     ERR(201)      VIDMSG
062240061010     C***                MOVEL     '1'           WEMFOR
062250061010     C***                GOTO      ENDIND
062260061010     C***                ENDIF
062270061010     C***                ENDIF
062280970704     C**
062290970704     C* M I T T E N T E
062300970704    1C     WCLI          IFEQ      'M'
062310970704     C                   MOVEL     O14IE         WMITIE            1
062320970704     C                   MOVEL     O14VLT        MITVLT
062330970704     C                   MOVEL     O95ISO        COMFAP
062340970708     C                   MOVEL     O95CTS        MITCTS            2
062350140403     C                   MOVEL     O95gf2        comgf2
062360970704     C**
062370970704   X1C                   ELSE
062380970704     C*
062390970704     C                   MOVEL     O14IE         WDESIE            1
062400970704     C                   MOVEL     O14VLT        DESVLT
062410970704     C                   MOVEL     O14EFT        DESEFT
062420000321     C                   MOVEL     O14EFD        DESEFD
062430971215     C                   MOVEL     O14COD        DESCOD
062440000120     C                   MOVEL     O14LAD        DESLAD
062450060920     C                   MOVEL     O14red        DESred
062460020130     C                   MOVEL     O14eff        DESeff
062470020131     C                   MOVEL     O14ffn        DESffn
062480080414     c***                movel     x_§15cex      descaeex
062490080414     c***                movel     x_§15cdp      descadpd
062500080414     c***                movel     x_§15cfe      descafed
062510970704     C                   MOVEL     O95ISO        COMFIN
062520970704     C                   MOVEL     O95GDD        DESGDD            1
062530021118      * Se spedizione export il DDT va sempre impostato a 'N'
062540021118     c                   If        O14ie = 'E'
062550021118     c                   Eval      DesGdd = 'N'
062560021118     c                   EndIf
062570021118      * Mi salvo flag ddt
062580021118     c                   Eval      SavGdd = O95Gdd
062590970704     C   12
062600970704     CAN 15
062610970704     CORN12              MOVEL     O95CTS        SAVCTS            2
062620970704     C*
062630970704     C* MANUTENZIONE RICALCOLO COD TASSAZIONE SOLO SE CAMBIATA PROV
062640990629     C*  NAZIONE E CAP
062650970704     C   12
062660970704     CANN15BLPPRD        IFNE      E14PRV
062670990629     C     BLPNZD        ORNE      E14NAR
062680990629     C     BLPCAD        ORNE      E14CAP
062690030320     c     blpnzd        orne      *Blanks
062700030320     c     e14nar        orne      *Blanks
062710970704     C                   MOVEL     O95CTS        SAVCTS
062720970704     C                   ENDIF
062730970704     C**
062740970704    1C                   ENDIF
062750970704     C*
062760970704     C     ENDIND        ENDSR
062770970707     C*
062780970707     C* CONTROLLO SE C'E' ERRORE-------------------------------------*
062790970707     C     CTRERR        BEGSR
062800150907     c                   clear                   wlv13
062810970708     C* IMPOSTO CAMPI PASSATI
062820970708     C     O13RON        IFEQ      'S'
062830970708     C                   MOVEL     O95NAR        E14NAR
062840970708     C                   ENDIF
062850970708     C     O13ROC        IFEQ      'S'
062860970708     C                   MOVEL     O95CAP        E14CAP
062870970708     C                   ENDIF
062880970708     C     O13ROP        IFEQ      'S'
062890970708     C                   MOVEL     O95PRV        E14PRV
062900970708     C                   ENDIF
062910970708     C     O13ROL        IFEQ      'S'
062920970708     C                   MOVEL     O95LOC        E14LOC
062930970708     C                   ENDIF
062940970708     C**
062950970707     C* ERRORE O RICERCA CAMPO
062960970707    1C     WERR          IFNE      ' '
062970150907     c* Per controllo dati Destinatario
062980150907     c* l'errore con il posizionamento cursore lo emetto solo se
062990150907     c* CAP non reperito o non è stato reperito il SOLO cap
063000150907     c* L'unico caso è il msg:
063010150907     c* ATTENZIONE!! Presenti dati incongruenti: modificati.Enter per continuare
063020150907     c* che si è deciso di non emettere più perchè inutile al bollettista pur
063030150907     c* modificando i dati inseriti da quest'ultimo in base a quanto rieperito
063040150907     c* da lv13/tisi95
063050150907     c                   if        wcli='M' or
063060150907     c                             o13roc<>'S' or
063070150907     c                             (o13rop='S' or o13rol='S' or o13ron='S')
063080150907     c                             or wlv13_giro2='S'
063090970707     C*
063100970707    2C     VIDMSG        IFNE      *BLANKS
063110970707     C                   SETON                                        90
063120970707    2C                   ENDIF
063130970707     C* POSIZIONAMENTO CURSORE
063140970707    2C                   SELECT
063150970707    2C     WERR          WHENEQ    '1'
063160970707     C     WERR          OREQ      '2'
063170970707    3C     WCLI          IFEQ      'M'
063180970707     C                   SETON                                        52
063190970707     C                   ELSE
063200970707     C                   SETON                                        64
063210970707    3C                   ENDIF
063220970707    2C     WERR          WHENEQ    '3'
063230970707    3C     WCLI          IFEQ      'M'
063240970707     C                   SETON                                        54
063250970707     C                   ELSE
063260150826     C                   SETON                                        6638
063270970707    3C                   ENDIF
063280970707    2C     WERR          WHENEQ    '4'
063290970707    3C     WCLI          IFEQ      'M'
063300970707     C                   SETON                                        55
063310970707     C                   ELSE
063320970707     C                   SETON                                        71
063330970707    3C                   ENDIF
063340970707    2C     WERR          WHENEQ    '5'
063350970707    3C     WCLI          IFEQ      'M'
063360970707     C                   SETON                                        53
063370970707     C                   ELSE
063380150826     C                   SETON                                        6538
063390970707    3C                   ENDIF
063400970707    2C     WERR          WHENEQ    '6'
063410970707     C                   SETON                                        68
063420970707    2C     WERR          WHENEQ    '7'
063430970707     C                   SETON                                        70
063440970707    2C     WERR          WHENEQ    '8'
063450970707     C                   SETON                                        10
063460020204     c     werr          wheneq    '0'
063470020204    3C     WCLI          IFEQ      'M'
063480020204     C                   SETON                                        55
063490020204     C                   ELSE
063500020204     C                   SETON                                        71
063510020204    3C                   ENDIF
063520970707    2C                   ENDSL
063530970707     C*
063540970707     C                   MOVEL     '1'           WEMFOR
063550150907     c                   else
063560150907     c* Controllo indirizzo destinatario e poposto cap
063570150907     c* per avere i dati corretti del cappario bisogna richiamare nuovamente
063580150907     c* lv13
063590150907     c                   eval      wlv13='S'
063600970707    1C                   ENDIF
063610150825    1C                   ENDIF
063620970707    1C                   ENDSR
063630150907     c
063640150907     C* Richiamo FNLV13R da CTRIND  ---------------------------------*
063650150907     C     sr_LV13       BEGSR
063660150907
063670150907     c                   if        §3arbl<>'R'
063680150907     C                   CALL      'FNLV13R'
063690150907     C                   PARM                    KPJBA
063700150907     C                   PARM                    DSLV13
063710150907     C                   PARM                    DSSI95
063720150907     C                   PARM      ' '           flgbac            1
063730150907     C                   PARM                    tisi97ds
063740150907     c                   else
063750150907     C                   CALL      'FNLV13R'
063760150907     C                   PARM                    KPJBA
063770150907     C                   PARM                    DSLV13
063780150907     C                   PARM                    DSSI95
063790150907     C                   PARM      ' '           flgbac            1
063800150907     c                   endif
063810150907     C*
063820150907     C                   MOVEL     O13ERR        WERR              1
063830150907     C                   MOVEL     O13MSG        VIDMSG
063840150907     C                   EXSR      CTRERR
063850150907     C**
063860150907     C* REIMPOSTO LE FORZATURE
063870150907     C     WCLI          IFEQ      'M'
063880150907     C                   MOVEL     E13FZV        OTT
063890150907     C                   MOVEL     E13FZ1        MMA
063900150907     C                   MOVEL     E13FZ2        MMB
063910150907     C                   MOVEL     E13FZ3        MMD
063920150907     C                   ELSE
063930150907     C                   MOVEL     E13FZV        SET
063940150907     C                   MOVEL     E13FZ1        AAA
063950150907     C                   MOVEL     E13FZ2        AAB
063960150907     C                   MOVEL     E13FZ3        AAD
063970150907     C                   ENDIF
063980150907     c                   endsr
063990970704     C*
064000940916     C* CONTROLLO DATA RITIRO MERCE ----------------------------------*
064010940916     C     CTRDRT        BEGSR
064020940916     C*
064030940916     C* CONTROLLO SOLO QUANDO VIENE MODIFICATA
064040990610   0AC     PARTCH        IFEQ      'P'
064050990610     C     VIDDRT        ANDGT     0
064060010307     C     §LPFPR        OREQ      'O'
064070010307     C     VIDDRT        ANDGT     0
064080990610     C     PARTCH        ORNE      'P'
064090010307     C     §LPFPR        ANDNE     'O'
064100940916    0C     VIDDRT        IFNE      SAVDRT
064110950215     C     VIDDRT        OREQ      0
064120070808     C* Se O.R.M. fittizio imposto a no display la scritta "DA O.R.M."
064130070808     c                   if        flgfit='S'
064140070808     c                   if        wperso='P'
064150070808     c                   movel     nodi          at0daorm
064160070808     c                   else
064170070808     c                   movel     nodi          atrdaorm
064180070808     c                   endif
064190070808     c                   endif
064200070808     c*
064210070831     c
064220940920     C                   Z-ADD     VIDDRT        G02DAT
064230940916     C                   CLEAR                   G02ERR
064240940916     C                   CALL      'XSRDA8'
064250940916     C                   PARM                    WLBDAT
064260940916     C*
064270070831     c* se in personalizzazione e non immessa data ritiro non è obbligatoria
064280070905     c* se l'orm è fittizio
064290070905     c* non è obbligatoria anche se non immessa la data e non immesso l'ORM
064300071107     c****               if        wperso='P' and dateu>=§vpodrt and
064310071107     c                   if        wperso='P' and
064320070905     c                             viddrt=0 and
064330070905     c                             ((flgfit='S' and widor1>*zeros) or
064340070905     c                             widor1=*zeros)
064350070831     c                   else
064360940916     C* SE ERRATA O MAGGIORE DI WDTGIO ERRORE
064370080109     C* NO < DI xx GIORNI DA OGGI (come da tabella "3I")
064380070904    1C*    G02ERR        IFEQ      '1'
064390070904     C*    G02INV        ORGT      DATEU
064400070904     C*    PARTCH        ANDNE     'P'
064410070904     C*    §LPFPR        ANDNE     'O'
064420070904     C*    G02INV        ORLT      DATAM
064430070904     c                   if        g02err='1' or (g02inv>dateu and
064440070904     c                             partch<>'P' and §lpfpr<>'O')
064450110420     c                             or (g02inv<datamin and not *in22)
064460110420     c                             or (g02inv<datam40 and     *in22)
064470071107     c***                          or (g02inv<datam and (dateu<§vpodrt or
064480080109     c***                          or (g02inv<datamin and (
064490080109     c***                          flgfit='S' or s_drt<>viddrt))
064500940916     C                   MOVEL     ERR(6)        VIDMSG
064510940920     C                   SETON                                        4390
064520080109     c* se errore data ritiro in quanto viene forzata data orm aggiungo
064530080109     c* nel messaggio di verificare l'orm
064540080128     c                   if        g02inv<datamin and flgfit<>'S' and not *in22
064550080109     c                   eval      vidmsg=%trim(vidmsg)
064560080109     c                             + ': verificare l''O.R.M.'
064570080109     c                   endif
064580940916    1C                   ENDIF
064590110422     c* Se prepagato e immessa data più vecchia di datamin
064600110422     c* errore forzabile
064610110422     c                   if        g02inv<datamin and *in22 and wforzadrt=*off
064620110422     C                   MOVEL     ERR(339)      VIDMSG
064630110422     c                   eval      %subst(vidmsg:49:2)=%char(§3iggb)
064640110422     C                   SETON                                        4390
064650110422     c                   eval      wforzadrt=*on
064660110422     c                   endif
064670070831     c                   endif
064680940916     C* OK
064690940916     C  N90              MOVE      G02INV        COMDRT
064700940916     C  N90              MOVE      G02DAT        VIDDRT
064710940916     C*
064720950215     C  N90              MOVEL     VIDDRT        SAVDRT
064730070829     C  N90              MOVEL     VIDDRT        S_DRT
064740940916    0C                   ENDIF
064750990610   0AC                   ENDIF
064760990610     C*
064770990610     C     VIDDRT        IFEQ      0
064780990610     C                   CLEAR                   COMDRT
064790990610     C                   CLEAR                   SAVDRT
064800990610     C                   ENDIF
064810990628     C* PRESTAZIONE MATTINO POMERIGGIO
064820040909     C  N90PARTCH        IFNE      'P'
064830010307     C     §LPFPR        ANDNE     'O'
064840990628     C     VIDFPP        ANDEQ     ' '
064850010503     C     WPERSO        ANDNE     'P'
064860990628     C                   MOVEL     ERR(163)      VIDMSG
064870990628     C                   SETON                                        4090
064880990628    1C                   ENDIF
064890940916     C                   ENDSR
064900940824     C*
064910940824     C* CONTROLLO NAZIONE E P.IVA ------------------------------------*
064920940907     C     CTRNAR        BEGSR
064930940824     C*
064940020211     C                   MOVEL     '15'          COD
064950020211     C                   MOVEL     '15'          CODTAB
064960940824     C* RICERCA
064970940824     C     '?'           SCAN      WNAR                                   30
064980941003    1C     *IN30         IFEQ      *ON
064990020213     c                   call      'TRUL19R'
065000020130     c                   parm                    codtab            2
065010020305     c                   parm      '1'           ordina            1
065020020130     c                   parm                    keytab            8
065030020130     c                   parm                    cmd               1
065040020130     C                   MOVEL     keytab        WNAR
065050940824     C                   GOTO      ENDCNA
065060941003    1C                   ENDIF
065070940824     C* CONTROLLO
065080940920     C                   MOVEL(P)  WNAR          KEY
065090940824     C*
065100940824     C                   EXSR      CTABEL
065110940824     C*
065120941003    1C     *IN30         IFEQ      *ON
065130940824     C                   MOVEL     ERR(28)       VIDMSG
065140940920     C                   SETON                                        6890
065150940824     C                   GOTO      ENDCNA
065160941003    1C                   ENDIF
065170941003     C*
065180941003     C                   MOVEL     TBLUNI        DS15
065190940907     C*
065200940825     C     ENDCNA        TAG
065210940825     C   90              MOVEL     '1'           WEMFOR
065220940825     C                   ENDSR
065230940824     C*
065240940824     C* CONTROLLO LINEA DI PARTENZA ---------------------------------*
065250940824     C     CTRLNP        BEGSR
065260940824     C*
065270940824    1C     SAVLNP        IFNE      WLNP
065280981007     C     BLPDSP        ORNE      SAVDSP
065290000518     C* RICNTROLLO SE BOLLA IMPORT DPD MA INDICATORE RELATIVO SPENTO
065300020319     C     §OGNTW        OREQ      'DPD'
065310000518     C     *IN79         ANDEQ     *OFF
065320940824     C* CONTROLLO CHE SIA GESTIBILE
065330070807     c                   if        simtpp='2' or simtpp=*blanks
065340070807     C     WLNP          LOOKUP    L6                                     30
065350070807     c                   else
065360940824     C     WLNP          LOOKUP    L1                                     30
065370070807     c                   endif
065380940928    2C     *IN30         IFEQ      *OFF
065390940824     C                   MOVEL     ERR(8)        VIDMSG
065400940920     C                   SETON                                        9045
065410940824     C                   GOTO      ENDCLP
065420940928    2C                   ENDIF
065430941230     C*
065440940824     C                   Z-ADD     WLNP          W0030             3 0
065450940824     C     W0030         CHAIN     AZORG01L      UNIORG               30
065460940928    2C     *IN30         IFEQ      *ON
065470940921     C     *IN30         OREQ      *OFF
065480940921     C     ORGFVA        ANDNE     *BLANKS
065490940824     C                   MOVEL     ERR(8)        VIDMSG
065500940920     C                   SETON                                        9045
065510940824     C                   GOTO      ENDCLP
065520940928    2C                   ENDIF
065530971211     C**
065540971211     C* MEMORIZZO IL CAPO SDI E SE E' ESTERO
065550000121     C*
065560991130      * DATI DPD: SE LNP DPD PROTEGGO SEMPRE RMA E SE LA SIGLA OPERATORE
065570991130      *           È UNA DI QUELLE PROTETTE, *IN13 = *ON, ANCHE RMN
065580991117     C                   MOVEL     ORGDE3        OG143
065590020319     C     §OGNTW        COMP      'DPD'                                  79
065600940824     C*
065610940824     C* PRENDO TERMINAL PARTENZA LINEA DI PARTENZA
065620970925     C                   CLEAR                   DSLV55
065630970925     C                   MOVEL     'P'           D55TPT
065640970925     C                   MOVEL     W0030         D55LIN
065650970925     C                   MOVEL     BLPDSP        D55DRF
065660970925     C                   CALL      'FNLV55R'
065670970925     C                   PARM                    DSLV55
065680970925     C     D55ERR        IFEQ      ' '
065690970925     C                   MOVEL     D55TFP        COMTFP            3 0
065700970925     C                   ELSE
065710001024     C                   MOVEL     ERR(211)      VIDMSG
065720001024     C                   SETON                                        9045
065730001024     C                   GOTO      ENDCLP
065740970925     C                   ENDIF
065750940824     C*
065760940824     C* PRENDO COD TRATTAMENTO MERCE DI DFT DELLA LINEA DI PARTENZA
065770940824     C                   MOVEL     '3G'          COD
065780940920     C                   MOVEL(P)  WLNP          KEY
065790940824     C*
065800940824     C                   EXSR      CTABEL
065810940824     C  N30              MOVEL     TBLUNI        COMCTM
065820940824     C   30              MOVEL     '  '          COMCTM
065830940824     C*
065840990610     C* CAMBIATA LNP: CONTROLLO IL CLIENTE ANCHE SE PERSONALIZZATO
065850990610     C                   MOVEL     'S'           WCOCCM            1
065860010219     C* RICHIAMO ROUTINE CHE DETERMINA SE LINEA CON PROC. ORM ATTIVATA
065870010219     C     SAVLNP        IFNE      WLNP
065880010219     C                   Z-ADD     WLNP          WLNPO
065890010219     C                   EXSR      ATTORM
065900011122     C* Se cambiata lnp devo ricordarmi di eseguire il controllo O.R.M.
065910011122     C* anche se è stato personalizzato
065920011122     C     WORM          IFEQ      'S'
065930011122     C                   MOVEL     '1'           WCKORM            1
065940011122     C                   ENDIF
065950010219     C                   ENDIF
065960010219     C                   MOVEL     WLNP          SAVLNP
065970010219     C                   MOVEL     BLPDSP        SAVDSP
065980990610     C                   ENDIF
065990940824     C     ENDCLP        ENDSR
066000940824     C*
066010010212     C* CONTROLLO NUMERO O.R.M. -------------------------------------*
066020010212     C     CTRORM        BEGSR
066030010305     C     §LPFPR        IFEQ      'O'
066040010305     C                   CLEAR                   FLGFIT
066050010305     C                   ENDIF
066060011122     C* SOLO SE NON È STATO PERSONALIZZATO
066070011122     C* DEVO PERO' RICONTROLARE SEMPRE IN CASO DI VARIAZIONE DELLA LINE
066080011122     C* DI PARTENZA
066090010222    0C     *IN37         IFEQ      *OFF
066100010305     C     §LPFPR        ANDNE     'O'
066110011122     C     WCKORM        OREQ      '1'
066120010212     C                   CLEAR                   FLGFIT
066130060522     C                   CLEAR                   w_pogest
066140061124     c                   clear                   wforpf
066150010212     C* ERRORE SE NUMERO ORM = 0
066160010223    1C     WIDOR1        IFEQ      *ZEROS
066170010212     C                   MOVEL     ERR(216)      VIDMSG
066180010212     C                   SETON                                        90
066190010215    2C     WPERSO        IFEQ      'P'
066200040901     C                   Z-ADD     05            H0RIGA
066210040909     C                   Z-ADD     20            H0COLO
066220010213     C                   ELSE
066230040901     C                   Z-ADD     06            H1RIGA
066240040909     C                   Z-ADD     20            H1COLO
066250010215    2C                   ENDIF
066260010212     C                   GOTO      ENDORM
066270010212    1C                   ENDIF
066280010212     C*
066290070620     c* in manutenzione di un prepagato non si può variare il n.orm
066300070620     c                   if        *in12='1' and *in15='0' and *in22
066310070620     c                             and widorm<>s_§b4orm
066320070620     C                   SETON                                        90
066330070620     C                   MOVEL     ERR(312)      VIDMSG
066340070620     C                   SETON                                        90
066350070620    3C     WPERSO        IFEQ      'P'
066360070620     C                   Z-ADD     05            H0RIGA
066370070620     C                   Z-ADD     20            H0COLO
066380070620     C                   ELSE
066390070620     C                   Z-ADD     06            H1RIGA
066400070620     C                   Z-ADD     20            H1COLO
066410070620    3C                   ENDIF
066420070620     C                   GOTO      ENDORM
066430070620     c                   endif
066440040322      * ORM reale
066450040322if  1c                   If        widor1 <> wofit
066460010924     C                   CLEAR                   DORM01
066470010212     C     KORM          CHAIN     FNORM01L                           30
066480010924     C  N30              MOVEL     ORMFLO        DORM01
066490040322     c* se non trovato errore
066500040322    2C     *IN30         IFEQ      *ON
066510010212     C                   MOVEL     ERR(217)      VIDMSG
066520010212     C                   SETON                                        90
066530010215    3C     WPERSO        IFEQ      'P'
066540040901     C                   Z-ADD     05            H0RIGA
066550040909     C                   Z-ADD     20            H0COLO
066560010213     C                   ELSE
066570040901     C                   Z-ADD     06            H1RIGA
066580040909     C                   Z-ADD     20            H1COLO
066590010215    3C                   ENDIF
066600010212     C                   GOTO      ENDORM
066610040322    2C                   ENDIF
066620100319     c
066630100319     c* Verifico se esiste FNORE
066640100319     c*  sempre se cambiato ORM oppure se non c'è la N di IGNORARE
066650100319    2C     WIDORM        IFNE      W01ORM
066660100319     c     wesore        orne      'N'
066670100319     c                   clear                   wesore
066680100319     c                   clear                   DoreGEN
066690100319     C     KORME         CHAIN     FNORE01L                           30
066700100319     c                   if        %found(fnore01l)
066710100319     C                   MOVEL     OReDati       DOReGEN
066720100319     C                   Z-ADD     1             C
066730100319     C     §oretsp       LOOKUP    TSP(C)                                 30
066740100319    4c                   if        *in30 and uts(c)='S'
066750100319     c                   eval      WEsORE='S'
066760100319     c                   endif
066770100319     c                   endif
066780100319     c                   endif
066790040322      * ORM fittizzio
066800040322   x1c                   Else
066810100322     c                   clear                   wesore
066820100322     c                   clear                   DoreGEN
066830040322      * memorizzo
066840010212     C                   MOVEL     'S'           FLGFIT            1
066850150303     c                   if        savfpr<>'B'
066860011121     C                   CLEAR                   ATRDES
066870100319     C* devo anche pulire i campi del destinatario solo se il
066880011205     C* precedente orm prevedeva la forzatura del destinatario
066890011205     C     SORMFD        IFEQ      'S'
066900011205     C                   CLEAR                   VIDRSD
066910011205     C                   CLEAR                   VIDIND
066920011205     C                   CLEAR                   VIDCAD
066930011205     C                   CLEAR                   VIDLOD
066940011205     C                   CLEAR                   VIDPRD
066950011205     C                   CLEAR                   VIDNZD
066960011205     C                   CLEAR                   SORMFD
066970011205     C                   ENDIF
066980150303     c                   endif
066990010212    1C                   ENDIF
067000051207     c
067010051207     c                   clear                   vidmsg
067020010212     C* eseguo i seguenti controlli solo se orm non fittizio
067030010215    1C     FLGFIT        IFEQ      *BLANKS
067040010409     C* ERRORE SE O.R.M. ANNULLATO
067050010409    2C     ORMATB        IFNE      *BLANKS
067060010409     C                   MOVEL     ERR(228)      VIDMSG
067070010409   X2C                   ELSE
067080010212     C* ERRORE SE P.O. RITIRO DIVERSO DA LINEA DI PARTENZA BOLLA
067090010409    3C     ORMPOR        IFNE      WOLNP
067100060522     c* verifico se p.o. ritiro gestito dalla lnp bolla
067110060522     c* perchè in tal caso non devo dare errore se p.o. ritiro <> da
067120060522     c* lnp bolla
067130060522     c                   clear                   dslv55
067140060522     c                   eval      d55tpt = '6'
067150060522     c                   z-add     ormpor        d55lin
067160060522     c                   z-add     blpdsp        d55drf
067170060522     c                   call      'FNLV55R'
067180060522     c                   parm                    dslv55
067190060522     c                   if        d55err <> *blanks or d55tfa <> wolnp
067200051207     c* Verifico se si tratta di dati edi trasferiti: in questo caso
067210051206     c*  non do errore
067220051206     c                   clear                   tntb50ds
067230051206     C                   move      VIDCCM        b50ke2
067240051206     C*
067250051206    3C     VIDFLC        IFEQ      0
067260051206     C                   MOVEL     VIDLNP        b50ke2
067270051206     C                   ELSE
067280051206     C                   MOVEL     VIDFLC        b50ke2
067290051206    3C                   ENDIF
067300051206     c
067310051206     c                   movel     b50ke2        b50ke1
067320051207     c* controllo linea e p.o. orm
067330051207     c                   movel     'O'           b50opz
067340051207     c                   movel     ormpor        b50ormreso
067350051206     c                   movel     wolnp         b50poa
067360051206     c                   call      'TNTB51R'
067370051206     c                   parm                    kpjba
067380051206     c                   parm                    tntb50ds
067390051206     c
067400051206     c                   if        b50err<>' '
067410081215     c* po ritiro orm diverso da lnp vanno bene per dpd purchè entrambi
067420081215     c* i network siano dpd
067430081215     c                   clear                   ntwpor
067440081215     c                   if        §ogntw='DPD'
067450081215     C     ORMPOr        CHAIN     AZORG01L      UNIORG
067460081215     C                   MOVEL     OG143         SAV143
067470081215     C                   MOVEL     ORGDE3        OG143
067480081215     c                   movel     §ogntw        ntwpor
067490081215     C                   MOVEL     SAV143        OG143
067500081215     c                   endif
067510081215     c                   if        §ogntw<>'DPD' or ntwpor<>'DPD'
067520010212     C                   MOVEL     ERR(218)      VIDMSG
067530081215     c                   endif
067540010409    3C                   ENDIF
067550060522     c                   else
067560060522     c*se p.o. ritiro gestito da lnp bolla memorizzo
067570060522     c                   z-add     d55tfa        w_pogest
067580060522    3C                   ENDIF
067590051206    3C                   ENDIF
067600070529     c* verifico se p.o. ritiro abilitato allo scarico dei PDA
067610070606     c* cerco la capofila del p.o. ritiro
067620070606     c                   clear                   dslv55
067630070606     c                   z-add     ormpor        d55lin
067640070606     c                   movel     '6'           d55tpt
067650070606     c                   z-add     ormddc        d55drf
067660070606     c                   call      'FNLV55R'
067670070606     c                   parm                    dslv55
067680070606     c     d55tfa        chain     azorg01l      uniorg
067690070529     c                   if        %found(azorg01l)
067700070529     C                   MOVEL     ORGDE8        OG148
067710070529     c                   else
067720070529     c                   clear                   og148
067730070529     c                   endif
067740070529     c                   movel     §ogpdaorm     s_§ogpdaorm
067750070606     c* memorizzo il p.o. gestore del p.o. ritiro per eventuali ricerche su
067760070606     c* tab "PDO"
067770080111     c****               z-add     d55tfa        g_ormpor
067780010409    2C                   ENDIF
067790051206     c
067800051207    2C**   ORMATB        IFNE      *BLANKS
067810051207     C**   ORMPOR        ORNE      WOLNP
067820051207     c* Visto che in un caso p.o. ritiro <> da linea bolla va bene, tes
067830051207     c*  to il campo messaggio
067840051207     c                   if        vidmsg<>*blanks
067850010212     C                   SETON                                        90
067860010215    3C     WPERSO        IFEQ      'P'
067870040901     C                   Z-ADD     05            H0RIGA
067880040909     C                   Z-ADD     20            H0COLO
067890010213     C                   ELSE
067900040901     C                   Z-ADD     06            H1RIGA
067910040909     C                   Z-ADD     20            H1COLO
067920010215    3C                   ENDIF
067930010212     C                   GOTO      ENDORM
067940010215    2C                   ENDIF
067950010216     C* CMD14 - VISUALIZZA ORM
067960010223     C     *INKH         IFEQ      *ON
067970010216     C                   CLEAR                   FIOR07
067980010216     C                   Z-ADD     WOPOE         D07POE
067990010222     C                   Z-ADD     WONSR         D07NSR
068000010222     C                   Z-ADD     WONOR2        D07NOR
068010010216     C                   Z-ADD     WONRV         D07NRV
068020020513     c     simtpp        ifeq      '2'
068030020513     c     simtpp        oreq      *blanks
068040020513     c                   move      simpou        d07fgs
068050010216     C                   ELSE
068060010216     C                   Z-ADD     SIMFEL        D07FGS
068070010216     C                   ENDIF
068080010216     C                   MOVEL     FIOR07        KPJBU
068090010216     C                   CALL      'FIOR07R'
068100010216     C                   PARM                    KPJBA
068110010227     C                   MOVEL     '1'           WEMFOR
068120010216     C                   GOTO      ENDORM
068130010216     C                   ENDIF
068140010214     C* SE NON SONO NEL GIRO DEI PREPAGATI ORMTOR DEVE ESSERE DIVERSO
068150010214     C* DA "P"
068160010215    2C     *IN22         IFEQ      *OFF
068170010214     C     ORMTOR        ANDEQ     'P'
068180010214     C                   MOVEL     ERR(222)      VIDMSG
068190010214     C                   SETON                                        90
068200010215    3C     WPERSO        IFEQ      'P'
068210040901     C                   Z-ADD     05            H0RIGA
068220040909     C                   Z-ADD     20            H0COLO
068230010214     C                   ELSE
068240040901     C                   Z-ADD     06            H1RIGA
068250040909     C                   Z-ADD     20            H1COLO
068260010215    3C                   ENDIF
068270010503     C                   GOTO      ENDORM
068280010215    2C                   ENDIF
068290010214     C* VICEVERSA DEVE ESSERE = "P"
068300010215    2C     *IN22         IFEQ      *ON
068310010214     C     ORMTOR        ANDNE     'P'
068320010214     C                   MOVEL     ERR(223)      VIDMSG
068330010214     C                   SETON                                        90
068340010215    3C     WPERSO        IFEQ      'P'
068350040901     C                   Z-ADD     05            H0RIGA
068360040909     C                   Z-ADD     20            H0COLO
068370010214     C                   ELSE
068380040901     C                   Z-ADD     06            H1RIGA
068390040909     C                   Z-ADD     20            H1COLO
068400010215    3C                   ENDIF
068410010503     C                   GOTO      ENDORM
068420010215    2C                   ENDIF
068430100319     c
068440100319     c* Se presente LINEA DI ARRIVO personalizzata e  <> dall'ORM
068450100319     c*  oppure disk B --> erore bloccante
068460100319    2c                   if         not *in12 or not *in15
068470100319    3c                   if         ormpoc>0
068480100319     c
068490100319    4c                   if        (vidlna>*zeros  and *in20 )
068500100319     c                             or (*in12 and not *in15 and §1bfg6='C')
068510100319     c                   movel     vidlna        w0030
068520100319    5c                   if        w0030<>ormpoc
068530100319     C                   MOVEL     ERR(73)       VIDMSG
068540100319     C                   SETON                                        90
068550100319    6C     WPERSO        IFEQ      'P'
068560100319     C                   Z-ADD     05            H0RIGA
068570100319     C                   Z-ADD     20            H0COLO
068580100319     C                   ELSE
068590100319     C                   Z-ADD     06            H1RIGA
068600100319     C                   Z-ADD     20            H1COLO
068610100319    6C                   ENDIF
068620100319     C                   GOTO      ENDORM
068630100319    5C                   ENDIF
068640100319    4C                   ENDIF
068650100319    3C                   ENDIF
068660100319     c
068670100319     c* Se presente FNORE e TSP personalizzato <> dall'ORM
068680100319     c*  errore bloccante
068690100319    3c                   if        wesORE='S'
068700100319    4c                   if        (vidtsp<>' '    and *in18) or
068710100319     c                             (*in12 and not *in15 and §1bfg6='C')
068720100319
068730100319    5c                   if        vidtsp<>§oretsp
068740100319     C                   MOVEL     ERR(71)       VIDMSG
068750100319     C                   SETON                                        90
068760100319    6C     WPERSO        IFEQ      'P'
068770100319     C                   Z-ADD     05            H0RIGA
068780100319     C                   Z-ADD     20            H0COLO
068790100319     C                   ELSE
068800100319     C                   Z-ADD     06            H1RIGA
068810100319     C                   Z-ADD     20            H1COLO
068820100319    6C                   ENDIF
068830100319     C                   GOTO      ENDORM
068840100319    5C                   ENDIF
068850100319    4C                   ENDIF
068860100319    3C                   ENDIF
068870100319    2C                   ENDIF
068880100319     c
068890030805      * controllo la serie dell'ORM, se inserita deve esistere la key
068900030805      * poe + nrs in tab. 'OSR'
068910130116      * dal 16/01/2013 non è più così
068920130116      * la tabella OSR la leggo per cliente ORDINANTE dell'ORM
068930130116      * controllare solo la serie dell'ORM immessa è inutile
068940130116      * l'importante è che esista l'ORM
068950130117If  2c                   If        wonsr > *Zeros
068960130117      /free
068970130117       //?Non faccio controlli se OK orm RC, l'orm è stato controllato
068980130117       //?prima e se è un ORM con serie i controlli sono già stati fatti
068990130117       //?all'immissione dell'ORM
069000130117       //?qua devo solo recuperare i dati dalla tabella OSR
069010130117       //?la tabella la devo agganciare per cliente ordinante dell'ORM
069020130117       //?(solo i primi 7 caratteri del campo ORMCOR)
069030130117         clear dOSR;
069040130117         wORMcor = %dec(%subst(%editc(ORMcor:'X'):1:7):7:0);
069050130117         osrxx = %lookup(wORMcor:skCLIosr);
069060130117         IF  osrxx > 0;
069070130117         //?aggancio tabella OSR per recupero dati x ORM da tabella
069080130117           clear dsbs02;
069090130117           T02mod = 'C';
069100130117           T02cod = 'OSR';
069110130117           T02ke1 = skLNPNRSosr(osrxx);
069120130117           tibs02r(kpjba:dsbs02);
069130130117           IF  T02err = *blank;
069140130117             dOSR = T02uni;
069150130117           ENDIF;
069160130117         ENDIF;
069170130117      /end-free
069180130117
069190130116     c**!!!              Clear                   dOsr
069200130116     c**!!!              Clear                   dsbs02
069210130116     c**!!!              Clear                   wkosr
069220130116     c**!!!              Eval      T02Mod = 'C'
069230130116     c**!!!              Eval      T02Sif = Knsif
069240130116     c**!!!              Eval      T02Cod = 'OSR'
069250130116     c**!!!              Movel     wopoe         wkosr
069260130116     c**!!!              Move      wonsr         wkosr
069270130116     c**!!!              Movel(p)  wkosr         T02Ke1
069280130116     c**!!!              Call      'TIBS02R'
069290130116     c**!!!              Parm                    Kpjba
069300130116     c**!!!              Parm                    Dsbs02
069310130116If  3c**!!!              If        T02Err <> *Blanks
069320130116If  4C**!!!              If        wperso = 'P'
069330130116     c**!!!              Z-Add     05            H0riga
069340130116     c**!!!              Z-Add     20            H0colo
069350130116   x4c**!!!              Else
069360130116     c**!!!              Z-Add     06            H1riga
069370130116     c**!!!              Z-Add     20            H1colo
069380130116    4c**!!!              EndIf
069390130116     c**!!!              Eval      VidMsg = Err(48)
069400130116     c**!!!              Move      wonsr         w002a
069410130116     c**!!!              Eval      %subst(VidMsg:11:2) = w002a
069420130116     c**!!!              Eval      *In90 = *On
069430130116     c**!!!              GoTo      EndOrm
069440130116    3c**!!!              EndIf
069450130116     c**!!!              Movel     T02Uni        dOsr
069460030805      * se non inserito dall'utente imposto il codice bolla
069470030805If  3C                   If        wperso = 'P'
069480030805If  4c                   If        V0cCbo = *Blanks
069490030805     c                   Eval      V0cCbo = d§OsrCbo
069500030805    4c                   EndIf
069510030805   x3c                   Else
069520030805If  4c                   If        VidCbo = *Blanks
069530030805     c                   Eval      VidCbo = d§OsrCbo
069540030805    4c                   EndIf
069550030805    3c                   EndIf
069560030805    2c                   EndIf
069570010404     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
069580010404     C* ANDRO' A PROPORRE NELLE NOTE
069590050211     C***  ORMPOE        IFNE      ORMPOR
069600050211     C***  'TEL.:'       CAT       ORMTER        W021A            21
069610050211     C***  W021A         CAT(P)    ORMRER:1      WTELRF           70
069620050211     C***                MOVE      WTELRF        WTELR2           35
069630050211     C***                ENDIF
069640010212     C* L'ORM DEVE ESSERE IN UNA FASE BOLLETTABILE
069650010212     c* Errore forzabile
069660010220    2C     ORMFAO        IFNE      PREFAO
069670010220     C                   MOVE      ORMFAO        PREFAO
069680010220     C                   CLEAR                   DSBS02
069690010220     C                   MOVEL     'C'           T02MOD
069700010220     C                   MOVEL     KNSIF         T02SIF
069710010220     C                   MOVEL     'FAR'         T02COD
069720010220     C                   MOVEL     ORMFAO        T02KE1
069730010220      *
069740010220     C                   CALL      'TIBS02R'
069750010220     C                   PARM                    KPJBA
069760010220     C                   PARM                    DSBS02
069770010220    3C     T02ERR        IFEQ      *BLANKS
069780010220     C                   MOVEL     T02UNI        DFAR
069790010220     C                   ELSE
069800010220     C                   CLEAR                   DFAR
069810010220    3C                   ENDIF
069820010220    2C                   ENDIF
069830010620     C* Se fase 999: errore bloccante
069840010620     C     §FARFB        IFEQ      'N'
069850050504     c     §lpfpr        andne     'O'
069860010620     C                   MOVEL     ERR(219)      VIDMSG
069870010620     C                   MOVE      *BLANKS       BLANK            45
069880010620     C                   MOVE      BLANK         VIDMSG
069890010620     C                   SETON                                        90
069900010620    4C     WPERSO        IFEQ      'P'
069910040901     C                   Z-ADD     05            H0RIGA
069920040909     C                   Z-ADD     20            H0COLO
069930010620     C                   ELSE
069940040901     C                   Z-ADD     06            H1RIGA
069950040909     C                   Z-ADD     20            H1COLO
069960010620    4C                   ENDIF
069970010620     C                   GOTO      ENDORM
069980010620     C                   ENDIF
069990010220     C*
070000010215    2C     WIDORM        IFNE      W01ORM
070010010223     C                   CLEAR                   WOVUO
070020070427     C                   CLEAR                   WOVUO1
070030070918     C                   CLEAR                   savdrt
070040010226     C                   MOVEL     'S'           CHGORM            1
070050090327     C                   MOVEL     'S'           CHGORM1           1
070060091120     C                   MOVEL     'S'           CHGORM2           1
070070090327     c                   clear                   w_fcli            1
070080031001     c                   Clear                   wfortbo
070090010215     C* Se sono in manutenzione memorizzo che è cambiato il numero
070100010215     C* O.R.M. (Mi serve nelle routine che propongono i campi da orm
070110010215     C* che se in manutenzione devo proporre solo se modificato n. orm)
070120010215    3C     *IN12         IFEQ      *ON
070130010215     C     *IN15         ANDEQ     *OFF
070140010215     C                   MOVEL     '1'           WORMMD            1
070150010215    3C                   ENDIF
070160010214     C* Quando cambia il numero O.R.M. devo pulire i campi per la forza
070170010214     C* tura usati nella routine di controllo congruenza con campi dell
070180010214     c* O.R.M.
070190090326     C                   CLEAR                   PREDRT
070200010214     C                   CLEAR                   PREPDR
070210010214     C                   CLEAR                   PREFPP
070220010214     C                   CLEAR                   PRECCM
070230010214     C                   CLEAR                   PREFFD
070240010214     C                   CLEAR                   PRECTR
070250010504     C* Pulisco anche campo per forzatura su n. O.R.M.
070260010504     C                   CLEAR                   WFORZO
070270070905     c                   clear                   s_drt
070280070905     c                   if        wperso='P'
070290070905     c                   movel     nodi          at0daorm
070300070905     c                   else
070310070905     c                   movel     nodi          atrdaorm
070320070905     c                   endif
070330011122     C* A cambio numero O.R.M. devo anche reimpostare la lna + FLAG DPD
070340111124     c* e clearo i campi note da orm
070350011122    3C     *IN12         IFEQ      *OFF
070360011122     C     *IN15         OREQ      *OFF
070370111124     c                   clear                   vidno1
070380111124     c                   clear                   vidno2
070390111128     c                   clear                   viddno
070400011122     C                   CLEAR                   VIDDPD
070410070214     c* in manutenzione e lna dpd o fedex non la clearo altrimenti non
070420070214     c* è possibile reinstradarla a dpd/fedex
070430070214    4C     ORMPOC        IFEQ      *ZEROS
070440070214     c                   if        *in12='0' or (savntw<>'DPD' and savntw<>
070450070214     c                             'FED')
070460011122     C                   CLEAR                   VIDLNA
070470070214     c                   endif
070480011122     C* SE LNA PERSONALIZZATA DEVO IMPOSTARE QUESTA
070490011122    5C     *IN20         IFEQ      *ON
070500011122     C                   MOVE      V0CLNA        VIDLNA
070510011122    5C                   ENDIF
070520011122    4C                   ENDIF
070530011122     C* Sempre a cmabio di O.R.M. devo anche pulire i campi del desti-
070540011205     C* natario solo se il precedente orm prevedeva la forzatura del
070550011205     C* destinatario
070560011205     C     SORMFD        IFEQ      'S'
070570011122     C                   CLEAR                   VIDRSD
070580011122     C                   CLEAR                   VIDIND
070590011122     C                   CLEAR                   VIDCAD
070600011122     C                   CLEAR                   VIDLOD
070610011122     C                   CLEAR                   VIDPRD
070620011122     C                   CLEAR                   VIDNZD
070630011205     C                   CLEAR                   SORMFD
070640011205     C                   ENDIF
070650011122    3C                   ENDIF
070660010214     C*
070670011122     C                   MOVE      WIDORM        W01ORM
070680010215    3C     §FARFB        IFNE      'S'
070690050504     c     §lpfpr        andne     'O'
070700010212     C                   MOVEL     ERR(219)      VIDMSG
070710010212     C                   SETON                                        90
070720010215    4C     WPERSO        IFEQ      'P'
070730040901     C                   Z-ADD     05            H0RIGA
070740040909     C                   Z-ADD     20            H0COLO
070750010213     C                   ELSE
070760040901     C                   Z-ADD     06            H1RIGA
070770040909     C                   Z-ADD     20            H1COLO
070780010215    4C                   ENDIF
070790010212     C                   GOTO      ENDORM
070800010215    3C                   ENDIF
070810010212     C*
070820010215    2C                   ENDIF
070830010504     C* IN IMMISSIONE NON E' POSSIILE UTILIZZARE UN O.R.M. LE CUI BOLLE
070840010504     C* VENGONO TRASMESSE CON DISK
070850010504     C* ERRORE FORZABILE CON F20
070860010504    2C     *IN12         IFEQ      *OFF
070870010504     C* MEMORIZZO SE PREMUTO COMANDO PER FORZATURA
070880010504     C     *INKU         IFEQ      *ON
070890010504     C                   MOVEL     '1'           WFORZO            1
070900010504     C                   ENDIF
070910010924    3C     §ORMCB        IFEQ      'S'
070920010504     C     WFORZO        ANDEQ     *BLANKS
070930010504     C                   SETON                                        90
070940010504     C                   MOVEL     ERR(230)      VIDMSG
070950010504    4C     WPERSO        IFEQ      'P'
070960040901     C                   Z-ADD     05            H0RIGA
070970040909     C                   Z-ADD     20            H0COLO
070980010504     C                   ELSE
070990040901     C                   Z-ADD     06            H1RIGA
071000040909     C                   Z-ADD     20            H1COLO
071010010504    4C                   ENDIF
071020010504     C                   GOTO      ENDORM
071030010504    3C                   ENDIF
071040010504    2C                   ENDIF
071050011122     C* Proteggo i campi a video relativi il destinatario se devo forza
071060011122     C* re il destinatario da orm
071070011122     C     §ORMFD        IFEQ      'S'
071080011122     C                   MOVEL     PROT          ATRDES
071090011122     C                   ELSE
071100011122     C                   CLEAR                   ATRDES
071110011122     C                   ENDIF
071120090429
071130090429     c                   clear                   poentw
071140090429     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
071150090429     C                   MOVEL     OG143         SAV143
071160090429     C  N30              MOVEL     ORGDE3        OG143
071170090429     C   30              CLEAR                   OG143
071180090429     c                   eval      poentw=§ogntw
071190090429     C                   MOVEL     SAV143        OG143
071200090429
071210010227     C* SE ORM FITTIZIO E PREMUTO F8 DEVO RIEMETTERE LA VIDEATA
071220010227   X1C                   ELSE
071230040319      * imposto flag se sono in manutenzione ed ho modificato il n. ORM
071240040319if  2c                   If        *In12 and Not *In15 and
071250040319     c                             widorm <> w01orm
071260040319     C                   Eval      wmodorm = *On
071270040319e   2c                   EndIf
071280070829     c* a cambio numero orm devo mettere in ND la scritta
071290070829     c* eventuale "DA O.R.M."
071300070829     c                   if        widorm <> w01orm
071310090327     C                   MOVE      WIDORM        W01ORM
071320090327     C                   MOVEL     'S'           CHGORM1           1
071330091120     C                   MOVEL     'S'           CHGORM2           1
071340090327     c                   clear                   w_fcli
071350070918     c                   clear                   savdrt
071360070829     c                   if        wperso='P'
071370070829     c                   eval      at0daorm=nodi
071380070829     c                   else
071390070829     c                   eval      atrdaorm=nodi
071400070829     c                   endif
071410111124     c                   clear                   vidno1
071420111124     c                   clear                   vidno2
071430111128     c                   clear                   viddno
071440070829     c* solo in immissione: reimposto la data ritiro a udate se l'utente non
071450070829     c* l'ha variata
071460070829     c                   if        *in12='0' and viddrt<>wdtgio and viddrt>0
071470071107     c****                         and viddrt=s_drt  and dateu>=§vpodrt
071480071107     c                             and viddrt=s_drt
071490070831     c                   if        wperso='P'
071500070831     c                   clear                   viddrt
071510070831     c                   eval      s_drt=viddrt
071520070831     c                   else
071530070829     c                   eval      viddrt=wdtgio
071540070829     c                   eval      s_drt=wdtgio
071550070831     c                   endif
071560070829     c                   movel     '1'           wemfor
071570070829     c                   goto      endorm
071580070829     c                   endif
071590070904     c* Per ora non faccio il seguente controllo: se passo da un reale a un
071600070904     c* fittizio l'utente deve stare attento alla data ritiro.
071610070829     c* in manutenzione: se orm sulla bolla 999999 e data ritiro video<>da
071620070829     c* data ritiro bolla rimetto data ritiro bolla
071630070904     c*                  if        *in12 and *in15='0' and viddrt<>s_drtblp
071640070904     c*                  eval      viddrt=s_drtblp
071650070904     c*                  movel     '1'           wemfor
071660070904     c*                  goto      endorm
071670070904     c*                  endif
071680070829     c                   endif
071690040319
071700010227     C   KH              MOVEL     '1'           WEMFOR
071710010227     C   KH              GOTO      ENDORM
071720010215    1C                   ENDIF
071730010222     C* PERSONALIZZAZIONE
071740010222     C     WPERSO        IFEQ      'P'
071750010222     C                   SETON                                        37
071760010222     C                   ENDIF
071770011122     C  N90              CLEAR                   WCKORM
071780011205     C* Mi salvo il contenuto §ormfd per sapere se a cambio di O.R.M.
071790011205     C* devo pulire i dati del destinatario
071800090429     c                   clear                   sormfd
071810090429     c                   if        flgfit<>'S'
071820011205     C                   MOVE      §ORMFD        SORMFD
071830090429     c                   endif
071840010222   X0C                   ELSE
071850010226     C* SE PERSONALIZZATO GESTISCO EVENTUALE CMD08
071860010227     C* CMD8 - VISUALIZZA ORM
071870010223     C     *INKH         IFEQ      *ON
071880010227     C     FLGFIT        IFNE      'S'
071890010222     C                   CLEAR                   FIOR07
071900010222     C                   Z-ADD     WOPOE         D07POE
071910010222     C                   Z-ADD     WONSR         D07NSR
071920010222     C                   Z-ADD     WONOR2        D07NOR
071930010222     C                   Z-ADD     WONRV         D07NRV
071940070627     c     simtpp        ifeq      '2'
071950020513     c     simtpp        oreq      *blanks
071960020513     c                   move      simpou        d07fgs
071970010222     C                   ELSE
071980010222     C                   Z-ADD     SIMFEL        D07FGS
071990010222     C                   ENDIF
072000010222     C                   MOVEL     FIOR07        KPJBU
072010010222     C                   CALL      'FIOR07R'
072020010222     C                   PARM                    KPJBA
072030010226     C                   ENDIF
072040010227     C                   MOVEL     '1'           WEMFOR
072050010222     C                   GOTO      ENDORM
072060010222     C                   ENDIF
072070010222    0C                   ENDIF
072080090327     c* Se era stato impostato cliente/tariffa per tassazione porti assegnati
072090090327     c* verifico se emettere messaggio per avvisare che cambiando l'orm
072100090327     c* i dati verranno automaticamente modificati
072110091120    1c                   if        chgorm1='S' and *in04
072120090327    2c***                if        flgfit<>'S' and ormksc>0
072130090327    2c****                         and wcliksc>0 and atrwksc=*blanks
072140090327    3c***                if        w_fcli=' '
072150090327     c***                movel     '1'           w_fcli
072160090327     C***                MOVEL     ERR(321)      VIDMSG
072170090327     C***                SETON                                        90
072180090327     C***                GOTO      ENDORM
072190090327    3c***                endif
072200090327    2c****               endif
072210090327    2c                   if        (flgfit<>'S' and ormksc>0)
072220090327     c                             or atrwksc<>*blanks
072230090327     c                   exsr      sr_inzwdwcli
072240090327    2c                   endif
072250090327     c                   clear                   chgorm1
072260090327    1c                   endif
072270091120     c* a cambio di orm inzializzo window per scelta beneficiario c/a
072280091120    1c                   if        chgorm2='S'
072290091120     c                   exsr      inzwdwcas
072300091123     c                   clear                   chgorm2
072310091120     c                   endif
072320010212     C     ENDORM        ENDSR
072330010215     C*
072340010214     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA I° VIDEATA) -----------*
072350010215     C     PRPOR1        BEGSR
072360010212     C                   CLEAR                   WEFORM
072370070806     C*
072380070905     C* DATA RITIRO (SOLO SE ORM E' IN UNA FASE valida ai fini della da
072390070905     c* ta ritiro)
072400070905    2C     §LPFPR        ifne      'O'
072410070905     c                   exsr      fordrt
072420070905    2C                   ENDIF
072430111124     c* NOTE in visualizzazione
072440111124     c                   if        (ormno1<> *blanks or ormno2<>*blanks)
072450111124     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
072460120127     c                   movel     ormno1        vidno1
072470120127     c                   movel     ormno2        vidno2
072480120127     c                   movel     'NoteOrm'     viddno
072490120127     C                   MOVEL     '1'           WEFORM
072500111124     c                   endif
072510070806     c*
072520010215    1C     *IN12         IFEQ      *OFF
072530010220     C* In manutenzione propongo solo se variato il numero ORM
072540010215     C     *IN15         OREQ      *OFF
072550010220     C     WORMMD        ANDEQ     '1'
072560010215     C     *IN15         OREQ      *ON
072570010212     C*
072580040901     c*
072590050426     c*****              exsr      PRPOR1bis
072600010215     C*
072610010212     C* ATTENZIONE! SE SONO IN CONFERMA BOLLE DA DISCHETTO I SEGUENTI
072620010212     C* DATI NON LI DEVO PRENDERE DALL'ORM:
072630011121     C* (FANNO ECCEZIONE LE PROPOSTE DEL DESTINATARIO SE §ORMFD='S')
072640010212     C*
072650010212     C* CLIENTE MITTENTE
072660010215    2C     *IN12         IFEQ      *OFF
072670010212     C     *IN15         OREQ      *OFF
072680010215    3C     VIDCCM        IFEQ      *ZEROS
072690031201     c                   Eval      wnoccm = '1'
072700010215    4C     ORMKSC        IFGT      *ZEROS
072710010213     C                   MOVEL     '1'           WEFORM
072720030905      * Propongo il ksc dell'orm se l'ORM preve la bolla in porto franco
072730091020    5c     §OrPfb        Ifne      'A'
072740010212     C                   MOVE      ORMKSC        VIDCCM
072750010212     C                   MOVEL     ORMKSC        W0030             3 0
072760130212     C                   Z-ADD     W0030         VIDFLC
072770010215    6C     W0030         IFNE      VIDLNP
072780130212     C****               Z-ADD     W0030         VIDFLC
072790010302     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
072800010302     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
072810041129     C                   SETON                                        14
072820010215    6C                   ENDIF
072830010215   X5C                   ELSE
072840030905      * Propongo 9999 se l'orm prevede la bolla in porto assegnato
072850010212     C                   Z-ADD     9999          VIDCCM
072860010215    5C                   ENDIF
072870010214     C                   MOVE      VIDCCM        PRECCM
072880010214     C                   MOVEL     VIDFLC        PRECCM
072890010215    5C     VIDFLC        IFEQ      0
072900010214     C                   MOVEL     VIDLNP        PRECCM
072910010215    5C                   ENDIF
072920010215   X4C                   ELSE
072930030905      * se Ksc vuoto e l'orm prevede la bolla in porto franco propongo la
072940010214     C* RAGIONE SOCIALE NEL CAMPO DELLA RICERCA ALFABETICA
072950030905    5c     §OrPfb        Ifne      'A'
072960010215    6C     VIDDMT        IFEQ      *BLANKS
072970010215     C                   MOVEL     ORMRSR        VIDDMT
072980041129     C                   MOVEL     '1'           WEFORM
072990041129     C     VIDDMT        IFNE      *BLANKS
073000041129     C***                SETON                                        0138
073010041129     C                   SETON                                        01
073020041129     C                   ENDIF
073030010215    6C                   ENDIF
073040010328   X5C                   ELSE
073050030905      * se ksc vuoto e l'orm prevede la bolla in porto assegnato
073060030905      * PROPONGO 9999 IN CCM
073070010328     C                   Z-ADD     9999          VIDCCM
073080010328     C                   MOVEL     '1'           WEFORM
073090010215    5C                   ENDIF
073100010215    4C                   ENDIF
073110010215    3C                   ENDIF
073120011121    2C                   ENDIF
073130010212     C* DESTINATARIO (RAG SOC,INDIR....)
073140011121    2C     *IN12         IFEQ      *OFF
073150011121     C     *IN15         OREQ      *OFF
073160011121     C     *IN15         OREQ      *ON
073170011121     C     §ORMFD        ANDEQ     'S'
073180011121     C*
073190010215    3C     ORMTOR        IFEQ      'S'
073200010301     C     §LPFPR        OREQ      'O'
073210010215    4C     VIDRSD        IFEQ      *BLANKS
073220011122     C     ORMRSC        ANDNE     *BLANKS
073230011121     C     §ORMFD        OREQ      'S'
073240011122     C     ORMRSC        ANDNE     VIDRSD
073250010214     C                   MOVEL     '1'           WEFORM
073260010212     C                   MOVEL     ORMRSC        VIDRSD
073270010215    4C                   ENDIF
073280010215    4C     VIDIND        IFEQ      *BLANKS
073290011122     C     ORMINC        ANDNE     *BLANKS
073300011121     C     §ORMFD        OREQ      'S'
073310011122     C     ORMINC        ANDNE     VIDIND
073320010213     C                   MOVEL     '1'           WEFORM
073330010212     C                   MOVEL     ORMINC        VIDIND
073340010215    4C                   ENDIF
073350010215    4C     VIDCAD        IFEQ      *BLANKS
073360011122     C     ORMCAC        ANDNE     *BLANKS
073370011121     C     §ORMFD        OREQ      'S'
073380011122     C     ORMCAC        ANDNE     VIDCAD
073390010213     C                   MOVEL     '1'           WEFORM
073400010212     C                   MOVEL     ORMCAC        VIDCAD
073410010215    4C                   ENDIF
073420160112     c* eseguo routine per eliminare caratteri non ammessi nella
073430160112     c* località destinatario da ORM
073440140211     c                   clear                   ormloc_n
073450140211     c                   if        ormloc<>*blanks
073460160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
073470140211     c                   eval      wtxt=ormloc
073480160112     c                   eval      ElencoChar=charnook
073490160112     c                   eval      TipoElenco='1'
073500160112     c                   clear                   UpperCase
073510160112     c                   exsr      sr_chk
073520160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
073530160112     c* alla  fine
073540140211     c                   exsr      chkstringa
073550140211     c                   movel     wtxt          ormloc_n
073560140211     c                   endif
073570010215    4C     VIDLOD        IFEQ      *BLANKS
073580140211     C     ORMLOC_n      ANDNE     *BLANKS
073590011121     C     §ORMFD        OREQ      'S'
073600140211     C     ORMLOC_n      ANDNE     VIDLOD
073610010213     C                   MOVEL     '1'           WEFORM
073620140211     C                   MOVEL     ORMLOC_n      VIDLOD
073630010215    4C                   ENDIF
073640010216    4C     VIDPRD        IFEQ      *BLANKS
073650010216     C     ORMPRC        ANDNE     *BLANKS
073660010216     C     VIDCAD        ANDEQ     ORMCAC
073670010216     C     VIDCAD        ANDNE     *BLANKS
073680011121     C     §ORMFD        OREQ      'S'
073690011122     C     ORMPRC        ANDNE     VIDPRD
073700010216     C                   MOVEL     '1'           WEFORM
073710010216     C                   MOVEL     ORMPRC        VIDPRD
073720010216    4C                   ENDIF
073730010216    4C     VIDNZD        IFEQ      *BLANKS
073740010216     C     ORMNAC        ANDNE     *BLANKS
073750010216     C     VIDCAD        ANDEQ     ORMCAC
073760010216     C     VIDCAD        ANDNE     *BLANKS
073770011121     C     §ORMFD        OREQ      'S'
073780011122     C     ORMNAC        ANDNE     VIDNZD
073790010216     C                   MOVEL     '1'           WEFORM
073800010216     C                   MOVEL     ORMNAC        VIDNZD
073810010216    4C                   ENDIF
073820010215    3C                   ENDIF
073830011121    2C                   ENDIF
073840011121     C*
073850011121    2C     *IN12         IFEQ      *OFF
073860011121     C     *IN15         OREQ      *OFF
073870010212     C* LINEA DI ARRIVO
073880010214     C* La linea di arrivo se presente sull'orm deve sempre essere
073890010214     C* uguale a video quindi, se diversa, la forzo
073900010228     C* Il messaggio di errore lo emetto solo se lna a video > 0 e <> DA ORM
073910010215    3C     ORMPOC        IFGT      *ZEROS
073920010215    4C     VIDLNA        IFGT      *ZEROS
073930010215     C                   MOVE      VIDLNA        W0030
073940010215    5C     W0030         IFNE      ORMPOC
073950010213     C                   MOVEL     RIMM          ATRLNA
073960010213     C                   MOVEL     ERR(220)      VIDMSG
073970010216     C                   MOVEL     '1'           WEFORM
073980010216     C                   MOVE      ORMPOC        VIDLNA
073990010216     C                   SETON                                        9047
074000010215    5C                   ENDIF
074010010216   X4C                   ELSE
074020010216     C                   MOVEL     '1'           WEFORM
074030010216     C                   MOVE      ORMPOC        VIDLNA
074040010216    4C                   ENDIF
074050020204     C* SE LNA DPD DEVO IMPOSTARE 'D' NEL network
074060020207     C* SE LNA FEDEX DEVO IMPOSTARE 'F' NEL network
074070010214     C* SE SONO IM MANUTENZIONE NON LO DEVO FARE PERCHE' IN QUESTO
074080010214     C* CASO NON C'E' IL CAMPO VIDDPD
074090010215    4C     *IN12         IFEQ      *OFF
074100010215     C     ORMPOC        CHAIN     AZORG01L      UNIORG               30
074110010214     C                   MOVEL     OG143         SAV143
074120010214     C                   MOVEL     ORGDE3        OG143
074130020319    5C     §OGNTW        IFEQ      'DPD'
074140020204     C                   MOVEL     'D'           VIDDPD
074150020204     c                   else
074160020204     c     §ogntw        ifeq      'FED'
074170020204     c                   movel     'F'           viddpd
074180020204     c                   endif
074190010215    5C                   ENDIF
074200010214     C                   MOVEL     SAV143        OG143
074210010215    4C                   ENDIF
074220010215    3C                   ENDIF
074230010314     C* FERMO DEPOSITO  - RIEMETTO LA VIDEATA SOLO SE SU ORM E' = 'S'
074240010215    3C     VIDFFD        IFEQ      *BLANKS
074250010215    4C     ORMFFD        IFEQ      'S'
074260010213     C                   MOVE      'S'           VIDFFD
074270010314     C                   MOVEL     '1'           WEFORM
074280010213     C                   ELSE
074290010213     C                   MOVE      'N'           VIDFFD
074300010215    4C                   ENDIF
074310010214     C                   MOVE      VIDFFD        PREFFD
074320010215    3C                   ENDIF
074330100319     c*
074340100319     c* TIPO SERVIZIO da FNORE
074350100319     c*  come per la linea di arrivo, se diversa la cambio emettendo MSG
074360100319   3ac                   if        Wesore<>'N'
074370100319     c                   clear                   WesORE
074380100319     c                   clear                   DoreGEN
074390100319     c     korme         chain     fnore01l
074400100319    3c                   if        %found(fnore01l)
074410100319     c                   movel     oredati       doreGEN
074420100319     c                   eval      wesore='S'
074430100319     C                   Z-ADD     1             C
074440100319     C     §oretsp       LOOKUP    TSP(C)                                 30
074450100319    4c                   if        *in30 and uts(c)='S'
074460100319    5c                   if        vidtsp<>*blanks and
074470100319     c                             vidtsp<>§oretsp
074480100319     C                   MOVEL     RIMM          ATRtsp
074490100319     c* Se già impostato per la linea di arrivo --> uni msg
074500100319    6c                   if        vidmsg=err(220)
074510100319     C                   MOVEL     ERR(74)       VIDMSG
074520100319     c                   else
074530100319     C                   MOVEL     ERR(75)       VIDMSG
074540100319    6c                   endif
074550100319     c
074560100319     C                   MOVEL     '1'           WEFORM
074570100319     C                   SETON                                        9048
074580100319    5C                   ENDIF
074590100319     c
074600100319     c* Riemetto video anche se TSP vuoto
074610100319     c                   if        vidtsp=' '
074620100319     C                   MOVEL     '1'           WEFORM
074630100319     c                   endif
074640100319     C                   MOVE      §oretsp       VIDtsp
074650100319    4c                   endif
074660100319    3c                   endif
074670100319   3ac                   endif
074680100319     c
074690010215    2C                   ENDIF
074700010301     C* SE SONO RICHIAMATA DA CONFERMA ORM PREPAGATI DEVO PROPORRE
074710010301     C* ANCHE COLLI E PESO
074720010301     C     §LPFPR        IFEQ      'O'
074730010301     C     V1CNCL        IFEQ      *ZEROS
074740010301     C                   Z-ADD     ORMNCL        V1CNCL
074750010301     C                   MOVEL     '1'           WEFORM
074760010305     C                   Z-ADD     ORMNCL        PRENCL
074770010301     C                   ENDIF
074780010301     C     VIDPKG        IFEQ      *ZEROS
074790010301     C                   Z-ADD     ORMPKG        VIDPKG
074800010305     C                   Z-ADD     ORMPKG        PREPKG
074810010301     C                   MOVEL     '1'           WEFORM
074820010301     C                   ENDIF
074830010301     C                   ENDIF
074840061124     c*
074850061124     c                   if        wforpf='1'
074860061124     c                   eval      §orpfb='A'
074870061124     c                   clear                   wforpf
074880061124     c                   endif
074890031201
074900031201      * se non sono in conferma bolle da clienti
074910060428if  1c                   If        (Not *In12 or Not *In15) and
074920031201      * e l'ORM prevede:
074930031201      *               --> la bolla in porto Assegnato
074940031201      *               --> paga ordinante orm
074950031201      *               --> destinatario orm estero
074960031201      *               --> ordinante orm italia
074970060428      * n.b.:per sapere se destinatario estero nei casi in cui sull'orm
074980060428      *      non è indicato ma è indicato a video devo testare il contenuto
074990060428      *      di vidnzd (wdesie infatti è disponibile solo dopo che il pgm
075000060428      *      ha fatto i controlli del destinatario che vengono fatti dopo
075010060428      *      questo controllo). Anche se non è corretto testare vidnzd
075020060428      *      per sapere se nazione estera (è il flag §15ita che me lo dice)
075030060428      *      era l'unico modo per gestire la videata in maniera chiara
075040060428      *      per il bollettista effettuando la forzatura nel momento
075050060428      *      giusto anzichè dare altre segnalazioni di errore che con-
075060060428      *      fonderebbero sicuramente.
075070031201     c                             (§OrPfb = 'A' and OrmPag = 'O' and
075080060914     c                             (OrmNac<>*Blanks or vidnzd<>*blanks))
075090060914     c*
075100060914    2c                   if        ormnao <> *blanks
075110060914     c                   movel     ormcor        po_cor            3 0
075120060914     c                   clear                   w_ordntw          1
075130060914     c     po_cor        chain     azorg01l      uniorg
075140060914    3c                   if        %found(azorg01l)
075150060914     C                   MOVEL     OG143         SAV143
075160060914     c                   movel     orgde3        og143
075170060914    4c                   if        §ogntw = 'EEX' or §ogntw='DPD'
075180060914     c                             or  §ogntw='FED'
075190060914     c                   movel     'E'           w_ordntw
075200060914    4c                   endif
075210060914     C                   MOVEL     SAV143        OG143
075220060914    3c                   endif
075230060914    2c                   endif
075240060914    2c                   if        ormnao = *blanks or w_ordntw<>'E'
075250050622      **non era impostato vidccm
075260050622     c***                          wnoccm = '1'
075270060427     c                   exsr      sr_FOrmEst
075280060914    2c                   endif
075290031201    1c                   EndIf
075300031201
075310010301     C*
075320010213     C   90              MOVEL     '1'           WEMFOR
075330010215    2C  N90WEFORM        IFEQ      '1'
075340010213     C* SE SONO IN CONFERMA RICHIAMATA CON X O W NON DEVO RIEMETTERE
075350010213     C* LA VIDEATA PER VISUALIZZARE CAMPI DA ORM QUINDI PULISCO FLAG
075360010215    3C     §LPFPR        IFEQ      'V'
075370010213     C     *IN12         OREQ      *OFF
075380010213     C     *IN15         OREQ      *OFF
075390010213     C                   ELSE
075400010213     C                   CLEAR                   WEFORM
075410010215    3C                   ENDIF
075420010215    2C                   ENDIF
075430010215    1C                   ENDIF
075440040901     C                   ENDSR
075450070806     c***
075460070806     c* Forzatura data ritiro da orm ---------------------------------*
075470070806     c***
075480070806     c     fordrt        begsr
075490070905     c*
075500070806     C                   CLEAR                   WLBDAT
075510070806     C                   MOVEL     '3'           G02ERR
075520070806     c* se fase utilizzabile propongo la data della fase
075530070806    3C     d§fardar      ifeq      'S'
075540071112     c                   if        ormfao=400
075550071112     c                   z-add     ormddc        g02inv
075560071112     c                   else
075570070806     C                   Z-ADD     ORMDFO        G02INV
075580071112     c                   endif
075590070806   x3c                   else
075600070806     c* se l'orm non è in una fase utilizzabile per la data ritiro prendo
075610070806     c* la data ritiro presente sull'orm
075620070806     C                   Z-ADD     ORMDAR        G02INV
075630070806    3c                   endif
075640070806     c* se la data ritiro da proporre è maggiore della data odierna non
075650070905     c* propongo nulla. Non propongo la data anche se bolla import
075660070905    3c                   if        g02inv<=dateu and
075670081008     c                              §ogntw<>'EEX' and §ogntw<>'FED'
075680081008     c                              and §ogntw<>'DPD'
075690071107    4c***                if        viddrt= *zeros  or
075700071107     c****                          dateu>=§vpodrt
075710081008     c*                            (§ogntw<>'EEX' and §ogntw<>'FED'
075720081008     c*                             and §ogntw<>'DPD' and
075730070905     c*                             dateu>=§vpodrt)
075740070806     C                   CALL      'XSRDA8'
075750070806     C                   PARM                    WLBDAT
075760070905    5c                   if        g02dat<>viddrt
075770070806     c* se modificata data avviso con dicitura "DA ORM" blinking
075780070806    6c                   if        viddrt>0
075790070806     c                   if        wperso='P'
075800070806     c                   movel     blnk          at0daorm
075810070806     c                   else
075820070806     c                   movel     blnk          atrdaorm
075830070806     c                   endif
075840070806    6c                   endif
075850070905     C                   MOVEL     '1'           WEFORM            1
075860070806     C                   Z-ADD     G02DAT        VIDDRT
075870070806     C                   Z-ADD     VIDDRT        PREDRT
075880070806    5c                   endif
075890070918     C                   Z-ADD     G02DAT        s_drt
075900071107    4C****               ENDIF
075910070905   x3c                   else
075920070905     c* se non propongo la data perchè > data giorno o bolla import
075930070905     c* propongo udate
075940070918     c                   if        *in12='0'
075950070918     c                   if        viddrt=*zeros or
075960071107     c                             s_drt=0
075970071107     c****                         (dateu>=§vpodrt and s_drt=0)
075980070918     c****               if        s_drt=0 or (Dateu<§vpodrt and viddrt=0)
075990070918     c                   if        viddrt<>wdtgio
076000070918     C                   MOVEL     '1'           WEFORM            1
076010070918     c                   endif
076020070905     c                   z-add     wdtgio        viddrt
076030070905     c                   z-add     wdtgio        s_drt
076040070905     C                   Z-ADD     VIDDRT        PREDRT
076050070905     c                   endif
076060070918     c                   endif
076070070806    3C                   ENDIF
076080070806    cc                   endsr
076090040901     C*
076100040901     C* Proposta dati da orm - bis - Campi della prima videata ------*
076110060522     c* ATTENZIONE! Questa routine è al momento inutilizzata. Se diveni
076120060522     c* sse necessario riattivarla occorre rivederla in quanto non
076130060522     c* è sufficiete cercare la distinta con ormpor in quanto ormpor
076140060522     c* potrebbe essere un p.o. gestito ed in questo caso bisogna
076150060522     c* cercare la distinta della lnp bolla
076160120611     C**** PRPOR1bis     BEGSR
076170040901     C*
076180040901     C* PADRONCINO - LO DETERMINO DALLA DISTINTA
076190040901     C* IDEM FLAG MATTINO/POMERIGGIO
076200040901     C* Propongo il flag mattino/pomeriggio solo se non immesso e se il
076210040901     c* padroncino a video è uguale a quello della distinta
076220040901     C* Non propongo mai se richiamata da conferma prepagati
076230120611     C**** §LPFPR        IFNE      'O'
076240120611    2C**** ORMNDC        IFGT      *ZEROS
076250120611     C**** VIDPDR        ANDEQ     *ZEROS
076260120611     C**** *IN22         ANDEQ     *OFF
076270120611    2C**** ORMNDC        ORGT      *ZEROS
076280120611     C**** VIDPDR        ANDEQ     *BLANKS
076290120611     C**** *IN22         ANDEQ     *OFF
076300120611     C**** ORMNDC        ORGT      *ZEROS
076310120611     C**** VIDPDR        ANDEQ     '?   '
076320120611     C**** *IN22         ANDEQ     *OFF
076330120611     C**** ORMNDC        ORGT      *ZEROS
076340120611     C**** VIDFPP        ANDEQ     *BLANKS
076350120611     C**** *IN22         ANDEQ     *OFF
076360120611     c****
076370120611     C****               MOVE      ORMNDC        W0050             5 0
076380120611     C**** KDST          CHAIN     FIDST01L                           30
076390120611    3C**** *IN30         IFEQ      *OFF
076400120611    4C**** VIDPDR        IFEQ      *ZEROS
076410120611    4C**** VIDPDR        OREQ      *BLANKS
076420120611    4C**** VIDPDR        OREQ      '?   '
076430120611     C****               MOVE      DSTPDR        VIDPDR
076440120611     c****               clear                   v1dpdr
076450120611     C****               MOVE      DSTPDR        PREPDR
076460120611     C****               MOVEL     '1'           WEFORM
076470120611    4C****               ENDIF
076480120611     C****               MOVE      DSTPDR        WDPDR
076490120611    4C**** VIDPDR        IFEQ      WDPDR
076500120611     C**** VIDFPP        ANDEQ     *BLANKS
076510120611     C****               MOVE      ORMNDC        W0050
076520120611     C**** KFVV          CHAIN     FNFVV01L                           30
076530120611     C****               MOVE      FVVFPP        VIDFPP
076540120611     C****               MOVEL     FVVFPP        PREFPP
076550120611     C****               MOVEL     '1'           WEFORM
076560120611    4C****               ENDIF
076570120611    3C****               ENDIF
076580120611    2C****               ENDIF
076590120611     C****               ENDIF
076600120611     c****               ENDSR
076610010214     C*
076620010214     C* CONTROLLI DI CONGRUENZA CAMPI I°VIDEATA CON CAMPI DELL'ORM --*
076630010214     C     CNFOR1        BEGSR
076640050427     c                   clear                   wcaut            27
076650010214     C*
076660010214     C* I seguenti errori sono tutti forzabili e vengono effettuati
076670010214     C* solo se numero ORM non fittizio e se non sono in immissione
076680010214     C* dei miei prepagati perchè in questo caso l'ORM viene crato
076690010214     C* dopo l'immissione del prepagato
076700010214     C*
076710010215    1C     FLGFIT        IFNE      'S'
076720010214     C     PARTCH        ANDNE     'P'
076730010214     C*
076740010214     C*** DATA RITIRO ***
076750010214     C*
076760071107     c****               if        dateu<§vpodrt
076770071107    2C**** VIDDRT        IFGT      *ZEROS
076780071107     C**** §LPFPR        ANDNE     'O'
076790071107     C**** d§fardar      ANDEQ     'S'
076800071107     C**** VIDDRT        ANDNE     PREDRT
076810071107     C**** ORMDFO        ANDNE     COMDRT
076820071107     C****               MOVEL     RIMM          ATRDRT
076830071107     C****               Z-ADD     VIDDRT        PREDRT
076840071107     C****               SETON                                        90
076850071107    2C****               ENDIF
076860071107     c****               endif
076870040902     c                   exsr      CNFOR1bis
076880010214     C* I SEGUENTI CONTROLLI VENGONO FATTI SOLO SE NON SONO IN CONFERMA
076890010214     C* BOLLE DA DISCHETTO
076900010215    2C     *IN12         IFEQ      *OFF
076910010214     C     *IN15         OREQ      *OFF
076920010214     C*
076930010214     C** CODICE CLIENTE MITTENTE
076940010214     C*
076950010215    3C     VIDCCM        IFGT      *ZEROS
076960010214     C     ORMKSC        ANDGT     *ZEROS
076970010214     C                   MOVE      VIDCCM        WOCCM
076980010214     C                   MOVEL     VIDFLC        WOCCM
076990010215    4C     WOCCM         IFNE      PRECCM
077000010214     C                   Z-ADD     WOCCM         PRECCM
077010010215    5C     VIDFLC        IFEQ      *ZEROS
077020010214     C                   MOVEL     VIDLNP        WOCCM
077030010215    5C                   ENDIF
077040010215    5C     WOCCM         IFNE      ORMKSC
077050030905    6c                   If        §OrPfb <> 'A'
077060010214     C                   MOVEL     RIMM          ATRCCM
077070010214     C                   SETON                                        90
077080010215   X6C                   ELSE
077090030905    7c                   If        Vidccm <> 9999
077100010214     C                   MOVEL     RIMM          ATRCCM
077110010214     C                   SETON                                        90
077120010215    7C                   ENDIF
077130010215    6C                   ENDIF
077140010215    5C                   ENDIF
077150010215    4C                   ENDIF
077160010215    3C                   ENDIF
077170010214     C*
077180010214     C** FERMO DEPOSITO
077190010214     C*
077200010215     C     ORMFFD        IFEQ      ' '
077210010215     C                   MOVE      'N'           W001A             1
077220010215     C                   ELSE
077230010215     C                   MOVE      ORMFFD        W001A
077240010215     C                   ENDIF
077250010215    3C     VIDFFD        IFNE      W001A
077260010214     C     VIDFFD        ANDNE     PREFFD
077270010220     C                   MOVE      VIDFFD        PREFFD
077280010214     C                   MOVEL     RIMM          ATRFFD
077290010214     C                   SETON                                        90
077300010215    3C                   ENDIF
077310010305     C*
077320010305     C** COLLI E PESO ** SE SONO IN CONFERMA PREPAGATI DI ALTRI P.O.
077330010305     C*
077340010305    3C     §LPFPR        IFEQ      'O'
077350010305    4C     V1CNCL        IFNE      ORMNCL
077360010305     C     V1CNCL        ANDNE     PRENCL
077370010305     C                   Z-ADD     V1CNCL        PRENCL
077380010305     C                   MOVEL     RIMM          ATRNCL
077390010305     C                   SETON                                        90
077400010305    4C                   ENDIF
077410010305    4C     VIDPKG        IFNE      ORMPKG
077420010305     C     VIDPKG        ANDNE     PREPKG
077430010305     C                   Z-ADD     VIDPKG        PREPKG
077440010305     C                   MOVEL     RIMM          ATRPKG
077450010305     C                   SETON                                        90
077460010305    4C                   ENDIF
077470010305    3C                   ENDIF
077480010215    2C                   ENDIF
077490010214     C*
077500010214     C   90              MOVEL     ERR(221)      VIDMSG
077510010214     C   90              MOVEL     '1'           WEMFOR
077520050427     c   90              if        wcaut <> *blanks
077530050427     c                   move      wcaut         vidmsg
077540050427     c                   endif
077550010215    1C                   ENDIF
077560010214     C                   ENDSR
077570040902     C*
077580040902     C* CONTROLLI DI CONGRUENZA CAMPI PDR e FPP CON CAMPI DELL'ORM --*
077590040902     C     CNFOR1bis     BEGSR
077600040902     C*
077610040902     C**
077620040902     C* CODICE PADRONCINO + FLAG MATTINO/POMERIGGIO
077630040902     C**
077640040902    2C     ORMNDC        IFGT      *ZEROS
077650040902     C     VIDPDR        ANDGT     *ZEROS
077660040902     C     VIDPDR        ANDNE     PREPDR
077670070606     c                   exsr      sr_dst
077680040902     C                   MOVE      DSTPDR        WDPDR
077690040902    3C     WDPDR         IFNE      VIDPDR
077700050426     c**   atrpdr        ifne      prri
077710040902     C                   MOVEL     RIMM          ATRPDR
077720050426     c**                 endif
077730040902     C                   MOVE      VIDPDR        PREPDR
077740040902     C                   SETON                                        90
077750050427     c                   move      dstpdr        wadpdr            7
077760050427     c                   eval      wcaut = caut
077770050427     c                   eval      %subst(wcaut: 6: 7) = wadpdr
077780040902    3C                   ENDIF
077790040902    2C                   ENDIF
077800040902     C* Il flag mattino/pomeriggio lo controllo solo se il PDR è =
077810040902    2C     ORMNDC        IFGT      *ZEROS
077820040902     C     VIDPDR        ANDEQ     WDPDR
077830040902     C     VIDFPP        ANDNE     *BLANKS
077840040902     C     VIDFPP        ANDNE     PREFPP
077850040902     C                   MOVE      ORMNDC        W0050
077860060522     c                   if        w_pogest = *zeros
077870060522     c                   z-add     ormpor        kfgs
077880060522     c                   else
077890060522     c                   z-add     w_pogest      kfgs
077900060522     c                   endif
077910040902     C     KFVV          CHAIN     FNFVV01L                           30
077920040902    3C     FVVFPP        IFNE      VIDFPP
077930050426     c***  atrfpp        ifne      prri
077940040902     C                   MOVEL     RIMM          ATRFPP
077950050426     c***                endif
077960040902     C                   MOVE      VIDFPP        PREFPP
077970040902     C                   SETON                                        90
077980040902    3C                   ENDIF
077990040902    2C                   ENDIF
078000040902     c                   ENDSR
078010120611     c
078020120611     C* Ricerca codice autotrasportatore che ha eseguito l'orm ----------------
078030070606     C     sr_dst        BEGSR
078040120611     c
078050120611     C                   MOVE      ORMNDC        W0050
078060070606     c                   if        w_pogest = *zeros
078070070606     C                   z-add     ORMpor        kfgs
078080070606     c                   else
078090070606     c                   z-add     w_pogest      kfgs
078100070606     c                   endif
078110120611     C     KDST          CHAIN     FIDST01L                           30
078120070606     C   30              CLEAR                   DSTPDR
078130070606     c                   endsr
078140010215     C*
078150010215     C* PROPOSTA DATI DA  O.R.M. (CAMPI DELLA II° VIDEATA) ----------*
078160010215     C     PRPOR2        BEGSR
078170010215     C                   CLEAR                   WEFORM
078180010215     C*
078190010215     C** MITTENTE (RAG.SOC.,INDIRIZZO...)
078200030912      * da mittente ORM se l'ORM prevede la bolla in porto assegnato
078210030912      * o se conferma ORM prepagati
078220010215     C*
078230030912    1c                   If        Not *In02 and
078240030923     c                             (VidCcm = 9999 or
078250030923     c                             (§LpFpr = 'O' and VidCcm = 8888))
078260010215    3C     WOVUO         IFEQ      *BLANKS
078270010215     C     VIDRSM        OREQ      *BLANKS
078280010215     C                   MOVEL     ORMRSR        VIDRSM
078290010215     C                   MOVEL     '1'           WEFORM
078300010215    3C                   ENDIF
078310010215    3C     WOVUO         IFEQ      *BLANKS
078320010215     C     VIDINM        OREQ      *BLANKS
078330010215     C                   MOVEL     ORMINR        VIDINM
078340010215     C                   MOVEL     '1'           WEFORM
078350010215    3C                   ENDIF
078360010215    3C     WOVUO         IFEQ      *BLANKS
078370010215     C     VIDCAM        OREQ      *BLANKS
078380010215     C                   MOVEL     ORMCAR        VIDCAM
078390010215     C                   MOVEL     '1'           WEFORM
078400010215    3C                   ENDIF
078410010215    3C     WOVUO         IFEQ      *BLANKS
078420010215     C     VIDLOM        OREQ      *BLANKS
078430010215     C                   MOVEL     ORMLOR        VIDLOM
078440010215     C                   MOVEL     '1'           WEFORM
078450010215    3C                   ENDIF
078460010215    3C     WOVUO         IFEQ      *BLANKS
078470010329     C     VIDPRM        OREQ      *BLANKS
078480010329     C     ORMPRR        ANDNE     *BLANKS
078490010329     C     VIDCAM        ANDEQ     ORMCAR
078500010329     C     ORMCAR        ANDNE     *BLANKS
078510010215     C                   MOVEL     ORMPRR        VIDPRM
078520010215     C                   MOVEL     '1'           WEFORM
078530010215    3C                   ENDIF
078540010216    3C     WOVUO         IFEQ      *BLANKS
078550010329     C     VIDNZM        OREQ      *BLANKS
078560010329     C     ORMNAR        ANDNE     *BLANKS
078570010329     C     VIDCAM        ANDEQ     ORMCAR
078580010329     C     ORMCAR        ANDNE     *BLANKS
078590010216     C                   MOVEL     ORMNAR        VIDNZM
078600010216     C                   MOVEL     '1'           WEFORM
078610010216    3C                   ENDIF
078620061113     c*
078630061113     c                   if        *in22 and ormtco='I' and ormcor=0
078640061113     c                   move      ormino        vidcdf
078650061113     c                   endif
078660031201    1C                   ENDIF
078670031201      * se ho forzato il porto franco
078680031201if  1c                   If        wforpf = '1'
078690031201if  2c                   If        Not *In02
078700031201      * imposto l'ordinante dell'orm nel mittente bolla
078710031201    3C     WOVUO         IFEQ      *BLANKS
078720031201     C     VIDRSM        OREQ      *BLANKS
078730031201     C                   MOVEL     ORMRSO        VIDRSM
078740031201     C                   MOVEL     '1'           WEFORM
078750031201    3C                   ENDIF
078760031201    3C     WOVUO         IFEQ      *BLANKS
078770031201     C     VIDINM        OREQ      *BLANKS
078780031201     C                   MOVEL     ORMINO        VIDINM
078790031201     C                   MOVEL     '1'           WEFORM
078800031201    3C                   ENDIF
078810031201    3C     WOVUO         IFEQ      *BLANKS
078820031201     C     VIDCAM        OREQ      *BLANKS
078830031201     C                   MOVEL     ORMCAO        VIDCAM
078840031201     C                   MOVEL     '1'           WEFORM
078850031201    3C                   ENDIF
078860031201    3C     WOVUO         IFEQ      *BLANKS
078870031201     C     VIDLOM        OREQ      *BLANKS
078880031201     C                   MOVEL     ORMLOO        VIDLOM
078890031201     C                   MOVEL     '1'           WEFORM
078900031201    3C                   ENDIF
078910031201    3C     WOVUO         IFEQ      *BLANKS
078920031201     C     VIDPRM        OREQ      *BLANKS
078930031201     C     ORMPRO        ANDNE     *BLANKS
078940031201     C     VIDCAM        ANDEQ     ORMCAO
078950031201     C     ORMCAO        ANDNE     *BLANKS
078960031201     C                   MOVEL     ORMPRO        VIDPRM
078970031201     C                   MOVEL     '1'           WEFORM
078980031201    3C                   ENDIF
078990031201    3C     WOVUO         IFEQ      *BLANKS
079000031201     C     VIDNZM        OREQ      *BLANKS
079010031201     C     ORMNAO        ANDNE     *BLANKS
079020031201     C     VIDCAM        ANDEQ     ORMCAO
079030031201     C     ORMCAO        ANDNE     *BLANKS
079040031201     C                   MOVEL     ORMNAO        VIDNZM
079050031201     C                   MOVEL     '1'           WEFORM
079060031201    3C                   ENDIF
079070031201    2c                   EndIf
079080031201      * imposto il mittente dell'orm nel mittente originale bolla
079090031201    2c                   If        wovuo = *Blanks or vidrmo = *Blanks
079100031201     c                   Movel     OrmRsr        vidrmo
079110031201     c                   Eval      wemfor = '1'
079120031201    2c                   EndIf
079130031201    2c                   If        wovuo = *Blanks or vidcmo = *Blanks
079140031201     c                   Movel     OrmCar        vidcmo
079150031201     c                   Eval      wemfor = '1'
079160031201    2c                   EndIf
079170031201    2c                   If        wovuo = *Blanks or  vidnmo = *Blanks
079180031201     c                   Movel     OrmNar        vidnmo
079190031201     c                   Eval      wemfor = '1'
079200031201    2c                   EndIf
079210031201    1c                   EndIf
079220010306     C*
079230010306     C* VOLUME - SOLO SE RICHIAMATA DA CONFERMA PREPAGATI DI ALTRO P.O.
079240010306     C*
079250010306    1C     §LPFPR        IFEQ      'O'
079260010306     C     ORMVLM        ANDGT     *ZEROS
079270010306     C* Metto il test su campo wovuo anche per volume per uniformità
079280010306     C* anche se in questo caso forse non serve perchè il volume
079290010306     c* non viene mai impostato diverso da 0 in ctrd01
079300010306     C     WOVUO         IFEQ      *BLANKS
079310010306     C     VIDVOL        OREQ      *ZEROS
079320010306     C                   Z-ADD     ORMVLM        VIDVOL
079330010306     C                   MOVEL     '1'           WEFORM
079340010306     C                   ENDIF
079350010306    1C                   ENDIF
079360010215     C*
079370010215     C* CODICE TARIFFA
079380010215     C*
079390031201     c                   If        Not *In29 and §OrPfb <> 'A'
079400010215     C                   MOVE      VIDCCM        W0070             7 0
079410010215    2C     VIDFLC        IFEQ      *ZEROS
079420010215     C                   MOVEL     VIDLNP        W0070
079430010215     C                   ELSE
079440010215     C                   MOVEL     VIDFLC        W0070
079450010215    2C                   ENDIF
079460010226     C* Propongo il codice tariffa da orm solo se:
079470010226     C* Stesso codice cliente mittente
079480010215    2C     W0070         IFEQ      ORMKSC
079490010226     C* immesso codice tariffa su orm
079500010215     C     ORMCTR        ANDNE     *BLANKS
079510010226     C* codice tariffa a video = blanks
079520010226     C     VIDCTR        ANDEQ     *BLANKS
079530010215     C                   MOVE      ORMCTR        VIDCTR
079540010215     C                   MOVE      ORMCTR        PRECTR
079550010215     C                   MOVEL     '1'           WEFORM
079560010215    2C                   ENDIF
079570010215    1C                   ENDIF
079580010215     C*
079590010215     C* NATURA MERCE
079600010215     C*
079610011221    1C  N27              DO
079620011221     C                   MOVEL     ORMNAM        W015A
079630011221    2C     W015A         IFNE      *BLANKS
079640010226     C     VIDNAS        ANDEQ     *BLANKS
079650010215     C                   MOVEL     ORMNAM        VIDNAS
079660010215     C                   MOVEL     '1'           WEFORM
079670011221    2C                   ENDIF
079680011221    1C                   ENDDO
079690010215     C*
079700010404     C* NOTE: SE PESO > 50 Q.LI
079710010404     C*       SE O.R.M. COMMISSIONATI DA ALTRO P.O. NELLE NOTE METTO
079720010404     C*       SEMPRE E SOLO IL REFERENTE E NUMERO DI TELEFONO
079730010307    1C                   SELECT
079740010307     C     §LPFPR        WHENEQ    'O'
079750050211     C***  ORMPOE        ORNE      ORMPOR
079760010307     C     VIDNT1        IFEQ      *BLANKS
079770010307     C                   MOVEL     WTELRF        VIDNT1
079780010307     C                   MOVEL     '1'           WEFORM
079790010307     C                   ENDIF
079800010307     C     WTELR2        IFNE      *BLANKS
079810010307     C     VIDNT2        IFEQ      *BLANKS
079820010307     C     WOVUO         OREQ      *BLANKS
079830010307     C                   MOVE      WTELR2        VIDNT2
079840010307     C                   MOVEL     '1'           WEFORM
079850010307     C                   ENDIF
079860010307     C                   ENDIF
079870010409     C     VIDPKG        WHENGE    §DFMAX
079880010215    2C     ORMNO1        IFNE      *BLANKS
079890010226     C     VIDNT1        ANDEQ     *BLANKS
079900010215     C                   MOVEL     ORMNO1        VIDNT1
079910010215     C                   MOVEL     '1'           WEFORM
079920010215    2C                   ENDIF
079930010215    2C     ORMNO2        IFNE      *BLANKS
079940010226     C     VIDNT2        IFEQ      *BLANKS
079950010226     C     WOVUO         OREQ      *BLANKS
079960010215     C                   MOVEL     ORMNO2        VIDNT2
079970010215     C                   MOVEL     '1'           WEFORM
079980010226     C                   ENDIF
079990010215    2C                   ENDIF
080000010307    1C                   ENDSL
080010010223     C                   MOVE      '1'           WOVUO             1
080020010215     C                   ENDSR
080030010215     C*
080040010215     C* CONTROLLI DI CONGRUENZA COD.TARIFFA CON CAMPO DELL'ORM ------*
080050010215     C     CNFOR2        BEGSR
080060010215     C*
080070010215     C*** CODICE TAR. ***
080080010215     C*
080090010223     C                   MOVE      VIDCCM        W0070
080100010223     C     VIDFLC        IFEQ      *ZEROS
080110010223     C                   MOVEL     VIDLNP        W0070
080120010223     C                   ELSE
080130010223     C                   MOVEL     VIDFLC        W0070
080140010223     C                   ENDIF
080150030905     C* ORM NON PAGATO DA DESTINATARIO
080160030905      * L'orm prevede la bolla in porto franco
080170030905     c     §OrPfb        Ifne      'A'
080180010223     C* PRESENTE CODICE CLIENTE SU ORM
080190010223     C     ORMKSC        ANDGT     *ZEROS
080200010223     C     ORMKSC        ANDEQ     W0070
080210010215     C     VIDCTR        IFNE      *BLANKS
080220010215     C     VIDCTR        ANDNE     PRECTR
080230010215     C     ORMCTR        ANDNE     VIDCTR
080240010215     C     ORMCTR        ANDNE     *BLANKS
080250010215     C                   MOVEL     RIMM          ATRCTR
080260010215     C                   MOVEL     VIDCTR        PRECTR
080270010215     C                   SETON                                        90
080280010215     C                   ENDIF
080290010223     C                   ENDIF
080300010215     C*
080310010215     C   90              MOVEL     ERR(224)      VIDMSG
080320010215     C   90              MOVEL     '1'           WEMFOR
080330010215     C                   ENDSR
080340070427     C*
080350070427     C* PROPOSTA mittente originale da orm per import dpd in porto assegnato
080360070427     C     PRPOR2_rmo    BEGSR
080370091008     c****               if        dateu>=§vpormo and §vpormo>0
080380070427     C                   CLEAR                   WEFORM
080390070427    2c                   If        wovuo1= *Blanks or vidrmo = *Blanks
080400070427     c                   Movel     OrmRsr        vidrmo
080410070430     c                   Eval      weform = '1'
080420070427    2c                   endif
080430070427    2c                   If        wovuo1= *Blanks or vidcmo = *Blanks
080440070427     c                   Movel     OrmCar        vidcmo
080450070430     c                   Eval      weform = '1'
080460070427    2c                   endif
080470070427    2c                   If        wovuo1= *Blanks or vidnmo = *Blanks
080480070427     c                   Movel     OrmNar        vidnmo
080490070430     c                   Eval      weform = '1'
080500070427    2c                   endif
080510070427     c                   movel     '1'           wovuo1            1
080520091008     c****               endif
080530070427     c                   endsr
080540091008     c*
080550960926     C* CONTROLLO CODICE AUTOTRASPORTATORE --------------------------*
080560940824     C     CTRPDR        BEGSR
080570940824     C*
080580940930     C                   CLEAR                   V1DPDR
080590990614     C                   CLEAR                   APDRSC
080600990614     C                   CLEAR                   APDFCM
080610990614     C                   CLEAR                   APDATB
080620940929     C*
080630940824     C     '?'           SCAN      WPDR                                   30
080640940824     C*
080650990915    1C     *IN30         IFEQ      *ON
080660021203      *
080670021203      * imposto i campi della ds esterna fnlv24ds
080680021203     C                   clear                   fnlv24ds
080690021203     C                   eval      d24fil   = wlnp
080700021203     C                   eval      d24tip   = 'A'
080710021203     C                   eval      d24flg   = 'R'
080720021203     C                   movel     fnlv24ds      kpjbu
080730940824     C                   CALL      'FNLV24R'
080740940824     C                   PARM                    KPJBA
080750021203      *
080760021203      * valorizzo i campi a video
080770021203     C                   movel     kpjbu         fnlv24ds
080780021203     C                   if        d24pdr   <> *zeros
080790021203     C                   move      d24pdr        wpdr
080800021203     C                   movel     d24rsc        v1dpdr
080810021203     C                   endif
080820021203     C                   MOVEL     '1'           WEMFOR
080830941011     C                   SETON                                        56
080840940824     C                   GOTO      ENDCPD
080850990915    1C                   END
080860940928     C* ESEGUO TESTN
080870990915    1C     PARTCH        IFNE      'P'
080880010307     C     §LPFPR        ANDNE     'O'
080890990610     C* PER PREPAGATI SOLO SE IL CAMPO E' PIENO
080900990610     C     PARTCH        OREQ      'P'
080910990610     C     WPDR          ANDNE     *BLANKS
080920990610     C     WPDR          ANDNE     *ZEROS
080930010307     C     §LPFPR        OREQ      'O'
080940010307     C     WPDR          ANDNE     *BLANKS
080950010307     C     WPDR          ANDNE     *ZEROS
080960990610     C*
080970940928     C                   TESTN                   WPDR                 30
080980940928     C                   MOVE      WPDR          W001A
080990990915    2C     *IN30         IFEQ      *OFF
081000940928     C     W001A         ORLT      '0'
081010940928     C                   MOVEL     ERR(21)       VIDMSG
081020940928     C                   SETON                                        5690
081030940928     C                   GOTO      ENDCPD
081040990915    2C                   ENDIF
081050940824     C*
081060940928     C                   MOVEL     WLNP          W0070             7 0
081070940928     C                   MOVE      WPDR          W0070
081080021204     C                   move      w0070         kpdpdr
081090021203     C                   move      'A'           kpdtip
081100021203     C     kfapd         chain     fiapd01l                           30
081110990915    2C     *IN30         IFEQ      *ON
081120940824     C     *IN30         OREQ      *OFF
081130940824     C     APDATB        ANDNE     *BLANKS
081140940824     C                   MOVEL     ERR(21)       VIDMSG
081150940920     C                   SETON                                        5690
081160940824     C                   GOTO      ENDCPD
081170990915    2C                   ENDIF
081180940824     C*
081190940824     C* NON POSSO INSERIRE UNA DATA RITIRO SE ESISTE LA CONFERMA DEI
081200960926     C*  CONTEGGI AUTOTRASPORTATORI PER QUEL GIORNO
081210950116     C                   MOVE      W0070         W01PDR
081220940824     C                   MOVEL     ' '           W01TSR
081230940824     C                   MOVEL     'C'           W01FVL
081240011126     C     KFTT          SETLL     FIFTT000                               90
081250011126     C  N90KFTT          SETLL     FIFST000                               90
081260940824     C*
081270990915    2C     *IN90         IFEQ      *ON
081280940824     C                   MOVEL     ERR(7)        VIDMSG
081290940920     C                   SETON                                        56
081300940824     C                   GOTO      ENDCPD
081310990915    2C                   ENDIF
081320990915     C*
081330990915     C* SE SI TRATTA DELLA CONFERMA DI UN PREPAGATO, DO MSG SE FLAG
081340990915     C*  MERCE A MAGAZZINO DIVERSO DAL COD AUTOTRASPORTATORE
081350990915     C     VIDPDR        IFNE      SAVPD4
081360990915     C                   CLEAR                   AAC
081370990915     C                   MOVEL     VIDPDR        SAVPD4
081380990915     C                   ENDIF
081390991001     C*
081400991001     C* CONTROLLO PER IL MOMENTO SOSPESO: QUANDO ATTIVEREMO PER I
081410991001     C*  PREPAGATI LA VARIA "U" SI DEVE RIMETTERE
081420001024     C* RIATTIVATO IL 24/10/00
081430990915     C*
081440001024     C     *IN22         IFEQ      *ON
081450990915     C     *IN12         ANDEQ     *ON
081460990915     C     *IN15         ANDEQ     *OFF
081470990915     C     AAC           ANDEQ     0
081480990915     C     BLPPDR        ANDEQ     0
081490990915     C     VIDMAG        IFNE      APDFCM
081500990915     C                   MOVEL     1             AAC
081510990915     C                   MOVEL     ERR(168)      VIDMSG
081520990915     C                   SETON                                        5690
081530990915     C                   GOTO      ENDCPD
081540990915     C                   ENDIF
081550990915     C                   ENDIF
081560940824     C*
081570940824     C                   MOVEL     APDRSC        V1DPDR
081580041013     c* se orm reale controllo che non esistano altre bolle associate
081590041013     c* allo stesso orm ma abbinate ad altro autotrasportatore.
081600041013     c* Se presenti --> errore bloccante
081610041013     C     WORM          IFEQ      'S'
081620041013     C     FLGFIT        ANDNE     'S'
081630041013     c                   exsr      SR_CtrOrmPdr
081640041013     C   90              GOTO      ENDCPD
081650041013     c                   endif
081660990915    1C                   ENDIF
081670940824     C*
081680940824     C     ENDCPD        TAG
081690940824     C   90              MOVEL     '1'           WEMFOR
081700940824     C                   ENDSR
081710041013     C**************************************************************************
081720041013     C*   Controllo esistenza altre bolle associate all'orm immesso
081730041013     C**************************************************************************
081740041013     C     SR_CtrOrmPdr  BEGSR
081750041013     C                   MOVEL     DSBLP0        SAVBLP
081760041019     c     *in12         ifeq      *on
081770041019     c     *in15         andeq     *off
081780041019     c                   movel     *blanks       savbol           16
081790041019     c                   eval      savbol = %EDITW(BLPAAS:'    ')     +
081800041019     C                                      %editw(BLPLNP:'   ')      +
081810041019     C                                      %editw(BLPNRS:'  ')       +
081820041019     C                                      %editw(BLPNSP:'       ')
081830041019     c                   endif
081840041019     c
081850060215     c                   movel     'M'           kar4trc
081860060215     c                   movel     widorm        kar4n14
081870160209     c     kar403        setll     fiar405l
081880041013     c                   do        *hival
081890160209     c     kar403        reade     fiar405l
081900041013     c* fine file
081910160209     c                   if        %eof(fiar405l)
081920041013     c                   leave
081930041013     c                   endif
081940061212     c     kblp4m        chain     fnblp01l
081950041019     c
081960041019     c     *in12         ifeq      *on
081970041019     c     *in15         andeq     *off
081980041019     c                   movel     *blanks       blpbol           16
081990041019     C                   eval      blpbol = %editw(BLPAAS:'    ')   +
082000041019     C                                      %editw(BLPLNP:'   ')    +
082010041019     C                                      %editw(BLPNRS:'  ')     +
082020041019     C                                      %editw(BLPNSP:'       ')
082030041019     c                   endif
082040041013     c* trovata bolla con aut diverso errore --> esco dal ciclo
082050041013     c                   if        %found(fnblp01l) and
082060041019     c                             blppdr <> w01pdr and
082070041019     c                             blppdr > 0
082080041019     c* se sono in manutenzione e ho letto la bolla che sto manutenzion
082090041019     c* ando ignoro
082100041019     c     *in12         ifeq      *on
082110041019     c     *in15         andeq     *off
082120041019     c     blpbol        andne     savbol
082130041019     c     *in12         oreq      *off
082140041019     c     *in15         oreq      *on
082150041019     c
082160041013     C                   MOVEL     ERR(286)      VIDMSG
082170041013     C                   SETON                                        5690
082180041013     C                   leave
082190041019     c                   endif
082200041013     c                   endif
082210041013     c
082220041013     c                   enddo
082230041013     c
082240041013     C                   MOVEL     SAVBLP        DSBLP0
082250041013     c                   endsr
082260940824     C*
082270940824     C* CONTROLLO CODICE BOLLA ---------------------------------------*
082280940824     C     CTRCBO        BEGSR
082290940824     C* NO PERSONALIZZAZIONE
082300940824    0C     *IN21         IFEQ      *OFF
082310941103     C                   SETOFF                                       040508
082320940824     C* RICERCA
082330940922     C                   MOVEL     '3A'          COD
082340940824     C     '?'           SCAN      WCBO                                   30
082350940824    1C     *IN30         IFEQ      *ON
082360940922     C                   EXSR      CX§TAB
082370940824     C                   MOVEL     §KEY          WCBO
082380941011     C                   SETON                                        46
082390940824     C                   GOTO      ENDCCB
082400940824    1C                   ENDIF
082410940824     C*
082420940920     C                   MOVEL(P)  WCBO          KEY
082430940824     C*
082440940824     C                   EXSR      CTABEL
082450940824    1C     *IN30         IFEQ      *ON
082460940824     C                   MOVEL     ERR(10)       VIDMSG
082470940920     C                   SETON                                        4690
082480940824     C                   GOTO      ENDCCB
082490940824    1C                   ENDIF
082500940824     C*
082510940824     C                   MOVEL     TBLUNI        DS3A
082520940824     C                   MOVEL     §3ATB1        FLGTB1            1
082530940824     C                   MOVEL     §3ADES        V2DCBO
082540940824     C* VEDO SE CAUSALE UTILIZZABILE
082550940824     C  N12
082560940824     CORN44
082570940824    1CAN 12§3AUCB        IFEQ      'N'
082580940824     C                   MOVEL     ERR(10)       VIDMSG
082590940920     C                   SETON                                        4690
082600940824     C                   GOTO      ENDCCB
082610940824    1C                   END
082620000509     C*
082630000509     C* PER BOLLE POSTE AMMESSO SOLO FRANCO
082640020319     C     §ogntw        IFEQ      'PPT'
082650000906     C     FLGTB1        IFNE      'F'
082660000906     C     §3ATB2        ORNE      '  '
082670000509     C                   MOVEL     ERR(199)      VIDMSG
082680000509     C                   SETON                                        4690
082690000509     C                   GOTO      ENDCCB
082700000509     C                   ENDIF
082710000911     C                   ENDIF
082720940824     C*
082730991026     C     FLGTB1        COMP      'A'                                    04
082740941103     C*
082750940929     C* 08 ON - TASSATO DESTINO
082760940826     C     §3AFTD        IFEQ      1
082770940826     C                   SETON                                        08
082780940920     C                   ENDIF
082790940920     C* 05 ON - 2 BOLLA E NON E' TASSATO DESTINO
082800940920     C  N08§3ATB2        IFNE      *BLANKS
082810940920     C                   SETON                                        05
082820940920     C                   ENDIF
082830991026      *
082840991026      * SE SONO NELLA PROCEDURA PREPAGATI DEVO SELEZIONARE UN PORTO FRANCO
082850991026     C     *IN04         IFEQ      *ON
082860991026     C     PARTCH        ANDEQ     'P'
082870010307     C     *IN04         OREQ      *ON
082880010307     C     §LPFPR        ANDEQ     'O'
082890991026     C                   MOVEL     ERR(173)      VIDMSG
082900991026     C                   SETON                                        4690
082910991026     C                   GOTO      ENDCCB
082920991026     C                   ENDIF
082930020611     c* X prepagati non posso bollettare come C/servizio
082940020611     c     *in22         ifeq      *on
082950020611     c     §3arbl        andeq     'C'
082960020611     c                   movel     err(256)      vidmsg
082970020611     C                   SETON                                        4690
082980020611     C                   GOTO      ENDCCB
082990020611     c                   endif
083000030805      * se ORM con serie il codice bolla non può essere diverso da quello
083010030805      * indicato in tabella 'OSR'
083020030805If  1c                   If        wonsr > *Zeros and flgfit <> 'S' and
083030030808     c                             wCbo <> d§OsrCbo and d§OsrCbo <> *Blanks
083040030805     c                   Eval      VidMsg = Err(148)
083050030805     c                   Eval      %subst(VidMsg:25:2) = d§OsrCbo
083060030805     c                   Eval      *In46 = *On
083070030805     c                   Eval      *In90 = *On
083080030805     c                   GoTo      EndCcb
083090030805    1c                   EndIf
083100040122
083110040122      * Il codice bolla '2R' è ammesso solo se ho inserito un ORM con la serie
083120040203     c                   If        wcbo = '2R' and
083130040203     c                             (flgfit = 'S' or wonsr = *Zeros)
083140040122     c                   Eval      VidMsg = Err(10)
083150040122     c                   Eval      *In46 = *On
083160040122     c                   Eval      *In90 = *On
083170040122     c                   GoTo      EndCcb
083180040122     c                   EndIf
083190991026     C*
083200940824    0C                   ENDIF
083210940824     C*
083220940824     C* SE BOLLA DI RECUPERO NO DATA SPEDIZIONE < DATA GIORNO -3
083230940824     C* ALTRIMENTI NO < DATA GIORNO
083240940824    0C     §3ARBL        IFEQ      'R'
083250940824     C*
083260000113    1C     *IN12         IFEQ      *OFF
083270000113     C     *IN15         OREQ      *ON
083280000113     C     BLPDSP        ORNE      WBDSP
083290000113    2C     BLPDSP        IFLT      DATAM
083300940824     C                   MOVEL     ERR(4)        VIDMSG
083310940929     C                   SETON                                        4190
083320000113    2C                   ENDIF
083330000113    1C                   ENDIF
083340940824     C*
083350940824   X0C                   ELSE
083360940824     C*
083370000104     C* IMMISSIONE O CONFERMA
083380000104    1C     *IN12         IFEQ      *OFF
083390000104     C     *IN15         OREQ      *ON
083400000104     C     BLPDSP        ORNE      WBDSP
083410061221     c
083420000104     C* MANUTENZIONE : SOLO SE LA DATA SPEDIZIONE E' STATA CAMBIATA
083430061221    2C***  BLPDSP        IFLT      DATEU
083440061221    2C     BLPDSP        IFLT      datameno1
083450940824     C                   MOVEL     ERR(5)        VIDMSG
083460061221     c                   eval      %subst(vidmsg:65:10) =
083470061221     c                             %editw(datgmeno1: '  /  /    ')
083480940929     C                   SETON                                        4190
083490000104    2C                   ENDIF
083500000104    1C                   ENDIF
083510940824    0C                   ENDIF
083520000104     C   90              GOTO      ENDCCB
083530960319     C* IN MANUTENZIONE NON POSSO MODIFICARE IL TIPO BOLLA SE BOLLA
083540960319     C*  FIGLIA
083550960319     C   12
083560960319     CANN15BLPCBO        IFNE      WCBO
083570960319     C     KBLP3         SETLL     FNLBL01L                               90
083580960319     C     *IN90         IFEQ      *ON
083590960319     C                   MOVEL     ERR(124)      VIDMSG
083600960319     C                   SETON                                        46
083610960319     C                   GOTO      ENDCCB
083620120926     c*
083630120926     c                   else
083640120926     c                   if        savrbl='R' and savtb1='F' and
083650120926     c                             §3arbl<>'R'
083660120926     C                   MOVEL     ERR(347)      VIDMSG
083670120926     C                   SETON                                        4690
083680120926     C                   GOTO      ENDCCB
083690120926     c                   endif
083700960319     C                   ENDIF
083710960319     C                   ENDIF
083720961122     C*
083730990518     C* SE MODIFICATO TIPO BOLLA, PULISCO CAMPO DIC/VEN
083740961122     C     WCBO          IFNE      SAVCBO
083750040213     C**!!!              CLEAR                   DIC
083760040213     C**!!!              CLEAR                   VEN
083770961122     C                   MOVEL     WCBO          SAVCBO
083780961122     C                   ENDIF
083790070427     c* In manutenzione
083800070427     c* se modificato porto da franco ad assegnato pulisco campo per
083810070427     c* controlli proposte mittente originale
083820070427     c                   if        *in12='1' and *in15='0' and
083830070427     C                             flgtb1<>savtb1 and flgtb1='A'
083840070427     c                   clear                   wovuo1
083850070427     c                   endif
083860940824     C* personalizzazione
083870940824     C     WPERSO        IFEQ      'P'
083880940824     C                   SETON                                        21
083890940824     C                   ENDIF
083900940824     C*
083910940928     C     ENDCCB        TAG
083920940824     C   90              MOVEL     '1'           WEMFOR
083930940824     C                   ENDSR
083940050214     C* CONTROLLO codice bolla --------------------------------------*
083950050214     C     CTRCBO_orm    BEGSR
083960060918    1C     *IN12         IFEQ      *OFF
083970091019    1C     *IN15         oreq      *On
083980091019     c     flgfit        andne     'S'
083990091019     c     §orpfb        andeq     'A'
084000060918     C* In manutenzione controllo solo se variato il numero ORM
084010060918     C     *IN15         OREQ      *OFF
084020060918     C     WORMMD        ANDEQ     '1'
084030081023     c* se bolla export dpd controllo anche se variato il codice bolla
084040081023     c     *in15         oreq      *off
084050081023     c     A_§ogntw      andeq     'DPD'
084060081023     c     vidcbo        andne     cbo_blp
084070050214      * Controllo il tipo bolla con quanto memorizzato sull'ORM
084080050214     c                   If        §OrPfb <> *Blanks and Flgtb1 <> §OrPfb
084090050214     c                             and flgfit <> 'S'
084100050214     c                   If        §OrPfb = 'F'
084110061124     c                             and wfortbo = *Blanks
084120061124     c                   Eval      VidMsg = Err(30)
084130050214     c                   Eval      %subst(VidMsg:34:9) = 'Franco   '
084140050214     c                   Eval      %subst(VidMsg:45:15) = 'ENTER X FORZARE'
084150061124     c                   Eval      *In46 = *On
084160061124     c                   Eval      *In90 = *On
084170050214     c                   Eval      WforTbo = '1'
084180050214     c                   EndIf
084190050214     c                   If        §OrPfb = 'A'
084200061124     c                   Eval      VidMsg = Err(30)
084210050214     c                   Eval      %subst(VidMsg:34:9) = 'Assegnato'
084220061124     c                   Eval      *In46 = *On
084230061124     c                   Eval      *In90 = *On
084240050214     c                   EndIf
084250050214     c                   EndIf
084260060918     c                   endif
084270050214     c                   endsr
084280081107     C* CONTROLLO codice bolla con cod. trattamento merce -----------*
084290081107     C     CTRCBO_ctm    BEGSR
084300081107     c* se cd. trattamento merce di recupero non posso usarlo con cod.
084310081107     c* bolla non di recupero a meno che non sia un codice bolla abili-
084320081107     c* tato
084330081107     c                   if        §1bfg8='N' and §3arbl<>'R'
084340081107     c                              and §3aurc=' '
084350081107     C                   MOVEL     ERR(318)      VIDMSG
084360081107     C                   SETON                                        4690
084370081107     c                   endif
084380081107     c                   endsr
084390940824     C*
084400940824     C* CONTROLLO LINEA DI ARRIVO -----------------------------------*
084410110217     C     CTRLNA_vid    BEGSR
084420110217     c
084430940824     C* NON E' STATA PERSONALIZZATA
084440940824    0C     *IN20         IFEQ      *OFF
084450940824     C*
084460940928     C                   CLEAR                   V1DLNA
084470940824     C* SOLO SE INSERITA, ALTRIMENTI LA CALCOLO IN AUTOMATICO
084480940824    1C     WLNA          IFNE      *BLANKS
084490940824     C     WLNA          ANDNE     *ZEROS
084500940824     C*
084510940824     C     '?'           SCAN      WLNA                                   30
084520940824     C*
084530940824    2C     *IN30         IFEQ      *ON
084540940824     C                   MOVE      *BLANKS       §COD1
084550940824     C                   MOVE      *BLANKS       WLNA
084560941230     C                   CALL      'TNSD19R'
084570940824     C                   PARM                    §COD1             3
084580940824     C                   PARM                    §TIP              1
084590940928     C                   PARM                    §DES
084600940824     C                   MOVEL     §COD1         WLNA
084610940928     C                   MOVEL     §DES          V1DLNA
084620940824     C                   MOVEL     '1'           WEMFOR
084630941011     C                   SETON                                        47
084640940824     C                   GOTO      ENDCLA
084650940824    2C                   ENDIF
084660110217     c
084670110217     c                   exsr      Ctrlna_Base
084680110217     c
084690110217     c* Se errore accendo indicatore di posizionamento cursore
084700110217     c                   if        *in90
084710110217     c                   seton                                        47
084720110217     C                   GOTO      ENDCLA
084730110217     c                   endif
084740940824     C*
084750991202     C* SE CAMBIATA
084760940824    2C     CO2LNA        IFNE      COMLNA
084770940824     C                   MOVEL     0             QUA
084780100209     C                   MOVEL     0             QUAH
084790040213     C**!!!              MOVEL     0             DIC
084800040213     C**!!!              MOVEL     0             VEN
084810940920     C                   MOVEL     COMLNA        CO2LNA
084820940824    2C                   END
084830940824     C* DESCRIZIONE
084840940824     C                   MOVEL     ORGDES        V1DLNA
084850940824     C* PERSONALIZZAZIONE
084860940824    2C     WPERSO        IFEQ      'P'
084870940824     C                   SETON                                        20
084880940824    2C                   ENDIF
084890940824     C*
084900940824   X1C                   ELSE
084910940824     C* LINEA NON IMMESSA
084920940824     C                   MOVEL     *BLANKS       V1DLNA
084930940824     C                   Z-ADD     0             COMLNA
084940020213     C                   CLEAR                   A_OG143
084950040525     C                   CLEAR                   A_OG150
084960940824     C* RICONTROLLO SEMPRE IL CAP
084970940824     C                   MOVEL     0             QUA
084980100209     C                   MOVEL     0             QUAH
084990940824    1C                   END
085000010220     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
085010010220     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
085020010220     C     WPERSO        IFEQ      'P'
085030010220     C     WORM          ANDEQ     'S'
085040010220     C     PARTCH        ANDNE     'P'
085050010220     C     FLGFIT        ANDNE     'S'
085060010220     C     WLNA          ANDGT     *ZEROS
085070010220     C                   MOVE      WLNA          W0030             3 0
085080010220     C     W0030         IFNE      ORMPOC
085090010220     C     ORMPOC        ANDGT     *ZEROS
085100010220     C                   SETON                                        9047
085110010220     C                   MOVEL     ERR(225)      VIDMSG
085120010220     C                   GOTO      ENDCLA
085130010220     C                   ENDIF
085140010220     C                   ENDIF
085150940928    0C                   END
085160940824     C*
085170940824     C     ENDCLA        TAG
085180940824     C   90              MOVEL     '1'           WEMFOR
085190940824     C                   ENDSR
085200110217     C*
085210110217     C* CONTROLLI di base 1° e 2° videata della linea di arrivo ------*
085220110217     c     CTRLNA_Base   BEGSR
085230110217     c
085240110217     C                   TESTN                   WLNA                 30
085250110217     C                   MOVE      WLNA          W001A             1
085260110217    2C     *IN30         IFEQ      *OFF
085270110217     C     W001A         ORLT      '0'
085280110217     C                   MOVEL     ERR(12)       VIDMSG
085290110217     C                   SETON                                        90
085300110217     C                   leavesr
085310110217    2C                   ENDIF
085320110217     c
085330110217     c* Se in immissione prepagati e lna Portogallo o Spagna errore
085340110217     c                   if        (partch='P' or §lpfpr='O') and
085350120608     c                             (wlna='340' or wlna='345' or wlna='341')
085360120608     c                             and (wccm=8888 or wccm=0)
085370110217     C                   SETON                                        90
085380110217     C                   MOVEA     ERR(311)      K78
085390110217     C                   MOVE      wlna          W003A             3
085400110217     C                   MOVEA     W003A         K78(17)
085410110217     C                   MOVEA     K78           VIDMSG
085420110217     C                   leavesr
085430110217     c                   endif
085440110217     C*
085450110217    2C     WLNA          IFGT      *ZEROS
085460110217     C                   MOVEL     WLNA          COMLNA
085470110217     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
085480110217     C                   ELSE
085490110217     C                   SETON                                        30
085500110217    2C                   END
085510110217     C*
085520110217     C* CONTROLLO SE ANNULLATO
085530110217     C* CONSIDERO SOLO I TIPI "F" E "A"
085540110217    2C  N30ORGFVA        IFNE      *BLANKS
085550110217    2C     ORGFAG        ORNE      'F'
085560110217     C     ORGFAG        ANDNE     'A'
085570110217     C                   SETON                                        30
085580110217    2C                   END
085590110217     C* CONTROLLO CHE NON SIA UNA LINEA BLOCCATA
085600110217     C                   MOVEL     ORGDE8        OG148
085610110217     C     §OGLBL        IFEQ      'N'
085620110217     C                   SETON                                        30
085630110217    2C                   END
085640110217     C*
085650110217    2C     *IN30         IFEQ      *ON
085660110217     C                   MOVEL     ERR(12)       VIDMSG
085670110217     C                   SETON                                        90
085680110217     C                   leavesr
085690110217    2C                   ENDIF
085700110217     c
085710110217     C* TERMINAL DI ARRIVO
085720110217     C                   CLEAR                   DSLV55
085730110217     C                   MOVEL     'A'           D55TPT
085740110217     C** PER POSTE DEVO PASARE LA LINEA E NON IL TERMINAL
085750110217     C                   MOVEL     VIDLNP        D55LNP
085760110217     C**
085770110217     C                   MOVEL     COMLNA        D55LIN
085780110217     C                   MOVEL     BLPDSP        D55DRF
085790110217     C                   CALL      'FNLV55R'
085800110217     C                   PARM                    DSLV55
085810110217     C     D55ERR        IFEQ      ' '
085820110217     C                   MOVEL     D55TFA        COMTFA
085830110217     C                   ELSE
085840110217     C                   SETON                                        90
085850110217     C                   MOVEL     ERR(212)      VIDMSG
085860110217     C                   leavesr
085870110217     C                   ENDIF
085880110217     C*
085890110217     C                   MOVEL     ORGDE3        A_OG143
085900110217     C                   MOVEL     ORGDF0        A_OG150
085910110217     c                   ENDSR
085920940824     C*
085930940824     C* CONTROLLO TIPO SERVIZIO --------------------------------------*
085940940824     C     CTRTSP        BEGSR
085950940824     C* SOLO SE NON PERSONALIZZATO
085960941107    0C     *IN18         IFEQ      *OFF
085970941107     C                   SETOFF                                       09
085980940824     C                   CLEAR                   V1DTSP
085990940824     C*
086000080327     c                   clear                   NOutiTSP          1
086010940824    1C     WTSP          IFNE      *BLANKS
086020940922     C                   MOVEL     '5E'          COD
086030940922     C* RICERCA
086040940824    2C     WTSP          IFEQ      '?'
086050940922     C                   EXSR      CX§TAB
086060940824     C                   MOVEL     §KEY          WTSP
086070090604     C**!!!              MOVEL     §DES          V1DTSP
086080090604     C                   Z-ADD     1             C
086090090604     C     WTSP          LOOKUP    TSP(C)                                 30
086100090604    2C                   IF        *in30
086110090604     C                   MOVEL     DTS08(C)      V1DTSP
086120090604     c                   else
086130090604     c                   clear                   v1dtsp
086140090604     c                   endif
086150941011     C                   SETON                                        48
086160940824     C                   GOTO      ENDCSP
086170940824    2C                   END
086180940922     C* CONTROLLO
086190941107     C                   Z-ADD     1             C
086200941107     C     WTSP          LOOKUP    TSP(C)                                 30
086210940922     C* ERRORE
086220941107    2C     *IN30         IFEQ      *OFF
086230940824     C                   MOVEL     ERR(15)       VIDMSG
086240940929     C                   SETON                                        4890
086250940824     C                   MOVEL     '1'           WEMFOR
086260940824     C                   GOTO      ENDCSP
086270940824    2C                   ENDIF
086280940824     C*
086290090604     C**!!!              MOVEL     DTS(C)        V1DTSP
086300090604     C**!!!              MOVEL     DTS(C)        V2DTSP
086310090604     C                   MOVEL     DTS08(C)      V1DTSP
086320090604     C                   MOVEL     DTS08(C)      V2DTSP
086330941102     C*
086340941102     C* DEVE ESSERE UTILIZZABILE IN BOLLETTAZIONE
086350080327     c                   clear                   NOutiTSP          1
086360941107    2C     UTS(C)        IFNE      'S'
086370080327     C* IN IMMISSIONE  SEMPRE ERRORE
086380941108   3 C     *IN12         IFEQ      *OFF
086390080327     c* per  disk clienti se non utilizzabile do errore solo se
086400080327     c*    diverso da tariffa e  quindi posticipo il controllo
086410080326     C**** *IN12         OREQ      *OFF
086420080327     C**** *IN15         ANDEQ     *ON
086430941107     C* IN MANUTENZ SOLO SE E' CAMBIATO
086440941107     C     *IN12         OREQ      *ON
086450941107     C     *IN15         ANDEQ     *OFF
086460941107     C     WTSP          ANDNE     BLPTSP
086470941107     C*
086480941102     C                   MOVEL     ERR(15)       VIDMSG
086490941102     C                   SETON                                        4890
086500941102     C                   MOVEL     '1'           WEMFOR
086510941102     C                   GOTO      ENDCSP
086520941108    3C                   ENDIF
086530080327     c
086540080327     c                   if        *in12 and *in15
086550080327     c                   eval      NOutiTSP='N'
086560080327     c                   endif
086570080327     c
086580941108    2C                   ENDIF
086590080327     c
086600120302     C* VEDO SE VALIDO PER POSTE, BRT/SDI
086610000509     C     USO(C)        IFEQ      'P'
086620020319     C     §ogntw        ANDNE     'PPT'
086630000509     C                   MOVEL     ERR(194)      VIDMSG
086640000509     C                   SETON                                        4890
086650000509     C                   MOVEL     '1'           WEMFOR
086660000509     C                   GOTO      ENDCSP
086670000509    3C                   ENDIF
086680000509     C     USO(C)        IFEQ      'E'
086690020319     C     §ogntw        ANDEQ     'PPT'
086700000509     C                   MOVEL     ERR(194)      VIDMSG
086710000509     C                   SETON                                        4890
086720000509     C                   MOVEL     '1'           WEMFOR
086730000509     C                   GOTO      ENDCSP
086740000509    3C                   ENDIF
086750100209     c
086760100209     c* Se modifico pulisco i flag di controllo linea di arrivo
086770100209     c                   if        wtsp<>sa2tsp
086780100209     c                   clear                   qua
086790100209     c                   clear                   quaH
086800100209     c                   eval      sa2tsp=wtsp
086810100209     c                   endif
086820100319     C* SE RICHIAMATA DA VIDEATA DI PERSONALIZZAZIONE PROC.ORM ATTIVA
086830100319     C* ERRORE SE FORZATA LNA DIVERSA DA QUELLA DEFINITA SULL'ORM
086840100319     C     WPERSO        IFEQ      'P'
086850100319     C     WORM          ANDEQ     'S'
086860100319     C     PARTCH        ANDNE     'P'
086870100319     C     FLGFIT        ANDNE     'S'
086880100319     C     WesORE        ANDeq     'S'
086890100319     C     Wtsp          ANDne     ' '
086900100319     C     wtsp          andne     §oretsp
086910100319     C                   SETON                                        9048
086920100319     C                   MOVEL     ERR(76)       VIDMSG
086930100319     C                   GOTO      ENDCSP
086940100319     C                   ENDIF
086950000509     C*
086960940824     C* PERSONALIZZAZIONE
086970940824    2C     WPERSO        IFEQ      'P'
086980940922     C                   SETON                                        18
086990940824    2C                   ENDIF
087000940824     C*
087010941107   X1C                   ELSE
087020941107     C                   SETON                                        09
087030940824    1C                   ENDIF
087040941107    0C                   ENDIF
087050940824     C*
087060940824     C     ENDCSP        ENDSR
087070940824     C*
087080940824     C* CONTROLLO CODICE TRATTAMENTO MERCE --------------------------*
087090940824     C     CTRCTM        BEGSR
087100950504     C* NON E' CAMBIATO IL CTM
087110950504     C     WCTM          IFNE      SAVCTM
087120940824     C                   CLEAR                   V1DCTM
087130940824     C* RICERCA
087140940922     C                   MOVE      '1B'          COD
087150940824     C     '?'           SCAN      WCTM                                   30
087160940922     C* RICERCA
087170940824    1C     *IN30         IFEQ      *ON
087180940922     C                   EXSR      CX§TAB
087190940824     C                   MOVEL     §KEY          WCTM
087200941011     C                   SETON                                        49
087210940824     C                   GOTO      ENDCTM
087220940824    1C                   END
087230940922     C* COTROLLO
087240940920     C                   MOVEL(P)  WCTM          KEY
087250940824     C                   EXSR      CTABEL
087260940922     C* ERRORE
087270940824    1C     *IN30         IFEQ      *ON
087280940824     C                   MOVEL     ERR(16)       VIDMSG
087290940920     C                   SETON                                        4990
087300940824     C                   GOTO      ENDCTM
087310940824    1C                   ENDIF
087320940824     C*
087330940824     C                   MOVEL     TBLUNI        DS1B
087340940824     C*
087350940824     C* FLAG2 >< "S" (NUM SPEDIZIONE DAL CLIENTE) IN IMMISSIONE
087360940824    1C  N12§1BFG2        IFEQ      'S'
087370100208     C                   MOVEL     ERR(16)       VIDMSG
087380940920     C                   SETON                                        4990
087390940824     C                   GOTO      ENDCTM
087400940824    1C                   END
087410940824     C*
087420940824     C* IN RECUPERO SOLO CTM DA MAGAZZINO
087430990602    1C  N12PARTCH        IFEQ      'R'
087440940824     C     §1BFG6        ANDNE     'M'
087450940824     C                   MOVEL     ERR(16)       VIDMSG
087460940920     C                   SETON                                        4990
087470940824     C                   GOTO      ENDCTM
087480940824    1C                   END
087490940824     C* IM IMMISSIONE NON POSSO USARE CTM CON FLG7=S
087500940824    1C  N12§1BFG7        IFEQ      'S'
087510940824     C                   MOVEL     ERR(16)       VIDMSG
087520940920     C                   SETON                                        4990
087530940824     C                   GOTO      ENDCTM
087540940824    1C                   END
087550000911     C*
087560000919     C* POSSO USARE CTM DISK C SOLO SE TERMINAL ABILITATO
087570001106     C* NON FACCIO QUESTO CONTROLLO SE FLAG 12 = 'E'. IN QUESTO CASO
087580001106     C* INFATTI DEVE ESSERE POSSIBILE BOLLETTARE SEMPRE E SE TERMINAL
087590001106     C* NON AIBLITATO NON LO CONSIDERERO' UN DISK C
087600000904     C     §1BF12        IFNE      'N'
087610001106     C     §1BF12        ANDNE     'E'
087620000904     C     WASDKC        ANDNE     'S'
087630000904     C                   MOVEL     ERR(206)      VIDMSG
087640000904     C                   SETON                                        4990
087650000904     C                   GOTO      ENDCTM
087660000904     C                   ENDIF
087670000911     C*
087680000919     C                   MOVEL     '3C'          COD
087690000919     C                   MOVEL(P)  WKSC          KEY
087700000919     C                   CLEAR                   DS3C
087710000919     C                   EXSR      CTABEL
087720000919     C  N30              MOVEL     TBLUNI        DS3C
087730000911     C*
087740940824     C* CONTROLLO SE PREVEDE L'ASSEGNAZIONE DEI SEGNACOLLI IN AUTOMATIC
087750980424     C                   SETOFF                                       25
087760940824    1C     §1BFG6        IFEQ      'D'
087770940824     C     §1BFG6        OREQ      'I'
087780940824     C     §1BFG6        OREQ      'N'
087790940824     C                   SETON                                        25
087800940824    1C                   END
087810950504     C* SALVO IL CTM
087820950504     C                   MOVEL     WCTM          SAVCTM
087830940824     C*
087840940824     C     ENDCTM        TAG
087850940824     C   90              MOVEL     '1'           WEMFOR
087860950504     C   90              CLEAR                   SAVCTM
087870940824    0C                   ENDIF
087880940824     C                   ENDSR
087890940824     C*
087900940824     C* CONTROLLO CODICE CLIENTE -------------------------------------*
087910940824     C     CTRCCM        BEGSR
087920000201     C*
087930940825    0C     *IN19         IFEQ      *OFF
087940990610     C     WCOCCM        OREQ      'S'
087950950303     C                   SETOFF                                       02
087960020319     c                   clear                   clintw
087970940922     C                   CLEAR                   MITVLT
087980940920     C* 19 ON - MITTENTE PERSONALIZZATO
087990950209     C     WFLC          IFEQ      WLNP
088000950209     C                   SETOFF                                       14
088010020319     C                   MOVEL     §ogntw        CLIntw
088020950209     C                   ELSE
088030950209     C                   SETON                                        14
088040000201     C**
088050020306     c     wccm          ifeq      8888
088060020507     c     wccm          oreq      9999
088070020306     C                   SETON                                        9050
088080020306     C                   MOVEL     ERR(81)       VIDMSG
088090020306     C                   GOTO      ENDCCM
088100020306     c                   endif
088110051207     C* Imposto campo del codice
088120051207     C                   MOVEL     WFLC          WKSC
088130051207     C                   MOVE      WCCM          WKSC
088140051207     C*
088150000201     C* CONTROLLO SE CLIENTE DPD
088160000201     C     WFLC          CHAIN     AZORG01L      UNIORG               30
088170000201     C                   MOVEL     OG143         SAV143
088180000201     C                   MOVEL     ORGDE3        OG143
088190020319     C     §OGNTW        IFEQ      'DPD'
088200010103     C     SAVFPR        IFNE      'P'
088210010103     C     SAVFPR        ANDNE     'G'
088220010319     C     WSIDPD        ANDEQ     'S'
088230051207     c* Possibile linea diversa solo se prevista da tabella 3TR
088240150929     c****               clear                   tntb50ds
088250150929     C****               movel     wksc          b50ke2
088260051207     C*
088270150929     c****               movel     b50ke2        b50ke1
088280150929     c****               movel     'C'           b50opz
088290150929     c****               movel     wlnp          b50poa
088300150929     c****               call      'TNTB51R'
088310150929     c****               parm                    kpjba
088320150929     c****               parm                    tntb50ds
088330051207     c
088340150929     c***                if        b50err<>' '
088350150730     c* filiale cliente diversa da lnp va bene per dpd purchè entrambi
088360150730     c* i network siano dpd
088370150929     c***                if        §ogntw<>'DPD'  or *in79=*off
088380150929     c                   if        *in79=*off
088390001212     C                   SETON                                        9045
088400001212     C                   MOVEL     ERR(215)      VIDMSG
088410001212     C                   GOTO      ENDCCM
088420150730     c                   endif
088430150929     C****               ENDIF
088440051207     c
088450051207     C                   ENDIF
088460000201     C                   ENDIF
088470020319     C                   MOVEL     §OGntw        CLINTW
088480040930     c* errore se network cliente è logistica o sede
088490040930     c     clintw        ifeq      'LOG'
088500040930     c     clintw        oreq      'XXX'
088510040930     C                   SETON                                        9051
088520040930     C                   MOVEL     ERR(284)      VIDMSG
088530040930     C                   GOTO      ENDCCM
088540040930     c                   endif
088550000201     C                   MOVEL     SAV143        OG143
088560950209     C                   ENDIF
088570051207     C* Imposto campo del codice
088580051207     C                   MOVEL     WFLC          WKSC
088590051207     C                   MOVE      WCCM          WKSC
088600940928     C                   Z-ADD     KCI           CCC
088610940824     C     KACO          CHAIN     CNACO000                           30
088620940824     C* ANNULLATO
088630940921    2C  N30ACOFLG        IFEQ      '*'
088640940824     C                   SETON                                        30
088650940921    2C                   END
088660940824     C*
088670940921    2C     *IN30         IFEQ      *ON
088680940824     C                   MOVEL     ERR(22)       VIDMSG
088690940922     C                   SETON                                        9050
088700940824     C                   GOTO      ENDCCM
088710940921    2C                   ENDIF
088720940824     C* FLAG=8 NON SPEDISCE - NO BOLLE
088730130312    2C***  ACOABL        IFEQ      '8'
088740130312    2C***  ACOABL        OREQ      '*'
088750130312    2C     ACOABL        IFne      *blanks
088760940824     C                   MOVEL     ERR(23)       VIDMSG
088770940922     C                   SETON                                        9050
088780940824     C                   GOTO      ENDCCM
088790940921    2C                   END
088800941011     C*
088810941011     C                   MOVEL     ACORAG        VIDDMT
088820940824     C*
088830940921    2C     WCCM          IFNE      8888
088840940909     C     WCCM          ANDNE     9999
088850940824     C     KACO          CHAIN     CNIND000                           30
088860940921    3C     *IN30         IFEQ      *ON
088870940824     C                   MOVEL     ERR(22)       VIDMSG
088880940922     C                   SETON                                        9050
088890940921    3C                   ENDIF
088900000509     C* PER BOLLA LNP POSTE, AMMESSI SOLO CLIENTI POSTE E VICEVERSA
088910020319     c     §ogntw        ifeq      'PPT'
088920020319     c     clintw        oreq      'PPT'
088930020319     C     §ogntw        IFNE      clintw
088940000509     C                   MOVEL     ERR(200)      VIDMSG
088950000509     C                   SETON                                        9050
088960020319     c                   endif
088970000509    3C                   ENDIF
088980000509     C*
088990970703     C* CONTROLLO LA NAZIONE
089000970703     C* VISTO CHE E' UN CODIFICATO PRENDO LA DIVISA CHE MI PUO' SERVIRE
089010970703     C*  PER L'IMPORTO DA ASSICURARE O VALORE MERCE DICHIARATO
089020970703     C                   MOVEL     '15'          COD
089030970703     C                   MOVEL(P)  INDSTA        KEY
089040970703     C                   EXSR      CTABEL
089050970703     C* NAZIONE ERRATA
089060970703    3C     *IN30         IFEQ      *ON
089070970703     C                   MOVEL     ERR(28)       VIDMSG
089080970703     C                   SETON                                        9050
089090970703   X3C                   ELSE
089100970703     C                   MOVEL     TBLUNI        DS15
089110970703     C                   MOVEL     §15VLT        MITVLT
089120970703    4C     §15ITA        IFNE      'I'
089130970703     C                   MOVEL     'E'           WMITIE            1
089140970703     C                   ELSE
089150970703     C                   MOVEL     'I'           WMITIE
089160970703    4C                   ENDIF
089170970703    3C                   ENDIF
089180970704     C*
089190970704     C* controllo se esiste in anagrafica la provincia
089200970704     C* SOLO SE NAZIONE ITALIA CIOE' ='   '
089210970704     C     INDSTA        IFEQ      *BLANKS
089220970704    3C     INDPRV        ANDEQ     *BLANKS
089230970704     C                   MOVEL     ERR(128)      VIDMSG
089240970704     C                   SETON                                        9050
089250970704     C                   GOTO      ENDCCM
089260100120    3C                   ENDIF
089270970703     C*
089280970703     C* CAP OBBLIGATORIO : CONTROLLO
089290970703     C                   CLEAR                   DSSI95
089300970708     C                   CLEAR                   DSLV13
089310970703     C                   MOVEL     '3'           I95TCN
089320970703     C                   MOVEL     INDCAE        I95CAP
089330970703     C                   MOVEL     INDSTA        I95NAR
089340970703     C                   MOVEL     INDPRV        I95PRV
089350970703     C                   MOVEL     INDCIT        I95LOC
089360970714     C                   MOVEL     BLPDSP        I95DAT
089370971201     C     §3AFCA        IFNE      0
089380971201     C                   MOVEL     'S'           I95FCA
089390971201     C                   ENDIF
089400971201     C                   MOVEL     FLGTB1        I95TPO
089410970708     C* ERRORE AFFIDABILITA = 0
089420970708     C                   MOVEL     'S'           I13AF0
089430970708     C* CONTROLLO CONGRUENZA CAP PROVINCIA
089440970708     C                   MOVEL     'S'           I13CNG
089450970708     C* CONTROLLO NON FORZABILE CITTA' CON VIARIO
089460100120     C*******            MOVEL     'S'           I13CNV
089470020212     c*
089480020212     c* mittente fedex passo flag apposito per dire di prendere i dati i
089490020212     c* dalla tabella della nazione
089500020212     c     §ogntw        ifeq      'FED'
089510020212     c                   movel     'S'           i95fi1
089520020212     c                   endif
089530970703     C                   CALL      'FNLV13R'
089540970708     C                   PARM                    KPJBA
089550970708     C                   PARM                    DSLV13
089560970708     C                   PARM                    DSSI95
089570941230     C* ERRORE
089580970708     C     O13ERR        IFNE      *BLANKS
089590970708     C                   MOVEL     O13MSG        W077A            77
089600970703     C* IMPOSTO IL MESSAGGIO METTENDO VICIVO LA SCRITTA:
089610970703     C*   "SUL PIANO DEI CONTI"
089620970703     C                   CLEAR                   K78
089630970703     C                   MOVEA     W077A         K78
089640970703     C     ' '           CHECKR    W077A         WP                2 0
089650970703     C                   ADD       2             WP
089660970703     C     WP            IFLT      61
089670970703     C                   MOVEA     CPDC          K78(WP)
089680970703     C                   MOVEA     K78           VIDMSG
089690970703     C                   ELSE
089700970703     C                   MOVEL     O95MSG        VIDMSG
089710970703     C                   MOVE      CPDC          VIDMSG
089720970703     C                   ENDIF
089730940922     C                   SETON                                        9050
089740941231     C                   GOTO      ENDCCM
089750941231    3C                   ENDIF
089760941230     C* SALVO IL FLAG ANTEPORTO
089770970703     C                   MOVEL     O95ISO        COMFAP
089780970708     C                   MOVEL     O95ISO        VIDFAP
089790970708     C                   MOVEL     O95CTS        MITCTS
089800140403     C                   MOVEL     O95gf2        comgf2
089810940922     C*
089820940921    2C                   ENDIF
089830940824     C*
089840940824     C   90              GOTO      ENDCCM
089850940824     C*
089860940921     C* PER MANUTENZIONE O DISK CLI OBBLIGATORIO IL COD.CLI ORIGINALE
089870960805     C* OPPURE UN CODICE CLIENTE CON LA STESSA SERIE
089880980410    1C   12§1BFG6        IFEQ      'C'
089890940824     C     §1BFG7        OREQ      'S'
089900940909    2C     WKSC          IFNE      SAVMIT
089910100517     c
089920960805     C*
089930100517     C**                 MOVEL     '3C'          COD
089940100517     C**                 MOVEL(P)  WKSC          KEY
089950960805     C*
089960100517     C**                 EXSR      CTABEL
089970100517     C**N30              MOVEL     TBLUNI        DS3C
089980960805     C*
089990100517    3C**   *IN30         IFEQ      *ON
090000100517     C**   §3CNRS        ORNE      VIDNRS
090010980805     C* E' VALIDA LA 3C SOLO SE HA L'ASTERISCO
090020100517     C**   §3COKD        ORNE      '*'
090030100517     C**                 MOVEL     ERR(67)       VIDMSG
090040100517     C**                 SETON                                        5090
090050100517    3C**                 ENDIF
090060100517     c
090070100517     c                   clear                   trulnrsds
090080100517     c                   movel     wksc          inrsCCM
090090100517     c                   movel     vidnrs        inrsNRS
090100100517     c                   movel     wfls          inrsFLS
090110100517     c
090120100517     c                   call      'TRULNRSR'
090130100517     c                   parm                    trulnrsds
090140100517     c                   if        onrserr<>' '
090150100517     C                   MOVEL     ERR(67)       VIDMSG
090160100517     C                   SETON                                        5090
090170100517    3C                   endif
090180100517     c
090190960805    2C                   END
090200940825    1C                   END
090210940825     C*
090220940825     C   90              GOTO      ENDCCM
090230940825    0C                   ENDIF
090240940824     C*
090250940824     C* CONTROLLI CODICE BOLLA CON CODICE CLIENTE
090260940825    0C     WCBO          IFNE      *BLANKS
090270941103    1C  N04WCCM          IFEQ      9999
090280940824     C                   MOVEL     ERR(11)       VIDMSG
090290940922     C                   SETON                                        5090
090300940825    1C                   END
090310940824     C* SE ASSEGNATO
090320940909    1C   04WCCM          IFEQ      8888
090330940824     C                   MOVEL     ERR(11)       VIDMSG
090340940922     C                   SETON                                        5090
090350940825    1C                   ENDIF
090360940824     C*
090370940824     C   90              GOTO      ENDCCM
090380940825    0C                   ENDIF
090390950125     C*
090400950125     C* SE E' FRANCO NON  SI PUO' TASSARE CON TARIFFA MITTENTE
090410990720    0C  N04WCBO          IFNE      *BLANKS
090420990720     C     WFTM          ANDEQ     'S'
090430950717     C                   MOVEL     ERR(119)      VIDMSG
090440950125     C                   SETON                                        5090
090450950125     C                   GOTO      ENDCCM
090460990720    0C                   ENDIF
090470940825     C*
090480020507     C* SE 8888 O 9999
090490940909    0C     WCCM          IFEQ      8888
090500940909     C     WCCM          OREQ      9999
090510940825     C*
090520950125     C* NON E' POSSIBILE IMMETTERE TASSAZIONE CON TAR MIT
090530940825    1C     WFTM          IFEQ      'S'
090540950717     C                   MOVEL     ERR(119)      VIDMSG
090550940922     C                   SETON                                        5090
090560940825     C                   GOTO      ENDCCM
090570940825    1C                   ENDIF
090580940921     C*
090590940921     C* SE PRIMA ERA CODIFICAT E ADESSO NO PULISCO I CAMPI DEL MITTENTE
090600990720    1C     WCCM          IFNE      WCCMS
090610950125     C                   CLEAR                   V2DTEL
090620940921     C*
090630940921     C* NON PULISCO SE CAMBIATO CODICE DA 8888 A 9999 O VICEVERSA
090640020507     C     WCCMS         ifNE      9999
090650940921     C     WCCMS         ANDNE     8888
090660010213     C*
090670940921     C                   CLEAR                   VIDRSM
090680940921     C                   CLEAR                   VIDLOM
090690940921     C                   CLEAR                   VIDINM
090700940921     C                   CLEAR                   VIDCAM
090710940921     C                   CLEAR                   VIDPRM
090720940921     C                   CLEAR                   VIDNZM
090730940921     C                   CLEAR                   VIDPIM
090740940921     C                   CLEAR                   VIDFAP
090750061110     C                   CLEAR                   VIDcdf
090760020507     c
090770990720    2C                   ENDIF
090780940921     C                   MOVEL     WCCM          WCCMS
090790990720    1C                   ENDIF
090800020507     c* se richiesta bolla firmata i dati del mittente sono quelli del
090810020507     c* p.o. mittente
090820020513     c     vidcbo        ifeq      'FO'
090830020507     c     wflc          chain     azorg01l      uniorg               30
090840020507     c                   movel     orgdes        vidrsm
090850020507     c                   movel     orgind        vidinm
090860020507     c                   movel     orgcpf        vidcam
090870020507     c                   movel     orgloc        vidlom
090880020507     c                   movel     orgpro        vidprm
090890020507     c                   endif
090900000113     C* SE E' IN PERSONALIZZAZIONE, RIPROTEGGO, E PROTETTO
090910000113     C   19              SETON                                        02
090920940825     C*
090930940825   X0C                   ELSE
090940110519     c* in immissione controllo se per il cliente mittente sono
090950110519     c* presenti bolle da confermare
090960110519     c* Se ce ne sono: messaggio forzabile
090970110519    3c                   if        not *in12
090980110519     c                   exsr      sr_chkvab
090990110519     c                   if        wemfor='1'
091000110519     c                   goto      endccm
091010110519     c                   endif
091020110519    3c                   endif
091030960926     C* SE TUTTO OK E NON E' 8888 O 9999 E CLIENTE DI ALTRO P.O.
091040940921     C* PROTEGGO IL MITTENTE E MEMORIZZO I CAMPI
091050940909     C*
091060940825     C                   SETON                                        02
091070990720    1C     WPERSO        IFEQ      'P'
091080950303     C                   SETON                                        19
091090990720    1C                   END
091100940909     C                   MOVEL     ACORAG        VIDRSM
091110940909     C                   MOVEL     INDCIT        VIDLOM
091120940909     C                   MOVEL     INDVIA        VIDINM
091130941005     C                   MOVEL     INDCAE        VIDCAM
091140940909     C                   MOVEL     INDPRV        VIDPRM
091150940909     C                   MOVEL     INDSTA        VIDNZM
091160940909     C                   MOVEL     INDIVA        WISO
091170990720    1C     WISO          IFGE      '00'
091180940909     C                   MOVEL     INDIVA        VIDCPM
091190120504     C                   clear                   VIDism
091200940909     C                   ELSE
091210940909     C                   MOVEL     INDIVA        VIDPIM
091220990720    1C                   END
091230120508     c* Prepagato e partita iva $$ non la carico a video: non ci vuole
091240120508     c* in contabilità crea problemi
091250120508     c                   if        *in22 and wiso='$$'
091260120508     c                   clear                   vidpim
091270120508     c                   endif
091280061110     c   22              movel     indcdf        vidcdf
091290950123     C*
091300950123     C                   MOVE      INDTEL        V2DTEL
091310950123     C                   MOVEL     'Tel.'        V2DTEL
091320940825    0C                   ENDIF
091330940824     C* OK
091340940825    0C     WPERSO        IFEQ      'P'
091350950303     C                   SETON                                        85
091360940825    0C                   END
091370990720     C                   CLEAR                   WCOCCM
091380110921     c* accedo a tabella "CLI" del cliente mittente
091390080104     c                   clear                   dcli
091400110921     c****               if        *in12 and not *in15 and
091410110921     c*****                        vidnrs>0
091420071218     c                   exsr      sr_dcli
091430110922     c****               endif
091440061110     c
091450061110     c* se no prepagato solo sottolineato il campo del codice fiscale
091460061110     c  n22              movel     ul            atrcdf
091470940824     C*
091480940824     C     ENDCCM        TAG
091490940824     C   90              MOVEL     '1'           WEMFOR
091500940824     C                   ENDSR
091510941103     C*
091520941103     C* CONTROLLO IL MITTENTE ORIGINALE ------------------------------*
091530941103     C     CTRMO         BEGSR
091540941103     C*
091550941103    0C     *IN03         IFEQ      *OFF
091560941103     C*
091570941103     C* SE IMMESSO CAP O NAZIONE IMMETTERE TUTTI E 3
091580941103    1C     WCMO          IFNE      *BLANKS
091590950206     C     WRMO          ANDEQ     *BLANKS
091600941103     C                   MOVEL     ERR(100)      VIDMSG
091610941103     C                   SETON                                        7190
091620941103     C                   GOTO      ENDCMO
091630941103    1C                   ENDIF
091640941103     C*
091650941103    1C     WNAR          IFNE      *BLANKS
091660941103    2C     WCMO          IFEQ      *BLANKS
091670941103     C     WRMO          OREQ      *BLANKS
091680941103     C                   MOVEL     ERR(100)      VIDMSG
091690941103     C                   SETON                                        7190
091700941103     C                   GOTO      ENDCMO
091710941103    2C                   ENDIF
091720941103    1C                   ENDIF
091730941103     C*
091740941103     C* CONTROLLO NAZIONE MITTENTE ORIGINALE
091750941103    1C     WNAR          IFNE      *BLANKS
091760941103     C                   EXSR      CTRNAR
091770941103    2C     WEMFOR        IFEQ      '1'
091780941103     C                   SETOFF                                       68
091790941103     C                   SETON                                        73
091800941103     C                   GOTO      ENDCMO
091810941103    2C                   END
091820950215    1C                   END
091830941103     C*
091840941103     C* CONTROLLO ESISTENZA CAP MITTENTE ORIGINALE
091850950215    1C     WCMO          IFNE      *BLANKS
091860970708     C**
091870970708     C* CAP CON VIARIO --> ERRORE FORZABILE
091880970708    2C     WCMO          IFNE      VARCMO
091890970708     C                   CLEAR                   DUE
091900970708     C                   MOVEL     WCMO          VARCMO
091910970708    2C                   ENDIF
091920970708     C**
091930970704     C                   CLEAR                   DSSI95
091940970708     C                   CLEAR                   DSLV13
091950970704     C                   MOVEL     WNAR          I95NAR
091960970704     C                   MOVEL     WCMO          I95CAP
091970970704     C                   MOVEL     '3'           I95TCN
091980970708     C* NON POSSO DARE ERRORE PER AFFIDABILITA=0 PERCHE' NON HO LA
091990970708     C*  PROVINCIA
092000970708     C                   MOVEL     'S'           I13CNV
092010970708     C                   MOVEL     'S'           I13SZV
092020970708     C                   MOVEL     DUE           E13FZV
092030970704     C                   CALL      'FNLV13R'
092040970708     C                   PARM                    KPJBA
092050970708     C                   PARM                    DSLV13
092060970708     C                   PARM                    DSSI95
092070970708     C* FLAG FORZATURA
092080970708     C                   MOVEL     E13FZV        DUE
092090941103     C*
092100941103     C* SE CAP NON TROVATO  ERRORE
092110970708    2C     O13ERR        IFNE      *BLANKS
092120970708     C                   MOVEL     O13MSG        VIDMSG
092130941103     C                   SETON                                        7290
092140941103     C                   GOTO      ENDCMO
092150970704    2C                   ENDIF
092160941103     C*
092170941103    1C                   ENDIF
092180941103     C*
092190941103     C     WPERSO        IFEQ      'P'
092200941103     C                   SETON                                        03
092210941103     C                   ENDIF
092220941103     C*
092230941103     C     ENDCMO        TAG
092240941103     C   90              MOVEL     '1'           WEMFOR
092250941103    0C                   ENDIF
092260941103     C*
092270941103     C                   ENDSR
092280940913     C*
092290940913     C* CONTROLLO CONSEGNA RICHIESTA ---------------------------------*
092300940913     C     CTRCR         BEGSR
092310940913     C*
092320940913    1C     *IN16         IFEQ      *OFF
092330971007    2C     WDCR          IFEQ      0
092340940913     C                   Z-ADD     0             COMDCR
092350940913     C* DATA
092360971007   X2C                   ELSE
092370940913     C                   Z-ADD     WDCR          G02DAT
092380940913     C                   MOVEL     *BLANKS       G02ERR
092390940913     C                   CALL      'XSRDA8'
092400941115     C                   PARM                    WLBDAT
092410941115     C* ERRORE
092420940913    3C     G02ERR        IFEQ      '1'
092430940913     C                   MOVEL     ERR(19)       VIDMSG
092440941102     C                   SETON                                        5990
092450940913     C                   GOTO      ENDCR
092460940913    3C                   END
092470940913     C*  SE CAMBIATA LA DATA CONSEGNA RICHIESTA PULISCO LA FORZATURA
092480940913    3C     G02INV        IFNE      COMDCR
092490940913     C                   MOVEL     ' '           UNO
092500030417     c                   Clear                   fordcr
092510940913    3C                   ENDIF
092520940916     C*
092530940913     C                   MOVE      G02INV        COMDCR            8 0
092540940916     C                   MOVE      G02DAT        WDCR
092550940913     C*
092560940913     C* SE < ALLA DATA SPEDIZIONE: ERRORE
092570940913    3C     COMDCR        IFLT      BLPDSP
092580940916     C                   MOVEL     ERR(19)       VIDMSG
092590941102     C                   SETON                                        5990
092600940913     C                   GOTO      ENDCR
092610940913    3C                   ENDIF
092620101022     c* Verifico che non cada in giorno festivo per "IL"
092630101022     c* In personalizzazione lo posso fare solo col calendario partenza
092640101022     c                   if        WPERSO='P' and   wtcr=' '
092650101022     c                   movel     comdcr        wdata
092660101022     C                   CLEAR                   W0030
092670101022     C     KCLN          CHAIN     AZCLN01L                           30
092680101022     C   30              CLEAR                   CLNPOM
092690101022     C                   MOVEA     CLNPOM        K31
092700101022     C                   MOVEL     K31(WGG)      WFEST
092710101022     c     wfest         lookup    S1Y                                    30
092720101022     c
092730101022    4c                   if        *in30 and wfest<>' '
092740141124     c                   select
092750141124     c                   when      v0clna=*blanks or
092760141124     c                             (a_§ogntw<>'DPD' and a_§ogntw<>'EEX'
092770141124     c                              and a_§ogntw<>'FED')
092780101022     C                   MOVEL     ERR(197)      VIDMSG
092790101022     C                   SETON                                        5990
092800101022     C                   GOTO      ENDCR
092810141124     c                   when      v0clna<>wforz_lnap
092820141124     c                   eval      wforz_lnap=v0clna
092830141124     C                   MOVEL     ERR(197)      VIDMSG
092840141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
092850141124     C                   SETON                                        5990
092860141124     C                   GOTO      ENDCR
092870141124     c                   endsl
092880101022    4c                   endif
092890101022    3c                   endif
092900940913     C*
092910940913     C* 16 ON - PERSONALIZZAZIONE
092920940913    3C     WPERSO        IFEQ      'P'
092930940913     C                   SETON                                        16
092940940913    3C                   ENDIF
092950940913    2C                   ENDIF
092960940913    1C                   ENDIF
092970030409
092980051214      **Se sono in personalizzazione controllo che la data consegna
092990051214      **richiesta non sia superiore a oggi + i giorni previsti in §vpodcg
093000051214     c***                If        Wperso = 'P' and ComDcr > woggi5
093010051214     c***                Eval      *In59 = *On
093020051214     c***                Eval      *In90 = *On
093030051214     c***                Eval      VidMsg = Err(277)
093040051214     c***                Eval      VidMsg = %trim(vidmsg) + ' ' +
093050051214     c***                          %trim(%editc(§vpodcg:'Z'))  +
093060051214     c***                          ' giorni dalla data odierna'
093070051214     c***                GoTo      EndCr
093080051214     c***                EndIf
093090051214     c* controllo che la data consegna richiesta non sia superiore a oggi +
093100051214     c* i giorni previsti in tabella VPO
093110051214     c                   if        wtcr = 'P'
093120051214     c                   z-add     woggidcgm1    s_woggidcg
093130051214     c                   z-add     §vpodcgm1     s_vpodcg
093140051214     c                   else
093150051214     c                   z-add     woggidcgm2    s_woggidcg
093160051214     c                   z-add     §vpodcgm2     s_vpodcg
093170051214     c                   endif
093180051214     c*
093190051214     c                   if        comdcr > s_woggidcg
093200051214     c                   Eval      *In59 = *On
093210051214     c                   Eval      *In90 = *On
093220051214     c                   Eval      VidMsg = Err(277)
093230051214     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
093240051214     c                             %trim(%editc(s_vpodcg:'Z'))  +
093250051215     c                             ' giorni dalla data odierna.'
093260051214     c                   GoTo      EndCr
093270051214     c                   endif
093280030416
093290030416      * Controllo che la data consegna richiesta non sia superiore a oggi + 1 mm
093300051214     c*                  If        ComDcr > woggi1m
093310051214     c*                            and fordcr = *Blanks
093320051214     c*                  Eval      *In59 = *On
093330051214     c*                  Eval      *In90 = *On
093340051214     c*                  Eval      VidMsg = Err(1)
093350051214     c*                  Eval      fordcr = '1'
093360051214     c*                  GoTo      EndCr
093370051214     c*                  EndIf
093380030409
093390940913     C* ORA
093400940920    1C     *IN23         IFEQ      *OFF
093410940913     C*
093420150202    2C***  WHCR          IFLT      0
093430150202     C***  WHCR          ORGT      24
093440150203     c                   if        whcr>0  or wmcr>0
093450150202    2C     WHCR          IFLT      08
093460150202     C     WHCR          ORGT      20
093470940913     C                   MOVEL     ERR(20)       VIDMSG
093480960319     C                   SETON                                        6090
093490940913     C                   GOTO      ENDCR
093500940913    2C                   ENDIF
093510150202    2C                   ENDIF
093520940913     C*
093530940913    2C     WMCR          IFLT      0
093540940913     C     WMCR          ORGT      59
093550940913     C                   MOVEL     ERR(20)       VIDMSG
093560960319     C                   SETON                                        6090
093570940913     C                   GOTO      ENDCR
093580940913    2C                   ENDIF
093590150203     c*
093600150203     c                   if        whcr=20 and wmcr>0
093610150203     C                   MOVEL     ERR(20)       VIDMSG
093620150203     C                   SETON                                        6090
093630150203     C                   GOTO      ENDCR
093640150203     c                   endif
093650150203
093660940916     C* PERSONALIZZAZIONE
093670940913    2C     WPERSO        IFEQ      'P'
093680941102    3C     WHCR          IFNE      0
093690941102     C     WMCR          ORNE      0
093700940920     C                   SETON                                        23
093710940913    3C                   ENDIF
093720940913    2C                   ENDIF
093730940913     C*
093740941102     C* SE IMMESSO TIPO DEVO IMMETTERE ANCHE ORA O DATA
093750941005    2C     WTCR          IFNE      ' '
093760941102     C*
093770941102    3C     WDCR          IFEQ      0
093780941102     C     WHCR          ANDEQ     0
093790941102     C     WMCR          ANDEQ     0
093800941102     C                   MOVEL     ERR(43)       VIDMSG
093810941102     C                   SETON                                        5990
093820941102     C                   GOTO      ENDCR
093830941102    3C                   ENDIF
093840941102     C*
093850941102    3C     WPERSO        IFEQ      'P'
093860940913     C                   SETON                                        17
093870941102    3C                   ENDIF
093880941005    2C                   ENDIF
093890941005    1C                   ENDIF
093900940913     C*
093910940916     C     ENDCR         ENDSR
093920900427     C*
093930900427     C* CONTROLLO DATI FORMATO1 --------------------------------------
093940020531     C     CTRD01        BEGSR
093950961111     C                   SETOFF                                       953976
093960000915     C                   SETOFF                                       33
093970941003     C                   CLEAR                   WEMFOR
093980010412     C                   CLEAR                   WEFORM
093990941115     C                   CLEAR                   VIDMSG
094000070323     c                   if        *in12='0' or *in15='1'
094010070322     c                   clear                   wparcel
094020070323     c                   endif
094030950127     C***
094040950127     C*** ESEGUO RICERCA ALFABETICA
094050950127     C                   MOVEL     VIDCCM        WCCM
094060950209     C                   MOVEL     VIDLNP        WLNP
094070950127     C     VIDFLC        IFNE      0
094080950127     C                   Z-ADD     VIDFLC        WFLC
094090950127     C                   ELSE
094100950127     C                   Z-ADD     VIDLNP        WFLC
094110950127     C                   ENDIF
094120950127     C                   MOVEL(P)  VIDDMT        PAXDMT
094130950127     C                   EXSR      RICALF
094140950127     C                   MOVEL     WCCM          VIDCCM
094150050215     C                   MOVEL(p)  PAXDMT        VIDDMT
094160950127     C     *IN14         IFEQ      *ON
094170950127     C                   MOVEL     WFLC          VIDFLC
094180950127     C                   ENDIF
094190010216     C     WEMFOR        IFEQ      '1'
094200010216     C                   GOTO      ENDC01
094210010216     C                   ENDIF
094220970925     C***
094230160223     c*** DATA SPEDIZIONE ***
094240970925     C                   EXSR      CTRDSP
094250970925     C   90              GOTO      ENDC01
094260950208     C***
094270950208     C*** LINEA PARTENZA ***
094280950208     C                   MOVEL     VIDLNP        WLNP
094290950208     C                   EXSR      CTRLNP
094300950208     C   90              GOTO      ENDC01
094310991206      *
094320991206      * PER LNP DPD OBBLIGATORIO 1 COLLO
094330020319     C     §OGNTW        IFEQ      'DPD'
094340000509     C     V1CNCL        ANDNE     1
094350991206     C                   SETON                                        6290
094360991206     C                   MOVEL     ERR(178)      VIDMSG
094370991206     C                   GOTO      ENDC01
094380000509     C                   ENDIF
094390010212     C***
094400010212     C*** NUMERO O.R.M.
094410010212     C*
094420010212     C* Controllo solo se attivata procedura O.R.M.
094430010212     C* Se sto immettendo i miei prepagati l'O.R.M. viene creato alla
094440010212     c* fine dell'immissione
094450010212     C     WORM          IFEQ      'S'
094460010212     C     PARTCH        ANDNE     'P'
094470010213     C                   Z-ADD     VIDPOE        WOPOE
094480010213     C                   Z-ADD     VIDNOR        WONOR
094490010213     C                   Z-ADD     VIDNRV        WONRV
094500010213     C                   Z-ADD     VIDLNP        WOLNP
094510010212     C                   EXSR      CTRORM
094520010212     C   90              GOTO      ENDC01
094530010216     C     WEMFOR        IFEQ      '1'
094540010216     C                   GOTO      ENDC01
094550010216     C                   ENDIF
094560010212     C* Propongo campi da O.R.M. se non immessi da utente
094570010212     C* ** Solo se orm non è fittizio **
094580010212     C     FLGFIT        IFEQ      *BLANKS
094590010215     C                   EXSR      PRPOR1
094600010213     C   90              GOTO      ENDC01
094610010212     c* Se ho proposto dei campi non continuo i controlli ma devo
094620010212     c* riemettere videata per visualizzare i dati aggiunti
094630050119     c* idem se richiesto espressamente di non continuare i controlli
094640010212     C     WEFORM        IFEQ      '1'
094650050119     c     wsolo_prp     oreq      '1'
094660040915     c* posizionamento cursore su cod mittente dopo proposte campi da orm
094670040915     c* se però cod.mittente personalizzato mi posiziono su n.ro colli
094680041108     c**** *in19         ifeq      *off
094690041108     c**** *in85         andeq     *off
094700041108     c**** *in38         andeq     *off
094710041108     c****               z-add     12            h1riga
094720041108     c****               z-add     24            h1colo
094730041108     c****               else
094740041129     c     *in38         ifeq      *off
094750041108     c**** *in19         ifeq      *on
094760041108     c**** *in85         oreq      *on
094770040915     c                   z-add     13            h1riga
094780040915     c                   z-add     20            h1colo
094790040915     c                   endif
094800041108     c*****              endif
094810041108     c*****              endif
094820050321     c                   eval      weform = '1'
094830010212     C                   GOTO      ENDC01
094840010212     C                   ENDIF
094850010212     C                   ENDIF
094860010212     C                   ENDIF
094870010227     C* SE PREMUTO F8 MA PROC.ORM NON ATTIVATA RIEMETTO LA VIDEATA
094880010227     C   KH              MOVEL     '1'           WEMFOR
094890010227     C   KH              GOTO      ENDC01
094900940920     C***
094910940920     C*** SIGLA OPERATORE ***
094920940920     C* CONTROLLO SOLO SE NON E' PROTETTO
094930941011     C     *IN13         IFEQ      *OFF
094940940920     C* NON DEVE ESSERE NELLA TABELLA 3M: SIGNIFICA CHE NON E' UTILIZZ
094950940920     C                   MOVEL     '3M'          COD
094960940920     C                   MOVEL(P)  VIDSOP        KEY
094970940920     C                   EXSR      CTABEL
094980940920     C     *IN30         IFEQ      *OFF
094990950713     C     VIDSOP        OREQ      ' '
095000940920     C                   MOVEL     ERR(29)       VIDMSG
095010940923     C                   SETON                                        4290
095020940920     C                   GOTO      ENDC01
095030940920     C                   ENDIF
095040940920     C                   ENDIF
095050940823     C***
095060990628     C*** DATA RITIRO MERCE E PRESTAZIONE M/P ***
095070020131     C                   EXSR      CTRDRT
095080940920     C   90              GOTO      ENDC01
095090940823     C***
095100960926     C*** CODICE AUTOTRASPORTATORE ***
095110940824     C                   MOVEL     VIDPDR        WPDR
095120940824     C                   EXSR      CTRPDR
095130940824     C                   MOVEL     WPDR          VIDPDR
095140940824     C     WEMFOR        IFEQ      '1'
095150940920     C                   GOTO      ENDC01
095160940824     C                   ENDIF
095170940823     C***
095180921006     C*** NUMERO SPEDIZIONE ***
095190990602     C  N12PARTCH        IFEQ      'R'
095200921006     C     RECNSP        ANDEQ     0
095210940823     C                   MOVEL     ERR(33)       VIDMSG
095220940923     C                   SETON                                        6190
095230940920     C                   GOTO      ENDC01
095240921006     C                   END
095250950127     C***
095260950127     C*** NUMERO COLLI ***
095270950127     C     V1CNCL        IFEQ      0
095280950127     C                   MOVEL     ERR(34)       VIDMSG
095290950127     C                   SETON                                        6290
095300950127     C                   GOTO      ENDC01
095310950127     C                   END
095320950127     C***
095330950127     C*** PESO   ***
095340950127     C* LO CONTROLLO SOLO IN SECONDA VIDEATA SE CARICAMENTO DISK  CLI
095350950127     C* >< DA 0
095360980402     C*
095370980402     C* OBBLIGATORIO
095380950127     C  N12VIDPKG        IFEQ      0
095390950127     C                   MOVEL     ERR(46)       VIDMSG
095400950127     C                   SETON                                        6390
095410950127     C                   GOTO      ENDC01
095420950127     C                   ENDIF
095430980402     C*
095440980402     C* NON MAGGIORE DEL LIMITE POSTO (forzabile)
095450090609     C* N12VIDPKG        IFGT      §QTPKB
095460090609     C*    VIDPKG        ANDNE     SAVPKG
095470090609     C*                  MOVE      VIDPKG        SAVPKG
095480090609     C*                  CLEAR                   WPT1
095490980623     C* PREPARO MSG
095500090609     C*                  MOVEA     ERR(52)       K78
095510090609     C*                  MOVEL     §QTPKB        W006A             6
095520090609     C*                  MOVEA     W006A         SKI(10)
095530090609     C*                  Z-ADD     10            I                 3 0
095540090609     C*                  EXSR      ABBL
095550090609     C*                  MOVEA     SKI(10)       K78(34)
095560090609     C*                  MOVE      §QTPKB        W001A
095570090609     C*                  MOVEL     W001A         K78(41)
095580090609     C*                  MOVEA     K78           VIDMSG
095590090609     C*                  SETON                                        6390
095600090609     C*                  GOTO      ENDC01
095610090609     C*                  ENDIF
095620940823     C***
095630940823     C*** CODICE BOLLA ***
095640940824     C                   MOVEL     VIDCBO        WCBO
095650940824     C                   EXSR      CTRCBO
095660940824     C                   MOVEL     WCBO          VIDCBO
095670940824     C     WEMFOR        IFEQ      '1'
095680940920     C                   GOTO      ENDC01
095690940824     C                   ENDIF
095700940929     C***
095710940929     C*** CODICE MITTENTE ***
095720940929     C                   MOVEL     VIDFTM        WFTM
095730940929     C                   MOVEL     VIDCCM        WCCM
095740940929     C     VIDFLC        IFNE      0
095750940929     C                   Z-ADD     VIDFLC        WFLC
095760940929     C                   ELSE
095770940929     C                   Z-ADD     VIDLNP        WFLC
095780941108     C                   ENDIF
095790940929     C                   EXSR      CTRCCM
095800941011     C                   MOVEL     WCCM          VIDCCM
095810941011     C     *IN14         IFEQ      *ON
095820941011     C                   MOVEL     WFLC          VIDFLC
095830941011     C                   ENDIF
095840941011     C*
095850940929     C     WEMFOR        IFEQ      '1'
095860940929     C                   GOTO      ENDC01
095870940929     C                   ENDIF
095880940823     C***
095890940823     C*** TIPO SERVIZIO ***
095900940824     C                   MOVEL     VIDTSP        WTSP
095910940929     C                   EXSR      CTRTSP
095920940929     C                   MOVEL     WTSP          VIDTSP
095930940824     C     WEMFOR        IFEQ      '1'
095940940920     C                   GOTO      ENDC01
095950940824     C                   ENDIF
095960940823     C***
095970940823     C*** CODICE TRATTAMENTO MERCE ***
095980940824     C*
095990940824     C* SE CODICE BOLLA PREVEDE IL CODICE TRATTAMENTO MERCE QUESTO
096000940824     C* PREVALE SUL CODICE DELL'ANAGRAFICA E SU QUELLO DIGITATO
096010940824     C     §3ACTM        IFNE      *BLANKS
096020940929     C                   MOVEL     §3ACTM        WCTM
096030940824     C                   ELSE
096040940824     C* SE NON IMMESSO PRENDO VALORE DI DEFAULT
096050940824     C     VIDCTM        IFEQ      *BLANKS
096060940929     C                   MOVEL     COMCTM        WCTM
096070940929     C                   ELSE
096080940929     C                   MOVEL     VIDCTM        WCTM
096090940824     C                   ENDIF
096100940824     C                   ENDIF
096110940824     C*
096120940824     C* CONTROLLO
096130950504     C                   CLEAR                   W003A
096140940929     C                   MOVEL     WCTM          W003A
096150940824     C                   EXSR      CTRCTM
096160940929     C* SCRIVO IL CTM SOLO SE AVEVO DIGITATO UN '?'
096170941005     C* SE IMPOSTO QUELLO DI DFT NON LO FACCIO VEDERE A VIDEO
096180940929     C     '?'           SCAN      W003A                                  30
096190940929     C     *IN30         IFEQ      *ON
096200940824     C                   MOVEL     WCTM          VIDCTM
096210940929     C                   ENDIF
096220940824     C     WEMFOR        IFEQ      '1'
096230940920     C                   GOTO      ENDC01
096240940824     C                   ENDIF
096250121106
096260121106     c* Non posso utilizzare un CTM che mantiene in numero di spedizione
096270121106     c*  se = 0
096280121106     C   12
096290121106    1Can 15§1BFG3        IFEQ      'S'
096300121106     c     vidnsp        andeq     0
096310121106     C                   MOVEL     ERR(72)       VIDMSG
096320121106     c                   eval      %subst(vidmsg:20:2)=vidctm
096330121106     C                   SETON                                        4990
096340121106     C                   GOTO      ENDC01
096350121106    1C                   END
096360940824     C*
096370910828     C* SE FLAG6=M O C  OBBLIGATORIA LA LINEA DI ARRIVO
096380910828     C     §1BFG6        IFEQ      'M'
096390910828     C     §1BFG6        OREQ      'C'
096400921019     C     §1BFG8        ANDNE     'N'
096410940823     C*
096420910828     C     VIDLNA        IFEQ      *BLANKS
096430910828     C     VIDLNA        OREQ      *ZEROS
096440940823     C                   MOVEL     ERR(14)       VIDMSG
096450940923     C                   SETON                                        4790
096460940920     C                   GOTO      ENDC01
096470910828     C                   END
096480910828     C                   END
096490081107     c* controllo la congruenza fra codice bolla e il codice trattamento merce
096500081107     c                   exsr      ctrcbo_ctm
096510081107     C     *in90         IFEQ      '1'
096520081107     C                   GOTO      ENDC01
096530081107     C                   ENDIF
096540910828     C*
096550910828     C* PER DISK CLI CONTROLLO ESISTENZA DETTAGLIO SEGNACOLLI X FLG7=S
096560950718     C   15
096570950718     CAN 12§1BFG7        IFEQ      'S'
096580020917     C     KBLC          SETLL     FIVAD000                               30
096590940823     C     *IN30         IFEQ      *OFF
096600940823     C                   MOVEL     ERR(37)       VIDMSG
096610940923     C                   SETON                                        6290
096620940920     C                   GOTO      ENDC01
096630970107     C                   ENDIF
096640950717     C* SE SEGNACOLLI DA CLIENTE, CONTROLLO CHE NON CI SIANO SEGNACOLLI
096650950717     C*  RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
096660950719     C     §1BFG6        IFEQ      'C'
096670980325     C                   EXSR      VADDOP
096680950717     C   90              GOTO      ENDC01
096690940823     C                   ENDIF
096700950719     C                   ENDIF
096710040601     C* PER DISK CLI CONTROLLO ESISTENZA estensione stmpa ddt x FLG16=S
096720040601     C   15
096730040603    1CAN 12§1BF16        IFEQ      'S'
096740130301     c                   clear                   wvax
096750130301     c                   clear                   wvatp
096760130301     C     KBLC          SETLL     FIVAX000
096770130301    2c                   if        %equal(fivax01l)
096780130301     c                   eval      wvax='S'
096790130301    2c                   endif
096800130301     C                   MOVEL     'P'           WTRC
096810130301     C     Kvat          SETLL     FIVAt000
096820130301    2C                   if        %equal(fivat01l)
096830130313     c* cliente abilitato al pdf: memkorizzo presenza pdf
096840130313     c                   eval      wvatp='S'
096850130313     c* cliente non abilitato alla gestione del PDF:
096860130313     c* memorizzo per l'invio mail di alert
096870130313     c                   if        §clipdfp=*blanks
096880130313     c                   eval      wvatpe='S'
096890130313     c                   endif
096900130301    2c                   endif
096910130301    2c                   if        wvax=*blanks and wvatp=*blanks
096920040601     C                   MOVEL     ERR(279)      VIDMSG
096930040601     C                   SETON                                        6290
096940040601     C                   GOTO      ENDC01
096950130313     c                   else
096960130313     c* cliente non abilitato al PDF
096970130313     c                   if        wvatp='S' and §clipdfp=*blanks
096980130313     C                   MOVEL     ERR(349)      VIDMSG
096990130313     C                   SETON                                        4990
097000130313     C                   GOTO      ENDC01
097010130313     c                   endif
097020040603    2C                   ENDIF
097030130301   2ac                   if        wvax='S'
097040040603     c                   clear                   s_vaxprr
097050040603    2c                   do        *hival
097060061010     c     kblc          reade(N)  fivax000
097070040603    3c                   if        %eof(fivax01l)
097080040603     c                   leave
097090040603    3c                   endif
097100040603    3c                   if        vaxprr = s_vaxprr
097110040603     C                   MOVEL     ERR(280)      VIDMSG
097120040603     c                   seton                                        6290
097130040603     C                   GOTO      ENDC01
097140040603   x3c                   else
097150040603     c                   eval      s_vaxprr=vaxprr
097160040603    3c                   endif
097170040603    2c                   enddo
097180041210     c* controllo esistenza logo su tabella ar8
097190041210     C                   CLEAR                   DSBS02
097200041210     C                   MOVEL     'C'           T02MOD
097210041210     C                   MOVEL     KNSIF         T02SIF
097220041210     C                   MOVEL     'AR8'         T02COD
097230041210     C                   MOVEL(P)  vaxtmd        T02KE1
097240041210      *
097250041210     C                   CALL      'TIBS02R'
097260041210     C                   PARM                    KPJBA
097270041210     C                   PARM                    DSBS02
097280041210      *
097290041210     C     T02ERR        IFne      *BLANKS
097300041210     C                   MOVEL     ERR(290)      VIDMSG
097310041210     c                   eval      vidmsg = %trim(vidmsg) + ' "' + vaxtmd + '" '
097320041210     c                             + 'per stampa Lettera di vettura.AVVISARE IL'
097330041210     c                             + ' CED'
097340041210     c                   seton                                        90
097350041210     C                   GOTO      ENDC01
097360041210     c                   endif
097370130301   2ac                   endif
097380130305     c* controlli pdf: verifico che non sia doppio negli ultimi 30gg
097390130304     c                   if        wvatp='S'
097400130304     c                   exsr      pdfdop
097410130304     c                   if        *in90
097420130304     C                   goto      ENDC01
097430130304     c                   endif
097440130301     c                   endif
097450040603    1C                   ENDIF
097460050221     c
097470970904     C**
097480970904     C* IN MANUTENZIONE NON SI PUO' VARIARE COLLI PER DISK CLIENTI B
097490050429     C   12
097500050429     CANN15V1CNCL        IFNE      SAVNCL
097510050429     C     §1BFG6        andeq     'C'
097520050429     C     §1BFG2        ANDEQ     'S'
097530050429     C                   MOVEL     ERR(69)       VIDMSG
097540050429     C                   SETON                                        6290
097550050429     C                   GOTO      ENDC01
097560050429     C                   ENDIF
097570940823     C***
097580940823     C*** LINEA ARRIVO ***
097590910805     C* IN MANUTENZIONE NON POSSO VARIARE LA LINEA PER DISK CLIENTI B
097600100210     c*  ES 10/02/10 parlando con Luciano ci sembrava non corretto far
097610100210     c*     modificare la data anche in conferma. Per evitare errori
097620100210     c*     anche dovuti al fatto che per servizio  H non ci può essere incongru
097630100210     c*     enza, metto il messaggio anche per la conferma
097640100210     c
097650100210     C*  12
097660100210     C*NN15§1BFG6        IFEQ      'C'
097670100210
097680100210     C   12§1BFG6        IFEQ      'C'
097690940928     C     SAVLNA        ANDNE     VIDLNA
097700071220     c     §clidkb       andne     'S'
097710100210     c     savlna        andgt     *zeros
097720940823     C                   MOVEL     ERR(13)       VIDMSG
097730940923     C                   SETON                                        4790
097740940920     C                   GOTO      ENDC01
097750910805     C                   END
097760020320     c* Non posso variare la linea di arrivo anche in base a §1bf14
097770020320     c   12
097780020320     cANN15§1bf14        ifeq      'S'
097790020320     C     SAVLNA        ANDNE     VIDLNA
097800020320     C                   MOVEL     ERR(249)      VIDMSG
097810020320     C                   SETON                                        4790
097820020320     C                   GOTO      ENDC01
097830020320     C                   END
097840970414     C* SE BOLLA DIROTTATA POSSO VARIARLA SOLO SE NON HO TRASMESSO
097850970414     C*  il LEGAME BOLLA
097860970414     C   12
097870970414     CANN15SAVLNA        IFNE      VIDLNA
097880970414     C     KBLP3         CHAIN(N)  FNLBL000                           32
097890970724     C  N32LBLFT1        IFNE      ' '
097900970414     C     LBLFT2        ORNE      ' '
097910970414     C                   MOVEL     ERR(141)      VIDMSG
097920970414     C                   SETON                                        4790
097930970414     C                   GOTO      ENDC01
097940970414     C                   END
097950970724     C* SE C'E' LEGAME BOLLA NON POSSO METTERE  L.ARRIVO=L.PARTENZA
097960970724     C  N32              MOVEL     VIDLNP        W003A
097970970724     C  N32W003A         IFEQ      VIDLNA
097980970724     C                   MOVEL     ERR(83)       VIDMSG
097990970724     C                   SETON                                        4790
098000970724     C                   GOTO      ENDC01
098010970724     C                   END
098020970414     C                   END
098030940824     C*
098040940824     C                   MOVEL     VIDLNA        WLNA
098050110217     C                   EXSR      CTRLNA_vid
098060940824     C                   MOVEL     WLNA          VIDLNA
098070940824     C     WEMFOR        IFEQ      '1'
098080940920     C                   GOTO      ENDC01
098090940824     C                   ENDIF
098100060707     c*
098110060707     c* Non posso variare la lna passando da lna non dpd a lna dpd
098120060707     c   12
098130060707     cann15savlna        ifne      vidlna
098140060707     c     savaogntw     andne     A_§ogntw
098150060707     c     A_§ogntw      andeq     'DPD'
098160060707     C                   MOVEL     ERR(305)      VIDMSG
098170060707     C                   SETON                                        4790
098180060707     C                   GOTO      ENDC01
098190060707     c                   endif
098200071220     c* Disk "B" - non posso variare la linea se:
098210071220     c                   if        *in12 and not *in15  and
098220071220     c                             §1bfg6='C' and savlna<>vidlna
098230071220     c                   exsr      sr_chkabilna
098240071221     c                   if        *in90
098250071221     c                   goto      endc01
098260071221     c                   endif
098270061124     c*
098280071220     c                   endif
098290061124     C* PER DISK A CON VAT OPPURE PER DISK C EX DISK B  CONTROLLO
098300061124     C* ESISTENZA CODICI CHI SONO
098310061124     C* IDEM SE SONO IN MANTUENZIONE
098320061124     C     A_§OGNTW      IFEQ      'DPD'
098330061124     C     VIDDPD        OREQ      'D'
098340061124     C                   MOVEL     'S'           WEXDPD            1
098350061124     C                   ELSE
098360061124     C                   CLEAR                   WEXDPD
098370061124     C                   ENDIF
098380061124     C*
098390160226     c* Disk A con VAT non DPD
098400160226     c                   if        (§1bf12='E' and wexdpd<>'S' and *in79=*off)
098410160226     c                             or
098420160226     c* Disk A con VAT export dpd con numero parcel automatico
098430160226     c                             (§1bf12='E' and wexdpd='S' and §1bf13='A')
098440160226     c                             or
098450160226     c* Dsik C ex disk B
098460160226     c                             (§1bf12='B')
098470160226     c                             or
098480160226     c* Manutenzione: Disk C (di qualunque tipo) no DPD
098490160226     c                             (*in12 and *in15=*off and
098500160226     c                              §1bf12<>'N' and wexdpd<>'S' and not *in79)
098510160226     c                             or
098520160226     c* Manutenzione: Disk C (di qualunque tipo) export dpd
098530160226     c* Con parcel automatico o instradamento forzato a dpd con parcel autom
098540160226     c                             (*in12 and *in15=*off and
098550160226     c                              §1bf12<>'N' and wexdpd='S' and (
098560160226     c                              §1bf13='A' or w_adpd='S'))
098570070323     c*  Per bolla export dpd con parcel  lungo 12 bypasso questo con-
098580070323     c*  trollo che non funzionerebbe
098590061124      * se non ho superato i 500 colli
098600061124If  2c                   If        v1cncl <= 500
098610061124     C* CONTROLLO CHE NON CI SIANO SEGNACOLLI
098620061124     C*                         RIPETUTI ALL'INTERNO DELLA STESSA BOLLA
098630061124     C* CONTEGGIO ANCHE N° RECORD "CHI SONO" PERCHE' DEVE ESSERE = AL
098640061124     C* NUMERO DEI COLLI
098650061124     C* PASSO A ROUTINE UN FLAG PER SEGNALARE CHE E' RICHIAM.DA CTRD01
098660061124     C                   MOVEL     'C'           WC01FG            1
098670061124     C                   EXSR      CTRS08
098680061124     C   90              MOVEL     W08MSG        VIDMSG
098690061124     C   90              SETON                                        62
098700061124     C   90              GOTO      ENDC01
098710061124   x2c                   Else
098720061124     c                   Eval      VidMsg = Err(275)
098730061124     c                   Eval      *In90 = *On
098740061124     c                   Eval      *In62 = *On
098750061124     c                   GoTo      EndC01
098760061124    2c                   EndIf
098770061124     C                   ENDIF
098780061124     c* se sono in conferma bolle da disk di bolla dpd errore se
098790061124     c* il cliente mi ha passato più di un VAT
098800061124     c                   if        *in12 and *in15 and §1bf12 = 'E'
098810061124     c                             and werrvat = '1'  and
098820061124     c                             ((§1bf13 = *blanks and wexdpd = 'S')
098830061124     c                              or (*in79 = *on))
098840061124     c                   Eval      VidMsg = Err(291)
098850061124     c                   Eval      *In90 = *On
098860061124     c                   Eval      *In62 = *On
098870061124     c                   GoTo      EndC01
098880061124     c                   endif
098890960320     C*
098900960320     C* PER LNA 102 OBBLIGATORIO IL C/S
098910960320     C     COMLNA        IFEQ      102
098920960320     C     §3ARBL        ANDNE     'C'
098930960320     C                   SETON                                        4690
098940960320     C                   MOVEL     ERR(126)      VIDMSG
098950960320     C                   GOTO      ENDC01
098960960320    3C                   ENDIF
098970000609     C**
098980060109     C* PER BOLLA EXPORT DPD, NON POSSO ACCETTARE SOLUZIONI "B" se ctm
098990060109     c* che non prevede l'assegnazione automatica del "chi sono DPD"
099000000609     C   15
099010000609     CAN 12§1BFG6        IFEQ      'C'
099020000609     C     §1BFG2        ANDEQ     'S'
099030060109     c     §1bf13        andne     'A'
099040020319     C     A_§OGNTW      IFEQ      'DPD'
099050020204     C     VIDDPD        OREQ      'D'
099060060109     C                   MOVEL     ERR(296)      VIDMSG
099070000609     C                   SETON                                        6290
099080000609     C                   GOTO      ENDC01
099090000609     C                   ENDIF
099100000609     C                   ENDIF
099110061121     c*
099120080411     c* 11/04/2008: Asterisco i seguenti controlli perchè li ho spostat
099130080411     c* dentro la CTRIND
099140061121     C* VERIFICO SE P.O. EMITTENTE DPD o fed-ex
099150080411     c***                clear                   poentw
099160080411    2C***  FLGFIT        IFNE      'S'
099170080411     C***  ORMPOE        CHAIN     AZORG01L      UNIORG               30
099180080411     C***                MOVEL     OG143         SAV143
099190080411     C**N30              MOVEL     ORGDE3        OG143
099200080411     C** 30              CLEAR                   OG143
099210080411     c**                 eval      poentw=§ogntw
099220080411     C**                 MOVEL     SAV143        OG143
099230080411    2C***                ENDIF
099240010503     C* SE BOLLA EXPORT DPD IN PORTO ASSEGNATO DEVE ESSERE ASSOCIATA AD
099250010503     C* UN ORM REALE COMMISSIONATO DA UN P.O. DPD
099260020207     c* IDEM PER BOLLA FEDEX
099270010508     C* NON FACCIO QUESTO CONTROLLO SE PGM RICHIAMATO DA PGM GIACENZE
099280020527     c* o da ritiri annullati (savfpr="T")
099290080411    0c***  *in04         ifeq      *on
099300080411     c***                clear                   pofed             1
099310080411     c***                clear                   podpd             1
099320080411     C***                MOVEA     ERR(229)      K78
099330080411    1C***  A_§OGNTW      IFEQ      'DPD'
099340080411     C***  VIDDPD        OREQ      'D'
099350080411     c***                movel     '1'           podpd
099360080411     C***                MOVE      'DPD  '       W005A             5
099370080411     C***                MOVEA     W005A         K78(14)
099380080411     C***                MOVEA     W005A         K78(71)
099390080411     c***                endif
099400080411     c***  A_§ogntw      ifeq      'FED'
099410080411     c***  viddpd        oreq      'F'
099420080411     c***                movel     '1'           pofed
099430080411     C***                MOVE      'FedEx'       W005A             5
099440080411     C***                MOVEA     W005A         K78(14)
099450080411     C***                MOVEA     W005A         K78(71)
099460080411     c***                endif
099470040907     c*
099480080411     c***                clear                   wnocont
099490040907     c* Se provengo da manutenzione di bolla di reso lo memorizzo
099500040907     c* per non effettuare il controllo seguente
099510080411     c***  *in12         ifeq      *on
099520080411     c***  *in15         andeq     *off
099530080411     c***  vidfbr        andeq     'S'
099540080411     c***                move      'N'           wnocont           1
099550080411     c***                endif
099560020131     c
099570080411    1C**   podpd         IFEQ      '1'
099580080411     c**   pofed         oreq      '1'
099590080411   1AC**   SAVFPR        IFNE      'P'
099600080411     C*    SAVFPR        ANDNE     'G'
099610080411     C*    SAVFPR        ANDNE     'T'
099620080411     c*    wnocont       andeq     *blanks
099630080411    2C*    FLGFIT        IFEQ      'S'
099640080411     C*    poentw        ORNE      'DPD'
099650080411     c*    podpd         andeq     '1'
099660080411     C*    poentw        ORNE      'FED'
099670080411     c*    pofed         andeq     '1'
099680080411     C*                  MOVEA     K78           VIDMSG
099690080411     C*                  SETON                                        90
099700080411    3C*    WPERSO        IFEQ      'P'
099710080411     C*                  Z-ADD     05            H0RIGA
099720080411     C*                  Z-ADD     20            H0COLO
099730080411     C*                  ELSE
099740080411     C*                  Z-ADD     06            H1RIGA
099750080411     C*                  Z-ADD     20            H1COLO
099760080411    3C*                  ENDIF
099770080411     C*                  GOTO      ENDC01
099780080411    2C*                  ENDIF
099790080411   1AC*                  ENDIF
099800080411    1C*                  ENDIF
099810080411    0c*                  endif
099820940823     C***
099830940823     C*** DESTINATARIO  ***
099840001121      ***
099850001121      * ALLINEO A SX LA LOCALITA'
099860001121     C     VIDLOD        IFNE      *BLANKS
099870001121     C                   MOVEL     VIDLOD        W001A
099880001121     C     W001A         IFEQ      *BLANKS
099890001121     C                   MOVEA     VIDLOD        K35
099900001121     C     ' '           CHECK     VIDLOD        XX
099910001121     C                   CLEAR                   VIDLOD
099920001121     C                   MOVEA     K35(XX)       VIDLOD
099930001121     C                   ENDIF
099940001121     C                   ENDIF
099950130923     c* controllo dei caratteri
099960130923     c                   eval      wtxt=vidrsd
099970131003     c                   eval      uppercase = '1'
099980141202     c                   clear                   ElencoChar
099990160112     c                   clear                   TipoElenco
100000130923     c                   exsr      sr_chk
100010130923     c                   movel     wtxt          vidrsd
100020130923     c                   eval      wtxt=vidind
100030131003     c                   eval      uppercase = '1'
100040141202     c                   clear                   ElencoChar
100050160112     c                   clear                   TipoElenco
100060130923     c                   exsr      sr_chk
100070130923     c                   movel     wtxt          vidind
100080130923     c                   eval      wtxt=vidlod
100090131003     c                   eval      uppercase = '1'
100100141202     c                   clear                   ElencoChar
100110160112     c                   clear                   TipoElenco
100120130923     c                   exsr      sr_chk
100130160112     c* eseguo routine per eliminare caratteri non ammessi nella località come
100140160112     c* da tabella "CSP"
100150160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
100160160112     c                   clear                   uppercase
100170160112     c                   eval      ElencoChar=Charnook
100180160112     c                   eval      TipoElenco='1'
100190160112     c                   exsr      sr_chk
100200140207     c* eseguo routine per eliminare caratteri di punteggiatura precedenti e
100210140207     c* seguenti la località
100220140207     c                   exsr      chkstringa
100230140110     c                   movel     wtxt          vidlod
100240140113     c* segnalo errore se località contenente caratteri di punteggiatura
100250140113     c* a destra e/o a sinistra
100260140207     c***                if        vidlod<>*blanks
100270140207     c***                exsr      chkstringa
100280140207     c***                if        posl=0 or wtxt<>%subst(wtxt:posl:lung)
100290140207     C***                MOVEL     ERR(350)      VIDMSG
100300140207     C***                SETON                                        6690
100310140207     C***                GOTO      ENDC01
100320140207     c***                endif
100330140207     c***                endif
100340001121      *
100350970701     C                   MOVEL     VIDRSD        I14RSC
100360970701     C                   MOVE      VIDRSD        I14RS2
100370970701     C                   MOVEL     VIDIND        I14IND
100380970701     C                   MOVEL     VIDLOD        E14LOC
100390970701     C                   MOVEL     VIDPID        E14PIP
100400970701     C                   MOVEL     VIDPRD        E14PRV
100410970701     C                   MOVEL     VIDNZD        E14NAR
100420970701     C                   MOVEL     VIDCAD        E14CAP
100430970704     C                   MOVEL     'D'           WCLI              1
100440061121     c                   clear                   wcdf
100450970704     C                   EXSR      CTRIND
100460970702     C*
100470970702     C* IMPOSTO I CAMPI DI UNA EVENTUALE RICERCA
100480970704     C                   MOVEL     E14LOC        VIDLOD
100490970704     C                   MOVEL     E14CAP        VIDCAD
100500970704     C                   MOVEL     E14NAR        VIDNZD
100510970704     C                   MOVEL     E14PRV        VIDPRD
100520970702     C                   MOVEL     E14PIP        VIDPID
100530970704     C* ERRORE
100540970704     C     WEMFOR        IFEQ      '1'
100550970704     C     *IN90         OREQ      *ON
100560970704     C                   GOTO      ENDC01
100570970704     C                   ENDIF
100580160223     c*
100590160223     c* Se bolla export eex verifico se instradabile su DPD
100600160223     c*
100610160302     c                   if        not *in12 or *in15
100620160302     c                   clear                   w_adpd
100630160302     c                   if        viddpd=' ' and wdesie='E' and
100640160302     c                             (vidlna = *zeros or vidlna=*blanks)
100650160302     c                             and not *in44
100660160407     c                             and §lpfpr<>'O' and partch<>'P'
100670160407     c                             and §3arbl<>'R'
100680160226     c                             and not *in04
100690160223     c                   exsr      sr_instrADPD
100700160223     c                   endif
100710160223     c                   endif
100720160223
100730070808     c* Per TELLUS --> Indirizzo: deve essere di almeno 6 caratteri
100740090202     c* Ignoro l'errore se destinatario estero protetto
100750070808     c                   eval      w_vidind=%trim(vidind)
100760070827     c     ' '           checkr    w_vidind      num               2 0
100770090202     c                   if        num<6 and (wdesie<>'E' or atrdes<>prot)
100780070808     C                   SETON                                        90
100790070808     C                   Z-ADD     18            H1RIGA
100800070808     C                   Z-ADD     02            H1COLO
100810070808     C                   MOVEL     ERR(313)      VIDMSG
100820070808     C                   GOTO      ENDC01
100830070808     c                   endif
100840061121     c* Se destinatario estero e orm avente p.o. emittente DPD errore se
100850061121     c* il network non è dpd
100860061121     c                   if        wdesie='E' and flgfit<>'S'
100870061121     c                             and poentw='DPD' and viddpd<>'D'
100880061121     c                             and A_§ogntw<>'DPD'
100890061121     c                   seton                                        90
100900061121     c                   Eval      VidMsg = Err(309)
100910061121     c                   z-add     21            H1riga
100920061121     c                   z-add     10            H1colo
100930061121     c                   GoTo      EndC01
100940061121     c                   endif
100950160513     c* Se destinatario estero e orm avente p.o. emittente EEX errore se
100960160513     c* il network non è EEX
100970160513     c                   if        wdesie='E' and flgfit<>'S'
100980160513     c                             and poentw='EEX' and
100990160513     c                             (viddpd<>' ' or
101000160513     c                              (A_§ogntw<>*blanks and A_§ogntw<>'EEX'))
101010160513     c                   seton                                        90
101020160513     c                   Eval      VidMsg = Err(365)
101030160513     c                   if        viddpd<>' '
101040160513     c                   z-add     21            H1riga
101050160513     c                   z-add     10            H1colo
101060160513     c                   else
101070160513     c                   z-add     14            H1riga
101080160513     c                   z-add     55            H1colo
101090160513     c                   endif
101100160513     c                   GoTo      EndC01
101110160513     c                   endif
101120141202     c* Se presente PIN CODE lo controllo - SE sono in Conferma Bolle
101130141202
101140141202     c                   if        *in12 and *in15  and
101150141202     c                             wpincode<>*blanks
101160141202     c* se bolla export non lo controllo perchè per l'export non lo
101170141202     c* memorizziamo
101180141202     c                   if        (comlna>0 and
101190141202     c                              a_§ogntw<>'FED' and
101200141202     c                              a_§ogntw<>'EEX' and
101210141202     c                              a_§ogntw<>'DPD' ) or
101220141202     c                             (comlna = 0 and wdesie<>'E')
101230141202     c* errore se Pin Code ricevuto > di 15 caratteri
101240141202     c                   if        lenPC>15
101250141202     c                   Eval      *In90 = *On
101260141202     c                   Eval      vidmsg=err(355)
101270141202     c                   goto      endc01
101280141202     c                   endif
101290141202     c* verifico la presenza di caratteri non validi
101300141209     c* se presenti dati in tabella CSP record "PINCODE" altrimenti
101310141203     c* i caratteri sono tutti validi
101320141203     c                   if        charpcok<>*blanks
101330141202     c                   eval      wtxt=wpincode
101340141202     c                   clear                   uppercase
101350141202     c                   eval      ElencoChar=charPCok
101360160112     c                   clear                   TipoElenco
101370141202     c                   exsr      sr_chk
101380141202     c                   if        esito<>'0'
101390141202     c                   Eval      *In90 = *On
101400141202     c                   Eval      vidmsg=err(356)
101410141202     c                   goto      endc01
101420141202     c                   endif
101430141209     c                   endif
101440141209     c* verifico che non siano presenti dei blank dentro al pin code
101450141209     c                   if        %scan(' ':%subst(wpincode:1:lenpc))>0
101460141209     c                   Eval      *In90 = *On
101470141209     c                   Eval      vidmsg=err(356)
101480141209     c                   goto      endc01
101490141209     c                   endif
101500141202     c                   endif
101510141202     c                   endif
101520050214     c*
101530050214     c* SE DESTINATARIO ESTERO vedo se devo forzare il porto franco
101540050214     C* (si tratta delle stesse operazioni effettuate anche routine prp
101550050214     c* or1 che devono essere effettuate anche in questo momento
101560050214     c* se l'orm è multiplo per cui deve prima essere controllato il
101570060427     c* destinatario per sapere se è estero- Idem se orm singolo ma non è
101580060427     c* specificato il destinatario ORM)
101590060428if  1c****               If        (Not *In12 or Not *In15) and
101600060428     c****                         (ormtor = 'M' or ormrsc=*blanks  )  and
101610050214      * e l'ORM prevede:
101620060428      *****           --> la bolla in porto Assegnato
101630060428      *****           --> paga ordinante orm
101640060428      *****           --> destinatario estero
101650060428      *****           --> ordinante orm italia
101660060428     c*****                        (§OrPfb = 'A' and OrmPag = 'O' and
101670060428     c****                          wdesie = 'E' and OrmNao = *Blanks)
101680060428     c****               exsr      sr_FOrmEst
101690060428    1c****               EndIf
101700061124     c                   if        vidnzd<>savnzd
101710061124     c                   clear                   wfortbo
101720061124     c                   move      vidnzd        savnzd
101730061124     c                   endif
101740140423
101750050214     c                   exsr      CTRCBO_orm
101760050214     C     *in90         IFEQ      '1'
101770050214     c                   eval      wemfor = '1'
101780050214     C                   GOTO      ENDC01
101790050214     C                   ENDIF
101800061011     c
101810061011     c* Per bolla dpd con CAP errato richiamo in automatico int cappar
101820061011     c*  DPD
101830061011    1c                   if        CapparioDPD='S' or *inkb
101840061011     c* Se non è + dpd tolgo il flag
101850061011    2C     A_§OGNTW      IFEQ      'DPD'
101860061011     C     VIDDPD        OREQ      'D'
101870061011     C     WDESIE        ANDEQ     'E'
101880061011     c* Se modificato il CAP vado avanti senza l'interrogazione
101890061011    3c                   if        vidcad=savcapdpd   or *inkb
101900061011     c* Per l'interrogazione passo solo il cap fittizio
101910061011     C                   MOVEL     '15'          COD
101920061011     C                   MOVEL(P)  VIDNZD        KEY
101930061011     C                   EXSR      CTABEL
101940061011     C                   MOVEL     TBLUNI        DS15
101950061011     c                   movea     vidcad        cap
101960061011     C                   CLEAR                   CAF
101970061011     C                   MOVEA     CAP(§15pcf)   CAF(§15pcf)
101980061011     c     §15ecf        add       §15pcf        finefit           2 0
101990061011     c                   movea     *blanks       caf(finefit)
102000061011     c
102010061011     C                   CLEAR                   tisie8ds
102020061011     c                   z-add     blpdsp        isie8dri
102030061011     c                   movel     'D01'         isie8op0
102040061011     C                   MOVEL     vidnzd        isie8nar
102050061011     C                   MOVEa     caf           isie8cap
102060061011     C                   CALL      'TISIE8R'
102070061011     C                   PARM                    kpjba
102080061011     C                   PARM                    tisie8ds
102090061011     c*
102100061011     c* Se errore lo emetto
102110061011     c                   if        osie8err<>' '
102120061011     C                   MOVEL     osie8msg      VIDMSG
102130061011     C                   SETON                                        6590
102140061011     C                   GOTO      ENDC01
102150061011     c                   endif
102160061011     c
102170061011    4c                   if        osie8capb<>*blanks
102180061011     c                   movel     osie8capb     vidcad
102190061011     c                   clear                   cappariodpd
102200061011     c
102210061011     c* In manutenzione se cambiato CAP riemetto videata
102220061011     c* In immissione/conferma no tanto devo confermare la videata
102230061011     c*    x nazione estera
102240150825     c****               if        *in12 and not *in15
102250061011     c                   eval      wemfor='1'
102260150825    4c****               endif
102270061011     c
102280061011     c                   else
102290061011     c* se non selezionato riemetto videata
102300061011     c                   eval      wemfor='1'
102310061011    4c                   endif
102320061011    3c                   endif
102330061011     c
102340061011   x2c                   else
102350061011     c                   clear                   cappariodpd
102360150729     c                   eval      wemfor='1'
102370061011    2c                   endif
102380061011    1c                   endif
102390020530     c*
102400941020     C**
102410950303     C* SE DESTINATARIO ESTERO --> P.IVA OBBLIGATORIA
102420950525     C* SOLO SE PAESE EFTA
102430050427     c* e non è bolla di recupero
102440000905     C     WDESIE        IFEQ      'E'
102450950616     C     VIDPID        ANDEQ     *BLANKS
102460050427     c     §3arbl        andne     'R'
102470000321     C*
102480020319    2C     A_§OGNTW      IFEQ      'DPD'
102490000321     C     DESEFD        ANDNE     *BLANKS
102500000321     C*
102510020204     C     VIDDPD        OREQ      'D'
102520000321     C     DESEFD        ANDNE     *BLANKS
102530020131     c*
102540020213    2C     A_§OGntw      oreq      'FED'
102550020131     C     DESEFf        ANDNE     *BLANKS
102560020131     C*
102570020131     C     VIDDPD        OREQ      'F'
102580020131     C     DESEFf        ANDNE     *BLANKS
102590000321     C*
102600020319     C     A_§OGNTW      ORNE      'DPD'
102610020213     c     A_§ogntw      andne     'FED'
102620000321     C     VIDDPD        ANDEQ     ' '
102630000321     C     O14EFT        ANDNE     *BLANKS
102640950303     C                   MOVEL     '1'           WEMFOR
102650950303     C                   SETON                                        387090
102660950303     C                   MOVEL     ERR(88)       VIDMSG
102670950303     C                   GOTO      ENDC01
102680000321    2C                   ENDIF
102690000321    1C                   ENDIF
102700970528     C* NON POSSO USARE L'ESPRESSO PER BOLLE IMPORT/EXPORT
102710970528     C     VIDTSP        IFEQ      'E'
102720970528     C     WDESIE        IFEQ      'E'
102730100118     c**   §ogntw        oreq      'EEX'
102740100118     c**   §ogntw        oreq      'FED'
102750100118     c**   §ogntw        oreq      'DPD'
102760970528     C                   MOVEL     '1'           WEMFOR
102770970528     C                   SETON                                        487090
102780970528     C                   MOVEL     ERR(142)      VIDMSG
102790100118     c                   eval      %subst(vidmsg:47:10) = v1dtsp
102800090604     c                   eval      vidmsg = %trim(vidmsg) + '!!'
102810970528     C                   GOTO      ENDC01
102820970528    1C                   ENDIF
102830970528    1C                   ENDIF
102840020415     c* NON POSSO USARE CLIENTE 9999 PER PORTI ASSEGNATI EUROEXPRESS
102850020416     c* Lo posso usare solo se bolla associata a orm reale commissionato da
102860020416     c* un p.o. EEX
102870020416     C     SAVFPR        IFNE      'P'
102880020416     C     SAVFPR        ANDNE     'G'
102890020527     C     SAVFPR        ANDNE     'T'
102900020416     c     vidccm        andeq     9999
102910020415     c     wdesie        ifeq      'E'
102920020415     c     viddpd        andeq     *blanks
102930020415     c     comlna        andeq     *zeros
102940020415     c     A_§ogntw      oreq      'EEX'
102950020416     c                   clear                   wokccm            1
102960020416     C* Verifico se P.O. emittente "EEX"
102970020416    2C     FLGFIT        IFNE      'S'
102980020416     C     ORMPOE        CHAIN     AZORG01L      UNIORG               30
102990020416     C                   MOVEL     OG143         SAV143
103000020416     C  N30              MOVEL     ORGDE3        OG143
103010020416     C   30              CLEAR                   OG143
103020020416     c     §ogntw        ifeq      'EEX'
103030020416     c                   movel     'S'           wokccm
103040020416     c                   endif
103050020416     C                   MOVEL     sav143        og143
103060020416    2C                   ENDIF
103070020416     c     flgfit        ifeq      'S'
103080020416     c     wokccm        oreq      *blanks
103090020415     C                   MOVEL     ERR(253)      VIDMSG
103100020415     C                   SETON                                        9050
103110020415     c   90              goto      endc01
103120020416     c                   endif
103130020415     c                   endif
103140020415     c                   endif
103150970528     C* NON POSSO USARE TIPO BOLLA 5
103160970528     C     WDESIE        IFEQ      'E'
103170970528     C     VIDCBO        ANDEQ     '5 '
103180970528     C                   MOVEL     '1'           WEMFOR
103190970528     C                   SETON                                        467090
103200970528     C                   MOVEL     ERR(143)      VIDMSG
103210970528     C                   GOTO      ENDC01
103220970528    1C                   ENDIF
103230030707
103240030707      * Se non sto facendo una bolla di recupero
103250030707If  1c                   If        §3aRbl <> 'R'
103260991206      **
103270991206      * SE CAP ESTERO--> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ITALIA
103280020319      ***                TRANNE SE LINEA DPD
103290950525     C     WDESIE        IFEQ      'E'
103300950525     C     COMLNA        ANDGT     0
103310020319     c     A_§ogntw      ifeq      'COR'
103320020319     c     A_§ogntw      oreq      'MES'
103330020319     c     A_§ogntw      oreq      'PPT'
103340950525     C                   MOVEL     ERR(117)      VIDMSG
103350950525     C                   SETON                                        4790
103360950525     C                   GOTO      ENDC01
103370020319     c                   endif
103380950525     C                   ENDIF
103390950525     C*
103400991206      * SE CAP ITALIA -> NON AMMESSA FORZATURA DELLA LINEA ARRIVO ESTERO
103410020319     C***NEMMENO DPD
103420950525     C     WDESIE        IFEQ      'I'
103430971211     C     COMLNA        ANDGT     0
103440020319     c     A_§ogntw      ifeq      'EEX'
103450020319     c     A_§ogntw      oreq      'FED'
103460020319     c     A_§ogntw      oreq      'DPD'
103470950525     C                   MOVEL     ERR(118)      VIDMSG
103480950525     C                   SETON                                        4790
103490950525     C                   GOTO      ENDC01
103500950525     C                   ENDIF
103510000121     C                   ENDIF
103520030707    1c                   EndIf
103530000121      *
103540000121      * PER LNA DPD OBBLIGATORIO 1 COLLO
103550020319     C     A_§OGNTW      IFEQ      'DPD'
103560020204     C     VIDDPD        OREQ      'D'
103570000121     C     WDESIE        ANDEQ     'E'
103580000121     C     V1CNCL        IFNE      1
103590000121     C                   SETON                                        6290
103600000121     C                   MOVEL     ERR(179)      VIDMSG
103610000121     C                   GOTO      ENDC01
103620000121     C                   ENDIF
103630000121     C                   ENDIF
103640090429      * OBBLIGATORIETA' DI un collo anche per orm commissionato da dpd
103650151002     c                   if        flgfit<>'S' and poentw='DPD' and v1cncl<>1
103660090429     C                   SETON                                        6290
103670090429     C                   MOVEL     ERR(323)      VIDMSG
103680090429     C                   GOTO      ENDC01
103690090429     c                   endif
103700000121      * PER LNA O LNP DPD Massimo peso inseribile da tabella
103710020319     C  N12A_§OGNTW      IFEQ      'DPD'
103720020319     C     §OGNTW        OREQ      'DPD'
103730020204     C     VIDDPD        OREQ      'D'
103740000121     C     WDESIE        ANDEQ     'E'
103750000121     C     VIDPKG        IFGT      §3IPKD
103760000121     C                   SETON                                        6390
103770000121     C                   MOVEA     ERR(180)      K78
103780000121     C                   MOVEL     §3IPKD        W006A             6
103790000121     C                   MOVEA     W006A         SKI(10)
103800000121     C                   Z-ADD     10            I                 3 0
103810000121     C                   EXSR      ABBL
103820000121     C                   MOVEA     SKI(10)       K78(53)
103830000121     C                   MOVE      §3IPKD        W001A
103840000121     C                   MOVEL     W001A         K78(60)
103850000121     C                   MOVEA     K78           VIDMSG
103860000121     C                   GOTO      ENDC01
103870000121     C                   ENDIF
103880000121     C                   ENDIF
103890020201     c* per servizio dpd non accettato tipo bolla con C/A  - IDEM per FED-EX
103900080414     c*    viddpd        ifeq      'D'
103910080414     c*    A_§ogntw      oreq      'DPD'
103920080414     c*                  eval      w006a = 'DPD   '
103930080414     c*                  else
103940080414     c*    viddpd        ifeq      'F'
103950080414     c*    A_§ogntw      oreq      'FED'
103960080414     c*                  eval      w006a = 'FedEx '
103970080414     c*                  else
103980080414     c*                  if        wdesie='E'
103990080414     c*                  eval      w006a = 'EUROEX'
104000080414     c*                  endif
104010080414     c*                  endif
104020080414     c*                  endif
104030061030     c
104040061030     c* Controllo se ammesso C/A per estero in base ai vari network
104050080414     c****               setoff                                       90
104060080414     c*****              select
104070080414     C***  VIDDPD        wheneq    'D'
104080080414     C**** WDESIE        ANDEQ     'E'
104090061030     c*
104100080414     C***  A_§OGNTW      OREQ      'DPD'
104110080414     c***                if        descadpd=' '  and §3afca<>0
104120080414     c****               seton                                        90
104130080414     c****               endif
104140061030     c
104150080414     C***  VIDDPD        wheneq    'F'
104160080414     C***  WDESIE        ANDEQ     'E'
104170061030     c
104180080414     C***  A_§OGntw      OREQ      'FED'
104190080414     c****               if        descafed=' '  and §3afca<>0
104200080414     c***                seton                                        90
104210080414     c****               endif
104220080414     c***                other
104230080414     c****               if        wdesie='E' and
104240080414     c****                         descaeex=' '  and §3afca<>0
104250080414     c****               seton                                        90
104260080414     c****               endif
104270080414     c***                endsl
104280061030     c
104290080414     C***                IF        *in90
104300080414     c***                movea     err(187)      k78
104310080414     c***                movea     w006a         k78(13)
104320080414     C***                MOVEa     k78           VIDMSG
104330080414     C***                SETON                                        4690
104340080414     C***                GOTO      ENDC01
104350080414     C***                ENDIF
104360061030     c*
104370030221     c* Per bolle export fedex non è ammesso l'inserimento di C/Servizio
104380030221     c     viddpd        ifeq      'F'
104390030221     c     A_§ogntw      oreq      'FED'
104400030221     c     §3arbl        ifeq      'C'
104410020228     C                   MOVEL     ERR(245)      VIDMSG
104420020228     C                   SETON                                        4690
104430020228     C                   GOTO      ENDC01
104440030221     c                   endif
104450020228     c                   endif
104460060613     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
104470060613     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
104480060613     C     *IN79         IFEQ      *ON
104490060613     C     VIDDPD        ANDne     'D'
104500060613     C     A_§OGNTW      ANDNE     'DPD'
104510060613     C     WDESIE        ANDEQ     'E'
104520060613     C                   SETOFF                                       79
104530060613     C                   ENDIF
104540000120     c* Numero dpd
104550000120     c*  INSERIBILE SOLTANTO SE RICHIESTO IL SERVIZIO O LNA ESTERA DPD
104560060612     c*  o se import dpd
104570000120     C  N12
104580060612    1COR 15VIDNRD        IFne      *blanks
104590060613   1ac     *in79         ifeq      *off
104600000120    2C     COMLNA        IFEQ      0
104610000120     C     VIDDPD        ANDEQ     ' '
104620020201    2C     COMLNA        oreq      0
104630020201     C     VIDDPD        andeq     'F'
104640000121    2C     COMLNA        ORGT      0
104650020319     C     A_§OGNTW      ANDNE     'DPD'
104660060921     c
104670000120     C     DESLAD        OREQ      0
104680060921     c     desred        andeq     ' '
104690060921     c
104700060921     C     DESLAD        OREQ      0
104710060921     c     desred        andeq     'S'
104720060921     c     vidfbr        andne     'S'
104730000120     C                   MOVEL     ERR(184)      VIDMSG
104740000120     C                   SETON                                        4790
104750000120     C                   GOTO      ENDC01
104760000120    2C                   ENDIF
104770060612     c
104780000120     C* NON INSERIBILE SE NON ACCETTATTO DAL CTM
104790000120    2C     §1BF13        IFEQ      'A'
104800000120     C                   MOVEL     ERR(185)      VIDMSG
104810000120     C                   SETON                                        5790
104820000120     C                   GOTO      ENDC01
104830000120    2C                   ENDIF
104840060612   1aC                   ENDIF
104850000120     C* SE INSERITO, e no bolla reupero,  CONTROLLO IL CHK DIGITS
104860000308    2C     §3ARBL        IFNE      'R'
104870060612     C                   movel     VIDNRD        WNPR
104880000124     C                   EXSR      DPDVAL
104890000124     C   90              SETON                                        57
104900000124     C   90              GOTO      ENDC01
104910060613     c* per import effettuo subito il controllo per parcel doppio
104920060613     c                   if        *in79='1' and §1bfg8='S'
104930060613     c                   exsr      dpddop_imp
104940060613     C   90              SETON                                        57
104950060613     C   90              GOTO      ENDC01
104960060613     c                   endif
104970070326     c* per export imposto campo wparcel
104980070326     c                   if        *in79='0' and %subst(wnpr:14:1)=*blanks
104990070326     c                             and vidfbr<>'S'
105000070326     c                   eval      wparcel='12'
105010080612     c* in questo caso devo anche controllare che il chi sono inserito non
105020080612     c* sia doppio su fisgn
105030080612     c                   clear                   w8hcol
105040080612     c                   movel     wnpr          w8cnot
105050080612     c                   clear                   w08msg
105060080612     c                   eval      wnopos='1'
105070080612     c                   exsr      ctrchidop
105080080612     C                   MOVEL     w08msg        VIDMSG
105090080612     C   90              SETON                                        57
105100080612     C   90              GOTO      ENDC01
105110070326     c                   endif
105120060613     c
105130000120    2C                   ENDIF
105140000120     C*
105150000120   X1C                   ELSE
105160000120     C*
105170060613     c     *in79         ifeq      *on
105180060612     C     §3ARBL        ANDNE     'R'
105190060612     C                   MOVEL     ERR(186)      VIDMSG
105200060612     C                   SETON                                        5790
105210060612     C                   GOTO      ENDC01
105220060612     c                   endif
105230060612    2C     §1BF13        ifne      'A'
105240000308     C     §3ARBL        ANDNE     'R'
105250000121     C     WDESIE        ANDEQ     'E'
105260020204    3C     VIDDPD        IFEQ      'D'
105270020319     C     A_§OGNTW      OREQ      'DPD'
105280000120     C                   MOVEL     ERR(186)      VIDMSG
105290000120     C                   SETON                                        5790
105300000120     C                   GOTO      ENDC01
105310000120    3C                   ENDIF
105320000120    2C                   ENDIF
105330000120    1C                   ENDIF
105340960213     C***
105350960213     C*** FERMO DEPOSITO ERRATO
105360960213     C     VIDFFD        IFNE      'S'
105370010214     C     VIDFFD        ANDNE     'N'
105380010220     C     VIDFFD        ANDNE     ' '
105390960213     C                   MOVEL     ERR(123)      VIDMSG
105400960213     C                   SETON                                        5290
105410960213     C                   GOTO      ENDC01
105420960213     C                   ENDIF
105430940916     C***
105440940916     C*** FLAG INOLTRO: SE IMPOSTATO FORZARE CON CMD6
105450940909     C  NKF
105460940909     CANN15
105470940909     CAN 12
105480940909     CORNKF
105490940909     CANN12VIDFIN        IFNE      ' '
105500940907     C                   MOVEL     ERR(44)       VIDMSG
105510940923     C                   SETON                                        6990
105520940920     C                   GOTO      ENDC01
105530940909     C                   ENDIF
105540110818     c***
105550110901     c*** valore per accorpamento spedizioni in consegna:
105560110818     c*** errore bloccante se il cliente ha passato un valore non previsto
105570110818     c*   in tabella "xco"
105580110901     c***                if        *in12 and *in15 and werrxco=*on
105590110901     C***                SETON                                        90
105600110901     c***                eval      vidmsg=err(343)
105610110901     C***                GOTO      ENDC01
105620110901     c***                endif
105630110818     c*
105640031121      * Obbligatori se spedizione per supermercato
105650040213if  1c**!!!              If        wdisag = 'S'
105660040213if  2c**!!!              If        VidRef = *Blanks
105670040213     c**!!!              Eval      VidMsg = Err(267)
105680040213     c**!!!              z-add     20            H1riga
105690040213     c**!!!              z-add     21            H1colo
105700040213     c**!!!              Eval      *In90 = *On
105710040213     c**!!!              Eval      wemfor = '1'
105720040213     c**!!!              GoTo      EndC01
105730040213    2c**!!!              EndIf
105740040213if  2c**!!!              If        VidTel = *Blanks
105750040213     c**!!!              Eval      VidMsg = Err(267)
105760040213     c**!!!              z-add     20            H1riga
105770040213     c**!!!              z-add     64            H1colo
105780040213     c**!!!              Eval      *In90 = *On
105790040213     c**!!!              Eval      wemfor = '1'
105800040213     c**!!!              GoTo      EndC01
105810040213    2c**!!!              EndIf
105820040213    1c**!!!              EndIf
105830941003     C*
105840941003     C* IMPOSTO LA LOCALITA' DEL DESTINATARIO IN 2 VIDEATA
105850941003     C                   MOVEL     VIDLOD        V2CLOD
105860950123     C                   MOVEL     VIDRSD        V2CRSD
105870910125     C****
105880020917     C* CONTO QUANTI COLLI E QUANTI RECORD HO IN Fivad:
105890040618    1C***12§1BFG7        IFEQ      'S'
105900040618     c* in conferma
105910040618    1c                   if        (*in12 = *on and *in15 = *on
105920040618     c                             and §1bfg7 = 'S' and §1bf12 <> 'B')
105930040618     c* in manutenzione
105940040618     c                             or (*in12 = *on and *in15 = *off
105950040618     c                             and §1bfg7 = 'S')
105960940909     C  N15KBLP3         SETLL     FNBLD000
105970020917     C   15KBLC          SETLL     FIVAD000
105980940908     C* CONT  = NUMERO RECORD
105990910125     C                   Z-ADD     0             CONT
106000940908     C* CONT2 = NUMERO COLLI
106010910128     C                   Z-ADD     0             CONT2
106020940908     C*
106030940909     C  N15KBLP3         READE(N)  FNBLD000                               31
106040020917     C   15KBLC          READE(N)  FIVAD000                               31
106050950220     C*
106060950220    2C     *IN31         DOWEQ     *OFF
106070950220     C                   ADD       1             CONT              3 0
106080950220     C                   ADD       BLDNCL        CONT2             6 0
106090950220     C*
106100950220     C* SE E' DA DISK CLIENTI VEDO SE IL COLLO E' > 0
106110950220     C     *IN15         IFEQ      *ON
106120980410     C     §1BFG6        ANDEQ     'C'
106130950220     C     BLDNCD        ANDEQ     0
106140950220     C                   MOVEL     ERR(85)       VIDMSG
106150950220     C                   SETON                                        629031
106160950220    3C                   ENDIF
106170010313     C* SE E' DA DISK CLIENTI CONTROLLO CHE IL NUMERO COLLI SIA
106180010313     C* CORRETTO RISPETTO AL RANGE DAL/AL PASSATO
106190010313    3C     *IN15         IFEQ      *ON
106200010313     C     §1BFG6        ANDEQ     'C'
106210010313     C* CONTO IL NUMERO COLLI NEL RANGE DAL/AL
106220010313    4C     BLDNCA        IFEQ      *ZEROS
106230010313     C     BLDNCA        OREQ      BLDNCD
106240010313     C                   Z-ADD     1             WNCOL
106250010313   X4C                   ELSE
106260010313     C                   Z-ADD     BLDNCD        WNCOA
106270010313     C                   CLEAR                   WNCOL
106280010313    5C     WNCOA         DOWLE     BLDNCA
106290010313     C                   ADD       1             WNCOL
106300010313     C                   ADD       1             WNCOA
106310010313    5C                   ENDDO
106320010313    4C                   ENDIF
106330010313    4C     WNCOL         IFNE      BLDNCL
106340010313     C                   MOVEL     ERR(227)      VIDMSG
106350010313     C                   SETON                                        629031
106360010313    4C                   ENDIF
106370010313    3C                   ENDIF
106380950220     C*
106390950220     C  N15
106400950220     CANN31KBLP3         READE(N)  FNBLD000                               31
106410950220     C   15
106420020917     CANN31KBLC          READE(N)  FIVAD000                               31
106430940909    2C                   ENDDO
106440950220     C*
106450950220     C   90              GOTO      ENDC01
106460940908     C*
106470910225     C* SE NUMERO SEGNACOLLI DEL DETTAGLIO BOLLE NON E' UGUALE
106480910225     C*   AL NUMERO INDICATO SULLA BOLLA
106490050113     C     CONT2         ifne      V1CNCL
106500940908     C*
106510910225     C* IN DISK CLIENTI SEMPRE ERRORE
106520940909    3C     *IN15         IFEQ      *ON
106530940908     C* IN MANUTENZIONE BOLLE SOLO SE + DI UN RECORD
106540940908     C     *IN15         OREQ      *OFF
106550940908     C     CONT          ANDGT     1
106560940908     C                   MOVEL     ERR(87)       VIDMSG
106570940923     C                   SETON                                        6290
106580940920     C                   GOTO      ENDC01
106590940909    3C                   ENDIF
106600910225     C*
106610940909    2C                   ENDIF
106620910128     C*
106630940909    1C                   END
106640000413     C**
106650000413     C* SE SI TRATTA DI LNP DPD DIRETTA ALL'ESTERO
106660000413     C*  IGNORO I CONTROLLI DEL PARCEL NEL RIF MITTENTE E RIF.ALFA
106670060613     c*  13/06/06 - Sposto questi controlli prima dei controlli su vidnrd
106680060613     C**   *IN79         IFEQ      *ON
106690060613     C**   VIDDPD        ANDne     'D'
106700060613     C***  A_§OGNTW      ANDNE     'DPD'
106710060613     C***  WDESIE        ANDEQ     'E'
106720060613     C***                SETOFF                                       79
106730060613     C***                ENDIF
106740940909     C*
106750160216     c* richiamo trul27r1 per sapere che cosa devo passare in FIE a fnlv59r
106760160216     c                   Clear                   Trul27Ds1
106770021120     c                   Exsr      TarCar
106780021120     c                   If        *In90
106790021120     c                   GoTo      EndC01
106800021120     c                   EndIf
106810080327     c
106820080327     c* Se tipo servizio tariffa <> da fnvab in conferma bolle, errore
106830080327     c*   se non utilizzabile in bollettazione
106840080327     c                   if        *in12 and *in15 and NOutiTSP='N'
106850080327     c                             and tamtsp<>vidtsp
106860080327     C                   MOVEL     ERR(130)      VIDMSG
106870080327     C                   SETON                                        4890
106880080327     C                   GOTO      ENDC01
106890080327     c                   endif
106900090609     c* controllo i limiti di colli e peso
106910090609     c
106920090609     c                   z-add     v1cncl        wncl
106930090609     c  n12              z-add     vidpkg        wpes
106940090609     c   12              clear                   wpes
106950090609     c                   clear                   wvol
106960090609     c                   eval      wvid='1'
106970160224     c                   exsr      sr_limtsp
106980090609     c                   if        *in90
106990090609     C                   MOVEL     wmsgtsp       VIDMSG
107000090609     C                   GOTO      ENDC01
107010090609     c                   endif
107020041011     c*
107030041011     c* Verifico se destinatario disagiato
107040041011     c* Per bolle poste non faccio niente
107050091210     c                   clear                   wdisag
107060091210     c  n12              clear                   w_ar5tcp
107070091210     c                   clear                   ddstflo
107080041012    1c     §ogntw        ifne      'PPT'
107090091210     c
107100091210     c                   clear                   tisit0ds
107110091210     c                   clear                   tisit0x1ds
107120091210     c                   movel     'E'           it0tla
107130091210     c                   movel     vidnzd        it0naz
107140091210     c                   movel     vidprd        it0prv
107150091210     c                   movel     vidcad        it0cap
107160091210     c                   movel     vidlod        it0loc
107170091210     c                   movel     vidind        it0ind
107180091210     c                   movel     vidrsd        it0rag
107190091210     c                   call      'TISIT5R'
107200091210     c                   parm                    tisit0ds
107210091210     c                   parm                    tisit0x1ds
107220041012    2c     ot0err        ifeq      *blanks
107230060113     c                   movel     ot0flo        ddstflo
107240060102   2ac                   if        ot0dos = 'A' or ot0dos = 'D' or
107250060102     c                             ot0dos = 'S'
107260041011     c                   movel     ot0dos        wdisag
107270041012    3c     wdisag        ifeq      'D'
107280041011     c                   movel     'X'           wdisag
107290041012    3c                   endif
107300060102   2ac                   endif
107310041011     c                   Eval      savdisag = wdisag
107320070924     c                   Eval      savpart = 'S'
107330041012   x2c                   else
107340041011     c                   clear                   wdisag
107350041012    2c                   endif
107360041012     c                   exsr      sr_imptc12
107370070924     c* propongo eventuali gg. di chiusura se previsti nei dest.particolari
107380070924     c                   exsr      sr_impgc12
107390041012    1c                   endif
107400040608     c*
107410040608      * --> Referente e Telefono del destinatario
107420040608      *     (messaggio forzabile)
107430150213      * Solo in immissione
107440150213    0c                   If        not *in12
107450040608      * Da indicare se
107460091209      * - Spedizione FedEx
107470040608      * - Spedizione a Privati
107480040608      * - Spedizione con Appuntamento
107490040608      * - Spedizione Export in c/assegno o in porto assegnato
107500040608      * -> Referente solo sped. Export
107510040608if  1c                   If        VidRef = *Blanks and wforza1 = *Off and
107520040608     c                             ((comlna > *Zeros and
107530040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
107540040608     c                             (comlna = *Zeros and wdesie = 'E'))
107550040608if  2c                   If        §3aFca > *Zeros
107560040608     c                   Eval      VidMsg = Err(36)
107570040608     c                   Eval      *In90 = *On
107580040608    2c                   EndIf
107590040608if  2c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
107600040608     c                   Eval      VidMsg = Err(54)
107610040608     c                   Eval      *In90 = *On
107620040608    2c                   EndIf
107630040608if  2c                   If        *In90
107640040608     c                   z-add     20            H1riga
107650040608     c                   z-add     21            H1colo
107660040608     c                   Eval      wforza1 = *On
107670040608     c                   GoTo      EndC01
107680040608    2c                   EndIf
107690040608    1c                   EndIf
107700040608      * -> Telefono
107710040608if  1c                   If        VidTel = *Blanks and wforza1 = *Off
107720040608s   2c                   Select
107730040608     c                   When      a_§OgNtw = 'FED' or viddpd = 'F'
107740040608     c                   Eval      VidMsg = Err(56)
107750040608     c                   Eval      *In90 = *On
107760040608     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
107770040608     c                   Eval      VidMsg = Err(267)
107780040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
107790040608     c                   Eval      *In90 = *On
107800040608     c                   When      %subst(VidGva:1:1) = 'P'
107810040608     c                   Eval      VidMsg = Err(58)
107820040608     c                   Eval      %subst(VidMsg:62:15) = 'ENTER X FORZARE'
107830040608     c                   Eval      *In90 = *On
107840040608     c                   When      (comlna > *Zeros and
107850040608     c                             (a_§OgNtw = 'EEX' or a_§OgNtw = 'DPD')) or
107860040608     c                             (comlna = *Zeros and wdesie = 'E')
107870040608if  3c                   If        §3aFca > *Zeros
107880040608     c                   Eval      VidMsg = Err(36)
107890040608     c                   Eval      *In90 = *On
107900040608    3c                   EndIf
107910040608if  3c                   If        flgtb1 = 'A' or §3aTb2 <> *Blanks
107920040608     c                   Eval      VidMsg = Err(54)
107930040608     c                   Eval      *In90 = *On
107940040608    3c                   EndIf
107950040608    2c                   EndSl
107960040608if  2c                   If        *In90
107970040608     c                   z-add     20            H1riga
107980040608     c                   z-add     64            H1colo
107990040608     c                   Eval      wforza1 = *On
108000040608     c                   GoTo      EndC01
108010040608    2c                   EndIf
108020040608    1c                   EndIf
108030150213    0c                   EndIf
108040910220     C*
108050910220     C* VEDO SE SPROTEGGERE LA SERIE
108060950103     C*
108070950103     C     *IN12         IFEQ      *OFF
108080950103     C                   CLEAR                   VIDNRS
108090950103     C                   ENDIF
108100930624     C* PER DISK CLIENTI
108110940930    1C     *IN12         IFEQ      *ON
108120930624     C     *IN15         ANDEQ     *ON
108130930624     C* PER SPEDIZIONI DI RECUPERO
108140930624     C     *IN12         OREQ      *OFF
108150930624     C     *IN98         ANDEQ     *ON
108160930624     C* PER SPEDIZIONI DI CLIENTI CHE SI ASSEGNANO SOLO I NUMERI SEGNAC
108170930624     C     *IN12         OREQ      *OFF
108180980410     C     §1BFG6        ANDEQ     'C'
108190930624     C     §1BFG2        ANDEQ     'N'
108200930803     C* PER CLIENTI CON SERIE
108210930803     C     *IN12         OREQ      *ON
108220930803     C     *IN15         ANDEQ     *OFF
108230930803     C     VIDNRS        ANDGT     0
108240000225     C* PER CLIENTI DISK "C"
108250000225     C     *IN12         OREQ      *ON
108260000225     C     *IN15         ANDEQ     *OFF
108270000225     C     VIDSOP        ANDEQ     ':'
108280930624     C*
108290000911     C                   CLEAR                   DS3C
108300910311     C                   MOVEL     'N'           §3CFG1
108310921012     C                   MOVEL     ' '           §3CFSP
108320910220     C                   MOVEL     '3C'          COD
108330940921     C                   MOVEL(P)  WKSC          KEY
108340910220     C*
108350930708     C                   EXSR      CTABEL
108360910301     C  N30              MOVEL     TBLUNI        DS3C
108370100517     C* SE IL TERMINAL NON HA ANCHILOSATO, NON LO HA NEMMENO IL CLIENT
108380000204     C     WASDKC        IFNE      'S'
108390000204     C                   CLEAR                   §3CDKC
108400000204     C                   ENDIF
108410921006     C*
108420980805   1AC     *IN30         IFEQ      *OFF
108430980805     C     §3COKD        ANDEQ     '*'
108440980805    2C     *IN12         IFEQ      *OFF
108450921006     C     *IN98         ANDEQ     '1'
108460921006     C                   SETON                                        95
108470921006     C                   MOVEL     §3CNRS        VIDNRS
108480921006     C*
108490940930   X2C                   ELSE
108500921006     C*
108510940930    3C     §3CFG1        IFEQ      'S'
108520910220     C                   SETON                                        95
108530910426     C* SE FLAG6 DEL CLIENTE PROPONGO GIA' LA SERIE
108540940930    4C     §1BFG6        IFEQ      'C'
108550921006     C     VIDNRS        ANDEQ     0
108560910426     C                   MOVEL     §3CNRS        VIDNRS
108570940930    4C                   END
108580910426     C*
108590940930    3C                   END
108600940930    2C                   END
108610980805   1AC                   END
108620980805    1C                   END
108630940930     C*
108640080313      * verifico se cliente ha serie parziale
108650100517     c******             exsr      sr_parz
108660940930     C* PER DISK CLI TENGO QUELLO PASSATO SOLO SE :
108670940930     C*  ABILITATO DA DS DEL CLIENTE
108680940930     C*  ABILITATO IL COD TASSAZIONE ALLA FORZATURA
108690120712     c* ES 12/07/12 --> tolto non più usata da tempo questa forzatura
108700120712     C** 12
108710120712     C*N 15§3CFCT        IFEQ      'S'
108720120712     C**                 MOVEL     'CT'          COD
108730120712     C**                 MOVEL(P)  §LPCTS        KEY
108740940930     C*
108750120712     C**                 EXSR      CTABEL
108760120712     C**N30              MOVEL     TBLUNI        DSCT
108770120712     C**N30§CTFDK        IFEQ      'S'
108780120712     C**                 MOVEL     §LPCTS        SAVCTS
108790120712     C**                 ENDIF
108800120712     C**                 ENDIF
108810910805     C*
108820910805     C* PER DISK CLI SE FLAG 6 NON E' "C" AZZERO LA SERIE
108830910805     C   12
108840910805     CAN 15§1BFG6        IFNE      'C'
108850921019     C     §1BFG8        ANDNE     'N'
108860910805     C                   Z-ADD     0             VIDNRS
108870910805     C                   END
108880940930     C*
108890910410     C* PULIZIA CAMPI NUMERO SEGNACOLLI SE IMMISSIONE E STAMPA SEGNAC
108900910410     C* NELL'ORGANIZZAZIONE
108910910410     C  N12
108920910410     CAN 25              Z-ADD     0             VIDNCD
108930910410     C  N12
108940910410     CAN 25              Z-ADD     0             VIDNCA
108950910606     C* PER DISK CLI AZZERO SOLO SE NON SI ASSEGNA I NUMERI SEGNACOLLI
108960980410     C   12
108970980410     CAN 25
108980980410     CAN 15§1BFG6        IFNE      'C'
108990910606     C                   Z-ADD     0             VIDNCD
109000910606     C                   Z-ADD     0             VIDNCA
109010910607     C                   END
109020910808     C  N12
109030910808     COR 12
109040910808     CAN 15              MOVEL     *BLANKS       VIDFNS
109050910805     C* CONTROLLO SE NON SEQUENZIALI
109060960805     C   12
109070960805    1CAN 15§1BFG7        IFEQ      'S'
109080980410     C     §1BFG6        ANDEQ     'C'
109090920917     C*
109100020917     C     KBLC          SETLL     FIVAD000
109110020917     C     KBLC          READE(N)  FIVAD000                               30
109120960805    3C  N30BLDNCA        IFNE      0
109130941230     C                   Z-ADD     BLDNCA        COMSCD
109140920917     C                   ELSE
109150941230     C                   Z-ADD     BLDNCD        COMSCD
109160960805    3C                   ENDIF
109170941230     C                   Z-ADD     BLDNCD        VIDNCD
109180941230     C                   SUB       BLDNCL        COMSCD
109190910805     C*
109200960805    3C     *IN30         DOWEQ     *OFF
109210941230     C                   ADD       BLDNCL        COMSCD
109220960805    4C     BLDNCA        IFNE      0
109230960805    5C     COMSCD        IFNE      BLDNCA
109240920917     C                   SETON                                        30
109250960805    5C                   ENDIF
109260920917     C*
109270960805   X4C                   ELSE
109280920917     C*
109290960805    5C     COMSCD        IFNE      BLDNCD
109300910805     C                   SETON                                        30
109310960805    5C                   ENDIF
109320960805    4C                   ENDIF
109330920917     C*
109340920917     C   30              MOVEL     'S'           VIDFNS
109350020917     C  N30KBLC          READE(N)  FIVAD000                               30
109360960805    3C                   ENDDO
109370920917     C* NON SEQ.: AZZERO
109380960805    3C     VIDFNS        IFEQ      'S'
109390910805     C                   Z-ADD     0             VIDNCD
109400910805     C                   Z-ADD     0             VIDNCA
109410920917     C*
109420960805   X3C                   ELSE
109430920917     C* SEQ : IMPOSTO SEGNACOLLO AL
109440960805    4C     V1CNCL        IFGT      1
109450960805    5C     BLDNCA        IFNE      0
109460941230     C                   Z-ADD     BLDNCA        VIDNCA
109470960805   X5C                   ELSE
109480941230     C                   Z-ADD     BLDNCD        VIDNCA
109490960805    5C                   ENDIF
109500960805    4C                   ENDIF
109510960805    3C                   ENDIF
109520960805     C* MI SALVO I SEGNACOLLI DAL / AL CHE NON POSSONO ESSERE MODIFICAT
109530960805     C                   Z-ADD     VIDNCD        WNSNCD
109540960805     C                   Z-ADD     VIDNCA        WNSNCA
109550910805     C*
109560960805    1C                   ENDIF
109570961111     C***
109580961111     C*** SE BOLLA EXPORT CON C/A PROTEGGO TIPO INCASSO E DIVISA
109590961111     C***
109600121022     C     COMLNA        IFEQ      0
109610121022     C     WDESIE        ANDEQ     'E'
109620121022     C     COMLNA        ORGT      0
109630121022     c     A_§ogntw      andeq     'EEX'
109640121022     C     COMLNA        ORGT      0
109650121022     c     A_§ogntw      andeq     'FED'
109660121022     C     COMLNA        ORGT      0
109670121022     c     A_§ogntw      andeq     'DPD'
109680020319     c
109690121022     C     §3AFCA        IFGT      0
109700121022     C***                SETON                                        76
109710121022     C***                MOVEL     'BM'          VIDTIC
109720011108     C**         VIDVCA    IFEQ *BLANKS
109730011108     C* Con l'euro la divisa non sarà mai più a blank, quindi propongo
109740011108     C* la divisa della nazione del destinatario solo se importo C/A=0
109750050504     c* 04/05/05: Se divisa della nazione diversa da "EUR" o "USD"
109760050504     c* non propongo niente. Questo per evitare errori da parte del
109770050504     c* bollettista di indicazione della divisa sbagliata in particolar
109780050504     c* per le spedizioni dirette a paesi europei che hanno conservato
109790050504     c* la loro divisa (Svizzera, Danimarca...)
109800121022     C     VIDCAS        IFEQ      *ZEROS
109810121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
109820121022     C                   MOVEL     DESVLT        VIDVCA
109830121022     C                   MOVEL     DESVLT        VARVCA
109840121022     c                   else
109850121022     C                   clear                   VIDVCA
109860121022     C                   clear                   VARVCA
109870121022     c                   endif
109880121022     C                   ENDIF
109890980219     C**
109900121022     C                   ELSE
109910121022     C                   CLEAR                   VIDTIC
109920121022     c                   if        desvlt = 'EUR' or desvlt = 'USD'
109930121022     C                   MOVEL     DESVLT        VIDVCA
109940121022     C                   MOVEL     DESVLT        VARVCA
109950121022     c                   else
109960121022     C                   clear                   VIDVCA
109970121022     C                   clear                   VARVCA
109980121022     c                   endif
109990121022     C                   ENDIF
110000011108     C                   ELSE
110010011108     C* SE DESTINATARIO NON È EXPORT E IMPORTO CONTRASSEGNO = 0
110020011108     C* PROPONGO GEDCN
110030011108     C     VIDCAS        IFEQ      *ZEROS
110040011108     C                   MOVEL     §GEDCN        VIDVCA
110050011108     C                   MOVEL     §GEDCN        VARVCA
110060011108     C                   ENDIF
110070961111     C                   ENDIF
110080091210     c***
110090091210     C*** Richiamo routine per impostare eventuali forzature flag DDT
110100091210     c***
110110091210     c                   exsr      SR_FRZBAM
110120070326     c***
110130070326     C* IMPOSTO LNA DPD SE NON 'C'E'
110140070326    1C     VIDDPD        IFEQ      'D'
110150070326     C     WDESIE        ANDEQ     'E'
110160070326     C     A_§OGNTW      OREQ      'DPD'
110170160302     c**** w_aDpd        oreq      'S'
110180070326    2C     VIDLNA        IFLE      *ZEROS
110190070326     C     DESLAD        ANDGT     0
110200070326     C                   Z-ADD     DESLAD        COMLNA
110210070326    2C                   ENDIF
110220070326    1C                   ENDIF
110230070326     C* SE NUMERO AUTOMATICO, LO PRELEVO
110240070326     c* 22/03/07: Prelevo quello automatico anche nel caso di inserimen
110250070326     c* to numero parcel lungo 12 in quanto dal 01/04/07 non saranno
110260070326     c* più gestiti da DPD
110270070326     C  N12
110280070326    1COR 15VIDDPD        IFEQ      'D'
110290070326     C     WDESIE        ANDEQ     'E'
110300070326     C     A_§OGNTW      OREQ      'DPD'
110310160224     c     w_ADpd        oreq      'S'
110320070326    2c                   if        Comnrd=0 and (§1bf13='A' or
110330160225     c                             wparcel='12' or w_aDpd='S')
110340070515    3c****               if        dateu >= §vpodpd
110350070326     c                   clear                   trul33ds
110360070326     c                   z-add     25            i33cnu
110370070326     c                   z-add     1             i33num
110380070326     c                   movel     trul33ds      kpjbu
110390070326     c                   call      'TRUL33R'
110400070326     c                   PARM                    kpjba
110410070326     c                   movel     kpjbu         trul33ds
110420070326    4c     o33err        ifgt      *zeros
110430070326     c                   seton                                        90
110440070326    5c                   select
110450070326     c     o33err        wheneq    1
110460070326     c                   movel     err(300)      vidmsg
110470070326     c     o33err        wheneq    2
110480070326     c                   movel     err(301)      vidmsg
110490070326     c     o33err        wheneq    3
110500070326     c                   movel     err(302)      vidmsg
110510070326    5c                   endsl
110520070326     c                   goto      endc01
110530070326    4c                   endif
110540070326     c                   z-add     o33nri        comnrd
110550070515   x3c****               else
110560070515     C**** KTBE          CHAIN     TNTBE02L                           30
110570070326     C* E NON C'E' LO CREO
110580070515     C***30              CLEAR                   TNTBE000
110590070515     C***30              CLEAR                   DCHI
110600070515     C**N30              MOVEL     TBEUNI        DCHI
110610070515     C***                ADD       1             §CHINM
110620070515     C***                MOVEL     DCHI          TBEUNI
110630070515    3C***  *IN30         IFEQ      *OFF
110640070515     C***                UPDATE    TNTBE000
110650070515     C***                ELSE
110660070515     C***                MOVEL     KTCOD         TBECOD
110670070515     C***                MOVEL     KTLIN         TBELIN
110680070515     C***                MOVEL     KTSIF         TBESIF
110690070515     C***                MOVEL     KTKE1         TBEKE1
110700070515     C***                MOVEL     KTKE2         TBEKE2
110710070515     C***                MOVEL     'DP'          TBEKE2
110720070515     C***                WRITE     TNTBE000
110730070515    3C***                ENDIF
110740070515     C***                CLEAR                   DPDBRC
110750070515     C***                MOVEL     §CHINM        DPDBRC
110760070515     C***                CLEAR                   DPDCHD
110770070515     C***                EXSR      M1031
110780070515     C***                z-add     DPDBRC        COMNRD
110790070515    3c***                endif
110800070326    2c                   endif
110810070326    1c                   endif
110820070326     c* Impostazione numero parcel dpd: se attribuzione automatica o
110830070326     c* numero parcel lungo 12 coincide con numero preso da numeratore
110840070326     c* altrimenti è quello immesso a video
110850070326    1c                   if        (*in12='0' or *in15=*on) and
110860070326     c                             ((viddpd='D' and wdesie='E') or
110870160225     c                             A_§ogntw='DPD' or W_aDpd='S')
110880160225     c                             and (§1bf13='A' or wparcel='12' or
110890160225     c                             W_aDpd='S')
110900070515    2c***                if        dateu >= §vpodpd
110910070326     c                   move      comnrd        v7cnpr
110920070515   x2c***                else
110930070326     c** parcel lungo 12
110940070515     c***                z-add     comnrd        w0120            12 0
110950070515     C***                movel     w0120         V7CNPR
110960070515    2c***                endif
110970070326     c* se sono in bollettazione (no conferma bolle) non propongo più
110980070326     c* numero parcel dpd nel RMN
110990070326    2C   15VIDRMN        IFEQ      0
111000070326     C                   z-add     COMNRD        VIDRMN
111010070326    2C                   ENDIF
111020070326   x1c                   else
111030070326    2c                   if        (*in12='0' or *in15=*on) and
111040070326     c                             vidnrd<>*blanks
111050070326     c* se numero dpd numerico lo propongo nel rif.mittente come segue:
111060070326     c* - Se spedizione export --> solo in conferma bolle da cliente
111070070326     c* - Se spedizione import --> sempre
111080070326     c* se numero dpd alfanumerico e spedizione import imposto 1 in rmn
111090070326     c* Numero parcel dpd numerico
111100070326    3c                   if        wsolo_num=*blanks
111110070326     c* export
111120070326    4c                   if        (*in15=*on and *in79=*off
111130070326     c                             and vidrmn=0)
111140070326     c* import
111150070326     c                             or (*in79='1')
111160070326     c                   clear                   vidrmn
111170070326    5c                   if        %subst(vidnrd:14:1) <> *blanks
111180070326     C                   move      VIDNRD        VIDRMN
111190070326     c                   else
111200070326     c                   eval      w012a=%subst(vidnrd:1:12)
111210070326     c                   move      w012A         vidrmn
111220070326    5c                   endif
111230070326    4C                   ENDIF
111240070326   x3c                   else
111250070326     c* Numero parcel dpd alfanumerico
111260070326    4c                   if        *in79='1'
111270070326     c                   z-add     1             vidrmn
111280070326    4c                   endif
111290070326    3c                   endif
111300070326     C                   movel     VIDNRD        V7CNPR
111310070326    2c                   endif
111320070326    1c                   endif
111330000623     C***
111340000623     C* CONTROLLO SE ESISTE LA DS3Q PER IL CIENE MITTENTE
111350970326     C***
111360000623     C                   CLEAR                   WES3Q
111370000623     C                   MOVEL     '3Q'          COD
111380000623     C                   MOVEL(P)  WKSC          KEY
111390000623     C*
111400000623     C                   EXSR      CTABEL
111410000623     C  N30              MOVEL     'S'           WES3Q             1
111420000623     C   30              MOVEL     ' '           WES3Q             1
111430011112     C***
111440011112     C* DIVISA IMPORTO DA ASSICURARE: PROPONGO DIVISA NAZIONE MITTENTE
111450011112     C*        SE ESTERO ALTIMENTI PROPONGO §GEDCN
111460011112     C***
111470011112     C     VIDIAS        IFEQ      *ZEROS
111480011112     C     MITVLT        IFNE      *BLANKS
111490011112     C     WMITIE        ANDEQ     'E'
111500011112     C                   MOVEL     MITVLT        VIDVAS
111510011112     C                   MOVEL     MITVLT        VARVAS
111520011112     C                   ELSE
111530011112     C                   MOVEL     §GEDCN        VIDVAS
111540011112     C                   MOVEL     §GEDCN        VARVAS
111550011112     C                   ENDIF
111560011112     C                   ENDIF
111570011113     C***
111580011113     C* DIVISA VALORE MERCE DICHIAR.: PROPONGO DIVISA NAZIONE MITTENTE
111590011113     C*        SE ESTERO, ALTIMENTI PROPONGO §GEDCN
111600011113     C***
111610011113     C     VIDVMD        IFEQ      *ZEROS
111620011115     C     MITVLT        IFNE      *BLANKS
111630011113     C     WMITIE        ANDEQ     'E'
111640011113     C                   MOVEL     MITVLT        VIDVAD
111650011113     C                   MOVEL     MITVLT        VARVAD
111660011113     C                   ELSE
111670011113     C                   MOVEL     §GEDCN        VIDVAD
111680011113     C                   MOVEL     §GEDCN        VARVAD
111690011113     C                   ENDIF
111700011115     C                   ENDIF
111710000120     C***
111720940920     C     ENDC01        TAG
111730940909     C   90              MOVEL     '1'           WEMFOR
111740940909     C                   ENDSR
111750940224     C*
111760940921     C* RICERCA E CARICAMENTO A VIDEO TARIFFE ------------------------*
111770940224     C     RICTAR        BEGSR
111780940921     C                   SETOFF                                       30
111790941221     C                   CLEAR                   WTACAR
111800941221     C                   CLEAR                   WTKS
111810991026     C                   CLEAR                   COMDIV
111820940921     C*
111830940921     C* PER DISK CLI PRENDO SEMPRE LA TARIFFA DEL CLIENTE
111840940921    1C     *IN12         IFEQ      *ON
111850940921     C     *IN15         ANDEQ     *ON
111860940921     C                   MOVEL     §LPCTR        VIDCTR
111870050921     C                   MOVEL     §LPCTR        ilv59ctr
111880050921     C                   MOVEL     'S'           ilv59ric
111890940921     C*
111900940921   X1C                   ELSE
111910010223     C*
111920130404     c* 1) caso IMISSIONE
111930130404     c* 2) caso manutenzione con ricaricamento tariffe
111940010223    2C  N29WORM          IFEQ      'S'
111950010223     C     FLGFIT        ANDNE     'S'
111960010223     C     PARTCH        ANDNE     'P'
111970050921     C     ilv59ric      ANDEQ     'S'
111980010223    3C     *IN12         IFEQ      *OFF
111990010223     C     *IN15         OREQ      *OFF
112000010223     C     WORMMD        ANDEQ     '1'
112010030905    4c                   If        §OrPfb <> 'A'
112020010223     C                   MOVE      VIDCCM        W0070             7 0
112030010223    5C     VIDFLC        IFEQ      *ZEROS
112040010223     C                   MOVEL     VIDLNP        W0070
112050010223     C                   ELSE
112060010223     C                   MOVEL     VIDFLC        W0070
112070010223    5C                   ENDIF
112080010223    5C     W0070         IFEQ      ORMKSC
112090010223     C     ORMCTR        ANDNE     *BLANKS
112100010223     C                   MOVE      ORMCTR        VIDCTR
112110010223     C                   MOVE      ORMCTR        PRECTR
112120050921     C                   MOVE      ORMCTR        ilv59ctr
112130010223    5C                   ENDIF
112140010223    4C                   ENDIF
112150010223    3C                   ENDIF
112160010223    2C                   ENDIF
112170130404     c*
112180130404     c* 3) caso manutenzione solo con  cambio ORM
112190130404    2C  N29WORM          IFEQ      'S'
112200130404     C     FLGFIT        ANDNE     'S'
112210130404     C     PARTCH        ANDNE     'P'
112220130404     C     ilv59ric      ANDEQ     ' '
112230130404     C     *IN12         andeq     *On
112240130404     C     *IN15         andeq     *OFF
112250130404     C     WORMMD        ANDEQ     '1'
112260130404     C     ORMCTR        ANDNE     *BLANKS
112270130404    4c                   If        §OrPfb <> 'A'
112280130404     C                   MOVE      VIDCCM        W0070             7 0
112290130404    5C     VIDFLC        IFEQ      *ZEROS
112300130404     C                   MOVEL     VIDLNP        W0070
112310130404     C                   ELSE
112320130404     C                   MOVEL     VIDFLC        W0070
112330130404    5C                   ENDIF
112340130404    5C     W0070         IFEQ      ORMKSC
112350130404     c                   if        ormctr<>vidctr
112360130404     c                   eval      CambiaCTR='S'
112370130404     c                   endif
112380130404     C                   MOVE      ORMCTR        VIDCTR
112390130404     C                   MOVE      ORMCTR        PRECTR
112400130404     C                   MOVE      ORMCTR        ilv59ctr
112410130404    5C                   ENDIF
112420130404    4C                   ENDIF
112430130404    2C                   ENDIF
112440940921     C*
112450940224     C* PER : IMMISSIONE (SE NON PERSONALIZZATO IL COD TARIFFA)
112460940921     C*       E MANUTENZIONE BOLLE
112470941107    2C     *IN29         IFEQ      *ON
112480941231     C* SE NON LO DEVO RICARICARE, IMPOSTO IL CODICE TARIFFA
112490050921     C     ilv59ric      ORNE      'S'
112500050921     C                   MOVEL     VIDCTR        ilv59ctr
112510941107    2C                   ENDIF
112520941107    1C                   ENDIF
112530950525     C* SE VIDCTR = '   ' E' COME SE LO DOVESSI RICARICARE
112540950525     C     VIDCTR        IFEQ      *BLANKS
112550050921     C                   MOVEL     'S'           ilv59ric
112560950525     C                   ENDIF
112570150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
112580150415     c* accetto anche tariffe bloccate
112590150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
112600150415     c                              and §3arbl='R' and §lpimv>0)
112610150415     C                   EVAL      ILV59blo='S'
112620150415     C                   ENDIF
112630941107     C*
112640941107     C* SE ESISTONO TARIFFE PER IL CLIENTE CERCO
112650050921     C                   MOVEL     'P'           ilv59tbo
112660040512      * se bolla monovaria pulisco il tipo bolla
112670040512     C                   IF        §3ASVA <> *BLANK
112680050921     C                   CLEAR                   ilv59tbo
112690050921     c                   movel     'P'           ilv59prp
112700040512     C                   ENDIF
112710040512
112720050921     C                   MOVEL     WKSC          ilv59ksc
112730050921     C                   MOVEL     KCI           ilv59kci
112740050921     C                   MOVEL     BLPDSP        ilv59dsp
112750050921     C                   MOVEL     VIDTSP        ilv59tsp
112760160216     C                   MOVEL     WFIE          ilv59fie
112770160216     c                   clear                   ilv59ta3
112780160216     c                   select
112790160216     c     viddpd        wheneq    'D'
112800160216     c     wdesie        andeq     'E'
112810160222     c     a_§ogntw      oreq      'DPD'
112820160216     c                   movel     'D'           ilv59ta3
112830160216     c     viddpd        wheneq    'F'
112840160216     c     wdesie        andeq     'E'
112850160222     c     a_§ogntw      oreq      'FED'
112860160216     c                   movel     'F'           ilv59ta3
112870160216     c     viddpd        wheneq    ' '
112880160216     c     wdesie        andeq     'E'
112890160222     c     a_§ogntw      oreq      'EEX'
112900160216     c                   movel     'E'           ilv59ta3
112910160216     c                   other
112920160216     c                   movel     'I'           ilv59ta3
112930160216     c                   endsl
112940050921     C                   CALL      'FNLV59R'
112950050921     C                   PARM                    fnlv59ds
112960160428
112970160428     c                   if        ilv59ric=' ' and ilv59con=' ' and
112980160428     c                             ilv59ta4='S' and ilv59ctr<>olv59ctr
112990160428     c                   eval      ilv59ric='S'
113000160428     c                   endif
113010900528     C*
113020050922     c* se avevo richiamato con CON e RIC vuoti il cod.tariffa non
113030050922     c* viene impostato. Quindi in questo caso non imposto vidctr
113040050922     c* Avrei potuto condizionare il richiamo di fnlv59r da con e/o ric
113050050922     c* pieni ma in questo caso mi si poneva il problema dell'impostazi
113060050922     c* one di wtacar, wtks e comdiv in caso di manutenzione.
113070050922     c                   if        ilv59ric <> ' ' or ilv59con <> ' '
113080080403     c*
113090080326     c                   if        olv59ctr<>vidctr
113100080326     c                   eval      CambiaCTR='S'
113110160428     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
113120160428     c* mettere in RI i campi presi da tariffa per avvisare della variazione
113130160428     c                   if        *in12 and not *in15
113140160428     c                   seton                                        97
113150160428     c     atrbva        ifne      prri
113160160428     c                   movel     riul          atrbva
113170160428     c                   endif
113180160428     c                   endif
113190080326     c                   endif
113200080326     c
113210050921     C                   MOVEL     olv59ctr      VIDCTR
113220050921     C                   MOVEL     olv59dfs      DEFCTR
113230050922     c                   endif
113240941221     C*
113250941221     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDO SEMPRE DATI DAL
113260941221     C* LA TARIFFA DI CARTELLO
113270050921     C     olv59tks      IFEQ      ' '
113280941221     C                   MOVEL     'S'           WTACAR            1
113290950410     C                   CLEAR                   UND
113300950410     C* SOLO SE LA DEVO RICARICARE LA AZZERO
113310050921     C  N29ilv59ric      IFEQ      'S'
113320941221     C                   MOVEL     *ZEROS        VIDCTR
113330021120      * Per bolla FedEx imposto il codice tariffa della cartello FedEx
113340021120     c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
113350160219     c***                Movel     O27Ctr        VidCtr
113360160219     c                   clear                   trulc7ds
113370160222     c                   eval      IC7tFIE =  'F'
113380160219     c                   eval      IC7DTA  =  blpdsp
113390160219     c                   eval      IC7PKG  =  vidpkg
113400160219     c                   eval      IC7tip  =  i27tip
113410160219     c                   call      'TRULC7R'
113420160219     c                   parm                    trulc7ds
113430160219     c                   Movel     Oc7Ctrc       VidCtr
113440021120     c                   EndIf
113450950410     C                   ENDIF
113460941221     C                   ENDIF
113470950410     C*
113480050921     C                   MOVEL     olv59tks      WTKS
113490941231     C* SE HO RICERCATO LA TARIFFA RICARICO IL PRG ALTRIMENTI
113500941231     C*  LO PULISCO
113510050921     C     ilv59ric      IFEQ      'S'
113520150424     C     ilv59con      oreq      'S'
113530150424     C     olv59err      ifeq      ' '
113540050921     C     olv59tks      ANDEQ     'S'
113550050921     C                   MOVEL     olv59prg      COMPRG
113560941231     C                   ENDIF
113570150424     C                   ENDIF
113580950103     C*
113590050921     C     olv59err      IFNE      ' '
113600050921     C     olv59tks      ORNE      'S'
113610941231     C                   Z-ADD     0             COMPRG
113620941231     C                   ENDIF
113630940921     C*
113640940921     C* SE LA TARIFFA E' FRA QUELLE TROVATE, CARICO GLI ALTRI DATI DEL
113650941110     C* ALTRIMENTI LI PRENDO SEMPRE DALLA TARIFFA DI CARTELLO
113660050921     C     ilv59ric      IFEQ      'S'
113670150424     c     CambiaCTR     oreq      'S'
113680940922     C                   EXSR      CTNTAM
113690010223     C*
113700950103     C                   ENDIF
113710941107     C*
113720941107     C* IMPOSTO I CAMPI DEI CODICI TARIFFA A VIDEO
113730050921     C                   MOVEL     olv59ct2      VIDCT2
113740050921     C                   MOVEL     olv59ct3      VIDCT3
113750050921     C                   MOVEL     olv59ct4      VIDCT4
113760050921     C                   MOVEL     olv59ct5      VIDCT5
113770050921     C                   MOVEL     olv59es2      VIDES2
113780050921     C                   MOVEL     olv59es3      VIDES3
113790050921     C                   MOVEL     olv59es4      VIDES4
113800050921     C                   MOVEL     olv59es5      VIDES5
113810940921     C*
113820940922     C* OGNI VOLTA CHE MODIFICATO IL COD MITTENTE, PER CUI RICARICO
113830940922     C*  LE TARIFFE, IMPOSTO "SAVCTR" CON QUELLO PROPOSTO
113840940922     C*  IN QUANTO I CAMPI LI HO PROPOSTI A VIDEO
113850940922     C                   MOVEL     VIDCTR        SAVCTR
113860930803     C                   SETOFF                                       30
113870900504     C                   ENDSR
113880940922     C*
113890940922     C* CHAIN SU TNTAM00F PER PRENDERE I CAMPI DA PROPORRE -----------*
113900940922     C     CTNTAM        BEGSR
113910941221     C                   SETOFF                                       30
113920010226     C                   CLEAR                   WNNTAR
113930010226     C                   CLEAR                   WN1TAR
113940050926     C                   CLEAR                   fvol              1
113950941231     C*
113960941231    1C     WTACAR        IFEQ      ' '
113970941231     C* ERRORE: NON TROVATA PROGRESSIVO COL CODICE TARIFFA
113980941231     C* IMPOSTATO
113990050921    2C     olv59err      IFNE      ' '
114000941221     C                   SETON                                        30
114010941221     C                   ELSE
114020941231     C                   MOVEL     VIDCTR        COMCTR
114030941231     C**
114040940922     C     KTAM2         CHAIN     TNTAM000                           30
114050110304     c
114060941231    2C                   ENDIF
114070941221     C*
114080941231   X1C                   ELSE
114090941221     C* TARIFFA DI CARTELLO
114100160216     c                   clear                   trulc7ds
114110160224     c                   select
114120160226     c                   when      o27ntw='DPD' or w_aDpd='S'
114130160224     c                   eval      IC7tFIE = 'D'
114140160224     c                   when      o27ntw='FED'
114150160224     c                   eval      IC7tFIE = 'F'
114160160224     c                   when      o27ntw='EEX'
114170160224     c                   eval      IC7tFIE = 'E'
114180160224     c                   other
114190160224     c                   eval      IC7tFIE = 'I'
114200160224     c                   endsl
114210160216     c                   eval      IC7DTA  =  blpdsp
114220160216     c                   eval      IC7CTB  =  vidctr
114230160216     c                   eval      IC7PKG  =  vidpkg
114240160219     c                   eval      IC7tip  =  i27tip
114250160216     c                   call      'TRULC7R'
114260160216     c                   parm                    trulc7ds
114270160219     c                   clear                   oc7prgc_
114280160219     c                   if        oc7prgc<>*blanks
114290160219     c                   movel     oc7prgc       oc7prgc_
114300160219     c                   endif
114310160216     c
114320160216     c
114330941107     C     KCAR2         CHAIN     TNTAM000                           30
114340941231    1C                   ENDIF
114350941221     C  N30              MOVEL     TAMDCV        DEVCTR
114360040610     C  N30              MOVEL     TAMflo        dsta01
114370961203     C* PRENDO TASSAZIONE TARIFFA MITT SOLO SE NON PROVENGO DA
114380961203     C*  GIACENZE PERCHE' IN DIROTTAMENTO NON HO PIU' LE TARIFFE
114390961203     C*  ORIGINALI
114400961203     C  N30
114410961203     CANN87              MOVEL     TAMFTM        SAVFTM
114420941221     C   30              CLEAR                   DEVCTR
114430941221     C   30              CLEAR                   SAVFTM
114440940922     C*
114450940922     C* PER DISK CLIENTI
114460940922     C* I CAMPI LI PRENDO SOLO SE SONO VUOTI
114470940922     C* PER IL RESTO       SEMPRE
114480941231    1C     *IN12         IFEQ      *ON
114490940922     C     *IN15         ANDEQ     *ON
114500970328     C*
114510970328     C  N30§LPBAM        IFEQ      ' '
114520970328     C                   MOVEL     TAMBAM        VIDBAM
114530970328     C                   ENDIF
114540940922     C*
114550941231    2C     §LPNAS        IFEQ      *BLANKS
114560941221     C  N30              MOVEL     TAMNAS        VIDNAS
114570030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
114580030409     c                   If        VidDpd = 'F' or a_§OgNtw = 'FED'
114590030409     c                             and Not *In30
114600030409     c                   Clear                   VidNas
114610030409     c                   EndIf
114620941221     C   30              CLEAR                   VIDNAS
114630941231    2C                   ENDIF
114640040610     c* Tipo merce: V-Valore
114650040610     C  N30§lpbva        IFEQ      ' '
114660040610     c     §1bfg8        andne     'N'
114670040610     C                   MOVEL     §tabva        VIDbva
114680040610     C                   ENDIF
114690040610     c*
114700941231    2C     §LPNOT        IFEQ      *BLANKS
114710941221     C  N30              MOVEL     TAMNOT        VIDNT1
114720941221     C   30              CLEAR                   VIDNT1
114730941231   X2C                   ELSE
114740941231    3C     §LPNT2        IFEQ      *BLANKS
114750941221     C  N30              MOVEL     TAMNOT        VIDNT2
114760941221     C   30              CLEAR                   VIDNT2
114770941231    3C                   ENDIF
114780941231    2C                   ENDIF
114790940922     C*§
114800940922     C* GESTIONE PARTIC.C/A SOLO SE BOLLA CON C/A
114810941231    2C     §3AFCA        IFNE      0
114820940922     C     §LPGCA        ANDEQ     *BLANKS
114830940922     C     §3AFCA        ANDNE     0
114840941221     C  N30              MOVEL     TAMGCA        VIDGCA
114850941221     C   30              CLEAR                   VIDGCA
114860941231    2C                   ENDIF
114870941231    2C     §LPGGA        IFEQ      *BLANKS
114880941221     C  N30              MOVEL     TAMGGA        VIDGGA
114890941221     C   30              CLEAR                   VIDGGA
114900941231    2C                   ENDIF
114910941231    2C     §LPGMA        IFEQ      *BLANKS
114920160509     c     §3arbl        andne     'R'
114930100215     C  N30              MOVEL     TAMGMA        VIDGMA
114940941221     C   30              CLEAR                   VIDGMA
114950941231    2C                   ENDIF
114960941231    2C     §LPGVA        IFEQ      *BLANKS
114970941221     C  N30              MOVEL     TAMGVA        VIDGVA
114980941221     C   30              CLEAR                   VIDGVA
114990941231    2C                   ENDIF
115000940922     C*
115010941231   X1C                   ELSE
115020010226     C*
115030010226     C* NATURA MERCE
115040010226     C* SE NON E' STATA PERSONALIZZATA ED E' ATTIVATA PROCEDURA ORM
115050010226     C* DEVO PROPORRE LA NATURA MERCE DELL'ORM SE PRESENTE E NON
115060010226     C* QUELLA DA TARIFFA.
115070010226     C* IDEM PER LE NOTE
115080011221     C                   MOVEL     ORMNAM        W015A
115090150424    3C*    WORM          IFEQ      'S'
115100150424     C*    FLGFIT        ANDNE     'S'
115110150424     C*    PARTCH        ANDNE     'P'
115120150424     C*    ilv59ric      ANDEQ     'S'
115130150424    3c                   if        worm='S' and flgfit<>'S' and partch<>'P'
115140150424     c                             and (ilv59ric='S' or CambiaCTR='S')
115150010226     C     *IN27         IFEQ      *OFF
115160011221     C     W015A         ANDNE     *BLANKS
115170010226     C                   MOVEL     ORMNAM        VIDNAS
115180010226     C                   MOVEL     '1'           WNNTAR            1
115190010226     C                   ENDIF
115200010404     C* NOTE SE PESO > 50 Q.LI  O SE O.R.M COMMISSIONATO
115210010307    4C                   SELECT
115220010307     C     §LPFPR        WHENEQ    'O'
115230050211     C***  ORMPOE        ORNE      ORMPOR
115240080326     c                   if        vidnt1=*blanks
115250010307     C                   MOVEL     WTELRF        VIDNT1
115260080326     c                   else
115270080326     c                   if        vidnt2=*blanks
115280080326     C                   MOVEL     WTELRF        VIDNT2
115290080326     c                   endif
115300080326     c                   endif
115310080326     c
115320010307     C                   MOVEL     '1'           WN1TAR
115330010409     C     VIDPKG        WHENGE    §DFMAX
115340010226    5C     ORMNO1        IFNE      *BLANKS
115350080326     c                   if        vidnt1=*blanks
115360010226     C                   MOVEL     ORMNO1        VIDNT1
115370080326     c                   else
115380080326     c                   if        vidnt2=*blanks
115390150427     c                             and ormno1<>vidnt1
115400080326     C                   MOVEL     ORMNO1        VIDNT2
115410080326     c                   endif
115420080326     c                   endif
115430010226     C                   MOVEL     '1'           WN1TAR            1
115440010226    5C                   ENDIF
115450010307    4C                   ENDSL
115460010226    3C                   ENDIF
115470941231     C*
115480941231    3C     *IN30         IFEQ      *OFF
115490080326   3ac                   if        CambiaCTR='S'
115500080326     c
115510080326    4C     WNNTAR        IFEQ      *BLANKS
115520080326     c* solo se ho modificato la tariffa
115530941231     C  N27              MOVEL     TAMNAS        VIDNAS
115540030409      * se bolla con lna FedEx non devo reperire la natura merce dalla tariffa
115550160411    5c                   If        (VidDpd = 'F' or a_§OgNtw = 'FED')
115560030409     c                             and Not *In27
115570030409     c                   Clear                   VidNas
115580080326    5c                   EndIf
115590080326    4C                   ENDIF
115600080326    4C     WN1TAR        IFEQ      *BLANKS
115610080326     c* In manutenzione solo se sono vuote
115620080326    5c     vidnt1        ifeq      *blanks
115630110304     c     vidnt1        oreq      savnot
115640940922     C                   MOVEL     TAMNOT        VIDNT1
115650110304     c                   movel     tamnot        savnot
115660080326     c                   else
115670080326    6c     vidnt2        ifeq      *blanks
115680110304     c     vidnt2        oreq      savnot
115690080326     C                   MOVEL     TAMNOT        VIDNT2
115700110304     c                   movel     tamnot        savnot
115710080326    6c                   endif
115720080326    5c                   endif
115730080326     c
115740080326    4C                   ENDIF
115750080326     c
115760080326    4c     atrbva        ifne      prri
115770040610     c     §1bfg8        andne     'N'
115780040610     c                   movel     §tabva        vidbva
115790080326    4c                   endif
115800941231    4C     §3AFCA        IFNE      0
115810940922     C                   MOVEL     TAMGCA        VIDGCA
115820941231    4C                   ENDIF
115830940922     C                   MOVEL     TAMGGA        VIDGGA
115840160509     c                   if        §3arbl<>'R'
115850940922     C                   MOVEL     TAMGMA        VIDGMA
115860160509     c                   endif
115870940922     C                   MOVEL     TAMGVA        VIDGVA
115880970128     C                   MOVEL     TAMBAM        VIDBAM
115890080326   3ac                   endif
115900080326     c
115910941231   X3C                   ELSE
115920941221     C*
115930941221     C* PULISCO I CAMPI CHE PRENDO DA TARIFFA
115940010226     C     WNNTAR        IFEQ      *BLANKS
115950941221     C  N27              CLEAR                   VIDNAS
115960010226     C                   ENDIF
115970080326   3ac                   if        CambiaCTR='S'
115980080326     C**   WN1TAR        IFEQ      *BLANKS
115990080326     C**                 CLEAR                   VIDNT1
116000080326     C**                 ENDIF
116010040610     c                   clear                   vidbva
116020941221     C                   CLEAR                   VIDGCA
116030941221     C                   CLEAR                   VIDGGA
116040941221     C                   CLEAR                   VIDGMA
116050941221     C                   CLEAR                   VIDGVA
116060970128     C                   MOVEL     'N'           VIDBAM
116070080326   3aC                   ENDIF
116080080326    3C                   ENDIF
116090010226     C*
116100941231    1C                   ENDIF
116110940922     C*
116120950125     C* IN MANUTENZIONE SE CAMBIANO CLIENTE, CAMBIO SEMPRE
116130950125     C*     IL TIPO SERVIZIO a meno che non sia stato inserito
116140950125     C*
116150950125     C* IN IMMISSIONE TIPO SERVIZIO LO PRENDO SOLO SE NON IMMESSO
116160150424    1C*    VIDTSP        IFEQ      ' '
116170950125     C*
116180150424     C*    *IN12         OREQ      *ON
116190150424     C*    *IN15         ANDEQ     *OFF
116200150424     C*    VIDTSP        ANDEQ     BLPTSP
116210150424     C*    TAMTSP        ANDNE     BLPTSP
116220150424     C*    ilv59ric      ANDEQ     'S'
116230150424     C*    DOD           ANDEQ     0
116240150424     c*    wesore        andne     'S'
116250100330     c
116260150424     c*    wesore        andne     'S'
116270150424     c                   if        vidtsp=' ' or
116280150424     c                             (*in12 and not *in15 and
116290150424     c                             vidtsp=blptsp and tamtsp<>blptsp and
116300150424     c                             (ilv59ric='S' or CambiaCtr='S') and DOD=0
116310150424     c                             and wesore<>'S')
116320941110     C* DECODIFICO
116330941110     C                   Z-ADD     1             C                 3 0
116340941110     C     TAMTSP        LOOKUP    TSP(C)                                 30
116350090604     C**!30              MOVEL     DTS(C)        V2DTSP
116360090604     C   30              MOVEL     DTS08(C)      V2DTSP
116370941110     C  N30              CLEAR                   V2DTSP
116380941110     C* SALVO
116390941110     C                   MOVEL     TAMTSP        COMTSP
116400941107     c*
116410950410     C* EMETTO IL MESSAGGIO SOLO SE CIO' CHE C'E' IN BOLLA E' DIVERSO
116420950103    2C     *IN12         IFEQ      *ON
116430941110     C     *IN15         ANDEQ     *OFF
116440941107     C                   MOVEA     ERR(17)       K78
116450941107     C*
116460950125     C                   MOVEA     BLPTSP        K78(31)
116470950125     C                   MOVEL     WDETSP        W008A             8
116480950125     C                   MOVEA     W008A         K78(33)
116490941107     C*
116500950125     C                   MOVEA     TAMTSP        K78(53)
116510090604     C**!!!              MOVEL     DTS(C)        W008A             8
116520090604     C                   MOVEL     DTS08(C)      W008A             8
116530950125     C                   MOVEA     W008A         K78(55)
116540941107     C                   MOVEA     K78           VIDMSG
116550950125     C                   CLEAR                   VIDTSP
116560950125     C                   CLEAR                   V1DTSP
116570950125     C                   CLEAR                   VARTSP
116580950410     C                   MOVEL     1             DOD
116590950410     C                   SETON                                        9048
116600950103    2C                   ENDIF
116610950103    1C                   ENDIF
116620941107     C*
116630151106     c                   if        vidnt1=vidnt2
116640151106     c                   clear                   vidnt2
116650151106     c                   endif
116660940922     C                   ENDSR
116670021120      *---------------------------------------------------------------*
116680021120      * Ricerco e carico tariffe
116690021120      *---------------------------------------------------------------*
116700021120     c     TarCar        BegSr
116710021120
116720160218     c* recupero il network bolla per il caricamento tariffe
116730021120     c                   exsr      riccar
116740160302     c** 90              goto      endTar
116750021120     c                   movel     o27fie        wfie
116760021120
116770021120     c* protezione p.iva del mittente
116780021120     c     *in04         ifeq      *on
116790021120     c                   select
116800021120     c     o27ntw        wheneq    'DPD'
116810021120     c     desefd        andeq     *blanks
116820021120     c     wdesie        andeq     'E'
116830021120     c                   seton                                        39
116840021120     c     o27ntw        wheneq    'FED'
116850021120     c     deseff        andeq     *blanks
116860021120     c     wdesie        andeq     'E'
116870021120     c                   seton                                        39
116880021120     c     o27ntw        wheneq    'EEX'
116890021120     c     deseft        andeq     *blanks
116900021120     c     wdesie        andeq     'E'
116910021120     c                   seton                                        39
116920021120     c     o27ntw        wheneq    'PPT'
116930021120     c     o27ntw        oreq      'COR'
116940021120     C                   SETON                                        39
116950021120     c                   endsl
116960021120     c                   endif
116970021120     C***
116980021120     C*** CARICAMENTO DEI CODICI TARIFFA ***
116990050921     C                   CLEAR                   fnlv59ds
117000080403     c                   clear                   CambiaCTR         1
117010080403     c*
117020150424     c                   if        *in29 and vidctr<>savctr
117030080403     C                   MOVEL     'S'           ilv59ric
117040080403     c                   MOVEL     'S'           CambiaCTR
117050080403     c                   endif
117060021120     C*
117070021120     C* SE MODIFICATO IL FLAG ITALIA ESTERO --> SEMPRE
117080021120     C     WFIE          IFNE      SAVFIE
117090160219     C     O27NTW        ORNE      S_27NTW
117100160219     C
117110160219     c
117120050921     C                   MOVEL     'S'           ilv59ric
117130021120     C                   MOVEL     WFIE          SAVFIE
117140160219     C                   MOVEL     O27NTW        S_27NTW
117150021120     C                   ENDIF
117160021120     C* IL TIPO SERVIZIO
117170160303     C     VIDTSP        IFNE      VARTSP
117180160428     C                   IF        VIDTSP=*BLANKS
117190160428     C                   MOVEL     'S'           ilv59ric
117200160428     C                   else
117210160428     C                   MOVEL     'S'           ilv59ta4
117220160428     c                   endif
117230160303     C                   MOVEL     VIDTSP        VARTSP
117240160303     C                   ENDIF
117250021120     C*
117260021120     C*  IL CODICE MITTENTE PER MANUTENZIONE
117270021120    1C     *IN12         IFEQ      *OFF
117280021120     C     *IN15         OREQ      *OFF
117290021120     C*
117300021120     C* DA ASSEGNATO CODIFICATO AD ASSEGNATO NON CODIFICATO --> PULISCO
117310021120     C*  I CAMPI PRESI DA TARIFFA
117320021120    2C     VIDCCM        IFEQ      9999
117330021120     C     SAVCCM        IFNE      0
117340021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
117350021120     C                   MOVEL     *ZEROS        SAVCCM
117360021120     C                   CLEAR                   TRE
117370021120     C                   CLEAR                   DOD
117380021120     C*
117390021120     C* VADO IN CARICAMENTO TARIFFA SOLO PER PULIRE LE SKIERE
117400050921     C                   MOVEL     'S'           ilv59ric
117410080403     C                   MOVEL     'S'           CambiaCTR
117420080403     c
117430021120     C                   ENDIF
117440021120     C*
117450021120   X2C                   ELSE
117460021120     C* ASSEGNATO CON MITTENTE CODIFICATO
117470021120     C*
117480021120     C* MITTENTE MODIFICATO
117490021120    3C     WKSC          IFNE      SAVCCM
117500050921     C                   MOVEL     'S'           ilv59ric
117510080403     C                   MOVEL     'S'           CambiaCTR
117520160429     c* in manutenzione, se cambiato codice tariffa accendo indicatore per
117530160429     c* mettere in RI i campi presi da tariffa per avvisare della variazione
117540160429     c                   if        *in12 and not *in15
117550160429     c                   seton                                        97
117560160429     c     atrbva        ifne      prri
117570160429     c                   movel     riul          atrbva
117580160429     c                   endif
117590160429     c                   endif
117600021120     C* SALVO I NUOVI CAMPI DI CONFRONTO
117610021120     C                   MOVEL     WKSC          SAVCCM
117620021120     C                   CLEAR                   TRE
117630021120     C                   CLEAR                   DOD
117640021120    3C                   ENDIF
117650021120    2C                   ENDIF
117660021120     C* VARIATO NUMERO ORM
117670021120     C     CHGORM        IFEQ      'S'
117680021120     C                   CLEAR                   CHGORM
117690130404     C******             MOVEL     'S'           ilv59ric
117700021120     C                   ENDIF
117710021120     C*
117720021120    1C                   ENDIF
117730150424      * Se cambiato codice tariffa tra prima e seconda videata
117740150424      * devo far assumere questa variazione a fnlv59r in modo da
117750150424      * ricevere i dati della nuova tariffa
117760150424     c                   if        vidctr<>savctr and ilv59ric=' '
117770150424     c                   eval      ilv59con='S'
117780150424     c                   eval      CambiaCTR='S'
117790150427     c                   seton                                        97
117800160429     c     atrbva        ifne      prri
117810160429     c                   movel     riul          atrbva
117820160429     c                   endif
117830150424     c                   endif
117840021120     C*
117850021120     C* CARICO TARIFFE DEL CLIENTE
117860021120     C*
117870021120     C* IMPOSTO CODICE TARIFFA A VIDEO
117880021120     C* IN MANUTENZIONE LE TARIFFE VENGONO RICARICATE SOLO SE MODIFICAT
117890021120     C                   EXSR      RICTAR
117900021120     C* SE IL CLIENTE NON HA TARIFFA--> ERRORE FORZABILE
117910160226     C* SE IL CLIENTE NON HA TARIFFA FED --> ERRORE NON FORZABILE
117920021120     C     WTKS          IFEQ      ' '
117930021120     C     VIDCCM        ANDNE     8888
117940021120     C     VIDCCM        ANDNE     9999
117950160226     C***  WFIE          IFNE      'D'
117960160226     c     wfie          ifne      'F'
117970021120     c     wfie          andne     'N'
117980021120     c     wfie          andne     'M'
117990021120     C     TRE           IFEQ      0
118000021120     C                   MOVEL     ERR(84)       VIDMSG
118010021120     C                   SETON                                        9050
118020021120     C                   MOVEL     1             TRE
118030021120     C                   GOTO      ENDTar
118040021120     C                   ENDIF
118050021120     C                   ELSE
118060160226     c*    wfie          ifeq      'D'
118070160226     C*                  MOVEL     ERR(188)      VIDMSG
118080160226     c*                  else
118090021120     C                   MOVEL     ERR(246)      VIDMSG
118100160226     c*                  endif
118110021120     C                   SETON                                        9050
118120021120     C                   GOTO      ENDTar
118130021120     C                   ENDIF
118140021120     C                   ENDIF
118150021120
118160021120     c     EndTar        EndSr
118170020207     C*
118180160224     C* RECUPERA NETWORK TARIFFA -------------------------------------*
118190020207     C     RICCAR        BEGSR
118200020213     c*
118210021120     c                   Z-Add     VidPkg        I27Pkg
118220020213     c                   movel     vidtsp        i27tsp
118230020213     c                   z-add     vidlnp        i27lnp
118240020213     c     comlna        ifgt      *zeros
118250020213     c                   z-add     comlna        i27lna
118260020213     c                   else
118270020213     c                   select
118280020213     c     viddpd        wheneq    'D'
118290020213     c     wdesie        andeq     'E'
118300020213     c                   movel     'D'           i27tln
118310020213     c     viddpd        wheneq    'F'
118320020213     c     wdesie        andeq     'E'
118330020213     c                   movel     'F'           i27tln
118340020213     c     viddpd        wheneq    ' '
118350020213     c     wdesie        andeq     'E'
118360020213     c                   movel     'E'           i27tln
118370020213     c                   other
118380020213     c                   movel     'I'           i27tln
118390020213     c                   endsl
118400020213     c                   endif
118410020213     c     vidflc        ifgt      *zeros
118420020213     c                   movel     vidflc        i27cli
118430020213     c                   else
118440020213     c                   movel     vidlnp        i27cli
118450020213     c                   endif
118460020213     c                   move      vidccm        i27cli
118470160216     c*****              z-add     blpdsp        i27dta
118480020213     c*
118490160216     c                   call      'TRUL27R1'
118500160216     c                   parm                    trul27ds1
118510160216     c***                z-add     o27ksc        tarksc
118520160216     c***                z-add     o27ctr        tarctr
118530020319     c* errore bloccante se non trovato il progressivo
118540160216     c***  o27prg        ifge      *zeros
118550160216     c***                move      o27prg        tarprg
118560160216     c***                else
118570160216     C***                SETON                                        90
118580160216     C***                MOVEL     ERR(248)      VIDMSG
118590160216     c***                endif
118600020213     c*
118610020207     c                   ENDSR
118620091210     C*--- IMPOSTAZIONE FORZATURE FLAG DDT ------------------------
118630091210     C     SR_FRZBAM     BEGSR
118640091210     C***
118650091210     C* SE BOLLA CON OBBLIGO DDT  RIMANE IMPOSTATO "S"
118660091210     C***
118670091210     C                   SELECT
118680101104     c* Se spedizione diretta a FEDEX sempre DDT SI
118690101104     c                   when      VidDpd = 'F' or a_§OgNtw = 'FED'
118700101104     C                   MOVEL     'S'           VIDBAM
118710091210     C* SE PAESE CON ATTRAVERSAMENTO DOGANA --> OBBLIGATORIA SI DDT
118720091210     C     DESEFT        WHENNE    ' '
118730091210     C     A_§OGNTW      ANDNE     'DPD'
118740091210     C     VIDDPD        ANDEQ     ' '
118750091210     c     A_§ogntw      andne     'FED'
118760091210     C                   MOVEL     'S'           VIDBAM
118770091210     c* Se richiesta bolla firmata --> Forzo si ddt
118780091210     c     vidcbo        wheneq    'FO'
118790091210     C                   MOVEL     'S'           VIDBAM
118800091210     C* SE BOLLA DI RECUPERO --> FORZI NO DDT
118810091210     C     §3ARBL        WHENEQ    'R'
118820091210     c**** vidcbo        andne     'FO'
118830091210     C                   MOVEL     'N'           VIDBAM
118840091210     C* SE OBBLIGO DDT DA CAPPARIO FORZO SI DDT
118850091210     C     DESGDD        WHENEQ    'S'
118860091210     c     savfpr        andne     'G'
118870091210     c     savfpr        andne     'P'
118880150302     c     savfpr        andne     'B'
118890091210     C                   MOVEL     'S'           VIDBAM
118900091210     c* se bolla con estensione ddt cliente (FIVAX) forzo NO DDT
118910091210     c     §1bf16        wheneq    'S'
118920091210     c                   movel     'N'           VIDBAM
118930091210     c     §dstddt       wheneq    'S'
118940091210     c     flgtb1        andeq     'A'
118950091210     c     vidcbo        andne     'FW'
118960091210     c     vidfbr        andne     'S'
118970091210     c     savfpr        andne     'G'
118980091210     c     savfpr        andne     'P'
118990091210     c                   movel     'S'           vidbam
119000091210     C                   ENDSL
119010091210     c                   eval      savddt = vidbam
119020091210     c                   endsr
119030041012     C*
119040041012     C*--- IMPOSTAZIONE CONSEGNE PARTICOLARI Per destinatario disagiat*
119050041012     C     SR_IMPtc12    BEGSR
119060041012     C*
119070041012     c* Referente e numero di telefono: se campi a video con '#'
119080041012     c* sono quelli automatici (dal tisit5) e quindi li pulisco
119090041012    2c                   if        %subst(Vidref:1:1) = '#'
119100041012     c                   clear                   vidref
119110041012    2c                   endif
119120041012    2c                   if        %subst(Vidtel:1:1) = '#'
119130041012     c                   clear                   vidtel
119140041012    2c                   endif
119150041012     c*
119160060324    2c                   if        (wdisag = 'X') OR
119170060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
119180060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
119190060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
119200041012     c                   select
119210041012     c     vidtc1        wheneq    *blanks
119220041012     c                   movel     wdisag        vidtc1
119230041012     c     vidtc2        wheneq    *blanks
119240041012     c                   movel     wdisag        vidtc2
119250041012     c                   endsl
119260041012    3c     vidtc1        ifeq      vidtc2
119270041012     c                   clear                   vidtc2
119280041012    3c                   endif
119290041012    3c                   if        vidref = *blanks
119300041012     c                   movel     ot0ref        vidref
119310041012    3c                   endif
119320041012    3c                   if        vidtel = *blanks
119330041012     c                   movel     ot0tel        vidtel
119340041012    3c                   endif
119350041012   x2c                   else
119360041012     c* se destinatario non disagiato e sono in immissione pulisco tc1 e tc2
119370041012     c* entro qui anche se destinatario supermercato/appuntamento ma previst
119380041012     c* ta consegna ad uffici
119390041012    3c                   if        *in12 = '0'
119400041012      * e se era stato precedentemente impostato da programma
119410041012     c                             and savdisag <> *Blanks
119420041012     c                   Eval      savdisag = wdisag
119430041012    4c     vidtc1        ifeq      'X'
119440091001     c     vidtc1        oreq      'S'
119450041012     c     vidtc1        oreq      'A'
119460041012     c                   clear                   vidtc1
119470041012     c                   Clear                   v2dtc1
119480041012    4c                   endif
119490041012    4c     vidtc2        ifeq      'X'
119500041012     c     vidtc2        oreq      'S'
119510041012     c     vidtc2        oreq      'A'
119520041012     c                   clear                   vidtc2
119530041012     c                   Clear                   v2dtc2
119540041012    4c                   endif
119550041012    3c                   endif
119560041012     c
119570041012    2c                   endif
119580091001     c* Memorizzo forzatura consegna particolare da destinatari particolari
119590091001     c                   if        wdisag<>*blanks and
119600091001     c                             (wdisag=vidtc1 or wdisag=vidtc2)
119610091001     c                   if        *in12=*off or
119620091001     c                             (wdisag<>sav_tc1 and wdisag<>sav_tc2)
119630091001     c                   eval      w_ar5tcp=wdisag
119640091001     c                   endif
119650091001     c                   endif
119660041012     c                   endsr
119670070924     C*--- IMPOSTAZIONE giorni di chiusura per destinatario particolar*
119680070924     C     SR_IMPgc12    BEGSR
119690070924     c*
119700070924    2c                   if        ot0err=*blanks
119710070924     c* propongo solo se a video non è stato specificato nulla.
119720070924     c* In manutenzione solo se cambiato il destinatario
119730070924     c                   if        vidgc1=*blanks and vidgc2=*blanks
119740070924     c                             and (*in12='0' or *in15='1' or
119750070924     c                             vidrsd<>savrsd or vidind<>savind or
119760070924     c                             vidprd<>savprd or vidcad<>savcad or
119770070924     c                             vidlod<>savlod or vidnzd<>savnzd)
119780070924     c                   eval      vidgc1=OT0X1GC1
119790070924     c                   eval      vidgc2=OT0X1GC2
119800070924     c                   endif
119810070924   x2c                   else
119820070924     c* se destinatario non presente e sono in immissione pulisco gc1 e gc2
119830070924    3c                   if        *in12 = '0'
119840070924      * e se era stato precedentemente impostato da programma
119850070924     c                             and savpart <> *Blanks
119860070924     c                   Eval      savpart = *blanks
119870070924     c                   clear                   vidgc1
119880070924     c                   Clear                   vidgc2
119890070924    3c                   endif
119900070924     c
119910070924    2c                   endif
119920070924     c                   endsr
119930900502     C*
119940900502     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
119950940819     C     INZ02         BEGSR
119960950126     C*
119970950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
119980971210     C                   EXSR      OFFD02
119990900502     C*
120000940923     C* SPENGO INDICATORI CHE EVIDENZIANO LE VALUTE
120010940923     C                   SETOFF                                       929399
120020940825     C                   MOVEL     *ZEROS        VIDRMN
120030060619     C***                MOVEL     *ZEROS        savRMN
120040940825     C                   MOVEL     *BLANKS       VIDRMA
120050941103     C* 03 ON - PERSONALIZZAIZONE MITTENTE ORIGINALE
120060941103     C     *IN03         IFEQ      *OFF
120070900502     C                   MOVEL     *BLANKS       VIDRMO
120080940930     C                   MOVEL     *BLANKS       VIDCMO
120090940930     C                   MOVEL     *BLANKS       VIDNMO
120100941103     C                   ENDIF
120110050315     C****               MOVE      *BLANKS       VIDFFD
120120940825     C                   MOVEL     *BLANKS       VIDFBR
120130900503     C                   MOVEL     *BLANKS       DEVCTR
120140940825     C                   MOVEL     *BLANKS       VIDTC1
120150940825     C                   MOVEL     *BLANKS       V2DTC1
120160940825     C                   MOVEL     *BLANKS       VIDTC2
120170940825     C                   MOVEL     *BLANKS       V2DTC2
120180900502     C                   MOVEL     *ZEROS        VIDNCL
120190930414     C                   MOVEL     *ZEROS        VARNCL
120200940825     C                   MOVEL     *ZEROS        V2CPKG
120210980402     C                   MOVEL     *ZEROS        SAVPKG
120220900502     C                   MOVEL     *ZEROS        VIDNRS
120230900502     C                   MOVEL     *ZEROS        VIDNCD
120240900502     C                   MOVEL     *ZEROS        VIDNCA
120250940825     C                   MOVEL     *BLANKS       VIDFVR
120260900502     C                   MOVEL     *ZEROS        VIDVOL
120270980402     C                   MOVEL     *ZEROS        SAVVOL
120280090609     c                   clear                   wvol_pre
120290940825     C                   MOVEL     *ZEROS        VIDCAS
120300011107     C                   MOVEL     §GEDCN        VIDVCA
120310011107     C                   MOVEL     §GEDCN        VARVCA
120320940825     C                   MOVEL     *BLANKS       VIDTIC
120330940825     C                   MOVEL     *ZEROS        VIDVMD
120340011113     C                   MOVEL     §GEDCN        VIDVAD
120350940825     C                   MOVEL     *ZEROS        VIDIAS
120360011211     C                   MOVEL     *ZEROS        VARIAS
120370011211     C                   MOVEL     *ZEROS        WARIAS
120380011212     C                   MOVEL     *ZEROS        WARCAS
120390011212     C                   MOVEL     *ZEROS        WARVMD
120400011112     C                   MOVEL     §GEDCN        VIDVAS
120410011112     C                   MOVEL     §GEDCN        VARVAS
120420940825     C                   MOVEL     *ZEROS        VIDQFT
120430950102     C                   MOVEL     *ZEROS        VARQFT
120440910912     C                   MOVEL     *ZEROS        BLPSPE
120450940825     C                   MOVEL     *BLANKS       VIDGGA
120460940825     C                   MOVEL     *BLANKS       VIDGCA
120470940825     C                   MOVEL     *BLANKS       VIDGMA
120480940825     C                   MOVEL     *BLANKS       VIDGVA
120490940922     C                   MOVEL     *BLANKS       VIDGGR
120500940922     C                   MOVEL     *BLANKS       VIDGCR
120510940922     C                   MOVEL     *BLANKS       VIDGMR
120520940922     C                   MOVEL     *BLANKS       VIDGVR
120530940825     C                   MOVEL     *BLANKS       VIDNT1
120540940825     C                   MOVEL     *BLANKS       VIDNT2
120550110304     c                   clear                   savnot
120560010220     C                   MOVEL     *BLANKS       VARFFD
120570930401     C                   MOVEL     *ZEROS        VA2VOL
120580930401     C                   MOVEL     *ZEROS        VARPKG
120590020531     C                   MOVEL     *ZEROS        VARtc1
120600020531     C                   MOVEL     *ZEROS        VARtc2
120610060110     C                   MOVEL     *ZEROS        D_VARrsd
120620060110     C                   MOVEL     *ZEROS        D_VARind
120630060110     C                   MOVEL     *ZEROS        D_VARlod
120640060110     C                   MOVEL     *ZEROS        D_VARprd
120650060110     C                   MOVEL     *ZEROS        D_VARnzd
120660060104     c* visto che in un caso questo campo lo andrò ad impostare anche
120670060104     c* nella routine ctrd01 sposto la pulizia nella inz01
120680060104     C****               MOVEL     *ZEROS        VARZNC
120690970128     C                   MOVEL     'N'           VIDBAM
120700021217     c                   Clear                   VidTba
120710021217     c                   Clear                   VidNba
120720030808     c                   Clear                   SavNba
120730021217     c                   Clear                   VidTb2
120740021217     c                   Clear                   VidNb2
120750030808     c                   Clear                   SavNb2
120760001214     C                   CLEAR                   KOL
120770001214     C                   Z-ADD     0             XY                2 0
120780040917     c* pulisco campo per forzatura mittente
120790040917     c                   clear                   wcontmit          1
120800030731
120810030731      * pulisco i campi di attributi visualizzazione e flag di work per
120820030731      * rif.mittente alfabetico, bancali, part.consegna varie
120830040226      * rif.mittente numerico
120840030731     c                   Clear                   AtrRma
120850030731     c                   Clear                   wrma
120860030731     c                   Clear                   AtrTba
120870030731     c                   Clear                   AtrNba
120880030731     c                   Clear                   AtrTb2
120890030731     c                   Clear                   AtrNb2
120900030731     c                   Clear                   AtrGva
120910040226     c                   Clear                   AtrRmn
120920150302     c                   clear                   atrnt1
120930150302     c                   clear                   atrnt2
120940150302     c                   clear                   atrncl2
120950150302     c                   clear                   atrpkg2
120960040226     c                   Eval      wrifm = *Off
120970150427     c                   clear                   atrctr
120980030708      * pulisco i campi della window x i colli originali + sfusi
120990030708     c                   Clear                   w03rig1
121000030708     c                   Clear                   w03rig2
121010030708     c                   Clear                   w03cor
121020030708     c                   Clear                   w03csf
121030030708     c                   Clear                   At3c01
121040030708     c                   Clear                   At3cor
121050030708     c                   Clear                   At3c02
121060030708     c                   Clear                   At3csf
121070030708     c                   Clear                   At3f12
121080030708     c                   Clear                   H3riga
121090030708     c                   Clear                   H3colo
121100030708     c                   Clear                   wtotncl
121110030708     c                   Clear                   savw03cor
121120030708     c                   Clear                   savw03csf
121130030805
121140030805     c                   Clear                   savkeyorm
121150080314     c* pulisco campo per forzatura serie parziale
121160080314     c                   clear                   f_range
121170090323     c* Campo per visualizzazione taso funzionale f15=cli/tar per tassaz.
121180090323     c* porti assegnati
121190090323     c                   clear                   atrf15
121200090327     c                   exsr      sr_inzwdwcli
121210091119     c*
121220091119     c                   exsr      inzwdwcas
121230940825     C                   ENDSR
121240940825     C*
121250940825     C*--- PULIZIA CAMPI FORMATO3 ------------------------------------*
121260940825     C     INZ03         BEGSR
121270950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
121280971210     C                   EXSR      OFFD03
121290950126     C*
121300940923     C* CAMPO CHE INDICA SE DEVO OBBLIGATORIAMENTE EMETTERE IL FORMATO3
121310940923     C                   CLEAR                   WEMD03
121320940923     C* TASSAZIONE
121330971211     C                   CLEAR                   V3CLNA
121340971211     C                   CLEAR                   V3DLNA
121350991008     C                   CLEAR                   VIDDIV
121360991011     C                   CLEAR                   WDIV1
121370940826     C                   MOVEL     *ZEROS        VIDPOR
121380991012     C                   MOVEL     *ZEROS        MEMPOR
121390940825     C                   MOVEL     *ZEROS        VIDIMV
121400940825     C                   MOVEL     *ZEROS        VIDFIV
121410991029     C                   MOVEL     *ZEROS        VA2VA1
121420040130     C                   MOVEL     *ZEROS        VA2VA2
121430040130     C                   MOVEL     *ZEROS        VA2VA3
121440040130     C                   MOVEL     *ZEROS        VA2VA4
121450041217     C                   MOVEL     *ZEROS        VA2VA5
121460041217     C                   MOVEL     *ZEROS        VA2VA6
121470940825     C                   MOVEL     *ZEROS        VIDNFT
121480940825     C                   MOVEL     *ZEROS        VIDDFT
121490940923     C                   MOVEL     ' '           VIDCEI
121500940826     C                   MOVEL     *BLANKS       V3DCEI
121510940929     C                   MOVEL     *BLANKS       V2DCEI
121520940923     C* PULIZIA SFL
121530940923     C                   SETON                                        35
121540160609     C****               WRITE     LS01C03
121550940923     C                   SETOFF                                       35
121560940923     C*
121570940923     C                   CLEAR                   V3CSV1
121580940923     C                   CLEAR                   V3CVA1
121590940923     C                   CLEAR                   V3CEV1
121600991008     C                   CLEAR                   V3HVA1
121610940923     C*
121620160609     C                   DO        20            NRR               5 0
121630160609     C*                  WRITE     LS01S03
121640160609     C                   ENDDO
121650940923     C* ESTENSIONE BOLLA
121660940923     C                   MOVEL     ' '           VI2SV1
121670940923     C                   MOVEL     *ZEROS        VI2VA1
121680040114     c                   Clear                   Vi2Sv2
121690040114     c                   Clear                   Vi2Va2
121700040114     c                   Clear                   Vi2Sv3
121710040114     c                   Clear                   Vi2Va3
121720040114     c                   Clear                   Vi2Sv4
121730040114     c                   Clear                   Vi2Va4
121740041217     c                   Clear                   Vi2Sv5
121750041217     c                   Clear                   Vi2Va5
121760041217     c                   Clear                   Vi2Sv6
121770041217     c                   Clear                   Vi2Va6
121780930628     C                   MOVEL     ' '           VI2CEI
121790940923     C                   MOVEL     *BLANKS       V2DCEI
121800040121     c                   Clear                   Vi2Es1
121810040121     c                   Clear                   Vi2Es2
121820040121     c                   Clear                   Vi2Es3
121830040121     c                   Clear                   Vi2Es4
121840041217     c                   Clear                   Vi2Es5
121850041217     c                   Clear                   Vi2Es6
121860040126     c                   Clear                   Vi2Imv
121870991011     C                   CLEAR                   WDIV2
121880991011     C                   CLEAR                   VI2DIV
121890990701     C                   CLEAR                   VIDIFT
121900990701     C                   CLEAR                   SAVIMV
121910060208     C                   CLEAR                   SAVIMVO
121920151014     C                   CLEAR                   SAVIMV_fat
121930151014     c                   Clear                   PesVolPkcn
121940151014     c                   Clear                   PesVolSpc
121950151014     c                   Clear                   PesVolImv
121960991008      *
121970900502     C                   ENDSR
121980971210     C**
121990971210     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
122000971210     C     INZ06         BEGSR
122010081008     C**                 CLEAR                   V6CINS
122020081008     C**                 CLEAR                   V6CSTA
122030971210     C                   CLEAR                   V6CAWB
122040971211     C                   CLEAR                   SAVAWB
122050081008     C**                 CLEAR                   V6CLNA
122060081008     C**                 CLEAR                   V6DLNA
122070971210     C                   ENDSR
122080900502     C*
122090991203     C**
122100991203     C*--- PULIZIA CAMPI FORMATO6 ------------------------------------*
122110991203     C     INZ07         BEGSR
122120991203     C                   CLEAR                   V7CNPR
122130991203     C                   CLEAR                   SAVNPR
122140991203     C                   CLEAR                   V7CLNA
122150991203     C                   CLEAR                   V7DLNA
122160061003     C***                CLEAR                   savfnp
122170060620     C                   CLEAR                   savkrt
122180991203     C                   ENDSR
122190000829     C*
122200000829     C*--- PULIZIA CAMPI FORMATO8 ------------------------------------*
122210000829     C     INZ08         BEGSR
122220000829     C*
122230000829     C                   CLEAR                   V8CKSC
122240000829     C                   CLEAR                   V8DKSC
122250000829     C* PULIZIA SFL
122260000829     C                   SETON                                        35
122270160609     C******             WRITE     LS01C08
122280000928     C                   SETOFF                                       357833
122290000829     C                   MOVE      *ZEROS        V8CNBR
122300000829     C                   MOVE      *ZEROS        NR8
122310000918     C                   MOVE      *ZEROS        SAVNR8
122320000829     C*
122330000829     C                   CLEAR                   V8CSCE
122340000829     C                   CLEAR                   V8CNOT
122350000908     C                   CLEAR                   V8HDKC
122360000908     C                   CLEAR                   V8HESG
122370000915     C                   CLEAR                   V8HST2
122380000915     C                   CLEAR                   V8HFLS
122390000915     C                   CLEAR                   V8HLNA
122400000915     C                   CLEAR                   V8HNRS
122410000915     C                   CLEAR                   V8HNSC
122420000921     C                   CLEAR                   V8HPRE
122430000830     C*
122440000830     C* PULISCO ANCHE CAMPO FORMATO 9
122450000830     C                   CLEAR                   V9CNOT
122460000921     C                   CLEAR                   CH2
122470000921     C                   CLEAR                   I2
122480000829      *
122490000829     C                   ENDSR
122500960404     C*--- PULIZIA CAMPI FORMATO2 ------------------------------------*
122510940825     C     CTRD02        BEGSR
122520940929     C                   CLEAR                   WEMFOR
122530941115     C                   CLEAR                   VIDMSG
122540930414     C                   Z-ADD     0             COMCTR
122550940216     C                   CLEAR                   CMD8
122560000321     C                   CLEAR                   WEFT
122570160302     c* Se bolla export eex verifico se instradabile su DPD
122580160302     c* Controllo già fatto nella ctrd01 ma qui è da ripetere nel caso
122590160302     c* cambiassero il peso in conferma bolle
122600160302     c                   if        *in12 and *in15
122610160302     c                   clear                   w_adpd
122620160302     c                   if        viddpd=' ' and wdesie='E' and
122630160302     c                             (vidlna = *zeros or vidlna=*blanks)
122640160302     c                             and not *in44
122650160407     c                             and §lpfpr<>'O' and partch<>'P'
122660160407     c                             and §3arbl<>'R'
122670160302     c                             and not *in04
122680160302     c                   exsr      sr_instrADPD
122690160302     c                   endif
122700160302     c                   endif
122710160406     c* In immissione bolle se immesso il volume verifico subito se rientra
122720160406     c* nei limiti per instradamento forzato a dpd
122730160406     c* (W_aDpd viene utilizzato per la ricerca della cartello in caso di bolla
122740160406     c* di cliente codificato con manca tariffa )
122750160406     c* se invece il volume non è immesso il controllo viene comunque rieseguito
122760160406     c* dopo il calcolo del volume automatico
122770160406     c                   if        not *in12 and w_aDpd='S' and vidvol>§16vld
122780160406     c                   eval      w_aDpd='N'
122790160406     c                   endif
122800160302     c* Se si vuole instradare a DpD una bolla EEX devo richiamare il
122810160302     c* cappario DPD per verificare che esista altrimenti devo mantenere
122820160302     c* EEX
122830160303    1c                   if        (not *in12 or *in15)
122840160303    2c                   select
122850160303   WHc                   when      w_aDpd='S'
122860160302     c                   exsr      sr_tisie3
122870160303    3C                   IF        Osie3err <> ' '
122880160302     c                   eval      w_aDpd='N'
122890160303     c                   clear                   comlna
122900160303   x3c                   else
122910160302     C* IMPOSTO LNA DPD SE NON 'C'E'
122920160302     C                   Z-ADD     DESLAD        COMLNA
122930160303    3c                   endif
122940160303   WHc                   when      w_aDpd='N'
122950160303     c                   clear                   comlna
122960160303    2c                   endsl
122970160303     c* Se eseguirò instradamento forzato a DPD
122980160303     c* Ripeto il controllo obbligatorietà p.iva destinatario già fatto
122990160303     c* in prima videata
123000160303     c                   if        w_aDpd='S' and
123010160303     c                             vidpid=*blanks and desefd<>*blanks
123020160303     C                   MOVEL     ERR(88)       VIDMSG
123030160303     c                   eval      vidmsg=%trim(vidmsg)+'; F12=x inserirla'
123040160303     C                   SETON                                        90
123050160303     C                   GOTO      ENDC02
123060160303     c                   endif
123070160324     c* Si è deciso di non memorizzare mai mail e cell per sped eex per
123080160324     c* le quali si forza l'instradamento a dpd e quindi non servono più
123090160324     c* le seguenti specifiche
123100160324     c****               if        wemdest<>*blanks and wdesie='E'
123110160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
123120160324     c****               clear                   wemdest
123130160324     c****               endif
123140160324     c****               if        wsms<>*blanks and wdesie='E'
123150160324     c****                         and a_§ogntw<>'DPD' and w_aDpd<>'S'
123160160324     c****               clear                   wsms
123170160324     c****               endif
123180160303    1c                   endif
123190160302
123200000321     C* SE DPD PAESE EFTA DA DPD
123210020319     C     A_§OGNTW      IFEQ      'DPD'
123220020204     C     VIDDPD        OREQ      'D'
123230160224     C     w_aDpd        OREQ      'S'
123240000321     C                   MOVEL     DESEFD        WEFT
123250000321     C                   ELSE
123260020213     c     A_§ogntw      ifeq      'FED'
123270020201     c     viddpd        oreq      'F'
123280020130     c                   movel     deseff        weft
123290020130     c                   else
123300000321     C                   MOVEL     DESEFT        WEFT              1
123310000321     C                   ENDIF
123320020130     C                   ENDIF
123330000321     C**
123340980219     C* SE VARIATO IMPORTO C/A LO SALVO
123350980219     C     *IN11         IFEQ      *ON
123360980219     C                   MOVEL     '1'           WIN11             1
123370980219     C                   ENDIF
123380980219     C* SE VARIATO IMPORTO ME LO SALVO
123390980219     C     *IN88         IFEQ      *ON
123400980219     C                   MOVEL     '1'           WIN88             1
123410980219     C                   ENDIF
123420940825     C***
123430940825     C*** MITTENTE ***
123440940825    1C     *IN02         IFEQ      *OFF
123450970703     C                   MOVEL     VIDRSM        I14RSC
123460970703     C                   CLEAR                   I14RS2
123470970703     C                   MOVEL     VIDINM        I14IND
123480970703     C                   MOVEL     VIDLOM        E14LOC
123490970703     C                   MOVEL     VIDPIM        E14PIP
123500970703     C                   MOVEL     VIDPRM        E14PRV
123510970703     C                   MOVEL     VIDNZM        E14NAR
123520970703     C                   MOVEL     VIDCAM        E14CAP
123530970704     C                   MOVEL     'M'           WCLI
123540061110     c   22              movel     vidcdf        wcdf
123550071023     c   22              movel     vidpim        wiva
123560970704     C                   EXSR      CTRIND
123570941020     C*
123580941020     C* CAMPI CHE POSSO AVER IMPOSTATO
123590970703     C                   MOVEL     E14LOC        VIDLOM
123600970703     C                   MOVEL     E14PIP        VIDPIM
123610970703     C                   MOVEL     E14PRV        VIDPRM
123620970703     C                   MOVEL     E14NAR        VIDNZM
123630970703     C                   MOVEL     E14CAP        VIDCAM
123640061109     C*
123650061109     c* Se errore sulla partita iva , visualizzo messaggio
123660061109     c                   if        xcfivaflg < *zeros
123670120504     c                   if        wcdf=*blanks OR %subst(wcdf:12:1)=' '
123680071023     c                   z-add     07            h2riga
123690071022     c                   else
123700071023     c                   z-add     08            H2riga
123710071022     c                   endif
123720061109     c                   z-add     64            H2colo
123730061109     c                   endif
123740970704     C*
123750970704     C     WEMFOR        IFEQ      '1'
123760970704     C     *IN90         OREQ      *ON
123770970704     C                   GOTO      ENDC02
123780970704     C                   ENDIF
123790040917     c* Segnalazione se inserito mittente estero
123800040917     c     wmitie        ifeq      'E'
123810040917     c     wcontmit      andeq     *blanks
123820040917     c                   movel     '1'           wcontmit
123830040917     c                   seton                                        90
123840040917     c                   z-add     7             h2riga
123850040917     c                   z-add     49            h2colo
123860040917     c                   movel     ERR(283)      vidmsg
123870040917     c                   goto      endc02
123880040917     c                   endif
123890061110     C
123900061110     C** SE PREPAGATO 8888, CERCO IL CODICE FISCALE SE NON INSERITO
123910120503     C   22              IF        VIDCCM=8888 AND VIDNZM=*BLANKS AND
123920120504     C                             (VIDCDF=*BLANKS or vidpim=*blanks)
123930120503     C                   EXSR      CALLYCO
123940120503     C                   ENDIF
123950970704     C**
123960950303     C* SE BOLLA DIRETTA ALL'ESTERO --> P.IVA OBBLIGATORIA
123970120515     c* oppure obbligatorio il codice fiscale lungo 16
123980970704    2C     WDESIE        IFEQ      'E'
123990000321     C     WEFT          ANDNE     *BLANKS
124000050427     c     §3arbl        andne     'R'
124010120515     C***  VIDPIM        ANDEQ     *BLANKS
124020120515     c                   if        vidpim=*blanks and
124030120515     c                             (vidcdf=*blank or %subst(vidcdf:12:1)=' ')
124040950303     C                   MOVEL     '1'           WEMFOR
124050950303     C                   SETON                                        7090
124060120515     C                   MOVEL     ERR(346)      VIDMSG
124070950303     C                   GOTO      ENDC02
124080120515     c                   endif
124090000120    2C                   ENDIF
124100970704    1C                   ENDIF
124110930331     C***
124120930331     C*** NUMERO COLLI     ***
124130940928    1C     VIDNCL        IFNE      V1CNCL
124140940825     C                   MOVEL     ERR(45)       VIDMSG
124150940922     C                   SETON                                        4190
124160940920     C                   GOTO      ENDC02
124170940928    1C                   ENDIF
124180930331     C***
124190930331     C*** PESO ***
124200940928    1C   12V2CPKG        IFEQ      0
124210941110     C                   MOVEL     ERR(46)       VIDMSG
124220940922     C                   SETON                                        4290
124230940920     C                   GOTO      ENDC02
124240940928    1C                   END
124250030204      * Manutenzione di bolla con bancali
124260030204      * Se viene modificato il peso o il volume
124270030204      * emetto un msg info
124280030204     c                   If        *In12 and Not *In15                      and
124290030204     c                             (VidNba > *Zeros or VidNb2 > *Zeros)     and
124300030204     c                             (V2cPkg <> SavPkg or Vidvol <> SavVol)   and
124310110921     c                             wPkg = *Blanks                           and
124320110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
124330030204     c                   Eval      wPkg = '1'
124340030204     c                   Eval      VidMsg = Err(272)
124350030204     c                   If        V2cPkg <> SavPkg
124360030204     c                   Eval      *In42 = *On
124370030204     c                   EndIf
124380030204     c                   If        Vidvol <> SavVol
124390030204     c                   Eval      *In47 = *On
124400030204     c                   EndIf
124410030204     c                   Eval      *In90 = *On
124420030204     c                   GoTo      EndC02
124430030204     c                   EndIf
124440980402     C*
124450090609    1C** 12V2CPKG        IFGT      §QTPKB
124460090609     C**   V2CPKG        ANDNE     SAVPKG
124470090609     C**                 MOVE      V2CPKG        SAVPKG
124480090609     C***                CLEAR                   WPT1
124490980623     C* PREPARO MSG
124500090609     C***                MOVEA     ERR(52)       K78
124510090609     C***                MOVEL     §QTPKB        W006A             6
124520090609     C***                MOVEA     W006A         SKI(10)
124530090609     C***                Z-ADD     10            I                 3 0
124540090609     C***                EXSR      ABBL
124550090609     C***                MOVEA     SKI(10)       K78(34)
124560090609     C***                MOVE      §QTPKB        W001A
124570090609     C***                MOVEL     W001A         K78(41)
124580090609     C***                MOVEA     K78           VIDMSG
124590090609     C***                SETON                                        4290
124600090609     C***                GOTO      ENDC02
124610090609    1C**                 END
124620000509     C*
124630000509     C     V2CPKG        IFNE      SAVPKG
124640000509     C                   CLEAR                   WPT1
124650000509     C                   MOVE      V2CPKG        SAVPKG
124660000509     C                   ENDIF
124670000509     C*
124680930331     C* NON CONTROLLO SE SONO IN MANUTENZIONE PERCHE' NON ESISTE DISCOR
124690940928    1C  N12VIDPKG        IFNE      V2CPKG
124700940825     C                   MOVEL     ERR(38)       VIDMSG
124710940922     C                   SETON                                        4290
124720940920     C                   GOTO      ENDC02
124730940928    1C                   END
124740160322     c* Ricarica network bolla per FED se peso modificato
124750160322     c                   if        *in12 and
124760160322     c                             (a_§ogntw='FED' or viddpd='F')
124770160322     c                   clear                   trul27ds1
124780160322     c                   eval      i27tip=wtip
124790160322     c                   z-add     v2cpkg        vidpkg
124800160322     c                   exsr      riccar
124810160322     c                   movel     o27fie        wfie
124820160322     c                   endif
124830021120
124840021120     c                   If        *In12
124850021120      * O27fie = 'N' tariffa FedEx Documenti il peso non deve essere superiore
124860021120      * a quanto indicato in tabella "DFE"
124870021121     c                   If        O27Fie = 'N' and V2cPkg > §DfePkgD
124880021120     c                   Movel     Err(264)      VidMsg
124890021120     c                   Eval      *In90 = *On
124900021120     c                   Eval      *In42 = *On
124910021120     c                   GoTo      EndC02
124920021120     c                   EndIf
124930021120     c                   EndIf
124940930331     C***
124950941107     C*** CODICE TARIFFA ***
124960050921     C                   CLEAR                   fnlv59ds
124970050921     C                   MOVEL     'S'           ilv59con
124980050921     C                   MOVEL     'P'           ilv59tbo
124990040512      * se bolla monovaria pulisco il tipo bolla
125000040512     C                   IF        §3ASVA <> *BLANK
125010050921     C                   CLEAR                   ilv59tbo
125020050921     C                   movel     'P'           ilv59prp
125030040512     C                   ENDIF
125040040512
125050050921     C                   MOVEL     WKSC          ilv59ksc
125060050921     C                   MOVEL     KCI           ilv59kci
125070050921     C                   MOVEL     WFIE          ilv59fie
125080050921     C                   MOVEL     VIDCTR        ilv59ctr
125090050921     C                   MOVEL     BLPDSP        ilv59dsp
125100050921     C                   MOVEL     VIDTSP        ilv59tsp
125110060515     c* Se non  cambiato il cod tariffa nè il cod cliente e
125120060515     c*  sono in manutenzione, non controllo in assenza di tariffe
125130060515     c*  se tariffa bloccata o usata per altri network
125140060515     c                   if        wksc=bolksc and vidctr=bolctr
125150060515     C                             AND *IN12 AND NOT *IN15
125160060515     C                   EVAL      ILV59TA2='B'
125170060515     C                   ENDIF
125180150415     c* se pgm richiamato per bola di recupero tassata fino all'imponibile
125190150415     c* accetto anche tariffe bloccate
125200150415     c                   if        (*in12 and *in15 and savfpr<>*blanks
125210150415     c                              and §3arbl='R' and §lpimv>0)
125220150415     C                   EVAL      ILV59blo='S'
125230150415     c                   endif
125240941107     C*
125250050921     C                   CALL      'FNLV59R'
125260050921     C                   PARM                    fnlv59ds
125270050921     C                   MOVEL     olv59dfs      DEFCTR
125280941107     C*
125290941107     C* ATTIVATA LA RICERCA
125300050921     C     olv59err      IFEQ      'R'
125310050921     C                   MOVEL     olv59ctr      VIDCTR
125320941231     C                   SETON                                        83
125330941107     C                   MOVEL     '1'           WEMFOR
125340941107     C                   GOTO      ENDC02
125350941107     C                   ENDIF
125360941107     C* ERRORE
125370050921     C     olv59msg      IFNE      *BLANKS
125380050921     C                   MOVEL     olv59msg      VIDMSG
125390941231     C                   SETON                                        9083
125400941107     C                   GOTO      ENDC02
125410941107     C                   ENDIF
125420021120
125430021120      * Per bolla FedEx
125440021120If  1c                   If        VidDpd = 'F' or A_§OgNtw = 'FED'
125450160216     c****               Movel     O27Ctr        Wctr
125460021120      * --> Se non ho trovato tariffe
125470021121      *     Naturalmente questo può capitare solo per i clienti non codificati
125480021121      *     il pezzo che riguarda i clienti codificati lo lascio ma lo asterisco
125490021120If  2c                   If        Wtks <> 'S'
125500160322     c**                 Movel     Oc7ctrc       Wctr
125510021121      * ---> se ho richiamato il trul27r con i27tip = "FM" o "FD"
125520160322If  3c                   If        I27Tip = 'FM' or I27Tip = 'FD'
125530021121      * ---> oppure ho O27Fie = 'M'
125540021122     c                             or WFie = 'M'
125550160322     c                   clear                   trulc7ds
125560160322     c                   eval      IC7tFIE =  wfie
125570160322     c                   eval      IC7DTA  =  blpdsp
125580160322     c                   eval      IC7PKG  =  v2cpkg
125590160322     c                   eval      IC7tip  =  i27tip
125600160322     c                   call      'TRULC7R'
125610160322     c                   parm                    trulc7ds
125620021120      * la tariffa in bolla deve essere quella della cartello
125630160322     c                   Movel     Oc7ctrc       Wctr
125640160322If  4c                   If        VidCtr <> wctr
125650021120     c                   Eval      *In83 = *On
125660021120     c                   Eval      *In90 = *On
125670021120     c                   Movel     Err(262)      VidMsg
125680021120     c                   Goto      EndC02
125690021120    4c                   EndIf
125700021120    3c                   EndIf
125710021121      * ---> se ho richiamato il trul27r con i27tip <> "FM" e "FD"
125720160322If  3c                   If        I27Tip <> 'FM' and I27Tip <> 'FD'
125730021121      * ---> e O27Fie non è = 'M'
125740021122     c                             and WFie <> 'M'
125750021121     c                   Move      Wksc          Ksc8888
125760021120      * ----> cliente non codificato
125770021120If  4c                   If        Ksc8888 = 8888
125780021120      * richiamo il trul27r xchè la tariffa in bolla deve essere una delle
125790021120      * 2 cartello FedEx
125800160216     c***                clear                   trul27ds
125810160216     c***                Z-Add     VidPkg        I27Pkg
125820160216     c***                Movel     Vidctr        I27Ctb
125830160216     c***                ExSr      RicCar
125840160229     c***90              GoTo      EndC02
125850160229     c                   clear                   trulc7ds
125860160229     c                   eval      IC7tFIE = 'F'
125870160322     c                   Z-Add     V2cPkg        Ic7Pkg
125880160229     c                   Movel     Vidctr        Ic7Ctb
125890160229     c                   call      'TRULC7R'
125900160229     c                   parm                    trulc7ds
125910160216     c                   Movel     Oc7Ctrc       Wctr
125920021120If  5c                   If        VidCtr <> WCtr
125930021120     c                   Eval      *In83 = *On
125940021120     c                   Eval      *In90 = *On
125950021120     c                   Movel     Err(262)      VidMsg
125960021120     c                   Goto      EndC02
125970021120    5c                   EndIf
125980021120    4c                   EndIf
125990021120    3c                   EndIf
126000021120    2c                   EndIf
126010021120    1c                   EndIf
126020940922     C*
126030950103     C* MEMORIZZO SEMPRE IL CODICE TARIFFE E PROGRESSIVO
126040941107     C     WTKS          IFEQ      'S'
126050050921     C                   MOVEL     olv59prg      COMPRG
126060050921     C                   MOVEL     olv59ctr      COMCTR
126070050921     C                   MOVEL     olv59div      COMDIV            3
126080991028     C*
126090991028     C                   MOVEL     'CV'          COD
126100991028     C                   MOVEL(P)  COMDIV        KEY
126110991028     C                   EXSR      CTABEL
126120991028     C                   MOVEL     TBLUNI        DSCV
126130011113     C                   MOVEL     §CVDEC        COMDEC
126140950103     C*
126150950102     C* PER MANUTENZIONE CHAIN SULLA TARIFFA
126160950102     C   12
126170950102     CANN15KTAM2         CHAIN     TNTAM000                           30
126180950102     C   12
126190950102     CANN15*IN30         IFEQ      *ON
126200950102     C                   CLEAR                   WTKS
126210050914     c                   else
126220050914     C                   MOVEL     TAMflo        dsta01
126230950102     C                   ENDIF
126240950102     C*
126250950103     C* SE HO CAMBIATO IL CODICE TARIFFA, DEVO RIPROPORRE I CAMPI MODIF
126260940928    2C     VIDCTR        IFNE      SAVCTR
126270940922     C                   SETON                                        97
126280040610     c     atrbva        ifne      prri
126290040610     c                   movel     riul          atrbva
126300040610     c                   endif
126310950102     C* E' COME SE AVESSI MODIFICATO IL MITTENTE: RICARICO I DATI
126320080326     c                   eval      CambiaCTR='S'
126330050921     C                   MOVEL     'S'           ilv59ric
126340940922     C                   EXSR      CTNTAM
126350091210     c* verifico se impostare eventuali forzature flag DDT
126360091210     c                   EXSR      SR_FRZBAM
126370950102     C*
126380940922     C                   MOVEL     VIDCTR        SAVCTR
126390941231     C                   MOVEL     '1'           WEMFOR
126400950102     C                   CLEAR                   UND
126410041012     c* se destinatario supermercato/appuntamento ed in base a vidgva
126420041012     c* devo eventualmente aggiungere o togliere telefono,referente,tc1
126430041012     c* e tc2
126440041012     c     §ogntw        ifne      'PPT'
126450041012     c                   exsr      SR_IMPtc12
126460041012     c                   endif
126470940922     C                   GOTO      ENDC02
126480940928    2C                   ENDIF
126490930331     C*
126500940922    1C                   ENDIF
126510930331     C***
126520930331     C*** VOLUME ***
126530940928    1C     VIDVOL        IFGT      §QTVLB
126540980402    1C     VIDVOL        ANDNE     SAVVOL
126550980402     C                   MOVE      VIDVOL        SAVVOL
126560980623     C* PREPARO MSG
126570090609     C***                MOVEA     ERR(26)       K78
126580090609     C***                MOVEL     §QTVLB        W002A             2
126590090609     C***                MOVEA     W002A         SKI(14)
126600090609     C***                Z-ADD     2             I                 3 0
126610090609     C***                EXSR      ABBL
126620090609     C***                MOVEA     SKI(14)       K78(36)
126630090609     C***                MOVE      §QTVLB        W003A
126640090609     C***                MOVEA     W003A         K78(39)
126650090609     C***                MOVEA     K78           VIDMSG
126660090609     C***                SETON                                        4790
126670090609     C***                GOTO      ENDC02
126680940928    1C                   ENDIF
126690090609     c*
126700930331     C* CALCOLO VOLUME
126710050415     c* prima però se bancali 'O' devo controllare i bancali per avere
126720050415     c* il n.colli originali per calcolare correttamente il volume auto
126730050415     c* matico
126740050415     c                   if        %subst(vidgva:1:1)='O'
126750050415     c                   exsr      sr_CntPVBan
126760050415     c     wemfor        ifeq      '1'
126770050415     c                   goto      endc02
126780050415     c                   endif
126790050415     c                   endif
126800050913     c* Se previsto da tariffa richiedo obbligatorio l'inserimento del volum
126810050926     c                   select
126820050926     c* §taovb='M' --> obbligatorio l'inserimento del volume --> no calcolo
126830050926     c*                automatico
126840050926     c                   when      vidvol=0 and §taovb = 'M'
126850050913     C                   MOVEL     ERR(293)      VIDMSG
126860050913     C                   SETON                                        4790
126870050913     c                   goto      endc02
126880050926     c* §taovb='O' --> se volume non immesso errore forzabile --> calcolo
126890050926     c*                opzionale del volume automatico
126900050926     c                   when      vidvol=0 and §taovb = 'O' and fvol = ' '
126910050926     C                   MOVEL     ERR(293)      VIDMSG
126920050926     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
126930050926     C                   SETON                                        4790
126940050926     c                   eval      fvol = '1'
126950050926     c                   goto      endc02
126960050926     c                   endsl
126970050913     c*
126980930331     C                   EXSR      CALVOL
126990160406     c* se bolla che prevede instradamento forzato a dpd tolgo la forzatura se
127000160406     c* il volume suepera il max stabilito
127010160406     c                   if        (not *in12 or *in15) and
127020160406     c                             w_aDpd='S' and varvol>§16vld
127030160406     c                   eval      w_aDpd='N'
127040160406     c                   clear                   weft
127050160406     c                   clear                   comlna
127060160406     c                   endif
127070100607     c* controllo i limiti di colli peso e volume
127080100607     c
127090100607     c                   z-add     vidncl        wncl
127100100607     c                   z-add     v2cpkg        wpes
127110100607     c                   z-add     vidvol        wvol
127120100607     c                   if        vidvol=0
127130100607     c                   z-add     varvol        wvol
127140100607     c                   endif
127150100607     c                   eval      wvid='2'
127160100607     c                   exsr      sr_limtsp
127170100607     c                   if        *in90
127180100607     C                   MOVEL     wmsgtsp       VIDMSG
127190100607     C                   GOTO      ENDC02
127200100607     c                   endif
127210020531     C***
127220020531     C*** CONSEGNE PARTICOLARI ***
127230020531     c* N.B.: Ho spostato il controllo delle consegne particolari prima del
127240020531     c*       del richiamo all'fnlv13r perchè con la gestione dei supermerca
127250020531     c*       ti le devo passare a lv13 affinchè il tisi95r mi ritorni la
127260020531     c*       giusta lna e zona. Prima il controllo veniva fatto dopo il
127270020531     c*       controllo dei giorni di chiusura
127280020531     C                   MOVEL     *BLANKS       DB0DC1
127290020531     C                   MOVEL     *BLANKS       V2DTC1
127300020531    1C     VIDTC1        IFNE      ' '
127310020531     C                   MOVEL     '1P'          COD
127320020531     C* RICERCA
127330020531    2C     VIDTC1        IFEQ      '?'
127340020531     C                   EXSR      CX§TAB
127350020531     C                   MOVEL     §KEY          VIDTC1
127360020531     C                   MOVEL     §DES          V2DTC1
127370020531     C                   GOTO      ENDC02
127380020531    2C                   END
127390020531     C* CONTROLLO
127400020531     C                   MOVEL(P)  VIDTC1        KEY
127410020531     C                   EXSR      CTABEL
127420020531     C  N30              MOVEL     TBLUNI        DS1P
127430020531     C* ERRORE: INESISTENTE
127440020531    2C     *IN30         IFEQ      *ON
127450020531     C*         NON UTILIZZABILE IN PARTENZA
127460020531     C     §1PUPR        ORNE      'S'
127470020531     C     §ogntw        ANDNE     'PPT'
127480020531     C                   MOVEL     ERR(102)      VIDMSG
127490020531     C                   SETON                                        6390
127500020531     C                   GOTO      ENDC02
127510020531    2C                   ENDIF
127520020531     C*
127530020531     C                   MOVEL     §1PDES        DB0DC1
127540020531     C                   MOVEL     §1PDES        V2DTC1
127550120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
127560020531    2C     §ogntw        IFEQ      'PPT'
127570020531    3C     §1PFPC        IFNE      'E'
127580020531     C     §1PFPC        ANDNE     'P'
127590020531     C                   MOVEL     ERR(198)      VIDMSG
127600020531     C                   SETON                                        6390
127610020531     C                   GOTO      ENDC02
127620020531    3C                   ENDIF
127630020531    2C                   ENDIF
127640020531    1C                   ENDIF
127650020531     C***
127660020531     C                   MOVEL     *BLANKS       DB0DC2
127670020531     C                   MOVEL     *BLANKS       V2DTC2
127680020531    1C     VIDTC2        IFNE      ' '
127690020531     C                   MOVEL     '1P'          COD
127700020531     C* RICERCA
127710020531    2C     VIDTC2        IFEQ      '?'
127720020531     C                   EXSR      CX§TAB
127730020531     C                   MOVEL     §KEY          VIDTC2
127740020531     C                   MOVEL     §DES          V2DTC2
127750020531     C                   GOTO      ENDC02
127760020531    2C                   END
127770020531     C* CONTROLLO
127780020531     C                   MOVEL(P)  VIDTC2        KEY
127790020531     C                   EXSR      CTABEL
127800020531     C  N30              MOVEL     TBLUNI        DS1P
127810020531     C* ERRORE: INESISTENTE
127820020531    2C     *IN30         IFEQ      *ON
127830020531     C*         NON UTILIZZABILE IN PARTENZA
127840020531     C     §1PUPR        ORNE      'S'
127850020531     C     §ogntw        ANDNE     'PPT'
127860020531     C                   MOVEL     ERR(102)      VIDMSG
127870020531     C                   SETON                                        6490
127880020531     C                   GOTO      ENDC02
127890020531    2C                   ENDIF
127900120302     C* CONTROLLO SE AMMESSO PER LE POSTE O BRT
127910020531    2C     §ogntw        IFEQ      'PPT'
127920020531    3C     §1PFPC        IFNE      'E'
127930020531     C     §1PFPC        ANDNE     'P'
127940020531     C                   MOVEL     ERR(198)      VIDMSG
127950020531     C                   SETON                                        6490
127960020531     C                   GOTO      ENDC02
127970020531    3C                   ENDIF
127980020531    2C                   ENDIF
127990020531     C* NON POSSONO ESSERE UGUALI
128000020531     C     VIDTC1        IFEQ      VIDTC2
128010020531     C                   MOVEL     ERR(121)      VIDMSG
128020020531     C                   SETON                                        6490
128030020531     C                   GOTO      ENDC02
128040020531    2C                   ENDIF
128050020731     C* Non è possibile indicare contemporaneamente consegne particolari
128060051121     C*  'S' ed 'X' / 'S' ed 'A' / "S" e "P" / "X" e "P"
128070020731    2C                   IF           (VIDTC1 = 'X'  and  VIDTC2 = 'S')
128080020731     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'X')
128090050915     C                             or (VIDTC1 = 'A'  and  VIDTC2 = 'S')
128100050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'A')
128110050915     C                             or (VIDTC1 = 'S'  and  VIDTC2 = 'P')
128120050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'S')
128130051121     C*                            or (VIDTC1 = 'X'  and  VIDTC2 = 'A')
128140051121     C*                            or (VIDTC1 = 'A'  and  VIDTC2 = 'X')
128150050915     C                             or (VIDTC1 = 'X'  and  VIDTC2 = 'P')
128160050915     C                             or (VIDTC1 = 'P'  and  VIDTC2 = 'X')
128170020731     C                   movel     ERR(257)      VIDmsg
128180050915     c                   eval      %subst(vidmsg:67:1) = vidtc1
128190050915     c                   eval      %subst(vidmsg:73:1) = vidtc2
128200020731     C                   seton                                        6490
128210020731     C                   goto      ENDC02
128220020731    2C                   ENDIF
128230020531     C*
128240020531     C                   MOVEL     §1PDES        DB0DC2
128250020531     C                   MOVEL     §1PDES        V2DTC2
128260020531    1C                   ENDIF
128270150413
128280020531     c* Se destinatario disagiato o supermercato errore se non indicato
128290020531     c* in nessuno dei due campi di consegna particolare
128300040608     c* idem se destinatario con appuntamento
128310041012     c*
128320041012     c* Se particolarità varia="U" --> consegna ad uffici devo invece
128330041012     c* dare errore se immesso supermercato o appuntamento
128340041012     c                   if        %subst(vidgva:1:1)='U'
128350041013     c                             and (vidtc1='S' or vidtc1='A' or vidtc2='S'
128360041013     c                             or vidtc2='A')
128370041012     C                   MOVEl     ERR(285)      vidmsg
128380041012     C                   SETON                                        636490
128390041012     C                   GOTO      ENDC02
128400041012     c                   endif
128410060324     c* Se immesso appuntamento e richiesta data consegna tassativa
128420060324     c* ---> errore
128430060324     c                   if        vidtcr = *blanks and viddcr > *zeros  and
128440060324     c                             (vidtc1='A' or vidtc2='A')
128450060324     C                   MOVEl     ERR(298)      vidmsg
128460060324     C                   SETON                                        636490
128470060324     C                   GOTO      ENDC02
128480060324     c                   endif
128490041012     c*
128500041012     C***  wdisag        ifne      *blanks
128510060324     c                   if        (wdisag = 'X') OR
128520060324     c                             (wdisag='S' and %subst(VidGva:1:1)<>'U') OR
128530060324     c                             (Wdisag='A' and %subst(VidGva:1:1)<>'U' and
128540060324     c                             (viddcr=*zeros or vidtcr <> *blanks))
128550041012     c     wdisag        ifne      vidtc1
128560020531     c     wdisag        andne     vidtc2
128570020531     C                   MOVEa     ERR(255)      k78
128580020531     c                   select
128590020531     c     wdisag        wheneq    'X'
128600040608     c                   eval      w016ad = 'Disagiato     '
128610020531     c     wdisag        wheneq    'S'
128620040608     c                   eval      w016ad = '"Supermercato"  '
128630040608     c     wdisag        wheneq    'A'
128640040608     c                   eval      w016ad = 'con Appuntamento'
128650020531     c                   endsl
128660040608     C                   MOVEa     w016ad        k78(14)
128670020531     C                   MOVEA     K78           VIDMSG
128680020531     C                   SETON                                        636490
128690020531     C                   GOTO      ENDC02
128700041012     c                   endif
128710020531     c                   endif
128720090921     c
128730090921     c* Per tipo servizio "H" non accetto S o A
128740090921     c                   if        vidtc1='A' or vidtc1='S' or
128750090921     c                             vidtc2='A' or vidtc2='S'
128760090921     c                   if        vidtsp='H'
128770090921     C                   MOVEl     err(231)      VIDMSG
128780090921     C                   SETON                                        6390
128790090921     C                   GOTO      ENDC02
128800090921     c                   endif
128810090921     c                   endif
128820150304     c* BANCALI
128830150304     c* Se particolarita varia = 'O' il controllo seguente l'ho già
128840150304     c* fatto prima del calcolo del volume automatico
128850150304     c                   if        %subst(vidgva:1:1)<>'O'
128860150304     c                   exsr      sr_CntPVBan
128870150304     c     wemfor        ifeq      '1'
128880150304     c                   goto      endc02
128890150304     c                   endif
128900150304     c                   endif
128910940922     C***
128920070223     C*** CONTROLLO CAP
128930150304     c* se spedizione con bancali devo tenere conto anche del peso e volume dei
128940150304     c* bancali per il calcolo dell'instradamento
128950150304     c                   z-add     v2cpkg        v2cpkg_i
128960150304     c                   z-add     varvol        varvol_i
128970150304     c                   if        (not *in12 or (*in15 and not *in44)) and
128980150304     c                             %subst(VidGva:1:1) <> 'O'            and
128990150304     c                             §cliban=*blanks
129000150304     c                   if        vidnba>*zeros
129010150304     c                   Clear                   w0071
129020150304     c                   Clear                   w0053
129030150304     c     wTbaPkg1      Mult      VidNba        w0071
129040150304     c                   Add       w0071         v2cpkg_i
129050150304     c     wTbaVol1      Mult      VidNba        w0053
129060150304     c                   Add       w0053         varvol_i
129070150304     c                   endif
129080150304     c                   if        vidnb2>*zeros
129090150304     c                   Clear                   w0071
129100150304     c                   Clear                   w0053
129110150304     c     wTbaPkg2      Mult      VidNb2        w0071
129120150304     c                   Add       w0071         v2cpkg_i
129130150304     c     wTbaVol2      Mult      VidNb2        w0053
129140150304     c                   Add       w0053         varvol_i
129150150304     c                   endif
129160150304     c                   endif
129170911008      *
129180020531     C* SE CAMBIATO F.D. O PESO O VOLUME  o consegne particolari RICONTROLLO
129190940916    2C     VARFFD        IFNE      VIDFFD
129200150304     C     VARPKG        ORNE      V2CPKG_i
129210150304     C     VA2VOL        ORNE      VARVOL_i
129220020531     C     VArtc1        ORNE      vidtc1
129230020531     C     VArtc2        ORNE      Vidtc2
129240060110     c     D_varrsd      andeq     vidrsd
129250060110     c     D_varind      andeq     vidind
129260060110     c     D_varlod      andeq     vidlod
129270060110     c     D_varprd      andeq     vidprd
129280060110     c     D_varnzd      andeq     vidnzd
129290010214     C                   MOVE      VIDFFD        COMFFD
129300010214     C     COMFFD        IFEQ      'N'
129310010214     C                   MOVE      *BLANKS       COMFFD
129320010214     C                   ENDIF
129330930414     C                   MOVEL     0             DIE
129340940916     C*
129350930402     C* IN MANUTENZIONE SE SONO TORNATI COME IN BOLLA NON FACCIO NIENTE
129360940916    3C     *IN12         IFEQ      '1'
129370930402     C     *IN15         ANDEQ     '0'
129380940916     C*
129390940916     C* IN MANUTENZ.SE NOV =" " SIGNIFICA CHE IL CAP E' DI NUOVO UGUALE
129400940916     C*  A QUELLO DELLA BOLLA
129410940916     C     NOV           ANDEQ     ' '
129420010214     C     COMFFD        ANDEQ     BLPFFD
129430940928     C     V2CPKG        ANDEQ     BLPPKB
129440940928     C     VARVOL        ANDEQ     BLPVLB
129450020531     C     vidtc1        ANDEQ     BLPtc1
129460020531     C     vidtc2        ANDEQ     BLPtc2
129470060110     c     vidrsd        andeq     blprsd
129480060110     c     vidind        andeq     blpind
129490060110     c     vidlod        andeq     blplod
129500060110     c     vidprd        andeq     blpprd
129510060110     c     vidnzd        andeq     blpnzd
129520930402     C                   MOVEL     BLPZNC        VARZNC
129530940916   X3C                   ELSE
129540920427     C                   MOVEL     0             QUA
129550100209     C                   MOVEL     0             QUAH
129560930406     C                   MOVEL     '1'           NOV
129570940916    3C                   END
129580940916    2C                   END
129590930402     C*
129600910129     C* CONTROLLO IN PAESARIO LA LNA
129610940916    2C     QUA           IFNE      NUMFOR
129620910801     C*
129630930401     C                   MOVEL     VIDFFD        VARFFD
129640150304     C                   MOVEL     V2CPKG_i      VARPKG
129650150304     C                   MOVEL     VARVOL_i      VA2VOL
129660020531     C                   MOVEL     Vidtc1        VArtc1
129670020531     C                   MOVEL     Vidtc2        VArtc2
129680060110     C                   MOVEL     Vidrsd        D_VArrsd
129690060110     C                   MOVEL     Vidind        D_VArind
129700060110     C                   MOVEL     Vidlod        D_VArlod
129710060110     C                   MOVEL     Vidprd        D_VArprd
129720060110     C                   MOVEL     Vidnzd        D_VArnzd
129730940919     C*
129740970704     C                   CLEAR                   DSSI95
129750970708     C                   CLEAR                   DSLV13
129760970707     C                   CLEAR                   W2LN
129770970704     C                   MOVEL     VIDNZD        I95NAR
129780970704     C                   MOVEL     VIDCAD        I95CAP
129790970704     C                   MOVEL     VIDLOD        I95LOC
129800970704     C                   MOVEL     VIDPRD        I95PRV
129810970704     C                   MOVEL     VIDFFD        I95FFD
129820010214     C     VIDFFD        IFEQ      'N'
129830010214     C                   MOVE      *BLANKS       I95FFD
129840010214     C                   ENDIF
129850131003     c* Se per il cliente è presente personalizzazione instradamento merce
129860131003     c* imposto peso e volume medio al posto del peso e volume della sped.
129870150304     C                   Z-ADD     V2CPKG_i      I95LKG
129880131003     c                   if        n_§clipsm>0
129890131003     C                   Z-ADD     n_§clipsm     I95LKG
129900131003     c                   endif
129910980219     C* PASSO IL VOLUME AL CALCOLO DELLA LNA SOLO SE NON E' CLIENTE B
129920980219     C*  O E' CLIENTE B CON VOLUME REALE
129930980219     C     VIDNRS        IFEQ      0
129940980219     C     VIDFVR        OREQ      'R'
129950150304     C                   Z-ADD     VARVOL_i      I95LMC
129960131003     c                   if        n_§clivlm>0
129970131003     C                   Z-ADD     n_§clivlm     I95Lmc
129980131003     c                   endif
129990980219     C                   ENDIF
130000000623     C** SE BOLLA POSTA DEVO PASSARE LNP AL POSTO DI TFP
130010020319     C     §ogntw        IFEQ      'PPT'
130020000623     C                   Z-ADD     VIDLNP        I95TFP
130030000623     C                   ELSE
130040000623     C                   Z-ADD     COMTFP        I95TFP
130050000623     C                   ENDIF
130060000623     C*
130070970704     C     VIDTSP        IFNE      *BLANKS
130080970704    1C                   MOVEL     VIDTSP        I95TSP
130090970704     C                   ELSE
130100970704     C* LO PRENDO DA TARIFFA
130110970704     C                   MOVEL     COMTSP        I95TSP
130120970704     C                   ENDIF
130130131003     c                   if        §clitspf<>*blanks
130140131003     c                   movel     §clitspf      i95tsp
130150131003     c                   endif
130160971201     C     §3AFCA        IFNE      0
130170971201     C                   MOVEL     'S'           I95FCA
130180971201     C                   ENDIF
130190971201     C                   MOVEL     FLGTB1        I95TPO
130200970704     C                   MOVEL     '7'           I95TCN
130210970714     C                   MOVEL     BLPDSP        I95DAT
130220980602     C                   MOVEL     'S'           I95FRE
130230020212     c* se network fedex passo flag apposito per dire di prendere i dati
130240020212     c* dalla tabella della nazione
130250020213     c     A_§ogntw      ifeq      'FED'
130260020212     c     viddpd        oreq      'F'
130270020212     c     wdesie        andeq     'E'
130280020212     c                   movel     'S'           i95fi1
130290020212     c                   endif
130300020531     c*
130310020531     c                   movel     vidtc1        i95fi2
130320020531     c                   move      vidtc2        i95fi2
130330131003     c                   if        (vidtc1='S' or vidtc2='S')
130340131003     c                             and §clisup='N'
130350131003     c                   if        vidtc1='S'
130360131003     c                   movel     ' '           i95fi2
130370131003     c                   else
130380131003     c                   move      ' '           i95fi2
130390131003     c                   endif
130400131003     c                   endif
130410970704     C*
130420970704     C                   CALL      'FNLV13R'
130430970708     C                   PARM                    KPJBA
130440970708     C                   PARM                    DSLV13
130450970708     C                   PARM                    DSSI95
130460060105     c*
130470150128     c                   move      o95loc        wLocNorm
130480060105     c                   move      o95lna        d_o95lna
130490060105     c                   move      o95znc        d_o95znc
130500060105     c                   move      o952ln        d_o952ln
130510111201     c* EVENTUALE FORZATURA LINEA DI ARRIVO: non valida per i disk B e
130520111201     c* le bolle di reso
130530111201     c                   if        §1bfg6<>'C' and
130540160421     c                             (vidfbr <> 'S' and *in44 = *off)
130550111201     c* .... Forzatura da archivio destinatari particolari
130560111201     c                   if        §dstlna > *zeros
130570060105     c                   movel     §dstlna       d_o95lna
130580060105     c                   clear                   d_o95znc
130590060105     c                   clear                   d_o952ln
130600060105     c                   if        §dstznc >= *zeros
130610060105     c                   movel     §dstznc       d_o95znc
130620060105     c                   endif
130630060105     c                   endif
130640120615     c* .... Forzatura da tabella "FLB/FLA"
130650120615     c* Forzatura linea di arrivo per codice cliente mittente o per linea di p.
130660120615     c                   clear                   trulflbds
130670120615     c                   movel     d_o95lna      iflblna
130680120615     c                   move      vidlnp        Iflblnp
130690120615    2c                   if        vidccm<>9999 and vidccm<>8888
130700120614     c                   move      vidccm        iflbccm
130710120615    3C     VIDFLC        IFEQ      0
130720120614     C                   MOVEL     VIDLNP        iflbccm
130730120614     C                   ELSE
130740120614     C                   MOVEL     VIDFLC        iflbccm
130750120614    3C                   ENDIF
130760120615    2c                   endif
130770120614     c                   call      'TRULFLBR'
130780120614     c                   parm                    trulflbds
130790120615    2c                   if        Oflblfz>*zeros
130800120615     c                   move      OflbLFZ       d_o95lna
130810120615    2c                   endif
130820111201     c                   endif
130830160224
130840930409     C*
130850110217     C* L I N E A    D I    A R R I V O    N O N    I M M E S S A
130860110217     c*     I T A L I A    O    E U R O E X P R E S S
130870110217     C
130880940916     C*  LA PRENDO DA CAPPARIO
130890000121    3C     VIDLNA        IFLE      *ZEROS
130900000121     C     VIDDPD        ANDEQ     ' '
130910160224     c     w_aDpd        andne     'S'
130920000121    3C     VIDLNA        ORLE      *ZEROS
130930000121     C     WDESIE        ANDEQ     'I'
130940970711     C                   CLEAR                   WMSGLN
130950970711     C                   CLEAR                   WMSGZO
130960970711     C**
130970060105     C                   MOVEL     d_o95lna      COMLNA
130980060105     C                   MOVEL     d_o952ln      W2LN
130990110217     c
131000111123     c* Controlli di base della linea di arrivo
131010110217     c                   movel     comlna        wlna
131020110217     c                   exsr      CTRLNA_Base
131030110217     c
131040110217     c                   if        *in90
131050110217     C                   GOTO      ENDC02
131060160411     c                   seton                                        40
131070110217     c                   endif
131080940916     C* Z O N A:
131090940916     C* 1) IMMISSIONE E DISK CLIENTI--> PRENDO SEMPRE
131100910801     C  N12
131110970704     COR 12
131120060105     C****AN 15              MOVEL     O95ZNC        VARZNC
131130060105     CAN 15              MOVEL     d_o95znc      VARZNC
131140940916     C* 2) MANUTENZIONE --> SE CAMBIATO CAP O FD O ZONA=0 RIPRENDO
131150940916     C   12
131160940916    4CANN15NOV           IFEQ      '1'
131170930402     C     VIDZNC        OREQ      0
131180060105     C                   MOVEL     d_o95znc      VARZNC
131190940916    4C                   END
131200910129     C*
131210940916   X3C                   ELSE
131220970711     C                   CLEAR                   WMSGLN
131230970711     C                   CLEAR                   WMSGZO
131240930401     C*
131250940916     C* L I N E A   D I   A R R I V O           I M M E S S A
131260110217     C*   N O N   C O N G R U E N T E  CON QUELLA DEL CAPPARIO ITALIA O EUROEXPR
131270110217     C*  OPPURE LINEA DI ARRIVO   D P D
131280110217     C*  OPPURE LINEA DI ARRIVO   F E D E X
131290110217     C
131300060105    4C     d_o95lna      IFNE      COMLNA
131310020204    5C     VIDDPD        OREQ      'D'
131320000222     C     WDESIE        ANDEQ     'E'
131330020319     C     A_§OGNTW      OREQ      'DPD'
131340160224     c     w_aDpd        oreq      'S'
131350020201    5C     VIDDPD        OREQ      'F'
131360020201     C     WDESIE        ANDEQ     'E'
131370020213     C     A_§OGntw      OREQ      'FED'
131380030516      * se linea di partenza 102 da conferma bolla clienti non devo
131390030516      * dare incongruenza
131400030516  5aac                   If        (vidlnp <> 102 and *in12 and *in15)
131410030516     c                             or not *in12 or not *in15
131420000222     C**
131430000120     C* SE FORZATA LNA DPD, NON DEVO DARE INCONGRUENZA
131440020204    5C     VIDDPD        IFEQ      'D'
131450000121     C     WDESIE        ANDEQ     'E'
131460020319     C     A_§OGNTW      OREQ      'DPD'
131470160224     C     w_aDpd        OREQ      'S'
131480020201     C     VIDDPD        oreq      'F'
131490020201     C     WDESIE        ANDEQ     'E'
131500020213     C     A_§OGntw      OREQ      'FED'
131510000218     C**
131520020204    6C     VIDDPD        IFEQ      'D'
131530020201     C     WDESIE        ANDEQ     'E'
131540020319     C     A_§OGNTW      OREQ      'DPD'
131550160224     C     w_aDpd        OREQ      'S'
131560000229     C* PER DPD IMPOSTO ZONA 00 PER RESI ZONA 80
131570000218     C     VIDFBR        IFEQ      'S'
131580000229     C                   MOVEL     80            VARZNC
131590000218     C                   ELSE
131600000218     C                   MOVEL     00            VARZNC
131610000218     C                   ENDIF
131620160224     c                   exsr      sr_tisie3
131630060703     c*SE ERRORE DA CAPPARIO DPD, verificare
131640060615     C     Osie3err      IFNE      ' '
131650060615     C                   MOVEL     ERR(189)      VIDMSG
131660061011     C                   EVAL      CAPPARIODPD='S'
131670061011     c                   movel     vidcad        savcapdpd
131680060615     C                   SETON                                        4090
131690060615     C                   ENDIF
131700070515     c*****              endif
131710020201   x6c                   else
131720060105     c                   movel     D_o95lna      comlna
131730060105     c                   movel     d_o95znc      varznc
131740020201    6c                   endif
131750110217     c
131760110217     c* Controlli di base della linea di arrivo
131770110217     c                   movel     comlna        wlna
131780110217     c                   exsr      CTRLNA_Base
131790110217     c
131800110217     c                   if        *in90
131810110217     C                   GOTO      ENDC02
131820110217     c                   seton                                        40
131830110217     c                   endif
131840110217     c
131850000120  X 5C                   ELSE
131860970711     C**
131870940916     C* NON E' FERMO DEPOSITO
131880010214    6C     VIDFFD        IFEQ      'N'
131890010220     C     VIDFFD        OREQ      ' '
131900000704     C* NON CONTROLLO PER BOLLE POSTE DISK B
131910020319   6Ac     §ogntw        IFNE      'PPT'
131920000704     C     §1BFG6        ORNE      'C'
131930000704     C     §1BFG2        ORNE      'S'
131940940916     C* NON SEGNALO ERRORE SE BOLLA DA DISP MITTENTE
131950000120    7C     WFPR          IFNE      'I'
131960970711     C     WMSGLN        ANDEQ     ' '
131970030627      * non segnalo errore se bolle di recupero
131980100209      * non segnalo errore se prima lo avevo dato per tipo servizio H
131990100209If  8c                   If        §3arbl <> 'R'  and (vidtsp='H' or
132000100209     c                             quah=0)
132010100208     c
132020100208     c* Messaggio diverso per tipo servizio "H"
132030100210     c                   if        vidtsp='H'  and  §1bfg6='C'
132040100210     C                   MOVEL     ERR(80)       VIDMSG
132050100210     C                   sub       1             QUA
132060100210     C                   add       1             QUAH
132070100210     c                   else
132080100208     C                   MOVEL     ERR(90)       VIDMSG
132090100210    8c                   EndIf
132100100208
132110940916     C                   SETON                                        4090
132120030627    8c                   EndIf
132130000120    7C                   END
132140920427     C                   ADD       1             QUA
132150000704   6AC                   END
132160930409     C*
132170000120    6C                   END
132180910801     C* AZZERO LA ZONA
132190910801     C  N12
132200930401     COR 12
132210930401     CAN 15              Z-ADD     0             VARZNC
132220060829     c                   if        wfpr = 'G'
132230060829     c                   z-add     vidznc        varznc
132240060829     c                   endif
132250940916     C* IN MANUTENZIONE: se HO variato i dati --> AZZERO LA ZONA
132260000120     C   12
132270000120    6CANN15NOV           IFEQ      '1'
132280930401     C                   Z-ADD     0             VARZNC
132290940916     C*
132300000120   x6C                   ELSE
132310940916     C* SE CAMBIATA SOLO LA LINEA             --> AZZERO LA ZONA
132320000120    7C     SAVLNA        IFNE      VIDLNA
132330930401     C                   Z-ADD     0             VARZNC
132340910801     C                   MOVEL     '1'           NOV
132350940916     C*
132360000120   X7C                   ELSE
132370940916     C* SE NON HO CAMBIATO NULLA             -->LASCIO QUELLA CHE C'ERA
132380930402     C                   Z-ADD     BLPZNC        VARZNC
132390930402     C                   MOVEL     ' '           NOV
132400000120    7C                   ENDIF
132410910801     C*
132420000120    6C                   ENDIF
132430980806     C**
132440980806     C* SE LNA ESTERA ANCHE SE FORZO LA LINEA INCONGRUENTE COL CAP
132450980806     C*  PRENDO LA ZONA
132460020319     c     A_§ogntw      ifeq      'EEX'
132470980806     C  N12
132480980806     COR 12
132490060105     CAN 15              Z-ADD     d_o95znc      VARZNC
132500980806     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
132510000120     C   12
132520000120    7CANN15NOV           IFEQ      '1'
132530980806     C     VIDZNC        OREQ      0
132540060105     C                   Z-ADD     d_o95znc      VARZNC
132550000120    7C                   END
132560000120    6C                   ENDIF
132570000120    5C                   ENDIF
132580970711     C* PER ERRORE ESCO
132590970711     C   90              GOTO      ENDC02
132600030516
132610030516  5aac                   endif
132620921029     C*
132630940928   X4C                   ELSE
132640940916     C*
132650110217     C* L I N E A   D I   A R R I V O           I M M E S S A
132660110217     c*     I T A L I A    O    E U R O E X P R E S S
132670940916     C*  LINEA     CONGRUENTE CON QUELLA DEL CAPPARIO --> PRENDO ZONA
132680960208     C* LINEA ORIGINALE SE SECONDA LINEA DISTRIBUZIONE
132690060105     C                   MOVEL     d_o952ln      W2LN              1
132700060829     C  N12
132710060829     COR 12
132720060829     CAN 15              Z-ADD     d_o95znc      VARZNC
132730060829     c                   if        *in12='1' and *in15='1' and
132740060829     c                                 wfpr='G' and vidznc>0
132750060829     C                   Z-ADD     vidznc        VARZNC
132760060829     c                   endif
132770930402     C* MANUTENZIONE: SE CAMBIATO CAP O FD O ZONA A 0 RIPRENDO
132780940916     C   12
132790940916    5CANN15NOV           IFEQ      '1'
132800930402     C     VIDZNC        OREQ      0
132810060105     C                   Z-ADD     d_o95znc      VARZNC
132820940916    5C                   END
132830970711     C* DISK CLI
132840970711     C                   MOVEL     'N'           WMSGLN            1
132850970714     C                   MOVEL     O95ZNC        WEMZNC
132860910801     C*
132870940916    4C                   ENDIF
132880940916    3C                   ENDIF
132890970618    2C                   ENDIF
132900940916     C*
132910020917     C* PER DISK CLI CON SERIE PRENDO ZONA DA FIVAB
132920950410     C* --> SEGNALO PERO' SE E' DISCORDANTE CON QUELLA CALCOLATA
132930950421     C*     SEMPRE SE NON SI TRATTA DI UNA ZONA PRESA DALL'OLTRE O FD
132940970618     C   12
132950970618    2CAN 15VIDNRS        IFNE      0
132960950410     C*
132970970711    3C     §LPZNC        IFNE      WEMZNC
132980020319     C     §ogntw        ANDNE     'PPT'
132990950410     C     QUI           ANDEQ     0
133000970711     C     WMSGLN        ANDEQ     'N'
133010970711     C     WMSGZO        ANDEQ     ' '
133020030515      * non controllo per linea di partenza 102
133030030515     c     §lplnp        Andne     102
133040950410     C                   MOVEA     ERR(115)      K78
133050970711     C                   MOVEL     WEMZNC        W002A             2
133060950410     C                   MOVEA     W002A         K78(49)
133070950410     C                   MOVEL     §LPZNC        W002A             2
133080950410     C                   MOVEA     W002A         K78(13)
133090950410     C                   MOVEA     K78           VIDMSG
133100950410     C                   SETON                                        5790
133110950410     C                   MOVEL     1             QUI
133120950410     C                   GOTO      ENDC02
133130970618    3C                   ENDIF
133140950410     C*
133150930401     C                   Z-ADD     §LPZNC        VARZNC
133160970618    2C                   ENDIF
133170980410     C*
133180980410     C   12
133190980410    2CANN15§1BFG6        IFEQ      'C'
133200980410     C     §1BFG2        ANDEQ     'S'
133210980410     C     NOV           ANDEQ     '1'
133220980410     C*
133230980410    3C     BLPZNC        IFNE      WEMZNC
133240020319     C     §ogntw        ANDNE     'PPT'
133250980410     C     QUI           ANDEQ     0
133260980410     C     WMSGLN        ANDEQ     'N'
133270980410     C     WMSGZO        ANDEQ     ' '
133280980410     C                   MOVEA     ERR(115)      K78
133290980410     C                   MOVEL     WEMZNC        W002A             2
133300980410     C                   MOVEA     W002A         K78(49)
133310980410     C                   MOVEL     BLPZNC        W002A             2
133320980410     C                   MOVEA     W002A         K78(13)
133330980410     C                   MOVEA     K78           VIDMSG
133340980410     C                   SETON                                        5790
133350980410     C                   MOVEL     1             QUI
133360980410     C                   GOTO      ENDC02
133370980410    3C                   ENDIF
133380980410     C*
133390980410     C                   Z-ADD     BLPZNC        VARZNC
133400980410    2C                   ENDIF
133410930402     C***
133420930402     C*** CONTROLLO ZONA IN MANUTENZIONE ***
133430930409     C* SE MODIFICATA E SE NON RICALCOLATA DEVE ESISTERE NELLA TAB. 03
133440940916     C   12
133450940916    2CANN15NOV           IFNE      '1'
133460930409     C     BLPZNC        ANDNE     VIDZNC
133470930409     C     VIDZNC        ANDGT     0
133480930402     C                   MOVEL     VIDZNC        VARZNC
133490930406     C*
133500930409     C                   MOVEL     '03'          COD
133510930409     C                   MOVEL     COMLNA        ALF5              5
133520930409     C                   MOVE      VIDZNC        ALF5
133530940919     C                   MOVEL(P)  ALF5          KEY
133540930409     C*
133550930708     C                   EXSR      CTABEL
133560940928    3C     *IN30         IFEQ      *ON
133570940916     C                   MOVEL     ERR(61)       VIDMSG
133580940922     C                   SETON                                        5790
133590940920     C                   GOTO      ENDC02
133600940916    3C                   ENDIF
133610940916    2C                   ENDIF
133620930406     C*
133630150414     c* Controlli per EXPO
133640151119     c*                  if        vidtc1='Z' or vidtc2='Z'
133650151119     c*                  move      comlna        w003a
133660151119     c*                  select
133670150414     c* Errore se bolla con C/A
133680151119     c*                  when      §3afca=1
133690151119     C*                  movel     ERR(360)      VIDmsg
133700151119     C*                  seton                                        90
133710150414     c* errore se non è bolla FRANCO
133720151119     c*                  when      flgtb1<>'F'
133730151119     C*                  movel     ERR(361)      VIDmsg
133740151119     C*                  seton                                        90
133750150414     c* errore se lna non in tabella
133760151119     c*                  when      %lookup(w003a:fil_expo)=0
133770151119     C*                  movel     ERR(362)      VIDmsg
133780151119     c*                  eval      vidmsg=%trim(vidmsg) + ' ' + w003a
133790151119     C*                  seton                                        90
133800151119     c*                  endsl
133810151119     c*                  if        *in90
133820151119     c*                  if        vidtc1='Z'
133830151119     c*                  seton                                        63
133840151119     c*                  else
133850151119     c*                  seton                                        64
133860151119     c*                  endif
133870151119     C*                  goto      ENDC02
133880151119     c*                  endif
133890151119     c*                  endif
133900960320     C***
133910960320     C*** PER LNA 102 OBBLIGATORIO IL C/S
133920000706    1C     COMLNA        IFEQ      102
133930960320     C     §3ARBL        ANDNE     'C'
133940960320     C                   SETON                                        4090
133950960320     C                   MOVEL     ERR(125)      VIDMSG
133960160303     C                   GOTO      ENDC02
133970000706    1C                   ENDIF
133980991206      **
133990110217      ** Aggancio AZORG di LNA per prednere dati
134000110217      ** Es: lo tolgo perchè lo fa già sopra avenfo unificato i controllo
134010110217      **     con la CTRLNA_Base non serrve più
134020110217      **
134030110217    1C**   VIDLNA        IFLE      *ZEROS
134040110217     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
134050110217     C**                 MOVEL     ORGDE3        A_OG143
134060110217     C**                 MOVEL     ORGDF0        A_OG150
134070110217    1C**                 ENDIF
134080991206      *
134090991206      * PER LNA DPD OBBLIGATORIO 1 COLLO
134100020319     C     A_§OGNTW      IFEQ      'DPD'
134110000120     C     VIDNCL        IFNE      1
134120991206     C                   SETON                                        4190
134130991206     C                   MOVEL     ERR(179)      VIDMSG
134140991206     C                   GOTO      ENDC02
134150991206     C                   ENDIF
134160000124     c* controllo numero parcel dpd doppio
134170000308     C*  NON LO CONTROLLO SE DA CTM NON HA SEGNACOLLI (PER BOLLA
134180000308     C*  RECUPERO O PER BOLLA LEGATA I CUI SEGNACOLLI SONO SULLA MAMMA)
134190000203     C     §1BFG8        IFEQ      'S'
134200060615     C                   move      V7CNPR        WNPR
134210000124     C                   EXSR      DPDDOP
134220000124     C     *IN90         IFEQ      *ON
134230000124     C                   SETON                                        41
134240000124     C                   MOVEL     ERR(190)      VIDMSG
134250000124     C                   GOTO      ENDC02
134260000124     C                   ENDIF
134270000203     C                   ENDIF
134280000120     C                   ENDIF
134290991213      * PER LNA O LNP DPD Massimo peso inseribile da tabella
134300020319     C     A_§OGNTW      IFEQ      'DPD'
134310020319     C     §OGNTW        OREQ      'DPD'
134320160411     c     *in44         andeq     *off
134330991214     C     V2CPKG        IFGT      §3IPKD
134340991213     C                   SETON                                        4290
134350991213     C                   MOVEA     ERR(180)      K78
134360991213     C                   MOVEL     §3IPKD        W006A             6
134370991213     C                   MOVEA     W006A         SKI(10)
134380991213     C                   Z-ADD     10            I                 3 0
134390991213     C                   EXSR      ABBL
134400991213     C                   MOVEA     SKI(10)       K78(53)
134410991213     C                   MOVE      §3IPKD        W001A
134420991213     C                   MOVEL     W001A         K78(60)
134430991213     C                   MOVEA     K78           VIDMSG
134440991213     C                   GOTO      ENDC02
134450991213     C                   ENDIF
134460991213     C                   ENDIF
134470991206      **
134480991203     C                   SETOFF                                       30
134490991203      *
134500991203     C                   SELECT
134510991203      *
134520060629      * IMPORT/EXPORT DPD  (import solo se in manutenzione e solo per
134530060629      * la visualizzazione)
134540991203      *  Premuto F18
134550020319     C     A_§OGNTW      WHENEQ    'DPD'
134560991203     C     *INKS         ANDEQ     *ON
134570060616     c     *in79         oreq      *on
134580060616     C     *INKS         ANDEQ     *ON
134590060616     c     *in12         andeq     *on
134600060616     c     *in15         andeq     *off
134610991203     C                   EXSR      GESD07
134620991203     C                   SETON                                        41
134630991203     C                   MOVEL     '1'           WEMFOR
134640991203     C                   GOTO      ENDC02
134650991203      *
134660991203      * EXPORT DPD
134670000307      *  Non premuto F18 e PARCEL non inserito. ESCLUDO I RECUPERI
134680020319     C     A_§OGNTW      WHENEQ    'DPD'
134690991203     C     *INKS         ANDEQ     *OFF
134700151104     C     V7CNPR        ANDEQ     *blanks
134710000308     C     §3ARBL        ANDNE     'R'
134720991203     C                   SETON                                        4190
134730991203     C                   MOVEL     ERR(175)      VIDMSG
134740991203     C                   GOTO      ENDC02
134750991203      *
134760991203      * SPEDIZIONE non ESTERO SDI E MITTENTE CON OBBLIGO AWB e non DPD
134770991203      * Premuto F18
134780991203     C     *INKS         WHENEQ    *ON
134790991203     C                   MOVEL     ERR(89)       VIDMSG
134800991203     C                   SETON                                        4190
134810991203     C                   GOTO      ENDC02
134820991203      *
134830991203     C                   ENDSL
134840940825     C***
134850910829     C*** RIFERIMENTO MITTENTE NUMERICO ***
134860940916    1C     VIDRMN        IFEQ      0
134870940825     C                   MOVEL     ERR(47)       VIDMSG
134880940922     C                   SETON                                        4390
134890940920     C                   GOTO      ENDC02
134900991130    1C                   ENDIF
134910970328     C***
134920970328     C*** FLAG D D T     ******
134930970408     C* PAESE CON ATTRAVERSAMENTO DOGANA: OBBLIGATORIO SI DDT
134940970408    1C     VIDBAM        IFEQ      'N'
134950000321     C     WEFT          ANDNE     ' '
134960970408     C                   MOVEL     ERR(140)      VIDMSG
134970970408     C                   SETON                                        7790
134980970408     C                   GOTO      ENDC02
134990970408     C                   ENDIF
135000101105     C* per Fedex : obbligatorio SI DDT
135010120523     c                   if        vidbam='N' and  §3arbl <>'R' and
135020101108     c                             (VidDpd = 'F' or a_§OgNtw = 'FED' )
135030101105     C                   MOVEL     ERR(335)      VIDMSG
135040101105     C                   SETON                                        7790
135050101105     C                   GOTO      ENDC02
135060101105     C                   ENDIF
135070970408     C* SE BOLLA DI RECUPERO, OBBLIGATORIO NO BAM
135080970408    1C     VIDBAM        IFEQ      'S'
135090970408     C     §3ARBL        ANDEQ     'R'
135100000321     C     WEFT          ANDEQ     ' '
135110020513     c     vidcbo        andne     'FO'
135120970408     C                   MOVEL     ERR(138)      VIDMSG
135130970408     C                   SETON                                        7790
135140970408     C                   GOTO      ENDC02
135150970408     C                   ENDIF
135160020507     C* SE BOLLA DI RECUPERO per bolle firmate, obbligatorio SI DDT
135170020507    1C     VIDBAM        IFEQ      'N'
135180020513     c     vidcbo        andeq     'FO'
135190020507     C                   MOVEL     ERR(254)      VIDMSG
135200020507     C                   SETON                                        7790
135210020507     C                   GOTO      ENDC02
135220020507     C                   ENDIF
135230970703     C* bolle CON OBBLIGO DDT DA CAPPARIO: SE NON E' RECUPERO ERRORE
135240970703     C*  SE IMMESSO NODDT
135250970408    1C     VIDBAM        IFEQ      'N'
135260970703     C     DESGDD        ANDEQ     'S'
135270970408     C     §3ARBL        ANDNE     'R'
135280081127     c     savfpr        andne     'G'
135290081127     c     savfpr        andne     'P'
135300150302     c     savfpr        andne     'B'
135310970328     C                   MOVEL     ERR(139)      VIDMSG
135320970328     C                   SETON                                        7790
135330970328     C                   GOTO      ENDC02
135340970408    1C                   ENDIF
135350041109     c* bolla con vax (con estensione ddt del cliente) errore se SI DDT
135360050211     c* solo se nazione e/o cap non prevedono l'obbligo del ddt si
135370050211     c                   if        §1bf16 = 'S' and vidbam = 'S' and
135380050211     c                             weft = *blanks and desgdd <> 'S'
135390041109     C                   MOVEL     ERR(287)      VIDMSG
135400041109     C                   SETON                                        7790
135410041109     C                   GOTO      ENDC02
135420041109     c                   endif
135430950303     C***
135440950303     C*** RIFERIMENTO MITTENTE ALFABETICO ***
135450950303     C* SE DESTINATARIO ESTERO -->  OBBLIGATORIO
135460950303     C     WDESIE        IFEQ      'E'
135470000321     C     WEFT          ANDNE     *BLANKS
135480950303     C     VIDRMA        ANDEQ     *BLANKS
135490950303     C                   MOVEL     '1'           WEMFOR
135500950303     C                   SETON                                          5890
135510950303     C                   MOVEL     ERR(110)      VIDMSG
135520950303     C                   GOTO      ENDC02
135530950303    1C                   ENDIF
135540021209      * Obbligatorio se è una bolla con consegna supermercato
135550030303      * ma non se è DPD
135560021209     c                   If        (VidTc1 = 'S' or VidTc2 = 'S')
135570021209     c                              and VidRma = *Blanks
135580030304     c                              and Not *In79 and wrma = *Blanks
135590021209     c                   Eval      Wemfor = '1'
135600021209     c                   Movel     Err(266)      VidMsg
135610021209     c                   Eval      *In58 = *On
135620021209     c                   Eval      *In90 = *On
135630021209     c                   GoTo      EndC02
135640021209     c                   EndIf
135650961111     C***
135660961111     C*** FLAG BOLLA RIENTRO
135670961111     C***
135680060920     c* se linea di arrivo dpd valida solo per resi ci deve essere
135690060920     c*  il flag
135700060921     c     viddpd        ifeq      'D'
135710060921     c     comlna        andeq     *zeros
135720060921     c     A_§ogNTW      oreq      'DPD'
135730060921     c* se però c'e' reso non do errore
135740060921     c                   if        o14lad<=*zeros and desred='S' and vidfbr<>'S'
135750060920     C                   SETON                                            90
135760060920     c                   z-add     20            h2riga
135770060920     c                   z-add     67            h2colo
135780060920     C                   MOVEL     ERR(157)      VIDMSG
135790060920     C                   GOTO      ENDC02
135800060920     c                   endif
135810060921     c                   endif
135820060920     c
135830961111     C     VIDFBR        IFNE      SAVFBR
135840961111     C                   MOVEL     VIDFBR        SAVFBR
135850961111     C                   CLEAR                   SED
135860961111     C                   ENDIF
135870090901     c*
135880090921     c* controllo se tipo servizio H accettabile x  linea di arrivo della bolla
135890090901     c*   tenendo conto dei tempi di trazione
135900090901     c                   if        vidtsp='H'
135910090901     c
135920100219     c                   clear                   UsaCass
135930090901     c                   exsr      ClsE98
135940090901     c
135950090922     c                   if        d98tcc<>10
135960100119     C                   SETON                                            90
135970090901     C                   MOVEL     ERR(57)       VIDMSG
135980100319     c* Se vengo da ORRM --> cancello il tipo servizio
135990100319     c                   if        wesORE='S'
136000100319     c                   movel     'N'           wesore
136010100319     c                   endif
136020090901     C                   GOTO      ENDC02
136030090901     c                   endif
136040100322     c* Se eiste FNORE --> dico che si può utilizzare
136050100322     c                   else
136060100322     c                   if        WesORE='N'
136070100322     c                   movel     'S'           wesore
136080100322     c                   endif
136090090901     c                   endif
136100060920     c*
136110900604     C*
136120900621     C*** CONTROLLO SEGNACOLLI DAL - AL ***
136130910118     C* SE FLAG STAMPA BOLLA E' "D" O "I" E PER BOLLE DI RECUPERO
136140910118     C*  OBBLIGATORIA LA NON IMMISSIONE
136150910117     C*
136160910118     C                   SETOFF                                       30
136170940825     C                   CLEAR                   WNOSEG
136180921019     C* NO SEGNACOLLO
136190930402     C* SE VENGO DA DISK CLIENTI SOLO SE E' BOLLA SENZA MAMMA
136200930402     C*  NEGLI ALTRI CASI SEMPRE
136210940825    1C     §1BFG8        IFEQ      'N'
136220930402     C*
136230940825    2C     *IN12         IFEQ      '1'
136240930402     C     *IN15         ANDEQ     '1'
136250940825     C*
136260940825    3C     §3ABCM        IFEQ      ' '
136270940825     C                   MOVEL     '1'           WNOSEG            1
136280940825    3C                   END
136290940825     C*
136300940825   X2C                   ELSE
136310940825     C                   MOVEL     '1'           WNOSEG            1
136320940825    2C                   END
136330940825    1C                   END
136340910805     C* NON SEQUENZIALI
136350940825    1C   12VIDFNS        IFEQ      'S'
136360940825     C                   MOVEL     '1'           WNOSEG            1
136370940825    1C                   END
136380910118     C*
136390940825    1C     WNOSEG        IFEQ      '1'
136400940825    2C     VIDNCD        IFGT      0
136410940825     C                   MOVEL     ERR(51)       VIDMSG
136420940922     C                   SETON                                        4590
136430940920     C                   GOTO      ENDC02
136440940825    2C                   END
136450910118     C*
136460940825    2C     VIDNCA        IFGT      0
136470940825     C                   MOVEL     ERR(51)       VIDMSG
136480940922     C                   SETON                                        4690
136490940920     C                   GOTO      ENDC02
136500940825    2C                   END
136510940825    1C                   END
136520960805     C* SE C'E' IL DETTAGLIO COLLI NON LI POSSO MODIFICARE
136530960805    1C     §1BFG7        IFEQ      'S'
136540980410     C     §1BFG6        ANDEQ     'C'
136550960805    2C     VIDNCD        IFNE      WNSNCD
136560960805     C     VIDNCA        ORNE      WNSNCA
136570960805     C                   MOVEL     ERR(127)      VIDMSG
136580960805     C                   SETON                                        4590
136590960805     C                   GOTO      ENDC02
136600960805    2C                   ENDIF
136610960805     C*
136620960805    1C                   ENDIF
136630910118     C*
136640940216     C*CAMBIO PORTO DIROTTAMENTO --> NON DO QUESTO ERRORE
136650940825     C* (44 ON )                     PERCHE' SEGNACOLLI SULLA MAMMA
136660940825     C  N44
136670940825    1CANN25WNOSEG        IFEQ      ' '
136680940825     C*
136690940825    2C     VIDNCD        IFEQ      0
136700940825     C                   MOVEL     ERR(51)       VIDMSG
136710940922     C                   SETON                                        4590
136720940920     C                   GOTO      ENDC02
136730940825    2C                   END
136740940916     C***
136750910117     C*
136760940825    3C     VIDNCA        IFNE      0
136770020315     C     VIDNCA        SUB       VIDNCD        COMNCL            8 0
136780900502     C                   ADD       1             COMNCL
136790900508     C                   ELSE
136800900508     C                   Z-ADD     1             COMNCL
136810940825    3C                   END
136820940825     C*
136830940825     C* CONTROLLO DIFFERENZA SEGNACOLLO DAL-AL CON NUMERO COLLI
136840940825    3C     COMNCL        IFNE      VIDNCL
136850940825     C                   MOVEL     ERR(45)       VIDMSG
136860940922     C                   SETON                                        4190
136870940920     C                   GOTO      ENDC02
136880940825    3C                   END
136890910117     C*
136900940825    1C                   END
136910910208     C*
136920940825     C* SE DEVO ATTRIBUIRE I SEGNACOLLI CONTROLLO CHE CI SIA LA NUMERAZ
136930991209     C                   CLEAR                   AAS
136940910208     C                   Z-ADD     9             CNU
136950930120     C                   MOVE      VIDLNP        COMLIN
136960930120     C                   MOVE      COMLNA        LIV2
136970930629     C     KNUF2         CHAIN(N)  FLNUF                              30
136980910508     C*
136990940916    1C     *IN30         IFEQ      *ON
137000940916    2C     *IN25         IFEQ      *ON
137010940825     C                   MOVEL     ERR(41)       VIDMSG
137020940922     C                   SETON                                        4590
137030940920     C                   GOTO      ENDC02
137040940916    2C                   ENDIF
137050940825     C                   Z-ADD     0             NUFRIN
137060940825     C                   Z-ADD     0             NUFRFI
137070940916    1C                   ENDIF
137080910208     C*
137090910208     C                   SETOFF                                       30
137100941021     C*
137110960926     C* LINEA SEGNACOLLO:
137120950525     C* PER DISK CLIENTI KA LNP E SEMPRE QUELLA DEL DISK
137130950525     C* SOLO PERO' SE IL CTM E' DI UNA SOLUZIONE "B"
137140950525     C   12
137150950525     CAN 15§1BFG6        IFEQ      'C'
137160950525     C                   MOVEL     §LPLNP        WFLS
137170950525     C                   ELSE
137180950525     C                   MOVEL     VIDLNP        WFLS
137190950525     C                   ENDIF
137200941021     C* PER IMMISSIONE E' LA LINEA DI PARTENZA
137210941021     C  N12              MOVEL     VIDLNP        WFLS
137220941021     C* PER MANUTENZIONE E' QUELLA GIA' MEMORIZZATA
137230941021     C   12
137240941021     CANN15              MOVEL     BLPFLS        WFLS
137250940825     C*
137260921006     C* SE SEGNACOLLI COMPRESI NEL RANGE DI QUELLI ASSEGNATI IN
137270921006     C*  AUTOMATICO  ERRORE
137280920203     C* NON CONTROLLO SE TIPO BOLLA CON MAMMA (§3ABCM=S)
137290950713    1C     §3ABCM        IFNE      'S'
137300950713    2C     VIDNCD        IFNE      0
137310921006     C*
137320921006     C* NON CONTROLLO IL RANGE SE SONO IN RECUPERO
137330950713     C   12
137340950713    3CAN 15§LPFPR        IFEQ      'R'
137350921006     C                   SETON                                        30
137360950713    3C                   END
137370921006     C*
137380990602    3C  N12PARTCH        IFEQ      'R'
137390921006     C                   SETON                                        30
137400950713    3C                   END
137410921006     C*
137420950713     C  N30
137430950713    3CANN25VIDNRS        IFEQ      0
137440910208     C*
137450950713    4C     VIDNCD        IFLT      NUFRIN
137460950713    5C     VIDNCA        IFGT      NUFRIN
137470940825     C                   MOVEL     ERR(51)       VIDMSG
137480940922     C                   SETON                                        4690
137490940920     C                   GOTO      ENDC02
137500950713    5C                   END
137510950713   X4C                   ELSE
137520950713    5C     VIDNCD        IFLE      NUFRFI
137530940825     C                   MOVEL     ERR(51)       VIDMSG
137540940922     C                   SETON                                        4590
137550940920     C                   GOTO      ENDC02
137560950713    5C                   END
137570950713    4C                   END
137580910208     C*
137590950713    3C                   END
137600950713    2C                   END
137610910208     C*
137620910208     C* S E G N A C O L L I   D O P P I
137630910117     C*
137640910208     C* IN MANUTENZIONE/DISK CLIENTI CONTROLLO SE NON CAMBIATA LNA
137650921006     C                   SETOFF                                       30
137660971211     C                   MOVEL     COMLNA        W003A
137670971211     C   12
137680971211    2CAN 25SAVLNA        IFNE      W003A
137690910208     C                   SETON                                        30
137700950713    2C                   ENDIF
137710950713     C*
137720910208     C*  E SE NON AUMENTATI SEGNACOLLI
137730940916     C   12
137740050113    2Can 25SAVNCL        iflt      V1CNCL
137750910208     C                   SETON                                        30
137760950713    3C                   ENDIF
137770950713     C*
137780950713     C* NON CONTROLLO SE DEVO ASSEGNARE IL PGM I SEGNACOLLI
137790950713    2C     §1BFG6        IFEQ      'D'
137800950713     C     §1BFG6        OREQ      'I'
137810950713     C     §1BFG6        OREQ      'N'
137820950713     C                   SETON                                        30
137830950713    2C                   ENDIF
137840000627     C* NON CONTROLLO IN CASO DI CHIAMATA PER CONTROLLO DI BOLLA
137850000627     C*  AUTOGENERATA  POSTE
137860000627     C     §LPFLG        IFEQ      'C'
137870000627     C     VIDSOP        ANDEQ     '&'
137880020319     c     §ogntw        andeq     'PPT'
137890000627     C                   SETON                                        30
137900000627    2C                   ENDIF
137910940916     C*
137920910826     C*
137930920123     C* PER DISK CLI  SE NON SONO SEQUENZIALI
137940141119     c*
137950141119     c* W_bldncd e W_bldnca servono per il controllo range segnacolli
137960141119     c* per serie parziale se segnacolli non sequenziali
137970141119     c* Li imposto solo in conferma bolle.
137980141119     c* In Immissione bolle e manutenzione LI LASCIO SEMPRE VUOTI in quanto
137990141119     c* non sono da controllare (TRULNRSR se vuoti non li controlla)
138000141119     c* - In immissione non è possibile bollettare con segnacolli non
138010141119     c*   sequenziali
138020141119     c* - In manutenzione non è possibile variare i dati sensibili per
138030141119     c*   il controllo range segnacolli (ccm, serie, fls, numeri segnacolli)
138040141118     c                   if        *in12 and *in15
138050080313     c                   z-add     *hival        w_bldncd
138060141118     c                   else
138070141118     c                   clear                   w_bldncd
138080141118     c                   endif
138090080313     c                   clear                   w_bldnca
138100940916     C   12
138110940916     CAN 15
138120940916    2CANN30VIDFNS        IFEQ      'S'
138130920123     C*
138140020917     C     KBLC          SETLL     FIVAD000
138150020917     C     KBLC          READE(N)  FIVAD000                               31
138160910826     C*
138170940916    3C     *IN31         DOWEQ     *OFF
138180941230     C                   Z-ADD     BLDNCD        COMSCD
138190080313     c* mi memorizzo in campi di comodo il numero più basso e quello più
138200080313     c* alto di segnacollo che mi servirà per il controllo range se
138210080313     c* cliente con serie parziale
138220080313    4c                   if        bldncd<w_bldncd
138230080313     C                   Z-ADD     BLDNCD        W_bldncd
138240080313    4c                   endif
138250080313    4c                   if        bldnca>0
138260080313    5c                   if        bldnca>W_bldnca
138270080313     C                   Z-ADD     BLDNCA        W_bldnca
138280080313    5c                   endif
138290080313   x4c                   else
138300080313    5c                   if        bldncd>w_bldnca
138310080313     C                   Z-ADD     BLDNCD        W_bldnca
138320080313    5c                   endif
138330080313    4c                   endif
138340120828     C     KBLT          CHAIN     FNBLT27L                           32
138350051102    4c                   if        *in32
138360120828     C     KBLT          CHAIN(N)  Fiars01L                           32
138370120828    5c                   if        not *in32
138380120828     c     kblt          chain     fnart27l                           32
138390051102     c* Se non trovato ART record presente x errore: lo cancello
138400120828     c   32kblt          delete    fiars01l
138410120828    5c                   endif
138420051102    4c                   endif
138430960319     C  N32              SETON                                        3190
138440020917     C   32KBLC          READE(N)  FIVAD000                               31
138450940916    3C                   ENDDO
138460940916     C*
138470940916    3C     *IN90         IFEQ      *ON
138480940916     C                   EXSR      PRPMSG
138490940920     C                   GOTO      ENDC02
138500940916    3C                   ENDIF
138510940916     C                   SETON                                        30
138520940916    2C                   ENDIF
138530910826     C*
138540920124     C* PER GLI ALTRI CASI
138550940916    2C  N30VIDFNS        IFEQ      ' '
138560910118     C                   Z-ADD     VIDNCD        CO2SCD            8 0
138570910118     C                   Z-ADD     VIDNCD        COMSCD            7 0
138580940916    3C     VIDNCA        IFEQ      0
138590900503     C                   Z-ADD     VIDNCD        COMSCA
138600900502     C                   ELSE
138610910118     C                   Z-ADD     VIDNCA        COMSCA            8 0
138620940916    3C                   END
138630900502     C*
138640940916    3C     CO2SCD        DOWLE     COMSCA
138650990318     C     CO2SCD        ANDGT     0
138660920124     C*
138670920124     C* PER IMMISSIONE  / DISK CLIENTI SEQUENZIALI
138680920124     C   12
138690920124     CAN 15
138700940916    4CORN12              DO
138710120828     C     KBLT          CHAIN     FNBLT27L                           32
138720051102     c
138730051102    5C   32§ogntw        IFne      'PPT'
138740120828     C     KBLT          CHAIN(N)  Fiars01L                           32
138750120828    6c                   if        not *in32
138760120828     c     kblt          chain     fnart27l                           32
138770051102     c* Se non trovato ART record presente x errore: lo cancello
138780120828     c   32kblt          delete    fiars01l
138790120828    6c                   endif
138800051102    5c                   endif
138810051102     c
138820051102     C  N32              SETON                                        90
138830940916     C*
138840001212     C* PREPARA MESSAGGIO DI ERRORE
138850100517     c
138860100517     C   90              EXSR      PRPMSG
138870100517    4C                   END
138880920124     C*
138890920124     C* PER MANUTENZIONE CONTROLLO ANCHE DI NON ESSERE ME STESSA
138900940916     C   12
138910940916    4CANN15              DO
138920120828     C     KBLT          SETLL     FNBLT27L
138930120828     C     KBLT          READE     FNBLT27L                               32
138940920124     C*
138950940916    5C     *IN32         DOWEQ     *OFF
138960940916    6C     VIDSPE        IFNE      BLPSPE
138970940916     C                   SETON                                        9032
138980920124     C                   ELSE
138990120828     C     KBLT          READE     FNBLT27L                               32
139000940916    6C                   ENDIF
139010940916    5C                   ENDDO
139020940916    4C                   ENDDO
139030940916     C* SEGNACOLLO DOPPIO --> PREPARA MESSAGGIO DI ERRORE
139040940916    4C     *IN90         IFEQ      *ON
139050940916     C                   EXSR      PRPMSG
139060940920     C                   GOTO      ENDC02
139070940916    4C                   ENDIF
139080920124     C*
139090910826     C* CONTROLLO ALTRO NUMERO
139100910826     C                   ADD       1             CO2SCD
139110910826     C                   ADD       1             COMSCD
139120940916    3C                   END
139130940916    2C                   END
139140920124     C*
139150940916    1C                   END
139160910220     C*
139170910220     C*** NUMERO SERIE ***
139180940826     C*
139190100517    2C     VIDNRS        IFNE      0
139200100517     c
139210940922     C*
139220940922     C* SE SERIE <> DA 0 E FLAG6 DEL CTM NON E' "C" ERRORE
139230940916    3C     §1BFG6        IFNE      'C'
139240940916     C                   MOVEL     ERR(49)       VIDMSG
139250940922     C                   SETON                                        5690
139260940920     C                   GOTO      ENDC02
139270940916    3C                   END
139280100517     c
139290100517     c                   clear                   trulnrsds
139300100517     c                   movel     wksc          inrsCCM
139310100517     c                   movel     vidnrs        inrsNRS
139320100517     c                   movel     wfls          inrsFLS
139330100517    3c                   if        vidfns='S'
139340100517     c                   movel     w_bldncd      inrsNCD
139350100517     c                   movel     w_bldnca      inrsNCA
139360100517     c                   else
139370100517     c                   movel     vidncd        inrsNCD
139380100517     c                   movel     vidnca        inrsNCA
139390100517    3c                   endif
139400100517     c
139410100517     c                   call      'TRULNRSR'
139420100517     c                   parm                    trulnrsds
139430100517     c
139440110902    3c****               select
139450110902    3c****               when      onrserr<>' ' and
139460110902     c****                         onrserr<>'N'
139470110902    3c                   if        onrserr<>' '
139480100517     C                   MOVEL     onrsmsg       VIDMSG
139490100517     C                   SETON                                        9056
139500100517     C                   GOTO      ENDC02
139510110902     c                   endif
139520100517     c
139530110902    3c*********          when      onrserr= 'N' and f_range=' '
139540080313      *
139550110902     c
139560110902     c******             eval      f_range='1'
139570110902     c*******            seton                                        90
139580110902     c******             exsr      escier
139590110902    4C**** §lpfpr        IFNE      '5'
139600080314     C* gestione window con errore forzabile
139610110902     c*****              setoff                                       90
139620100517     c* riempi i campi col messaggio
139630110902     c*****              eval      w3cpfl1=%subst(onrsmsg:1:24)
139640110902     c*****              eval      w3cpfl2=%subst(onrsmsg:25:38)
139650110902     c*****              eval      w3cpfl3=%subst(onrsmsg:63:16)
139660100517     c
139670110902    5c****               if        §lpfpr<>'V'
139680110902     c****               write     ls01d02
139690110902    5c****               endif
139700110902    5c****               dou       *inkf
139710110902     c****               exfmt     ls01w3cp
139720110902    5c****               enddo
139730110902     c****               eval      wemfor='1'
139740110902     c****               goto      endc02
139750110902   x4C***+               ELSE
139760110902     c***                seton                                        90
139770110902     C****               GOTO      ENDC02
139780110902    4C****               ENDIF
139790110902    3c******             ENDSL
139800910308     C*
139810940916   X2C                   ELSE
139820910308     C* SERIE =0 FLAG6 DEL CTM = "C" ERRORE
139830940916    3C     §1BFG6        IFEQ      'C'
139840940916     C                   MOVEL     ERR(49)       VIDMSG
139850940922     C                   SETON                                        5690
139860940920     C                   GOTO      ENDC02
139870940916    3C                   END
139880940916    2C                   END
139890921006     C*
139900940916     C* SE RECUPERO CONTROLLO NUM SPEDIZIONE DOPPIO
139910990602    1C  N12PARTCH        IFEQ      'R'
139920940915     C     KNSP          SETLL     FNBLP01L                               30
139930940928    2C     *IN30         IFEQ      *ON
139940940916     C                   MOVEL     ERR(50)       VIDMSG
139950940922     C                   SETON                                        5690
139960940920     C                   GOTO      ENDC02
139970940928    2C                   END
139980940928    1C                   END
139990940916     C***
140000900502     C*** NATURA MERCE ***
140010940928    1C  N27VIDNAS        IFEQ      *BLANKS
140020940928     C                   MOVEL     ERR(53)       VIDMSG
140030940922     C                   SETON                                        4890
140040940920     C                   GOTO      ENDC02
140050940928    1C                   END
140060970115     C*
140070970115     C* CONTROLLO QUALI DICITURE NON SONO AMMESSE E PER QULI BOLLE
140080970115     C                   Z-ADD     1             C
140090970115    1C     LDC(C)        DOWNE     *BLANKS
140100970115     C*
140110970115     C                   CLEAR                   WRICER
140120970115    2C     WDESIE        IFEQ      'E'
140130970115    3C     TBO(C)        IFEQ      ' '
140140970115     C     TBO(C)        OREQ      'E'
140150970115     C                   MOVEL     'S'           WRICER            1
140160970115    3C                   ENDIF
140170970115    2C                   ENDIF
140180970115    2C     WDESIE        IFEQ      'I'
140190970115    3C     TBO(C)        IFEQ      ' '
140200970115     C     TBO(C)        OREQ      'I'
140210970115     C                   MOVEL     'S'           WRICER            1
140220970115    3C                   ENDIF
140230970115    2C                   ENDIF
140240970115     C*
140250970115    2C     WRICER        IFEQ      'S'
140260970115     C                   MOVEL     TBO(C)        W003A
140270970115     C                   MOVE      LDC(C)        W003A
140280970115     C                   MOVEL     '3F'          COD
140290970115     C                   MOVEL(P)  W003A         KEY
140300970115     C     KTAB2         CHAIN     TABEL                              30
140310970115    3C     *IN30         IFEQ      *OFF
140320970115     C                   MOVEA     TBLUNI        K89
140330970115    3C                   ENDIF
140340970115     C                   MOVEL     LDC(C)        Z                 2 0
140350970115     C                   Z-ADD     1             Y                 3 0
140360970115     C*
140370970115    3C     Y             DOWLT     86
140380970115     C                   CLEAR                   W015A
140390970115     C                   MOVEA     K89(Y)        W015A            15
140400970115    4C     W015A         IFNE      *BLANKS
140410970115     C     W015A:Z       SCAN      VIDNAS                                 31
140420970115     C* ERRORE
140430970115    5C     *IN31         IFEQ      *ON
140440970115     C*
140450970115     C     WDESIE        IFEQ      'E'
140460970115     C                   MOVEA     ERR(135)      K78
140470970115     C                   ELSE
140480970115     C                   MOVEA     ERR(136)      K78
140490970115     C                   ENDIF
140500970115     C                   Z-ADD     11            YY                3 0
140510970115     C                   DO        Z
140520970115     C                   MOVEL     K89(Y)        K78(YY)
140530970115     C                   ADD       1             YY
140540970115     C                   ADD       1             Y
140550970115     C                   ENDDO
140560970115     C                   MOVEL     '"'           K78(YY)
140570970115     C                   MOVEA     K78           VIDMSG
140580970115     C*
140590970115     C                   SETON                                        4890
140600970115     C                   Z-ADD     89            Y
140610970115     C                   Z-ADD     29            C
140620970115    5C                   ENDIF
140630970115    4C                   ENDIF
140640970115     C*
140650970115     C                   ADD       Z             Y
140660970115    3C                   ENDDO
140670970115    2C                   ENDIF
140680970115     C*
140690970115     C                   ADD       1             C
140700970115    1C                   ENDDO
140710940930     C***
140720940930     C*** MITTENTE ORIGINALE ***
140730941103     C                   MOVEL     VIDRMO        WRMO
140740941103     C                   MOVEL     VIDCMO        WCMO
140750941108     C                   MOVEL     VIDNMO        WNAR
140760941103     C                   EXSR      CTRMO
140770941103     C                   MOVEL     WNAR          VIDNMO
140780941103     C     WEMFOR        IFEQ      '1'
140790941103     C                   GOTO      ENDC02
140800941103     C                   ENDIF
140810091008     c*** . . .obbligatorio per porti assegnati import
140820091008     c                   if        §3atb1='A2' and (§ogntw='FED' or
140830091008     c                             §ogntw='DPD' or §ogntw='EEX')
140840091008     c                             and (vidrmo=*blanks or vidcmo=*blanks)
140850091016     c                             and *in44=*off and vidfbr<>'S'
140860091008     C                   MOVEL     ERR(328)      VIDMSG
140870091008     C                   SETON                                        90
140880091008     c                   select
140890091008     c                   when      vidrmo=*blanks
140900091008     c                   seton                                        71
140910091008     c                   when      vidcmo=*blanks
140920091008     c                   seton                                        72
140930091008     c                   endsl
140940091008     C                   GOTO      ENDC02
140950091008     c                   endif
140960091008     c
140970940922     C***
140980940922     C*** CONTRASSEGNO ***
140990961204     c***
141000961204     C* PER BOLLE DI RESO NON SI PUO' INSERIRE
141010961204     C     VIDFBR        IFEQ      'S'
141020961204     C     §3AFCA        ANDGT     0
141030961204     C                   MOVEL     ERR(134)      VIDMSG
141040961204     C                   SETON                                        5090
141050961204     C                   GOTO      ENDC02
141060961204    1C                   ENDIF
141070940922     C* IN MANUTENZIONE: SE BOLLA CHE PREVEDE C/A MA E' CON MAMMA E
141080940922     C*  SI TRATTA DI UN TIPO BOLLA NON MANUTENZ, NON POSSO INSERIRE:
141090940922     C*  NE' TIPO INCASSO NE' C/ASSEGNO, MENTRE POSSO INSERIRE LE VARIE
141100940922     C*
141110940922    1C     *IN12         IFEQ      *ON
141120940922     C     *IN15         ANDEQ     *OFF
141130940922     C     *IN44         ANDEQ     *ON
141140940922     C     §3ABCM        ANDNE     ' '
141150940922     C     §3AFCA        ANDNE     0
141160940922     C*
141170940922    2C     VIDTIC        IFNE      *BLANKS
141180940922     C                   MOVEL     ERR(99)       VIDMSG
141190940922     C                   SETON                                        4990
141200940922    2C                   END
141210940922    2C  N90VIDCAS        IFNE      0
141220940922     C                   MOVEL     ERR(98)       VIDMSG
141230940922     C                   SETON                                        5090
141240940922    2C                   END
141250940922     C*
141260940922   X1C                   ELSE
141270940922     C*
141280940922     C* IN TUTTI GLI ALTRI CASI SI SEGUONO LE REGOLE CORRETTE
141290940922     C* NON C'E' FLAG C/ASSEGNO SU TIPO BOLLA
141300940922    2C     §3AFCA        IFEQ      0
141310940922     C*
141320940922    3C     VIDTIC        IFNE      *BLANKS
141330940922     C                   MOVEL     ERR(99)       VIDMSG
141340940922     C                   SETON                                        4990
141350940922    3C                   ENDIF
141360940922    3C  N90VIDCAS        IFNE      0
141370940922     C                   MOVEL     ERR(98)       VIDMSG
141380940922     C                   SETON                                        5090
141390940922    3C                   ENDIF
141400940922     C*
141410940922   X2C                   ELSE
141420940922     C*
141430940922     C*     C'E' FLAG C/ASSEGNO SU TIPO BOLLA
141440940922    3C     VIDCAS        IFEQ      0
141450940922     C                   MOVEL     ERR(98)       VIDMSG
141460940922     C                   SETON                                        5090
141470940922    3C                   ENDIF
141480011108     C  N90VIDVCA        IFEQ      *BLANKS
141490011108     C                   MOVEL     ERR(169)      VIDMSG
141500011108     C                   SETON                                        5190
141510011108     C                   ENDIF
141520940922    2C                   ENDIF
141530940922     C*
141540940922    1C                   ENDIF
141550940922     C* ERRORE
141560940922     C   90              GOTO      ENDC02
141570090622     c*
141580090622     c* Controllo tipo incasso C/A e relativa divisa
141590090622     c* richiamo pgm TRULTICR
141600090625    1c                   if        vidtic<>*blanks or vidcas>0
141610091211     c                   exsr      sr_trultic
141620091211     c                   exsr      sr_impochktic
141630090622     c
141640090625    2c                   if        oticric='T'
141650090624     c                   movel     otictic       vidtic
141660090624     c                   eval      wemfor='1'
141670090624     C                   GOTO      ENDC02
141680090625    2c                   endif
141690090625    2c                   if        oticric='D'
141700090624     c                   movel     oticdiv       vidvca
141710090624     C                   eval      wemfor='1'
141720090624     C                   GOTO      ENDC02
141730090625    2c                   endif
141740090622     c* Errore tipo incasso
141750091211     c* Se errore di tipo "C" lo segnalo solo se non c'è orm con
141760091211     c* triangolazione oppure se è stato già scelto il beneficiario
141770091211     c* del contrassegno
141780091211    2c                   if        oticerr='T' or (oticerr='C' and
141790091211     c                             (nochkticC=*off or (wcassel1='X'or
141800091211     c                             wcassel2='X')))
141810090624     C                   MOVEL     oticmsg       VIDMSG
141820090624     C                   SETON                                        4990
141830090624     C                   GOTO      ENDC02
141840091211    2C                   ENDIF
141850090622     c* Errore divisa
141860090625    2c                   if        oticerr='D'
141870090624     C                   MOVEL     oticmsg       VIDMSG
141880090624     C                   SETON                                        5190
141890090624     C                   GOTO      ENDC02
141900090624    2C                   ENDIF
141910090624     c* Ulteriori controlli non presenti in TRULTICR
141920090625
141930060707     c* se tipo incasso richiede il mittente originale controllo che
141940060707     c* sia stato immesso
141950090625    2c                   if        §1amro='S' and vidrmo=*blanks
141960060707     C                   MOVEL     ERR(304)      VIDMSG
141970060707     C                   SETON                                        7190
141980060707     C                   GOTO      ENDC02
141990090625    2c                   endif
142000090625      * Devo lo stesso agganciare tabella "TM" perchè serve poi nella
142010090625      * routine di registrazione
142020090625     C                   MOVEL     'TM'          COD
142030090625     C                   MOVEL(P)  WKSC          KEY
142040090625     C*
142050090625     C                   EXSR      CTABEL
142060090625     c  n30              movel     tbluni        dstm
142070090625     c   30              clear                   dstm
142080090625     c*
142090090625    1c                   endif
142100011108     C*
142110011108     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE IL C/A
142120011108     C* INDICATORE DI CHANGE 11 ON
142130011108    1C     VARVCA        IFNE      VIDVCA
142140011108    2C     WIN11         IFEQ      *BLANKS
142150011108     C     VIDCAS        ANDNE     0
142160011108     C                   MOVEL     ERR(105)      VIDMSG
142170011108     C                   SETON                                        5090
142180011108     C                   GOTO      ENDC02
142190011108    2C                   ENDIF
142200011108     C*
142210011108    1C                   ENDIF
142220011108     C*
142230011212      * pulisco il flag x la forzatura importo C/Assegno
142240011212     C     VIDCAS        IFNE      WARCAS
142250011212     C                   CLEAR                   FORCAS
142260011212     C                   Z-ADD     VIDCAS        WARCAS
142270011212     C                   ENDIF
142280011212     C                   CLEAR                   FCASAV
142290011211     C* Richiamo TRUL21R per controllo limiti importo C/Assegno
142300090921    1C     VIDCAS        IFGT      *ZEROS
142310011211     C                   CLEAR                   DSUL21
142320011211     C                   MOVEL     VIDCBO        I21CBO
142330090921    2C     VIDTSP        IFNE      *BLANKS
142340011211     C                   MOVEL     VIDTSP        I21TSP
142350011211     C                   ELSE
142360011211     C                   MOVEL     COMTSP        I21TSP
142370090921    2C                   ENDIF
142380011211     C                   Z-ADD     VIDLNP        I21LNP
142390011211     C                   MOVEL     VIDNZM        I21NZM
142400011211     C                   Z-ADD     COMLNA        I21LNA
142410011211     C                   MOVEL     VIDNZD        I21NZD
142420130826    2C**   *IN04         IFEQ      *ON
142430130826     C**                 Z-ADD     9999          I21KSC
142440130826     C**                 MOVEL     VIDLNP        I21KSC
142450130826   x2C**                 ELSE
142460130826     c* in I21ksc passo il mittente
142470011211     C                   Z-ADD     VIDCCM        I21KSC
142480090921    3C     VIDFLC        IFEQ      0
142490011211     C                   MOVEL     VIDLNP        I21KSC
142500090921   x3C                   ELSE
142510011211     C                   MOVEL     VIDFLC        I21KSC
142520090921    3C                   ENDIF
142530130826     c                   if        vidccm=9999
142540130826     c                   move      8888          i21ksc
142550130826     c                   endif
142560130826    2C**                 ENDIF
142570011211     C                   MOVEL     VIDCTR        I21CTR
142580011211     C                   MOVEL     VIDTIC        I21TIC
142590011211     C                   Z-ADD     VIDCAS        I21IMP
142600011211     C                   MOVEL     VIDVCA        I21DIV
142610011211     C                   MOVEL     KNMUS         I21UTE
142620011211     C                   MOVEL     NOMPGM        I21PGM
142630011211     C                   CALL      'TRUL21R'
142640011211     C                   PARM                    DSUL21
142650011212     C* Salvo il flag del limite di abilitazione C/A che mi servirà per
142660011212     C* il richiamo del pgm di stampa L.V.
142670011212     C                   MOVE      O21FCA        FCASAV
142680011211     C* IMPORTO MAGGIORE DEL LIMITE MAX
142690090921    2C     O21FX2        IFNE      *BLANKS
142700011211     C                   MOVEA     ERR(131)      K78
142710011212     C                   MOVE      O21LX2        WNUMED
142720011212     C* richiamo routine per editare il limite
142730011212     C                   EXSR      CALLXE
142740011211      * metto il numero editato nel campo del messaggio
142750011211     C                   MOVEA     W014A         SKII(1)
142760011211     C                   MOVEA     SKII(1)       K78(47)
142770011211     C*
142780011211     C                   MOVEA     K78           VIDMSG
142790011211     C                   SETON                                        5090
142800011211     C                   GOTO      ENDC02
142810090921    2C                   ENDIF
142820090921     c
142830011211     C* IMPORTO INFERIORE AL LIMITE MINIMO
142840090921    2C     O21FMN        IFNE      *BLANKS
142850011212     C                   MOVEA     ERR(236)      K78
142860011212     C                   MOVE      O21LMN        WNUMED
142870011212     C* richiamo routine per editare il limite
142880011212     C                   EXSR      CALLXE
142890011212      * metto il numero editato nel campo del messaggio
142900011212     C                   MOVEA     W014A         SKII(1)
142910011212     C                   MOVEA     SKII(1)       K78(31)
142920011212     C*
142930011212     C                   MOVEA     K78           VIDMSG
142940011212     C                   SETON                                        5090
142950011212     C                   GOTO      ENDC02
142960090921    2C                   ENDIF
142970090921     c
142980011211     C* IMPORTO MAGGIORE DEL LIMITE FORZABILE
142990090921    2C     O21FX1        IFNE      *BLANKS
143000011212     C     FORCAS        ANDEQ     *BLANKS
143010011212     C                   MOVEL     '1'           FORCAS            1
143020011212     C                   MOVEA     ERR(237)      K78
143030011212     C                   MOVE      O21LX1        WNUMED
143040011212     C* richiamo routine per editare il limite
143050011212     C                   EXSR      CALLXE
143060011212      * metto il numero editato nel campo del messaggio
143070011212     C                   MOVEA     W014A         SKII(1)
143080011212     C                   MOVEA     SKII(1)       K78(24)
143090011212     C                   MOVEA     K78           VIDMSG
143100011212     C                   SETON                                        5090
143110011212     C                   GOTO      ENDC02
143120090921    2C                   ENDIF
143130090921     c
143140090921     c* Tipo servizio H non ammesso er C/ASS da abilitare
143150090921     c                   if        fcasav<>*blanks  and  vidtsp='H'
143160090921     c                   SETON                                        5090
143170090921     C                   MOVEL     ERR(149)      VIDMSG
143180090921     C                   GOTO      ENDC02
143190090921     c                   endif
143200090921     c
143210090921    1C                   ENDIF
143220090625     C*
143230011108     C                   MOVEL     VIDVCA        VARVCA
143240011108     C                   CLEAR                   WIN11
143250940916     C***
143260961111     C*** N O T E    ***
143270990610     C* SONO OBBLIGATORIE SE BOLLA PREPAGATO PER TELEFONO E REFERENTE
143280990610     C*  RITIRO
143290990610    3C     PARTCH        IFEQ      'P'
143300990610     C     SES           ANDEQ     0
143310010306    3C     §LPFPR        OREQ      'O'
143320010306     C     SES           ANDEQ     0
143330990610     C                   MOVEL     ERR(159)      VIDMSG
143340990610     C                   MOVEL     1             SES
143350990610     C                   SETON                                        8690
143360990610     C                   GOTO      ENDC02
143370990610    3C                   END
143380990610     C*
143390990610    3C     VIDNT1        IFEQ      *BLANKS
143400990610     C     VIDNT2        ANDEQ     *BLANKS
143410990610     C     PARTCH        ANDEQ     'P'
143420010306    3C     VIDNT1        OREQ      *BLANKS
143430010306     C     VIDNT2        ANDEQ     *BLANKS
143440010306     C     §LPFPR        ANDEQ     'O'
143450990610     C                   MOVEL     ERR(159)      VIDMSG
143460990610     C                   SETON                                        8690
143470990610     C                   GOTO      ENDC02
143480990610    3C                   END
143490961111     C***
143500961111     C*** IMPORTO DA ASSICURARE ***
143510961111     C***
143520950120     C* SE VARIATO ME LO SALVO
143530950120     C     *IN89         IFEQ      *ON
143540950120     C                   MOVEL     '1'           WIN89             1
143550950120     C                   ENDIF
143560950104     C*
143570011112     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
143580011112     C     VIDIAS        IFGT      *ZEROS
143590011112     C     VIDVAS        ANDEQ     *BLANKS
143600011112     C                   MOVEL     ERR(169)      VIDMSG
143610011114     C                   SETON                                        8190
143620011112     C                   GOTO      ENDC02
143630011112     C                   ENDIF
143640011112     C*
143650950104     C                   MOVEL     VIDVAS        WVLT
143660950104     C                   Z-ADD     VIDIAS        W0133            13 3
143670950104     C* CONTROLLO LA DIVISA
143680950104     C                   EXSR      CTRVLT
143690950104     C                   MOVEL     WVLT          VIDVAS
143700950104     C* ERRORE
143710950104     C   90              SETON                                        81
143720950104     C*
143730950104     C     WEMFOR        IFEQ      '1'
143740950104     C                   GOTO      ENDC02
143750950104     C                   ENDIF
143760011113     C*
143770011113     C* CONTROLLO SCADENZA DIVISA
143780011113     C     BLPDSP        IFGT      §CVDLI
143790011113     C     VIDIAS        ANDNE     0
143800011113     C                   MOVEL     ERR(232)      VIDMSG
143810011114     C                   SETON                                        8190
143820011113     C                   GOTO      ENDC02
143830011113     C                   ENDIF
143840950104     C*
143850950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
143860950104     C* INDICATORE DI CHANGE 89 ON
143870950104     C     VIDVAS        IFNE      VARVAS
143880950120     C     WIN89         ANDEQ     *BLANKS
143890011112     C     VIDIAS        ANDNE     0
143900950104     C                   MOVEL     ERR(105)      VIDMSG
143910950104     C                   SETON                                        8090
143920950104     C                   GOTO      ENDC02
143930950104    2C                   ENDIF
143940950104     C*
143950950104     C                   MOVEL     VIDVAS        VARVAS
143960950120     C                   CLEAR                   WIN89
143970940922     C*
143980940922     C* LO PRENDO SOLO PER LE SPEDIZIONI IN FRANCO PERCHE' IN ASSEGNATO
143990940922     C*  LA MERCE E' FRANCO STABILIMENTO, PER CUI DIVENTA DEL DESTINAT
144000941103    1C     *IN04         IFEQ      *OFF
144010940922     C* SOLO SE IL MITTENTE HA TARIFFE
144020941108     C     WTKS          ANDEQ     'S'
144030950104     C*
144040950104     C* SE <> 0 CONTROLLO CHE NON SUPERI IL VALORE IN TARIFFA
144050011211    2C     VIDIAS        IFNE      VARIAS
144060950104     C     VIDNCL        ORNE      VARNCL
144070950104     C                   Z-ADD     0             DIE
144080991028    2C                   END
144090940922     C*
144100940922    2C     VIDIAS        IFGT      0
144110940922     C     DIE           ANDNE     NUMFOR
144120950215     C     TAMFIS        ORNE      '0'
144130011211     C                   Z-ADD     VIDIAS        VARIAS
144140940922     C                   MOVEL     VIDNCL        VARNCL
144150960209     C* NON CONTROLLA DA TARIFFA SE OBBLIG.SE TIPO BOLLA NON PREVISTO
144160960209     C     §3ATB1        LOOKUP    TBL                                    30
144170960209     C*
144180960209   2AC     *IN30         IFEQ      *ON
144190940922     C*
144200940922     C* SOLO SE E' ASSICURAZIONE ANCHE PER LE PARTENZE ( <> A )
144210990818     C     KTPT          CHAIN     TITPT000                           30
144220950220    3C     *IN30         IFEQ      *ON
144230950220     C     TPTATB        ORNE      ' '
144240950220     C     TPTAPL        ORNE      'A'
144250950215     C*
144260950215     C* TAMFIS=1 OBBLIGATORIO     FORZABILE --> CON ENTER PRENDO MAX
144270950215     C*                                         IMPORTO DA TARIFFA
144280950215    4C     TAMFIS        IFEQ      '1'
144290950215     C     CIN           ANDNE     NUMFOR
144300011211     C     VIDIAS        ANDEQ     0
144310950215     C                   MOVEL     ERR(93)       VIDMSG
144320950215     C                   SETON                                        8090
144330950215     C                   ADD       1             CIN
144340950215     C                   GOTO      ENDC02
144350950215    4C                   ENDIF
144360950215     C*
144370950215     C* TAMFIS=3 OBBLIGATORIO NON FORZABILE --> ERRORE SEMPRE
144380950215    4C     TAMFIS        IFEQ      '3'
144390011211     C     VIDIAS        ANDEQ     0
144400950215     C                   MOVEL     ERR(94)       VIDMSG
144410950215     C                   SETON                                        8090
144420950215     C                   GOTO      ENDC02
144430950215    4C                   ENDIF
144440950215     C*
144450950215     C* TAMFIS=2 NON INSERIBILE             --> ERRORE SEMPRE
144460950215    4C     TAMFIS        IFEQ      '2'
144470011211     C     VIDIAS        ANDNE     0
144480950215     C                   MOVEL     ERR(95)       VIDMSG
144490950217     C                   SETON                                        8090
144500950215     C                   GOTO      ENDC02
144510950215    4C                   ENDIF
144520950220    3C                   ENDIF
144530950215     C* SE C'E VALORE MERCE:
144540950220    3C  N30TPTATB        IFEQ      ' '
144550950220     C     TPTAPL        ANDNE     'A'
144560950220     C     TPTVLM        ANDGT     0
144570940922     C* VALORE A COLLO
144580950220    4C     TPTFVM        IFEQ      '1'
144590991028     C     VIDNCL        MULT      TPTVLM        W0133A           13 3
144600950220   X4C                   ELSE
144610950220    5C     TPTFVM        IFEQ      '2'
144620991028     C                   Z-ADD     TPTVLM        W0133A
144630950220   X5C                   ELSE
144640940922     C     V2CPKG        ADD       0,9           W0060             6 0
144650991028     C     W0060         MULT      TPTVLM        W0133A
144660950220    5C                   END
144670950220    4C                   END
144680991028     C**
144690991028     C* TRASFORMO L'IMPORTO DA ASSICURARE NELLA DIVISA DELLA TARIFFA
144700011113     C                   Z-ADD     VIDIAS        IASTAR
144710991028    5C     COMDIV        IFNE      VIDVAS
144720991028     C                   CLEAR                   DSYEUR
144730991028     C                   MOVEL     VIDVAS        YECDVI
144740991028     C                   MOVEL     COMDIV        YECDVO
144750991028     C                   Z-ADD     VIDIAS        YECIMI
144760011113     C                   MOVE      COMDEC        YECDCO
144770991028     C*
144780991028     C                   CALL      'YEURCO'
144790991028     C                   PARM                    DSYEUR
144800991028     C*
144810991028    6C     YECESI        IFEQ      ' '
144820011113     C                   Z-ADD     YECIMO        IASTAR           17 3
144830991028    6C                   ENDIF
144840991028    5C                   ENDIF
144850940922     C*
144860011113    4C     IASTAR        IFGT      W0133A
144870950217     C     DIE           ANDNE     NUMFOR
144880940922     C                   ADD       1             DIE
144890940922     C                   MOVEL     ERR(97)       VIDMSG
144900941231     C                   SETON                                        8090
144910940922     C                   GOTO      ENDC02
144920950220    4C                   ENDIF
144930940922     C*
144940950215    3C                   ENDIF
144950960209   2AC                   ENDIF
144960960209    2C                   ENDIF
144970940922    1C                   ENDIF
144980940916     C*
144990011211      * pulisco il flag x la forzatura importo da assicurare forzabile
145000011211     C     VIDIAS        IFNE      WARIAS
145010011211     C                   CLEAR                   FORIAS
145020011211     C                   Z-ADD     VIDIAS        WARIAS
145030011211     C                   ENDIF
145040011211     C*
145050011211     C* CONTROLLO LIMITI IMPORTO DA ASSICURARE
145060011211     C     VIDIAS        IFGT      0
145070011211     C                   CLEAR                   DSUL22
145080011211     C                   MOVEL     VIDCBO        I22CBO
145090011211     C     VIDTSP        IFNE      *BLANKS
145100011211     C                   MOVEL     VIDTSP        I22TSP
145110011211     C                   ELSE
145120011211     C                   MOVEL     COMTSP        I22TSP
145130011211     C                   ENDIF
145140011212     C                   Z-ADD     VIDLNP        I22LPS
145150011211     C                   MOVEL     VIDNZM        I22NZM
145160011211     C                   Z-ADD     COMLNA        I22LNS
145170011211     C                   MOVEL     VIDNZD        I22NZD
145180011211     C     *IN04         IFEQ      *ON
145190011211     C                   Z-ADD     9999          I22KSC
145200011211     C                   MOVEL     VIDLNP        I22KSC
145210011211     C                   ELSE
145220011211     C                   Z-ADD     VIDCCM        I22KSC
145230011211     C     VIDFLC        IFEQ      0
145240011211     C                   MOVEL     VIDLNP        I22KSC
145250011211     C                   ELSE
145260011211     C                   MOVEL     VIDFLC        I22KSC
145270011211     C                   ENDIF
145280011211     C                   ENDIF
145290011211     C                   MOVEL     VIDCTR        I22CTR
145300011211     C                   Z-ADD     VIDIAS        I22IMP
145310011211     C                   MOVEL     VIDVAS        I22DIV
145320011211     C                   MOVEL     KNMUS         I22UTE
145330011211     C                   MOVEL     NOMPGM        I22PGM
145340011211     C                   CALL      'TRUL22R'
145350011211     C                   PARM                    DSUL22
145360011211     C* IMPORTO DA ASSICUARE NON AMMESSO
145370011211     C     O22FMN        IFNE      *BLANKS
145380011211     C     O22FX1        ANDNE     *BLANKS
145390011211     C     O22FX2        ANDNE     *BLANKS
145400011211     C                   MOVEL     ERR(234)      VIDMSG
145410011211     C                   SETON                                        8090
145420011211     C                   GOTO      ENDC02
145430011211     C                   ENDIF
145440011211     C* IMPORTO DA ASSICURARE > DEL LIMITE IMPOSTO
145450011211     C     O22FX2        IFNE      *BLANKS
145460011211     C                   MOVEA     ERR(96)       K78
145470011212     C                   MOVE      O22LX2        WNUMED
145480011212     C* richiamo routine per editare il limite
145490011212     C                   EXSR      CALLXE
145500011211      * metto il numero editato nel campo del messaggio
145510011211     C                   MOVEA     W014A         SKII(1)
145520011211     C                   MOVEA     SKII(1)       K78(38)
145530011211     C                   MOVEA     K78           VIDMSG
145540011211     C                   SETON                                        8090
145550011211     C                   GOTO      ENDC02
145560011211     C                   ENDIF
145570011211     C* IMPORTO DA ASSICURARE INFERIORE DEL LIMITE DI LEGGE
145580011211     C     O22FMN        IFNE      *BLANKS
145590011211     C                   MOVEA     ERR(165)      VIDMSG
145600011211     C                   SETON                                        8090
145610011211     C                   GOTO      ENDC02
145620011211     C                   ENDIF
145630011211     C* IMPORTO DA ASSICURARE > DEL LIMITE FORZABILE
145640011211     C     O22FX1        IFNE      *BLANKS
145650011211     C     FORIAS        ANDEQ     *BLANKS
145660011211     C                   MOVEL     '1'           FORIAS            1
145670011211     C                   MOVEA     ERR(235)      K78
145680011212     C                   MOVE      O22LX1        WNUMED
145690011212     C* richiamo routine per editare il limite
145700011212     C                   EXSR      CALLXE
145710011211      * metto il numero editato nel campo del messaggio
145720011211     C                   MOVEA     W014A         SKII(1)
145730011211     C                   MOVEA     SKII(1)       K78(28)
145740011211     C                   MOVEA     K78           VIDMSG
145750011211     C                   SETON                                        8090
145760011211     C                   GOTO      ENDC02
145770011211     C                   ENDIF
145780011211     C                   ENDIF
145790950102     C***
145800950102     C*** QUANTITA' DA FATTURARE  ***
145810950102     C                   MOVEL     VIDCTR        W001A
145820950102     C*
145830950103     C* SE MODIFICATA, PULISCO IL FLAG DI CONTROLLO
145840950102     C     VIDQFT        IFNE      VARQFT
145850950102     C                   CLEAR                   UND
145860950102     C                   MOVEL     VIDQFT        VARQFT
145870950102     C                   ENDIF
145880950102     C*
145890950103     C* CONTROLLO LA Q.TA DA FATTURARE CON TARIFFE SOLO SE C'E'
145900950103     C*  TARIFFA E SE E' FRANCO, PER ASSEGNATO E' DEL DESTINATARIO
145910950102    1C     WTKS          IFEQ      'S'
145920950102     C     W001A         ANDEQ     '4'
145930950103     C     *IN04         ANDEQ     *OFF
145940950102     C*
145950950102    2C     VIDQFT        IFEQ      0
145960950102     C*
145970950102     C* TAMFVD = '1' ASSUMO VALORE DA ASSICURARE SE NON IMMESSO
145980950103    3C     TAMFVD        IFEQ      '1'
145990950103     C     UND           ANDEQ     0
146000950102     C                   MOVEL     ERR(106)      VIDMSG
146010950102     C                   SETON                                        8490
146020950102     C                   MOVEL     1             UND
146030950102     C                   GOTO      ENDC02
146040950103    3C                   ENDIF
146050961007     C* TAMFVD = '2' O '4'  INSERIRE IN BOLLETTAZIONE
146060950103    3C     TAMFVD        IFEQ      '2'
146070961007     C     TAMFVD        OREQ      '4'
146080950102     C                   MOVEL     ERR(107)      VIDMSG
146090950102     C                   SETON                                        8490
146100950102     C                   GOTO      ENDC02
146110950103    3C                   ENDIF
146120950102     C*
146130950102   X2C                   ELSE
146140950102     C* TAMFVD = '3' ASSUME SEMPRE IMPORTO DA ASSICURARE: DA NON INSER
146150950102    3C     TAMFVD        IFEQ      '3'
146160950102     C                   MOVEL     ERR(108)      VIDMSG
146170950102     C                   SETON                                        8490
146180950102     C                   GOTO      ENDC02
146190950102    3C                   ENDIF
146200950102    2C                   ENDIF
146210950102    1C                   ENDIF
146220950102     c* TARIFFA A QUANTITA'
146230950102     C     W001A         IFEQ      '5'
146240950102     C     VIDQFT        ANDEQ     0
146250950102     C                   MOVEL     ERR(109)      VIDMSG
146260950102     C                   SETON                                        8490
146270950102     C                   GOTO      ENDC02
146280950102    3C                   ENDIF
146290940922     C***
146300940922     C*** VALORE MERCE DICHIARATO ***
146310940922     C*
146320011113     C* SE IMPORTO DA ASSICURARE>0 ---> DIVISA OBBLIGATORIA
146330011113     C     VIDVMD        IFGT      *ZEROS
146340011113     C     VIDVAD        ANDEQ     *BLANKS
146350011113     C                   MOVEL     ERR(169)      VIDMSG
146360011113     C                   SETON                                        6990
146370011113     C                   GOTO      ENDC02
146380011113     C                   ENDIF
146390021118
146400021118      * Se Spedizione Export EuroExpress con ddt "S"
146410021118      *  ---> Obbligatorio il valore merce
146420021118     c                   If        SavGdd = 'S' and VidVmd = *Zeros
146430021118     c                             and a_§OgNtw = 'EEX'
146440021118     c                   Movel     Err(259)      VidMsg
146450021118     c                   Eval      *In82 = *On
146460021118     c                   Eval      *In90 = *On
146470021118     c                   Goto      Endc02
146480021118     c                   EndIf
146490011113     C*
146500940922     C                   MOVEL     VIDVAD        WVLT
146510940922     C                   Z-ADD     VIDVMD        W0133            13 3
146520940922     C* CONTROLLO LA DIVISA
146530940922     C                   EXSR      CTRVLT
146540940922     C                   MOVEL     WVLT          VIDVAD
146550940922     C* ERRORE
146560950410     C   90              SETON                                        69
146570940922     C*
146580940928    1C     WEMFOR        IFEQ      '1'
146590940922     C                   GOTO      ENDC02
146600940928    1C                   ENDIF
146610011113     C*
146620011113     C* CONTROLLO SCADENZA DIVISA
146630011113     C     BLPDSP        IFGT      §CVDLI
146640011113     C     VIDVMD        ANDNE     0
146650011113     C                   MOVEL     ERR(232)      VIDMSG
146660011113     C                   SETON                                        6990
146670011113     C                   GOTO      ENDC02
146680011113     C                   ENDIF
146690941219     C*
146700950410     C* SE HO MODIFICATO LA DIVISA DEVO RIDIGITARE L'IMPORTO
146710941219     C* INDICATORE DI CHANGE 88 ON
146720941219    2C     VARVAD        IFNE      VIDVAD
146730950120     C     WIN88         ANDEQ     *BLANKS
146740011113     C     VIDVMD        ANDNE     0
146750941220     C                   MOVEL     ERR(105)      VIDMSG
146760941231     C                   SETON                                        8290
146770941219     C                   GOTO      ENDC02
146780941219     C                   ENDIF
146790941219     C*
146800941219     C                   MOVEL     VIDVAD        VARVAD
146810950120     C                   CLEAR                   WIN88
146820011212      * pulisco il flag x la forzatura valore merce
146830011212     C     VIDVMD        IFNE      WARVMD
146840011212     C                   CLEAR                   FORVMD
146850050714     c                   Clear                   forzavmd          1
146860011212     C                   Z-ADD     VIDVMD        WARVMD
146870011212     C                   ENDIF
146880011212     C* CONTROLLO LIMITI
146890011212     C                   CLEAR                   DSUL23
146900011212     C                   MOVEL     VIDCBO        I23CBO
146910011212     C     VIDTSP        IFNE      *BLANKS
146920011212     C                   MOVEL     VIDTSP        I23TSP
146930011212     C                   ELSE
146940011212     C                   MOVEL     COMTSP        I23TSP
146950011212     C                   ENDIF
146960011212     C                   Z-ADD     VIDLNP        I23LNP
146970011212     C                   MOVEL     VIDNZM        I23NZM
146980011212     C                   Z-ADD     COMLNA        I23LNA
146990011212     C                   MOVEL     VIDNZD        I23NZD
147000011212     C     *IN04         IFEQ      *ON
147010011212     C                   Z-ADD     9999          I23KSC
147020011212     C                   MOVEL     VIDLNP        I23KSC
147030011212     C                   ELSE
147040011212     C                   Z-ADD     VIDCCM        I23KSC
147050011212     C     VIDFLC        IFEQ      0
147060011212     C                   MOVEL     VIDLNP        I23KSC
147070011212     C                   ELSE
147080011212     C                   MOVEL     VIDFLC        I23KSC
147090011212     C                   ENDIF
147100011212     C                   ENDIF
147110011212     C                   MOVEL     VIDCTR        I23CTR
147120011212     C                   Z-ADD     VIDVMD        I23IMP
147130011212     C                   MOVEL     VIDVAD        I23DIV
147140011212     C                   MOVEL     KNMUS         I23UTE
147150011212     C                   MOVEL     NOMPGM        I23PGM
147160011212     C                   CALL      'TRUL23R'
147170011212     C                   PARM                    DSUL23
147180011212     C* IMPORTO INFERIORE AL LIMITE MINIMO
147190011212    1C     O23FMN        IFNE      *BLANKS
147200011212     C* Il messaggio è diverso a seconda che l'importo passato sia 0
147210011212     C* O > 0
147220011212    2C     VIDVMD        IFEQ      *ZEROS
147230011212     C                   MOVEL     ERR(238)      VIDMSG
147240011212   x2C                   ELSE
147250011212     C                   MOVEA     ERR(239)      K78
147260011212     C                   MOVE      O23LMN        WNUMED
147270011212     C* richiamo routine per editare il limite
147280011212     C                   EXSR      CALLXE
147290011212      * metto il numero editato nel campo del messaggio
147300011212     C                   MOVEA     W014A         SKII(1)
147310011212     C                   MOVEA     SKII(1)       K78(37)
147320011212     C                   MOVEA     K78           VIDMSG
147330011212    2C                   ENDIF
147340011212     C                   SETON                                        8290
147350011212     C                   GOTO      ENDC02
147360011212    1C                   ENDIF
147370011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO BLOCCANTE
147380011212     C     O23FX2        IFNE      *BLANKS
147390011212     C                   MOVEA     ERR(240)      K78
147400011212     C                   MOVE      O23LX2        WNUMED
147410011212     C* richiamo routine per editare il limite
147420011212     C                   EXSR      CALLXE
147430011212      * metto il numero editato nel campo del messaggio
147440011212     C                   MOVEA     W014A         SKII(1)
147450011212     C                   MOVEA     SKII(1)       K78(53)
147460011212     C                   MOVEA     K78           VIDMSG
147470011212     C                   SETON                                        8290
147480011212     C                   GOTO      ENDC02
147490011212     C                   ENDIF
147500011212     c* IMPORTO SUPERIORE AL LIMITE MASSIMO FORZABILE
147510011212     C     O23FX1        IFNE      *BLANKS
147520011212     C     FORVMD        ANDEQ     *BLANKS
147530011212     C                   MOVE      '1'           FORVMD            1
147540011212     C                   MOVEA     ERR(241)      K78
147550011212     C                   MOVE      O23LX1        WNUMED
147560011212     C* richiamo routine per editare il limite
147570011212     C                   EXSR      CALLXE
147580011212      * metto il numero editato nel campo del messaggio
147590011212     C                   MOVEA     W014A         SKII(1)
147600011212     C                   MOVEA     SKII(1)       K78(30)
147610011212     C                   MOVEA     K78           VIDMSG
147620011212     C                   SETON                                        8290
147630011212     C                   GOTO      ENDC02
147640011212     C                   ENDIF
147650950410     C* SE IMP ASSICURARE E VAL MERCE HANNO STESSO IMPORTO--> DEVONO
147660950410     C*  AVERE  ANCHE STESSA DIVISA E VICEVERSA
147670050714      * msg forzabile
147680950410    1C     VIDVMD        IFGT      0
147690950410     C*
147700950410     C     VIDIAS        IFEQ      VIDVMD
147710950410     C     VIDVAD        ANDNE     VIDVAS
147720050714     c     forzavmd      andeq     *Blanks
147730050714     c                   Eval      vidmsg = ERR(122)
147740950410     C                   SETON                                        6990
147750050714     c                   Eval      forzavmd = '1'
147760950410     C                   GOTO      ENDC02
147770950410    2C                   ENDIF
147780950410     C     VIDVAD        IFEQ      VIDVAS
147790950410     C     VIDIAS        ANDGT     0
147800950410     C     VIDIAS        ANDNE     VIDVMD
147810050714     c     forzavmd      andeq     *Blanks
147820050714     c                   Eval      vidmsg = ERR(122)
147830950410     C                   SETON                                        8290
147840050714     c                   Eval      forzavmd = '1'
147850950410     C                   GOTO      ENDC02
147860950410    2C                   ENDIF
147870950410     C*
147880950410    1C                   ENDIF
147890940913     C***
147900930329     C*** CONSEGNA RICHISTA ***
147910090901     c*  non accetto la consegna richiesta se tipo servizio H
147920150202     c                   if        (viddcr>0 or vidhcr>0) and vidtsp='H'
147930090901     C                   MOVEL     ERR(60)       VIDMSG
147940090901     C                   SETON                                        5990
147950090901     c                   goto      endc02
147960090901     c                   endif
147970090901     c
147980941115     C                   Z-ADD     VIDDCR        WDCR
147990941115     C                   Z-ADD     VIDHCR        WHCR
148000941115     C                   Z-ADD     VIDMCR        WMCR
148010940913     C                   MOVEL     VIDTCR        WTCR
148020940913     C                   EXSR      CTRCR
148030940916     C                   MOVEL     WDCR          VIDDCR
148040940920     C   90              GOTO      ENDC02
148050101022     c
148060101022     c* Controllo se cade in giorno festivo col calendario arrivi
148070101022    1c                   if        vidtcr=' '  and viddcr>0
148080101022     c                   movel     comdcr        wdata
148090101022     c                   clear                   w0030
148100101022     C     KCLNa         CHAIN     AZCLN01L                           30
148110101022     C   30              CLEAR                   CLNPOM
148120101022     C                   MOVEA     CLNPOM        K31
148130101022     C                   MOVEL     K31(WGG)      WFEST
148140101022     c     wfest         lookup    S1Y                                    30
148150101022     c
148160101022     c                   if        *in30 and wfest<>' '
148170141124     c                   select
148180141124     c                   when      a_§ogntw<>'FED' and a_§ogntw<>'DPD'
148190141124     c                             and a_§ogntw<>'EEX'
148200101022     C                   MOVEL     ERR(197)      VIDMSG
148210101022     C                   SETON                                        5990
148220101022     C                   GOTO      ENDC02
148230141124     c                   when      comlna<>wforz_lna
148240141124     c                   eval      wforz_lna=comlna
148250141124     C                   MOVEL     ERR(197)      VIDMSG
148260141124     c                   eval      vidmsg=%trim(Vidmsg)+ '.Enter x Forzare'
148270141124     C                   SETON                                        5990
148280141124     C                   GOTO      ENDC02
148290141124     c                   endsl
148300101022    2C                   ENDIF
148310101022    1C                   ENDIF
148320940916     C***
148330960319     C*** GIORNI DI CHIUSURA ***
148340960319     C                   MOVEL     VIDGC1        WGC1
148350960319     C                   MOVEL     VIDGC2        WGC2
148360960319     C                   EXSR      CTRGCH
148370960319     C   90              GOTO      ENDC02
148380940214     C*
148390100219     c
148400940919     C***
148410940919     C*** PARTICOLARITA' C/A ***
148420940919    1C     VIDGCA        IFNE      *BLANKS
148430941005     C     VIDGCR        ORNE      *BLANKS
148440031029      * salto questo controllo
148450031029      * xchè per ora la particolarità c/a non deve essere gestita
148460031029     c                   GoTo      DopoMsg
148470940922     C*
148480940922     C* non posso indicarla se tipo bolla non prevede C/Assegno
148490940928    2C     §3AFCA        IFEQ      0
148500941005     C     VIDGCA        ANDNE     *BLANKS
148510940922     C                   SETON                                        6590
148520940922     C                   MOVEL     ERR(103)      VIDMSG
148530940922     C                   GOTO      ENDC02
148540940922    2C                   ENDIF
148550031029     c     DopoMsg       Tag
148560940922     C*
148570941005     C* RICHIAMO IL PRG DI RICERCA
148580941005    2C     VIDGCR        IFEQ      '?'
148590031029      * non devo fare nessuna ricerca xchè per ora la particolarità c/a non
148600031029      * deve essere gestita
148610031029     c                   GoTo      DopoRicGca
148620941005     C                   CLEAR                   DS7PQR
148630941005     C                   MOVEL     'S'           DS7RIC
148640941005     C                   MOVEL     'V'           DS7GES
148650941005     C                   MOVEL     WKSC          DS7KSC
148660941005     C                   MOVEL     VIDGCA        DS7COD
148670941005     C                   MOVEL     DS7PQR        KPJBU
148680941005     C                   CALL      'TRTB72R'
148690941005     C                   PARM                    KPJBA
148700941005     C                   MOVEL     KPJBU         DS7PQR
148710111110     C***                CLEAR                   VIDGCR
148720941005     C*
148730941005     C     VIDGCA        IFEQ      *BLANKS
148740941005     C                   MOVEL     DS7COD        VIDGCA
148750941005    2C                   ENDIF
148760941005     C*
148770111110     c     DopoRicGca    Tag
148780111110     C                   CLEAR                   VIDGCR
148790960109     C                   SETON                                        65
148800941005     C                   MOVEL     '1'           WEMFOR
148810111110     c***  DopoRicGca    Tag
148820941005     C                   GOTO      ENDC02
148830941005    2C                   ENDIF
148840941005     C* CONTROLLO
148850031029      * non devo fare nessun controllo xchè per ora la particolarità c/a non
148860031029      * deve essere gestita
148870031029      * ma se immessa emetto un errore
148880031029     c                   Eval      VidMsg = Err(31)
148890031029     c                   Eval      *In65 = *On
148900031029     c                   Eval      *In90 = *On
148910031029     c                   Goto      EndC02
148920031029
148930941005     C                   CLEAR                   DS7PQR
148940941005     C                   MOVEL     'S'           DS7RIC
148950941005     C                   MOVEL     'C'           DS7GES
148960941005     C                   MOVEL     WKSC          DS7KSC
148970941005     C                   MOVEL     VIDGCA        DS7COD
148980941005     C                   MOVEL     DS7PQR        KPJBU
148990941005     C                   CALL      'TRTB72R'
149000941005     C                   PARM                    KPJBA
149010941005     C                   MOVEL     KPJBU         DS7PQR
149020941005     C* ERRORE
149030941005    2C     DS7ERR        IFEQ      '1'
149040941005     C                   MOVEL     DS7MSG        VIDMSG
149050941005     C                   SETON                                        6590
149060940920     C                   GOTO      ENDC02
149070940919    2C                   ENDIF
149080940922     C*
149090940922    1C                   ENDIF
149100940919     C***
149110940919     C*** PARTICOLARITA' GIACENZA ***
149120940919    1C     VIDGGA        IFNE      *BLANKS
149130941005     C     VIDGGR        ORNE      *BLANKS
149140941005     C*
149150941005     C* RICHIAMO IL PRG DI RICERCA
149160951120    2C     VIDGGR        IFEQ      '?'
149170941005     C                   CLEAR                   DS7PQR
149180941005     C                   MOVEL     'S'           DS7RIC
149190941005     C                   MOVEL     'V'           DS7GES
149200941005     C                   MOVEL     VIDGGA        DS7COD
149210941005     C                   MOVEL     DS7PQR        KPJBU
149220941005     C                   CALL      'TRTB69R'
149230941005     C                   PARM                    KPJBA
149240941005     C                   MOVEL     KPJBU         DS7PQR
149250960109     C                   CLEAR                   VIDGGR
149260941005     C*
149270941005     C     VIDGGA        IFEQ      *BLANKS
149280941005     C                   MOVEL     DS7COD        VIDGGA
149290941005    2C                   ENDIF
149300941005     C*
149310960109     C                   SETON                                        66
149320941005     C                   MOVEL     '1'           WEMFOR
149330941005     C                   GOTO      ENDC02
149340941005    2C                   ENDIF
149350941005     C* CONTROLLO
149360941005     C                   CLEAR                   DS7PQR
149370941005     C                   MOVEL     'S'           DS7RIC
149380941005     C                   MOVEL     'C'           DS7GES
149390941005     C                   MOVEL     WKSC          DS7KSC
149400941005     C                   MOVEL     VIDGGA        DS7COD
149410941005     C                   MOVEL     DS7PQR        KPJBU
149420941005     C                   CALL      'TRTB69R'
149430941005     C                   PARM                    KPJBA
149440941005     C                   MOVEL     KPJBU         DS7PQR
149450941005     C* ERRORE
149460941005    2C     DS7ERR        IFEQ      '1'
149470941005     C                   MOVEL     DS7MSG        VIDMSG
149480941005     C                   SETON                                        6690
149490940920     C                   GOTO      ENDC02
149500940919    2C                   ENDIF
149510940919    1C                   ENDIF
149520940919     C***
149530940919     C*** PARTICOLARITA' CONSEGNA ***
149540100218     c                   clear                   ds7r
149550940922    1C     VIDGMA        IFNE      *BLANKS
149560951120     C     VIDGMR        ORNE      *BLANKS
149570941005     C* RICHIAMO IL PRG DI RICERCA
149580941005    2C     VIDGMR        IFEQ      '?'
149590941005     C                   CLEAR                   DS7PQR
149600941005     C                   MOVEL     'S'           DS7RIC
149610941005     C                   MOVEL     'V'           DS7GES
149620941005     C                   MOVEL     VIDGMA        DS7COD
149630941005     C                   MOVEL     DS7PQR        KPJBU
149640941005     C                   CALL      'TRTB70R'
149650941005     C                   PARM                    KPJBA
149660941005     C                   MOVEL     KPJBU         DS7PQR
149670960109     C                   CLEAR                   VIDGMR
149680941005     C*
149690941005     C     VIDGMA        IFEQ      *BLANKS
149700941005     C                   MOVEL     DS7COD        VIDGMA
149710941005    2C                   ENDIF
149720941005     C*
149730960109     C                   SETON                                        67
149740941005     C                   MOVEL     '1'           WEMFOR
149750941005     C                   GOTO      ENDC02
149760941005    2C                   ENDIF
149770941005     C* CONTROLLO
149780941005     C                   CLEAR                   DS7PQR
149790941005     C                   MOVEL     'S'           DS7RIC
149800941005     C                   MOVEL     'C'           DS7GES
149810941005     C                   MOVEL     WKSC          DS7KSC
149820941005     C                   MOVEL     VIDGMA        DS7COD
149830941005     C                   MOVEL     DS7PQR        KPJBU
149840941005     C                   CALL      'TRTB70R'
149850941005     C                   PARM                    KPJBA
149860941005     C                   MOVEL     KPJBU         DS7PQR
149870941005     C* ERRORE
149880941005    2C     DS7ERR        IFEQ      '1'
149890100215     C                   MOVEL     DS7MSG        VIDMSG
149900941005     C                   SETON                                        6790
149910940920     C                   GOTO      ENDC02
149920940919    2C                   ENDIF
149930100215     c*
149940100215     c* Da tabella 7R verifico se prevede il calcolo della consegna
149950100215     c*  richeista (Tab DCR) e segnalo eventuali incongruenze
149960100215     C                   MOVEL     '7R'          COD
149970100215     C                   MOVEL(P)  VIDGMA        KEY
149980100215     C                   EXSR      CTABEL
149990100215     C                   MOVEL     TBLUNI        DS7R
150000100215     c
150010100215     c                   if        §7ratt ='S' and
150020100215     c                             (vidtsp='H' or vidtsp='E')
150030100215     C                   MOVEL     err(332)      VIDMSG
150040100215     C                   SETON                                        6790
150050100215     C                   GOTO      ENDC02
150060100215    2C                   ENDIF
150070100218     c
150080100224    1c                   if        §7ratt ='S' and
150090100217     c                             (vidore>0 or viddcr>0 )
150100100218     c* In manutenzione non do errore se la particolarità c'era
150110100218     c*  anche prima
150120100224     c* Se richiamato da pgm di cambio porto dirottamento non do errore
150130100224     c                   if        not *in44 and (not *in12 or *in15 or
150140100224     c                              blpgma<>vidgma)
150150100215     C                   MOVEL     err(333)      VIDMSG
150160100215     C                   SETON                                        6790
150170100215     C                   GOTO      ENDC02
150180100215    2C                   ENDIF
150190100224    1C                   ENDIF
150200100218     c
150210100224     c                   if        §7ratt ='S' and (§3arbl='R' or
150220100224     c                             §3arbl='C' and §3aucb=' ')
150230100217     C                   MOVEL     err(334)      VIDMSG
150240100217     C                   SETON                                        6790
150250141201c    C                   GOTO      ENDC02
150260100217    2C                   ENDIF
150270151015
150280151015     c* Particolarità consegna "RC"  non utilizzabile per bolle export
150290151015If  2c                   If        §7rRC = 'S'  and
150300151015     c                             (A_§ogntw='FED' or
150310151015     c                             a_§ogntw='EEX' or
150320151015     c                             a_§ogntw='DPD')
150330151015     c                   seton                                        6790
150340151015     C                   MOVEL     err(363)      VIDMSG
150350151015     c                   eval      %subst(vidmsg:25:2)=vidgma
150360151015     c                   GoTo      EndC02
150370151015     c                   endif
150380100215     c
150390030805      * Se la bolla prevede la particolarità consegne 'RC' devo controllare
150400030805      * che esista l'ORM da utilizzare per il ritiro contestuale alla consegna
150410030912      * solo se non sono chiamata da giacenze
150420100604If  2c**                 If        VidGma = 'RC' and
150430100604If  2c                   If        §7rRC = 'S'   and
150440030912If  2c                             savfpr <> 'G' and savfpr <> 'P'
150450150302     c                             and savfpr<>'B'
150460031217     c                   Eval      wope = 'C'
150470030805     c                   ExSr      Sr_RicOrm
150480030805If  3c                   If        *In90 = *On
150490030805     c                   GoTo      EndC02
150500030805    3c                   EndIf
150510030805    2c                   EndIf
150520940919    1C                   ENDIF
150530100219     c
150540141201     c* Controlli Congruenza fra PinCode e Codice Particolarità
150550141201     c* se bolla export errore forzabile se presente particolartià che
150560141201     c* prevede PIN Code
150570141201     c                   if        A_§ogntw='FED' or
150580141201     c                             a_§ogntw='EEX' or
150590141201     c                             a_§ogntw='DPD'
150600141201     c                   if        §7rpincode='S' and WforzPCExp=' '
150610141201     c                   eval      WforzPCExp='1'
150620141201     c                   seton                                        6790
150630141201     C                   MOVEL     err(352)      VIDMSG
150640141201     c                   GoTo      EndC02
150650141201     c                   endif
150660141201     c                   else
150670141201     c* Controlli per bolla NON Export
150680141202     c* non eseguo questi controlli se provengo da pgm giacenze
150690141202     c                   if        not *in44
150700141201     c                   select
150710141201     c                   when      wpincode<>*blanks and  (
150720141201     c                             (vidgma=*blanks) or
150730141201     c                             (vidgma<>*blanks and §7rpincode<>'S'))
150740141201     c                   seton                                        6790
150750141201     C                   MOVEL     err(353)      VIDMSG
150760141201     c                   GoTo      EndC02
150770141201     c                   when      wpincode=*blanks and vidgma<>*blanks
150780141201     c                             and §7rpincode='S'
150790141201     c                   seton                                        6790
150800141201     C                   MOVEL     err(354)      VIDMSG
150810141201     c                   GoTo      EndC02
150820141201     c                   endsl
150830141202     c* se provengo da pgm giacenze controllo che non si modifichi la particola-
150840141202     c* rità giacenza rispetto a quella passata da "pin code" a "no pin code"
150850141202     c* o viceversa
150860141202     c                   else
150870141202     c                   if        vidgma<>§lpgma and
150880141202     c                             w7rPC<>§7rpincode
150890141202     c                   seton                                        6790
150900141202     C                   MOVEL     err(357)      VIDMSG
150910141202     c                   GoTo      EndC02
150920141202     c                   endif
150930141202     c                   endif
150940141201     c                   endif
150950141201     c*
150960100219     C* DATA CONSEGNA NON PUO' ESSERE < DATA CONSEGNA TEORICA
150970100219     C* SE TIPO CONSEGNA E' ' ' O 'P' (IL O PRIMA DEL)
150980100219     C* (QUESTO CONTROLLO LO METTO DOPO I GIORNI CHIUSURA e dopo la partic.
150990100219     C*  consegna perchè mi SERVONO E CORRETTI)
151000100219     c* data consegna non puo' essere > data consegna teorica più i gio
151010100219     c* rni di tolleranza oltre delivery come da tabella vpo
151020100219    1C     VIDDCR        IFGT      0
151030100219     C* CALL AL TNSD99
151040100219     c                   clear                   UsaCass
151050100219     C                   EXSR      CLSE98
151060100219     c                   z-add     d98dce        s_d98dce
151070100219   1aC     VIDTCR        ifne      'D'
151080100219     C*
151090100219    2C     COMDCR        IFLT      D98DCE
151100100219     c* se tipo servizio "Distribuzione" richiamo nuovamente TNSD99R passand
151110100219     c* ogli tipo servizio corriere. Infatti se la data consegna richiesta
151120100219     c* è inferiore anche della data teorica per il servizio corriere l'erro
151130100219     c* re è bloccante altrimenti è forzabile
151140100219    3c                   if        d98tsp = 'D'
151150100219     c                   eval      d98tsp = 'C'
151160100219     C                   CALL      'TNSD99R'
151170100219     C                   PARM                    DSSD99
151180100219    4c     comdcr        ifge      d98dce
151190100219    5c     uno           ifne      '1'
151200100219     C                   MOVEL     ERR(62)       VIDMSG
151210100219     C                   seTON                                        5990
151220100219     C                   MOVEL     '1'           UNO
151230100219     c                   eval      vidmsg = %trim(vidmsg) + ' ENTER per FORZARE'
151240100219     C                   GOTO      ENDC02
151250100219    5c                   endif
151260100219   x4c                   else
151270100219     C                   MOVEL     ERR(62)       VIDMSG
151280100219     C                   SETON                                        5990
151290100219     c                   goto      endc02
151300100219    4c                   endif
151310100219   x3c                   else
151320100219     C                   MOVEL     ERR(62)       VIDMSG
151330100219     C                   SETON                                        5990
151340100219     C                   GOTO      ENDC02
151350100219    3c                   endif
151360100219    2C                   ENDIF
151370100219   1aC                   ENDIF
151380100219     c** Aggiungo alla data consegna teorica i giorni previsti in tabella
151390100219      *  escludendo i festivi
151400100219      *  questo messaggio non lo do per particolarità di ATTESA
151410100219    2c                   if        vidgma= *blanks  or  §7rATT=' '
151420100219     c                   Clear                   Trul13ds
151430100219     c                   Eval      tI13Tla = 'L'
151440100219     c                   Eval      I13Mod = 'A'
151450100219     c                   Eval      I13Fil = comlna
151460100219     c                   Eval      I13Din = S_d98dce
151470100219     c                   Eval      I13gio = §vpodcrod
151480100219     c                   Call      'TRUL13R'
151490100219     c                   Parm                    Trul13ds
151500100219    3c                   If        tO13Err = *Blanks  and
151510100219     c                             comdcr > o13dfi and fordcr = *blanks
151520100219     c                   eval      vidmsg = err(294)
151530100219     c                   Eval      VidMsg = %trim(vidmsg) + ' ' +
151540100219     c                             %trim(%editc(§vpodcrod:'Z'))  +
151550100219     c                             ' giorni la data consegna teorica.' +
151560100219     c                             'ENTER x FORZ.'
151570100219     C                   SETON                                        5990
151580100219     c                   movel     '1'           fordcr
151590100219     C                   GOTO      ENDC02
151600100219    3c                   endif
151610100219    2C                   ENDIF
151620100219    1C                   ENDIF
151630100219     c
151640050415     c* Se particolarita varia = 'O' il controllo seguente l'ho già
151650050415     c* fatto prima del calcolo del volume automatico
151660150304     c****               if        %subst(vidgva:1:1)<>'O'
151670150304     c****               exsr      sr_CntPVBan
151680150304     c**** wemfor        ifeq      '1'
151690150304     c***                goto      endc02
151700150304     c****               endif
151710150304     c****               endif
151720040216
151730040216      * --> Telefono del destinatario
151740040216      *     (da immettere in prima videata)
151750040216      * x Spedizione con Appuntamento
151760040216      * x Spedizione con consegna a PRIVATI
151770040216if  1c                   If        VidTel = *Blanks and wforza1 = *Off and
151780150213     c                             wforza2 = *Off and not *in12
151790040216s   2c                   Select
151800040216     c                   When      VidTc1 = 'A' or VidTc2 = 'A'
151810040216     c                   Eval      VidMsg = Err(267)
151820040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
151830040216     c                   Eval      *In90 = *On
151840040216     c                   When      %subst(VidGva:1:1) = 'P'
151850040216     c                   Eval      VidMsg = Err(58)
151860040216     c                   Eval      %subst(VidMsg:62:15) = 'F12 x immettere'
151870040216     c                   Eval      *In90 = *On
151880040216    2c                   EndSl
151890040216if  2c                   If        *In90
151900040216     c                   Eval      wforza2 = *On
151910040216     c                   GoTo      EndC02
151920040216    2c                   EndIf
151930040216    1c                   EndIf
151940040610     C***
151950040610     C*** Tipo MERCE V-Valore ***
151960040610    1C     VIDbva        ifne      *BLANKS
151970040610     c     §1bfg8        andne     'S'
151980040610     C                   MOVEL     ERR(281)      VIDMSG
151990040610     C                   SETON                                        90
152000040610     c                   z-add     20            H2riga
152010040610     c                   z-add     80            H2colo
152020040610     C                   GOTO      ENDC02
152030040610    1C                   END
152040940919     C***
152050050309     c*
152060050309     c* Essendosi verificato un caso di bolla immessa senza il cod boll
152070050309     c* per sicurezza aggiungo il seguente controllo
152080050309     c     vidcbo        ifeq      *blanks
152090050309     C                   MOVEL     ERR(292)      VIDMSG
152100050309     C                   SETON                                        90
152110050309     C                   GOTO      ENDC02
152120050309     c                   endif
152130160511     c* Indirizzo email e numero di cellulare per invio SMS:
152140160512     c* non sono da memorizzare se bolla export NON DPD
152150160511     c                   if        sav_wemdest<>*blanks
152160160511     c                   if            wdesie='E' and
152170160512     c                             a_§ogntw<>'DPD'
152180160511     c                   clear                   wemdest
152190160511     c                   else
152200160511     c* se hanno cambiato il newtork riprendo l'eventuale indirizzo email
152210160511     c                   eval      wemdest=sav_wemdest
152220160511     c                   endif
152230160511     c                   endif
152240160511     c* numero di cellulare per invio sms
152250160511     c                   if        sav_wsms<>*blanks
152260160511     c                   if        wdesie='E' and
152270160512     c                             a_§ogntw<>'DPD'
152280160511     c                   clear                   wsms
152290160511     c                   else
152300160511     c* se hanno cambiato il newtork riprendo l'eventuale numero di cell
152310160511     c                   eval      wsms=sav_wsms
152320160511     c                   endif
152330160511     c                   endif
152340940919     C*** FINE SUBROUTINE
152350940920     C     ENDC02        TAG
152360940826     C   90              MOVEL     '1'           WEMFOR
152370941021     C*
152380940826     C                   ENDSR
152390160224     C* Richiamo cappario dpd -----------------------------------
152400160224     c     sr_tisie3     begsr
152410160224     c                   clear                   tisie3ds
152420160224     c                   eval      isie3tla='E'
152430160224     c                   z-add     blpdsp        isie3dri
152440160224     C                   z-add     BLPDSP        Isie3dsp
152450160224     c                   time                    isie3hsp
152460160224     C                   MOVEL     VIDNZD        isie3nzd
152470160224     C                   MOVEL     VIDCAD        Isie3cad
152480160224     c                   movel     vidlod        isie3cty
152490160224     c                   z-add     vidlnp        isie3lnp
152500160224     C     VIDFBR        IFEQ      'S'
152510160224     c                   z-add     300           isie3srv
152520160224     c                   else
152530160224     c                   if        v2cpkg>§3ilmp
152540160224     c                   z-add     101           isie3srv
152550160224     c                   else
152560160224     c                   z-add     136           isie3srv
152570160224     c                   endif
152580160224     c                   endif
152590160224     c                   movel     'N'           isie3exc
152600160224     C                   CALL      'TISIE3R'
152610160224     C                   PARM                    tisie3ds
152620160224     c                   endsr
152630091211     C* Richiamo trulticr per controllo tipo incasso c/a e divisa  ---*
152640091211     c     sr_trultic    begsr
152650091211     c                   clear                   trulticds
152660091211     c                   clear                   ds1a
152670091211     c                   eval      iticTBO='P'
152680091211     c                   eval      iticlnp=vidlnp
152690091211     c                   eval      iticlna=comlna
152700091211     c                   eval      iticlnantw=A_§ogntw
152710091211     c                   eval      iticnzd=vidnzd
152720091211     c                   eval      iticprd=vidprd
152730091211     c                   eval      iticcad=vidcad
152740091211     c                   eval      iticlod=vidlod
152750091211     c                   eval      iticind=vidind
152760091211     c                   eval      iticrsd=vidrsd
152770091211     c                   eval      iticdsp=blpdsp
152780091211     c* se orm con triangolazione e beneficiario ordinante-->passo ordinante
152790091211     c* altrimenti sempre il mittente
152800091211     c                   if        nochkticC=*on and wcassel2='X'
152810091211     C                   eval      iticccm=ormksc
152820091211     c                   else
152830091211     C                   eval      iticccm=wksc
152840091211     c                   endif
152850091211
152860091211     c                   eval      itictic=vidtic
152870091211     c                   eval      iticdiv=vidvca
152880091211     c                   eval      iticcas=vidcas
152890091211     c                   eval      iticpgm='FNLS01R'
152900091211     c* 44 on = richiamato da pgm giacenze --> devo passare
152910091211     c*         l'info a trultic per far si che venga bypassato il
152920091211     c*         controllo su tabella "TM"
152930091211    2c                   if        *in44
152940091211     c                   eval      %subst(iticpgm:10:1)='1'
152950091211    2c                   endif
152960091211     c                   call      'TRULTICR'
152970091211     c                   parm                    TRULTICDS
152980091211     c                   parm                    ds1a
152990091211     c*
153000091211     c                   endsr
153010091211     c*
153020091211     C* Impostazinoe flag per controllo tic --------------------------*
153030091211     C     sr_impochktic BEGSR
153040091211     C*
153050091214     c                   eval      nochkticC=*off
153060091211     c                   if        dateu>=§vpocas
153070091211     c                   if        §3afca<>0 and flgfit<>'S' and ormpag='O'
153080091211     c                             and §1amro<>'S'
153090091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
153100091211     c                                 %editc(ormksc:'X')
153110091211     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
153120091211     c                                 %subst(%editc(ormcor:'X'):1:7)
153130091211     c                   eval      nochkticC=*on
153140091211     c                   endif
153150091211     c                   endif
153160091211     c                   endsr
153170940922     C*
153180940922     C* CONTROLLO DIVISA ---------------------------------------------*
153190940922     C     CTRVLT        BEGSR
153200940922     C*
153210940922     C                   MOVEL     'CV'          COD
153220940922     C* RICERCA
153230940922     C     '?'           SCAN      WVLT                                   30
153240940922     C     *IN30         IFEQ      *ON
153250940922     C                   EXSR      CX§TAB
153260940922     C                   MOVEL     §KEY          WVLT
153270940922     C                   GOTO      ENDVLT
153280940922     C                   ENDIF
153290940922     C*
153300940922     C* CONTROLLO DIVISA
153310940922     C                   MOVEL(P)  WVLT          KEY
153320940922     C                   EXSR      CTABEL
153330940922     C* ERRORE
153340940922    1C     *IN30         IFEQ      *ON
153350941110     C                   MOVEL     ERR(79)       VIDMSG
153360940922     C                   SETON                                        90
153370940922     C                   GOTO      ENDVLT
153380940922    1C                   ENDIF
153390940922     C                   MOVEL     TBLUNI        DSCV
153400940922     C*
153410940922     C* VEDO SE AMMESSI IMPORTI DECIMALI NELL'IMPORTO
153420940922    1C     §CVFDC        IFNE      'S'
153430940922     C                   MOVE      W0133         W0033             3 3
153440940922    2C     W0033         IFNE      0
153450941110     C                   MOVEL     ERR(78)       VIDMSG
153460940922    2C                   ENDIF
153470991025      *
153480991025   X1C                   ELSE
153490991025      * VERIFICO SE I DECIMALI INSERITI SONO QUELLLI AMMESSI
153500991025     C                   SELECT
153510991025     C     §CVDEC        WHENEQ    3
153520991025     C     §CVDEC        WHENEQ    2
153530991025     C                   MOVE      W0133         W0010             1 0
153540991025     C     W0010         IFNE      *ZEROS
153550991025     C                   MOVEL     ERR(171)      VIDMSG
153560991025     C                   ENDIF
153570991025     C     §CVDEC        WHENEQ    1
153580991025     C                   MOVE      W0133         W0020             2 0
153590991025     C     W0020         IFNE      *ZEROS
153600991025     C                   MOVEL     ERR(171)      VIDMSG
153610991025     C                   ENDIF
153620991025     C     §CVDEC        WHENEQ    0
153630991025     C                   ENDSL
153640991025      *
153650991025    1C                   ENDIF
153660991025      *
153670991025     C     VIDMSG        IFNE      *BLANKS
153680991025     C                   SETON                                        90
153690991025     C                   GOTO      ENDVLT
153700991025     C                   ENDIF
153710940922     C*
153720940922     C     ENDVLT        TAG
153730940922     C   90              MOVEL     '1'           WEMFOR
153740940922     C                   ENDSR
153750940916     C*
153760940916     C* PREPARA IL MESSAGGIO DI SEGNACOLLO DOPPIO -------------------*
153770940916     C     PRPMSG        BEGSR
153780940916     C* MUOVO LA SKIERA DELL ERRORE
153790940916     C                   MOVEA     ERR(92)       K78
153800940916     C*
153810940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL SEGNACOLLO
153820940916     C                   MOVEL     COMSCD        W007A             7
153830950718     C                   MOVEA     W007A         SKI(9)
153840950718     C                   Z-ADD     9             I                 3 0
153850950718     C                   EXSR      ABBL
153860940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
153870950718     C                   MOVEA     SKI(9)        K78(19)
153880940916     C* IMPOSTO L'ANNO
153890120828     C                   MOVE      BLTAAS        W004A             4
153900120828     C***                MOVE      ARTAAS        W004A             4
153910940916     C                   MOVEA     W004A         K78(52)
153920940916     C* LINEA DI PARTENZA
153930120828     C                   MOVEL     BLTLNP        W003A             3
153940120828     C***                MOVEL     ARTLNP        W003A             3
153950940916     C                   MOVEA     W003A         K78(57)
153960940916     C* SERIE
153970120828     C     BLTNRS        IFEQ      00
153980120828     C***  ARTNRS        IFEQ      00
153990940916     C                   MOVEA     '  '          K78(61)
154000940916     C                   ELSE
154010120828     C                   MOVEL     BLTNRS        W002A             2
154020120828     C***                MOVEL     ARTNRS        W002A             2
154030940916     C                   MOVEA     W002A         K78(61)
154040940916     C                   ENDIF
154050940916     C* SOSTITUISCO CON " " GLI 0 NON SIGNIFICATIVI DEL NUM.SPEDIZIONE
154060120828     C                   MOVEL     BLTNSP        W007A
154070120828     C***                MOVEL     ARTNSP        W007A
154080950718     C                   MOVEA     W007A         SKI(9)
154090950718     C                   Z-ADD     9             I
154100950718     C                   EXSR      ABBL
154110940916     C* IMPOSTO IL NUMERO DI SEGNACOLLO DOPPIO
154120950718     C                   MOVEA     SKI(9)        K78(64)
154130940916     C* LINEA DI ARRIVO
154140120828     C                   MOVEL     BLTLNA        W003A             3
154150120828     C***                MOVEL     ARTLNA        W003A             3
154160940916     C                   MOVEA     W003A         K78(76)
154170940916     C*
154180940916     C* MUOVO LA SKIERA NEL MESSAGGIO
154190940916     C                   MOVEA     K78           VIDMSG
154200940922     C                   SETON                                        45
154210940916     C                   ENDSR
154220960318     C*
154230960318     C* CONTROLLO SE SPEDIZIONE CON COLLI > DEL PREVISTO-------------*
154240960318     C     CTRCRG        BEGSR
154250960318    1C     VIDNCL        IFGT      §3INCL
154260030704      * Se devo bancalare i colli emetto la finestra
154270030704     c                   Clear                   w03rig1
154280030704     c                   Clear                   w03rig2
154290030704     c                   Eval      w03rig1 =
154300030704     c                                      'Attenzione numero colli +
154310030704     c                                       superiore a'
154320030704     c                   Eval      w03rig1 =
154330030704     c                                      %trim(w03rig1) + ' ' +
154340030704     c                                      %trim(%editc(§3iNcl:'4'))
154350030704     c                   Eval      w03rig2 =
154360030704     c                                      'Bancalare i colli prima di +
154370030704     c                                       bollettare'
154380030704     c                   Eval      At3c01 = nodi
154390030704     c                   Eval      At3cor = ndpr
154400030704     c                   Eval      At3c02 = nodi
154410030704     c                   Eval      At3csf = ndpr
154420030704     c                   Eval      At3f12 = nodi
154430030704     c                   Do        *Hival
154440030704     c                   Exfmt     Ls01w03
154450030704     c                   Eval      *In41 = *On
154460030704     c                   Eval      wforw03 = '1'
154470030704     c   kf              Leave
154480030704     c                   EndDo
154490030704
154500960318    1C                   ENDIF
154510960318     C                   ENDSR
154520030704      *---------------------------------------------------------------*
154530030704      * Emetto window x colli originali + controlli
154540030704      *---------------------------------------------------------------*
154550030704     c     Sr_Over25     BegSr
154560030704
154570030704     c                   Clear                   w03rig1
154580030704     c                   Clear                   w03rig2
154590030704     c                   Eval      w03rig1 =
154600030704     c                             'Spedizione con colli bancalati'
154610030704     c                   If        *In12 and Not *In15
154620030704     c                   Eval      w03rig2 =
154630030704     c                             'Immettere i seguenti dati:'
154640030704     c                   EndIf
154650030704     c                   Clear                   At3c01
154660030704     c                   Clear                   At3cor
154670030704     c                   Clear                   At3c02
154680030704     c                   Clear                   At3csf
154690030704     c                   Clear                   At3f12
154700030708     c                   Clear                   H3riga
154710030708     c                   Clear                   H3colo
154720030718      * Salvo i comandi F8 e F9
154730030718     c                   Eval      savinkh = *Inkh
154740030718     c                   Eval      savinki = *Inki
154750030708      * Controllo il totale dei colli
154760030708     c                   If        wtotncl > *Zeros
154770030708      * deve essere uguale ai bancali + sfusi
154780030708     c                   If        wtotncl <> vidncl
154790030707     c                   Eval      At3csf = rimm
154800030707     c                   z-add     04            H3riga
154810030707     c                   z-add     37            H3colo
154820030707     c                   Eval      w03msg =
154830030708     c                             'sfusi+bancali diversi da colli bolla'
154840030707     c                   Eval      *In90 = *On
154850030708     c                   EndIf
154860040128      *  NON deve essere superiore ai colli originali
154870040128     c                   If        wtotncl > w03cor and Not *In90
154880030708     c                   Eval      At3cor = rimm
154890030708     c                   z-add     04            H3riga
154900030708     c                   z-add     18            H3colo
154910030708     c                   Eval      w03msg =
154920030708     c                             'Colli originali minori di sfusi+bancali'
154930030708     c                   Eval      *In90 = *On
154940030708     c                   EndIf
154950030707     c                   EndIf
154960030704
154970030704     c                   Do        *Hival
154980030704     c                   Exfmt     Ls01w03
154990030704
155000030707     c                   Eval      *In90 = *Off
155010030704     c                   Clear                   w03msg
155020030704     c                   Clear                   At3c01
155030030704     c                   Clear                   At3cor
155040030704     c                   Clear                   At3c02
155050030704     c                   Clear                   At3csf
155060030704     c                   Clear                   At3f12
155070030704     c                   Clear                   H3riga
155080030704     c                   Clear                   H3colo
155090030704
155100030708      * F12 Ritorno
155110030708     c                   If        *Inkl
155120030708     c                   Eval      w03cor = savw03cor
155130030708     c                   Eval      w03csf = savw03csf
155140030708     c                   If        w03csf = *Zeros
155150030708     c                   Clear                   wtotncl
155160030708     c                   Else
155170030708     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
155180030708     c                   EndIf
155190030718     c                   Movel     '1'           WEMFOR
155200030708     c                   Leave
155210030708     c                   EndIf
155220030708      * colli originali obbligatori
155230030704     c                   If        w03Cor = *zeros
155240030704     c                   Eval      At3cor = rimm
155250030704     c                   z-add     04            H3riga
155260030707     c                   z-add     18            H3colo
155270030704     c                   Eval      w03msg = 'Immettere i colli originali'
155280030704     c                   Eval      *In90 = *On
155290030704     c                   Iter
155300030704     c                   EndIf
155310030707
155320030707     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
155330040129      * il totale dei colli NON deve essere superiore ai colli originali
155340040129     c                   If        wtotncl > w03cor
155350030708     c                   Eval      At3cor = rimm
155360030708     c                   z-add     04            H3riga
155370030708     c                   z-add     18            H3colo
155380030708     c                   Eval      w03msg =
155390030708     c                             'Colli originali minori di sfusi+bancali'
155400030708     c                   Eval      *In90 = *On
155410030708     c                   Iter
155420030708     c                   EndIf
155430030708      * il totale dei colli deve essere uguali ai bancali + sfusi
155440030707     c                   If        wtotncl <> vidncl
155450030707     c                   Eval      At3csf = rimm
155460030707     c                   z-add     04            H3riga
155470030707     c                   z-add     37            H3colo
155480030707     c                   Eval      w03msg =
155490030708     c                             'sfusi+bancali diversi da colli bolla'
155500030707     c                   Eval      *In90 = *On
155510030707     c                   Iter
155520030707     c                   EndIf
155530030704
155540030704     c   kf              Leave
155550030704
155560030704     c                   EndDo
155570030718      * Ripristino i comandi F8 e F9
155580030718     c                   Eval      *Inkh = savinkh
155590030718     c                   Eval      *InKi = savinki
155600030704
155610030704     c                   EndSr
155620030805      *---------------------------------------------------------------*
155630030805      * Ricerco l'orm x fare il ritiro contestuale alla consegna
155640030805      *---------------------------------------------------------------*
155650030805     c     Sr_RicOrm     BegSr
155660030805
155670091006      * Preparo la ds x il richiamo a FNLS28R
155680091006      * Solo se richiamato FNLS28R x i controlli
155690031217if  1c                   If        wope = 'C'
155700091006     c                   Clear                   Fnls28ds
155710091006     c                   Eval      I28Ope = wope
155720091006     c                   Eval      I28ccm = wksc
155730080407     c                   if        *in12
155740091006     c                   Move      §lpaac        I28Aas
155750080407     c                   endif
155760120326      * passo sempre la lnp del video in quanto ad oggi dei traduttori
155770120326      * personalizzati per ORM RC non ce ne sono.
155780120326      * Attenzione che se dovessero esserci di nuovo dei traduttori
155790120326      * personalizzati il pgm prevede di controllare l'esistenza dell'ORM RC
155800120326      * e per collegare ORM con Bolla si fa tramite RFA dell'ORM = al n. bolla
155810120326      * memorizzato sul VAB di conseguenza la LNP del video non va più bene.
155820120326     c                   move      vidlnp        I28lnp
155830091006     c                   if        widspe <> 0
155840120326     c**!!!              Move      Widlnp        I28lnp
155850091006     c                   Move      Widnrs        I28nrs
155860091006     c                   Move      Widnsp        I28nsp
155870091006     c                   else
155880091006     c  n12              eval      i28aas = waas
155890120326     c**!!!              move      vidlnp        i28lnp
155900091006     c                   endif
155910091006     c                   Eval      I28Lna = comlna
155920091006     c                   Move      varznc        I28Znc
155930091006     c                   eval      i28rsd = vidrsd
155940091006     c                   eval      i28ind = vidind
155950091006     c                   eval      i28cad = vidcad
155960091006     c                   eval      i28lod = vidlod
155970091006     c                   eval      i28prd = vidprd
155980091006     c                   eval      i28nzd = vidnzd
155990091006     c                   eval      i28ncl = v1cncl
156000091006     c                   eval      i28pkb = vidpkg
156010091006      * Solo se richiamato FNLS28R x i aggiornare passo solo I28Ope
156020031217      * gli altri dati sono già impostati
156030031217   x1c                   Else
156040091006     c                   Eval      I28Ope = wope
156050040227      * se sono in conferma bolle da dischetto e il cliente non mantiene il
156060040227      * numero di spedizione devo aggiornare anche il riferimento sull'ORM
156070091006      * o immissione bolla
156080091006if  2c                   If        (*In12 and *In15 and BlpNsp <> WidNsp)
156090091006     c                              or not *in12
156100091006     c                   Eval      I28nAas = BlpAas
156110091006     c                   Eval      I28Lnp = BlpLnp
156120091006     c                   Eval      I28Nrs = BlpNrs
156130091006     c                   Eval      I28Nsp = BlpNsp
156140040227    2c                   EndIf
156150031217    1c                   EndIf
156160091006     c                   Call      'FNLS28R'
156170091006     c                   parm                    kpjba
156180091006     c                   Parm                    Fnls28ds
156190091006      * Solo se ho richiamato FNLS28R x i controlli verifico gli errori
156200031217if  1c                   If        wope = 'C'
156210031217      * Orm Non trovato
156220091006if  2c                   If        O28Err = 01
156230031217     c                   Eval      VidMsg = Err(150)
156240031217     c                   Eval      *In67 = *On
156250031217     c                   Eval      *In90 = *On
156260031217    2c                   EndIf
156270031217      * Altri errori sull'ORM
156280091006if  2c                   If        O28Err > *Zeros and O28Err <> 01
156290091006     c                   Eval      VidMsg = O28Msg
156300031217     c                   Eval      *In67 = *On
156310031217     c                   Eval      *In90 = *On
156320031217    2c                   EndIf
156330091124    1c                   EndIf
156340031217      * Ok ORM - imposto campi x memorizzarli in FIAR5 rcd 'RCC'
156350091006     c                   Eval      savOrmPoe = O28Poe
156360091006     c                   Eval      savOrmNsr = O28Nsr
156370091006     c                   Eval      savOrmNor = O28Nor
156380091006     c                   Eval      savOrmNrv = O28Nrv
156390030805
156400030805     c                   EndSr
156410960319     C*
156420960319     C* CONTROLLO GIORNI DI CHIUSURA --------------------------------*
156430960319     C     CTRGCH        BEGSR
156440960319     C*** 1° GIORNO CHIUSURA ***
156450960319    1C     WGC1          IFNE      *BLANKS
156460960319     C                   MOVEL     WGC1          ACOM              1
156470960319     C                   MOVE      WGC1          BCOM              1
156480960319     C                   Z-ADD     1             B                 3 0
156490960319     C     ACOM          LOOKUP    GGG(B)                                 30
156500960319     C* ERRORE
156510960319    2C     *IN30         IFEQ      *OFF
156520960319     C                   MOVEL     ERR(63)       VIDMSG
156530960319     C                   SETON                                        7490
156540960319     C                   GOTO      ENDGCH
156550960319    2C                   ENDIF
156560960319     C*
156570960319    2C     BCOM          IFNE      ' '
156580960319     C     BCOM          ANDNE     'P'
156590960319     C     BCOM          ANDNE     'M'
156600960319     C                   MOVEL     ERR(63)       VIDMSG
156610960319     C                   SETON                                        7490
156620960319     C                   GOTO      ENDGCH
156630960319    2C                   END
156640960319     C*
156650960319    1C                   END
156660960319     C***
156670960319     C*** 2° GIORNO CHIUSURA ***
156680960319    1C     WGC2          IFNE      *BLANKS
156690960319     C                   MOVEL     WGC2          ACOM              1
156700960319     C                   MOVE      WGC2          BCOM              1
156710960319     C                   Z-ADD     1             B
156720960319     C     ACOM          LOOKUP    GGG(B)                                 30
156730960319     C* ERRORE
156740960319    2C     *IN30         IFEQ      *OFF
156750960319     C                   MOVEL     ERR(63)       VIDMSG
156760960319     C                   SETON                                        6290
156770960319     C                   GOTO      ENDGCH
156780960319    2C                   ENDIF
156790960319     C*
156800960319    2C     BCOM          IFNE      ' '
156810960319     C     BCOM          ANDNE     'P'
156820960319     C     BCOM          ANDNE     'M'
156830960319     C                   MOVEL     ERR(63)       VIDMSG
156840960319     C                   SETON                                        6290
156850960319     C                   GOTO      ENDGCH
156860960319    2C                   END
156870960319     C*
156880960319     C* I GIORNI DI CHIUSURA NON POSSO ESSERE UGUALI
156890960319    2C     WGC1          IFEQ      WGC2
156900960319     C                   MOVEL     ERR(63)       VIDMSG
156910960319     C                   SETON                                        6290
156920960319     C                   GOTO      ENDGCH
156930960319    2C                   END
156940960319    1C                   END
156950960319     C* NON POSSONO ESSERE ' P' ' M'
156960960319    1C     WGC1          IFEQ      ' M'
156970960319     C     WGC1          OREQ      ' P'
156980960319    2C     WGC2          IFEQ      ' M'
156990960319     C     WGC2          OREQ      ' P'
157000960319     C                   MOVEL     ERR(63)       VIDMSG
157010960319     C                   SETON                                        6290
157020960319     C                   GOTO      ENDGCH
157030960319    2C                   END
157040960319    1C                   END
157050960319     C* personalizzazione
157060960319    2C     WPERSO        IFEQ      'P'
157070960319     C     WGC1          IFNE      '  '
157080960319     C     WGC2          ORNE      '  '
157090960319     C                   SETON                                        91
157100960319    2C                   ENDIF
157110960319    2C                   ENDIF
157120960319     C*
157130960319     C     ENDGCH        ENDSR
157140050415     C* CONTROLLO PARTICOLARITA' VARIE E BANCALI --------------------*
157150050415     c     sr_CntPVBan   begsr
157160050415     C***
157170050415     C*** PARTICOLARITA' VARIE    ***
157180050415     C*   PER ORA NON ESISTONO E SALTO COMPLETAMENTE IL CONTROLLO
157190050415     C*   SI PUO' SOLO IMMETTERE 'P ' CHE INDICA CONSEGNA A PRIVATI
157200050415      *   si può inserire anche 'B' bancali o 'O' bancali x over 25
157210050415    1C     VIDGVA        IFNE      *BLANKS
157220050415     C     VIDGVR        ORNE      *BLANKS
157230050415     C* RICHIAMO IL PRG DI RICERCA
157240050415    2C     VIDGVR        IFEQ      '?'
157250050415     C                   CLEAR                   DS7PQR
157260050415     C                   MOVEL     'S'           DS7RIC
157270050415     C                   MOVEL     'V'           DS7GES
157280050415     C                   MOVEL     WKSC          DS7KSC
157290050415     C                   MOVEL     VIDGVA        DS7COD
157300050415     C                   MOVEL     DS7PQR        KPJBU
157310050415     C                   CALL      'TRTB73R'
157320050415     C                   PARM                    KPJBA
157330050415     C                   MOVEL     KPJBU         DS7PQR
157340050415     C                   CLEAR                   VIDGVR
157350050415     C*
157360050415     C     VIDGVA        IFEQ      *BLANKS
157370050415     C                   MOVEL     DS7COD        VIDGVA
157380050415    2C                   ENDIF
157390050415     C*
157400050415     C                   MOVEL     '1'           WEMFOR
157410050415     C                   GOTO      ENDpvban
157420050415    2C                   ENDIF
157430050415     C* CONTROLLO
157440050415     C                   CLEAR                   DS7PQR
157450050415     C                   MOVEL     'S'           DS7RIC
157460050415     C                   MOVEL     'C'           DS7GES
157470050415     C                   MOVEL     WKSC          DS7KSC
157480050415     C                   MOVEL     VIDGVA        DS7COD
157490050415     C                   MOVEL     DS7PQR        KPJBU
157500050415     C                   CALL      'TRTB73R'
157510050415     C                   PARM                    KPJBA
157520050415     C                   MOVEL     KPJBU         DS7PQR
157530050415     C* ERRORE
157540050415    2C     DS7ERR        IFEQ      '1'
157550050415     C                   MOVEL     DS7MSG        VIDMSG
157560050415     C                   SETON                                        7590
157570050415     C                   GOTO      ENDpvban
157580050415    2C                   ENDIF
157590050415     c* controllo ambito di utilizzo particolarità varia
157600050415     C                   MOVEL     '7S'          COD
157610050415     C                   MOVEL(P)  vidgva        KEY
157620050415     c                   clear                   ds7s
157630050415     C                   EXSR      CTABEL
157640050415     C                   MOVEL     TBLUNI        DS7S
157650050415     c     §7suti        ifeq      'B'
157660050415     c     §ogntw        andeq     'PPT'
157670050415     c     §7suti        oreq      'P'
157680050415     c     §ogntw        andne     'PPT'
157690050415     C                   MOVEL     err(288)      VIDMSG
157700050415     C                   SETON                                        7590
157710050415     C                   GOTO      ENDpvban
157720050415     c                   endif
157730050415    1C                   ENDIF
157740050415      * B A N C A L I
157750050415      * tipo bancali
157760050415If  1c                   If        VidTba <> *Blanks and VidTba <> '00'
157770050415      * ricerca
157780050415     c     '?'           Scan      VidTba                                 30
157790050415If  2c                   If        *In30
157800050415     c                   Clear                   Dsbs02
157810050415     c                   Eval      T02Mod = 'R'
157820050415     c                   Eval      T02Sif = Knsif
157830050415     c                   Eval      T02Cod = 'TBA'
157840050415     c                   Call      'TIBS02R'
157850050415     c                   Parm                    Kpjba
157860050415     c                   Parm                    Dsbs02
157870050415     c                   Movel     T02Ke1        VidTba
157880050415     c                   Eval      Wemfor = '1'
157890050415     c                   z-add     23            H2riga
157900050415     c                   z-add     16            H2colo
157910050415     c                   GoTo      ENDpvban
157920050415    2c                   EndIf
157930050415      * controllo
157940050415     c                   Clear                   Dsbs02
157950050415     c                   Clear                   dTba
157960050415     c                   Eval      T02Mod = 'C'
157970050415     c                   Eval      T02Sif = Knsif
157980050415     c                   Eval      T02Cod = 'TBA'
157990050415     c                   Movel(p)  VidTba        T02Ke1
158000050415     c                   Call      'TIBS02R'
158010050415     c                   Parm                    Kpjba
158020050415     c                   Parm                    Dsbs02
158030050415If  2c                   If        T02Err <> *Blanks
158040050415     c                   Movel     Rimm          AtrTba
158050050415     c                   Eval      VidMsg = Err(269)
158060050415     c                   Eval      *In90 = *On
158070050415     c                   z-add     23            H2riga
158080050415     c                   z-add     16            H2colo
158090050415     c                   GoTo      ENDpvban
158100050415    2c                   EndIf
158110050415     c                   Movel     T02Uni        dTba
158120050415     c                   Z-Add     §TbaPkg       wTbaPkg1
158130050415     c                   Z-Add     §TbaVol       wTbaVol1
158140150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
158150150305     c                   exsr      sr_figlia
158160150305     c                   if        wfiglia=*blanks
158170150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
158180150226     c* sia utilizzabile per la varia B/O
158190150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
158200150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
158210150226     c                   Movel     Rimm          AtrTba
158220150226     c                   Eval      VidMsg = Err(358)
158230150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
158240150226     c                   Eval      *In90 = *On
158250150226     c                   z-add     23            H2riga
158260150226     c                   z-add     16            H2colo
158270150226     c                   GoTo      ENDpvban
158280150226    2c                   endif
158290150226     c* se inserita la particolarità varia B controllo che il cliente sia
158300150226     c* abilitato all'utilizzo del tipo bancale
158310150226    2c                   if        %subst(VidGva:1:1)='B'
158320150302     c                   move      vidtba        wtba
158330150226     c                   exsr      sr_callTisigar
158340150226     c                   if        ogaesito<>*blanks
158350150226     c                   Movel     Rimm          AtrTba
158360150226     c                   Eval      VidMsg = Err(359)
158370150226     c                   Eval      *In90 = *On
158380150226     c                   z-add     23            H2riga
158390150226     c                   z-add     16            H2colo
158400150226     c                   GoTo      ENDpvban
158410150226     c                   endif
158420150226    2c                   endif
158430150305     c                   endif
158440050415   x1c                   Else
158450050415If  2c                   If        VidNba > *Zeros
158460050415     c                   Movel     Rimm          AtrTba
158470050415     c                   Eval      VidMsg = Err(269)
158480050415     c                   Eval      *In90 = *On
158490050415     c                   z-add     23            H2riga
158500050415     c                   z-add     16            H2colo
158510050415     c                   GoTo      ENDpvban
158520050415    2c                   EndIf
158530050415    1c                   EndIf
158540050415      * numero bancali
158550050415If  1c                   If        VidNba = *Zeros and VidTba > *Zeros
158560050415     c                   Movel     Rimm          AtrNba
158570050415     c                   Eval      VidMsg = Err(268)
158580050415     c                   Eval      *In90 = *On
158590050415     c                   z-add     23            H2riga
158600050415     c                   z-add     22            H2colo
158610050415     c                   GoTo      ENDpvban
158620050415    1c                   EndIf
158630050415      * tipo bancali 2
158640050415If  1c                   If        VidTb2 <> *Blanks and VidTb2 <> '00'
158650050415      * ricerca
158660050415     c     '?'           Scan      VidTb2                                 30
158670050415If  2c                   If        *In30
158680050415     c                   Clear                   Dsbs02
158690050415     c                   Eval      T02Mod = 'R'
158700050415     c                   Eval      T02Sif = Knsif
158710050415     c                   Eval      T02Cod = 'TBA'
158720050415     c                   Call      'TIBS02R'
158730050415     c                   Parm                    Kpjba
158740050415     c                   Parm                    Dsbs02
158750050415     c                   Movel     T02Ke1        VidTb2
158760050415     c                   Eval      Wemfor = '1'
158770050415     c                   z-add     23            H2riga
158780050415     c                   z-add     32            H2colo
158790050415     c                   GoTo      ENDpvban
158800050415    2c                   EndIf
158810050415      * controllo
158820050415     c                   Clear                   Dsbs02
158830050415     c                   Clear                   dTba
158840050415     c                   Eval      T02Mod = 'C'
158850050415     c                   Eval      T02Sif = Knsif
158860050415     c                   Eval      T02Cod = 'TBA'
158870050415     c                   Movel(p)  VidTb2        T02Ke1
158880050415     c                   Call      'TIBS02R'
158890050415     c                   Parm                    Kpjba
158900050415     c                   Parm                    Dsbs02
158910050415If  2c                   If        T02Err <> *Blanks
158920050415     c                   Movel     Rimm          AtrTb2
158930050415     c                   Eval      VidMsg = Err(269)
158940050415     c                   Eval      *In90 = *On
158950050415     c                   z-add     23            H2riga
158960050415     c                   z-add     32            H2colo
158970050415     c                   GoTo      ENDpvban
158980050415    2c                   EndIf
158990050415     c                   Movel     T02Uni        dTba
159000050415     c                   Z-Add     §TbaPkg       wTbaPkg2
159010050415     c                   Z-Add     §TbaVol       wTbaVol2
159020150305     c* i due controlli seguenti li faccio solo se la bolla non è una figlia
159030150305     c                   exsr      sr_figlia
159040150305     c                   if        wfiglia=*blanks
159050150226     c* Se inserita la particolarità varia B/O controllo che il tipo bancale
159060150226     c* sia utilizzabile per la varia B/O
159070150226    2c                   if        (%subst(VidGva:1:1)='B' and §tbautb='N') or
159080150226     c                             (%subst(VidGva:1:1)='O' and §tbauto='N')
159090150226     c                   Movel     Rimm          AtrTb2
159100150226     c                   Eval      VidMsg = Err(358)
159110150226     c                   eval      vidmsg=%trim(vidmsg)+%subst(vidgva:1:1)+'"'
159120150226     c                   Eval      *In90 = *On
159130150226     c                   z-add     23            H2riga
159140150226     c                   z-add     32            H2colo
159150150226     c                   GoTo      ENDpvban
159160150226    2c                   endif
159170150226     c* se inserita la particolarità varia B controllo che il cliente sia
159180150226     c* abilitato all'utilizzo del tipo bancale
159190150226    2c                   if        %subst(VidGva:1:1)='B'
159200150302     c                   move      vidtb2        wtba
159210150226     c                   exsr      sr_callTisigar
159220150226     c                   if        ogaesito<>*blanks
159230150226     c                   Movel     Rimm          AtrTb2
159240150226     c                   Eval      VidMsg = Err(359)
159250150226     c                   Eval      *In90 = *On
159260150226     c                   z-add     23            H2riga
159270150226     c                   z-add     32            H2colo
159280150226     c                   GoTo      ENDpvban
159290150226     c                   endif
159300150226    2c                   endif
159310150305     c                   endif
159320050415   x1c                   Else
159330050415If  2c                   If        VidNb2 > *Zeros
159340050415     c                   Movel     Rimm          AtrTb2
159350050415     c                   Eval      VidMsg = Err(269)
159360050415     c                   Eval      *In90 = *On
159370050415     c                   z-add     23            H2riga
159380050415     c                   z-add     32            H2colo
159390050415     c                   GoTo      ENDpvban
159400050415    2c                   EndIf
159410050415    1c                   EndIf
159420050415      * numero bancali 2
159430050415If  1c                   If        VidNb2 = *Zeros and VidTb2 > *Zeros
159440050415     c                   Movel     Rimm          AtrNb2
159450050415     c                   Eval      VidMsg = Err(268)
159460050415     c                   Eval      *In90 = *On
159470050415     c                   z-add     23            H2riga
159480050415     c                   z-add     38            H2colo
159490050415     c                   GoTo      ENDpvban
159500050415    1c                   EndIf
159510050415      * non si possono immettere 2 tipi bancali uguali
159520050415If  1c                   If        VidTba > *Zeros and VidTb2 > *Zeros
159530050415     c                             and VidTba = VidTb2
159540050415     c                   Movel     Rimm          AtrTb2
159550050415     c                   Eval      VidMsg = Err(270)
159560050415     c                   Eval      *In90 = *On
159570050415     c                   z-add     23            H2riga
159580050415     c                   z-add     32            H2colo
159590050415     c                   GoTo      ENDpvban
159600050415    1c                   EndIf
159610050415      * se inseriti i bancali la particolarità Varie "B" è obbligatoria
159620050415      * oppure la particolarità Varie "O"
159630050415If  1c                   If        (VidTba > *Zeros or VidTb2 > *Zeros) and
159640050415     c                              %Subst(VidGva:1:1) <> 'B' and
159650050415     c                              %Subst(VidGva:1:1) <> 'O'
159660050415     c                   Select
159670050415     c                   When      wgva = 'O'
159680050415     c                   Eval      VidMsg = Err(32)
159690050415     c                   When      wgva = 'B'
159700050415     c                   Eval      VidMsg = Err(35)
159710050415     c                   Other
159720050415     c                   Eval      VidMsg = Err(274)
159730050415     c                   EndSl
159740050415     c                   Eval      *In90 = *On
159750050415     c                   Eval      *In75 = *On
159760050415     c                   GoTo      ENDpvban
159770050415    1c                   EndIf
159780050415      * se inserita la particolarità Varie "B" sono obbligatori
159790050415      * oppure la particolarità Varie "O"
159800050415If  1c                   If        (%subst(VidGva:1:1) ='B' or
159810050415     c                              %subst(VidGva:1:1) ='O')  and
159820050415     c                             (VidTba = *Blanks or VidTba = '00') and
159830050415     c                             (VidTb2 = *Blanks or Vidtb2 = '00')
159840050415     c                   Movel     Rimm          AtrTba
159850050415     c                   Eval      VidMsg = Err(271)
159860050415     c                   Eval      *In90 = *On
159870050415     c                   z-add     23            H2riga
159880050415     c                   z-add     16            H2colo
159890050415     c                   GoTo      ENDpvban
159900050415    1c                   EndIf
159910050415      * msg info x n. colli inferiore al tot. bancali
159920050415     c                   Eval      wtotnba = VidNba + VidNb2
159930050415     c                   If        VidNcl < wtotnba and wtotnba > *Zeros
159940050415     c                             and wfornba = *Blanks
159950050415     c                   Eval      VidMsg = Err(27)
159960050415     c                   Eval      *In41 = *On
159970050415     c                   Eval      *In90 = *On
159980050415     c                   Eval      wfornba = '1'
159990050415     c                   GoTo      ENDpvban
160000050415     c                   EndIf
160010050415      * Manutenzione di bolla con bancali
160020050415      * Se viene modificato il numero di bancali
160030050415      * emetto un msg info
160040050415     c                   If        *In12 and Not *In15                      and
160050050415     c                             (VidNba <> SavNba or VidNb2 <> SavNb2)   and
160060110921     c                             wNba = *Blanks                           and
160070110921     c                             (§cliban=*blanks or %subst(VidGva:1:1)='O')
160080050415     c                   Eval      wNba = '1'
160090050415     c                   Eval      VidMsg = Err(273)
160100050415     c                   If        VidNba <> SavNba
160110050415     c                   Movel     Rimm          AtrNba
160120050415     c                   z-add     23            H2riga
160130050415     c                   z-add     22            H2colo
160140050415     c                   EndIf
160150050415     c                   If        VidNb2 <> SavNb2
160160050415     c                   Movel     Rimm          AtrNb2
160170050415     c                   z-add     23            H2riga
160180050415     c                   z-add     38            H2colo
160190050415     c                   EndIf
160200050415     c                   Eval      *In90 = *On
160210050415     c                   GoTo      ENDpvban
160220050415     c                   EndIf
160230050415      * per Particolarità varie 'O'
160240050415      * questi controlli non li faccio se richiamato da giacenze
160250050415     c                   If        %subst(VidGva:1:1) = 'O'
160260050415      * se colli originali già immessi devo controllare il n. dei colli sfusi
160270050415      * con i bancali
160280050415     c                   If        w03Cor > *zeros
160290050415     c                   Eval      wtotncl = w03csf + vidnba + vidnb2
160300050415     c                   EndIf
160310050415      * devo controllare se inseriti i colli originali
160320050415      * se non sono stati inseriti emetto la window per inserirli
160330050415     c                   If        w03cor = *Zeros     or
160340050415      * oppure se sono in manutenzione bolla e sono stati variati
160350050415      * o i bancali o il n. dei colli
160360050415      * emetto la window
160370050415     c                             (*In12 and Not *In15)                   or
160380050415     c                             (wtotncl > *Zeros  and
160390050415     c                             (wtotncl <> vidncl or
160400050415     c                             (wtotncl >= w03cor and w03cor > *Zeros)))
160410050415     c                   ExSr      Sr_Over25
160420050415     c                   EndIf
160430050415     c                   EndIf
160440050415     c     endpvban      tag
160450050415     C   90              MOVEL     '1'           WEMFOR
160460050415     c                   endsr
160470150305     c*---------------------------------------------------------------*
160480150305     C* verifica se bolla figlia
160490150305     c*---------------------------------------------------------------*
160500150305     c     sr_figlia     begsr
160510150305     c                   clear                   wfiglia
160520150305     c                   select
160530150305     c                   when       *in12 and *in15 and *in44
160540150305     c                   eval      wfiglia='S'
160550150305     c                   when       *in12 and not *in15
160560150305     c     kblp3         setll     fnlbl01l
160570150305     c                   if        %equal(fnlbl01l)
160580150305     c                   eval      wfiglia='S'
160590150305     c                   endif
160600150305     c                   endsl
160610150305     c                   endsr
160620150226     c*---------------------------------------------------------------*
160630150226     C* richiamo pgm di controllo abilitazione cliente al tipo bancale*
160640150226     c*---------------------------------------------------------------*
160650150226     c     sr_callTisigarbegsr
160660150226     c                   clear                   tisigads
160670150226     c                   if        dateu>=§vpobanc
160680150226     c                   z-add     vidccm        igaksc
160690150226     c                   if        vidflc=0
160700150226     c                   movel     vidlnp        igaksc
160710150226     c                   else
160720150226     c                   movel     vidflc        igaksc
160730150226     c                   endif
160740150226     c                   eval      IGADAT=blpdsp
160750150226     c                   eval      IGATSC='B'
160760150226     c                   eval      IGATBA=wtba
160770150226     c                   movel     tisigads      kpjbu
160780150226     c                   call      'TISIGAR'
160790150226     c                   parm                    kpjba
160800150226     c                   movel     kpjbu         tisigads
160810150226     c                   endif
160820150226     c                   endsr
160830940826     C*
160840940826     C* GESTIONE 3 VIDEATA ------------------------------------------*
160850940826     C     GESD03        BEGSR
160860991008      *
160870940928     C                   CLEAR                   WEMD03
160880971211     C                   MOVEL     COMLNA        V3CLNA
160890940826     C* DECODIFICA LNA
160900940826     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
160910971211     C  N30              MOVEL     ORGDES        V3DLNA
160920940923     C*
160930940923     C* SE TASSAZIONE CON TARIFFA MITTENTE, TASSO LA BOLLA
160940950125     C* SOLO PER GLI ASSEGNATI
160950950125     C   04SAVFTM        IFNE      ' '
160960940923     C     VIDFTM        ORNE      ' '
160970940923     C     VIDIMV        IFEQ      0
160980980506     C                   MOVEL     '1'           WBOL
160990011025      *
161000011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
161010011025      * varia 'N'
161020011025     C     FLGVRN        IFEQ      '1'
161030011115      * leggo il sbfl delle varie
161040011115     C                   DO        20            NRR
161050011115     C     NRR           CHAIN     LS01S03                            30
161060011115     C     V3CSV1        IFEQ      'N'
161070011115     C     V3CVA1        ANDEQ     88888888
161080011115     C                   EXSR      TASSAN
161090011115     C  N30              UPDATE    LS01S03
161100011115     C                   ENDIF
161110011115     C                   ENDDO
161120011025     C                   ENDIF
161130011025      *
161140151014     c                   clear                   PesVolPkcn
161150151014     c                   clear                   PesVolSpc
161160151014     c                   clear                   PesVolImv
161170940923     C                   EXSR      TASSAZ
161180151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
161190151014     c                   if        vidimv>0
161200151014     c                   eval      PesVolPkcn=taspkcn
161210151014     c                   eval      PesVolSpc=tasspc
161220151014     c                   eval      PesVolIMV=vidimv
161230151014     c                   endif
161240941219     C* SE TASSAZIONE RIUSCITA, MSG CHE E' TASSATA CON TARIFFA MITTEN
161250950504     C* IN CONFERMA BOLLE DA  CLIENTI NON LO DO'
161260941219     C     *IN90         IFEQ      *OFF
161270950504     C     *IN12         IFEQ      *OFF
161280950504     C     *IN15         OREQ      *OFF
161290950504     C     §LPFPR        OREQ      'V'
161300941110     C                   MOVEL     ERR(59)       VIDMSG
161310940923     C                   SETON                                        90
161320940923     C                   ENDIF
161330950504     C                   ENDIF
161340941219     C*
161350941219     C                   ENDIF
161360940923     C                   ENDIF
161370950504     C*
161380950504     C* SE DEVO VARIARE EMETTO PRIMA VIDEATA ALTRIMENTI PASSO SUBITO
161390950504     C*    AI CONTROLLI --> SE NON C'E' STATO UN ERRORE IN TASSAZIONE
161400950504     C  N90
161410950504     CAN 12
161420950504    2CAN 15§LPFPR        IFNE      'V'
161430950504     C                   GOTO      CT3TAG
161440950504    2C                   END
161450961111     C* EMETTO MSG CHE DEVO TASSARE IL PORTO SE FRANCO FRONTIERA
161460961111     C     VIDFBR        IFEQ      'F'
161470961111     C     SED           ANDEQ     0
161480961111     C                   MOVEL     ERR(129)      VIDMSG
161490961111     C                   SETON                                        9052
161500961111     C                   MOVEL     1             SED
161510961111     C                   ENDIF
161520940923     C*
161530940826     C     FOR03         TAG
161540941011     C                   Z-ADD     1             NRR
161550940826     C*
161560940923     C                   WRITE     LS01D04
161570940923     C                   EXFMT     LS01C03
161580950504     C*
161590950504     C     CT3TAG        TAG
161600941115     C*
161610941021     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE
161620950126     C                   EXSR      OFFD03
161630940826     C*
161640990701     C* F22 - CALCOLO PROVVIGIONI DEL MITTENTE
161650940928    3C     *INKW         IFEQ      *ON
161660940919     C* SOLO SE SI TRATTA DI UN CODIFICATO
161670940919    4C     VIDCCM        IFNE      9999
161680940919    4C     VIDCCM        ANDNE     8888
161690940919     C* SOLO SE IL CLIENTE HA UNA TARIFFA ALMENO VALIDA
161700980608     C*  ALTRIMENTI USA LA TARIFFA DI CARTELLO IL PGM TNSF20R
161710980506     C                   MOVEL     '2'           WBOL              1
161720980506     C                   EXSR      TASSAZ
161730980506     C** IMPOSTO LA VARIA SE TROVATA IN VI2VA1
161740940826   X4C                   ELSE
161750940919     C* ERRORE PER 8888 O 9999
161760941110     C                   MOVEL     ERR(82)       VIDMSG
161770980608     C                   SETON                                        4090
161780940919    4C                   ENDIF
161790940919     C*
161800940826     C                   GOTO      FOR03
161810940919    3C                   ENDIF
161820941115     C*
161830940826     C* CONTROLLI
161840940826     C                   EXSR      CTRD03
161850940826     C* RIEMETTO FORMATO
161860950127     C     WEMFOR        IFEQ      '1'
161870950127     C                   EXSR      ESCIER
161880950127     C     §LPFPR        IFNE      '5'
161890000113     C  NKL              GOTO      FOR03
161900950127     C                   ELSE
161910950127     C                   GOTO      ENDD03
161920950127     C                   ENDIF
161930950127     C                   ENDIF
161940941115     C*
161950990701     C* F12 - RITORNO VIDEATA 2
161960941115     C     *INKL         IFEQ      *ON
161970990701     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA F9 QUESTA VIDEATA
161980941115     C     VIDPOR        IFNE      0
161990941115     C     WESVAR        ORNE      ' '
162000941115     C     VIDCEI        ORNE      ' '
162010040116     c     wesvar1       orne      *Blanks
162020941115     C     VI2CEI        ORNE      ' '
162030000113     C     WEMFOR        OREQ      '1'
162040941115     C                   MOVEL     'S'           WEMD03            1
162050000113     C                   CLEAR                   WEMFOR
162060000113     C                   CLEAR                   VIDMSG
162070000113     C                   SETOFF                                       90
162080941115     C                   ENDIF
162090941115     C                   GOTO      ENDD03
162100941115     C                   ENDIF
162110940826     C*
162120990630     C* F14 - TASSAZIONE BOLLA
162130990630     C     *INKN         IFEQ      *ON
162140990630     C                   MOVEL     '1'           WBOL
162150011025      *
162160011025      * Se bolla di reso con varia 'N' 88888888 devo prima tassare la
162170011025      * varia 'N'
162180011025     C     FLGVRN        IFEQ      '1'
162190011115      * leggo il sbfl delle varie
162200011115     C                   DO        20            NRR
162210011115     C     NRR           CHAIN     LS01S03                            30
162220011115     C     V3CSV1        IFEQ      'N'
162230011115     C     V3CVA1        ANDEQ     88888888
162240011025     C                   EXSR      TASSAN
162250011115     C  N30              UPDATE    LS01S03
162260011115     C                   ENDIF
162270011115     C                   ENDDO
162280011025     C                   ENDIF
162290011025      *
162300151014     c                   clear                   PesVolPkcn
162310151014     c                   clear                   PesVolSpc
162320151014     c                   clear                   PesVolImv
162330990630     C                   EXSR      TASSAZ
162340151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
162350151014     c                   if        vidimv>0
162360151014     c                   eval      PesVolPkcn=taspkcn
162370151014     c                   eval      PesVolSpc=tasspc
162380151014     c                   eval      PesVolIMV=vidimv
162390151014     c                   endif
162400990701     C*
162410990630     C* PER PREPAGATI CALCOLO IL TOTALE FATTURA
162420990701     C     *IN22         IFEQ      *ON
162430990716     C     VIDIMV        IFGT      0
162440060208     c* se sono in manutenzione ed è variato il totale imponibile
162450060208     c* errore se prepagato già incassato
162460070514     c***                if        *in12 = *on and *in15 = *off  and
162470070514     c***                          dateu >= §vpogpp
162480070514     c                   if        *in12 = *on and *in15 = *off
162490060208     c                   exsr      sr_callycow
162500060208     c                   if        prmesito <> 0
162510060208     C                   MOVEL     ERR(297)      VIDMSG
162520060208     C                   SETON                                        90
162530060208     C                   GOTO      FOR03
162540060208     c                   endif
162550060208     c                   endif
162560120105     c                   if        viddft>0
162570120105     C                   Z-ADD     viddft        G02DAT
162580120105     C                   MOVEL     *BLANK        G02ERR
162590120105     C                   CALL      'XSRDA8'
162600120105     C                   PARM                    WLBDAT
162610120105     C                   MOVEL     G02INV        comdft
162620120105     c                   else
162630990701     C                   Z-ADD     DATEU         COMDFT
162640120105     c                   endif
162650991014     C                   EXSR      TOTFAT
162660990701     C                   Z-ADD     D04IFT        VIDIFT
162670990701     C                   Z-ADD     D04IMV        VIDIMV
162680990701     C                   Z-ADD     D04POR        VIDPOR
162690990701     C                   Z-ADD     D04IMV        SAVIMV
162700991014     C                   Z-ADD     D04POR        MEMPOR
162710990701     C                   ENDIF
162720990716     C                   ENDIF
162730990630     C*
162740990630     C                   GOTO      FOR03
162750990630     C                   ENDIF
162760060207     c*
162770060207     c* MANUTENZIONE: GESTIONE MOTIVAZIONE PER PREPAGATI
162780060207     c* Se sono in manutenzione di un prepagato ed è stato variato il
162790060207     c* totale imponibile richiedo motivazione
162800060308     c*
162810060308     c                   movel     'TR'          wcvb
162820060308     c                   exsr      cls_lv85
162830060308     c*
162840060208     c                   clear                   ilv85cvb
162850060207     c                   if        *in12 = *on and *in15= *off and
162860070514     c****                         dateu >= §vpogpp  and
162870060208     c                             *in22 = *on and vidimv <> savimvo
162880060227     c                   movel     '7L'          cod
162890060227     C                   MOVEL(P)  'TR'          KEY
162900060227     C                   EXSR      CTABEL
162910060227     C                   MOVEL     TBLUNI        DS7L
162920060227     c                   if        §7lmtv = 'S'
162930060227     c                   clear                   fnlv85ds
162940060208     c                   eval      ilv85cvb = 'TR'
162950060209     c                   eval      ilv85tel = 'V'
162960060207     c                   movel     fnlv85ds      kpjbu
162970060207     c                   call      'FNLV85R'
162980060207     c                   parm                    kpjba
162990060210     c                   movel     kpjbu         fnlv85ds
163000060207     c* F12=Ritorno --> riemetto formato 03
163010060209     c                   if        olv85f12 = '1'
163020060207     c                   goto      for03
163030060207     c                   endif
163040060227     c                   endif
163050060207     c                   endif
163060940826     C*
163070940919     C* SE CONTO SERVIZIO IMMISSIONE PER CMD6
163080101104     c                   if        not *inkf and not *inkh
163090101104     C     WFPR          IFNE      'I'
163100940919     C     §3ARBL        ANDEQ     'C'
163110950410     C* SE E' DISK CLIENTI CON LNP = 102 -SEDE- NON DO ERRORE
163120950410    4C     VIDLNP        IFNE      102
163130950410     C     *IN12         OREQ      *OFF
163140950410     C     *IN15         OREQ      *OFF
163150940928     C                   MOVEL     ERR(40)       VIDMSG
163160940923     C                   SETON                                        90
163170940919     C                   GOTO      FOR03
163180900504     C                   END
163190950410     C                   END
163200101104     c                   endif
163210960318     C**
163220960318     C* SE NUM COLLI > DEL LIMITE AVVISO CHE SI DEVE EFFETTUARE CARGO
163230960318     C* FORZABILE CON F6 --> NON AVVISO PER CERTI TIPI TARIFFA
163240960805     C* NON LO FACCIO SE BOLLA DI RECUPERO
163250960805     C  NKF§3ARBL        IFNE      'R'
163260130927     c     wforw03       andeq     *Blanks
163270960805     C                   EXSR      CTRCRG
163280030704     c   41              GoTo      For03
163290960805     C                   ENDIF
163300940919     C*
163310940923     C     ENDD03        ENDSR
163320900507     C*
163330900507     C*--- CONTROLLO FORMATO 3 ---------------------------------------*
163340940826     C     CTRD03        BEGSR
163350991008      *
163360941004     C                   SETOFF                                       90
163370941115     C                   CLEAR                   VIDMSG
163380940826     C                   CLEAR                   WEMFOR
163390030623     C                   CLEAR                   WVAR3A            1
163400991028     C**
163410991028     C* CONTROLLO DIVISA SE MODIFICATA
163420991028    1C     VI2DIV        IFNE      *BLANKS
163430991028     C     VI2DIV        ANDNE     WDIV2
163440991028     C     WDIV2         ANDNE     *BLANKS
163450991028     C                   CLEAR                   DSLV16
163460991028     C                   CLEAR                   DTASV
163470991028     C                   MOVEL     'D'           D17FIM
163480991028     C                   MOVE      VI2DIV        D17DIV
163490991028     C                   Z-ADD     BLPDSP        D17DSP
163500991028     C                   CALL      'FNLV16R'
163510991028     C                   PARM                    DSLV16
163520991028     C                   PARM                    DTASV
163530991028     C                   MOVEL     D17DIV        VI2DIV
163540991028     C* ERRORE
163550991028    2C     O17ERR        IFNE      *BLANKS
163560991028     C                   SETON                                        43
163570991028    3C     O17MSG        IFNE      *BLANKS
163580991028     C                   MOVEL     O17MSG        VIDMSG
163590991028     C                   SETON                                        90
163600991028    3C                   ENDIF
163610991028     C                   GOTO      ENDC03
163620991028    2C                   ENDIF
163630991028     C**
163640991028      * SE VARIATA DIVISA DEVO CONVERTIRE GLI IMPORTI NON MODIFICATI
163650991028    2C     VI2VA1        IFEQ      VA2VA1
163660991028     C     VI2VA1        ANDGT     *ZEROS
163670991028     C                   CLEAR                   DSYEUR
163680991028     C                   MOVEL     WDIV2         YECDVI
163690991028     C                   Z-ADD     VI2VA1        YECIMI
163700991028     C                   MOVEL     VI2DIV        YECDVO
163710991028    3C     O17FDC        IFEQ      'S'
163720991028     C                   MOVEL     '3'           YECDCO
163730991028    3C                   ENDIF
163740991028     C**
163750991028     C                   CALL      'YEURCO'
163760991028     C                   PARM                    DSYEUR
163770991028     C**
163780991028    3C     YECESI        IFEQ      ' '
163790991028     C                   Z-ADD     YECIMO        VI2VA1
163800991028     C                   MOVEL     '1'           WEMFOR
163810991028    3C                   ENDIF
163820991028    2C                   ENDIF
163830040114      * Varia 2
163840040114    2c                   If        Vi2Va2 = Va2Va2 and Vi2Va2 > 0
163850040114     c                   Clear                   dsyeur
163860040114     c                   Movel     wdiv2         YecDvi
163870040114     c                   Z-add     Vi2va2        YecImi
163880040114     c                   Movel     Vi2Div        YecDvo
163890040114    3c                   If        O17fDc = 'S'
163900040114     c                   Movel     '3'           YecDco
163910040114    3c                   EndIf
163920040114     c                   Call      'YEURCO'
163930040114     c                   Parm                    dsyeur
163940040114    3c                   If        YecEsi = *Blanks
163950040114     c                   Z-add     YecImo        Vi2Va2
163960040114     c                   Eval      wemfor = '1'
163970040114    3c                   EndIf
163980040114    2c                   EndIf
163990040114      * Varia 3
164000040114    2c                   If        Vi2Va3 = Va2Va3 and Vi2Va3 > 0
164010040114     c                   Clear                   dsyeur
164020040114     c                   Movel     wdiv2         YecDvi
164030040114     c                   Z-add     Vi2va3        YecImi
164040040114     c                   Movel     Vi2Div        YecDvo
164050040114    3c                   If        O17fDc = 'S'
164060040114     c                   Movel     '3'           YecDco
164070040114    3c                   EndIf
164080040114     c                   Call      'YEURCO'
164090040114     c                   Parm                    dsyeur
164100040114    3c                   If        YecEsi = *Blanks
164110040114     c                   Z-add     YecImo        Vi2Va3
164120040114     c                   Eval      wemfor = '1'
164130040114    3c                   EndIf
164140040114    2c                   EndIf
164150040114      * Varia 4
164160040114    2c                   If        Vi2Va4 = Va2Va4 and Vi2Va4 > 0
164170040114     c                   Clear                   dsyeur
164180040114     c                   Movel     wdiv2         YecDvi
164190040114     c                   Z-add     Vi2va4        YecImi
164200040114     c                   Movel     Vi2Div        YecDvo
164210040114    3c                   If        O17fDc = 'S'
164220040114     c                   Movel     '3'           YecDco
164230040114    3c                   EndIf
164240040114     c                   Call      'YEURCO'
164250040114     c                   Parm                    dsyeur
164260040114    3c                   If        YecEsi = *Blanks
164270040114     c                   Z-add     YecImo        Vi2Va4
164280040114     c                   Eval      wemfor = '1'
164290040114    3c                   EndIf
164300040114    2c                   EndIf
164310041217      * Varia 5
164320041217    2c                   If        Vi2Va5 = Va2Va5 and Vi2Va5 > 0
164330041217     c                   Clear                   dsyeur
164340041217     c                   Movel     wdiv2         YecDvi
164350041217     c                   Z-add     Vi2va5        YecImi
164360041217     c                   Movel     Vi2Div        YecDvo
164370041217    3c                   If        O17fDc = 'S'
164380041217     c                   Movel     '3'           YecDco
164390041217    3c                   EndIf
164400041217     c                   Call      'YEURCO'
164410041217     c                   Parm                    dsyeur
164420041217    3c                   If        YecEsi = *Blanks
164430041217     c                   Z-add     YecImo        Vi2Va5
164440041217     c                   Eval      wemfor = '1'
164450041217    3c                   EndIf
164460041217    2c                   EndIf
164470041217      * Varia 6
164480041217    2c                   If        Vi2Va6 = Va2Va6 and Vi2Va6 > 0
164490041217     c                   Clear                   dsyeur
164500041217     c                   Movel     wdiv2         YecDvi
164510041217     c                   Z-add     Vi2va6        YecImi
164520041217     c                   Movel     Vi2Div        YecDvo
164530041217    3c                   If        O17fDc = 'S'
164540041217     c                   Movel     '3'           YecDco
164550041217    3c                   EndIf
164560041217     c                   Call      'YEURCO'
164570041217     c                   Parm                    dsyeur
164580041217    3c                   If        YecEsi = *Blanks
164590041217     c                   Z-add     YecImo        Vi2Va6
164600041217     c                   Eval      wemfor = '1'
164610041217    3c                   EndIf
164620041217    2c                   EndIf
164630040114
164640991028    1C                   ENDIF
164650991028      *
164660991028     C                   Z-ADD     VI2VA1        VA2VA1
164670040114     c                   Z-add     Vi2Va2        Va2Va2
164680040114     c                   Z-add     Vi2Va3        Va2Va3
164690040114     c                   Z-add     Vi2Va4        Va2Va4
164700041217     c                   Z-add     Vi2Va5        Va2Va5
164710041217     c                   Z-add     Vi2Va6        Va2Va6
164720040121     C                   Z-ADD     VI2VA1        VVA(1)
164730040121     c                   Z-add     Vi2Va2        Vva(2)
164740040121     c                   Z-add     Vi2Va3        Vva(3)
164750040121     c                   Z-add     Vi2Va4        Vva(4)
164760041217     c                   Z-add     Vi2Va5        Vva(5)
164770041217     c                   Z-add     Vi2Va6        Vva(6)
164780991028     C                   MOVEL     VI2DIV        WDIV2
164790991028     C* RIEMETTO VIDEATA
164800991028     C     WEMFOR        IFEQ      '1'
164810991028     C                   GOTO      ENDC03
164820991028    2C                   ENDIF
164830940826     C*
164840100119      * Gli altri controlli sono demandati al FNLV16
164850100119     C                   CLEAR                   Dlv1601
164860100119     C                   CLEAR                   DSLV16
164870100119     C                   CLEAR                   DTASV
164880100119
164890940920     C* 2 BOLLA --> CONTROLLO I CAMPI
164900991011    1C     VI2SV1        IFNE      *BLANKS
164910991011     C     VI2VA1        ORNE      *ZEROS
164920040114     c     Vi2Sv2        orne      *Blanks
164930040114     c     Vi2Va2        orne      *Zeros
164940040114     c     Vi2Sv3        orne      *Blanks
164950040114     c     Vi2Va3        orne      *Zeros
164960040114     c     Vi2Sv4        orne      *Blanks
164970040114     c     Vi2Va4        orne      *Zeros
164980041217     c     Vi2Sv5        orne      *Blanks
164990041217     c     Vi2Va5        orne      *Zeros
165000041217     c     Vi2Sv6        orne      *Blanks
165010041217     c     Vi2Va6        orne      *Zeros
165020991011     C     VI2DIV        ORNE      *BLANKS
165030100119     C                   MOVEL     'E'           D17FIM
165040100119   x1c                   else
165050100119     c* controllo solo il codice esenzione IVA
165060100119    2C     VI2CEI        ifne      *BLANKS
165070100119     C                   MOVEL     'I'           D17FIM
165080100119    2c                   endif
165090100119    1c                   endif
165100991026      *
165110100119    1c                   if        d17fim<>' '
165120991011     C                   MOVEL     'P'           D17TBO
165130991011     C                   MOVEL     WKSC          D17KSC
165140991028     C                   Z-ADD     BLPDSP        D17DSP
165150991011     C                   MOVEL     VIDLNP        D17LNP
165160991011     C                   MOVEL     VIDLNA        D17LNA
165170991011     C                   MOVEL     §3ATB2        D17TBL
165180991011     C                   MOVEL     §3ARBL        D17RBL
165190020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
165200040115     c                   Movel     §3asva        §d17Sva
165210040115      * passo che devo controllare la seconda bolla
165220040115     c                   Eval      §d17Tb2 = 'S'
165230100119     c                   Eval      §d17ctriso='S'
165240100119     c                   Eval      §d17iso=vidisd
165250100119
165260100119     c                   if        vidpid<>*blanks and vidisd=*blanks
165270100119     c                   eval      §d17iso='IT'
165280100119     c                   endif
165290100119
165300040115     c                   Movel     Dlv1601       D17Flo
165310991011     C                   MOVEL     VI2DIV        D17DIV
165320991011     C                   MOVEL     WDIV2         D17DVP
165330991011     C     §3AFCA        IFEQ      2
165340991011     C                   MOVEL     'S'           D17FCA
165350991011     C                   ENDIF
165360991011     C                   MOVEL     VI2CEI        D17CEI
165370991012     C                   MOVEL     VI2SV1        VSV(1)
165380991012     C                   MOVEL     VI2VA1        VVA(1)
165390040121     c                   Movel     Vi2Es1        ves(1)
165400040115     C                   MOVEL     VI2SV2        VSV(2)
165410040115     C                   Z-add     VI2VA2        VVA(2)
165420040121     c                   Movel     Vi2Es2        ves(2)
165430040115     C                   MOVEL     VI2SV3        VSV(3)
165440040115     C                   Z-add     VI2VA3        VVA(3)
165450040121     c                   Movel     Vi2Es3        ves(3)
165460040115     C                   MOVEL     VI2SV4        VSV(4)
165470040115     C                   Z-add     VI2VA4        VVA(4)
165480040121     c                   Movel     Vi2Es4        ves(4)
165490041217     C                   MOVEL     VI2SV5        VSV(5)
165500041217     C                   Z-add     VI2VA5        VVA(5)
165510041217     c                   Movel     Vi2Es5        ves(5)
165520041217     C                   MOVEL     VI2SV6        VSV(6)
165530041217     C                   Z-add     VI2VA6        VVA(6)
165540041217     c                   Movel     Vi2Es6        ves(6)
165550100119     c* In questo caso passo il codice iso della partita iva del destinatario
165560100119     c
165570991011      *
165580991011     C                   CALL      'FNLV16R'
165590991011     C                   PARM                    DSLV16
165600991012     C                   PARM                    DTASV
165610991011      *
165620991011     C                   MOVEL     D17CEI        VI2CEI
165630991011     C                   MOVEL     D17DIV        VI2DIV
165640991015     C                   MOVEL     O17FDC        WFDC2
165650991011     C                   MOVEL     O17DEI        V2DCEI
165660040115      * Ricarico le varie
165670040115     c                   Movel     Vsv(1)        Vi2Sv1
165680040115     c                   Z-add     Vva(1)        Vi2Va1
165690040121     c                   Movel     Ves(1)        Vi2Es1
165700040115     c                   Movel     Vsv(2)        Vi2Sv2
165710040115     c                   Z-add     Vva(2)        Vi2Va2
165720040121     c                   Movel     Ves(2)        Vi2Es2
165730040115     c                   Movel     Vsv(3)        Vi2Sv3
165740040115     c                   Z-add     Vva(3)        Vi2Va3
165750040121     c                   Movel     Ves(3)        Vi2Es3
165760040115     c                   Movel     Vsv(4)        Vi2Sv4
165770040115     c                   Z-add     Vva(4)        Vi2Va4
165780040121     c                   Movel     Ves(4)        Vi2Es4
165790041217     c                   Movel     Vsv(5)        Vi2Sv5
165800041217     c                   Z-add     Vva(5)        Vi2Va5
165810041217     c                   Movel     Ves(5)        Vi2Es5
165820041217     c                   Movel     Vsv(6)        Vi2Sv6
165830041217     c                   Z-add     Vva(6)        Vi2Va6
165840041217     c                   Movel     Ves(6)        Vi2Es6
165850991011      *
165860991011     C     O17ERR        IFNE      *BLANKS
165870991011      *
165880991011      *  Se errore riemetto videata con messaggio
165890991011     C     O17MSG        IFNE      *BLANKS
165900991011     C                   MOVEL     O17MSG        VIDMSG
165910991011     C                   SETON                                        90
165920991011      *  Se interrogazione riemetto videata
165930991011     C                   ELSE
165940991011     C                   MOVEL     '1'           WEMFOR            1
165950991011     C                   ENDIF
165960991011      *
165970991011     C                   SELECT
165980991011     C     O17ERR        WHENEQ    '1'
165990991011     C                   SETON                                        42
166000991011     C     O17ERR        WHENEQ    '6'
166010040116     c                   If        O17Erv = 1
166020991011     C                   SETON                                        40
166030040115     c                   EndIf
166040040116     c                   If        O17Erv = 2
166050040115     c                   z-add     09            H3riga
166060041217     c                   z-add     49            H3colo
166070040115     c                   EndIf
166080040116     c                   If        O17Erv = 3
166090041217     c                   z-add     09            H3riga
166100041217     c                   z-add     65            H3colo
166110040115     c                   EndIf
166120040116     c                   If        O17Erv = 4
166130040115     c                   z-add     10            H3riga
166140041217     c                   z-add     33            H3colo
166150040115     c                   EndIf
166160041217     c                   If        O17Erv = 5
166170041217     c                   z-add     10            H3riga
166180041217     c                   z-add     49            H3colo
166190041217     c                   EndIf
166200041217     c                   If        O17Erv = 6
166210041217     c                   z-add     10            H3riga
166220041217     c                   z-add     65            H3colo
166230041217     c                   EndIf
166240991011     C     O17ERR        WHENEQ    '7'
166250991011     C                   SETON                                        43
166260991011     C                   ENDSL
166270991011      *
166280991011     C   90              GOTO      ENDC03
166290991011     C                   ENDIF
166300991011      *
166310991011    1C                   ENDIF
166320040130      * salvo le varie in una sk per poterle poi riorganizzare al momento
166330040130      * della scrittura dei file FIAR6 e FIAR7
166340040130     c                   Eval      W2sv(1) = vi2sv1
166350040130     c                   Eval      W2va(1) = vi2va1
166360040130     c                   Eval      W2sv(2) = vi2sv2
166370040130     c                   Eval      W2va(2) = vi2va2
166380040130     c                   Eval      W2sv(3) = vi2sv3
166390040130     c                   Eval      W2va(3) = vi2va3
166400040130     c                   Eval      W2sv(4) = vi2sv4
166410040130     c                   Eval      W2va(4) = vi2va4
166420041217     c                   Eval      W2sv(5) = vi2sv5
166430041217     c                   Eval      W2va(5) = vi2va5
166440041217     c                   Eval      W2sv(6) = vi2sv6
166450041217     c                   Eval      W2va(6) = vi2va6
166460040130      * Controllo se caricata almeno una varia
166470041217do  1c                   Do        6             c
166480040130     c                   If        w2sv(c) <> *Blanks
166490040130     c                   Eval      wesvar1 = 'S'
166500040130     c                   EndIf
166510040130    1c                   EndDo
166520011212     C* CONTROLLO CHE LA L'IMPORTO NON SUPERI IL LIMITE FATTURABILE
166530040130     c                   xfoot     w2va          wsomts
166540040116if  1c                   If        wsomts > *Zeros
166550011212     C     VI2DIV        IFNE      §GEDCN
166560011212     C                   CLEAR                   DSYEUR
166570011212     C                   MOVEL     VI2DIV        YECDVI
166580011212     C                   MOVEL     §GEDCN        YECDVO
166590040114     c                   Z-add     wsomts        YecImi
166600011212     C                   MOVE      DECCN         YECDCO
166610011212     C                   CALL      'YEURCO'
166620011212     C                   PARM                    DSYEUR
166630011212     C     YECESI        IFEQ      ' '
166640011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
166650011212     C                   ENDIF
166660011212     C                   ENDIF
166670011212     C     WSOMTS        IFGT      IMFGEI
166680040115     c                   Movea     err(242)      k78
166690011212     C                   MOVE      IMFGEI        WNUMED
166700011212     C* richiamo routine per editare il limite
166710011212     C                   EXSR      CALLXE
166720011212      * metto il numero editato nel campo del messaggio
166730011212     C                   MOVEA     W014A         SKII(1)
166740040115     c                   Movea     skii(1)       k78(54)
166750040115     c                   Movea     §gedcn        k78(69)
166760011212     C*
166770011212     C                   MOVEA     K78           VIDMSG
166780011212     C                   SETON                                        4190
166790011212     C                   GOTO      ENDC03
166800011212     C                   ENDIF
166810040116    1C                   ENDIF
166820040126
166830040126     c                   Z-add     wsomts        Vi2Imv
166840991011      *
166850991012      * SE TASSAZIONE CON TARIFFA MITTENTE PROVO A RITASSARE
166860991012      * NON TASSO SE P.A. EXPORT
166870950127    1C   04SAVFTM        IFEQ      'S'
166880950127     C     VIDFTM        OREQ      'S'
166890950127    2C     VIDIMV        IFEQ      0
166900980506     C                   MOVEL     '1'           WBOL
166910151014     c                   clear                   PesVolPkcn
166920151014     c                   clear                   PesVolSpc
166930151014     c                   clear                   PesVolImv
166940950127     C                   EXSR      TASSAZ
166950151014     c* Se totale imponibile, memorizzo i dati usati dalla fatturaz.
166960151014     c                   if        vidimv>0
166970151014     c                   eval      PesVolPkcn=taspkcn
166980151014     c                   eval      PesVolSpc=tasspc
166990151014     c                   eval      PesVolIMV=vidimv
167000151014     c                   endif
167010950127    2C                   END
167020950127    1C                   END
167030991012      *
167040991012      * SE VARIATA LA DIVISA: LA CONTROLLO, CONVERTO IMPORTI MODIFICATI
167050991012      *                       E RIEMETTO LA VIDEATA
167060991012     C     VIDDIV        IFNE      WDIV1
167070991015     C     VIDDIV        ANDNE     *BLANKS
167080991026     C     WDIV1         ANDNE     *BLANKS
167090991012     C                   EXSR      VARDIV
167100991028     C     WEMFOR        IFEQ      '1'
167110991012     C                   GOTO      ENDC03
167120991028     C                   ENDIF
167130991012     C                   ENDIF
167140991012      *
167150100119     C                   CLEAR                   Dlv1601
167160100119     C                   CLEAR                   DSLV16
167170991007     C                   CLEAR                   DTASV
167180941219     C                   MOVEL     'P'           D17TBO
167190991012      * PER PREPAGATI IMPOSTO IL FLAG APPOSITO
167200991012     C   22              MOVEL     'S'           D17PRP
167210991012     C  N04              MOVEL     WKSC          D17KSC
167220941219     C*
167230941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
167240991012    1C     SAVFTM        IFEQ      'S'
167250991012     C     *IN04         ANDEQ     *ON
167260941219     C     VIDFTM        OREQ      'S'
167270991012     C     *IN04         ANDEQ     *ON
167280941221     C                   MOVE      WKSC          D17KSC
167290941219     C                   MOVEL     'S'           D17FTM
167300991012      *
167310991012      * SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
167320941219   X2C                   ELSE
167330941221     C                   MOVEL     COMLNA        D17KSC
167340941221     C                   MOVE      9999          D17KSC
167350991012    1C                   ENDIF
167360991012      *
167370991012     C                   MOVEL     'C'           D17FIM
167380941219     C                   MOVEL     VIDLNP        D17LNP
167390941219     C                   MOVEL     VIDLNA        D17LNA
167400941219     C                   MOVEL     §3ATB1        D17TBL
167410941219     C                   MOVEL     §3ARBL        D17RBL
167420020503     C* SE IL TIPO BOLLA PREVEDE SOLO UNA VARIA, LA PASSO
167430020503     C                   MOVEL     §3ASVA        D17FLO
167440950103     C     §3AFCA        IFEQ      1
167450941219     C                   MOVEL     'S'           D17FCA
167460941219     C                   ENDIF
167470941219     C                   MOVEL     VIDIAS        D17IAS
167480941219     C                   MOVEL     VIDQFT        D17QFT
167490941219     C                   MOVEL     VIDPOR        D17POR
167500991014     C     COMDFT        IFGT      *ZEROS
167510991014     C                   Z-ADD     COMDFT        D17DSP
167520991012     C                   ELSE
167530991028     C                   Z-ADD     BLPDSP        D17DSP
167540991012     C                   ENDIF
167550941219     C                   MOVEL     VIDIMV        D17IMV
167560941219     C                   MOVEL     VIDCEI        D17CEI
167570941219     C                   MOVEL     VIDFIV        D17FIV
167580941219     C                   MOVEL     VIDNFT        D17NFT
167590941219     C                   MOVEL     VIDDFT        D17DFG
167600941219     C                   MOVEL     'S'           D17FFI
167610991012     C                   MOVEL     VIDDIV        D17DIV
167620991012     C                   MOVEL     WDIV1         D17DVP
167630100119     c
167640100119     c* Controllo codice esenzione iva con partita iva del "chi paga"
167650100120     c*  sempre se ASSEGNATO
167660100119
167670100119     c                   if        *in04
167680100120     c                   Eval      §d17ctriso='S'
167690100119     c                   Eval      §d17iso=vidisd
167700100119     c                   if        vidpid<>*blanks and vidisd=*blanks
167710100119     c                   eval      §d17iso='IT'
167720100119     c                   endif
167730100119
167740100119     c                   else
167750100120     c*  solo per prepagati se FRANCO
167760100120     c                   if        *in22
167770100120     c                   Eval      §d17ctriso='S'
167780100119     c                   Eval      §d17iso=vidism
167790100119     c                   if        vidpim<>*blanks and vidism=*blanks
167800100119     c                   eval      §d17iso='IT'
167810100119     c                   endif
167820100120     c                   endif
167830100120     c
167840100119     c                   endif
167850100119
167860100119     c                   Movel     Dlv1601       D17Flo
167870991012      *
167880991012      * CARICO SCHIERA VARIE
167890941219     C                   CLEAR                   C
167900941219     C                   DO        20            NRR
167910941219     C     NRR           CHAIN     LS01S03                            30
167920941219     C     *IN30         IFEQ      *OFF
167930970604     C**
167940941219     C                   ADD       1             C
167950941219     C                   MOVEL     V3CSV1        VSV(C)
167960991007     C                   Z-ADD     V3CVA1        VVA(C)
167970030623     C* MEMORIZZO SE C'E' LA VARIA DELLA BOLLA NEL CASO DI BOLLE CON SINGOLA VAR
167980030623     C                   IF        §3ASVA <> *BLANKS AND V3CSV1 = §3ASVA
167990030623     C                   MOVEL     'S'           WVAR3A            1
168000030623     C                   ENDIF
168010941219     C                   ENDIF
168020941219     C                   ENDDO
168030970604     C* ERRORE
168040970604     C   90              GOTO      ENDC03
168050990701     C**
168060941219     C** CALL
168070991008     C                   CALL      'FNLV16R'
168080991008     C                   PARM                    DSLV16
168090991007     C                   PARM                    DTASV
168100991012      *
168110991012     C                   MOVEL     D17DIV        VIDDIV
168120991015     C                   MOVEL     O17FDC        WFDC1
168130941219     C                   MOVEL     D17CEI        VIDCEI
168140991011     C                   MOVEL     O17DEI        DESCEI            8
168150991011     C                   MOVEL     O17DEI        V3DCEI
168160941219     C                   Z-ADD     D17DFG        VIDDFT
168170991011     C                   Z-ADD     O17DFA        COMDFT
168180991012      *
168190991012      * RICARICO LE VARIE
168200941219     C                   DO        20            NRR
168210941219     C     NRR           CHAIN     LS01S03                            30
168220941219     C                   MOVEL     VSV(NRR)      V3CSV1
168230941219     C                   MOVEL     VES(NRR)      V3CEV1
168240941223     C*
168250941223     C     VSV(NRR)      IFNE      *BLANKS
168260941223     C                   MOVEL     'S'           WESVAR            1
168270941223     C                   ENDIF
168280941219     C* SE C'E' ERRORE SU VARIA, ACCENDO INDICATORE DI POSIZIONAMENTO
168290991011     C     O17ERV        IFEQ      NRR
168300941219     C                   SETON                                        5090
168310991019     C                   MOVEL     O17MSG        VIDMSG
168320941219     C                   ELSE
168330941219     C                   SETOFF                                       50
168340941219     C                   ENDIF
168350991012      *
168360941219     C  N30              UPDATE    LS01S03
168370941219     C   30              WRITE     LS01S03
168380941219     C                   ENDDO
168390991012      *
168400991015     C   90              GOTO      ENDC03
168410991015      *
168420991012      * GESTIONE ERRORI
168430991011    1C     O17ERR        IFNE      *BLANKS
168440941219     C                   MOVEL     '1'           WEMFOR
168450941021     C*
168460991011    2C     O17MSG        IFNE      *BLANKS
168470991011     C                   MOVEL     O17MSG        VIDMSG
168480941219     C                   SETON                                        90
168490941021    2C                   ENDIF
168500941021     C**
168510941021     C* ESENZIONE IVA
168520991011    2C     O17ERR        IFEQ      '1'
168530950103     C                   SETON                                        46
168540940920     C                   GOTO      ENDC03
168550941021    2C                   ENDIF
168560941021     C**
168570941021     C* NUMERO FATTURA
168580991011     C     O17ERR        IFEQ      '2'
168590941219     C                   SETON                                        48
168600941021     C                   GOTO      ENDC03
168610941021    2C                   ENDIF
168620941021     C**
168630960926     C* REGISTRO IVA FATTURA
168640991011    2C     O17ERR        IFEQ      '3'
168650941219     C                   SETON                                        47
168660941021     C                   GOTO      ENDC03
168670941021    2C                   ENDIF
168680941021     C**
168690941021     C* DATA FATTURA
168700991011     C     O17ERR        IFEQ      '4'
168710941219     C                   SETON                                        49
168720941021     C                   GOTO      ENDC03
168730941021    2C                   ENDIF
168740941021     C**
168750941021     C* IMPONIBILE
168760991011     C     O17ERR        IFEQ      '5'
168770941219     C                   SETON                                        45
168780941021     C                   GOTO      ENDC03
168790941021    2C                   ENDIF
168800991012     C**
168810991012     C* DIVISA
168820991012     C     O17ERR        IFEQ      '7'
168830991012     C                   SETON                                        53
168840991012     C                   GOTO      ENDC03
168850991012    2C                   ENDIF
168860991012     C**
168870991012     C* PORTO
168880991012     C     O17ERR        IFEQ      '8'
168890991012     C                   SETON                                        52
168900991012     C                   GOTO      ENDC03
168910991012    2C                   ENDIF
168920941021     C*
168930941021    1C                   ENDIF
168940991104      *
168950991104      * MEMORIZZO GLI IMPORTI DI TASSAZIONE IN CAMPI DI COMODO PER CONFRONTI
168960011212     C* MENTRE MEMORIZZO FACCIO ANCHE LA SOMMA DEGLI IMPORTI PER POI
168970011212     C* CONTROLLARLA COL LIMITE FATTURABILE
168980991104     C                   Z-ADD     VIDPOR        MEMPOR
168990011212     C                   Z-ADD     VIDPOR        WSOMTS           17 3
169000991104     C                   MOVEL     VIDDIV        WDIV1
169010991104     C                   DO        20            NRR
169020991104     C     NRR           CHAIN     LS01S03                            30
169030991104     C                   Z-ADD     V3CVA1        V3HVA1
169040011219     C* Se è bolla di rientro non tassata fino all'imponibile con varia
169050011219     c* "N" 88888888 non la considero per il confronto con §geimf
169060011219     C     VIDFBR        IFEQ      'S'
169070011219     C     V3CSV1        ANDEQ     'N'
169080011219     C     V3CVA1        ANDEQ     88888888
169090011219     C     VIDIMV        ANDEQ     *ZEROS
169100030624     C* oppure varia & 8888888
169110030624     C     V3CSV1        OREQ      '&'
169120030624     C     V3CVA1        ANDEQ     88888888
169130030624     C     VIDIMV        ANDEQ     *ZEROS
169140011219     C                   ELSE
169150011212     C                   ADD       V3CVA1        WSOMTS
169160011219     C                   ENDIF
169170991104     C  N30              UPDATE    LS01S03
169180991104     C                   ENDDO
169190011212     C***
169200011212     C     VIDIMV        IFGT      *ZEROS
169210011212     C                   Z-ADD     VIDIMV        WSOMTS
169220011212     C                   ENDIF
169230011212     C* CONTROLLO CHE LA SOMMA DEGLI IMPORTI O IL TOTALE IMPONIBILE,
169240011212     C* SE PRESENTE, NON SUPERI IL LIMITE FATTURABILE
169250011212     C     WSOMTS        IFGT      *ZEROS
169260011212     C     VIDDIV        IFNE      §GEDCN
169270011212     C                   CLEAR                   DSYEUR
169280011212     C                   MOVEL     VIDDIV        YECDVI
169290011212     C                   MOVEL     §GEDCN        YECDVO
169300011212     C                   Z-ADD     WSOMTS        YECIMI
169310011212     C                   MOVE      DECCN         YECDCO
169320011212     C                   CALL      'YEURCO'
169330011212     C                   PARM                    DSYEUR
169340011212     C     YECESI        IFEQ      ' '
169350011212     C                   Z-ADD     YECIMO        WSOMTS           17 3
169360011212     C                   ENDIF
169370011212     C                   ENDIF
169380011212     C     WSOMTS        IFGT      IMFGEI
169390011212     C                   MOVEA     ERR(242)      K78
169400011212     C                   MOVE      IMFGEI        WNUMED
169410011212     C* richiamo routine per editare il limite
169420011212     C                   EXSR      CALLXE
169430011212      * metto il numero editato nel campo del messaggio
169440011212     C                   MOVEA     W014A         SKII(1)
169450011212     C                   MOVEA     SKII(1)       K78(54)
169460011212     C                   MOVEA     §GEDCN        K78(69)
169470011212     C*
169480011212     C                   MOVEA     K78           VIDMSG
169490011212     C                   SETON                                        5290
169500011212     C                   GOTO      ENDC03
169510011212     C                   ENDIF
169520011212     C                   ENDIF
169530991012      *
169540991012     C* PER COD 8888 O 9999 CON VARIA "R" OBBLIGATORIO IMPORTO DA ASSICURARE
169550991012     C*  "S" IN O17FAS INDICA QUESTO TIPO DI ERRORE
169560991011    3C     O17FAS        IFEQ      'S'
169570940923     C* SE = 0 E FORZO CON ENTER PRENDO VALORE DA TARIFFA
169580941021    4C     SEI           IFNE      NUMFOR
169590941021     C                   MOVEL     ERR(9)        VIDMSG
169600940923     C                   SETON                                        5090
169610940923     C                   ADD       1             SEI
169620940923     C                   GOTO      ENDC03
169630940923    4C                   ENDIF
169640940923    3C                   ENDIF
169650940826     C*
169660950421     C* DATA FATTURA DEVE APPARTENERE ALLO STESSO MESE DELLA DATA SPEDI
169670990701    3C     VIDDFT        IFGT      0
169680990830     C     *IN22         ANDEQ     *OFF
169690950421     C                   MOVEL     VIDDFT        W0040             4 0
169700950421     C                   MOVE      W0040         W0020F            2 0
169710950421     C                   MOVEL     VIDDSP        W0040
169720950421     C                   MOVE      W0040         W0020S            2 0
169730990701    4C     W0020S        IFNE      W0020F
169740950421     C                   SETON                                        4990
169750950421     C                   MOVEL     ERR(116)      VIDMSG
169760950421     C                   GOTO      ENDC03
169770990701    4C                   ENDIF
169780990701    3C                   ENDIF
169790961111     C**
169800990830     C* SE LA DATA FATTURA <=10 DATA DI PARUT, IMPOSTO LA PRIMA DATA
169810000113     C*  DEL GIORNO, SE NON CAMBIA L'ANNO, ALTRIMENTI ERRORE
169820991011    2C   22O17DFA        IFLE      WDTU10
169830991011     C     O17DFA        ANDGT     0
169840000113     C                   MOVEL     O17DFA        W0040
169850000113     C     W0040         IFEQ      WAAUPI
169860990830     C* IMPOSTO WDTU10 + 1 E AVVISO
169870990830     C                   Z-ADD     WDTUPI        VIDDFT
169880990830     C                   SETON                                        4990
169890990830     C                   MOVEL     ERR(167)      VIDMSG
169900990830     C                   GOTO      ENDC03
169910000113     C                   ELSE
169920000113     C**
169930000113     C                   SETON                                        4990
169940000113     C                   MOVEL     ERR(182)      VIDMSG
169950000113     C                   GOTO      ENDC03
169960991012    2C                   ENDIF
169970000113    2C                   ENDIF
169980001121     C* SE DATA FATTURA < DATA SPEDIZIONE E CAMBIO MESE, NON POSSO
169990001121     C*  METTERE IN SOSPENSIONE LA BOLLA
170000000508    2C   22O17DFA        IFGT      WDTU10
170010000508     C     O17DFA        ANDGT     0
170020001121     C                   MOVEL     O17DFA        W0060F            6 0
170030001121     C                   MOVEL     BLPDSP        W0060S            6 0
170040000508     C     W0060F        IFLT      W0060S
170050000508     C     BLPDSP        ANDGT     DATEU
170060000508     C                   SETON                                        4990
170070000508     C                   MOVEL     ERR(193)      VIDMSG
170080000508     C                   GOTO      ENDC03
170090000508     C                   ENDIF
170100000508     C                   ENDIF
170110000113     C*
170120990610     C* SE FRANCO FRONTIERA SPECIFICARE IL PORTO
170130961111     C  NKLVIDPOR        IFEQ      0
170140961111     C     VIDFBR        ANDEQ     'F'
170150961111     C                   SETON                                        5290
170160961111     C                   MOVEL     ERR(129)      VIDMSG
170170961111     C                   GOTO      ENDC03
170180961111     C                   ENDIF
170190990610     C*
170200990610     C* SE PREPAGATO INSERIRE TASSAZIONE O F14 PER TASSARE
170210990701     C  NKL
170220990701    1CANNKN*IN22         IFEQ      *ON
170230990701    2C     VIDIMV        IFEQ      0
170240990614     C                   SETON                                        5290
170250990610     C                   MOVEL     ERR(160)      VIDMSG
170260990610     C                   GOTO      ENDC03
170270990701   X2C                   ELSE
170280990701    3C     VIDIMV        IFNE      SAVIMV
170290990716     C     VIDIMV        ANDGT     0
170300060207     c* se sono in manutenzione errore se già incassato
170310060208     c                   if        *in12 = *on and *in15 = *off and
170320070514     c****                         dateu >= §vpogpp and vidimv <> savimvo
170330070514     c                             vidimv <> savimvo
170340060208     c                   exsr      sr_callycow
170350060208     c                   if        prmesito <> 0
170360060208     C                   SETON                                        90
170370060208     C                   MOVEL     ERR(297)      VIDMSG
170380060208     C                   GOTO      ENDC03
170390060208     c                   endif
170400060207     c                   endif
170410120105     c                   if        viddft>0
170420120105     C                   Z-ADD     viddft        G02DAT
170430120105     C                   MOVEL     *BLANK        G02ERR
170440120105     C                   CALL      'XSRDA8'
170450120105     C                   PARM                    WLBDAT
170460120105     C                   MOVEL     G02INV        comdft
170470120105     c                   else
170480990630     C                   Z-ADD     DATEU         COMDFT
170490120105     c                   endif
170500990630     C                   EXSR      TOTFAT
170510990630     C                   Z-ADD     D04IFT        VIDIFT
170520990701     C                   Z-ADD     D04IMV        VIDIMV
170530990701     C                   Z-ADD     D04POR        VIDPOR
170540991014     C                   Z-ADD     D04POR        MEMPOR
170550990701     C                   MOVEL     '1'           WEMFOR
170560990701     C                   Z-ADD     VIDIMV        SAVIMV
170570990701    3C                   ENDIF
170580990701    2C                   ENDIF
170590990630     C* LIBRO IVA
170600990701    2C     *IN34         IFEQ      *ON
170610020725     C                   clear                   DSBS02
170620020725     C                   clear                   DYIV
170630020725     C                   movel     'C'           T02mod
170640020725     C                   movel     KNSIF         T02sif
170650020725     C                   movel     'YIV'         T02cod
170660020725     C                   movel     C_Soc         T02ke1
170670020725     C                   movel     VIDLNP        T02ke2
170680020725     C                   call      'TIBS02R'
170690020725     C                   parm                    KPJBA
170700020725     C                   parm                    DSBS02
170710020725     C                   IF        T02err = *blanks
170720020725     C                   movel     T02uni        DYIV
170730020725     C                   movel     §IVLVF        FIV
170740020725     C                   else
170750020725     C                   clear                   DYIV
170760020725     C                   movel     VIDLNP        FIV
170770020725     C                   endif
170780990630     C* NUMERO FATTURA
170790990630     C     KNUM          CHAIN(N)  CNNUM000                           30
170800990630     C* ERRORE : MANCA IL NUMERATORE DELLE FATTURE
170810990701    3C     *IN30         IFEQ      *ON
170820990630     C                   MOVEL     ERR(164)      VIDMSG
170830990630     C                   SETON                                        5290
170840990630     C                   GOTO      ENDC03
170850990701    3C                   ENDIF
170860990701    2C                   ENDIF
170870990701    1C                   ENDIF
170880011025      * Se è bolla di reso con varia 'N' 88888888 deve esserci la varia 'N'
170890011025     C                   SETOFF                                       50
170900011025    1C     FLGVRN        IFEQ      '1'
170910011025    2C                   DO        20            NRR
170920011025     C     NRR           CHAIN     LS01S03                            30
170930011025    3C     *IN32         IFEQ      *OFF
170940011025     C                   SETON                                        50
170950011025    4C     V3CSV1        IFEQ      'N'
170960011025     C                   SETOFF                                       50
170970011025     C                   LEAVE
170980011025    4C                   ENDIF
170990011025    3C                   ENDIF
171000011025    2C                   ENDDO
171010011025    2C     *IN50         IFEQ      '1'
171020011025     C     1             CHAIN     LS01S03                            30
171030011025     C  N30              UPDATE    LS01S03
171040011114     C                   MOVEL     ERR(233)      VIDMSG
171050011025     C                   SETON                                        90
171060011025     C                   GOTO      ENDC03
171070011025    2C                   ENDIF
171080011025    1C                   ENDIF
171090991012      *
171100940923     C     ENDC03        TAG
171110940928     C   90              MOVEL     '1'           WEMFOR            1
171120991012      *
171130940923     C                   ENDSR
171140060208     C* Richiamo pgm che verifca se prepagato incassato -------------*
171150060208     C     sr_callycow   BEGSR
171160060208     c                   z-add     §lpaas        prmaas
171170060208     c                   z-add     §lplnp        prmlnp
171180060208     c                   z-add     §lpnrs        prmnrs
171190060208     c                   z-add     §lpnsp        prmnsp
171200060208     c                   z-add     vidfiv        prmfiv
171210060208     c                   z-add     vidnft        prmnft
171220060208     c                   z-add     dftar6        prmdft
171230060209     c                   clear                   prmesito
171240060607     c                   call      'YCOW0121R1'
171250060208     C                   PARM                    prmaas
171260060208     C                   PARM                    prmLnp
171270060208     C                   PARM                    prmNrs
171280060208     C                   PARM                    prmNsp
171290060208     C                   PARM                    prmFiv
171300060208     C                   PARM                    prmDft
171310060208     C                   PARM                    prmNft
171320060208     C                   PARM                    prmEsito
171330060208     C                   ENDSR
171340971211     C*
171350971211     C* GESTIONE 6 VIDEATA ------------------------------------------*
171360081008     C**   GESD06        BEGSR
171370081008     C**                 MOVEL     COMLNA        V6CLNA
171380971211     C* DECODIFICA LNA
171390081008     C**   COMLNA        CHAIN     AZORG01L      UNIORG               30
171400081008     C**N30              MOVEL     ORGDES        V6DLNA
171410971211     C*
171420081008     C**   FOR06         TAG
171430971211     C*
171440081008     C**                 EXFMT     LS01D06
171450081008     C**                 SETOFF                                       4090
171460971211     C* CONTROLLO SE INSERITO NUMERO AWB: NON POSSO CANCELLARLO SE
171470971211     C*  C'ERA
171480081008     C** 12
171490081008    1C**ANN15V6CAWB        IFEQ      0
171500081008     C**   SAVAWB        ANDGT     0
171510081008     C**                 SETON                                        4090
171520081008     C**                 MOVEL     ERR(145)      VIDMSG
171530081008     C**                 GOTO      FOR06
171540081008    1C**                 ENDIF
171550971211     C*
171560081008     c**   A_§ogntw      ifeq      'EUP'
171570081008     C**                 MOVEL     WKSC          W007A
171580081008     C**   W007A         LOOKUP    KSS                                    30
171590081008    2C**   *IN30         IFEQ      *ON
171600971211     C**
171610971211     C* CONTROLLO CHECK DIGIT
171620081008    3C**   V6CAWB        IFGT      0
171630081008     C**                 MOVEL     V6CAWB        W0090             9 0
171640081008     C**   W0090         DIV       7             RISUL            10 0
171650081008     C**                 MVR                     RESTO             1 0
171660971211     C**
171670081008     C**                 MOVE      V6CAWB        W0010             1 0
171680081008    4C**   RESTO         IFNE      W0010
171690081008     C**                 SETON                                        4090
171700081008     C**                 MOVEA     ERR(147)      K78
171710081008     C**                 MOVEL     RESTO         K78(66)
171720081008     C**                 MOVEA     K78           VIDMSG
171730081008     C**                 GOTO      FOR06
171740081008    4C**                 ENDIF
171750081008    3C**                 ENDIF
171760081008    2C**                 ENDIF
171770081008    1C**                 ENDIF
171780971211     C**
171790081008     C**                 ENDSR
171800991203     C*
171810991203     C* GESTIONE 7 VIDEATA ------------------------------------------*
171820991203     C     GESD07        BEGSR
171830991203     C                   MOVEL     COMLNA        V7CLNA
171840991203     C* DECODIFICA LNA
171850991203     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
171860991203     C  N30              MOVEL     ORGDES        V7DLNA
171870991203     C*
171880991203     C     FOR07         TAG
171890991203     C*
171900991203     C                   EXFMT     LS01D07
171910991203     C                   SETOFF                                       4090
171920991203     C* CONTROLLO SE INSERITO NUMERO PARCEL: NON POSSO CANCELLARLO SE
171930991203     C*  C'ERA
171940991203     C   12
171950060616     CANN15V7CNPR        IFEQ      *blanks
171960060616     C     SAVNPR        ANDne     *blanks
171970991203     C                   SETON                                        4090
171980991203     C                   MOVEL     ERR(176)      VIDMSG
171990991203     C                   GOTO      FOR07
172000991203     C                   ENDIF
172010991203      **
172020991203      * CONTROLLO VALIDITA'
172030060616    1C     V7CNPR        IFne      *blanks
172040000308     C     §3ARBL        ANDNE     'R'
172050000124     C                   MOVEL     V7CNPR        WNPR
172060000124     C                   EXSR      DPDVAL
172070000124     C   90              SETON                                        40
172080000124     C   90              GOTO      FOR07
172090070323     c* Sped. export DPD:
172100070323     c* dal I° aprile non più ammessi parcel dpd lunghi 12
172110070326     C                   if        A_§OGNTW='DPD' and dateu >=20070401
172120070326     c                             and %subst(wnpr:14:1)=*blanks
172130070326     c                             and vidfbr<>'S'
172140070323     c                   seton                                        9040
172150070323     C                   MOVEL     ERR(299)      VIDMSG
172160070323     C                   GOTO      FOR07
172170070323     c                   endif
172180000124     C*
172190991227    1C                   ENDIF
172200070323     c
172210000124     C**
172220000124     C* CONTROLLO NUMERO PARCEL DPD DOPPIO
172230000308     C* IGNORO PER BOLLA SENZA SEGNACOLLI
172240000308     C     §1BFG8        IFEQ      'S'
172250060616     C                   movel     V7CNPR        WNPR
172260060616     c                   if        *in79=*on
172270060616     c                   exsr      dpddop_imp
172280060616     c                   else
172290000124     C                   EXSR      DPDDOP
172300060616     c                   endif
172310000124     C* ERRORE
172320000124     C   90              SETON                                        40
172330000124     C   90              GOTO      FOR07
172340060612     C                   ENDIF
172350991217     C**
172360060623     c* se import dpd metto il nuovo numero nel rmn se possibile
172370060623     c                   if        *in79='1' and *in13='0' and
172380060623     c                             wsolo_num=*blanks
172390060623     c                   clear                   vidrmn
172400060623     c                   if        %subst(v7cnpr:14:1) <> *blanks
172410060623     C                   move      VIDNRD        VIDRMN
172420060623     c                   else
172430060623     c                   eval      w012a=%subst(v7cnpr:1:12)
172440060623     c                   move      w012A         vidrmn
172450060623     c                   endif
172460060623     c
172470060623     c                   endif
172480000124     C                   ENDSR
172490000124     C**
172500000124     C* CONTROLLO VALIDITA' PARCEL DPD--------------------------------*
172510000124     C     DPDVAL        BEGSR
172520060613     c                   clear                   wsolo_num         1
172530060612     c                   select
172540060612     c* controllo parcel lungo 14 --> non devono esserci dei blanks
172550060613     c* e ammesso solo a partire da data in tabella "VPO" (per export)
172560060612     c                   when      %subst(wnpr:14:1) <> *blanks
172570070515     c***                if        *in79='0' and §vpodpd > dateu
172580070515     c***                          and vidfbr =' '
172590070515     C***                SETON                                        90
172600070515     C***                MOVEL     ERR(299)      VIDMSG
172610070515     c***                else
172620060612     c                   if        %scan(' ':wnpr) > 0
172630060612     C                   SETON                                        90
172640060612     C                   MOVEL     ERR(299)      VIDMSG
172650060613     c                   endif
172660070515     c****               endif
172670060613     c                   if        *in90='0'
172680060613     c* controllo se parcel lungo 14 contiene solo numeri
172690060619     c                   z-add     1             hh                2 0
172700061031     c                   z-add     0             hy                2 0
172710060613     c     hh            dowle     14
172720061031     c***  wsolo_num     andeq     *blanks
172730060619     c                   if        %subst(wnpr:hh:1) < '0'
172740060613     c                   eval      wsolo_num='N'
172750061031     c                   eval      hy=hh
172760060613     c                   endif
172770060613     c                   add       1             hh
172780060613     c                   enddo
172790061031     c* le lettere possono esserci solo nei primi 4 bytes dal quinto in poi
172800061031     c* devono essere solo numeri
172810061031     c                   if        wsolo_num='N' and hy >4
172820061031     C                   SETON                                        90
172830061031     C                   MOVEL     ERR(299)      VIDMSG
172840061031     c                   endif
172850061031     c
172860060613     c                   endif
172870060612     c* errore se parcel lungo 13
172880060612     c                   when      %subst(wnpr:13:1) <> *blanks
172890060612     C                   SETON                                        90
172900060612     C                   MOVEL     ERR(299)      VIDMSG
172910060612     c                   other
172920060612     c* controllo parcel lungo 12. Deve contenere solo numeri
172930060612     c                   z-add     1             hh
172940060612     c     hh            dowle     12
172950060612     c     *in90         andeq     '0'
172960060619     c                   if        %subst(wnpr:hh:1) < '0'
172970060612     C                   SETON                                        90
172980060612     C                   MOVEL     ERR(299)      VIDMSG
172990060612     c                   endif
173000060612     c                   add       1             hh
173010060612     c                   enddo
173020060612     c                   if        *in90 = '0'
173030060620     C                   movel     WNPR          DPDBRC
173040060619     C                   Z-ADD     DPDCHD        WDPDBR            1 0
173050061012     C                   CLEAR                   DPDCHD
173060000124     C                   EXSR      M1031
173070000124    3C     DPDCHD        IFNE      WDPDBR
173080000124     C                   SETON                                        90
173090060612     C                   MOVEL     ERR(299)      VIDMSG
173100060612    3C                   ENDIF
173110060612     C                   ENDIF
173120060612     c                   endsl
173130061012     c* Siccome i primi byte del numero parcel dpd corrispondono al
173140061012     c* depot dpd viene segnalato errore bloccante se il numero non
173150061012     c* è presente nell'archivio dei depot
173160061106     c                   if        *in90='0' and
173170061106     c                             ((*in79 and *in12='0') or *in79='0')
173180061012     c                   if        %subst(wnpr:14:1) <> *blanks
173190061012     c                   movel     wnpr          wdpc
173200061012     c                   else
173210061012     c                   eval      wdpc='0'+%subst(wnpr:1:3)
173220061012     c                   endif
173230061107     c                   clear                   truldepds
173240061107     c                   movel     wdpc          idepdpc
173250061107     c                   call      'TRULDEPR'
173260061107     c                   parm                    truldepds
173270061107     c                   if        odeperr='1'
173280061012     C                   SETON                                        90
173290061012     C                   MOVEL     ERR(306)      VIDMSG
173300061012     c                   endif
173310061012     c                   endif
173320060612      *se spedizione export devo anche controllare che numero parcel
173330060621      * inizi per '084' altrimenti errore forzabile
173340060626     c                   if        *in79='0' and *in90='0'
173350060621     c                   if        %subst(wnpr:14:1) <> *blanks
173360060621     c                   movel     wnpr          w0003a            3
173370060621     c     w0003a        ifne      '084'
173380060612     c     wnpr          andne     wnprpre
173390060612     C                   SETON                                        90
173400060621     C                   MOVEL     ERR(303)      VIDMSG
173410060612     c                   endif
173420060621     c                   else
173430060621     c                   movel     wnpr          w0020n            2 0
173440060621     c     w0020n        ifne      84
173450060621     c     wnpr          andne     wnprpre
173460060621     C                   SETON                                        90
173470060621     C                   MOVEL     ERR(289)      VIDMSG
173480060621     c                   endif
173490060621     c                   endif
173500060612     c                   move      wnpr          wnprpre
173510060612     c                   endif
173520000124     C                   ENDSR
173530000124      *
173540000124     C* CONTROLLO SE NUMERO PARCEL EXPORT DPD E' DOPPIO--------------*
173550000124     C     DPDDOP        BEGSR
173560070305     c* non eseguo controllo se pgm richiamato da giacenze
173570070305     c                   if        savfpr<>'G' and savfpr<>'P'
173580000124     C* NON DEVE ESSERE GIA' ESISTENTE
173590000124     C                   MOVEL(P)  WNPR          W030A            30
173600060601     c* tologo il check digit per ricercare il parcel number su fiar4
173610060615    1c                   if        %subst(wnpr:14:1) = *blanks
173620060601     c                   eval      %subst(w030a:12:1)= ' '
173630060616    1c                   endif
173640060601     C                   MOVEL     'I'           WTRC
173650060215     C     Kar4F         SETLL     Fiar403l
173660060215     C     WTRC          READE     fiar403l                               30
173670000124    1C     *IN30         DOWEQ     *OFF
173680000124    2C     *IN12         IFEQ      *OFF
173690000124     C     *IN15         OREQ      *ON
173700060215     C     ar4NRS        ORNE      §LPNRS
173710060215     C     ar4AAS        ORNE      §LPAAS
173720060215     C     ar4NSP        ORNE      §LPNSP
173730000124     C*
173740060615     C                   MOVEL     ar4N30        W014a
173750060615     c                   movel     wnpr          wnpr14           14
173760060707    1c                   if        %subst(wnpr:14:1) = *blanks
173770060707     c                   eval      %subst(wnpr14:12:1)= ' '
173780060707    1c                   endif
173790060615    3C     W014a         IFEQ      WNPR14
173800070305     C**   Kar4B         CHAIN(N)  FNBLT01L                           30
173810070305     C**SOLO SE LNA E LNP UGUALE DO ERRORE
173820070305    4C**N30BLTLNA        IFEQ      COMLNA
173830070305     C**   BLTLNP        ANDEQ     VIDLNP
173840000124     C                   MOVEL     ERR(181)      VIDMSG
173850000124     C                   SETON                                        90
173860000124     C                   GOTO      ENDDOP
173870070305    4C**                 ENDIF
173880000124    3C                   ENDIF
173890000124     C**
173900000203     C                   SETOFF                                       30
173910060615    3C     W014a         IFGT      WNPR14
173920000124     C                   SETON                                        30
173930000124    3C                   ENDIF
173940000124    2C                   ENDIF
173950000124     C*
173960060215     C  N30WTRC          READE     Fiar403l                               30
173970000124    1C                   ENDDO
173980070305     c                   endif
173990000124     C     ENDDOP        ENDSR
174000060613     C* CONTROLLO SE NUMERO PARCEL import DPD E' DOPPIO--------------*
174010060613     C     DPDDOP_imp    BEGSR
174020060613     C* NON DEVE ESSERE GIA' ESISTENTE
174030060613     C                   MOVEL(P)  vidnrd        W030A            30
174040060614     c* se immesso numero parcel lungo 12
174050060613     c* tolgo il check digit per ricercare il parcel number su fiar4
174060060614    1c                   if        %subst(vidnrd:14:1) = *blanks
174070060613     c                   eval      %subst(w030a:12:1)= ' '
174080060614    1c                   endif
174090060613     C                   MOVEL     'I'           WTRC
174100060613     C     Kar4F         SETLL     Fiar403l
174110060613     C     WTRC          READE     fiar403l                               30
174120060614    1C     *IN30         DOWEQ     *OFF
174130060613    2C     *IN12         IFEQ      *OFF
174140060613     C     *IN15         OREQ      *ON
174150060613     C     ar4NRS        ORNE      §LPNRS
174160060613     C     ar4AAS        ORNE      §LPAAS
174170060613     C     ar4NSP        ORNE      §LPNSP
174180060613     C*
174190060613     C                   MOVEL     ar4N30        W014a            14
174200060623     c                   movel     w030a         wnpr14           14
174210060613    3C     W014a         ifeq      WNPR14
174220060628     c     ar4lnp        andeq     vidlnp
174230060614     c
174240060613     c                   movel     dsblp0        savblp
174250061212     c     kblp4m        chain     fnblp01l
174260060614    4c                   if        %found(fnblp01l)
174270060614     C                   Z-ADD     BLPMGS        WDSP
174280060614     C                   MOVEL     BLPAAS        WDSP
174290060614    5C     WDSP          IFGE      DPDDSP
174300061012     c     blpcca        andne     '7'
174310060614     C                   MOVEL     ERR(181)      VIDMSG
174320060614     C                   SETON                                        3090
174330060614    5C                   ENDIF
174340060614    4c                   endif
174350060614     C                   MOVEL     SAVBLP        DSBLP0
174360060613    3C                   ENDIF
174370060613    3C     W014a         IFGT      WNPR14
174380060613     C                   SETON                                        30
174390060613    3C                   ENDIF
174400060613    2C                   ENDIF
174410060613     C*
174420060613     C  N30WTRC          READE     Fiar403l                               30
174430060614    1c                   ENDDO
174440060614     c*
174450060614     c
174460060613     C     ENDDOP_imp    ENDSR
174470991012      *
174480991012      *--- CONVERTO IMPORTI VIDEATA FATTURAZIONE NON MODIFICATI ------*
174490991104     C     VARDIV        BEGSR
174500991012      *
174510991012      * CONTROLLO DIVISA
174520991012     C                   CLEAR                   DSLV16
174530991012     C                   CLEAR                   DTASV
174540991012     C                   MOVEL     'D'           D17FIM
174550991014     C     COMDFT        IFGT      *ZEROS
174560991014     C                   Z-ADD     COMDFT        D17DSP
174570991012     C                   ELSE
174580991028     C                   Z-ADD     BLPDSP        D17DSP
174590991012     C                   ENDIF
174600991012     C                   MOVEL     VIDDIV        D17DIV
174610991012      *
174620991012     C                   CALL      'FNLV16R'
174630991012     C                   PARM                    DSLV16
174640991012     C                   PARM                    DTASV
174650991104      *
174660991104     C                   MOVEL     D17DIV        VIDDIV
174670991012      *
174680991012     C     O17ERR        IFEQ      '7'
174690991012     C                   SETON                                        53
174700991028     C                   MOVEL     '1'           WEMFOR
174710991012     C     O17MSG        IFNE      *BLANKS
174720991015     C                   MOVEL     O17MSG        VIDMSG
174730991012     C                   SETON                                        90
174740991012    2C                   ENDIF
174750991012     C                   GOTO      ENDDIV
174760991012    2C                   ENDIF
174770991012      *
174780991012     C                   CLEAR                   WCONVE
174790991012     C                   CLEAR                   DTASV
174800991012      *
174810991012      * PORTO
174820991012     C     VIDPOR        IFGT      *ZEROS
174830991012    3C     VIDPOR        ANDEQ     MEMPOR
174840991012     C                   CLEAR                   DSYEUR
174850991012     C                   MOVEL     WDIV1         YECDVI
174860991012     C                   Z-ADD     VIDPOR        YECIMI
174870991012     C                   MOVEL     VIDDIV        YECDVO
174880991012     C     O17FDC        IFEQ      'S'
174890991012     C                   MOVEL     '3'           YECDCO
174900991012     C                   ENDIF
174910991012     C                   CALL      'YEURCO'
174920991012     C                   PARM                    DSYEUR
174930991028    4C     YECESI        IFEQ      ' '
174940991012     C                   Z-ADD     YECIMO        VIDPOR
174950991015     C                   MOVEL     'S'           WCONVE            1
174960991028    4C                   ENDIF
174970991028    3C                   ENDIF
174980991012      *
174990991012      * VARIE
175000991012     C                   DO        20            NRR
175010991012     C     NRR           CHAIN     LS01S03                            30
175020991012     C     V3CVA1        IFGT      *ZEROS
175030991012    3C     V3CVA1        ANDEQ     V3HVA1
175040991012     C                   CLEAR                   DSYEUR
175050991012     C                   MOVEL     WDIV1         YECDVI
175060991012     C                   Z-ADD     V3CVA1        YECIMI
175070991012     C                   MOVEL     VIDDIV        YECDVO
175080991012     C     O17FDC        IFEQ      'S'
175090991012     C                   MOVEL     '3'           YECDCO
175100991012     C                   ENDIF
175110991012     C                   CALL      'YEURCO'
175120991012     C                   PARM                    DSYEUR
175130991028    4C     YECESI        IFEQ      ' '
175140991012     C                   Z-ADD     YECIMO        V3CVA1
175150991012     C                   Z-ADD     YECIMO        V3HVA1
175160991019     C                   UPDATE    LS01S03
175170991012     C                   MOVEL     'S'           WCONVE
175180991028    4C                   ENDIF
175190991028    3C                   ENDIF
175200991012     C                   Z-ADD     NRR           C
175210991012      * CARICO SCHIERA VARIE X RICALCOLO TOT FATTURA
175220991012     C     VIDIMV        IFGT      *ZEROS
175230991012     C                   MOVEL     V3CSV1        VSV(C)
175240991012     C                   Z-ADD     V3CVA1        VVA(C)
175250991015     C                   MOVEL     V3CEV1        VES(C)
175260991012     C                   ENDIF
175270991012     C                   ENDDO
175280991012      *
175290991012      * SE CONVERTITI IMPORTI ED è IMPOSTATO IL TOTALE FATTURA LO RICALCOLO
175300991012     C     WCONVE        IFEQ      'S'
175310991028     C                   MOVEL     '1'           WEMFOR
175320991028     C     VIDIMV        IFGT      *ZEROS
175330991012     C                   CLEAR                   DSLV16
175340991012     C                   MOVEL     'T'           D17FIM
175350991012     C                   Z-ADD     VIDPOR        D17POR
175360991012     C                   CALL      'FNLV16R'
175370991012     C                   PARM                    DSLV16
175380991012     C                   PARM                    DTASV
175390991012     C                   ENDIF
175400991028     C                   ENDIF
175410991012      *
175420991012     C     O17ERR        IFEQ      *BLANKS
175430991012     C                   Z-ADD     O17IMV        VIDIMV
175440991012     C                   ELSE
175450991012     C                   CLEAR                   VIDIMV
175460991012     C                   ENDIF
175470991012      *
175480991012     C                   MOVEL     VIDDIV        WDIV1
175490991012     C                   Z-ADD     VIDPOR        MEMPOR
175500991012      *
175510991012     C     ENDDIV        ENDSR
175520991012      *
175530930331     C*--- CALCOLO IL VOLUME -----------------------------------------*
175540930331     C     CALVOL        BEGSR
175550930331     C                   MLLZO     1             VIDNCL
175560930331     C                   MLLZO     1             VIDVOL
175570940825     C                   MLLZO     1             V2CPKG
175580930331     C*
175590930401     C                   Z-ADD     0             VARVOL
175600941230     C* SE DA DISK CLIENTI E' PASSATO IL VOLUME E NON E' STATO VARIATO
175610941230     C* PRENDO IL FLG VOLUME PASSATO SE C'E'
175620941230     C   12
175630941230    1CAN 15VIDVOL        IFNE      0
175640941230     C                   MOVEL     VIDVOL        VARVOL
175650941230     C*
175660941230     C     VIDVOL        IFEQ      §LPVLB
175670941230     C                   MOVEL     §LPFVB        VIDFVR
175680941230     C                   ELSE
175690941230     C                   MOVEL     'R'           VIDFVR
175700941230    1C                   END
175710941230    1C                   END
175720930331     C*
175730941230    1C  N12VIDVOL        IFNE      0
175740930331     C                   MOVEL     'R'           VIDFVR
175750930401     C                   MOVEL     VIDVOL        VARVOL
175760941108    1C                   END
175770930331     C*
175780941108     C   12
175790941108    1CANN15VIDVOL        IFNE      BLPVLB
175800941108    2C     VIDVOL        IFNE      0
175810930401     C                   MOVEL     VIDVOL        VARVOL
175820930331     C                   MOVEL     'R'           VIDFVR
175830941108    2C                   END
175840930331     C*
175850941108   X1C                   ELSE
175860930331     C*
175870941107     C* IN MANUTENZIONE SE NON E' GIA' VOLUME REALE, RICALCOLO
175880941108    2C     §7TRVL        IFEQ      'R'
175890941107     C                   MOVEL     VIDVOL        VARVOL
175900941108    2C                   END
175910941108    1C                   END
175920930331     C*
175930930331     C*  CALCOLO VOLUME AUTOMATICO SE A ZEROS
175940940923    1C     VARVOL        IFEQ      0
175950941025     C                   CLEAR                   DSLV18
175960941025     C                   MOVEL     §3ATB1        D18TBL
175970941025     C                   MOVEL     'P'           D18TBO
175980941025     C                   MOVEL     BLPDSP        D18AAS
175990941025     C                   MOVE      BLPDSP        D18MGS
176000941108     C                   MOVEL     V2CPKG        D18PKF
176010941025     C                   MOVEL     VIDNCL        D18NCL
176020050415     c* se previsti bancali passo il numero colli originali
176030050415     c                   if        %subst(vidgva:1:1)='O'
176040050415     c                   z-add     w03cor        d18ncl
176050050415     c                   endif
176060940923     C* SE NON C'E' TARIFFA CLIENTE USO TARIFFA CARTELLO
176070941108    2C     WTKS          IFEQ      ' '
176080160219     c                   clear                   trulc7ds
176090160224     c                   select
176100160224     c                   when      o27ntw='DPD'
176110160224     c                   eval      IC7tFIE = 'D'
176120160224     c                   when      o27ntw='FED'
176130160224     c                   eval      IC7tFIE = 'F'
176140160224     c                   when      o27ntw='EEX'
176150160224     c                   eval      IC7tFIE = 'E'
176160160224     c                   other
176170160224     c                   eval      IC7tFIE = 'I'
176180160224     c                   endsl
176190160219     c                   eval      IC7DTA  =  blpdsp
176200160219     c                   eval      IC7PKG  =  vidpkg
176210160219     c                   eval      IC7tip  =  i27tip
176220160219     c                   call      'TRULC7R'
176230160219     c                   parm                    trulc7ds
176240160219     C                   MOVEL     oc7KSCc       D18KSC
176250160219     C                   MOVEL     oc7PRGc       D18PRG
176260160219     C                   MOVEL     oc7CTRc       D18CTR
176270941025     C                   ELSE
176280941025     C                   MOVEL     WKSC          D18KSC
176290941025     C                   MOVEL     COMPRG        D18PRG
176300941025     C                   MOVEL     COMCTR        D18CTR
176310940923    2C                   ENDIF
176320020311     c     vidtsp        ifne      *blanks
176330020311     c                   movel     vidtsp        d18tsp
176340020311     c                   else
176350020311     c                   movel     comtsp        d18tsp
176360020311     c                   endif
176370020311     c     comlna        ifgt      *zeros
176380020311     c                   z-add     comlna        d18lna
176390020311     c                   else
176400020311     c                   movel     i27tln        d18tln
176410020311     c                   endif
176420020311     c                   z-add     vidlnp        d18lnp
176430020311     c
176440941025     C*
176450941025     C                   CALL      'FNLV18R'
176460941025     C                   PARM                    DSLV18
176470941025     C*
176480941108     C                   MOVEL     D18FVF        VIDFVR
176490941108     C                   MOVEL     D18VLF        VARVOL
176500930331     C                   END
176510941025     C*
176520941025     C* SE  VOLUME=0 IMPOSTO 0,001
176530930401     C     VARVOL        IFEQ      0
176540941024     C                   Z-ADD     0,001         VARVOL
176550930331     C                   END
176560930331     C                   ENDSR
176570940628     C*
176580940628     C* CALCOLO IL FLAG INOLTRO --------------------------------------*
176590940628     C     INOLTR        BEGSR
176600940628     C                   MOVEL     VIDFIN        WFIN
176610940628     C*
176620940628     C*   SE FERMO DEPOSITO E' SEMPRE ' '
176630940628    1C     VIDFFD        IFEQ      'S'
176640941110     C                   MOVEL     'C'           WFIN
176650940628     C*
176660940628   X1C                   ELSE
176670940628     C*
176680940628     C* CALCOLO  SE NON C'E' FORZATURA
176690940926    2C     WFIN          IFEQ      ' '
176700940919     C                   MOVEL     COMFIN        WFIN
176710940926    2C                   ENDIF
176720940926    1C                   ENDIF
176730940628     C                   ENDSR
176740000627     C*
176750000627     C* ASSEGNO NUMERO DI SEGNACOLLI ALLA BOLLA ----------------------*
176760000627     C     ASSSGN        BEGSR
176770000627     C* IN MANUTENZIONE  SE NUMERO COLLI < DIMINUISCO IL DAL
176780000627     C*  SE > RIASSEGNO I NUMERI
176790000627     C   12
176800000627     CANN15
176810000627    2CAN 25              DO
176820050428    3C     VIDNCL        IFLT      SAVNCL
176830000627     C     SAVNCL        SUB       VIDNCL        DIF               5 0
176840000627     C                   SUB       DIF           VIDNCA
176850000627     C* SE COLLO 1 AZZERO SEGNACOLLO AL
176860000627    4C     VIDNCA        IFEQ      VIDNCD
176870000627     C                   Z-ADD     0             VIDNCA
176880000627    4C                   END
176890000627    3C                   END
176900000627     C*
176910000627    3C     VIDNCL        IFGT      SAVNCL
176920000627    3C     SAVLNA        ORNE      VIDLNA
176930111026     c* Routine di memorizzazione vecchi segnacolli per scrittura R.A. prima
176940111026     c* di pulire VIDNCD e VIDNCA
176950111026     c                   exsr      sr_memRA
176960000627     C                   CLEAR                   VIDNCD
176970000627     C                   CLEAR                   VIDNCA
176980000627    3C                   END
176990000627    2C                   END
177000000627     C*
177010000627     C* SE SEGNACOLLI IMMESSI LI MEMORIZZO
177020000627     C*  SE DEVO STAMPARE SEGNACOLLO LI CALCOLO
177030000627    2C     VIDNCD        IFGT      0
177040000627     C                   MOVEL     VIDNCD        BLPNCD
177050000627     C                   MOVEL     VIDNCA        BLPNCA
177060000627   X2C                   ELSE
177070000627     C                   Z-ADD     0             BLPNCD
177080000627     C                   Z-ADD     0             BLPNCA
177090000627     C* PER CREAZIONE SEGNACOLLO
177100000627    3C     §1BFG8        IFEQ      'S'
177110000627    4C   25              DO
177120000627     C                   CLEAR                   AAS
177130000627     C                   Z-ADD     9             CNU
177140000627     C                   Z-ADD     VIDLNP        COMLIN
177150000627     C                   Z-ADD     COMLNA        LIV2
177160000627     C     KNUF2         CHAIN     FLNUF                              3031
177170000627     C*
177180000627     C   30              Z-ADD     0             BLPNCD
177190000627     C   30              Z-ADD     0             BLPNCA
177200000627     C*
177210000627     C     *IN31         IFEQ      *ON
177220000627     C                   SETON                                        90
177230000627     C                   MOVEL     ERR(42)       VIDMSG
177240000627     C                   MOVEL     '1'           WEMFOR
177250000627     C                   GOTO      ENDASS
177260000627     C                   ENDIF
177270000627     C*
177280000627    5C     *IN30         DOWEQ     *OFF
177290000627     C     NUFNUM        ADD       VIDNCL        BLPNCA
177300000627     C* SE SUPERO IL RANGE FINALE RICOMINCIO DA QUELLO INIZIALE
177310000627    6C     BLPNCA        IFGT      NUFRFI
177320000627     C                   Z-ADD     NUFRIN        NUFNUM
177330000627    6C                   END
177340000627     C*
177350000627     C     NUFNUM        ADD       1             COMSCD
177360000627     C     VIDNCL        ADD       NUFNUM        BLPNCA
177370000627     C*
177380000627     C* CONTROLLO SE ESISTONO GIA' SEGNACOLLI IN QUEL RANGE
177390000627     C*
177400000627    6C     COMSCD        DOWLE     BLPNCA
177410000627     C     COMSCD        ANDGT     0
177420120816     C***  KBLT          CHAIN     FNBLT27L                           30
177430120816     C***                if        not %found(fnblt27l)
177440120816     C     KBLT          CHAIN     FIART27L                           30
177450120816     C                   if        not %found(fIART27l)
177460080925     C     KBLT          CHAIN(N)  fiars01l                           30
177470120817     C**                 if        not %found(fiars01l)
177480120817     C**   KBLT          CHAIN     fnart27l                           30
177490120817     c**                 endif
177500080925     c                   endif
177510000627     C  N30              Z-ADD     COMSCD        NUFNUM
177520000627     C  N30              Z-ADD     BLPNCA        COMSCD
177530000627     C                   ADD       1             COMSCD
177540000627    6C                   END
177550000627     C*
177560000627     C   30NUFNUM        ADD       1             BLPNCD
177570000627     C   30              Z-ADD     BLPNCA        NUFNUM
177580000627     C   30              UPDATE    FLNUF
177590000627    5C                   END
177600000627     C*
177610000627     C* SE AL = DAL AZZERO IL CAMPO
177620000627    5C     BLPNCA        IFEQ      BLPNCD
177630000627     C                   Z-ADD     0             BLPNCA
177640000627    5C                   END
177650000627    4C                   END
177660000627     C*
177670000627   X3C                   ELSE
177680000627     C*
177690000627     C* PER BOLLE SENZA SEGNACOLLI
177700000627     C                   CLEAR                   BLPNCD
177710000627     C                   CLEAR                   BLPNCA
177720000627     C                   CLEAR                   BLPFLS
177730000627     C*
177740000627    3C                   END
177750000627    2C                   END
177760000627     C*
177770000627     C     ENDASS        ENDSR
177780000627     C*
177790000627     C* VEDO COME AGGIORNARE IL CAMPO AGGFST -------------------------*
177800000627     C     AGGFST        BEGSR
177810000627     C* ALLEGA BAM
177820000627     C** PER DISK CLIENTI VEDO SE DEVO STAMPARE LA BOLLA
177830000627     C                   EXSR      CTRSTA
177840000627     C**
177850000627     C*  S I    D D T
177860000627     C**
177870000627    1C     VIDBAM        IFEQ      'S'
177880000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
177890000627    2C     §1BFG3        IFEQ      'S'
177900000627     C                   MOVEL     'C'           BLPFST
177910000627     C                   ELSE
177920000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
177930000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
177940000627     C                   MOVEL     'S'           BLPFST
177950000627    2C                   ENDIF
177960000627     C*
177970000627   X1C                   ELSE
177980000627     C**
177990000627     C*  N O    D D T
178000000627     C**
178010000627     C                   SELECT
178020000627     C* IL CLIENTE STAMPA LA NOSTRA LETTERA DI VETTURA
178030000627    2C     §1BFG3        WHENEQ    'S'
178040000627     C                   MOVEL     'K'           BLPFST
178050000627     C* IL CLIENTE NON STAMPA LA NOSTRA LETTERA DI VETTURA :
178060000627     C*  STAMPATE AL TERMINE DELLA REGISTRAZIONE IN BLP
178070000627    2C     §3ATB1        WHENEQ    'A3'
178080000627     C     WSTA          OREQ      ' '
178090000627     C     WSTA          OREQ      'S'
178100000627     C* SE BOLLA F3 FACCIO FINA CHE SIA STAMPATO MA IN REALTA' NON
178110000627     C*  LA STAMPO NEMMENO IN DIFFERITA PERCHE' NON SERVE
178120000627    2C     §3ATB1        OREQ      'F3'
178130000627     C                   MOVEL     'Y'           BLPFST
178140000627     C*
178150000627     C* SE E' BOLLA DPD IMPOSTO FLAG DI GIA' STAMPATO
178160140612     C***  A_§OGNTW      WHENEQ    'DPD'
178170000627     C* EXPORT NON DPD, GIA' STAMPATO
178180140612     c***  A_§ogntw      oreq      'EEX'
178190140612     c***  A_§ogntw      oreq      'EUP'
178200140612     c***  A_§ogntw      oreq      'FED'
178210000627     C* POSTE , GIA' STAMPATO
178220140612     c***  §ogntw        oreq      'PPT'
178230140612     c***  blpdsp        andlt     §vpoptl
178240140612     c                   when      A_§OGNTW='DPD'
178250160304     c****                         or (A_§ogntw='EEX'
178260160304     c****                         and (%lookup('999':sk_VPODIR)=0 and
178270160304     c****                             %lookup(%editc(blplnp:'X'):sk_VPODIR)=0))
178280000627     C                   MOVEL     'Y'           BLPFST
178290000627   X2C                   OTHER
178300000627     C*
178310000627     C* SE SONO IN VARIAZIONE BOLLA E NON HO MODIFICATO IL FLAG DDT
178320000627     C*  LASCIO QUELLO CHE C'ERA
178330000627     C                   MOVEL     'N'           BLPFST
178340000627    3C     *IN12         IFEQ      *ON
178350000627     C     *IN15         ANDEQ     *OFF
178360000627     C*
178370000627    4C     SAVBAM        IFEQ      'Y'
178380000627     C                   MOVEL     'Y'           BLPFST
178390000627    4C                   ENDIF
178400000627     C* SE ERA DPD E NON LO E' PIU', DEVO METTERE "N" PER FAR
178410000627     C*  STAMPARE LA BOLLA
178420020319    4C     SAVNTW        IFEQ      'DPD'
178430020319     C     A_§OGNTW      ANDNE     'DPD'
178440000627     C                   MOVEL     'N'           BLPFST
178450000627    4C                   ENDIF
178460000627     C* IN MANUTENZIONE DI UN PREPAGATO, IMPOSTO SEMPRE PER DDT NO,
178470000627     C*  DA STAMPARE
178480000627    4C     *IN22         IFEQ      *ON
178490000627     C                   MOVEL     'N'           BLPFST
178500000627    4C                   ENDIF
178510000627    3C                   ENDIF
178520000627     C**
178530000627    2C                   ENDSL
178540000627    1C                   ENDIF
178550000627     C                   ENDSR
178560900504     C*
178570900504     C*--- REGISTRAZIONE BOLLA ---------------------------------------*
178580090623     c     REGIS         begsr
178590940928     C* DPO LA PRIMA BOLLA MI POSIZIONO SEMPRE SUL MITTENTE
178600010222     C* SE ATTIVATA PROCEDURA ORM E SONO IN IMMISSIONE O MANUTENZIONE
178610010306     C* E NON SONO NEL GIRO DEI PREPAGATI MI POSIZIONO SEMPRE SUL N.ORM
178620010222     C     WORM          IFEQ      'S'
178630010222     C     PARTCH        ANDNE     'P'
178640010307     C     §LPFPR        ANDNE     'O'
178650010222     C     *IN12         ANDEQ     *OFF
178660010222     C     WORM          OREQ      'S'
178670010222     C     PARTCH        ANDNE     'P'
178680010307     C     §LPFPR        ANDNE     'O'
178690010222     C     *IN15         ANDEQ     *OFF
178700010222     C                   SETON                                        06
178710010222     C                   ELSE
178720940928     C                   SETON                                        07
178730010222     C                   ENDIF
178740010222     C*
178750950123     C                   CLEAR                   WRD2
178760900507     C* AZZERO CAMPI COMODO
178770940214     C                   CLEAR                   SAVFST
178780991014     C                   CLEAR                   DSLV04
178790991027     C                   CLEAR                   WSV1
178800991027     C                   CLEAR                   WVA1
178810991027     C                   CLEAR                   WSV2
178820991027     C                   CLEAR                   WVA2
178830991027     C                   CLEAR                   WSV3
178840991027     C                   CLEAR                   WVA3
178850001019     C                   CLEAR                   WSTSGN
178860070604     c                   clear                   wmsg_pda          1
178870070606     c                   clear                   w02pdr_p
178880111026     c                   clear                   RA_ncd
178890111026     c                   clear                   RA_nca
178900111026     c                   clear                   RA_ncl
178910111026     c                   clear                   RA_lna
178920941108     C*
178930930331     C*  VALORE POSITIVO DEI CAMPI NUMERI A VIDEO
178940920505     C                   MLLZO     1             VIDPOR
178950940926     C                   MLLZO     1             VIDNFT
178960940926     C                   MLLZO     1             VIDFIV
178970940926     C                   MLLZO     1             VIDRMN
178980940926     C                   MLLZO     1             VIDCAS
178990940825     C                   MLLZO     1             VIDIAS
179000940926     C                   MLLZO     1             VIDQFT
179010920505     C                   MLLZO     1             VIDNCD
179020920505     C                   MLLZO     1             VIDNCA
179030920505     C                   MLLZO     1             VIDHCR
179040940926     C                   MLLZO     1             VI2VA1
179050040116     c                   Mllzo     1             Vi2Va2
179060040116     c                   Mllzo     1             Vi2Va3
179070040116     c                   Mllzo     1             Vi2Va4
179080041217     c                   Mllzo     1             Vi2Va5
179090041217     c                   Mllzo     1             Vi2Va6
179100021218     c                   Mllzo     1             VidNba
179110021218     c                   Mllzo     1             VidNb2
179120060209     c* Le seguenti specifiche le ho spostate più sotto per permettere
179130060209     c* la storicizzazione delle variazioni dei prepagati, non potendo
179140060209     c* storicizzare ora dal momento che ci possono essere dei casi
179150060209     c* di uscita dalla routine senza registrare la bolla (v. goto
179160060209     c* endreg)
179170991006      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
179180991006      * IN FIAR700F
179190060209     C**   WAR7          IFEQ      'E'
179200060209     c**   war61         oreq      'E'
179210060209     c**   wkscsf1       andne     0000
179220060209     c**   wkscsf1       andne     9999
179230060209     C**                 MOVEL     '1'           WTRC
179240060209     C**   KBLP4         SETLL     FIAR7000
179250060209     C**   KBLP4         READE     FIAR7000                               30
179260991006      *
179270060209    2C**   *IN30         DOWEQ     *OFF
179280060209     C**                 DELETE    FIAR7000
179290060209     C**   KBLP4         READE     FIAR7000                               30
179300060209    2C**                 ENDDO
179310991006      *
179320060209     C**                 ENDIF
179330040116      * anche per la seconda bolla
179340060209if  1c****               If        War71 = 'E' or (war62 = 'E' and
179350060209     c****                         wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
179360060209     c****               Eval      Wtrc = '2'
179370060209     c**** Kblp4         Setll     Fiar7000
179380060209do  2c****               Do        *Hival
179390060209     c**** Kblp4         Reade     Fiar7000
179400060209     c****               If        %Eof(Fiar701l)
179410060209     c****               Leave
179420060209     c****               EndIf
179430060209     c****               Delete    Fiar7000
179440060209    2c****               EndDo
179450060209    1c****               EndIf
179460941115     C* PULISCO I FORMATI
179470060209     C***                CLEAR                   FIAR6000
179480060209     C***                CLEAR                   FIAR7000
179490051115     C                   CLEAR                   Fiar9000
179500900507     C*
179510900504     C                   Z-ADD     VIDLNP        BLPLNP
179520900504     C                   MOVEL     BLPDSP        BLPAAS
179530900504     C                   MOVE      VIDNRS        BLPNRS
179540940926     C                   MOVE      BLPDSP        BLPMGS
179550940926     C                   MOVEL     VIDCBO        BLPCBO
179560920410     C*
179570920410     C* DISK CLI: SE NON SI ASSEGNA NUMERAZ. SEGNAC. AZZERO SERIE
179580930628     C   12
179590930628    1CAN 15§1BFG2        IFEQ      'N'
179600980410     C     §1BFG6        ANDNE     'C'
179610910606     C                   Z-ADD     0             BLPNRS
179620950525     C* SE IL CTM ERA "%" --> IMPOSTO "§"
179630000214    2C     VIDSOP        IFEQ      '%'
179640950525     C                   MOVEL     '§'           VIDSOP
179650000214     C* SE E' DISK "C"    --> IMPOSTO ":"
179660050223     C     *IN79         IFEQ      *ON
179670050223    3C     WASDKC        ANDEQ     'S'
179680050223     C     §3CDKC        ANDEQ     'S'
179690000905     C     §1BF12        ORNE      'N'
179700001106     C     §1BF12        ANDNE     'E'
179710001106     C     §1BF12        OREQ      'E'
179720001106     C     WASDKC        ANDEQ     'S'
179730000214     C                   MOVEL     ':'           VIDSOP
179740000214    3C                   ENDIF
179750000214    2C                   ENDIF
179760950525    1C                   ENDIF
179770001013     C* SE VENGO DA CONFERMA DA DISCHETTO E NON È DISK B METTO SOP=: SE
179780001013     C* E' DISK C
179790001013     C   12
179800001013     CAN 15§1BFG1        IFNE      'S'
179810001013     C     WASDKC        ANDEQ     'S'
179820001013     C     §1BF12        ANDNE     'N'
179830001013     C                   MOVEL     ':'           VIDSOP
179840001013     C                   ENDIF
179850930624     C***
179860930624     C***   N U M E R O   S P E D I Z I O N E
179870920415     C                   SETOFF                                       30
179880921012     C* IN IMMISSIONE : SE NON E' BOLLA DI RECUPERO
179890990602    1C  N12PARTCH        IFEQ      'R'
179900921006     C                   Z-ADD     RECNSP        BLPNSP
179910930628   X1C                   ELSE
179920921006     C                   SETON                                        30
179930930628    1C                   END
179940921012     C*
179950921005     C* IN DISK CLI :  SE NON SI STAMPA LA BOLLA
179960921012     C*                O NON E' BOLLA DI RECUPERO
179970921012     C*                O NON MANTIENE NUM SPEDIZIONE
179980930628     C   12
179990930628    1CAN 15§1BFG3        IFNE      'S'
180000921005     C*
180010930628    2C     §3CFSP        IFEQ      'S'
180020921012     C     §1BFG2        ANDEQ     'S'
180030921012     C     §LPFPR        OREQ      'R'
180040971104     C**
180050971104    3C     VIDNSP        IFGT      0
180060921005     C                   Z-ADD     VIDNSP        BLPNSP
180070971104   X3C                   ELSE
180080971104     C** SE MANCA LO RIASSEGNO
180090971104     C** SE L'HO AZZERATO IN CARICAMENTO LO RIPRENDO DA DS
180100971104    4C     §LPNSP        IFGT      0
180110971104     C                   Z-ADD     §LPNSP        BLPNSP
180120971104     C                   ELSE
180130971104     C                   SETON                                        30
180140971104    4C                   ENDIF
180150971104    3C                   ENDIF
180160971104     C***
180170971104    3C     VIDNRS        IFEQ      0
180180971104     C                   Z-ADD     §LPNRS        BLPNRS
180190971104    3C                   ENDIF
180200971104     C**
180210930628   X2C                   ELSE
180220920415     C                   SETON                                        30
180230930628    2C                   END
180240921005     C*
180250930628   X1C                   ELSE
180260921005     C*
180270920421     C                   Z-ADD     VIDNSP        BLPNSP
180280930628    1C                   END
180290920415     C*
180300930628    1C     *IN30         IFEQ      *ON
180310951228     C                   MOVE      VIDDSP        AAS
180320910117     C                   Z-ADD     3             CNU
180330910117     C                   Z-ADD     VIDLNP        COMLIN
180340000509     C                   CLEAR                   WNUF2
180350000509     C* SE LNP POSTE METTO ANCHE LA SERIE ON CHIAVE
180360020319     C     §ogntw        IFEQ      'PPT'
180370000509     C                   Z-ADD     VIDNRS        WNUF2
180380000509     C                   ENDIF
180390921006     C* CHAIN FINO A QUANDO NON TROVO UN NUMERO LIBERO
180400930628    2C     *IN30         DOWEQ     '1'
180410000509     C     KNUFSP        CHAIN     FLNUF                              3031
180420951228     C* SE NON TROVATO IL NUMERATORE PROVO A CREARLO
180430000627     C*  NON LO FACCIO PER POSTE
180440020319     C     §ogntw        IFNE      'PPT'
180450000627     C     *IN30         ANDEQ     *ON
180460951228     C                   Z-ADD     CNU           PA4CNU
180470951228     C                   CALL      'FNLVCNR'
180480951228     C                   PARM                    PA4CNU
180490000509     C     KNUFSP        CHAIN     FLNUF                              3031
180500951228     C                   ENDIF
180510951228     C*
180520951228     C* SE ANCORA NON TROVATO ERRORE
180530940923     C   30              SETON                                        90
180540940923     C   30              MOVEL     ERR(39)       VIDMSG
180550020320     C* RECORD ALLOCATO
180560940923     C   31              SETON                                        90
180570940923     C   31              MOVEL     ERR(42)       VIDMSG
180580951228     C* PER ERRORE ESCO
180590950508     C   90              MOVEL     '1'           WEMFOR
180600921006     C   90              GOTO      ENDREG
180610921006     C*
180620900824     C                   ADD       1             NUFNUM
180630900824     C                   UPDATE    FLNUF
180640921006     C                   Z-ADD     NUFNUM        RECNSP
180650921006     C*
180660921006     C* 30 ON - SPED ESISTENTE FACCIO NUOVA CHAIN
180670940915     C     KNSP          SETLL     FNBLP01L                               30
180680040329      * devo controllare anche su titas che non ci sia già
180690040329      * una spedizione con lo stesso numero
180700040329     c                   If        Not *In30 and %Open(Titas30c)
180710040329     c     kNsp          Chain(n)  Titas30c
180720040329     c                   If        %Found(Titas30c)
180730040329     c                   Eval      *In30 = *On
180740040329     c                   EndIf
180750040329     c                   EndIf
180760040329
180770921006     C  N30              MOVEL     NUFNUM        BLPNSP
180780930628    2C                   ENDDO
180790040727   x1c                   Else
180800040727      * se bolla già presente su TITAS emetto errore bloccante
180810040727     c                   If        %Open(Titas30c)
180820040727     c                   Eval      recnsp = BlpNsp
180830040727     c     kNsp          Chain(n)  Titas30c
180840040727     c                   If        %Found(Titas30c)
180850040727     c                   Eval      VidMsg = Err(55)
180860040727     c                   Eval      *In90 = *On
180870040727     c                   Eval      wemfor = '1'
180880040727     c                   Goto      EndReg
180890040727     c                   EndIf
180900040727     c                   EndIf
180910930628    1C                   ENDIF
180920920410     C*
180930900827     C   12
180940900827     CANN15              MOVEL     VIDNSP        BLPNSP
180950940926     C*
180960940926     C* MEMORIZZO I CAMPI IMPOSTATI A VIDEO: SE BOLLA CON MAMMA
180970940926     C*  NON LI MEMORIZZO MA STAMPO SOLTANTO
180980051115     C                   MOVEL     VIDCAS        ar9CAS
180990011108     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO CONTRASSEGNO > 0
181000011108     C     VIDCAS        IFGT      *ZEROS
181010051115     C                   MOVEL     VIDVCA        ar9VCA
181020011113     C                   ELSE
181030051115     C                   CLEAR                   ar9VCA
181040011108     C                   ENDIF
181050050518     c* Se = *blanks, e forzabile da tabella TM --> forzo
181060051115     C                   MOVEL     VIDTIC        ar9TIC
181070091001     c                   clear                   w_ar5tic
181080111213     c                   if        vidcas>0
181090121022     c* per spedizioni export non valgono le seguenti forzature ma
181100121022     c* pilotano i tipi incasso abilitati come da tabella "1AX"
181110121022     c                             and a_§ogntw<>'DPD'
181120121022     c                             and a_§ogntw<>'EEX'
181130121022     c                             and a_§ogntw<>'FED'
181140071011     c                   select
181150071011     c                   when      vidtic=*blanks and §TMFTI<>*BLANKS
181160051115     C                   MOVEL     §TMfti        ar9tic
181170080625     C                   MOVEL     §TMfti        vidtic
181180090706     c* frozatura per destinatario particolare
181190111213     c                   when      vidtic=*blanks and
181200091002     c                             ot0err=*blanks and OT0X1TICF<>*blanks
181210090706     C                   MOVEL     OT0X1TICF     ar9tic
181220090706     C                   MOVEL     OT0X1TICF     vidtic
181230091001     c                   movel     ot0x1ticf     w_ar5tic
181240111213     c                   when      vidtic=*blanks
181250071008     c* Se = *blanks, e forzabile da tabella FSC --> forzo
181260090619     c* Se cliente abilitato da tabella CIC non devo forzare
181270090619     C                   CLEAR                   dsbs02
181280090619     C                   MOVEL     'C'           T02MOD
181290090619     C                   MOVEL     KNSIF         T02SIF
181300090619     C                   MOVEL     'CIC'         T02COD
181310090619     c                   if        vidflc=0
181320090622     c                   eval      t02ke1=%editc(vidlnp:'X')+%editc(vidccm:'X')
181330090619     c                   else
181340090619     c                   eval      t02ke1=%editc(vidflc:'X')+%editc(vidccm:'X')
181350090619     c                   endif
181360090619     C                   CALL      'TIBS02R'
181370090619     C                   PARM                    KPJBA
181380090619     C                   PARM                    dsbs02
181390090619      * Cliente non presente in tabella "CIC"
181400090619     c                   if        t02err<>*blanks
181410071008     C                   CLEAR                   dsbs02
181420071008     C                   MOVEL     'C'           T02MOD
181430071008     C                   MOVEL     KNSIF         T02SIF
181440071008     C                   MOVEL     'FSC'         T02COD
181450071008     c                   movel(P)  comlna        t02ke1
181460071008     C                   CALL      'TIBS02R'
181470071008     C                   PARM                    KPJBA
181480071008     C                   PARM                    dsbs02
181490071008    2C                   IF        T02ERR = *BLANKS and t02atb=*blanks
181500071008     C                   movel     'SC'          ar9tic
181510080625     C                   movel     'SC'          vidtic
181520071008    2C                   ENDIF
181530090619     c                   endif
181540071011     c                   endsl
181550111213     c                   endif
181560050518     c
181570941005     C***
181580941005     C***   N U M E R O   S E G N A C O L L I
181590941005     C                   MOVEL     WFLS          BLPFLS
181600971211     C                   MOVEL     COMLNA        VIDLNA
181610940926     C*
181620940926     C* MEMORIZZO SEGNACOLLI SE BOLLA SENZA MAMMA
181630940926    1C     §3ABCM        IFEQ      ' '
181640000627     C* ASSEGNO NUMERO DI SEGNACOLLI
181650000627     C                   EXSR      ASSSGN
181660000627     C     WEMFOR        IFEQ      '1'
181670000627     C                   GOTO      ENDREG
181680000627     C                   ENDIF
181690940926     C*
181700940926   X1C                   ELSE
181710940926     C* BOLLA CON MAMMA
181720950215     C                   CLEAR                   BLPFLS
181730940926     C                   CLEAR                   BLPNCD
181740940926     C                   CLEAR                   BLPNCA
181750051115     C                   CLEAR                   ar9TIC
181760051115     C                   CLEAR                   ar9CAS
181770051115     C                   CLEAR                   ar9VCA
181780940926    1C                   ENDIF
181790020320     c* Se bolla Export FedEx prelevo numeri AWB
181800020320     c     A_§ogntw      ifeq      'FED'
181810020320     c                   clear                   wawbini
181820020320     c* devo assegnare numeri awb fedex in immissione o conferma bolle
181830020320     c* SEMPRE oppure in manutenzione se è aumentato il numero dei colli
181840020320     c* oppure se è cambiata la linea di arrivo e la precedente era una
181850020320     c* linea non fedex
181860020320     c     *in12         ifeq      *off
181870020320     c     *in15         oreq      *on
181880020320     c     *in15         oreq      *off
181890020320     C     vidncl        andgt     savncl
181900020320     c     *in15         oreq      *off
181910020320     C     savntw        andne     'FED'
181920020320     c                   clear                   trul33ds
181930020320     c                   z-add     21            i33cnu
181940020320     c                   z-add     vidncl        i33num
181950020320     c                   movel     trul33ds      kpjbu
181960020320     c                   call      'TRUL33R'
181970020320     c                   PARM                    kpjba
181980020320     c                   movel     kpjbu         trul33ds
181990020320     c* se errore vado a fine routine
182000020320     c     o33err        ifgt      *zeros
182010020320     c                   seton                                        90
182020020320     c                   movel     '1'           wemfor
182030020320     c                   select
182040020320     c     o33err        wheneq    1
182050020320     c                   movel     err(250)      vidmsg
182060020320     c     o33err        wheneq    2
182070020320     c                   movel     err(251)      vidmsg
182080020320     c     o33err        wheneq    3
182090020320     c                   movel     err(252)      vidmsg
182100020320     c                   endsl
182110020320     c                   goto      endreg
182120020320     c                   endif
182130020320     c                   z-add     o33nri        wawbini
182140020320     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
182150051102     c* del ARS trk "F"
182160020320     c                   z-add     wawbini       wawb
182170020320     c                   endif
182180020320     c                   endif
182190010228     C* SE SONO IN IMMISSIONE DEI MIEI PREPAGATI RICHIAMO PGM DI IMM.
182200010227     C* ORM
182210010227     C     PARTCH        IFEQ      'P'
182220010227     C     VIDMAG        ANDNE     'S'
182230010307     C     WORM          ANDEQ     'S'
182240010713     C     §3ARBL        ANDNE     'R'
182250010227     C                   EXSR      RIEO05
182260010228     C                   CLEAR                   KPJBU
182270010227     C                   CALL      'FIOR05R'
182280010227     C                   PARM                    KPJBA
182290010228     C                   PARM                    DSOR05
182300010227     C* SE PREMUTO F3 VADO A FINE ROUTINE E RIEMETTO LA VIDEATA
182310010227     C     §RMERR        IFEQ      '3'
182320010227     C                   MOVEL     '1'           WEMFOR
182330010227     C                   GOTO      ENDREG
182340010227     C                   ENDIF
182350010227     C                   ENDIF
182360001024     C*
182370060215     C* SE ANNO SPEDIZIONE E ANNO DI VAD SONO <> SISTEMO Fiar4 E
182380970107     C*  EDRDE01L
182390060215     c* 15/02/2006: Non si deve più aggiornare ar4 perchè è stato
182400060215     c* sostituito dal vat. Bisogna però continuare ad aggiornare EDRDE
182410060215     c* per bolle import
182420060215     C*****              CLEAR                   WESRDE
182430970107     C   12
182440970107    1CAN 15§1BFG3        IFEQ      'S'
182450970107     C*
182460970107     C     §3CFSP        OREQ      'S'
182470970107     C     §1BFG2        ANDEQ     'S'
182480970107     C*
182490060216     C* SE NON C'E' IL VAD RICONTROLLO KAAS CON Fiar4
182500060216     c* non serve più: ora l'informazione viene passata col vat
182510970107     C*
182520970407    2C     §LPAAC        IFNE      §LPAAS
182530060215     C**   KBLC4         CHAIN     Fiar401L                           31
182540060215    3C**   *IN31         DOWEQ     *OFF
182550060215     C**                 Z-ADD     §LPAAS        ar4AAS
182560060215     C**                 UPDATE    Fiar4000
182570060215     C**                 MOVEL     'S'           WESRDE            1
182580060215     C***  KBLC4         READE     Fiar401L                               31
182590060215    3C**                 ENDDO
182600970107     C*
182610060215    3C**** WESRDE        IFEQ      'S'
182620060215    3c                   if        §ogntw = 'EEX' or §ogntw = 'FED' or
182630081008     c                             §ogntw = 'DPD'
182640970107     C**
182650970107    4C     WOPRDE        IFEQ      ' '
182660970107     C                   OPEN      EDRDE01L
182670970107     C                   MOVEL     'S'           WOPRDE            1
182680970107    4C                   ENDIF
182690970107     C**
182700970107     C     KBLC4         CHAIN     EDRDE01L                           31
182710970107    4C     *IN31         DOWEQ     *OFF
182720970107     C                   Z-ADD     §LPAAS        RDEAAS
182730970107     C                   UPDATE    EDRDE000
182740970107     C     KBLC4         READE     EDRDE01L                               31
182750970107    4C                   ENDDO
182760970107    3C                   ENDIF
182770970107    2C                   ENDIF
182780970107     C*
182790970107    1C                   ENDIF
182800060209     c*
182810060209     c* STORICIZZAZIONI PER PREPAGATI
182820060209     c* Se cvb <> *blanks significa che è stata richiesta una variazione
182830060209     c* da gestire
182840060209     c                   if        ilv85cvb <> *blanks
182850060209     c* -- Storicizzazione variazione --
182860060209     c                   if        §7lfsa = 'S'
182870060209     c* se variazione da storicizzare e si tratta di variazione di
182880060209     c* tassazione memorizzo fiar6 e fiar7 prima di cancellare
182890060209     c* La write verrà eseguita prima della write di fnblp
182900060209     c                   if        ilv85cvb = 'TR'
182910060209     c                   clear                   fiarbt00
182920060209     c                   movel     knmus         arbpru
182930060209     c                   z-add     dateu         arbdtv
182940060209     c                   time                    arborv
182950060209     c                   movel     ilv85cvb      arbcvb
182960060209     c                   movel     '1'           arbtrc
182970060209     c                   exsr      stoarb
182980060209     c                   endif
182990060209     c                   endif
183000060209     c* -- Storicizzazione motivo variazione --
183010060209     c                   if        §7lmtv = 'S'
183020070604     c*                  movel     'L'           ilv85tla
183030070604     c                   movel     ' '           ilv85tla
183040060209     c                   movel     'R'           ilv85tel
183050060209     c                   z-add     arbdtv        ilv85dac
183060060209     c                   z-add     arborv        ilv85orc
183070060209     c                   z-add     blpaas        ilv85aas
183080060209     c                   z-add     blplnp        ilv85lnp
183090060209     c                   z-add     blpnrs        ilv85nrs
183100060209     c                   z-add     blpnsp        ilv85nsp
183110060307     c                   movel     olv85mtv      ilv85mtv
183120060307     c                   movel     olv85nt1      ilv85nt1
183130060307     c                   movel     olv85nt2      ilv85nt2
183140060209     c                   movel     fnlv85ds      kpjbu
183150060209     c                   call      'FNLV85R'
183160060209     c                   parm                    kpjba
183170060210     c                   movel     kpjbu         fnlv85ds
183180060209     c                   endif
183190060209     c                   endif
183200060209      *
183210060209      * IN MANUTENZIONE CANCELLO TUTTI I RECORD CHE CI SONO DELLE VARIE
183220060209      * IN FIAR700F
183230060209     C     WAR7          IFEQ      'E'
183240060209     c     war61         oreq      'E'
183250060209     c     wkscsf1       andne     0000
183260060209     c     wkscsf1       andne     9999
183270060209     C                   MOVEL     '1'           WTRC
183280060209     C     KBLP4         SETLL     FIAR7000
183290060209     C     KBLP4         READE     FIAR7000                               30
183300060209      *
183310060209    2C     *IN30         DOWEQ     *OFF
183320060209     C                   DELETE    FIAR7000
183330060209     C     KBLP4         READE     FIAR7000                               30
183340060209    2C                   ENDDO
183350060209      *
183360060209     C                   ENDIF
183370060209      * anche per la seconda bolla
183380060209if  1c                   If        War71 = 'E' or (war62 = 'E' and
183390060209     c                             wKSCsf2 <> 0000 and wKSCsf2 <> 9999)
183400060209     c                   Eval      Wtrc = '2'
183410060209     c     Kblp4         Setll     Fiar7000
183420060209do  2c                   Do        *Hival
183430060209     c     Kblp4         Reade     Fiar7000
183440060209     c                   If        %Eof(Fiar701l)
183450060209     c                   Leave
183460060209     c                   EndIf
183470060209     c                   Delete    Fiar7000
183480060209    2c                   EndDo
183490060209    1c                   EndIf
183500060209     C* PULISCO I FORMATI
183510060209     C                   CLEAR                   FIAR6000
183520060209     C                   CLEAR                   FIAR7000
183530940926     C***
183540941108     C*
183550940926     C***  T O T A L E   F A T T U R A
183560940926    1C     VIDNFT        IFGT      0
183570990630     C     *IN34         OREQ      *ON
183580941108     C*
183590120109     c* Qui non viene impostato comdft prima di richiamare totfat
183600120109     c* In caso di immissione di un prepagato il comdft in questo
183610120109     c* momento è = 0 (viene azzerato all'uscita dal FNLV16R) e
183620120109     c* viene quindi passata data fattura=0 al pgm fnlv04r.
183630120109     c* Nei periodi a cavallo di cambio aliquota IVA non è comunque
183640120109     c* un problema visto che il pgm FNLV04R se riceve data fattura=0,
183650120109     c* sceglie l'aliquota iva per il calcolo in base alla data del giorno
183660990630     C                   EXSR      TOTFAT
183670941108     C*
183680941108     C* SE E' UN ASSEGNATO MEMORIZZO TUTTI I CAMPI DELLA TASSAZIONE
183690990629     C*  OPPURE SE E' UN PREPAGATO
183700941108     C     *IN04         IFEQ      *ON
183710990629     C     *IN34         OREQ      *ON
183720941108     C                   ADD       D04BOL        DB0ESE
183730941108     C                   Z-ADD     D04IFT        DB0IFT
183740990701     C                   Z-ADD     D04IVA        DB0IVA
183750990701     C                   Z-ADD     D04IMV        VIDIMV
183760991130     C                   Z-ADD     VIDIMV        DB0IMV
183770990630     C                   Z-ADD     D04POR        VIDPOR
183780991014     C                   Z-ADD     D04POR        MEMPOR
183790941108    2C                   ENDIF
183800990630     C**
183810990630     C* REPERISCO: PO IVA, NUMERO E DATA FATTURA
183820990630    2C     *IN34         IFEQ      *ON
183830990630     C     KNUM          CHAIN     CNNUM000                           30
183840990630    3C     *IN30         IFEQ      *OFF
183850990630     C                   ADD       1             NUMNUM
183860990630     C                   Z-ADD     NUMNUM        VIDNFT
183870990630     C                   MOVE      DATEU         NUMDTP
183880990630     C                   UPDATE    CNNUM000
183890990630   X3C                   ELSE
183900990630     C                   Z-ADD     0             VIDNFT
183910990630    3C                   ENDIF
183920990630     C                   Z-ADD     FIV           VIDFIV
183930990630     C                   Z-ADD     DATEU         COMDFT
183940990630    2C                   ENDIF
183950941108    1C                   ENDIF
183960940926     C*
183970940926     C* SE ESISTE ALMENO UNA VARIA LEGGO IL SFL E GIA' CHE CI SONO
183980940926     C*  IMPOSTO GIA' I CAMPI DELLA TASSAZIONE
183990940926     C                   Z-ADD     1             NRR
184000941108     C                   Z-ADD     1             C
184010991014    1C     WESVAR        IFNE      ' '
184020940926     C*
184030941108    2C                   DO        20            NRR
184040940926     C     NRR           CHAIN     LS01S03                            30
184050991014      *
184060941108    3C     *IN30         IFEQ      *OFF
184070941108     C     V3CSV1        ANDNE     ' '
184080991014      * ESENTE: SOMMO AL TOTALE FATTURA SE E' DA IMPOSTARE
184090940926    4C     V3CEV1        IFNE      ' '
184100940926     C     VIDNFT        ANDGT     0
184110941108     C                   ADD       V3CVA1        DB0ESE
184120991130     C                   SUB       V3CVA1        DB0IMV
184130940926    4C                   ENDIF
184140991014      * SCRIVO VARIE
184150991014     C                   EXSR      WRTVAR
184160940926    3C                   ENDIF
184170940926    2C                   ENDDO
184180991014      *
184190940926    1C                   ENDIF
184200991014      *
184210991014      * SE IMPOSTATA L'IVA SCRIVO VARIA
184220991014     C     D04IVA        IFGT      *ZEROS
184230991014     C                   MOVEL     §$2IVA        V3CSV1
184240991014     C                   Z-ADD     D04IVA        V3CVA1
184250991014     C                   EXSR      WRTVAR
184260991014     C                   ENDIF
184270991014      * SE IMPOSTATO IL BOLLO SCRIVO VARIA, IN DB0ESE è GIA' STATA SOMMATA
184280991014     C     D04BOL        IFGT      *ZEROS
184290991014     C                   MOVEL     §$2BOL        V3CSV1
184300991014     C                   Z-ADD     D04BOL        V3CVA1
184310991014     C                   EXSR      WRTVAR
184320991014     C                   ENDIF
184330991027      *
184340991027      * SE PIENA UNA VARIA O ANTICIPATA O NUMERO FATTURA O PORTO
184350991027      *  O INOLTRO O DIRITTO FISSO O ESENZ.IVA  --> SCRIVO FIAR600F
184360991006      *
184370991006      * Se agganciata precedentemente riaggancio file tassazione per 1a bolla
184380991006     C     WAR61         IFEQ      'E'
184390991006     C                   MOVEL     '1'           WTRC
184400050331     c* se presente cod.Segue fattura significa che era stata tassata
184410050331     c* in arrivo --> DELETO la tassazione dell'arrivo
184420050331     c                   if        wKSCsf1 <> 0000 and wKSCsf1 <> 9999
184430050331     c     kblp4         delete    fiar6000
184440050331     c                   clear                   war61
184450050331     c                   else
184460991006     C     KBLP4         CHAIN     FIAR6000                           30
184470050331     c                   endif
184480991006     C                   ENDIF
184490991006      *
184500941108    1C     VIDDFT        IFGT      0
184510051116     C     wsv1          ORNE      ' '
184520051116     C     wsv2          ORNE      ' '
184530051116     C     wsv3          ORNE      ' '
184540051116     C     VIDCEI        ORNE      ' '
184550940926     C     VIDPOR        ORNE      0
184560991202     C*          VIDANT    ORNE 0
184570991006     C                   MOVEL     '1'           AR6TRC
184580991006     C                   Z-ADD     BLPAAS        AR6AAS
184590991006     C                   Z-ADD     BLPLNP        AR6LNP
184600991006     C                   Z-ADD     BLPNRS        AR6NRS
184610991006     C                   Z-ADD     BLPNSP        AR6NSP
184620991006     C                   Z-ADD     VIDPOR        AR6POR
184630991006     C                   Z-ADD     VIDIMV        AR6IMV
184640991006     C                   MOVEL     VIDCEI        AR6CEI
184650991027      *
184660991027     C                   MOVEL     WSV1          AR6SV1
184670991027     C                   Z-ADD     WVA1          AR6VA1
184680991027     C                   MOVEL     WSV2          AR6SV2
184690991027     C                   Z-ADD     WVA2          AR6VA2
184700991027     C                   MOVEL     WSV3          AR6SV3
184710991027     C                   Z-ADD     WVA3          AR6VA3
184720991027      *
184730120104      * L'aliquota iva la memorizzo solo se presente numero fattura
184740991006      * SE ESENZIONE NON MEMORIZZO L'ALIQUOTA
184750120104     c                   if        vidnft>0
184760941108    2C     VIDCEI        IFEQ      *BLANKS
184770120109     c                   if        comdft>§qtdsa
184780991006     C                   Z-ADD     §QTALI        AR6ALI
184790120104     c                   else
184800120104     C                   Z-ADD     §QTALO        AR6ALI
184810120104     c                   endif
184820941108   X2C                   ELSE
184830991006     C                   MOVEL     *ZEROS        AR6ALI
184840941108    2C                   ENDIF
184850120104     c                   endif
184860991006     C                   Z-ADD     D04IFT        AR6IFT
184870991006     C                   Z-ADD     VIDFIV        AR6FIV
184880991006     C                   Z-ADD     VIDNFT        AR6NFT
184890991006     C                   Z-ADD     COMDFT        AR6DFT
184900991015     C                   MOVEL     VIDDIV        AR6DIV
184910991015      * IMPOSTO FLAG DI TOTALE IMPONIBILE INSERITO IN PARTENZA
184920991015     C     AR6IMV        IFGT      *ZEROS
184930991015     C                   MOVEL     'P'           AR6FIM
184940991015     C                   ELSE
184950991015     C                   CLEAR                   AR6FIM
184960991015     C                   ENDIF
184970991015      * PER ASSEGNATI IMPOSTO CODICE DI FATTURAZIONE
184980991015     C                   CLEAR                   AR6CTR
184990991015     C     *IN04         IFEQ      *ON
185000991022     C                   MOVE      9999          AR6KSC
185010991022     C                   MOVEL     AR6LNP        AR6KSC
185020991015     C                   ELSE
185030991015     C                   CLEAR                   AR6KSC
185040991015     C                   ENDIF
185050991006      *
185060991015      *
185070991006     C     WAR61         IFEQ      'E'
185080991006     C                   UPDATE    FIAR6000
185090940926     C                   ELSE
185100991006     C                   WRITE     FIAR6000
185110940926     C                   ENDIF
185120941108     C*
185130941108     C* DATI PER STAMPA
185140990629     C* PER ASEGNATO O FRANCO PREPAGATO
185150941108     C     *IN04         IFEQ      *ON
185160990629     C     *IN34         OREQ      *ON
185170941108     C                   MOVEL     VIDCEI        DB0CEI
185180991014     C                   MOVEL     V3DCEI        DB0DCE
185190991014     C                   MOVEL     VIDDIV        DB0DIV
185200991014     C                   MOVEL     WFDC1         DB0FDC
185210941108     C                   Z-ADD     VIDIMV        DB0IMV
185220941108     C                   ENDIF
185230021209      * Per prepagato stampo sempre i dati della fattura
185240021209     c                   If        *In34
185250941108     C                   Z-ADD     VIDNFT        DB0NFT
185260941108     C                   Z-ADD     COMDFT        DB0DFT
185270941108     C                   ENDIF
185280940926     C*
185290940926   X1C                   ELSE
185300991006     C* SE NON DEVO SCRIVERE IL RECORD FIAR6 E C'ERA --> DELETO
185310991006    2C     WAR61         IFEQ      'E'
185320991006     C                   DELETE    FIAR6000
185330940926    2C                   ENDIF
185340940926    1C                   ENDIF
185350930624     C***
185360940919     C***  F L A G   I N O L T R O
185370940628     C                   EXSR      INOLTR
185380940628     C                   MOVEL     WFIN          BLPFIN
185390930624     C***
185400930624     C***  L I N E A   D I   A R R I V O
185410940628     C                   MOVEL     COMLNA        BLPLNA
185420930611     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
185430941107     C* CAMPI PER LA STAMPA BOLLA
185440941107     C                   MOVEL     ORGFAG        DB0FAG
185450941107     C                   MOVEL     ORGDES        DB0DLA
185460941107     C                   MOVEL     ORGIND        DB0INL
185470941107     C                   MOVEL     ORGLOC        DB0LOL
185480941107     C                   MOVEL     ORGPRO        DB0PRL
185490941107     C                   MOVEL     ORGTEL        DB0TEL
185500160422     C                   MOVEL     ORGdd2        DB0FAX
185510100319     c* Mancava l'impostazione del CAP db0CAL ma lo lascio vuoto perchè
185520100319     c*  così capiamo che si tratta di LVD stampata in partenza che
185530100319     c*  non dovrebbe mai essere usata per la consegna
185540941107     C*
185550910426     C* DESCRIZIONE LINEA ARRIVO PER SEGNACOLLO
185560930628    1C     ORGDE5        IFNE      *BLANKS
185570000208     C                   MOVEL     ORGDE5        WDLA
185580910426     C                   ELSE
185590000208     C                   MOVEL     ORGDES        WDLA
185600930628    1C                   END
185610001024     C                   MOVE      COMTFA        BLPTFA
185620971202     C* BLPFEA: TERMINAL DI PARTENZA DELLA LINEA DI ARRIVO
185630971202     C                   CLEAR                   DSLV55
185640971202     C                   MOVEL     'P'           D55TPT
185650971202     C                   MOVEL     COMLNA        D55LIN
185660971202     C                   MOVEL     BLPDSP        D55DRF
185670971202     C                   CALL      'FNLV55R'
185680971202     C                   PARM                    DSLV55
185690971202     C     D55ERR        IFEQ      ' '
185700971202     C                   MOVEL     D55TFP        BLPFEA
185710971202     C                   ELSE
185720971202     C                   MOVEL     COMLNA        BLPFEA
185730971202     C                   ENDIF
185740910201     C*
185750971202     C* TERMINAL DI PARTENZA
185760960130     C                   MOVEL     COMTFP        BLPTFP
185770111128     C                   MOVEL     comtfp        BLPFLE
185780940919     C***
185790940919     C***  M I T T E N T E
185800940919     C* SE ASSEGNATO SCRIVO 9999 NEL CODICE SPEDIZIONE
185810940919     C*  E IL MITTENTE, SE CODIFICATO, IN BLPCCM
185820940919     C                   CLEAR                   BLPCCM
185830940919    1C     *IN04         IFEQ      *ON
185840940919     C                   Z-ADD     9999          BLPKSC
185850940919     C                   MOVEL     BLPLNP        BLPKSC
185860940919     C*
185870940919    2C     VIDCCM        IFNE      9999
185880940919     C                   Z-ADD     VIDCCM        BLPCCM
185890940919     C*
185900940927    3C     VIDFLC        IFEQ      0
185910940919     C                   MOVEL     VIDLNP        BLPCCM
185920940919     C                   ELSE
185930940919     C                   MOVEL     VIDFLC        BLPCCM
185940940927    3C                   ENDIF
185950940927    2C                   ENDIF
185960940919    1C                   ENDIF
185970940919     C*
185980940919     C* SE FRANCO CODICE SEMPRE IL BLPKSC
185990941103     C     *IN04         IFEQ      *OFF
186000940919     C                   Z-ADD     VIDCCM        BLPKSC
186010940919     C     VIDFLC        IFEQ      0
186020940919     C                   MOVEL     VIDLNP        BLPKSC
186030940919     C                   ELSE
186040940919     C                   MOVEL     VIDFLC        BLPKSC
186050940919     C                   ENDIF
186060940919     C                   ENDIF
186070940919     C*
186080900504     C                   MOVEL     VIDRSM        BLPRSM
186090900504     C                   MOVEL     VIDINM        BLPINM
186100900504     C                   MOVEL     VIDCAM        BLPCAM
186110900504     C                   MOVEL     VIDLOM        BLPLOM
186120900504     C                   MOVEL     VIDPRM        BLPPRM
186130930202     C                   MOVEL     *BLANKS       BLPCPI
186140940919     C                   MOVEL     VIDNZM        BLPNZM
186150050114     c* flag unificazione spedizioni impostato solo se provengo da
186160050114     c* conferma bolle da cliente
186170130301     c  n12              clear                   blpxco
186180050114     c                   if        *in12 and *in15
186190050114     c                   eval      blpxco = wxco
186200050114     c                   endif
186210941221     C* MERCE PORTATA A MAGAZZINO
186220990915     C     *IN34         IFEQ      *ON
186230990915     C     VIDPDR        ANDLE     *ZEROS
186240001024     C                   MOVEL     VIDMAG        BLPFDN
186250990915     C                   ELSE
186260941221     C                   MOVEL     APDFCM        BLPFDN
186270990915     C                   ENDIF
186280950626     C* P A R T I T A   I V A
186290950626     C*
186300950626     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
186310950626     C*     NELLA P.IVA
186320950626     C     VIDISM        IFEQ      '$$'
186330950626     C     VIDCPM        ANDEQ     *BLANKS
186340950626     C                   MOVEL     'PRIVATO'     VIDCPM
186350950626     C                   ENDIF
186360950626     C     VIDISD        IFEQ      '$$'
186370950626     C     VIDCPD        ANDEQ     *BLANKS
186380950626     C                   MOVEL     'PRIVATO'     VIDCPD
186390950626     C                   ENDIF
186400950626     C*
186410941103     C  N04VIDISM        IFEQ      *BLANKS
186420940927     C                   MOVEL     VIDCPM        BLPCPI
186430940927     C                   ELSE
186440940927     C                   MOVEL     VIDPIM        BLPCPI
186450940927     C                   ENDIF
186460940927     C   04VIDISD        IFEQ      *BLANKS
186470940927     C                   MOVEL     VIDCPD        BLPCPI
186480940927     C                   ELSE
186490940927     C                   MOVEL     VIDPID        BLPCPI
186500940927     C                   ENDIF
186510950303     C*
186520950303     C* SE BOLLA DIRETTA ALL'ESTERO SCRIVO LE P.IVA
186530950303    1C     WDESIE        IFEQ      'E'
186540100119     c* Se c'e' esenzione IVA seconda bolla, memorizzo la partita IVA
186550100119     c     vi2cei        orne      ' '
186560100119     c* In manutenzione la devo cancellare se non è estero e non c'e' esenz.IVA
186570971230     C     *IN12         OREQ      *ON
186580971230     C     *IN15         ANDEQ     *OFF
186590971230     C     WDESIE        ANDNE     'E'
186600100119     C     vi2cei        andeq     ' '
186610950303     c*
186620971222     C                   CLEAR                   D19NT1
186630950303     C     VIDISD        IFEQ      *BLANKS
186640950303     C                   MOVEL     VIDCPD        W016A
186650950303     C                   ELSE
186660950303     C                   MOVEL     VIDPID        W016A            16
186670950303     C                   ENDIF
186680950303     C*
186690950303     C                   MOVE      W016A         D19NT1
186700950303     C*
186710950303     C     VIDISM        IFEQ      *BLANKS
186720950303     C                   MOVEL     VIDCPM        W016A
186730950303     C                   ELSE
186740950303     C                   MOVEL     VIDPIM        W016A            16
186750950303     C                   ENDIF
186760950303     C*
186770971222     C                   MOVEL     W016A         D19NT1
186780100119     c
186790100119     c                   if        *in12 and not *in15
186800100119     c                             and WDESIE<>'E' and vi2cei=' '
186810100119     C**   12
186820100119     C**ANN15WDESIE        IFNE      'E'
186830971230     C                   CLEAR                   D19NT1
186840971230     C                   ENDIF
186850060216     C                   MOVEL     'T'           D19ftr
186860950303     C                   MOVEL     BLPAAS        D19AAS
186870950303     C                   MOVEL     BLPLNP        D19LNP
186880950303     C                   MOVEL     BLPNRS        D19NRS
186890950303     C                   MOVEL     BLPNSP        D19NSP
186900950303     C                   MOVEL     'P'           D19TRC
186910950303     C                   CLEAR                   D19NT2
186920950303     C                   CALL      'FNLV19R'
186930950303     C                   PARM                    DSLV19
186940950303     C                   ENDIF
186950061110     c* Codice Fiscale mittente se inserito per prepagati non codificati
186960061110     c                   if        (*in34 and vidcdf<>*blanks) or
186970061110     c                             (not *in34 and *in22)
186980061110     C                   CLEAR                   D19NT1
186990061110     c                   movel     vidcdf        d19nt1
187000061110     C                   MOVEL     'T'           D19ftr
187010061110     C                   MOVEL     BLPAAS        D19AAS
187020061110     C                   MOVEL     BLPLNP        D19LNP
187030061110     C                   MOVEL     BLPNRS        D19NRS
187040061110     C                   MOVEL     BLPNSP        D19NSP
187050061110     C                   MOVEL     'Q'           D19TRC
187060061110     C                   CLEAR                   D19NT2
187070061110     C                   CALL      'FNLV19R'
187080061110     C                   PARM                    DSLV19
187090061110     C                   ENDIF
187100940919     C***
187110940919     C***  D E S T I N A T A R I O
187120900504     C                   MOVEL     VIDRSD        BLPRSD
187130950123     C                   MOVE      VIDRSD        WRD2             35
187140941025     C*
187150940919     C* SE SCRITTA ANCHE 2 RAGIONE SOCIALE DESTINATARIO
187160940919     C*  SCRIVO IL FILE DI ESTENSIONE DESCRIZIONI SE SUPERA IL MINIMO
187170940919     C*  CARATTERI PREVISTI  (CAMPO §7KMNC)
187180941025     C*  IN MANUTENZIONE VADO SEMPRE, PER IL RESTO SOLO SE IMMESSA
187190941025     C     *IN12         IFEQ      *ON
187200941025     C     *IN15         ANDEQ     *OFF
187210950123    2C     WRD2          ORNE      *BLANKS
187220060216     C                   MOVEL     'T'           D19ftr
187230941025     C                   MOVEL     BLPAAS        D19AAS
187240941025     C                   MOVEL     BLPLNP        D19LNP
187250941025     C                   MOVEL     BLPNRS        D19NRS
187260941025     C                   MOVEL     BLPNSP        D19NSP
187270941025     C                   MOVEL     'D'           D19TRC
187280971219     C                   MOVEL(P)  WRD2          D19NT1
187290941025     C                   CLEAR                   D19NT2
187300941025     C                   CALL      'FNLV19R'
187310941025     C                   PARM                    DSLV19
187320941025     C                   ENDIF
187330900504     C                   MOVEL     VIDIND        BLPIND
187340900504     C                   MOVEL     VIDCAD        BLPCAD
187350060705     c* se spedizione export DPD diretta in Portogallo devo aggiungere al
187360060705     c* cap immesso tanti 0 a dx quanti ne servono per arrivare ad una
187370060705     c* lunghezza di cap di 7 byte
187380060705     c                   if        a_§ogntw='DPD' and vidnzd = 'P  '
187390060705     c     ' '           checkr(e) blpcad:7      NN                1 0
187400060705     c                   if        %found
187410060705     c                   eval      %subst(blpcad:nn+1:7-nn)=*all'0'
187420060705     c                   endif
187430060705     c                   endif
187440900504     C                   MOVEL     VIDLOD        BLPLOD
187450900504     C                   MOVEL     VIDPRD        BLPPRD
187460940919     C                   MOVEL     VIDNZD        BLPNZD
187470140612     c* se spedizione export e presente la provincia la tengo solo se
187480140612     c* è obbligatoria come da tabella nazione
187490140612     c                   if        blpnzd<>*blanks
187500140612     C                   MOVEL     '15'          COD
187510140612     C                   MOVEL(P)  BLPNZD        KEY
187520140612     C                   EXSR      CTABEL
187530140612     C   30              CLEAR                   DS15
187540140612     C  N30              MOVEL     TBLUNI        DS15
187550140612     c                   if        §15sto<>'S'
187560140612     c                   clear                   blpprd
187570140612     c                   endif
187580140612     c                   endif
187590940919     C*
187600900504     C                   MOVEL     VIDGC1        BLPGC1
187610900504     C                   MOVEL     VIDGC2        BLPGC2
187620900504     C                   MOVEL     VIDCTR        BLPCTR
187630900613     C                   MOVEL     SAVCTS        BLPCTS
187640911008     C                   MOVEL     VIDFBR        BLPFBR
187650000627     C*
187660000627     C* ALLEGA BAM
187670000627     C                   EXSR      AGGFST
187680950127     C*
187690960118     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
187700951009     C                   CLEAR                   BLPFTM
187710950127     C   04SAVFTM        IFEQ      'S'
187720950127     C     VIDFTM        OREQ      'S'
187730950127     C                   MOVEL     'S'           BLPFTM
187740950127     C                   ENDIF
187750950127     C*
187760941230     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
187770941230    2C     APDFCM        IFNE      ' '
187780941230     C                   MOVEL     'C'           BLPFAP
187790941230     C                   ELSE
187800941230     C                   MOVEL     COMFAP        BLPFAP
187810941230    2C                   END
187820940922     C* SE NON IMMESSO TIPO SERVIZIO
187830940922     C     VIDTSP        IFNE      *BLANKS
187840940919    1C                   MOVEL     VIDTSP        BLPTSP
187850940922     C                   ELSE
187860940922     C* LO PRENDO DA TARIFFA
187870940922     C                   MOVEL     COMTSP        BLPTSP
187880940922     C                   ENDIF
187890020725     C*
187900940919     C                   MOVEL     VIDIAS        BLPIAS
187910011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE IMPORTO ASSICURARE > 0
187920011113     C     VIDIAS        IFGT      *ZEROS
187930011113     C                   MOVEL     VIDVAS        BLPVAS
187940011113     C                   ELSE
187950011113     C                   CLEAR                   BLPVAS
187960011113     C                   ENDIF
187970940919     C                   MOVEL     VIDVMD        BLPVMD
187980011113     C* SPOSTO LA DIVISA DEL VIDEO SOLO SE VALORE MERCE > 0
187990011113     C     VIDVMD        IFGT      *ZEROS
188000011113     C                   MOVEL     VIDVAD        BLPVAD
188010011113     C                   ELSE
188020011113     C                   CLEAR                   BLPVAD
188030011113     C                   ENDIF
188040940919     C                   MOVEL     VIDQFT        BLPQFT
188050900504     C                   MOVEL     VIDNAS        BLPNAS
188060941115     C                   MOVEL     V1CNCL        BLPNCL
188070150304     C                   MOVEL     V2CPKG_i      BLPPKB
188080150304     C                   MOVEL     V2CPKG_i      BLPPKF
188090940919     C                   MOVEL     VIDFVR        BLPFVB
188100150304     C                   MOVEL     VARVOL_i      BLPVLB
188110940919     C                   MOVEL     VIDFVR        BLPFVF
188120150304     C                   MOVEL     VARVOL_i      BLPVLF
188130150304     c* Le istruzioni seguenti sono già state eseguite prima del calcolo
188140150304     c* dell'instradamento:
188150030204      * Immissione bolla
188160150304     c****               If        (*In12 and *In15) or Not *In12
188170030204      * Se sono stati impostati i bancali devo sommare al peso e al volume
188180030204      * il peso e il volume dei bancali
188190030922      * no x particolarità varia 'O'
188200150304     c***                If        %subst(VidGva:1:1) <> 'O'
188210150304     c***                If        VidNba > *Zeros and §cliban=*blanks
188220150304     c***                Clear                   w0071
188230150304     c**                 Clear                   w0053
188240150304     c***  wTbaPkg1      Mult      VidNba        w0071
188250150304     c***                Add       w0071         BlpPkb
188260150304     c***                Add       w0071         BlpPkf
188270150304     c***  wTbaVol1      Mult      VidNba        w0053
188280150304     c***                Add       w0053         BlpVlb
188290150304     c****               Add       w0053         BlpVlf
188300150304     c****               EndIf
188310150304     c****               If        VidNb2 > *Zeros
188320150304     c****               Clear                   w0071
188330150304     c****               Clear                   w0053
188340150304     c**** wTbaPkg2      Mult      VidNb2        w0071
188350150304     c***                Add       w0071         BlpPkb
188360150304     c***                Add       w0071         BlpPkf
188370150304     c**** wTbaVol2      Mult      VidNb2        w0053
188380150304     c***                Add       w0053         BlpVlb
188390150304     c***                Add       w0053         BlpVlf
188400150304     c***                EndIf
188410150304     c****               EndIf
188420150304     c****               EndIf
188430010214     C     VIDFFD        IFEQ      'N'
188440010214     C                   MOVEL     *BLANKS       BLPFFD
188450010214     C                   ELSE
188460940919     C                   MOVEL     VIDFFD        BLPFFD
188470010214     C                   ENDIF
188480940919     C                   MOVEL     COMDRT        BLPDRT
188490000308     C                   CLEAR                   BLPPDR
188500990630     C  N34              MOVEL     VIDLNP        BLPPDR
188510990630     C  N34              MOVE      VIDPDR        BLPPDR
188520940919     C                   MOVEL     VIDFPP        BLPFPP
188530940928     C                   MOVEL     VIDNRT        BLPNRT
188540940919     C                   MOVEL     VIDTCR        BLPTCR
188550940919     C                   MOVEL     COMDCR        BLPDCR
188560940919     C                   MOVEL     VIDHCR        BLPHCR
188570940919     C                   MOVE      VIDMCR        BLPHCR
188580030326      * Data consegna richiesta - Forzata su richiesta del cliente
188590030326      * in immissione bolla
188600030410      * e se non già impostata la data consegna richiesta
188610100219     c                   If        ((*In12 and *In15) or Not *In12)
188620100219     c                               and BlpDcr = *Zeros
188630030326     c                   ExSr      SrDcr
188640100217     c                   EndIf
188650100217     c
188660000214     C* SE E' UN DISK "C" MA NUMERAZIONE AUTOMATICA DPD,
188670000214     C* TRATTO COME DISK "A"
188680940919     C                   MOVEL     VIDSOP        BLPSOP
188690940919     C                   MOVEL     VIDRMN        BLPRMN
188700940919     C                   MOVEL     VIDRMA        BLPRMA
188710940919     C                   MOVEL     VIDRMO        BLPRMO
188720941005     C*
188730941005     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
188740941005     C     VIDCMO        IFNE      *BLANKS
188750941005     C                   MOVEL     VIDCMO        BLPCAM
188760941005     C                   MOVEL     VIDNMO        BLPNZM
188770941005     C                   ENDIF
188780941005     C*
188790160331     c* Forzatura zona di consegna per "VEDI PACCO DPD"  se prevista
188800160331     c                   if        w_vediP='1' and §NSDZNC<>*blanks
188810160331     c                   movel     §NSDZNC       VARZNC
188820160331     c                   endif
188830160421     c* In manutenzione verifico se si può aggiornare anche la zona di consegna
188840160421     c                   if        *in12 and not *in15
188850160421     c                   clear                   w_VariaZnc
188860160421     c                   exsr      sr_VariaZnc
188870160421     c                   endif
188880160421     c                   if        not *in12 or
188890160421     c                             (*in12 and *in15) or
188900160421     c                             (*in12 and not *in15 and w_VariaZnc=' ')
188910940919     C                   MOVEL     VARZNC        BLPZNC
188920160422     c                   else
188930160422     c                   movel     blpznc        varznc
188940160421     c                   endif
188950950303     C     §3ACTM        IFNE      *BLANKS
188960950303     C                   MOVEL     §3ACTM        BLPCTM
188970950303     C                   ELSE
188980940919     C                   MOVEL     VIDCTM        BLPCTM
188990950303     C                   ENDIF
189000941005     C     BLPCTM        IFEQ      *BLANKS
189010941005     C                   MOVEL     WCTM          BLPCTM
189020941005     C                   ENDIF
189030940919     C                   MOVEL     VIDTC1        BLPTC1
189040940919     C                   MOVEL     VIDTC2        BLPTC2
189050001205     C* SE MANUTENZIONE DI BOLLA POSTE E AGGIUNTA O TOLTA TC1/2 "F"
189060060215     C* DEVO AGGIORNARE ar4 TIPO RECORD J
189070140122     C** 12
189080140122     C**ANN15§ogntw        IFEQ      'PPT'
189090140122     C**                 CLEAR                   WTCP
189100140122     C**                 CLEAR                   WSVTCP
189110140122     C**   VIDTC1        IFEQ      'F'
189120140122     C**   VIDTC2        OREQ      'F'
189130140122     C**                 MOVEL     'F'           WTCP
189140140122     C**                 ENDIF
189150140122     C**   SAVTC1        IFEQ      'F'
189160140122     C**   SAVTC2        OREQ      'F'
189170140122     C**                 MOVEL     'F'           WSVTCP
189180140122     C**                 ENDIF
189190140122     C**                 SELECT
189200001205     C* SE NON E' STATA NE' AGGIUNTA NE' TOLTA LA "F" NON FACCIO NIENTE
189210140122     C**   VIDTC1        WHENNE    'F'
189220140122     C**   VIDTC2        ANDNE     'F'
189230140122     C**   SAVTC1        ANDNE     'F'
189240140122     C**   SAVTC2        ANDNE     'F'
189250140122     C**   WTCP          OREQ      'F'
189260140122     C**   WSVTCP        ANDEQ     'F'
189270140122     C**                 OTHER
189280140122     C**                 MOVEL     'J'           WTRC
189290140122     C**   KBLP4         CHAIN(N)  Fiar401L                           30
189300140122    3C**   *IN30         IFEQ      *OFF
189310140122     C**                 MOVEL     ar4NOT        DSBL4J
189320001205     C* TOLTO LA 'F'
189330140122    4C**   WTCP          IFEQ      *BLANKS
189340140122     C**   WSVTCP        ANDEQ     'F'
189350140122     C**                 CLEAR                   §B4BAI
189360140122   X4C**                 ELSE
189370001205     C* AGGIUNTA 'F'
189380140122    5C**   WTCP          IFEQ      'F'
189390140122     C**   WSVTCP        ANDEQ     *BLANKS
189400140122     C**                 MOVEL     'S'           §B4BAI
189410140122    5C**                 ENDIF
189420140122    4C**                 ENDIF
189430140122     C**                 CLEAR                   DSLV19
189440140122     C**                 MOVEL     DSBL4J        D19NT1
189450140122     c**                 movel     'T'           d19ftr
189460140122     C**                 MOVEL     BLPAAS        D19AAS
189470140122     C**                 MOVEL     BLPLNP        D19LNP
189480140122     C**                 MOVEL     BLPNRS        D19NRS
189490140122     C**                 MOVEL     BLPNSP        D19NSP
189500140122     C**                 MOVEL     'J'           D19TRC
189510140122     C**                 CLEAR                   D19NT2
189520140122     C**                 CALL      'FNLV19R'
189530140122     C**                 PARM                    DSLV19
189540140122   X3C**                 ELSE
189550001205     C* AGGIUNTA 'F' --> CREO RECORD "J"
189560140122    4C**   WTCP          IFEQ      'F'
189570140122     C**   WSVTCP        ANDEQ     *BLANKS
189580140122     C**                 CLEAR                   DSLV19
189590140122     C**                 CLEAR                   DSBL4J
189600140122     c**                 movel     'T'           d19ftr
189610140122     C**                 MOVEL     'S'           §B4BAI
189620140122     C**                 MOVEL     DSBL4J        D19NT1
189630140122     C**                 MOVEL     BLPAAS        D19AAS
189640140122     C**                 MOVEL     BLPLNP        D19LNP
189650140122     C**                 MOVEL     BLPNRS        D19NRS
189660140122     C**                 MOVEL     BLPNSP        D19NSP
189670140122     C**                 MOVEL     'J'           D19TRC
189680140122     C***                CLEAR                   D19NT2
189690140122     C**                 CALL      'FNLV19R'
189700140122     C***                PARM                    DSLV19
189710140122    4C***                ENDIF
189720140122    3C***                ENDIF
189730140122     C***                ENDSL
189740140122     C***                ENDIF
189750141201     c* se spedizione export non memorizzo nè il pin code se presente e nemmeno
189760141201     c* la particolarità consegna se prevede il PIN CODE
189770141201     c                   if        a_§ogntw='DPD' or
189780141201     c                             a_§ogntw='EEX' or
189790141201     c                             a_§ogntw='FED'
189800141201     c                   clear                   wpincode
189810141201     c                   if        §7rpincode='S'
189820141201     c                   clear                   vidgma
189830141201     c                   endif
189840141201     c                   endif
189850141201
189860940919     C                   MOVEL     VIDGGA        BLPGGA
189870940919     C                   MOVEL     VIDGMA        BLPGMA
189880141201
189890940919     C                   MOVEL     VIDGVA        BLPGVA
189900960208     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
189910960208     C* DELLE PARTICOLARITA' VARIE
189920970707     C     W2LN          IFEQ      'S'
189930960208     C                   MOVE      'D'           BLPGVA
189940960208     C                   ELSE
189950960208     C                   MOVE      ' '           BLPGVA
189960960208     C                   ENDIF
189970141201
189980141201
189990940919     C* C/ASSEGNO
190000051115    1C     ar9CAS        IFGT      0
190010940919     C     VIDGCA        ORNE      *BLANKS
190020051115     C                   MOVEL     BLPAAS        ar9AAS
190030051115     C                   MOVEL     BLPLNP        ar9LNP
190040051115     C                   MOVEL     BLPNRS        ar9NRS
190050051115     C                   MOVEL     BLPNSP        ar9NSP
190060051115     C                   MOVEL     VIDGCA        ar9GCA
190070051115     C                   MOVEL     dateu         ar9duv
190080940919     C*
190090051115     C     War9          IFEQ      'E'
190100051115     C                   UPDATE    Fiar9000
190110940926     C                   ELSE
190120051115     C                   WRITE     Fiar9000
190130940926     C                   ENDIF
190140940926     C*
190150940926     C                   ELSE
190160940926     C* SE C'ERA E ORA NON PIU' DELETO
190170051115     C     War9          IFEQ      'E'
190180051115     C                   DELETE    Fiar9000
190190940919     C                   ENDIF
190200940926     C                   ENDIF
190210900828     C*
190220941025     C* SE NO A BORDERO' METTO 99999 IN DATA BORDERO' E NUM.F.VIAGG
190230930628    1C     §1BFG4        IFEQ      'N'
190240900829     C                   MOVEL     DATEU         BLPDBR
190250900828     C                   MOVEL     *ALL'9'       BLPNFV
190260930628   X1C                   ELSE
190270930628    2C     *IN12         IFEQ      *ON
190280930628     C     *IN15         ANDEQ     *ON
190290930628     C     *IN12         OREQ      *OFF
190300930628     C                   MOVEL     *ZEROS        BLPDBR
190310930628     C                   MOVEL     *ZEROS        BLPNFV
190320930628    2C                   END
190330930628    1C                   END
190340910805     C  N12              MOVEL     *BLANKS       BLPFNS
190350910805     C   12              MOVEL     VIDFNS        BLPFNS
190360971212     C**
190370971215     C** SE BOLLA EXP/IMP SDI CON NUMERO AWB SCRITTO, LO MEMORIZZO
190380020211     c** SE BOLLA EXPORT FEDEX ASSEGNO IL NUMERO AWB
190390971217     C   12
190400971217     CAN 15
190410971217     CORN12              CLEAR                   DSBL4E
190420020213     c     A_§ogntw      ifeq      'FED'
190430020320     c     wawbini       andgt     *zeros
190440020211     C                   CLEAR                   DSBL4E
190450020228     c                   movel     wawbini       w0012a           12
190460020228     c* calcolo check digit
190470020228     c                   exsr      chkdgf
190480020228     c                   movel     w0012a        §b4erp
190490020211     C                   MOVEL     'A'           §B4EMA
190500020211     C                   MOVEL     'P'           §B4EAT
190510020212     c* memorizzo numero iniziale di awb che mi servirà in fase di creazione
190520051102     c* del ARS trk "F"
190530020208     c                   endif
190540081008    1C**   V6CAWB        IFEQ      0
190550081008     c**   A_§ogntw      andeq     'EUP'
190560971212     C* VEDO SE C'E' IL CONTATORE 19 - NUMERO AWB
190570081008     C***                CLEAR                   AAS
190580081008     C**                 Z-ADD     19            CNU
190590081008     C**                 Z-ADD     BLPTFP        COMLIN
190600081008     C**   KNUF          CHAIN     FLNUF01L                           30
190610081008    2C**   *IN30         IFEQ      *OFF
190620081008     C**                 ADD       1             NUFNUM
190630980623     C* SE SUPERA RANGE FINALE, RIPARTO DA QUELLO INIZIALE
190640081008     C**   NUFNUM        IFGT      NUFRFI
190650081008     C**                 Z-ADD     NUFRIN        NUFNUM
190660081008    6C**                 END
190670081008     C**                 UPDATE    FLNUF
190680081008     C**                 Z-ADD     NUFNUM        W0090
190690081008     C**                 MOVEL     §3IFAW        W0090
190700081008     C**   W0090         DIV       7             RISUL
190710081008     C**                 MVR                     RESTO
190720081008     C**                 MOVEL     W0090         W010A
190730081008     C**                 MOVE      RESTO         W010A
190740971217     C*
190750081008     C**                 CLEAR                   DSBL4E
190760081008     C**                 MOVEL     W010A         §B4ERP
190770081008     C**                 MOVEL     'A'           §B4EMA
190780081008     C**                 MOVEL     'P'           §B4EAT
190790971216     C* SE LA STAMPO IN IMMEDIATO METTO SUBITO LA S DI STAMPATO
190800081008    3C**   §1BFG6        IFEQ      'I'
190810971217     C*
190820081008     C**   §1BFG6        OREQ      'C'
190830081008     C**   §1BFG0        ANDEQ     'I'
190840971217     C*
190850081008     C**   §1BFG6        OREQ      'C'
190860081008     C**   §1BFG0        ANDEQ     'C'
190870081008     C**   §1BF11        ANDEQ     'I'
190880081008     C**                 MOVEL     'S'           §B4EST
190890081008     C**                 ELSE
190900081008     C**                 MOVEL     'N'           §B4EST
190910081008    3C**                 ENDIF
190920081008    2C**                 ENDIF
190930971212     C**
190940081008   X1C**                 ELSE
190950971217     C* IN MANUTENZIONE SOLO SE HO MODIFICATO IL NUMERO
190960971217     C*  ALTRIMENTI LASCIO QUELLO CHE C'E'
190970081008    2C**   V6CAWB        IFGT      0
190980980310     C* SOLO SE EXPORT SDI
190990081008     c**   A_§ogntw      ifeq      'EUP'
191000081008    4C**   SAVAWB        IFNE      V6CAWB
191010081008     C**   §B4EMA        OREQ      ' '
191020081008     C**                 CLEAR                   DSBL4E
191030081008     C**                 MOVEL     V6CAWB        §B4ERP
191040081008     C**                 MOVEL     'M'           §B4EMA
191050081008     C**                 MOVEL     'P'           §B4EAT
191060081008     C**                 MOVEL     'S'           §B4EST
191070081008    4C**                 ENDIF
191080081008    3C**                 ENDIF
191090081008    2C***                ENDIF
191100081008    1C**                 ENDIF
191110971230     C* SE MODIFICATA LA LNA E DIVENTATE ENTRAMBE IN ITALIA
191120060215     C*    AZZERO NUMERO AWB E CANCELLO Fiar4
191130971230    2C     *IN12         IFEQ      *ON
191140971230     C     *IN15         ANDEQ     *OFF
191150120302     C* PER LA LINEA DI PARTENZA VALE SOLO PER BRT
191160020211     c     §ogntw        ifne      'EEX'
191170020211     c     §ogntw        andne     'FED'
191180081008     c***  §ogntw        andne     'EUP'
191190020213     c     A_§ogntw      andne     'FED'
191200081008     c***  A_§ogntw      andne     'EUP'
191210020211     C                   MOVEL     'E'           WTRC
191220060215     C     KBLP4         DELETE    Fiar4000                           30
191230020211     C                   CLEAR                   §B4ERP
191240020211     c                   endif
191250971230    2C                   ENDIF
191260060216     C* SE C'E' NUMERO AWB SCRIVO RECORD E IN ar4
191270971212    1C     §B4ERP        IFNE      *BLANKS
191280971216     C     SAVAWB        ORNE      0
191290081008     c***  A_§ogntw      ifeq      'EUP'
191300081008     c     A_§ogntw      ifeq      'FED'
191310060215     C                   MOVEL     'T'           D19ftr
191320971212     C                   MOVEL     BLPAAS        D19AAS
191330971212     C                   MOVEL     BLPLNP        D19LNP
191340971212     C                   MOVEL     BLPNRS        D19NRS
191350971212     C                   MOVEL     BLPNSP        D19NSP
191360971212     C                   MOVEL     'E'           D19TRC
191370971212     C                   CLEAR                   D19NT1
191380971212     C                   MOVEL     DSBL4E        D19NT1
191390971212     C                   CLEAR                   D19NT2
191400971212     C                   CALL      'FNLV19R'
191410971212     C                   PARM                    DSLV19
191420020211     c                   endif
191430971212    1C                   ENDIF
191440031219      * se ho caricato il riferimento partner estero da FIVAT rcd 'C'
191450060216      * scrivo il Fiar4 rcd 'E'
191460031219    1c                   If        *In12 and *In15
191470080128     c                             and A_§ogntw<>'FED'
191480060215     c                   MOVEL     'T'           D19ftr
191490031219     C                   MOVEL     BLPAAS        D19AAS
191500031219     C                   MOVEL     BLPLNP        D19LNP
191510031219     C                   MOVEL     BLPNRS        D19NRS
191520031219     C                   MOVEL     BLPNSP        D19NSP
191530031219     C                   MOVEL     'E'           D19TRC
191540031219     C                   CLEAR                   D19NT1
191550031219     C                   MOVEL     wrifp         D19NT1
191560031219     C                   CLEAR                   D19NT2
191570031219     C                   CALL      'FNLV19R'
191580031219     C                   PARM                    DSLV19
191590031219    1c                   EndIf
191600141031     c* Memorizzo Pin Code se presente
191610141031    1c                   If        *In12 and *In15 and wPinCode<>*blanks
191620141031     c                   MOVEL     'T'           D19ftr
191630141103
191640141103     c                   clear                   dsbl4y
191650141103     C                   MOVEL     wPinCode      §b4pcd
191660141103
191670141031     C                   MOVEL     BLPAAS        D19AAS
191680141031     C                   MOVEL     BLPLNP        D19LNP
191690141031     C                   MOVEL     BLPNRS        D19NRS
191700141031     C                   MOVEL     BLPNSP        D19NSP
191710141031     C                   MOVEL     'Y'           D19TRC
191720141031     C                   CLEAR                   D19NT1
191730141103     c                   movel     dsbl4y        d19nt1
191740141031     C                   CLEAR                   D19NT2
191750141031     C                   CALL      'FNLV19R'
191760141031     C                   PARM                    DSLV19
191770141031    1c                   endif
191780991203      **
191790060216      ** SE EXPORT DPD CON NUMERO PARCEL SCRITTO, LO MEMORIZZO IN Fiar4
191800060509     c                   if        (*in12 and *in15) or *in12 = '0'
191810061003     C****               CLEAR                   DSBL4F
191820060509     C                   CLEAR                   DSBL4I
191830060509     C                   CLEAR                   DSBL4K
191840060509     c                   endif
191850991203      *
191860020319    1C     A_§OGNTW      IFEQ      'DPD'
191870060620     c*
191880991203      *
191890060616    2C     V7CNPR        IFne      *blanks
191900060620     c* Imposto dsbl4f solo se si utilizza ancora il cappario vecchio
191910061003     C****               CLEAR                   DSBL4F
191920061003    3c****               if        dateu < §vpodpd  AND
191930061003     c****                         %subst(v7cnpr:14:1)=*blanks
191940061003     C****               MOVEL     V7CNPR        §B4FNP
191950061003     C**** §1BF13        IFEQ      'A'
191960061003     C****               MOVEL     'A'           §B4FMA
191970061003     C****               ELSE
191980061003     C****               MOVEL     'M'           §B4FMA
191990061003     C****               ENDIF
192000061003     C****               MOVEL     'P'           §B4FAT
192010061003     C****               MOVEL     'S'           §B4FST
192020061003     C****               MOVEL     OD3NAZ        §B4NAZ
192030061003     C****               MOVEL     OD3RTN        §B4RTN
192040061003     C****               MOVEL     OD3ZON        §B4ZON
192050061003     C****               MOVEL     OD3COL        §B4FNR
192060061003    3c****               endif
192070060616     c* imposto dsbl4i/k
192080060509     c                   clear                   dsbl4i
192090060616     c                   clear                   dsbl4k
192100060509     C                   MOVEL     V7CNPR        §B4IPN
192110060616     c* tolgo il check digit dal parcel number se n. parcel lungo 12
192120060620     c                   if        %subst(§b4ipn:14:1) = *blanks
192130060509     c                   eval      %subst(§b4ipn:12:1)=' '
192140060620     c                   eval      §b4icd=%subst(v7cnpr:12:1)
192150060616     c                   else
192160060616     c* se parcel lungo 14 calcolo il check digit
192170060616     c                   clear                   trul28ds4
192180060616     c                   eval      i284cod=§b4ipn
192190060616     c                   call      'TRUL28R5'
192200060616     c                   parm                    trul28ds4
192210060616     c                   movel     o284ckd       §b4icd
192220060616     c                   endif
192230060616     c* Se ho usato il cappario dpd vecchio imposto dsbl4i con campi
192240060616     c* del cappario vecchio altrimenti perndo quelli del cappario nuov
192250070515     c***                if        dateu < §vpodpd  AND
192260070515     c***                          %subst(v7cnpr:14:1)=*blanks
192270060510     c* depot di arrivo --> muovo uno 0 in prima posizione
192280070515     c***                movel     '0'           §b4ida
192290070515     C***                MOVE      OD3RTN        §B4ida
192300070515     C***                MOVEL     OD3ZON        §B4iza
192310060509     c* imposto dsbl4k
192320070515     C***                MOVEL     OD3COL        §B4krt
192330070515     c***                else
192340060616     c                   movel     osie3dsrt     §b4ids
192350060616     c                   movel     osie3bidp     §b4ibi
192360060616     c                   movel     osie3ddep     §b4ida
192370060616     c                   move      isie3srv      §b4isc
192380061010     c                   movel     osie3iatad    §b4iat
192390061010     c                   movel     osie3ptyg     §b4ipy
192400070515     c***                endif
192410991203      *
192420991203    2C                   ENDIF
192430991203    1C                   ENDIF
192440050228     c*
192450050228    1C     *in79         IFEQ      *on
192460070605    1C     A_§OGNTW      andne     'DPD'
192470060616    2C     v7cnpr        IFne      *blanks
192480061003     C****               CLEAR                   DSBL4F
192490060621     c* solo se parcel lungo 11
192500061003     c****               if        %subst(v7cnpr:14:1) = *blanks
192510061003     c****               movel     v7cnpr        §b4fnp
192520061003     c***                endif
192530060510     c* imposto dsbl4i
192540060616     c                   movel     v7cnpr        §b4ipn
192550060621    3c                   if        %subst(§b4ipn:14:1) = *blanks
192560060616     c                   eval      %subst(§b4ipn:12:1)=' '
192570060619     c                   eval      §b4icd=%subst(v7cnpr:12:1)
192580060621   x3c                   else
192590060616     c* se parcel lungo 14 calcolo il check digit
192600060616     c                   clear                   trul28ds4
192610060616     c                   eval      i284cod=§b4ipn
192620060616     c                   call      'TRUL28R5'
192630060616     c                   parm                    trul28ds4
192640060616     c                   movel     o284ckd       §b4icd
192650060621    3c                   endif
192660060621     c* destination sort
192670060621     c                   move      §oghb1        §b4ids
192680060621     c                   move      a_§ogdp1      §b4ida
192690060621    3c                   select
192700060628     c* immissione o bolla di reso
192710060628     c                   when      *in12='0' or blpfbr = 'S'
192720060621     C                   CLEAR                   PTYPE             2
192730060621     c                   if        blppkb>§3ilmp
192740060621     c                   move      101           §b4isc
192750060621     c                   eval      ptype='01'
192760060621     c                   else
192770060621     c                   move      136           §b4isc
192780060928     c                   eval      ptype='02'
192790060621     c                   endif
192800060628     c                   if        blpfbr='S'
192810060628     c                   move      300           §b4isc
192820060628     c                   endif
192830060621     c                   move      '%'           §b4ibi
192840060621     c                   if        %subst(§b4ipn:14:1)=*blanks
192850060621     c                   eval      §b4krt='39' + %subst(blpcad:1:5)+
192860060621     c                             ptype
192870060621     c                   endif
192880060628     c* conferma da disk
192890060628     c                   when      *in12='1' and *in15='1'
192900060628     c                   move      §VATESCD      §B4ISC
192910060628     c                   move      §VATEbid      §b4ibi
192920060628    4c                   if        §vaterou <> *blanks
192930060628     c                   move      §vaterou      §b4krt
192940060628    4c                   endif
192950060621    3c                   endsl
192960050228    2C                   ENDIF
192970160218     c* FLAG TRADUTTORE
192980160218     c                   select
192990150916     c* flag traduttore se in Conferma da disk
193000160218     c                   when      *in12 and *in15
193010150916     c                   eval      dblp01=§lpflo
193020160218     c* Metto quello che ricevo da chiamante
193030150916     c                   eval      §B4TRD=§LPTRD
193040160218     c* se non ho ricevuto nulla e sono richiamata da pgm giacenze per
193050160218     c* bolla di reso metto "R" si tratta di bolla di recupero:
193060160218     c                   if        §b4trd=*blanks and §3arbl<>'R' and *in44
193070160218     c                             and blpfbr='S'
193080160218     c                   eval      §b4trd='R'
193090160218     c                   endif
193100160218     c* Immissione bolle: metto "M"=Manuale se non è bolla di recupero
193110160218     c                   when      not *in12
193120160218     c                   if        §3arbl<>'R'
193130160218     c                   eval      §b4trd='M'
193140160218     c                   endif
193150160218     c
193160160218     c                   endsl
193170050228    1C                   ENDIF
193180991203      *
193190991203      * SE MODIFICATA LA LNA E NON È PIÙ DPD AZZERO IL NUMERO PARCEL
193200060215      *  E CANCELLO Fiar4
193210991203    2C     *IN12         IFEQ      *ON
193220991203     C     *IN15         ANDEQ     *OFF
193230020319     C     A_§OGNTW      ANDNE     'DPD'
193240050228     c     *in79         andne     *on
193250061003     C***                MOVEL     'F'           WTRC
193260061003     C***  KBLP4         DELETE    Fiar4000                           30
193270060626     C***                CLEAR                   §B4FNP
193280061003     C***                CLEAR                   dsbl4f
193290060510     C                   MOVEL     'I'           WTRC
193300060510     C     KBLP4         DELETE    Fiar4000                           30
193310060626     C                   CLEAR                   dsbl4i
193320060510     C                   MOVEL     'K'           WTRC
193330060510     C     KBLP4         DELETE    Fiar4000                           30
193340060626     C                   CLEAR                   dsbl4k
193350991203    2C                   ENDIF
193360991203      *
193370060620      * SE C'E' NUMERO PARCEL SCRIVO RECORD "I" IN ar4
193380060620     c* Tipo rekord F
193390061003     c***                if        §b4fnp<>*blanks or savfnp<>*blanks
193400061003     C***                MOVEL     'T'           D19ftr
193410061003     C***                MOVEL     BLPAAS        D19AAS
193420061003     C***                MOVEL     BLPLNP        D19LNP
193430061003     C***                MOVEL     BLPNRS        D19NRS
193440061003     C***                MOVEL     BLPNSP        D19NSP
193450061003     C***                MOVEL     'F'           D19TRC
193460061003     C***                MOVEL(P)  DSBL4F        D19NT1
193470061003     C***                CLEAR                   D19NT2
193480061003     C***                CALL      'FNLV19R'
193490061003     C***                PARM                    DSLV19
193500061003     c***                endif
193510060620     c* Tipo record K
193520060620     c                   if        §b4krt<>*blanks or savkrt<>*blanks
193530060620     C                   MOVEL     'T'           D19ftr
193540060620     C                   MOVEL     BLPAAS        D19AAS
193550060620     C                   MOVEL     BLPLNP        D19LNP
193560060620     C                   MOVEL     BLPNRS        D19NRS
193570060620     C                   MOVEL     BLPNSP        D19NSP
193580060620     C                   MOVEL     'K'           D19TRC
193590060620     C                   MOVEL(P)  DSBL4K        D19NT1
193600060620     C                   CLEAR                   D19NT2
193610060620     C                   CALL      'FNLV19R'
193620060620     C                   PARM                    DSLV19
193630060620     c                   endif
193640060620     c* Tipo record I
193650060510    1C     §B4IPN        IFNE      *BLANKS
193660060616     C     SAVNPR        ORNE      *blanks
193670060510     c*
193680060510     C                   MOVEL     'T'           D19ftr
193690060510     C                   MOVEL     BLPAAS        D19AAS
193700060510     C                   MOVEL     BLPLNP        D19LNP
193710060510     C                   MOVEL     BLPNRS        D19NRS
193720060510     C                   MOVEL     BLPNSP        D19NSP
193730060510     C                   MOVEL     'I'           D19TRC
193740060510     C                   MOVEL(P)  DSBL4I        D19NT1
193750060510     C                   CLEAR                   D19NT2
193760060510     C                   CALL      'FNLV19R'
193770060510     C                   PARM                    DSLV19
193780061106     c* se sono in conferma bolle import dpd scrivo depot su DPPDC
193790061106     c* se manca
193800061107     c                   if        §b4ipn<>*blanks and *in79  and *in12
193810061107     c                             and *in15
193820061106     c                   clear                   truldepds
193830061106     c
193840061106     c                   if        %subst(§b4ipn:14:1) <> *blanks
193850061106     c                   movel     §b4ipn        idepdpc
193860061106     c                   else
193870061106     c                   eval      idepdpc='0'+%subst(§b4ipn:1:3)
193880150918     c                   endif
193890150918     c* Memorizzo il depot solo se numerico
193900150918     c* (E' capitato un depot AA00 che è poi stato utilizzato erroneamente
193910150918     c*  per un parcel number di una bolla export dpd e il collo è poi stato
193920150918     c*  smarrito)
193930150918     c                   if        %check(digits:idepdpc)=0
193940061106     c                   call      'TRULDEPR'
193950061106     c                   parm                    truldepds
193960061106     c                   if        odeperr='1'
193970151112     c     idepdpc       chain     dppdc01l
193980151112     c                   if        %found(dppdc01l)
193990151112     c                   z-add     20401231      pdcdsc
194000151112     c                   z-add     dateu         pdcdtv
194010151112     c                   time                    pdcorv
194020151112     c                   update    dppdc000
194030151112     c                   else
194040061106     c                   clear                   dppdc000
194050061106     c                   eval      pdcdpc=idepdpc
194060151112     c                   z-add     19900101      pdcdde
194070151112     c******             z-add     dateu         pdcdde
194080061106     c                   z-add     20391231      pdcdsc
194090061106     c                   z-add     dateu         pdcdtv
194100061107     c                   time                    pdcorv
194110061106     c                   movel     'FNLS01R'     pdcpru
194120061106     c                   write     dppdc000
194130151112     c                   endif
194140061106     c                   endif
194150150918     c                   endif
194160061106     c                   endif
194170991214     C**
194180991214     C* SCRIVO IL NUMERO DI PARCEL ANCHE NELLE NOTE
194190991214     C*
194200050405     c* se import dpd non lo devo fare lo faccio solo per export
194210060616     c                   clear                   dpdsta
194220060616     c                   clear                   dpdsta14         27
194230050405    2c     *in79         ifeq      *off
194240060626     c     §b4ipn        ifne      *blanks
194250060510     C***                MOVEL     §B4FNP        DPDPAR
194260060616     c                   if        %subst(§b4ipn:14:1)=*blanks
194270060510     c                   movel     §b4ipn        dpdpar
194280060510     c                   move      §b4icd        dpdpar
194290991214     C                   MOVEL     DPD1          DPDS1
194300991214     C                   MOVEL     DPD2          DPDS2
194310991214     C                   MOVEL     DPD3          DPDS3
194320991214     C                   MOVEL     CDPD          DPDCOS
194330060616     c                   else
194340060616     c                   eval      dpdsta14=cdpd+%subst(§b4ipn:1:4)+
194350060616     c                             ' '+%subst(§b4ipn:5:10)
194360060616     c                   endif
194370060626     c                   endif
194380991217     C* IN MANUTENZIONE CONTROLLO SE LE NOTE SONO QUELLE MESSE IN AUTOM
194390991217     C*  DEL PARCEL
194400991217     C     *IN12         IFEQ      *ON
194410991217     C     *IN15         ANDEQ     *OFF
194420991217     C                   MOVEL     VIDNT1        W012A            12
194430991217     C*
194440991217     C     W012A         IFEQ      CDPD
194450991217     C                   CLEAR                   VIDNT1
194460991217     C                   ENDIF
194470991217     C                   ENDIF
194480991217     C*
194490060626     c                   if        dpdsta<>*blanks or dpdsta14<>*blanks
194500060626    3C     VIDNT1        IFEQ      *BLANKS
194510060626    4c                   if        dpdsta<>*blanks
194520991214     C                   MOVEL(P)  DPDSTA        VIDNT1
194530060616     c                   else
194540060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
194550060626    4c                   endif
194560060626   x3C                   ELSE
194570991214     C                   MOVEL     VIDNT1        VIDNT2
194580060626    4c                   if        dpdsta<>*blanks
194590991214     C                   MOVEL(P)  DPDSTA        VIDNT1
194600060616     c                   else
194610060616     C                   MOVEL(P)  DPDSTa14      VIDNT1
194620060626    4c                   endif
194630060626    3C                   ENDIF
194640060626     c                   endif
194650050405    2c                   endif
194660991203    1C                   ENDIF
194670991117      *
194680010502      * SE BOLLA CON LNP DPD E NUM. DISTINTA NON IMPOSTATO DEVO:
194690991130      *  - RICAVARE IL NUMERO DISTINTA E MEMORIZZARLO IN RMA
194700000218      *  - CREARE IL FILE EVENTI DPD TRANNE PER BOLLE DI RECUPERO
194710060619     C     *IN79         IFEQ      *ON
194720080304     C***  BLPRMA        ANDEQ     *BLANKS
194730060619     c* solo per parcel number lungo 14 continuo a scrivere n.distinta
194740080304     c                   if        %subst(§b4ipn:14:1)=*blanks
194750080304     c                             and blprma=*blanks
194760060619     C                   EXSR      SPEDPD
194770060619     C                   MOVEL     DPDBRC        BLPRMA
194780060619     c                   endif
194790060619     C     §3ARBL        IFNE      'R'
194800060619     C                   EXSR      EVEDPD
194810060619     C                   ENDIF
194820060619     C                   ENDIF
194830010502     C*
194840010924      * MEMORIZZO IL RIF. ORM NEL RIF. MITTENTE ALFANUMERICO
194850010924      *  - SEMPRE SE QUELLO IN BOLLA E' VUOTO
194860010924      *  - SE ENTRAMBI PIENI SOLO SE IMPOSTATO L'APPOSITO FLAG SULL'ORM
194870010924      *  - MAI SE BOLLA DPD
194880040226if  1c                   If        worm = 'S' and
194890040226     c                             (Not *In79 or wrifm = *Off)
194900010924      *  PREPAGATO
194910010502    2C     PARTCH        IFEQ      'P'
194920010924      *
194930010502    3C     VIDMAG        IFNE      'S'
194940010924     C     BLPRMA        ANDEQ     *BLANKS
194950010502     C                   MOVEL     §RMRFA        BLPRMA
194960010502    3C                   ENDIF
194970010924      *
194980010502   X2C                   ELSE
194990010924      *  NO PREPAGATO
195000010502    3C     FLGFIT        IFNE      'S'
195010010924    4C     BLPRMA        IFEQ      *BLANKS
195020010502     C                   MOVEL     ORMRFA        BLPRMA
195030010924   X4C                   ELSE
195040010924    5C     ORMRFA        IFNE      *BLANKS
195050010924     C     §ORMFR        ANDEQ     'S'
195060010924     C                   MOVEL     ORMRFA        BLPRMA
195070010924    5C                   ENDIF
195080010924    4C                   ENDIF
195090010924    3C                   ENDIF
195100010924      *
195110010502    2C                   ENDIF
195120010924      *
195130010502    1C                   ENDIF
195140991214     C***
195150991214     C***  N O T E
195160060216     C                   MOVEL     'T'           D19ftr
195170991214     C                   MOVEL     BLPAAS        D19AAS
195180991214     C                   MOVEL     BLPLNP        D19LNP
195190991214     C                   MOVEL     BLPNRS        D19NRS
195200991214     C                   MOVEL     BLPNSP        D19NSP
195210991214     C                   MOVEL     VIDNT1        D19NT1
195220991214     C                   MOVEL     VIDNT2        D19NT2
195230991214     C     VIDNT1        IFNE      *BLANKS
195240991214     C     VIDNT2        ORNE      *BLANKS
195250991214     C                   MOVEL     '8'           D19TRC
195260991214     C                   CALL      'FNLV19R'
195270991214     C                   PARM                    DSLV19
195280991214     C                   ENDIF
195290991214     C**
195300991214     C* REIMPOSTO LE NOTE IN MANUTENZIONE
195310991214     C   12
195320991214     CANN15              MOVEL     D19NT1        VIDNT1
195330991214     C   12
195340991214     CANN15              MOVEL     D19NT2        VIDNT2
195350991214     C**
195360991214     C* IN MANUTENZIONE SE IL PGM MI RESTITUISCE LA 2 RIGA VUOTA,
195370991214     C* LA DELETO PERCHE' POTEVA PRIMA ESISTERE
195380991214     C   12
195390991214    1CANN15D19ERR        IFEQ      *BLANKS
195400991214     C     D19NT1        ANDNE     *BLANKS
195410991214     C     D19NT2        ANDEQ     *BLANKS
195420991214     C                   MOVEL     '9'           D19TRC
195430991214     C                   CLEAR                   D19NT1
195440991214     C                   CLEAR                   D19NT2
195450991214     C                   CALL      'FNLV19R'
195460991214     C                   PARM                    DSLV19
195470991214    1C                   ENDIF
195480991214     C* SE TORNATO CODICE DI ERRORE RICHIAMO IL PGM 2 VOLTE
195490991214     C* UNA VOLTA PER NOTA
195500991214    2C     D19ERR        IFNE      *BLANKS
195510991214    1C     *IN12         OREQ      *ON
195520991214     C     *IN15         ANDEQ     *OFF
195530991214     C     VIDNT1        ANDEQ     *BLANKS
195540991214     C     VIDNT2        ANDEQ     *BLANKS
195550991214     C* NOTA 1
195560991214     C                   MOVEL     '8'           D19TRC
195570991214     C                   MOVEL     VIDNT1        D19NT1
195580991214     C                   CLEAR                   D19NT2
195590991214     C                   CALL      'FNLV19R'
195600991214     C                   PARM                    DSLV19
195610991214     C* NOTA 2
195620991214     C                   MOVEL     '9'           D19TRC
195630991214     C                   MOVEL     VIDNT2        D19NT1
195640991214     C                   CLEAR                   D19NT2
195650991214     C                   CALL      'FNLV19R'
195660991214     C                   PARM                    DSLV19
195670991214    1C                   ENDIF
195680000508     C* DATI POSTE SOLO IN CONFERMA
195690140122     C**   *IN12         IFEQ      *ON
195700140122     C***  *IN15         ANDEQ     *ON
195710140122     C***  §ogntw        ANDEQ     'PPT'
195720000509     C* SE CE' IAS O XCO
195730140122     C***  §B4IAS        IFGT      0
195740140122     C**   §B4XCO        ORNE      ' '
195750140122     C**   §B4DSC        ORNE      *BLANKS
195760140122     C**                 CLEAR                   DSLV19
195770140122     C**                 MOVEL     'T'           D19ftr
195780140122     C**                 MOVEL     BLPAAS        D19AAS
195790140122     C**                 MOVEL     BLPLNP        D19LNP
195800140122     C**                 MOVEL     BLPNRS        D19NRS
195810140122     C**                 MOVEL     BLPNSP        D19NSP
195820140122     C**                 MOVEL     DSBL4J        D19NT1
195830140122     C**                 MOVEL     'J'           D19TRC
195840140122     C**                 CALL      'FNLV19R'
195850140122     C**                 PARM                    DSLV19
195860140122     C***                ENDIF
195870140122     C***                ENDIF
195880000623     C*
195890000623     C* SE ESISTE TABELLA 3Q, CREO RECORD VUOTO W
195900060217     c* Se sono in manutenzione aggiorno (azzero la data) solo se cambi
195910060217     c* ato codice
195920000623    1C     WES3Q         IFEQ      'S'
195930060217     c
195940060217     c                   if        *in12 = *off or *in15 = *on or
195950060217     c                             wksc <> savmit
195960000623     C*
195970060217     C                   CLEAR                   DSBL4W
195980060223     C                   CLEAR                   DSLV19
195990000623     C**
196000060217     C                   MOVEL     DSBL4W        d19nt1
196010060217     C                   MOVEL     BLPAAS        d19AAS
196020060217     C                   MOVEL     BLPLNP        d19LNP
196030060217     C                   MOVEL     BLPNRS        d19NRS
196040060217     C                   MOVEL     BLPNSP        d19NSP
196050060217     C                   MOVEL     'W'           d19TRC
196060060223     c                   movel     'T'           d19ftr
196070060217     c                   clear                   d19nt2
196080060217     c* se sono in manutenzione richiamo fnlv19r solo se cambiato codice
196090060217     C                   CALL      'FNLV19R'
196100060217     C                   PARM                    DSLV19
196110060217     c                   endif
196120000623     C*
196130000623   X1C                   ELSE
196140000623     C* SE ESISTEVA MA ADESSO NON ESISTE PIU' DEVO CANCELLARE IL RECORD
196150000623    2C     WBL4W         IFEQ      'E'
196160060223     c                   clear                   dslv19
196170060217     C                   clear                   d19nt1
196180060217     C                   MOVEL     BLPAAS        d19AAS
196190060217     C                   MOVEL     BLPLNP        d19LNP
196200060217     C                   MOVEL     BLPNRS        d19NRS
196210060217     C                   MOVEL     BLPNSP        d19NSP
196220060217     C                   MOVEL     'W'           d19TRC
196230060223     c                   movel     'T'           d19ftr
196240060217     c                   clear                   d19nt2
196250060217     C                   CALL      'FNLV19R'
196260060217     C                   PARM                    DSLV19
196270000623    2C                   ENDIF
196280000623    1C                   ENDIF
196290090325     C* Impostazione campi cliente/tariffa per tassazione porti assegnati
196300090805     c                   clear                   w_ar5ass
196310090325     c                   if        *in04
196320090325     c                   exsr      riewdwcli
196330091027     c                   select
196340091027     c                   when      flgfit<>'S' and ormpag='O'
196350090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
196360090806     c                                 %editc(ormksc:'X')
196370090806     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
196380090806     c                                 %subst(%editc(ormcor:'X'):1:7)
196390090804     c                   eval      w_ar5ass='T'
196400091027     c                   when      *in12 and *in15 and §lpass='T'
196410091027     c                   eval      w_ar5ass='T'
196420091027     c                   endsl
196430090325     c                   endif
196440091214     c* impostazione campo codice benefeiciario contrassegno
196450091214     c                   clear                   w_ar5cdi
196460091214     c                   select
196470091214     c                   when      wcassel2='X' and wwdwcas='S'
196480091214     c                   eval      w_ar5cdi=wcascor
196490091214     c                   when      *in12 and *in15 and §lpcdi>0
196500091214     c                   eval      w_ar5cdi=§lpcdi
196510091214     c                   endsl
196520090325     c*
196530010215     C* SE ATTIVATA PROCEDURA O.R.M. E NUMERO O.R.M. NON FITTIZIO LO
196540060215     C* MEMORIZZO SU Fiar4 TIPO RECORD "M"
196550060215      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
196560010925      * TIPO RECORD "Z" PER RITORNO VAS
196570010925    1C     WORM          IFEQ      'S'
196580010220     C     PARTCH        ANDNE     'P'
196590010228     C     WORM          OREQ      'S'
196600010228     C     VIDMAG        ANDNE     'S'
196610010713     C     §3ARBL        ANDNE     'R'
196620010215     C                   CLEAR                   DSLV19
196630060215     C                   MOVEL     'T'           D19ftr
196640010215     C                   MOVEL     BLPAAS        D19AAS
196650010215     C                   MOVEL     BLPLNP        D19LNP
196660010215     C                   MOVEL     BLPNRS        D19NRS
196670010215     C                   MOVEL     BLPNSP        D19NSP
196680010925    2C     FLGFIT        IFNE      'S'
196690010228     C     PARTCH        OREQ      'P'
196700010215     C  N12
196710010215     COR 12
196720010215     CAN 15              CLEAR                   DSBL4M
196730010925    3C     PARTCH        IFEQ      'P'
196740010228     C                   Z-ADD     §RMPOO        §B4POE
196750010228     C                   Z-ADD     §RMNSO        §B4NSR
196760010228     C                   Z-ADD     §RMNOO        §B4NOR
196770010228     C                   Z-ADD     §RMNRO        §B4NRV
196780010925   X3C                   ELSE
196790010215     C                   Z-ADD     WOPOE         §B4POE
196800010222     C                   Z-ADD     WONSR         §B4NSR
196810010222     C                   Z-ADD     WONOR2        §B4NOR
196820010215     C                   Z-ADD     WONRV         §B4NRV
196830010925    3C                   ENDIF
196840090325     c*
196850090325     c                   if        *in04
196860090325     c                   eval      §b4clg=wclg
196870090325     c                   endif
196880151104     c* Se bolla abbinata ad orm manuale
196890151104     c* memorizzo che sarà da addebitare l'orm telefonico, l'addebito
196900151104     c* Se ad un ORM abbino più spedizioni SOLO su una bisogna
196910151104     c* memorizzare l'addebito
196920151104     c                   exsr      sr_b4ado
196930151117     c                   eval      §b4ado=w_§b4ado
196940010221     C*
196950010925     C                   MOVEL     'M'           D19TRC
196960010215     C                   MOVEL     DSBL4M        D19NT1
196970010215     C                   CALL      'FNLV19R'
196980010215     C                   PARM                    DSLV19
196990060216      * SE IMPOSTATO APPOSITO FLAG IN ORMFLO MEMORIZZO ORMKSC IN Fiar4
197000010925      * TIPO RECORD "Z" PER RITORNO VAS
197010121123    3c                   if        not *in12 or *in15
197020121123    4C     §ORMKS        IFEQ      'S'
197030040319     C     ORMKSC        ANDGT     *ZEROS
197040010925     C                   MOVEL     'Z'           D19TRC
197050010925     C                   CLEAR                   D19NT1
197060010925     C                   CLEAR                   D19NT2
197070010925     C                   CLEAR                   D19ERR
197080010927     C                   CLEAR                   DSBL4Z
197090010925     C                   MOVEL     ORMKSC        §B4OKC
197100010925     C                   MOVEL     DSBL4Z        D19NT1
197110010925     C                   CALL      'FNLV19R'
197120010925     C                   PARM                    DSLV19
197130121123    4C                   ENDIF
197140121123   x3c                   else
197150121122     c* in manutenzione verifico se modificare cancellare o aggiungere ar4 trk Z
197160130219     c* . . . se situazione invariata non faccio nulla
197170130219     c                   clear                   wnoZ              1
197180130219    4c                   if        wesar4z='S' and §ormks='S'
197190130219     c                             and wkscz=ormksc
197200130219     c                   eval      wnoZ='N'
197210130219    4c                   endif
197220130219    4c                   if        wnoz=*blanks  and
197230130219     c                             (wesar4z='S' and wtrasmz='N' or
197240130219     c                             (§ormks='S' and ormksc>*zeros))
197250121123     C                   MOVEL     'Z'           D19TRC
197260121123     C                   CLEAR                   D19NT1
197270121123     C                   CLEAR                   D19NT2
197280121123     C                   CLEAR                   D19ERR
197290121123     C                   CLEAR                   DSBL4Z
197300121122
197310121123    5c                   select
197320121123     c* era presente tipo record "Z"  ma ora non più : cancella se non trasmesso
197330121123     c                   when      wesar4z='S' and §ormks<>'S'
197340121126     c* era presente tipo record "Z" prima e adesso ma cliente diverso: aggiorna
197350121126     c* a sflagga per la ritrasmissione
197360121123     c                   when      wesar4z='S' and §ormks='S' and ormksc>*zeros
197370121123     c                             and wkscz<>ormksc
197380121123     C                   MOVEL     ORMKSC        §B4OKC
197390121126     C                   clear                   §B4dtr
197400121123     C                   MOVEL     DSBL4Z        D19NT1
197410121123     c* non era presente tipo record "Z" e ora si: scrive nuovo "Z"
197420121123     c                   when      wesar4z<>'S'
197430121123     C                   MOVEL     ORMKSC        §B4OKC
197440121123     C                   MOVEL     DSBL4Z        D19NT1
197450121123    5c                   endsl
197460121123     C                   CALL      'FNLV19R'
197470121123     C                   PARM                    DSLV19
197480121123    4c                   endif
197490121123    3c                   endif
197500010925      *--
197510010925   X2C                   ELSE
197520010925      *--
197530010215     C* SE SONO IN MANUTENZIONE E N. O.R.M. FITTIZIO DEVO CANCELLARE
197540060215     C* ar4 CON TIPO RECORD "M" E "Z" SE PRESENTI
197550010925    3C     *IN12         IFEQ      *ON
197560010215     C     *IN15         ANDEQ     *OFF
197570010925     C                   MOVEL     'M'           D19TRC
197580010215     C                   CALL      'FNLV19R'
197590010215     C                   PARM                    DSLV19
197600121127     c* Record "Z" lo cancello solo se non trasmesso.
197610121127     c* Se invece era stato trasmesso non lo cancello per mantenere traccia di
197620121127     c* quello che era stato fatto
197630121127     c                   if        wesar4z='S' and wtrasmz='N'
197640010925     C                   MOVEL     'Z'           D19TRC
197650010925     C                   CALL      'FNLV19R'
197660010925     C                   PARM                    DSLV19
197670121127     c                   endif
197680040319      * cancello anche il record 'A'
197690040319      * ma solo se prima dell'ORM fittizio era impostato un ORM reale
197700040319      * e lo so testando il flag wmodorm impostato nella ctrorm
197710040319if  4c                   If        wmodorm = *On
197720040319     c                   Movel     'A'           d19trc
197730040319     c                   Call      'FNLV19R'
197740040319     c                   Parm                    dslv19
197750040319e   4c                   EndIf
197760010925    3C                   ENDIF
197770010925      *
197780010925    2C                   ENDIF
197790010925    1C                   ENDIF
197800090325     c*
197810090325     c* memorizzo ksc/ctr per p.assegnati
197820090325     c                   if        *in04
197830090325     c                   Clear                   dsbl4a
197840090325     c                   Clear                   dslv19
197850090325     C                   MOVEL     'T'           D19ftr
197860090325     C                   MOVEL     BLPAAS        D19AAS
197870090325     C                   MOVEL     BLPLNP        D19LNP
197880090325     C                   MOVEL     BLPNRS        D19NRS
197890090325     C                   MOVEL     BLPNSP        D19NSP
197900090325     c                   Movel     'A'           d19trc
197910090327     c                   if        wcliksc>0
197920090327     c                   z-add     wcliksc       §b4aks
197930090326     C                   IF        wclictr<>*blanks
197940090325     c                   move      wclictr       §b4act
197950090325     c                   endif
197960090325     c                   exsr      sr_fncls
197970090325     c                   move      wclsflo8      §b4af1
197980090325     c                   Movel     dsbl4a        d19nt1
197990090325     c                   Call      'FNLV19R'
198000090325     c                   Parm                    Dslv19
198010090325     c                   endif
198020090325     c                   endif
198030110706     c* memorizzo CUP/CIG se presenti
198040110706     c                   if        wcupcup<>*blanks or wcupcig<>*blanks
198050110706     c                   Clear                   dsbl44
198060110706     c                   Clear                   dslv19
198070110706     C                   MOVEL     'T'           D19ftr
198080110706     C                   MOVEL     BLPAAS        D19AAS
198090110706     C                   MOVEL     BLPLNP        D19LNP
198100110706     C                   MOVEL     BLPNRS        D19NRS
198110110706     C                   MOVEL     BLPNSP        D19NSP
198120110706     c                   Movel     '4'           d19trc
198130110706     c                   movel     wcupcup       §b44cup
198140110706     c                   movel     wcupcig       §b44cig
198150110706     c                   Movel     dsbl44        d19nt1
198160110706     c                   Call      'FNLV19R'
198170110706     c                   Parm                    Dslv19
198180110706     c                   else
198190110706     c                   if        *in12 and not *in15
198200110706     c                   Clear                   dslv19
198210110706     C                   MOVEL     'T'           D19ftr
198220110706     C                   MOVEL     BLPAAS        D19AAS
198230110706     C                   MOVEL     BLPLNP        D19LNP
198240110706     C                   MOVEL     BLPNRS        D19NRS
198250110706     C                   MOVEL     BLPNSP        D19NSP
198260110706     c                   Movel     '4'           d19trc
198270110706     c                   Call      'FNLV19R'
198280110706     c                   Parm                    Dslv19
198290110706     c                   endif
198300110706     c                   endif
198310150128
198320150128     c* Località normalizzata
198330150210     c                   if        blplod<>wLocNorm
198340150210     c                             or (*in12 and not *in15)
198350150128     c                   Clear                   dslv19
198360150128     C                   MOVEL     'T'           D19ftr
198370150128     C                   MOVEL     BLPAAS        D19AAS
198380150128     C                   MOVEL     BLPLNP        D19LNP
198390150128     C                   MOVEL     BLPNRS        D19NRS
198400150128     C                   MOVEL     BLPNSP        D19NSP
198410150128     c                   Movel     'X'           d19trc
198420150210     c                   if        blplod<>wlocnorm
198430150128     c                   movel     wLocNorm      d19nt1
198440150210     c                   else
198450150210     c                   clear                   d19nt1
198460150210     c                   endif
198470150128     c                   Call      'FNLV19R'
198480150128     c                   Parm                    Dslv19
198490150210     c                   endif
198500150128
198510130305     c* F I A R 8
198520130924     c                   eval      aggioAr8='S'
198530130924     c                   exsr      sr_gesar8
198540130305     c* F I A R 5
198550030805      * se bolla con bancali - part. varia "B"
198560021218      * scrivo o aggiorno il file estensione FIAR500F record "BAN"
198570030704     c                   If        %subst(VidGva:1:1) = 'B'
198580021218     c                   Clear                   DAr5Ban
198590030704     c                   Eval      Kar5Trd = 'BAN'
198600021218     c     KFiar5        Chain     Fiar501l
198610021218     c                   Move      Dateu         Ar5Dac
198620021218     c                   Movel     W0140         Ar5Orc
198630021218     c                   Movel     VidTba        §Ar5Tba
198640021218     c                   Eval      §Ar5Nba = VidNba
198650021218     c                   Movel     VidTb2        §Ar5Tb2
198660021218     c                   Eval      §Ar5Nb2 = VidNb2
198670021218     c                   Movel(p)  DAr5Ban       Ar5Uni
198680030704     c                   ExSr      Sr_wrtFiar5
198690021218     c                   EndIf
198700030805      * se bolla con bancali - part. varia "O"
198710030704      * scrivo o aggiorno il file estensione FIAR500F record "BNB"
198720030730      * se non richiamto da giacenze
198730031125     c                   If        %subst(VidGva:1:1) = 'O'
198740030704     c                   Clear                   DAr5Bnb
198750030704     c                   Eval      Kar5Trd = 'BNB'
198760030704     c     KFiar5        Chain     Fiar501l
198770030704     c                   Move      Dateu         Ar5Dac
198780030704     c                   Movel     W0140         Ar5Orc
198790030704     c                   Movel     VidTba        §Ar5bTba
198800030704     c                   Eval      §Ar5bNba = VidNba
198810030704     c                   Movel     VidTb2        §Ar5bTb2
198820030704     c                   Eval      §Ar5bNb2 = VidNb2
198830030704     c                   Eval      §Ar5bCor = w03cor
198840030704     c                   Eval      §Ar5bCsf = w03csf
198850030704     c                   Movel(p)  DAr5Bnb       Ar5Uni
198860030704     c                   ExSr      Sr_wrtFiar5
198870030704     c                   EndIf
198880030805      * se bolla con paricolarità consegna "RC"
198890030805      * scrivo o aggiorno il file estensione FIAR500F record "RCC"
198900030912      * solo se non sono richiamata da giacenze
198910100604     c**                 If        VidGma = 'RC' and
198920100604     c                   If        §7rRC  = 'S'  and
198930030912     c                             savfpr <> 'G' and savfpr <> 'P'
198940150302     c                             and savfpr <> 'B'
198950091124      * Aggiorno l'ORM se sono in immissione
198960091124     c                   If        Not *In12 or
198970091124     c                             (*In12 and *In15)
198980091221      * oppure aggiornamento ed inserito "RC"
198990100604     c                             or (*in12 and Not *in15 and w7rRC <> 'S')
199000091124     c                   Eval      wope = 'A'
199010091124     c                   ExSr      Sr_Ricorm
199020030805     c                   Clear                   DAr5Rcc
199030030805     c                   Eval      Kar5Trd = 'RCC'
199040030805     c     KFiar5        Chain     Fiar501l
199050030805     c                   Move      Dateu         Ar5Dac
199060030805     c                   Movel     W0140         Ar5Orc
199070030805     c                   Eval      §Ar5rPoe = savOrmPoe
199080030805     c                   Eval      §Ar5rNsr = savOrmNsr
199090030805     c                   Eval      §Ar5rNor = savOrmNor
199100030805     c                   Eval      §Ar5rNrv = savOrmNrv
199110030805     c                   Movel(p)  DAr5Rcc       Ar5Uni
199120030805     c                   ExSr      Sr_wrtFiar5
199130091221     c                   EndIf
199140030805     c                   EndIf
199150031113      * Se inseriti il referente o il n. di telefono devo memorizzarli
199160031113      * nel FIAR500F record "GEN"
199170040610      * Idem per tipo merce v-valore
199180090804      * Idem se bolla in assegnato con triangolazione
199190110527      * 27/05/11 Ci sarà sempre il record GEN, quindi chaino sempre e scrivo o
199200110527      *          aggiorno
199210110527if  1c****               If        VidRef <> *Blanks or VidTel <> *Blanks
199220110527     c****                         or vidbva <> *blanks  or w_ar5ass='T'
199230110527     c****                         or w_ar5tcp<>*blanks or w_ar5tic<>*blanks
199240110527     c****                         or ar9tic<>*blanks or
199250110527     c****                         w_ar5cdi>0 or not *in12 or *in15
199260031113     c                   Clear                   DAr5Gen
199270031113     c                   Eval      Kar5Trd = 'GEN'
199280031113     c     KFiar5        Chain     Fiar501l
199290031114if  2c                   If        Not %Found(Fiar501l)
199300160225     c***                Move      Dateu         Ar5Dac
199310160225     c***                Movel     W0140         Ar5Orc
199320160225     c                   eval      ar5dac=%dec(%date())
199330160225     c                   eval      ar5orc=%dec(%time())
199340110527     c                   eval      §ar5bpru=knmus
199350110527     c                   eval      §ar5bnmtd=knmtd
199360031114     c                   Eval      §Ar5Ref = VidRef
199370031114     c                   Eval      §Ar5Teld = VidTel
199380140416     c* se numero di telefono vuoto ma è presente l'sms, quest'ultimo lo copio
199390140416     c* anche in §arteld
199400150213     c***                if        §ar5teld=*blanks
199410150213     c***                eval      §Ar5Teld = wsms
199420150213     c***                endif
199430040610     c                   Eval      §Ar5bva = Vidbva
199440090804     c                   Eval      §Ar5ass = w_ar5ass
199450091001     c                   Eval      §Ar5tcp = w_ar5tcp
199460091001     c                   Eval      §Ar5tic = w_ar5tic
199470091104     c                   Eval      §Ar5tici =ar9tic
199480091214     c                   if        w_ar5cdi>0
199490091214     c                   Eval      §Ar5CDI  =%editc(w_ar5cdi:'X')
199500091119     c                   else
199510091119     c                   clear                   §ar5cdi
199520091118     c                   endif
199530130308     c                   eval      §ar5alx=w_allx
199540130408     c                   eval      §ar5alm=w_allm
199550130417     c                   eval      §ar5als=w_alls
199560140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
199570140407     c* nazione mittente italia
199580140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
199590140407     c                             blpnzm=*blanks
199600140403     c                   eval      §AR5PK2='S'
199610140403     c                   else
199620140403     c                   clear                   §AR5PK2
199630140403     c                   endif
199640160225     c                   if        w_aDpd='S'
199650160225     c                   eval      §ar5fdpd='S'
199660160225     c                   endif
199670031113     c                   Movel(p)  DAr5Gen       Ar5Uni
199680031113     c                   ExSr      Sr_wrtFiar5
199690031114   x2c                   Else
199700040610     c                   movel     ar5uni        DAr5Gen
199710031114     c                   Eval      §Ar5Ref = VidRef
199720031114     c                   Eval      §Ar5Teld = VidTel
199730040610     c                   eval      §ar5bva = vidbva
199740090804     c                   Eval      §Ar5ass = w_ar5ass
199750091001     c                   Eval      §Ar5tcp = w_ar5tcp
199760091001     c                   Eval      §Ar5tic = w_ar5tic
199770091104     c                   Eval      §Ar5tici =ar9tic
199780091214     c                   if        w_ar5cdi>0
199790091214     c                   Eval      §Ar5cdi  =%editc(w_ar5cdi:'X')
199800091119     c                   else
199810091119     c                   clear                   §ar5cdi
199820091118     c                   endif
199830140407     c* la pickup2 la imposto solo se non è consegna a magazzino e
199840140407     c* nazione mittente italia
199850140407     c                   if        comgf2<>'01' and blpfdn=*blanks and
199860140407     c                             blpnzm=*blanks
199870140403     c                   eval      §AR5PK2='S'
199880140403     c                   else
199890140403     c                   clear                   §AR5PK2
199900140403     c                   endif
199910031113     c                   Movel(p)  DAr5Gen       Ar5Uni
199920031113     c                   Update    Fiar5000
199930031114    2c                   EndIf
199940110527    1c****               EndIf
199950130918     c* Impostazione campo §ar5mmp - "S"=Invio mail per avviso merce partita
199960130923     c* In conferma bolle dipende da quello che ho ricevuto nel vat
199970130923    1c                   if        *in12 and *in15
199980130918     c                   clear                   wmmp_ar5
199990130923    2c                   if        wemdest <> *blanks  and
200000130930     c                             (wmmp<>'N' or §ar5alm='S')
200010130918     c                   eval      wmmp_ar5='S'
200020130923    2c                   endif
200030130923   x1c                   else
200040130923     c* In manutenzione bolle se eliminato indirizzo email abblenco campo per
200050130923     c* invio mail per avviso merce partita
200060130923    2c                   if        *in12 and not *in15
200070130923     c                             and wemdest=*blanks
200080130923     c                   clear                   wmmp_ar5
200090130923    2c                   endif
200100130923    1c                   endif
200110140424     c* Pulizia fla invo sms merce partita se manca numero cell.
200120160126     c* oppure se già previsto invio della mail purchè non sia espressamente
200130160126     c* richiesto il doppio invio (mail+sms) come da tab.cli
200140140424     c                   if        wsms=*blanks
200150160126     c                             or (wmmp_ar5='S' and §cliemsms<>'S')
200160140424     c                   clear                   wsmp
200170140424     c                   endif
200180110512      * Indirizzo email destinatario
200190110512      * scrivo o aggiorno il file estensione FIAR500F record "EMD"
200200130315     c                   If        wemdest <> *blanks  or wsms<>*blanks
200210110512     c                   Clear                   DAr5emd
200220110512     c                   Eval      Kar5Trd = 'EMD'
200230110512     c     KFiar5        Chain     Fiar501l
200240110613if  2c                   If        Not %Found(Fiar501l)
200250110512     c                   Move      Dateu         Ar5Dac
200260110512     c                   Movel     W0140         Ar5Orc
200270110512     c                   Movel     wemdest       §Ar5eml
200280130315     c                   movel     wsms          §ar5tel
200290130315     c                   movel     wsmp          §ar5smp
200300130918     c                   movel     wmmp_ar5      §ar5mmp
200310110512     c                   Movel(p)  DAr5emd       Ar5Uni
200320110512     c                   ExSr      Sr_wrtFiar5
200330110613     c                   else
200340110613     c                   movel     ar5uni        DAr5emd
200350110613     c                   Movel     wemdest       §Ar5eml
200360130315     c                   movel     wsms          §ar5tel
200370130315     c                   movel     wsmp          §ar5smp
200380130918     c                   movel     wmmp_ar5      §ar5mmp
200390111012     c                   Movel(p)  DAr5Emd       Ar5Uni
200400110613     c                   Update    Fiar5000
200410110613     c                   endif
200420110512     c                   EndIf
200430040610      * Se non sono inseriti il referente e il n. di telefono e v-valore
200440031114      * e sono in manutenzione cancello il FIAR500F record "GEN"
200450110527if  1c****               If        *In12 and Not *In15 and
200460110527     c*****                        VidRef = *Blanks and VidTel = *Blanks
200470110527     c*****                        and vidbva = *blanks
200480110527     c*****                        and w_ar5ass=*blanks
200490110527     c******                       and w_ar5tcp=*blanks
200500110527     c******                       and w_ar5tic=*blanks
200510110527     c******                       and ar9tic=*blanks
200520110527     c*****                        and w_ar5cdi=0
200530110527     c*****              Eval      Kar5Trd = 'GEN'
200540110527     c**** KFiar5        Chain     Fiar501l
200550110527     c****               If        %Found(Fiar501l)
200560110527     c****               Delete    Fiar5000
200570110527     c****               EndIf
200580110527    1c****               EndIf
200590030805      * se sono in manutenzione bolla e non c'è la particolarità
200600021218      * varie "B" controllo se c'è il record in FIAR500F record "BAN"
200610021218      * se c'è è da cancellare
200620030127     c                   If        *In12 and Not *In15 and
200630030704     c                             %Subst(BlpGva:1:1) <> 'B'
200640030704     c                   Eval      Kar5Trd = 'BAN'
200650021218     c     KFiar5        Chain     Fiar501l
200660021218     c                   If        %Found(Fiar501l)
200670021218     c                   Delete    Fiar5000
200680021218     c                   EndIf
200690021218     c                   EndIf
200700030805      * se sono in manutenzione bolla e non c'è la particolarità
200710030704      * varie "O" controllo se c'è il record in FIAR500F record "BNB"
200720030704      * se c'è è da cancellare
200730030704     c                   If        *In12 and Not *In15 and
200740030704     c                             %Subst(BlpGva:1:1) <> 'O'
200750030704     c                   Eval      Kar5Trd = 'BNB'
200760030704     c     KFiar5        Chain     Fiar501l
200770030704     c                   If        %Found(Fiar501l)
200780030704     c                   Delete    Fiar5000
200790030704     c                   EndIf
200800030704     c                   EndIf
200810030807      * se sono in manutenzione bolla e non c'è la particolarità
200820030807      * consegna "RC" controllo se c'è il record in FIAR500F record "RCC"
200830030807      * se c'è è da cancellare
200840030807     c                   If        *In12 and Not *In15 and
200850100604     c                             §7rRC  <> 'S'
200860100604     c***                          BlpGma <> 'RC'
200870030807     c                   Eval      Kar5Trd = 'RCC'
200880030807     c     KFiar5        Chain     Fiar501l
200890030807     c                   If        %Found(Fiar501l)
200900030807     c                   Delete    Fiar5000
200910030807     c                   EndIf
200920030807     c                   EndIf
200930110512      * In msanutenzine cancello fiar5 rcd EMD se è stato eliminato
200940150213if  1c*                  If        *In12 and Not *In15 and
200950150213     c*                            wemdest = *blanks  and atremd=*blanks
200960150213     c*                            and wsms=*blanks
200970150213     c*                  Eval      Kar5Trd = 'EMD'
200980150213     c*    KFiar5        Chain     Fiar501l
200990150213     c*                  If        %Found(Fiar501l)
201000150213     c*                  Delete    Fiar5000
201010150213     c*                  EndIf
201020150213    1c*                  EndIf
201030061213     c*
201040061213     C                   CLEAR                   WABLT
201050071221     C                   CLEAR                   WAgglna           1
201060071221    0c                   if        *in12 and not *in15
201070071221   0Ac                   if        §1bfg6='C' and savlna<>vidlna and
201080071221     c                             §clidkb='S'
201090071221     c                   eval      wagglna='S'
201100071221  x0Ac                   else
201110071221     C*  12
201120071221    1C*ANN15BLPFNS        IFEQ      ' '
201130071221    1c     blpfns        ifeq      ' '
201140061213     C     BLPNCD        ANDNE     0
201150061213     C     §1BFG8        ANDNE     'N'
201160061213     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
201170061213     C     §1BFG8        OREQ      'N'
201180061213     C**
201190061213     C* VEDO SE CANCELLARE LE SPUNTE ENTRATA:
201200061213     C* 1) SE FG8 = N SEMPRE
201210061213     C* 2) SE MODIFICATA LA LNA SEMPRE
201220061213     C* 3) SE AUMENTATO IL NUMERO DEI COLLI SOLO SE FG6 =D O I
201230061213     C* 4) SE DIMINUITO IL NUMERO DEI COLLI SOLO PER GLI ULTIMI
201240061213     C                   MOVEL     'S'           WDELBR            1
201250061213     C                   MOVEL     'S'           WABLT             1
201260061213    2C                   SELECT
201270061213     C     §1BFG8        WHENEQ    'N'
201280061213     C     SAVLNA        ORNE      VIDLNA
201290061213     C                   Z-ADD     99999         WCONTC            5 0
201300061213     C*
201310061213     C     SAVNCL        WHENLT    VIDNCL
201320061213     C     §1BFG6        ANDEQ     'D'
201330061213     C     SAVNCL        ORLT      VIDNCL
201340061213     C     §1BFG6        ANDEQ     'I'
201350061213     C                   Z-ADD     99999         WCONTC            5 0
201360061213     C*
201370061213     C     SAVNCL        WHENGT    VIDNCL
201380061213     C     §1BFG6        ANDEQ     'D'
201390061213     C     SAVNCL        ORGT      VIDNCL
201400061213     C     §1BFG6        ANDEQ     'I'
201410061213     C                   CLEAR                   WCONTC
201420061213     C     SAVNCD        WHENNE    BLPNCD
201430061213     C     SAVNCA        ORNE      BLPNCA
201440061213     C                   MOVEL     'N'           WDELBR            1
201450061213   X2C                   OTHER
201460061213     C                   MOVEL     'N'           WDELBR            1
201470061213     C                   MOVEL     'N'           WABLT
201480061213    2C                   ENDSL
201490061213    1c                   endif
201500071221   0Ac                   endif
201510071221    0c                   endif
201520061213     c* In manutenzione bolle , se riscrivo  fnblt devo clearare blpncr/ncp
201530061213    1c                   if        *in12 and not *in15
201540061213    2c                   if        wablt='S'
201550061213     c                   clear                   blpncr
201560061213     c                   clear                   blpncp
201570061213     c                   clear                   blpvlc
201580061213     c                   clear                   blppkc
201590061213   x2c                   else
201600061213     c* Se già calcolato volume cml devo reimpostarlo su VLF
201610061213    3c                   if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
201620061213     c                   clear                   dslv20
201630061213     C                   MOVEL     'P'           D20TBO
201640061213     C                   MOVEL     'C'           D20TVL
201650061213     c                   movel     'L'           d20tla
201660061213     C                   MOVEL     BLPvlc        D20vlu
201670061213     C                   MOVEL     BLPncr        D20ncr
201680061213     C                   MOVEL     BLPFVF        D20FVF
201690061213     C                   MOVEL     BLPVLF        D20VLF
201700061213     C                   MOVEL     BLPFVB        D20FVB
201710061213     C                   MOVEL     BLPVLB        D20VLB
201720061213     C                   MOVEL     BLPAAS        D20AAS
201730061213     C                   MOVEL     BLPLNP        D20LNP
201740061213     C                   MOVEL     BLPNRS        D20NRS
201750061213     C                   MOVEL     BLPNSP        D20NSP
201760061213     C                   MOVEL     BLPCBO        D20CBO
201770061213     C                   MOVEL     BLPNCL        D20NCL
201780061213    4C     BLPDBR        IFGT      *ZEROS
201790061213     C                   MOVE      BLPDBR        D20DTE
201800061213     C                   ELSE
201810061213     C                   MOVE      BLPMGS        D20DTE
201820061213     C                   MOVEL     BLPAAS        D20DTE
201830061213    4C                   END
201840061213     C                   MOVEL     DSLV20        KPJBU
201850061213     C*
201860061213     C                   CALL      'FNLV20R'
201870061213     C                   PARM                    KPJBA
201880061213     c                   parm      'N'           pwstor            1
201890061213     C*
201900061213     C                   MOVEL     KPJBU         DSLV20
201910061213     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
201920061213    4C     D20ERR        IFNE      '1'
201930061213     C                   MOVEL     D20FVF        BLPFVF
201940061213     C                   MOVEL     D20VLF        BLPVLF
201950061213E   4C                   ENDIF
201960061213    3c                   endif
201970061213    2c                   endif
201980061213    1c                   endif
201990070403     c*
202000070403     c                   exsr      sr_fiarg
202010070604     c*
202020070529     c* manutenzione di un prepagato ed è stato variato l'importo fattura
202030070529     c* eseguo operazioni per invio dati a PDA
202040070601    1c                   if        *in12 and *in15='0' and *in22
202050080213     c                             and vidimv<>savimvo and s_§ogpdaorm<>*blanks
202060070529     c                             and (ormfao=400 or ormfao=410)
202070070604     c                   exsr      sr_pda
202080070601    1c                   endif
202090111026     c* Richiamo pgm per scrittura R.A. in caso di manutenzione con
202100111026     c* riassegnazione segnacolli
202110111026     c                   if        RA_ncl>0
202120111026     c                   exsr      sr_wrtRA
202130111026     c                   endif
202140040601     c
202150151014     c* Se bolla tassata fino all'imponibile o eliminata precedente tassazione
202160151014     c* scrivo/aggiorno fiar5 record "FAT" in ambiente di sede
202170151014     c                   if        (vidimv>0 and vidimv<>savimv_fat) or
202180151014     c                             (vidimv=0 and war61='E')
202190151117     c                   if        %open(fiar531c)
202200151117     c                   exsr      regpesivol
202210151117     c                   endif
202220151015     c                   endif
202230151023     c* se bolla franco import DPD verifico cod. tariffa da utilizzare
202240151023     c                   if        not *in04 and §ogntw='DPD'
202250151023     c                   clear                   fieulpdds
202260151023     c                   eval      ILPDLNP   =blplnp
202270151023     c                   eval      ILPDLNA   =blplna
202280151023     c                   eval      ILPDPARCEL=§b4ipn
202290151023     c                   eval      ILPDHUBP  =§OGHB1
202300151023     c                   eval      ILPDDEPP  =§OGDP1
202310151023     c                   eval      ILPDHUBA  =a_§OGHB1
202320151023     c                   eval      ILPDDEPA  =a_§OGDP1
202330151023     c                   call      'FIEULPDR'
202340151023     c                   parm                    fieulpdds
202350151023     c                   eval      blpctr=OLPDTAR
202360151023
202370151023     c                   endif
202380950713     C**
202390950713     C* W R I T E   I N   F N B L P 0 0 F
202400950713     C   12
202410950713     CAN 15
202420950713     CORN12              WRITE     FNBLP000
202430950713     C* SE MANUTENZIONE AGGIORNO
202440950713     C   12
202450950713     CANN15              UPDATE    FNBLP000
202460081014     c                   if        *in12 and *in15 and §3cabd_s<>' '
202470081014     c                   clear                   trtc86drds
202480081020     c                   eval      i86mod='UV'
202490081020     c                   z-add     §fgs          i86fgsv
202500081020     c                   z-add     §lpaac        i86aasv
202510081014     c                   z-add     §lplnp        i86lnpv
202520081014     c                   z-add     §lpnrs        i86nrsv
202530081014     c                   z-add     §lpnsp        i86nspv
202540081014     c                   z-add     §lpccm        i86ccmv
202550081014     c                   z-add     §lprmn        i86rmnv
202560081014     c                   move      §lprma        i86rmav
202570081014     c                   z-add     blpaas        i86aasb
202580081014     c                   z-add     blplnp        i86lnpb
202590081014     c                   z-add     blpnrs        i86nrsb
202600081014     c                   z-add     blpnsp        i86nspb
202610081017     c                   if        blpccm>0
202620081014     c                   z-add     blpccm        i86ccmb
202630081017     c                   else
202640081017     c                   z-add     blpksc        i86ccmb
202650081017     c                   endif
202660081014     c                   z-add     blprmn        i86rmnb
202670081014     c                   move      blprma        i86rmab
202680081014     c                   call      'TRTC86DRR'
202690081014     c                   parm                    trtc86drds
202700081014     c                   endif
202710110902     c* Se valore di accorpamento spedizioni in consegna non valido invio
202720110902     c* email a CED
202730110902     c                   if        werrxco=*on
202740110902     c                   exsr      sr_mail
202750110902     c                   endif
202760971215     C**
202770971215     C** VERIFICO SE C'E' ETICHETTA ESTERA DA STAMPARE
202780081008     C**                 CLEAR                   WESTER
202790000204     C* ANCHE PER DPD
202800081008     C**   A_§OGNTW      IFEQ      'DPD'
202810040525     c* se ogsea = "S" significa che l'etichetta estera viene stampata in
202820040525     c* arrivo e quindi lascio wester = blanks
202830081008     c***  A_§ogsea      andne     'S'
202840081008     C***                MOVEL     'S'           WESTER
202850081008     C***                ENDIF
202860001024     C* MANUTENZIONE: SE MODIFICATA DATA SPEDIZIONE AGGIORNO LA DATA
202870001024     C*               ANCHE SU FISGN
202880001024     C   12
202890001024     CANN15BLPDSP        IFNE      WBDSP
202900001024     C     §3CDKC        IFEQ      'S'
202910001024     C     *IN79         ANDEQ     *ON
202920001024     C     §1BF12        ORNE      'N'
202930001106     C     §1BF12        ANDNE     'E'
202940001106     C     §1BF12        OREQ      'E'
202950001106     C     WASDKC        ANDEQ     'S'
202960001024     C     KBLP3         SETLL     FISGN05L
202970001024     C     KBLP3         READE     FISGN05L                               30
202980001024     C     *IN30         DOWEQ     *OFF
202990001024     C                   MOVE      BLPMGS        §LDMGS
203000010326     C                   Z-ADD     BLPTFA        §LDTNA
203010121213     c* Non serve più anzi crea problemi nel caso di fisgn duplicato su altro
203020121213     c* tfp.
203030121213     C***                Z-ADD     BLPTFP        SGNTNP
203040010116     C                   CLEAR                   SGNT6A
203050010116     C                   CLEAR                   SGNT6B
203060010116     C                   CLEAR                   SGNT6C
203070010116     C                   CLEAR                   SGNT6D
203080010116     C                   CLEAR                   SGNT6E
203090010116     C                   CLEAR                   SGNT6F
203100080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
203110001024     C                   UPDATE    FISGN005
203120001024     C     KBLP3         READE     FISGN05L                               30
203130001024     C                   ENDDO
203140001024     C                   ENDIF
203150001024     C                   ENDIF
203160000908     C*
203170000908     C* PER DISK C INSERITO CON DAL AL LO DEVO ESPLODERE
203180001009     C* (TEORICAMENTE DOVREI ESCLUDERE EXPORT DPD SE CHI SONO IMMESSO
203190001009     C* MANUALMENTE O DA RMN IN PRATICA ESCLUDO SEMPRE SE SI TRATTA
203200001009     C* DI EXPORT DPD DAL MOMENTO CHE LE SPEDIZIONI PER DPD SONO
203210001009     C* MONOCOLLO)
203220050224     c* per lo stesso motivo escludo anche le import dpd
203230000913    1C     §1BF12        IFNE      'N'
203240001011     C     WEXDPD        ANDNE     'S'
203250050223     c     *in79         andne     *on
203260000911     C     OZ1NCL        ANDGT     2
203270000908     C* I COD. CHI SONO CHE ESPLODO LI SCRIVO NEL SUBFILE IN AGGIUNTA
203280000908     C* PARTENDO DA NUMERO DI RECORD=NR8
203290000908     C* PRIMA DI CLEARARE LA DS MEMORIZZO IL DAL AL IMPOSTATI NEL
203300000908     C* RICHIAMO FATTO DURANTE I CONTROLLI
203310000911     C     OZ1MAX        IFEQ      '2'
203320000908     C                   MOVEL     IZ1CH1        CHIDAL
203330000908     C                   MOVEL     IZ1CH2        CHIAL
203340000911     C                   ELSE
203350000911     C                   MOVEL     IZ1CH2        CHIDAL
203360000911     C                   MOVEL     IZ1CH1        CHIAL
203370000911     C                   ENDIF
203380000908     C* FACCIO UN CICLO DI RICHIAMI A FNLSZ1R FINO AD ARRIVARE AL
203390000908     C* "CHI SONO" AL
203400000911     C                   MOVE      *ALL' '       WW               35
203410000911     C                   Z-ADD     1             IX
203420000911     C     WW            LOOKUP    CHI(IX)                                30
203430000908    2C     CHIDAL        DOWNE     CHIAL
203440000908     C                   CLEAR                   DSLSZ1
203450000908     C                   MOVEL     'E'           IZ1MOD
203460000908     C                   MOVEL     CHIDAL        IZ1CH1
203470000908     C                   Z-ADD     V8CKSC        IZ1CCM
203480000908     C                   MOVEL     BLPCTM        IZ1CTM
203490000908     C                   Z-ADD     BLPNRS        IZ1NRS
203500000908     C                   CALL      'FNLSZ1R'
203510010402     C                   PARM                    KPJBA
203520000908     C                   PARM                    DSLSZ1
203530000908     C                   PARM                    DS1B
203540000911     C     OZ1CHI        IFNE      CHIAL
203550000908     C                   MOVEL     OZ1CHI        V8CNOT
203560000908     C                   CLEAR                   V8CSCE
203570000908     C                   CLEAR                   V8HDKC
203580000908     C                   CLEAR                   V8HESG
203590000915     C                   CLEAR                   V8HST2
203600000915     C                   CLEAR                   V8HFLS
203610000915     C                   CLEAR                   V8HLNA
203620000915     C                   CLEAR                   V8HNRS
203630000915     C                   CLEAR                   V8HNSC
203640000921     C                   CLEAR                   V8HPRE
203650000911     C                   ADD       1             NR8
203660000911     C                   MOVEL     OZ1CHI        CHI(IX)
203670000911     C                   Z-ADD     NR8           POS(IX)
203680000918     C                   ADD       1             IX
203690000908     C                   WRITE     LS01S08
203700000911     C                   ENDIF
203710000908     C                   MOVEL     OZ1CHI        CHIDAL
203720000908    2C                   ENDDO
203730000908    1C                   ENDIF
203740070322     c* se sono in immissione/conferma bolla di sped export dpd
203750070322     c* con numero parcel lungo 12 carico vidnrd nel subfile
203760070322     c                   if        (*in12='0' or *in15='1') and
203770070322     c                             wexdpd='S' and wparcel='12'
203780070322     c                             and §1bf13<>'A'
203790070326     C* PULIZIA SFL
203800070326     C                   SETON                                        35
203810070326     C                   WRITE     LS01C08
203820070326     C                   SETOFF                                       357833
203830070326     c*
203840070322     c                   z-add     0             nr8
203850070322     C                   MOVEL     vidnrd        V8CNOT
203860070322     C                   MOVEL     *BLANKS       V8CSCE
203870070322     C                   MOVE      *BLANKS       V8HDKC
203880070322     C                   MOVE      *BLANKS       V8HESG
203890070322     C                   MOVE      *ZEROS        V8HST2
203900070322     C                   clear                   V8HFLS
203910070322     C                   clear                   V8HLNA
203920070322     C                   clear                   V8HNRS
203930070322     C                   clear                   V8HNSC
203940070322     C* SCRIVO SUBFILE
203950070322     C                   ADD       1             NR8
203960070322     C                   WRITE     LS01S08
203970070322     c                   endif
203980000204     C**
203990000204     C** PER SI DISK "C" --> CHAIN   F I S G N 0 0 F
204000000204    1C     §3CDKC        IFEQ      'S'
204010070323     c     *IN79         ANDEQ     *ON
204020000907     C     §1BF12        ORNE      'N'
204030001106     C     §1BF12        ANDNE     'E'
204040001106     C     §1BF12        OREQ      'E'
204050001106     C     WASDKC        ANDEQ     'S'
204060000204     C                   CLEAR                   WESSGN
204070000929     C                   CLEAR                   WSGNR
204080000208     C                   CLEAR                   FISGN000
204090000919     C                   MOVEL     'S'           WDKC              1
204100000204     C                   SELECT
204110000204     C* IMPORT DPD --> RIF.MITTENTE
204120060622     C     *IN79         WHENEQ    *ON
204130050301     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
204140050301     C                   CLEAR                   V8HCOL
204150060619    4C     savnpr        IFNE      v7cnpr
204160060623     c     savnpr        andne     *blanks
204170060622     C****               move      savnpr        W0120            12 0
204180060622     C****               MOVEL(P)  W0120         KWHO
204190060622     C     Kblp3         setll     FISGN05L
204200060622    5C                   do        *hival
204210060622     C     Kblp3         reade     FISGN05L
204220060622     c                   if        %eof(fisgn05l)
204230060622     c                   leave
204240060622     c                   endif
204250050301     C                   EXSR      ANNSGN
204260060622    5C                   ENDdo
204270050301     C                   ELSE
204280050301     C                   MOVE      *HIVAL        V8HCOL
204290050301    4C                   ENDIF
204300060621     c* Il chi sono per chainare fisgn lo compongo come segue:
204310060621     c* 1) se ho il barcode id -> barcodeId+CapDest+n.parcel+serv.code+iso N
204320060621     c* 2) se non ho il barcode id --> numero parcel lungo 11+1
204330060622    4c                   if        §b4ibi<>*blanks
204340060623     c* se sono in conferma bolle o in immissione o in manutenzione di
204350060623     c* bolla immessa a mano (no disk)
204360060623     c* compongo il chi sono con i dati che ho
204370060623    5c                   if        *in12='0' or *in15='1'
204380060623     c                             or  *in13='0'
204390090511    6c                   if        *in15='1'
204400090511    7c                   if        §lpcad<>*blanks
204410060622     c                   eval      §lpcad_w=§lpcad
204420090511   x7c                   else
204430060622     c                   eval      §lpcad_w=blpcad
204440090511    7c                   endif
204450090514     c                   else
204460090514     c                   eval      §lpcad_w=blpcad
204470090511    6c                   endif
204480060621     c                   clear                   outcapdpd
204490060621     c                   call      'XCAPDPD'
204500060622     c                   parm                    §lpcad_w
204510060621     c                   parm                    outcapdpd         7
204520060621     c                   eval      kwho=§b4ibi+outcapdpd
204530060621     c* se parcel lungo 12 lo trucco con 0 e 99
204540060622    6c                   if        %subst(§b4ipn:14:1)=*blanks
204550060621     c                   eval      kwho=%trim(kwho)+'0'
204560060621     c                             +%subst(§b4ipn:1:3)
204570060621     c                             +'99' + %subst(§b4ipn:4:8)
204580060622   x6c                   else
204590060621     c                   eval      kwho=%trim(kwho)+§b4ipn
204600060622    6c                   endif
204610060621     C                   MOVEL     '15'          COD
204620060621     C                   MOVEL(P)  BLPNZD        KEY
204630060621     C                   EXSR      CTABEL
204640060621     C   30              CLEAR                   DS15
204650060621     C  N30              MOVEL     TBLUNI        DS15
204660060621     c                   movel     §15cie        §15ciea           3
204670060621     c                   eval      kwho=%trim(kwho)+§b4isc+§15ciea
204680060622   x5c                   else
204690060623     c* altrimenti se sono in manutenzione di bolla ricevuta da cliente
204700060623     c* (DISK A) il chi sono lo reperisco chainando fisgn per key
204710060623     c* spedizione
204720060622     c     kblp3         chain(N)  fisgn05l
204730060622     c                   eval      kwho=sgnwho
204740060622    5c                   endif
204750060622   x4c                   else
204760060710     C                   clear                   kwho
204770060710     C                   movel     §b4ipn        kwho
204780060621     C                   eval      %subst(kwho:12:1)=§b4icd
204790060622    4c                   endif
204800000908     C                   EXSR      CTRSGN
204810050221     C* EXPORT DPD --> da vat O DIGITATO, DA CTM
204820001011    2C     WEXDPD        WHENEQ    'S'
204830140714     C     §1BF13        ANDNE     'A'
204840160225     c     w_aDpd        andne     'S'
204850070322     c     wparcel       andne     '12'
204860140715     c     §1bf12        andne     'B'
204870000204     C* SE E' CAMBIATO IL NUMERO, ANNULLO IL PRECEDENTE
204880001009     C                   CLEAR                   V8HCOL
204890001009    4C     SAVNPR        IFNE      V7CNPR
204900001009     C                   MOVEL(P)  SAVNPR        KWHO
204910010116     C     KSGN          CHAIN     FISGN01L                           30
204920001009    5C     *IN30         IFEQ      *OFF
204930001009     C                   EXSR      ANNSGN
204940001009    5C                   ENDIF
204950001009     C                   ELSE
204960001009     C                   MOVE      *HIVAL        V8HCOL
204970001009    4C                   ENDIF
204980000209     C*
204990001009     C                   MOVEL(P)  V7CNPR        KWHO
205000001009     C                   EXSR      CTRSGN
205010000915     C* DISK C NO DPD: RICHIAMO CTRSGN PER OGNI RECORD DEL SUBFILE
205020001002     C     §1BF12        WHENNE    'N'
205030000908     C                   Z-ADD     1             NR8
205040000908     C                   MOVE      *BLANKS       SAVDKC            1
205050000915     C                   MOVE      *ZEROS        JJ                3 0
205060000908     C     NR8           CHAIN     LS01S08                            30
205070000908    3C     *IN30         DOWEQ     *OFF
205080000908     C* Escludo record annullati
205090000908    4C     V8CSCE        IFEQ      *BLANKS
205100000908     C                   MOVEL(P)  V8CNOT        KWHO
205110000908     C                   CLEAR                   WESSGN
205120000908     C* Controllo file fisgn
205130000908     C                   EXSR      CTRSGN
205140000908     C                   MOVE      WDKC          V8HDKC
205150000919    5C     WESSGN        IFEQ      'S'
205160000908     C                   MOVEL     'S'           V8HESG
205170000915     C                   Z-ADD     SGNST2        V8HST2
205180000919   X5C                   ELSE
205190000920     C                   CLEAR                   V8HESG
205200000915     C                   CLEAR                   V8HST2
205210000919    5C                   ENDIF
205220000908     C                   UPDATE    LS01S08
205230000920     C* Tratto la spedizione come diskC (scrittura di fisgn) se almeno
205240000920     C* un collo lo tratto come DISK C
205250000919    5C     WDKC          IFEQ      'S'
205260000908     C                   MOVE      WDKC          SAVDKC
205270000919    5C                   ENDIF
205280000908     C                   MOVEL     'S'           WDKC
205290000919   X4C                   ELSE
205300051102     C* MEMORIZZO IN SCHIERA ANNULLATI SE LEGATO A ARS
205310000920    5C     V8HCOL        IFGT      *ZEROS
205320000915     C                   ADD       1             JJ
205330000915     C                   Z-ADD     V8HCOL        ANN(JJ)
205340000919     C* SE RECORD ANNULLATO ANNULLO FISGN
205350010116     C     KSGN8         CHAIN     FISGN01L                           30
205360000920    6C     *IN30         IFEQ      *OFF
205370000921     C* Se annullato con A non lo potrò più riattivare perchè ormai i
205380000921     C* dati memorizzati su fisgn non sono più aggiornati correttamente
205390000921     c* Se annullato con A e progressivo = 0 significa che non ci sono
205400000921     c* più bolle manutenzionabili con questo cod. chi sono e quindi
205410000921     c* annullo con *
205420000921     C                   EXSR      ANNSGN
205430000920    6C                   ENDIF
205440000920    5C                   ENDIF
205450000920    4C                   ENDIF
205460000911     C                   ADD       1             NR8
205470000908     C     NR8           CHAIN     LS01S08                            30
205480000908    3C                   ENDDO
205490000908     C     SAVDKC        IFEQ      'S'
205500000908     C                   MOVE      'S'           WDKC
205510000908     C                   ENDIF
205520000204     C                   OTHER
205530000204     C                   MOVEL     'N'           WDKC
205540000204    2C                   ENDSL
205550000204     C*
205560000929   X1C                   ELSE
205570010515     C* 15/05/01: FISGN NON DEVE PIU' ESSERE SCRITTO PER LA RISTAMPA
205580001106     C                   MOVEL     'N'           WDKC
205590000204    1C                   ENDIF
205600980409     C*
205610980409     C* ABBLENCO CAMPO DI COMODO USATO IN ROUTINE CRTBLD PER SAPERE
205620980409     C* SE RISTAMAPRE O MENO L'ETICHETTA SEGNACOLLO
205630980409     C* (WPRT = ' '--> SI RISTAMPA; WPRT= 'N' --> NO RISTAMPA)
205640980409     C                   MOVE      *BLANKS       WPRT              1
205650950713     C**
205660940914     C* F N V A D 0 0 F : DETTAGLIO SEGNACOLLI
205670910807     C** DISK CLI:  CONTROLLO SE SE SONO RECORD NON SEQUENZIALI
205680000919     C   12
205690000919     CAN 15§1BFG7        IFEQ      'S'
205700980410     C     §1BFG6        ANDEQ     'C'
205710980219     C                   SETOFF                                       3130
205720020917     C     KBLC          SETLL     FIVAD000
205730020917     C     KBLC          READE     FIVAD000                               30
205740001002     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
205750001002     C  N30WSGNR         IFEQ      'S'
205760081008     C***  WESTER        IFEQ      'S'
205770081008     C***                MOVEL     'ALL'         §DETST
205780081008     C***                ELSE
205790001106     C                   MOVEL     'ITA'         §DETST
205800040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
205810040506     c* etichetta Italia con dati esteri
205820040506     C     A_§ogntw      IFEQ      'EEX'
205830040506     C                   MOVEL     'EEX'         §DETSE
205840040506     c                   else
205850040506     c                   clear                   §detse
205860040506     C                   ENDIF
205870081008     C***                ENDIF
205880001005     C                   CLEAR                   WSTSEG
205890001002     C                   EXSR      RIESEG
205900001002     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
205910001002     C                   CLEAR                   DSBLD7
205920150202     C                   MOVE      BLPfls        §LCLNP
205930001002     C                   MOVE      BLPLNA        §LCLNA
205940001002     C                   MOVE      BLPNRS        §LCNRS
205950001002     C                   MOVE      BLPZNC        §LCZSC
205960001002     C                   MOVE      DSBLD         WWBLD
205970001002     C                   MOVE      DSBLDE        WWBLDE
205980001002     C                   ENDIF
205990930930     C*
206000930930     C* SE NON SEQUENZIALI MEMORIZZO IL PRIMO SEGNACOLLO
206010971215    2C  N30BLPFNS        IFEQ      'S'
206020941230     C                   MOVEL     BLDNCD        VIDNCD
206030951019     C                   Z-ADD     1             BLDNC1
206040971215    2C                   ENDIF
206050910802     C*
206060971215    2C     *IN30         DOWEQ     '0'
206070001002     C*
206080001002     C     WSGNR         IFEQ      'S'
206090001002     C                   MOVE      WWBLD         DSBLD
206100001002     C                   MOVE      WWBLDE        DSBLDE
206110001002     C                   ENDIF
206120001002     C*
206130980403     C                   MOVEL     BLDNCD        SV1NCD
206140980319     C*
206150980319    3C     BLDNCA        IFEQ      0
206160980319     C                   Z-ADD     BLDNCD        BLDNCA
206170980319    3C                   ENDIF
206180000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
206190051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
206200000915     C     §1BF12        IFNE      'N'
206210000915     C                   Z-ADD     1             NR8
206220000915     C                   ENDIF
206230000929     C*
206240000929     C* SE NO DISK C DEVO SCRIVERE FISGN IN RISTAMPA
206250000929     C     WSGNR         IFEQ      'S'
206260000929     C                   MOVE      BLDCDP        §LDCDP
206270000929     C                   ENDIF
206280980319     C*
206290980319    3C     BLDNCD        DOWLE     BLDNCA
206300990318     C     BLDNCD        ANDGT     0
206310980319     C*
206320980319     C                   MOVEL     BLDNCD        WNSC
206330000929     C                   EXSR      CRTBLT
206340001003     C* No disk c: scrittura fisgn in ristampa
206350010404     C* N.B.: Scrittura fisgn per ristampa --> REGOLA: viene effettua
206360010404     C*       ta al momento della creazione del dettaglio colli (CRTBLT
206370010404     c*       ). Non viene fatta nell routine stasci o stascd come per
206380010404     c*       la scrittura di fisgn per §1bf12<>"N" o per import dpd
206390010404     c*       in quanto queste routine non vengono sempre richiamate
206400010404     c*       (per esempio in conferma bolle da disk quando fg6='S')
206410020917     c*       ECCEZIONE: Se cliente con fivad e fg6="D" l'fisgn viene
206420010404     C*       creato dentro stascd per non perdere il codice prodotto
206430010404     c*       Idem se sono in manutenzione
206440001002     C     WSGNR         IFEQ      'S'
206450000929     C                   ADD       1             §LDNC1
206460001002     C                   Z-ADD     WNSC          §LDNCD
206470001002     C                   Z-ADD     WNSC          §LCNCD
206480001002     C                   EXSR      M10
206490001002     C                   MOVEA     §CA           V8CNOT
206500010404     C                   EXSR      EUREXP
206510010306     C                   MOVEL     DSBLD         WSBLD
206520010306     C                   MOVEL     DSBLDE        WSBLDE
206530010306     C     KSGN8         CHAIN     FISGN01L                           30
206540010306     C                   MOVEL     WSBLD         DSBLD
206550010306     C                   MOVEL     WSBLDE        DSBLDE
206560010306     C   30              EXSR      WRTSGN
206570010306     C  N30              EXSR      UPDSGN
206580001002     C                   ENDIF
206590980319     C*
206600980319     C                   ADD       1             BLDNCD
206610980319    3C                   ENDDO
206620001002     C*
206630001002     C                   MOVE      DSBLD         WWBLD
206640001002     C                   MOVE      DSBLDE        WWBLDE
206650980319     C*
206660980403     C* REIMPOSTO NUMERO SEGNACOLLO CHE SI E' SPORCATO NEL CICLO
206670980403     C* DI CREAZIONE DEL BLT
206680980403     C                   Z-ADD     SV1NCD        BLDNCD
206690980403    3C     BLDNCA        IFEQ      BLDNCD
206700980319     C                   MOVE      *ZEROS        BLDNCA
206710980319    3C                   ENDIF
206720951019     C* CREO FNBLD PER SEGNACOLLI NON SEQUENZIALI
206730971215    3C     BLPFNS        IFEQ      'S'
206740971215     C**
206750971215    4C     §1BFG9        IFEQ      'S'
206760971217     C*
206770081008     C**   §1BFG0        OREQ      'D'
206780081008     C**   §1BFG6        ANDEQ     'C'
206790081008     C**   WESTER        ANDEQ     'S'
206800971217     C*
206810081008     C**   §1BF11        OREQ      'D'
206820081008     C**   §1BFG0        ANDEQ     'C'
206830081008     C**   WESTER        ANDEQ     'S'
206840951019     C                   Z-ADD     BLDNCD        COMSCD
206850951019     C                   Z-ADD     BLDNCL        VARNCL
206860971224     C                   MOVEL     BLDCDP        VARCDP
206870951019     C                   EXSR      ROTCDP
206880971215    4C                   ENDIF
206890971215     C**
206900971215     C** STAMPA LA SOLA ETICHETTA DELL'ESTERO IN IMMEDIATO
206910120302     C**  PER SDI SEMPRE, PER BRT SOLO SE IN IMMEDIATO
206920081008    4C**   WESTER        IFEQ      'S'
206930081008     C**   §1BFG9        ANDNE     'S'
206940971217     C*
206950081008    5C**   §1BFG0        IFEQ      'I'
206960081008     C**   §1BFG6        ANDEQ     'C'
206970971217     C*
206980081008     C**   §1BF11        OREQ      'I'
206990081008     C**   §1BFG0        ANDEQ     'C'
207000081008     C**                 MOVEL     'EST'         §DETST
207010971215     C**
207020971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
207030081008     C**                 Z-ADD     BLDNCD        CO2SCD
207040081008    6C**   BLDNCA        IFEQ      0
207050081008     C**                 Z-ADD     BLDNCD        STANCA
207060081008     C**                 ELSE
207070081008     C**                 Z-ADD     BLDNCA        STANCA
207080081008    6C**                 END
207090971215     C**
207100081008     C**                 EXSR      STASCI
207110081008    5C**                 ENDIF
207120081008    4C**                 ENDIF
207130971215    3C                   ENDIF
207140951019     C*
207150910802     C* CANCELLO FLBLD
207160020917     C                   DELETE    FIVAD000
207170910802     C* RILEGGO
207180020917     C     KBLC          READE     FIVAD000                               30
207190971215    2C                   ENDDO
207200971215    1C                   ENDIF
207210910802     C*
207220921006     C* CREO FLBLT SEQUENZIALE PER:
207230921006     C*         DISK CLI CON SEGNAC SEQUENZIALI
207240921006     C*         MANUTENZIONE BOLLE SE SEQUENZIALI
207250921006     C*         IMMISSIONE BOLLE
207260921016     C                   SETOFF                                       30
207270960404     C   12
207280960404    1CAN 15§3ABCM        IFEQ      ' '
207290941221     C* SE IL CTM PREVEDE SEGNACOLLI --> LI CREO
207300941221     C     §1BFG8        ANDEQ     'S'
207310960404    2C     §1BFG7        IFNE      'S'
207320980410     C     §1BFG6        ORNE      'C'
207330921006     C                   SETON                                            30
207340960404    2C                   END
207350960404    1C                   END
207360921006     C*
207370071221     c                   if        *in12 and not *in15
207380071221     c                   if        wagglna='S'
207390071221     c     kblp3         setll     fnblt01l
207400071221     c     kblp3         reade     fnblt01l
207410071221     c                   dow       not %eof(fnblt01l)
207420071221     c                   eval      bltlna=blplna
207430071221     c                   if        wsbord='S' and bltdfv=0
207440071221     c                   clear                   bltnfv
207450071221     c                   endif
207460071221     c                   update    fnblt000
207470071221     c     kblp3         reade     fnblt01l
207480071221     c                   enddo
207490120814     c* Ripeto lo stesso aggiornamento anche per fiart
207500120814     c     kblp3         setll     fiart01l
207510120814     c     kblp3         reade     fiart01l
207520120814     c                   dow       not %eof(fiart01l)
207530120814     c                   eval      artlna=blplna
207540120814     c                   if        wsbord='S' and bltdfv=0
207550120814     c                   clear                   artnfv
207560120814     c                   endif
207570120814     c                   update    fiart000
207580120814     c     kblp3         reade     fiart01l
207590120814     c                   enddo
207600071221     c                   else
207610071221     C** 12
207620071221    1C**ANN15BLPFNS        IFEQ      ' '
207630071221     c     blpfns        ifeq      ' '
207640921016     C     BLPNCD        ANDNE     0
207650921019     C     §1BFG8        ANDNE     'N'
207660950504     C* SE HO ELIMINATO I SEGNACOLLI --> LI CENCELLO
207670950504     C     §1BFG8        OREQ      'N'
207680960404     C*
207690980407   2AC     WABLT         IFEQ      'S'
207700960404     C                   MOVEL     5             KNPG
207710960404     C                   MOVEL     SIMFEL        KFLE
207720980320     C*
207730980320     C                   MOVE      *BLANKS       WCRT
207740960404     C*
207750940915     C     KBLP3         SETLL     FNBLT000
207760960404    2C     *IN30         DOWEQ     *OFF
207770051124     C     KBLP3         READE     FNBLT000                               30
207780960404     C*
207790980407    4C  N30WCONTC        IFNE      99999
207800960404     C                   ADD       1             WCONTC
207810960404    4C                   ENDIF
207820960404     C* CANCELLO LE SPUNTE ENTRATA SOLO SE C'E' 'S' E SE WCONTC
207830960404     C*  > DEL NUMERO DEI COLLI
207840980407    3C  N30WDELBR        IFEQ      'S'
207850980407     C     WCONTC        ANDGT     BLPNCL
207860070123     C     KBRV          CHAIN     FNBRV000                           31
207870960404    4C     *IN31         DOWEQ     *OFF
207880051124     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
207890051124     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
207900051124     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
207910051124     c* no anomalie da cancellare create a fronte della spunta entrata
207920051124     c**                 z-add     brvnfv        wrvnfv
207930051124     c**                 movel     param2        kpjbu
207940051124     C**                 CALL      'FNLSA8R'
207950051124     C**                 PARM                    KPJBA
207960070123     C                   DELETE    FNBRV000
207970070123     C     KBRV          READE     FNBRV000                               31
207980960404    4C                   ENDDO
207990040415     c*
208000040415    3C                   ENDIF
208010040415     c*
208020040415     c* cancello dalle spunte entrata il peso e volume se c'e' S e
208030040415     c*  se WCONT <= del numero dei colli
208040040415    3C  N30WDELBR        IFEQ      'S'
208050040415     C     WCONTC        ANDle     BLPNCL
208060070123     C     KBRV          CHAIN     FNBRV000                           31
208070040415    4C     *IN31         DOWEQ     *OFF
208080040415     c                   clear                   brvvuc
208090040415     c                   clear                   brvpuc
208100070123     C                   update    FNBRV000
208110070123     C     KBRV          READE     FNBRV000                               31
208120040415    4C                   ENDDO
208130960404     C*
208140960404    3C                   ENDIF
208150960404     C*
208160000915    3C     *IN30         IFEQ      *OFF
208170980320     C                   MOVE      'S'           WCRT              1
208180051124     C  N30              DELETE    FNBLT000
208190120814     c     kfiart        delete    fiart000                           31
208200980323     C                   MOVEL     'E'           WTRC
208210051102     C     KARS1         CHAIN     FIARS01L                           31
208220051102     C  N31              DELETE    FIARS000
208230020212     C                   MOVEL     'F'           WTRC
208240051102     C     KARS1         CHAIN     FIARS01L                           31
208250020212     c     *in31         ifeq      *off
208260020212     c* Se ho diminuito il numero dei colli oppure ho variato la linea di
208270020212     c* arrivo non devo riassegnare i numeri awb per il segnacollo fedex
208280051102     c* quindi memorizzo il primo numero awb prima di cancellare il ARS
208290020212     c* 'erchè mi servirà per ricrearlo
208300020212     c     wawbini       ifeq      *zeros
208310051102     c                   movel     ARSnot        wawbini
208320020212     c                   z-add     wawbini       wawb
208330020212     c                   endif
208340051102     C                   DELETE    FIARS000
208350020212     c                   endif
208360000915     C                   MOVEL     'C'           WTRC
208370051102     C     KARS1         CHAIN     FIARS01L                           31
208380000920    4C     *IN31         IFEQ      *OFF
208390000921     C* SE HO ELIMINATO SEGNACOLLI DOVREI ANNULLARE EVENTUALE FISGN
208400001003     C* MA NON LO FACCIO PERCHE' QUESTO CASO NON DOVREBBE MAI VERIFI-
208410000921     C* CARSI DAL MOMENTO CHE IN MANUTENZIONE BOLLE NON E' POSSIBILE
208420000921     C* CAMBIARE IL CODICE TRATTAMENTO MERCE
208430051102     C                   DELETE    FIARS000
208440000920    4C                   ENDIF
208450980320    3C                   ENDIF
208460960404    2C                   ENDDO
208470980320     C* SE HO CANCELLATO IL DETTAGLIO COLLI LO RICREO
208480980320     C     §1BFG8        IFEQ      'S'
208490980320     C     WCRT          ANDEQ     'S'
208500980320     C                   Z-ADD     BLPNCD        CO2SCD
208510980320     C     BLPNCA        IFEQ      0
208520980320     C                   Z-ADD     BLPNCD        BLPNCA
208530980320     C                   END
208540000915     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
208550051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
208560000915     C     §1BF12        IFNE      'N'
208570000915     C                   Z-ADD     1             NR8
208580000915     C                   ENDIF
208590980320     C*
208600980320     C     CO2SCD        DOWLE     BLPNCA
208610000915     C     CO2SCD        ANDGT     0
208620980320     C                   Z-ADD     CO2SCD        WNSC
208630980320     C                   EXSR      CRTBLT
208640980320     C                   ADD       1             CO2SCD
208650980320     C                   END
208660980320     C                   END
208670980408  X2AC                   ELSE
208680980408     C* SE HO SBORDERIZZATO LA BOLLA ELIMINO BLTNFV SU DETT. COLLI
208690980408    2C     WSBORD        IFEQ      'S'
208700980409     C                   EXSR      SBORD
208710980408    2C                   ENDIF
208720980320   2AC                   ENDIF
208730950713     C*
208740960404   X1C                   ELSE
208750950713     C* SE SEGNACOLLI NON SEQUENZIALI E HO SBORDERIZZATO IN AUTOMATICO
208760950713     C*  LA BOLLA --> ELIMINO BLTNFV SU DETT COLLI
208770960404    2C     BLPFNS        IFEQ      'S'
208780950713     C     WSBORD        ANDEQ     'S'
208790980409     C                   EXSR      SBORD
208800960404    2C                   ENDIF
208810950713     C*
208820960404    1C                   ENDIF
208830071221    1C                   endif
208840071221    1C                   endif
208850000915     C* SE SONO IN MANUTENZIONE E NON SONO AUMENTATI O DIMINUITI I
208860051102     C* COLLI E NON E' VARIATA LA LNA DEVO AGGIORNARE ARS PER
208870000915     C* EVENTUALI ANNULLAMENTI E AGGIUNTE SU SUBFILE COD CHI SONO
208880000915     C                   MOVEL     *BLANKS       WUPDSG            1
208890001009    1C     *IN12         IFEQ      *ON
208900001009     C     *IN15         ANDEQ     *OFF
208910001009     C     WABLT         ANDNE     'S'
208920071221     C     WAgglna       ANDNE     'S'
208930001009    2C                   SELECT
208940050228     c* IMPORT DPD                                                     cel
208950050228     c     *in79         wheneq    *on
208960050228     c     §1bf12        andne     'N'
208970060619     c     savnpr        andne     v7cnpr
208980050228     C                   MOVEL     'C'           WTRC
208990051102     C     KARS1P        CHAIN     FIARS01L                           31
209000060622     C**N31              move      v7cnpr        w0120
209010060622     C**N31              movel     w0120         ARSNOT
209020060622     c  n31              movel     v7cnpr        arsnot
209030051114     C  N31              movel     dateu         ARSduv
209040051102     C  N31              UPDATE    FIARS000
209050050228     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
209060050228     C  N31              MOVEL     'S'           WUPDSG
209070001009     C* EXPORT DPD
209080001009     C     §1BF12        WHENNE    'N'
209090001011     C     WEXDPD        ANDEQ     'S'
209100160225     c     w_aDpd        andne     'S'
209110140714     C     §1BF13        ANDNE     'A'
209120140715     c     §1bf12        andne     'B'
209130070323     c     wparcel       andne     '12'
209140001009     C     SAVNPR        ANDNE     V7CNPR
209150001009     C                   MOVEL     'C'           WTRC
209160051102     C     KARS1P        CHAIN     FIARS01L                           31
209170051102     C  N31              MOVEL     V7CNPR        ARSNOT
209180051114     C  N31              MOVEL     dateu         ARSduv
209190051102     C  N31              UPDATE    FIARS000
209200001009     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
209210001009     C  N31              MOVEL     'S'           WUPDSG
209220001009     C     §1BF12        WHENNE    'N'
209230050224     c     *in79         andeq     *off
209240000915     C     ANN(1)        ANDGT     *ZEROS
209250000915     C                   Z-ADD     1             NR8
209260000915     C                   Z-ADD     1             JJ
209270000915     C     NR8           CHAIN     LS01S08                            31
209280001009   2AC     *IN31         DOWEQ     *OFF
209290001003    3C     V8HCOL        IFEQ      *ZEROS
209300000915     C     V8CSCE        ANDEQ     *BLANKS
209310000915     C                   MOVE      ANN(JJ)       KANNUL
209320000915     C                   MOVEL     'C'           WTRC
209330051102     C     KARS1K        CHAIN     FIARS01L                           31
209340051102     C  N31              MOVEL     V8CNOT        ARSNOT
209350051114     C  N31              MOVEL     dateu         ARSduv
209360051102     C  N31              UPDATE    FIARS000
209370000915     C* MEMORIZZO CHE DOVRO' ANDARE A SCRIVERE FISGN
209380000915     C  N31              MOVEL     'S'           WUPDSG
209390020212    4C     §ogntw        IFEQ      'EEX'
209400000915     C                   MOVEL     'E'           WTRC
209410051102     C     KARS1K        CHAIN     FIARS01L                           31
209420051102     C  N31              MOVEL     V8CNOT        ARSNOT
209430051114     C  N31              MOVEL     dateu         ARSduv
209440051102     C  N31              UPDATE    FIARS000
209450001003    4C                   ENDIF
209460000915     C                   ADD       1             JJ
209470001003    3C                   ENDIF
209480000915     C                   ADD       1             NR8
209490000915     C     NR8           CHAIN     LS01S08                            31
209500001009   2AC                   ENDDO
209510070323     C     §1BF12        WHENNE    'N'
209520070323     C     WEXDPD        ANDEQ     'S'
209530070323     c     v7cnpr        andne     savnpr
209540070323     C                   MOVEL     'S'           WUPDSG
209550001009    2C                   ENDSL
209560001009    1C                   ENDIF
209570921006     C*
209580921006     C  N12BLPNCD        IFGT      0
209590921006     C                   SETON                                        30
209600921006     C                   END
209610921006     C* CREO FLBLT
209620980320     C   12
209630980320     CAN 15
209640980320     CAN 30
209650980320     CORN12
209660980320     CAN 30              DO
209670910827     C                   Z-ADD     BLPNCD        CO2SCD
209680910826     C     BLPNCA        IFEQ      0
209690910826     C                   Z-ADD     BLPNCD        BLPNCA
209700910826     C                   END
209710000908     C* SE DISK C IMPOSTO A 1 NRR PER LETTURA SUBFILE CODICI CHI SONO
209720051102     C* CHE VERRA' FATTA PER LA CREAZIONE DI FIARS
209730000908     C     §1BF12        IFNE      'N'
209740000908     C                   Z-ADD     1             NR8
209750000908     C                   ENDIF
209760001003     C*
209770001003     C     WSGNR         IFEQ      'S'
209780001005     C     §1BFG6        ANDNE     'M'
209790001003     C     §1BFG6        IFNE      'D'
209800001003     C     §1BFG7        ORNE      'S'
209810081008     C**   WESTER        IFEQ      'S'
209820081008     C**                 MOVEL     'ALL'         §DETST
209830081008     C**                 ELSE
209840001003     C                   MOVEL     'ITA'         §DETST
209850040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
209860040506     c* etichetta Italia con dati esteri
209870040506     C     A_§ogntw      IFEQ      'EEX'
209880040506     C                   MOVEL     'EEX'         §DETSE
209890040506     c                   else
209900040506     c                   clear                   §detse
209910040506     C                   ENDIF
209920081008     C***                ENDIF
209930001005     C                   CLEAR                   WSTSEG
209940001003     C                   EXSR      RIESEG
209950001003     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
209960001003     C                   CLEAR                   DSBLD7
209970150202     C                   MOVE      BLPfls        §LCLNP
209980001003     C                   MOVE      BLPLNA        §LCLNA
209990001003     C                   MOVE      BLPNRS        §LCNRS
210000001003     C                   MOVE      BLPZNC        §LCZSC
210010001003     C                   ENDIF
210020001003     C                   ENDIF
210030000908     C*
210040910827     C     CO2SCD        DOWLE     BLPNCA
210050990318     C     CO2SCD        ANDGT     0
210060940926     C                   Z-ADD     CO2SCD        WNSC
210070910802     C                   EXSR      CRTBLT
210080001003     C* No disk c: scrittura fisgn in ristampa
210090001003     C* Se la stampa segnacolli è in differita e il cliente mi passa
210100020917     C* fivad non creo qui fisgn ma lo creo quando scrivo fnbld perchè
210110001003     C* in questo caso devo memorizzare su fisgn anche il codice prodot
210120001003     C     WSGNR         IFEQ      'S'
210130001005     C     §1BFG6        ANDNE     'M'
210140001003     C     §1BFG6        IFNE      'D'
210150001003     C     §1BFG7        ORNE      'S'
210160001003     C                   ADD       1             §LDNC1
210170001003     C                   Z-ADD     WNSC          §LDNCD
210180001003     C                   Z-ADD     WNSC          §LCNCD
210190001003     C                   EXSR      M10
210200001003     C                   MOVEA     §CA           V8CNOT
210210010404     C                   EXSR      EUREXP
210220010306     C                   MOVEL     DSBLD         WSBLD
210230010306     C                   MOVEL     DSBLDE        WSBLDE
210240010306     C     KSGN8         CHAIN     FISGN01L                           30
210250010306     C                   MOVEL     WSBLD         DSBLD
210260010306     C                   MOVEL     WSBLDE        DSBLDE
210270010306     C  N30              EXSR      UPDSGN
210280010306     C   30              EXSR      WRTSGN
210290001003     C                   ENDIF
210300001003     C                   ENDIF
210310910827     C                   ADD       1             CO2SCD
210320910805     C                   END
210330910802     C                   END
210340910802     C*
210350910826     C     BLPNCA        IFEQ      BLPNCD
210360910826     C                   Z-ADD     0             BLPNCA
210370910826     C                   END
210380950504     C* PER ELIMINAZIONE DEI SEGNACOLLI, CANCELLO ANCHE FNBLD
210390950504     C   12
210400950504     CANN15§1BFG8        IFEQ      'N'
210410950504     C     KBLP3         SETLL     FNBLD000                               30
210420950504     C     *IN30         IFEQ      *ON
210430950504     C*
210440950504     C     KBLP3         READE     FNBLD000                               30
210450950504     C     *IN30         DOWEQ     *OFF
210460950504     C                   DELETE    FNBLD000
210470950504     C     KBLP3         READE     FNBLD000                               30
210480950504     C                   ENDDO
210490950504     C                   ENDIF
210500950504     C                   ENDIF
210510980320     C*
210520980320     C* LE SEGUENTI ISTRUZIONI SI COLLOCAVANO, PER ANALOGIA, DOPO
210530980320     C* LA CREAZIONE DEL BLD PER I SEGNACOLLI NON SEQUENZIALI.
210540980320     C* SONO STATE SPOSTATE QUI AFFINCHE' IN OGNI CASO IL DETTAGLIO
210550980320     C* COLLI SIA GIA' STATO CREATO PER POTER PERMETTERE LA STAMPA
210560980320     C* DELLE ETICHETTE ESTERE
210570980320     C*
210580980320     C* SE FG9='S' CREO 1 RECORD IN FNBLD  SE SEGNACOLLI SEQUENZIALI
210590980320     C   12
210600980320    1CAN 15BLPFNS        IFEQ      ' '
210610980320     C*
210620980320    2C     §1BFG6        IFEQ      'C'
210630980320     C     §1BFG9        ANDEQ     'S'
210640980320     C*
210650081008     C**   §1BFG0        OREQ      'D'
210660081008    2C**   §1BFG6        ANDEQ     'C'
210670081008     C**   WESTER        ANDEQ     'S'
210680980320     C*
210690081008     C**   §1BF11        OREQ      'D'
210700081008     C**   §1BFG0        ANDEQ     'C'
210710081008     C**   WESTER        ANDEQ     'S'
210720980320     C                   Z-ADD     BLPNCD        BLDNCD
210730980320     C                   Z-ADD     BLPNCA        BLDNCA
210740980320     C                   Z-ADD     VIDNCL        BLDNCL
210750980320     C                   Z-ADD     1             BLDNC1
210760980320     C                   EXSR      CRTBLD
210770980320    2C                   ENDIF
210780980320     C** STAMPA ETICHETTA IN IMMEDIATO SE ESTERA LA LNA
210790081008    2C**   WESTER        IFEQ      'S'
210800081008     C**   §1BFG9        ANDNE     'S'
210810980320     C*
210820081008    3C**   §1BFG0        IFEQ      'I'
210830081008     C**   §1BFG6        ANDEQ     'C'
210840980320     C*
210850081008     C**   §1BF11        OREQ      'I'
210860081008     C**   §1BFG0        ANDEQ     'C'
210870081008     C**                 MOVEL     'EST'         §DETST
210880980320     C**
210890980320     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
210900081008     C**                 Z-ADD     BLPNCD        CO2SCD
210910081008    4C**   BLPNCA        IFEQ      0
210920081008     C**                 Z-ADD     BLPNCD        STANCA
210930081008     C**                 ELSE
210940081008     C**                 Z-ADD     BLPNCA        STANCA
210950081008    4C**                 END
210960980320     C**
210970081008     C**                 EXSR      STASCI
210980081008    3C**                 ENDIF
210990081008    2C**                 ENDIF
211000980320    1C                   ENDIF
211010910805     C*
211020910805     C* E S T E N S I O N E   B O L L A
211030991006      *
211040991006      * Se agganciata precedentemente riaggancio file tassazione per 2a bolla
211050991006     C     WAR62         IFEQ      'E'
211060991006     C                   MOVEL     '2'           WTRC
211070050331     c                   if        wKSCsf2 <> 0000 and wKSCsf2 <> 9999
211080050331     c     kblp4         delete    fiar6000
211090050331     c                   clear                   war62
211100050331     c                   else
211110991006     C     KBLP4         CHAIN     FIAR6000                           30
211120050331     c                   endif
211130991006     C                   ENDIF
211140991006      *
211150040116if  1c                   If        *In05 and
211160040116     c                             (wesvar1 <> *Blanks or Vi2Cei <> *Blanks)
211170040116      * Carico le varie
211180040116if  2c                   If        wesvar1 <> *Blanks
211190040116     c                   Clear                   wsv1
211200040116     c                   Clear                   wva1
211210040116     c                   Clear                   wsv2
211220040116     c                   Clear                   wva2
211230040116     c                   Clear                   wsv3
211240040116     c                   Clear                   wva3
211250040116     c                   Eval      ContaSv = 1
211260041217do  3c                   Do        6             c
211270040116     c                   If        w2sv(c) <> *Blanks
211280040116     c                   Exsr      Wrtvar1
211290040116     c                   EndIf
211300040116    3c                   EndDo
211310040116    2c                   EndIf
211320991006      *
211330991006     C                   CLEAR                   FIAR6000
211340991006      *
211350991006     C                   MOVEL     '2'           AR6TRC
211360991006     C                   MOVEL     BLPAAS        AR6AAS
211370991006     C                   MOVEL     BLPLNP        AR6LNP
211380991006     C                   MOVEL     BLPNRS        AR6NRS
211390991006     C                   MOVEL     BLPNSP        AR6NSP
211400991006     C                   MOVEL     VI2CEI        AR6CEI
211410040116     c                   Movel     wsv1          Ar6Sv1
211420040116     c                   Z-add     wva1          Ar6Va1
211430040116     c                   Movel     wsv2          Ar6Sv2
211440040116     c                   Z-add     wva2          Ar6Va2
211450040116     c                   Movel     wsv3          Ar6Sv3
211460040116     c                   Z-add     wva3          Ar6Va3
211470991015     C                   MOVEL     VI2DIV        AR6DIV
211480991022     C                   MOVE      9999          AR6KSC
211490991022     C                   MOVEL     AR6LNP        AR6KSC
211500040126     c                   Z-add     Vi2Imv        Ar6Imv
211510991022     C     AR6IMV        IFGT      *ZEROS
211520991022     C                   MOVEL     'P'           AR6FIM
211530991022     C                   ELSE
211540991022     C                   CLEAR                   AR6FIM
211550991022     C                   ENDIF
211560991014     C* DATI PER STAMPA SOLO SE NON è PREPAGATO
211570991014     C     *IN34         IFEQ      *OFF
211580040116     c                   Z-add     Ar6Imv        Db0Imv
211590941108     C                   MOVEL     VI2CEI        DB0CEI
211600991014     C                   MOVEL     V2DCEI        DB0DCE
211610991015     C                   MOVEL     VI2DIV        DB0DIV
211620991014     C                   MOVEL     WFDC2         DB0FDC
211630991014     C                   ENDIF
211640900507     C*
211650991006     C     WAR62         IFEQ      'E'
211660991006     C                   UPDATE    FIAR6000
211670940926     C                   ELSE
211680991006     C                   WRITE     FIAR6000
211690940926     C                   ENDIF
211700930624     C*
211710940920   X1C                   ELSE
211720940926     C*  C'ERA MA ELIMINATA LA ESTENSIONE BOLLA
211730991006    2C     WAR62         IFEQ      'E'
211740991006     C                   DELETE    FIAR6000
211750930624    2C                   ENDIF
211760930624    1C                   ENDIF
211770940926     C***
211780930331     C*** L E G A M E   B O L L A
211790930331     C   12
211800930331     CANN15VIDLNA        IFNE      SAVLNA
211810940915     C     KBLP3         CHAIN     FNLBL000                           30
211820930331     C  N30              Z-ADD     BLPLNA        LBLLAN
211830940928     C  N30              MOVEL     ' '           LBLFT1
211840940928     C  N30              MOVEL     ' '           LBLFT2
211850940915     C  N30              UPDATE    FNLBL000
211860930331     C                   END
211870910117     C***
211880910125     C* IMMISSIONE:
211890910411     C* NO STAMPA SEGNACOLLO IN  D I F F E R I T A:
211900910220     C     §1BFG6        IFNE      'D'
211910951019     C   12
211920951019     CAN 15              EXSR      DELVAD
211930910220     C                   ELSE
211940960805     C*    STAMPA SEGNACOLLO IN DIFFERITA: CREO FNBLD00F
211950910128     C  N12              DO
211960910128     C                   SETON                                        30
211970910128     C                   Z-ADD     BLPNCD        BLDNCD
211980910128     C                   Z-ADD     BLPNCA        BLDNCA
211990910506     C                   Z-ADD     VIDNCL        BLDNCL
212000910128     C                   EXSR      CRTBLD
212010910128     C                   END
212020910129     C* MANUTENZIONE / DISK CLIENTI:
212030910129     C   12              DO
212040910521     C*** DISK CLIENTI NO DETTAGLIO COLLI DA CLIENTE:
212050910411     C   15§1BFG7        IFNE      'S'
212060040618     c     §1bf12        oreq      'B'
212070910411     C                   Z-ADD     BLPNCD        BLDNCD
212080910411     C                   Z-ADD     BLPNCA        BLDNCA
212090910506     C                   Z-ADD     VIDNCL        BLDNCL
212100910521     C                   Z-ADD     1             BLDNC1
212110910411     C                   EXSR      CRTBLD
212120020917     C* DELETO FIVAD SE C'ERA
212130960805     C                   EXSR      DELVAD
212140910411     C*
212150910411     C                   ELSE
212160910411     C*
212170910521     C*** DISK CLIENTI SI DETTAGLIO COLLI DA CLIENTE:
212180020917     C     KBLC          SETLL     FIVAD000
212190020917     C     KBLC          READE     FIVAD000                               30
212200910411     C*
212210940214     C                   Z-ADD     BLPNCD        COMSCD
212220940214     C                   MOVEL     BLDCDP        VARCDP
212230910411     C                   Z-ADD     1             BLDNC1
212240940214     C                   CLEAR                   VARNCL
212250910411     C*
212260930628     C     *IN30         DOWEQ     *OFF
212270940214     C*
212280960805     C* CREO RECORD IN FNBLD00 PER ROTTURA COD PRODOTTO
212290940214     C     BLDCDP        IFNE      VARCDP
212300001018     C* SE DEVO SCRIVERE FISGN IN RISTAMPA IMPOSTO WSGNR = 'B' PER
212310001018     C* RICHIAMARE STASCD (SCRITTURA DI FISGN AL MOMENTO DELLA SCRITTU-
212320001018     C* DI FNBLD)
212330001018     C     WSGNR         IFEQ      'S'
212340010515     C                   MOVEL     'B'           WSGNR             1
212350001018     C                   ENDIF
212360940214     C                   EXSR      ROTCDP
212370940214     C                   ENDIF
212380940214     C*
212390940214     C* SE CODICE PRODOTTO NON MODIFICATO, SOMMO INSIEME I 2 RECORD
212400940214     C                   ADD       BLDNCL        VARNCL
212410940214     C*
212420910411     C* CANCELLO IL RECORD DAL FLBLD DI PASSAGGIO
212430020917     C                   DELETE    FIVAD000
212440910411     C*
212450020917     C     KBLC          READE     FIVAD000                               30
212460940214     C                   ENDDO
212470940214     C* ULTIMA ROTTURA
212480001018     C     WSGNR         IFEQ      'S'
212490001018     C                   MOVEL     'B'           WSGNR
212500001018     C                   ENDIF
212510940214     C                   EXSR      ROTCDP
212520940214     C*
212530910411     C                   END
212540910411     C*
212550910411     C*** MANUTENZIONE BOLLE:
212560910411     C  N15              DO
212570001003     C*
212580001003     C*
212590910201     C                   SETOFF                                       3132
212600910411     C     SAVLNA        COMP      VIDLNA                             3131
212610910411     C  N31VIDNCL        COMP      SAVNCL                             3132
212620910125     C*
212630940214     C*  L I N E A   A R R I V O   > <   O   N C L   A U M E N T A T O
212640910411     C   31              DO
212650000915     C     KBLP3         CHAIN     FNBLD000                           33
212660940214     C*
212670000915     C     *IN33         IFEQ      *OFF
212680940214     C                   Z-ADD     BLPNCD        COMSCD
212690940214     C                   MOVEL     BLDFST        SAVFST
212700940214     C*
212710940214     C     SAVNCL        IFNE      VIDNCL
212720940214     C                   Z-ADD     VIDNCL        BLDNCL
212730940214     C                   ENDIF
212740940214     C                   ENDIF
212750910128     C*
212760001019     C                   CLEAR                   WSTSGN
212770001019     C*
212780000915     C     *IN33         DOWEQ     '0'
212790001018     C     WSGNR         IFEQ      'S'
212800001018     C                   MOVEL     'B'           WSGNR
212810001018     C                   ENDIF
212820940224     C                   Z-ADD     BLDNCL        VARNCL
212830940224     C                   MOVEL     BLDCDP        VARCDP
212840940224     C*
212850940224     C                   EXSR      ROTCDP
212860940214     C*
212870960404     C* SE PUO' AVERE PIU' CODICI PRODOTTO (FLAG 7 = "S") RILEGGO
212880960404     C*  ALTRIMENTI ESCO DALLA LETTURA DI FNBLD00F, PERCHE' SE HO
212890940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
212900940907     C     §1BFG7        IFEQ      'S'
212910000915     C     KBLP3         READE     FNBLD000                               33
212920940907     C                   ELSE
212930000915     C                   SETON                                        33
212940940907     C                   END
212950940907     C*
212960940214     C                   ENDDO
212970910128     C*
212980910128     C                   END
212990910128     C*
213000910405     C** ALTRE MODIFICHE DELLA MANUTENZIONE BOLLE
213010910405     C*
213020940214     C* D I M I N U Z I O N E   N U M E R O   D E I   C O L L I
213030910411     C  N31*IN32         IFEQ      '1'
213040001019     C                   CLEAR                   WSTSGN
213050000915     C     KBLP3         CHAIN     FNBLD000                           33
213060910405     C*
213070910405     C                   Z-ADD     BLPNCD        BLDNCD
213080910405     C                   Z-ADD     BLPNCA        BLDNCA
213090910506     C                   Z-ADD     VIDNCL        BLDNCL
213100000915     C  N33              MOVEL     BLDFST        SAVFST
213110001018     C     WSGNR         IFEQ      'S'
213120001018     C                   MOVEL     'B'           WSGNR
213130001018     C                   ENDIF
213140910405     C                   EXSR      CRTBLD
213150910405     C*
213160910405     C                   ELSE
213170910405     C*
213180910405     C*                    MODIFICHE CON   AGGIORNAMENTO FLBLD
213190940214     C*
213200940921     C     SAVMIT        IFNE      WKSC
213210960926     C     SAVPDR        ORNE      VIDPDR
213220940214     C     SAVRSD        ORNE      VIDRSD
213230910411     C* CODICE PRODOTTO DA RIF ALFABETICO
213240940214     C     §1BFG7        ORNE      'S'
213250940922     C     SAVRMA        ANDNE     VIDRMA
213260940214     C                   SETON                                        31
213270980409     C* Memorizzo di non ristampare l'etichetta
213280050422     c* (solo se non ho variato campi per cui devo ristampare)
213290050422     C     SAVTSP        IFeq      BLPTSP
213300050422     C     SAVCAD        andeq     VIDCAD
213310050422     C     SAVZNC        andeq     VARZNC
213320050422     C     SAVbva        andeq     vidbva
213330980409     C                   MOVE      'N'           WPRT              1
213340050422     c                   endif
213350940214     C                   ENDIF
213360910411     C*
213370910405     C*                    MODIFICHE SENZA AGGIORNAMENTO FLBLD
213380980409     C  N31SAVTSP        IFNE      BLPTSP
213390940214     C     SAVCAD        ORNE      VIDCAD
213400940214     C     SAVZNC        ORNE      VARZNC
213410050421     C     SAVbva        ORNE      vidbva
213420910405     C                   SETON                                        3132
213430930402     C                   END
213440120302     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BRT
213450051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
213460980409     C     SAVCAD        IFNE      VIDCAD
213470051102     C                   EXSR      AGGARS
213480980409     C                   END
213490000915     C* SE HO VARIATO SOLO COD.CHI SONO DEVO ANDARE IN WRITE SU FISGN
213500000915     C     *IN31         IFEQ      *OFF
213510000915     C     *IN32         ANDEQ     *OFF
213520000915     C     WUPDSG        ANDEQ     'S'
213530000915     C                   SETON                                        3132
213540000915     C                   ENDIF
213550940214     C* --> VARIO FLBLD
213560971230     C     *IN31         IFEQ      *ON
213570001019     C                   CLEAR                   WSTSGN
213580000915     C     KBLP3         CHAIN     FNBLD000                           33
213590000915     C  N33              MOVEL     BLDFST        SAVFST
213600941108     C*
213610000915     C     *IN33         DOWEQ     *OFF
213620001018     C     WSGNR         IFEQ      'S'
213630001018     C                   MOVEL     'B'           WSGNR
213640001018     C                   ENDIF
213650980410     C* VARIAZIONE FLBLD00F E STAMPA
213660971230     C     *IN32         IFEQ      *OFF
213670940214     C                   EXSR      CRTBLD
213680971230     C                   ELSE
213690001005     C* RICHIAMO STASCD PER SCRITTURA FISGN IN RISTAMPA
213700001005     C     WSGNR         IFEQ      'B'
213710001005     C                   EXSR      STASCD
213720001005     C                   MOVEL     'S'           WSGNR
213730001005     C                   ENDIF
213740940214     C* SOLO STAMPA
213750971217     C*  NON VENGONO RISTAMPATI I SAGNACOLLI SE SONO SOLO ESTERO
213760971230     C     SAVFST        IFEQ      'S'
213770980319     C                   EXSR      STASCD
213780081008     C**   *IN12         IFEQ      *ON
213790081008     C**   *IN15         ANDEQ     *OFF
213800081008     c**   A_§ogntw      andeq     'EUP'
213810081008     C**                 MOVEL     'E'           WTRC
213820081008     C**   KBLP4         CHAIN     Fiar4000                           90
213830081008     C**   *IN90         IFEQ      *OFF
213840081008     C**                 MOVEL     ar4NOT        DSBL4E
213850081008     C**                 MOVEL     'S'           §B4EST
213860081008     C**                 MOVEL     DSBL4E        ar4NOT
213870081008     C**                 UPDATE    Fiar4000
213880081008     C**                 ENDIF
213890081008     C**                 SETOFF                                       90
213900081008     C**                 ENDIF
213910971230     C                   ENDIF
213920040603     c* disalloco record di fnbld
213930040603     c                   unlock    fnbld01l
213940971230     C                   ENDIF
213950940907     C*
213960940907     C* SE PUO' AVERE PIU' CODICI PORDOTTO (FLAG 7 = "S") RILEGGO
213970940907     C*  ALTRIMENTI ESCO DALLA LETTURA DI FLBLD50F, PERCHE' SE HO
213980940907     C*  AGGIUNTO IL CODICE PRODOTTO RISCHIO DI RILEGGE IL RECORD
213990971230     C     §1BFG7        IFEQ      'S'
214000000915     C     KBLP3         READE     FNBLD000                               33
214010940907     C                   ELSE
214020000915     C                   SETON                                        33
214030971230     C                   END
214040940907     C*
214050940214     C                   ENDDO
214060940214     C                   ENDIF
214070910417     C                   END
214080910128     C*
214090910128     C                   END
214100910411     C                   END
214110910201     C                   END
214120910411     C*
214130910411     C* STAMPA SEGNACOLLO IN  I M M E D I A T O
214140910131     C     §1BFG6        IFEQ      'I'
214150910208     C* PER DISK CLIENTI O IMMISSIONE BOLLE STAMPO SUBITO
214160910208     C                   MOVEL     *BLANKS       §LDRST
214170081008     C**   WESTER        IFEQ      'S'
214180081008     C**                 MOVEL     'ALL'         §DETST
214190081008     C**                 ELSE
214200971215     C                   MOVEL     'ITA'         §DETST
214210040505     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
214220040505     c* etichetta Italia con dati esteri
214230040505     C     A_§ogntw      IFEQ      'EEX'
214240040505     C                   MOVEL     'EEX'         §DETSE
214250040506     c                   else
214260040506     c                   clear                   §detse
214270040505     C                   ENDIF
214280081008     C**                 ENDIF
214290971215     C* IMPOSTO I SEGNACOLLI DAL AL DA STAMPARE
214300971215     C                   Z-ADD     BLPNCD        CO2SCD
214310971215     C     BLPNCA        IFEQ      0
214320971215     C                   Z-ADD     BLPNCD        STANCA
214330971215     C                   ELSE
214340971215     C                   Z-ADD     BLPNCA        STANCA
214350971215     C                   END
214360910131     C   12
214370910131     CAN 15
214380910201     CORN12              EXSR      STASCI
214390910131     C*
214400910405     C* IN MANUTENZIONE STAMPO SOLO SE CAMBIATI:
214410910131     C   12
214420910131     CANN15              DO
214430001005     C     WSGNR         IFEQ      'S'
214440001005     C                   MOVEL     'B'           WSGNR
214450001005     C                   ENDIF
214460980320     C* SE MODIFICATO IL CAP DI UNA BOLLA EXPORT BAR (MA NON LA LNA)
214470051102     C* DEVO AGGIORNARE IL NUMERO SEGNACOLLO EUROEXPRESS SU FIARS
214480980409     C     SAVCAD        IFNE      VIDCAD
214490051102     C                   EXSR      AGGARS
214500980409     C                   END
214510000922     C* SE DISK C DEVO RICHIAMARE STASCI ANCHE PER LE SEGUENTI VARIAZ.
214520050228     C***  §1BF12        IFNE      'N'
214530050228     C***  §1BF12        ANDNE     'E'
214540050228     C***  §1BF12        OREQ      'E'
214550050228     C***  WASDKC        ANDEQ     'S'
214560050228     C***  WSGNR         OREQ      'B'
214570050228     C***  SAVMIT        IFNE      WKSC
214580050228     C***  SAVPDR        ORNE      VIDPDR
214590050228     C***  SAVRSD        ORNE      VIDRSD
214600050228     C***  §1BFG7        ORNE      'S'
214610050228     C***  SAVRMA        ANDNE     VIDRMA
214620050228     C***                MOVEL     'S'           WUPDSG
214630050228     C***                ENDIF
214640050228     C***                ENDIF
214650980320     C*
214660001018     C                   CLEAR                   WNOPRT
214670940214     C     SAVLNA        IFNE      VIDLNA
214680940214     C     SAVNCL        ORNE      VIDNCL
214690940214     C     SAVCAD        ORNE      VIDCAD
214700930930     C     SAVZNC        ORNE      VIDZNC
214710941230     C     SAVTSP        ORNE      BLPTSP
214720050421     C     SAVbva        ORNE      vidbva
214730910405     C*
214740930930     C                   EXSR      STASCI
214750001018     C                   ELSE
214760050228     c     wdkc          ifeq      'S'
214770050228     c     wsgnr         oreq      'B'
214780050228     C     SAVMIT        IFNE      WKSC
214790050228     C     SAVPDR        ORNE      VIDPDR
214800050228     C     SAVRSD        ORNE      VIDRSD
214810050228     C     §1BFG7        ORNE      'S'
214820050228     C     SAVRMA        ANDNE     VIDRMA
214830050228     c     wupdsg        oreq      'S'
214840001018     C                   MOVEL     '1'           WNOPRT            1
214850001018     C                   EXSR      STASCI
214860001018     C                   ENDIF
214870050228     c                   endif
214880930930     C                   ENDIF
214890910131     C                   END
214900910117     C                   END
214910910312     C*
214920910129     C* PER DISK CLIENTI SE CAMBIATO CTM E PRIMA ERA "D" CANCELLO
214930020917     C*   IN FIVAD01L I RECORD
214940940222     C     *IN12         IFEQ      *ON
214950940222     C     *IN15         ANDEQ     *ON
214960970328     C* FLAG DI RISTAMPA BOLLA
214970970328     C                   MOVEL     WSTA          CMD8
214980940222     C                   ENDIF
214990980406     C* PER DISK CLIENTI SE CAMBIATO CTM VEDO SE CANCELLARE IL VAT
215000980406     C     *IN12         IFEQ      *ON
215010980406     C     *IN15         ANDEQ     *ON
215020980406     C                   EXSR      DELVAT
215030040601     C                   EXSR      DELVAX
215040980406     C                   END
215050940920     C***
215060940216     C* S T A M P A    B O L L A
215070940920     C***
215080020619     C* ESCLUDO SEMPRE BOLLE DI RECUPERO (TRANNE LE BOLLE FO-ASSEGNATO
215090020619     c* RECUPERO BOLLE firmate perchè in questo caso la bolla firmata
215100020619     c* deve partire con allegata la bolla di recupero)
215110040701     C* ESCLUDO SEMPRE BOLLE EXPORT DPD, BOLLE POSTE (solo se data
215120040701     c* spedizione < data in tabella "VPO" trk "PPT"
215130000121     C*
215140940920     C* 1) SE FLG STAMPA BOLLA CLIENTE NON E' "S" (STAMPATA DAL CLIENT)
215150940920     C*                              E NON E' "B" (DA STAMPARE COL PGM
215160940920     C*                                            DI RISTAMPA BOLLA)
215170940920     C*                                MA  E' "N" (DA STAMPARE IN IMMIS
215180940920     C*                                            SIONE BOLLE)
215190940920     C* IN MANUTENZIONE SI PUO' RISTAMPARE SEMPRE
215200970407     C* 2) SE IN MANUT. SE PREMUTO CMD8  (CMD8= 1)
215210941230     C* 3) SE DA DISK CLIENTI SOLO SE LNP >< DA LNA   PER "G"
215220960321     C* 4) SE DA DISK CLIENTI MAI                     PER "P"
215230970407     C* 5) SE IN MANUT. SE ERA NO DDT E DIVENTA SI DDT STAMPO SUBITO
215240000121     C* 6) SE IN MANUT. SE ERA SI DDT DPD E DIVENTA SI DDT NON DPD
215250000121     C*                                                STAMPO SUBITO
215260940216     C*
215270000121     C* 7) RESI E DIROTTAMENTI SEMPRE SUBITO
215280000121     C* 8) SE BOLLA A3 NON SI PUO' MAI STAMPARE
215290000121     C* 9) SE BOLLA F3 NON SI PUO' STAMPARE IN IMMISSIONE
215300000509     C*10) SE MANUTENZIONE DI PREPAGATO, RISTAMPO SEMPRE SE E' DDT SI
215310000121     C*11) SE IMMISSIONE   DI PREPAGATO, STAMPO SEMPRE
215320960321    0C     §3ATB1        IFNE      'A3'
215330020319     C     A_§OGNTW      ANDNE     'DPD'
215340020319     C     §ogntw        ANDNE     'PPT'
215350020619     c     §3atb1        oreq      'A3'
215360020619     c     blpcbo        andeq     'FO'
215370020319     C     §ogntw        OREQ      'PPT'
215380000713     C     BLPNRS        ANDEQ     0
215390040701     c     §ogntw        oreq      'PPT'
215400040729     c     blpdsp        andge     §vpoptl
215410000218     C* PER I PREPAGATI STAMPO LA BOLLA CHE E'LA FATTURA
215420000218     C     *IN34         OREQ      *ON
215430960321     C*
215440941110    1C     *IN12         IFEQ      *OFF
215450970128     C     BLPFST        ANDEQ     'S'
215460940216     C*
215470940216     C     *IN12         OREQ      *ON
215480940216     C     CMD8          ANDEQ     '1'
215490970404     C     BLPFST        ANDNE     'N'
215500970404     C*
215510970404     C     *IN12         OREQ      *ON
215520970404     C     *IN15         ANDEQ     *OFF
215530970404     C     SAVBAM        ANDNE     'S'
215540970404     C     SAVBAM        ANDNE     'C'
215550970404     C     BLPFST        ANDEQ     'S'
215560970407     C*
215570970407     C     *IN12         OREQ      *ON
215580970407     C     *IN15         ANDEQ     *ON
215590970407     C     CMD8          ANDEQ     'S'
215600990630     C*
215610990630     C     *IN12         OREQ      *ON
215620990701     C     *IN15         ANDEQ     *OFF
215630990630     C     BLPFST        ANDEQ     'S'
215640990701     C     *IN22         ANDEQ     *ON
215650990701     C     *IN12         OREQ      *OFF
215660990701     C     *IN34         ANDEQ     *ON
215670000121     C*
215680000121     C     *IN12         OREQ      *ON
215690000121     C     *IN15         ANDEQ     *OFF
215700020319     C     SAVNTW        ANDEQ     'DPD'
215710020319     C     A_§OGNTW      ANDNE     'DPD'
215720000121     C     BLPFST        ANDEQ     'S'
215730900514     C                   EXSR      STAMPA
215740940216    1C                   END
215750960321    0C                   END
215760911031     C*
215770911031     C* PASSO IL NUMERO DI SPEDIZIONE AL PGM RICHIAMATO
215780911031     C   12              Z-ADD     BLPNSP        §LPNSP
215790921006     C* SE RECUPERO ADDIZIONO 1 AL NUMERO
215800921006     C  N12
215810921006     CAN 98              ADD       1             RECNSP
215820900504     C*
215830040415     c* In manutenzione bolle , se riscritto fnblt devo clearare blpncr/ncp
215840061213    1c*                  if        *in12 and not *in15
215850061213    2c*                  if        wablt='S'
215860061213     c*    blpnrr        chain     fnblp000                           90
215870061213     c*                  clear                   blpncr
215880061213     c*                  clear                   blpncp
215890061213     c*                  clear                   blpvlc
215900061213     c*                  clear                   blppkc
215910061213     c* n90              update    fnblp000
215920061213   x2c*                  else
215930050502     c* Se già calcolato volume cml devo reimpostarlo su VLF
215940061213    3c*                  if        (blpvlc>0 and  blpncr>0 and blpncr<99999)
215950061213     c*    blpnrr        chain     fnblp000                           90
215960061213     c*                  clear                   dslv20
215970061213     C*                  MOVEL     'P'           D20TBO
215980061213     C*                  MOVEL     'C'           D20TVL
215990061213     c*                  movel     'L'           d20tla
216000061213     C*                  MOVEL     BLPvlc        D20vlu
216010061213     C*                  MOVEL     BLPncr        D20ncr
216020061213     C*                  MOVEL     BLPFVF        D20FVF
216030061213     C*                  MOVEL     BLPVLF        D20VLF
216040061213     C*                  MOVEL     BLPFVB        D20FVB
216050061213     C*                  MOVEL     BLPVLB        D20VLB
216060061213     C*                  MOVEL     BLPAAS        D20AAS
216070061213     C*                  MOVEL     BLPLNP        D20LNP
216080061213     C*                  MOVEL     BLPNRS        D20NRS
216090061213     C*                  MOVEL     BLPNSP        D20NSP
216100061213     C*                  MOVEL     BLPCBO        D20CBO
216110061213     C*                  MOVEL     BLPNCL        D20NCL
216120061213    4C*    BLPDBR        IFGT      *ZEROS
216130061213     C*                  MOVE      BLPDBR        D20DTE
216140061213     C*                  ELSE
216150061213     C*                  MOVE      BLPMGS        D20DTE
216160061213     C*                  MOVEL     BLPAAS        D20DTE
216170061213    4C*                  END
216180061213     C*                  MOVEL     DSLV20        KPJBU
216190050502     C*
216200061213     C*                  CALL      'FNLV20R'
216210061213     C*                  PARM                    KPJBA
216220061213     c*                  parm      'N'           pwstor            1
216230050502     C*
216240061213     C*                  MOVEL     KPJBU         DSLV20
216250050502     C* SE NON C'E' ERRORE : AGGIORNO LA BOLLA
216260061213    4C*    D20ERR        IFNE      '1'
216270061213     C*                  MOVEL     D20FVF        BLPFVF
216280061213     C*                  MOVEL     D20VLF        BLPVLF
216290061213E   4C*                  ENDIF
216300061213     c*                  update    fnblp000
216310061213    3c*                  endif
216320061213    2c*                  endif
216330061213    1c*                  endif
216340070601     c                   if        wmsg_pda='S'
216350070606     c* decodifico l'aut.
216360070606     C                   move      w02pdr_p      kpdpdr
216370070606     C                   move      'A'           kpdtip
216380070606     c                   clear                   w02rsc_p
216390070606     c     kfapd         chain     fiapd01l
216400070606     c                   if        %found(fiapd01l)
216410070606     c                   movel     apdrsc        w02rsc_p
216420070606     c                   endif
216430070601     c                   exfmt     ls01w02pda
216440070601     c                   endif
216450040408     c
216460080603     c* disalloco fisgn01l: Se manutneziono bolla export dpd senza
216470080603     c* modificare nulla, nella routine CTRSGN viene allocato fisgn
216480080603     c* e non viene poi pèiù disallocato
216490080603     c                   unlock    fisgn01l
216500081111     c* in manutenzione se cambiata data ritiro verifico se rielaborare
216510081121     c* statistica partito e a terra
216520090330     c* devo rielaborare anche in immissione se la data ritiro è inferiore
216530090330     c* a udate
216540090330    1c                   if        (*in12 and not *in15 and blpdrt<>s_drtblpi)
216550090330     c                             or ((*in12='0' or *in15) and blpdrt>0)
216560090330     c                   z-add     blpncl        st2ncl
216570090330    2c                   If        blpdrt <= §SdfParU
216580081111     C                   MOVE      blpdrt        SA2DTS            8 0
216590081111     C                   MOVE      'P'           SA2TRC            1
216600090330     C                   exsr      sr_callsa2r3
216610090330    2c                   endif
216620090330    2c                   If        s_drtblpi <= §SdfParU
216630081121     c                             and s_drtblpi > 0
216640081111     C                   MOVE      s_drtblpi     SA2DTS            8 0
216650081111     C                   MOVE      'P'           SA2TRC            1
216660090330     C                   exsr      sr_callsa2r3
216670090330    2c                   endif
216680090330    2c                   If        blpdrt <= §SdfterU
216690081121     C                   MOVE      blpdrt        SA2DTS            8 0
216700081121     C                   MOVE      'T'           SA2TRC            1
216710090330     C                   exsr      sr_callsa2r3
216720090330    2c                   endif
216730090330    2c                   If        s_drtblpi <= §SdfTerU
216740081121     c                             and s_drtblpi > 0
216750081121     C                   MOVE      s_drtblpi     SA2DTS            8 0
216760081121     C                   MOVE      'T'           SA2TRC            1
216770090330     C                   exsr      sr_callsa2r3
216780090330    2c                   endif
216790090330    1c                   endif
216800130308     c* invio messagio a ced se cliente fornisce pdf senza abilitazione
216810130313     c* e nel caso in cui la bolla sia stata confermata senza (hanno
216820130313     c* cambiato il CTM a video)
216830130313     c                   if        wvatpe='S' and §1bf16<>'S'
216840130308     c                   exsr      ced_alert
216850130308     c                   endif
216860080603
216870040408     C     ENDREG        ENDSR
216880090330      *--------------------------------------------------------------*
216890090330      * Richiamo pgm per rielaborazione statistiche partito e a terra
216900090330      *--------------------------------------------------------------*
216910090330     c     sr_callsa2r3  BegSr
216920090330     C                   CALL      'FNLSA2R3'
216930090330     C                   PARM                    SA2TLA            1
216940090330     C                   PARM                    SA2TRC
216950090330     C                   PARM                    SA2DTS
216960090330     C                   PARM                    WWLNA             3 0
216970090330     C                   PARM                    st2ncl            5 0
216980090330     c                   endsr
216990160421      *--------------------------------------------------------------*
217000160422      * Verifica se aggiornare la zona di consegna su blp
217010160421      *--------------------------------------------------------------*
217020160421     c     sr_VariaZnc   BegSr
217030160422     c* Se già presente una spunta reale, allo scarico spunte
217040160422     c* è stata aggiornata la zona su blp con la zona della spunta se <>
217050160422     c* In questi casi questo pgm non deve più modificare la zona di consegna
217060160422     c* della bolla
217070160421     c                   if        blplna=lna_sav   and
217080160422     c                             blpncl<=savncl
217090160422     C     Kblt1         SETLL     fiart01l
217100160422     C     kblt1         READE(n)  fiart01l
217110160421    2C                   DOW       not %eof(fiart01l)
217120160421     C*
217130160421     c                   exsr      sr_zona
217140160421     c                   if        wokzona='1'
217150160421     c* verifico se presente una spunta
217160160421     c                   eval      w_VariaZnc='N'
217170160421     c                   leavesr
217180160421     c                   endif
217190160422     C     kblt1         READE(n)  fiart01l
217200160421     c                   enddo
217210160422     c                   endif
217220160421     c                   endsr
217230060209      *--------------------------------------------------------------*
217240060209      * Storicizzazione variazione di tassazione prepagato
217250060209      *--------------------------------------------------------------*
217260060209     c     Stoarb        BegSr
217270060209     c*
217280060209     c                   open      fiarbt0f
217290060209     c                   open      fiarbu0f
217300060209     c*
217310060209     c                   movel     '1'           wtrc
217320060209     C     KBLP4         CHAIN     FIAR6000
217330060209     c*
217340060209     c                   z-add     blpaas        arbaas
217350060209     c                   z-add     blplnp        arblnp
217360060209     c                   z-add     blpnrs        arbnrs
217370060209     c                   z-add     blpnsp        arbnsp
217380060209     C                   MOVEL     AR6DIV        ARBDIV
217390060209     C                   MOVEL     AR6POR        ARBPOR
217400060209     C                   MOVEL     AR6SV1        ARBSV1
217410060209     C                   MOVEL     AR6VA1        ARBVA1
217420060209     C                   MOVEL     AR6SV2        ARBSV2
217430060209     C                   MOVEL     AR6VA2        ARBVA2
217440060209     C                   MOVEL     AR6SV3        ARBSV3
217450060209     C                   MOVEL     AR6VA3        ARBVA3
217460060209     C                   MOVEL     AR6IMV        ARBIMV
217470060209     C                   MOVEL     AR6ALI        ARBALI
217480060209     C                   MOVEL     AR6CEI        ARBCEI
217490060209     C                   MOVEL     AR6IFT        ARBIFT
217500060209     C                   MOVEL     AR6DFT        ARBDFT
217510060209     C                   MOVEL     AR6NFT        ARBNFT
217520060209     C                   MOVEL     AR6FIV        ARBFIV
217530060209     C                   MOVEL     AR6FIM        ARBFIM
217540060209     c                   z-add     blpksc        arbksc
217550060209     c                   z-add     blpctr        arbctr
217560060209     c                   move      blpcbo        arbcbo
217570060209      *
217580060209      * Metto nell'ultimo byte del campo arbpru che la bolla aggiornata
217590060209      * è in partenza 'P'
217600060209     C                   MOVE      'P'           ARBPRU
217610060209      *
217620060209     C                   WRITE     FIARBT00
217630060209     C*
217640060209     C* SE HO DELLE ATRE VARIE LE STORICIZZO NEL FILE FIARBU0F
217650060209    1C     WAR7          IFEQ      'E'
217660060209     C     Kblp4         SETLL     FIAR7000
217670060209     C     Kblp4         READE     FIAR7000                               30
217680060209     C*
217690060209    2C     *IN30         DOWEQ     *OFF
217700060209     C                   MOVEL     AR7SVN        ARBSVN
217710060209     C                   MOVEL     AR7VAN        ARBVAN
217720060209     C                   WRITE     FIARBU00
217730060209     C*
217740060209     C     Kblp4         READE(N)  FIAR7000                               30
217750060209    2C                   ENDDO
217760060209     C                   ENDIF
217770060209     C*
217780060209     c                   close     fiarbt0f
217790060209     c                   close     fiarbu0f
217800060209     C*
217810060209     c                   endsr
217820060209
217830050209      *--------------------------------------------------------------*
217840050209      * Chaino fncls per codice ass. per impostazione §b4af1
217850050209      *--------------------------------------------------------------*
217860050209     c     Sr_fncls      BegSr
217870050209     c                   clear                   WCLSflo8
217880050209     c     §b4aks        chain     fncls01l
217890050209     c                   if        %found(fncls01l)
217900050209     c                   eval      wclsflo8 = %SUBST(clsflo:8:1)
217910050209     c                   endif
217920050209     c                   endsr
217930030704
217940030704      *--------------------------------------------------------------*
217950030704      * Scrivo/Aggiorno Fiar5
217960030704      *--------------------------------------------------------------*
217970030704     c     Sr_wrtFiar5   BegSr
217980030704
217990030704     c                   If        %Found(Fiar501l)
218000030704     c                   Update    Fiar5000
218010030704     c                   Else
218020030704     c                   Eval      Ar5Aas = BlpAas
218030030704     c                   Eval      Ar5Lnp = BlpLnp
218040030704     c                   Eval      Ar5Nrs = BlpNrs
218050030704     c                   Eval      Ar5Nsp = BlpNsp
218060030704     c                   Eval      Ar5Trd = KAr5Trd
218070030704     c                   Eval      Ar5Ft1 = 'T'
218080030704     c                   Eval      Ar5Dt1 = *All'9'
218090030704     c                   Eval      Ar5Ft2 = 'T'
218100030704     c                   Eval      Ar5Dt2 = *All'9'
218110030704     c                   Write     Fiar5000
218120030704     c                   EndIf
218130030704
218140030704     c                   EndSr
218150030326
218160030326      *--------------------------------------------------------------*
218170030326      * Forzo la data consegna richiesta
218180030326      *--------------------------------------------------------------*
218190030326     c     SrDcr         BegSr
218200111206     c* questa DS mi serve per controllare la data calcolata con i giorni
218210111206     c*  di chiusura, solo in caso di partciolarità di attesa
218220111206     c*  richiamerò non il TRUL13 ma il TRUL13R1
218230111206     c                   clear                   trul13ds1
218240100218     c
218250100218    1c                   select
218260030409      * Se non ho le ore da aggiungere alla delivery
218270100218If  1c                   when      VidOre > *Zeros
218280100218     c
218290100218     c                   Eval      wwtcr = 'P'
218300100218     c                   Eval      wore = VidOre
218310100218     c                   if        blptsp='C' or blptsp='E'
218320100218     c                   eval      wore=wore+24
218330100218     c                   endif
218340100218     c                   if        blptsp<>'H'
218350100218     c                   Exsr      CalDcr
218360100218     c                   endif
218370100218     c
218380100218     c* Se ho la particolarità, cerco con particolarità
218390100218    1c                   when      vidgma<>'  ' and §7ratt='S'
218400100218     c                   Clear                   dDcr
218410100218     c                   Clear                   dsbs02
218420100218     c                   Eval      T02Mod = 'C'
218430100218     c                   Eval      T02Sif = Knsif
218440100218     c                   Eval      T02Cod = 'DCR'
218450100218     c                   Movel     wksc          T02Ke1
218460100218     c                   Movel     'TTR'         t02ke2
218470100218     c                   Call      'TIBS02R'
218480100218     c                   Parm                    Kpjba
218490100218     c                   Parm                    Dsbs02
218500100218     c
218510100218      * se il cliente è codificato in tabella calcolo la nuova data
218520100218      * consegna richiesta
218530100218If  2c                   If        T02Err = *Blanks
218540100218     c                   Movel     T02Uni        dDcr
218550100218     c                   Eval      wore = §DcrOre
218560100218     c                   Eval      wwtcr = §DcrTcr
218570111206     c* Imposto i giorni di chiusura
218580111206     c                   eval      i13gc1=vidgc1
218590111206     c                   eval      i13gc2=vidgc2
218600111206     c                   eval      i13tcr=wwtcr
218610100218     c                   Exsr      CalDcr
218620100218     c                   endif
218630100218     c
218640100218   x1c                   other
218650100218      * Forzo la data consegna richiesta con tabella DCR se:
218660100218      * 1) non è una bolla di recupero o un conto servizi
218670100218      * 2) non è un tipo serivizio "H"=Consegna ore 10:30
218680100218      * 3) non è un tipo serivizio "E"=priority
218690100218      *  se trovo la tabella DCR con cliente/tariffa o solo cliente
218700100218     c
218710100218If  2c                   If        §3arbl = 'N' and blptsp<>'H'
218720100217     c                             and blptsp<>'E'
218730100215
218740030326     c                   Clear                   dDcr
218750030326     c                   Clear                   dsbs02
218760030326     c                   Eval      T02Mod = 'C'
218770030326     c                   Eval      T02Sif = Knsif
218780030326     c                   Eval      T02Cod = 'DCR'
218790100215     c                   Movel     wksc          T02Ke1
218800100218     c                   Movel     VidCtr        t02ke2
218810030326     c                   Call      'TIBS02R'
218820030326     c                   Parm                    Kpjba
218830030326     c                   Parm                    Dsbs02
218840030326      * se il cliente è codificato in tabella calcolo la nuova data
218850030326      * consegna richiesta
218860100218If  3c                   If        T02Err <>*Blanks
218870100218     c                   Eval      T02Mod = 'C'
218880100218     c                   Eval      T02Sif = Knsif
218890100218     c                   Eval      T02Cod = 'DCR'
218900100218     c                   Movel     wksc          T02Ke1
218910100218     c                   clear                   t02ke2
218920100218     c                   Call      'TIBS02R'
218930100218     c                   Parm                    Kpjba
218940100218     c                   Parm                    Dsbs02
218950100218    3c                   endif
218960100218     c
218970100218If  3c                   If        T02Err = *Blanks
218980030326     c                   Movel     T02Uni        dDcr
218990030409     c                   Eval      wore = §DcrOre
219000030409     c                   Eval      wwtcr = §DcrTcr
219010030409     c                   Exsr      CalDcr
219020100218    3c                   EndIf
219030100218    2c                   EndIf
219040100218    1c                   Endsl
219050030326
219060030326     c                   EndSr
219070030409
219080030409      *--------------------------------------------------------------*
219090030409      * Calcolo le ore da aggiungere alla delivery
219100030409      *--------------------------------------------------------------*
219110030409     c     CalDcr        BegSr
219120100222     c* Se 24 ore per IL o  48 per PRIMA DDEL
219130100219     c*   devo aggiungere alla delivery anche i tempi
219140100219     c*   del C/ass altrimenti non servono (48 ore le ho comunque)
219150100222     c                   if        (wwTCR= ' ' and  wore>24)
219160100222     c                             or (wwTCR='P' and wore>48)
219170100222     c                             or wwTCR='D'
219180100219     c                   eval      UsaCass='N'
219190100219     c                   endif
219200100219     c
219210030409      * CALL AL TNSD99 x calcolare la data consegna teorica
219220030409     c                   ExSr      CLSE98
219230100219     c
219240100219      * Richiamo pgm che calcola la prima data lavorativa disponibile
219250030409     c                   Clear                   Trul13ds
219260030409     c                   Eval      tI13Tla = 'L'
219270030409     c                   Eval      I13Mod = 'A'
219280030409     c                   Eval      I13Fil = BlpLna
219290030409     c                   Eval      I13Din = d98dce
219300030409     c                   Eval      I13Hin = d98hce
219310030409     c                   Eval      I13Ore = wore
219320111206     c
219330111206     c* se impostati i giorni di chiusura, richiamo trul13r1
219340111206     c                   if        i13gc1<>*blanks or i13gc2<>*blanks
219350111206     c                   Call      'TRUL13R1'
219360111206     c                   Parm                    Trul13ds
219370111206     c                   Parm                    Trul13ds1
219380111206     c                   else
219390030409     c                   Call      'TRUL13R'
219400030409     c                   Parm                    Trul13ds
219410111206     c                   endif
219420111206     c
219430111206     c                   If        tO13Err = *Blanks and o13dfi>0
219440030409     c                   Eval      BlpTcr = wwtcr
219450030409     c                   Eval      BlpDcr = O13Dfi
219460030409     c                   EndIf
219470030409
219480030409     c                   EndSr
219490000209     C*
219500000209     C* CONTROLLO FILE FISGN00F -------------------------------------*
219510000209     C     CTRSGN        BEGSR
219520010116     C     KSGN          CHAIN     FISGN01L                           30
219530000209    3C     *IN30         IFEQ      *OFF
219540000209     C* SE NON E' LA STESSA SPEDIZIONE, ANNULLO
219550000209    4C     §LDAAS        IFNE      BLPAAS
219560000209     C     SGNLNP        ORNE      BLPLNP
219570000209     C     §LDNRS        ORNE      BLPNRS
219580000209     C     SGNNSP        ORNE      BLPNSP
219590000919    5C     SGNATB        IFNE      '*'
219600000920     C* Se il chi sono non è di nuova immissione non devo incrementare
219610000920     C* il progressivo ed in generale non è necessario updatare fisgn
219620000920     C* perchè in questo caso risulta già annullato
219630000920    6C     V8HCOL        IFEQ      *ZEROS
219640000209     C                   MOVEL     'A'           SGNATB
219650010116     C                   CLEAR                   SGNT6A
219660010116     C                   CLEAR                   SGNT6B
219670010116     C                   CLEAR                   SGNT6C
219680010116     C                   CLEAR                   SGNT6D
219690010116     C                   CLEAR                   SGNT6E
219700010116     C                   CLEAR                   SGNT6F
219710080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
219720000920    7C     SGNFL1        IFEQ      *BLANKS
219730000920     C                   MOVE      *ZEROS        WSGPRG            1 0
219740000920     C                   ELSE
219750000920     C                   MOVE      SGNFL1        WSGPRG
219760000920    7C                   ENDIF
219770000920     C                   ADD       1             WSGPRG
219780000920     C                   MOVE      WSGPRG        SGNFL1
219790000209     C                   UPDATE    FISGN000
219800150701     c                   exsr      sr_CalSgn
219810000921   X6C                   ELSE
219820001009     C     *IN79         IFEQ      *OFF
219830001011     C     WEXDPD        ANDNE     'S'
219840160225     c     w_adpd        andne     'S'
219850001009     C                   UNLOCK    FISGN01L
219860001009     C                   ENDIF
219870000920    6C                   ENDIF
219880000209     C                   MOVEL     'N'           WDKC
219890000919   x5C                   ELSE
219900000919     C* altra spedizione ma sgnatb='*' --> posso andare in update
219910000919     C                   MOVEL     'S'           WESSGN            1
219920000921     C                   CLEAR                   SGNST2
219930000920     C     *IN79         IFEQ      *OFF
219940001011     C     WEXDPD        ANDNE     'S'
219950160225     c     w_adpd        andne     'S'
219960000919     C                   UNLOCK    FISGN01L
219970000919    5C                   ENDIF
219980000920    5C                   ENDIF
219990000209   X4C                   ELSE
220000000209     C*
220010000921     C* MEMORIZZO CHE ESISTE FISGN --> VADO IN UPDATE
220020000921     C* SE PERO' E' ANNULLATO IL COLLO NON DEVO TRATTARLO COME DISK C
220030000921     C     SGNATB        IFEQ      'A'
220040000921     C                   MOVEL     'N'           WDKC
220050000921     C                   ELSE
220060000209     C                   MOVEL     'S'           WESSGN            1
220070000921     C                   ENDIF
220080000918     C     *IN79         IFEQ      *OFF
220090001011     C     WEXDPD        ANDNE     'S'
220100160225     c     w_adpd        andne     'S'
220110000918     C                   UNLOCK    FISGN01L
220120000918     C                   ENDIF
220130000209    4C                   ENDIF
220140000209     C*
220150000209   X3C                   ELSE
220160000209     C* IMMISSIONE
220170000919     C                   CLEAR                   SGNATB
220180000209     C                   MOVEL(P)  KWHO          SGNWHO
220190000211     C                   Z-ADD     §3ISEA        SGNSEA
220200000209     C                   MOVEL     'S'           SGNST1
220210000921     C                   CLEAR                   SGNST2
220220000921     C                   MOVE      '0'           SGNFL1
220230000211     C     BLPCCM        IFGT      0
220240000211     C                   MOVEL     BLPCCM        SGNKSC
220250000211     C                   ELSE
220260000211     C                   MOVEL     BLPKSC        SGNKSC
220270000908    4C                   ENDIF
220280000921     C                   MOVEL     BLPLNP        SGNLNP
220290000921     C                   MOVEL     BLPNSP        SGNNSP
220300010116     C                   CLEAR                   SGNT6A
220310010116     C                   CLEAR                   SGNT6B
220320010116     C                   CLEAR                   SGNT6C
220330010116     C                   CLEAR                   SGNT6D
220340010116     C                   CLEAR                   SGNT6E
220350010116     C                   CLEAR                   SGNT6F
220360080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
220370000922     C                   CLEAR                   SGNRST
220380000211    3C                   ENDIF
220390000211     C**
220400000209     C                   ENDSR
220410000921     C* ANNULLO FILE FISGN00F -------------------------------------*
220420000921     C     ANNSGN        BEGSR
220430000921    1C     SGNATB        IFEQ      'A'
220440000921    2C     SGNFL1        IFEQ      *BLANKS
220450000921     C                   MOVE      *ZEROS        WSGPRG
220460000921   X2C                   ELSE
220470000921     C                   MOVE      SGNFL1        WSGPRG
220480000921    2C                   ENDIF
220490000921    2C     WSGPRG        IFEQ      0
220500000921     C                   MOVE      '*'           SGNATB
220510000921   X2C                   ELSE
220520000921     C                   SUB       1             WSGPRG
220530000921     C                   MOVE      WSGPRG        SGNFL1
220540000921    2C                   ENDIF
220550000921   X1C                   ELSE
220560000921    2C     SGNATB        IFEQ      *BLANKS
220570000921     C                   MOVEL     '*'           SGNATB
220580000921    2C                   ENDIF
220590000921    1C                   ENDIF
220600010116     C                   CLEAR                   SGNT6A
220610010116     C                   CLEAR                   SGNT6B
220620010116     C                   CLEAR                   SGNT6C
220630010116     C                   CLEAR                   SGNT6D
220640010116     C                   CLEAR                   SGNT6E
220650010116     C                   CLEAR                   SGNT6F
220660080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
220670001005     C     WSGNR         IFEQ      'B'
220680060622     c     *in79         oreq      *on
220690001005     C                   UPDATE    FISGN005
220700001005     C                   ELSE
220710000921     C                   UPDATE    FISGN000
220720150701     c                   exsr      sr_CalSgn
220730001005     C                   ENDIF
220740000921     C                   ENDSR
220750991014      *
220760991014      * AGGIORNO VARIE IN FNBLP E IN FIAR7 -------------------------*
220770991014     C     WRTVAR        BEGSR
220780991014      *
220790991014     C                   SELECT
220800991026    4C     C             WHENGT    3
220810991014     C                   Z-ADD     BLPAAS        AR7AAS
220820991014     C                   Z-ADD     BLPLNP        AR7LNP
220830991014     C                   Z-ADD     BLPNRS        AR7NRS
220840991014     C                   Z-ADD     BLPNSP        AR7NSP
220850991014     C                   MOVEL     '1'           AR7TRC
220860991014     C                   MOVEL     V3CSV1        AR7SVN
220870991014     C                   Z-ADD     V3CVA1        AR7VAN
220880991014     C                   WRITE     FIAR7000
220890991014    4 *
220900991014    4C     C             WHENEQ    3
220910991027     C                   MOVEL     V3CSV1        WSV3
220920991027     C                   Z-ADD     V3CVA1        WVA3
220930991014     C                   ADD       1             C
220940991014    4 *
220950991014    4C     C             WHENEQ    2
220960991027     C                   MOVEL     V3CSV1        WSV2
220970991027     C                   Z-ADD     V3CVA1        WVA2
220980991014     C                   ADD       1             C
220990991014    4 *
221000991014    4C     C             WHENEQ    1
221010991027     C                   MOVEL     V3CSV1        WSV1
221020991027     C                   Z-ADD     V3CVA1        WVA1
221030991014     C                   ADD       1             C
221040991014    4C                   ENDSL
221050991014      *
221060991014     C                   ENDSR
221070040116      *
221080040116      *-------------------------------------------------------------*
221090040116      * Aggiorno le varie della seconda bolla
221100040116      *-------------------------------------------------------------*
221110040116     c     WrtVar1       BegSr
221120040116
221130040116s   1c                   Select
221140040116     c                   When      ContaSv > 3
221150040116     c                   Eval      Ar7Aas = BlpAas
221160040116     c                   Eval      Ar7Lnp = BlpLnp
221170040116     c                   Eval      Ar7Nrs = BlpNrs
221180040116     c                   Eval      Ar7Nsp = BlpNsp
221190040116     c                   Eval      Ar7Trc = '2'
221200040116     c                   Eval      Ar7Svn = w2sv(c)
221210040116     c                   Eval      Ar7Van = w2va(c)
221220040116     c                   Write     Fiar7000
221230040116
221240040116     c                   When      ContaSv = 3
221250040116     c                   Movel     w2sv(c)       wsv3
221260040116     c                   Z-add     w2va(c)       wva3
221270040116     c                   Add       1             ContaSv
221280040116
221290040116     c                   When      ContaSv = 2
221300040116     c                   Movel     w2sv(c)       wsv2
221310040116     c                   Z-add     w2va(c)       wva2
221320040116     c                   Add       1             ContaSv
221330040116
221340040116     c                   When      ContaSv = 1
221350040116     c                   Movel     w2sv(c)       wsv1
221360040116     c                   Z-add     w2va(c)       wva1
221370040116     c                   Add       1             ContaSv
221380040116    1c                   EndSl
221390040116
221400040116     c                   EndSr
221410991014     C*
221420991014     C* CONTROLLO SE BOLLA DA STAMPARE O MNEO ----------------------*
221430991014     C     CTRSTA        BEGSR
221440970328     C                   MOVEL     '1'           WSTA
221450970328     C* SOLO PER RICHIAMO DA CONFERMA BOLLA
221460970328     C*  SE NON E' DA STAMPARE FACCIO FINTA CHE SIA STAMPA STAMPATA
221470970328     C     *IN12         IFEQ      *ON
221480970328     C     *IN15         ANDEQ     *ON
221490970328     C*
221500970407     C                   SELECT
221510970407     C     WFPR          WHENEQ    'G'
221520970328     C     BLPLNP        ANDEQ     BLPLNA
221530970328     C                   MOVEL     ' '           WSTA
221540970328     C* SE NON E' DA STAMPARE, NON STAMPO
221550970407     C     §1BFG3        WHENNE    'N'
221560970328     C                   MOVEL     ' '           WSTA
221570970328     C* SE FLAG "P" NON STAMPO MAI
221580970407     C     WFPR          WHENEQ    'P'
221590970328     C                   MOVEL     ' '           WSTA              1
221600970407     C**
221610970407     C* SE NON VENGO DA CONFERMA BOLLE STAMPO SEMPRE SUBITO
221620140612     C***  §LPRIC        WHENNE    'C'
221630160304     c***                when      §lpric<>'C'
221640160304     c***                          and (%lookup('999':sk_VPODIR)=0 and
221650160304     c***                               %lookup(%editc(blplnp:'X'):sk_VPODIR)=0)
221660160304     C***                MOVEL     'S'           WSTA
221670970407     C                   ENDSL
221680970328     C*
221690970328     C                   ENDIF
221700970328     C                   ENDSR
221710970328     C*
221720020917     C*--- CANCELLO RECORD FIVAD00F ----------------------------------*
221730951019     C     DELVAD        BEGSR
221740020917     C     KBLC          SETLL     FIVAD000                               30
221750910220     C   30              DO        *HIVAL
221760020917     C     KBLC          READE     FIVAD000                               30
221770020917     C  N30              DELETE    FIVAD000
221780910220     C  N30              END
221790910220     C*
221800910220     C                   ENDSR
221810020917     C*--- CANCELLO RECORD FIVAT00F ----------------------------------*
221820980406     C     DELVAT        BEGSR
221830020917     C     KBLC          SETLL     FIVAT000                               30
221840980406     C   30              DO        *HIVAL
221850020917     C     KBLC          READE     FIVAT000                               30
221860020917     C  N30              DELETE    FIVAT000
221870980406     C  N30              END
221880980406     C*
221890980406     C                   ENDSR
221900040601     c*
221910040601     C*--- CANCELLO RECORD FIVAX00F ----------------------------------*
221920040601     C     DELVAX        BEGSR
221930040601     C     KBLC          SETLL     FIVAX000                               30
221940040601     C   30              DO        *HIVAL
221950040601     C     KBLC          READE     FIVAX000                               30
221960040601     C  N30              DELETE    FIVAX000
221970040601     C  N30              END
221980040601     C*
221990040601     C                   ENDSR
222000940214     C*
222010940214     C* ROTTURA CODICE PRODOTT DA DETTAGLIO COLLI CLIENTE -----------*
222020940214     C     ROTCDP        BEGSR
222030940214     C*
222040940214     C                   Z-ADD     COMSCD        BLDNCD
222050940214     C     BLDNCD        ADD       VARNCL        BLDNCA
222060940214     C                   SUB       1             BLDNCA
222070940214     C                   ADD       VARNCL        COMSCD
222080940214     C     BLDNCA        IFEQ      BLDNCD
222090940214     C                   Z-ADD     0             BLDNCA
222100940214     C                   END
222110000426     C                   MOVEL     BLDNCL        SA2NCL
222120000426     C                   MOVE      BLDCDP        SA2CDP
222130000426     C                   MOVEL     VARNCL        BLDNCL
222140000426     C                   MOVE      VARCDP        BLDCDP
222150940224     C* CREA O AGGIORNA SEGNACOLLI
222160940214     C                   EXSR      CRTBLD
222170001002     C*
222180000426     C                   MOVEL     SA2NCL        BLDNCL
222190000426     C                   MOVE      SA2CDP        BLDCDP
222200940214     C                   ADD       VARNCL        BLDNC1
222210940214     C                   MOVEL     BLDCDP        VARCDP
222220940214     C                   CLEAR                   VARNCL
222230940214     C                   ENDSR
222240991117     C*
222250991117     C*--- IMPOSTO NUMERO DISTINTA PER SPED DPD ----------------------*
222260991117     C     SPEDPD        BEGSR
222270991117      *
222280991117     C                   CLEAR                   DPDBRC
222290991117      *
222300060510     C                   MOVE      §OGDP1        DPDLNP
222310991117      *
222320991117     C                   MOVEL     BLPMGS        W0020
222330991117     C                   MOVE      W0020         DPDGMS
222340991117     C                   MOVE      BLPMGS        W0020
222350991117     C                   MOVEL     W0020         DPDGMS
222360991117      * Aggancio numeratore 190 per progressivo distinta
222370991117     C                   CLEAR                   NUFNUM
222380991117     C                   EXSR      DPDNUM
222390991117     C                   Z-ADD     NUFNUM        DPDNDS
222400991117      * Calcolo CHECK DIGIT
222410991117     C                   EXSR      M1031
222420991117      *
222430991117     C                   ENDSR
222440991117      *
222450991117      ** CALCOLA CHECK DIGIT -----------------------------
222460991117     C     M1031         BEGSR
222470991117      *
222480991117     C                   MOVE      *ZERO         §TT2              3 0
222490991117     C                   CLEAR                   W0030
222500991117     C                   CLEAR                   W0010
222510991117      *
222520991117      * TOTALIZZO I VALORI, QUELLI NELLE POSIZIONI DISPARI PER 3
222530991117     C                   DO        11            XX                2 0
222540991117      *
222550991117     C     XX            DIV       2             §CTR              3 0
222560991117     C                   MVR                     §RST              3 030
222570991117      *
222580991117     C     *IN30         IFEQ      '1'
222590991117     C     §11(XX)       MULT      3             §CTR
222600991117     C                   ELSE
222610991117     C                   Z-ADD     §11(XX)       §CTR
222620991117     C                   ENDIF
222630991117      *
222640991117     C                   ADD       §CTR          W0030
222650991117     C                   ENDDO
222660991117      *
222670991117     C     W0030         ADD       9             §TT2
222680991117     C                   MOVE      0             §TT2
222690991117     C     §TT2          SUB       W0030         DPDCHD
222700991117      *
222710991117     C                   ENDSR
222720991117      *
222730991117      *--- NUMERO DISTINTA DPD ---------------------------------------*
222740991117     C     DPDNUM        BEGSR
222750991117      *
222760991117     C                   Z-ADD     BLPMGS        DATA6
222770991117     C                   MOVE      BLPAAS        W0020
222780991117     C                   MOVEL     W0020         DATA6
222790991117     C                   Z-ADD     190           CNU
222800991117      *
222810991118     C     KNUF3         CHAIN     FLNUF2                             30
222820991117      * SE NON TROVATO IL NUMERATORE PROVO A CREARLO
222830991117     C     *IN30         IFEQ      *ON
222840991117     C                   CLEAR                   FLNUF2
222850991117     C                   Z-ADD     CNU           NUFCNU
222860991117     C                   Z-ADD     DATA6         NUFDAT
222870991117     C                   WRITE     FLNUF2
222880991118     C     KNUF3         CHAIN     FLNUF2                             30
222890991118     C                   ENDIF
222900991117      *
222910991117     C     *IN30         IFEQ      *OFF
222920991117     C                   ADD       1             NUFNUM
222930991117     C                   UPDATE    FLNUF2
222940991117     C                   ENDIF
222950991117      *
222960991117     C                   ENDSR
222970991130      *
222980991130      *--- EVENTI DPD ------------------------------------------------*
222990991130     C     EVEDPD        BEGSR
223000991130      *
223010060619     C                   MOVE      'S'           WEU12             1
223020991130      *
223030060619     C                   CLEAR                   fieu12ds
223040060619     C                   Z-ADD     BLPAAS        i12AAS
223050060619     C                   Z-ADD     BLPLNP        i12LNP
223060060619     C                   Z-ADD     BLPNRS        i12NRS
223070060619     C                   Z-ADD     BLPNSP        i12NSP
223080060619     C                   Z-ADD     BLPLNA        i12LNA
223090060619     C                   movel     v7cnpr        i12parcel
223100060619     c                   movel     'I'           i12ie
223110991130      *
223120060619     C                   CALL      'FIEU12R'
223130991130     C                   PARM                    KPJBA
223140060619     C                   PARM                    fieu12ds
223150991130      *
223160991130     C                   ENDSR
223170991117      *
223180991117      *--- STAMPA BOLLE ----------------------------------------------*
223190900508     C     STAMPA        BEGSR
223200941107     C*
223210941107     C                   MOVEL     'P'           DB0TBO
223220110323     C                   MOVEL     'B'           DB0GES
223230990610     C* STAMPO DI UN FRANCO PREPAGATO
223240990610     C     PARTCH        IFEQ      'P'
223250010307     C     §LPFPR        OREQ      'O'
223260990610     C                   MOVEL     '8'           DB0TBO
223270110323     c* Per la stampa di un prepagato
223280110323     c* non va più bene richiamare con "B" perchè non c'è la possibilità
223290110323     c* di passare l'importo del bollo (bisognerebbe modificare la fnlsb5ds
223300110323     c* ma per il momento non è il caso mentre non va bene il campo db0ese pechè
223310110323     c* è stato pensato per contenere la somma degli importi esenti..)
223320110323     c* Quindi richiamo con DB0GES=' ': in questo modo il pgm di stampa
223330110323     c* reperisce autonomamente i dati della bolla incluso il bollo se presente
223340110323     C                   MOVEL     ' '           DB0GES
223350990610     C                   ENDIF
223360941108     C*
223370941108     C* SE SONO IN MANUTENZIONE SI TRATTA DI RISTAMPA
223380941108    1C     *IN12         IFEQ      *ON
223390941108     C     *IN15         ANDEQ     *OFF
223400941108     C                   MOVEL     'R'           DB0RIS
223410941108    1C                   ENDIF
223420941107     C*
223430941107     C                   MOVEL     BLPCBO        DB0CBO
223440941107     C                   MOVEL     §3ATB1        DB0TB1
223450941107     C                   MOVEL     §3ATB2        DB0TB2
223460990610     C* DE NON E' PREPAGATO STAMPO LA DECODIFICA DEL TIPO BOLLA
223470990628     C     PARTCH        IFNE      'P'
223480010307     C     §LPFPR        ANDNE     'O'
223490990610     C                   MOVEL(P)  §3ADES        DB0DCB
223500990610     C                   ELSE
223510990610     C                   MOVEL(P)  CPREPA        DB0DCB
223520990610     C                   ENDIF
223530990610     C**
223540941107     C                   MOVEL     BLPTSP        DB0TSP
223550941107     C                   Z-ADD     1             C
223560941107     C     BLPTSP        LOOKUP    TSP(C)                                 30
223570941107     C   30              MOVEL     DTS(C)        DB0DTS
223580941115     C   30              MOVEL     STS(C)        DB0FST
223590941107     C*
223600941107     C                   MOVEL     BLPAAS        DB0AAS
223610941107     C                   MOVEL     BLPMGS        DB0MGS
223620941107     C                   MOVEL     BLPLNP        DB0LNP
223630941107     C                   MOVEL     BLPNRS        DB0NRS
223640941107     C                   MOVEL     BLPNSP        DB0NSP
223650941107     C                   MOVEL     BLPTC1        DB0TC1
223660941107     C                   MOVEL     BLPTC2        DB0TC2
223670941107     C                   MOVEL     BLPFNS        DB0FNS
223680941107     C                   MOVEL     BLPRMN        DB0RMN
223690941107     C                   MOVEL     BLPRMA        DB0RMA
223700941107     C                   MOVEL     BLPIAS        DB0IAS
223710941107     C                   MOVEL     BLPVAS        DB0VAS
223720941107     C                   MOVEL     BLPVMD        DB0VMD
223730941107     C                   MOVEL     BLPVAD        DB0VAD
223740961007     C     TAMFVD        IFNE      '4'
223750941107     C                   MOVEL     BLPQFT        DB0QFT
223760961007     C                   ENDIF
223770941107     C                   MOVEL     VIDTIC        DB0TIC
223780980806     C* SE L'IMPORTO DEL C/A E' OLTRE IL LIMITE PRENDO DESCRIZIONE OLTR
223790980806     C                   MOVEL     §1ADES        DB0DTI
223800980806     C**
223810980806     C     §1ADEO        IFNE      *BLANKS
223820980806     C** DESCRIZIONE OLTRE LIMITE
223830011212     C     FCASAV        IFNE      *BLANKS
223840980806     C                   MOVEL     §1ADEO        DB0DTI
223850980806     C                   ENDIF
223860980806     C                   ENDIF
223870980806     C**
223880950208     C                   MOVEL     §1AUCM        DB0UCM
223890950208     C                   MOVEL     §1ASTE        DB0STE
223900941107     C                   MOVEL     VIDCAS        DB0CAS
223910941107     C                   MOVEL     VIDVCA        DB0VCA
223920941107     C                   MOVEL     VIDGCA        DB0GCA
223930941107     C                   MOVEL     BLPLNA        DB0LNA
223940941107     C                   MOVEL     BLPZNC        DB0ZNC
223950941107     C* CODICE MITENTE PIENO
223960941108    1C     BLPCCM        IFGT      0
223970941107     C                   Z-ADD     BLPCCM        DB0CCM
223980941108   X1C                   ELSE
223990941107     C* SE NON E' ASSEGNO LO IMPOSTO DA KSC
224000941108    2C     *IN04         IFEQ      *OFF
224010941107     C                   MOVEL     BLPKSC        DB0CCM
224020950125     C* SOLO SE BOLLA FRANCO PASSO LA P.IVA
224030061110     C***                MOVEL     BLPCPI        DB0CPI
224040061110     c* Adesso nel campo della partita iva ci passo il codice fiscale per
224050061110     c*  la stampa
224060061110     c                   movel     vidcdf        db0cpi
224070941108    2C                   ENDIF
224080941108    1C                   ENDIF
224090941107     C*
224100941107     C* ASSEGNATO O 2 BOLLA: CODICE DESTINATARIO LNA9999
224110941108    1C     §3ATB2        IFNE      *BLANKS
224120941108     C     *IN04         OREQ      *ON
224130941107     C                   Z-ADD     9999          DB0CCD
224140941107     C                   MOVEL     BLPLNA        DB0CCD
224150941108    1C                   ENDIF
224160941107     C                   MOVEL     BLPRSM        DB0RSM
224170941107     C                   MOVEL     BLPINM        DB0INM
224180941107     C                   MOVEL     BLPLOM        DB0LOM
224190941107     C                   MOVEL     BLPCAM        DB0CAM
224200941107     C                   MOVEL     BLPFAP        DB0FAP
224210941107     C                   MOVEL     BLPNZM        DB0NZM
224220941107     C                   MOVEL     BLPPRM        DB0PRM
224230941107     C*
224240941107     C                   MOVEL     BLPRSD        DB0RSD
224250950123     C                   MOVE      WRD2          DB0RD2
224260941107     C                   MOVEL     BLPIND        DB0IND
224270941107     C                   MOVEL     BLPLOD        DB0LOD
224280941107     C                   MOVEL     BLPCAD        DB0CAD
224290941107     C                   MOVEL     BLPFIN        DB0FIN
224300941107     C                   MOVEL     BLPNZD        DB0NZD
224310941107     C                   MOVEL     BLPPRD        DB0PRD
224320941107     C                   MOVEL     BLPRMO        DB0RMO
224330941107     C                   MOVEL     BLPGC1        DB0GC1
224340941107     C                   MOVEL     BLPGC2        DB0GC2
224350941107     C                   MOVEL     BLPNAS        DB0NAS
224360941107     C                   MOVEL     BLPNCL        DB0NCL
224370941107     C                   MOVEL     BLPPKF        DB0PKF
224380941107     C                   MOVEL     BLPVLF        DB0VLF
224390941115     C                   MOVEL     BLPFVF        DB0FVF
224400941107     C                   MOVEL     BLPFLS        DB0FLS
224410941107     C                   MOVEL     BLPNCD        DB0NCD
224420941107     C                   MOVEL     BLPNCA        DB0NCA
224430941107     C                   MOVEL     BLPXCO        DB0XCO
224440941107     C                   MOVEL     VIDNT1        DB0NT1
224450941107     C                   MOVEL     VIDNT2        DB0NT2
224460941107     C                   MOVEL     BLPFFD        DB0FFD
224470941107     C                   MOVEL     BLPDCR        DB0DCR
224480941107     C                   MOVEL     BLPTCR        DB0TCR
224490941107     C                   MOVEL     BLPHCR        DB0HCR
224500941107     C                   MOVEL     BLPFBR        DB0FBR
224510941107     C                   MOVEL     BLPGGA        DB0GGA
224520941107     C                   MOVEL     BLPGMA        DB0GMA
224530960208     C                   MOVEL     VIDGVA        DB0GVA
224540950125     C                   MOVEL     BLPSOP        DB0SOP
224550950626     C                   MOVEL     BLPCTR        DB0CTR
224560990628     C                   MOVEL     BLPDRT        DB0DRT
224570990628     C                   MOVEL     BLPNRT        DB0NRT
224580990628     C                   MOVEL     BLPPDR        DB0PDR
224590990628     C                   MOVEL     BLPFPP        DB0FPP
224600950102     C   12
224610950102     CANN15              MOVEL     'V'           DB0RIS
224620970206     C*
224630970206     C* ALLEGA BAM
224640970206     C     BLPFST        IFEQ      'S'
224650970206     C     BLPFST        OREQ      'C'
224660970206     C                   MOVEL     'S'           DB0BAM
224670970206     C                   ENDIF
224680970206     C*
224690030611     C                   CALL      WD90PSL
224700030626     C                   PARM                    fnlsb5DS
224710130318     c                   parm                    FNLSB6ds1
224720941108     C*
224730941108     C                   Z-ADD     1             I100
224740941107     C**
224750900508     C                   ENDSR
224760900511     C*
224770990701     C*--- CARICO RECORD DI MANUTENZIONE -----------------------------*
224780010215     C     CARBLP        BEGSR
224790990630     C                   SETOFF                                       22
224800990701     C                   CLEAR                   SAVNFT
224810070918     c                   clear                   s_drt
224820950206     C                   Z-ADD     KCI           CCC
224830011025      *
224840011025     C                   CLEAR                   FLGVRN
224850030204     c                   Clear                   wPkg
224860030204     c                   Clear                   wNba
224870070322     c                   clear                   wparcel
224880091221     c                   clear                   wvidgma
224890100604     c                   clear                   w7rRC
224900011025      *
224910900511     C* CHAIN
224920061212     C     KBLP3         CHAIN     FNBLP01l
224930061212     c                   if        %found(fnblp01l)
224940061218     c                   z-add     blpnrr        savnrr
224950061212     c     blpnrr        chain     fnblp00f                           90
224960950102     C     *IN90         IFEQ      *OFF
224970940927     C*
224980940927     C* DATA SPEDIZIONE
224990930414     C                   Z-ADD     BLPMGS        BLPDSP
225000930414     C                   MOVEL     BLPAAS        BLPDSP
225010000104     C                   Z-ADD     BLPMGS        WBDSP             8 0
225020000104     C                   MOVEL     BLPAAS        WBDSP
225030940927     C* DATA RITIRO MERCE
225040940927     C                   Z-ADD     BLPDRT        VIDDRT
225050081111     C                   Z-ADD     BLPDRT        s_drtblpi
225060940927     C* DATA CONSEGNA RICHIESTA
225070940927     C                   Z-ADD     BLPDCR        VIDDCR
225080940927     C*
225090960926     C* AUTOTRASPORTATORE
225100950126     C                   MOVE      BLPPDR        SAVPDR
225110990915     C                   MOVE      BLPPDR        SAVPD4
225120940928     C                   MOVE      BLPPDR        VIDPDR
225130010220     C                   MOVE      BLPPDR        PREPDR
225140990915     C                   MOVE      BLPFPP        VIDFPP
225150010220     C                   MOVE      BLPFPP        PREFPP
225160991001     C* SE ERA PREPAGATO, FACCIO ALMENO VEDERE SE MERCE PORTATA A MAG
225170991001     C                   MOVEL     BLPFDN        VIDMAG
225180900511     C*
225190900516     C                   MOVE      BLPNSP        VIDNSP
225200900511     C                   MOVEL     BLPNRS        VIDNRS
225210900511     C                   MOVEL     BLPLNP        VIDLNP
225220910805     C                   MOVEL     BLPFNS        VIDFNS            1
225230040506
225240040506      * Imposto la ds di comodo del n. spedizione
225250040506     c                   Z-add     BlpNsp        WidNsp
225260040506     c                   Z-add     BlpNrs        WidNrs
225270040506     c                   Z-add     BlpLnp        WidLnp
225280040506
225290970128     C* ALLEGA BAM
225300970128     C     BLPFST        IFEQ      'S'
225310970128     C     BLPFST        OREQ      'C'
225320970128     C                   MOVEL     'S'           VIDBAM
225330970128     C                   ELSE
225340970128     C                   MOVEL     'N'           VIDBAM
225350970128     C                   ENDIF
225360970404     C                   MOVEL     BLPFST        SAVBAM
225370940920     C* CODICE BOLLA
225380940920     C                   MOVEL     BLPCBO        VIDCBO
225390081023     C                   MOVEL     BLPCBO        cbo_blp
225400940920     C* SIGLA OPERATORE
225410940920     C                   MOVEL     BLPSOP        VIDSOP
225420900511     C* LINEA ARRIVO E DECODIFICA
225430900511     C                   MOVEL     BLPLNA        VIDLNA
225440070404     C                   MOVEL     BLPLNA        lna_sav
225450960926     C* PUNTO OPERATIVO CLIENTE
225460940927     C     BLPCCM        IFGT      0
225470940927     C                   MOVEL     BLPCCM        W0030
225480940927     C                   MOVE      BLPCCM        VIDCCM
225490940927     C                   MOVEL     BLPCCM        WKSC
225500940927     C                   ELSE
225510940927     C                   MOVEL     BLPKSC        W0030
225520940927     C                   MOVE      BLPKSC        VIDCCM
225530940927     C                   MOVEL     BLPKSC        WKSC
225540940927     C                   ENDIF
225550940927     C* SALVO IL CODICE MITTENTE
225560060515     C                   MOVEL     WKSC          bolksc
225570060515     C                   MOVEL     WKSC          SAVMIT
225580941115     C                   MOVEL     VIDCCM        WCCMS
225590940927     C* PARTITA IVA
225600940927     C                   MOVEL     BLPCPI        WPIVA
225610940929     C*
225620940929     C* VEDO SE C'E' TASSAZIONE
225630991006     C                   MOVEL     '1'           WTRC
225640991006     C     KBLP4         CHAIN     FIAR6000                           30
225650940929    1C     *IN30         IFEQ      *OFF
225660050331     c                   move      ar6ksc        wKSCsf1
225670991006     C                   MOVEL     'E'           WAR61             1
225680050331     c* se c'è cod. S.F. significa che bolla tassata in arrivo:NON DEVO
225690050331     c* CARICARLA
225700050331   1ac                   if        wKSCsf1 = 0000 or wKSCsf1 = 9999
225710940929     C*
225720991012     C                   MOVEL     AR6POR        VIDPOR
225730991012     C                   MOVEL     AR6POR        MEMPOR
225740991006     C                   MOVEL     AR6IMV        VIDIMV
225750991006     C                   MOVEL     AR6IMV        SAVIMV
225760060208     C                   MOVEL     AR6IMV        SAVIMVO
225770151014     C                   MOVEL     AR6IMV        SAVIMV_fat
225780991006     C                   MOVEL     AR6CEI        VIDCEI
225790991008     C                   MOVEL     AR6DIV        VIDDIV
225800991011     C                   MOVEL     AR6DIV        WDIV1
225810940929     C*
225820991006     C                   MOVEL     AR6NFT        SAVNFT
225830991006     C                   MOVEL     AR6NFT        VIDNFT
225840991006     C                   MOVEL     AR6FIV        VIDFIV
225850991006     C                   MOVEL     AR6DFT        VIDDFT
225860060208     C                   MOVEL     AR6DFT        DFTar6
225870991006     C     AR6NFT        IFGT      0
225880991006     C     AR6NFT        ANDLT     §QTNFT
225890990630     C                   SETON                                        22
225900991006     C                   Z-ADD     AR6IFT        VIDIFT
225910990630     C                   ENDIF
225920991027      *
225930940929     C                   Z-ADD     0             NRR
225940011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
225950011025     C     BLPFBR        IFEQ      'S'
225960011025     C                   SELECT
225970011025     C     AR6SV1        WHENEQ    'N'
225980011025     C     AR6VA1        ANDEQ     88888888
225990011025     C                   MOVEL     '1'           FLGVRN            1
226000011025     C     AR6SV2        WHENEQ    'N'
226010011025     C     AR6VA2        ANDEQ     88888888
226020011025     C                   MOVEL     '1'           FLGVRN
226030011025     C     AR6SV3        WHENEQ    'N'
226040011025     C     AR6VA3        ANDEQ     88888888
226050011025     C                   MOVEL     '1'           FLGVRN
226060011025     C                   ENDSL
226070011025     C                   ENDIF
226080991027      *
226090991027     C                   MOVEL     AR6SV1        WSVN
226100991027     C                   Z-ADD     AR6VA1        WVAN
226110940929     C                   EXSR      CARVAR
226120991027      *
226130991027     C                   MOVEL     AR6SV2        WSVN
226140991027     C                   Z-ADD     AR6VA2        WVAN
226150940929     C                   EXSR      CARVAR
226160991027      *
226170991006    2C     AR6SV3        IFNE      ' '
226180991027     C                   MOVEL     AR6SV3        WSVN
226190991027     C                   Z-ADD     AR6VA3        WVAN
226200940929     C                   EXSR      CARVAR
226210941021     C*
226220940929     C* VISTO CHE C'E' LA 3 VARIA VEDO SE CE NE SONO ANCORA
226230991006     C                   MOVEL     '1'           WTRC
226240991006     C     KBLP4         SETLL     FIAR7000
226250991006     C     KBLP4         READE     FIAR7000                               30
226260940929    3C     *IN30         DOWEQ     *OFF
226270011025      * Controllo se è una bolla di reso e se ha la varia 'N' 88888888
226280011025     C     BLPFBR        IFEQ      'S'
226290011025     C     FLGVRN        ANDNE     '1'
226300011025     C     AR7SVN        ANDEQ     'N'
226310011025     C     AR7VAN        ANDEQ     88888888
226320011025     C                   MOVEL     '1'           FLGVRN
226330011025     C                   ENDIF
226340011025      *
226350991006     C                   MOVEL     'E'           WAR7              1
226360991027     C                   MOVEL     AR7SVN        WSVN
226370991027     C                   MOVEL     AR7VAN        WVAN
226380940929     C                   EXSR      CARVAR
226390991006     C     KBLP4         READE     FIAR7000                               30
226400940929    3C                   ENDDO
226410940929    2C                   ENDIF
226420940929     C*
226430941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
226440941020     C     VIDPOR        IFNE      0
226450941020     C     NRR           ORNE      0
226460941020     C     VIDCEI        ORNE      ' '
226470941020     C                   MOVEL     'S'           WEMD03            1
226480941020     C                   ENDIF
226490991006      *
226500991006     C                   CLEAR                   FIAR6000
226510050331   1ac                   endif
226520940929    1C                   ENDIF
226530941107     C* TIPO SERVIZIO
226540941107     C                   MOVEL     BLPTSP        VIDTSP
226550941107     C                   MOVEL     BLPTSP        SAVTSP
226560941115     C                   MOVEL     BLPTSP        VARTSP
226570941115     C* CONSEGNE PARTICOLARI
226580941115     C                   MOVEL     BLPTC1        VIDTC1
226590941115     C                   MOVEL     BLPTC2        VIDTC2
226600091001     c                   movel     blptc1        sav_tc1
226610091001     c                   movel     blptc2        sav_tc2
226620001205     C                   MOVEL     BLPTC1        SAVTC1
226630001205     C                   MOVEL     BLPTC2        SAVTC2
226640140122     C****               MOVEL     BLPTC1        WSVTCP
226650140122     C****               MOVEL     BLPTC1        WTCP
226660940929     C*
226670940929     C* D E C O D I F I C H E
226680940927     C                   EXSR      DECBOL
226690120926     c* se cod.bolla franco recupero e bolla presente su giacenze in part
226700120926     c* per il recupero delle spese devo disabilitare F16=Annullamento
226710120926     c* Se non voglio più addebitare le spese devono stornare la bolla
226720120926     c* dalla manutenzione bolle di sede
226730120926     c                   if        savrbl='R' and  savtb1='F'
226740120926     C/exec sql
226750120927     c+ Select gcpagc into :wagc
226760120926     c+   from tigcp00f
226770120926     c+   where GCPLPW = :BLPLNP AND GCPASW=:BLPAAS AND GCPNSW=:BLPNRS
226780120927     c+     and GCPNBW = :BLPNSP AND GCPSEDE=' '
226790120926     C/end-exec
226800120926     c                   if        SqlCOD < 0 or sqlCOD = 100
226810120926     c                   else
226820120926      * se qui : ha trovato la giacenza E DISATTIVO QUINDI F16
226830120927     c                   movel     nodi          atrann
226840120926     c                   end
226850120926     c                   endif
226860990702     C* E MANCA LA DATA RITIRO O COD PADR, MI POSIZIONO SULLA DATA
226870990702     C*  RITIRO
226880990702     C     BLPPDR        IFEQ      0
226890990702     C     BLPDRT        OREQ      0
226900990702     C                   SETOFF                                       07
226910040909     c                   z-add     09            h1riga
226920040909     c                   z-add     20            h1colo
226930990702     C                   ENDIF
226940940929     C*
226950950125     C* SALVO LA DECODIFICA DEL TIPO SPEDIZIONE
226960950125     C                   MOVEL     V1DTSP        WDETSP           10
226970940928     C* VEDO SE CARICARE IL MITTENTE O NO
226980941005     C                   MOVEL     *BLANKS       VIDFAP
226990941005    1C     VIDCCM        IFEQ      8888
227000940928     C     VIDCCM        OREQ      9999
227010940928     C                   MOVEL     BLPRSM        VIDRSM
227020940928     C                   MOVEL     BLPINM        VIDINM
227030940928     C                   MOVEL     BLPLOM        VIDLOM
227040940928     C                   MOVEL     BLPCAM        VIDCAM
227050940928     C                   MOVEL     BLPPRM        VIDPRM
227060940928     C                   MOVEL     BLPNZM        VIDNZM
227070941005     C*
227080941005   X1C                   ELSE
227090941005     C*
227100941005     C* CHAIN SU CNACO PER VEDERE SE CAP E NAZIONE DIVERSI
227110941005     C     KACO          CHAIN     CNIND000                           30
227120941005     C*
227130941005    2C     *IN30         IFEQ      *OFF
227140941005    3C     INDCAE        IFNE      BLPCAM
227150941005     C     INDSTA        ORNE      BLPNZM
227160941005     C                   MOVEL     BLPCAM        VIDCMO
227170941005     C                   MOVEL     BLPNZM        VIDNMO
227180941005    3C                   ENDIF
227190941005    2C                   ENDIF
227200941005    1C                   ENDIF
227210910429     C*
227220941005     C* CHAIN PER VEDERE SE ESISTE LA 2 DESCRIZIONE DESTINATARIO
227230940927     C                   MOVEL     'D'           WTRC
227240060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
227250940927     C* TROVATA
227260940927     C     *IN30         IFEQ      *OFF
227270060215     C                   MOVE      ar4NOT        VIDRSD
227280060215     C                   MOVE      ar4NOT        SAVRSD
227290940927     C                   ENDIF
227300900511     C                   MOVEL     BLPRSD        VIDRSD
227310910405     C                   MOVEL     BLPRSD        SAVRSD
227320900511     C                   MOVEL     BLPIND        VIDIND
227330070404     C                   MOVEL     BLPIND        savIND
227340900511     C                   MOVEL     BLPPRD        VIDPRD
227350070404     C                   MOVEL     BLPPRD        savPRD
227360910405     C                   MOVEL     BLPCAD        SAVCAD
227370910405     C                   MOVEL     BLPCAD        VIDCAD
227380940930     C                   MOVEL     BLPCAD        VARCAD
227390900511     C                   MOVEL     BLPLOD        VIDLOD
227400070404     C                   MOVEL     BLPLOD        savLOD
227410940927     C                   MOVEL     BLPNZD        VIDNZD
227420020122     C                   MOVEL     BLPNZD        NZDINI
227430911031     C                   MOVEL     BLPCTS        SAVCTS
227440941107     C* CONTROLLO SE IL CLIENTE E' ITALIA O ESTERO
227450941107     C                   MOVEL     BLPNZD        WNAR
227460941107     C                   EXSR      CTRNAR
227470941107     C* NAZIONE CORRETTA
227480941107     C     WEMFOR        IFNE      '1'
227490941107     C     §15ITA        IFEQ      'I'
227500941108     C                   MOVEL     'I'           WDESIE
227510941107     C                   ELSE
227520941108     C                   MOVEL     'E'           WDESIE
227530941107     C                   ENDIF
227540941107     C*
227550941107     C* NAZIONE ERRATA: IMPOSTO SEMPRE "I"
227560941107     C                   ELSE
227570941108     C                   MOVEL     'I'           WDESIE
227580941107     C                   ENDIF
227590941107     C*
227600941107     C* VEDO SE BOLLA ITALIANA O ESTERA
227610971216     C     BLPLNP        CHAIN     AZORG01L      UNIORG               30
227620991203     C                   MOVEL     ORGDE3        OG143
227630000121     C* MEMORIZZO TELEFONO E FAX
227640000121     C                   MOVEL     ORGTEL        LNPTEL           15
227650000121     C                   MOVEL     ORGFAX        LNPFAX           15
227660971210     C**
227670160302     c****               clear                   trul27ds1
227680160302     c****               z-add     BlpPkf        I27Pkg
227690160302     c****               move      BlpCtr        I27Ctb
227700160302     c****               exsr      riccar
227710160302     c****               movel     o27fie        savfie
227720160302     c***                movel     o27ntw        s_27ntw
227730970407     C* MI SERVE PER IL CONFRONTO PER CARICARE I CODICI TARIFFA
227740970407     C     VIDCCM        IFNE      9999
227750940927     C                   MOVEL     WKSC          SAVCCM
227760970407     C                   ELSE
227770970407     C                   CLEAR                   SAVCCM
227780970407     C                   ENDIF
227790940927     C*
227800900607     C                   MOVEL     BLPCTR        VIDCTR
227810060515     C                   MOVEL     BLPCTR        BolCTR
227820150427     C                   MOVEL     blpctr        SAVCTR
227830971210     C* VEDO SE ESISTE NUMERO AWB SOLO PER IMPORTO SDI O EXPORT SDI
227840081008    1c**   §ogntw        ifeq      'EUP'
227850081008     c**   A_§ogntw      oreq      'EUP'
227860081008     C**                 MOVEL     'E'           WTRC
227870081008     C**   KBLP4         CHAIN(N)  Fiar4000                           30
227880081008    2C**   *IN30         IFEQ      *OFF
227890081008     C**                 MOVEL     ar4NOT        DSBL4E
227900081008     C**                 MOVEL     §B4ERP        W010A            10
227910971210     C**
227920081008    3C**   W010A         IFGT      *ZEROS
227930081008     C**                 MOVEL     §B4ERP        V6CAWB
227940081008     C**                 MOVEL     §B4ERP        SAVAWB
227950081008    3C**                 ENDIF
227960971210     C** INSERIMENTO MANUALE
227970081008     C**   §B4EMA        IFEQ      'M'
227980081008     C**                 MOVEL     'MANUALE'     V6CINS
227990081008     C**                 ENDIF
228000971210     C** INSERIMENTO AUTOMATICO
228010081008     C**   §B4EMA        IFEQ      'A'
228020081008     C**                 MOVEL     'AUTOMATI'    V6CINS
228030081008     C**                 MOVE      'CO'          V6CINS
228040081008     C**                 ENDIF
228050971210     C* STAMPATO S/N
228060081008     C**   §B4EST        IFEQ      'S'
228070081008     C**                 MOVEL     'SI'          V6CSTA
228080081008     C**                 ENDIF
228090081008    3C**   §B4EST        IFEQ      'N'
228100081008     C**                 MOVEL     'NO'          V6CSTA
228110081008    3C**                 ENDIF
228120081008    2C**                 ENDIF
228130971210     C**
228140081008    1C**                 ENDIF
228150991203      *
228160060620      * VEDO SE ESISTE NUMERO PARCEL PER IMPORT/EXPORT DPD
228170160323     c                   clear                   w_vediP
228180020319    1C     A_§OGNTW      IFEQ      'DPD'
228190060619    1C     §ogntw        oreq      'DPD'
228200060620     c*
228210061003     C***                MOVEL     'F'           WTRC
228220061003     C***  KBLP4         CHAIN(N)  Fiar4000                           30
228230061003    2C***  *IN30         IFEQ      *OFF
228240061003     C***                MOVEL     ar4NOT        DSBL4F
228250061003     C***                MOVEL     §B4FNP        savfnp
228260061003    2C***                ENDIF
228270060620     c*
228280060620     C                   MOVEL     'K'           WTRC
228290060620     C     KBLP4         CHAIN(N)  Fiar4000                           30
228300060620     C     *IN30         IFEQ      *OFF
228310060620     C                   MOVEL     ar4NOT        DSBL4K
228320060620     C                   MOVEL     §B4krt        savkrt
228330060620     C                   ENDIF
228340060620     c***
228350060605     C                   MOVEL     'I'           WTRC
228360060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
228370991203      *
228380991203    2C     *IN30         IFEQ      *OFF
228390060605     C                   MOVEL     ar4NOT        DSBL4I
228400991203      *
228410060619     c                   if        §b4ipn<>*blanks
228420060605     C                   MOVEL     §B4ipn        V7CNPR
228430060619     c* se parcel number lungo 11 aggiungo a video anche il check digit
228440060619     c                   if        %subst(§b4ipn:14:1)=*blanks
228450060619     c                   eval      %subst(v7cnpr:12:1)=§b4icd
228460060619     c                   endif
228470060619     C                   MOVEL     v7cnpr        SAVNPR
228480991203    3C                   ENDIF
228490160331     c                   if        §b4trd='1'
228500160331     c                   eval      w_vediP='1'
228510160331     c                   endif
228520991203      *
228530991203    2C                   ENDIF
228540991203    1C                   ENDIF
228550941115     C*
228560941115     C* CARICO LE NOTE
228570941115     C                   MOVEL     '8'           WTRC
228580060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
228590941115     C* TROVATA
228600941115     C     *IN30         IFEQ      *OFF
228610060215     C                   MOVEL     ar4NOT        VIDNT1
228620941115     C*
228630941115     C                   MOVEL     '9'           WTRC
228640060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
228650941115     C* TROVATA
228660941115     C     *IN30         IFEQ      *OFF
228670060215     C                   MOVEL     ar4NOT        VIDNT2
228680941115     C                   ENDIF
228690000124     C                   ENDIF
228700000124     C**
228710000124     C* SE LA PRIMA NOTA E' MESSA IN AUTOMATICO, LA CLEARO
228720000124     C                   MOVEL     VIDNT1        W012A            12
228730000124     C*
228740000124     C     W012A         IFEQ      CDPD
228750000124     C                   CLEAR                   VIDNT1
228760000124     C     VIDNT2        IFNE      *BLANKS
228770000124     C                   MOVEL     VIDNT2        VIDNT1
228780000124     C                   CLEAR                   VIDNT2
228790000124     C                   ENDIF
228800000124     C                   ENDIF
228810000623     C***
228820060216     C* VEDO SE CE' RECORD ar4 W
228830000623     C                   MOVEL     'W'           WTRC
228840060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
228850000623     C  N30              MOVEL     'E'           WBL4W             1
228860121123     C***
228870121123     C* VEDO SE CE' RECORD ar4 Z
228880121123     c                   clear                   wesar4z
228890121123     c                   clear                   wtrasmz
228900121123     c                   clear                   wkscz
228910121123     C                   MOVEL     'Z'           WTRC
228920121123     C     KBLP4         CHAIN(N)  Fiar4000                           30
228930121123     c                   if        not *in30
228940121123     C                   MOVEL     'S'           Wesar4z           1
228950121123     C                   MOVEL     AR4NOT        DSBL4Z
228960121123     c                   if        §B4DTR=0
228970121123     C                   EVAL      WTRASMz='N'
228980121123     C                   ENDIF
228990121123     c                   move      §b4okc        wkscz
229000121123     c                   endif
229010061110     c*
229020061110     C* CARICO il codice fiscale se presente
229030061110     C                   MOVEL     'Q'           WTRC
229040061110     C     KBLP4         CHAIN(N)  Fiar4000                           30
229050061110     C     *IN30         IFEQ      *OFF
229060061110     c                   movel     ar4not        vidcdf
229070061110     c                   endif
229080141201
229090141201     C* CARICO il PIN CODE se presente
229100141201     C                   MOVEL     'Y'           WTRC
229110141201     C     KBLP4         CHAIN(N)  Fiar4000                           30
229120141201     C     *IN30         IFEQ      *OFF
229130141201     c                   movel     ar4not        dsbl4y
229140141201     c                   eval      wpincode=§B4PCD
229150141201     c                   endif
229160950410     c*
229170950410     C* CARICO LE P.IVA MITTENTE E DESTINATARIO
229180950410     C                   MOVEL     'P'           WTRC
229190060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
229200950410     C     *IN30         IFEQ      *OFF
229210950410     C*
229220060215     C                   MOVEL     ar4NOT        WPIVA
229230050921     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
229240050921     c                   select
229250050921     c* solo numeri
229260050921     c* "PRIVATO senza iso
229270050921     c     *in30         wheneq    *off
229280050921     c     wiso          andge     *zeros
229290050921     c     *in30         oreq      *on
229300050921     c     posiz         andlt     3
229310050921     c                   movel     wpiva         vidcpm
229320050921     c* iso + numeri
229330050921     c* iso + "PRIVATO"
229340050921     c     *in30         wheneq    *off
229350050921     c     posiz         orgt      2
229360050921     c                   movel     wpiva         vidpim
229370050921     c                   endsl
229380050921     c
229390950410     C*
229400060215     C                   MOVE      ar4NOT        WPIVA
229410050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
229420050921     c                   select
229430050921     c* solo numeri
229440050921     c* "PRIVATO senza iso
229450050921     c     *in30         wheneq    *off
229460050921     c     wiso          andge     *zeros
229470050921     c     *in30         oreq      *on
229480050921     c     posiz         andlt     3
229490050921     c                   movel     wpiva         vidcpd
229500050921     c* iso + numeri
229510050921     c* iso + "PRIVATO"
229520050921     c     *in30         wheneq    *off
229530050921     c     posiz         orgt      2
229540050921     c                   movel     wpiva         vidpid
229550050921     c                   endsl
229560950410     C*
229570950410     C                   ENDIF
229580900607     C*
229590900604     C* FLAG INOLTRO PULISCO SE NON E' UNA ISOLA
229600900604     C                   MOVEL     ' '           VIDFIN
229610941115     C                   MOVEL     BLPFBR        VIDFBR
229620941115     C                   MOVEL     BLPGC1        VIDGC1
229630900511     C                   MOVEL     BLPGC2        VIDGC2
229640900511     C                   MOVEL     BLPFTM        VIDFTM
229650940927     C                   MOVEL     BLPIAS        VIDIAS
229660940927     C                   MOVEL     BLPVAS        VIDVAS
229670950410     C                   MOVEL     BLPVAS        VARVAS
229680940927     C                   MOVEL     BLPVMD        VIDVMD
229690940927     C                   MOVEL     BLPVAD        VIDVAD
229700950410     C                   MOVEL     BLPVAD        VARVAD
229710940927     C                   MOVEL     BLPQFT        VIDQFT
229720940928     C                   MOVEL     BLPGGA        VIDGGA
229730940928     C                   MOVEL     BLPGMA        VIDGMA
229740091221     c                   eval      wvidgma = blpgma
229750100604     c* Verifico se c'e' ritiro contestuale alla consegna
229760100604     c                   clear                   ds7r
229770100604     C                   MOVEL     '7R'          COD
229780100604     C                   MOVEL(P)  blpGMA        KEY
229790100604     C                   EXSR      CTABEL
229800100604     C  n30              MOVEL     TBLUNI        DS7R
229810100604     c                   eval      w7rRC = §7rRC
229820100604     c
229830960208     C                   CLEAR                   VIDGVA
229840960208     C                   MOVEL     BLPGVA        W001A
229850960208     C                   MOVEL     W001A         VIDGVA
229860900511     C                   MOVEL     BLPNAS        VIDNAS
229870900511     C                   MOVEL     BLPNCL        VIDNCL
229880940819     C                   MOVEL     BLPNCL        V1CNCL
229890930331     C                   MOVEL     BLPNCL        SAVNCL
229900980408     C                   MOVE      BLPNCD        SAVNCD
229910980408     C                   MOVE      BLPNCA        SAVNCA
229920940927     C                   MOVEL     BLPPKB        VIDPKG
229930940927     C                   MOVEL     BLPPKB        V2CPKG
229940980402     C                   MOVEL     BLPPKB        SAVPKG
229950940927     C                   MOVEL     BLPVLB        VIDVOL
229960980402     C                   MOVEL     BLPVLB        SAVVOL
229970090609     c                   movel     blppkb        wpes_pre
229980090609     c                   movel     blpvlb        wvol_pre
229990090609     C                   MOVEL     BLPNCL        wncl_pre
230000930512     C* VEDO RAGGRUPPAMENTO DEL VOLUME
230010940928     C                   MOVEL     BLPFVB        VIDFVR            1
230020930512     C                   MOVEL     '7T'          COD
230030940928     C                   MOVEL(P)  BLPFVB        KEY
230040930708     C                   EXSR      CTABEL
230050930512     C  N30              MOVEL     TBLUNI        DS7T
230060930708     C   30              CLEAR                   DS7T
230070910125     C*
230080900511     C                   MOVEL     BLPRMN        VIDRMN
230090060619     C******             MOVEL     BLPRMN        savrmn
230100940825     C                   MOVEL     BLPRMA        VIDRMA
230110940922     C                   MOVEL     BLPRMA        SAVRMA
230120900511     C                   MOVEL     BLPRMO        VIDRMO
230130900511     C                   MOVEL     BLPNCD        VIDNCD
230140900511     C                   MOVEL     BLPNCA        VIDNCA
230150960808     C                   MOVEL     BLPNCD        WNSNCD
230160960808     C                   MOVEL     BLPNCA        WNSNCA
230170900511     C                   MOVEL     BLPZNC        VIDZNC
230180930401     C                   MOVEL     BLPZNC        VARZNC
230190930402     C                   MOVEL     BLPZNC        SAVZNC
230200900511     C                   MOVEL     BLPCTM        VIDCTM
230210900511     C                   MOVEL     BLPFFD        VIDFFD
230220930401     C                   MOVEL     BLPFFD        VARFFD
230230010214     C     BLPFFD        IFEQ      *BLANKS
230240010214     C                   MOVEL     'N'           VIDFFD
230250010214     C                   MOVEL     'N'           VARFFD
230260010214     C                   ENDIF
230270910114     C*
230280900516     C                   MOVEL     BLPNFV        VIDNFV
230290910114     C                   MOVEL     BLPTCR        VIDTCR
230300940927     C                   MOVEL     BLPHCR        VIDHCR
230310940927     C                   MOVE      BLPHCR        VIDMCR
230320900516     C* GIRO DATA BORDERO
230330940927     C                   CLEAR                   WLBDAT
230340950107     C                   MOVEL     '3'           G02ERR
230350940927     C                   Z-ADD     BLPDBR        G02INV
230360940927     C                   CALL      'XSRDA8'
230370940927     C                   PARM                    WLBDAT
230380940927     C                   Z-ADD     G02DAT        VIDDBR
230390940928     C* VEDO SE ESISTE C/A
230400940928     C     §3AFCA        IFNE      0
230410051115     C     KBLP3         CHAIN     Fiar9000                           30
230420940928     C     *IN30         IFEQ      *OFF
230430051115     C                   MOVEL     'E'           War9              1
230440051115     C                   Z-ADD     ar9CAS        VIDCAS
230450051115     C                   MOVEL     ar9TIC        VIDTIC
230460051115     C                   MOVEL     ar9GCA        VIDGCA
230470051115     C                   MOVEL     ar9VCA        VIDVCA
230480051115     C                   MOVEL     ar9VCA        VARVCA
230490940928     C                   ENDIF
230500940928     C                   ENDIF
230510940928     C*
230520900517     C* SE ESISTE AGGANCIO 2° BOLLA
230530991006     C                   MOVEL     '2'           WTRC
230540991006     C     KBLP4         CHAIN     FIAR6000                           30
230550940927    1C     *IN30         IFEQ      *OFF
230560050331     c                   move      ar6ksc        wKSCsf2
230570991006     C                   MOVEL     'E'           WAR62             1
230580040114
230590050331   1ac                   if        wKSCsf2 = 0000 or wKSCsf2 = 9999
230600040114     c                   Z-add     Ar6Va1        Vi2Va1
230610040116     c                   Z-add     Ar6Va1        Va2va1
230620991006     C                   MOVEL     AR6SV1        VI2SV1
230630040114     c                   Z-add     Ar6Va2        Vi2Va2
230640040114     c                   Z-add     Ar6Va2        Va2Va2
230650040114     c                   Movel     Ar6Sv2        Vi2Sv2
230660040114     c                   Z-add     Ar6Va3        Vi2Va3
230670040114     c                   Z-add     Ar6Va3        Va2Va3
230680040114     c                   Movel     Ar6Sv3        Vi2Sv3
230690040126     c                   Z-add     Ar6Imv        Vi2Imv
230700040114      * Vedo se ci sono altre varie su FIAR7
230710040114     c                   Eval      wtrc = '2'
230720041217     c                   clear                   contasv
230730040114     c     Kblp4         Setll     Fiar7000
230740040114     c                   Do        *Hival
230750040114     c     Kblp4         Reade     Fiar7000
230760040114     c                   If        %Eof(Fiar701l)
230770040114     c                   Leave
230780040114     c                   EndIf
230790040114     c                   Eval      war71 = 'E'
230800041217     c                   select
230810041217     c                   when      contasv = 0
230820040114     c                   Movel     Ar7Svn        Vi2Sv4
230830040114     c                   Z-add     Ar7Van        Vi2Va4
230840040114     c                   Z-add     Ar7Van        Va2Va4
230850041217     c                   add       1             contasv
230860041217     c                   when      contasv = 1
230870041217     c                   Movel     Ar7Svn        Vi2Sv5
230880041217     c                   Z-add     Ar7Van        Vi2Va5
230890041217     c                   Z-add     Ar7Van        Va2Va5
230900041217     c                   add       1             contasv
230910041217     c                   when      contasv = 2
230920041217     c                   Movel     Ar7Svn        Vi2Sv6
230930041217     c                   Z-add     Ar7Van        Vi2Va6
230940041217     c                   Z-add     Ar7Van        Va2Va6
230950040114     c                   Leave
230960041217     c                   endsl
230970040114     c                   EndDo
230980040114
230990991006     C                   MOVEL     AR6CEI        VI2CEI
231000991008     C                   MOVEL     AR6DIV        VI2DIV
231010991011     C                   MOVEL     AR6DIV        WDIV2
231020940927     C* SE ESISTE ESENZIONE IVA DECODIFICO
231030991006    2C     VI2CEI        IFNE      *BLANKS
231040940927     C                   MOVEL     'EI'          COD
231050940927     C                   MOVEL(P)  VI2CEI        KEY
231060940927     C                   EXSR      CTABEL
231070940927     C  N30              MOVEL     TBLUNI        V2DCEI
231080940927    2C                   ENDIF
231090980120     C**
231100050407     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
231110050407     C     VI2imv        IFNE      0
231120050407     C     vi2va1        ORNE      0
231130050407     C     vi2va2        ORNE      0
231140050407     C     vi2va3        ORNE      0
231150050407     C     vi2va4        ORNE      0
231160050407     C     vi2va5        ORNE      0
231170050407     C     vi2va6        ORNE      0
231180050407     C     VI2CEI        ORNE      ' '
231190050407     C                   MOVEL     'S'           WEMD03            1
231200050407     C                   ENDIF
231210050407     c*
231220991006     C                   CLEAR                   FIAR6000
231230050331   1ac                   endif
231240940927    1C                   ENDIF
231250941011     C*
231260941011     C* METTO IL NUMERO DI SPEDIZIONE IN 1 VIDEATA
231270941011     C                   Z-ADD     BLPNRS        PRENRS
231280941011     C                   Z-ADD     BLPNSP        PRENSP
231290941011     C                   MOVEL     BLPLNA        PRELNA
231300941011     C                   Z-ADD     BLPRMN        PRERMN
231310941011     C                   Z-ADD     BLPZNC        PREZNC
231320160225
231330160225      * Aggancio file estensione Fiar500f record "GEN" per recuperare
231340160225      * il referente e il telefono e v-valore
231350160225     c                   Clear                   DAr5Gen
231360160225     c                   clear                   w_ar5tcp
231370160225     c                   clear                   w_ar5als
231380160225     c                   clear                   w_ar5alx
231390160225     c                   clear                   w_aDpd
231400160225     c                   Eval      kAr5Trd = 'GEN'
231410160225     c     KFiar5        Chain(n)  Fiar501l
231420160225     c                   If        %Found(Fiar501l)
231430160225     c                   Movel     Ar5Uni        DAr5Gen
231440160225     c                   EndIf
231450160225     c                   Eval      VidRef = §Ar5Ref
231460160225     c                   Eval      VidTel = §Ar5Teld
231470160225     c                   Eval      Vidbva = §Ar5bva
231480160225     c                   eval      savbva = §ar5bva
231490160225     c                   eval      w_ar5tcp=§ar5tcp
231500160225     c                   eval      w_ar5als=§ar5als
231510160225     c                   eval      w_ar5alx=§ar5alx
231520160301     c                   eval      w_aDpd=§ar5fDpd
231530000913     C*
231540000913     C* SE DISK C CARICO COD.CHI SONO NEL SUBFILE
231550000913     C                   SETOFF                                       96
231560000918     C* PRENDO CTM
231570000918     C                   MOVE      '1B'          COD
231580000918     C                   MOVEL(P)  VIDCTM        KEY
231590000918     C                   EXSR      CTABEL
231600000918     C  N30              MOVEL     TBLUNI        DS1B
231610000918     C   30              CLEAR                   DS1B
231620000918     C*
231630160302     c                   clear                   wtip
231640160226     c* Disk "C" no DPD
231650160226     c                   if        (§1bf12<>'N' and
231660160226     c                              A_§OGNTW<>'DPD' and §ogntw<>'DPD' )
231670160226     c                             or
231680160226     c* Disk C export dpd con numero parce automatico (da f13 o forzatura instra
231690160226     c* damento)
231700160226     c                             (§1BF12<>'N' and A_§OGNTW='DPD' and
231710160226     c                              (§1bf13='A' or w_adpd='S'))
231720160226     c                             or
231730160226     c                             (§1bf12='B' and A_§OGNTW='DPD')
231740000913     C* Attivo F22=Manutenzione cod."Chi Sono"
231750000913     C                   SETON                                        96
231760000913     C                   MOVEL     'C'           WTRC
231770000913     C                   Z-ADD     0             NR8
231780120817     C**   KBLT1         SETLL     FNBLT01L
231790120817     C**   KBLT1         READE(N)  FNBLT01L                               30
231800120817     C     KBLT1         SETLL     FIART01L
231810120817     C     KBLT1         READE(N)  FIART01L                               30
231820000913    3C     *IN30         DOWEQ     *OFF
231830120817     C***  KARS1         CHAIN(N)  FIARS01L                           30
231840120817     C     KARS1A        CHAIN(N)  FIARS01L                           30
231850051102     C  N30              EXSR      CARARS
231860120817     C**   KBLT1         READE(N)  FNBLT01L                               30
231870120817     C     KBLT1         READE(N)  FIART01L                               30
231880000913    3C                   ENDDO
231890000913     C     NR8           IFGT      0
231900000913     C                   SETON                                        78
231910000913     C                   ENDIF
231920000918     C                   Z-ADD     NR8           SAVNR8
231930000913    2C                   ENDIF
231940070322     c* se bolla export dpd con numero parcel non automatico verifico
231950070322     c* se chi sono diverso dal numero parcel ed in questo caso memoriz
231960070323     c* zo nel subfile ma non abilito l'f22
231970070322     C     §1BF12        ifNE      'N'
231980070322     C     A_§OGNTW      ANDEQ     'DPD'
231990070322     C     §1BF13        ANDne     'A'
232000140715     C     §1BF12        ANDne     'B'
232010160225     c     w_aDpd        andne     'S'
232020070322     C                   Z-ADD     0             NR8
232030070322     C                   MOVEL     'C'           WTRC
232040120817     C***  KBLT1         chain(N)  FNBLT01L
232050120817     c***                if        %found(fnblt01l)
232060120817     C***  KARS1         CHAIN(N)  FIARS01L
232070120817     C     KBLT1         chain(N)  FIART01L
232080120817     c                   if        %found(fiart01l)
232090120817     C     KARS1A        CHAIN(N)  FIARS01L
232100070322     c                   if        %found(fiars01l)
232110070322     c                             and arsnot<>v7cnpr
232120070322     c                   exsr      carars
232130070322     c                   eval      wparcel='12'
232140070322     C                   SETON                                        78
232150070322     c                   endif
232160070322     c                   endif
232170070322     C                   Z-ADD     NR8           SAVNR8
232180070322     c                   endif
232190160302     c* Determino il fie
232200160302     c                   clear                   trul27ds1
232210160302     c                   z-add     BlpPkf        I27Pkg
232220160302     c                   movel     vidtsp        i27tsp
232230160302     c                   z-add     vidlnp        i27lnp
232240160302     c                   z-add     comlna        i27lna
232250160302     c                   z-add     savmit        i27cli
232260160302     c* tipo tariffa per export FED
232270160302     c                   if        wtip='FM' or wtip='FD'
232280160302     c                   move      wtip          i27tip
232290160302     c                   endif
232300160302     c                   call      'TRUL27R1'
232310160302     c                   parm                    trul27ds1
232320160302     c                   movel     o27fie        savfie
232330160302     c                   movel     o27ntw        s_27ntw
232340010209     C* PRENDO NUMERO ORM SE PRESENTE
232350010209     C                   MOVEL     'M'           WTRC
232360060215     C     KBLP4         CHAIN(N)  Fiar4000                           30
232370060215     C  N30              MOVEL     ar4NOT        DSBL4M
232380010209     C   30              CLEAR                   DSBL4M
232390061122     c                   movel     dsbl4m        S_dsbl4m
232400010209     C                   Z-ADD     §B4POE        VIDPOE
232410010222     C                   MOVEL     §B4NSR        VIDNOR
232420010222     C                   MOVE      §B4NOR        VIDNOR
232430010209     C                   Z-ADD     §B4NRV        VIDNRV
232440010215     C                   MOVEL     VIDORM        W01ORM
232450011126     C                   MOVEL     '1'           WOVUO
232460070427     C                   MOVEL     '1'           WOVUO1
232470011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
232480011126     C                   Z-ADD     VIDPOE        WOPOE
232490011126     C                   Z-ADD     VIDNOR        WONOR
232500011126     C                   Z-ADD     VIDNRV        WONRV
232510091008
232520011126     C                   CLEAR                   DORM01
232530090327     c                   clear                   s_ormksc
232540090327     c                   clear                   s_ormctr
232550011126     C     KORM          CHAIN     FNORM01L                           30
232560011126     C  N30              MOVEL     ORMFLO        DORM01
232570090327     c  n30              z-add     ormksc        s_ormksc
232580090327     c  n30              move      ormctr        s_ormctr
232590011126     C     §ORMFD        IFEQ      'S'
232600011126     C                   MOVEL     PROT          ATRDES
232610011126     C                   ELSE
232620011126     C                   CLEAR                   ATRDES
232630011126     C                   ENDIF
232640021218      * Aggancio file estensione Fiar500f record "BAN" per recuperare i
232650021218      * bancali
232660030704     c                   If        %subst(VidGva:1:1) = 'B'
232670021218     c                   Clear                   DAr5Ban
232680030704     c                   Eval      kAr5Trd = 'BAN'
232690021218     c     KFiar5        Chain(n)  Fiar501l
232700021218     c                   If        %Found(Fiar501l)
232710021218     c                   Movel     Ar5Uni        DAr5Ban
232720021218     c                   EndIf
232730021220     c                   If        §Ar5Tba > *Zeros
232740021218     c                   Movel     §Ar5Tba       VidTba
232750021220     c                   EndIf
232760021218     c                   Eval      VidNba = §Ar5Nba
232770030204     c                   Eval      SavNba = §Ar5Nba
232780021220     c                   If        §Ar5Tb2 > *Zeros
232790021220     c                   Movel     §Ar5Tb2       VidTb2
232800021220     c                   EndIf
232810021218     c                   Eval      VidNb2 = §Ar5Nb2
232820030204     c                   Eval      SavNb2 = §Ar5Nb2
232830030704     c                   EndIf
232840030704
232850030704      * Aggancio file estensione Fiar500f record "BNB" per recuperare i
232860030704      * bancali e i colli originali
232870030704     c                   If        %subst(VidGva:1:1) = 'O'
232880030704     c                   Clear                   DAr5Bnb
232890030704     c                   Eval      kAr5Trd = 'BNB'
232900030704     c     KFiar5        Chain(n)  Fiar501l
232910030704     c                   If        %Found(Fiar501l)
232920030704     c                   Movel     Ar5Uni        DAr5Bnb
232930030704     c                   EndIf
232940030704     c                   If        §Ar5bTba > *Zeros
232950030704     c                   Movel     §Ar5bTba      VidTba
232960030704     c                   EndIf
232970030704     c                   Eval      VidNba = §Ar5bNba
232980030704     c                   Eval      SavNba = §Ar5bNba
232990030704     c                   If        §Ar5bTb2 > *Zeros
233000030704     c                   Movel     §Ar5bTb2      VidTb2
233010030704     c                   EndIf
233020030704     c                   Eval      VidNb2 = §Ar5bNb2
233030030704     c                   Eval      SavNb2 = §Ar5bNb2
233040030704     c                   Eval      w03cor = §Ar5bCor
233050030704     c                   Eval      w03csf = §Ar5bCsf
233060030708     c                   Eval      savw03cor = §Ar5bCor
233070030708     c                   Eval      savw03csf = §Ar5bCsf
233080030704     c                   EndIf
233090031113      * Aggancio file estensione Fiar500f record "GEN" per recuperare
233100040610      * il referente e il telefono e v-valore
233110160225     c* Spostate prima delle considerazioni Disk C perchè mi serviva
233120160225     c* flag FORZATURA INSTRADAMENTO DA EEX A DPD §ar5fdpd
233130160225     c*                  Clear                   DAr5Gen
233140160225     c*                  clear                   w_ar5tcp
233150160225     c*                  clear                   w_ar5als
233160160225     c*                  clear                   w_ar5alx
233170160225     c*                  clear                   w_aDpd
233180160225     c*                  Eval      kAr5Trd = 'GEN'
233190160225     c*    KFiar5        Chain(n)  Fiar501l
233200160225     c*                  If        %Found(Fiar501l)
233210160225     c*                  Movel     Ar5Uni        DAr5Gen
233220160225     c*                  EndIf
233230160225     c*                  Eval      VidRef = §Ar5Ref
233240160225     c*                  Eval      VidTel = §Ar5Teld
233250160225     c*                  Eval      Vidbva = §Ar5bva
233260160225     c*                  eval      savbva = §ar5bva
233270160225     c*                  eval      w_ar5tcp=§ar5tcp
233280160225     c*                  eval      w_ar5als=§ar5als
233290160225     c*                  eval      w_ar5alx=§ar5alx
233300160225     c*                  eval      §ar5fDpd=w_aDpd
233310091211     c                   eval      nochkticC=*off
233320091112     c* window scelta beneficiario contrassegno: se presente codice su
233330091112     c* fiar5 rek gen imposto opportunamente campo scelta beneficiario C/A
233340091118     c                   if        dateu>=§vpocas
233350091119     c                   if        §ar5cdi<>*blanks
233360091112     c                   eval      wcassel2='X'
233370091211     c                   eval      nochkticC=*on
233380091112     c                   else
233390091127     C                   CLEAR                   DS1a
233400091127     c                   if        vidtic<>*blanks
233410091127     C                   MOVEL     '1A'          COD
233420091127     C                   MOVEL(P)  vidtic        KEY
233430091127     C                   EXSR      CTABEL
233440091127     C  N30              MOVEL     TBLUNI        DS1a
233450091127     c                   endif
233460091112     c                   if        §3afca<>0 and *in04 and widor1>0
233470091112     c                             and ormpag='O'
233480091204     c                             and §1amro<>'S'
233490091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
233500091112     c                                 %editc(ormksc:'X')
233510091112     c                             and %subst(%editc(ormcrc:'X'):1:7)<>
233520091112     c                                 %subst(%editc(ormcor:'X'):1:7)
233530091112     c                   eval      wcassel1='X'
233540091211     c                   eval      nochkticC=*on
233550091112     c                   endif
233560091112     c                   endif
233570091118     c                   endif
233580110512      * Aggancio file estensione Fiar500f record "EMD" per recuperare indirizzo
233590130315      * email destinatario e numero di telefono per sms
233600110512     c                   Clear                   DAr5emd
233610110512     c                   Eval      kAr5Trd = 'EMD'
233620110512     c     KFiar5        Chain(n)  Fiar501l
233630110512     c                   If        %Found(Fiar501l)
233640110512     c                   Movel     Ar5Uni        DAr5Emd
233650110512     c                   Eval      wemdest = §Ar5eml
233660160511     c                   Eval      sav_wemdest = §Ar5eml
233670130918     c* Per il momento e fino ache non ci sarà la storicicazione di
233680130918     c* varizioni di email destinatario impedisco la variazione se
233690130918     c* già inviata email
233700150213     c***                if        wemdest<>*blanks and §ar5dto=*blanks
233710150213     c***                clear                   atremd
233720150213     c***                clear                   atrwemd
233730150213     c***                endif
233740130315     c                   Eval      wsms    = §Ar5tel
233750160511     c                   Eval      sav_wsms    = §Ar5tel
233760140423     c* Per il momento e fino ache non ci sarà la storicicazione di
233770140423     c* varizioni di tel destinatario impedisco la variazione se
233780140423     c* già inviato sms
233790150213     c***                if        wsms   <>*blanks and §ar5dos=*blanks
233800150213     c***                clear                   atremd
233810150213     c***                clear                   atrwtel
233820150213     c****               endif
233830130315     c                   Eval      wsmp    = §Ar5smp
233840130923     c                   Eval      wmmp_ar5= §Ar5mmp
233850110512     c                   EndIf
233860110706     C* Aggancio fiar4 record "4" perr recuperare codici cup e cig
233870110706     C                   MOVEL     '4'           WTRC
233880110706     C     KBLP4         CHAIN(N)  Fiar4000                           30
233890110706     C  N30              MOVEL     ar4NOT        DSBL44
233900110706     C   30              CLEAR                   DSBL44
233910110706     c                   if        §b44cup<> *blanks or §b44cig<>*blanks
233920110706     c                   movel     §b44cup       wcupcup
233930110706     c                   movel     §b44cig       wcupcig
233940110706     c                   endif
233950090326     C* Manutenzione bolle: se sono in manutenzione bolle devo eventualmente
233960090326     c* completare la videata prendendo ksc/ctr memorizzati su data base
233970090326     c* se bolla avente sigla operatore presente in tabella 3M proteggo sempre
233980090326     c* perchè potebbe trattarsi di codici inseriti in automatico in fase di
233990090326     c* bolettazione in quanto passati da chiamante
234000090326     c                   if        *in04
234010090326     c                   exsr      sr_daar4a
234020130918     c                   endif
234030091112     c
234040160126     c* Verifico se presenti disposizioni per la consegna (variazioni o R.A.)
234050160126     c* da segnalare
234060160120     c                   clear                   wf10
234070160126     c                   eval      at0fva=nodi
234080160126     c                   clear                   wf16
234090160126     c                   eval      at0fra=nodi
234100160120     C     Kblp3         SETLL     FiARBF2C
234110160120     c                   if        %equal(fiarbf2c)
234120160126     c* Presenti variazioni --> attivo F10 e verifico se presente R.A.
234130160126     c                   clear                   at0fva
234140160120     c                   eval      wf10='S'
234150160126     c                   eval      wdna2lnp = §lplnp
234160160126     c                   eval      wdna2nrs = §lpnrs
234170160126     c                   eval      wdna2nsp = §lpnsp
234180160126     c                   eval      wdna2aas = §lpaas
234190160126     c                   eval      TGDtor  = 'S'
234200160126     c                   eval      TGDogg  = ds_OggSped
234210160126     c     K02TGD02      setll     FITGD000
234220160303     c                   if        %equal(fitgd32l)
234230160126     c                   clear                   at0fra
234240160126     c                   eval      wf16='S'
234250160126     c                   endif
234260160126     c                   else
234270160126     c* non sono presenti variazioni: verifico se presenti dispo di
234280160126     c* consegna --> se richiesto dirottamento c'è R.A. senza variazioni
234290160126     c* N.B.: non si può attivare l'F16=R.A. a prescindere dalla presenza o
234300160203     c* meno di variazioni/dispo di consegna in quanto le
234310160126     c* R.A. si possono generare anche in partenza a fronte di variazione
234320160126     c* colli o lna  (v.di routine sr_wrtRA ) e queste non sono da considerare
234330160126     c* disposizioni per la consegna
234340160126     c     kblp3         setll     tiidc01l
234350160203     c     kblp3         reade     tiidc01l
234360160203     c                   dow       not %eof(tiidc01l)  and wf16=' '
234370160203     c* solo se dispo aperta chaino relativa r.a. e solo se aperta anche
234380160203     c* quest'ultima attivo f16
234390160203     c                   if        idceladata=0
234400160203     c     ktgd01        chain     fitgd01l
234410160203     c                   if        %found(fitgd01l) and TGDDCD=0
234420160126     c                   clear                   at0fra
234430160126     c                   eval      wf16='S'
234440160203     c                   endif
234450160203     c                   endif
234460160203     c     kblp3         reade     tiidc01l
234470160203     c                   enddo
234480160120     c                   endif
234490000913     C*
234500950102     C                   ENDIF
234510061212     C                   ENDIF
234520900511     C                   ENDSR
234530011025     C*
234540011025      *--- TASSAZIONE VARIA 'N' --------------------------------------*
234550011025     C     TASSAN        BEGSR
234560011025      *
234570011025     C                   CLEAR                   DTAS
234580011025     C                   CLEAR                   DTASV
234590011025     C                   Z-ADD     BLPKSC        TASKSC
234600011025     C                   Z-ADD     BLPCTR        TASCTR
234610011025     C                   Z-ADD     BLPPKF        TASPKF
234611160530     C                   Z-ADD     BLPPKb        TASPKb
234620011025     C                   MOVEL     BLPLNP        TASLNP
234630011025     C                   MOVEL     BLPCTS        TASCTS
234640011025     C                   MOVEL     BLPDSP        TASDSP
234650011025     C                   MOVEL     BLPDSP        TASDCT
234660011025     C                   MOVEL     BLPVLF        TASVLF
234661160530     C                   MOVEL     BLPfvF        TASfvF
234670011025     C                   MOVEL     BLPTSP        TASTSP
234680011025     C     WBOL          IFEQ      '1'
234690011025     C                   MOVEL     §3ATB1        TASTBL
234700011025     C                   ELSE
234710011025     C                   MOVEL     §3ATB2        TASTBL
234720011025     C                   ENDIF
234730011025     C                   MOVEL     BLPLNA        TASLNA
234740011025     C                   MOVEL     BLPNCL        TASNCL
234741160530     C                   MOVEL     BLPNCL        TASNCLb
234750011025     C                   MOVEL     BLPQFT        TASQFT
234760011025     C     WBOL          IFEQ      '1'
234770011025     C     §3AFCA        ANDEQ     1
234780011025     C     WBOL          OREQ      '2'
234790011025     C     §3AFCA        ANDEQ     2
234800051115     C                   MOVEL     ar9CAS        TASCAS
234810051115     C                   MOVEL     ar9VCA        TASVCA
234820051115     C                   MOVEL     ar9TIC        TASTIC
234830011025     C                   ENDIF
234840011025     C                   MOVEL     BLPIAS        TASIAS
234850011025     C                   MOVEL     BLPVAS        TASVAS
234860011025     C                   MOVEL     BLPCAD        TASCAD
234870011025     C                   MOVEL     BLPNZD        TASNZD
234880011025     C                   MOVEL     BLPFIN        TASFIN
234890011025     C                   MOVEL     BLPCAM        TASCAM
234900011025     C                   MOVEL     BLPNZM        TASNZM
234910011025     C                   MOVEL     BLPFAP        TASFAP
234920011025     C                   MOVEL     BLPTC1        TASTC1
234930011025     C                   MOVEL     BLPTC2        TASTC2
234940011025     C     BLPFST        IFEQ      'S'
234950011025     C     BLPFST        OREQ      'C'
234960011025     C                   MOVEL     'S'           TASDDT
234970011025     C                   ELSE
234980011025     C                   MOVEL     'N'           TASDDT
234990011025     C                   ENDIF
235000061002     c*****              movel     blpfbr        §tasflo
235010061002     c* Passo nella DTAS01 il blpfbr
235020061002     c                   clear                   dtas01
235030061002     c                   movel     blpfbr        §asfbr
235040061002     c                   movel(P)  dtas01        §tasflo
235050011025      **
235060011025      * SE BOLLA EXPORT--> NON PASSO MAI IL FLAG CONSEGNA A MAGAZZINO
235070011025      *                    IN MODO CHE TASSI SEMPRE LA VARIA 'U'
235080020219     C     A_§ogntw      ifeq      'COR'
235090020219     c     A_§ogntw      oreq      'MES'
235100020219     c     A_§ogntw      oreq      'PPT'
235110011025     C                   MOVEL     BLPFDN        TASFDN
235120011025     C                   ENDIF
235130011025      **
235140011025      * CHAIN SU CAPPARIO PER PRENDERE COD TASSAZIONE MITTENTE
235150011025     C                   CLEAR                   DSSI95
235160011025     C                   MOVEL     BLPLOM        I95LOC
235170011025     C                   MOVEL     BLPCAM        I95CAP
235180011025     C                   MOVEL     BLPNZM        I95NAR
235190011025     C                   MOVEL     '3'           I95TCN
235200011025     C                   MOVEL     BLPDSP        I95DAT
235210011025     C     §3AFCA        IFNE      0
235220011025     C                   MOVEL     'S'           I95FCA
235230011025     C                   ENDIF
235240011025     C                   MOVEL     §3ATB1        I95TPO
235250020305     c* se network fedex passo flag apposito per dire di prendere i dati
235260020305     c* dalla tabella della nazione
235270020305     c     §ogntw        ifeq      'FED'
235280020305     c                   movel     'S'           i95fi1
235290020305     c                   endif
235300011025     C                   CALL      'TISI95R'
235310011025     C                   PARM                    DSSI95
235320011025     C     O95ERR        IFEQ      *BLANKS
235330011025     C                   MOVEL     O95CTS        TASMCT
235340011025     C                   ENDIF
235350011025     C                   MOVEL     'S'           WCAL13            1
235360020218      * ELABORO E CHIUDO CON RT IL PGM
235370011025     C                   MOVEL     ' '           TASTLA
235380011212     C* DATA TASSAZIONE = 0    : SE STO TASSANDO LA VARIA "N" NON E'
235390011121     C*                          POSSIBILE CHE LA BOLLA SIA GIA' FATTU-
235400011121     C*                          RATA
235410021002     c* imposto peso vdl e colli rilevati
235420030204     c                   z-add     blpncp        Tasncp
235430030204     c                   z-add     blppkc        Taspkc
235440030204      * Bancali
235450030205If  1c                   If        %Subst(VidGva:1:1) ='B'
235460030204     c                   Eval      TasBan = VidNba + VidNb2
235470030205     c                   EndIf
235480030728      * Colli originali
235490030728If  1c                   If        %Subst(VidGva:1:1) ='O'
235500030728     c                   Eval      TasNcl = W03Cor
235510030728     c                   EndIf
235520011025      *
235530011025     C                   CALL      'TNSF20R'
235540011025     C                   PARM                    KPJBA
235550011025     C                   PARM                    DTAS
235560011025     C                   PARM                    DTASV
235570011025      *
235580011025      * Tassazione andata buon fine
235590011025     C     TASERR        IFEQ      *BLANKS
235600011025      *
235610011025      * Controllo la divisa della tassazione con la divisa del video
235620011025      * se non corrispondono devo convertire la varia 'N' nella divisa
235630011025      * del video
235640011025     C     TASDIV        IFNE      VIDDIV
235650011025      * aggancio la tabella CV per sicurezza
235660011025     C                   CLEAR                   DSCV
235670011025     C                   MOVEL     'CV'          COD
235680011025     C                   MOVEL(P)  VIDDIV        KEY
235690011025     C                   EXSR      CTABEL
235700011025     C  N30              MOVEL     TBLUNI        DSCV
235710011025      *
235720011025     C                   CLEAR                   DSYEUR
235730011025     C                   MOVEL     TASDIV        YECDVI
235740011025     C                   MOVEL     VIDDIV        YECDVO
235750011025     C                   Z-ADD     TASIMV        YECIMI
235760011025     C     §CVFDC        IFEQ      'S'
235770011025     C                   MOVE      '3'           YECDCO
235780011025     C                   ELSE
235790011025     C                   MOVE      '0'           YECDCO
235800011025     C                   ENDIF
235810011025     C                   CALL      'YEURCO'
235820011025     C                   PARM                    DSYEUR
235830011025     C     YECESI        IFEQ      ' '
235840011025     C                   Z-ADD     YECIMO        TASIMV
235850011025     C                   ELSE
235860011025     C                   Z-ADD     88888888      TASIMV
235870011025     C                   ENDIF
235880011025     C                   ENDIF
235890011025      *
235900011025     C                   Z-ADD     TASIMV        V3CVA1
235910011025     C                   ENDIF
235920011025      *
235930011025     C                   ENDSR
235940901031     C*
235950901031     C*--- TASSAZIONE BOLLA ------------------------------------------*
235960901031     C     TASSAZ        BEGSR
235970991012      *
235980991007     C                   CLEAR                   DTAS
235990020503     C                   CLEAR                   WTASSA            1
236000030623     C                   CLEAR                   WTASSAD           1
236010030623     C                   CLEAR                   ITASSA           11 3
236020941219     C*
236030941219     C                   MOVEL     VIDCTR        TASCTR
236040990701     C* SE E' FRANCO CODIFICATO SEMPRE CODICE CLIENTE
236050941219    1C     *IN04         IFEQ      *OFF
236060941219     C                   MOVEL     WKSC          TASKSC
236070990701     C* PER 8888 IMPOSTO LA TARIFFA DI TASSAZIONE DEI PREPAGATI
236080990701   1AC     VIDCCM        IFEQ      8888
236090990610     C*
236100990610     C* PER PREPAGATI CERCO LA TARIFFA GIUSTA
236110020117      *
236120020117      * Non più, prendere sempre la tariffa di cartello
236130990610     C**
236140160219     c***                z-add     o27ksc        tasksc
236150160219     c***                z-add     o27ctr        tasctr
236160160322     c***                z-add     oc7kscc       tasksc
236170160322     c***                z-add     oc7ctrc       tasctr
236180990610     C**
236190990701   1AC                   ENDIF
236200990701    1C                   ENDIF
236210941219     C*
236220941219     C* SE ASSEGNATO CON TASSAZ TARIFFA MITTENTE LINEA PARTENZA+CLIMIT
236230941219    1C     *IN04         IFEQ      *ON
236240991007      *
236250941219    2C     SAVFTM        IFEQ      'S'
236260941219     C     VIDFTM        OREQ      'S'
236270941219     C                   MOVE      WKSC          TASKSC
236280941219   X2C                   ELSE
236290941219     C*
236300941219     C* SE ASSEGNATO NORMALE: LINEA ARRIVO+CODICE CLIENTE
236310941219     C                   MOVEL     COMLNA        TASKSC
236320941219     C                   MOVE      9999          TASKSC
236330941219     C                   Z-ADD     0             TASCTR
236340941219    2C                   END
236350941219    1C                   END
236360941219     C                   MOVEL     VIDCAM        TASCAM
236370991014     C                   MOVEL     VIDNZM        TASNZM
236380990610    1C     APDFCM        IFNE      ' '
236390941230     C                   MOVEL     'C'           TASFAP
236400941230     C                   ELSE
236410941230     C                   MOVEL     COMFAP        TASFAP
236420990610    1C                   END
236430941219     C*
236440941219     C* FLAG INOLTRO
236460990610     C*
236470941219     C                   EXSR      INOLTR
236480941219     C                   MOVEL     WFIN          TASFIN
236490941219     C                   MOVEL     VIDCAD        TASCAD
236500991014     C                   MOVEL     VIDNZD        TASNZD
236510941219     C*
236511160530     C                   movel     vidfvr        tasfvf
236520160530     C                   Z-ADD     V2CPKG_i      TASPKF
236521160530     C                   Z-ADD     V2CPKG_i      TASPKb
236530941219     C                   MOVEL     VIDLNP        TASLNP
236540941219     C                   MOVEL     SAVCTS        TASCTS
236550941219     C*
236560941219     C                   MOVEL     BLPDSP        TASDSP
236570970414     C                   MOVEL     BLPDSP        TASDCT
236580941219     C                   MOVEL     VARVOL        TASVLF
236590941219     C     VIDTSP        IFNE      *BLANKS
236600941219    1C                   MOVEL     VIDTSP        TASTSP
236610941219     C                   ELSE
236620941219     C* LO PRENDO DA TARIFFA
236630941219     C                   MOVEL     COMTSP        TASTSP
236640941219    1C                   ENDIF
236650941219     C* SE E' ANCORA VUOTO, IMPOSTO "C"
236660941219    1C     TASTSP        IFEQ      ' '
236670941219     C                   MOVEL     'C'           TASTSP
236680941219    1C                   ENDIF
236690980512     C     WBOL          IFEQ      '1'
236700980512     C                   MOVEL     §3ATB1        TASTBL
236710980512     C                   ELSE
236720980512     C                   MOVEL     §3ATB2        TASTBL
236730020503    1C                   ENDIF
236740941219     C*
236750950116     C* SOLO SE C/A SULLA 1 BOLLA
236760020503    1C     WBOL          IFEQ      '1'
236770980506     C     §3AFCA        ANDEQ     1
236780980506     C     WBOL          OREQ      '2'
236790980506     C     §3AFCA        ANDEQ     2
236800941219     C                   MOVEL     VIDCAS        TASCAS
236810941219     C                   MOVEL     VIDVCA        TASVCA
236820941219     C                   MOVEL     VIDTIC        TASTIC
236830020503    1C                   ENDIF
236840941219     C*
236850941219     C                   MOVEL     COMLNA        TASLNA
236860941219     C                   MOVEL     VIDNCL        TASNCL
236861160530     C                   MOVEL     VIDNCL        TASNCLB
236870040127      * passo il porto se sto tassando la prima bolla
236880040127     c                   If        wbol = '1'
236890941219     C                   MOVEL     VIDPOR        TASPOR
236900040127     c                   EndIf
236910941219     C                   MOVEL     VIDIAS        TASIAS
236920941219     C                   MOVEL     VIDVAS        TASVAS
236930941219     C                   MOVEL     VIDTC1        TASTC1
236940941219     C                   MOVEL     VIDTC2        TASTC2
236950941219     C                   MOVEL     VIDQFT        TASQFT
236960020503    1C     VIDBAM        IFEQ      'S'
236970970411     C                   MOVEL     'S'           TASDDT
236980020503    1C                   ENDIF
236990061002     c*vidfbr            movel     vidfbr        §tasflo
237000061002     c* Passo nella DTAS01 il blpfbr
237010061002     c                   clear                   dtas01
237020061002     c                   movel     vidfbr        §asfbr
237030130926     c***                if        wemdest<>*blanks
237040130926     c***                movel     'S'           §asemd
237050130926     c***                endif
237060130926     c                   clear                   w_emd
237070140424     c                   clear                   w_smp
237080130926     c* verifico presenza richiesta avviso mail merce partita
237090130926     c                   select
237100130926     c* manutenzione
237110130926     c                   when      *in12 and not *in15
237120130926     c                             and wmmp_ar5='S' and wemdest<>*blanks
237130130926     c                   eval      w_emd = 'S'
237140130926     c* conferma bolle da cliente
237150130926     c                   when      *in12 and *in15
237160130930     c                   if        wmmp='N'
237170130926     c                   eval      aggioAr8=' '
237180130926     c                   exsr      sr_gesar8
237190130926     c                   endif
237200130926     c                   if        wemdest<>*blanks  and
237210130930     c                             (wmmp<>'N' or w_allm='S')
237220130926     c                   eval      w_emd = 'S'
237230130926     c                   endif
237240130926     c                   endsl
237250140424     c                   if        wsms<>*blanks and wsmp='S'
237260140424     c                   eval      w_smp='S'
237270140424     c                   endif
237280140424     c
237290130926
237300130926     c                   select
237310150324     c***                when      w_emd='S' and w_smp=' '
237320150324     c                   when      w_emd='S'
237330130926     c                   eval      §asemd='S'
237340140424     c                   when      w_emd='S' and w_smp='S'
237350130926     c                   eval      §asemd='E'
237360140424     c                   when      w_smp='S'
237370130926     c                   eval      §asemd='X'
237380130926     c                   endsl
237390150107     c* PIN CODE
237400150107     c                   if        wpincode<>*blanks
237410150107     c                   eval      §aspin='S'
237420150107     c                   endif
237430130926     c
237440061002     c                   movel(P)  dtas01        §tasflo
237450151127
237460151127     c* Packing list e orm telefonici solo per la prima bolla in quanto la secon
237470151127     c* è solo per tassare una specifica varia
237480151127     c                   if        wbol='1'
237490151117     c* PACKING LIST
237500151117     c                   select
237510151117     c* manutenzione
237520151117     c                   when      *in12 and not *in15
237530151117     c                   if        w_ar5alx='S' or w_ar5als='S'
237540151117     c                   eval      tasspl='S'
237550151117     c                   endif
237560151117     c* conferma bolle
237570151117     c* in questa fase non so ancora se packing list pdf  in quanto
237580151117     c* lo so solo dopo il trattamento del pdf che viene eseguito da
237590151117     c* altro pgm. quindi qui gestisco solo il packing list da fivax
237600151117     c                   when      *in12 and *in15
237610151117     c                   if        wvax='S'
237620151117     c                   eval      tasspl='S'
237630151117     c                   endif
237640151117     c                   endsl
237650151117     c* ADDEBITO ORM TELEFONICI (diritto di chiamata)
237660151117     c                   exsr      sr_b4ado
237670151117     c                   if        w_§b4ado='S'
237680151117     c                   movel     'S'           tasprt
237690151117     c                   endif
237700151127     c                   endif
237710941219     C* LEGGO IL SFL PER PRENDERE LE VARIE
237720980506     C* SOLO PER 1 BOLLA ESISTE TASSAZIONE COMPLETA
237730991007     C                   CLEAR                   DTASV
237740980506    1C     WBOL          IFEQ      '1'
237750941219     C                   Z-ADD     1             NRR
237760941219     C                   Z-ADD     1             C
237770941219     C*
237780980506    2C                   DO        20            NRR
237790941219     C     NRR           CHAIN     LS01S03                            30
237800941219     C*
237810980506    3C     *IN30         IFEQ      *OFF
237820020503     c* se devo tassare una specifica varia(da tabella 3A) e c'e' gia'
237830020503     c*  non richiamo la tassazione
237840020503     c                   if        §3asva<>*blanks and v3csv1=§3asva
237850020503     c                   eval      wtassa='N'
237860030623      * mi salvo l'importo della varia
237870030623     c                   eval      itassa=v3cva1
237880020503     c                   endif
237890030623     c* se esiste già la varia "D" non la ricalcolo
237900030623     c*
237910030623     c                   if        v3csv1='D'
237920030623     c                   eval      wtassad='N'
237930030623     c                   endif
237940030624      * SE ESISTE LA VARIA "&" CON TUTTI 8888888 NON LA PASSO AL TNSF20R
237950030624      * MA PASSO UN FLAG  DI RICHIESTA CALCOLO VARIA "&"
237960030624     C                   IF        V3CSV1 = '&' AND V3CVA1 = 88888888
237970030624     C                   EVAL      TASFCAA = 'S'
237980030624     C                   ELSE
237990941219     C                   MOVEL     V3CSV1        VSV(C)
238000991007     C                   Z-ADD     V3CVA1        VVA(C)
238010030624     c                   ENDIF
238020941219     C                   ADD       1             C
238030980506    3C                   ENDIF
238040980506    2C                   ENDDO
238050980506     C**
238060991019     C                   MOVEL     VIDDIV        TASDIV
238070991019     C**
238080980506     C** 2 BOLLA: IMPOSTO LA VARIA "G"
238090980506   X1C                   ELSE
238100991019     C                   MOVEL     VI2DIV        TASDIV
238110980608     C     VI2VA1        IFGT      0
238120980608     C                   MOVEL     VI2SV1        VSV(1)
238130991007     C                   Z-ADD     VI2VA1        VVA(1)
238140040121     c                   Movel     Vi2Es1        Ves(1)
238150980608     C                   ENDIF
238160040115     c                   If        Vi2Va2 > *Zeros
238170040115     c                   Movel     Vi2Sv2        Vsv(2)
238180040115     c                   Z-add     Vi2Va2        Vva(2)
238190040121     c                   Movel     Vi2Es2        Ves(2)
238200040115     c                   EndIf
238210040115     c                   If        Vi2Va3 > *Zeros
238220040115     c                   Movel     Vi2Sv3        Vsv(3)
238230040115     c                   Z-add     Vi2Va3        Vva(3)
238240040121     c                   Movel     Vi2Es3        Ves(3)
238250040115     c                   EndIf
238260040115     c                   If        Vi2Va4 > *Zeros
238270040115     c                   Movel     Vi2Sv4        Vsv(4)
238280040115     c                   Z-add     Vi2Va4        Vva(4)
238290040121     c                   Movel     Vi2Es4        Ves(4)
238300040115     c                   EndIf
238310041217     c                   If        Vi2Va5 > *Zeros
238320041217     c                   Movel     Vi2Sv5        Vsv(5)
238330041217     c                   Z-add     Vi2Va5        Vva(5)
238340041217     c                   Movel     Vi2Es5        Ves(5)
238350041217     c                   EndIf
238360041217     c                   If        Vi2Va6 > *Zeros
238370041217     c                   Movel     Vi2Sv6        Vsv(6)
238380041217     c                   Z-add     Vi2Va6        Vva(6)
238390041217     c                   Movel     Vi2Es6        Ves(6)
238400041217     c                   EndIf
238410980608     C                   MOVEL     'G'           TASSVA
238420040115     c                   Eval      TascVag = 'S'
238430980506    1C                   ENDIF
238440990915     C* MERCE PORTATA A MAGAZZINO DAL COD.AUTOTRASPORTATORE
238450990915     C*  PER I PREPAGATI LA RICHIESTA VIENE FATTA A VIDEO
238460990915     C     VIDPDR        IFLE      *ZEROS
238470990915     C     *IN22         ANDEQ     *ON
238480001024     C                   MOVEL     VIDMAG        TASFDN
238490990915     C                   ELSE
238500990915     C                   MOVEL     APDFCM        TASFDN
238510990915     C                   ENDIF
238520020220     c* se bolla in assegnato export faccio sempre pagare la varia U
238530020220     c     *in04         ifeq      *on
238540020220     c     A_§ogntw      ifeq      'EEX'
238550081008     c***  A_§ogntw      oreq      'EUP'
238560020220     c     A_§ogntw      oreq      'DPD'
238570020220     c     A_§ogntw      oreq      'FED'
238580020220     c                   clear                   tasfdn
238590020220     c                   endif
238600020220     c                   endif
238610941219     C*
238620970708     C                   MOVEL     MITCTS        TASMCT
238630021002     c**
238640030204
238650030204      * Bancali
238660030205If  1c                   If        %Subst(VidGva:1:1) ='B'
238670030204     c                   Eval      TasBan = VidNba + VidNb2
238680030205     c                   EndIf
238690030728      * Colli originali
238700030728If  1c                   If        %Subst(VidGva:1:1) ='O'
238710030728     c                   Eval      TasNcl = W03Cor
238720030728     c                   EndIf
238730030204
238740020503     c                   if        wtassa=' '
238750020503     c* se devo tassare solo una varia, da tipo bolla, la imposto
238760020503     c                   if        §3asva<>*blanks
238770020503     c                   eval      tassva=§3asva
238780020503     c                   endif
238790030623      *
238800030623     c                   endif
238810030623      * per prepagato passo al TNSF20R la varia  "D" e l'importo del dir.fat.
238820030623      * da sommare che prendo CNIND (INDSIN)
238830030623      *
238840030623     c                   if        *in34  or *in22
238850030623      * recupero le spese incasso
238860030623     c     kaco          chain     cnind00f
238870030623     c                   if        %found(cnind00f)
238880031007      * se diritto di fatturazione a zero con calcolo la varia D
238890031007     c                   if        indsin = 0
238900031007     c                   eval      wtassad='N'
238910031007      *
238920031007     c                   else
238930030623     c                   move      indsin        tasivdf
238940030623     c                   eval      tassvdf = 'D'
238950031007     c                   endif
238960031007      *
238970030623     c                   endif
238980030623      *
238990030623     c                   if        wtassa='N' and wtassad = ' '
239000030623     c* se ho già tassata la singola varia devo sommare il solo diritto di fattu
239010030623     c* maggiore di zero oppure se imponibile a zero ho la singola varia valoriz
239020030623     c                   if        tasimv > 0  or (tasimv = 0 and itassa > 0)
239030030623     c                   eval      tassva='D'
239040030623     c                   else
239050030623     c                   eval      wtassad = 'N'
239060030623     c                   endif
239070030623     c                   endif
239080030623     c**
239090030623     c                   if        wtassa = 'N' and wtassad = 'N'
239100030623     c                   goto      endtas
239110030623     c                   endif
239120040115      * no prepagato
239130040115     c                   Else
239140040115     c                   if        wtassa = 'N'
239150040115     c                   goto      endtas
239160040115     c                   endif
239170040115     c                   endif
239180030623     c*
239190990701     C                   CLEAR                   WFIAS
239200990701     C                   MOVEL     PARAMF        KPJBU
239210991014      *
239220941219     C                   CALL      'TNSF20R'
239230941221     C                   PARM                    KPJBA
239240991007     C                   PARM                    DTAS
239250991007     C                   PARM                    DTASV
239260941219     C*
239270941219     C                   Z-ADD     0             NRR
239280941219     C                   Z-ADD     1             C
239290991014      *
239300991014      * PRIMA BOLLA
239310980506    1C     WBOL          IFEQ      '1'
239320991014     C* IMPOSTO LE VARIE
239330941219    2C                   DO        20            C
239340991027     C                   MOVEL     VSV(C)        WSVN
239350991027     C                   Z-ADD     VVA(C)        WVAN
239360941219     C                   MOVEL     VES(C)        WEV1
239370941219     C                   EXSR      CARVAR
239380941219    2C                   ENDDO
239390991025     C*
239400991025     C                   ADD       1             NRR
239410991025     C     NRR           DO        20            NRR
239420991025     C     NRR           CHAIN     LS01S03                            30
239430991025     C                   CLEAR                   V3CSV1
239440991025     C                   CLEAR                   V3CVA1
239450991025     C                   CLEAR                   V3HVA1
239460991025     C                   CLEAR                   V3CEV1
239470991025     C   30              WRITE     LS01S03
239480991025     C  N30              UPDATE    LS01S03
239490991025     C                   ENDDO
239500930415     C*
239510980506    2C     TASERR        IFEQ      *BLANKS
239520901031     C                   MOVEL     TASPOR        VIDPOR
239530991015     C                   MOVEL     TASPOR        MEMPOR
239540950220     C                   Z-ADD     TASQFT        VIDQFT
239550991014     C                   MOVEL     TASIMV        VIDIMV
239560991015     C                   MOVEL     TASDIV        VIDDIV
239570991015     C                   MOVEL     TASDIV        WDIV1
239580991015      *
239590991015   X2C                   ELSE
239600991015     C     TASMSG        IFEQ      *BLANKS
239610991015     C                   MOVEL     ERR(104)      VIDMSG
239620991015     C                   ELSE
239630991015     C                   MOVEL(P)  TASMSG        VIDMSG
239640991015     C                   ENDIF
239650991015     C                   SETON                                        9052
239660991015    2C                   ENDIF
239670991014      *
239680991014      * 2 BOLLA
239690980506   X1C                   ELSE
239700040115     c                   Clear                   ContaSv
239710040115      * carico le varie
239720040115Do  2c                   Do        20            c
239730040115If  3c                   If        Vsv(c) <> §$2Iva and
239740040115     c                             Vsv(c) <> §$2Bol
239750040115     c                   Add       1             ContaSv
239760040115S   4c                   Select
239770040115     c                   When      ContaSv = 1
239780040115     c                   Movel     Vsv(c)        Vi2Sv1
239790040115     c                   Z-add     Vva(c)        Vi2Va1
239800040121     c                   Movel     Ves(c)        Vi2Es1
239810040115     c                   When      ContaSv = 2
239820040115     c                   Movel     Vsv(c)        Vi2Sv2
239830040115     c                   Z-add     Vva(c)        Vi2Va2
239840040121     c                   Movel     Ves(c)        Vi2Es2
239850040115     c                   When      ContaSv = 3
239860040115     c                   Movel     Vsv(c)        Vi2Sv3
239870040115     c                   Z-add     Vva(c)        Vi2Va3
239880040121     c                   Movel     Ves(c)        Vi2Es3
239890040115     c                   When      ContaSv = 4
239900040115     c                   Movel     Vsv(c)        Vi2Sv4
239910040115     c                   Z-add     Vva(c)        Vi2Va4
239920040121     c                   Movel     Ves(c)        Vi2Es4
239930041217     c                   When      ContaSv = 5
239940041217     c                   Movel     Vsv(c)        Vi2Sv5
239950041217     c                   Z-add     Vva(c)        Vi2Va5
239960041217     c                   Movel     Ves(c)        Vi2Es5
239970041217     c                   When      ContaSv = 6
239980041217     c                   Movel     Vsv(c)        Vi2Sv6
239990041217     c                   Z-add     Vva(c)        Vi2Va6
240000041217     c                   Movel     Ves(c)        Vi2Es6
240010040115    4c                   EndSl
240020040115    3c                   EndIf
240030040115    2c                   EndDo
240040991014      *
2400509806080   2C     TASERR        IFEQ      ' '
240060040115     C                   MOVEL     TASDIV        VI2DIV
240070040115     C                   MOVEL     TASDIV        WDIV2
240080040126     c                   Movel     TasImv        Vi2Imv
240090980506     C**
240100980506   X2C                   ELSE
240110980506     C* MANCA TARIFFA
240120980608     C     TASMSG        IFEQ      *BLANKS
240130980506     C                   MOVEL     ERR(104)      VIDMSG
240140980608     C                   ELSE
240150980608     C                   MOVEL(P)  TASMSG        VIDMSG
240160980608     C                   ENDIF
240170980506     C                   SETON                                        9041
240180980506    2C                   ENDIF
240190980506    1C                   ENDIF
240210940923     C*
240220940919     C     ENDTAS        ENDSR
240230990630     C*
240240990630     C* CALCOLO IL TOTALE FATTURA ------------------------------------*
240250990630     C     TOTFAT        BEGSR
240260991014      *
240270991015      *  RECUPERO L'ARROTONDAMENTO
240280991102     C                   CLEAR                   DSBS02
240290991102     C                   MOVEL     'C'           T02MOD
240300991102     C                   MOVEL     KNSIF         T02SIF
240310991102     C                   MOVEL     'GEI'         T02COD
240320991102     C                   MOVEL     VIDDIV        T02KE1
240330991102      *
240340991102     C                   CALL      'TIBS02R'
240350991102     C                   PARM                    KPJBA
240360991102     C                   PARM                    DSBS02
240370991102      *
240380991102     C     T02ERR        IFEQ      *BLANKS
240390991102     C                   MOVEL     T02UNI        DGEI
240400991102     C                   ELSE
240410991102     C                   CLEAR                   DGEI
240420991102     C                   ENDIF
240430991015      *
240440990630     C     VIDIMV        IFGT      0
240450991014     C                   CLEAR                   DSLV04
240460990630     C                   Z-ADD     COMDFT        D04DFT
240470991014     C                   Z-ADD     VIDIMV        D04IMV
240480991014     C                   MOVEL     VIDDIV        D04DIV
240490990630     C                   MOVEL     VIDCEI        D04CEI
240500991014     C                   MOVEL     VIDTIC        D04TIC
240510990630     C                   Z-ADD     VIDCAS        D04CAS
240520990630     C                   MOVEL     VIDVCA        D04VCA
240530990630     C                   Z-ADD     VIDPOR        D04POR
240540990701     C     *IN22         IFEQ      *ON
240550991015     C                   MOVEL     §GEAED        D04AED
240560991015     C                   Z-ADD     §GEAVL        D04VAR
240570990701     C                   ENDIF
240580991014     C     *IN04         IFEQ      *ON
240590991014     C                   MOVEL     '1'           D04SPE
240600991014     C                   ELSE
240610991014     C                   MOVEL     '8'           D04SPE
240620991014     C                   ENDIF
240630991014     C                   MOVEL     §3ATB1        D04TBL
240640991014      *
240650991014     C                   CALL      'FNLV04R'
240660991014     C                   PARM                    DSLV04
240670991007     C                   PARM                    DTASV
240680990630     C                   ENDIF
240690991014      *
240700990630     C                   ENDSR
240710930915     C*
240720930915     C* ANNULLAMENTO BOLLA -------------------------------------------*
240730930915     C     ANNULL        BEGSR
240740930915     C                   SETOFF                                       90
240750060307     C                   clear                   wf12              1
240760970408     C* NON POSSO ANNULLARE MAI UNA BOLLA LEGATA
240770940915     C     KBLP3         CHAIN     FNLBL01L                           30
240780930915     C*
240790930915    1C     *IN30         IFEQ      *OFF
240800941020     C                   MOVEL     ERR(65)       VIDMSG
240810941020     C                   SETON                                        90
240820970408    1C                   ENDIF
240830040614     c* Non posso annullare mai una bolla £ se lnp=lna
240840040611     C  N90BLPCBO        ifeq      '£ '
240850040611     C     BLPLNP        ANDeq     BLPLNA
240860040611     C                   MOVEL     ERR(282)      VIDMSG
240870040611     C                   SETON                                        90
240880040611     c                   endif
240890061127     c* Non posso annullare bolla con C.A.
240900141202     c                   if        not *in90
240910061127     c                   clear                   fidn12ds
240920061127     c                   eval      dn_i12aas = §LPAAS
240930061127     c                   eval      dn_i12lnp = §LPLNP
240940061127     c                   eval      dn_i12nrs = §LPNRS
240950061127     c                   eval      dn_i12nsp = §LPNSP
240960061127     c                   eval      dn_i12fel = 'E'
240970061127     c                   eval      dn_i12fan = 'E'
240980061127     c                   call      'FIDN12R'
240990061127     c                   parm                    fidn12ds
241000061127     c* se numero di CA trovate maggiore di zero
241010061127     c                   if        dn_o12nca > 0
241020061127     C                   MOVEL     ERR(310)      VIDMSG
241030061127     C                   SETON                                        90
241040061127     c                   endif
241050141202     c                   endif
241060110321     c* avviso se sono presenti spunte entrata
241070141202     c                   if        not *in90
241080110321     c                   if        wforzbrv=*off
241090110321     c                   eval      wcheck=*on
241100110321     c                   exsr      sr_gesbranm
241110110321     c                   if        *in90
241120110321     C                   MOVEL     ERR(336)      VIDMSG
241130110321     c                   endif
241140110321     c                   eval      wforzbrv=*on
241150110321     c                   endif
241160141202     c                   endif
241170060210     c* ANNULLAMENTO DI UN PREPAGATO
241180060210     c* verifico se in caso di annullamento prepagati devo richiedere
241190060210     c* la motivazione
241200060308     c                   movel     'KM'          wcvb
241210060308     c                   exsr      cls_lv85
241220060210     c                   clear                   ilv85cvb
241230070514     c**n90              if        *in22 = *ON and dateu >= §vpogpp
241240070514     c  n90              if        *in22 = *ON
241250060213     c*  Prima di tutto controllo che il prepagato non sia già stato incassa
241260060213     c*  to
241270060213     c                   exsr      sr_callycow
241280060213     c                   if        prmesito <> 0
241290060213     C                   MOVEL     ERR(297)      VIDMSG
241300060213     C                   SETON                                        90
241310060213     c                   else
241320110419     c*  Poi controllo che l'ORM non sia in distinta
241330110419     c                   if        ormndc>0
241340110419     c                   seton                                        90
241350110419     c*        errore: ORM già ritirato
241360110419     c                   if        ormfao=600
241370110419     C                   MOVEL     ERR(337)      VIDMSG
241380110419     c                   else
241390110419     c*        errore: per annullare togliere l'orm dalla distinta
241400110419     C                   MOVEL     ERR(338)      VIDMSG
241410110419     c                   endif
241420110419     c                   else
241430060227     c                   movel     '7L'          cod
241440060227     C                   MOVEL(P)  'KM'          KEY
241450060227     C                   EXSR      CTABEL
241460060227     C                   MOVEL     TBLUNI        DS7L
241470060227     c                   if        §7lmtv = 'S'
241480060210     c                   clear                   fnlv85ds
241490060210     c                   eval      ilv85cvb = 'KM'
241500060210     c                   eval      ilv85tel = 'V'
241510060309     c                   z-add     5             ilv85row
241520060210     c                   movel     fnlv85ds      kpjbu
241530060210     c                   call      'FNLV85R'
241540060210     c                   parm                    kpjba
241550060227     c*****              parm                    ds7l
241560060210     c                   movel     kpjbu         fnlv85ds
241570060210     c* F12=Ritorno --> riemetto formato 01
241580060210     c                   if        olv85f12 = '1'
241590060307     c                   eval      wf12   = '1'
241600060307     c                   goto      fannull
241610060210     c                   endif
241620060227     c                   endif
241630060213     c                   endif
241640060210     c                   endif
241650110419     c                   endif
241660060125
241670060125      * Richiamo il pgm per annullare l'ORM legato alla bolla RC
241680100604     c***                If        blpgma = 'RC'
241690110321     c  n90              If        w7rRC  = 'S'
241700060125     c                   Clear                   fnls25ds
241710060125     c                   If        blpccm > *Zeros
241720060125     c                   Eval      i25Ksc = blpccm
241730060125     c                   Else
241740060125     c                   Eval      i25ksc = blpksc
241750060125     c                   EndIf
241760060125     c                   Move      blpaas        i25aas
241770060125     c                   Eval      i25spe = %editc(blplnp:'X') +
241780060125     c                                      %editc(blpnrs:'X') +
241790060125     c                                      %editc(blpnsp:'X')
241800060125     c                   Call      'FNLS25R'
241810060125     c                   Parm                    Fnls25ds
241820060125     c                   EndIf
241830061122     c* se annullamento di un prepagato richiamo il seguente pgm per
241840061122     c* chiudere l'orm. No considero eventuali errori ricevuti dal
241850061122     c* pgm in quanto ininfluenti per questa operazione
241860070627     c  n90              if        *in22=*on and S_§b4fit<>*all'9'
241870061122     c                   clear                   fior51ds
241880061122     c                   z-add     s_§b4poe      i51poe
241890061122     c                   z-add     s_§b4nsr      I51NSR
241900061122     c                   z-add     s_§b4nor      I51NOR
241910061122     c                   z-add     s_§b4nrv      I51NRV
241920061122     c                   z-add     999           i51far
241930061122     c                   movel     '80'          i51car
241940061122     c                   call      'FIOR51R'
241950061122     c                   parm                    fior51ds
241960061122     c                   endif
241970060125
241980970408     C****
241990930915     C* CANCELLAZIONE FISICA FILES
242000930915     C  N90              EXSR      DELBLP
242010941020     C* PASSO NEL FALG PROVENIENZA '1' PER INDICARE CHE LA BOLLA E'
242020941011     C*  STATA ANNULLATA
242030941020     C                   MOVEL     '1'           §LPFPR
242040930915     C*
242050060307     C     fannull       ENDSR
242060901031     C*
242070930915     C*--- CANCELLAZIONE FISICA BOLLA IN TUTTI I SUOI FILES ----------*
242080930915     C     DELBLP        BEGSR
242090950410     C*
242100930915     C* SCRIVO RECORD IN FLBLA
242110070514     c***                if        *in22 = *off or dateu < §vpogpp
242120070514     c                   if        *in22 = *off
242130900511     C                   MOVEL     BLPLNP        BLALNP
242140900511     C                   MOVEL     BLPAAS        BLAAAS
242150900511     C                   MOVEL     BLPMGS        BLAMGS
242160900511     C                   MOVEL     BLPNRS        BLANRS
242170900511     C                   MOVEL     BLPNSP        BLANSP
242180900511     C                   MOVEL     BLPLNA        BLALNA
242190080904     C                   MOVEL     §3atb1        BLATBL
242200900511     C                   MOVEL     DATEU         BLADAN
242210080904     C                   MOVEL     simfel        BLAfle
242220110411     C                   MOVEL     blpcbo        BLAcbo
242230110411     c                   time                    blaoan
242240110411     c                   movel     knmus         blapru
242250110411     c                   movel     knmtd         blamtd
242260110411     c                   if        blpccm>0
242270110411     c                   z-add     blpccm        blaccm
242280110411     c                   else
242290110411     c                   if        not *in04
242300110411     c                   z-add     blpksc        blaccm
242310110411     c                   endif
242320110411     c                   endif
242330110411     c                   z-add     blprmn        blarmn
242340110411     c                   movel     blprma        blarma
242350110411     c                   movel     blprsm        blarsm
242360110411     c                   movel     blpinm        blainm
242370110411     c                   movel     blpcam        blacam
242380110411     c                   movel     blplom        blalom
242390110411     c                   movel     blpprm        blaprm
242400110411     c                   movel     blpnzm        blanzm
242410110411     c                   movel     blprsd        blarsd
242420110411     c                   movel     blpcad        blacad
242430110411     c                   movel     blplod        blalod
242440110411     c                   movel     blpprd        blaprd
242450110411     c                   movel     blpnzd        blanzd
242460110411     c                   movel     blpctm        blactm
242470110411     c                   z-add     blpncl        blancl
242480110411     c                   z-add     blppkb        blapkb
242490110411     c                   z-add     blpfls        blafls
242500110411     c                   z-add     blpncd        blancd
242510110411     c                   z-add     blpnca        blanca
242520080904     C                   WRITE     TNBLA000
242530060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
242540060210     c* anomalie
242550110321     c                   eval      wcheck=*off
242560060210     c                   exsr      sr_gesbranm
242570060210     c                   endif
242580060210     C* DISALLOCAZIONE FILES
242590001130      *
242600061212     C                   UNLOCK    FNBLP00F
242610051115     C                   UNLOCK    Fiar901L
242620001211     C                   UNLOCK    FIAR601L
242630001211     C                   UNLOCK    FIAR701L
242640060215     C                   UNLOCK    Fiar401L
242650001211     C                   UNLOCK    FNBLT01L
242660051102     C                   UNLOCK    FIARS01L
242670120814     C                   UNLOCK    FIART01L
242680060210     c*
242690070514     c* OPERAZIONI PER PREPAGATI
242700070514     c****               if        *in22 = *on and dateu >= §vpogpp
242710070514     c                   if        *in22 = *on
242720060210     c* richiamo fnlr48r per storicizzare la variazione
242730060210     c* ed effettuare altri eventuali aggiornamenti su file contrassegni
242740060210     c* e tassazione seconda bolla. L'aggiornamento della testata bolla
242750060210     c* viene effettuato in questo pgm al compimento di tutti gli aggiornam.
242760060303     c                   clear                   fnlr48ds
242770060210     C                   MOVEL     'L'           D48TLA
242780060210     C                   z-add     blplnp        D48FGS
242790060210     C                   z-add     blpaas        D48AAS
242800060210     C                   MOVE      blpLNP        D48LNP
242810060210     C                   MOVE      blpNRS        D48NRS
242820060210     C                   MOVE      blpNSP        D48NSP
242830060210     C                   MOVE      blpcbo        D48CBO
242840060210     C                   MOVEL     'KM'          D48CVB
242850060210     C                   MOVEL     'K'           D48TRC
242860060210     C                   MOVEL     'E'           D48FFR
242870060210     C                   MOVEL     ' '           D48ERR
242880060210     C                   MOVEL     *BLANK        D48MSG
242890060210     C                   MOVEL     'P'           D48TBO
242900060303     c                   movel     'N'           d48mct
242910060307     c                   eval      d48mtv = olv85mtv
242920060307     c                   movel     olv85nt1      d48not
242930060307     c                   move      olv85nt2      d48not
242940060210     c                   clear                   dsarbk
242950060210     C                   MOVEL     'M'           §BKcbn
242960060210     C                   MOVEL     fnlr48ds      KPJBU
242970060210     C                   CALL      'FNLR48R'
242980060210     C                   PARM                    KPJBA
242990060210     C                   PARM                    DSARBD
243000060210     C                   PARM                    DSARBK
243010060210     C                   PARM                    DARBT
243020060210     C                   PARM                    DSARBG
243030060210     C                   PARM                    trul90ds
243040060210     C                   MOVEL     KPJBU         fnlr48ds
243050060210     C     D48ERR        IFne      *BLANK
243060060210     c                   seton                                        90
243070060213     c                   movel     D48msg        vidmsg
243080060210     c                   goto      e_del
243090060210     C                   END
243100060210     c* rialloco fnblp
243110061218     C     savnrr        CHAIN     FNBLP000                           90
243120060210     c* richiamo routine di cancellazione spunte entrata e sistemazione
243130060210     c* anomalie
243140110321     c                   eval      wcheck=*off
243150060210     c                   exsr      sr_gesbranm
243160060210     c                   endif
243170001211     C*
243180160202     c* Chiudo Dispo per la consegna e R.A. se presenti
243190160202     c                   exsr      sr_chiuDispoRa
243200060210     C* RICHIAMO PROGRAMMA DI CANCELLAZIONE
243210060210     C*
243220001130     C                   MOVE      KPJBU         WA256           256
243230001130     C                   CLEAR                   DSLS63
243240060213     c* se è un prepagato lo richiamo in modalità "P" per cancellare solo
243250060213     c* il dettaglio colli e suoi file legati
243260070514     c****               if        *in22 = *on and dateu >= §vpogpp
243270070514     c                   if        *in22 = *on
243280060210     c                   movel     'P'           i63mod
243290060210     c                   endif
243300001130     C                   MOVE      BLPAAS        I63AAS
243310001130     C                   MOVE      BLPLNP        I63LNP
243320001130     C                   MOVE      BLPNRS        I63NRS
243330001130     C                   MOVE      BLPNSP        I63NSP
243340001130     C                   MOVEL     DSLS63        KPJBU
243350001130     C                   CALL      'FNLS63R'
243360001130     C                   PARM                    KPJBA
243370001130     C                   MOVE      WA256         KPJBU
243380081020     c                   clear                   trtc86drds
243390081020     c* richiamo pgm per cancellare eventuali record su firab
243400081020     c                   eval      i86mod='DC'
243410081020     c                   z-add     blpaas        i86aasb
243420081020     c                   z-add     blplnp        i86lnpb
243430081020     c                   z-add     blpnrs        i86nrsb
243440081020     c                   z-add     blpnsp        i86nspb
243450081020     c                   call      'TRTC86DRR'
243460081020     c                   parm                    trtc86drds
243470060210     c*
243480070514     c* OPERAZIONI PER PREPAGATI
243490070514     c****               if        *in22 = *on and dateu >= §vpogpp
243500070514     c                   if        *in22 = *on
243510060210     C                   exsr      sr_aggblp
243520060210     c                   endif
243530910807     C*
243540060210     C     e_del         ENDSR
243550060210     C*--- Operazioni su spunte e anomalie a fronte di f16=Annullam --*
243560060210     C     sr_gesbranm   BEGSR
243570060210     C* LEGGO FNBLT SE ESISTE
243580060210     C                   MOVEL     5             KNPG
243590060210     C                   MOVEL     SIMFEL        KFLE
243600060210     C*
243610120817     C***  KBLP3         SETLL     FNBLT000                               30
243620120817     C     KBLP3         SETLL     FIART000                               30
243630060210    1C     *IN30         IFEQ      *ON
243640120817     C***  KBLP3         READE(N)  FNBLT000                               30
243650120817     C     KBLP3         READE(N)  FIART000                               30
243660060210    2C     *IN30         DOWEQ     *OFF
243670110321   2ac                   if        wcheck=*on
243680120817     C***  KBRV          setll     FNBRV000
243690120817     C     KBRVA         setll     FNBRV000
243700110321     c                   if        %equal(fnbrv09l)
243710110321     c                   seton                                        90
243720110321     c                   leavesr
243730110321     c                   endif
243740110321  x2ac                   else
243750060210     C* SPUNTE ENTRATA
243760120817     C***  KBRV          CHAIN     FNBRV000                           31
243770120817     C     KBRVA         CHAIN     FNBRV000                           31
243780060210    3C     *IN31         DOWEQ     *OFF
243790060210     c* richiamo fnlsa8r per effettuare tutti gli aggiornamenti necessari a
243800060210     c* fronte di cancellazione spunta. Lo tengo asteriscato perchè anche
243810060210     c* se di regola è logico richiamarlo di fatto in questa fase non esisto
243820060210     c* no anomalie da cancellare create a fronte della spunta entrata
243830060210     c**                 z-add     brvnfv        wrvnfv
243840060210     c**                 movel     param2        kpjbu
243850060210     C**                 CALL      'FNLSA8R'
243860060210     C**                 PARM                    KPJBA
243870070123     C                   DELETE    FNBRV000
243880120817     C***  KBRV          READE     FNBRV000                               31
243890120817     C     KBRVA         READE     FNBRV000                               31
243900060210    3C                   ENDDO
243910060210     c* se presenti anomalie con key segnacollo aventi anche la spedizione
243920060210     C* le aggiorno togliendo i dati della spedizione se invece si tratta
243930060210     c* di anomalie  con key spedizione aventi anche il segnacollo le deleto
243940060210     c     kanm2         setll     fnanm02l
243950060210    3c                   do        *hival
243960060210     c     kanm2         reade     fnanm02l
243970060210    4c                   if        %eof(fnanm02l)
243980060210     c                   leave
243990060210    4c                   endif
244000060210     c                   movel     '7C'          cod
244010060210     c                   movel(p)  anmcaa        key
244020060210     C                   EXSR      CTABEL
244030060210     C                   MOVEL     TBLUNI        DS7C
244040060210    4c                   if        §7ckey = 'S'
244050060210     c                   clear                   anmaas
244060060210     c                   clear                   anmlnp
244070060210     c                   clear                   anmnsp
244080060210     c                   update    fnanm000
244090060210   x4c                   else
244100060210     c                   delete    fnanm000
244110060210    4c                   endif
244120060210    3c                   enddo
244130060210     C*
244140110321   2ac                   endif
244150110321     c*
244160120817     C***  KBLP3         READE(N)  FNBLT000                               30
244170120817     C     KBLP3         READE(N)  FIART000                               30
244180060210    2C                   ENDDO
244190060210    1C                   ENDIF
244200060210     c* leggo eventuali anomalie rimaste con key spedizione e se ce ne sono
244210060210     c* le deleto
244220110321     c                   if        wcheck=*off
244230060210     c     kanm1         setll     fnanm01l
244240060210    1c                   do        *hival
244250060210     c     kanm1         reade     fnanm01l
244260060210     c                   if        %eof(fnanm01l)
244270060210     c                   leave
244280060210     c                   endif
244290060210     c                   delete    fnanm01
244300060210    1c                   enddo
244310110321     c                   endif
244320060210     c                   endsr
244330060210     C*--- Operazioni aggiornamento fnblp  a fronte di f16 su prepagato
244340060210     C     sr_aggblp     BEGSR
244350060210     c                   z-add     dateu         blpdrt
244360060210     c                   z-add     999           blppdr
244370060210     C                   eval      BLPFPP = 'P'
244380060214     c                   movel     'N'           blpft1
244390060214     c                   movel     'N'           blpft2
244400060210     C                   MOVEL     *ALL'9'       BLPNFV
244410060210     C                   MOVEL     '4 '          BLPctm
244420060210     c                   movel     'M '          blpcbo
244430060303     c* azzero importo da assicurare altrimenti in ricezione bolle in sede
244440060303     c* scrive fiar4 trk "c" e fiarbt0e
244450060303     c                   clear                   blpias
244460060303     c                   clear                   blpvas
244470060210     c                   update    fnblp000
244480060210     c                   endsr
244490900824     C*
244500900824     C*--- CARICO RECORD BOLEL DA DISK CLIENTI -----------------------*
244510900824     C     CARBLC        BEGSR
244520100319     c                   clear                   WesORE            1
244530100319     c                   clear                   DoreGEN
244540140122     C***                CLEAR                   DSBL4J
244550980115     C                   MOVEL     CMAIUS        MA               26
244560980115     C                   MOVEL     CMINUS        MI               26
244570000124     C* SPIEGO IL SIGNIFICATO DEL FLAG §LPFPR:
244580950419     C* - SE "V" - VISUALIZZO SEMPRE LA BOLLA CHE CONFERMO
244590950419     C* - SE "X" - VISUALIZZO SOLO SE C'E' ERRORE
244600950419     C* - SE "W" - NON VISUALIZZO MAI MA PASSO CODICE DI ERRORE
244610950419     C*
244620930630     C                   MOVEL     *OFF          *INKL
244630930630     C                   MOVEL     *OFF          *INKC
244640930630     C                   MOVEL     *OFF          *INKI
244650930630     C                   MOVEL     *OFF          *INKF
244660940927     C*
244670940921     C                   Z-ADD     0             WKSC
244680091221     c                   clear                   wvidgma
244690100604     c                   clear                   w7rRC
244700141202     c                   clear                   w7rPC
244710160225     c                   clear                   w_adpd
244720940927     C* D A T E
244730910702     C* DATA SPEDIZIONE
244740940926     C                   Z-ADD     §LPMGS        BLPDSP
244750940926     C                   MOVEL     §LPAAS        BLPDSP
244760970512     C*
244770970512     C* LA LINEA DI PARTENZA E' QUELLA DEL CODICE AUTOTRASP.
244780970512     C                   MOVEL     §LPPDR        VIDLNP
244790971216     C     VIDLNP        IFNE      BLCLNP
244800971216     C                   Z-ADD     VIDLNP        W0030
244810971216     C     W0030         CHAIN     AZORG01L      UNIORG               30
244820000508     C                   MOVEL     ORGDE3        OG143
244830971216     C                   MOVEL     VIDLNP        BLCLNP
244840971216     C                   ENDIF
244850941011     C*
244860940927     C* DATA CONSEGNA RICHIESTA
244870940927     C                   Z-ADD     §LPDCR        VIDDCR
244880941011     C* SIGLA OPERATORE VIDEO
244890941011     C                   MOVEL     §LPSOP        VIDSOP
244900960926     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
244910941011     C                   Z-ADD     §LPDRT        VIDDRT
244920940927     C                   MOVEL     §LPNRT        VIDNRT
244930940927     C                   MOVEL     §LPFPP        VIDFPP
244940010220     C                   MOVEL     §LPFPP        PREFPP
244950900824     C*
244960941011     C                   MOVEL     §LPPDR        W0030
244970960927     C     W0030         IFNE      VIDLNP
244980941011     C                   CLEAR                   VIDPDR
244990010220     C                   CLEAR                   PREPDR
245000941011     C                   ELSE
245010941011     C                   MOVE      §LPPDR        VIDPDR
245020010220     C                   MOVE      §LPPDR        PREPDR
245030941011     C                   ENDIF
245040010212     C* NUMERO O.R.M.
245050010220     C* SE RICHIAMATO DA PGM GIACENZE IMPOSTO NUMERO ORM FITTIZIO
245060020522     c* idem se richiamato da pgm ritiri annullati
245070150302     c* idem se richiamato da Gestione Bancali
245080010220     C     §LPFPR        IFEQ      'G'
245090010220     C     §LPFPR        OREQ      'I'
245100010220     C     §LPFPR        OREQ      'P'
245110020522     C     §LPFPR        OREQ      'T'
245120150302     C     §LPFPR        OREQ      'B'
245130010220     C                   MOVEL     §LPPDR        W0030             3 0
245140010220     C     W0030         CHAIN     AZORG01L      UNIORG               30
245150010220     C  N30              MOVEL     ORGDE8        OG148
245160010220     C   30              CLEAR                   OG148
245170060926     c* faccio finta che abbia sempre la procedura ORM attiva
245180060926     c                   eval      §ogorm='S'
245190060926     c
245200010220     C     §OGORM        IFEQ      'S'
245210010220     C                   MOVEL     §LPPDR        VIDPOE
245220010220     C                   MOVE      *ALL'9'       VIDNOR
245230010220     C                   MOVE      *ALL'9'       VIDNRV
245240010220     C                   ELSE
245250010220     C                   MOVE      *ZEROS        VIDPOE
245260010220     C                   MOVE      *ZEROS        VIDNOR
245270010220     C                   MOVE      *ZEROS        VIDNRV
245280010220     C                   ENDIF
245290011126     C                   CLEAR                   ATRDES
245300150303     c*
245310150303     c                   if        §lpfpr='B'
245320150303     c                   movel     prot          atrdes
245330150303     c                   endif
245340010220     C                   ELSE
245350010212     C                   Z-ADD     §LPPOE        VIDPOE
245360010222     C                   MOVEL     §LPNSR        VIDNOR
245370010222     C                   MOVE      §LPNOR        VIDNOR
245380010212     C                   Z-ADD     §LPNRV        VIDNRV
245390011126     C* CHAINO SUBITO ORM PERCHE' DEVO VEDERE SE PROTEGGERE DESTINATARI
245400011126     C                   Z-ADD     VIDPOE        WOPOE
245410011126     C                   Z-ADD     VIDNOR        WONOR
245420011126     C                   Z-ADD     VIDNRV        WONRV
245430011126     C                   Z-ADD     VIDLNP        WOLNP
245440011126     C                   CLEAR                   DORM01
245450011126     C     KORM          CHAIN     FNORM01L                           30
245460011126     C  N30              MOVEL     ORMFLO        DORM01
245470011126     C     §ORMFD        IFEQ      'S'
245480011126     C                   MOVEL     PROT          ATRDES
245490011126     C                   ELSE
245500011126     C                   CLEAR                   ATRDES
245510011126     C                   ENDIF
245520111209     c* se sull'orm sono presenti le note le visualizzo subito
245530111209     c                   if        not *in30 and
245540111209     c                             (ormno1<> *blanks or ormno2<>*blanks)
245550111209     c                             and (vidno1<>ormno1 or vidno2<>ormno2)
245560120127     c                   movel     ormno1        vidno1
245570120127     c                   movel     ormno2        vidno2
245580120127     c                   movel     'NoteOrm'     viddno
245590111209     c                   endif
245600010220     C                   ENDIF
245610100319     c
245620010212     C                   MOVEL     VIDORM        W01ORM
245630940927     C* CODICE BOLLA
245640940926     C                   MOVEL     §LPCBO        VIDCBO
245650940929     C* PARTITA IVA
245660940929     C                   MOVEL     §LPCPI        WPIVA
245670011206     C*
245680011206     C* IMPOSTO IL CODICE CLIENTE MITTENTE
245690011206     C                   MOVE      §LPCCN        WKSC
245700011206     C                   MOVE      §LPCCN        VIDCCM
245710011206     C                   MOVE      §LPCCN        WCCMS
245720011206     C                   MOVEL     §LPCCN        W0030
245730011206     C* CODICE TRATTAMENTO MERCE
245740011206     C                   MOVEL     §LPCTM        VIDCTM
245750011206     C                   MOVEL     VIDCTM        WCTM
245760011206     C                   EXSR      CTRCTM
245770011206     C* SE TROVATO ERRORE DOPO LO FACCIO RICONTROLLARE
245780011206     C     *IN90         IFEQ      *ON
245790120903     c     vidctm        oreq      *blanks
245800011206     C                   SETOFF                                       90
245810011206     C                   CLEAR                   SAVCTM
245820011206     C                   CLEAR                   DS1B
245830011206     C                   ENDIF
245840940927     C* LINEA ARRIVO
245850020621     C     §1BFG1        IFeq      'S'
245860140506     C     §1BF12        andne     'B'
245870020320     c     §1bf14        oreq      'S'
245880140506     C     §1BF12        andne     'B'
245890980126     C     §LPFPR        OREQ      'G'
245900980126     C     §LPFPR        OREQ      'P'
245910980126     C     §LPFPR        OREQ      'I'
245920150302     C     §LPFPR        OREQ      'B'
245930011206     C* SE DISK "C" EX DISK "B" LNA E ZNC DEVONO RIMANERE = 0
245940140506     C***  §1BF12        IFNE      'B'
245950911031     C                   MOVEL     §LPLNA        VIDLNA
245960980126     C                   MOVEL     §LPZNC        VIDZNC
245970140506     C***                ENDIF
245980980126     C                   ENDIF
245990970512     C*
246000970512     C* SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
246010970512     C*  BOLLA --> ABILIT' LA FILIALE CLIENTE
246020970512     C     W0030         IFNE      VIDLNP
246030970512     C                   SETON                                        1438
246040970512     C                   MOVEL     W0030         VIDFLC
246050970512     C                   ENDIF
246060940929     C* DATI FATTURA
246070940929     C                   MOVEL     §LPCEI        VIDCEI
246080940929     C                   MOVEL     §LPNFT        VIDNFT
246090940929     C                   MOVEL     §LPFIV        VIDFIV
246100940929     C                   Z-ADD     §LPDFT        VIDDFT
246110080327     C* TIPO SERVIZIO: lo carichiamo solo se inseribile dal bollettista/clie
246120080327     C                   MOVEL     §LPTSP        VIDTSP
246130080327     C                   Z-ADD     1             C
246140080327     C     vidtsp        LOOKUP    TSP(C)                                 30
246150080327     c                   if        not *in30 or uts(C)<>'S'
246160080327     c                   clear                   vidtsp
246170080327     c                   endif
246180080327     c
246190941115     C* CONSEGNE PARTICOLARI
246200941115     C                   MOVEL     §LPTC1        VIDTC1
246210941115     C                   MOVEL     §LPTC2        VIDTC2
246220091001     C                   MOVEL     §LPTC1        sav_tc1
246230091001     C                   MOVEL     §LPTC2        sav_tc2
246240091001     c                   clear                   w_ar5tcp
246250940929     C*
246260940929     C* D E C O D I F I C H E   BOLLA
246270940927     C                   EXSR      DECBOL
246280030303
246290030303      * Controllo se proteggere o meno il campo del rif. mitt. alf.
246300080331      * Bolla non manutenzionabile proteggo (solo se rma <> blanks)
246310080331     c                   If        §3aucb = 'N'
246320080331     c                   if        §lprma<>*blanks
246330030304     c                   Movel     Prot1         AtrRma
246340030304     c                   Eval      wrma = 's'
246350080331     c                   endif
246360030303     c                   Else
246370030303      * Provengo da giacenze e il p.o. del cliente è DPD proteggo
246380030303     c                   If        (§lpfpr = 'P' or §lpfpr = 'G')
246390060627     C                   MOVEL     OG143         SAV143
246400030303     c                   Clear                   og143
246410060627     c     w0030         Chain     Azorg01l      uniorg
246420030303     c                   If        %Found(Azorg01l)
246430030303     c                   Movel     orgde3        og143
246440030303     c                   Endif
246450030303     c                   If        §Ogntw = 'DPD'
246460030304     c                   Movel     Prot1         AtrRma
246470030304     c                   Eval      wrma = 's'
246480030303     c                   EndIf
246490060627     C                   MOVEL     SAV143        OG143
246500030303     c                   Endif
246510030303     c                   Endif
246520081014     C** Memorizzo se per il cliente del vab si gestisce il raggruppamento
246530081014     c** bolle
246540081014     C                   CLEAR                   DS3C
246550081014     C                   MOVEL     '3C'          COD
246560081014     C                   MOVEL(P)  §lpccm        KEY
246570081014     C                   EXSR      CTABEL
246580081014     C  N30              MOVEL     TBLUNI        DS3C
246590081014     c                   eval      §3cabd_s=§3cabd
246600980310     C* CARICO LA DS3C DEL CLIENTE PER VEDERE SE MANTIENE IL NUMERO
246610060216     C*  DI SPEDIZIONE PER VEDERE SE CHAINARE RECORD E DI ar4
246620980310     C                   CLEAR                   DS3C
246630980310     C                   MOVEL     '3C'          COD
246640980310     C                   MOVEL(P)  WKSC          KEY
246650980310     C*
246660980310     C                   EXSR      CTABEL
246670980310     C  N30              MOVEL     TBLUNI        DS3C
246680971222     C* VEDO SE ESISTE NUMERO AWB SEMPRE PERCHE' POTREBBE ESSERE SBAGLI
246690971222     C*  ATA LA LNA SULLA BOLLA
246700980310     C     §3CFSP        IFEQ      'S'
246710060216     C     KBLC4         CHAIN(N)  Fiar4000                           30
246720971216     C     *IN30         IFEQ      *OFF
246730060216     C                   MOVEL     ar4NOT        DSBL4E
246740971216     C                   MOVEL     §B4ERP        W010A            10
246750971216     C**
246760971216     C     W010A         IFGT      *ZEROS
246770020208     C                   MOVEL     §B4ERP        v6cawb
246780971216     C                   MOVEL     §B4ERP        SAVAWB
246790971216     C                   ENDIF
246800971222     C                   ENDIF
246810980310     C                   ENDIF
246820110818     c* FLAG ACCORPAMENTO SPEDIZIONI in consegna
246830110818     c* Se cliente abilitato al passaggio del flag accorpamento sped.
246840110818     c* verifico in tabella XCO se flag valido:
246850110818     c* - memorizzo errore, se flag non valido
246860110818     c* - memorizzo il dato nel campo wxco, se flag valido
246870110901     c* - memorizzo se si devee inviare messaggio al ced
246880050114     c                   clear                   wxco
246890110818     c                   eval      werrxco=*off
246900050114    1c                   if        §lpxco <> *blanks
246910050114    2c                   if        §3caus = 'S'
246920050114     C                   CLEAR                   dsbs02
246930110818     c                   clear                   dxco
246940050114     C                   MOVEL     'C'           T02MOD
246950050114     C                   MOVEL     KNSIF         T02SIF
246960110818     C                   MOVEL     'XCO'         T02COD
246970110818     c                   movel(P)  'XCO'         t02ke1
246980050114     c                   call      'TIBS02R'
246990050114     C                   PARM                    KPJBA
247000050114     C                   PARM                    dsbs02
247010050114    3C                   IF        T02ERR = *BLANKS
247020110818     C                   MOVEL     T02uni        dxco
247030050114    3C                   ENDIF
247040110901     c* Se valore non presente in tabella:
247050110901     c* memorizzo che devo inviare email a CED
247060110818    3c                   if        %lookup(§lpxco:vaa)=0
247070160108     c****               eval      werrxco=*on
247080110901     c* e se il valore è numerico>0 lo mantengo comunque
247090110901     c                   if        §lpxco>'0'
247100160108     c****               eval      wxco = §lpxco
247110110901     c                   endif
247120110818     c                   else
247130110901     c* Se valore presente in tabella  ---> tutto ok
247140110818     c                   eval      wxco = §lpxco
247150110818    3c                   endif
247160050114    2c                   endif
247170050114    1c                   endif
247180050114     c*
247190000214     C* VEDO SE DISK 'C'
247200911031     C*
247210940926     C* MITTENTE
247220020507     C* SE 8888 O 9999
247230941010    1C     VIDCCM        IFEQ      8888
247240940926     C     VIDCCM        OREQ      9999
247250980115     C                   MOVEL     §LPRSM        VIDRSM
247260911031     C                   MOVEL     §LPINM        VIDINM
247270911031     C                   MOVEL     §LPLOM        VIDLOM
247280911031     C                   MOVEL     §LPCAM        VIDCAM
247290920130     C                   MOVEL     §LPPRM        VIDPRM
247300940926     C                   MOVEL     §LPNZM        VIDNZM
247310941010     C*
247320941010   X1C                   ELSE
247330941010     C*
247340941010     C* SE CODIFICATO E §LPCAM E §LPNZM SONO PIENI, CONTROLLO CON CNIND
247350941010    2C     §LPCAM        IFNE      *BLANKS
247360941010     C     §LPNZM        ORNE      *BLANKS
247370950529     C                   Z-ADD     KCI           CCC
247380941010     C     KACO          CHAIN     CNIND000                           30
247390941010     C*
247400941010    3C     *IN30         IFEQ      *OFF
247410941010    4C     INDCAE        IFNE      §LPCAM
247420941010     C     INDSTA        ORNE      §LPNZM
247430941010     C                   MOVEL     §LPCAM        VIDCMO
247440941010     C                   MOVEL     §LPNZM        VIDNMO
247450941010    4C                   ENDIF
247460941010    3C                   ENDIF
247470941010    2C                   ENDIF
247480941010     C*
247490941010    1C                   ENDIF
247500941010     C*
247510940926     C                   MOVEL     *BLANKS       VIDFAP
247520940927     C                   MOVEL     *BLANKS       VIDFIN
247530911031     C*
247540980115     C                   MOVEL     §LPRSD        VIDRSD
247550980115     C                   MOVE      §LPRD2        VIDRSD
247560980115     C     MI:MA         XLATE     VIDRSD        VIDRSD
247570980115     C     MI:MA         XLATE     §LPIND        VIDIND
247580980115     C     MI:MA         XLATE     §LPPRD        VIDPRD
247590980115     C     MI:MA         XLATE     §LPCAD        VIDCAD
247600980115     C     MI:MA         XLATE     §LPLOD        VIDLOD
247610980115     C     MI:MA         XLATE     §LPNZD        VIDNZD
247620160112     c* eseguo routine per eliminare caratteri non ammessi come da tabella "CSP"
247630160112     c* nella località
247640140211     c                   eval      wtxt=vidlod
247650160112     c* per i caratteri non ammessi in tutto il campo richiamo XCHKCHAR
247660160112     c                   eval      ElencoChar=charnook
247670160112     c                   eval      TipoElenco='1'
247680160112     c                   clear                   UpperCase
247690160112     c                   exsr      sr_chk
247700160112     c* richiamo routine "chkstringa" per i carattri non ammessi all'inizio e
247710160112     c* alla  fine
247720140211     c                   exsr      chkstringa
247730140211     c                   movel     wtxt          vidlod
247740070404     c                   movel     vidrsd        savrsd
247750070404     c                   movel     vidind        savind
247760070404     c                   movel     vidprd        savprd
247770070404     c                   movel     vidcad        savcad
247780070404     c                   movel     vidlod        savlod
247790070404     c                   movel     vidnzd        nzdini
247800910204     C*
247810940927     C                   MOVEL     §LPCCN        SAVMIT
247820900824     C*
247830980115     C     MI:MA         XLATE     §LPGC1        VIDGC1
247840980115     C     MI:MA         XLATE     §LPGC2        VIDGC2
247850911031     C                   MOVEL     §LPFTM        VIDFTM
247860940927     C                   MOVEL     §LPQFT        VIDQFT
247870940927     C                   MOVEL     §LPIAS        VIDIAS
247880940926     C                   MOVEL     §LPVAS        VIDVAS
247890950517     C                   MOVEL     §LPVAS        VARVAS
247900940926     C                   MOVEL     §LPVMD        VIDVMD
247910940926     C                   MOVEL     §LPVAD        VIDVAD
247920950517     C                   MOVEL     §LPVAD        VARVAD
247930911031     C                   MOVEL     §LPNAS        VIDNAS
247940040610     C                   MOVEL     §LPbva        VIDbva
247950940819     C                   MOVEL     §LPNCL        V1CNCL
247960930401     C                   MOVEL     §LPNCL        SAVNCL
247970930401     C                   MOVEL     §LPNCL        VIDNCL
247980940926     C                   Z-ADD     §LPPKB        VIDPKG
247990940926     C                   Z-ADD     §LPPKB        V2CPKG
248000980402     C                   Z-ADD     0             SAVPKG
248010940926     C                   Z-ADD     §LPVLB        VIDVOL
248020980402     C                   Z-ADD     0             SAVVOL
248030940926     C                   MOVEL     §LPCAS        VIDCAS
248040110519     C     mi:ma         xlate     §LPVCA        VIDVCA
248050110519     C     mi:ma         xlate     §LPVCA        VARVCA
248060911031     C                   MOVEL     §LPTIC        VIDTIC
248070900824     C*
248080911031     C                   MOVEL     §LPRMN        VIDRMN
248090940926     C                   MOVEL     §LPRMA        VIDRMA
248100911031     C                   MOVEL     §LPRMO        VIDRMO
248110091008     C                   MOVEL     '1'           WOVUO1
248120060627     c* se lnp dpd metto rmn in nrd
248130060628     c                   if        §ogntw='DPD' and §3arbl <> 'R'
248140060628     c                   movel     §lpnpr        vidnrd
248150060628     c                   endif
248160900824     C* CONTROLLO SE POSIZIONARMI SU SEGNACOLLO O SU VOLUME
248170911031     C     §LPNCD        IFEQ      0
248180931123     C                   SETOFF                                       36
248190900824     C                   ELSE
248200900827     C                   SETON                                        36
248210900824     C                   END
248220940926     C                   MOVEL     §LPNOT        VIDNT1
248230940926     C                   MOVEL     §LPNT2        VIDNT2
248240910129     C* CODICE TRATTAMENTO MERCE
248250011206     C* QUESTE SPECIFICHE LE HO SPOSTATE PRIMA DELL'IMPOSTAZIONE DI VID
248260011206     C* LNA PERCHE' MI SERVIVA IL CONTENUTO DI §1BF12
248270950504     C*
248280910805     C                   MOVEL     *ZEROS        VIDNCD
248290910805     C                   MOVEL     *ZEROS        VIDNCA
248300921005     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
248310920203     C     §LPFPR        IFEQ      'G'
248320941230     C                   MOVEL     §LPFPR        WFPR              1
248330920203     C                   MOVEL     §LPNCD        VIDNCD
248340920203     C                   MOVEL     §LPNCA        VIDNCA
248350920203     C                   MOVEL     'V'           §LPFPR
248360950420     C                   SETON                                        8744
248370011029     C                   MOVEL     PROT          ATRFTM
248380970328     C     §LPBAM        IFEQ      ' '
248390970328     C                   MOVEL     'S'           §LPBAM
248400920203     C                   END
248410970328     C                   END
248420941230     C* SE PROGRAMMA VIENE DA GIACENZE PRENDO SEGNACOLLI SE PASSATI
248430941230     C* IN QUESTO CASO NON MI FERMO SULLA BOLLA E NON LA STAMPO
248440941230     C     §LPFPR        IFEQ      'P'
248450941230     C                   MOVEL     §LPFPR        WFPR              1
248460941230     C                   MOVEL     §LPNCD        VIDNCD
248470941230     C                   MOVEL     §LPNCA        VIDNCA
248480941230     C                   MOVEL     'X'           §LPFPR
248490950420     C                   SETON                                        8744
248500011029     C                   MOVEL     PROT          ATRFTM
248510970328     C     §LPBAM        IFEQ      ' '
248520970328     C                   MOVEL     'S'           §LPBAM
248530970328     C                   END
248540941230     C                   END
248550921029     C* CREO BOLLA PER INVIO DISPOSIZIONI MITTENTE AI CLIENTI
248560921029     C     §LPFPR        IFEQ      'I'
248570921029     C                   MOVEL     'X'           §LPFPR
248580940222     C                   MOVEL     'I'           WFPR
248590011029     C                   SETON                                        87
248600011029     C                   MOVEL     PROT          ATRFTM
248610921029     C                   END
248620020522     C     §LPFPR        IFEQ      'T'
248630030609      * se sto creando una bolla "FT" x ORM commissionati
248640030609      * devo impostare §lpfpr = 'X' e proteggere la lna
248650030609    2c                   If        §lpCbo = 'FT'
248660030609     c                   Eval      §lpFpr = 'X'
248670030609     c                   Movel     Prot1         AtrLna
248680030609    xc                   Else
248690020522     C                   MOVEL     'V'           §LPFPR
248700030609    2c                   EndIf
248710020522     c                   endif
248720150302     C* SE PROGRAMMA VIENE DA Gest.Bancali
248730150302     C     §LPFPR        IFEQ      'B'
248740150302     C                   SETON                                        44
248750150302     C                   MOVEL     PROT          ATRFTM
248760150302     C                   MOVEL     PROT          ATRnt1
248770150302     C                   MOVEL     PROT          ATRnt2
248780150302     C                   MOVEL     PROT          ATRncl
248790150302     C                   MOVEL     PROT          ATRpkg
248800150302     C                   MOVEL     PROT          ATRncl2
248810150302     C                   MOVEL     PROT          ATRpkg2
248820150302     C                   MOVEL     'V'           §LPFPR
248830150302     C                   END
248840910208     C* SOLO CON FLAG6=C PRENDO I SEGNACOLLI SE NO COMUNQUE LI AZZERO
248850910208     C     §1BFG6        IFEQ      'C'
248860911031     C                   MOVEL     §LPNCD        VIDNCD
248870911031     C                   MOVEL     §LPNCA        VIDNCA
248880920204     C                   END
248890910805     C* SE FLAG7=S ABILITO TASTO PER GESTIONE DETT. STAMPA SEGNACOLLI
248900910805     C     §1BFG7        IFEQ      'S'
248910020917     C* Se DISKC non devo abilitare l'F21 di manutenzione fivad
248920001016     C     §1BF12        IFEQ      'N'
248930001106     C     §1BF12        OREQ      'E'
248940001106     C     WASDKC        ANDNE     'S'
248950910805     C                   SETON                                        94
248960001016     C                   ENDIF
248970910805     C* SE VI3FNS=S -> C'E' SEGNACOLLO E NON CODICE PRODOTTO
248980020917     C     KBLC          SETLL     FIVAD000
248990020917     C     KBLC          READE(N)  FIVAD000                               31
249000910805     C  N31BLDNCD        IFGT      0
249010920204     C     BLDCDP        ANDEQ     *BLANKS
249020910805     C                   MOVEL     'S'           VI3FNS
249030910805     C                   END
249040910805     C                   END
249050910220     C*
249060120903     C***  §1BFG2        IFNE      'N'
249070120903     C***  §LPFPR        OREQ      'R'
249080120903     C     §1BFG2        IFeq      'S'
249090921005     C                   MOVEL     §LPNSP        VIDNSP
249100921005     C                   MOVEL     §LPNRS        VIDNRS
249110921005     C                   ELSE
249120910129     C                   Z-ADD     0             VIDNSP
249130910129     C                   Z-ADD     0             VIDNRS
249140000829     C                   END
249150050222     C* SE NAZIONE DESTINATARIO ESTERA,
249160050222     C* CONTROLLO IL COD.TARIFFA PER SAPERE SE E' TRAFFICO DPD
249170050222     C                   MOVEL     '15'          COD
249180050222     C                   MOVEL(P)  VIDNZD        KEY
249190050222     C                   EXSR      CTABEL
249200050222     C   30              CLEAR                   DS15
249210050222     C  N30              MOVEL     TBLUNI        DS15
249220050222     C*
249230050222    1C     §15ITA        IFNE      'I'
249240050222     C                   MOVE      WKSC          W0040
249250050222     C*
249260050222     C* SE CLIENTE CODIFICATO, FACCIO COME ADESSO
249270050222     C* SE CLIENTE NON CODIFICATO MA COD.TRATTAMENTO MERCE PER DPD,
249280050222     C*   E LNA DPD, CONSIDERO LO STESSO IL RIF.MITTENTE
249290050222   1AC     W0040         IFEQ      8888
249300050222     C     W0040         OREQ      9999
249310050222     C     VIDLNA        IFGT      *ZEROS
249320050222     C     A_§OGNTW      ANDEQ     'DPD'
249330050222     C                   MOVEL     'D'           VIDDPD
249340050222     C*
249350050222     c                   select
249360050222    5C     §1BF13        wheneq    'R'
249370060628     c                   movel     §lpnpr        vidnrd
249380050222    5C     §1BF13        wheneq    *blanks
249390050222     c                   exsr      sr_vatdpd
249400060612     c                   movel     w014a         vidnrd
249410050222     C                   ENDsl
249420050222     c                   else
249430050222     c     vidlna        ifgt      *zeros
249440050222     c     A_§ogntw      andeq     'FED'
249450050222     c                   movel     'F'           viddpd
249460050222     c                   endif
249470050222     C                   ENDIF
249480050222     C*
249490050222  X1AC                   ELSE
249500050222     C*
249510050921     c                   clear                   fnlv59ds
249520050921     C                   MOVEL     'P'           ilv59tbo
249530050222      * se bolla monovaria pulisco il tipo bolla
249540050222     C                   IF        §3ASVA <> *BLANK
249550050921     C                   CLEAR                   ilv59tbo
249560050921     C                   movel     'P'           ilv59prp
249570050222     C                   ENDIF
249580050222
249590050921     C                   MOVEL     WKSC          ilv59KSC
249600050921     C                   MOVEL     KCI           ilv59KCI
249610050921     C                   MOVEL     BLPDSP        ilv59DSP
249620050921     C                   MOVEL     VIDTSP        ilv59TSP
249630050921     C                   MOVEL     §LPCTR        ilv59CTR
249640050921     C                   MOVEL     'S'           ilv59RIC
249650050921     C                   MOVEL     'S'           ilv59CON
249660050222     C* CONTROLLO TRA LE TARIFFE ESTERE E ITALIADPD
249670050921     C                   MOVEL     'S'           ilv59FIE
249680150415
249690150415     c                   if        savfpr<>' '
249700150415     C                   EVAL      ILV59blo='S'
249710150415     c                   endif
249720150415
249730050921     C                   CALL      'FNLV59R'
249740050921     C                   PARM                    fnlv59ds
249750050222     C*
249760050222     C* SE NON HO TROVATO LA TARIFFA DEL CLIENTE PRENDOPRG
249770050921    2C     olv59err      IFEQ      ' '
249780050921     C     olv59tks      ANDEQ     'S'
249790050921     C                   MOVEL     olv59prg      COMPRG
249800050222     C                   MOVEL     §LPCTR        COMCTR
249810050222     C     KTAM2         CHAIN     TNTAM000                           30
249820050222     C* TARIFFA VALIDA
249830050222    3C     *IN30         IFEQ      *OFF
249840050222     C     TAMATB        ANDEQ     ' '
249850050222     C                   MOVEL     TAMFLO        DSTA01
249860050222     C* TARIFFA DPD
249870050222    4C     §TADPD        IFEQ      'S'
249880050222     C                   MOVEL     'D'           VIDDPD
249890050222     c                   select
249900050222    5C     §1BF13        wheneq    'R'
249910060628     c                   movel     §lpnpr        vidnrd
249920050222    5C     §1BF13        wheneq    *blanks
249930050222     c                   exsr      sr_vatdpd
249940060612     c                   movel     w014a         vidnrd
249950050222    5C                   endsl
249960050222     c                   else
249970050222     c* tariffa fedex
249980050222     c     §tafed        ifeq      'S'
249990050222     c                   movel     'F'           viddpd
250000050222     c                   endif
250010050222    4C                   ENDIF
250020050222    3C                   ENDIF
250030050222    2C                   ENDIF
250040050222   1AC                   ENDIF
250050050222    1C                   ENDIF
250060000831     C* PER NO DISK "B" CONTROLLO SE DISK "C"
250070000904     C* Spengo indicatore per attivazione tasto funzionale di gestione
250080000904     c* cod. CHI SONO
250090000901     C                   SETOFF                                       96
250100000901    1C     §1BFG1        IFNE      'S'
250110000831     C     WASDKC        ANDEQ     'S'
250120000831     C* SE IMPORT DPD O COD.TRATTAMENTO MERCE CHE PREVEDE IL DISK C
250130000901    2C     §1BF12        IFNE      'N'
250140001013     C     §1BF12        ANDNE     ' '
250150020319     C     §OGNTW        OREQ      'DPD'
250160000919     C     §3CDKC        ANDEQ     'S'
250170000214     C                   MOVEL     ':'           VIDSOP
250180000901     C* Carico subfile prendendo il chi sono dal VAT oppure dal VAB/VAD
250190000901     C* in base al tipo di DISKC
250200050222     c* Non devo caricare il subfile se:
250210050222     c* 1) spedizione export dpd e numero parcel dpd = codice chi sono
250220050222     c* 2) spedizione import dpd
250230050222     c* in questi due casi infatti il cod.chi sono coincide col numero
250240050222     c* parcel dpd che viene già inserito in altro modo
250250051102     c* Sarà il pgm a tenerne conto per la scrittura di fisgn e FIARS
250260000901    3C     §1BF12        IFEQ      'E'
250270050222     c     viddpd        andne     'D'
250280050222     c     §ogntw        andne     'DPD'
250290050222     c     §1bf12        oreq      'E'
250300050222     c     viddpd        andeq     'D'
250310050222     c     §1bf13        andne     *blanks
250320030321      * se non ho superato i 500 colli
250330050222     c     V1cNcl        ifle      500
250340000829     C                   EXSR      CARVAT
250350000901     C                   SETON                                        96
250360000911     C     NR8           IFGT      0
250370000911     C                   SETON                                        78
250380000911     C                   ENDIF
250390050222     c                   endif
250400000901   X3C                   ELSE
250410000901    4C     §1BF12        IFEQ      'B'
250420030321      * se non ho superato i 500 colli
250430030321     c     V1cNcl        andle     500
250440140506     c* se vengo da dirottamenti carico da FIART altrimenti dal VAB
250450140506     c                   if        §lpnspm>0
250460140506     c                   exsr      CARART
250470140506     c                   else
250480000901     C                   EXSR      CARVAB
250490140506     c                   endif
250500000911     C     NR8           IFGT      0
250510000911     C                   SETON                                        78
250520000911     C                   ENDIF
250530000901     C                   SETON                                        96
250540050222     c                   else
250550050222     c* se import dpd e numero parcel nel fivat lo metto nel rmn
250560050222     c     §1bf12        ifeq      'E'
250570050222     c     §ogntw        andeq     'DPD'
250580050222     c                   exsr      sr_vatdpd
250590060612     c                   movel     w014a         vidnrd
250600060616     c                   seton                                        79
250610050222     c                   endif
250620000901    4C                   ENDIF
250630000901    3C                   ENDIF
250640000901    2C                   ENDIF
250650000901    1C                   ENDIF
250660001106     C*
250670001106     C* SE FLAG 12 = 'E' MA AS400 NON ABILITATO A DISK C CARICO LO
250680020917     C* STESSO SUBFILE PRENDENDO I DATI DA FIVAT
250690001106    1C     §1BFG1        IFNE      'S'
250700001106     C     WASDKC        ANDNE     'S'
250710001106     C     §1BF12        ANDEQ     'E'
250720030321      * se non ho superato i 500 colli
250730030321     c     V1cNcl        andle     500
250740050222     c     viddpd        ifne      'D'
250750050222     c     §ogntw        andne     'DPD'
250760050222     c     viddpd        oreq      'D'
250770050222     c     §1bf13        andne     *blanks
250780001106     C                   EXSR      CARVAT
250790001106     C                   SETON                                        96
250800001106     C     NR8           IFGT      0
250810001106     C                   SETON                                        78
250820001106     C                   ENDIF
250830050222     c                   endif
250840001106     C                   ENDIF
250850000831     C*
250860911031     C                   MOVEL     §LPFFD        VIDFFD
250870010214     C     §LPFFD        IFEQ      *BLANKS
250880010214     C                   MOVEL     'N'           VIDFFD
250890010214     C                   ENDIF
250900911031     C                   MOVEL     §LPTCR        VIDTCR
250910940927     C                   MOVEL     §LPHCR        VIDHCR
250920940927     C                   MOVE      §LPHCR        VIDMCR
250930150202     c* non tengo l'ora consegna richiesta del cliente
250940150202     c* se < 8:00 o > 20:00
250950150203     c* se h 10:30 se < 0800 o > 1030
250960150202     c                   if        §lphcr<0800 or
250970150203     c                             (vidtsp='H' and §lphcr>1030) or
250980150202     c                             §lphcr>2000
250990150202     c                   clear                   vidhcr
251000150202     c                   clear                   vidmcr
251010150202     c                   endif
251020150203     c
251030940927     C* MI SERVONO PER IL CONFRONTO PER SAPERE SE CAMBIARE O NO I CAMPI
251040940927     C   04              Z-ADD     §LPCCN        SAVCCM
251050941103     C  N04              Z-ADD     1             SAVCCM
251060920123     C*
251070920123     C                   MOVEL     §LPFBR        VIDFBR
251080031029     c                   Clear                   VidGca
251090940927     C                   MOVEL     §LPGGA        VIDGGA
251100940927     C                   MOVEL     §LPGMA        VIDGMA
251110091221     c                   eval      wvidgma = §lpgma
251120100604     c* Verifico se c'e' ritiro contestuale alla consegna
251130100604     c                   clear                   ds7r
251140100604     C                   MOVEL     '7R'          COD
251150100604     C                   MOVEL(P)  §lpGMA        KEY
251160100604     C                   EXSR      CTABEL
251170100604     C  n30              MOVEL     TBLUNI        DS7R
251180100604     c                   eval      w7rRC = §7rRC
251190141202     c                   eval      w7rPC = §7rpincode
251200100604     c
251210940927     C                   MOVEL     §LPGVA        VIDGVA
251220031029     c                   move      ' '           VidGva
251230920123     C                   MOVEL     §LPPOR        VIDPOR
251240940927     C                   MOVEL     §LPIMV        VIDIMV
251250991026     C                   MOVEL     §LPDIV        VIDDIV
251260970326     C* FLAG DDT S/N
251270970326     C     §LPBAM        IFNE      ' '
251280970328     C     §LPBAM        IFEQ      'S'
251290970328     C     §LPBAM        OREQ      'C'
251300060609     C     §LPBAM        OREQ      'P'
251310060609     C     §LPBAM        OREQ      'Q'
251320991007     C                   MOVEL     'S'           VIDBAM
251330970328     C                   ELSE
251340970328     C                   MOVEL     'N'           VIDBAM
251350970326     C                   ENDIF
251360970328     C                   ENDIF
251370020102     C* SE SONO RICHIAMATA DA PGM DELLE GIACENZE E HO DEGLI IMPORTI DI
251380020102     C* TASSAZIONE SENZA NUMERO FATTURA E LA DIVISA E' DIVERSA DA GE
251390020102     C* DCN MEMORIZZO CHE DEVO CARICARE LA VIDEATA CON GLI IMPORTI CON-
251400020102     C* VERTITI NELLA DIVISA DI CONTO DAL MOMENTO CHE PER §LPFPR = "G",
251410020102     C* "I" O "P" I DATI DI TASSAZIONE SONO PROTETTI ED IN CASO DI
251420020102     C* ERRORE DI DIVISA SCADUTA L'YENTE NON PUO' IN ALCUN MODO INTERVE
251430020102     C* NIRE PER CAMBIARE LA DIVISA
251440020102     C                   CLEAR                   WCONV
251450020102     C     WFPR          IFEQ      'G'
251460020102     C     WFPR          OREQ      'I'
251470020102     C     WFPR          OREQ      'P'
251480020102     C     VIDNFT        IFEQ      0
251490020102     C     VIDDIV        ANDNE     *BLANKS
251500020102     C     VIDDIV        ANDNE     §GEDCN
251510020102     C                   MOVEL     '1'           WCONV             1
251520020102     C                   ENDIF
251530020102     C                   ENDIF
251540940927     C* CARICO LE VARIE
251550940927     C                   Z-ADD     0             NRR
251560941108     C                   DO        20            C
251570991027     C                   MOVEL     VSV(C)        WSVN
251580991027     C                   Z-ADD     VVA(C)        WVAN
251590940927     C                   EXSR      CARVAR
251600020102      * CARICO SCHIERA VARIE X RICALCOLO TOT.IMPONIBILE
251610020102     C     WCONV         IFEQ      '1'
251620020102     C     VIDIMV        ANDGT     *ZEROS
251630020102     C                   MOVEL     V3CSV1        VSV(C)
251640020102     C                   Z-ADD     V3CVA1        VVA(C)
251650020102     C                   MOVEL     V3CEV1        VES(C)
251660020102     C                   ENDIF
251670941108     C                   ENDDO
251680020102     C* CONVERTO ANCHE PORTO E RICALCOLO EVENTUALMENTE IL TOTALE IMPO-
251690020102     C* NIBILE
251700020102    1C     WCONV         IFEQ      '1'
251710020102     C* PORTO
251720020102    2C     VIDPOR        IFGT      *ZEROS
251730020102     C                   CLEAR                   DSYEUR
251740020102     C                   MOVEL     VIDDIV        YECDVI
251750020102     C                   Z-ADD     VIDPOR        YECIMI
251760020102     C                   MOVEL     §GEDCN        YECDVO
251770020102     C     COMFDC        IFEQ      'S'
251780020102     C                   MOVEL     '3'           YECDCO
251790020102     C                   ELSE
251800020102     C                   MOVEL     '0'           YECDCO
251810020102     C                   ENDIF
251820020102     C                   CALL      'YEURCO'
251830020102     C                   PARM                    DSYEUR
251840020102    3C     YECESI        IFEQ      ' '
251850020102     C                   Z-ADD     YECIMO        VIDPOR
251860020102    3C                   ENDIF
251870020102    2C                   ENDIF
251880020102     C* TOTALE IMPONIBILE
251890020102    2C     VIDIMV        IFGT      *ZEROS
251900020102     C                   CLEAR                   DSLV16
251910020102     C                   MOVEL     'T'           D17FIM
251920020102     C                   Z-ADD     VIDPOR        D17POR
251930020102     C                   CALL      'FNLV16R'
251940020102     C                   PARM                    DSLV16
251950020102     C                   PARM                    DTASV
251960020102     C                   Z-ADD     O17IMV        VIDIMV
251970151014     C                   Z-ADD     O17IMV        savIMV_fat
251980020102    2C                   ENDIF
251990020102     C* DIVISA
252000020102     C                   MOVE      §GEDCN        VIDDIV
252010020102    1C                   ENDIF
252020020102     C                   CLEAR                   WCONV
252030940927     C*
252040940927     C* NUM TENTATIVI PER SUPERARE CONTROLLI FORZATI
252050940927     C     §LPFPR        IFNE      'V'
252060941021     C                   Z-ADD     1             NUMFOR
252070940927     C                   ELSE
252080940927     C                   Z-ADD     1             NUMFOR
252090940927     C                   ENDIF
252100941020     C*
252110941020     C*  VEDO SE RIEMETTERE IN AUTOMATICO SENZA CMD9 LA 3 VIDEATA
252120941020     C     VIDPOR        IFNE      0
252130941020     C     NRR           ORNE      0
252140941020     C     VIDCEI        ORNE      ' '
252150941020     C     VI2SV1        ORNE      ' '
252160040114     c     Vi2Sv2        orne      *Blanks
252170040114     c     Vi2Sv3        orne      *Blanks
252180040114     c     Vi2Sv4        orne      *Blanks
252190941020     C     VI2CEI        ORNE      ' '
252200941020     C                   MOVEL     'S'           WEMD03            1
252210941020    1C                   ENDIF
252220941011     C*
252230941011     C* VISUALIZZO IL NUMERO DI SPEDIZIONE CHE STO CONFERMANDO
252240941011     C                   Z-ADD     §LPNRS        PRENRS
252250941011     C                   Z-ADD     §LPNSP        PRENSP
252260941011     C                   MOVEL     §LPLNA        PRELNA
252270941011     C                   Z-ADD     §LPRMN        PRERMN
252280941011     C                   Z-ADD     §LPZNC        PREZNC
252290040506
252300040506      * Imposto la ds di comodo del n. spedizione
252310060222     c****               Z-add     VidLnp        WidLnp
252320060222     c                   Z-add     §lplnp        WidLnp
252330040506     c                   Z-add     §lpNrs        WidNrs
252340040506     c                   Z-add     §lpNsp        WidNsp
252350000124     C*
252360000508     C*
252370050114     C* SE LNP POSTE, MEMORIZZO A PARTE IAS, PER
252380060216     C*  MEMORIZZARLO NEL ar4 RECORD "J"
252390140122     C**   §ogntw        IFEQ      'PPT'
252400140122     C**                 Z-ADD     VIDIAS        §B4IAS
252410140122     C**                 MOVEL     VIDVAS        §B4VAS
252420140122     C**                 MOVEL     §LPDSK        §B4DSC
252430140122     c**                 clear                   §b4xco
252440140122     C**                 CLEAR                   VIDIAS
252450140122     C**                 CLEAR                   VIDVAS
252460140122     C**                 ENDIF
252470031125
252480021218      * Carico i dati relativi ai bancali
252490021220     c                   If        §LpTba > *Zeros
252500021218     c                   Movel     §LpTba        VidTba
252510021220     c                   EndIf
252520021218     c                   Eval      VidNba = §LpNba
252530030704     c                   Eval      SavNba = §LpNba
252540030224     c                   If        §LpTb2 > *Zeros
252550021218     c                   Movel     §LpTb2        VidTb2
252560021220     c                   EndIf
252570021218     c                   Eval      VidNb2 = §LpNb2
252580030704     c                   Eval      SavNba = §LpNb2
252590031125      * più quelli relativi ai colli sfusi e originali
252600031125     c                   Eval      w03Cor = §LpCor
252610031125     c                   Eval      w03Csf = §LpCsf
252620030409
252630030409      * Ore da sommare alla delivery
252640030409     c                   Move      §ore          VidOre
252650031125
252660031125      * carico i dati del telefono e del referente
252670031125     c                   Eval      VidRef = §LpRef
252680031125     c                   Eval      VidTel = §LpTel
252690031125
252700031125      * Imposto i campi dal FIVAT no record 'E'
252710031125     c                   ExSr      Sr_CarVat
252720031125      * Controllo quali dati dei bancali devo tenere
252730031126      * se non sono richiamta da giacenze
252740031126     c                   If        (savfpr <> 'P' and savfpr <> 'G')
252750031125     c                   ExSr      Sr_CtrBancali
252760031126     c                   EndIf
252770160323     c* Se spedizione import DPD memorizzo se si tratta di "VEDI PACCO"
252780160323     c                   clear                   w_vediP           1
252790160323     c                   if        §ogntw='DPD'
252800160323     c                   eval      dblp01=§lpflo
252810160323     c                   if        §lptrd='1'
252820160323     c                   eval      w_vediP='1'
252830160323     c                   endif
252840160323     c                   endif
252850021218
252860900824     C                   ENDSR
252870010301     C*
252880010301     C*--- CARICO RECORD BOLLE DA CONFERMA ORM PREPAGATI -------------*
252890010301     C     CARBLO        BEGSR
252900010301     C                   Z-ADD     §LPPOE        VIDPOE
252910010301     C                   MOVEL     §LPNSR        VIDNOR
252920010301     C                   MOVE      §LPNOR        VIDNOR
252930010301     C                   Z-ADD     §LPNRV        VIDNRV
252940010301     C                   Z-ADD     VIDORM        WIDORM
252950010924     C                   CLEAR                   DORM01
252960010301     C     KORM          CHAIN     FNORM01L                           30
252970010301     C                   Z-ADD     ORMPOR        VIDLNP
252980010301     C                   MOVEL     '1'           VIDCBO
252990010924     C                   MOVEL     ORMFLO        DORM01
253000011121     C* Proteggo i campi a video relativi il destinatario se devo forza
253010011121     C* re il destinatario da orm
253020011121     C     §ORMFD        IFEQ      'S'
253030011121     C                   MOVEL     PROT          ATRDES
253040011121     C                   ELSE
253050011121     C                   CLEAR                   ATRDES
253060011121     C                   ENDIF
253070010301     C                   EXSR      PRPOR1
253080010307     C* UNISCO TELEFONO E REFERENTE IN UN CAMPO DI COMODO CHE
253090010307     C* ANDRO' A PROPORRE NELLE NOTE
253100010307     C     'TEL.:'       CAT       ORMTER        W021A            21
253110010307     C     W021A         CAT(P)    ORMRER:1      WTELRF           70
253120010307     C                   MOVE      WTELRF        WTELR2           35
253130010301     C                   ENDSR
253140000627     C*
253150000627     C*--- RISCRIVO AGGIORNATA LA DBLP -------------------------------*
253160000627     C     AGDBLP        BEGSR
253170000627     C* DATA SPEDIZIONE
253180000627     C                   Z-ADD     BLPDSP        §LPMGS
253190000627     C                   MOVEL     BLPDSP        §LPAAS
253200000627     C* DATA CONSEGNA RICHIESTA
253210000627     C                   Z-ADD     COMDCR        §LPDCR
253220000627     C                   MOVEL     VIDSOP        §LPSOP
253230000627     C                   MOVEL     VIDRMN        §LPRMN
253240000627     C                   MOVEL     VIDRMA        §LPRMA
253250000627     C                   MOVEL     VIDRMO        §LPRMO
253260000627     C* RITIRO: AUTOTRASPORTATORE DATA NUMERO E PRESTAZIONE
253270000627     C                   Z-ADD     COMDRT        §LPDRT
253280000627     C                   MOVEL     VIDNRT        §LPNRT
253290000627     C                   MOVEL     VIDFPP        §LPFPP
253300000627     C                   MOVEL     VIDLNP        §LPPDR
253310000627     C                   MOVE      VIDPDR        §LPPDR
253320000627     C*
253330000627     C* CODICE BOLLA
253340000627     C                   MOVEL     VIDCBO        §LPCBO
253350000627     C                   Z-ADD     VIDCAS        §LPCAS
253360011113     C     VIDCAS        IFGT      *ZEROS
253370011113     C                   MOVEL     VIDVCA        §LPVCA
253380011113     C                   ELSE
253390011113     C                   CLEAR                   §LPVCA
253400011113     C                   ENDIF
253410000627     C                   MOVEL     VIDTIC        §LPTIC
253420000627     C                   MOVEL     VIDGCA        §LPGCA
253430011113     C                   CLEAR                   §LPCMB
253440000627     C* SEGNACOLLI
253450000627    1C     §3ABCM        IFEQ      ' '
253460000627     C                   EXSR      ASSSGN
253470000627     C     WEMFOR        IFEQ      ' '
253480000627     C                   MOVEL     BLPNCD        §LPNCD
253490000627     C                   MOVEL     BLPNCA        §LPNCA
253500000627     C                   ENDIF
253510000627     C                   ELSE
253520000627     C                   CLEAR                   §LPNCD
253530000627     C                   CLEAR                   §LPNCA
253540000627     C                   ENDIF
253550000627     C* TASSAZIONE
253560000627     C                   Z-ADD     VIDPOR        §LPPOR
253570000627     C                   Z-ADD     VIDIMV        §LPIMV
253580000627     C                   MOVEL     VIDCEI        §LPCEI
253590000627     C                   MOVEL     VIDDIV        §LPDIV
253600000627     C* MANCANO LE VARIE E DATI FATTURA !!
253610000627     C**
253620000627     C                   MOVEL     COMLNA        §LPLNA
253630000627     C                   MOVEL     VIDRSM        §LPRSM
253640000627     C                   MOVEL     VIDINM        §LPINM
253650000627     C                   MOVEL     VIDCAM        §LPCAM
253660000627     C                   MOVEL     VIDLOM        §LPLOM
253670000627     C                   MOVEL     VIDPRM        §LPPRM
253680000627     C                   MOVEL     VIDNZM        §LPNZM
253690000627     C* SE IMMESSA ANCHE NAZINE E CAP LI METTO AL POSTO DI QUELLI MITT
253700000627     C     VIDCMO        IFNE      *BLANKS
253710000627     C                   MOVEL     VIDCMO        §LPCAM
253720000627     C                   MOVEL     VIDNMO        §LPNZM
253730000627     C                   ENDIF
253740000627     C*
253750000627     C                   MOVEL     VARZNC        §LPZNC
253760000627     C     §3ACTM        IFNE      *BLANKS
253770000627     C                   MOVEL     §3ACTM        §LPCTM
253780000627     C                   ELSE
253790000627     C                   MOVEL     VIDCTM        §LPCTM
253800000627     C                   ENDIF
253810000627     C     BLPCTM        IFEQ      *BLANKS
253820000627     C                   MOVEL     WCTM          §LPCTM
253830000627     C                   ENDIF
253840000627     C                   MOVEL     VIDTC1        §LPTC1
253850000627     C                   MOVEL     VIDTC2        §LPTC2
253860000627     C                   MOVEL     VIDGGA        §LPGGA
253870000627     C                   MOVEL     VIDGMA        §LPGMA
253880000627     C                   MOVEL     VIDGVA        §LPGVA
253890000627     C* SE SECONDA LINEA DISTRIBUZIONE IMMETTO UNA "D" NEL 2 BYTE
253900000627     C* DELLE PARTICOLARITA' VARIE
253910000627     C     W2LN          IFEQ      'S'
253920000627     C                   MOVE      'D'           §LPGVA
253930000627     C                   ELSE
253940000627     C                   MOVE      ' '           §LPGVA
253950000627     C                   ENDIF
253960000627     C* P A R T I T A   I V A
253970000627     C*
253980000627     C* SE CODICE ISO $$ E VUOTA LA P.IVA --> METTO LA SCRITTA PRIVATO
253990000627     C*     NELLA P.IVA
254000000627     C     VIDISM        IFEQ      '$$'
254010000627     C     VIDCPM        ANDEQ     *BLANKS
254020000627     C                   MOVEL     'PRIVATO'     VIDCPM
254030000627     C                   ENDIF
254040000627     C     VIDISD        IFEQ      '$$'
254050000627     C     VIDCPD        ANDEQ     *BLANKS
254060000627     C                   MOVEL     'PRIVATO'     VIDCPD
254070000627     C                   ENDIF
254080000627     C*
254090000627     C  N04VIDISM        IFEQ      *BLANKS
254100000627     C                   MOVEL     VIDCPM        §LPCPI
254110000627     C                   ELSE
254120000627     C                   MOVEL     VIDPIM        §LPCPI
254130000627     C                   ENDIF
254140000627     C   04VIDISD        IFEQ      *BLANKS
254150000627     C                   MOVEL     VIDCPD        §LPCPI
254160000627     C                   ELSE
254170000627     C                   MOVEL     VIDPID        §LPCPI
254180000627     C                   ENDIF
254190000627     C**
254200000627     C                   MOVEL     VIDRSD        §LPRSD
254210000627     C                   MOVE      VIDRSD        §LPRD2
254220000627     C                   MOVEL     VIDIND        §LPIND
254230000627     C                   MOVEL     VIDCAD        §LPCAD
254240000627     C                   MOVEL     VIDLOD        §LPLOD
254250000627     C                   MOVEL     VIDPRD        §LPPRD
254260000627     C                   MOVEL     VIDNZD        §LPNZD
254270000627     C                   MOVEL     VIDGC1        §LPGC1
254280000627     C                   MOVEL     VIDGC2        §LPGC2
254290000627     C                   MOVEL     VIDCTR        §LPCTR
254300000627     C                   MOVEL     SAVCTS        §LPCTS
254310000627     C                   MOVEL     VIDFBR        §LPFBR
254320000627     C* ALLEGA BAM
254330000627     C                   EXSR      AGGFST
254340000627     C                   MOVEL     BLPFST        §LPBAM
254350000627     C* METTO TASSAZIONE CON TARIFFA MITTENTE SOLO SE E' ASSEGNATO
254360000627     C                   CLEAR                   §LPFTM
254370000627     C   04SAVFTM        IFEQ      'S'
254380000627     C     VIDFTM        OREQ      'S'
254390000627     C                   MOVEL     'S'           §LPFTM
254400000627     C                   ENDIF
254410000627     C* SE NON IMMESSO TIPO SERVIZIO
254420000627     C     VIDTSP        IFNE      *BLANKS
254430000627    1C                   MOVEL     VIDTSP        §LPTSP
254440000627     C                   ELSE
254450000627     C* LO PRENDO DA TARIFFA
254460000627     C                   MOVEL     COMTSP        §LPTSP
254470000627     C                   ENDIF
254480000627     C                   MOVEL     VIDIAS        §LPIAS
254490011113     C     VIDIAS        IFGT      *ZEROS
254500011113     C                   MOVEL     VIDVAS        §LPVAS
254510011113     C                   ELSE
254520011113     C                   CLEAR                   §LPVAS
254530011113     C                   ENDIF
254540000627     C                   MOVEL     VIDVMD        §LPVMD
254550011113     C     VIDVMD        IFGT      *ZEROS
254560011113     C                   MOVEL     VIDVAD        §LPVAD
254570011113     C                   ELSE
254580011113     C                   CLEAR                   §LPVAD
254590011113     C                   ENDIF
254600000627     C                   MOVEL     VIDQFT        §LPQFT
254610000627     C                   MOVEL     VIDNAS        §LPNAS
254620000627     C                   MOVEL     V1CNCL        §LPNCL
254630000627     C                   MOVEL     V2CPKG        §LPPKB
254640000627     C                   MOVEL     VIDFVR        §LPFVB
254650000627     C                   MOVEL     VARVOL        §LPVLB
254660000627     C                   MOVEL     VIDFFD        §LPFFD
254670010214     C     VIDFFD        IFEQ      'N'
254680010214     C                   MOVE      *BLANKS       §LPFFD
254690010214     C                   ENDIF
254700000627     C                   MOVEL     VIDTCR        §LPTCR
254710000627     C                   MOVEL     COMDCR        §LPDCR
254720000627     C                   MOVEL     VIDHCR        §LPHCR
254730000627     C                   MOVE      VIDMCR        §LPHCR
254740000627     C*
254750000627     C                   MOVEL     VIDNT1        §LPNOT
254760000627     C                   MOVEL     VIDNT2        §LPNT2
254770000627     C***
254780000627     C***  F L A G   I N O L T R O
254790000627     C                   EXSR      INOLTR
254800000627     C                   MOVEL     WFIN          §LPFIN
254810000627     C*
254820000627     C* FLAG ANTEPORTO: NON LO CALCOLO SE E' CONSEGNA A MAGAZZINO
254830000627    2C     APDFCM        IFNE      ' '
254840000627     C                   MOVEL     'C'           §LPFAP
254850000627     C                   ELSE
254860000627     C                   MOVEL     COMFAP        §LPFAP
254870000627    2C                   END
254880050114     c* flag unificazione spedizioni
254890050114     c                   if        *in12 and *in15
254900050114     c                   eval      §lpxco = wxco
254910050114     c                   endif
254920000627     C**
254930000627     C                   ENDSR
254940940927     C*
254950940927     C* CARICAMENTO BOLLE: DECODIFICHE -------------------------------*
254960940927     C     DECBOL        BEGSR
254970961007     C                   SETOFF                                       0413
254980950410     C                   SETOFF                                       131487
254990940927     C                   SETOFF                                       364494
255000940928     C*
255010940928     C* SE EMETTO 1 VIDEATA MI POSIZIONO SEMPRE SUL MITTENTE
255020010222     C* O SUL NUMERO ORM SE ATTIVATA PROCEDURA E SONO IM MANUTENZIONE
255030961007     C                   SETON                                        0730
255040940927     C*
255050940927     C* M I T T E N T E
255060960926     C* LNP CODICE <> LNP BOLLA: IMPOSTO P.O. CLIENTE
255070950103     C     W0030         IFNE      VIDLNP
255080950103     C                   MOVEL     W0030         VIDFLC
255090950103     C                   SETON                                        14
255100940927     C                   ENDIF
255110950103     C*
255120940927     C* C O D I C E   B O L L A
255130940927     C                   MOVEL     '3A'          COD
255140940927     C                   MOVEL(P)  VIDCBO        KEY
255150940927     C                   EXSR      CTABEL
255160940927     C  N30              MOVEL     TBLUNI        DS3A
255170940927     C  N30              MOVEL     §3ATB1        FLGTB1
255180940927     C   30              MOVEL     'F'           FLGTB1
255190070427     c                   move      flgtb1        savtb1
255200120926     c   30              clear                   savrbl
255210120926     c  n30              movel     §3arbl        savrbl
255220940927     C*
255230940927     C     FLGTB1        IFEQ      'A'
255240940927     C                   SETON                                        04
255250940927     C                   END
255260940927     C*
255270940927     C* CODICE BOLLA NON MANUTENZIONABILE
255280940927     C     §3AUCB        IFEQ      'N'
255290940927     C                   SETON                                        44
255300940927     C                   END
255310051123     c* Proteggo il codice bolla se in manutenzione o conferma bolle
255320051123     c* e bolla monovaria
255330051123     c                   if        *in12 = *on and §3asva <> *blanks
255340051123     c                   Movel     Prot1         AtrCbo
255350051123     c                   endif
255360940927     C* P A R T I T A   I V A
255370050921     C     'PRIVATO'     SCAN      WPIVA         posiz                    30
255380050921     c                   select
255390050921     c* solo numeri
255400070427     c* "PRIVATO senza iso
255410050921     c     *in30         wheneq    *off
255420050921     c     wiso          andge     *zeros
255430050921     c     *in30         oreq      *on
255440050921     c     posiz         andlt     3
255450050921     c  n04              movel     wpiva         vidcpm
255460050921     c   04              movel     wpiva         vidcpd
255470050921     c* iso + numeri
255480050921     c* iso + "PRIVATO"
255490050921     c     *in30         wheneq    *off
255500050921     c     posiz         orgt      2
255510050921     c  n04              movel     wpiva         vidpim
255520050921     c   04              movel     wpiva         vidpid
255530050921     c                   endsl
255540050921     C***  *IN30         IFEQ      *ON
255550050921     C***  WISO          ORGE      *ZEROS
255560050921     C**N04              MOVEL     WPIVA         VIDCPM
255570050921     C** 04              MOVEL     WPIVA         VIDCPD
255580050921     C**                 ELSE
255590050921     C**N04              MOVEL     WPIVA         VIDPIM
255600050921     C** 04              MOVEL     WPIVA         VIDPID
255610050921     C**                 ENDIF
255620940927     C*
255630940927     C* L I N E A   D I   A R R I V O
255640941011     C                   MOVEL     VIDLNA        SAVLNA
255650940927     C     VIDLNA        IFGT      *ZEROS
255660941011     C                   MOVEL     VIDLNA        COMLNA
255670940927     C     COMLNA        CHAIN     AZORG01L      UNIORG               30
255680940927     C  N30              MOVEL     ORGDES        V1DLNA
255690940927     C   30              MOVEL     *BLANKS       V1DLNA
255700020213     C                   MOVEL     ORGDE3        A_OG143
255710060707     C                   MOVEL     a_§ogntw      savaogntw
255720040525     C                   MOVEL     ORGDF0        A_OG150
255730020215     c                   movel     A_§ogntw      savntw
255740940927     C                   ENDIF
255750940927     C*
255760941011     C* C O D I C E   P A D R O N C I N O
255770990702     C                   CLEAR                   V1DPDR
255780941011     C     VIDPDR        IFGT      *ZEROS
255790941011     C                   MOVEL     VIDLNP        W0070
255800941011     C                   MOVE      VIDPDR        W0070
255810021204     C                   move      w0070         kpdpdr
255820021203     C                   move      'A'           kpdtip
255830021203     C     kfapd         chain     fiapd01l                           30
255840941011     C  N30              MOVEL     APDRSC        V1DPDR
255850940927     C   30              CLEAR                   V1DPDR
255860941011     C                   ENDIF
255870941107     C*
255880941107     C* T I P O   S E R V I Z I O
255890941107     C     VIDTSP        IFNE      ' '
255900941107     C                   Z-ADD     1             C
255910941107     C     VIDTSP        LOOKUP    TSP(C)                                 30
255920090604     C**!30              MOVEL     DTS(C)        V1DTSP
255930090604     C   30              MOVEL     DTS08(C)      V1DTSP
255940941107     C                   ENDIF
255950941115     C*
255960941115     C* C O N S E G N E   P A R T I C O L A R I
255970941115     C                   MOVEL     '1P'          COD
255980941115     C     VIDTC1        IFNE      *BLANKS
255990941115     C                   MOVEL(P)  VIDTC1        KEY
256000941115     C                   EXSR      CTABEL
256010941115     C  N30              MOVEL     TBLUNI        V2DTC1
256020941115     C                   ENDIF
256030941115     C     VIDTC2        IFNE      *BLANKS
256040941115     C                   MOVEL(P)  VIDTC2        KEY
256050941115     C                   EXSR      CTABEL
256060941115     C  N30              MOVEL     TBLUNI        V2DTC2
256070941115     C                   ENDIF
256080940927     C*
256090940927     C* S I G L A   O P E R A T O R E
256100940927     C* SE E' IN TABELLA  3M  SIGNIFICA CHE NON SI PUO' MANUTENZIONARE
256110940927     C                   MOVEL     '3M'          COD
256120940927     C                   MOVEL(P)  VIDSOP        KEY
256130940927     C                   EXSR      CTABEL
256140940927     C* SE TROVATA IN TABELLA --> PROTEGGO IL CAMPO
256150940927     C     *IN30         IFEQ      *OFF
256160940927     C                   SETON                                        13
256170940927     C                   END
256180940929     C* E S E N Z I O N E   I V A
256190940929     C     VIDCEI        IFNE      ' '
256200940929     C                   MOVEL     'EI'          COD
256210940929     C                   MOVEL(P)  VIDCEI        KEY
256220940929     C                   EXSR      CTABEL
256230940929     C  N30              MOVEL     TBLUNI        V3DCEI
256240940929     C                   ENDIF
256250940927     C* G I R O   D A T E
256260940927     C                   CLEAR                   WLBDAT
256270940927     C                   MOVE      BLPDSP        G02INV
256280940927     C                   MOVEL     '3'           G02ERR
256290940927     C                   CALL      'XSRDA8'
256300940927     C                   PARM                    WLBDAT
256310940927     C                   MOVEL     G02DAT        VIDDSP
256320940927     C* LA CONTROLLO SEMPRE LA DATA RITIRO
256330940927     C                   CLEAR                   SAVDRT
256340940927     C*
256350940927     C                   CLEAR                   WLBDAT
256360940927     C                   Z-ADD     VIDDRT        G02INV
256370940927     C                   MOVEL     '3'           G02ERR
256380940927     C                   CALL      'XSRDA8'
256390940927     C                   PARM                    WLBDAT
256400940927     C                   MOVEL     G02DAT        VIDDRT
256410010221     C                   Z-ADD     VIDDRT        PREDRT
256420070829     C                   Z-ADD     VIDDRT        s_drtblp
256430940927     C*
256440940927     C                   CLEAR                   WLBDAT
256450940927     C                   Z-ADD     VIDDCR        G02INV
256460940927     C                   MOVEL     '3'           G02ERR
256470940927     C                   CALL      'XSRDA8'
256480940927     C                   PARM                    WLBDAT
256490940927     C                   MOVEL     G02DAT        VIDDCR
256500940929     C*
256510940929     C                   CLEAR                   WLBDAT
256520940929     C                   Z-ADD     VIDDFT        G02INV
256530941115     C                   MOVEL     '3'           G02ERR
256540940929     C                   CALL      'XSRDA8'
256550940929     C                   PARM                    WLBDAT
256560940929     C                   Z-ADD     G02DAT        VIDDFT
256570940927     C                   ENDSR
256580910117     C*
256590910117     C*--- CREO RECORD PER STAMPA BOLLA ------------------------------*
256600910117     C     CRTBLD        BEGSR
256610910129     C  N12              MOVEL     *BLANKS       BLDATB
256620910201     C                   MOVEL     BLPLNP        BLDLNP
256630910117     C                   MOVEL     BLPAAS        BLDAAS
256640910117     C                   MOVEL     BLPNSP        BLDNSP
256650910117     C                   MOVEL     BLPNRS        BLDNRS
256660940214     C*
256670991201     C* RIFERIMENTO MITTENTE ALFABETICO, SE LNP DPD SCRIVO NUMERICO
256680910411     C     §1BFG7        IFNE      'S'
256690020319     C     §OGNTW        IFNE      'DPD'
256700940825     C                   MOVEL     BLPRMA        BLDCDP
256710991201     C                   ELSE
256720060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
256730060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
256740060622     c* in ogni caso non lo prendo più dal rmn
256750060622     c                   if        %subst(§b4ipn:14:1)=*blanks
256760060622     C                   eval      bldcdp=%subst(§b4ipn:1:3) + ' ' +
256770060622     c                             %subst(§b4ipn:4:8) + ' ' +
256780060622     c                             §b4icd
256790060622     c                   else
256800060622     c                   eval      bldcdp=§b4ipn
256810060622     c                   endif
256820991201     C                   ENDIF
256830940214     C                   ENDIF
256840940214     C*
256850910201     C  N12              MOVEL     *BLANKS       BLDFST
256860910220     C  N12              Z-ADD     1             BLDNC1
256870971215     C   12
256880971215     CAN 15              SELECT
256890971215     C* DEVO RISTAMPARE ENTRAMBE LE ETICHETTE
256900971215     C     §1BFG9        WHENEQ    'S'
256910951019     C     §1BFG6        ANDEQ     'C'
256920951019     C                   MOVEL     'S'           BLDFST
256930971215     C* DEVO STAMPARE SOLO ETICHETTA ESTERA
256940971215     C     §1BFG0        WHENEQ    'D'
256950971215     C     §1BFG6        ANDEQ     'C'
256960971215     C                   MOVEL     'E'           BLDFST
256970971217     C     §1BFG0        WHENEQ    'C'
256980971217     C     §1BFG6        ANDEQ     'C'
256990971217     C     §1BF11        ANDEQ     'D'
257000971217     C                   MOVEL     'E'           BLDFST
257010971215     C                   OTHER
257020951019     C                   MOVEL     ' '           BLDFST
257030971215     C                   ENDSL
257040971215     C*
257050971215     C                   MOVEL     BLPPDR        BLDPDR
257060910205     C                   MOVEL     BLPLNA        BLDLNA
257070910205     C                   MOVEL     BLPTFA        BLDTFA
257080910405     C                   MOVEL     BLPRSD        BLDRSD
257090910412     C                   MOVEL     BLPRSM        BLDRSM
257100910117     C     BLPCCM        IFGT      0
257110910117     C                   MOVEL     BLPCCM        BLDCCM
257120910117     C                   ELSE
257130910117     C                   MOVEL     BLPKSC        BLDCCM
257140910117     C                   END
257150000204     C**
257160000204     C* SE DEVO CREARE IL FILE METTO LA "S" DI STAMPATO
257170000204     C     WDKC          IFEQ      'S'
257180001003     C     WSGNR         OREQ      'B'
257190000211     C                   EXSR      STASCD
257200001005     C* Reimposto a "S" flag per scrittura fisgn in ristampa perchè
257210001005     C* se viene richiamato deve essere lanciato il pgm di stampa e non
257220001005     C* deve più scrivere fisgn
257230001005     C     WSGNR         IFEQ      'B'
257240001005     C                   MOVEL     'S'           WSGNR
257250001005     C                   ENDIF
257260000914     C                   ENDIF
257270000211     C*
257280000914     C* SE DISK C FLAGGO COME STAMPATO BLDFST
257290020917     C* SE FLAG 12 = E (DISK A CON FIVAT) FLAGGO SOLO SE AS400 ABILITA-
257300001106     C* TO AL DISK C
257310000914     C     *IN79         IFEQ      *ON
257320000925     C     §3CDKC        ANDEQ     'S'
257330000914     C     §1BF12        ORNE      'N'
257340001106     C     §1BF12        ANDNE     'E'
257350001106     C     §1BF12        OREQ      'E'
257360001106     C     WASDKC        ANDEQ     'S'
257370000204     C                   MOVEL     'S'           BLDFST
257380000211     C                   ENDIF
257390910117     C*
257400910204     C   15
257410000911     CORN12
257420000915     COR 12
257430000915     CANN15
257440000915     CAN 33              WRITE     FNBLD000
257450000915     C   12
257460000915     CANN15
257470000915     CANN33              UPDATE    FNBLD000
257480940214     C*
257490940214     C* SE LI AVEVO GIA' STAMPATI LI RISTAMPO SUBITO
257500971217     C*  NON VENGONO RISTAMPATI SE SONO SOLO ESTERO
257510980409     C*  NON RISTAMPO ANCHE SE E' UNA SOLUZIONE A E NON HANNO VARIATO
257520980409     C*  NESSUNO DEI CAMPI CHE INTERESSANO (N.COLLI,LNA,ZONA,CAP DEST.,
257530980409     C*  TSP.) --> WPRT = "N"
257540971217     C     SAVFST        IFEQ      'S'
257550980409     C     WPRT          ANDEQ     ' '
257560001003     C* PER DISK C STASCD L'HO GIA' RICHIAMATA
257570000915     C     WDKC          IFNE      'S'
257580940214     C                   EXSR      STASCD
257590000915     C                   ENDIF
257600060216     C* SE C'E' Fiar4 PER LNA ESTERO SDI AGGIORNO IL FLAG DI STAMPA
257610081008     C**   *IN12         IFEQ      *ON
257620081008     C**   *IN15         ANDEQ     *OFF
257630081008     c**   A_§ogntw      andeq     'EUP'
257640081008     C**                 MOVEL     'E'           WTRC
257650081008     C**   KBLP4         CHAIN     Fiar4000                           90
257660081008    2C**   *IN90         IFEQ      *OFF
257670081008     C**                 MOVEL     ar4NOT        DSBL4E
257680081008     C**                 MOVEL     'S'           §B4EST
257690081008     C**                 MOVEL     DSBL4E        ar4NOT
257700081008     C**                 UPDATE    Fiar4000
257710081008     C**                 ENDIF
257720081008     C**                 SETOFF                                       90
257730081008     C**                 ENDIF
257740971230     C                   ENDIF
257750910117     C*
257760910117     C                   ENDSR
257770940927     C*
257780940927     C* CARICO LA VARIA IN SFL ---------------------------------------*
257790940927     C     CARVAR        BEGSR
257800991012      *
257810991027     C     WSVN          IFNE      ' '
257820950418     C     *IN87         OREQ      *ON
257830991027      *
257840991027     C     WSVN          IFNE      §$2IVA
257850991027     C     WSVN          ANDNE     §$2BOL
257860991027      *
257870940927     C                   ADD       1             NRR
257880940927     C     NRR           CHAIN     LS01S03                            30
257890991027     C                   MOVEL     WSVN          V3CSV1
257900991027     C                   Z-ADD     WVAN          V3CVA1
257910991027     C                   Z-ADD     WVAN          V3HVA1
257920020102    3C     WCONV         IFEQ      '1'
257930020102     C     WVAN          ANDGT     0
257940020102    4C     VIDIMV        IFGT      *ZEROS
257950020102     C     WSVN          ORNE      'N'
257960020102     C     WVAN          ORNE      88888888
257970020102     C                   CLEAR                   DSYEUR
257980020102     C                   MOVEL     VIDDIV        YECDVI
257990020102     C                   MOVEL     §GEDCN        YECDVO
258000020102     C                   Z-ADD     WVAN          YECIMI
258010020102     C     COMFDC        IFEQ      'S'
258020020102     C                   MOVEL     '3'           YECDCO
258030020102     C                   ELSE
258040020102     C                   MOVEL     '0'           YECDCO
258050020102     C                   ENDIF
258060020102     C                   CALL      'YEURCO'
258070020102     C                   PARM                    DSYEUR
258080020102    5C     YECESI        IFEQ      ' '
258090020102     C                   Z-ADD     YECIMO        V3CVA1
258100020102     C                   Z-ADD     YECIMO        V3HVA1
258110020102    5C                   ENDIF
258120020102    4C                   ENDIF
258130020102    3C                   ENDIF
258140941021     C                   MOVEL     WEV1          V3CEV1
258150940927     C   30              WRITE     LS01S03
258160940927     C  N30              UPDATE    LS01S03
258170991027      *
258180940927     C                   ENDIF
258190991027     C                   ENDIF
258200991012      *
258210940927     C                   ENDSR
258220910117     C*
258230971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO ----------------------------*
258240910201     C     STASCI        BEGSR
258250000121     C                   MOVEL     'I'           WSTSEG            1
258260000121     C                   EXSR      RIESEG
258270971215     C**
258280971215     C**  SOLO SE DEVO STAMPARE QUALCHE COSA
258290971215     C     §DETST        IFNE      *BLANKS
258300001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
258310001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
258320001005     C   12
258330001005     CANN15WSGNR         IFEQ      'B'
258340001005     C     KBLP3         SETLL     FISGN05L
258350001005     C                   ENDIF
258360971215     C     CO2SCD        DOWLE     STANCA
258370990318     C     CO2SCD        ANDGT     0
258380980320     C* Routine per segnacolli euroexpress: imposta §DEEUR e §LDCDP
258390980320     C                   EXSR      EUREXP
258400980319     C*
258410910208     C                   ADD       1             §LDNC1
258420911119     C                   Z-ADD     CO2SCD        §LDNCD
258430910201     C*
258440000914     C* SE DISK C NON STAMPO MAI IN IMMEDIATO
258450001018     C* ANCHE SE SCRIVO FISGN SOLO PER RISTAMPA E HO VBARIATO CAMPI
258460001018     C* PER I QUALI NON È NECESSARIO RISTAMPARE IMMEDIATAMENTE L'ETICH.
258470050302     C     *IN79         IFEQ      *OFF
258480050302     C     §1BF12        ANDEQ     'N'
258490050302     C     WNOPRT        ANDNE     '1'
258500001107     C*
258510050302     C     §1BF12        oreq      'E'
258520050302     C     WASDKC        ANDNE     'S'
258530050302     C     WNOPRT        ANDNE     '1'
258540001107     C*
258550050302     C     §1BF12        OREQ      'N'
258560050302     C     *IN79         ANDEQ     *ON
258570050302     C     §3CDKC        ANDNE     'S'
258580050302     C     WNOPRT        ANDNE     '1'
258590001107     C*
258600030611     C                   CALL      WD90pss
258610910201     C                   PARM                    DSBLD
258620971216     C                   PARM                    DSBLDE
258630001005     C                   ENDIF
258640001107     C* SCRITTURA/AGGIORNAMENTO FISGN00F: PER DISKC O PER SOLA RISTAMP
258650050302     C     §1BF12        IFNE      'N'
258660050302     C     §1BF12        ANDNE     'E'
258670050302     C     §1BF12        OREQ      'E'
258680050302     C     WASDKC        ANDEQ     'S'
258690050302     C     *IN79         OREQ      *ON
258700050302     C     §3CDKC        ANDEQ     'S'
258710001005     C     WSGNR         OREQ      'B'
258720000225     C*
258730000225     C* PULISCO PERCHE' HO AGGIORNATO
258740000913    3C                   SELECT
258750050225     c* import dpd (ctm disk c)
258760050225     c     §1bf12        whenne    'N'
258770050225     c     *in79         andeq     *on
258780050302     c     wdkc          ifeq      'S'
258790050225     C     WESSGN        IFEQ      'S'
258800050225     C                   EXSR      UPDSGN
258810050225     C                   ELSE
258820050225     C                   Z-ADD     COMTFP        SGNTNP
258830050225     C                   WRITE     FISGN000
258840050225     C                   ENDIF
258850060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
258860060622     c* anche fisgn con key composta dal solo numero parcel
258870060622     c                   if        §b4ibi<>*blanks
258880060622     c                             and %subst(§b4ipn:14:1)=*blanks
258890060622     c                   clear                   kwho
258900060622     C                   movel     §b4ipn        kwho
258910060622     C                   eval      %subst(kwho:12:1)=§b4icd
258920060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
258930060623     c* serviranno per la seconda scrittura
258940060623     C                   MOVEL     DSBLD         WSBLD
258950060623     C                   MOVEL     DSBLDE        WSBLDE
258960060622     C                   CLEAR                   WESSGN
258970060622     C                   CLEAR                   WSGNR
258980060622     C                   CLEAR                   FISGN000
258990060622     C                   MOVEL     'S'           WDKC              1
259000060622     C                   EXSR      CTRSGN
259010060622     C     WDKC          IFEQ      'S'
259020060623     C                   MOVEL     WSBLD         dsbld
259030060623     C                   MOVEL     WSBLDE        dsblde
259040060622     C     WESSGN        IFEQ      'S'
259050060622     C                   EXSR      UPDSGN
259060060622     C                   ELSE
259070060622     C                   Z-ADD     COMTFP        SGNTNP
259080060622     C                   WRITE     FISGN000
259090060622     C                   ENDIF
259100060622     C                   ENDIF
259110060622     c                   endif
259120050302     C                   ENDIF
259130050221     C* EXPORT DPD DA VAT O MANUALE
259140001009     C     §1BF12        WHENNE    'N'
259150001011     C     WEXDPD        ANDEQ     'S'
259160160225     c     w_aDpd        andne     'S'
259170140714     C     §1BF13        ANDNE     'A'
259180140715     c     §1bf12        andne     'B'
259190070323     c     wparcel       andne     '12'
259200050302     C     WDKC          IFEQ      'S'
259210001009     C     WESSGN        IFEQ      'S'
259220001009     C                   EXSR      UPDSGN
259230001009     C                   ELSE
259240010116     C                   Z-ADD     COMTFP        SGNTNP
259250001009     C                   WRITE     FISGN000
259260001009     C                   ENDIF
259270050302     C                   ENDIF
259280000912     C     §1BF12        WHENNE    'N'
259290000911     C                   Z-ADD     CO2SCD        WO2SCD
259300000911     C                   MOVEL     'C'           WTRC
259310051102     C     KARS01        CHAIN(N)  FIARS01L                           30
259320000913    4C     *IN30         IFEQ      *OFF
259330000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
259340000911     C                   Z-ADD     1             IX
259350051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
259360000911     C     POS(IX)       CHAIN     LS01S08                            30
259370000204     C*
259380000204     C* SCRITTURA DEL FILE  PER DISK "C"
259390000913    5C     V8HDKC        IFEQ      'S'
259400000913    6C     V8HESG        IFEQ      'S'
259410000919     C                   MOVEL     DSBLD         WSBLD
259420000919     C                   MOVEL     DSBLDE        WSBLDE
259430010116     C     KSGN8         CHAIN     FISGN01L                           30
259440000919     C                   MOVEL     WSBLD         DSBLD
259450000919     C                   MOVEL     WSBLDE        DSBLDE
259460000921     C                   EXSR      UPDSGN
259470000913   X6C                   ELSE
259480000929     C                   EXSR      WRTSGN
259490000913    6C                   ENDIF
259500000913    5C                   ENDIF
259510000913    4C                   ENDIF
259520050225     C* IMPORT DPD (ctm no diskc)
259530000912     C     *IN79         WHENEQ    *ON
259540000912     C     WESSGN        IFEQ      'S'
259550000921     C                   EXSR      UPDSGN
259560000912     C                   ELSE
259570010116     C                   Z-ADD     COMTFP        SGNTNP
259580000912     C                   WRITE     FISGN000
259590000912     C                   ENDIF
259600001005     C* SCRIVO O UPDATO FISGN PER RISTAMPA
259610001005     C     WSGNR         WHENEQ    'B'
259620001005     C                   MOVEL     DSBLD         WSBLD
259630001005     C                   MOVEL     DSBLDE        WSBLDE
259640001005     C     KBLP3         READE     FISGN05L                               30
259650001013     C                   MOVE      *IN30         WIN30
259660001005     C                   MOVEL     WSBLD         DSBLD
259670001005     C                   MOVEL     WSBLDE        DSBLDE
259680001013     C                   CLEAR                   DSBLD7
259690001013     C                   MOVE      §LDLNP        §LCLNP
259700001013     C                   MOVE      §LDLNA        §LCLNA
259710001013     C                   MOVE      §LDNRS        §LCNRS
259720001013     C                   MOVE      §LDZSC        §LCZSC
259730001013     C                   MOVE      §LDNCD        §LCNCD
259740001013     C                   EXSR      M10
259750001013     C                   MOVEA     §CA           SGNWHO
259760001013     C                   MOVEA     §CA           V8CNOT
259770001013     C                   MOVE      WIN30         *IN30
259780001005     C     *IN30         IFEQ      *OFF
259790001005     C                   EXSR      UPDSGN
259800001005     C                   ELSE
259810001005     C                   EXSR      WRTSGN
259820001005     C                   ENDIF
259830000913    3C                   ENDSL
259840000204     C                   ENDIF
259850910201     C*
259860910827     C                   ADD       1             CO2SCD
259870910201     C*
259880971215     C                   ENDDO
259890001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
259900001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
259910001005     C   12
259920001005     CANN15WSGNR         IFEQ      'B'
259930001005     C     VIDNCL        ANDLT     SAVNCL
259940001005     C     KBLP3         READE     FISGN05L                               30
259950001005     C     *IN30         DOWEQ     *OFF
259960001005     C                   EXSR      ANNSGN
259970001005     C     KBLP3         READE     FISGN05L                               30
259980001005     C                   ENDDO
259990001005     C                   ENDIF
260000971215     C                   ENDIF
260010910404     C*
260020910117     C                   ENDSR
260030000121     C*
260040000121     C* RIEMPO DS PER STAMPA SEGNACOLLI ------------------------------*
260050000121     C     RIESEG        BEGSR
260060000124     C                   CLEAR                   §DEEUR
260070000124     C                   CLEAR                   §DEAWB
260080000124     C                   CLEAR                   §DEFCA
260090040506     C                   CLEAR                   §DEISA
260100000124     C                   CLEAR                   §DESIA
260110000201     C                   CLEAR                   §DESSE
260120010302     C                   CLEAR                   SAVCDP
260130000124     C*
260140000121     C     WSTSEG        IFEQ      'I'
260150000929     C* WSGNR = 'S' --> Scrivo fisgn per eventuale ristampa
260160001107     C* (Se provengo da manutenzione non devo azzerare nc1 prechè in
260170001107     C*  questo caso devo richiamare pgm di stampa e non scrittura di
260180001107     C*  fisgn. Se azzerassi, la stampa del progressivo sull'etichetta
260190001107     C*  partirebbe da 0 anzichè da 1)
260200000929     C     WSGNR         OREQ      'S'
260210001107     C     *IN12         ANDEQ     *OFF
260220001107     C     WSGNR         OREQ      'S'
260230001107     C     *IN15         ANDEQ     *ON
260240000121     C                   Z-ADD     0             §LDNC1
260250000121     C                   ELSE
260260000121     C                   Z-ADD     BLDNC1        §LDNC1
260270000121     C                   ENDIF
260280000208     C*
260290000208     C                   MOVEL     WDLA          §LDDLA
260300000208     C                   MOVEL     BLPFLS        §LDLNP
260310000121     C     BLPFLS        CHAIN     AZORG01L      UNIORG               30
260320000121     C  N30              MOVEL     ORGDES        §LDDLP
260330000121     C   30              MOVEL     *BLANKS       §LDDLP
260340000121     C     WSTSEG        IFEQ      'D'
260350000121     C                   MOVEL     BLDCDP        §LDCDP
260360000121     C                   ELSE
260370000121      * RIFERIMENTO MITTENTE ALFABETICO
260380000121     C                   MOVEL     BLPRMA        §LDCDP
260390000121     C                   ENDIF
260400000121      *
260410000121      * SE LNP DPD SCRIVO NUMERICO
260420020319     C     §OGNTW        IFEQ      'DPD'
260430060622     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
260440060622     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
260450060622     c* in ogni caso non lo prendo più dal rmn
260460060622     c                   if        %subst(§b4ipn:14:1)=*blanks
260470060622     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
260480060622     c                             %subst(§b4ipn:4:8) + ' ' +
260490060622     c                             §b4icd
260500060622     c                   else
260510060622     c                   eval      §ldcdp=§b4ipn
260520060622     c                   endif
260530000121     C                   ENDIF
260540000121      *
260550000121      * PER EXPORT DPD SCRIVO NUMERO PARCEL
260560020319    1C     A_§OGNTW      IFEQ      'DPD'
260570060510    2C     §B4ipn        ANDNE     *BLANKS
260580010302     C* Se RMA diverso da blanks lo devo stampare, allineato a dx,
260590120302     C* nella prima riga di stampa dell'etichetta brt andando
260600010302     C* a coprire in parte la ragione sociale del mittente
260610010302     C* In questo punto mi salvo quindi il rma che andrò a muovere
260620010302     c* nela campo della ragione sociale se <> da blank (v.sotto)
260630060510     c* ATTENZIONE: per numero parcel lungo 14 continuiamo a stamparlo
260640120302     c* sull'etichetta brt ma non più distanziato in quanto
260650060510     c* §ldcdp non è abbastanza lungo
260660010302     C                   MOVE      §LDCDP        SAVCDP
260670060626     c* se numero parcel lungo 12 stampo XXX XXXXXXXX X
260680060626     c* se numero parcel lungo 14 stampo xxxx xxxxxxxxxx
260690060626     c                   if        %subst(§b4ipn:14:1)=*blanks
260700060626     C                   eval      §ldcdp=%subst(§b4ipn:1:3) + ' ' +
260710060626     c                             %subst(§b4ipn:4:8) + ' ' +
260720060626     c                             §b4icd
260730060626     c                   else
260740060626     c                   eval      §ldcdp=§b4ipn
260750060626     c                   endif
260760000121    2C                   ENDIF
260770020211     c*
260780020211      * PER EXPORT FEDEX SCRIVO AWB
260790020213    1C     A_§ogntw      IFEQ      'FED'
260800020211     C                   MOVEL     §B4ERP        §LDCDP
260810020211    1C                   ENDIF
260820000201     C*
260830000201     C* ALTRI DATI ETICHETTA ESTERA
260840000201     C                   EXSR      ETIEST
260850000121     C*
260860000121     C                   MOVEL     BLPNRS        §LDNRS
260870000121     C                   MOVEL     BLPLNA        §LDLNA
260880000121     C                   MOVEL     BLPTFA        §LDTNA
260890000121     C                   MOVE      BLPPDR        §LDCPD
260900000121     C                   MOVEL     BLPTSP        §LDTSP
260910000121     C                   MOVEL     BLPZNC        §LDZSC
260920000121     C                   MOVE      BLPNCL        §LDNC2
260930000121     C                   MOVEL     BLPRSM        §LDRSM
260940010302     C* SOLO PER SEGNACOLLI EXPORT DPD:
260950010302     C* MUOVO ALLINEATO, A SX DELLA RSM, IL RMA SE <> DA BLANKS
260960010302     C* E LO COMPATTO PERDENDO CIOÈ I BLANK NON SIGNIFICATIVI
260970010302     C     SAVCDP        IFNE      *BLANKS
260980010302     C                   CLEAR                   W35
260990010302     C                   MOVEA     SAVCDP        W35
261000010302     C     ' '           CHECKR    SAVCDP        §Z                2 0
261010010302     C                   ADD       2             §Z
261020010302     C                   MOVEA     BLPRSM        W35(§Z)
261030010302     C                   MOVEA     W35           §LDRSM
261040010302     C                   ENDIF
261050000121     C                   MOVEL     BLPPRM        §LDPRM
261060000121     C                   MOVEL     BLPRSD        §LDRSD
261070000121     C                   MOVEL     BLPCAD        §LDCAD
261080000121     C                   MOVEL     BLPLOD        §LDLOD
261090000121     C                   MOVEL     BLPIND        §LDIND
261100000121     C                   MOVE      BLPPRD        §LDPRD
261110000121     C                   MOVEL     *ZEROS        §LDNCP
261120000121     C                   MOVEL     *ZEROS        §LDNCU
261130000121     C                   MOVEL     BLPFVF        §LDFVR
261140000121     C                   MOVEL     BLPVLF        §LDVOL
261150000121     C                   MOVEL     BLPPKF        §LDPKG
261160000121     C                   MOVEL     BLPAAS        §LDAAS
261170000121     C                   MOVEL     BLPMGS        §LDMGS
261180050422     c                   clear                   §ldrst
261190050422     c* in conferma o in immissione imposto "V" di valore se collo
261200050422     c* di valore
261210050422     c                   if        (*in12 = *off or *in15 = *on) and
261220050422     c                             vidbva <> *blanks
261230050422     c                   eval      §ldrst = 'V'
261240050422     c                   endif
261250050422     c* in manutenzione metto "M" se modificato no collo di valore
261260050422     c*                 metto "W" se modificato    collo di valore
261270050422     C     *IN12         IFEQ      *ON
261280050422     C     *IN15         ANDEQ     *OFF
261290050422     c     vidbva        ifeq      *blanks
261300050422     c* Se è un disk c non ha senso stampare l'etichetta con la "M" in
261310050422     c* quanto questa esce solo quando il collo passa sull'impianto
261320050422     c     wdkc          ifne      'S'
261330050422     c     wsgnr         andne     'B'
261340050422     C                   MOVEL     'M'           §LDRST
261350050422     c                   endif
261360050422     c                   else
261370050422     c     wdkc          ifne      'S'
261380050422     c     wsgnr         andne     'B'
261390050422     c                   movel     'W'           §ldrst
261400050422     c                   else
261410050422     c                   movel     'V'           §ldrst
261420050422     c                   endif
261430050422     c                   endif
261440050422     c                   endif
261450000121     C                   ENDSR
261460000929     C*
261470971215     C*--- STAMPA SEGNACOLLI IN IMMEDIATO COME RISTAMPA DEL "D" ------*
261480910201     C     STASCD        BEGSR
261490910201     C* RICHIAMO DIRETTAMENTE IL PROGRAMMA DI STAMPA SEGNACOLLO
261500910827     C                   Z-ADD     BLDNCD        CO2SCD
261510910201     C     BLDNCA        IFEQ      0
261520910201     C                   Z-ADD     BLDNCD        BLDNCA
261530910201     C                   END
261540040506     C* IMPOSTO DSBLDE
261550081008     C**   WESTER        IFEQ      'S'
261560081008     C**                 MOVEL     'ALL'         §DETST
261570081008     C**                 ELSE
261580040506     C                   MOVEL     'ITA'         §DETST
261590040506     C* Se export Euroexpress imposto "EEX" in §detse per far stampare
261600040506     c* etichetta Italia con dati esteri
261610040506     C     A_§ogntw      IFEQ      'EEX'
261620040506     C                   MOVEL     'EEX'         §DETSE
261630040506     c                   else
261640040506     c                   clear                   §detse
261650040506     C                   ENDIF
261660081008     C***                ENDIF
261670000121     C* RIEMPO LE DS
261680060622     C                   MOVEL     'D'           WSTSEG
261690000121     C                   EXSR      RIESEG
261700000211     C**
261710000919     C*
261720001005     C* SE SONO IN MANUTENZIONE E DEVO SCRIVERE FISGN COME RISTAMPA
261730001005     C* (NO DISK C) LEGGO FISGN05L (PER SPEDIZIONE) PER AGGIORNARLO
261740001005     C   12
261750001005     CANN15WSGNR         IFEQ      'B'
261760001019     C     WSTSGN        ANDEQ     *BLANKS
261770001005     C     KBLP3         SETLL     FISGN05L
261780001019     C                   MOVE      '1'           WSTSGN            1
261790001005     C                   ENDIF
261800980320     C*
261810000908     C     CO2SCD        DOWLE     BLDNCA
261820990318     C     CO2SCD        ANDGT     0
261830980320     C* Routine per impostazione campi segnacollo euroexpress di dsblde
261840980320     C                   EXSR      EUREXP
261850911122     C                   Z-ADD     CO2SCD        §LDNCD
261860910201     C*
261870000204     C     WDKC          IFNE      'S'
261880001003     C     WSGNR         ANDNE     'B'
261890030611     C                   CALL      WD90pss
261900910201     C                   PARM                    DSBLD
261910971216     C                   PARM                    DSBLDE
261920000913     C                   ELSE
261930000225     C*
261940000225     C* PULISCO PERCHE' HO AGGIORNATO
261950000912    3C                   SELECT
261960050224     C* IMPORT DPD
261970050224     c     §1bf12        whenne    'N'
261980050224     C     *IN79         andeq     *ON
261990050224     C     WDKC          IFEQ      'S'
262000050224     C     WESSGN        IFEQ      'S'
262010050224     C                   EXSR      UPDSGN
262020050224     C                   ELSE
262030050224     C                   Z-ADD     COMTFP        SGNTNP
262040050224     C                   WRITE     FISGN000
262050050224     C                   ENDIF
262060050224     C                   ENDIF
262070060622     c* se utilizzato il cappario nuovo cerco di scrivere/aggiornare
262080060622     c* anche fisgn con key composta dal solo numero parcel
262090060622     c                   if        §b4ibi<>*blanks
262100060622     c                             and %subst(§b4ipn:14:1)=*blanks
262110060622     c                   clear                   kwho
262120060622     C                   movel     §b4ipn        kwho
262130060622     C                   eval      %subst(kwho:12:1)=§b4icd
262140060623     c* mi salvo campi del fisgn dalla precedente scrittura perchè mi
262150060623     c* serviranno per la seconda scrittura
262160060623     C                   MOVEL     DSBLD         WSBLD
262170060623     C                   MOVEL     DSBLDE        WSBLDE
262180060622     C                   CLEAR                   WESSGN
262190060622     C                   CLEAR                   WSGNR
262200060622     C                   CLEAR                   FISGN000
262210060622     C                   MOVEL     'S'           WDKC              1
262220060622     C                   EXSR      CTRSGN
262230060622     C     WDKC          IFEQ      'S'
262240060623     C                   MOVEL     WSBLD         dsbld
262250060623     C                   MOVEL     WSBLDE        dsblde
262260060622     C     WESSGN        IFEQ      'S'
262270060622     C                   EXSR      UPDSGN
262280060622     C                   ELSE
262290060622     C                   Z-ADD     COMTFP        SGNTNP
262300060622     C                   WRITE     FISGN000
262310060622     C                   ENDIF
262320060622     C                   ENDIF
262330060622     c                   endif
262340050221     C* DISK C EXPORT DPD DA vat O MANUALE
262350001009     C     §1BF12        WHENNE    'N'
262360001011     C     WEXDPD        ANDEQ     'S'
262370160225     c     w_aDpd        andne     'S'
262380140714     C     §1BF13        ANDNE     'A'
262390140715     c     §1bf12        andne     'B'
262400070323     C     wparcel       ANDNE     '12'
262410001009     C     WDKC          IFEQ      'S'
262420001009     C     WESSGN        IFEQ      'S'
262430001009     C                   EXSR      UPDSGN
262440001009     C                   ELSE
262450010116     C                   Z-ADD     COMTFP        SGNTNP
262460001009     C                   WRITE     FISGN000
262470001009     C                   ENDIF
262480001009     C                   ENDIF
262490000912     C     §1BF12        WHENNE    'N'
262500000911     C                   Z-ADD     CO2SCD        WO2SCD
262510000911     C                   MOVEL     'C'           WTRC
262520051102     C     KARS01        CHAIN(N)  FIARS01L                           30
262530000912    4C     *IN30         IFEQ      *OFF
262540000911     C* CERCO IL CHI SONO NEL SUBFILE PER AVERE CONTENUTO CAMPI HIDDEN
262550000911     C                   Z-ADD     1             IX
262560051102     C     ARSNOT        LOOKUP    CHI(IX)                                30
262570000911     C     POS(IX)       CHAIN     LS01S08                            30
262580000204     C*
262590000204     C* SCRITTURA DEL FILE  PER DISK "C"
262600000912    5C     V8HDKC        IFEQ      'S'
262610000912    6C     V8HESG        IFEQ      'S'
262620000919     c* prima di chainare fisgn mi salvo la ds
262630000919     C                   MOVEL     DSBLD         WSBLD
262640000919     C                   MOVEL     DSBLDE        WSBLDE
262650010116     C     KSGN8         CHAIN     FISGN01L                           30
262660000919     C                   MOVEL     WSBLD         DSBLD
262670000919     C                   MOVEL     WSBLDE        DSBLDE
262680000912     C                   EXSR      UPDSGN
262690000912   X6C                   ELSE
262700000929     C                   EXSR      WRTSGN
262710000912    6C                   ENDIF
262720000912    5C                   ENDIF
262730000912    4C                   ENDIF
262740050224     C* IMPORT DPD (ctm no disk c)
262750000912     C     *IN79         WHENEQ    *ON
262760000912     C     WESSGN        IFEQ      'S'
262770000912     C                   EXSR      UPDSGN
262780000912     C                   ELSE
262790010116     C                   Z-ADD     COMTFP        SGNTNP
262800000912     C                   WRITE     FISGN000
262810000912     C                   ENDIF
262820001003     C* FISGN IN RISTAMPA
262830001003     C     WSGNR         WHENEQ    'B'
262840001005     c* prima di leggere fisgn mi salvo la ds
262850001005     C                   MOVEL     DSBLD         WSBLD
262860001005     C                   MOVEL     DSBLDE        WSBLDE
262870001005     C     KBLP3         READE     FISGN05L                               30
262880001013     C                   MOVE      *IN30         WIN30             1
262890001005     C                   MOVEL     WSBLD         DSBLD
262900001005     C                   MOVEL     WSBLDE        DSBLDE
262910001013     C                   CLEAR                   DSBLD7
262920001013     C                   MOVE      §LDLNP        §LCLNP
262930001013     C                   MOVE      §LDLNA        §LCLNA
262940001013     C                   MOVE      §LDNRS        §LCNRS
262950001013     C                   MOVE      §LDZSC        §LCZSC
262960001013     C                   MOVE      §LDNCD        §LCNCD
262970001013     C                   EXSR      M10
262980001013     C                   MOVEA     §CA           SGNWHO
262990001013     C                   MOVEA     §CA           V8CNOT
263000001013     C                   MOVE      WIN30         *IN30
263010001005     C     *IN30         IFEQ      *OFF
263020001005     C                   EXSR      UPDSGN
263030001005     C                   ELSE
263040001003     C                   EXSR      WRTSGN
263050001005     C                   ENDIF
263060000912    3C                   ENDSL
263070000911     C                   ENDIF
263080910201     C*
263090910827     C                   ADD       1             CO2SCD
263100910313     C                   ADD       1             §LDNC1
263110910201     C*
263120910201     C                   END
263130001005     C* SE HO SCRITTO FISGN IN RISTAMPA E SONO IN MANUTENZIONE PER
263140001005     C* DIMINUZIONE NUMERO COLLI DEVO CANCELLARE RECORD RESTANTI
263150001005     C   12
263160001005     CANN15WSGNR         IFEQ      'B'
263170001005     C     VIDNCL        ANDLT     SAVNCL
263180001005     C     KBLP3         READE     FISGN05L                               30
263190001005     C     *IN30         DOWEQ     *OFF
263200001005     C                   EXSR      ANNSGN
263210001005     C     KBLP3         READE     FISGN05L                               30
263220001005     C                   ENDDO
263230001005     C                   ENDIF
263240910201     C                   ENDSR
263250910805     C*
263260910805     C*--- CREO FLBLT00F ---------------------------------------------*
263270910805     C     CRTBLT        BEGSR
263280940926     C                   CLEAR                   FNBLT000
263290910805     C                   MOVEL     BLPAAS        BLTAAS
263300940926     C                   MOVEL     BLPLNP        BLTLNP
263310910805     C                   MOVEL     BLPNRS        BLTNRS
263320000921     C                   MOVEL     BLPNSP        BLTNSP
263330910828     C                   MOVEL     BLPLNA        BLTLNA
263340910828     C                   MOVEL     BLPFLS        BLTFLS
263350060622     C                   MOVEL     BLPNFV        BLTNFV
263360920910     C                   MOVEL     BLPFLP        BLTFLP
263370940926     C                   MOVEL     WNSC          BLTNSC
263380940915     C                   WRITE     FNBLT000
263390120817     c* richiamo creazione dettaglio colli unico
263400120817     c                   exsr      crtFIART
263410980318     C*
263420000908     C* RICHIAMO CREAZIONE ESTENSIONE DETTAGLIO SEGNACOLLO
263430000908     C* PER MEMORIZZAZIONE COD. "CHI SONO"
263440051102     C                   EXSR      CRTARS
263450910805     C*
263460910805     C                   ENDSR
263470120814     C*--- CREO FIART00F ---------------------------------------------*
263480120814     C     crtFIART      BEGSR
263490120814     C                   CLEAR                   FIART000
263500120814     C                   MOVEL     BLPAAS        ARTAAS
263510120814     C                   MOVEL     BLPLNP        ARTLNP
263520120814     C                   MOVEL     BLPNRS        ARTNRS
263530120814     C                   MOVEL     BLPNSP        ARTNSP
263540120814     C                   MOVEL     BLPLNA        ARTLNA
263550120814     C                   MOVEL     BLPFLS        ARTFLS
263560120814     C                   MOVEL     BLPNFV        ARTNFV
263570120814     C                   MOVEL     BLPFLP        ARTFLP
263580120814     C                   MOVEL     WNSC          ARTNSC
263590120814     C                   WRITE     FIART000
263600120814     c                   endsr
263610051102     C*--- CREO FIARS00F ---------------------------------------------*
263620051102     C     CRTARS        BEGSR
263630001009     C*
263640001013    1C                   SELECT
263650050221     C* DISK C EXPORT DPD DA vat O MANUALE
263660001011     C     WEXDPD        WHENEQ    'S'
263670140714     C     §1BF13        ANDNE     'A'
263680160225     C     w_aDpd        ANDNE     'S'
263690001009     C     §1BF12        ANDNE     'N'
263700140715     C     §1BF12        ANDNE     'B'
263710070322     c     wparcel       andne     '12'
263720051102     C                   CLEAR                   FIARS000
263730120817     C***                MOVE      BLTFLS        ARSFLS
263740120817     C***                MOVE      BLTLNA        ARSLNA
263750120817     C***                MOVE      BLTNRS        ARSNRS
263760120817     C***                MOVE      BLTNSC        ARSNSC
263770120817     C                   MOVE      ARTFLS        ARSFLS
263780120817     C                   MOVE      ARTLNA        ARSLNA
263790120817     C                   MOVE      ARTNRS        ARSNRS
263800120817     C                   MOVE      ARTNSC        ARSNSC
263810051102     C                   MOVEL     'C'           ARSTRC
263820051102     C                   MOVEL     V7CNPR        ARSNOT
263830051114     C                   MOVEL     dateu         ARSduv
263840051102     C                   WRITE     FIARS000
263850050224     c* Disk C import DPD
263860050224     c     *in79         wheneq    *on
263870050224     c     §1bf12        andne     'N'
263880051102     C                   CLEAR                   FIARS000
263890120817     C***                MOVE      BLTFLS        ARSFLS
263900120817     C***                MOVE      BLTLNA        ARSLNA
263910120817     C***                MOVE      BLTNRS        ARSNRS
263920120817     C***                MOVE      BLTNSC        ARSNSC
263930120817     C                   MOVE      ARTFLS        ARSFLS
263940120817     C                   MOVE      ARTLNA        ARSLNA
263950120817     C                   MOVE      ARTNRS        ARSNRS
263960120817     C                   MOVE      ARTNSC        ARSNSC
263970051102     C                   MOVEL     'C'           ARSTRC
263980060622     c***                z-add     blprmn        w0120
263990060622     C***                MOVEL     w0120         ARSNOT
264000060622     c                   movel     v7cnpr        arsnot
264010051114     C                   MOVEL     dateu         ARSduv
264020051102     C                   WRITE     FIARS000
264030980318     C*
264040000908     C* DISK C
264050000608     C*
264060000908     C     §1BF12        WHENNE    'N'
264070000908     C     NR8           CHAIN     LS01S08                            30
264080000908     C     *IN30         DOWEQ     *OFF
264090000908     C     V8CSCE        ANDEQ     'A'
264100000908     C                   ADD       1             NR8
264110000908     C     NR8           CHAIN     LS01S08                            30
264120000908     C                   ENDDO
264130000908     C     *IN30         IFEQ      *OFF
264140051102     C                   CLEAR                   FIARS000
264150120817     C***                MOVE      BLTFLS        ARSFLS
264160120817     C***                MOVE      BLTLNA        ARSLNA
264170120817     C***                MOVE      BLTNRS        ARSNRS
264180120817     C***                MOVE      BLTNSC        ARSNSC
264190120817     C                   MOVE      ARTFLS        ARSFLS
264200120817     C                   MOVE      ARTLNA        ARSLNA
264210120817     C                   MOVE      ARTNRS        ARSNRS
264220120817     C                   MOVE      ARTNSC        ARSNSC
264230051102     C                   MOVEL     'C'           ARSTRC
264240051102     C                   MOVEL     V8CNOT        ARSNOT
264250051114     C                   MOVEL     dateu         ARSduv
264260051102     C                   WRITE     FIARS000
264270000911     C                   ADD       1             NR8
264280000908     C                   ENDIF
264290120302     C* SE IMPORT BRT DEVO MEMORIZZARE SEMPRE SU ARS ANCHE
264300000911     C* RECORD TIPO 'E' PER SEGNACOLLO EUROEXPRESS
264310020211     c     §ogntw        ifeq      'EEX'
264320000911     C     §1BF12        ANDEQ     'E'
264330051102     C                   CLEAR                   FIARS000
264340120817     C***                MOVE      BLTFLS        ARSFLS
264350120817     C***                MOVE      BLTLNA        ARSLNA
264360120817     C***                MOVE      BLTNRS        ARSNRS
264370120817     C***                MOVE      BLTNSC        ARSNSC
264380120817     C                   MOVE      ARTFLS        ARSFLS
264390120817     C                   MOVE      ARTLNA        ARSLNA
264400120817     C                   MOVE      ARTNRS        ARSNRS
264410120817     C                   MOVE      ARTNSC        ARSNSC
264420051102     C                   MOVEL     'E'           ARSTRC
264430051102     C                   MOVEL     V8CNOT        ARSNOT
264440051114     C                   MOVEL     dateu         ARSduv
264450051102     C                   WRITE     FIARS000
264460000911     C                   ENDIF
264470000908    1C                   ENDSL
264480051020     c*
264490051020     c                   select
264500120302     C* EXPORT BRT
264510051020     c     A_§ogntw      wheneq    'EEX'
264520051102     C                   CLEAR                   FIARS000
264530120817     C***                MOVE      BLTFLS        ARSFLS
264540120817     C***                MOVE      BLTLNA        ARSLNA
264550120817     C***                MOVE      BLTNRS        ARSNRS
264560120817     C***                MOVE      BLTNSC        ARSNSC
264570120817     C                   MOVE      ARTFLS        ARSFLS
264580120817     C                   MOVE      ARTLNA        ARSLNA
264590120817     C                   MOVE      ARTNRS        ARSNRS
264600120817     C                   MOVE      ARTNSC        ARSNSC
264610051102     C                   MOVEL     'E'           ARSTRC
264620051020     c                   clear                   dsbld7
264630120817     c***                eval      §lclnp=bltfls
264640120817     c***                eval      §lclna=bltlna
264650120817     c***                eval      §lcnrs=bltnrs
264660120817     c***                eval      §lcncd=bltnsc
264670120817     c                   eval      §lclnp=artfls
264680120817     c                   eval      §lclna=artlna
264690120817     c                   eval      §lcnrs=artnrs
264700120817     c                   eval      §lcncd=artnsc
264710051020     c                   eval      §lczsc=blpznc
264720051020     c                   exsr      m10
264730051102     C                   MOVEA     §CA           ARSnot
264740051114     C                   MOVEL     dateu         ARSduv
264750051020     C*
264760051102     C                   WRITE     FIARS000                             30
264770051020     C* EXPORT FEDEX
264780051020     c     A_§ogntw      wheneq    'FED'
264790051102     C                   CLEAR                   FIARS000
264800120817     C***                MOVE      BLTFLS        ARSFLS
264810120817     C***                MOVE      BLTLNA        ARSLNA
264820120817     C***                MOVE      BLTNRS        ARSNRS
264830120817     C***                MOVE      BLTNSC        ARSNSC
264840120817     C                   MOVE      ARTFLS        ARSFLS
264850120817     C                   MOVE      ARTLNA        ARSLNA
264860120817     C                   MOVE      ARTNRS        ARSNRS
264870120817     C                   MOVE      ARTNSC        ARSNSC
264880051102     C                   MOVEL     'F'           ARSTRC
264890051020     c                   movel     wawb          w0012a           12
264900051020     c* calcolo check digit
264910051020     c                   exsr      chkdgf
264920051102     c                   movel     w0012a        ARSnot
264930051114     C                   MOVEL     dateu         ARSduv
264940051020     C*
264950051102     C                   WRITE     FIARS000
264960051020     c                   add       1             wawb
264970051020     C                   ENDsl
264980980318     C                   ENDSR
264990980320     C*--- COMPATTO IL CAP TOGLIENDO TUTTI I BLANK -------------------*
265000980320     C     WRKCAP        BEGSR
265010011120     C     WNO55L        IFEQ      *BLANKS
265020980320     C* Compongo il segnacollo Euroexpress
265030980320     C                   MOVE      *ZEROS        §Y                2 0
265040980320     C                   MOVE      *BLANKS       §S9
265050980320     C                   MOVE      *BLANK        §O9
265060980320     C                   MOVEA     WRKCAD        §S9
265070980320     C* Compatto il cap togliendo tutti i blank
265080980320    2C                   DO        9             §X1               2 0
265090980320    3C     §S9(§X1)      IFNE      *BLANKS
265100980320     C                   ADD       1             §Y
265110980320     C                   MOVE      §S9(§X1)      §O9(§Y)
265120980320    3C                   END
265130980320    2C                   END
265140011120     C                   ENDIF
265150980320     C* Prendo codice iso della nazione
265160980320     C                   MOVEL     '15'          COD
265170980320     C                   MOVEL(P)  BLPNZD        KEY
265180980320     C                   EXSR      CTABEL
265190980320     C   30              CLEAR                   DS15
265200980320     C  N30              MOVEL     TBLUNI        DS15
265210980320     C* Unisco il cap compattato alla nazione
265220980320     C                   MOVEL     §15COD        W15COD            2
265230980320     C                   ENDSR
265240051102     C*--- AGGIORNO FIARS00F -----------------------------------------*
265250051102     C     AGGARS        BEGSR
265260040514     c                   clear                   jf                2 0
265270980320     C                   MOVEL     'E'           WTRC
265280020213    1C     A_§ogntw      IFEQ      'EEX'
265290120817     C***  KBLT1         SETLL     FNBLT01L
265300120817     C***  KBLT1         READE(N)  FNBLT01L                               30
265310120817     C     KBLT1         SETLL     FIART01L
265320120817     C     KBLT1         READE(N)  FIART01L                               30
265330980320    2C     *IN30         DOWEQ     *OFF
265340120817     C***  KARS1         CHAIN     FIARS01L                           30
265350120817     C     KARS1A        CHAIN     FIARS01L                           30
265360980320    3C     *IN30         IFEQ      *OFF
265370051102     c                   eval      jf=%scan(wjut:ARSnot)
265380040514    4c     jf            ifgt      *zeros
265390051102     C                   MOVEL     ARSNOT        DSEEX
265400980320     C* Compatto il cap nuovo e prendo cod.iso
265410980320     C                   MOVEL     VIDCAD        WRKCAD
265420980320     C                   EXSR      WRKCAP
265430011120     C     WNO55L        IFEQ      *BLANKS
265440980320     C                   MOVEA     §O9           WCAD
265450980320     C* Unisco il cap compattato alla nazione salvata
265460980408     C                   CLEAR                   WCADN
265470980320     C     WCAD          CAT       W15COD:0      WCADN
265480011107     C                   ELSE
265490011107     C                   CLEAR                   WCADN
265500011126     C                   CLEAR                   W55L
265510011120     C                   MOVEL     W15COD        W15C
265520011107     C                   ENDIF
265530980320     C*
265540051102     C                   MOVEL     DSEEX         ARSNOT
265550051114     C                   MOVEL     dateu         ARSduv
265560051102     C                   UPDATE    FIARS000
265570040514    4c                   endif
265580980320    3C                   END
265590040514     c     jf            ifgt      *zeros
265600120817     C**** KBLT1         READE(N)  FNBLT01L                               30
265610120817     C     KBLT1         READE(N)  FIART01L                               30
265620040514     c                   else
265630040514     c                   seton                                        30
265640040514     c                   endif
265650980320    2C                   ENDDO
265660980320    1C                   END
265670980320     C                   ENDSR
265680980320     C*--- IMPOSTO CAMPI SEGNAC.EUROEX DA PASSARE A PGM DI STAMPA ----*
265690980320     C     EUREXP        BEGSR
265700040505     C     §ogntw        ifeq      'EEX'
265710980320     C                   MOVEL     'E'           WTRC
265720980320     C                   Z-ADD     CO2SCD        WO2SCD            7 0
265730051102     C     KARS01        CHAIN(N)  FIARS01L                           30
265740980320    2C     *IN30         IFEQ      *OFF
265750980320     C* PASSO AL PGM DI STAMPA ETICHETTE IL N. SEGNACOLLO EUROEXPRESS
265760051102     C                   MOVEL     ARSNOT        §DEEUR
265770120302     C* SE IMPORT BRT METTO NEL CODICE PRODOTTO DELL'ETICHETTA
265780980320     C* ITALIA IL N.SEGNACOLLO EUROEXPRESS
265790000209     C*
265800051102     C                   MOVEA     ARSNOT        W35
265810980330     C                   Z-ADD     1             BB                2 0
265820980330     C     ' '           LOOKUP    W35(BB)                                30
265830980330     C   30              MOVEA     *BLANKS       W35(BB)
265840980330     C                   MOVEA     W35(6)        §LDCDP
265850980320    2C                   ENDIF
265860980320    1C                   ENDIF
265870020212     c* EXPORT FEDEX
265880020213    1C     A_§ogntw      IFEQ      'FED'
265890020212     C                   MOVEL     'F'           WTRC
265900020212     C                   Z-ADD     CO2SCD        WO2SCD            7 0
265910051102     C     KARS01        CHAIN(N)  FIARS01L                           30
265920020212    2C     *IN30         IFEQ      *OFF
265930020212     C* METTO NEL CODICE PRODOTTO DELL'ETICHETTA ITALIA il n.segnac. FEDEX
265940051102     C                   MOVEL     ARSNOT        §ldcdp
265950020212    2C                   ENDIF
265960020212    1C                   ENDIF
265970980320     C                   ENDSR
265980980409     C*
265990980409     C*--- SBORDERIZZAZIONE ------------------------------------------*
266000980409     C     SBORD         BEGSR
266010981020     C                   SETOFF                                       30
266020980409     C     KBLP3         SETLL     FNBLT000
266030980409    1C     *IN30         DOWEQ     *OFF
266040980409     C     KBLP3         READE     FNBLT000                               30
266050980409     C* SOLO SE NON C'E' GIA' LA DATA DI PARTENZA
266060980409    2C  N30BLTDFV        IFEQ      0
266070980409     C                   CLEAR                   BLTNFV
266080980409     C                   UPDATE    FNBLT000
266090120814     c     kfiart        chain     fiart01l
266100120814     c                   if        %found(fiart01l)
266110120814     C                   CLEAR                   ARTNFV
266120120814     C                   UPDATE    FIART000
266130120814     c                   endif
266140980409    2C                   ENDIF
266150980409    1C                   ENDDO
266160980409     C                   ENDSR
266170940916     C*
266180930708     C*--- CHAIN TABEL00F --------------------------------------------*
266190930708     C     CTABEL        BEGSR
266200930708     C     KTAB2         CHAIN     TABEL                              30
266210930708     C  N30TBLFLG        IFNE      ' '
266220930708     C                   SETON                                        30
266230930708     C                   END
266240930708     C                   ENDSR
266250930708     C*
266260930708     C*--- READ  TABEL00F --------------------------------------------*
266270930708     C     RTABEL        BEGSR
266280930708     C     KTAB3         READE     TABEL                                  30
266290930708     C                   ENDSR
266300940214     C*
266310940214     C*--- PASSO DATI PER CALCOLARE CONSEGNA TEORICA -----------------*
266320940214     C     CLSE98        BEGSR
266330970925     C                   CLEAR                   DSSD99
266340940214     C*
266350941230     C     VIDTSP        IFNE      *BLANKS
266360940214     C                   MOVEL     VIDTSP        D98TSP
266370941230     C                   ELSE
266380941230     C                   MOVEL     COMTSP        D98TSP
266390941230     C                   ENDIF
266400940214     C                   MOVEL     VIDCAD        D98CAD
266410970925     C                   MOVEL     VIDLOD        D98LOD
266420950102     C                   MOVEL     VIDNZD        D98NZD
266430940628     C* CALCOLO FLAG INOLTRO
266440940628     C                   EXSR      INOLTR
266450940628     C                   MOVEL     WFIN          D98FIN
266460940214     C*
266470001031     C* TERMINAL DI PARTENZA
266480960130     C                   MOVEL     COMTFP        D98TFP
266490940214     C*
266500001031     C* TERMINAL DI ARRIVO
266510970925     C                   CLEAR                   DSLV55
266520970925     C                   MOVEL     'A'           D55TPT
266530001031     C                   MOVEL     VIDLNP        D55LNP
266540001031     C*
266550970925     C                   MOVEL     COMLNA        D55LIN
266560970925     C                   MOVEL     BLPDSP        D55DRF
266570970925     C                   CALL      'FNLV55R'
266580970925     C                   PARM                    DSLV55
266590970925     C*
266600001031    1C     D55ERR        IFEQ      ' '
266610970925     C                   MOVEL     D55TFA        D98TFA
266620970925     C                   ELSE
266630970925     C                   MOVEL     COMLNA        D98TFA
266640001031    1C                   ENDIF
266650960927     C*
266660970925     C                   MOVEL     VIDLNP        D98LNP
266670970925     C                   MOVEL     COMLNA        D98LNA
266680940214     C                   MOVEL     BLPDSP        D98DSP
266690950102     C                   MOVE      BLPDSP        D98MGS
266700160315     c                   if        vidgc1<>' P' and vidgc1<>' M'
266710940214     C                   MOVEL     VIDGC1        D98GC1
266720160315     c                   endif
266730160315     c                   if        vidgc2<>' P' and vidgc2<>' M'
266740940214     C                   MOVEL     VIDGC2        D98GC2
266750160315     c                   endif
266760950102     C                   MOVEL     §3ATB1        D98TBL
266770950102     C                   MOVEL     WKSC          D98KSC
266780130826     c                   if        %subst(%editc(wksc:'X'):4:4)='9999'
266790130826     c                   move      8888          d98ksc
266800130826     c                   endif
266810100219     c* In alcuni casi, per la delivery, non devo tenere conto dei tempi
266820100219     c*  del C/Ass e fermo deposito
266830100219     c                   if        UsaCass=' '
266840010823     C                   Z-ADD     VIDCAS        D98CAS
266850010823     C                   MOVEL     VIDVCA        D98VCA
266860940214     C                   MOVEL     VIDTIC        D98TIC
266870940214     C                   MOVEL     VIDFFD        D98FFD
266880010214     C     D98FFD        IFEQ      'N'
266890010214     C                   MOVE      *BLANKS       D98FFD
266900010214     C                   ENDIF
266910100219     C                   ENDIF
266920950102     C*
266930970925     C                   CALL      'TNSD99R'
266940970925     C                   PARM                    DSSD99
266950940214     C* FLAG CHE TENGO MEMORIZZATO PER POI CHIUDERE I FILES
266960940214     C                   MOVEL     '1'           WCL98             1
266970940214     C*
266980100219     c                   clear                   UsaCass
266990900427     C                   ENDSR
267000950126     C*
267010950126     C* SPENGO INDICATORI DELLA 1 VIDEATA ---------------------------*
267020950126     C     OFFD01        BEGSR
267030950126     C                   SETOFF                                       404142
267040000313     C                   SETOFF                                       614356
267050950126     C                   SETOFF                                       455150
267060950126     C                   SETOFF                                       626346
267070950126     C                   SETOFF                                       474849
267080950126     C                   SETOFF                                       646566
267090950126     C                   SETOFF                                       676869
267100950126     C                   SETOFF                                       701090
267110950303     C                   SETOFF                                       553871
267120000120     C                   SETOFF                                       5257
267130010222     C                   CLEAR                   H1RIGA
267140010222     C                   CLEAR                   H1COLO
267150010214     C                   CLEAR                   H0RIGA
267160010214     C                   CLEAR                   H0COLO
267170071107     c****               if        dateu<§vpodrt
267180071107     C****               CLEAR                   ATRDRT
267190071107     c****               endif
267200010214     C                   CLEAR                   ATRPDR
267210010214     C                   CLEAR                   ATRCCM
267220010214     C                   CLEAR                   ATRFFD
267230010214     C                   CLEAR                   ATRFPP
267240010220     C                   CLEAR                   ATRLNA
267250010305     C                   CLEAR                   ATRNCL
267260010305     C                   CLEAR                   ATRPKG
267270100319     C                   CLEAR                   ATRTSP
267280950126     C                   ENDSR
267290950126     C*
267300950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE -------------*
267310950126     C     OFFD02        BEGSR
267320950126     C                   SETOFF                                       929399
267330950126     C                   SETOFF                                       414243
267340961111     C                   SETOFF                                       454686
267350950126     C                   SETOFF                                       474849
267360950126     C                   SETOFF                                       505152
267370950126     C                   SETOFF                                       535455
267380950126     C                   SETOFF                                       565759
267390950126     C                   SETOFF                                       606162
267400950126     C                   SETOFF                                       636465
267410950410     C                   SETOFF                                       586667
267420950410     C                   SETOFF                                       686970
267430950126     C                   SETOFF                                       717273
267440950126     C                   SETOFF                                       109040
267450950126     C                   SETOFF                                       808182
267460950126     C                   SETOFF                                       839784
267470961111     C                   SETOFF                                       747586
267480991117     C                   SETOFF                                       77
267490040610     c     atrbva        ifne      prri
267500040610     c                   movel     hiul          atrbva
267510040610     c                   endif
267520040216
267530040301     c                   Eval      wkk = *Off
267540021217
267550021218     c                   Clear                   H2riga
267560021218     c                   Clear                   H2colo
267570021217
267580950126     C                   ENDSR
267590950126     C*
267600950126     C* SPENGO GLI INDICATORI DI POSIZIONAMENTO CURSORE 3 VIDEATA-----*
267610950126     C     OFFD03        BEGSR
267620991025     C                   SETOFF                                       404142
267630991025     C                   SETOFF                                       434546
267640991025     C                   SETOFF                                       474849
267650991025     C                   SETOFF                                       505152
267660991025     C                   SETOFF                                       5390
267670040116     c                   Clear                   Atrsv2
267680040116     c                   Clear                   Atrsv3
267690040116     c                   Clear                   Atrsv4
267700041217     c                   Clear                   Atrsv5
267710041217     c                   Clear                   Atrsv6
267720950126     C                   ENDSR
267730950126     C*
267740950126     C* SE DISK CLIENTI CON "X" ESCO DAL PGM ED EMETTO NUOVA BOLLA----*
267750091111     C     ESCIER        BEGSR
267760950126     C*
267770091111     c* devo entrare se presente errore (90 on) oppure se devo per forza
267780091111     c* emettere una videata
267790020123     c     *in90         ifeq      *on
267800091111     c     wvidobb       oreq      '1'
267810020123     C     §LPFPR        IFEQ      'V'
267820950419     C     §LPFPR        OREQ      'X'
267830950126     C     *IN12         OREQ      *OFF
267840950126     C     *IN15         OREQ      *OFF
267850010305     C     §LPFPR        IFNE      'O'
267860950126     C  N12
267870950126     COR 12
267880950126     CANN15              CLEAR                   §LPFPR
267890070307     C                   ENDIF
267900950126     C*
267910950126     C                   ELSE
267920950126     C*
267930950126     C                   MOVEL     '5'           §LPFPR
267940950126     C                   ENDIF
267950020123     C                   ENDIF
267960950126     C                   ENDSR
267970950127     C* SE E' STATA BATTUTA UNA CHIAVE RICERCA
267980950127     C*          E NON E STATO IMMESSO CODICE-01 ON ABILITATA LA RICERC
267990950127     C     RICALF        BEGSR
268000950127    1C   01WCCM          IFEQ      0
268010950127     C     PAXDMT        ANDNE     *BLANKS
268020950127     C* DESCRIZIONE AZIENDA
268030950127     C                   MOVEL     VIDDSA        PAXDUT           30
268040950127     C* PAXSTA=9 ESCLUDO ANNULLATI
268050950127     C                   Z-ADD     9             PAXSTA
268060950127     C* CAPOCONTO CLIENTI
268070950127     C                   Z-ADD     KCI           PAXCCC
268080950127     C* CODICE DA RICERCARE: SE IMMESSA LNP CERCO SOLO AL SUO INTERNO
268090000207     C                   MOVEL(P)  WFLC          PAXFLR
268100980929     C                   CLEAR                   PAXDIT
268110000121     C                   Z-ADD     1             PAXNUM
268120950127     C*
268130000121     C                   CALL      'XALFA3BR'
268140950127     C                   PARM                    PAXDUT
268150950127     C                   PARM                    CODUT
268160950127     C                   PARM                    PAXDMT
268170950127     C                   PARM                    PAXCCC
268180950127     C                   PARM                    PAXSTA            1 0
268190961016     C                   PARM                    PAXFLR           90
268200980701     C                   PARM                    PAXDIT            3
268210000121     C                   PARM                    PAXNUM            2 0
268220000121     C                   PARM                    PAXKCM           80
268230000121     C                   PARM                    PAXKSM          140
268240000121     C                   PARM                    PAXKDM           60
268250950127     C*
268260950127     C                   MOVEL     '1'           WEMFOR
268270950127     C* NON TROVATO O PREMUTO CMD12
268280950127    2C     PAXSTA        IFGT      -1
268290950127     C* CODICE SELEZIONATO: IMPOSTO A VIDEO
268300000127     C                   MOVEL     PAXKSM        W0070             7 0
268310000127     C                   MOVE      W0070         WCCM
268320000127     C                   MOVEL     W0070         W0030
268330950127     C                   SETON                                        50
268340950127     C*
268350950127     C* SE LA LINEA DEL CODICE NON CORRISPONDE ALLA LINEA PARTENZA
268360960926     C*  IMPOSTO ANCHE IL PUNTO OPEATIVO CLIENTE
268370950127     C     W0030         IFNE      WLNP
268380950127     C                   MOVEL     W0030         WFLC
268390950127     C                   SETON                                        14
268400950127     C                   ENDIF
268410950127    2C                   ENDIF
268420950127    1C                   ENDIF
268430950127     C                   ENDSR
268440950104     C**************************************************************************
268450950104     C*  ABBLANCA ZERO NON SIGNIFICATIVI
268460950104     C**************************************************************************
268470950104     C     ABBL          BEGSR
268480950104     C*
268490950104     C     SKI(I)        DOWEQ     '0'
268500950717     C     I             ANDLT     15
268510950104     C                   MOVEL     ' '           SKI(I)
268520950104     C                   ADD       1             I
268530950717     C                   ENDDO
268540950104     C*
268550950104     C                   ENDSR
268560950717     C**************************************************************************
268570950717     C*  CONTROLLO SEGNACOLLO DOPPIO ALL'INTERNO DELLA STESSA BOLLA
268580950717     C**************************************************************************
268590950717     C     VADDOP        BEGSR
268600020917     C     KBLC          SETLL     FIVAD000
268610020917     C     KBLC          READE(N)  FIVAD000                               30
268620950717     C                   CLEAR                   WNCD
268630950717     C*
268640950717     C     *IN30         DOWEQ     *OFF
268650950717     C*
268660950717     C     WNCD          IFNE      BLDNCD
268670950717     C                   MOVEL     BLDNCD        WNCD
268680020917     C     KBLC          READE(N)  FIVAD000                               30
268690950717     C                   ELSE
268700950717     C                   SETON                                        629030
268710950717     C                   ENDIF
268720950717     C*
268730950717     C                   ENDDO
268740950717     C* PREPARO MESSAGGIO
268750950717     C     *IN90         IFEQ      *ON
268760950717     C                   MOVEA     ERR(120)      K78
268770950717     C                   MOVEL     WNCD          W007A
268780950717     C                   MOVEA     W007A         SKI(9)
268790950717     C                   Z-ADD     9             I                 3 0
268800950717     C                   EXSR      ABBL
268810950717     C                   MOVEA     SKI(9)        K78(37)
268820950717     C                   MOVEA     K78           VIDMSG
268830950717     C                   ENDIF
268840950717     C*
268850950717     C                   ENDSR
268860001031     C**
268870120302     C* STAMPA ETICHETTA ESTERA SDI O BRT ----------------------------*
268880971215     C     ETIEST        BEGSR
268890971215     C*
268900040506     c* entro in questa routine anche per la stampa dell'etichetta Ita
268910040506     c* lia se segnacollo export Euroexpress per impostare la nazione
268920040506     c* §defca viene impostato ma per il momento non utilizzato nel
268930040506     c* pgm di stampa
268940040506     c*
268950081008    1C***  WESTER        IFEQ      'S'
268960081008     c     §detse        ifeq      'EEX'
268970971215     C                   MOVEL     DESCOD        §DEISA
268980971215     C**
268990971215    3C                   SELECT
269000971215     C     FLGTB1        WHENEQ    'A'
269010971215     C     §3AFCA        ANDEQ     0
269020971215     C                   MOVEL     'A'           §DEFCA
269030971215     C     FLGTB1        WHENEQ    'A'
269040971215     C     §3AFCA        ANDNE     0
269050971215     C                   MOVEL     'X'           §DEFCA
269060971215     C     §3AFCA        WHENNE    0
269070971215     C                   MOVEL     'S'           §DEFCA
269080971215    3C                   ENDSL
269090971215    1C                   ENDIF
269100971215     C**
269110971215     C                   ENDSR
269120000901     C*****************************************************
269130000901     C* CALCOLA CIFRA DI CONTROLLO SECONDO IL MODULO 10 IBM
269140000901     C*****************************************************
269150000901     C     M10           BEGSR
269160000901     C                   MOVE      *ZERO         §TT               3 0
269170000906     C                   MOVE      *ZERO         §TT2              3 0
269180000901     C                   MOVE      *ZERO         §1                1 0
269190000901     C                   Z-ADD     18            §S                2 0
269200000901     C                   DO        17            §N                2 0
269210000901     C                   SUB       1             §S
269220000901     C* INTANTO SPOSTO DA UNA SCHIERA AL CAMPO COD.BARRE
269230000901     C                   MOVE      §C(§N)        §CB(§N)
269240000901     C     §N            DIV       2             §CTR              3 0
269250000901     C                   MVR                     §RST              3 030
269260000901     C     *IN(30)       IFEQ      '1'
269270000901     C     §C(§S)        MULT      2             §N2               2 0
269280000901     C                   MOVE      §N2           §A2               2
269290000901     C                   MOVEA     §A2           §2A
269300000901     C                   XFOOT     §2            §CTR
269310000901     C                   ELSE
269320000901     C                   Z-ADD     §C(§S)        §CTR
269330000901     C                   END
269340000901     C                   ADD       §CTR          §TT
269350000901     C                   END
269360000901     C*
269370000901     C     §TT           ADD       9             §TT2
269380000901     C                   MOVE      0             §TT2
269390000901     C     §TT2          SUB       §TT           §1
269400000901     C*
269410000901     C                   MOVE      §1            §CB(18)
269420000901     C                   ENDSR
269430000901     C**************************************************************************
269440020917     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIVAT
269450000901     C**************************************************************************
269460000901     C     CARVAT        BEGSR
269470000905     C* CAMPI SFL CONTROL
269480000912     C                   MOVE      §LPCCN        V8CKSC
269490000905     C                   Z-ADD     KCI           CCC
269500000905     C     KACO          CHAIN     CNACO000                           30
269510000905     C  N30              MOVEL     ACORAG        V8DKSC
269520000905     C   30              MOVEL     *BLANKS       V8DKSC
269530000905     C*
269540000901     C                   Z-ADD     0             NR8
269550000901     C                   MOVEL     'E'           WTRC
269560020917     C     KVAT          SETLL     FIVAT000
269570061010     C     KVAT          READE(N)  FIVAT000                               30
269580000901     C     *IN30         DOWEQ     *OFF
269590000901     C                   MOVEL     *BLANKS       V8CSCE
269600040302     c                   Eval      wtxt = VatNot
269610041117     c                   eval      uppercase = '1'
269620141202     c                   clear                   ElencoChar
269630160112     c                   clear                   TipoElenco
269640040302     c                   ExSr      Sr_Chk
269650040302     c                   Movel     wtxt          V8cNot
269660000908     C                   MOVE      *BLANKS       V8HDKC
269670000908     C                   MOVE      *BLANKS       V8HESG
269680000915     C                   MOVE      *ZEROS        V8HST2
269690000915     C                   CLEAR                   V8HFLS
269700000915     C                   CLEAR                   V8HLNA
269710000915     C                   CLEAR                   V8HNRS
269720000915     C                   CLEAR                   V8HNSC
269730000921     C                   CLEAR                   V8HPRE
269740000901     C* SCRIVO SUBFILE
269750040617     c* potrebbe succcedere che il cliente ci passi più di 500 record
269760040617     c* di vat ma sul vab il numero colli è inferiore a 500
269770040617     c* In questo caso ne carico al max 500
269780040617     c     nr8           ifeq      500
269790040617     c                   seton                                        30
269800040617     c                   else
269810000901     C                   ADD       1             NR8
269820000901     C                   WRITE     LS01S08
269830061010     C     KVAT          READE(N)  FIVAT000                               30
269840040617     c                   endif
269850000901     C                   ENDDO
269860000918     C                   Z-ADD     NR8           SAVNR8
269870000901     C*
269880000901     C                   ENDSR
269890050221     C**************************************************************************
269900050221     C*  CARICAMENTO numero parcel dpd
269910050221     C**************************************************************************
269920050221     C     sr_vatdpd     BEGSR
269930050221     C                   MOVEL     'E'           WTRC
269940050221     c                   clear                   werrvat           1
269950060612     c                   clear                   w014a
269960050221     C     KVAT          SETLL     FIVAT000
269970061010     C     KVAT          READE(N)  FIVAT000                               30
269980050221     C     *IN30         DOWEQ     *OFF
269990050221     c     werrvat       andeq     *blanks
270000060612     c     w014a         ifeq      *blanks
270010060612     c                   if        §ogntw = 'DPD'
270020060612     c                   movel     vatnot        dvate
270030060612     c                   movel     §VATEPRN      w014a
270040060612     c                   else
270050060612     c                   movel     vatnot        w014a
270060060612     c                   endif
270070050221     c                   else
270080050221     c                   eval      werrvat = '1'
270090050221     c                   endif
270100061010     C     KVAT          READE(N)  FIVAT000                               30
270110050221     c                   enddo
270120050221     c                   endsr
270130000901     C**************************************************************************
270140020917     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIVAB O FIVAD
270150000901     C**************************************************************************
270160000901     C     CARVAB        BEGSR
270170000901     C                   Z-ADD     0             NR8
270180000905     C* CAMPI SFL CONTROL
270190000912     C                   MOVE      §LPCCN        V8CKSC
270200000905     C                   Z-ADD     KCI           CCC
270210000905     C     KACO          CHAIN     CNACO000                           30
270220000905     C  N30              MOVEL     ACORAG        V8DKSC
270230000905     C   30              MOVEL     *BLANKS       V8DKSC
270240000901     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
270250000901     C                   CLEAR                   DSBLD7
270260000901     C                   MOVE      §LPLNP        §LCLNP
270270000901     C                   MOVE      §LPLNA        §LCLNA
270280000901     C                   MOVE      §LPNRS        §LCNRS
270290000901     C                   MOVE      §LPZNC        §LCZSC
270300020917     C* SEGNACOLLI SEQUENZIALI: CARICO CHI SONO DA FIVAB
270310000901    1C     §1BFG7        IFNE      'S'
270320000901     C                   MOVE      §LPNCD        §LCNCD
270330000901     C* Calcolo il check digit
270340000901     C                   EXSR      M10
270350000911     C                   MOVEA     §CA           V8CNOT
270360000901     C                   MOVEL     *BLANKS       V8CSCE
270370000908     C                   MOVE      *BLANKS       V8HDKC
270380000908     C                   MOVE      *BLANKS       V8HESG
270390000915     C                   MOVE      *ZEROS        V8HST2
270400000915     C                   CLEAR                   V8HFLS
270410000915     C                   CLEAR                   V8HLNA
270420000915     C                   CLEAR                   V8HNRS
270430000915     C                   CLEAR                   V8HNSC
270440000921     C                   CLEAR                   V8HPRE
270450000901     C                   ADD       1             NR8
270460000901     C                   WRITE     LS01S08
270470101217     c                   movel     v8cnot        chidal
270480000901    2C     §LPNCA        IFGT      *ZEROS
270490001016     C     §LPNCA        ANDNE     §LPNCD
270500101217     C                   MOVE      §LPNCA        §LCNCD
270510101217     C* Calcolo il check digit
270520101217     C                   EXSR      M10
270530101217     C                   MOVEA     §CA           V8CNOT
270540101217     C                   MOVEL     *BLANKS       V8CSCE
270550101217     C                   ADD       1             NR8
270560101217     C                   WRITE     LS01S08
270570101217     c                   movel     v8cnot        chial
270580101217     c     chidal        downe     chial
270590101216     C                   CLEAR                   DSLSZ1
270600101216     C                   MOVEL     'E'           IZ1MOD
270610101216     C                   MOVEL     CHIDAL        IZ1CH1
270620101216     C                   Z-ADD     V8CKSC        IZ1CCM
270630101216     C                   MOVEL     wctm          IZ1CTM
270640101216     C                   Z-ADD     §lpnrs        IZ1NRS
270650101216     C                   CALL      'FNLSZ1R'
270660101216     C                   PARM                    KPJBA
270670101216     C                   PARM                    DSLSZ1
270680101216     C                   PARM                    DS1B
270690101217     c     oz1chi        ifne      chial
270700101216     C                   MOVEL     OZ1CHI        V8CNOT
270710000901     C                   MOVEL     *BLANKS       V8CSCE
270720000901     C                   ADD       1             NR8
270730000901     C                   WRITE     LS01S08
270740000901    2C                   ENDIF
270750101217     c                   eval      chidal=oz1chi
270760101217     c                   enddo
270770101217     c                   endif
270780000918     C                   Z-ADD     NR8           SAVNR8
270790000901   X1C                   ELSE
270800020917     C* ALTRIMENTI LI CARICO DA FIVAD
270810020917     C     KBLC          SETLL     FIVAD000
270820020917     C     KBLC          READE     FIVAD000                               30
270830000904    2C     *IN30         DOWEQ     *OFF
270840000904    3C     BLDNCA        IFEQ      0
270850000904     C                   Z-ADD     BLDNCD        BLDNCA
270860000904    3C                   ENDIF
270870000904     C*
270880000904    3C     BLDNCD        DOWLE     BLDNCA
270890000904     C     BLDNCD        ANDGT     0
270900000904     C                   MOVE      BLDNCD        §LCNCD
270910000904     C* Calcolo il check digit
270920000904     C                   EXSR      M10
270930000911     C                   MOVEA     §CA           V8CNOT
270940000901     C                   MOVEL     *BLANKS       V8CSCE
270950000908     C                   MOVE      *BLANKS       V8HDKC
270960000908     C                   MOVE      *BLANKS       V8HESG
270970000915     C                   MOVE      *ZEROS        V8HST2
270980000915     C                   CLEAR                   V8HFLS
270990000915     C                   CLEAR                   V8HLNA
271000000915     C                   CLEAR                   V8HNRS
271010000915     C                   CLEAR                   V8HNSC
271020000921     C                   CLEAR                   V8HPRE
271030000901     C* SCRIVO SUBFILE
271040000901     C                   ADD       1             NR8
271050000901     C                   WRITE     LS01S08
271060000904     C                   ADD       1             BLDNCD
271070000904    3C                   ENDDO
271080020917     C     KBLC          READE     FIVAD000                               30
271090000904    2C                   ENDDO
271100000918     C                   Z-ADD     NR8           SAVNR8
271110000904     C*
271120000904    1C                   ENDIF
271130000901     C*
271140000901     C                   ENDSR
271150140506     C**************************************************************************
271160140506     C*  CARICAMENTO SUBFILE COD. "CHI SONO" DA FIART (dirottamenti)
271170140506     C**************************************************************************
271180140506     C     CARART        BEGSR
271190140506     C                   Z-ADD     0             NR8
271200140506     C* CAMPI SFL CONTROL
271210140506     C                   MOVE      §LPCCN        V8CKSC
271220140506     C                   Z-ADD     KCI           CCC
271230140506     C     KACO          CHAIN     CNACO000                           30
271240140506     C  N30              MOVEL     ACORAG        V8DKSC
271250140506     C   30              MOVEL     *BLANKS       V8DKSC
271260140506     C* IMPOSTO CAMPI FISSI CHE COMPONGONO IL CHI SONO
271270140506     C                   CLEAR                   DSBLD7
271280140506     c     kbolm         chain     fnarb01l
271290140506     c                   if        %found(fnarb01l)
271300140710     C                   MOVE      arbfls        §LCLNP
271310140506     C                   MOVE      arbnrs        §LCNRS
271320140716     C                   MOVE      arbZNC        §LCZSC
271330140506     C                   MOVE      arbLNA        §LCLNA
271340140506     c                   endif
271350140506     C*
271360140506     C     Kbolm         SETLL     fiart01l
271370140506     C     kbolm         READE(n)  fiart01l
271380140506    2C                   DOW       not %eof(fiart01l)
271390140506     C*
271400140506     C                   MOVE      artnsc        §LCNCD
271410140716     c* Prendo zona dall'ultima spunta fatta. Se non trovo spunte
271420140716     c* tengo la zona della bolla
271430140716     c                   exsr      sr_zona
271440140716     c                   if        wokzona='1'
271450140716     C                   MOVE      wznbrv        §LCZSC
271460140716     c                   else
271470140716     C                   MOVE      arbZNC        §LCZSC
271480140716     c                   endif
271490140506     C* Calcolo il check digit
271500140506     C                   EXSR      M10
271510140506     C                   MOVEA     §CA           V8CNOT
271520140506     C                   MOVEL     *BLANKS       V8CSCE
271530140506     C                   MOVE      *BLANKS       V8HDKC
271540140506     C                   MOVE      *BLANKS       V8HESG
271550140506     C                   MOVE      *ZEROS        V8HST2
271560140506     C                   CLEAR                   V8HFLS
271570140506     C                   CLEAR                   V8HLNA
271580140506     C                   CLEAR                   V8HNRS
271590140506     C                   CLEAR                   V8HNSC
271600140506     C                   CLEAR                   V8HPRE
271610140506     C* SCRIVO SUBFILE
271620140506     C                   ADD       1             NR8
271630140506     C                   WRITE     LS01S08
271640140506     C     kbolm         READE(n)  fiart01l
271650140506    2C                   ENDDO
271660140506     C                   Z-ADD     NR8           SAVNR8
271670140506     C*
271680140506     C*
271690140506     C                   ENDSR
271700140716     C**************************************************************************
271710140716     C*  determinazinoe zona segnacollo da spunta
271720140716     C**************************************************************************
271730140716     C     sr_zona       BEGSR
271740140716     c
271750140716     c                   clear                   wznbrv
271760140716     c                   clear                   wokzona
271770140716     c     kbrv7z        setll     fnbrv07l
271780140716     c     kbrv7z        reade     fnbrv07l
271790140716     c                   dow       not %eof(fnbrv07l)
271800140716     c* scarto se categoria 8 o manca la data caricamento (spunta autogenerata)
271810140716     c                   if        brvnpg<>8 and brvdcs>0
271820140716     c                   if        wokzona=*blanks or
271830140716     c                             brvdfs>wdfs or
271840140716     c                             (brvdfs=wdfs and brvhms>whms)
271850140716     c                   z-add     brvznc        wznbrv
271860140716     c                   eval      wokzona='1'
271870140716     c                   z-add     brvdfs        wdfs
271880140716     c                   z-add     brvhms        whms
271890140716     c                   endif
271900140716     c                   endif
271910140716     c     kbrv7z        reade     fnbrv07l
271920140716     c                   enddo
271930140716     c                   endsr
271940000913     C**************************************************************************
271950051102     C*  CARICAMENTO SUBFILE COD. CHI SONO DA FIARS
271960000913     C**************************************************************************
271970051102     C     CARARS        BEGSR
271980000913     C* CAMPI SFL CONTROL
271990000913     C                   MOVE      WKSC          V8CKSC
272000000913     C                   Z-ADD     KCI           CCC
272010000913     C     KACO          CHAIN     CNACO000                           30
272020000913     C  N30              MOVEL     ACORAG        V8DKSC
272030000913     C   30              MOVEL     *BLANKS       V8DKSC
272040000913     C*
272050000913     C                   MOVEL     *BLANKS       V8CSCE
272060051102     C                   MOVEL     ARSNOT        V8CNOT
272070000913     C                   MOVE      *BLANKS       V8HDKC
272080000913     C                   MOVE      *BLANKS       V8HESG
272090000915     C                   MOVE      *ZEROS        V8HST2
272100051102     C                   Z-ADD     ARSFLS        V8HFLS
272110051102     C                   Z-ADD     ARSLNA        V8HLNA
272120051102     C                   Z-ADD     ARSNRS        V8HNRS
272130051102     C                   Z-ADD     ARSNSC        V8HNSC
272140000913     C* SCRIVO SUBFILE
272150000913     C                   ADD       1             NR8
272160000913     C                   WRITE     LS01S08
272170160302
272180160302     c                   if        a_§ogntw='FED'
272190160302     c                   eval      wtip=%subst(arsnot:1:2)
272200160302     c                   endif
272210000913     C*
272220000913     C                   ENDSR
272230031114      *------------------------------------------------------------------------*
272240031114      *  CARICAMENTO DATI DA FIVAT00F
272250031114      *------------------------------------------------------------------------*
272260031114     c     Sr_CarVat     BegSr
272270110818     c**
272280110818     c** N.B: l'elenco dei tipi record del fivat e le relative descrizioni
272290110818     c**      sono interrogabili sulla tabella "VAT"
272300110818     c**
272310031125     c                   Clear                   dVato
272320031125
272330031114      * Leggo FIVAT00f
272340031114     c     kVat1         Setll     Fivat01l
272350031114     c                   Do        *Hival
272360061010     c     kVat1         Reade(N)  Fivat01l
272370031114     c                   If        %Eof(Fivat01l)
272380031114     c                   Leave
272390031114     c                   EndIf
272400031114      * Escludo i record "E"
272410031114     c                   If        VatTrc = 'E'
272420031114     c                   Iter
272430031114     c                   EndIf
272440040302
272450040302      * Controllo i dati inviati dal cliente, tranne il rcd 'O' xchè è tutto
272460040302      * numerico
272470141202      * per tipo record "Y"  - PIN CODE i controlli non li devo fare in
272480141202      * questo momento
272490141202     c                   If        VatTrc <> 'O' and
272500141202     c                             VatTrc <>'Y'
272510040302     c                   Eval      wtxt = VatNot
272520131003     c                   clear                   uppercase
272530141202     c                   clear                   ElencoChar
272540160112     c                   clear                   TipoElenco
272550040302     c                   ExSr      Sr_Chk
272560040302     c                   Movel     wtxt          VatNot
272570040302     c                   EndIf
272580031114      * Imposto i campi in base al tipo record
272590031114     c                   Select
272600031114      * Referente
272610031114     c                   When      VatTrc = 'A'
272620031114     c                   Eval      VidRef = VatNot
272630031114      * Telefono
272640031114     c                   When      VatTrc = 'B'
272650031114     c                   Eval      VidTel = VatNot
272660031125      * Bancali x particolarità varia 'O'
272670031125     c                   When      VatTrc = 'O'
272680031125     c                   Movel     VatNot        dVato
272690031219      * Riferimento partener estero
272700031219     c                   When      VatTrc = 'C'
272710031219     c                   Movel     VatNot        wrifp
272720110510      * E-mail al destinatario - indirizzo
272730110510     c                   When      VatTrc = 'I'
272740150213     c*                  Clear                   atremd
272750150213     c*                  Clear                   atrwemd
272760110510     c                   Movel     VatNot        wemdest
272770110512     c                   When      VatTrc = 'J'
272780150213     c*                  Clear                   atremd
272790150213     c*                  Clear                   atrwemd
272800110512     c                   if        wemdest<>*blanks
272810110512     c                   eval      wemdest=%trimr(wemdest) + vatnot
272820110512     c                   else
272830110512     c                   Movel     VatNot        wemdest
272840110512     c                   endif
272850110704      * codici CUP e CIG per tracciabilità flussi finanziari
272860110704     c                   when      VatTrc='4'
272870110704     c                   movel     vatnot        dvat4
272880120606     c                   exsr      impocupcig
272890120606     c***                eval      Wcupcup=§vat4cup
272900120606     c***                eval      Wcupcig=§vat4cig
272910130315     c* numero di telefono per invio sms
272920130918     c* flag per negare l'invio di mail per merce partita
272930130315     c                   when      VatTrc='S'
272940130315     c                   Movel     VatNot        dVats
272950130403     c                   eval      wsms=§vatstel
272960150213     c*                  if        wsms<>*blanks
272970150213     c*                  clear                   atremd
272980150213     c*                  clear                   atrwtel
272990150213     c*                  endif
273000130930     c                   clear                   wsmp
273010130930     c                   if        wsms<>*blanks and §vatssmp<>'N'
273020130930     c                   eval      wsmp='S'
273030130930     c                   endif
273040130918     c                   eval      wmmp=§vatsmmp
273050141031      * PIN CODE
273060141031     c                   when      VatTrc='Y'
273070141031     c                   Movel     VatNot        wPinCode
273080141202     c* memorizzo la lunghezza del PIN ricevuto dal cliente
273090141202     c                   eval      lenPC=%checkr(' ':vatnot)
273100031219      * Altri record non li carico
273110031219     c                   Other
273120031219     c                   Iter
273130031114
273140031114     c                   EndSl
273150031114
273160031114     c                   EndDo
273170150213
273180150213     c* Se ho il numero di cellulare lo metto anche nel Tel.Dest. se manca
273190150213     c                   if        wsms<>*blanks and vidtel=*blanks
273200150216      /free
273210150216       pInCell = %trim(wsms);
273220150216       pOutErr = *blanks;
273230150216       if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
273240150216           // Numero di cellulare KO
273250150216           clear wsms;
273260150216       else;
273270150216           vidtel=wsms;
273280150216       endif;
273290150216      /end-free
273300150213     c                   endif
273310160510     c* se ho l'indirizzo e-mail, se errato lo clearo
273320160510     c                   if        wemdest<>*blanks
273330160510     c                   exsr      sr_chkemd
273340160510      * Errore
273350160510if  3c                   If        §emlerro <> '0'
273360160510     c                   clear                   wemdest
273370160510     c                   else
273380160510     c                   Eval      wemdest = §emlindo
273390160510     c                   endif
273400160510     c                   endif
273410160511     c                   eval      sav_wemdest=wemdest
273420160511     c                   eval      sav_wsms   =wsms
273430031114
273440031114     c                   EndSr
273450040302      *---------------------------------------------------------
273460040302      * Controllo i caratteri dei campi alfanumerici
273470040302      *---------------------------------------------------------
273480040302     c     Sr_Chk        BegSr
273490040302
273500040302     c                   Eval      TxtInOut = wtxt
273510040302     c                   Call      'XCHKCHAR'
273520040302     c                   Parm                    TxtInOut
273530040302     c                   Parm                    ElencoChar
273540040302     c                   Parm                    TipoElenco
273550040302     c                   Parm                    CharSost
273560040302     c                   Parm                    UpperCase
273570040302     c                   Parm                    ChkNull
273580040302     c                   Parm                    CharNull
273590040302     c                   Parm                    Esito
273600040302     c                   If        Esito = '1'
273610040302     c                   Move      TxtInOut      wtxt
273620040302     c                   EndIf
273630040302
273640040302     c                   EndSr
273650140110      *---------------------------------------------------------
273660140110      * Controllo caratteri di punteggiatura precedenti e seguenti
273670140110      *---------------------------------------------------------
273680140110     c     chkstringa    BegSr
273690140110
273700140110     c* trovo la prima posizione "buona" da utilizzare
273710160112     c                   eval      posl=%check(charnooki:wtxt)
273720140207     c* trovo l'ultima posizione "buona" da utilizzare (escludo il ".")
273730140207     c                   eval      posr=%checkr(charnookf:wtxt)
273740140207     c                   if        posl=0
273750140207     c                   clear                   wtxt
273760140207     c                   else
273770140110     c* determino la lunghezza della stringa "buona"
273780140110     c                   eval      lung=(posr-posl)+1
273790140207     c                   eval      wtxt=%subst(wtxt:posl:lung)
273800140110     c                   endif
273810140110
273820140110     c                   EndSr
273830120606      *---------------------------------------------------------
273840120606      * Verifica e impostazione CUP e  CIG ricevuti dal cliente
273850120606      *---------------------------------------------------------
273860120606     c     impocupcig    BegSr
273870120606     c                   clear                   wstringa
273880120606     c     '0':' '       xlate     §vat4cup      wstringa
273890120606     c                   if        wstringa<>*blanks
273900120606     c                   eval      Wcupcup=§vat4cup
273910120606     c                   endif
273920120606     c                   clear                   wstringa
273930120606     c     '0':' '       xlate     §vat4cig      wstringa
273940120606     c                   if        wstringa<>*blanks
273950120606     c                   eval      Wcupcig=§vat4cig
273960120606     c                   endif
273970120606     c                   EndSr
273980110512      *---------------------------------------------------------
273990110512      * Controllo indirizzo email destinatario
274000110512      *---------------------------------------------------------
274010110512     c     Sr_Chkemd     BegSr
274020110512     c                   Clear                   dsemail
274030110512     c                   Eval      §emlindi = wemdest
274040110512     c                   Call      'XEMAIL'
274050110512     c                   Parm                    dsemail
274060110512     c                   EndSr
274070031125      *------------------------------------------------------------------------*
274080031125      *  CONTROLLO CHE DATI TENERE PER I BANCALI
274090031125      *------------------------------------------------------------------------*
274100031125     c     Sr_CtrBancali BegSr
274110031125
274120031125     c                   Clear                   wgva
274130031125
274140031126     c                   Select
274150031126      * particolarità varia 'O'
274160031126w   1c                   When      %subst(VidGva:1:1) = 'O'
274170031126      * dati trovati in FIVAT rcd 'O'
274180031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
274190031126      * carico i dati del FIVAT
274200031126     c                   Clear                   VidTba
274210031126     c                   If        §VatoTba > *Zeros
274220031126     c                   Movel     §VatoTba      VidTba
274230031126     c                   EndIf
274240031126     c                   Eval      VidNba = §VatoNba
274250031126     c                   Eval      SavNba = §VatoNba
274260031126     c                   Clear                   VidTb2
274270031126     c                   If        §VatoTb2 > *Zeros
274280031126     c                   Movel     §VatoTb2      VidTb2
274290031126     c                   EndIf
274300031126     c                   Eval      VidNb2 = §VatoNb2
274310031126     c                   Eval      SavNba = §VatoNb2
274320031126     c                   Eval      w03Cor = §VatoCor
274330031126     c                   Eval      w03Csf = §VatoCsf
274340031126      * dati non trovati in FIVAT rcd 'O'
274350031126   x2c                   Else
274360031126      * pulisco i campi del video
274370031126     c                   Clear                   VidTba
274380031126     c                   Clear                   VidNba
274390031126     c                   Clear                   SavNba
274400031126     c                   Clear                   VidTb2
274410031126     c                   Clear                   VidNb2
274420031126     c                   Clear                   SavNba
274430031126    2c                   EndIf
274440031126
274450031126      * particolarità varia 'B'
274460031126w   1c                   When      %subst(VidGva:1:1) = 'B'
274470031126      * dati trovati in FIVAT rcd 'O'
274480031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
274490031126      * pulisco i dati del FIVAT
274500031126     c                   Clear                   dVato
274510031126    2c                   EndIf
274520031126
274530031126      * particolarità varia = ' '
274540031126w   1c                   When      %subst(VidGva:1:1) = ' '
274550031126      * dati trovati in FIVAT rcd 'O'
274560031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
274570031126      * carico i dati del FIVAT
274580031126     c                   Clear                   VidTba
274590031126     c                   If        §VatoTba > *Zeros
274600031126     c                   Movel     §VatoTba      VidTba
274610031126     c                   EndIf
274620031126     c                   Eval      VidNba = §VatoNba
274630031126     c                   Eval      SavNba = §VatoNba
274640031126     c                   Clear                   VidTb2
274650031126     c                   If        §VatoTb2 > *Zeros
274660031126     c                   Movel     §VatoTb2      VidTb2
274670031126     c                   EndIf
274680031126     c                   Eval      VidNb2 = §VatoNb2
274690031126     c                   Eval      SavNba = §VatoNb2
274700031126     c                   Eval      w03Cor = §VatoCor
274710031126     c                   Eval      w03Csf = §VatoCsf
274720031126      * imposto un flag per emettere un msg mirato in seconda videata
274730031126     c                   Eval      wgva = 'O'
274740031126      * dati non trovati in FIVAT rcd 'O'
274750031126   x2c                   Else
274760031126      * se ho i bancali
274770031126if  3c                   If        §LpNba > *Zeros or §LpNb2 > *Zeros
274780031126      * imposto un flag per emettere un msg mirato in seconda videata
274790031126     c                   Eval      wgva = 'B'
274800031126    3c                   EndIf
274810031126    2c                   EndIf
274820031126
274830031126   o1c                   other
274840031126      * dati trovati in FIVAT rcd 'O'
274850031126if  2c                   If        §VatoNba > *Zeros or §VatoNb2 > *Zeros
274860031126      * pulisco i dati del FIVAT
274870031126     c                   Clear                   dVato
274880031126      * dati non trovati in FIVAT rcd 'O'
274890031126   x2c                   Else
274900031126      * pulisco i campi del video
274910031126     c                   Clear                   VidTba
274920031126     c                   Clear                   VidNba
274930031126     c                   Clear                   SavNba
274940031126     c                   Clear                   VidTb2
274950031126     c                   Clear                   VidNb2
274960031126     c                   Clear                   SavNba
274970031126    2c                   EndIf
274980031126
274990031126    1c                   EndSl
275000031125
275010031125     c                   EndSr
275020000904     C**************************************************************************
275030000904     C*  GESTIONE VIDEATA MANUTENZIONE COD. CHI SONO
275040000904     C**************************************************************************
275050000904     C     GESD08        BEGSR
275060000905     C  N90              Z-ADD     1             V8CNBR
275070000904     C                   CLEAR                   V8ZMSG
275080000905     C   90              MOVEL     W08MSG        V8ZMSG
275090000928     C* SE DSIK C EX DISK BI ACCENDO 33 PER DISABILITARE F9-AGGIUNTA
275100000928     C     §1BF12        IFEQ      'B'
275110000928     C                   SETON                                        33
275120000928     C                   ENDIF
275130000904     C* EMISSIONE VIDEATA
275140000904     C     EMD08         TAG
275150000904     C                   WRITE     LS01Z08
275160000904     C                   EXFMT     LS01C08
275170000911     C                   SETOFF                                       6190
275180000904     C                   CLEAR                   V8ZMSG
275190000904     C     *INKL         CABEQ     *ON           ENDD08
275200010504     C* CONTROLLO EVENTUALI RECORD ANNULLATI E LI TOLGO DALLA SCHIERA
275210010504     C* DI WORK
275220010504     C                   EXSR      CTRS8A
275230000904     C* F9=AGGIUNTA CODICI
275240000904     C     *INKI         IFEQ      *ON
275250000904     C                   EXSR      GESD09
275260000914     C     *INKL         CABEQ     *ON           ENDD08
275270000904     C                   ENDIF
275280010504     C* CONTROLLO DATI
275290010504     C                   EXSR      CTRS08
275300010504     C   90              MOVEL     W08MSG        V8ZMSG
275310010504     C  NKF
275320010504     COR 90              GOTO      EMD08
275330000904     C     ENDD08        ENDSR
275340000830     C**************************************************************************
275350000830     C*  GESTIONE VIDEATA INSERIMENTO COD. CHI SONO
275360000830     C**************************************************************************
275370000904     C     GESD09        BEGSR
275380000905     C* QUESTA ROUTINE POTREBBE ESSERE RICHIAMATA DURANTE LA MANUTENZIO
275390000905     C* NE DEL SUBFILE: IN QUESTO CASO DEVO MANTENERE IL POSIZIONAMENTO
275400000905     C* NEL SUBFILE CHE C'È GIA'
275410000904     C     V8CNBR        IFEQ      0
275420000830     C                   Z-ADD     1             V8CNBR
275430000904     C                   ENDIF
275440000918     C                   Z-ADD     SAVNR8        NR8
275450051121     c                   write     ls01d08
275460000904     C     EMD09         TAG
275470000830     C                   WRITE     LS01C08
275480000830     C                   EXFMT     LS01D09
275490000904     C                   SETOFF                                       61
275500000921     C* SCRIVO SUBFILE (SE CHI SONO GIA' IMMESSO NON LO RICARICO E NON
275510000921     C* DO ERRORE)
275520000830     C     V9CNOT        IFNE      *BLANKS
275530000921     C     V9CNOT        LOOKUP    CH2                                    31
275540000921     C     *IN31         IFEQ      *OFF
275550000830     C                   ADD       1             NR8
275560000830     C                   Z-ADD     NR8           V8CNBR
275570000911     C                   MOVEL     V9CNOT        V8CNOT
275580000830     C                   CLEAR                   V8CSCE
275590000908     C                   CLEAR                   V8HDKC
275600000908     C                   CLEAR                   V8HESG
275610000915     C                   CLEAR                   V8HST2
275620000915     C                   CLEAR                   V8HFLS
275630000915     C                   CLEAR                   V8HLNA
275640000915     C                   CLEAR                   V8HNRS
275650000915     C                   CLEAR                   V8HNSC
275660000921     C                   CLEAR                   V8HPRE
275670000830     C                   WRITE     LS01S08
275680000921     C                   SETON                                        78
275690000921     C                   ADD       1             I2                3 0
275700000921     C                   MOVE      V9CNOT        CH2(I2)
275710000921     C                   ENDIF
275720000911     C                   CLEAR                   V9CNOT
275730000830     C                   ENDIF
275740000918     C                   Z-ADD     NR8           SAVNR8
275750000905     C* PER F6 ESCO DALLA VIDEATA DI IMMISSIONE "CHI SONO"
275760000914     C     *INKF         IFEQ      *OFF
275770000914     C     *INKL         ANDEQ     *OFF
275780000914     C                   GOTO      EMD09
275790000914     C                   ENDIF
275800000830     C                   ENDSR
275810000830     C**************************************************************************
275820000830     C*   CONTROLLO SUBFILE CHI SONO
275830000905     C**************************************************************************
275840000830     C     CTRS08        BEGSR
275850000830     C                   CLEAR                   CHI
275860000907     C                   CLEAR                   POS
275870021119     c                   Clear                   Prefisso
275880000830     C                   CLEAR                   W08MSG
275890000830     C                   Z-ADD     0             IX                4 0
275900000911    0C     *IN78         IFEQ      *ON
275910000830     C                   Z-ADD     1             NR8
275920000921     C                   SETOFF                                       9061
275930000830     C     NR8           CHAIN     LS01S08                            31
275940000831    1C     *IN31         DOWEQ     *OFF
275950000904     C* IGNORO CODICE SE ANNULLATO
275960000904   1AC     V8CSCE        IFEQ      ' '
275970000904     C* IL CODICE CHI SONO NON DEVE ESSERE RIPETUTO ALL'INTERNO
275980000904     C* DEL SUBFILE
275990000830     C     V8CNOT        LOOKUP    CHI                                    31
276000000831    2C     *IN31         IFEQ      *ON
276010000830     C* SE IL CODICE È DOPPIO ERRORE - ESCO DAL CICLO MEMORIZZANDO IL
276020000830     C* NRR IN ERRORE
276030000905     C                   Z-ADD     NR8           V8CNBR
276040000905     C                   SETON                                        9061
276050000911     C     WC01FG        IFEQ      'C'
276060000831     C                   MOVEL     ERR(205)      W08MSG
276070000911     C                   ELSE
276080000911     C                   MOVEA     ERR(205)      K78
276090000911     C                   MOVEA     *BLANKS       K78(44)
276100000911     C                   MOVEA     K78           W08MSG
276110000911     C                   ENDIF
276120000905     C                   UPDATE    LS01S08
276130000831     C                   GOTO      ENDS08
276140000831    2C                   ENDIF
276150021119      * Controllo prefisso chi sono
276160021119     c                   Movel     V8cNot        Wpre
276170080307     c     digits        check     v8cnot:3      wy
276180021119      * prefisso "FD" o "FM possibile solo per bolle FedEx
276190080307      * (se è seguito da 12 cifre)
276200021119     c                   If        (Wpre = 'FD' or Wpre = 'FM')
276210021119     c                              and A_§OgNtw <> 'FED' and
276220021119     c                                   VidDpd <> 'F'
276230080307     c                              and wy=15
276240021119     c                   Z-Add     Nr8           V8cNbr
276250021119     c                   Eval      *In90 = *On
276260021119     c                   Eval      *In61 = *On
276270021119     c                   Movel     Err(261)      W08Msg
276280021119     c                   Update    Ls01s08
276290021119     c                   GoTo      EndS08
276300021119     c                   EndIf
276310021119      * solo per bolle FedEx
276320021119If  2c                   If        (VidDpd = 'F' or A_§OgNtw = 'FED')
276330021119     c                              and ix > 1
276340021119      * immesso prefisso "FM" o "FD"
276350021119      * tutti i segnacolli devono avere lo stesso prefisso
276360021119If  3c                   If        (Wpre = 'FD' or Wpre = 'FM')
276370021119     c     Wpre          Lookup    Prefisso                               30
276380021119      * Deve essere lo stesso prefisso già inserito
276390021119If  4c                   If        Not *In30
276400021119     c                   Z-Add     Nr8           V8cNbr
276410021119     c                   Eval      *In90 = *On
276420021119     c                   Eval      *In61 = *On
276430021119     c                   Movel     Err(260)      W08Msg
276440021119     c                   Update    Ls01s08
276450021119     c                   GoTo      EndS08
276460021119    4c                   EndIf
276470021119   x3c                   Else
276480021119      * immesso altro prefisso
276490021119      * non devono essere stati inseriti prefissi "FD" o "FM"
276500021119     c     'FD'          Lookup    Prefisso                               30
276510021119If  4c                   If        *In30
276520021119     c                   Z-Add     Nr8           V8cNbr
276530021119     c                   Eval      *In90 = *On
276540021119     c                   Eval      *In61 = *On
276550021119     c                   Movel     Err(260)      W08Msg
276560021119     c                   Update    Ls01s08
276570021119     c                   GoTo      EndS08
276580021119    4c                   EndIf
276590021119     c     'FM'          Lookup    Prefisso                               30
276600021119If  4c                   If        *In30
276610021119     c                   Z-Add     Nr8           V8cNbr
276620021119     c                   Eval      *In90 = *On
276630021119     c                   Eval      *In61 = *On
276640021119     c                   Movel     Err(260)      W08Msg
276650021119     c                   Update    Ls01s08
276660021119     c                   GoTo      EndS08
276670021119    4c                   EndIf
276680021119    3c                   EndIf
276690021119    2c                   EndIf
276700020308     c* Richiamo routine per controllare che cod. chi sono non sia
276710020308     c* doppio su fisgn e su blp (se segnacollo euroexpress)
276720020308     c                   eval      w8hcol = v8hcol
276730020308     c                   eval      w8cnot = v8cnot
276740020308     c                   eval      wnopos = ' '
276750020308     c                   exsr      ctrchidop
276760020308     c   90              goto      ends08
276770020308     C* SE NON C'È ERRORE MEMORIZZO IN SCHIERA
276780020308     C                   ADD       1             IX
276790020308     C                   MOVE      V8CNOT        CHI(IX)
276800020308     C                   Z-ADD     NR8           POS(IX)
276810021119      * Mi carico un Sk con solo il prefisso dei chi sono
276820021119     c                   Movel     Chi(ix)       Prefisso(ix)
276830000904   1AC                   ENDIF
276840000921     C                   UPDATE    LS01S08
276850000830     C                   ADD       1             NR8
276860000830     C  N90NR8           CHAIN     LS01S08                            31
276870000831    1C                   ENDDO
276880000911     C   31              SUB       1             NR8
276890000911    0C                   ENDIF
276900000907     C     IX            IFEQ      *ZEROS
276910000905     C                   SETON                                        90
276920000911     C     WC01FG        IFEQ      'C'
276930000905     C                   MOVEL     ERR(152)      W08MSG
276940000911     C                   ELSE
276950000911     C                   MOVEA     ERR(152)      K78
276960000911     C                   MOVEA     *BLANKS       K78(27)
276970000911     C                   MOVEA     K78           W08MSG
276980000911     C                   ENDIF
276990000911     C                   GOTO      ENDS08
277000000905     C                   ENDIF
277010000907     C* Richiamo pgm controllo Cod."CHI SONO"
277020010306     C* Se inseriti solo 2 codici E NUMERO COLLI A VIDEO > DI 2
277030000918     C* si potrebbe trattare di un dal/al
277040000907     C* e quindi richiamo pgm una volta sola passando entrambi i codici
277050000907    1C     IX            IFEQ      2
277060010306     C     V1CNCL        ANDGT     2
277070000907     C                   CLEAR                   DSLSZ1
277080000907     C                   MOVEL     'C'           IZ1MOD
277090000911     C                   MOVEL     WCTM          IZ1CTM
277100000907     C                   Z-ADD     V8CKSC        IZ1CCM
277110000907     C     §1BF12        IFEQ      'B'
277120000907     C                   Z-ADD     §LPNRS        IZ1NRS
277130000907     C                   ENDIF
277140000907     C                   MOVEL     CHI(1)        IZ1CH1
277150000907     C                   MOVEL     CHI(2)        IZ1CH2
277160000907     C                   CALL      'FNLSZ1R'
277170010402     C                   PARM                    KPJBA
277180000907     C                   PARM                    DSLSZ1
277190000907     C                   PARM                    DS1B
277200000907    2C     OZ1ERR        IFNE      ' '
277210000907    3C     OZ1ECH        IFEQ      '1'
277220000907     C                   Z-ADD     POS(1)        V8CNBR
277230000907   X3C                   ELSE
277240000907     C                   Z-ADD     POS(2)        V8CNBR
277250000907    3C                   ENDIF
277260000918     C     V8CNBR        CHAIN     LS01S08                            31
277270000907     C                   SETON                                        9061
277280000911     C     WC01FG        IFEQ      'C'
277290000907     C                   MOVEL     ERR(208)      W08MSG
277300000911     C                   ELSE
277310000911     C                   MOVEA     ERR(208)      K78
277320000911     C                   MOVEA     *BLANKS       K78(45)
277330000911     C                   MOVEA     K78           W08MSG
277340000911     C                   ENDIF
277350000907     C                   UPDATE    LS01S08
277360000911     C                   GOTO      ENDS08
277370000908     C                   ELSE
277380000908     C* SE NO ERRORE MEMORIZZO IL NUMERO DEI COLLI
277390000908     C                   Z-ADD     OZ1NCL        IX
277400020308    3c     oz1ncl        ifgt      2
277410020308     c                   movel     dslsz1        sav_dslsz1
277420020308     c* se numero dei colli > 2 si tratta di un dal/al
277430020308     c* devo quindi esplodere i codici per controllare che anche
277440020308     c* quelli all'interno del range non siano già presenti su fisgn
277450020308    4C     OZ1MAX        IFEQ      '2'
277460020308     C                   MOVEL     IZ1CH1        CHIDAL
277470020308     C                   MOVEL     IZ1CH2        CHIAL
277480020308   x4C                   ELSE
277490020308     C                   MOVEL     IZ1CH2        CHIDAL
277500020308     C                   MOVEL     IZ1CH1        CHIAL
277510020308    4C                   ENDIF
277520030214      * Prima di esplodere (per evitare giri inutili) controllo che il
277530030214      * n. dei cod. CHI SONO coincida con il n. dei colli immesso in
277540030214      * prima videata
277550030214If  4c                   If        Ix <> V1cNcl
277560030214     c                   Eval      *In90 = *On
277570030214If  5c                   If        Wc01Fg = 'C'
277580030214     c                   Eval      w08msg = Err(154)
277590030214   x5c                   Else
277600030214     c                   Movea     Err(154)      K78
277610030214     c                   Movea     *Blanks       K78(54)
277620030214     c                   Movea     K78           w08msg
277630030214    5c                   EndIf
277640030214     c                   GoTo      EndS08
277650030214    4c                   EndIf
277660020308    4C     CHIDAL        DOWNE     CHIAL
277670020308     C                   CLEAR                   DSLSZ1
277680020308     C                   MOVEL     'E'           IZ1MOD
277690020308     C                   MOVEL     CHIDAL        IZ1CH1
277700020308     C                   Z-ADD     V8CKSC        IZ1CCM
277710020308     C                   MOVEL     WCTM          IZ1CTM
277720020308     C     §1BF12        IFEQ      'B'
277730020308     C                   Z-ADD     §LPNRS        IZ1NRS
277740020308     C                   ENDIF
277750020308     C                   CALL      'FNLSZ1R'
277760020308     C                   PARM                    KPJBA
277770020308     C                   PARM                    DSLSZ1
277780020308     C                   PARM                    DS1B
277790020308    5C     OZ1CHI        IFNE      CHIAL
277800020308     c                   clear                   w8hcol
277810020308     c                   movel     '1'           wnopos
277820020308     c                   eval      w8cnot = oz1chi
277830020308     c                   exsr      ctrchidop
277840020308     c   90              movel     sav_dslsz1    dslsz1
277850020308     c   90              goto      ends08
277860020308    5c                   endif
277870020308     C                   MOVEL     OZ1CHI        CHIDAL
277880020308    4C                   ENDDO
277890020308     c                   movel     sav_dslsz1    dslsz1
277900020308    3c                   endif
277910000907    2C                   ENDIF
277920000907   X1C                   ELSE
277930010306     C* Se codici inseriti diverso da 2 O NUMERO COLLI <= 2
277940000918     C* li controllo una alla volta
277950001031     C                   Z-ADD     1             II                4 0
277960000907    2C     II            DOWLE     IX
277970000907     C                   CLEAR                   DSLSZ1
277980000907     C                   MOVEL     'C'           IZ1MOD
277990000911     C                   MOVEL     WCTM          IZ1CTM
278000000907     C                   Z-ADD     V8CKSC        IZ1CCM
278010000907     C     §1BF12        IFEQ      'B'
278020000907     C                   Z-ADD     §LPNRS        IZ1NRS
278030000907     C                   ENDIF
278040000907     C                   MOVEL     CHI(II)       IZ1CH1
278050000907     C                   CALL      'FNLSZ1R'
278060010402     C                   PARM                    KPJBA
278070000907     C                   PARM                    DSLSZ1
278080000907     C                   PARM                    DS1B
278090000907    3C     OZ1ERR        IFNE      ' '
278100000907     C                   Z-ADD     POS(II)       V8CNBR
278110000918     C     V8CNBR        CHAIN     LS01S08                            31
278120000907     C                   SETON                                        9061
278130000911     C     WC01FG        IFEQ      'C'
278140000907     C                   MOVEL     ERR(208)      W08MSG
278150000911     C                   ELSE
278160000911     C                   MOVEA     ERR(208)      K78
278170000911     C                   MOVEA     *BLANKS       K78(45)
278180000911     C                   MOVEA     K78           W08MSG
278190000911     C                   ENDIF
278200000907     C                   UPDATE    LS01S08
278210000911     C                   GOTO      ENDS08
278220000907    3C                   ENDIF
278230000911     C                   ADD       1             II
278240000907    2C                   ENDDO
278250000907    1C                   ENDIF
278260000908     c* Controllo che numero cod.chi sono corrisponda con numero colli
278270000908     c* in prima videata
278280000908     C     IX            IFNE      V1CNCL
278290000908     C                   SETON                                        90
278300000911     C     WC01FG        IFEQ      'C'
278310000908     C                   MOVEL     ERR(154)      W08MSG
278320000911     C                   ELSE
278330000911     C                   MOVEA     ERR(154)      K78
278340000911     C                   MOVEA     *BLANKS       K78(54)
278350000911     C                   MOVEA     K78           W08MSG
278360000911     C                   ENDIF
278370000908     C                   ENDIF
278380000911     C     ENDS08        TAG
278390000911     C                   MOVE      *BLANKS       WC01FG
278400000911     C                   ENDSR
278410020308     C**************************************************************************
278420020308     C*   Controllo se cod. chi sono già esistente
278430020308     C**************************************************************************
278440020308     C     CTRCHIDOP     BEGSR
278450020308     C* Se segnac. EUROEX controllo che non sia doppio in altra bolla
278460040505    1c     §ogntw        ifeq      'EEX'
278470020308     C     W8HCOL        ANDEQ     *ZEROS
278480020308     C                   MOVEL     'E'           WTRC
278490051102     C     KARS2         SETLL     FIARS02L                               31
278500020308    2C     *IN31         IFEQ      *ON
278510020308    3c     wnopos        ifeq      *blanks
278520020308     C                   Z-ADD     NR8           V8CNBR
278530020308     c                   seton                                        61
278540020308    3c                   endif
278550020308     C                   SETON                                        90
278560020308     C                   MOVEA     ERR(155)      K78
278570020308     C                   MOVEL     w8CNOT        W030A            30
278580020308     C                   MOVEA     W030A         K78(18)
278590020308     C                   MOVEA     K78           W08MSG
278600020308    3c     wnopos        ifeq      *blanks
278610020308     C                   UPDATE    LS01S08
278620020308    3c                   endif
278630020308     C                   GOTO      ENDCDOP
278640020308    2C                   ENDIF
278650020308    1C                   ENDIF
278660020308     C* MSG FORZABILE SE CHI SONO GIA' PRESENTE SU FISGN
278670020308     C* (SOLO SE RECORD E' DI NUOVA IMMISSIONE)
278680020308     C* 02/05/01: RENDO ERRORE BLOCCANTE SU RICHIESTA DELLA LORENA
278690020308    1C     W8HCOL        IFEQ      *ZEROS
278700020308     C     KSGN88        CHAIN(N)  FISGN01L                           31
278710020308    2C     *IN31         IFEQ      *OFF
278720020308     C     SGNATB        ANDNE     '*'
278730020308    3c     wnopos        ifeq      *blanks
278740020308     C                   Z-ADD     NR8           V8CNBR
278750020308     c                   seton                                        61
278760020308    3c                   endif
278770020308     C                   SETON                                        90
278780020308     c                   eval      w08msg = %trim(err(209)) + ' '
278790020308     c                             + %trim(w8cnot)
278800020308     c                             + ' presente in altra bolla'
278810020308    3c     wnopos        ifeq      *blanks
278820020308     C                   UPDATE    LS01S08
278830020308    3c                   endif
278840020308     C                   GOTO      ENDCDOP
278850020308    2C                   ENDIF
278860020308    1C                   ENDIF
278870020308     c     ENDCDOP       endsr
278880010504     C**************************************************************************
278890010504     C*   ELIMINAZIONE CHI SONO ANNULLATI DA SUBFILE
278900010504     C**************************************************************************
278910010504     C     CTRS8A        BEGSR
278920010504    0C     *IN78         IFEQ      *ON
278930010504     C                   Z-ADD     1             NR8
278940010504     C     NR8           CHAIN     LS01S08                            31
278950010504    1C     *IN31         DOWEQ     *OFF
278960010504     C* SE RECORD ANNULLATO DEVO TOGLIERLO DA CH2
278970010504     C     V8CSCE        IFEQ      'A'
278980010504     C                   Z-ADD     1             WK                3 0
278990010504     C     V8CNOT        LOOKUP    CH2(WK)                                31
279000010504     C   31              MOVE      *BLANKS       CH2(WK)
279010010504     C                   UPDATE    LS01S08
279020010504     C                   ENDIF
279030010504     C                   ADD       1             NR8
279040010504     C  N90NR8           CHAIN     LS01S08                            31
279050010504    1C                   ENDDO
279060010504     C   31              SUB       1             NR8
279070010504    0C                   ENDIF
279080010504     C                   ENDSR
279090000912     C**************************************************************************
279100000912     C*   AGGIORNAMENTO FILE FISGN00F
279110000912     C**************************************************************************
279120000912     C     UPDSGN        BEGSR
279130000921     C* QUESTO CAMPO NON CREDO CHE SIA UTILIZZATO ADOGNI MODI MI SEMBRA
279140000921     C* GIUSTO IN QUESTO CASO ABBLENCARLO
279150000921     C     SGNATB        IFEQ      '*'
279160000921     C                   CLEAR                   SGNSQU
279170000921     C                   ENDIF
279180000921     C*
279190000919     C                   CLEAR                   SGNATB
279200000921     C                   Z-ADD     §3ISEA        SGNSEA
279210000921     C                   MOVEL     'S'           SGNST1
279220160226     c* disk "C" no dpd
279230160226     c                   if        (§1bf12<>'N' and wexdpd<>'S' and *in79=*off)
279240160226     c                             or
279250160226     c* disk "C" export dpd con numero parcel automatico (da §1bf13 o instradame
279260160226     c* nto forzato a dpd oppure numero parcel lungo 12 che uso come disk "C" ma
279270160226     c* assegno parcel dpd automatico
279280160226     c                             (§1bf12<>'N' and wexdpd='S' and
279290160226     c                              (§1bf13='A' or w_adpd='S' or wparcel='12'))
279300160226     c                             or
279310160226     c* Disk "B" che diventa "C" export DPD anche se parcel non automatico
279320160226     c                             (§1bf12='B' and wexdpd='S')
279330090624      *
279340000925     C                   Z-ADD     V8HST2        SGNST2
279350000925     C                   ENDIF
279360000921     C                   MOVE      '0'           SGNFL1
279370000912     C     BLPCCM        IFGT      0
279380000912     C                   MOVEL     BLPCCM        SGNKSC
279390000912     C                   ELSE
279400000912     C                   MOVEL     BLPKSC        SGNKSC
279410000912     C                   ENDIF
279420000921     C                   Z-ADD     BLPLNP        SGNLNP
279430000921     C                   Z-ADD     BLPNSP        SGNNSP
279440010116     C                   CLEAR                   SGNT6A
279450010116     C                   CLEAR                   SGNT6B
279460010116     C                   CLEAR                   SGNT6C
279470010116     C                   CLEAR                   SGNT6D
279480010116     C                   CLEAR                   SGNT6E
279490010116     C                   CLEAR                   SGNT6F
279500080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
279510000922     C                   CLEAR                   SGNRST
279520001005     C     WSGNR         IFEQ      'B'
279530001005     C                   UPDATE    FISGN005
279540001005     C                   ELSE
279550000912     C                   UPDATE    FISGN000
279560150701     c                   exsr      sr_CalSgn
279570001005     C                   ENDIF
279580000912     C                   ENDSR
279590000929     C**************************************************************************
279600000929     C*   SCRITTURA     FILE FISGN00F
279610000929     C**************************************************************************
279620000929     C     WRTSGN        BEGSR
279630000929     C                   CLEAR                   SGNATB
279640000929     C                   MOVEL(P)  V8CNOT        SGNWHO
279650000929     C                   Z-ADD     §3ISEA        SGNSEA
279660000929     C                   MOVEL     'S'           SGNST1
279670001002     C     WSGNR         IFEQ      *BLANKS
279680000929     C                   CLEAR                   SGNST2
279690001002     C                   ELSE
279700001002     C                   Z-ADD     1             SGNST2
279710010405     C* SGNFL2 = N SIGNIFICA CHE SI TRATTA DI FISGN SCRITTO PER SOLA
279720010405     C* RISTAMPA --> NON E' UN REALE DISK C
279730010405     C                   MOVEL     'N'           SGNFL2
279740001002     C                   ENDIF
279750000929     C                   MOVE      '0'           SGNFL1
279760000929     C                   MOVEL     BLPLNP        SGNLNP
279770000929     C                   MOVEL     BLPNSP        SGNNSP
279780000929     C     BLPCCM        IFGT      0
279790000929     C                   MOVEL     BLPCCM        SGNKSC
279800000929     C                   ELSE
279810000929     C                   MOVEL     BLPKSC        SGNKSC
279820000929    4C                   ENDIF
279830010116     C                   CLEAR                   SGNT6A
279840010116     C                   CLEAR                   SGNT6B
279850010116     C                   CLEAR                   SGNT6C
279860010116     C                   CLEAR                   SGNT6D
279870010116     C                   CLEAR                   SGNT6E
279880010116     C                   CLEAR                   SGNT6F
279890080624     c                   eval      sgndatora = %char(%timestamp:*iso0)
279900000929     C                   CLEAR                   SGNRST
279910010116     C                   Z-ADD     COMTFP        SGNTNP
279920001005     C     WSGNR         IFEQ      'B'
279930001005     C                   WRITE     FISGN005
279940001005     C                   ELSE
279950001005     C                   WRITE     FISGN000
279960001005     C                   ENDIF
279970001005     C*
279980000929     C                   ENDSR
279990010209     C**************************************************************************
280000010209     C*   VERIFICO SE ATTIVATA PROCEDURA O.R.M.
280010011121     C**************************************************************************
280020010209     C     ATTORM        BEGSR
280030010209     C                   MOVE      *BLANKS       WORM              1
280040010220     C   12
280050010220     CAN 15VIDPOE        IFGT      *ZEROS
280060010209     C                   MOVEL     'S'           WORM
280070010209     C                   ENDIF
280080010305     C     §LPFPR        IFNE      'O'
280090010215     C     *IN12         IFEQ      *OFF
280100010215     C     *IN15         OREQ      *OFF
280110010219     C                   MOVE      WLNPO         W0030
280120010215     C     W0030         CHAIN     AZORG01L      UNIORG               30
280130010209     C  N30              MOVEL     ORGDE8        OG148
280140010209     C   30              CLEAR                   OG148
280150060926     c                   eval      §ogorm='S'
280160010209     C     §OGORM        IFEQ      'S'
280170010209     C                   MOVEL     'S'           WORM
280180010209     C                   ENDIF
280190010215     C                   ENDIF
280200010305     C                   ELSE
280210010301     C                   MOVEL     'S'           WORM
280220010301     C                   ENDIF
280230010209     C* IMPOSTO INDICATORI PER NON VISUALIZZARE KEY ORM SE P.O. NON
280240010209     C* ABILITATO
280250010209     C     WORM          IFEQ      *BLANKS
280260010223     C                   SETOFF                                       37
280270010209     C                   MOVEL     NDPR          ATRPOE
280280010215     C                   MOVEL     NDPR          ATRORM
280290010219     C                   MOVEL     NODI          ATRDOR
280300010209     C                   CLEAR                   VIDPOE
280310010209     C                   CLEAR                   VIDNOR
280320010209     C                   CLEAR                   VIDNRV
280330010209     C* Campi della videata di personalizzazione
280340010209     C                   MOVEL     NDPR          AT0POE
280350010215     C                   MOVEL     NDPR          AT0ORM
280360010219     C                   MOVEL     NODI          AT0DOR
280370010209     C                   CLEAR                   V0CPOE
280380010209     C                   CLEAR                   V0CNOR
280390010209     C                   CLEAR                   V0CNRV
280400010222     C* Questa routine viene richiamata anche in immissione bolle
280410010222     C* tutte le volte che variano la linea di partenza.
280420010222     C* Se si passa da lnp attivata a proc. ORM ad una NON attivata
280430010222     C* bisogna spegnere indicatore 06 di posiz. cursore su N. ORM
280440010222     C* se è acceso e al suo posto bisogna accendere lo 07
280450010222     C  N12*IN06         IFEQ      *ON
280460010222     C                   SETOFF                                       06
280470010222     C                   SETON                                        07
280480010222     C                   ENDIF
280490010209     C                   ELSE
280500010209     C* PROCEDURA ORM ATTIVA
280510010409     C* Chaino tabella DFT per prendere il massimo peso in KG per la
280520010409     C* richiesta note obbligatoria
280530010409     C* Provo prima con key = p.o. ritiro
280540010409     c* Se record non trovato chaino record 999
280550010409     C                   CLEAR                   WTRDFT
280560010409     C                   CLEAR                   DSBS02
280570010409     C                   MOVEL     'C'           T02MOD
280580010409     C                   MOVEL     KNSIF         T02SIF
280590010409     C                   MOVEL     'DFT'         T02COD
280600010409     C                   MOVEL(P)  WLNPO         T02KE1
280610010409     C     WTRDFT        DOWEQ     *BLANKS
280620010409      *
280630010409     C                   CALL      'TIBS02R'
280640010409     C                   PARM                    KPJBA
280650010409     C                   PARM                    DSBS02
280660010409      *
280670010409     C     T02ERR        IFEQ      *BLANKS
280680010409     C     T02KE1        OREQ      '999'
280690010409     C                   MOVEL     '1'           WTRDFT            1
280700010409     C     T02ERR        IFEQ      *BLANKS
280710010409     C                   MOVEL     T02UNI        DDFT
280720010409     C                   ELSE
280730010409     C                   CLEAR                   DDFT
280740010409     C                   ENDIF
280750010409     C                   ELSE
280760010409     C                   MOVEL     '999'         T02KE1
280770010409     C                   CLEAR                   T02ERR
280780010409     C                   ENDIF
280790010409     C                   ENDDO
280800010409     C*
280810010209     C                   CLEAR                   ATRPOE
280820010215     C                   CLEAR                   ATRORM
280830010219     C                   CLEAR                   ATRDOR
280840010209     C* Campi della videata di personalizzazione
280850010209     C                   CLEAR                   AT0POE
280860010215     C                   CLEAR                   AT0ORM
280870010219     C                   CLEAR                   AT0DOR
280880010209     C* IN IMMISSIONE PREPAGATI  MIEI KEY ORM = ND + PR
280890010220     C     PARTCH        IFEQ      'P'
280900010220     C                   MOVEL     NDPR          ATRPOE
280910010220     C                   MOVEL     NDPR          ATRORM
280920010220     C                   MOVEL     NODI          ATRDOR
280930010220     C                   MOVEL     NDPR          AT0POE
280940010220     C                   MOVEL     NDPR          AT0ORM
280950010220     C                   MOVEL     NODI          AT0DOR
280960010220     C                   ENDIF
280970010209     C* IN IMMISSIONE PREPAG.NON MIEI KEY ORM =      PR
280980010301     C     §LPFPR        IFEQ      'O'
280990010209     C* IN CONFERMA                   KEY ORM =      PR
281000010301     C     *IN12         OREQ      *ON
281010010301     C     *IN15         ANDEQ     *ON
281020010301     C                   MOVEL     PROT          ATRPOE
281030010301     C                   MOVEL     PROT          ATRORM
281040010301     C                   ENDIF
281050010213     C*
281060010213     C* INIZIALIZZO ANCHE CAMPI DI CMODO CHE MI SERVONO NELLA ROUTINE
281070010213     C* DEI CONTROLLI SE PROCEDURA ORM ATTIVATA
281080010220     C     *IN12         IFEQ      *OFF
281090010301     C     §LPFPR        ANDNE     'O'
281100010213     C                   CLEAR                   PREDRT
281110010214     C                   CLEAR                   PREPDR
281120010214     C                   CLEAR                   PREFPP
281130010214     C                   CLEAR                   PRECCM
281140010214     C                   CLEAR                   PREFFD
281150010222     C* Questa routine viene richiamata anche in immissione bolle
281160010222     C* tutte le volte che variano la linea di partenza.
281170010222     C* Se si passa da lnp non attivata a proc. ORM ad una attivata
281180010222     C* bisogna spegnere indicatore 07 di posiz. cursore su cod mitt
281190010222     C* se è acceso e al suo posto bisogna accendere lo 06
281200010222     C     *IN07         IFEQ      *ON
281210010222     C                   SETOFF                                       07
281220010222     C                   SETON                                        06
281230010222     C                   ENDIF
281240010220     C                   ENDIF
281250010215     C                   CLEAR                   WORMMD
281260010220     C                   CLEAR                   WPRIMV
281270040319     c                   Eval      wmodorm = *Off
281280010222     C* SE SONO IN MANUTENZIONE DEVO POSIZIONARE IL CURSORE SUL
281290010222     C* NUMERO ORM
281300010222     C     *IN12         IFEQ      *ON
281310010222     C     *IN15         ANDEQ     *OFF
281320040323      * ma se bolla di recupero o bolla 'FW' devo proteggere il n. ORM
281330040323if  3c                   If        §3arbl = 'R' or vidcbo = 'FW'
281340040323     c                   Movel     prot          atrpoe
281350040323     c                   Movel     prot          atrorm
281360040324     c                   Eval      *In06 = *Off
281370040323     c                   GoTo      Endattorm
281380040323e   3c                   EndIf
281390040323      * o se bolla legata devo proteggere il n. ORM
281400040323     c     kBlp3         Setll     Fnlbl01l
281410040323if  3c                   If        %Equal(Fnlbl01l)
281420040323     c                   Movel     prot          atrpoe
281430040323     c                   Movel     prot          atrorm
281440040324     c                   Eval      *In06 = *Off
281450040323     c                   GoTo      Endattorm
281460040323    3c                   EndIf
281470010222     C                   SETOFF                                       07
281480010222     C                   SETON                                        06
281490010222     C                   ENDIF
281500010209     C                   ENDIF
281510011121     C*
281520040323     C     endattorm     ENDSR
281530010228     C**************************************************************************
281540010228     C*   RIEMPIMENTO CAMPI DI PASSAGGIO A PGM FIOR05R
281550010228     C**************************************************************************
281560010228     C     RIEO05        BEGSR
281570010228     C                   CLEAR                   DSOR05
281580010228     C*
281590010228     C                   MOVEL     '2'           §RMTLA
281600010228     C                   MOVEL     'B'           §RMFPR
281610010228     C                   Z-ADD     VIDLNP        §RMPOE
281620010228     C                   Z-ADD     VIDLNP        §RMPOR
281630010228     C                   MOVEL     'P'           §RMTOR
281640010228     C                   MOVEL     'P'           §RMTCO
281650010305     C                   Z-ADD     VIDCCM        W0070             7 0
281660010228     C     VIDFLC        IFEQ      0
281670010228     C                   MOVEL     VIDLNP        W0070
281680010228     C                   ELSE
281690010228     C                   MOVEL     VIDFLC        W0070
281700010228     C                   ENDIF
281710010228     C                   CLEAR                   §RMCRA
281720010228     C     VIDCCM        IFNE      8888
281730010228     C                   MOVEL     W0070         §RMCRA
281740010228     C                   ENDIF
281750010228     C                   MOVEL     VIDRSM        §RMRSR
281760010228     C                   MOVEL     VIDINM        §RMINR
281770010228     C                   MOVEL     VIDCAM        §RMCAR
281780010228     C                   MOVEL     VIDLOM        §RMLOR
281790010228     C                   MOVEL     VIDPRM        §RMPRR
281800010228     C                   MOVEL     VIDNZM        §RMNAR
281810010228     C                   MOVEL     VIDRSD        §RMRSC
281820010228     C                   MOVEL     VIDIND        §RMINC
281830010228     C                   MOVEL     VIDCAD        §RMCAC
281840010228     C                   MOVEL     VIDLOD        §RMLOC
281850010228     C                   MOVEL     VIDPRD        §RMPRC
281860010228     C                   MOVEL     VIDNZD        §RMNAC
281870010228     C     VIDFFD        IFEQ      'N'
281880010228     C                   MOVEL     *BLANKS       §RMFFD
281890010228     C                   ELSE
281900010228     C                   MOVEL     VIDFFD        §RMFFD
281910010228     C                   ENDIF
281920010228     C                   MOVEL     VIDNAS        §RMNAM
281930010228     C                   Z-ADD     VIDNCL        §RMNCL
281940010228     C                   Z-ADD     VIDPKG        §RMPKG
281950010228     C                   Z-ADD     VIDVOL        §RMVLM
281960010228     C                   MOVEL     'M'           §RMPAG
281970010228     C                   MOVEL     VIDNT1        §RMNO1
281980010228     C                   MOVEL     VIDNT2        §RMNO2
281990010228     C                   MOVEL     VIDRMA        §RMRFA
282000160216     C                   z-add     comlna        §RMPOC
282010010228     C                   ENDSR
282020011212     C**************************************************************************
282030011212     C*   RICHIAMO PGM DI UTILITA' PER EDITARE CAMPO NUMERICO
282040011212     C**************************************************************************
282050011212     C     CALLXE        BEGSR
282060011212     C                   CLEAR                   DSEDIT
282070011212     C                   CLEAR                   W014A
282080011212     C                   MOVE      WNUMED        IEDNUM
282090011212     C                   Z-ADD     3             IEDNRD
282100011212     C                   MOVE      '4'           IEDEDT
282110011212     C                   Z-ADD     14            IEDLEN
282120011212     C                   CALL      'XEDIT'
282130011212     C                   PARM                    DSEDIT
282140011212     C     OEDFLG        IFEQ      *OFF
282150011212     C                   MOVEL     OEDNUM        W014A            14
282160011212     C                   ENDIF
282170011212     C                   ENDSR
282180020212     C**************************************************************************
282190020212     C*   Calcolo check digit AWB FEDEX
282200020212     C**************************************************************************
282210020212     C     CHKDGF        BEGSR
282220020212      * Il check digit del codice a barre di FedEx va colcolato moltiplicando
282230020212      * il numero del codice a barre (partendo dall'undicesimo e andando a
282240020212      * a ritroso) per un valore alternato (1 - 3 - 7) e sommati tra loro, il
282250020212      * totale va diviso per 11 e il resto è i check digit
282260020212      * se il resto è 10 o 0 il check digit deve essere 0
282270020212      * Esempio:
282280020212      * codice a barre 0 1  2 3 4  5  6 7  8  9 8
282290020212      * valore         3 1  7 3 1  7  3 1  7  3 1
282300020212      * totale         0 1 14 9 4 35 18 7 56 27 8 = 179
282310020212      * check digit    179 / 11 = 16 resto 3
282320020212     c                   move      w0012a        fedexbrc
282330020214     c                   clear                   totale
282340020212
282350020212      * Carico 1 - 3 - 7 in una schiera di comodo 'base'
282360020212
282370020212     c                   eval      base(1) = 1
282380020212     c                   eval      base(2) = 3
282390020212     c                   eval      base(3) = 7
282400020212
282410020212     c                   eval      zw = 0
282420020212
282430020212      * parto dall'undicesimo numero
282440020212     c     11            do        11            xw
282450020212      * andando all'indietro il contatore arriva a 0 e devo uscire dal ciclo
282460020212     c                   if        xw = 0
282470020212     c                   leave
282480020212     c                   endif
282490020212     c                   eval      zw = zw + 1
282500020212     c                   eval      totale = totale + (fbrc(xw) * base(zw))
282510020212
282520020212     c                   if        zw = 3
282530020212     c                   eval      zw = 0
282540020212     c                   endif
282550020212      * torno indietro
282560020212     c                   enddo     -1
282570020212
282580020212     c     totale        div       11            intero
282590020212     c                   mvr                     restof
282600020212
282610020212     c                   if        restof = 0 or restof = 10
282620020212     c                   move      '0'           fchd
282630020212     c                   else
282640020212     c                   move      restof        fchd
282650020212     c                   endif
282660020212
282670020212     c                   move      fedexbrc      w0012a
282680020212     c                   ENDSR
282690040601     C**************************************************************************
282700040601     C*   Scrittura fiar8
282710040601     C**************************************************************************
282720040601     C     SR_fiar8      BEGSR
282730040601     c     kblc          setll     fivax01l
282740040601     c                   do        *hival
282750061010     c     kblc          reade(N)  fivax01l
282760040601     c                   if        %eof(fivax01l)
282770040601     c                   leave
282780040601     C                   endif
282790040601     c                   clear                   fiar8000
282800040601     c                   Eval      Ar8Aas = BlpAas
282810040601     c                   Eval      Ar8Lnp = BlpLnp
282820040601     c                   Eval      Ar8Nrs = BlpNrs
282830040601     c                   Eval      Ar8Nsp = BlpNsp
282840040601     c                   eval      ar8tmd = vaxtmd
282850040601     c                   eval      ar8prr = vaxprr
282860040601     c                   eval      ar8trk = vaxtrk
282870050913     c                   eval      ar8uni = %trimr(vaxdtt)
282880130924     c                   if        aggioAr8='S'
282890040601     c                   write     fiar8000
282900130924     c                   endif
282910130308     c                   eval      w_allx='S'
282920040601     c                   enddo
282930040601     c                   endsr
282940130304     C**************************************************************************
282950130304     C*   Scrittura fiar8 da fivat tipo record "P"
282960130304     C**************************************************************************
282970130304     C     SR_fiar8_vatp BEGSR
282980130304     c                   clear                   w_prr
282990130304     c                   clear                   w_pdfn
283000130304     C                   MOVEL     'P'           WTRC
283010130304     c     kvat          setll     fivat01l
283020130305    1c                   do        *hival
283030130304     c     kvat          reade(N)  fivat01l
283040130305    2c                   if        %eof(fivat01l)
283050130304     c                   leave
283060130305    2C                   endif
283070130304     c                   movel(P)  vatnot        dvatp
283080130305    2c                   if        §vatppdfn=*blanks
283090130304     c                             or §vatppdfn=w_pdfn
283100130304     C                   iter
283110130305    2c                   endif
283120130304     c                   movel     §vatppdfn     w_pdfn
283130130304     c                   eval      w_prr+=1
283140130304     c                   clear                   fiar8000
283150130304     c                   Eval      Ar8Aas = BlpAas
283160130304     c                   Eval      Ar8Lnp = BlpLnp
283170130304     c                   Eval      Ar8Nrs = BlpNrs
283180130304     c                   Eval      Ar8Nsp = BlpNsp
283190130304     c                   eval      ar8tmd = '§PDF'
283200130304     c                   eval      ar8prr = w_prr
283210130304     c                   clear                   dar8§pdf
283220130304     c                   eval      §AR8PIDZ=§VATPIDZ
283230130306     c                   eval      §AR8PPDFP=§clipdfp
283240130306     c                   eval      §AR8PPDFn=§VATPPDFN
283250130311     c* se non prevista la stampa imposto a "N" il flag per il trattamento
283260130311     c* dell'allegato (su richiesta di FG)
283270130315     c                   if        %subst(§ar8pidz:1:1)<>'1'
283280130311     c                   eval      §ar8ptrt='N'
283290130315     c                   endif
283300130408     c* se non prevista la mail   imposto a "N" il flag per invio email
283310130408     c                   if        %subst(§ar8pidz:2:1)<>'1'
283320130408     c                   eval      §ar8peml='N'
283330130408     c                   else
283340130408     c                   eval      w_allm='S'
283350130408     c                   endif
283360130304     c                   eval      ar8uni = %trimr(dar8§pdf)
283370130924     c                   if        aggioAr8='S'
283380130304     c                   write     fiar8000
283390130924     c                   endif
283400130305    1c                   enddo
283410130304     c                   endsr
283420060308     C**************************************************************************
283430060308     C*   Richiamo lv85r per chiusura in LR
283440060308     C**************************************************************************
283450060308     C     CLS_lv85      BEGSR
283460060308     c*   ATTENZIONE: Il pgm fnlv85r serve per gestire richiesta, controllo
283470060308     c*               registrazione su data base del motivo variazione
283480060308     c*
283490060308     c*               Per ora il pgm di bollettazione richiama l'lv85
283500060308     c*               in due casi diversi di variazione bolla:
283510060308     c*               1)variazione totale imponibile di un prepagato (cvb TR
283520060308     c*               2)annullamento di un prepagato (cvb KM)
283530060308     c*
283540060308     c*               Quando fnlv85r viene richiamato in modalità "V"
283550060308     c*               (richiesta e controllo della motivazione)
283560060308     c*               viene passato tipo lancio (ilv85tla) = blanks
283570060308     c*               per chiudere in return.
283580060308     c*               In questo modo la window di richiesta motivazione
283590060308     c*               non viene pulita ed in caso di F12=Ritorno e successi-
283600060308     c*               va riconferma della variazione la window viene ripropo
283610060308     c*               sta con i dati precedentemente immessi.
283620060308     c*               Il pgm deve però essere chiuso con LR se la window
283630060308     c*               precedente era stata emessa a fronte di una causale
283640060308     c*               diversa dalla quale si era usciti con f12 anzichè
283650060308     c*               con f6=Conferma. Questa routine serve proprio per
283660060308     c*               chiudere con LR se cambiata la causale variazione
283670060308     c*               al fine di emettere la window pulita.
283680060308     c*
283690060308     c                   if        ilv85cvb <> *blanks and ilv85cvb <> wcvb
283700060308     c                   clear                   fnlv85ds
283710060308     c                   eval      ilv85tla = 'C'
283720060308     c                   movel     fnlv85ds      kpjbu
283730060308     c                   call      'FNLV85R'
283740060308     c                   parm                    kpjba
283750060308     c                   endif
283760060308     c                   endsr
283770060427     C**************************************************************************
283780060427     C*   Forzature per orm esteri con triangolazione
283790060427     C**************************************************************************
283800060427     C     sr_FOrmEst    BEGSR
283810060427      * Forzo che deve essere un porto franco
283820060427     c                   Eval      §OrPfb = 'F'
283830060427      * Flag di appoggio per portare l'ordinante nel mittente
283840060427      * e il mittente orm nel mittente originale
283850060427     c                   Eval      wforpf = '1'
283860060427if 1ac                   if        wnoccm = '1'
283870130212     c                   clear                   wnoccm
283880060427      * Ksc da ORM
283890060427if  2c                   If        OrmKsc > *Zeros
283900060427      * propongo il ksc dell'ORM
283910060427     c                   Move      OrmKsc        vidccm
283920060427     c                   Movel     OrmKsc        w0030
283930130212     c                   Z-add     w0030         vidflc
283940060427      * SE LA LINEA PARTENZA DEL CODICE NON E' LA LINEA PARTENZA DELLA
283950060427      *  BOLLA --> ABILITA LA FILIALE CLIENTE
283960060427if  3C                   If        w0030 <> vidlnp
283970130212     c****               Z-add     w0030         vidflc
283980060427     c                   Seton                                        14
283990060427    3c                   EndIf
284000060427      * no Ksc da ORM
284010060427   x2c                   Else
284020060427      * propongo la ragione sociale dell'ordinante nella ricerca alfabetica
284030060427     c                   Movel     OrmRso        viddmt
284040060427     c                   clear                   vidccm
284050060427if  3c                   If        viddmt <> *Blanks
284060060427     c***                Seton                                        0138
284070060427     c                   Seton                                        01
284080060427    3c                   EndIf
284090060427    2c                   EndIf
284100060427   1ac                   endif
284110060427     c                   endsr
284120070403     C**************************************************************************
284130070403     C*   Aggiornamento/scrittura numero giro
284140070403     C**************************************************************************
284150070403     C     sr_FIARG      BEGSR
284160070404     c                   clear                   wupd              1
284170100323     c                   clear                   wFGI              1
284180100323     c                   clear                   wAggioARG
284190100323     c* Verifico se per il cliente mittente è presente una forzatura GIRO
284200100323     c*  nel file azfgi
284210100323     c                   eval      kksc=wksc
284220100323     c                   eval      klnp=blplnp
284230100323     c                   eval      klna=blplna
284240100323     c                   exsr      LeggiFGI
284250100323     c
284260100323    1c                   if        wfgi=*blanks
284270100323     c                   eval      klnp=999
284280100323     c                   exsr      LeggiFGI
284290100323    1c                   endif
284300100323     c
284310100323    1c                   select
284320070405     c* conferma bolla di reso
284330070405     c                   when      *in12='1' and *in15='1' and
284340070405     c                             vidfbr='S' and *in44='1'
284350070705     c*                  if        §lpcgi<>*blanks and
284360070705     c*                            vidrsd=savrsd and
284370070705     c*                            vidind=savind and
284380070705     c*                            vidprd=savprd and
284390070705     c*                            vidcad=savcad and
284400070705     c*                            vidlod=savlod and
284410070705     c*                            vidnzd=nzdini
284420100323    2c                   if        §lpcgi<>*blanks
284430070405     c                   eval      w_cgi=§lpcgi
284440070405     c                   exsr      ges_arg
284450100323    2c                   endif
284460100323
284470100323     c* Immissione oppure conferma bolla NON di reso
284480100323    1c                   when      *in12='0' or *in15='1'
284490160323     c*  Se Vedi pacco dpd imposto il giro forzato come da tabella
284500160323     c                   if        w_vediP='1'
284510160323     c                   eval      w_cgi=§NSDCGI
284520160323     c                   exsr      ges_arg
284530160323     c                   else
284540100323     c*  Se c'e' AZFGI --> vince sui destinatari
284550100323    2c                   if        wfgi='S'
284560100323     c                   eval      w_cgi=fgicgi
284570100323     c                   exsr      ges_arg
284580100323   x2c                   else
284590100323    3c                   if        ot0err=*blanks and ot0x1cgi<>*blanks
284600070924     c                             and comlna=ot0x1pog
284610070924     c                   eval      w_cgi=ot0x1cgi
284620070404     c                   exsr      ges_arg
284630160323     c                   endif
284640100323    3c                   endif
284650100323    2c                   endif
284660100323     c* Manutenzione bolla
284670160323     c*  Solo se non si tratta di VEDI PACCO
284680160324    1c                   when      *in12='1' and *in15='0' and W_vediP<>'1'
284690100323     c* Se modificato il mittente ed il nuovo ha il giro forzato --> vince
284700100323    2c                   if        wksc<>savmit  or
284710100323     c                             blplna<>lna_sav
284720100323     c                   clear                   wupd              1
284730100323     c     kblp3         chain     fiarg01l
284740100323    3c                   if        %found(fiarg01l)
284750100323     c                   eval      wupd='1'
284760100323    3c                   endif
284770100323     c
284780100323    3c                   if        wFGI='S'
284790160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
284800160129     c* la linea di arrivo
284810160129     c                   if        wupd=' '
284820160129     c                             or argcgi<>'DIR'
284830160129     c                             or blplna<>lna_sav
284840160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
284850160129    7c                   if        wupd='1' and argcgi='DIR'
284860160129     c                   exsr      sr_chiuDispoRA
284870160129    7c                   endif
284880100323     c                   eval      w_cgi=fgicgi
284890100323     c                   exsr      ges_arg
284900160129     c                   else
284910160129     c                   if        wupd='1'
284920160129     c                   unlock    fiarg01l
284930160129     c                   endif
284940160129     c                   endif
284950100323   x3c                   else
284960100323     c
284970100323     c* Se non ha il giro ed il vecchio ce lo aveva, cancello FIARG
284980100323     c*  e poi proseguo con gli altri controlli
284990100323     c
285000100323    4c                   if        %found(fiarg01l)
285010100323     c                   eval      klna=lna_sav
285020100323     c                   eval      kksc=savmit
285030100323     c                   eval      klnp=blplnp
285040100323     c                   exsr      LeggiFGI
285050100323     c
285060100323    5c                   if        wfgi=*blanks
285070100323     c                   eval      klnp=999
285080100323     c                   exsr      LeggiFGI
285090100323    5c                   endif
285100100323     c
285110100323    5c                   if        wfgi='S' and fgicgi=argcgi
285120100323     c                   delete    fiarg000
285130100323    5c                   endif
285140100323    4c                   endif
285150100323    3c                   endif
285160100323    2c                   endif
285170100323     c
285180100323    2c                   if        vidrsd<>savrsd or
285190070404     c                             blpind<>savind or
285200070404     c                             blpprd<>savprd or
285210070404     c                             blpcad<>savcad or
285220070404     c                             blplod<>savlod or
285230070404     c                             blpnzd<>savnzd or
285240100323     c                             blplna<>lna_sav or
285250100323     c                             wksc<>savmit
285260100323     c
285270100323     c* non Faccio nulla se ho già aggiornato FIARG col nuovo mittente o
285280100323     c*  nuova linea di arrivo
285290100323    3c                   if        WaggioARG=' '
285300100323     c
285310100323    4c                   if        ot0err=*blanks and
285320071010     c                             ot0x1cgi<>*blanks and comlna=ot0x1pog
285330070924     c                   eval      w_cgi=ot0x1cgi
285340100323     c                   clear                   wupd              1
285350070404     c     kblp3         chain     fiarg01l
285360100323    5c                   if        %found(fiarg01l)
285370070404     c                   eval      wupd='1'
285380100323    5c                   endif
285390160129
285400160129     c* Vado in aggiornamento solo se: non c'è il giro "DIR" o se è cambiata
285410160129     c* la linea di arrivo
285420160129     c                   if        wupd=' '
285430160129     c                             or argcgi<>'DIR'
285440160129     c                             or blplna<>lna_sav
285450160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
285460160129    7c                   if        wupd='1' and argcgi='DIR'
285470160129     c                   exsr      sr_chiuDispoRA
285480160129    7c                   endif
285490070404     c                   exsr      ges_arg
285500160129     c                   else
285510160129     c                   if        wupd='1'
285520160129     c                   unlock    fiarg01l
285530160129     c                   endif
285540160129     c                   endif
285550100323   x4c                   else
285560160129     c* Non posso cancellare a prescindere.
285570160129     c* Cancello solo se il giro non è "DIR" oppure se è cambiata la
285580160129     c* linea di arrivo
285590160129     c***  kblp3         delete(e) fiarg01l
285600160129     c     kblp3         chain     fiarg01l
285610160129    5c                   if        %found(fiarg01l)
285620160129    6c                   if        argcgi<>'DIR' or blplna<>lna_sav
285630160129     c* se cancello il giro DIR chiudo anche la dispo e la relativa R.A.
285640160129    7c                   if        argcgi='DIR'
285650160129     c                   exsr      sr_chiuDispoRA
285660160129    7c                   endif
285670160129     c                   delete    fiarg000
285680160129   x6c                   else
285690160129     c                   unlock    fiarg01l
285700160129    6c                   endif
285710160129    5c                   endif
285720100323    4c                   endif
285730100323    3c                   endif
285740100323    2c                   endif
285750100323    1c                   endsl
285760070403     c
285770070403     c                   endsr
285780070404     C**************************************************************************
285790070404     C*   Aggiornamento/scrittura numero giro
285800070404     C**************************************************************************
285810070404     C     ges_arg       BEGSR
285820100323     c                   clear                   WaggioARG         1
285830070404     c                   if        wupd=*blanks
285840070404     c                   clear                   fiarg000
285850070404     c                   z-add     blpaas        argaas
285860070404     c                   z-add     blplnp        arglnp
285870070404     c                   z-add     blpnrs        argnrs
285880070404     c                   z-add     blpnsp        argnsp
285890070404     c                   endif
285900070404     c                   z-add     blplna        arglna
285910070404     c* p.o. di consegna capofila della £6 del p.o. di arrivo
285920070404     c                   clear                   dslv55
285930070404     c                   eval      d55tpt = '6'
285940070404     c                   z-add     blplna        d55lin
285950070404     c                   z-add     blpdsp        d55drf
285960070404     c                   call      'FNLV55R'
285970070404     c                   parm                    dslv55
285980070404     c                   z-add     d55tfa        argpoc
285990070404     c                   movel     'M'           argtgi
286000070404     c                   movel     w_cgi         argcgi
286010070404     c                   if        wupd=*blanks
286020070404     c                   write     fiarg000
286030070404     c                   else
286040070404     c                   update    fiarg000
286050070404     c                   endif
286060100323     c
286070100323     c                   eval      wAggioARG='S'
286080070404     c                   endsr
286090100323     C**************************************************************************
286100100323     c* Lettura file forzatura giro di consegna
286110100323     C**************************************************************************
286120100323     c     LeggiFGI      BEGSR
286130100323     c     kfgi          setll     azfgi01l
286140100323     c     kfgi          reade     azfgi01l
286150100323     c
286160100323     c                   dow       not %eof(azfgi01l)
286170100323     c                   if        blpdsp>=fgidde and blpdsp<=fgidsc
286180100323     c                             and fgiatb=' '  and klna = fgipog
286190100323     c                   eval      wfgi='S'
286200100323     c                   leave
286210100323     c                   endif
286220100323     c
286230100323     c     kfgi          reade     azfgi01l
286240100323     c                   enddo
286250100323
286260100323     c                   ENDSR
286270160129     C**************************************************************************
286280160201     C*   Chiusura dispo di Dirottamento/Reso e R.A. relativa
286290160129     C**************************************************************************
286300160129     C     sr_chiuDispoRABEGSR
286310160201     c                   clear                   wfine
286320160201     c     kblp3         setll     tiidc01l
286330160201     c     kblp3         reade     tiidc01l
286340160129     c                   dow       not  %eof(tiidc01l) and Wfine=*blanks
286350160201     c                   if        idcfla<>' '
286360160129     c*  CHIUSURA NOTE R.A.
286370160129     c                   exsr      sr_noteRa
286380160129     c*  Aggiorno il record TIIDC
286390160129     c                   eval      IDCELAUTE=KNMUS
286400160201     c*****              eval      IDCELADATA=%int( %subst( %char( %dec( +
286410160201     c*****                        %timestamp() ) ) :1 :14 ) )
286420160201      /free
286430160201              IDCELADATA=%int( %subst( %char( %dec( %timestamp() ) )
286440160201                                 :1 :14 ) );
286450160201      /end-free
286460160129     c                   update    tiidc000
286470160129     c                   eval      wfine='1'
286480160129     c                   endif
286490160201     c     kblp3         reade     tiidc01l
286500160129     c                   enddo
286510160129     c                   endsr
286520160129     c**********************************************************************
286530160129     c* CHIUSURA  Note R.A.
286540160129     c**********************************************************************
286550160129     C     sr_noteRa     BEGSR
286560160129     c                   clear                   fidna7ds
286570160129     C                   EVAL      IDNA7ANT=IDCANT
286580160129     C                   EVAL      IDNA7NUT=IDCNUT
286590160129     C                   EVAL      IDNA7PDT=IDCPDT
286600160201     C                   EVAL      IDNA7PCT=simPOU
286610160129     C                   EVAL      IDNA7utc=knmus
286620160129     c***????            eval      IDNA7NOT=wnot
286630160129     c                   call      'FIDNA7R'
286640160129     c                   parm                    fidna7ds
286650160129     c
286660160129     C                   ENDSR
286670070604     C**************************************************************************
286680070604     C*   Aggiornamento dati per PDA
286690070604     C**************************************************************************
286700070604     C     Sr_pda        BEGSR
286710070604     c* verifico se già estratti orm per pda
286720080111     C****               CLEAR                   dsbs02
286730080111     c****               clear                   dpdo
286740080111     C****               MOVEL     'C'           T02MOD
286750080111     C****               MOVEL     KNSIF         T02SIF
286760080111     C****               MOVEL     'PDO'         T02COD
286770080111     c****               movel(P)  g_ormpor      t02ke1
286780080111     C****               CALL      'TIBS02R'
286790080111     C****               PARM                    KPJBA
286800080111     C****               PARM                    dsbs02
286810080111    2C****               IF        T02ERR = *BLANKS
286820080111     C****               MOVEL     T02uni        dpdo
286830080111    2C****               ENDIF
286840080111     c****               clear                   aggpda            1
286850080111    1c****               if        d§pdodata>0
286860080111    2c****               if        ormddc<> d§pdodata
286870070604     c     kfnorf        chain     fnorf01l
286880070604    3c                   if        %found(fnorf01l)
286890080221     c**!!!kfipdo        chain     fipdo01t
286900080111    4c****               if        not %found(fipdo01t)
286910080221    4c**!!!              if        %found(fipdo01t)
286920080111     c****               eval      aggpda='N'
286930080111    4c****               endif
286940080111    3c****               endif
286950080111    2c****               endif
286960080111    2c****               if        aggpda=' '
286970070604     c                   clear                   fior56ds
286980070604     c                   eval      or56tla = 'O'
286990070604     c                   eval      or56poe = ormpoe
287000070604     c                   eval      or56nsr = ormnsr
287010070604     c                   eval      or56nor = ormnor
287020070604     c                   eval      or56nrv = ormnrv
287030080111     c                   eval      or56fgs = orffgs
287040080111     c                   eval      or56ndcd = orfndc
287050080111     c                   eval      or56ndca = orfndc
287060080111     c                   eval      or56ddc = orfddc
287070140121     c                   eval      or56cmd  = 'V'
287080140121     c                   eval      or56var = 'I'
287090070604     c                   call      'FIOR56R'
287100070604     c                   parm                    kpjbu
287110070604     c                   parm                    fior56ds
287120070604     c* se effettuato scarico memorizzo di avvisare dell'avvenuto sca-
287130070604     c* rico a PDA
287140070604    3c                   if        or56err=*blanks
287150070604     c                   eval      wmsg_pda='S'
287160070606     c                   exsr      sr_dst
287170070606     c                   move      dstpdr        w02pdr_p
287180070604    3c                   endif
287190080221    2c**!!!              endif
287200070604    1c                   endif
287210070604     c                   endsr
287220071023     C**************************************************************************
287230071023     C*   Impostazione campo partita iva mittente
287240071023     C**************************************************************************
287250071023     C     Sr_wpiva      BEGSR
287260071023     C     'PRIVATO'     SCAN      WPIVA         posiz             2 0    30
287270071023     c                   select
287280071023     c* solo numeri
287290071023     c* "PRIVATO senza iso
287300071023     c     *in30         wheneq    *off
287310071023     c     wiso          andge     *zeros
287320071023     c     *in30         oreq      *on
287330071023     c     posiz         andlt     3
287340071023     c                   movel     wpiva         vidcpm
287350071023     c* iso + numeri
287360071023     c* iso + "PRIVATO"
287370071023     c     *in30         wheneq    *off
287380071023     c     posiz         orgt      2
287390071023     c                   movel     wpiva         vidpim
287400071023     c                   endsl
287410071023     c                   endsr
287420071218     C**************************************************************************
287430071218     C*   Reperimento dati tabella cli
287440071218     C**************************************************************************
287450071218     C     Sr_dcli       BEGSR
287460071218     C                   CLEAR                   dsbs02
287470071218     c                   clear                   dcli
287480071218     C                   MOVEL     'C'           T02MOD
287490071218     C                   MOVEL     KNSIF         T02SIF
287500071218     C                   MOVEL     'CLI'         T02COD
287510071221     c                   movel(P)  wksc          t02ke1
287520071218     C                   CALL      'TIBS02R'
287530071218     C                   PARM                    KPJBA
287540071218     C                   PARM                    dsbs02
287550071218    2C                   IF        T02ERR = *BLANKS
287560071218     C                   MOVEL     T02uni        dcli
287570071218    2C                   ENDIF
287580131003     c* Personalizzazione instradamento merce:
287590131003     c* se pieni, sposto peso e volume medio in campi numerici
287600131003     c                   clear                   n_§clipsm
287610131003     c                   clear                   n_§clivlm
287620131003     c                   testn                   §clipsm              30
287630131003     c                   if        *in30 and %subst(§clipsm:7:1)>='0'
287640131003     c                   move      §clipsm       n_§clipsm
287650131003     c                   endif
287660131003     c                   testn                   §clivlm              30
287670131003     c                   if        *in30 and %subst(§clivlm:5:1)>='0'
287680131003     c                   move      §clivlm       n_§clivlm
287690131003     c                   endif
287700131003     c
287710071218     c                   endsr
287720071220     C**************************************************************************
287730071220     C*   Controlli per abilitazione modifica lna di sped. disk B
287740071220     C**************************************************************************
287750071220     C     Sr_chkabilna  BEGSR
287760120817     c***  kblt1         setll     fnblt01l
287770120817     c***  kblt1         reade(N)  fnblt01l
287780120817     c***                dow       not %eof(fnblt01l)
287790120817     c     kblt1         setll     fiart01l
287800120817     c     kblt1         reade(N)  fiart01l
287810120817     c                   dow       not %eof(fiart01l)
287820120817     c     kanm2         setll     fnbrv07l
287830071220     c* - presenti spunte dei segnacolli con la vecchia lna
287840071220     c                   if        %equal(fnbrv07l)
287850071220     c                   seton                                        4790
287860071221     c                   movel     err(315)      vidmsg
287870071220     c                   goto      f_chkabilna
287880071220     c                   endif
287890071220     c* - non presenti spunte dei segnacolli con la nuova lna
287900071221     c     kbrv7         setll     fnbrv07l
287910071220     c                   if        not %equal(fnbrv07l)
287920071220     c                   seton                                        4790
287930071221     c                   movel     err(316)      vidmsg
287940071220     c                   goto      f_chkabilna
287950071220     c                   endif
287960071220     c* - segnacolli doppi sulla nuova lna
287970120829     c* - Non controlla presenza su fiars perchè in questa situazione ars non c'
287980120829     c*   è
287990120817     c**   kbrv7         setll     fnblt27l
288000120817     c**                 if        %equal(fnblt27l)
288010120817     c**   kbrv7         chain     fnblt27l
288020120817     c     kbrv7         setll     fiart27l
288030120817     c                   if        %equal(fiart27l)
288040120817     c     kbrv7         chain     fiart27l
288050071221     c                   seton                                        4790
288060071221     c                   clear                   vidmsg
288070080103     c                   eval      vidmsg='SEGNACOLLO'
288080071221     c                   eval      vidmsg=%trim(vidmsg) + ' ' +
288090120817     c                             %char(artnsc)
288100071221     c                   eval      vidmsg=%trim(vidmsg)+
288110080103     c                             ' DOPPIO: presente su spedizione '
288120120817     c                             + %char(artlnp)
288130120817     c                   eval      vidmsg=%trim(vidmsg)+ ' ' + %char(artnrs)
288140080103     c                             + '-'
288150080103     c                   eval      vidmsg=%trim(vidmsg) +
288160120817     c                             %char(artnsp) +' ' + %char(artaas)
288170071221     c                   goto      f_chkabilna
288180071221     c                   endif
288190120817     c***  kblt1         reade(N)  fnblt01l
288200120817     c     kblt1         reade(N)  fiart01l
288210071220     c                   enddo
288220071220     c* - nuova lna è estera
288230100210     c                   if        a_§ogntw<>'COR' and a_§ogntw<>'MES'
288240100210     c                   seton                                        4790
288250100210     c                   movel     err(317)      vidmsg
288260100210     c                   goto      f_chkabilna
288270100210     c                   endif
288280071220     c     f_chkabilna   endsr
288290080313     C**************************************************************************
288300080313     C*   Verifica se cliente con serie parziale
288310080313     C**************************************************************************
288320100517     C**   Sr_parz       BEGSR
288330100517     c**                 clear                   wparz
288340100517     c**                 clear                   wparz_d
288350100517     c**                 clear                   wparz_a
288360100517    1c**                 if        vidnrs>0
288370100517     c**                 eval      k_tbecod = '3CP'
288380100517     c**                 movel(p)  wksc          k_tbeke1
288390100517     c**   ktbe1         setll     tntbe01l
288400100517    2c**                 do        *hival
288410100517     c**   ktbe1         reade(N)  tntbe01l
288420100517    3c**                 if        %eof(tntbe01l)
288430100517     c**                 leave
288440100517    3c**                 endif
288450100517    3c**                 if        tbeatb='A'
288460100517     c**                 iter
288470100517    3c**                 endif
288480100517     c**                 movel     tbeuni        d3cp
288490100517     c**                 clear                   w007a             7
288500100517     c**                 eval      w007a  = %subst(tbeke2: 3: 7)
288510100517     c**                 move      w007a         wparz_d
288520100517     c**                 z-add     §3cpal        wparz_a
288530100517     c**                 eval      wparz = 'S'
288540100517    2c**                 enddo
288550100517    1c**                 endif
288560100517     c**                 endsr
288570090327     C**************************************************************************
288580090327     C*    PULIZIA CAMPI window cliente/tariffa tassazione porti assegnati
288590090327     C**************************************************************************
288600090327     C     sr_inzwdwcli  BEGSR
288610090327     c                   clear                   wcliksc
288620090327     c                   clear                   wclidks
288630090327     c                   clear                   wclictr
288640090327     c                   clear                   atrwksc
288650090327     c                   clear                   atrwctr
288660090327     c                   endsr
288670090323     C**************************************************************************
288680090323     C*   Gestione window per immissione/modifica cli/tariffa per tassaz. p.a.
288690090323     C**************************************************************************
288700090323     C     geswdw_clitar BEGSR
288710090323     c                   exsr      riewdwcli
288720090325     c                   clear                   hcliriga
288730090325     c                   clear                   hclicolo
288740090327     c                   eval      s_wcliksc=wcliksc
288750090326     c                   eval      s_wclictr=wclictr
288760090324     c                   eval      $fine='0'
288770090323     c*
288780090323     c                   dow       $fine='0'
288790090323     c                   exfmt     ls01wcli
288800090325     c                   eval      *in90='0'
288810090325     c                   clear                   hcliriga
288820090325     c                   clear                   hclicolo
288830090323     c                   select
288840090323     c* f12=Ritorno
288850090323     c                   when      *inkl='1'
288860090323     c                   eval      $fine='1'
288870090327     c                   eval      wcliksc=s_wcliksc
288880090326     c                   eval      wclictr=s_wclictr
288890090323     c                   other
288900090323     c* f6=conferma o enter
288910090323     c                   exsr      ctrwdwcli
288920090323     c                   if        *inkf and not *in90
288930090326     c                   eval      $fine='1'
288940090323     c                   endif
288950090323     c                   endsl
288960090323     c                   enddo
288970090323     c*
288980090323     c                   endsr
288990090324     C**************************************************************************
289000090324     C* Riempimento campi window cliente/tariffa per tassazione porti assegnati
289010090324     C**************************************************************************
289020090325     C     riewdwcli     BEGSR
289030090324
289040090324     c                   select
289050090324     c* DA ORM
289060090324     c                   when      partch<>'P' and flgfit<>'S'
289070090325     c                   exsr      sr_clearing
289080090324      * Se ORM richiede la bolla in porto assegnato e bolla in porto assegnato
289090090324      * memorizzo il codice cliente che servirà in arrivo in tassazione
289100090324      * porti assegnati. Memorizzo il codice cliente anche nel caso
289110090324      * di bolla in p.a. che fa parte del clearing dpd
289120090324if  2c                   If         ((§OrPfb = 'A' or wforpf = '1') and *In04
289130090324     c                              and Ormksc > *Zeros) or *in04 and wclg='S'
289140090324    3c                   if        wclg=' '
289150090327     c                   Z-add     OrmKsc        wcliksc
289160090325     c                   eval      atrwksc=prot
289170090327     c                   if        ormctr<>*blanks
289180090324     c                   Move      OrmCtr        wclictr
289190090325     c                   eval      atrwctr=prot
289200090324     c                   endif
289210090324   x3c                   else
289220090324     c* se spedizione che va nel clearing il codice cliente è da
289230090324     c* reperire su EDTAB tab 'PU'
289240090324     c                   eval      kedcod='PU'
289250090324     c                   clear                   kedkey
289260090324     c                   move      wopoe         com003a           3
289270090324     c                   eval      kedkey='DPD'+com003a
289280090324     c     kedtab        chain     edtab01l
289290090324    4c                   if        %found(edtab01l)
289300090324     c                   movel     tabuni        edidspu
289310090324     c                   if        §puormaksc>*zeros
289320090327     c                   move      §PUORMAKSC    wcliksc
289330090325     c                   eval      atrwksc=prot
289340090324     c                   endif
289350090327     c                   if        §puormactr<>*blanks
289360090324     c                   move      §PUORMACTR    wclictr
289370090325     c                   eval      atrwctr=prot
289380090324     c                   endif
289390090324    4c                   endif
289400090324    3c                   endif
289410090324e   2c                   EndIf
289420090324     c* DA PGM CHIAMANTE
289430090327     c                   when      *in12 and *in15 and *in04 and vidcbo<>'FW'
289440090325    1c                   if        §lpksca>*zeros
289450090325     c                   eval      w_§lpksca=§lpksca
289460090325     c                   eval      w_§lpctra=§lpctra
289470090325   x1c                   else
289480090325    2c                   if        savfpr='T' or savfpr='P'
289490090325     c                   z-add     §lpccm        w0040
289500090325     c                   if        w0040<> 9999
289510090325     c                   move      §lpccm        w_§lpksca
289520090325     c                   if        §lpctr<>999
289530090325     c                   move      §lpctr        w_§lpctra
289540090325     c                   endif
289550090325     c                   endif
289560090325    2c                   endif
289570090325    1c                   endif
289580090325    1c                   if        w_§lpksca>*zeros
289590090327     c                   movel     w_§lpksca     wcliksc
289600090324     c                   eval      atrwksc=prot
289610090327    2c                   if        w_§lpctra<>*blanks
289620090325     c                   move      w_§lpctra     wclictr
289630090324     c                   eval      atrwctr=prot
289640090325    2c                   endif
289650090325    1c                   endif
289660090324     c* DA CONFERMA BOLLE PER BOLLE "FW"
289670090324     c                   when      *in12 and *in15 and vidcbo='FW'
289680090324     c                             and (%Subst(§lpNot:1:18) = wnotfw
289690090324     c                             or   %Subst(§lpNt2:1:18) = wnotfw)
289700090324     c                   Clear                   w007a
289710090324     c                   If        %Subst(§lpNot:1:18) = wnotfw
289720090324     c                   Eval      w007a = %Subst(§lpNot:20:7)
289730090324     c                   Else
289740090324     c                   Eval      w007a = %Subst(§lpNt2:20:7)
289750090324     c                   EndIf
289760090324      * verifico che siano tutti numeri
289770090324     c                   if        %check(digits:w007a)=0
289780090327     c                   Move      w007a         wcliksc
289790090324     c                   eval      atrwksc=prot
289800090324     c                   EndIf
289810090325     c                   endsl
289820090326     c*
289830090327     c                   if        wcliksc>0
289840090326     C                   clear                   TIBS69DS
289850090327     C                   z-add     wcliksc       I69kac
289860090326     C                   call      'TIBS69R'
289870090326     C                   parm                    tibs69DS
289880090326     C                   parm                    ds_cnaco
289890090326     C                   parm                    ds_cnind
289900090326     C                   parm                    ds_cnclp
289910090326     C                   parm                    ds_fncls
289920090515     c                   eval      wclidks=BS_acorag
289930090326     c                   endif
289940090324     c
289950090324     c                   endsr
289960090325     C**************************************************************************
289970090325     C* Controllo window cliente/tariffa per tassazione porti assegnati
289980090325     C**************************************************************************
289990090325     C     ctrwdwcli     BEGSR
290000090327     c                   if        wcliksc=0
290010090326     c                   clear                   wclidks
290020090326     c                   endif
290030090325     c* codice cliente
290040090326     c                   if        atrwksc=*blanks
290050090327     c                   if        wcliksc>0
290060090326     c                   clear                   wclidks
290070090325     C                   clear                   TIBS69DS
290080090327     C                   z-add     wcliksc       I69kac
290090090327     C                   z-add     wcliksc       I69kin
290100090325     C                   call      'TIBS69R'
290110090325     C                   parm                    tibs69DS
290120090325     C                   parm                    ds_cnaco
290130090325     C                   parm                    ds_cnind
290140090325     C                   parm                    ds_cnclp
290150090325     C                   parm                    ds_fncls
290160090515     c                   eval      wclidks=BS_acorag
290170090325     C* ERRORE
290180090325     c     O69Err        Ifeq      '1'
290190090515     c     BS_acoflg     Orne      *Blanks
290200090325     C     wcliksc       OREQ      8888
290210090325     c                   eval      *in90=*on
290220090325     C                   MOVEL     err(319)      wclimsg
290230090325     c                   z-add     04            Hcliriga
290240090325     c                   z-add     18            Hclicolo
290250090325     c                   goto      endwcli
290260090325    2C                   ENDIF
290270130312    2C***  BS_Acoabl     IFEQ      '8'
290280130312    2C***  BS_acoabl     OREQ      '*'
290290130312    2C     BS_Acoabl     IFne      *blanks
290300090325     c                   eval      *in90=*on
290310090325     C                   MOVEL     err(320)      wclimsg
290320090325     c                   z-add     04            Hcliriga
290330090325     c                   z-add     18            Hclicolo
290340090325     c                   goto      endwcli
290350090325    2C                   END
290360090325     c                   endif
290370090325     c                   endif
290380090325     c* codice tariffa
290390090326     c                   if        atrwctr=*blanks and wclictr<>*blanks
290400090325     c* errore se manca il codice cliente
290410090327     c                   if        wcliksc=*zeros
290420090325     c                   eval      *in90=*on
290430090325     C                   MOVEL     err(319)      wclimsg
290440090325     c                   z-add     04            Hcliriga
290450090325     c                   z-add     18            Hclicolo
290460090325     c                   goto      endwcli
290470090325     c                   endif
290480090325     c*
290490090325     c                   eval      s_fnlv59ds=fnlv59ds
290500090325     C                   CLEAR                   fnlv59ds
290510090325     C                   MOVEL     'A'           ilv59tbo
290520090325      * Se bolla monovaria carico tutte le tariffe ma propongo la partenza
290530090325     C                   IF        §3ASVA <> *BLANK
290540090325     C                   movel     ' '           ilv59tbo
290550090325     C                   movel     'P'           ilv59prp
290560090325     C                   ENDIF
290570090325      *
290580090327     C                   MOVEL     wcliksc       ilv59KSC
290590090325     C                   MOVEL     KCI           ilv59KCI
290600090325     C                   MOVEL     WFIE          ilv59FIE
290610090325     C                   MOVEL     blpdsp        ilv59DSP
290620090325     C                   MOVEL     vidtsp        ilv59TSP
290630090325     C                   MOVEL     'S'           ilv59RIC
290640090325     c                   move      wclictr       ilv59ctr
290650090325     C*
290660090325     C                   CALL      'FNLV59R'
290670090325     C                   PARM                    fnlv59ds
290680090325     C* ERRORE
290690090325     C     olv59msg      IFNE      *BLANKS
290700090325     C                   MOVEL     olv59msg      wclimsg
290710090325     C                   eval      *in90='1'
290720090325     c                   z-add     05            Hcliriga
290730090325     c                   z-add     18            Hclicolo
290740090325     c                   eval      fnlv59ds=s_fnlv59ds
290750090325     C                   GOTO      endwcli
290760090325     C                   ENDIF
290770090325     c*
290780090325     c                   eval      fnlv59ds=s_fnlv59ds
290790090325     c                   endif
290800090325     c     endwcli       endsr
290810090324     C**************************************************************************
290820090324     C* Verifica se spedizione che va nel clearing
290830090324     C**************************************************************************
290840090324     C     sr_clearing   BEGSR
290850090324     c                   clear                   wclg
290860090324    1c                   if        *in12 and *in15='0' and
290870090324     c                             s_§b4poe=wopoe and
290880090324     c                             s_§b4nsr=wonsr and
290890090324     c                             s_§b4nor=wonor2 and
290900090324     c                             s_§b4nrv=wonrv
290910090324     c                   eval      wclg=§b4clg
290920090324   x1c                   else
290930090324     c* se spedizione commissionata da dpd con orm automatico
290940090324     c* verifico se
290950090324     c* sono presenti altre bolle aventi lo stesso orm per l'impostazione
290960090324     c* del flag §b4clg
290970090324     C
290980090324    2c                   if        ormrfa<>*blanks and %subst(ormrfa:1:
290990090324     c                             3)='DPD'
291000090324     c                   eval      kdpodep=%subst(ormrfa:4:4)
291010090324     c                   eval      w006a=%subst(ormrfa:8:6)
291020090324     c                   move      w006a         kdpoord
291030090324     c     kdpo          setll     fidpo03l
291040090324    3c                   if        %equal(fidpo03l)
291050090324     c                   eval      wclg='S'
291060090324     c                   movel     'M'           kar4trc
291070090324     c                   movel     widorm        kar4n14
291080160209     c     kar403        setll     fiar405l
291090090324    4c                   do        *hival
291100160209     c     kar403        reade     fiar405l
291110090324     c* fine file
291120160209    5c                   if        %eof(fiar405l)
291130090324     c                   leave
291140090324    5c                   endif
291150090324     c*
291160090324     c                   eval      wclg=' '
291170090324    4c                   enddo
291180090324    3c                   endif
291190090324    2c                   endif
291200090324    1c                   endif
291210090324     c                   endsr
291220090326     C**************************************************************************
291230090326     C* Carico cliente/tariffa per tassazione p.a. da fiar4 trk 'A'
291240090326     C**************************************************************************
291250090326     C     sr_daar4a     BEGSR
291260090326     C                   MOVEL     'A'           WTRC
291270090326     c     kblp4         chain(N)  fiar401l
291280090326     c                   if        %found(fiar401l)
291290090326     c                   movel     ar4not        dsbl4a
291300090326     C                   MOVEL     '3M'          COD
291310090326     C                   MOVEL(P)  Vidsop        KEY
291320090326     C                   EXSR      CTABEL
291330090327     c                   if        §b4aks>0
291340090327     c                   z-add     §b4aks        wcliksc
291350090327     c                   if        s_ormksc>0  or not *in30
291360090326     c                   eval      atrwksc=prot
291370090326     c                   endif
291380090327     c                   if        §b4act<>*blanks
291390090326     c                   move      §b4act        wclictr
291400090327     c                   if        (s_ormksc>0 and s_ormctr<>*blanks)
291410090327     c                             or (not *in30 and s_ormksc=0)
291420090326     c                   eval      atrwctr=prot
291430090326     c                   endif
291440090327     c                   else
291450090327     c* se cod.tariffa non presente ma bolla non da orm proteggo comunque se
291460090327     c* ksc impostato altrimenti poi se fosse sprotetto non avrebbero più
291470090327     c* la possibiltà di correggerlo in caso di errore
291480090327     c                   if        not *in30 and wcliksc>0 and s_ormksc=0
291490090327     c                   eval      atrwctr=prot
291500090327     c                   endif
291510090326     c                   endif
291520090326     c                   endif
291530090326     c                   endif
291540090326     c                   endsr
291550110512     C**************************************************************************
291560110512     C*   Gestione window per manutenzione indirizzo email destinatario
291570110512     C**************************************************************************
291580150213     C*    sr_geswdwemd  BEGSR
291590150213     c*                  clear                   hemdriga
291600150213     c*                  clear                   hemdcolo
291610150213     c*                  eval      $fine='0'
291620150213     c*                  eval      s_wemdest=wemdest
291630150213     c*                  eval      s_wsms   =wsms
291640110512     c*
291650150213     c*                  dow       $fine='0'
291660150213     c*                  exfmt     ls01wemd
291670150213     c*                  eval      *in90='0'
291680150213     c*                  clear                   hemdriga
291690150213     c*                  clear                   hemdcolo
291700150213     c*                  clear                   wemdmsg
291710150213     c*                  select
291720110512     c* f12=Ritorno
291730150213     c*                  when      *inkl='1'
291740150213     c*                  eval      $fine='1'
291750150213     c*                  eval      wemdest=s_wemdest
291760150213     c*                  eval      wsms=s_wsms
291770150213     c*                  other
291780110512     c* f6=conferma o enter
291790150213     c*                  if        wemdest<>*blanks
291800150213     c*                  if        wdesie='E'
291810150213     c*                  Eval      *In90 = *On
291820150213     c*                  Eval      wemdmsg = err(342)
291830150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
291840150213     c*                            ':eliminare Indir.'
291850150213     c*                  eval      hemdriga=3
291860150213     c*                  eval      hemdcolo=7
291870150213     c*                  else
291880150213     c*                  exsr      Sr_Chkemd
291890110512      * Errore
291900150213if  3c*                  If        §emlerro <> '0'
291910150213     c*                  Eval      *In90 = *On
291920150213     c*                  Eval      wemdmsg = err(340)
291930150213     c*                  eval      hemdriga=3
291940150213     c*                  eval      hemdcolo=7
291950150213   x3c*                  else
291960150213     c*                  Eval      wemdest = §emlindo
291970150213    3c*                  EndIf
291980150213     c*                  EndIf
291990150213     c*                  endif
292000150213     c*                  if        wsms<>*blanks
292010150213     c*                  if        wdesie='E'
292020150213     c*                  Eval      *In90 = *On
292030150213     c*                  Eval      wemdmsg = err(342)
292040150213     c*                  Eval      wemdmsg=%trimr(wemdmsg) +
292050150213     c*                            ':eliminare Cell.'
292060150213     c*                  eval      hemdriga=5
292070150213     c*                  eval      hemdcolo=7
292080150213     c*                  else
292090140423      /free
292100150216       //pinCell = %trim(wsms);
292110150216       //pOutErr = *blanks;
292120150213       //if UBCHKCEL_Check(pInCell:pOutCell:pOutErr) < 0 OR pOutErr = 'E';
292130140423
292140140423           // Numero di cellulare KO
292150150213       //   *In90 = *On;
292160150213       //   wemdmsg = err(351);
292170150213       //   hemdriga=5;
292180150213       //   hemdcolo=7;
292190150213    3  //EndIf;
292200140423      /end-free
292210150213     c*                  EndIf
292220150213     c*                  endif
292230150213     c*                  if        *inkf and not *in90
292240150213     c*                  eval      $fine='1'
292250150213     c*                  endif
292260150213     c*                  endsl
292270150213     c*                  enddo
292280110512     c*
292290150213     c*                  endsr
292300110705     C**************************************************************************
292310110705     C*   Gestione window per codici CUP e CIG
292320110705     C**************************************************************************
292330110705     C     sr_geswdwcup  BEGSR
292340110705     c                   eval      $fine='0'
292350110705     c                   eval      s_wcupcup=wcupcup
292360110705     c                   eval      s_wcupcig=wcupcig
292370110705     c*
292380110705     c                   dow       $fine='0'
292390110705     c                   exfmt     ls01wcup
292400110705     c                   eval      *in90='0'
292410110705     c                   select
292420110705     c* f12=Ritorno
292430110705     c                   when      *inkl='1'
292440110705     c                   eval      $fine='1'
292450110705     c                   eval      wcupcup=s_wcupcup
292460110705     c                   eval      wcupcig=s_wcupcig
292470110705     c                   other
292480110705     c* f6=conferma
292490110705     c                   if        *inkf
292500110705     c                   eval      $fine='1'
292510110705     c                   endif
292520110705     c                   endsl
292530110705     c                   enddo
292540110705     c*
292550110705     c                   endsr
292560090608     C**************************************************************************
292570090608     C* Carico limiti (peso/colli/volume) per tipo servizio
292580090608     C**************************************************************************
292590090608     C     sr_limtsp     BEGSR
292600090609     c                   clear                   wmsgtsp
292610090608     c                   clear                   trul73ds
292620090608     c                   if        vidtsp<>*blanks
292630090608     c                   eval      i73tsp=vidtsp
292640090608     c                   else
292650090608     c                   eval      i73tsp=comtsp
292660090608     c                   endif
292670111026     c* campi per la forzatura del messaggio di errore --> pulizia a cambio di
292680111026     c* tipo servizio
292690111026     c                   if        i73tsp<>savtsp73
292700111026     c                   clear                   wncl_pre
292710111026     c                   clear                   wpes_pre
292720111026     c                   clear                   wvol_pre
292730111026     c                   eval      savtsp73=i73tsp
292740111026     c                   endif
292750090619     c* Esco dalla routine senza effettuare il controllo se non ho il tipo
292760090619     c* servizio e provengo da controlli della prima videata:
292770090619     c* è successo che abbiano fatto un dirottamento ma il codice tariffa
292780090619     c* della bolla mamma utilizzato non è uno dei codici presenti per il
292790090619     c* cliente della bolla di dirottamento e quindi il tipo serivizio in
292800090619     c* questi casi è vuoto. In seconda videata poi saranno costretti a
292810090619     c* modificare il codice tariffa e di conseguenza i controlli limiti per
292820090619     c* tipo servizio verranno eseguiti correttamente
292830090619     c                   if        wvid='1' and i73tsp=*blanks
292840090619     c                   leavesr
292850090619     c                   endif
292860090609     c                   z-add     1             c
292870090609     c     i73tsp        lookup    tsp(c)                                 30
292880090609     c                   eval      i73psk=wpes
292890090608     c                   eval      i73vmc=wvol
292900090608     c                   eval      i73ncl=wncl
292910090608     c                   call      'TRUL73R'
292920090608     c                   parm                    trul73ds
292930090608     c                   select
292940090608     c                   when      o73err='E'
292950090608     c                   seton                                        90
292960090609     c                   eval      wmsgtsp=err(324)
292970090609     c                   eval      %subst(wmsgtsp: 40: 8)=dts08(c)
292980090609     c* colli bloccante
292990090608     c                   when      o73fclm='1'
293000090608     c                   seton                                        90
293010090609     c                   if        wvid='1'
293020090609     c                   seton                                        62
293030090609     c                   else
293040090609     c                   seton                                        41
293050090609     c                   endif
293060090609     c                   eval      wmsgtsp=err(325)
293070090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293080090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclm:'4')
293090090609     c* peso kg bloccante
293100090608     c                   when      O73FKGM='1'
293110090608     c                   seton                                        90
293120090609     c                   if        wvid='1'
293130090609     c                   seton                                        63
293140090609     c                   else
293150090609     c                   seton                                        42
293160090609     c                   endif
293170090609     c                   eval      wmsgtsp=err(326)
293180090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293190090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgm:'4')
293200090609     c*volume mc bloccante
293210090608     c                   when      O73FMCM='1'
293220090609     c                   seton                                        9047
293230090609     c                   eval      wmsgtsp=err(327)
293240090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293250090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcm:'4')
293260090609     c* colli forzabile
293270090608     c                   when      O73FCLF='1' and wncl<>wncl_pre
293280090608     c                   seton                                        90
293290090609     c                   if        wvid='1'
293300090609     c                   seton                                        62
293310090609     c                   else
293320090609     c                   seton                                        41
293330090609     c                   endif
293340090609     c                   eval      wmsgtsp=err(325)
293350090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293360090610     c                   eval      %subst(wmsgtsp: 37: 5)=%editc(o73lclf:'4')
293370090610     c                   eval      wmsgtsp=%trim(wmsgtsp)+ '. ENTER per forzare'
293380090609     c                   eval      wncl_pre=wncl
293390090609     c* peso kg forzabile
293400090609     c                   when      O73Fkgf='1' and wpes<>wpes_pre
293410090608     c                   seton                                        90
293420090609     c                   if        wvid='1'
293430090609     c                   seton                                        63
293440090609     c                   else
293450090609     c                   seton                                        42
293460090609     c                   endif
293470090609     c                   eval      wmsgtsp=err(326)
293480090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293490090610     c                   eval      %subst(wmsgtsp: 34: 8)=%editc(o73lkgf:'4')
293500090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
293510090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
293520090609     c                   eval      wpes_pre=wpes
293530090609     c* volume mc forzabile
293540090608     c                   when      O73FmcF='1' and wvol<>wvol_pre
293550090609     c                   seton                                        9047
293560090609     c                   eval      wmsgtsp=err(327)
293570090609     c                   eval      %subst(wmsgtsp: 19: 3)=dts03(c)
293580090610     c                   eval      %subst(wmsgtsp: 36: 6)=%editc(o73lmcf:'4')
293590090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' Avvisare ROM.'
293600090616     c                   eval      wmsgtsp=%trim(wmsgtsp)+ ' ENTER per forzare'
293610090609     c                   eval      wvol_pre=wvol
293620090608     c                   endsl
293630090608     c                   endsr
293640091111     C**************************************************************************
293650091111     C*   Gestione window per scelta beneficiario contrassegno
293660091111     C**************************************************************************
293670091111     C     geswdw_cas    BEGSR
293680091111     c                   exsr      riewdwcas
293690091111     c                   clear                   hcasriga
293700091111     c                   clear                   hcascolo
293710091111     c                   eval      $fine='0'
293720091111     c*
293730091111     c                   dow       $fine='0'
293740091111     c                   exfmt     ls01wcas
293750091111     c                   eval      *in90='0'
293760091111     c                   clear                   hcasriga
293770091111     c                   clear                   hcascolo
293780091111     c                   select
293790091111     c* f12=Ritorno
293800091111     c                   when      *inkl='1'
293810091111     c                   eval      $fine='1'
293820091111     c                   other
293830091111     c* f6=conferma o enter
293840091111     c                   exsr      ctrwdwcas
293850091111     c                   if        *inkf and not *in90
293860091111     c                   eval      $fine='1'
293870091111     c                   endif
293880091111     c                   endsl
293890091111     c                   enddo
293900091111     c*
293910091111     c                   endsr
293920091111     C**************************************************************************
293930091111     C* Riempimento campi window scelta beneficiario contrassegno
293940091111     C**************************************************************************
293950091111     C     riewdwcas     BEGSR
293960091111     c* mittente spedizione
293970091111     c                   eval      wcasmit=vidrsm
293980091111     c* ordinante O.R.M.
293990091117     c                   eval      wcascor=ormksc
294000091112     c* ..ragione sociale da cnaco
294010091112     C                   clear                   TIBS69DS
294020091112     C                   z-add     ormksc        I69kac
294030091112     C                   call      'TIBS69R'
294040091112     C                   parm                    tibs69DS
294050091112     C                   parm                    ds_cnaco
294060091112     C                   parm                    ds_cnind
294070091112     C                   parm                    ds_cnclp
294080091112     C                   parm                    ds_fncls
294090091112     c                   eval      wcasord=BS_acorag
294100091112     c*
294110091111     c* destinatario spedizione
294120091111     c                   eval      wcasdest=v2crsd
294130091111     c                   endsr
294140091111     C**************************************************************************
294150091111     C* Controllo window scelta beneficiario contrassegno
294160091111     C**************************************************************************
294170091111     C     ctrwdwcas     BEGSR
294180091111     c                   select
294190091111     c* Effettuare alemno una selazione
294200091111     c                   when      wcassel1=*blanks and wcassel2=*blanks
294210091111     c                   z-add     15            Hcasriga
294220091111     c                   z-add     36            Hcascolo
294230091112     C                   MOVEL     err(329)      wcasmsg
294240091112     c                   seton                                        90
294250091111     c* Selezionare o mittente o ordinante
294260091111     c                   when      wcassel1='X' and wcassel2='X'
294270091111     c                   z-add     15            Hcasriga
294280091111     c                   z-add     36            Hcascolo
294290091112     C                   MOVEL     err(330)      wcasmsg
294300091112     c                   seton                                        90
294310091211     c* ricontrollo il tipo incasso in base alla scelta effettuata
294320091211     c                   other
294330091211     c                   exsr      sr_trultic
294340091211     c                   if        oticerr='T' or  oticerr='C'
294350091211     C                   MOVEL     err(331)      wcasmsg
294360091214     c* eccendo anche indicatore per posizionamento su tic in seconda videata
294370091214     c                   seton                                        9049
294380091211     c                   endif
294390091111     c                   endsl
294400091111     c                   endsr
294410091119     C**************************************************************************
294420091119     C* Inizializzazione campi window scelta beneficiario D/A
294430091127     C**************************************************************************
294440091119     C     inzwdwcas     BEGSR
294450091119     c                   clear                   wcasmit
294460091119     c                   clear                   wcascor
294470091119     c                   clear                   wcasord
294480091119     c                   clear                   wcasdest
294490091119     c                   clear                   wcassel1
294500091119     c                   clear                   wcassel2
294510091211     c                   eval      nochkticC=*off
294520091119     c                   endsr
294530110516     C**************************************************************************
294540110516     C* Window per richiesta conferma annullamento
294550110516     C**************************************************************************
294560110516     C     sr_geswdwconf BEGSR
294570110516     c                   clear                   wvann
294580110516     c                   eval      $fine='0'
294590110516     c*
294600110516     c                   dow       $fine='0'
294610110516     c                   exfmt     ls01wann
294620110516     c                   if        *inkf
294630110516     c                   eval      $fine='1'
294640110516     c                   endif
294650110516     c                   enddo
294660110516     c                   endsr
294670110519     C**************************************************************************
294680110519     C* Controllo presenza bolle da confermare
294690110519     C**************************************************************************
294700110519     C     sr_chkvab     BEGSR
294710110519    4c                   if        s_wksc<>wksc
294720110519     c                   eval      wfvab=*off
294730110519    4c                   endif
294740110519     c     wksc          setll     fivab01l
294750110519     c     wksc          setll     edivab1l
294760110519    4c                   if        (%equal(fivab01l) or %equal(edivab1l) )
294770110519     c                             and (s_wksc<>wksc or wfvab=*off)
294780110519     c                   movel     '1'           wemfor
294790110519     c                   eval      wms1=err(341)
294800110519     c                   eval      wfvab=*on
294810110519    5c*                  select
294820110519     c*                  when      %equal(fivab01l) and
294830110519     c*                            %equal(edivab1l)
294840110519     c*                  eval      wms1=err(341)
294850110519     c*                  eval      wfvab=*on
294860110519     c*                  when      %equal(fivab01l)
294870110519     c*                  eval      wms1=err(341)
294880110519     c*                  eval      wfvab=*on
294890110519     c*                  when      %equal(edivab1l)
294900110519     c*                  eval      wfvab=*on
294910110519     c*                  eval      wms1=err(341)
294920110519    5c*                  endsl
294930110519     c                   eval      $fine='0'
294940110519     c                   dow       $fine='0'
294950110519     c                   exfmt     ls01wvab
294960110519     c* f12=Ritorno
294970110519     c                   if        *inkl='1'
294980110519     c                   eval      $fine='1'
294990110519     c                   endif
295000110519     c                   enddo
295010110519     c*
295020110519    4c                   endif
295030110519     c                   eval      s_wksc=wksc
295040110519     c                   endsr
295050110902     C**************************************************************************
295060110902     C* Invio email a CED per errore valore accorpamento spedizioni in consegna
295070110902     C**************************************************************************
295080110902     C     sr_mail       BEGSR
295090110902     C* Inizializzo variabili
295100110902     C                   movel     *blanks       wrkEmlTo        253
295110110902     C                   movel     *blanks       wrkEmlCc        253
295120110902     C                   movel     *blanks       wrkMsg         5000
295130110902     C                   movel     *blanks       wrkOgg           44
295140110902     C                   movel     *blanks       wrkesito          1
295150120302     C* Valorizzo i campi della @-mail
295160120302     C                   eval      wrkEmlTo='ced@brt.it'
295170110902     c                   eval      wrkEmlCc = *blank
295180110902     C                   eval      wrkOgg='PERFECT ORDER WURTH'
295190110902     C                   eval      wrkMsg='Valore di accorpamento "'   +
295200110902     c                             §lpxco                              +
295210110902     C                             '" non presente in tabella "XCO"'   +':/N'+
295220110902     C                             ' '                                 +':/N'+
295230110902     C                             'SPEDIZIONE: ' +%editc(blplnp:'X')  +
295240110902     c                             ' ' +%editc(blpnrs:'Z') + ' '       +
295250110902     c                             %editc(blpnsp:'Z') +' '             +
295260110902     c                             %editc(blpaas:'X')                  +':/N'+
295270110902     C                             'RMN: '+%editc(blprmn:'Z')          +':/N'+
295280110902     C                             'RMA: '+blprma                      +':/N'+
295290110902     c                             ' '                                 +':/N'+
295300110902     c                             ' '
295310110902     C*
295320110902     C                   call(e)   'TIS701C1'
295330110902     C                   parm                    wrkEmlto
295340110902     C                   parm                    wrkEmlCc
295350110902     C                   parm                    wrkOgg
295360110902     C                   parm                    wrkMsg
295370110902     C                   parm                    wrkesito
295380110902     c                   endsr
295390111026     C**************************************************************************
295400111026     C* Memorizzazione dati vecchi colli per scrittura R.A.
295410111026     C**************************************************************************
295420111026     C     sr_memRA      BEGSR
295430111026     c* devo memorizzare il numero dei colli e il range dal/al prima della
295440111026     c* riassegnazione per poi poterli memorizzare nel file delle R.A.
295450111026     c* Devo memorizzare anche se si tratta di variazione di lna o di
295460111026     c* aumento colli
295470111026     c                   eval      RA_ncd=vidncd
295480111026     c                   eval      RA_nca=vidnca
295490111026     c                   eval      RA_ncl=savncl
295500111026     c                   eval      RA_lna=savlna
295510111026     c
295520111026     c                   endsr
295530111026     C**************************************************************************
295540111026     C* Richiamo pgm di scrittura R.A. per bolla modificata con riass.segnacolli
295550111026     C**************************************************************************
295560111026     C     sr_wrtRA      BEGSR
295570140507     c                   clear                   fidna6ds
295580140507     c                   eval      ida06mad=' 30'
295590140507     c                   eval      ida06tor='S'
295600140507     c                   eval      ida06ogg=%editc(blplnp:'X') +
295610140507     c                             %editc(blpnrs:'X')+
295620111026     c                             %editc(blpnsp:'X')+%editc(blpaas:'X')
295630111026     c                   move      RA_lna        wRA_lna
295640111026     c                   if        wRa_lna<>blplna
295650140507     c                   eval      ida06no2='Ex LNA'
295660140507     c                   eval      ida06no2=%trim(ida06no2)+' '+RA_lna
295670140507     c                   eval      ida06no2=%trim(ida06no2)+' colli'
295680111026     c                   else
295690140507     c                   eval      ida06no2='Ex Nr. colli'
295700111026     c                   endif
295710140507     c                   eval      ida06no2=%trim(ida06no2)+
295720140507     c                             ' '+%editc(RA_ncl:'Z')
295730140507     c                   eval      %subst(ida06no2:36:13)='Segnacolli da'
295740140507     c                   eval      ida06no2=%trim(ida06no2)+
295750140507     c                             ' '+%editc(RA_ncd:'2')
295760111026     c                   if        RA_nca>0
295770140507     c                   eval      ida06no2=%trim(ida06no2)+
295780140507     c                             ' a '+%editc(RA_nca:'2')
295790111026     c                   endif
295800140507     c                   eval      ida06ute=knmus
295810140507     c                   eval      ida06fil=simpou
295820140507     c                   call      'FIDNA6R'
295830140507     c*****              parm                    kpjba
295840140507     c                   parm                    fidna6ds
295850111026     c                   endsr
295860130304     C* CONTROLLO SE nome file PDF doppio ---------------------------*
295870130304     C     pdfdop        BEGSR
295880130307     c                   movel     dsblp0        savblp
295890130304     c     kvat          reade(N)  fivat01l
295900130304    1c                   dow       not  %eof(fivat01l)
295910130304     c                   movel     vatnot        dvatp
295920130304    2c                   if        §vatppdfn<>*blanks
295930130306     c     kar8§pdf      setll     fiar802l
295940130306     c     kar8§pdf      reade     fiar802l
295950130304    3c                   dow       not %eof(fiar802l)
295960130304     c     kblpar8       chain     fnblp01l
295970130304    4c                   if        %found(fnblp01l)
295980130304     C                   Z-ADD     BLPMGS        WDSP
295990130304     C                   MOVEL     BLPAAS        WDSP
296000130305    5C     WDSP          IFGE      datapdf
296010130304     c     blpcca        andne     '7'
296020130304     C                   MOVEL     ERR(348)      VIDMSG
296030130304     C                   SETON                                        90
296040130307     C                   MOVEL     SAVBLP        DSBLP0
296050130304     c                   leavesr
296060130304     c                   endif
296070130304     c                   endif
296080130306     c     kar8§pdf      reade     fiar802l
296090130304    3c                   enddo
296100130304    2c                   endif
296110130304     c     kvat          reade(n)  fivat01l
296120130304    1c                   enddo
296130130307     C                   MOVEL     SAVBLP        DSBLP0
296140130304     c*
296150130304     C                   ENDSR
296160130308     C* Invio messagio a Ced se cliente fornisce pdf ma non abilitato*
296170130308     C     ced_alert     BEGSR
296180130311     c                   eval      wrkEmlTo = 'CedAlert@brt.it'
296190130308     c                   eval      wrkEmlcc = *blank
296200130312     c                   eval      wrkOgg = 'PDF del cliente ' +
296210130312     c                                      %editc(§lpccn:'X') +
296220130313     c                                      ' NON ELABORATO'
296230130313     C                   eval      wrkMsg = 'Il cliente ha trasmesso FIVAT' +
296240130313     c                                      ' Tipo Rek "P" ma non è abilitato.'
296250130308     c
296260130308     C                   CALL      'TIS701C1'
296270130308     C                   PARM                    wrkEmlTo        253
296280130308     C                   PARM                    wrkEmlCc        253
296290130308     C                   PARM                    wrkOgg           44
296300130308     C                   PARM                    wrkMsg         5000
296310130308     C                   PARM                    wrkesito          1
296320130308     c                   endsr
296330130924
296340130924     C* Scrittura Fiar8 + impostazione campi per fiar5 record GEN  --*
296350130924     c     sr_gesar8     begsr
296360130924     c* Se sono in conferma bolle da dischetto e ctm che prevede fivax
296370130924     c* scrivo fiar8
296380130924     c                   clear                   w_allx
296390130924     c                   clear                   w_allm
296400130924     c                   clear                   w_alls
296410130924     c                   If        *In12 and *In15
296420130924     c                             and §1bf16 = 'S'
296430130924     c                   if        wvax='S'
296440130924     c                   exsr      sr_fiar8
296450130924     c                   endif
296460130924     c                   if        wvatp='S'
296470130924     c                   exsr      sr_fiar8_vatp
296480130924     c                   endif
296490130924     c                   endif
296500130924     c* se richiamato da pgm "Wanda" vedo se creare fiar8 oer la nuova
296510130924     c* bolla copiando i dati dal fiar8 della bolla mamma
296520130924     c   12
296530130924    1can 15savfpr        ifeq      'G'
296540130924     c     savfpr        oreq      'P'
296550130924    2c     §lpar8        ifeq      'S'
296560130924     c     kbolm         setll     fiar801l
296570130924    3c                   do        *hival
296580150929     c     kbolm         reade     fiar801l
296590130924    4c                   if        %eof(fiar801l)
296600130924     c                   leave
296610130924    4c                   endif
296620130924     c                   Eval      Ar8Aas = BlpAas
296630130924     c                   Eval      Ar8Lnp = BlpLnp
296640130924     c                   Eval      Ar8Nrs = BlpNrs
296650130924     c                   Eval      Ar8Nsp = BlpNsp
296660130924     c                   if        aggioAr8='S'
296670130924     c                   write     fiar8000
296680130924     c                   endif
296690130924    4c                   if        ar8tmd<>'§PDF'
296700130924     c                   eval      w_allx='S'
296710130924     c                   else
296720130924     c                   eval      dar8§pdf=ar8uni
296730130924     c* il secondo byte è per la mail  ('1'=invia mail)
296740130924    5c                   if        %subst(§ar8pidz:2:1)='1'
296750130924     c                   eval      w_allm='S'
296760130924    5c                   endif
296770130924     c*
296780130924    5c                   if        %subst(§ar8pidz:1:1)='1' and
296790130924    5c                             (§ar8ptrt='S' or §ar8ptrt='X')
296800130924     c                   eval      w_alls='S'
296810130924    5c                   endif
296820130924     c*
296830130924    4c                   endif
296840130924    3c                   enddo
296850130924    2c                   endif
296860130924    1c                   endif
296870130924     c                   endsr
296880150701     C**************************************************************************
296890150701     C* Richiamo pgm di aggiornamento record fisgn duplicati su altro terminal
296900150701     C**************************************************************************
296910150701     C     sr_CalSgn     BEGSR
296920150701     c* Lo faccio solo per manutenzione perchè in immissione/conferma
296930150701     c* bolle, se updato fisgn perchè lo riutilizzo (se aveva  atb= "*" )
296940150701     c* è il  gufo che gestisce la cancellazione e la duplica per eventuale
296950150701     C* altro terminal di partenza
296960150701     c                   if        *in12 and not *in15
296970150701     c                   clear                   fnlssgnds
296980150701     c                   eval      isgntnp=sgntnp
296990150701     c                   eval      isgnwho=sgnwho
297000150701     c                   call      'FNLSSGNR1'
297010150701     c                   parm                    fnlssgnds
297020150701     c                   endif
297030150701     c                   endsr
297040151014     C*--- Registro peso e volume usati perfatturaz. in FIAR5 --------*
297050151014     C     REGPesivol    BEGSR
297060151014     c                   clear                   dar5fat
297070151014     c                   Eval      kar5trd='FAT'
297080151014     c     kfiar5        Chain     Fiar531c
297090151014     c                   If        %Found(Fiar531c)
297100151014     c                   Movel     ar5uni        dar5fat
297110151014     c                   endif
297120151014     c* Se tassata
297130151014    1c                   if        vidimv>0
297140151014     c* Volume
297150151014     c                   movel     blpvlf        §ar5vltas
297160151014     c                   movel     blpfvf        §ar5fvtas
297170151014     c* Peso
297180151014     c                   movel     blppkf        §ar5pktas
297190151014     c                   movel     'R'           §ar5fptas
297200151014     c
297210151016     c* NON Gestisco lA possibilità di memorizzare il peso vdl
297220151016     c* in quanto al tnsf20r non viene mai passato il taspkc
297230151014     c                   eval      §AR5DATAS=%dec(%date())
297240151014     c                   eval      §AR5HMTAS=%dec(%time())
297250151014     c                   eval      §AR5PRTAS=knmus
297260151014     c                   eval      §AR5NJTAS=knmtd
297270151014     c*
297280151014    1c                   endif
297290151014     c
297300151014      * aggiorno Fiar5 record "FAT"
297310151014if  1c                   If        %Found(Fiar531c)
297320151014     c* Se ho eliminato la tassazione  deleto
297330151014     c                   if        vidimv=0
297340151014     c                   delete    fiar500s
297350151014     c                   else
297360151014     c                   Movel(p)  dar5fat       Ar5uni
297370151014     c                   eval      ar5dac=%dec(%date())
297380151014     c                   eval      ar5orc=%dec(%time())
297390151014     c                   Update    Fiar500s
297400151014     c                   endif
297410151014      * scrivo   Fiar5 record "FAT"
297420151014   x1c                   Else
297430151014    2c                   if        vidimv>0
297440151014     c                   Clear                   Fiar500s
297450151014     c                   Eval      Ar5Aas = blpAas
297460151014     c                   Eval      Ar5Lnp = blpLnp
297470151014     c                   Eval      Ar5Nrs = blpNrs
297480151014     c                   Eval      Ar5Nsp = blpNsp
297490151014     c                   Eval      Ar5Trd = 'FAT'
297500151014     c                   Movel(p)  dar5fat       Ar5uni
297510151014     c                   eval      ar5dac=%dec(%date())
297520151014     c                   eval      ar5orc=%dec(%time())
297530151014     c                   Eval      AR5FT1='T'
297540151014     c                   Eval      AR5DT1=99999999
297550151014     c                   Eval      AR5FT2='T'
297560151014     c                   Eval      AR5DT2=99999999
297570151014     c                   Eval      AR5FT3='T'
297580151014     c                   Eval      AR5DT3=99999999
297590151014     c                   Write     Fiar500s
297600151014    2c                   EndIf
297610151014    1c                   EndIf
297620151014     c
297630151014     c                   ENDSR
297640151104     C*--- Memorizzazione flag per addebito ORM telefonico -----------*
297650151104     C     sr_b4ado      BEGSR
297660151117     c                   clear                   w_§b4ado
297670160210     C* ** Solo se:  non è un prepagato
297680160210     C*              orm non è fittizio **
297690160210     c*              no import
297700160210    1C                   if        not *in22      and
297710160210     c                             flgfit<>'S'    and
297720160210     c                             §ogntw<>'DPD' and §ogntw<>'EEX' and
297730160210     c                             §ogntw<>'FED'
297740160210
297750151104     c* Se Orm telefonico, di default imposto flag = 'S'
297760160210    2c                   if        (ORMTCO='M' or ormtco='E')
297770160209     c                             and (not *in04 or ormpag='O')
297780151117     c                   eval      w_§b4ado='S'
297790151104     c* Pulisco il flag se:
297800151104     c* già presente altra bolla abbinata allo stesso ORM che prevede
297810151104     c* l'addebito
297820151104     c                   movel     'M'           kar4trc
297830151104     c                   movel     widorm        kar4n14
297840160209     c     kar403        setll     fiar405l
297850160209     c     kar403        reade     fiar405l
297860160210    3c                   dow       not %eof(fiar405l) and w_§b4ado='S'
297870151104     c*
297880160209     c                   eval      a_dsbl4m=ar4not
297890160210    4c                   if        a_§b4ado='S' and
297900160210     c                             ((not *in12 or *in15) or
297910160210     c                              (§lpaas<>ar4aas or §lplnp<>ar4lnp or
297920160210     c                               §lpnrs<>ar4nrs or §lpnsp<>ar4nsp) )
297930151117     c                   clear                   w_§b4ado
297940160210    4c                   endif
297950160209     c     kar403        reade     fiar405l
297960160210    3c                   enddo
297970160210    2c                   endif
297980160210    1c                   endif
297990151104     c                   endsr
298000160120     C*--- Gestione window per interrogazione variaizoni fatte da arrivo
298010160120     C     sr_WdwF10     BEGSR
298020160120     c****               write     ls01d01
298030160120     c                   dow       $finef10='0'
298040160120     c                   write     ls01d01
298050160120     c                   exfmt     ls01wf10
298060160120     c                   select
298070160120     c* F10 = Visualizza variazioni
298080160120     c                   when      *inkj=*on
298090160120     C                   MOVEL     'P'           PA1TBO
298100160120     c                   eval      PA1AAS=§LPAAS
298110160120     c                   eval      PA1LNP=§LPLNP
298120160120     c                   eval      PA1NRS=§LPnrs
298130160120     c                   eval      PA1NSP=§LPNsp
298140160120     C                   MOVEL     PARAM1        KPJBU
298150160120     C                   CALL      'FNLR75R'
298160160120     C                   PARM                    KPJBA
298170160125     c* F16 = Visualizza R.A.
298180160125     c                   when      *inkq=*on
298190160126     c                   eval      wdna2lnp  = §lplnp
298200160126     c                   eval      wdna2nrs  = §lpnrs
298210160126     c                   eval      wdna2nsp  = §lpnsp
298220160126     c                   eval      wdna2aas = §lpaas
298230160125     c                   reset                   FIDNA2ds
298240160125     c                   eval      IA2ogg  = ds_OggSped
298250160125     c                   call      'FIDNA2R'
298260160125     c                   parm                    KPJBA
298270160125     c                   parm                    FIDNA2ds
298280160120     c* F12 = Ritorno
298290160120     c                   when      *inkl=*on
298300160120     c                   eval      $finef10='1'
298310160120     c                   endsl
298320160120     c                   enddo
298330160120     c                   endsr
298340160215     C*--- Verifica requisiti bolla export per instradare in DPD
298350160215     C     sr_InstrADPD  BEGSR
298360160406     c*
298370160224     c                   eval      w_aDpd='S'
298380160310     c
298390160310     c                   if        %lookup('999':sk_VPODPD)=0 and
298400160310     c                             %lookup(%editc(vidlnp:'X'):sk_VPODPD)=0
298410160310     c                   eval      w_aDpd='N'
298420160310     c                   leavesr
298430160310     c                   endif
298440160226     c* Peso bolla
298450160226    1c                   if        not*in12
298460160226     c                   z-add     vidpkg        pkgbolla
298470160226     c                   else
298480160226     c                   z-add     v2cpkg        pkgbolla
298490160226    1c                   endif
298500160226     c*
298510160226    1c                   if        deslad<=0 or
298520160226     c                             v1cncl<>1 or
298530160226     c                             pkgbolla>§3ipkd
298540160226     c                   eval      w_aDpd='N'
298550160226     c                   leavesr
298560160226    1c                   endif
298570160226
298580160406     c* recupero eventuale limite di peso e volume per nazione su tabella "16"
298590160226     C                   MOVEL     '16'          COD
298600160226     C                   MOVEL(P)  VIDNZD        KEY
298610160226     c                   clear                   ds16
298620160226     C                   EXSR      CTABEL
298630160226     C  n30              MOVEL     TBLUNI        DS16
298640160226     C   30              z-add     *hival        §16pkd
298650160406     C   30              z-add     *hival        §16vld
298660160226     c
298670160406     c* N.B: Il controllo di limite del volume verrà eseguito anche dopo
298680160406     c*      il calcolo del volume automatico (dopo l'esecuzione della routine
298690160406     c*      CALVOL)
298700160406     c                   if        pkgbolla > §16pkd  or
298710160406     c                             vidvol   > §16vld
298720160226     c                   eval      w_aDpd='N'
298730160226     c                   leavesr
298740160226     c                   endif
298750160226
298760160226     c* verifico eventuali blocchi per instradare a dpd  - TAB "IED"
298770160226     c                   clear                   fnlvdpds
298780160226     c                   eval      idplna=o95lna
298790160226     c                   eval      idpnaz=vidnzd
298800160226     c                   eval      idpccm=wksc
298810160226     c                   movel     fnlvdpds      kpjbu
298820160226     c                   call      'FNLVDPR'
298830160226     c                   parm                    kpjba
298840160226     c                   movel     kpjbu         fnlvdpds
298850160226     c                   if        odpesito='0'
298860160226     c                   eval      w_aDpd='N'
298870160226     c                   leavesr
298880160226     c                   endif
298890160226     c
298900160223     c* verifico eventuali blocchi cappario utilizzi particolari
298910160223     c                   eval      d_i97ntw='DPD'
298920160223     c                   call      'TISI97R'
298930160223     c                   parm                    dssi95
298940160223     c                   parm                    d_tisi97ds
298950160226    1c                   select
298960160224     c                   when      d_o97err<>*blanks
298970160224     c                   eval      w_aDpd='N'
298980160224     c                   leavesr
298990160224     c                   when      d_o97uti='N'
299000160224     c                   movel     d_o97flo      dcppflo
299010160226    2c                   if        §cppall='S'  or
299020160223     c                             (§cppcas='S' and i95fca='S') or
299030160223     c                             (§cpppas='S' and i95tpo='A') or
299040160223     c                             (§cpppas='O' and i95tpo='A' and
299050160223     c                              (flgfit='S' or i97ntw<>poentw))
299060160224     c                   eval      w_aDpd='N'
299070160224     c                   leavesr
299080160226    2c                   endif
299090160226    1c                   endsl
299100160222     c
299110160215     c                   endsr
299120941221     OFNLV22P   T    LRNLR
299130011212**   GGG
2991409006111234567
299150900511**   VAR
299160941011 ** IMMISSIONE  BOLLE  PARTENZE **
299170941011 ** MANUTENZIONE BOLLE PARTENZE **
299180941011 ** CONFERMA  BOLLE  DA CLIENTI **
299190941011 ** RECUPERO  IMMISSIONE  BOLLE **
299200941011 ** RECUPERO   CONFERMA   BOLLE **
299210990602 **   IMMISSIONE   PREPAGATI    **
299220030409** RigW  Max lung.67                                             67
299230030409              Spedizione da affidare a network FedEx
299240030409         Spedizione relativa ad ORM Commissionato da FedEx
299250030409- Indicare la NATURA DELLA MERCE in lingua inglese
299260030409- Indicare PESO e VOLUME reali
299270030409- Allegare COPIA della fattura alla lettera di vettura (DDT=SI)
299280030520- Allegare ai colli gli altri documenti ritirati dal cliente
299290030409- Indicare AWB FedEx nel Riferimento mittente numerico
299300030520- Allegare alla LDV TUTTI i documenti ritirati dal cliente (DDT=SI)
299310060110       Destinatario con obbligo del DDT in fase di consegna
299320060110Allegare alla LDV l'originale del documento di trasporto (DDT=SI)
299330151015        ATTENZIONE: Spedizione con Attraversamento Doganale.
299340151015Verificare che la NATURA MERCE sia conforme alla merce riportata
299350151015sul DDT
299360040329** cmdt
299370040329OVRDBF FILE(TITAS30C) TOFILE(
299380151014OVRDBF FILE(FIAR531C) TOFILE(
299390030409** ERR
299400030417Data cons. richiesta superiore a 1 mese dalla data odierna. ENTER x forzare   01
299410950920Data Spedizione formalmente errata  o  superiore a data sospensione xx/xx/xx
299420941020L'anno di spedizione non si puo' variare
299430941020Per le bolle di RECUPERO la Data Spedizione non puo' essere minore di 3 Giorni
299440061221Data Spedizione -per Spedizioni non di Recupero- non minore del xx/xx/xxxx
299450941020Data Ritiro Merce Errata
299460960926Data Ritiro Merce Errata:già confermati i conteggi autotrasp. in questa data
299470941020Linea di PARTENZA Errata
299480941021Immessa Varia "R" per 8888 o 9999 :obbligatorio l'imp.Assicur.Se 0 da tariffa 09
299490941020Codice Bolla Errato o non utilizzabile                                        10
299500941020Discordanza tra codice bolla e codice cliente mittente
299510110217Linea di Arrivo errata o annullata o bloccata                                 12
299520941020Non si puo' variare la linea di arrivo se bolla da cliente
299530941020Immettere la linea di arrivo
299540941110Tipo Servizio Errato o non inseribile dal bollettista                         15
299550941102Codice Trattamento Merce errato
299560950125ATTENZIONE!! TIPO SERVIZIO da x-xxxxxxxx   diventa  x-xxxxxxxx
299570030415Immettere il codice cliente se immessi i dati della Consegna Richiesta        18
299580941020Data Consegna Richiesta Errata
299590150202Ora Consegna richiesta Errata o non gestibile                                 20
299600960926Codice Autotrasportatore errato
299610941020Cliente Errato o Annullato
299620941020Codice inutilizzabile: cliente che non spedisce
299630941020Se immessa"Tassazione con Tariffa Mittente" inserire anche codice cliente mitt
299640941021Se immessa la Descrizione del Mittente indicare anche il codice: 8888 o 9999  25
299650980623ATTENZIONE! Spedizione di volume > xx,xxx mc. Avvisare ROM. ENTER per forzare 26
299660030728ATTENZIONE! Il numero colli è inferiore ai bancali inseriti                   27
299670940822Nazione Errata
299680950713Sigla Operatore non utilizzabile o non immessa
299690030905L'ORM richiede la bolla in Porto xxxxxxxxx                                    30
299700031029Non immettere la particolarità C/Assegno                                      31
299710031125Immettere la particolarità varia "O" per spedizione con bancali               32
299720941020Numero Spedizione gia' esistente o non immesso
299730941020Manca Numero COLLI
299740031125Immettere la particolarità varia "B" per spedizione con bancali               35
299750040216Referente e Telefono obbligatori per bolla Export con C/A. ENTER X FORZARE    36
299760941020Manca Dettaglio colli: inserirlo con F21 !!!
299770941021PESO Errato o diverso da precedente videata
299780941020MANCA NUMERATORE BOLLE: telefonare in Sede !!!!!!!
299790941020CONTO SERVIZIO : F6  per l'Immissione !!!                                     40
299800941020MANCA NUMERATORE PER STAMPA SEGNACOLLI: Telefonare in Sede !!!!!!
299810991117NUMERATORE BOLLE/SEGNACOLLI non disponibile: RITENTARE  NUOVAMENTE !!!
299820941102Se immesso tipo immettere anche la data o l'ora Consegna Richiesta
299830941020Inoltro Forzato:  F6  per Confermare l'Immissione
299840941102Numero Colli errato o diverso dalla prima videata                             45
299850980402Immettere il peso
299860941020Manca Riferimento Mittente Numerico
299870030805Serie ORM xx non gestita - AVVISARE IL CED                                    48
299880941020Serie incongruente con codice trattamento Merce
299890941020Numero Spedizione indicato in prima videata gia' esistente
299900941020Segnacollo Errato
299910980623ATTENZIONE! Spedizione di peso > xxxxxx,x kg. Avvisare ROM. ENTER per forzare 52
299920941020Manca natura merce
299930040216Referente e Tel. obbligatori per bolla EXPORT in P.Assegnato. ENTER X FORZARE 54
299940040727Spedizione già esistente!!!! Non è possibile confermare la bolla.             55
299950040213Bolla Export FedEx inserire il Telefono del destinatario. ENTER X FORZARE     56
299960090901T.Servizio "H" non ammesso per i tempi di trazione della bolla:F12 x corregg. 57
299970040216Spedizione con consegna a PRIVATI ins. il Telefono del dest.                  58
299980941110T A S S A Z I O N E   C O N   T A R I F F A   M I T T E N T E !!!!            59
299990090901Consegna richiesta non ammessa per tipo servizio "H"                          60
300000941020Zona digitata inesistente per la linea di arrivo della bolla
300010051007Consegna richiesta MINORE della data consegna teorica.
300020941020Giorno Chiusura Errato
300030030411§§Consegna particolare errata                                                 64
300040970408Impossibile annullare bolla LEGATA                                            65
300050030411§§dice Tariffa immesso ha TIPO SERVIZIO x-xxxxxxxx, diverso da quello in bolla66
300060100517Spedizione da cliente,impossibile modificare cod.Cliente Mittente:SERIE DIVERS67
300070030411§§Importo obbligatorio se immessa la sigla varia                              68
300080050429Non si puo' variare: bolla da disk clienti
300090030411§§Per bolla con C/Assegno e' obbligatoria la varia "G"                        70
300100100319ORM non inseribile: Tipo Servizio personalizzato o da disk"B" diverso dall'ORM71
300110100208Cod.Trattam.Merce "xx" non utilizzabile:forzato da"ConfermaBolle"in 1°videata 72
300120100319ORM non inseribile: linea Arrivo personalizzata o da disk"B" diversa dall'ORM
300130100319Forzata linea di arrivo e tipo servizio come da O.R.M.                        74
300140100319Forzato Tipo Servizio come da O.R.M.                                          75
300150100319Tipo Servizio diverso da quello definito sull'O.R.M.                          76
300160030411§§bligatorio dichiarare VALORE MERCE se destinat.estero con attraversam.dogana77
300170950410Non ammessi importi con decimali per la divisa indicata
300180950410Divisa errata                                                                 79
300190100210CAP Destin.Incongruente con L.Arrivo/PESO/VOLM:correggere T.Servizio"H" in "E"80
300200960926Codice non ammesso se cliente di altro punto operativo
300210941110Impossibile usare tariffa cliente per calcolare varia "G":tariffa inesistente
300220970724Bolla legata: impossibile impostare linea di arrivo uguale a linea di partenza83
300230950208Il cliente non presenta tariffe per la bolla ITALIA o ESTERO:ENTER per forzare84
300240950220La bolla presenta un numero segnacollo = 0 : verificare con F21               85
300250940909La serie non e' quella del cliente
300260940909Totale colli del dettaglio segnacolli non corrisponde
300270160303P.IVA obbligatoria se bolla Export con attraversam. dogana                    88
300280980310Non e' possibile inserire il numero AWB                                       89
300290970415CAP Destin.Incongruente con L.Arrivo/PESO/VOLM: ENTR x forzare; F12 x corregg.90
300300030904§§CAP Destinatario incongruente con Linea Arrivo:x spediz.in F.DEP. non si forza
300310941011SEGNACOLLO DOPPIO xxxxxxx  presente su  spedizione xxxx xxx xx xxxxxxx per xxx
300320940916Importo da Assicurare = 0 : ENTER per prendere il massimo importo da Tariffa
300330940916Importo da Assicurare obbligatorio, come indicato nella tariffa del cliente
300340011211Importo da Assicurare da non immettere, come indicato nella tariffa del clien.
300350011211Importo da Ass. > DEL LIMITE IMPOSTO XXXXXXXXXX,XXX EUR:TEL.IN SEDE X AUTORIZ.96
300360940916Importo da Assicurare superiore al mandato esposto in tariffa:ENTER x Forzare
300370940919Importo C/Assegno Errato
300380941110Tipo Incasso C/Assegno inesistente o non e' da indicare
300390110217Se immesso CAP o Nazione Mit.Originale immettere tutti 3 i campi:CAP NAZ e MIT
300400090921Fermo Deposito non ammesso per tipo servizio "H"                              01
300410940919Consegna Particolare inesistente o non utilizzabile
300420940919Particolarita' C/A errata,non ammessa o non utilizzabile x il cliente indicato
300430941219Errori in Tassazione                                                           4
300440001106Se modificata la divisa, ridigitare il relativo importo
300450950102Q.ta'da fatturare = 0 per tariffa a valore:ENTER per prendere importo da assic 6
300460950103Inserire la quantita' fatturare  per tariffa a valore
300470950102Q.ta'da fatturare non inseribile per tariffa a valore:assunto importo da assic 8
300480950103Q.ta'da fatturare = 0 per tariffa a quantita'
300490950525Riferimento mitt.alfabetico obbligatorio se destin.estero con attravers.dogana
300500950410Se Imp.Assicurare e Val.Merce uguali, devono anche avere la stessa divisa     11
300510950410Se stessa divisa, importo da Assicurare e Valore Merce devono essere uguali
300520030411§§IMPOSSIBILE ANNULLARE BOLLA: gia' consegnata                                13
300530030411§§IMPOSSIBILE ANNULLARE BOLLA: bolla in consegna                              14
300540950421Zona arrivo xx da bolla cliente diversa da zona xx risultante dal Cappario    15
300550950421Data fattura prepagato deve essere dello stesso mese della data spedizione    16
300560950525Impossibile forzare LINEA ARRIVO ITALIA se destinatario estero                17
300570950525Impossibile forzare LINEA ARRIVO ESTERA se destinatario italiano              18
300580950717"Tassazione con Tariffa Mittente"ammessa solo per assegnati con mittente codif19
300590951027Bolla non confermabile: segnacollo  xxxxxxx  presente piu' volte in bolla     20
300600951027Le consegne particolari non possono essere uguali                             21
300610050714Attenzione!! Verificare Importo da Assicurare e Valore Merce. ENTER X FORZARE 22
300620960213Fermo Deposito errato                                                         23
300630960319Spedizione legata a bolla precedente: non si puo' modificare il codice bolla
300640960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio: F12 x corregg
300650960320Le spedizioni dirette a 102=BO-SEDE devono essere in C/Servizio
300660960805Bolla cliente con dettaglio colli: impossibile modificare il numero segnacolli27
300670970704Manca provincia del Mittente in anagrafica: INSERIRLA!!!!                     28
300680961111Se "FRANCO FRONTIERA" tassare la spedizione fino a Milano indicando il PORTO  29
300690080327Tipo Servizio immesso DIVERSO da tariffa e non forzabile                      30
300700011211Importo C/Assegno SUPERIORE al limite imposto XXXXXXXXXX,XXX EUR              31
300710030411§§Per porti assegnati EXPORT, impossibile inserire l'importo da assicurare    32
300720030411§§Per bolle IMPORT, impossibile inserire l'importo da assicurare              33
300730961204Per bolle di RESO  impossibile inserire il C/Assegno
300740970115Dicitura "                non ammessa nella natura merce per bolla ESTERO     35
300750970115Dicitura "                non ammessa nella natura merce per bolla ITALIA     36
300760970128Impossibile ristampare bolla non ancora stampata                              37
300770970328Bolle di recupero devono avere per forza  NO   D D T                          38
300780011212Il CAP prevede obbligatoriamente il documento di trasporto ( SI DDT )         39
300790970408Bolle dirette a nazione con attraversamento dogana devono avere   SI   D D T
300800970414Impossibile modificare linea di arrivo: bolla legata e legame gia' inviato
300810100118Non possono esserci bolle export con servizio XXXXXXXXXX                      42
300820970528Codice bolla non utilizzabile per bolle export                                43
300830030411§§Tassazione non ammessa per P.A. export. Accettata solo la varia N           44
300840971211Non e' possibile togliere il numero A.W.B.                                    45
300850980311Numero A.W.B. obbligatorio per questo codice mittente : F18 per inserirlo     46
300860971211Ultima cifra (CHECK DIGIT) del numero A.W.B. errata: deve essere x            47
300870030805Utilizzare codice bolla xx - ritiro contestuale a consegna.                   48
300880090921T.Servizio "H" non ammesso per C/Assegno da abilitare:F12 x correggere        49
300890030808Ritiro contestuale alla consegna: non trovato ORM abbinato. AVVISARE CED.     50
300900030411§§Impossibile variare il numero colli per bolle import etichettate EUROEXPRESS51
300910000904Codici "CHI SONO" mancanti: F22 per immetterli                                52
300920030411§§lla non confermabile:presenti in bolla segn.Euroexpress doppi.F22 X corregg.53
300930000904Il nr. colli non corrisponde al tot. cod."CHI SONO". F22 X CORREGGERE         54
300940980403Segn.EuroExpress XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX già presente in altra bolla   55
300950030411§§Impossibile selezionare cliente di altro Circuito                           56
300960060921Nazione destinatario valida per DPD soltanto per bolle di RESO!!              57
300970060922CAP inutilizzabile per il network xxx                                         58
300980990610Prepagato: Immettere nelle note il TELEFONO e REFERENTE del RITIRO            59
300990990610Prepagato: premere F14 per tassare o inserire tassazione fino all'imponibile
301000030411§§Non trovata tariffa per tassare i prepagati !!                              61
301010030411§§Per i prepagati i dati della fattura sono obbligatori                       62
301020990628Immettere la prestazione ritiro: mattina o pomeriggio                         63
301030990630MANCA NUMERATORE fatture Prepagati:impossibile confermare.Inserirlo in contab 64
301040060221Importo da assicurare INFERIORE a quanto previsto dalla legge                 65
301050030411§§Per i Prepagati, Numero fattura deve essere maggiore di XXXXXX              66
301060990830Data fattura modificata perche' gia' bloccata per contabilizzazione           67
301070990915Cod.Autotrasport.incongruente con indicazione di merce a magazzino.ENTR forza 68
301080991011E' obbligatorio indicare la divisa                                            69
301090030411§§Prepagati: cliente non codificato o senza tariffa obbligatoria la divisa xxx70
301100991026Numero di decimali errato per la divisa immessa                               71
301110030411§§Prepagati: utilizzare la divisa della tariffa del cliente, xxx              72
301120991026Codice bolla non valido per prepagati                                         73
301130991130Rif.Mittente numerico contiene PARCEL DPD non valido                          74
301140991203Numero PARCEL obbligatorio per EXPORT DPD : F18 per inserirlo                 75
301150991203Non e' possibile togliere il numero PARCEL DPD                                76
301160991203Il numero PARCEL DPD inserito non è corretto                                  77
301170991206Se linea di partenza DPD la spedizione deve essere di 1 collo                 78
301180991206Se linea di arrivo DPD la spedizione deve essere di 1 collo                   79
301190991213Spedizione D.P.D. : non ammesso un peso superiore a xxxxxx,x kg.              80
301200991214Numero  PARCEL D.P.D.  gia' presente                                          81
301210000113Data fattura errata perche'gia'contabilizzata ma impossibile il cambio d'anno!82
301220020214Linea di arrivo errata: non e' una linea prevista per il network              83
301230020214Numero DPD inseribile soltanto se richiesto il network DPD per l'estero       84
301240000120Numero DPD non inseribile: attribuito in modo automatico                      85
301250060612Manca il numero DPD. Inserirlo!!                                              86
301260061030Per network xxxxxx non ammesse spedizioni con C/Assegno per la nazione indicat
301270020214Non trovate tariffe DPD per il cliente: IMPOSSIBILE utilizzare il network DPD 88
301280061011CAP no trovato su cappario D.P.D:F12 x attivazione automatica int.Cappario DPD
301290000124Numero  PARCEL D.P.D.inserito in prima videata, gia' presente !!              90
301300060109Non si posso fare bolle export DPD per clienti soluzioni "B"
301310020214Per la nazione del destinatario non è previsto il network DPD                 92
301320000508Per corretta contabilizzazione,impossibile bollettare la fattura in SOSPENSION93
301330020201Tipo servizio non ammesso per la linea di partenza indicata                   94
301340000509Se linea di partenza POSTE la spedizione deve essere di 1 collo               95
301350000509Spedizione POSTE : peso superiore a xxxxxx,x kg.  Enter per forzare!          96
301360101022Data consegna richiesta immessa errata: cade in giorno festivo                97
301370000509Consegna particolare non ammessa per spedizione POSTE                         98
301380000509Sono ammesse solo spedizioni in  FRANCO  per le  POSTE
301390000509Ammessi soltanto clienti POSTE per spedizioni POSTE                           00
301400000622CAP o localita' inutilizzabili perche' obsoleti                               01
301410000622In conferma di bolle autogenerate POSTE non si puo'cambiare la linea di arrivo
301420000627Impossibile stampare la bolla:dati in controllo e non in aggiornamento!       03
301430000725Bolle poste: utilizzabili solo cod.trattamento merce soluzioni "B"            04
301440000830Presenti in bolla codici "CHI SONO" doppi. F22 PER CORREGGERE                 05
301450000904Terminal di partenza non abilitato all'uso del DISK C                         06
301460030904§§Cliente non abilitato all'uso del DISK C                                    07
301470000918Presenti in bolla codici "CHI SONO" errati. F22 PER CORREGGERE                08
301480020308ATTENZIONE:cod."CHI SONO"                                                     09
301490110419Immettere l'Autotrasportatore per interrogare l'O.R.M.                        10
301500001024Non trovato terminal di partenza della linea di partenza. TELEFONARE IN SEDE  11
301510001024Non trovato terminal di arrivo della linea di arrivo.     TELEFONARE IN SEDE  12
301520110217
301530001220SEGNAC.DOPPIO: presente su spedizione xxxx xxx xx xxxxxxx per xxx.ENTR x FORZ.
301540150929Cliente DPD: la linea di partenza deve corrispondere ad un p.o. DPD
301550010212Immettere il numero O.R.M.                                                    16
301560010212O.R.M. inesistente                                                            17
301570010220Immettere un  O.R.M. avente p.o. ritiro uguale alla linea di partenza bolla
301580010212O.R.M. in fase non bollettabile. ENTER PER FORZARE
301590010213Forzata linea di arrivo come da O.R.M.                                        20
301600010221Dati diversi rispetto a quelli definiti sull'O.R.M. ENTER PER FORZARE         21
301610010214Il numero O.R.M. non deve essere un prepagato                                 22
301620010214Il numero O.R.M. deve essere un prepagato                                     23
301630010215Codice tariffa diverso da quello definito sull'O.R.M.                         24
301640100319Linea di arrivo diversa da quella definita sull'O.R.M.                        25
301650100319ATTENZIONE:MODIFICATO O.R.M. - Alcuni dati potrebbero aver subito variazioni  26
301660010313La bolla presenta,nel dettaglio colli,un tot.colli errato: verificare con F21 27
301670010409O.R.M. annullato
301680020207Bolla Export       in p.ass.: immettere O.R.M. reale commiss. da p.o.         29
301690010504O.R.M. utilizzabile solo in "Conferma bolle da clienti". F20 PER FORZARE
301700090921Per tipo servizio "H" non ammesse consegne per APPUNTAMENTO o SUPERMERCATI    31
301710011112Divisa scaduta                                                                32
301720011114Manca la varia 'N'                                                            33
301730011211Importo da assicurare non ammesso                                             34
301740011212Importo da assicurare > di XXXXXXXXXX,XXX EUR: VERIFICARE. ENTER PER FORZARE  35
301750011212Importo C/Assegno INFERIORE a xxxxxxxxxx,xxx EUR                              36
301760011212Importo C/Assegno > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE       37
301770011212Valore merce dichiarato obbligatorio                                          38
301780011212Valore merce dichiarato INFERIORE a xxxxxxxxxx,xxx EUR                        39
301790011212Valore merce dichiarato SUPERIORE al limite imposto xxxxxxxxxx,xxx EUR        40
301800011212Valore merce dichiarato > di xxxxxxxxxx,xxx EUR:VERIFICARE. ENTER PER FORZARE 41
301810011212Gli importi inseriti SUPERANO il limite fatturabile, xxxxxxxxxx,xxx xxx       42
301820040116§§ orto varia SUPERA il limite fatturabile, xxxxxxxxxx,xxx xxx                43
301830020214Per la nazione del destinatario non è previsto il network FedEx               44
301840030221Bolla export FedEx: non ammesse spedizioni in C/Servizio                      45
301850020214Non trovate tariffe FedEx x il cliente:IMPOSSIBILE utilizzare il network FedEx46
301860020228Per la nazione del destinatario non è previsto il network Euroexpress         47
301870020319Non trovato il progressivo della tariffa di cartello: TELEFONARE IN SEDE      48
301880020320Linea di arrivo non manutenzionabile                                          49
301890020320Manca il numeratore per l'assegnazione dell'AWB FedEx:TELEFONARE IN SEDE      50
301900020320Numeratore AWB FedEx non disponibile: RITENTARE NUOVAMENTE !!!                51
301910020320Numeratore AWB FedEx oltre il massimo del range previsto: TELEFONARE IN SEDE  52
301920020417Non ammesso cliente mittente non codificato per P.A. Euroexpress              53
301930020507Bolle di recupero per bolle firmate devono avere  per forza  SI   D D T       54
301940040608Destinatario                 :immettere la relativa consegna particolare      55
301950020611C/servizio non ammesso per un prepagato                                       56
301960020731Non è possibile indicare contemporaneamente consegne particolari 'S' e 'X'    57
301970021111Spedizione xxxx xxx xx xxxxxxx per xxx già consegnata                         58
301980021118Valore merce dichiarato obbligatorio per territori Extra CEE                  59
301990021119Se immesso prefisso "FD" o "FM" tutti i segnacolli devo avere lo stesso pref. 60
302000021119Prefisso segnacollo valido solo per bolle FedEx                               61
302010021120Immettere codice tariffa della relativa cartello FedEx                        62
302020030904§§Non ammessa tariffa FedEx Documenti: peso superiore a Kg. xxxxxx,x          63
302030021120Peso incongruente con Bolla FedEx tipo Documenti                              64
302040030904§§Peso incongruente con Bolla FedEx tipo Merci                                65
302050021209Immettere il rif.mittente alfabetico, bolla con cons.particolare Supermercati 66
302060040213Spedizione con APPUNTAMENTO inserire il Telefono del destin.                  67
302070030114Immettere il n. bancali                                                       68
302080021218Tipo bancale errato                                                           69
302090021218Non ammesso stesso tipo bancale                                               70
302100030805Immettere il tipo e il n. bancali x particolarità varie "B" o "O"             71
302110030204Spedizione con bancali, verificare peso e volume                              72
302120030204Modificato il numero dei bancali, verificare peso e volume                    73
302130030805Immettere la particolarità varie "B" o "O" per spedizione con bancali         74
302140030321Bolla con più di 500 colli non è possibile bollettare "DISK C"                75
302150030411Immettere o i dati della consegna richiesta o il numero delle ore             76
302160051215Data consegna richiesta non ammessa: oltre                                    77
302170030415Le ore da aggiungere alla delivery devono essere:  24 - 48 - 72               78
302180130312Mancano dati per la gestione del Packing List/PDF del cliente                 79
302190040603Presenti progressivi riga duplicati nei dati per stampa DDT del cliente
302200040610Bolla senza colli: tipo merce V=valore non ammesso                            81
302210040614Impossibile annullare questa bolla "£ " --> già presente anche in arrivo      82
302220040917Attenzione: inserito mittente estero, VERIFICARE. Enter per continuare        83
302230040930Codice cliente non utilizzabile                                               84
302240041012Particolarità Varie='U':consegna per Appuntamento o a Supermercati non ammessa85
302250041013Per l'O.R.M. immesso già presenti altre bolle con diverso autotrasportatore   86
302260041110Spedizione che prevede la stampa del DDT nella LdV: obbligatorio NO DDT       87
302270041126Codice particolarità varie non utilizzabile per questa linea di partenza bolla88
302280041117ATTENZIONE! Il numero parcel DPD non inizia per 84. ENTER per FORZARE         89
302290041210ATTENZIONE! Manca il logo                                                     90
302300050221Presenti numeri parcel dpd da cliente ripetuti o in numero maggiore di 1      91
302310050309ATTENZIONE: manca il codice bolla. Telefonare IMMEDIATAMENTE in sede          92
302320050914Volume obbligatorio                                                           93
302330051214Consegna richiesta supera di                                                  94
302340060103Bolla in P.Assegnato diretta a destinatario che richiede il SI DDT.ENTER x FOR95
302350060109Bolla export DPD "Disk B":codice trattamento merce errato."Chi Sono" non Autom96
302360060208Prepagato già incassato: impossibile variare totale imponibile                97
302370060324Consegna part. per Appuntamento non valida: presente data consegna "Tassativa"98
302380060612Numero Parcel DPD non valido
302390060613Manca il numeratore per l'assegnazione del Parcel DPD:TELEFONARE IN SEDE      00
302400060613Numeratore Parcel DPD non disponibile: RITENTARE NUOVAMENTE !!!               01
302410060613Numeratore Parcel DPD oltre il massimo del range previsto: TELEFONARE IN SEDE 02
302420060621ATTENZIONE! Il numero parcel DPD non inizia per 084. ENTER per FORZARE        03
302430060707Per il Tipo Incasso C/Assegno richiesto immettere anche il Mittente Originale 04
302440060707Non è possibile variare Linea Arr. passando da network NON DPD a network DPD  05
302450061109Parcel DPD errato:i caratteri iniziali non corrispondono a un Depot esistente 06
302460090827Località non servita per il tipo servizio indicato                            07
302470061109Codice Fiscale obbligatorio per Prepagato non codificato: ENTER per forzare
302480061121O.R.M. commissionato da DPD: selezionare network "DPD"                        09
302490061127Presente C.A.: impossibile annullare                                          10
302500070307Linea di Arrivo     non ammessa per un prepagato di mitt. non codificato      11
302510070620Preapagato: numero O.R.M. non modificabile
302520070806Completare l'indirizzo del destinatario                                       13
302530071023P.Iva/Cd.Fiscale obbligatori per Prepagato non codificato: ENTER per forzare  14
302540071221Linea di arrivo non modificabile:presenti spunte sulla vecchia linea di arrivo15
302550071221Per la linea di arrivo richiesta mancano le spunte: modifica non ammessa      16
302560071221Linea di arrivo estera: non utilizzabile per manutenzione bolla cliente diskB 17
302570081110Codice bolla non valido per un codice trattamento merce di recupero           18
302580090325Codice cliente errato o inesistente                                           19
302590090325Codice cliente non utilizzabile: bloccato in Piano dei Conti                  20
302600090326Attenzione:cambiando l'ORM potrebbe cambiare il cliente/tariffa per tassazione21
302610090326Tasto funzionale non abilitato                                                22
302620090429ORM commissionato da DPD: la spedizione deve essere di 1 collo                23
302630090609Manca tabella Limiti per Tipo Servizio          - TELEFONARE IN SEDE          24
302640090901ATTENZIONE! Sped."   " di n.colli > xxxxx  non ammessa                        25
302650090901ATTENZIONE! Sped."   " di peso > xxxxxx,x Kg. non ammessa                     26
302660090901ATTENZIONE! Sped."   " di volume > xx,xxx mc. non ammessa                     27
302670091008Dato obbligatorio per Porto Assegnato Import                                  28
302680091112Effettuare almeno una selezione                                               29
302690091211Selezionare il mitt. OPPURE l'ordinante ORM                                   30
302700091211Tp.incasso C/A errato --> F12 x correggere                                    31
302710100215Particolarità CONSEGNA incongruente con tipo servizio della bolla             32
302720100217Particolarità CONSEGNA non ammessa se presente consegna richiesta             33
302730100217Particolarità CONSEGNA non ammessa per bolle di recupero o in C/servizio      34
302740101105Bolle dirette a  FEDEX  devono avere   SI   D D T                             35
302750110321ATTENZIONE! Presenti spunte entrata: F16 per forzare                          36
302760110419IMPOSSIBILE ANNULLARE IL PREPAGATO: O.R.M. già ritirato                       37
302770110419O.R.M. ASSEGNATO: disassegnare l'ORM per poter annullare il prepagato         38
302780110422ATTENZIONE: inserita data ritiro più vecchia di xx gg lavorativi.ENTERxFORZARE39
302790110516Presenti errori nell'indirizzo Email Destinatario                             40
302800110519Presenti bolle da VAS non confermate per il cliente mittente: VERIFICARE      41
302810110613Avviso al destinatario non previsto per bolla export                          42
302820130131Inserire la P.Iva o il Codice Fiscale.                                        43
302830151109P.Iva obbligatoria                                                            44
302840120508P.Iva "$$" non ammessa per prepagato                                          45
302850120515Bolla con attraversamento dogana: inserire la P.Iva o Cod.Fiscale se privato  46
302860120926Non si può trasformare un franco recupero in una bolla non di recupero        47
302870130312Nome PDF per gestione DDT del cliente già presente in altra bolla.Avvisare CED48
302880130313Cliente non abilitato al PDF.                                                 49
302890140114Presenti caratteri di punteggiatura all'Inizio e/o alla Fine della Località   50
302900140417Presenti errori nel numero di cellulare del destinatario                      51
302910141203Particolarità CONSEGNA con PIN CODE non gestita per Export:non sarà registrata52
302920141201Spedizione con PIN CODE: inserire una particolarità CONSEGNA con PIN CODE     53
302930141201Particolarità CONSEGNA con PIN CODE non valida per spedizione senza PIN CODE  54
302940141202Presente PIN CODE più lungo del massimo previsto: impossibile confermare      55
302950141202Presente PIN CODE con caratteri non ammessi: impossibile confermare           56
302960141203Non è possibile modificare la Particolarità Consegna: presente PIN CODE       57
302970150226Tipo Bancale non utilizzabile per particolarità varia "                       58
302980150226Cliente non abilitato all'utilizzo del tipo bancale per particolarità varia B 59
302990150413Spedizione per EXPO: non ammesso il Contrassegno                              60
303000150414Spedizione per EXPO possibile solo per bolle Franco                           61
303010150414Spedizione per EXPO non ammessa per la linea di arrivo                        62
303020151014Particolarità CONSEGNA "  " non ammessa per spedizioni export                 63
303030151106Codice Fiscale obbligatorio.                                                  64
303040160513O.R.M. commissionato da "EEX": la spedizione deve essere instradata a "EEX"   65
