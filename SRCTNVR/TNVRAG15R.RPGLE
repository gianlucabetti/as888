000100091029      //---------------------------------------------------------------
000200121112      //?Tnvrag15R - estrazione potenziali el potenziale
000300091029      //---------------------------------------------------------------
000400091029
000500091029     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600091029     h dftactgrp(*no) actgrp(*caller)
000700091029
000800091029      //---------------------------------------------------------------
000900091029      //?Dichiarazione file.
001000091029      //---------------------------------------------------------------
001100121113      // - File Anagrafica potenziali
001200121113     fTNCPO01L  if   e           k disk
001300091029
001400121113      // - File Anagrafica potenziali Eliminabile da storicizzare
001500121113     fTNCPOelF  o  a e             disk    rename(tncpo000:tncpoel)
001600121113
001700121113      // - File Anagrafica clienti
001800121113     fCNACO16L  if   e           k disk
001900121113
002000110411      // - File Attività
002100110426     fTiatc05L  if   e           k disk
002200110412
002300091029      //---------------------------------------------------------------
002400091029      //?Definizione costanti.
002500091029      //---------------------------------------------------------------
002600091029
002700091029      //---------------------------------------------------------------
002800091029      //?Definizione schiere.
002900091029      //---------------------------------------------------------------
003000091029
003100091029      //---------------------------------------------------------------
003200091029      //?Definizione aree dati.
003300091029      //---------------------------------------------------------------
003400091029      //---------------------------------------------------------------
003500091029      //?Definizione strutture dati.
003600091029      //---------------------------------------------------------------
003700101216
003800091029      // - Parametri ricevuti
003900091029     d KPJBA         e ds
004000110201
004100110201
004200091029      //---------------------------------------------------------------
004300091029      //?Definizione variabili globali.
004400091029      //---------------------------------------------------------------
004500091029
004600091029      // - Flags booleani
004700091029     d $End            s               n   inz(*off)
004800110201     d $EndAtc         s               n   inz(*off)
004900091029     d $Fine           s               n   inz(*off)
005000101216
005100101216      // - Indici di schiera
005200091029
005300091029      // - Campi di comodo
005400101217
005500110415
005600091029      //---------------------------------------------------------------
005700091029      //?Definizione procedure esterne.
005800091029      //---------------------------------------------------------------
005900101216
006000110131
006100101216      //---------------------------------------------------------------
006200101216      //?Definizione prototipi.
006300101216      //---------------------------------------------------------------
006400091029
006500091029      //---------------------------------------------------------------
006600091029      //?Definizione key-list.
006700091029      //---------------------------------------------------------------
006800091029
006900091029      //---------------------------------------------------------------
007000091029      //?Riepilogo indicatori.
007100091029      //---------------------------------------------------------------
007200091029
007300091029      //---------------------------------------------------------------
007400091029      //?M A I N - L I N E
007500091029      //---------------------------------------------------------------
007600091029
007700091029     c     *Entry        plist
007800091029     c                   parm                    KPJBA
007900091029
008000091029      /free
008100091029
008200091029       //?Operazioni iniziali
008300101216       exsr RoutInz;
008400110131
008500101216       //?Elabora
008600091029       DOW  $Fine = *off;
008700101216         exsr Elabora;
008800091029       ENDDO;
008900091029
009000091029       //?Operazioni finali
009100101216       exsr RoutEnd;
009200091029
009300091029       //--------------------------------------------------------------
009400091029       //?Operazioni iniziali.
009500091029       //--------------------------------------------------------------
009600101216       BEGSR RoutInz;
009700091029
009800091029       ENDSR;
009900101217
010000101216       //--------------------------------------------------------------
010100101216       //?Elabora.
010200101216       //--------------------------------------------------------------
010300101216       BEGSR Elabora;
010400101217
010500121113         //?Cerco tutti i potenziale eliminabili
010600101217         $End = *off;
010700121113         setll (0)TNCPO01L;
010800110131
010900121113         read   TNCPO01L;
011000121113         DOW not %eof(TNCPO01L) ;
011100121113           //?Potenziale eliminabile
011200121113             IF  CPOfls = 'E' ;
011300121113                 setll cpocpo CNACO16L;
011400121113
011500121113           //?Nessun KSC associato al potenziale
011600121113                 IF  not %Equal(CNACO16L);
011700121113           //?verifico se l'attività che l'ha reso eliminabile e di oltre 2 anni
011800121113                     exsr Sr_Elimina ;
011900121113                 ENDIF;
012000101216             ENDIF;
012100110131
012200121113           read  TNCPO01L;
012300110131         ENDDO  ;
012400110131
012500121113         $FINE = *on ;
012600101216       ENDSR;
012700110131
012800110131       //--------------------------------------------------------------
012900110131       //?Verifico se Potenziale Eliminabile
013000110131       //--------------------------------------------------------------
013100110131       BEGSR Sr_elimina ;
013200110201
013300121113         setgt cpocpo   tiatc05l ;
013400121113         readpe cpocpo tiatc05l ;
013500121113         dow not %eof(tiatc05l) ;
013600121113         If atccac = 'AA' ;
013700121113           readpe cpocpo tiatc05l ;
013800121113           iter ;
013900121113         ENDIF;
014000110131         //?Controllo se l'ultima attività eseguita sul potenziale è una 14 o 15
014100111026         If Atccac = '14' or Atccac = '15' ;
014200121113            if ATCdco <= 20101231 ;
014300121113               eval cpodtr = atcdco ;
014400121113               write tncpoel  ;
014500121113            Endif;
014600111026         ENDIF;
014700111026         leave ;
014800111026         Enddo ;
014900110201
015000110131       ENDSR;
015100110131
015200091029       //--------------------------------------------------------------
015300091029       //?Operazioni finali.
015400091029       //--------------------------------------------------------------
015500101216       BEGSR RoutEnd;
015600091029
015700091029         *inLR = *on;
015800091029         return;
015900091029
016000091029       ENDSR;
016100091029
016200091029      /end-free
