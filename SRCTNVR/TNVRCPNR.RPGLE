000100110414      //--------------------------------------------------------------
000200110510      //?TNVRcpnr - Aggiorna Codice Potenziale / ksc / nrv nelle note
000300110510      //?         -
000400110414      //--------------------------------------------------------------
000500110414
000600110414     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700110414     h dftactgrp(*no) actgrp(*caller)
000800110414
000900110414      //---------------------------------------------------------------
001000110414      //?Dichiarazione file.
001100110414      //---------------------------------------------------------------
001200110510     fTiatc01l  if   e           k disk
001300110511     fTIcpn01L  uf   e           k disk
001400110414
001500110414      //---------------------------------------------------------------
001600110414      //?Definizione costanti.
001700110414      //---------------------------------------------------------------
001800110414
001900110414      //---------------------------------------------------------------
002000110414      //?Definizione schiere.
002100110414      //---------------------------------------------------------------
002200110414
002300110414      //---------------------------------------------------------------
002400110414      //?Definizione aree dati.
002500110414      //---------------------------------------------------------------
002600110414
002700110414      // - Dati utente
002800110414     d §AzUte        e ds                  extname(AZUTE00F)
002900110414     d                                     dtaara
003000110414     d §DatiUte      e ds                  extname(dDatiUte)
003100110414     d                                     dtaara
003200110414
003300110414      //---------------------------------------------------------------
003400110414      //?Definizione strutture dati.
003500110414      //---------------------------------------------------------------
003600110414
003700110414      // - Parametri ricevuti
003800110414     d KPJBA         e ds
003900110414
004000110414      //---------------------------------------------------------------
004100110414      //?Definizione variabili globali.
004200110414      //---------------------------------------------------------------
004300110414
004400110414      // - Flags booleani
004500110414     d $End            s               n   inz(*off)
004600110414
004700110414      // - Indici di schiera
004800110414
004900110414      // - Campi di comodo
005000110414     d w_cpo           s             11  0 inz
005100110511     d w_atnp          s              3  0 inz
005200110414
005300110414      //---------------------------------------------------------------
005400110414      //?Definizione procedure esterne.
005500110414      //---------------------------------------------------------------
005600110414
005700110414
005800110414      //---------------------------------------------------------------
005900110414      //?prototipi
006000110414      //---------------------------------------------------------------
006100110414
006200110414      //---------------------------------------------------------------
006300110414      //?Definizione key-list.
006400110414      //---------------------------------------------------------------
006500110414
006600110414      //---------------------------------------------------------------
006700110414      //?Riepilogo indicatori.
006800110414      //---------------------------------------------------------------
006900110414
007000110414      //---------------------------------------------------------------
007100110414
007200110414      //---------------------------------------------------------------
007300110414      //?M A I N - L I N E
007400110414      //---------------------------------------------------------------
007500110414
007600110414     c     *Entry        plist
007700110414     c                   parm                    KPJBA
007800110414
007900110414      /free
008000110414
008100110414       //?Elaborazione attività / Visite
008200110414       exsr Sr_Aggiorna ;
008300110414
008400110414       //?Operazioni finali
008500110414       exsr RoutEnd;
008600110414
008700110414       //--------------------------------------------------------------
008800110414       //?Aggiornamento archivi Tiatc Tivis
008900110414       //--------------------------------------------------------------
009000110414       BEGSR Sr_aggiorna ;
009100110414
009200110414       // Imposto uno alla chiave perchè voglio evitare di leggere tutte
009300110414       // le attività non legate ai potenziali
009400110414         W_cpo = 1 ;
009500110511         setll W_cpo ticpn01l ;
009600110414         Dow not $end ;
009700110511             read(e) ticpn01l ;
009800110511        // se record impegnato leggo il successivo
009900110511             If %error ;
010000110511                iter;
010100110511             endif ;
010200110511             If %eof(ticpn01l) ;
010300110414                leave ;
010400110414             Endif ;
010500110511             If cpnatn = 0 ;
010600110414                iter ;
010700110414             Endif ;
010800110511        // cerco l'attività corrispondente
010900110511             If cpnatnp = 0 ;
011000110511                W_atnp = 1 ;
011100110511             else ;
011200110511                W_atnp = cpnatnp ;
011300110511             Endif ;
011400110511             Chain (cpntat:cpnatn:W_atnp) Tiatc01l ;
011500110511             If not %found(Tiatc01l);
011600110414                iter ;
011700110414             Endif ;
011800110511             If cpncpo = atccpo or cpncpo = 0 ;
011900110511                iter ;
012000110511             Endif ;
012100110414
012200110511             cpncpo = atccpo ;
012300110511             cpnksc = atcksc ;
012400110511             cpnnrv = atcnrv ;
012500110511             update ticpn000 ;
012600110414
012700110414         Enddo ;
012800110414
012900110414       ENDSR ;
013000110414       //--------------------------------------------------------------
013100110414       //?Operazioni finali.
013200110414       //--------------------------------------------------------------
013300110414       BEGSR RoutEnd;
013400110414
013500110414         *inLR = *on;
013600110414         return;
013700110414
013800110414       ENDSR;
013900110414
014000110414      /end-free
