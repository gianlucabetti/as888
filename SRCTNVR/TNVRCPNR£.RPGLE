000100110414      //--------------------------------------------------------------
000200110414      //?TNVRATC1 - Aggiorna Categoria Potenziale in TIATC
000300110414      //?         - nel FLO dei file
000400110414      //--------------------------------------------------------------
000500110414
000600110414     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000700110414     h dftactgrp(*no) actgrp(*caller)
000800110414
000900110414      //---------------------------------------------------------------
001000110414      //?Dichiarazione file.
001100110414      //---------------------------------------------------------------
001200110414     fTNCPO01L  if   e           k disk
001300110414     fTIATC04L  uf   e           k disk
001400110414
001500110414      //---------------------------------------------------------------
001600110414      //?Definizione costanti.
001700110414      //---------------------------------------------------------------
001800110414
001900110414      //---------------------------------------------------------------
002000110414      //?Definizione schiere.
002100110414      //---------------------------------------------------------------
002200110414
002300110414      //---------------------------------------------------------------
002400110414      //?Definizione aree dati.
002500110414      //---------------------------------------------------------------
002600110414
002700110414      // - Dati utente
002800110414     d §AzUte        e ds                  extname(AZUTE00F)
002900110414     d                                     dtaara
003000110414     d §DatiUte      e ds                  extname(dDatiUte)
003100110414     d                                     dtaara
003200110414
003300110414      //---------------------------------------------------------------
003400110414      //?Definizione strutture dati.
003500110414      //---------------------------------------------------------------
003600110414
003700110414      // - Parametri ricevuti
003800110414     d KPJBA         e ds
003900110414
004000110414      // - Flag operativi tiatc
004100110414     d datc01        e ds                  inz
004200110414
004300110414      // - Flag operativi tivis
004400110414     d dvis01        e ds                  inz
004500110414
004600110414
004700110414      //---------------------------------------------------------------
004800110414      //?Definizione variabili globali.
004900110414      //---------------------------------------------------------------
005000110414
005100110414      // - Flags booleani
005200110414     d $End            s               n   inz(*off)
005300110414
005400110414      // - Indici di schiera
005500110414
005600110414      // - Campi di comodo
005700110414     d w_cpo           s             11  0 inz
005800110414
005900110414      //---------------------------------------------------------------
006000110414      //?Definizione procedure esterne.
006100110414      //---------------------------------------------------------------
006200110414
006300110414
006400110414      //---------------------------------------------------------------
006500110414      //?prototipi
006600110414      //---------------------------------------------------------------
006700110414
006800110414      //---------------------------------------------------------------
006900110414      //?Definizione key-list.
007000110414      //---------------------------------------------------------------
007100110414
007200110414      //---------------------------------------------------------------
007300110414      //?Riepilogo indicatori.
007400110414      //---------------------------------------------------------------
007500110414
007600110414      //---------------------------------------------------------------
007700110414
007800110414      //---------------------------------------------------------------
007900110414      //?M A I N - L I N E
008000110414      //---------------------------------------------------------------
008100110414
008200110414     c     *Entry        plist
008300110414     c                   parm                    KPJBA
008400110414
008500110414      /free
008600110414
008700110414       //?Elaborazione attività / Visite
008800110414       exsr Sr_Aggiorna ;
008900110414
009000110414       //?Operazioni finali
009100110414       exsr RoutEnd;
009200110414
009300110414       //--------------------------------------------------------------
009400110414       //?Aggiornamento archivi Tiatc Tivis
009500110414       //--------------------------------------------------------------
009600110414       BEGSR Sr_aggiorna ;
009700110414
009800110414       // Imposto uno alla chiave perchè voglio evitare di leggere tutte
009900110414       // le attività non legate ai potenziali
010000110414         W_cpo = 1 ;
010100110414         setll W_cpo tiatc04l ;
010200110414         Dow not $end ;
010300110414             read(e) tiatc04l ;
010400110414        // se record impegnato leggo il successivo
010500110414             If %error ;
010600110414                iter;
010700110414             endif ;
010800110414             If %eof(tiatc04l) ;
010900110414                leave ;
011000110414             Endif ;
011100110414             If atccpo = 0 ;
011200110414                iter ;
011300110414             Endif ;
011400110414        // elaboro i soli record attività ancora da eseguire oppure eseguiti dal 11/Aprile/2011
011500110414             If atcdco > 0  and atcdco < 20110411 ;
011600110414                iter ;
011700110414             Endif ;
011800110414
011900110414             If W_cpo <> atccpo  ;
012000110414                W_cpo = atccpo   ;
012100110414       // a rottura di codice aggancio il file TNCPO per recuperare l'attuale
012200110414       // categoria da aggiornare sui files
012300110414                chain atccpo tncpo01l ;
012400110414                If not %found(tncpo01l) ;
012500110414       // Se non trovo il potenziale mi posizione sulle attività del potenmziale successivo
012600110414                   setgt W_cpo tiatc04l ;
012700110414                   Clear W_cpo ;
012800110414                   iter ;
012900110414                endif ;
013000110414             endif ;
013100110414             datc01 = atcflo ;
013200110414       // verifico se 1° categoria potenziale è blank e causale da fare valorizzata
013300110414       // valorizzo la categoria
013400110414             If §atccapo1 = ' ' and atccad <> '  ' ;
013500110414                §atccapo1 = cpofls ;
013600110414             Endif ;
013700110414
013800110414       // verifico se 2° categoria potenziale è blank e causale esecuzione valorizzata
013900110414       // valorizzo la categoria
014000110414             If §atccapo2 = ' ' and atccac <> '  ' ;
014100110414                §atccapo2 = cpofls ;
014200110414             Endif ;
014300110414
014400110414             atcflo = datc01 ;
014500110414             update tiatc000 ;
014600110414
014700110414         Enddo ;
014800110414
014900110414       ENDSR ;
015000110414       //--------------------------------------------------------------
015100110414       //?Operazioni finali.
015200110414       //--------------------------------------------------------------
015300110414       BEGSR RoutEnd;
015400110414
015500110414         *inLR = *on;
015600110414         return;
015700110414
015800110414       ENDSR;
015900110414
016000110414      /end-free
