000100120925      //--------------------------------------------------------------
000200121025      //?TNVRCRM14 - Storicizzo gli stati A2.
000300120925      //--------------------------------------------------------------
000400120925
000500120925     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600120925
000700120925      //---------------------------------------------------------------
000800120925      //?Dichiarazione file.
000900120925      //---------------------------------------------------------------
001000121001
001100120928       // -?File Storico
001200120928     fTICRM00F  o    e             disk
001300120925
001400120925      //---------------------------------------------------------------
001500120925      //?Definizione costanti.
001600120925      //---------------------------------------------------------------
001700120925
001800120925      //---------------------------------------------------------------
001900120925      //?Definizione schiere.
002000120925      //---------------------------------------------------------------
002100120925
002200120925      //---------------------------------------------------------------
002300120925      //?Definizione aree dati.
002400120925      //---------------------------------------------------------------
002500120925
002600120925      //---------------------------------------------------------------
002700120925      //?Definizione strutture dati.
002800120925      //---------------------------------------------------------------
002900120928
003000121001       // -?File TICPS00F
003100121001     d TICPSds       e ds                  extname(TICPS00F)
003200120925
003300120925      //---------------------------------------------------------------
003400120925      //?Definizione variabili globali.
003500120925      //---------------------------------------------------------------
003600120925
003700120925       // -?Flags booleani
003800120925     d wEoF            s               n   inz(*off)
003900120925
004000120925      //---------------------------------------------------------------
004100120925      //?Definizione procedure esterne.
004200120925      //---------------------------------------------------------------
004300120925
004400120925      //---------------------------------------------------------------
004500120925      //?Definizione prototipi.
004600120925      //---------------------------------------------------------------
004700120925
004800120925      //---------------------------------------------------------------
004900120925      //?Definizione key-list.
005000120925      //---------------------------------------------------------------
005100120925
005200120925      //---------------------------------------------------------------
005300120925      //?Riepilogo indicatori.
005400120925      //---------------------------------------------------------------
005500120925
005600120925      //---------------------------------------------------------------
005700120925
005800120925      //---------------------------------------------------------------
005900120925      //?M A I N - L I N E
006000120925      //---------------------------------------------------------------
006100120925
006200120925      /free
006300120925
006400120925       //?Operazioni iniziali
006500120925       exsr RoutInz;
006600120925
006700120925       //?Elabora
006800121001       exsr Sto_CPS;
006900120925
007000120925       //?Operazioni finali
007100120925       exsr RoutEnd;
007200120925
007300120925       //--------------------------------------------------------------
007400120925       //?Operazioni iniziali.
007500120925       //--------------------------------------------------------------
007600120925       BEGSR RoutInz;
007700120925
007800120925         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
007900120925
008000120925       ENDSR;
008100120928
008200120928       //--------------------------------------------------------------
008300121001       //?Storicizzo gli stati A2.
008400120928       //--------------------------------------------------------------
008500121001       BEGSR Sto_CPS;
008600120928
008700120928         wEoF = *off;
008800120927
008900121001       //?Leggo SOLO gli stati A2 li storicizzo
009000120928         exec sql
009100121001          DECLARE CPSA2 cursor for
009200121001          SELECT * from TICPS00F
009300121001          WHERE CPSfst = 'A2';
009400120928
009500120928         exec sql
009600121001           open CPSA2;
009700120928
009800120928         IF sqlcode < 0;
009900120928           wEoF = *on;
010000120928           leavesr;
010100120928         ENDIF;
010200120928
010300120928         DOW  not wEoF;
010400120928
010500121001           exec sql fetch next from CPSA2 into :TICPSds;
010600120928           IF  sqlcod = 100 or sqlcod < 0;
010700120928             wEoF = *on;
010800120928             leave;
010900120928           ENDIF;
011000120928
011100121001         //?Storicizzo lo stato
011200121001           clear TICRM000;
011300121001           CRMtrc = 'S';
011400121001           CRMcpo = CPScpo;
011500121001           CRMdai = CPSdim;
011600121001           CRMdaf = CPSdst;
011700121001           CRMmmd = CPScmd;
011800121012           CRMdca = 'VISITATO';
011900121030           IF  CPScmd = *blanks and CPScmm > 0;
012000121030             CRMmmd = 'Filiale ' + %subst(%editc(CPScmm:'X'):1:3);
012100121030           ENDIF;
012200121001           WRITE  TICRM000;
012300120928
012400120928         ENDDO;
012500120928
012600121001         exec sql close CPSA2;
012700120928         wEoF = *off;
012800120928
012900120928       ENDSR;
013000120925
013100120925       //--------------------------------------------------------------
013200120925       //?Operazioni finali.
013300120925       //--------------------------------------------------------------
013400120925       BEGSR RoutEnd;
013500120925
013600120925         *inLR = *on;
013700120925         return;
013800120925
013900120925       ENDSR;
014000120925
014100120925      /end-free
