000100100413      //---------------------------------------------------------------
000200121025      //?TNVRCRM16 - Elimina TFNTC su trattative no in TIVIS
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000101203     fTFNTC01L  uf   e           k disk    rename(TFNTC:TFNTC000)
001100121025     fTIVIS05L  if   e           k disk
001200100413
001300100413      //---------------------------------------------------------------
001400100413      //?Definizione costanti.
001500100413      //---------------------------------------------------------------
001600100413
001700100413      //---------------------------------------------------------------
001800100413      //?Definizione schiere.
001900100413      //---------------------------------------------------------------
002000090715
002100100413      //---------------------------------------------------------------
002200100413      //?Definizione aree dati.
002300100413      //---------------------------------------------------------------
002400100413
002500100413      //---------------------------------------------------------------
002600100413      //?Definizione strutture dati.
002700100413      //---------------------------------------------------------------
002800100415
002900100413      //---------------------------------------------------------------
003000100413      //?Definizione variabili globali.
003100100413      //---------------------------------------------------------------
003200100413
003300100413      // - Flags booleani
003400121025     d wEnd            s               n   inz(*off)
003500121025     d wNoVIS          s               n   inz(*off)
003600100413
003700100413      // - Campi di comodo
003800101203     d w0070           s              7  0
003900100413
004000100413      //---------------------------------------------------------------
004100100413      //?Definizione procedure esterne.
004200100413      //---------------------------------------------------------------
004300100413
004400100413      //---------------------------------------------------------------
004500121025      //?Definizione prototipi.
004600100413      //---------------------------------------------------------------
004700100413
004800100413      //---------------------------------------------------------------
004900100413      //?Definizione key-list.
005000100413      //---------------------------------------------------------------
005100100415
005200100413
005300100413      //---------------------------------------------------------------
005400100413      //?Riepilogo indicatori.
005500100413      //---------------------------------------------------------------
005600100413
005700100413      //---------------------------------------------------------------
005800100413      //?M A I N - L I N E
005900100413      //---------------------------------------------------------------
006000100413
006100100413      /free
006200100413
006300100413       //?Operazioni iniziali
006400100513       exsr RoutInz;
006500100413
006600100726       //?Elaboro
006700100726       exsr Elabora;
006800100413
006900100413       //?Operazioni finali
007000100513       exsr RoutEnd;
007100100413
007200100413       //--------------------------------------------------------------
007300100413       //?Operazioni iniziali.
007400100413       //--------------------------------------------------------------
007500100513       BEGSR RoutInz;
007600100726
007700100726         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
007800100413
007900100413       ENDSR;
008000100413
008100100413       //--------------------------------------------------------------
008200100422       //?Elaboro.
008300100413       //--------------------------------------------------------------
008400100513       BEGSR Elabora;
008500100413
008600121025         wEnd = *off;
008700100413
008800121025       //?Estraggo solo le note Trattativa
008900100413         exec sql
009000121025         DECLARE NTCt cursor for
009100101203         SELECT  NTCapl, NTCnk1, NTCnk2, NTCtnt
009200101203         FROM TFNTC00F
009300121025         WHERE NTCapl = 'T'
009400101203         ORDER by NTCnk1, NTCnk2, NTCtnt;
009500100413
009600121025         exec sql OPEN NTCt;
009700100413
009800121025         DOW  not wEnd;
009900121025           exec sql FETCH next from NTCt into :NTCapl, :NTCnk1,
010000121025                                              :NTCnk2, :NTCtnt;
010100100413           IF  sqlcod = 100 or sqlcod < 0;
010200121025             wEnd = *on;
010300100413             leave;
010400100413           ENDIF;
010500100422
010600121025         //?Controllo se esiste la trattativa su TIVIS
010700121025           exsr CtrVIS;
010800100726
010900121025         //?Se NON trovo TIVIS
011000121025         //?cancello la nota
011100121025           IF  wNoVIS;
011200121025             exsr DelNtc;
011300100726           ENDIF;
011400100413         ENDDO;
011500100413
011600121025         exec sql CLOSE NTCt;
011700100413
011800100413       ENDSR;
011900100726
012000100726       //--------------------------------------------------------------
012100121025       //?Controllo se esiste la trattativa su TIVIS.
012200100726       //--------------------------------------------------------------
012300121025       BEGSR CtrVIS;
012400100726
012500121025         wNoVis = *off;
012600101203
012700121025       //?Controllo se la trattativa esiste su TIVIS
012800101203         w0070 = %dec(%subst(NTCnk1:5:7):7:0);
012900121025         chain (w0070) TIVIS05L;
013000121025         IF  not %found(TIVIS05L);
013100121025           wNoVis = *on;
013200101203         ENDIF;
013300100726
013400100726       ENDSR;
013500100413
013600100413       //--------------------------------------------------------------
013700101203       //?Cancello la nota.
013800100413       //--------------------------------------------------------------
013900101203       BEGSR DelNtc;
014000100726
014100101203       //?Aggancio il file TFNTC
014200101203         chain (NTCapl:NTCnk1:NTCnk2:NTCtnt) TFNTC01L;
014300101203       //?Se non trovo vado via
014400101203         IF  not %Found(TFNTC01L);
014500100726           leavesr;
014600100726         ENDIF;
014700100422
014800101203       //?Cancello la nota
014900101203         DELETE TFNTC000;
015000100413
015100100413       ENDSR;
015200100413
015300100413       //--------------------------------------------------------------
015400100413       //?Operazioni finali.
015500100413       //--------------------------------------------------------------
015600100513       BEGSR RoutEnd;
015700100413
015800100413         *inLR = *on;
015900100413         return;
016000100413
016100100413       ENDSR;
016200100413
016300100413      /end-free
