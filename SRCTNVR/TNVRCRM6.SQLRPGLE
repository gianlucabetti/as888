000100100413      //---------------------------------------------------------------
000200100610      //?TNVRCRM6 - INFO trattative senza delta
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000100610     fTIVII01L  if a e           k disk
001100100413
001200100413      //---------------------------------------------------------------
001300100413      //?Definizione costanti.
001400100413      //---------------------------------------------------------------
001500100413
001600100413      //---------------------------------------------------------------
001700100413      //?Definizione schiere.
001800100413      //---------------------------------------------------------------
001900090715
002000100413      //---------------------------------------------------------------
002100100413      //?Definizione aree dati.
002200100413      //---------------------------------------------------------------
002300100413
002400100413      //---------------------------------------------------------------
002500100413      //?Definizione strutture dati.
002600100413      //---------------------------------------------------------------
002700100415
002800100415     d KPJBA         e ds
002900100415
003000100413      //---------------------------------------------------------------
003100100413      //?Definizione variabili globali.
003200100413      //---------------------------------------------------------------
003300100413
003400100413      // - Flags booleani
003500100413     d $End            s               n   inz(*off)
003600100413     d $Fine           s               n   inz(*off)
003700100513
003800100413      // - Campi di comodo
003900100610     d wDataOggi       s              8  0
004000100610     d wData_ISO       s               d   datfmt(*iso)
004100100610     d wVIIfil         s                   like(VIIfil)
004200100610     d wVIInrv         s                   like(VIInrv)
004300100610     d wVIItpf         s                   like(VIItpf) inz('DEL')
004400100413
004500100413      //---------------------------------------------------------------
004600100413      //?Definizione procedure esterne.
004700100413      //---------------------------------------------------------------
004800100413
004900100413      //---------------------------------------------------------------
005000100413      //?prototipi
005100100413      //---------------------------------------------------------------
005200100413
005300100413      //---------------------------------------------------------------
005400100413      //?Definizione key-list.
005500100413      //---------------------------------------------------------------
005600100413
005700100413      //---------------------------------------------------------------
005800100413      //?Riepilogo indicatori.
005900100413      //---------------------------------------------------------------
006000100413
006100100413      //---------------------------------------------------------------
006200100413      //?M A I N - L I N E
006300100413      //---------------------------------------------------------------
006400100413
006500100413     c     *Entry        plist
006600100610     c                   parm                    kpjba
006700100413
006800100413      /free
006900100413
007000100413       //?Operazioni iniziali
007100100513       exsr RoutInz;
007200100413
007300100610       //?Scrivo le info trattative DEL
007400100610       exsr Elabora;
007500100413
007600100413       //?Operazioni finali
007700100513       exsr RoutEnd;
007800100413
007900100413       //--------------------------------------------------------------
008000100413       //?Operazioni iniziali.
008100100413       //--------------------------------------------------------------
008200100513       BEGSR RoutInz;
008300100610
008400100610         wData_ISO = %date();
008500100610         wDataOggi = %dec(wData_ISO);
008600100413
008700100413       ENDSR;
008800100413
008900100413       //--------------------------------------------------------------
009000100422       //?Elaboro.
009100100413       //--------------------------------------------------------------
009200100513       BEGSR Elabora;
009300100413
009400100413         $End = *off;
009500100413
009600100413         exec sql
009700100610         DECLARE VII cursor for
009800100610         SELECT  VIInrv, VIIfil
009900100610         FROM TIVII00F
010000100610         GROUP by VIInrv, VIIfil
010100100610         ORDER by VIInrv;
010200100413
010300100610         exec sql OPEN VII;
010400100413
010500100413         DOW  not $End;
010600100610           exec sql FETCH next from VII into :wVIInrv, :wVIIfil;
010700100413           IF  sqlcod = 100 or sqlcod < 0;
010800100413             $End = *on;
010900100413             leave;
011000100413           ENDIF;
011100100422
011200100610       //?Se non trovo il record 'DEL' lo devo creare
011300100610           chain (wVIInrv : wVIItpf) TIVII01L;
011400100610           IF  not %found(TIVII01L);
011500100610             clear TIVII000;
011600100610             VIInrv = wVIInrv;
011700100610             VIItpf = wVIItpf;
011800100610             VIItva = '%';
011900100610             VIIdim = %dec(%date());
012000100610             VIIfil = wVIIfil;
012100100610             VIIpru = 'BATCH';
012200100610             write TIVII000;
012300100422           ENDIF;
012400100422
012500100413         ENDDO;
012600100413
012700100610         exec sql CLOSE VII;
012800100514
012900100413       ENDSR;
013000100413
013100100413       //--------------------------------------------------------------
013200100413       //?Operazioni finali.
013300100413       //--------------------------------------------------------------
013400100513       BEGSR RoutEnd;
013500100413
013600100413         *inLR = *on;
013700100413         return;
013800100413
013900100413       ENDSR;
014000100413
014100100413      /end-free
