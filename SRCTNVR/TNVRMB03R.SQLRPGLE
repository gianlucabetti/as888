000100120423      //---------------------------------------------------------------
000200120423      //
000300130128      //?      Cancella TICPI non presenti su TNCPO
000400120423      //
000500120423      //---------------------------------------------------------------
000600120423
000700120423     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800120423
000900120423      //---------------------------------------------------------------
001000120423      //?Dichiarazione file.
001100120423      //---------------------------------------------------------------
001200130125
001300130125      // - File info trattative
001400130128     fTICPI01L  uf   e           k disk
001500120423
001600120423      //---------------------------------------------------------------
001700120423      //?Definizione costanti.
001800120423      //---------------------------------------------------------------
001900120423
002000120423      //---------------------------------------------------------------
002100120423      //?Definizione schiere.
002200120423      //---------------------------------------------------------------
002300120423
002400120423      //---------------------------------------------------------------
002500120423      //?Definizione aree dati.
002600120423      //---------------------------------------------------------------
002700120423
002800120423      //---------------------------------------------------------------
002900120423      //?Definizione strutture dati.
003000120423      //---------------------------------------------------------------
003100120706
003200130128      // - File potenziali
003300130128     d tncpods       e ds                  extname(TNCPO00F)
003400120423
003500120423      //---------------------------------------------------------------
003600120423      //?Definizione variabili globali.
003700120423      //---------------------------------------------------------------
003800120423      // - Flags booleani
003900120423     d wEoF            s               n   inz(*off)
004000120423
004100120423      // - Campi di comodo
004200120423
004300120423      //---------------------------------------------------------------
004400120423      //?Definizione procedure esterne.
004500120423      //---------------------------------------------------------------
004600120423
004700120423      //---------------------------------------------------------------
004800120423      //?Definizione prototipi.
004900120423      //---------------------------------------------------------------
005000120423
005100120423      //---------------------------------------------------------------
005200120423      //?Definizione key-list.
005300120423      //---------------------------------------------------------------
005400120423
005500120423      //---------------------------------------------------------------
005600120423      //?Riepilogo indicatori.
005700120423      //---------------------------------------------------------------
005800120423
005900120423      //---------------------------------------------------------------
006000120423      //?M A I N - L I N E
006100120423      //---------------------------------------------------------------
006200120423
006300120423      /free
006400120423
006500120423       //?Operazioni iniziali
006600120423       exsr RoutInz;
006700120423
006800120430       //?Elabora file
006900120430       exsr Elabora;
007000120423
007100120423       //?Operazioni finali
007200120423       exsr RoutEnd;
007300120423
007400120423       //--------------------------------------------------------------
007500120423       //?Operazioni iniziali.
007600120423       //--------------------------------------------------------------
007700120423       BEGSR RoutInz;
007800120706
007900120706       //?Impostazione opzioni per SQL?
008000120706         exec sql   set  option  DynUsrPrf = *Owner,
008100120706                                 CloSqlCsr = *EndMod;
008200120423
008300120423       ENDSR;
008400120423
008500120423       //--------------------------------------------------------------
008600120430       //?Elabora file
008700120423       //--------------------------------------------------------------
008800120430       BEGSR Elabora;
008900120423
009000120423         wEoF = *off;
009100120423
009200130125       //?Leggo file Info Trattative
009300120706         exec sql
009400130125           DECLARE  INFO cursor FOR
009500130128           SELECT   CPIcpo from TICPI00F
009600130128           EXCEPTION JOIN TNCPO00F
009700130128           on CPIcpo = CPOcpo
009800130128           ORDER BY CPIcpo;
009900120706
010000120706         exec sql
010100130125           open INFO;
010200120706           IF sqlcode < 0;
010300120706             wEoF = *on;
010400120706           ENDIF;
010500120706
010600120706         DOW not wEoF;
010700120706           exec sql
010800130128             FETCH NEXT from INFO into :CPIcpo;
010900120706           IF sqlcod = 100 or sqlcod < 0;
011000120706             wEOF = *on;
011100120706             leave;
011200120706           ENDIF;
011300120706
011400130125         //?Cancello le info trattative
011500130128           setll CPIcpo TICPI01L;
011600130128           reade CPIcpo TICPI01L;
011700130128           DOW not %eof(TICPI01L);
011800130128             DELETE TICPI01L;
011900130128             reade CPIcpo TICPI01L;
012000130125           ENDDO;
012100120706
012200120706         ENDDO;
012300120706
012400120706       //?Chiudo il cursore
012500120706         exec sql
012600130125           close INFO;
012700120706
012800120706       ENDSR;
012900130125
013000120423       //--------------------------------------------------------------
013100120423       //?Operazioni finali.
013200120423       //--------------------------------------------------------------
013300120423       BEGSR RoutEnd;
013400120423
013500120423         *inLR = *on;
013600120423         return;
013700120423
013800120423       ENDSR;
013900051221
014000051221      /end-free
014100051221
