000100120423      //---------------------------------------------------------------
000200120423      //
000300130214      //?      Data Blocco cliente su TIACP00F
000400120423      //
000500120423      //---------------------------------------------------------------
000600120423
000700120423     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800120423
000900120423      //---------------------------------------------------------------
001000120423      //?Dichiarazione file.
001100120423      //---------------------------------------------------------------
001200130201
001300130214     fTIACP00F  uf   e             disk
001400120423
001500120423      //---------------------------------------------------------------
001600120423      //?Definizione costanti.
001700120423      //---------------------------------------------------------------
001800120423
001900120423      //---------------------------------------------------------------
002000120423      //?Definizione schiere.
002100120423      //---------------------------------------------------------------
002200120423
002300120423      //---------------------------------------------------------------
002400120423      //?Definizione aree dati.
002500120423      //---------------------------------------------------------------
002600120423
002700120423      //---------------------------------------------------------------
002800120423      //?Definizione strutture dati.
002900120423      //---------------------------------------------------------------
003000130214
003100130214       // -?Parametri ricevuti?
003200130214     d kpjba         e ds
003300130214
003400130214      // -?DS pgm ricerca data blocco cliente
003500130214     d TRULBLCDS     e ds
003600130214
003700130214      // -?File TIACP
003800130214     d ACPds         e ds                  extname(TIACP00F)
003900130214     d                                     prefix(w_)
004000120423
004100120423      //---------------------------------------------------------------
004200120423      //?Definizione variabili globali.
004300120423      //---------------------------------------------------------------
004400120423      // - Flags booleani
004500120423     d wEoF            s               n   inz(*off)
004600120423
004700120423      // - Campi di comodo
004800130214     d w_ACPrcd        s             15  0 inz
004900120423
005000120423      //---------------------------------------------------------------
005100120423      //?Definizione procedure esterne.
005200120423      //---------------------------------------------------------------
005300130214
005400130214      // -?PGM ricerca data blocco cliente
005500130214     d TRULBLCR        pr                  extpgm('TRULBLCR')
005600130214     d  KPJBA                              likeds(KPJBA)
005700130214     d  TRULBLCDS                          likeds(TRULBLCDS)
005800120423
005900120423      //---------------------------------------------------------------
006000120423      //?Definizione prototipi.
006100120423      //---------------------------------------------------------------
006200120423
006300120423      //---------------------------------------------------------------
006400120423      //?Definizione key-list.
006500120423      //---------------------------------------------------------------
006600120423
006700120423      //---------------------------------------------------------------
006800120423      //?Riepilogo indicatori.
006900120423      //---------------------------------------------------------------
007000120423
007100120423      //---------------------------------------------------------------
007200120423      //?M A I N - L I N E
007300120423      //---------------------------------------------------------------
007400130214
007500130214     c     *Entry        plist
007600130214     c                   parm                    kpjba
007700120423
007800120423      /free
007900120423
008000120423       //?Operazioni iniziali
008100120423       exsr RoutInz;
008200120423
008300120430       //?Elabora file
008400120430       exsr Elabora;
008500120423
008600120423       //?Operazioni finali
008700120423       exsr RoutEnd;
008800120423
008900120423       //--------------------------------------------------------------
009000120423       //?Operazioni iniziali.
009100120423       //--------------------------------------------------------------
009200120423       BEGSR RoutInz;
009300120706
009400130214       //?Impostazione opzioni per SQL?
009500130214         exec sql   set  option  DynUsrPrf = *Owner,
009600130214                                 CloSqlCsr = *EndMod;
009700120423
009800120423       ENDSR;
009900130204
010000130204       //--------------------------------------------------------------
010100130204       //?Elabora
010200130204       //--------------------------------------------------------------
010300130204       BEGSR elabora;
010400130204
010500130204         wEoF = *off;
010600130204
010700130214       //?Leggo il file
010800130204         exec sql
010900130214         DECLARE TIACP cursor FOR
011000130214         SELECT rrn(TIACP00F) as w_ACPrrn, TIACP00F.*
011100130214         from TIACP00F
011200130214         WHERE ACPcbc <> '   ';
011300130204
011400130204         exec sql
011500130214         open TIACP;
011600130204         IF sqlcode < 0;
011700130204           wEoF = *on;
011800130204         ENDIF;
011900130204
012000130204         DOW not wEoF;
012100130204           exec sql
012200130214           FETCH NEXT from TIACP into :w_ACPrcd, :ACPds;
012300130204           IF sqlcod = 100 or sqlcod < 0;
012400130204             wEOF = *on;
012500130204             leave;
012600130204           ENDIF;
012700130214
012800130214         //?Cerco la data blocco
012900130214           clear TRULBLCDS;
013000130214           IBLCkcc = 151;
013100130214           IBLCksc = w_ACPksc;
013200130214           trulblcr (KPJBA:TRULBLCDS);
013300130214           IF  OBLCdav > 0;
013400130214             chain w_ACPrcd TIACP00F;
013500130214             IF  %found(TIACP00F);
013600130214               ACPdbc = OBLCdav;
013700130214               update TIACP000;
013800130214             ENDIF;
013900130214           ENDIF;
014000130204         ENDDO;
014100130204
014200130204       //?Chiudo il cursore
014300130204         exec sql
014400130214           close TIACP;
014500130204
014600130204       ENDSR;
014700130125
014800120423       //--------------------------------------------------------------
014900120423       //?Operazioni finali.
015000120423       //--------------------------------------------------------------
015100120423       BEGSR RoutEnd;
015200120423
015300120423         *inLR = *on;
015400120423         return;
015500120423
015600120423       ENDSR;
015700051221
015800051221      /end-free
015900051221
