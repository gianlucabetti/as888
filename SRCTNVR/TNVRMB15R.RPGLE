000100121218      //---------------------------------------------------------------
000200121218      //
000300140331      //?              Invio immagini LDV a ALMAVIVA
000400121218      //
000500121218      //---------------------------------------------------------------
000600121218
000700121218     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800040119
000900040119      *---------------------------------------------------------------*
001000121218
001100140331     fALMAW_POD if   e           k disk    rename(ALMAW_POD:ALMAVIVA)
001200140331     fPRTF198   o    f  198        printer oflind(*inof)
001300121218     fTILAC00F  o    e           k disk
001400140331     fTITAS30C  if   e           k disk
001500040119
001600040119      *---------------------------------------------------------------*
001700090212
001800090212       // - Parametri x TRUL55R
001900090212     d TRUL55ds      e ds                  inz
002000090212     d   I55tla      e                     inz('C')
002100121218
002200121218      // Parametri
002300121218     d kpjba         e ds
002400121218
002500121218       // - Campi di comodo
002600121218
002700121218       // - flag booleani
002800121218     d wEoF            s               n
002900090212
003000090212       //--------------------------------------------------------------
003100090212       //?Definizione procedure usate.                                 ?
003200090212       //--------------------------------------------------------------
003300090212
003400090212       // - Determinazione nome dell'immagine per TILAC
003500090212     d trul55r         pr                  extpgm('TRUL55R')
003600140331     d trul55ds                            likeds(trul55ds)
003700040119
003800040119      *---------------------------------------------------------------*
003900121218
004000121218     c     *entry        plist
004100121218     c                   parm                    kpjba
004200040119
004300121218      /free
004400121218
004500121218        wEoF = *off;
004600121218
004700140331       // Leggo file ALMAVIVA
004800121218        DOW not wEoF;
004900140331          read  ALMAW_POD;
005000121218
005100121218       // fine file
005200140331          IF  %eof(ALMAW_POD);
005300121218            leave;
005400121218          ENDIF;
005500140331
005600140331       // Controllo se esiste la bolla
005700140331          setll (aas:lnp:nrs:nsp) TITAS30C;
005800140331          IF  not %found(TITAS30C);
005900140331            exsr stampa;
006000140331          ELSE;
006100140331            exsr elabora;
006200140331          ENDIF;
006300140331
006400121218        ENDDO;
006500121218
006600121218        *inLR = *ON;
006700140331
006800140331       //-------------------------------------------------------------**
006900140331       // Stampa errore
007000140331       //-------------------------------------------------------------**
007100140331        BEGSR stampa;
007200140331
007300140331          IF  not *in99 or *inof;
007400140331            except testa;
007500140331            *in99 = *on;
007600140331          ENDIF;
007700140331
007800140331          except riga;
007900140331
008000140331        ENDSR;
008100121218
008200121218       //-------------------------------------------------------------**
008300121218       // Elabora
008400121218       //-------------------------------------------------------------**
008500121218        BEGSR elabora;
008600121218
008700121218          clear TILAC000;
008800140331          LACtim  = '20140331100000';
008900140331          LACaas  = %subst(%editc(aas:'X'):3:2);
009000140331          LAClnp  = %editc(lnp:'X');
009100140331          LACnrs  = %editc(nrs:'X');
009200140331          LACnsp  = %editc(nsp:'X');
009300121218          LACcop  = 'CLI';
009400140331          LACdir  = 'ALMAVIVA SPOT';
009500140331          LACtpi  = 'TIF';
009600121218
009700121218       // flag nome immagine:
009800140331          clear  TRUL55ds;
009900140331          I55fmi = 'N ';
010000140331          I55lnp = lnp;
010100140331          I55nrs = nrs;
010200140331          I55nsp = nsp;
010300140331          I55aas = aas;
010400140331          I55rmn = rmn;
010500140331          I55fld = 'L';
010600140331          trul55r ( TRUL55ds );
010700140331          IF  O55err = *off;
010800140331            LACnim = O55niml;
010900140331          ENDIF;
011000121219
011100121219          LACela  = '00';
011200140331          LACtela = 'N';
011300140331          LACtad  = 'N';
011400140331          LACidjob = 'ALMAVIVA';
011500121218
011600121218          WRITE  TILAC000;
011700140331
011800140331        ENDSR;
011900050330
012000121218      /end-free
012100140331
012200140331     oPRTF198   e            testa          2 02
012300140331     o                                           20 'BARTOLINI S.p.A.'
012400140331     o                                           60 '**  ERRORI ALMAVIVA **'
012500140331     o                       udate              110 '  /  /  '
012600140331     o                                          120 'TNVRMB15R'
012700140331     o                                          128 'Pag.'
012800140331     o                       page          Z    132
012900140331     o          e            testa          2
013000140331     o                                            7 'Bolla'
013100140331     o          e            riga        1
013200140331     o                       aas                  4
013300140331     o                       lnp               +  1
013400140331     o                       nrs               +  1
013500140331     o                       nsp               +  1
