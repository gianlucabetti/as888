000100100413      //---------------------------------------------------------------
000200140714      //?TNVRMB20R - Da 00F/S a 10F/S tel/fax
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000140714     fTNCPO10f  o    e             disk
001100140714     fTNCPO10s  o    e             disk    rename(tncpo100:tncpo1s) prefix(s)
001200100413
001300100413      //---------------------------------------------------------------
001400100413      //?Definizione costanti.
001500100413      //---------------------------------------------------------------
001600100413
001700100413      //---------------------------------------------------------------
001800100413      //?Definizione schiere.
001900100413      //---------------------------------------------------------------
002000090715
002100100413      //---------------------------------------------------------------
002200100413      //?Definizione aree dati.
002300100413      //---------------------------------------------------------------
002400100413
002500100413      //---------------------------------------------------------------
002600100413      //?Definizione strutture dati.
002700100413      //---------------------------------------------------------------
002800100423
002900100423      // Anagrafica potenziali
003000100423     d TNCPOds       e ds                  extname(TNCPO00F)
003100140714
003200140714      // Anagrafica storico potenziali
003300140714     d TNCPOSds      e ds                  extname(TNCPO00S)
003400140714     d                                     prefix(s)
003500100415
003600100413      //---------------------------------------------------------------
003700100413      //?Definizione variabili globali.
003800100413      //---------------------------------------------------------------
003900100413
004000100413      // - Flags booleani
004100140714     d wEnd            s               n   inz(*off)
004200100413
004300100413      // - Campi di comodo
004400100413
004500100413      //---------------------------------------------------------------
004600100413      //?Definizione procedure esterne.
004700100413      //---------------------------------------------------------------
004800100413
004900100413      //---------------------------------------------------------------
005000140714      //?Definizione prototipi.
005100100413      //---------------------------------------------------------------
005200100413
005300100413      //---------------------------------------------------------------
005400100413      //?Definizione key-list.
005500100413      //---------------------------------------------------------------
005600100413
005700100413      //---------------------------------------------------------------
005800100413      //?Riepilogo indicatori.
005900100413      //---------------------------------------------------------------
006000100413
006100100413      //---------------------------------------------------------------
006200100413      //?M A I N - L I N E
006300100413      //---------------------------------------------------------------
006400100413
006500100413      /free
006600110304
006700140714       //?Elabora Potenziali
006800140714       exsr Elabora;
006900110304
007000140714       //?Elabora Storico potenziali
007100140714       exsr ElaboraS;
007200100413
007300100413       //?Operazioni finali
007400110304       exsr RoutEnd;
007500100420
007600100413       //--------------------------------------------------------------
007700140714       //?Elabora Potenziali.
007800100413       //--------------------------------------------------------------
007900140714       BEGSR Elabora;
008000110304
008100140714       //?Estraggo i potenziali
008200140714         wEnd = *off;
008300110304
008400110304         //?Dichiarazione del cursore
008500110304         exec sql
008600140714         DECLARE CPO cursor for
008700140714         SELECT CPOcpo, CPOtel, CPOfax
008800110304         FROM TNCPO00F
008900110304         ORDER by CPOcpo;
009000110304
009100110304         //?Apertura del cursore
009200140714         exec sql open CPO;
009300110304
009400110304         IF sqlcode < 0;
009500140714           wEnd = *on;
009600110304         ENDIF;
009700110304
009800140714         DOW not wEnd;
009900110304
010000140714           exec sql FETCH next from CPO into :CPOcpo, :CPOtel, :CPOfax;
010100110304
010200110304           IF sqlcod = 100 or sqlcod < 0;
010300140714             wEnd = *on;
010400110304             leave;
010500110304           ENDIF;
010600110304
010700140714           clear TNCPO100;
010800140714           IF  CPOtel <> *blanks or CPOfax <> *blanks;
010900140714             CPO1cpo = CPOcpo;
011000140714             CPO1tel = CPOtel;
011100140714             CPO1fax = CPOfax;
011200140714             write TNCPO100;
011300140714           ENDIF;
011400110304
011500110304         ENDDO;
011600110304
011700110304         //?chiudo il cursore
011800140714         exec sql CLOSE CPO;
011900100423
012000100423       ENDSR;
012100110304
012200110304       //--------------------------------------------------------------
012300140714       //?Elabora Storico Potenziali.
012400110304       //--------------------------------------------------------------
012500140714       BEGSR ElaboraS;
012600110304
012700140714         //?Estraggo storico Potenziali
012800140714         wEnd = *off;
012900110304
013000110304         //?Dichiarazione del cursore
013100110304         exec sql
013200140714         DECLARE CPOS cursor for
013300140714         SELECT CPOcpo, CPOtel, CPOfax
013400140714         FROM TNCPO00S
013500110304         ORDER by CPOcpo;
013600110304
013700110304         //?Apertura del cursore
013800140714         exec sql open CPOS;
013900110304
014000110304         IF sqlcode < 0;
014100140714           wEnd = *on;
014200110304         ENDIF;
014300110304
014400140714         DOW not wEnd;
014500110304
014600140714           exec sql FETCH next from CPOS into :SCPOcpo, :SCPOtel,
014700140714                                              :SCPOfax;
014800110304
014900110304           IF sqlcod = 100 or sqlcod < 0;
015000140714             wEnd = *on;
015100110304             leave;
015200110304           ENDIF;
015300110304
015400140714           clear TNCPO1S;
015500140714           IF  sCPOtel <> *blanks or sCPOfax <> *blanks;
015600140714             sCPO1cpo = sCPOcpo;
015700140714             sCPO1tel = sCPOtel;
015800140714             sCPO1fax = sCPOfax;
015900140714             write TNCPO1S;
016000140714           ENDIF;
016100110304
016200110304         ENDDO;
016300110304
016400110304         //?chiudo il cursore
016500140714         exec sql CLOSE CPOS;
016600110304
016700110304       ENDSR;
016800100426
016900100413       //--------------------------------------------------------------
017000100413       //?Operazioni finali.
017100100413       //--------------------------------------------------------------
017200110304       BEGSR RoutEnd;
017300100413
017400100413         *inLR = *on;
017500100413         return;
017600100413
017700100413       ENDSR;
017800100413
017900100413      /end-free
