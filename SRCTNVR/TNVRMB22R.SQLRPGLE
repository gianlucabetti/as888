000100100413      //---------------------------------------------------------------
000200140909      //?TNVRMB22R - Prg. 823 Data Ult.Conf. Info Commerciali
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000140909     fTNCPO11L  uf a e           k disk
001100100413
001200100413      //---------------------------------------------------------------
001300100413      //?Definizione costanti.
001400100413      //---------------------------------------------------------------
001500100413
001600100413      //---------------------------------------------------------------
001700100413      //?Definizione schiere.
001800100413      //---------------------------------------------------------------
001900090715
002000100413      //---------------------------------------------------------------
002100100413      //?Definizione aree dati.
002200100413      //---------------------------------------------------------------
002300100413
002400100413      //---------------------------------------------------------------
002500100413      //?Definizione strutture dati.
002600100413      //---------------------------------------------------------------
002700140909
002800140909      // Anagrafica potenziali
002900140909     d TNCPO00F      e ds                  extname(TNCPO00F)
003000140724
003100140724      // ds campo CPOrst
003200140724     d dCPO01        e ds
003300100415
003400100413      //---------------------------------------------------------------
003500100413      //?Definizione variabili globali.
003600100413      //---------------------------------------------------------------
003700100413
003800100413      // - Flags booleani
003900140714     d wEnd            s               n   inz(*off)
004000100413
004100100413      // - Campi di comodo
004200100413
004300100413      //---------------------------------------------------------------
004400100413      //?Definizione procedure esterne.
004500100413      //---------------------------------------------------------------
004600100413
004700100413      //---------------------------------------------------------------
004800140714      //?Definizione prototipi.
004900100413      //---------------------------------------------------------------
005000100413
005100100413      //---------------------------------------------------------------
005200100413      //?Definizione key-list.
005300100413      //---------------------------------------------------------------
005400100413
005500100413      //---------------------------------------------------------------
005600100413      //?Riepilogo indicatori.
005700100413      //---------------------------------------------------------------
005800100413
005900100413      //---------------------------------------------------------------
006000100413      //?M A I N - L I N E
006100100413      //---------------------------------------------------------------
006200100413
006300100413      /free
006400110304
006500140909       //?Elaboro potenziali
006600140909       exsr Elabora;
006700100413
006800100413       //?Operazioni finali
006900110304       exsr RoutEnd;
007000100420
007100100413       //--------------------------------------------------------------
007200140909       //?Leggo i potenziali e aggiorno la data.
007300100413       //--------------------------------------------------------------
007400140909       BEGSR Elabora;
007500110304
007600140714         wEnd = *off;
007700110304
007800140909         //?Con SQL leggo tutti i potenziali
007900110304         exec sql
008000140909         DECLARE POT cursor for
008100140716         SELECT *
008200140909         FROM TNCPO00F
008300140909         WHERE substr(CPOrst, 5, 8) <> '        ' and
008400140909               substr(CPOrst, 5, 8) <> '00000000'
008500140909         ORDER by CPOcpo;
008600110304
008700110304         //?Apertura del cursore
008800140909         exec sql open POT;
008900110304
009000110304         IF sqlcode < 0;
009100140714           wEnd = *on;
009200110304         ENDIF;
009300110304
009400140714         DOW not wEnd;
009500110304
009600140909           exec sql FETCH next from POT into :TNCPO00F;
009700110304
009800140724           IF  sqlcod = 100 or sqlcod < 0;
009900140714             wEnd = *on;
010000110304             leave;
010100110304           ENDIF;
010200140909
010300140909           dCPO01 = CPOrst;
010400110304
010500140909           chain (CPOcpo) TNCPO11L;
010600140909           IF  %found(TNCPO11L);
010700140909             CPO1ducifo = %dec(§CPOifodul:8:0);
010800140909             update TNCPO100;
010900140716           ENDIF;
011000140909           IF  not %found(TNCPO11L);
011100140909             clear TNCPO100;
011200140909             CPO1cpo = CPOcpo;
011300140909             CPO1ducifo = %dec(§CPOifodul:8:0);
011400140909             write TNCPO100;
011500140714           ENDIF;
011600110304
011700110304         ENDDO;
011800110304
011900110304         //?chiudo il cursore
012000140909         exec sql CLOSE POT;
012100100423
012200100423       ENDSR;
012300100426
012400100413       //--------------------------------------------------------------
012500100413       //?Operazioni finali.
012600100413       //--------------------------------------------------------------
012700110304       BEGSR RoutEnd;
012800100413
012900100413         *inLR = *on;
013000100413         return;
013100100413
013200100413       ENDSR;
013300100413
013400100413      /end-free
