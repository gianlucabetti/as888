000100121218      //---------------------------------------------------------------
000200121218      //
000300141216      //?              Invio immagini LDV a CEVA
000400121218      //
000500121218      //---------------------------------------------------------------
000600121218
000700121218     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800040119
000900040119      *---------------------------------------------------------------*
001000121218
001100150413     fCEVA_TIM  if   e           k disk    rename(CEVA_TIM:CEVA)
001200140331     fPRTF198   o    f  198        printer oflind(*inof)
001300121218     fTILAC00F  o    e           k disk
001400150413     fTITAS32C  if   e           k disk
001500150413     fTITA430C  if   e           k disk
001600040119
001700040119      *---------------------------------------------------------------*
001800090212
001900090212       // - Parametri x TRUL55R
002000090212     d TRUL55ds      e ds                  inz
002100090212     d   I55tla      e                     inz('C')
002200121218
002300121218      // Parametri
002400121218     d kpjba         e ds
002500150413
002600150413     d dTA4a         e ds
002700121218
002800121218       // - Campi di comodo
002900121218
003000121218       // - flag booleani
003100121218     d wEoF            s               n
003200090212
003300090212       //--------------------------------------------------------------
003400090212       //?Definizione procedure usate.                                 ?
003500090212       //--------------------------------------------------------------
003600090212
003700090212       // - Determinazione nome dell'immagine per TILAC
003800090212     d trul55r         pr                  extpgm('TRUL55R')
003900140331     d trul55ds                            likeds(trul55ds)
004000040119
004100040119      *---------------------------------------------------------------*
004200121218
004300121218     c     *entry        plist
004400121218     c                   parm                    kpjba
004500040119
004600121218      /free
004700121218
004800121218        wEoF = *off;
004900121218
005000141216       // Leggo file CEVA
005100121218        DOW not wEoF;
005200150413          read  CEVA_TIM;
005300121218
005400121218       // fine file
005500150413          IF  %eof(CEVA_TIM);
005600121218            leave;
005700121218          ENDIF;
005800150413
005900150413          clear TASaas;
006000150413          clear TASlnp;
006100150413          clear TASnrs;
006200150413          clear TASnsp;
006300150413       // Cerco la bolla con RMN-CCM
006400150413          chain (RMN:CCM) TITAS32C;
006500150413          IF  not %found(TITAS32C) or TASaas <> AAS;
006600150413            exsr stampa;
006700150413          ELSE;
006800150413            exsr elabora;
006900150413          ENDIF;
007000121218        ENDDO;
007100121218
007200121218        *inLR = *ON;
007300140331
007400140331       //-------------------------------------------------------------**
007500140331       // Stampa errore
007600140331       //-------------------------------------------------------------**
007700140331        BEGSR stampa;
007800140331
007900140331          IF  not *in99 or *inof;
008000140331            except testa;
008100140331            *in99 = *on;
008200140331          ENDIF;
008300140331
008400140331          except riga;
008500140331
008600140331        ENDSR;
008700121218
008800121218       //-------------------------------------------------------------**
008900121218       // Elabora
009000121218       //-------------------------------------------------------------**
009100121218        BEGSR elabora;
009200150413
009300150413       // Cerco RMA
009400150413          clear dTA4a;
009500150413          chain (TASaas:TASlnp:TASnrs:TASnsp:'A') TITA430C;
009600150413          IF  not %found(TITA430C);
009700150413            exsr Stampa;
009800150413            leavesr;
009900150413          ELSE;
010000150413            dTA4a = TA4not;
010100150413          ENDIF;
010200121218
010300121218          clear TILAC000;
010400150413          LACtim  = '20151304120000';
010500141216          LACaas  = %subst(%editc(TASaas:'X'):3:2);
010600141216          LAClnp  = %editc(TASlnp:'X');
010700141216          LACnrs  = %editc(TASnrs:'X');
010800141216          LACnsp  = %editc(TASnsp:'X');
010900121218          LACcop  = 'CLI';
011000150413          LACdir  = 'CEVA TIM';
011100140331          LACtpi  = 'TIF';
011200121218
011300121218       // flag nome immagine:
011400140331          clear  TRUL55ds;
011500150413          I55fmi = 'A ';
011600141216          I55lnp = TASlnp;
011700141216          I55nrs = TASnrs;
011800141216          I55nsp = TASnsp;
011900141216          I55aas = TASaas;
012000150413          I55rma = §TA4arma;
012100140331          I55fld = 'L';
012200140331          trul55r ( TRUL55ds );
012300140331          IF  O55err = *off;
012400140331            LACnim = O55niml;
012500140331          ENDIF;
012600121219
012700121219          LACela  = '00';
012800140331          LACtela = 'N';
012900140331          LACtad  = 'N';
013000150413          LACidjob = 'CEVA_TIM';
013100121218
013200121218          WRITE  TILAC000;
013300140331
013400140331        ENDSR;
013500050330
013600121218      /end-free
013700140331
013800140331     oPRTF198   e            testa          2 02
013900141216     o                                           20 'BRT S.p.A.'
014000141216     o                                           60 '**  ERRORI CEVA **'
014100140331     o                       udate              110 '  /  /  '
014200141216     o                                          120 'TNVRMB24R'
014300140331     o                                          128 'Pag.'
014400140331     o                       page          Z    132
014500140331     o          e            testa          2
014600140331     o                                            7 'Bolla'
014700140331     o          e            riga        1
014800141216     o                       TASaas               4
014900141216     o                       TASlnp            +  1
015000141216     o                       TASnrs            +  1
015100141216     o                       TASnsp            +  1
015200150413     o                       RMN               +  1
