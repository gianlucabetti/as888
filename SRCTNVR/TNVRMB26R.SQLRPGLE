000100121218      //---------------------------------------------------------------
000200121218      //
000300150414      //?   Aggiorna obiettivo finale per Lettere errate
000400121218      //
000500121218      //---------------------------------------------------------------
000600121218
000700121218     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800040119
000900040119      *---------------------------------------------------------------*
001000121218
001100140331     fPRTF198   o    f  198        printer oflind(*inof)
001200150414     fTICMF01L  uf   e           k disk
001300040119
001400040119      *---------------------------------------------------------------*
001500150414
001600150414     d FaseObjFine     c                   const(' 30')
001700121218
001800121218      // Parametri
001900121218     d kpjba         e ds
002000121218
002100121218       // - Campi di comodo
002200121218
002300121218       // - flag booleani
002400121218     d wEoF            s               n
002500150414
002600150414      // - File FASI
002700150414     d TICMFDS       e ds                  extname(TICMF00F)
002800150414     d                                     prefix(e_)
002900090212
003000090212       //--------------------------------------------------------------
003100090212       //?Definizione procedure usate.                                 ?
003200090212       //--------------------------------------------------------------
003300040119
003400040119      *---------------------------------------------------------------*
003500121218
003600121218     c     *entry        plist
003700121218     c                   parm                    kpjba
003800040119
003900121218      /free
004000121218
004100150414              exsr elabora;
004200150414
004300150414        *inLR = *ON;
004400150414
004500150414       //-------------------------------------------------------------**
004600150414       // Elabora
004700150414       //-------------------------------------------------------------**
004800150414        BEGSR elabora;
004900150414
005000121218        wEoF = *off;
005100150414         exec sql
005200150414           declare CMF cursor for
005300150414           select * from ticmf00f
005400150414           where substr(cmfflo, 15, 1) = 'E';
005500150414
005600150414         //?Apertura del cursore
005700150414         exec sql
005800150414           open CMF;
005900150414
006000150414         IF sqlcode < 0;
006100150414           wEoF = *on;
006200150414           exec sql close CMF;
006300150414           leavesr;
006400150414         ENDIF;
006500150414
006600150414         DOW  not wEoF;
006700150414           exec sql
006800150414             fetch next from CMF into :TICMFDS;
006900150414           IF sqlcod = 100 or sqlcod < 0;
007000150414             wEof = *on;
007100150414             leave;
007200150414           ENDIF;
007300150414
007400150414           chain (e_CMFncm:e_CMFksu:e_CMFksc:e_CMFcpo:FaseObjFine) TICMF01L;
007500150414           IF not %found(TICMF01L);
007600150414            iter;
007700150414           ENDIF;
007800150414
007900150414           IF  CMFncm = 2;
008000150414             CMFpea = 2,20;
008100150414           ENDIF;
008200150414
008300150414           IF  CMFncm = 4;
008400150414             CMFpea = 4,30;
008500150414           ENDIF;
008600150414
008700150414           %subst(CMFflo:2:1) = 'W';
008800150414           update TICMF000;
008900150413
009000121218        ENDDO;
009100150414        ENDSR;
009200140331
009300121218      /end-free
