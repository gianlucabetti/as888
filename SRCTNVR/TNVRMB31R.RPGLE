000100150716      //--------------------------------------------------------------
000200150716      //?Controllo luogo 008 con 006
000300150716      //--------------------------------------------------------------
000400090127     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000500150716
000600150716      //---------------------------------------------------------------
000700150716      //?Dichiarazione file.
000800150716      //---------------------------------------------------------------
000900150716      // - Anagrafica Cliente
001000150716     fCNACO00F  if   e           k disk
001100150716
001200150716      // - File Luoghi
001300150716     fFNSPE01L  if   e           k disk
001400150716     fFNSP201L  if   e           k disk
001500150716
001600150716      // - Printer File
001700090127     fPrtf198   o    f  198        Printer Oflind(*InOf)
001800090127
001900150716      //---------------------------------------------------------------
002000150716      //?Definizione costanti.
002100150716      //---------------------------------------------------------------
002200150716
002300150716      //---------------------------------------------------------------
002400150716      //?Definizione schiere.
002500150716      //---------------------------------------------------------------
002600150716
002700150716      //---------------------------------------------------------------
002800150716      //?Definizione aree dati.
002900150716      //---------------------------------------------------------------
003000150716      // - Dati utente
003100150716     d §AzUte        e ds                  extname(AZUTE00F)
003200150716     d                                     dtaara
003300150716     d §DatiUte      e ds                  extname(dDatiUte)
003400150716     d                                     dtaara
003500150716
003600150716      //---------------------------------------------------------------
003700150716      //?Definizione strutture dati.
003800150716      //---------------------------------------------------------------
003900150716      // - Parametri ricevuti
004000150716     d KPJBA         e ds
004100150716
004200150716      // - Reperimento dati utente
004300150716     d TIBS34DS      e ds
004400150716
004500150716      //---------------------------------------------------------------
004600150716      //?Definizione variabili globali.
004700150716      //---------------------------------------------------------------
004800150716      // - Flags booleani
004900150716     d Fine            s               n   inz(*off)
005000150716     d ok006           s               n   inz(*off)
005100150716     d ok008           s               n   inz(*off)
005200150716
005300150716      // - Campi di comodo
005400150716     d Conta           s              5s 0 inz
005500150716     d SPErag006       s                   like(SPErag)
005600150716     d SPEind006       s                   like(SPEind)
005700150716     d SPEcap006       s                   like(SPEcap)
005800150716     d SPEloc006       s                   like(SPEloc)
005900150716     d SPEpro006       s                   like(SPEpro)
006000150716     d SPEnaz006       s                   like(SPEnaz)
006100150716     d SP2est006       s                   like(SP2est)
006200150716     d SPErag008       s                   like(SPErag)
006300150716     d SPEind008       s                   like(SPEind)
006400150716     d SPEcap008       s                   like(SPEcap)
006500150716     d SPEloc008       s                   like(SPEloc)
006600150716     d SPEpro008       s                   like(SPEpro)
006700150716     d SPEnaz008       s                   like(SPEnaz)
006800150716     d SP2est008       s                   like(SP2est)
006900150716
007000150716      //---------------------------------------------------------------
007100150716      //?Definizione procedure usate.
007200150716      //---------------------------------------------------------------
007300150716
007400150716      //---------------------------------------------------------------
007500150716      //?Definizione Prototipi.
007600150716      //---------------------------------------------------------------
007700150716      /copy gaitrasrc/srcprotopr,TIBS34R
007800150716
007900150716      //---------------------------------------------------------------
008000150716      //?Definizione key-list.
008100150716      //---------------------------------------------------------------
008200150716
008300150716      //---------------------------------------------------------------
008400150716      //?M A I N - L I N E
008500150716      //---------------------------------------------------------------
008600150716
008700150716     c     *Entry        plist
008800150716     c                   parm                    kpjba
008900150716
009000150716      /free
009100150716
009200150716       //?Operazioni iniziali
009300150716       exsr RoutInz;
009400150716
009500150716       //?Elabora
009600150716       exsr Elabora;
009700150716
009800150716       //?Operazioni finali
009900150716       exsr RoutEnd;
010000150716
010100150716       //--------------------------------------------------------------
010200150716       //?Operazioni iniziali.
010300150716       //--------------------------------------------------------------
010400150716       BEGSR RoutInz;
010500150716
010600150716       //?Reperimento dati job
010700150716         exsr DatiJob;
010800150716
010900150716       ENDSR;
011000150716
011100150716       //--------------------------------------------------------------
011200150716       //?Reperimento Dati del job (Utente/Operativi).
011300150716       //--------------------------------------------------------------
011400150716       BEGSR DatiJob;
011500150716
011600150716         in(E) §AzUte;
011700150716         IF  NOT %error;
011800150716           in(E) §DatiUte;
011900150716         ENDIF;
012000150716         IF  %error or RSut = *blanks;
012100150716           clear TIBS34ds;
012200150716           tibs34r(tibs34ds);
012300150716           in §AzUte;
012400150716           in §DatiUte;
012500150716         ENDIF;
012600150716
012700150716       ENDSR;
012800150716
012900150716       //--------------------------------------------------------------
013000150716       //?Elaborazione.
013100150716       //--------------------------------------------------------------
013200150716       BEGSR Elabora;
013300150716
013400150716       //?Leggo anagrafiche CNACO
013500150716         setll (1:DUTkci:1) CNACO00F;
013600150716         reade (1:DUTkci) CNACO00F;
013700150716         DOW  not %eof(CNACO00F);
013800150716
013900150716           clear SPErag006;
014000150716           clear SPEind006;
014100150716           clear SPEcap006;
014200150716           clear SPEloc006;
014300150716           clear SPEpro006;
014400150716           clear SPEnaz006;
014500150716           clear SP2est006;
014600150716           clear SPErag008;
014700150716           clear SPEind008;
014800150716           clear SPEcap008;
014900150716           clear SPEloc008;
015000150716           clear SPEpro008;
015100150716           clear SPEnaz008;
015200150716           clear SP2est008;
015300150716           ok006 = *off;
015400150716           ok008 = *off;
015500150716
015600150716       //?Cerco luogo 008
015700150716           chain ('L':ACOksc:'008') FNSPE01L;
015800150716           IF  %found(FNSPE01L);
015900150716             ok008 = *on;
016000150716             SPErag008 = SPErag;
016100150716             SPEind008 = SPEind;
016200150716             SPEcap008 = SPEcap;
016300150716             SPEloc008 = SPEloc;
016400150716             SPEpro008 = SPEpro;
016500150716             SPEnaz008 = SPEnaz;
016600150716           ENDIF;
016700150716           chain (ACOksc:'008':'EM') FNSP201L;
016800150716           IF  %found(FNSPE01L);
016900150716             SP2est008 = SP2est;
017000150716           ENDIF;
017100150716
017200150716       //?Cerco luogo 006
017300150716           chain ('L':ACOksc:'006') FNSPE01L;
017400150716           IF  %found(FNSPE01L);
017500150716             ok006 = *on;
017600150716             SPErag006 = SPErag;
017700150716             SPEind006 = SPEind;
017800150716             SPEcap006 = SPEcap;
017900150716             SPEloc006 = SPEloc;
018000150716             SPEpro006 = SPEpro;
018100150716             SPEnaz006 = SPEnaz;
018200150716           ENDIF;
018300150716           chain (ACOksc:'006':'EM') FNSP201L;
018400150716           IF  %found(FNSPE01L);
018500150716             SP2est006 = SP2est;
018600150716           ENDIF;
018700150716
018800150716           IF  ok008 and ok006;
018900150716
019000150716       //?Confronto i 2 luoghi se uguali sommo
019100150716           IF  SPErag006 = SPErag008 and
019200150716               SPEind006 = SPEind008 and
019300150716               SPEcap006 = SPEcap008 and
019400150716               SPEloc006 = SPEloc008 and
019500150716               SPEpro006 = SPEpro008 and
019600150716               SPEnaz006 = SPEnaz008 and
019700150716               SP2est006 = SP2est008;
019800150716             conta += 1;
019900150716           ENDIF;
020000150716           ENDIF;
020100150716
020200150716           reade (1:DUTkci) CNACO00F;
020300150716
020400150716         ENDDO;
020500150716
020600150716         except TESTA;
020700150716
020800150716       ENDSR;
020900150716
021000150716       //--------------------------------------------------------------
021100150716       //?Operazioni finali.
021200150716       //--------------------------------------------------------------
021300150716       BEGSR RoutEnd;
021400150716
021500150716         *inLR = *on;
021600150716         return;
021700150716
021800150716       ENDSR;
021900150716
022000150716      /end-free
022100090128
022200030113     oPrtf198   e            Testa          2 02
022300030113     o                                           20 'BARTOLINI S.p.A.'
022400150716     o                                           60 '**  Luogo 008 = 006'
022500030113     o                       Udate              110 '  /  /  '
022600150716     o                                          120 'TNVRMB31R'
022700030113     o                                          128 'Pag.'
022800030113     o                       Page          Z    132
022900150716     o          e            Testa       2
023000150716     o                                           20 'N.clienti con luogo'
023100150716     o                                         +  1 '008 = 006'
023200150716     o                       conta             +  1
