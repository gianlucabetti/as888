000100131001      //---------------------------------------------------------------
000200131001      //
000300151013      //?      Controllo tempi ufficio ORM VAS
000400131001      //
000500131001      //---------------------------------------------------------------
000600131001
000700080520     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000800040511
000900131001      //---------------------------------------------------------------
001000131001      //?Dichiarazione file.
001100131001      //---------------------------------------------------------------
001200151013     fFNORM01L  if   e           k disk
001300151013     fFNORF01L  if   e           k disk
001400151019     fPRTF198   o    f  198        printer oflind(*inof)
001500040511
001600131001      //---------------------------------------------------------------
001700131001      //?Definizione costanti.
001800131001      //---------------------------------------------------------------
001900131001
002000131001      //---------------------------------------------------------------
002100131001      //?Definizione schiere.
002200131001      //---------------------------------------------------------------
002300131001
002400131001      //---------------------------------------------------------------
002500131001      //?Definizione aree dati.
002600131001      //---------------------------------------------------------------
002700131001
002800131001      //---------------------------------------------------------------
002900131001      //?Definizione strutture dati.
003000131001      //---------------------------------------------------------------
003100131001
003200131001       // -?Parametri ricevuti?
003300131001     d kpjba         e ds
003400131001
003500151013      // -?File FNORF00F
003600151013     d FNORFDS       e ds                  extname(FNORF00F)
003700151013     d                                     prefix(w)
003800131001
003900131001      //---------------------------------------------------------------
004000131001      //?Definizione variabili globali.
004100131001      //---------------------------------------------------------------
004200131001
004300131001      // -?Flag booleani
004400151013     d primo           s               n   inz(*off)
004500131001     d wEoF            s               n   inz(*off)
004600131001
004700131001      // -?Campi di comodo
004800151013     d TOTvas          s              5s 0
004900151013     d TOTvasman       s              5s 0
005000151013     d wdata           s              8s 0
005100151019     d wpoe            s              3s 0
005200131001
005300131001      //---------------------------------------------------------------
005400131001      //?Definizione procedure esterne.
005500131001      //---------------------------------------------------------------
005600131001
005700131001      //---------------------------------------------------------------
005800131001      //?Definizione prototipi.
005900131001      //---------------------------------------------------------------
006000131001
006100131001      //---------------------------------------------------------------
006200131001      //?Definizione key-list.
006300131001      //---------------------------------------------------------------
006400131001
006500131001      //---------------------------------------------------------------
006600131001      //?Riepilogo indicatori.
006700131001      //---------------------------------------------------------------
006800131001
006900131001      //---------------------------------------------------------------
007000131001      //?M A I N - L I N E
007100131001      //---------------------------------------------------------------
007200131001
007300131001     c     *Entry        plist
007400131001     c                   parm                    kpjba
007500131001
007600131001      /free
007700131001
007800131001       //?Operazioni iniziali
007900131001       exsr RoutInz;
008000131001
008100131001       //?Elabora file
008200131001       exsr Elabora;
008300131001
008400131001       //?Operazioni finali
008500131001       exsr RoutEnd;
008600131001
008700131001       //--------------------------------------------------------------
008800131001       //?Operazioni iniziali.
008900131001       //--------------------------------------------------------------
009000131001       BEGSR RoutInz;
009100131001
009200131001       //?Impostazione opzioni per SQL?
009300151013         exec sql set option DynUsrPrf = *Owner,
009400151013                             CloSqlCsr = *EndMod;
009500151019
009600151019       //?Impostazione dati
009700151019         wdata = 20151005;
009800131001
009900131001       ENDSR;
010000131001
010100131001       //--------------------------------------------------------------
010200131001       //?Elabora
010300131001       //--------------------------------------------------------------
010400131001       BEGSR elabora;
010500131001
010600131001         wEoF = *off;
010700131001
010800151013       //?Leggo le fasi ORM
010900131001         exec sql
011000151013         DECLARE ORF cursor FOR
011100131001         SELECT *
011200151013         from FNORF00F
011300151019         WHERE  ORFdae = :wdata and
011400151013                ORFnsr = 0 and ORFpog = ORFPoe and
011500151013                ORFfar in(050, 100)
011600151013         ORDER BY ORFpoe, ORFnsr, ORFnor, ORFnrv;
011700131001
011800131001         exec sql
011900151013         open ORF;
012000131001         IF sqlcode < 0;
012100131001           wEoF = *on;
012200131001         ENDIF;
012300131001
012400131001         DOW not wEoF;
012500131001           exec sql
012600151013           FETCH NEXT from ORF into :FNORFDS;
012700131001           IF sqlcod = 100 or sqlcod < 0;
012800131001             wEOF = *on;
012900131001             leave;
013000131001           ENDIF;
013100151019
013200151019       //?Stampo a rottuta di poe
013300151019           IF  wORFpoe <> wpoe;
013400151019             IF  wpoe > 0;
013500151019               exsr Stampa;
013600151019             ENDIF;
013700151019             wpoe = wORFpoe;
013800151019           ENDIF;
013900131001
014000151013           exsr Conta;
014100131001
014200131001         ENDDO;
014300131001
014400131001       //?Chiudo il cursore
014500131001         exec sql
014600151013           close ORF;
014700151019
014800151019       //?Stampo
014900151019          wpoe = wORFpoe;
015000151019          exsr Stampa;
015100131001
015200131001       ENDSR;
015300131001
015400131001       //--------------------------------------------------------------
015500151013       //?Conto gli ORM.
015600131001       //--------------------------------------------------------------
015700151013       BEGSR Conta;
015800080710
015900151013         chain (wORFpoe:wORFnsr:wORFnor:wORFnrv) FNORM01L;
016000151013         IF  %found(FNORM01L) and
016100151013            (ORMtco = 'I' or ORMtco = 'F');
016200151013           exsr PrimaFase;
016300131001         ENDIF;
016400131001
016500131001       ENDSR;
016600131001
016700131001       //--------------------------------------------------------------
016800151013       //?Controllo la prima fase.
016900131001       //--------------------------------------------------------------
017000151013       BEGSR PrimaFase;
017100151013
017200151013         chain (wORFpoe:wORFnsr:wORFnor:wORFnrv) FNORF01L;
017300151013         IF  %found(FNORF01L) and
017400151013             ORFdae = wORFdae and ORFfar = wORFfar;
017500151013           IF  ORFpue <> 'BATCH';
017600151013             TOTvasman += 1;
017700151013           ENDIF;
017800151013           TOTvas += 1;
017900151013         ENDIF;
018000131001
018100131001       ENDSR;
018200151019
018300151019       //-------------------------------------------------------------**
018400151019       //?Stampa il n. di ORM.
018500151019       //-------------------------------------------------------------**
018600151019        BEGSR Stampa;
018700151019
018800151019          IF  not *in99 or *inof;
018900151019            except testa;
019000151019            *in99 = *on;
019100151019          ENDIF;
019200151019
019300151019          except riga;
019400151019
019500151019          clear totvas;
019600151019          clear totvasman;
019700151019
019800151019        ENDSR;
019900131001
020000131001       //--------------------------------------------------------------
020100131001       //?Operazioni finali.
020200131001       //--------------------------------------------------------------
020300131001       BEGSR RoutEnd;
020400131001
020500131001         *inLR = *on;
020600131001         return;
020700131001
020800131001       ENDSR;
020900131001
021000131001      /end-free
021100131001
021200151019     oPRTF198   e            testa          2 02
021300151019     o                                           60 '**  ORM VAS **'
021400151019     o                       udate              110 '  /  /  '
021500151019     o                                          120 'TNVRMB37R'
021600151019     o                                          128 'Pag.'
021700151019     o                       page          Z    132
021800151019     o          e            riga        1
021900151019     o                                            8 'Filiale'
022000151019     o                       wpoe              +  2
022100151019     o                                         +  2 'tot.vas'
022200151019     o                       totvas            +  2
022300151019     o                                         +  2 'di cui man.'
022400151019     o                       totvasman         +  2
