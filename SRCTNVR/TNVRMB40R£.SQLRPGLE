000100131001      //---------------------------------------------------------------
000200131001      //
000300160121      //?      Conta le telefonate x Appuntamento su bolle
000400160121      //?      di Novembre 2015
000500131001      //
000600131001      //---------------------------------------------------------------
000700131001
000800080520     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000900150909     h dftactgrp(*no) actgrp(*caller)
001000040511
001100131001      //---------------------------------------------------------------
001200131001      //?Dichiarazione file.
001300131001      //---------------------------------------------------------------
001400150909      // -?File Bolle        ?
001500160121     fTITAS38C  if   e           k disk
001600080710
001700160121      // -?File Telefonate   ?
001800160121     fFITGD02L  if   e           k disk
001900160121
002000160121      // -?File di stampa    ?
002100160121     fPRTF198   o    f  198        printer oflind(*inof)
002200160121
002300160121      // -?File bolle x controllo in EDPMBTEST
002400160121     fTITASMB   o    e             disk    rename(TITAS000:TITAS)
002500040511
002600160121      // -?File Telefonate x controllo in EDPMBTEST
002700160121     fFITGDMB   o    e             disk    rename(FITGD000:FITGD)
002800160121
002900131001      //---------------------------------------------------------------
003000131001      //?Definizione costanti.
003100131001      //---------------------------------------------------------------
003200131001
003300131001      //---------------------------------------------------------------
003400131001      //?Definizione schiere.
003500131001      //---------------------------------------------------------------
003600131001
003700131001      //---------------------------------------------------------------
003800131001      //?Definizione aree dati.
003900131001      //---------------------------------------------------------------
004000131001
004100131001      //---------------------------------------------------------------
004200131001      //?Definizione strutture dati.
004300131001      //---------------------------------------------------------------
004400131001
004500150909      // -?Parametri ricevuti?
004600131001     d kpjba         e ds
004700150909
004800160121      // -?Chiave Telefonate
004900160121     d keyOGG          DS
005000160121     d  wTASlnp                       3  0
005100160121     d  wTASnrs                       2  0
005200160121     d  wTASnsp                       7  0
005300160121     d  wTASaas                       4  0
005400160121     d  wBlank                        4
005500131001
005600131001      //---------------------------------------------------------------
005700131001      //?Definizione variabili globali.
005800131001      //---------------------------------------------------------------
005900131001
006000131001      // -?Flag booleani
006100131001     d wEoF            s               n   inz(*off)
006200131001
006300131001      // -?Campi di comodo
006400160121     d Novembre        s              8s 0 inz(20151101)
006500160121     d Dicembre        s              8s 0 inz(20151201)
006600160121     d Gennaio         s              8s 0 inz(20160101)
006700160121     d nTel            s              8s 0
006800160121     d nTel11          s              8s 0
006900160121     d nTel12          s              8s 0
007000160121     d nTel01          s              8s 0
007100160121     d waas            s              4s 0 inz(2015)
007200160121     d wmgsini         s              4s 0 inz(1101)
007300160121     d wmgsfin         s              4s 0 inz(1130)
007400131001
007500131001      //---------------------------------------------------------------
007600131001      //?Definizione procedure esterne.
007700131001      //---------------------------------------------------------------
007800131001
007900131001      //---------------------------------------------------------------
008000131001      //?Definizione prototipi.
008100131001      //---------------------------------------------------------------
008200131001
008300131001      //---------------------------------------------------------------
008400131001      //?Definizione key-list.
008500131001      //---------------------------------------------------------------
008600131001
008700131001      //---------------------------------------------------------------
008800131001      //?Riepilogo indicatori.
008900131001      //---------------------------------------------------------------
009000131001
009100131001      //---------------------------------------------------------------
009200131001      //?M A I N - L I N E
009300131001      //---------------------------------------------------------------
009400131001
009500131001     c     *Entry        plist
009600131001     c                   parm                    kpjba
009700131001
009800131001      /free
009900131001
010000131001       //?Operazioni iniziali
010100131001       exsr RoutInz;
010200131001
010300131001       //?Elabora file
010400131001       exsr Elabora;
010500131001
010600131001       //?Operazioni finali
010700131001       exsr RoutEnd;
010800131001
010900131001       //--------------------------------------------------------------
011000131001       //?Operazioni iniziali.
011100131001       //--------------------------------------------------------------
011200131001       BEGSR RoutInz;
011300131001
011400131001       ENDSR;
011500131001
011600131001       //--------------------------------------------------------------
011700131001       //?Elabora
011800131001       //--------------------------------------------------------------
011900150909       BEGSR Elabora;
012000131001
012100131001         wEoF = *off;
012200160121         clear nTel;
012300160121         clear nTel11;
012400160121         clear nTel12;
012500160121         clear nTel01;
012600131001
012700160121       //?Leggo le bolle di novembre
012800160121         setll (waas:wmgsini) TITAS38C;
012900160121         reade (waas) TITAS38C;
013000160121         DOW not %eof(TITAS38C);
013100160121
013200160121           IF  TASmgs > wmgsfin;
013300160121             leave;
013400160121           ENDIF;
013500160121
013600160121           IF  TASftc = 'A' or TAStc2 = 'A';
013700160121             exsr Conta;
013800160121           ENDIF;
013900160121
014000160121           reade (waas) TITAS38C;
014100131001
014200131001         ENDDO;
014300131001
014400131001       ENDSR;
014500131001
014600131001       //--------------------------------------------------------------
014700160121       //?Conto le telefonate
014800131001       //--------------------------------------------------------------
014900150909       BEGSR Conta;
015000150909
015100160121         wTASlnp = TASlnp;
015200160121         wTASnrs = TASnrs;
015300160121         wTASnsp = TASnsp;
015400160121         wTASaas = TASaas;
015500160121         clear wBlank;
015600131001
015700160121       //?Aggancio il file delle telefonate
015800160121         setll ('S':keyOGG) FITGD02L;
015900160121         reade ('S':keyOGG) FITGD02L;
016000160121         DOW  not %eof(FITGD02L);
016100160121         //?Solo Telefonate
016200160122           IF  %subst(TGDflo:1:1) <> ' ' and
016300160121         //?Solo causale Appuntamento
016400160121             TGDmad = ' 15';
016500160121         //?Divido per mese
016600160121             IF  TGDdac >= Novembre and TGDdac < Dicembre;
016700160121               nTel11 += 1;
016800160121             ENDIF;
016900160121             IF  TGDdac >= Dicembre and TGDdac < Gennaio;
017000160121               nTel12 += 1;
017100160121             ENDIF;
017200160121             IF  TGDdac >= Gennaio;
017300160121               nTel01 += 1;
017400160121             ENDIF;
017500160121             nTel += 1;
017600160121         //?Scrivo file x controllo
017700160121             write TITAS;
017800160121             write FITGD;
017900160121           ENDIF;
018000160121           reade ('S':keyOGG) FITGD02L;
018100150909         ENDDO;
018200131001
018300131001       ENDSR;
018400131001
018500131001       //--------------------------------------------------------------
018600131001       //?Operazioni finali.
018700131001       //--------------------------------------------------------------
018800131001       BEGSR RoutEnd;
018900160121
019000160121          IF  not *in99 or *inof;
019100160121            except testa;
019200160121            *in99 = *on;
019300160121          ENDIF;
019400160121
019500160121          except riga;
019600131001
019700131001         *inLR = *on;
019800131001         return;
019900131001
020000131001       ENDSR;
020100131001
020200131001      /end-free
020300160121
020400160121     oPRTF198   e            testa          2 02
020500160121     o                                           20 'BRT S.p.A.'
020600160121     o                                           60 'Tel. Appuntamento bolle'
020700160121     o                                          + 1 ' Novembre 2015'
020800160121     o                       udate              110 '  /  /  '
020900160121     o                                          120 'TNVRMB40R'
021000160121     o                                          128 'Pag.'
021100160121     o                       page          Z    132
021200160121     o          e            testa          2
021300160121     o                                           10 'Totale    '
021400160121     o                                           +1 'Novembre  '
021500160121     o                                           +1 'Dicembre  '
021600160121     o                                           +1 'Gennaio   '
021700160121     o          e            riga        1
021800160121     o                       nTel          2     10
021900160121     o                       nTel11        2   +  1
022000160121     o                       nTel12        2   +  1
022100160121     o                       nTel01        2   +  1
