000100131001      //---------------------------------------------------------------
000200131001      //
000300160122      //?      Stampo il tot.delle tel.fatte per
000400160122      //?      filiale/tipo tel./ora
000500131001      //
000600131001      //---------------------------------------------------------------
000700131001
000800080520     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000900150909     h dftactgrp(*no) actgrp(*caller)
001000040511
001100131001      //---------------------------------------------------------------
001200131001      //?Dichiarazione file.
001300131001      //---------------------------------------------------------------
001400160122      // -?File di work a totale
001500160122     fAPPMB     o    e             disk    rename(appmb:appmb1)
001600160121
001700131001      //---------------------------------------------------------------
001800131001      //?Definizione costanti.
001900131001      //---------------------------------------------------------------
002000131001
002100131001      //---------------------------------------------------------------
002200131001      //?Definizione schiere.
002300131001      //---------------------------------------------------------------
002400131001
002500131001      //---------------------------------------------------------------
002600131001      //?Definizione aree dati.
002700131001      //---------------------------------------------------------------
002800131001
002900131001      //---------------------------------------------------------------
003000131001      //?Definizione strutture dati.
003100131001      //---------------------------------------------------------------
003200150909      // -?Parametri ricevuti?
003300131001     d kpjba         e ds
003400160122
003500160122      // -?File di Work      ?
003600160122     d giralods      e ds                  extname(GIRALO)
003700131001
003800131001      //---------------------------------------------------------------
003900131001      //?Definizione variabili globali.
004000131001      //---------------------------------------------------------------
004100131001      // -?Flag booleani
004200160122     d Fine            s               n   inz(*off)
004300131001
004400131001      // -?Campi di comodo
004500131001
004600131001      //---------------------------------------------------------------
004700131001      //?Definizione procedure esterne.
004800131001      //---------------------------------------------------------------
004900131001
005000131001      //---------------------------------------------------------------
005100131001      //?Definizione prototipi.
005200131001      //---------------------------------------------------------------
005300131001
005400131001      //---------------------------------------------------------------
005500131001      //?Definizione key-list.
005600131001      //---------------------------------------------------------------
005700131001
005800131001      //---------------------------------------------------------------
005900131001      //?Riepilogo indicatori.
006000131001      //---------------------------------------------------------------
006100131001
006200131001      //---------------------------------------------------------------
006300131001      //?M A I N - L I N E
006400131001      //---------------------------------------------------------------
006500131001
006600131001     c     *Entry        plist
006700131001     c                   parm                    kpjba
006800131001
006900131001      /free
007000131001
007100131001       //?Operazioni iniziali
007200131001       exsr RoutInz;
007300131001
007400131001       //?Elabora file
007500131001       exsr Elabora;
007600131001
007700131001       //?Operazioni finali
007800131001       exsr RoutEnd;
007900131001
008000131001       //--------------------------------------------------------------
008100131001       //?Operazioni iniziali.
008200131001       //--------------------------------------------------------------
008300131001       BEGSR RoutInz;
008400131001
008500131001       ENDSR;
008600131001
008700131001       //--------------------------------------------------------------
008800131001       //?Elabora
008900131001       //--------------------------------------------------------------
009000150909       BEGSR Elabora;
009100131001
009200160122         Fine = *off;
009300160122         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
009400131001
009500160122       //?Leggo il file di work creato da ND
009600160122         exec sql DECLARE WRK cursor for
009700160122                  SELECT * from GIRALO
009800160122                  ORDER BY TGDpot, SEL0003, SEL0001;
009900160122
010000160122       //?Apertura del cursore
010100160122         exec sql
010200160122         OPEN WRK;
010300160122
010400160122         IF sqlcode < 0;
010500160122           exec sql
010600160122           CLOSE WRK;
010700160122           leavesr;
010800160122         ENDIF;
010900160122
011000160122         DOW  not Fine;
011100160122           exec sql
011200160122           FETCH NEXT from WRK into :giralods;
011300160122           IF sqlcod = 100 or sqlcod < 0;
011400160122             Fine = *on;
011500160122             leave;
011600160122           ENDIF;
011700160122
011800160122       //?Scrivo a rottura di filiale/tipo
011900160122           IF  TGDpot <> Filiale and Filiale > 0;
012000160122             write appmb1;
012100160122             clear appmb1;
012200160122           ENDIF;
012300160122           IF  SEL0003 <> Tipo and Tipo <> *blanks;
012400160122             write appmb1;
012500160122             clear appmb1;
012600160122           ENDIF;
012700160122
012800160122           Filiale = TGDpot;
012900160122           Tipo = SEL0003;
013000160122
013100160122       //?imposto il totale degli appuntamenti per orario
013200160122           IF  SEL0001 = '00';
013300160122             zero = SEL0004;
013400160122           ENDIF;
013500160122           IF  SEL0001 = '01';
013600160122             uno = SEL0004;
013700160122           ENDIF;
013800160122           IF  SEL0001 = '02';
013900160122             due = SEL0004;
014000160122           ENDIF;
014100160122           IF  SEL0001 = '03';
014200160122             tre = SEL0004;
014300160122           ENDIF;
014400160122           IF  SEL0001 = '04';
014500160122             quattro = SEL0004;
014600160122           ENDIF;
014700160122           IF  SEL0001 = '05';
014800160122             cinque = SEL0004;
014900160122           ENDIF;
015000160122           IF  SEL0001 = '06';
015100160122             sei = SEL0004;
015200160122           ENDIF;
015300160122           IF  SEL0001 = '07';
015400160122             sette = SEL0004;
015500160122           ENDIF;
015600160122           IF  SEL0001 = '08';
015700160122             otto = SEL0004;
015800160122           ENDIF;
015900160122           IF  SEL0001 = '09';
016000160122             nove = SEL0004;
016100160122           ENDIF;
016200160122           IF  SEL0001 = '10';
016300160122             dieci = SEL0004;
016400160122           ENDIF;
016500160122           IF  SEL0001 = '11';
016600160122             undici = SEL0004;
016700160122           ENDIF;
016800160122           IF  SEL0001 = '12';
016900160122             dodici = SEL0004;
017000160122           ENDIF;
017100160122           IF  SEL0001 = '13';
017200160122             tredici = SEL0004;
017300160122           ENDIF;
017400160122           IF  SEL0001 = '14';
017500160122             quattordi = SEL0004;
017600160122           ENDIF;
017700160122           IF  SEL0001 = '15';
017800160122             quindici = SEL0004;
017900160122           ENDIF;
018000160122           IF  SEL0001 = '16';
018100160122             sedici = SEL0004;
018200160122           ENDIF;
018300160122           IF  SEL0001 = '17';
018400160122             diciasette = SEL0004;
018500160122           ENDIF;
018600160122           IF  SEL0001 = '18';
018700160122             diciotto = SEL0004;
018800160122           ENDIF;
018900160122           IF  SEL0001 = '19';
019000160122             diciannove = SEL0004;
019100160122           ENDIF;
019200160122           IF  SEL0001 = '20';
019300160122             venti = SEL0004;
019400160122           ENDIF;
019500160122           IF  SEL0001 = '21';
019600160122             ventuno = SEL0004;
019700160122           ENDIF;
019800160122           IF  SEL0001 = '22';
019900160122             ventidue = SEL0004;
020000160122           ENDIF;
020100160122           IF  SEL0001 = '23';
020200160122             ventitre = SEL0004;
020300160122           ENDIF;
020400160122
020500160122         ENDDO;
020600160122
020700160122       //?Chiusura del cursore
020800160122         exec sql
020900160122         CLOSE WRK;
021000131001
021100131001       ENDSR;
021200131001
021300131001       //--------------------------------------------------------------
021400131001       //?Operazioni finali.
021500131001       //--------------------------------------------------------------
021600131001       BEGSR RoutEnd;
021700131001
021800131001         *inLR = *on;
021900131001         return;
022000131001
022100131001       ENDSR;
022200131001
022300131001      /end-free
