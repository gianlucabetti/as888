000100160330      //---------------------------------------------------------------
000200160330      //
000300160330      //?      Imposto gli orari minimo e massimo sui ritiri
000400160330      //
000500160330      //---------------------------------------------------------------
000600160330
000700160330     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000800160330
000900160330      //---------------------------------------------------------------
001000160330      //?Dichiarazione file.
001100160330      //---------------------------------------------------------------
001200160330      // -?Organigramma
001300160330     fAZCOS01L  uf   e           k disk
001400160330
001500160330      //---------------------------------------------------------------
001600160330      //?Definizione costanti.
001700160330      //---------------------------------------------------------------
001800160330
001900160330      //---------------------------------------------------------------
002000160330      //?Definizione schiere.
002100160330      //---------------------------------------------------------------
002200160330
002300160330      //---------------------------------------------------------------
002400160330      //?Definizione aree dati.
002500160330      //---------------------------------------------------------------
002600160330
002700160330      //---------------------------------------------------------------
002800160330      //?Definizione strutture dati.
002900160330      //---------------------------------------------------------------
003000160330      // -?Parametri ricevuti?
003100160330     d kpjba         e ds
003200160330
003300160330      // -?File AZCOS
003400160330     d AZCOS00F      e ds                  extname(AZCOS00F) prefix(c_)
003500160330
003600160330      //---------------------------------------------------------------
003700160330      //?Definizione variabili globali.
003800160330      //---------------------------------------------------------------
003900160330
004000160330      // -?Flag booleani
004100160330     d wEoF            s               n   inz(*off)
004200160330
004300160330      // -?Campi di comodo
004400160330
004500160330      //---------------------------------------------------------------
004600160330      //?Definizione procedure esterne.
004700160330      //---------------------------------------------------------------
004800160330
004900160330      //---------------------------------------------------------------
005000160330      //?Definizione prototipi.
005100160330      //---------------------------------------------------------------
005200160330
005300160330      //---------------------------------------------------------------
005400160330      //?Definizione key-list.
005500160330      //---------------------------------------------------------------
005600160330
005700160330      //---------------------------------------------------------------
005800160330      //?Riepilogo indicatori.
005900160330      //---------------------------------------------------------------
006000160330
006100160330      //---------------------------------------------------------------
006200160330      //?M A I N - L I N E
006300160330      //---------------------------------------------------------------
006400160330
006500160330     c     *Entry        plist
006600160330     c                   parm                    kpjba
006700160330
006800160330      /free
006900160330
007000160330       //?Operazioni iniziali
007100160330       exsr RoutInz;
007200160330
007300160330       //?Elabora file
007400160330       exsr Elabora;
007500160330
007600160330       //?Operazioni finali
007700160330       exsr RoutEnd;
007800160330
007900160330       //--------------------------------------------------------------
008000160330       //?Operazioni iniziali.
008100160330       //--------------------------------------------------------------
008200160330       BEGSR RoutInz;
008300160330
008400160330       //?Impostazione opzioni per SQL?
008500160330         exec sql set option DynUsrPrf = *Owner,
008600160330                             CloSqlCsr = *EndMod;
008700160330
008800160330       ENDSR;
008900160330
009000160330       //--------------------------------------------------------------
009100160330       //?Elabora
009200160330       //--------------------------------------------------------------
009300160330       BEGSR Elabora;
009400160330
009500160330         wEoF = *off;
009600160330
009700160330       //?Leggo CAP Bolle
009800160330         exec sql
009900160330         DECLARE CAP cursor FOR
010000160330         SELECT *
010100160330         from AZCOS00F
010200160330         WHERE COSver = 47 and COStser = 'C'
010300160330         ORDER BY COSver, COSnar, COScap, COSloc, COSlna;
010400160330
010500160330         exec sql
010600160330         open CAP;
010700160330         IF sqlcode < 0;
010800160330           wEoF = *on;
010900160330         ENDIF;
011000160330
011100160330         DOW not wEoF;
011200160330           exec sql
011300160330           FETCH NEXT from CAP into :AZCOS00F;
011400160330           IF sqlcod = 100 or sqlcod < 0;
011500160330             wEoF = *on;
011600160330             leave;
011700160330           ENDIF;
011800160330
011900160330         //?Aggancio dati Ritiri e imposto min/max
012000160330           chain (c_COSver:c_COSnar:c_COScap:c_COSloc:c_COSlna:'R') AZCOS01L;
012100160330           IF  %found(AZCOS01L);
012200160330             COSomiis = c_COSomiis;
012300160330             COSomxfs = c_COSomxfs;
012400160330             update AZCOS000;
012500160330           ENDIF;
012600160330
012700160330         ENDDO;
012800160330
012900160330       //?Chiudo il cursore
013000160330         exec sql
013100160330           close CAP;
013200160330
013300160330       ENDSR;
013400160330
013500160330       //--------------------------------------------------------------
013600160330       //?Operazioni finali.
013700160330       //--------------------------------------------------------------
013800160330       BEGSR RoutEnd;
013900160330
014000160330         *inLR = *on;
014100160330         return;
014200160330
014300160330       ENDSR;
014400160330
014500160330      /end-free
