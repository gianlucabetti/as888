000100160210      //---------------------------------------------------------------
000200160210      //
000300160411      //?      ORM da VAS con data fase > data immissione VAS
000400160210      //
000500160210      //---------------------------------------------------------------
000600160210
000700160210     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000800160210
000900160210      //---------------------------------------------------------------
001000160210      //?Dichiarazione file.
001100160210      //---------------------------------------------------------------
001200160210      // -?File Fasi ORM
001300160411     fFNORF01L  if   e           k disk
001400160411
001500160411      // -?File di stampa
001600160411     fPRTF198   o    f  198        printer oflind(*inof)
001700160210
001800160210      //---------------------------------------------------------------
001900160210      //?Definizione costanti.
002000160210      //---------------------------------------------------------------
002100160210
002200160210      //---------------------------------------------------------------
002300160210      //?Definizione schiere.
002400160210      //---------------------------------------------------------------
002500160210
002600160210      //---------------------------------------------------------------
002700160210      //?Definizione aree dati.
002800160210      //---------------------------------------------------------------
002900160210
003000160210      //---------------------------------------------------------------
003100160210      //?Definizione strutture dati.
003200160210      //---------------------------------------------------------------
003300160210      // -?Parametri ricevuti?
003400160210     d kpjba         e ds
003500160210
003600160210      // -?File FNORM00F
003700160210     d FNORM00F      e ds                  extname(FNORM00F)
003800160210
003900160210      //---------------------------------------------------------------
004000160210      //?Definizione variabili globali.
004100160210      //---------------------------------------------------------------
004200160210
004300160210      // -?Flag booleani
004400160210     d wEoF            s               n   inz(*off)
004500160210
004600160210      // -?Campi di comodo
004700160210     d wdataini        s              8s 0
004800160210     d wdatafin        s              8s 0
004900160210
005000160210      //---------------------------------------------------------------
005100160210      //?Definizione procedure esterne.
005200160210      //---------------------------------------------------------------
005300160210
005400160210      //---------------------------------------------------------------
005500160210      //?Definizione prototipi.
005600160210      //---------------------------------------------------------------
005700160210
005800160210      //---------------------------------------------------------------
005900160210      //?Definizione key-list.
006000160210      //---------------------------------------------------------------
006100160210
006200160210      //---------------------------------------------------------------
006300160210      //?Riepilogo indicatori.
006400160210      //---------------------------------------------------------------
006500160210
006600160210      //---------------------------------------------------------------
006700160210      //?M A I N - L I N E
006800160210      //---------------------------------------------------------------
006900160210
007000160210     c     *Entry        plist
007100160210     c                   parm                    kpjba
007200160210
007300160210      /free
007400160210
007500160210       //?Operazioni iniziali
007600160210       exsr RoutInz;
007700160210
007800160210       //?Elabora file
007900160210       exsr Elabora;
008000160210
008100160210       //?Operazioni finali
008200160210       exsr RoutEnd;
008300160210
008400160210       //--------------------------------------------------------------
008500160210       //?Operazioni iniziali.
008600160210       //--------------------------------------------------------------
008700160210       BEGSR RoutInz;
008800160210
008900160210       //?Impostazione opzioni per SQL?
009000160210         exec sql set option DynUsrPrf = *Owner,
009100160210                             CloSqlCsr = *EndMod;
009200160210
009300160210       //?Imposto le date
009400160411         wdataini = 20160401;
009500160411         wdatafin = 20160410;
009600160210
009700160210       ENDSR;
009800160210
009900160210       //--------------------------------------------------------------
010000160210       //?Elabora
010100160210       //--------------------------------------------------------------
010200160210       BEGSR Elabora;
010300160210
010400160210         wEoF = *off;
010500160210
010600160210       //?Leggo gli ORM
010700160210         exec sql
010800160210         DECLARE ORM cursor FOR
010900160210         SELECT *
011000160210         from FNORM00F
011100160411         WHERE ORMdao between :wdataini and :wdatafin
011200160411               and ORMtco in('F', 'I')
011300160411               and ORMnrv = 0
011400160210         ORDER BY ORMpoe, ORMnsr, ORMnor, ORMnrv;
011500160210
011600160210         exec sql
011700160210         open ORM;
011800160210         IF sqlcode < 0;
011900160210           wEoF = *on;
012000160210         ENDIF;
012100160210
012200160210         DOW not wEoF;
012300160210           exec sql
012400160210           FETCH NEXT from ORM into :FNORM00F;
012500160210           IF sqlcod = 100 or sqlcod < 0;
012600160210             wEoF = *on;
012700160210             leave;
012800160210           ENDIF;
012900160210
013000160411         //?Aggancio la prima fase
013100160411           chain (ORMpoe:ORMnsr:ORMnor:ORMnrv) FNORF01L;
013200160411           IF  not %found(FNORF01L);
013300160210             iter;
013400160210           ENDIF;
013500160210
013600160411         //?Controllo la data
013700160411           IF  ORMdao <> ORFdae;
013800160411             exsr Stampa;
013900160411           ENDIF;
014000160210
014100160210         ENDDO;
014200160210
014300160210       //?Chiudo il cursore
014400160210         exec sql
014500160210           close ORM;
014600160210
014700160210       ENDSR;
014800160411
014900160411       //--------------------------------------------------------------
015000160411       //?Stampa.
015100160411       //--------------------------------------------------------------
015200160411       BEGSR Stampa;
015300160411
015400160411          except riga;
015500160411
015600160411       ENDSR;
015700160210
015800160210       //--------------------------------------------------------------
015900160210       //?Operazioni finali.
016000160210       //--------------------------------------------------------------
016100160210       BEGSR RoutEnd;
016200160210
016300160210         *inLR = *on;
016400160210         return;
016500160210
016600160210       ENDSR;
016700160210
016800160210      /end-free
016900160411
017000160411     oPRTF198   e            riga        1
017100160411     o                       ORMpoe               3
017200160411     o                       ORMnsr            +  1
017300160411     o                       ORMnor            +  1
017400160411     o                       ORMnrv            +  1
