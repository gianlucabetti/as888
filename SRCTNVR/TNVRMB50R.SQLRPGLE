000100160210      //---------------------------------------------------------------
000200160210      //
000300160511      //?      Scrivo FILTO da FILTE x test
000400160210      //
000500160210      //---------------------------------------------------------------
000600160210
000700160210     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000800160210
000900160210      //---------------------------------------------------------------
001000160210      //?Dichiarazione file.
001100160210      //---------------------------------------------------------------
001200160511      // -?File LOG Tellus ORM
001300160511     fFILTO00F  o    e             disk
001400160210
001500160210      //---------------------------------------------------------------
001600160210      //?Definizione costanti.
001700160210      //---------------------------------------------------------------
001800160210
001900160210      //---------------------------------------------------------------
002000160210      //?Definizione schiere.
002100160210      //---------------------------------------------------------------
002200160210
002300160210      //---------------------------------------------------------------
002400160210      //?Definizione aree dati.
002500160210      //---------------------------------------------------------------
002600160210
002700160210      //---------------------------------------------------------------
002800160210      //?Definizione strutture dati.
002900160210      //---------------------------------------------------------------
003000160210      // -?Parametri ricevuti?
003100160210     d kpjba         e ds
003200160210
003300160511      // -?File FILTE00F
003400160511     d FILTE00F      e ds                  extname(FILTE00F)
003500160210
003600160210      //---------------------------------------------------------------
003700160210      //?Definizione variabili globali.
003800160210      //---------------------------------------------------------------
003900160210      // -?Flag booleani
004000160210     d wEoF            s               n   inz(*off)
004100160210
004200160210      //---------------------------------------------------------------
004300160210      //?Definizione procedure esterne.
004400160210      //---------------------------------------------------------------
004500160210
004600160210      //---------------------------------------------------------------
004700160210      //?Definizione prototipi.
004800160210      //---------------------------------------------------------------
004900160210
005000160210      //---------------------------------------------------------------
005100160210      //?Definizione key-list.
005200160210      //---------------------------------------------------------------
005300160210
005400160210      //---------------------------------------------------------------
005500160210      //?Riepilogo indicatori.
005600160210      //---------------------------------------------------------------
005700160210
005800160210      //---------------------------------------------------------------
005900160210      //?M A I N - L I N E
006000160210      //---------------------------------------------------------------
006100160210     c     *Entry        plist
006200160210     c                   parm                    kpjba
006300160210
006400160210      /free
006500160210
006600160210       //?Operazioni iniziali
006700160210       exsr RoutInz;
006800160210
006900160210       //?Elabora file
007000160210       exsr Elabora;
007100160210
007200160210       //?Operazioni finali
007300160210       exsr RoutEnd;
007400160210
007500160210       //--------------------------------------------------------------
007600160210       //?Operazioni iniziali.
007700160210       //--------------------------------------------------------------
007800160210       BEGSR RoutInz;
007900160210
008000160210       //?Impostazione opzioni per SQL?
008100160210         exec sql set option DynUsrPrf = *Owner,
008200160210                             CloSqlCsr = *EndMod;
008300160210
008400160210       ENDSR;
008500160210
008600160210       //--------------------------------------------------------------
008700160210       //?Elabora
008800160210       //--------------------------------------------------------------
008900160210       BEGSR Elabora;
009000160210
009100160210         wEoF = *off;
009200160210
009300160505       //?Leggo Alert
009400160210         exec sql
009500160511         DECLARE LTE cursor FOR
009600160210         SELECT *
009700160511         from FILTE00F;
009800160210
009900160210         exec sql
010000160511         open LTE;
010100160210         IF sqlcode < 0;
010200160210           wEoF = *on;
010300160210         ENDIF;
010400160210
010500160210         DOW not wEoF;
010600160210           exec sql
010700160511           FETCH NEXT from LTE into :FILTE00F;
010800160210           IF sqlcod = 100 or sqlcod < 0;
010900160210             wEoF = *on;
011000160210             leave;
011100160210           ENDIF;
011200160511
011300160511           exsr Scrivi;
011400160210
011500160210         ENDDO;
011600160210
011700160210       //?Chiudo il cursore
011800160210         exec sql
011900160511         close LTE;
012000160210
012100160210       ENDSR;
012200160411
012300160411       //--------------------------------------------------------------
012400160511       //?Scrivo file FILTO.
012500160411       //--------------------------------------------------------------
012600160505       BEGSR Scrivi;
012700160411
012800160511          clear FILTO000;
012900160511
013000160511          LTOidb = LTEidb;
013100160511          LTOfil = LTEpoe;
013200160511          LTOprg = LTEprg;
013300160511          LTOdat = LTEdat;
013400160511          LTOora = LTEora;
013500160511          LTOnris = LTEnsps;
013600160511          LTOhdl = LTEhdl;
013700160511          LTOdatu = LTEdatu;
013800160511          LTOorau = LTEorau;
013900160511          LTOnrir = LTEnspr;
014000160511          LTOnrig = LTEnspg;
014100160511          LTOnrieb = LTEnspeb;
014200160511          LTOnriet = LTEnspet;
014300160511          LTOnriew = LTEnspew;
014400160511          LTOflo = LTEflo;
014500160511
014600160511          write FILTO000;
014700160411
014800160411       ENDSR;
014900160210
015000160210       //--------------------------------------------------------------
015100160210       //?Operazioni finali.
015200160210       //--------------------------------------------------------------
015300160210       BEGSR RoutEnd;
015400160210
015500160210         *inLR = *on;
015600160210         return;
015700160210
015800160210       ENDSR;
015900160210
016000160210      /end-free
