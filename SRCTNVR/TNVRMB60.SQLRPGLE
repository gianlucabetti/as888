000100091021      //---------------------------------------------------------------
000200091021      //
000300091021      //      Sistema dati per ORM assegnati a mezzo
000400091021      //
000500091021      //---------------------------------------------------------------
000600091021
000700091021     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800091021
000900091021      //---------------------------------------------------------------
001000091021      //?Dichiarazione file.
001100091021      //---------------------------------------------------------------
001200091021
001300071018     ffnorg01l  uf   e           k disk
001400091021
001500091021      //---------------------------------------------------------------
001600091021      //?Definizione costanti.
001700091021      //---------------------------------------------------------------
001800091021
001900091021      //---------------------------------------------------------------
002000091021      //?Definizione schiere.
002100091021      //---------------------------------------------------------------
002200091021
002300091021      //---------------------------------------------------------------
002400091021      //?Definizione aree dati.
002500091021      //---------------------------------------------------------------
002600091021
002700091021      //---------------------------------------------------------------
002800091021      //?Definizione strutture dati.
002900091021      //---------------------------------------------------------------
003000091021     d fnormds       e ds                  extname(fnorm00f)
003100091021
003200091021      //---------------------------------------------------------------
003300091021      //?Definizione variabili globali.
003400091021      //---------------------------------------------------------------
003500091021      // - Flags booleani
003600091021     d $End            s               n   inz(*off)
003700091021
003800091021      //---------------------------------------------------------------
003900091021      //?Definizione procedure esterne.
004000091021      //---------------------------------------------------------------
004100091021
004200091021      //---------------------------------------------------------------
004300091021      //?Definizione key-list.
004400091021      //---------------------------------------------------------------
004500091021
004600091021      //---------------------------------------------------------------
004700091021      //?Main.
004800091021      //---------------------------------------------------------------
004900091021
005000091021      /free
005100091021
005200091021        exec sql
005300091021          DECLARE orm cursor for
005400091021          SELECT fnorm01l.*
005500091021          FROM fnorm01l JOIN fnorg01l on
005600091021          ormpoe = orgpoe and ormnsr = orgnsr and ormnor = orgnor and
005700091021          ormnrv = orgnrv
005800150921          WHERE ormpor = 111 and ormfao = 100                   and
005900150921          orgndc > 0 and orgfgs = 111 and ormndc = 0;
006000091021
006100091021        exec sql
006200091021          OPEN orm;
006300091021            IF  sqlcode < 0;
006400091021              $End = *on;
006500091021            ENDIF;
006600091021
006700091021          DOW  not $End;
006800091021            exec sql
006900091021              FETCH NEXT from orm into :fnormds;
007000091021                IF  sqlcod = 100 or sqlcod < 0;
007100091021                  $End = *on;
007200091021                  leave;
007300091021                ENDIF;
007400091021
007500091021              exsr sr_sistema;
007600091021
007700091021          ENDDO;
007800091021
007900091021        exec sql
008000091021          CLOSE orm;
008100080225
008200091021        *inlr = *on;
008300070927
008400091021       //--------------------------------------------------------------
008500091021       //? sistemo i dati degli ORM
008600091021       //--------------------------------------------------------------
008700091021       BEGSR sr_sistema;
008800091021
008900091021         chain (ormpoe:ormnsr:ormnor:ormnrv) fnorg01l;
009000091021         IF  %found(fnorg01l);
009100091021           clear orgpdc;
009200091021           clear orgfgs;
009300091021           clear orgndc;
009400091021           clear orgddc;
009500091021           clear orgnftl;
009600091021           clear orgslo;
009700091021           clear orgdtvdis;
009800091021           clear orghvdis;
009900091021           UPDATE fnorg000;
010000091021         ENDIF;
010100091021
010200091021       ENDSR;
