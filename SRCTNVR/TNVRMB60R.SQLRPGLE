000100170314      //---------------------------------------------------------------
000200170502      //?TNVRMB60R - Cancella giri NON 'R' da FNACR10F
000300170314      //---------------------------------------------------------------
000400170314     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000500170314
000600170314      //---------------------------------------------------------------
000700170314      //?Dichiarazione file.
000800170314      //---------------------------------------------------------------
000900170502     fFNACR12L  uf   e           k disk
001000170314
001100170314      //---------------------------------------------------------------
001200170314      //?Definizione costanti.
001300170314      //---------------------------------------------------------------
001400170314
001500170314      //---------------------------------------------------------------
001600170314      //?Definizione schiere.
001700170314      //---------------------------------------------------------------
001800170314
001900170314      //---------------------------------------------------------------
002000170314      //?Definizione aree dati.
002100170314      //---------------------------------------------------------------
002200170314      // - Dati utente
002300170314     d §AzUte        e ds                  extname(AZUTE00F)
002400170314     d                                     dtaara
002500170314     d §DatiUte      e ds                  extname(dDatiUte)
002600170314     d                                     dtaara
002700170314
002800170314      //---------------------------------------------------------------
002900170314      //?Definizione strutture dati.
003000170314      //---------------------------------------------------------------
003100170314      // - Parametri ricevuti
003200170314     d KPJBA         e ds
003300170407
003400170502      // - Ds File FIGRG00F
003500170502     d FIGRG00F      e ds                  extname(FIGRG00F)
003600170314
003700170314      //---------------------------------------------------------------
003800170314      //?Definizione variabili globali.
003900170314      //---------------------------------------------------------------
004000170314      // - Flags booleani
004100170314     d Fine            s               n   inz(*off)
004200170314     d wEoF            s               n   inz(*off)
004300170314
004400170314      // - Campi di comodo
004500170314
004600170314      //---------------------------------------------------------------
004700170314      //?Definizione procedure esterne.
004800170314      //---------------------------------------------------------------
004900170314
005000170314      //---------------------------------------------------------------
005100170314      //?Definizione prototipi.
005200170314      //---------------------------------------------------------------
005300170314
005400170314      //---------------------------------------------------------------
005500170314      //?Definizione key-list.
005600170314      //---------------------------------------------------------------
005700170314
005800170314      //---------------------------------------------------------------
005900170314      //?Riepilogo indicatori.
006000170314      //---------------------------------------------------------------
006100170314
006200170314      //---------------------------------------------------------------
006300170314      //?M A I N - L I N E
006400170314      //---------------------------------------------------------------
006500170314     c     *Entry        plist
006600170314     c                   parm                    kpjba
006700170314
006800170314      /free
006900170314
007000170314       //?Operazioni iniziali
007100170314       exsr RoutInz;
007200170314
007300170407       //?Elaborazione principale
007400170407       exsr Elabora;
007500170314
007600170314       //?Operazioni finali
007700170314       exsr RoutEnd;
007800170314
007900170314       //--------------------------------------------------------------
008000170314       //?Operazioni iniziali.
008100170314       //--------------------------------------------------------------
008200170314       BEGSR RoutInz;
008300170314
008400170314         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
008500170314
008600170314       ENDSR;
008700170314
008800170314       //--------------------------------------------------------------
008900170407       //?Elaborazione principale.
009000170314       //--------------------------------------------------------------
009100170407       BEGSR Elabora;
009200170407
009300170502       //?Leggo i giri NON 'R' su FIGRG00F
009400170407         exec sql
009500170502         DECLARE GIRI cursor for
009600170502         SELECT * from FIGRG00F
009700170502         WHERE  substr(GRGflo, 4, 1) <> 'R'
009800170502         ORDER BY GRGfgs, GRGcgi;
009900170407
010000170502         exec sql open GIRI;
010100170407
010200170407         IF  sqlcode < 0;
010300170407           wEoF = *on;
010400170502           exec sql close GIRI;
010500170407           leavesr;
010600170407         ENDIF;
010700170407
010800170407         DOW  not wEoF;
010900170407           exec sql
011000170502           fetch next from GIRI into :FIGRG00F;
011100170407           IF  sqlcod = 100 or sqlcod < 0;
011200170407             wEoF = *on;
011300170407             leave;
011400170407           ENDIF;
011500170407
011600170502         //?Leggo anagrafiche
011700170502           setll (GRGfgs:GRGcgi) FNACR12L;
011800170502           reade (GRGfgs:GRGcgi) FNACR12L;
011900170502           DOW  not %eof(FNACR12L);
012000170502             delete FNACR100;
012100170502             reade (GRGfgs:GRGcgi) FNACR12L;
012200170502           ENDDO;
012300170407
012400170407         ENDDO;
012500170407
012600170502         exec sql close GIRI;
012700170314
012800170314       ENDSR;
012900170314
013000170314       //--------------------------------------------------------------
013100170314       //?Operazioni finali.
013200170314       //--------------------------------------------------------------
013300170314       BEGSR RoutEnd;
013400170314
013500170314         *inLR = *on;
013600170314         return;
013700170314
013800170314       ENDSR;
013900170314
014000170314      /end-free
