000100091021      //---------------------------------------------------------------
000200091021      //
000300091021      //      Sistema dati per ORM assegnati a mezzo
000400091021      //
000500091021      //---------------------------------------------------------------
000600091021
000700091021     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800091021
000900091021      //---------------------------------------------------------------
001000091021      //?Dichiarazione file.
001100091021      //---------------------------------------------------------------
001200091021
001300091022     ffnorm01l  uf   e           k disk
001400091021
001500091021      //---------------------------------------------------------------
001600091021      //?Definizione costanti.
001700091021      //---------------------------------------------------------------
001800091021
001900091021      //---------------------------------------------------------------
002000091021      //?Definizione schiere.
002100091021      //---------------------------------------------------------------
002200091021
002300091021      //---------------------------------------------------------------
002400091021      //?Definizione aree dati.
002500091021      //---------------------------------------------------------------
002600091021
002700091021      //---------------------------------------------------------------
002800091021      //?Definizione strutture dati.
002900091021      //---------------------------------------------------------------
003000091021     d fnormds       e ds                  extname(fnorm00f)
003100091022     d fnblpds       e ds                  extname(fnblp00f)
003200091021
003300091021      //---------------------------------------------------------------
003400091021      //?Definizione variabili globali.
003500091021      //---------------------------------------------------------------
003600091021      // - Flags booleani
003700091021     d $End            s               n   inz(*off)
003800091021
003900091021      //---------------------------------------------------------------
004000091021      //?Definizione procedure esterne.
004100091021      //---------------------------------------------------------------
004200091021
004300091021      //---------------------------------------------------------------
004400091021      //?Definizione key-list.
004500091021      //---------------------------------------------------------------
004600091021
004700091021      //---------------------------------------------------------------
004800091021      //?Main.
004900091021      //---------------------------------------------------------------
005000091021
005100091021      /free
005200091021
005300091021        exec sql
005400091021          DECLARE orm cursor for
005500091022          SELECT fnorm00f.*, fnblp00f.*
005600091022          FROM fnorm00f JOIN fnblp00f on
005700091022          digits(blplnp) = substr(ormrfa, 4, 3) and
005800091022          blpdim = ormdao and ormrsr = blprsd
005900091022          where ormnsr > 0 and ormdao > 20091012
006000091022          and ormpor = 0
006100091022          and blpgma = 'RC';
006200091021
006300091021        exec sql
006400091021          OPEN orm;
006500091021            IF  sqlcode < 0;
006600091021              $End = *on;
006700091021            ENDIF;
006800091021
006900091021          DOW  not $End;
007000091021            exec sql
007100091022              FETCH NEXT from orm into :fnormds, :fnblpds;
007200091021                IF  sqlcod = 100 or sqlcod < 0;
007300091021                  $End = *on;
007400091021                  leave;
007500091021                ENDIF;
007600091021
007700091021              exsr sr_sistema;
007800091021
007900091021          ENDDO;
008000091021
008100091021        exec sql
008200091021          CLOSE orm;
008300080225
008400091021        *inlr = *on;
008500070927
008600091021       //--------------------------------------------------------------
008700091021       //? sistemo i dati degli ORM
008800091021       //--------------------------------------------------------------
008900091021       BEGSR sr_sistema;
009000091021
009100091022         chain (ormpoe:ormnsr:ormnor:ormnrv) fnorm01l;
009200091022         IF  %found(fnorm01l);
009300091022           ormpor = blplna;
009400091022           ormrfa = 'B' + %subst(%editc(blpaas:'X'):3:2) +
009500091022                    %editc(blplnp:'X') + %editc(blpnrs:'X') +
009600091022                    %editc(blpnsp:'X');
009700091022           UPDATE fnorm000;
009800091021         ENDIF;
009900091021
010000091021       ENDSR;
