000300171123      //-------------------------------------------------------------------------
000400171123       // Traffico Dati Cliente Mondadori
000500171123      //-------------------------------------------------------------------------
000501171123     h decedit('0,') datedit(*ymd.) option(*nodebugio)
000502171123
000503171123       //---------------------------------------------------------------
000504171123       //?Dichiarazione file
000505171123       //---------------------------------------------------------------
000700171123     fWFTRM00F  o    e             disk
000701171123
000702171123       //---------------------------------------------------------------
000703171123       //Definizione schiere.
000704171123       //---------------------------------------------------------------
000705171123     d skcod           s              7s 0 dim(100) ctdata perrcd(1)
000706171123
001300171123       //---------------------------------------------------------------
001301171123       //?Definizione strutture dati.
001302171123       //---------------------------------------------------------------
001303171123     d kpjba         e ds
001304171123     d TISE70DS      e ds
001305171123
001306171123       //---------------------------------------------------------------
001307171123       //?Definizione variabili.
001308171123       //---------------------------------------------------------------
001309171123     d mesi            s              2s 0 inz(10)
001310171123     d indiceX         s              3s 0 inz
001311171123     d indiceY         s              3s 0 inz
001312171123     d wDel            s              8s 1 inz
001313171123     d wVal            s             20s 3 inz
001314171123
001315171123       //---------------------------------------------------------------
001316171123       //?Definizione procedure usate.
001317171123       //---------------------------------------------------------------
005101171123     d TISE70R         pr                  extpgm('TISE70R')
005103171123     d  tise70ds                           likeds(tise70ds)
008100060316
008101171123       //---------------------------------------------------------------
008102171123
008103171123     c     *entry        plist
008104171123     c                   parm                    kpjba
008105171123
008106171123      // Leggo tutta la schiera dei codici Mondadori passata dal presidio vendite
008107171123       indiceX = 1;
008108171123       FOR indiceX by 1 to %elem(skcod);
008109171123         IF  skcod(indiceX) > *zeros;
008110171123           exsr Elabora;
008111171123         ENDIF;
008112171123       ENDFOR;
008119171123
008120171123       *inLR = *on;
008121171123
008122171123       //--------------------------------------------------------------
008123171123       //?Elaboro i codici
008124171123       //--------------------------------------------------------------
008125171123       BEGSR Elabora;
008126171123
008127171123         //Devo elaborare i dati del traffico mese x mese
008128171123         //da Gennaio 2017 a Ottobre 2017
008129171123         indiceY = 1;
008130171123         FOR indiceY by 1 to mesi;
008131171123         clear wVal;
008132171123         clear wDel;
008133171123           clear TISE70DS;
008134171123           I70tla = 'S';
008135171123           I70tle = 'ST';
008136171123           I70ksc = skcod(indiceX);
008137171123           I70dai = 2017 *100 +indiceY;
008138171123           I70daf = I70dai;
008139171123           tise70r (TISE70DS);
008140171123           clear WFTRM000;
008141171123           TRMcliente = skcod(indiceX);
008142171123           TRMmese = indiceY;
008143171123           TRMnrsped = O70nsp;
008144171123           TRMpeso = O70pkg;
008145171123           TRMricavi = O70ric;
008146171123         //?Calcolo il delta
008147171123         //?Ricavo Reale - Ricavo presunto * 100 / Ricavo Reale
008148171123           wVal = (O70rir - O70rip) * 100;
008149171123           IF  O70rir = 0;
008150171123             O70rir = 1;
008151171123           ENDIF;
008152171123           wVal = wVal / O70rir;
008153171123           eval(h) wDel = wVal;
008154171123           SELECT;
008155171123           WHEN  wDel = 0;
008156171123           WHEN  wDel >= 1000;
008157171123             TRMdelta = 999,9;
008158171123           WHEN  wDel <= -1000;
008159171123             TRMdelta = -999,9;
008160171123           OTHER;
008161171123             TRMdelta = wDel;
008162171123           ENDSL;
008164171123           write WFTRM000;
008165171123         ENDFOR;
008166171123
008167171123       ENDSR;
008201171123
008400171123** skcod
0084011711230013730
0084021711230017636
0084031711230024484
0084041711230024824
0084051711230055052
0084061711230055053
0084071711230055877
0084081711230058209
0084091711230058494
0084101711230058495
0084111711230058496
0084121711230058497
0084131711230251439
0084141711230280251
0084151711230280277
0084161711230289895
0084171711230320372
0084181711230321911
0084191711230434990
0084201711230435892
0084211711230435929
0084221711230437376
0084231711230495962
0084241711230496188
0084251711230496202
0084261711230496203
0084271711230496204
0084281711230496211
0084291711230496217
0084301711230496219
0084311711230496220
0084321711230496221
0084331711230496222
0084341711230496223
0084351711230496224
0084361711230496225
0084371711230496226
0084381711230496227
0084391711230496246
0084401711230496247
0084411711230581448
0084421711230637258
0084431711230637259
0084441711230637260
0084451711230637261
0084461711230637262
0084471711230637417
0084481711230637418
0084491711230674860
0084501711230701758
0084511711230720792
0084521711230871626
0084531711230898474
0084541711230898475
0084551711230898935
0084561711230899180
0084571711230936541
0084581711230936542
0084591711230936546
0084601711230962225
0084611711231051938
0084621711231092021
0084631711231141822
0084641711231153256
0084651711231153257
0084661711231153258
0084671711231203232
0084681711231203233
0084691711231203234
0084701711231203235
0084711711231203236
0084721711231203237
0084731711231203238
0084741711231203239
0084751711231203240
0084761711231203241
0084771711231203242
0084781711231203243
0084791711231203315
0084801711231203382
0084811711231231440
0084821711231261142
0084831711231261151
0084841711231272151
0084851711231302591
0084861711231302592
0084871711231302593
0084881711231302616
0084891711231321760
0084901711231392548
0084911711231431433
0084921711231480841
0084931711231651133
0084941711231730814
0084951711232242666
0084961711232495496
0084971711232553321
0084981711232553322
0084991711232553323
0085001711232553324
