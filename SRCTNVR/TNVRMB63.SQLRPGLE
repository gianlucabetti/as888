000100091021      //---------------------------------------------------------------
000200091021      //
000300091119      //      Sistema FIAR5 rcd RCC
000400091021      //
000500091021      //---------------------------------------------------------------
000600091021
000700091021     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800091021
000900091021      //---------------------------------------------------------------
001000091021      //?Dichiarazione file.
001100091021      //---------------------------------------------------------------
001200091021
001300091119     ffiar501l  uf   e           k disk
001400091021
001500091021      //---------------------------------------------------------------
001600091021      //?Definizione costanti.
001700091021      //---------------------------------------------------------------
001800091021
001900091021      //---------------------------------------------------------------
002000091021      //?Definizione schiere.
002100091021      //---------------------------------------------------------------
002200091021
002300091021      //---------------------------------------------------------------
002400091021      //?Definizione aree dati.
002500091021      //---------------------------------------------------------------
002600091021
002700091021      //---------------------------------------------------------------
002800091021      //?Definizione strutture dati.
002900091021      //---------------------------------------------------------------
003000091021     d fnormds       e ds                  extname(fnorm00f)
003100091119     d dar5rcc       e ds
003200091021
003300091021      //---------------------------------------------------------------
003400091021      //?Definizione variabili globali.
003500091021      //---------------------------------------------------------------
003600091021      // - Flags booleani
003700091021     d $End            s               n   inz(*off)
003800091119
003900091119      // - Campi di comodo
004000091119     d wormrfa         s                   like(ormrfa)
004100091021
004200091021      //---------------------------------------------------------------
004300091021      //?Definizione procedure esterne.
004400091021      //---------------------------------------------------------------
004500091021
004600091021      //---------------------------------------------------------------
004700091021      //?Definizione key-list.
004800091021      //---------------------------------------------------------------
004900091021
005000091021      //---------------------------------------------------------------
005100091021      //?Main.
005200091021      //---------------------------------------------------------------
005300091021
005400091021      /free
005500091021
005600091021        exec sql
005700091119          DECLARE ar5 cursor for
005800091119          SELECT ar5aas, ar5lnp, ar5nrs, ar5nsp
005900091119          FROM fiar500f
006000091119          where ar5trd = 'RCC' and ar5uni = '00000000000000';
006100091021
006200091021        exec sql
006300091119          OPEN ar5;
006400091021            IF  sqlcode < 0;
006500091021              $End = *on;
006600091021            ENDIF;
006700091021
006800091021          DOW  not $End;
006900091021            exec sql
007000091119              FETCH NEXT from ar5 into :ar5aas, :ar5lnp, :ar5nrs, :ar5nsp;
007100091021                IF  sqlcod = 100 or sqlcod < 0;
007200091021                  $End = *on;
007300091021                  leave;
007400091021                ENDIF;
007500091021
007600091021              exsr sr_sistema;
007700091021
007800091021          ENDDO;
007900091021
008000091021        exec sql
008100091119          CLOSE ar5;
008200080225
008300091021        *inlr = *on;
008400070927
008500091021       //--------------------------------------------------------------
008600091119       //? sistemo i dati
008700091021       //--------------------------------------------------------------
008800091021       BEGSR sr_sistema;
008900091119
009000091119         wormrfa = 'B' + %subst(%editc(ar5aas:'X'):3:2) +
009100091119                   %editc(ar5lnp:'X') + %editc(ar5nrs:'X') +
009200091119                   %editc(ar5nsp:'X');
009300091119
009400091119         exec sql
009500091119          select ormpoe, ormnsr, ormnor, ormnrv
009600091119          into :ormpoe, :ormnsr, :ormnor, :ormnrv
009700091119          from fnorm00f
009800091119          where ormrfa = :wormrfa;
009900091021
010000091119          IF  sqlcod = 0 ;
010100091119            chain (ar5aas:ar5lnp:ar5nrs:ar5nsp:'RCC') fiar501l;
010200091119            IF  %found(fiar501l);
010300091119              브r5rpoe = ormpoe;
010400091119              브r5rnsr = ormnsr;
010500091119              브r5rnor = ormnor;
010600091119              브r5rnrv = ormnrv;
010700091119              ar5uni = dar5rcc;
010800091119              UPDATE fiar5000;
010900091119            ENDIF;
011000091119          ENDIF;
011100091021
011200091021       ENDSR;
