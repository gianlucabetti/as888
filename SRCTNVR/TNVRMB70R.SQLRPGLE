000100100413      //---------------------------------------------------------------
000200101222      //?TNVRMB70R - Sistemo data/ora immissione attività sul SIC
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000101222
001100101222      // - File attività
001200101222     fTIATC01L  if   e           k disk
001300101222      // - File per QL
001400101222     fTIATCE0F  uf   e             disk
001500100413
001600100413      //---------------------------------------------------------------
001700100413      //?Definizione costanti.
001800100413      //---------------------------------------------------------------
001900100413
002000100413      //---------------------------------------------------------------
002100100413      //?Definizione schiere.
002200100413      //---------------------------------------------------------------
002300090715
002400100413      //---------------------------------------------------------------
002500100413      //?Definizione aree dati.
002600100413      //---------------------------------------------------------------
002700100413
002800100413      //---------------------------------------------------------------
002900100413      //?Definizione strutture dati.
003000100413      //---------------------------------------------------------------
003100101222
003200101222      // File attività QL
003300101222     d ATCEds        e ds                  extname(TIATCE0F)
003400101222     d                                     prefix(w_)
003500100415
003600100413      //---------------------------------------------------------------
003700100413      //?Definizione variabili globali.
003800100413      //---------------------------------------------------------------
003900100413
004000100413      // - Flags booleani
004100100413     d $End            s               n   inz(*off)
004200100413     d $Fine           s               n   inz(*off)
004300100413
004400101222      // - Campi di comodo
004500101222     d w_ATErcd        s             15  0 inz
004600101222
004700100413      //---------------------------------------------------------------
004800100413      //?Definizione procedure esterne.
004900100413      //---------------------------------------------------------------
005000100413
005100100413      //---------------------------------------------------------------
005200101021      //?Prototipi.
005300100413      //---------------------------------------------------------------
005400100413
005500100413      //---------------------------------------------------------------
005600100413      //?Definizione key-list.
005700100413      //---------------------------------------------------------------
005800100413
005900100413      //---------------------------------------------------------------
006000100413      //?Riepilogo indicatori.
006100100413      //---------------------------------------------------------------
006200100413
006300100413      //---------------------------------------------------------------
006400100413      //?M A I N - L I N E
006500100413      //---------------------------------------------------------------
006600100413
006700100413      /free
006800101021
006900101021       //?Operazioni iniziali
007000101021       exsr sr_RoutInz;
007100100413
007200101222       //?Leggo attività eseguite QL
007300101021       exec sql
007400101222       declare F1 cursor for
007500101222       select rrn(TIATCE0F) as w_ATErrn, TIATCE0F.* from TIATCE0F
007600101222       order by ATEatn, ATEatnp;
007700101021
007800101021       exec sql
007900101222       open F1;
008000101222
008100101222       IF  sqlcode < 0;
008200101222         $End = *on;
008300101222       ENDIF;
008400101222
008500101222       DOW not $End;
008600101222         exec sql
008700101222         fetch next from F1 into :w_ATErcd, :ATCEds;
008800101222         IF  sqlcod = 100 or sqlcod < 0;
008900101222           $End = *on;
009000101222           leave;
009100101222         ENDIF;
009200101222         //?Aggancio l'attività
009300101222         chain (w_ATEtat:w_ATEatn:w_ATEatnp) TIATC01L;
009400101222         IF  %found(TIATC01L);
009500101222         //?Aggiorno la data e ora immissione sul file QL
009600101222         //?agganciandolo con numero relativo record
009700101222           chain w_ATErcd TIATCE0F;
009800101222           IF  %found(TIATCE0F);
009900101222             ATEdim = ATCdim;
010000101222             ATEhim = ATChim;
010100101222             update TIATCE00;
010200101222           ENDIF;
010300101222         ENDIF;
010400101222       ENDDO;
010500101222
010600101222       exec sql
010700101222       close F1;
010800101222
010900100413       //?Operazioni finali
011000100413       exsr sr_RoutEnd;
011100100413
011200100413       //--------------------------------------------------------------
011300100413       //?Operazioni iniziali.
011400100413       //--------------------------------------------------------------
011500100413       BEGSR sr_RoutInz;
011600100423
011700100413
011800100413       ENDSR;
011900100426
012000100413       //--------------------------------------------------------------
012100100413       //?Operazioni finali.
012200100413       //--------------------------------------------------------------
012300100413       BEGSR sr_RoutEnd;
012400100413
012500100413         *inLR = *on;
012600100413         return;
012700100413
012800100413       ENDSR;
012900100413
013000100413      /end-free
