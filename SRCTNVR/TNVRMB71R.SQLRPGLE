000100100413      //---------------------------------------------------------------
000200110304      //?TNVRMB71R - Sistema CMM a 0
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000100930     fCNACO16L  if   e           k disk
001100110304     fCNCLP00F  if   e           k disk
001200110304     fTIATC04L  if   e           k disk
001300100423     fTNCPO01L  uf   e           k disk
001400100413
001500100413      //---------------------------------------------------------------
001600100413      //?Definizione costanti.
001700100413      //---------------------------------------------------------------
001800100413
001900100413      //---------------------------------------------------------------
002000100413      //?Definizione schiere.
002100100413      //---------------------------------------------------------------
002200090715
002300100413      //---------------------------------------------------------------
002400100413      //?Definizione aree dati.
002500100413      //---------------------------------------------------------------
002600100413
002700100413      //---------------------------------------------------------------
002800100413      //?Definizione strutture dati.
002900100413      //---------------------------------------------------------------
003000100415
003100100415     d KPJBA         e ds
003200100423
003300100423      // Anagrafica potenziali
003400100423     d TNCPOds       e ds                  extname(TNCPO00F)
003500100423     d                                     prefix(o_)
003600100929
003700100929      // Attività
003800100929     d TIATCds       e ds                  extname(TIATC00F)
003900100415
004000100413      //---------------------------------------------------------------
004100100413      //?Definizione variabili globali.
004200100413      //---------------------------------------------------------------
004300100413
004400100413      // - Flags booleani
004500100413     d $End            s               n   inz(*off)
004600100413     d $Fine           s               n   inz(*off)
004700100413
004800100413      // - Campi di comodo
004900101001     d NrAtt           s              7  0
005000100929     d sav_CPOcpo      s                   like(CPOcpo)
005100110304     d tipo            s              1
005200100413
005300100413      //---------------------------------------------------------------
005400100413      //?Definizione procedure esterne.
005500100413      //---------------------------------------------------------------
005600100413
005700100413      //---------------------------------------------------------------
005800100413      //?prototipi
005900100413      //---------------------------------------------------------------
006000100413
006100100413      //---------------------------------------------------------------
006200100413      //?Definizione key-list.
006300100413      //---------------------------------------------------------------
006400100413
006500100413      //---------------------------------------------------------------
006600100413      //?Riepilogo indicatori.
006700100413      //---------------------------------------------------------------
006800100413
006900100413      //---------------------------------------------------------------
007000100413      //?M A I N - L I N E
007100100413      //---------------------------------------------------------------
007200100929
007300100929     c     *Entry        plist
007400110304     c                   parm                    tipo
007500100413
007600100413      /free
007700100413
007800100413       //?Operazioni iniziali
007900110304       exsr RoutInz;
008000110304
008100110304       SELECT;
008200110304         WHEN  tipo = 'C';
008300110304         //?Elabora Codificati
008400110304           exsr Elabora_C;
008500110304
008600110304         WHEN  tipo = 'M';
008700110304         //?Elabora Mai codificati
008800110304           exsr Elabora_M;
008900110304
009000110304         WHEN  tipo = 'P';
009100110304         //?Elabora Persi
009200110304           exsr Elabora_P;
009300110304       ENDSL;
009400100413
009500100413       //?Operazioni finali
009600110304       exsr RoutEnd;
009700100413
009800100413       //--------------------------------------------------------------
009900100413       //?Operazioni iniziali.
010000100413       //--------------------------------------------------------------
010100110304       BEGSR RoutInz;
010200100423
010300100413
010400100413       ENDSR;
010500100420
010600100413       //--------------------------------------------------------------
010700110304       //?Elabora Codificati.
010800100413       //--------------------------------------------------------------
010900110304       BEGSR Elabora_C;
011000110304
011100110304         //?Estraggo i potenziali Codificati
011200110304         $End = *off;
011300110304
011400110304         //?Dichiarazione del cursore
011500110304         exec sql
011600110304         DECLARE CPOC cursor for
011700110304         SELECT CPOCPO
011800110304         FROM TNCPO00F
011900110304         WHERE CPOCMM = 0 and CPOFLS = 'C'
012000110304         ORDER by CPOcpo;
012100110304
012200110304         //?Apertura del cursore
012300110304         exec sql open CPOC;
012400110304
012500110304         IF sqlcode < 0;
012600110304           $End = *on;
012700110304         ENDIF;
012800110304
012900110304         DOW not $End;
013000110304
013100110304           exec sql FETCH next from CPOC into :O_CPOCPO;
013200110304
013300110304           IF sqlcod = 100 or sqlcod < 0;
013400110304             $End = *on;
013500110304             leave;
013600110304           ENDIF;
013700110304
013800110304           //?Recupero il commerciale dal primo cliente che aggancio
013900110304           chain O_CPOcpo CNACO16L;
014000110304           IF  %found(CNACO16L);
014100110304             chain (ACOkut:ACOkcc:ACOksc) CNCLP00F;
014200110304             IF  %found(CNCLP00F);
014300110304               chain o_CPOcpo TNCPO01L;
014400110304               IF  %found(TNCPO01L);
014500110304                 CPOcmm = CLPage;
014600110304                 update TNCPO000;
014700110304               ENDIF;
014800110304             ENDIF;
014900110304           ENDIF;
015000110304
015100110304         ENDDO;
015200110304
015300110304         //?chiudo il cursore
015400110304         exec sql CLOSE CPOC;
015500100423
015600100423       ENDSR;
015700110304
015800110304       //--------------------------------------------------------------
015900110304       //?Elabora Mai codificati.
016000110304       //--------------------------------------------------------------
016100110304       BEGSR Elabora_M;
016200110304
016300110304         //?Estraggo i potenziali Mai codificati
016400110304         $End = *off;
016500110304
016600110304         //?Dichiarazione del cursore
016700110304         exec sql
016800110304         DECLARE CPOM cursor for
016900110304         SELECT CPOCPO
017000110304         FROM TNCPO00F
017100110304         WHERE CPOCMM = 0 and CPOFLS = 'M'
017200110304         ORDER by CPOcpo;
017300110304
017400110304         //?Apertura del cursore
017500110304         exec sql open CPOM;
017600110304
017700110304         IF sqlcode < 0;
017800110304           $End = *on;
017900110304         ENDIF;
018000110304
018100110304         DOW not $End;
018200110304
018300110304           exec sql FETCH next from CPOM into :O_CPOCPO;
018400110304
018500110304           IF sqlcod = 100 or sqlcod < 0;
018600110304             $End = *on;
018700110304             leave;
018800110304           ENDIF;
018900110304
019000110304           //?Recupero il commerciale dalla prima attività che trovo
019100110304           chain O_CPOcpo TIATC04L;
019200110304           IF  %found(TIATC04L);
019300110304             chain o_CPOcpo TNCPO01L;
019400110304             IF  %found(TNCPO01L);
019500110304               CPOcmm = ATCcco;
019600110304               update TNCPO000;
019700110304             ENDIF;
019800110304           ENDIF;
019900110304
020000110304         ENDDO;
020100110304
020200110304         //?chiudo il cursore
020300110304         exec sql CLOSE CPOM;
020400110304
020500110304       ENDSR;
020600110304
020700110304       //--------------------------------------------------------------
020800110304       //?Elabora Persi.
020900110304       //--------------------------------------------------------------
021000110304       BEGSR Elabora_P;
021100110304
021200110304         //?Estraggo i potenziali Persi
021300110304         $End = *off;
021400110304
021500110304         //?Dichiarazione del cursore
021600110304         exec sql
021700110304         DECLARE CPOP cursor for
021800110304         SELECT CPOCPO
021900110304         FROM TNCPO00F
022000110304         WHERE CPOCMM = 0 and CPOFLS = 'P'
022100110304         ORDER by CPOcpo;
022200110304
022300110304         //?Apertura del cursore
022400110304         exec sql open CPOP;
022500110304
022600110304         IF sqlcode < 0;
022700110304           $End = *on;
022800110304         ENDIF;
022900110304
023000110304         DOW not $End;
023100110304
023200110304           exec sql FETCH next from CPOP into :O_CPOCPO;
023300110304
023400110304           IF sqlcod = 100 or sqlcod < 0;
023500110304             $End = *on;
023600110304             leave;
023700110304           ENDIF;
023800110304
023900110304           //?Recupero il commerciale dal primo cliente che aggancio
024000110304           chain O_CPOcpo CNACO16L;
024100110304           IF  %found(CNACO16L);
024200110304             chain (ACOkut:ACOkcc:ACOksc) CNCLP00F;
024300110304             IF  %found(CNCLP00F);
024400110304               chain o_CPOcpo TNCPO01L;
024500110304               IF  %found(TNCPO01L);
024600110304                 CPOcmm = CLPage;
024700110304                 update TNCPO000;
024800110304               ENDIF;
024900110304             ENDIF;
025000110304           ENDIF;
025100110304
025200110304         ENDDO;
025300110304
025400110304         //?chiudo il cursore
025500110304         exec sql CLOSE CPOP;
025600110304
025700110304       ENDSR;
025800100426
025900100413       //--------------------------------------------------------------
026000100413       //?Operazioni finali.
026100100413       //--------------------------------------------------------------
026200110304       BEGSR RoutEnd;
026300100413
026400100413         *inLR = *on;
026500100413         return;
026600100413
026700100413       ENDSR;
026800100413
026900100413      /end-free
