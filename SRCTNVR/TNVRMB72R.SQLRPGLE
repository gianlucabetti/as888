000100100413      //---------------------------------------------------------------
000200110606      //?TNVRMB72R - Sistema FTR su TNCPO00F
000300100413      //---------------------------------------------------------------
000400100413
000500100413     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600100413
000700100413      //---------------------------------------------------------------
000800100413      //?Dichiarazione file.
000900100413      //---------------------------------------------------------------
001000100413
001100100413      //---------------------------------------------------------------
001200100413      //?Definizione costanti.
001300100413      //---------------------------------------------------------------
001400100413
001500100413      //---------------------------------------------------------------
001600100413      //?Definizione schiere.
001700100413      //---------------------------------------------------------------
001800090715
001900100413      //---------------------------------------------------------------
002000100413      //?Definizione aree dati.
002100100413      //---------------------------------------------------------------
002200100413
002300100413      //---------------------------------------------------------------
002400100413      //?Definizione strutture dati.
002500100413      //---------------------------------------------------------------
002600100415
002700100415     d KPJBA         e ds
002800100423
002900100423      // Anagrafica potenziali
003000100423     d TNCPOds       e ds                  extname(TNCPO00F)
003100100415
003200100413      //---------------------------------------------------------------
003300100413      //?Definizione variabili globali.
003400100413      //---------------------------------------------------------------
003500100413
003600100413      // - Flags booleani
003700100413     d $End            s               n   inz(*off)
003800110606
003900110606      // - Campi di comodo
004000110606     d parmcpo         s             11
004100100413
004200100413      //---------------------------------------------------------------
004300100413      //?Definizione procedure esterne.
004400100413      //---------------------------------------------------------------
004500110606
004600110606      // - Ricalcola codice importanza
004700110606     d TRMK08R         pr                  extpgm('TRMK08R')
004800110606     d  kpjba                              likeds(KPJBA)
004900110606     d  parmcpo                      11
005000110606
005100100413
005200100413      //---------------------------------------------------------------
005300100413      //?prototipi
005400100413      //---------------------------------------------------------------
005500100413
005600100413      //---------------------------------------------------------------
005700100413      //?Definizione key-list.
005800100413      //---------------------------------------------------------------
005900100413
006000100413      //---------------------------------------------------------------
006100100413      //?Riepilogo indicatori.
006200100413      //---------------------------------------------------------------
006300100413
006400100413      //---------------------------------------------------------------
006500100413      //?M A I N - L I N E
006600100413      //---------------------------------------------------------------
006700100929
006800100929     c     *Entry        plist
006900110606     c                   parm                    kpjba
007000100413
007100100413      /free
007200100413
007300100413       //?Operazioni iniziali
007400110304       exsr RoutInz;
007500110606
007600110606       //?Elabora
007700110606       exsr Elabora;
007800100413
007900100413       //?Operazioni finali
008000110304       exsr RoutEnd;
008100100413
008200100413       //--------------------------------------------------------------
008300100413       //?Operazioni iniziali.
008400100413       //--------------------------------------------------------------
008500110304       BEGSR RoutInz;
008600100423
008700100413
008800100413       ENDSR;
008900100420
009000100413       //--------------------------------------------------------------
009100110606       //?Elabora.
009200100413       //--------------------------------------------------------------
009300110606       BEGSR Elabora;
009400110304
009500110606         //?Estraggo i potenziali con CPOFTR strano
009600110304         $End = *off;
009700110304
009800110304         //?Dichiarazione del cursore
009900110304         exec sql
010000110606         DECLARE CPO cursor for
010100110304         SELECT CPOCPO
010200110304         FROM TNCPO00F
010300110606         WHERE CPOFTR not in('D', 'T', 'A', 'B', 'C') and
010400110606               CPOFTR <> ' '
010500110304         ORDER by CPOcpo;
010600110304
010700110304         //?Apertura del cursore
010800110606         exec sql open CPO;
010900110304
011000110304         IF sqlcode < 0;
011100110304           $End = *on;
011200110304         ENDIF;
011300110304
011400110304         DOW not $End;
011500110304
011600110606           exec sql FETCH next from CPO into :CPOCPO;
011700110304
011800110304           IF sqlcod = 100 or sqlcod < 0;
011900110304             $End = *on;
012000110304             leave;
012100110304           ENDIF;
012200110304
012300110606           //?Richiamo pgm che ricalcola il codice importanza
012400110606           parmcpo = %editc(CPOcpo:'X');
012500110606           trmk08r (kpjba : parmcpo);
012600110304
012700110304         ENDDO;
012800110304
012900110304         //?chiudo il cursore
013000110606         exec sql CLOSE CPO;
013100100423
013200100423       ENDSR;
013300100426
013400100413       //--------------------------------------------------------------
013500100413       //?Operazioni finali.
013600100413       //--------------------------------------------------------------
013700110304       BEGSR RoutEnd;
013800100413
013900100413         *inLR = *on;
014000100413         return;
014100100413
014200100413       ENDSR;
014300100413
014400100413      /end-free
