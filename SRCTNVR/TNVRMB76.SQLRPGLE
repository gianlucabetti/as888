000100120103      //---------------------------------------------------------------
000200120103      //
000300120103      //?              ORM RC rimessi a giro
000400120103      //
000500120103      //---------------------------------------------------------------
000600120103
000700120103     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800120103
000900120103      //---------------------------------------------------------------
001000120103      //?Dichiarazione file.
001100120103      //---------------------------------------------------------------
001200120103
001300120103     ffnorf01l  if   e           k disk
001400120103     fwfnormmb  o    e             disk    rename(wfnormmb:wfnorm)
001500120103
001600120103      //---------------------------------------------------------------
001700120103      //?Definizione costanti.
001800120103      //---------------------------------------------------------------
001900120103
002000120103      //---------------------------------------------------------------
002100120103      //?Definizione schiere.
002200120103      //---------------------------------------------------------------
002300120103
002400120103      //---------------------------------------------------------------
002500120103      //?Definizione aree dati.
002600120103      //---------------------------------------------------------------
002700120103
002800120103      //---------------------------------------------------------------
002900120103      //?Definizione strutture dati.
003000120103      //---------------------------------------------------------------
003100120103
003200120103     d FNORM00F      e ds                  extname(FNORM00F)
003300120103
003400120103      //---------------------------------------------------------------
003500120103      //?Definizione variabili globali.
003600120103      //---------------------------------------------------------------
003700120103      // - Flags booleani
003800120103     d wChiuso         s               n   inz(*off)
003900120103     d wFine           s               n   inz(*off)
004000120103     d wRiaperto       s               n   inz(*off)
004100120103
004200120103      // - Campi di comodo
004300120103     d wData1          s              8  0 inz(20111101)
004400120103     d wData2          s              8  0 inz(20111130)
004500120103
004600120103      //---------------------------------------------------------------
004700120103      //?Definizione procedure esterne.
004800120103      //---------------------------------------------------------------
004900120103
005000120103      //---------------------------------------------------------------
005100120103      //?Definizione prototipi.
005200120103      //---------------------------------------------------------------
005300120103
005400120103      //---------------------------------------------------------------
005500120103      //?Definizione key-list.
005600120103      //---------------------------------------------------------------
005700120103
005800120103      //---------------------------------------------------------------
005900120103      //?Riepilogo indicatori.
006000120103      //---------------------------------------------------------------
006100120103
006200120103      //---------------------------------------------------------------
006300120103      //?M A I N - L I N E
006400120103      //---------------------------------------------------------------
006500120103
006600120103      /free
006700120103
006800120103       //?Operazioni iniziali
006900120103       exsr RoutInz;
007000120103
007100120103       //?Elabora
007200120103       exsr Elabora;
007300120103
007400120103       //?Operazioni finali
007500120103       exsr RoutEnd;
007600120103
007700120103       //--------------------------------------------------------------
007800120103       //?Operazioni iniziali.
007900120103       //--------------------------------------------------------------
008000120103       BEGSR RoutInz;
008100120103
008200120103       ENDSR;
008300120103
008400120103       //--------------------------------------------------------------
008500120103       //?Elabora.
008600120103       //--------------------------------------------------------------
008700120103       BEGSR Elabora;
008800120103
008900120103         exec sql
009000120103          declare ORM cursor for
009100120103          select * from FNORM00F
009200120103          where ORMnsr > 0 and ORMdao between :wData1 and :wData2
009300120103          order by ORMpoe, ORMnsr, ORMnor, ORMnrv;
009400120103
009500120103         exec sql
009600120103           open ORM;
009700120103           IF sqlcode < 0;
009800120103             wFine = *on;
009900120103           ENDIF;
010000120103
010100120103         DOW  not wFine;
010200120103           exec sql
010300120103             fetch next from ORM into :FNORM00F;
010400120103             IF sqlcod = 100 or sqlcod < 0;
010500120103               wFine = *on;
010600120103               leave;
010700120103             ENDIF;
010800120103             exsr Fase;
010900120103             IF  wRiaperto;
011000120103               write WFNORM;
011100120103             ENDIF;
011200120103         ENDDO;
011300120103
011400120103         exec sql close ORM;
011500120103
011600120103       ENDSR;
011700120103
011800120103       //--------------------------------------------------------------
011900120103       //?Controllo le fasi.
012000120103       //--------------------------------------------------------------
012100120103       BEGSR Fase;
012200120103
012300120103         wChiuso  = *off;
012400120103         wRiaperto = *off;
012500120103
012600120103         setll (ORMpoe:ORMnsr:ORMnor:ORMnrv) FNORF01L;
012700120103         reade (ORMpoe:ORMnsr:ORMnor:ORMnrv) FNORF01L;
012800120103         DOW  not %eof;
012900120103           reade (ORMpoe:ORMnsr:ORMnor:ORMnrv) FNORF01L;
013000120103           IF  ORFfar > 900;
013100120103             wChiuso = *on;
013200120103           ENDIF;
013300120103           IF  wChiuso and ORFfar = 100;
013400120103             wRiaperto = *on;
013500120103           ENDIF;
013600120103         ENDDO;
013700120103
013800120103       ENDSR;
013900120103
014000120103       //--------------------------------------------------------------
014100120103       //?Operazioni finali.
014200120103       //--------------------------------------------------------------
014300120103       BEGSR RoutEnd;
014400120103
014500120103         *inLR = *on;
014600120103         return;
014700120103
014800120103       ENDSR;
014900120103
015000120103      /end-free
