000100120103      //---------------------------------------------------------------
000200120103      //
000300120418      //?              ORM che nascono in fase 100
000400120103      //
000500120103      //---------------------------------------------------------------
000600120103
000700120103     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800120103
000900120103      //---------------------------------------------------------------
001000120103      //?Dichiarazione file.
001100120103      //---------------------------------------------------------------
001200120103
001300120103     ffnorf01l  if   e           k disk
001400120418     fwfnorm    o    e             disk    rename(wfnorm:wfnorm0)
001500120418     f                                     prefix(w)
001600120103
001700120103      //---------------------------------------------------------------
001800120103      //?Definizione costanti.
001900120103      //---------------------------------------------------------------
002000120103
002100120103      //---------------------------------------------------------------
002200120103      //?Definizione schiere.
002300120103      //---------------------------------------------------------------
002400120103
002500120103      //---------------------------------------------------------------
002600120103      //?Definizione aree dati.
002700120103      //---------------------------------------------------------------
002800120103
002900120103      //---------------------------------------------------------------
003000120103      //?Definizione strutture dati.
003100120103      //---------------------------------------------------------------
003200120103
003300120103     d FNORM00F      e ds                  extname(FNORM00F)
003400120103
003500120103      //---------------------------------------------------------------
003600120103      //?Definizione variabili globali.
003700120103      //---------------------------------------------------------------
003800120103      // - Flags booleani
003900120103     d wFine           s               n   inz(*off)
004000120418     d w100            s               n   inz(*off)
004100120103
004200120103      // - Campi di comodo
004300120418     d wData1          s              8  0 inz(20120402)
004400120418     d wData2          s              8  0 inz(20120406)
004500120103
004600120103      //---------------------------------------------------------------
004700120103      //?Definizione procedure esterne.
004800120103      //---------------------------------------------------------------
004900120103
005000120103      //---------------------------------------------------------------
005100120103      //?Definizione prototipi.
005200120103      //---------------------------------------------------------------
005300120103
005400120103      //---------------------------------------------------------------
005500120103      //?Definizione key-list.
005600120103      //---------------------------------------------------------------
005700120103
005800120103      //---------------------------------------------------------------
005900120103      //?Riepilogo indicatori.
006000120103      //---------------------------------------------------------------
006100120103
006200120103      //---------------------------------------------------------------
006300120103      //?M A I N - L I N E
006400120103      //---------------------------------------------------------------
006500120103
006600120103      /free
006700120103
006800120103       //?Operazioni iniziali
006900120103       exsr RoutInz;
007000120103
007100120103       //?Elabora
007200120103       exsr Elabora;
007300120103
007400120103       //?Operazioni finali
007500120103       exsr RoutEnd;
007600120103
007700120103       //--------------------------------------------------------------
007800120103       //?Operazioni iniziali.
007900120103       //--------------------------------------------------------------
008000120103       BEGSR RoutInz;
008100120103
008200120103       ENDSR;
008300120103
008400120103       //--------------------------------------------------------------
008500120103       //?Elabora.
008600120103       //--------------------------------------------------------------
008700120103       BEGSR Elabora;
008800120103
008900120103         exec sql
009000120103          declare ORM cursor for
009100120103          select * from FNORM00F
009200120418          where ORMdar between :wData1 and :wData2
009300120103          order by ORMpoe, ORMnsr, ORMnor, ORMnrv;
009400120103
009500120103         exec sql
009600120103           open ORM;
009700120103           IF sqlcode < 0;
009800120103             wFine = *on;
009900120103           ENDIF;
010000120103
010100120103         DOW  not wFine;
010200120103           exec sql
010300120103             fetch next from ORM into :FNORM00F;
010400120103             IF sqlcod = 100 or sqlcod < 0;
010500120103               wFine = *on;
010600120103               leave;
010700120103             ENDIF;
010800120418             exsr wrtFile;
010900120103         ENDDO;
011000120103
011100120103         exec sql close ORM;
011200120103
011300120103       ENDSR;
011400120103
011500120103       //--------------------------------------------------------------
011600120418       //?Scrivo il file di work se ORM nasce in fas 100
011700120103       //--------------------------------------------------------------
011800120418       BEGSR wrtFile;
011900120418
012000120418         clear wfnorm0;
012100120103
012200120418         chain (ORMpoe:ORMnsr:ORMnor:ORMnrv) FNORF01L;
012300120418         IF  %found(FNORF01L) and ORFfar = 100;
012400120418           wORMpoe = ORMpoe;
012500120418           wORMnsr = ORMnsr;
012600120418           wORMnor = ORMnor;
012700120418           wORMnrv = ORMnrv;
012800120418           wORMtor = ORMtor;
012900120418           wORMtco = ORMtco;
013000120418           wORMfao = ORMfao;
013100120418           wORMdar = ORMdar;
013200120418           wORMpor = ORMpor;
013300120418           chain (ORMpoe:ORMnsr:ORMnor:ORMnrv:ORMdfo:ORMofo:ORMfao) FNORF01L;
013400120418           IF  %found(FNORF01L);
013500120418             wORFcar = ORFcar;
013600120418           ENDIF;
013700120418           write WFNORM0;
013800120418         ENDIF;
013900120103
014000120103       ENDSR;
014100120103
014200120103       //--------------------------------------------------------------
014300120103       //?Operazioni finali.
014400120103       //--------------------------------------------------------------
014500120103       BEGSR RoutEnd;
014600120103
014700120103         *inLR = *on;
014800120103         return;
014900120103
015000120103       ENDSR;
015100120103
015200120103      /end-free
