000100120103      //---------------------------------------------------------------
000200120103      //
000300120906      //?              ORM con POR variato in base al peso
000400120103      //
000500120103      //---------------------------------------------------------------
000600120103
000700120103     h Decedit('0,') Datedit(*ymd.) Option(*nodebugio)
000800120103
000900120103      //---------------------------------------------------------------
001000120103      //?Dichiarazione file.
001100120103      //---------------------------------------------------------------
001200120103
001300120906     fAzorg01l  if   e           k disk
001400120906     fPrtf198   o    f  198        Printer Oflind(*InOf)
001500120906
001600120103      //---------------------------------------------------------------
001700120103      //?Definizione costanti.
001800120103      //---------------------------------------------------------------
001900120103
002000120103      //---------------------------------------------------------------
002100120103      //?Definizione schiere.
002200120103      //---------------------------------------------------------------
002300120103
002400120103      //---------------------------------------------------------------
002500120103      //?Definizione aree dati.
002600120103      //---------------------------------------------------------------
002700120103
002800120103      //---------------------------------------------------------------
002900120103      //?Definizione strutture dati.
003000120103      //---------------------------------------------------------------
003100120103
003200120906     d og143         e ds
003300120906     d TISI95DS      e ds
003400120906     d FNORM00F      e ds                  extname(FNORM00F)
003500120103
003600120103      //---------------------------------------------------------------
003700120103      //?Definizione variabili globali.
003800120103      //---------------------------------------------------------------
003900120103      // - Flags booleani
004000120103     d wFine           s               n   inz(*off)
004100120103
004200120103      // - Campi di comodo
004300120906     d Conta           s              9  0
004400120906     d TotOrm          s              9  0
004500120906     d wData1          s              8  0 inz(20120701)
004600120906     d wData2          s              8  0 inz(20120731)
004700120103
004800120103      //---------------------------------------------------------------
004900120103      //?Definizione procedure esterne.
005000120103      //---------------------------------------------------------------
005100120906
005200120906     d tisi95r         pr                  extpgm('TISI95R')
005300120906     d  tisi95ds                           liKEDS(tisi95ds)
005400120103
005500120103      //---------------------------------------------------------------
005600120103      //?Definizione prototipi.
005700120103      //---------------------------------------------------------------
005800120103
005900120103      //---------------------------------------------------------------
006000120103      //?Definizione key-list.
006100120103      //---------------------------------------------------------------
006200120103
006300120103      //---------------------------------------------------------------
006400120103      //?Riepilogo indicatori.
006500120103      //---------------------------------------------------------------
006600120103
006700120103      //---------------------------------------------------------------
006800120103      //?M A I N - L I N E
006900120103      //---------------------------------------------------------------
007000120103
007100120103      /free
007200120103
007300120103       //?Operazioni iniziali
007400120103       exsr RoutInz;
007500120103
007600120103       //?Elabora
007700120103       exsr Elabora;
007800120103
007900120103       //?Operazioni finali
008000120103       exsr RoutEnd;
008100120103
008200120103       //--------------------------------------------------------------
008300120103       //?Operazioni iniziali.
008400120103       //--------------------------------------------------------------
008500120103       BEGSR RoutInz;
008600120906
008700120906         clear conta;
008800120906         clear totorm;
008900120103
009000120103       ENDSR;
009100120103
009200120103       //--------------------------------------------------------------
009300120103       //?Elabora.
009400120103       //--------------------------------------------------------------
009500120103       BEGSR Elabora;
009600120103
009700120103         exec sql
009800120103          declare ORM cursor for
009900120906          select * from FNORM00F
010000120418          where ORMdar between :wData1 and :wData2
010100120103          order by ORMpoe, ORMnsr, ORMnor, ORMnrv;
010200120103
010300120103         exec sql
010400120103           open ORM;
010500120103           IF sqlcode < 0;
010600120103             wFine = *on;
010700120103           ENDIF;
010800120103
010900120103         DOW  not wFine;
011000120103           exec sql
011100120906             fetch next from ORM into :FNORM00F;
011200120103             IF sqlcod = 100 or sqlcod < 0;
011300120103               wFine = *on;
011400120103               leave;
011500120103             ENDIF;
011600120906
011700120906             clear OG143;
011800120906             chain (ormpor) azorg01l;
011900120906             IF  %found(azorg01l);
012000120906               OG143 = orgde3;
012100120906             ENDIF;
012200120906
012300120906             totorm += 1;
012400120906
012500120906             exsr ctrPOR;
012600120906
012700120103         ENDDO;
012800120103
012900120103         exec sql close ORM;
013000120906
013100120906         except Stampa;
013200120103
013300120103       ENDSR;
013400120103
013500120103       //--------------------------------------------------------------
013600120906       //?Controllo se cambia il POR con peso/volume
013700120103       //--------------------------------------------------------------
013800120906       BEGSR ctrPOR;
013900120418
014000120906         clear tisi95ds;
014100120906         I95tcn = '7';
014200120906         I95cap = ORMcar;
014300120906         I95nar = ORMnar;
014400120906         I95ind = ORMinr;
014500120906         I95loc = ORMlor;
014600120906         I95prv = ORMprr;
014700120906         I95lkg = ORMpkg;
014800120906         I95lmc = ORMvlm;
014900120906         IF  §ogntw = 'DPD';
015000120906           I95fi1 = 'D';
015100120906         ENDIF;
015200120906         IF  §ogntw = 'FED';
015300120906           I95fi1 = 'S';
015400120906         ENDIF;
015500120906
015600120906         tisi95r (tisi95ds);
015700120906
015800120906       //?se la lna che torna dal tisi è <> dal por conto
015900120906         IF  O95lna <> ORMpor;
016000120906           conta += 1;
016100120906         ENDIF;
016200120103
016300120103       ENDSR;
016400120103
016500120103       //--------------------------------------------------------------
016600120103       //?Operazioni finali.
016700120103       //--------------------------------------------------------------
016800120103       BEGSR RoutEnd;
016900120103
017000120103         *inLR = *on;
017100120103         return;
017200120103
017300120103       ENDSR;
017400120103
017500120103      /end-free
017600120906
017700120906     oPrtf198   e            Stampa         2 02
017800120906     o                                           21 'ORM con instradamento'
017900120906     o                                         +  1 'diverso da filiale ritiro'
018000120906     o                                         +  1 'nel mese di luglio 2012:'
018100120906     o                       conta         z   +  1
018200120906     o                                         +  1 'su un totale ORM:'
018300120906     o                       totorm        z   +  1
