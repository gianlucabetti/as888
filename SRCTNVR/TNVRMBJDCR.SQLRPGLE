000100121012      //--------------------------------------------------------------
000200121012      //?MBJDC - Spot per scrittura immagini con MERGE
000300121012      //--------------------------------------------------------------
000400121012
000500121012     h decedit('0,') datedit(*ymd/) option(*nodebugio)
000600121012
000700121012      //---------------------------------------------------------------
000800121012      //?Dichiarazione file.
000900121012      //---------------------------------------------------------------
001000121012
001100121012       // -?File Bolle
001200121012     fFIAR531C  if   e           k disk
001300121012
001400121012       // -?File per Elaborazione immagini
001500121015     fTIJDC00F  O    e             disk    prefix(JDC:3)
001600121012     fTILAC00F  O    e             disk
001700040119
001800121012      //---------------------------------------------------------------
001900121012      //?Definizione costanti.
002000121012      //---------------------------------------------------------------
002100121012
002200121012      //---------------------------------------------------------------
002300121012      //?Definizione schiere.
002400121012      //---------------------------------------------------------------
002500121012
002600121012      //---------------------------------------------------------------
002700121012      //?Definizione aree dati.
002800121012      //---------------------------------------------------------------
002900121012
003000121012      //---------------------------------------------------------------
003100121012      //?Definizione strutture dati.
003200121012      //---------------------------------------------------------------
003300121015
003400121015       // -?KPJBA
003500121015     d kpjba         e ds
003600050330
003700121012       // -?RCD DOC - FIAR500F
003800120604     d dAR5doc       e ds                  inz
003900121012
004000121012       // -?File TITAS00F
004100121012     d TITASds       e ds                  extname(TITAS00F)
004200121015
004300121015       // -?Ds pgm - TRUL55R
004400121015     d TRUL55DS      e ds
004500121012
004600121012      //---------------------------------------------------------------
004700121012      //?Definizione variabili globali.
004800121012      //---------------------------------------------------------------
004900121012
005000121012       // -?Flags booleani
005100121012     d wEoF            s               n   inz(*off)
005200121012
005300121012       // -?Campi di comodo contatori
005400121012     d nrBOLLE         s              5s 0
005500121012
005600121012       // -?Campi di comodo
005700090212
005800121012      //--------------------------------------------------------------
005900121012      //?Definizione procedure usate.                                 ?
006000121012      //--------------------------------------------------------------
006100121015
006200121015       // -?Determinazione nome dell'immagine per TILAC
006300121015     d trul55r         pr                  extpgm('TRUL55R')
006400121015     d  trul55ds                           likeds(TRUL55DS)
006500121012
006600121012      //---------------------------------------------------------------
006700121012      //?Definizione prototipi.
006800121012      //---------------------------------------------------------------
006900090218
007000121012      //--------------------------------------------------------------
007100121012      //?Definizione key-list.                                        ?
007200121012      //--------------------------------------------------------------
007300121012
007400121012      //---------------------------------------------------------------
007500121012      //?Riepilogo indicatori.
007600121012      //---------------------------------------------------------------
007700121012
007800121012      //---------------------------------------------------------------
007900121012
008000121012      //---------------------------------------------------------------
008100121012      //?M A I N - L I N E
008200121012      //---------------------------------------------------------------
008300121012
008400121012     c     *entry        plist
008500121012     c                   parm                    KPJBA
008600121012
008700121012      /free
008800121012
008900121012       // Operazioni iniziali
009000121012       exsr RoutInz;
009100121012
009200121012       // Elabora
009300121012       exsr Elabora;
009400121012
009500121012       // Operazioni finali
009600121012       exsr RoutEnd;
009700121012
009800121012       //--------------------------------------------------------------
009900121012       //?Operazioni iniziali.
010000121012       //--------------------------------------------------------------
010100121012       BEGSR RoutInz;
010200121015
010300121015         clear nrBOLLE;
010400121012
010500121012         exec sql set option dynusrprf = *owner, closqlcsr = *endmod;
010600121012
010700121012       ENDSR;
010800121012
010900121012       //--------------------------------------------------------------
011000121012       //?Elabora le bolle.
011100121012       //--------------------------------------------------------------
011200121012       BEGSR Elabora;
011300121012
011400121012       //?Leggo le bolle del cliente mittente 2552057 dal primo di ottobre 2012
011500121012         exec sql
011600121012          DECLARE TAS255 cursor for
011700121012          SELECT * from TITAS00F
011800121015          WHERE TASccm in(2552057, 2552080) and TASaas = 2012 and
011900121012                TASmgs >= 1001;
012000121012
012100121012         exec sql
012200121012           open TAS255;
012300121012
012400121012         IF sqlcode < 0;
012500121012           wEoF = *on;
012600121012           leavesr;
012700121012         ENDIF;
012800121012
012900121012         DOW  not wEoF;
013000121012
013100121012           exec sql fetch next from TAS255 into :TITASds;
013200121012           IF  sqlcod = 100 or sqlcod < 0;
013300121012             wEoF = *on;
013400121012             leave;
013500121012           ENDIF;
013600121015
013700121015         //?Se ho già scritto 1000 bolle esco
013800121015           IF  nrBOLLE >= 1000;
013900121015             leave;
014000121015           ENDIF;
014100121012
014200121015         //?Aggancio FIAR5
014300121015           AR5trd = 'DOC';
014400121015           chain (TASaas:TASlnp:TASnrs:TASnsp:AR5trd) FIAR531C;
014500121015           IF  %found(FIAR531C);
014600121015             dAR5doc = AR5uni;
014700121015             IF  §AR5Jfid <> *blanks;
014800121015               exsr Scrivi;
014900121015               nrBOLLE += 1;
015000121015             ENDIF;
015100121015           ENDIF;
015200121012
015300121012         ENDDO;
015400121012
015500121012         exec sql close TAS255;
015600121012         wEoF = *off;
015700121012
015800121012       ENDSR;
015900121015
016000121015       //--------------------------------------------------------------
016100121015       //?Scrivo i 2 file.
016200121015       //--------------------------------------------------------------
016300121015       BEGSR Scrivi;
016400121015
016500121015       //?TILAC00F
016600121015         clear TILAC000;
016700121015
016800121015         %subst(LACtim:1:8) = %editc(%dec(%date()):'X');
016900121015         %subst(LACtim:9:6) = %editc(%dec(%time()):'X');
017000121015         LACaas = %subst(%editc(TASaas:'X'):3:2);
017100121015         LAClnp = %editc(TASlnp:'X');
017200121015         LACnrs = %editc(TASnrs:'X');
017300121015         LACnsp = %editc(TASnsp:'X');
017400121015         LACcop = 'CLI';
017500121015         LACdir = '1020001/PF';
017600121015         LACtpi = 'PDF';
017700121015
017800121015         clear  TRUL55ds;
017900121015         I55fmi = 'NS';
018000121015         I55lnp = TASlnp;
018100121015         I55nrs = TASnrs;
018200121015         I55nsp = TASnsp;
018300121015         I55aas = TASaas;
018400121015         I55mgs = TASmgs;
018500121015         I55rmn = TASrmn;
018600121015         trul55r (TRUL55DS);
018700121015         IF  O55err = *off;
018800121015           LACnim = O55nim;
018900121015         ENDIF;
019000121015
019100121015         LACela = '00';
019200121015         LACtela = 'T';
019300121015         LACksc = TASccm;
019400121015         LACtad = 'N';
019500121015         LACidjob = 'Test';
019600121015
019700121015         WRITE  TILAC000;
019800121015
019900121015       //?TIJDC00F
020000121015         clear TIJDC000;
020100121015
020200121015         JDCtim = LACtim;
020300121015         JDCaas = LACaas;
020400121015         JDClnp = LAClnp;
020500121015         JDCnrs = LACnrs;
020600121015         JDCnsp = LACnsp;
020700121015         JDCcop = 'CL1';
020800121015         JDCdir = '1020001/DF';
020900121015         JDCtpi = LACtpi;
021000121015         JDCnim = LACnim;
021100121015         JDCela = '00';
021200121015         JDCtela = LACtela;
021300121015         JDCksc = LACksc;
021400121015         JDCtad = LACtad;
021500121015         JDCidjob = LACidjob;
021600121015
021700121015         WRITE  TIJDC000;
021800121015
021900121015       ENDSR;
022000121012
022100121012       //--------------------------------------------------------------
022200121012       //?Operazioni finali.
022300121012       //--------------------------------------------------------------
022400121012       BEGSR RoutEnd;
022500121012
022600121012         *inLR = *on;
022700121012         return;
022800121012
022900121012       ENDSR;
023000121012
023100121012      /end-free
