000100051118      *---------------------------------------------------------------*
000200051121      *? Cancellazione note clienti "doppie"                         ?*
000300051118      *---------------------------------------------------------------*
000400051118      *
000500051118     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600051118      *
000700051118      *?A R C H I V I?------------------------------------------------*
000800051118      *
000900051118     fTNVRNTC1D cf   e             workstn
001000051118      *
001100051118      *?C O S T A N T I?----------------------------------------------*
001200051118      *
001300051118      *
001400051118      *?S C H I E R E?------------------------------------------------*
001500051118      *
001600051125     d $Msg            s             78    dim(2) ctdata perrcd(1)
001700051118      *
001800051118      *?S T R U T T U R E   D A T I?----------------------------------*
001900051118      *
002000051118     d Tibs34ds      e ds
002100051118     d Azuteds       e ds                  extname(AZUTE00F)
002200051118     d dDatiUte      e ds
002300051118      *
002400051118     d KPJBA         e ds
002500051118      *
002600051118     d Status         sds
002700051118     d  SDSpgm           *proc
002800051118     d  SDSprm           *parms
002900051118      *
003000051118     d TNVRNTC2ds      ds                  inz
003100051118     d   V1Cprt                            inz
003200051118     d   V1Cdlt                            inz
003300051118      *
003400051118      *?V A R I A B I L I?--------------------------------------------*
003500051118      *
003600051118      * - Flags booleani
003700051118     d $Fine           s              1    inz(*off)
003800051118      *
003900051118      *?I N D I C A T O R I?------------------------------------------*
004000051118      *
004100051118      *  28 - Visualizzazione V1DMSG
004200051121      *  50 - ERRORE: Effettuare ALMENO una selezione
004300051118      *  90 - Generico di errore
004400051118      *
004500051118      *===============================================================*
004600051118      *
004700051118     c     *Entry        plist
004800051118     c                   parm                    KPJBA
004900051118      *
005000051118      *?Inizializzazione videata D1?
005100051118     c                   exsr      sr_InzD1
005200051118      *
005300051118do  1c                   DOU       $Fine  = *on
005400051118      *
005500051118      *?Emissione testata e riga tasti funzionali abilitati?
005600051118if  2c                   if        NOT *in90
005700051118      * - emissione testata (x rstdsp *no)
005800051118     c                   write     tnvrNTCt1
005900051118      * - emissione piede
006000051118     c                   write     tnvrNTCz1
006100051118e   2c                   endif
006200051118      *
006300051118      *?Emissione videata?
006400051118     c                   exfmt     tnvrNTCd1
006500051118     c                   setoff                                       28  90
006600051118     c                   clear                   V1Dmsg
006700051118      *
006800051118sel 2c                   select
006900051118      *
007000051118      *?F3=Fine?
007100051118w   2c                   when      *inKC
007200051118     c                   eval      $Fine  = *on
007300051118      *
007400051118      *?Controllo dati immessi a video?
007500051118x   2c                   other
007600051118     c                   exsr      sr_CtrD1
007700051118sel 3c                   select
007800051118      * Rilevati errori
007900051118w   3c                   when      *in90  = *on
008000051118      *?F6=Esegue?
008100051118w   3c                   when      *inKF  = *on
008200051118     c                   exsr      Sbm_Job
008300051118     c                   eval      $Fine  = *on
008400051118e   3c                   endsl
008500051118      *
008600051118e   2c                   endsl
008700051118      *
008800051118e   1c                   ENDDO
008900051118      *
009000051118      *?Fine?
009100051118     c                   eval      *inLR  = *on
009200051118      *
009300051118      *?S U B R O U T I N E S?----------------------------------------*
009400051118      *
009500051118      *---------------------------------------------------------------*
009600051118      *?Routine Iniziale                                             ?*
009700051118      *---------------------------------------------------------------*
009800051118     c     *InzSR        BegSR
009900051118      *
010000051118      * Reperisco dati job
010100051118     c                   exsr      DatiJob
010200051118      *
010300051118     c                   movel     SDSpgm        VTCpgm
010400051118      *
010500051118     c                   EndSr
010600051118      *
010700051118      *---------------------------------------------------------------*
010800051118      *?Reperimento Dati del job (Utente/Operativi)                  ?*
010900051118      *---------------------------------------------------------------*
011000051118     c     DatiJob       BegSr
011100051118      *
011200051118     c     *dtaara       define    §azute        azuteds
011300051118     c     *dtaara       define    §datiute      ddatiute
011400051118      *
011500051118     c                   in(E)     *dtaara
011600051118     c                   IF        %ERROR or RSUT = *blanks
011700051118     c                   clear                   Tibs34Ds
011800051118     c                   call      'TIBS34R'
011900051118     c                   parm                    Tibs34Ds
012000051118     c                   in        *dtaara
012100051118     c                   ENDIF
012200051118      *
012300051118     c                   EndSr
012400051118      *
012500051118      *---------------------------------------------------------------*
012600051118      *?Inizializzazione videata D1                                  ?*
012700051118      *---------------------------------------------------------------*
012800051118     c     sr_InzD1      BEGSR
012900051118      *
013000051125     c                   eval      V1Cprt = 1
013100051118     c                   eval      V1Cdlt = 'N'
013200051118      *
013300051118     c                   ENDSR
013400051118      *
013500051118      *---------------------------------------------------------------*
013600051118      *?Controllo dati in videata D1                                 ?*
013700051118      *---------------------------------------------------------------*
013800051118     c     sr_CtrD1      BEGSR
013900051118      *
014000051121     c                   movea     *zeros        *in(50)
014100051121      *
014200051125     c                   if            V1Cprt = *zeros
014300051121     c                             and V1Cdlt = 'N'
014400051121     c                   seton                                        502890
014500051121     c                   eval      V1Dmsg = $Msg(1)
014600051121     c                   leavesr
014700051121     c                   endif
014800051125      *
014900051125     c                   if            V1Cprt > 1
015000051125     c                             and V1Cdlt = 'S'
015100051125     c                   seton                                        502890
015200051125     c                   eval      V1Dmsg = $Msg(2)
015300051125     c                   leavesr
015400051125     c                   endif
015500051118      *
015600051118     c                   ENDSR
015700051118      *
015800051118      *---------------------------------------------------------------*
015900051118      *?Sbm_Job * Sottomissione lavoro batch                         ?*
016000051118      *---------------------------------------------------------------*
016100051118     c     Sbm_Job       BEGSR
016200051118      *
016300051118     c                   eval      kcoaz  = 'VRN2'
016400051118     c                   movel(p)  TNVRNTC2ds    KPJBU
016500051118      *
016600051124     c***                movel(p)  'TNVRNTC2R'   Wpgm             10
016700051124     c                   movel(p)  'BCH10'       Wpgm             10
016800051118     c                   call      Wpgm
016900051118     c                   parm                    KPJBA
017000051118      *
017100051118     c                   ENDSR
017200051125
017300051125** - $Msg
017400051125Selezionare una stampa e/o la cancellazione
017500051125Cancellazione NON abbinabile alle stampe "2", "3" e "4"
