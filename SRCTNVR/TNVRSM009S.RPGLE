000100110224       //==============================================================
000200110224       //?TNVRSM009S - Lista records eliminabili in tabella "AR8".     ?
000300110224       //==============================================================
000400110224
000500110224       //--------------------------------------------------------------
000600110224       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700110224       //--------------------------------------------------------------
000800110224
000900110224     /*PRM  dbgview(*source)
001000110224     /*END
001100110224
001200110224       //--------------------------------------------------------------
001300110224       //?Specifiche di controllo.                                     ?
001400110224       //--------------------------------------------------------------
001500110224
001600110224     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700110224     h dftactgrp(*no)
001800110224     h bnddir('UBBNDDIR')
001900110224
002000110224       //--------------------------------------------------------------
002100110224       //?Dichiarazione file.                                          ?
002200110224       //--------------------------------------------------------------
002300110224
002400110224
002500110224       // -?Tabella "AR8"?
002600110224     fTNTBE01L  if   e           k disk
002700110224
002800110224       // -?Printer File?
002900110224     fQSYSPRT   o    f  132        printer usropn oflind(*inOF)
003000110224
003100110224       //--------------------------------------------------------------
003200110224       //?Definizione costanti.                                        ?
003300110224       //--------------------------------------------------------------
003400110224
003500110224     d c_OvrPrtF       c                   const('OVRPRTF +
003600110224     d                                            file(QSYSPRT) +
003700110224     d                                            pagesize(66 132 *rowcol) +
003800110224     d                                            lpi(6) cpi(10) +
003900110224     d                                            usrdta(''t.AR8 elim'')')
004000110224     d c_DltOvr        c                   const('DLTOVR +
004100110224     d                                            file(QSYSPRT)')
004200110224
004300110224       //--------------------------------------------------------------
004400110224       //?Definizione schiere.                                         ?
004500110224       //--------------------------------------------------------------
004600110224
004700110224
004800110224       //--------------------------------------------------------------
004900110224       //?Definizione aree dati.                                       ?
005000110224       //--------------------------------------------------------------
005100110224
005200110224
005300110224       //--------------------------------------------------------------
005400110224       //?Definizione strutture dati.                                  ?
005500110224       //--------------------------------------------------------------
005600110224
005700110224       // -?Tab. "AR8" = Tipi Modulo DDT x file FIAR8?
005800110224     d dAR8          e ds                  inz
005900110224
006000110224       // -?Status?
006100110224     d Status         sds
006200130328     d   SDSpgm          *proc
006300130328     d   SDSusr              254    263
006400110224
006500110224       //--------------------------------------------------------------
006600110224       //?Definizione variabili globali.                               ?
006700110224       //--------------------------------------------------------------
006800110224
006900110224       // -?Orario?
007000110224     d w_Time          s             10    inz
007100110224
007200110224       // -?Campi di stampa?
007300110224     d w_Logo          s              4    inz
007400110224     d w_Note          s             30    inz
007500110224     d w_TypeErr       s              1  0 inz
007600110224     d w_TotLog        s              5  0 inz
007700110224
007800110224       //--------------------------------------------------------------
007900110224       //?Definizione procedure usate.                                 ?
008000110224       //--------------------------------------------------------------
008100110224
008200110224       // -?Parametri API QUSROBJD (Retrieve Object Description)?
008300110224      /copy qSysInc/qRpgleSrc,QUSROBJD
008400110224      /copy GaiTraSrc/srcProtoPr,QUSROBJD
008500110224
008600110224       // -?Parametri API QCAPCMD (Process Commands)?
008700110224     d Qcmd            s           1024    inz  varying
008800110224      /copy qSysInc/qRpgleSrc,QCAPCMD
008900110224      /copy gaitrasrc/srcProtoPR,QCAPCMD
009000110224
009100110224       // -?Parametri gestione errori API.?
009200110224      /copy qSysInc/qRpgleSrc,QUSEC
009300110224
009400110224       //--------------------------------------------------------------
009500110224       //?Definizione key-list.                                        ?
009600110224       //--------------------------------------------------------------
009700110224
009800110224       // -?File TNTBE01L?
009900110224     d k05tntbe01    e ds                  extname(TNTBE01L : *key)
010000110224     d                                     prefix(k_)   inz
010100110224
010200110224       //--------------------------------------------------------------
010300110224       //?Riepilogo indicatori.                                        ?
010400110224       //--------------------------------------------------------------
010500110224
010600110224
010700110224       //--------------------------------------------------------------
010800110224       //?M A I N - L I N E                                            ?
010900110224       //--------------------------------------------------------------
011000110224
011100110224      /free
011200110224
011300110224       // -?Operazioni iniziali?
011400110224       exsr  sr_RoutInz;
011500110224
011600110224       // -?Estrazione loghi non più esistnti?
011700110224       DoW  Not %eof(TNTBE01L);
011800110224         exsr  sr_CheckLogo;
011900110224       EndDo;
012000110224
012100110224       // -?Operazioni finali?
012200110224       exsr  sr_RoutEnd;
012300110224
012400110224       //--------------------------------------------------------------
012500110224       //?Operazioni iniziali.                                         ?
012600110224       //--------------------------------------------------------------
012700110224       BEGSR sr_RoutInz;
012800110224
012900110224         *inLR = *on;
013000110224
013100110224         // -?Posizionamento & 1ª lettura della tab. "AR8" in TNTBE01L?
013200110224         k_TBEcod = 'AR8';
013300110224         setll  %kds( k05tntbe01 )  TNTBE000;
013400110224
013500110224         DoU  %eof(TNTBE01L)  or  TBEatb = *blank;
013600110224           reade  %kds( k05tntbe01 : 1 )  TNTBE000;
013700110224         EndDo;
013800110224
013900110224       ENDSR;
014000110224
014100110224       //--------------------------------------------------------------
014200110224       //?Verifica esistenza logo in input da tab. "AR8"  e            ?
014300110224       //?Lettura record successivo in tab. "AR8".                     ?
014400110224       //--------------------------------------------------------------
014500110224       BEGSR  sr_CheckLogo;
014600110224
014700110224         dAR8 = TBEuni;
014800110224         clear  w_TypeErr;
014900130328
015000130328         If  §AR8tsd <> '§§';
015100110224
015200130328           // -?Verifica esistenza oggetto?
015300130328           clear QUSD0100;
015400130328           clear QUSEC;
015500130328           Qusbprv = %size(Qusec);
015600130328           RetrieveObjectDescription( QUSD0100 :
015700130328                                      %len(QUSD0100) :
015800130328                                      'OBJD0100' :
015900130328                                      'LOGO' + %subst( TBEke1 : 1 : 4 )
016000130328                                             + '  GAITRAOBJ ':
016100130328                                      '*PAGSEG' :
016200130328                                      qUsec );
016300130328
016400130328           // -?Fallito il reperimento dati:?
016500130328           //  ?stampa segnalazione logo?
016600130328           If  qUsei <> *blank;
016700130328             w_TypeErr = 1;
016800130328             exsr  sr_Stampa;
016900130328           EndIf;
017000130328
017100130328         EndIf;
017200110224
017300110224         // -Vecchio logo cliente della LOGISTICA?
017400110224         //  (per la fattura in FIAR8)?
017500110224         IF  §AR8logoF <> *blank;
017600110224
017700110224           // -?Verifica esistenza oggetto?
017800110224           clear QUSD0100;
017900110224           clear QUSEC;
018000110224           Qusbprv = %size(Qusec);
018100110224           RetrieveObjectDescription( QUSD0100 :
018200110224                                      %len(QUSD0100) :
018300110224                                      'OBJD0100' :
018400110224                                      'LOGO' + %trimr( TBEke1 )
018500110224                                             + '  GAITRAOBJ ':
018600110224                                      '*PAGSEG' :
018700110224                                      qUsec );
018800110224
018900110224           // -?Fallito il reperimento dati:?
019000110224           //  ?stampa segnalazione logo?
019100110224           If  qUsei <> *blank;
019200110224             w_TypeErr = 2;
019300110224             exsr  sr_Stampa;
019400110224           EndIf;
019500110224
019600110224         ENDIF;
019700110224
019800110224         // -?Lettura logo successivo in tab. "AR8"?
019900110224         DoU  %eof(TNTBE01L)  or  TBEatb = *blank;
020000110224           reade  %kds( k05tntbe01 : 1 )  TNTBE000;
020100110224         EndDo;
020200110224
020300110224       ENDSR;
020400110224
020500110224       //--------------------------------------------------------------
020600110224       //?Stampa segnalazione segmento di pagina.                      ?
020700110224       //--------------------------------------------------------------
020800110224       BEGSR  sr_Stampa;
020900110224
021000110224         // -?Impostazione campi in output?
021100110224         w_Logo = TBEke1;
021200110224         clear  w_Note;
021300110224         select;
021400110224           when  w_TypeErr = 1;
021500110224             w_Note = 'Logo inesistente in GAITRAOBJ.';
021600110224           when  w_TypeErr = 2;
021700110224             w_Note = 'Logo x fattura in DDT Logistica inesistente +
021800110224                       in GAITRAOBJ.';
021900110224         endsl;
022000110224
022100110224         // -?Test OverFlow e stampa testata?
022200110224         exsr  sr_TestOF;
022300110224
022400110224         // -?Stampa riga di dettaglio?
022500110224         except  PRTdet;
022600110224
022700110224         // -?Incremento n° totale loghi?
022800110224         w_TotLog += 1;
022900110224
023000110224       ENDSR;
023100110224
023200110224       //--------------------------------------------------------------
023300110224       //?Test OverFlow in stampa.                                     ?
023400110224       //--------------------------------------------------------------
023500110224       BEGSR  sr_TestOF;
023600110224
023700110224         // -?Apertura file di stampa?
023800110224         if  not %open (QSYSPRT);
023900110224           Qcmd = c_OvrPrtF;
024000110224           exsr  sr_ExecCmd;
024100110224           open  QSYSPRT;
024200110224           *inOF = *on;
024300110224         endif;
024400110224
024500110224         // -?Test OverFlow e stampa testata?
024600110224         if  *inOF;
024700110224           w_Time = %char( %time() );
024800110224           except PRTtxt;
024900110224           *inOF  = *off;
025000110224         endif;
025100110224
025200110224       ENDSR;
025300110224
025400110224       //--------------------------------------------------------------
025500110224       //?Esecuzione del comando (già impostato).                      ?
025600110224       //--------------------------------------------------------------
025700110224       BEGSR  sr_ExecCmd;
025800110224
025900110224         clear Qcap0100;
026000110224         Qcabcsdh = *off;
026100110224         Qcapa    = *off;
026200110224         Qcacmdss = *off;
026300110224         Qcaerved = *allX'00';
026400110224
026500110224         clear Qusec;
026600110224         Qusbprv  = %size(Qusec);
026700110224
026800110224         ProcessCommands ( Qcmd : %size(Qcmd) : Qcap0100 :
026900110224                           %size(Qcap0100) : 'CPOP0100' : *omit :
027000110224                           0 : 0 : Qusec);
027100110224
027200110224         //if  Qusei <> *blank;
027300110224         //  ...;
027400110224         //endif;
027500110224
027600110224       ENDSR;
027700110224
027800110224       //--------------------------------------------------------------
027900110224       //?Operazioni finali.                                           ?
028000110224       //--------------------------------------------------------------
028100110224       BEGSR  sr_RoutEnd;
028200110224
028300110224         // -?Stampa "fine-lista"?
028400110224         exsr  sr_TestOF;
028500110224         except  PRTend;
028600110224
028700110224         // -?Chiusura printer-file?
028800110224         close  QSYSPRT;
028900110224
029000110224         // -?Uscita?
029100110224         return;
029200110224
029300110224       ENDSR;
029400110224
029500110224      /end-free
029600110224
029700110224       //--------------------------------------------------------------
029800110224       //?P R I N T E R - F I L E S                                    ?
029900110224       //--------------------------------------------------------------
030000110224
030100110224     oQSYSPRT   e            PRTtxt            2
030200110224     o                                              'ELENCO LOGHI IN T-
030300110224     o                                              AB."AR8" ANNULLABI-
030400110224     o                                              LI'
030500110224     o                       SDSpgm           +   5
030600110224     o                       SDSusr           +   5
030700110224     o                       *date         y  +   5
030800110224     o                       w_Time           +   5
030900110224     o                                        +   5 'Pag.'
031000110224     o                       Page          z  +   0
031100110224     o          e            PRTtxt      0  0
031200110224     o                                              'ELENCO LOGHI IN T-
031300110224     o                                              AB."AR8" ANNULLABI-
031400110224     o                                              LI'
031500110224     o          e            PRTtxt      2
031600110224     o                                              'Logo'
031700110224     o                                        +   2 'Descrizione      -
031800110224     o                                                           '
031900110224     o                                        +   2 'Note'
032000110224     o          e            PRTtxt      0  0
032100110224     o                                              'Logo'
032200110224     o                                        +   2 'Descrizione      -
032300110224     o                                                           '
032400110224     o                                        +   2 'Note'
032500110224     o          e            PRTtxt      1
032600110224     o                                              '===='
032700110224     o                                        +   2 '=================+
032800110224     o                                               ============='
032900110224     o                                        +   2 '=================+
033000110224     o                                               ============='
033100110224     o          e            PRTtxt      0  1
033200110224     o                                              '===='
033300110224     o                                        +   2 '=================+
033400110224     o                                               ============='
033500110224     o                                        +   2 '=================+
033600110224     o                                               ============='
033700110224      *
033800110224     o          e            PRTdet      1
033900110224     o                       w_Logo
034000110224     o                       §AR8des          +   2
034100110224     o                       w_Note           +   2
034200110224      *
034300110224     o          e            PRTend      2
034400110224     o                                        +   6 '***  Fine Lista  +
034500110224     o                                               ***'
034600110224     o                                        +   3 'Tot. loghi = '
034700110224     o                       w_TotLog      k  +   1
034800110224     o          e            PRTend      0  0
034900110224     o                                        +   6 '***  Fine Lista  +
035000110224     o                                               ***'
