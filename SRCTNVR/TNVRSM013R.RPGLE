000100140718       //==============================================================
000200141002       //?TNVRSM013R - Crea WF x Statistica ALERT.                     ?
000300140718       //==============================================================
000400140718
000500140718       //--------------------------------------------------------------
000600140718       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700140718       //--------------------------------------------------------------
000800140718
000900140718     /*PRM  dbgview(*source)
001000140718     /*CMD  ovrdbf file(TITAS38C) tofile(GAITRAGRPS/TITAS38C) +
001100140718     /*CMD         ovrscope(*calllvl)
001200140718     /*END  dltovr file(TITAS38C) lvl(*)
001300140718     /*END
001400140718
001500140718       //--------------------------------------------------------------
001600140718       //?Specifiche di controllo.                                     ?
001700140718       //--------------------------------------------------------------
001800140718
001900140718     h decedit('0,') datedit(*dmy/) option(*nodebugio)
002000140718
002100140718       //--------------------------------------------------------------
002200140718       //?Dichiarazione file.                                          ?
002300140718       //--------------------------------------------------------------
002400140718
002500140718       // -?Bolle Sede?
002600140721     fTITAS38C  if   e           k disk
002700140718
002800140718       // -?Work-File di output?
002900140721     fWFSMT00F  o    e             disk
003000140718
003100140718       //--------------------------------------------------------------
003200140718       //?Definizione costanti.                                        ?
003300140718       //--------------------------------------------------------------
003400140718
003500140718
003600140718       //--------------------------------------------------------------
003700140718       //?Definizione schiere.                                         ?
003800140718       //--------------------------------------------------------------
003900140718
004000140718
004100140718       //--------------------------------------------------------------
004200140718       //?Definizione aree dati.                                       ?
004300140718       //--------------------------------------------------------------
004400140718
004500140718
004600140718       //--------------------------------------------------------------
004700140718       //?Definizione strutture dati.                                  ?
004800140718       //--------------------------------------------------------------
004900140718
005000140718       // -?Status?
005100140718     d Status         sds
005200140721     d   SDSpgm          *proc
005300140721     d   SDSusr              254    263
005400140718
005500140718     d dTASflo       e ds                  inz  qualified
005600140718
005700140718       //--------------------------------------------------------------
005800140718       //?Definizione variabili globali.                               ?
005900140718       //--------------------------------------------------------------
006000140718
006100140718       // -?Campi di comodo?
006200140718     d wDataIni        s              8  0 inz(20140101)
006300140718     d wDataFin        s              8  0 inz(20140630)
006400140718     d wDate_EUR       s               d   datfmt(*eur)  inz
006500140718
006600140718       //--------------------------------------------------------------
006700140718       //?Definizione procedure usate.                                 ?
006800140718       //--------------------------------------------------------------
006900140718
007000140721
007100140718       //--------------------------------------------------------------
007200140718       //?Definizione key-list.                                        ?
007300140718       //--------------------------------------------------------------
007400140718
007500140718       // -?File TITAS38C?
007600140718     d keyTITAS38    e ds                  extname(TITAS38C : *key)
007700140718     d                                     prefix(k_)
007800140718     d                                     inz
007900140718
008000140718       //--------------------------------------------------------------
008100140718       //?Riepilogo indicatori.                                        ?
008200140718       //--------------------------------------------------------------
008300140718
008400140718
008500140718       //--------------------------------------------------------------
008600140718       //?M A I N - L I N E                                            ?
008700140718       //--------------------------------------------------------------
008800140718
008900140718      /free
009000140718
009100140718       // -?Operazioni iniziali?
009200140718       exsr  sr_RoutInz;
009300140718
009400140718       // -?Estrazione range segnacolli per filiale/serie?
009500140718       DoW  Not %eof(TITAS38C);
009600140718
009700140718         If  TASdbr >= wDataIni  and  TASdbr <= wDataFin;
009800140718
009900140718           dTASflo = TASflo;
010000140718           if  dTASflo.§FLOemd <> *blank;
010100140721             exsr  sr_WriteWFSMT;
010200140718           endif;
010300140718
010400140718         EndIf;
010500140718
010600140718         read  TITAS38C;
010700140718
010800140718       EndDo;
010900140718
011000140718       // -?Operazioni finali?
011100140718       exsr  sr_RoutEnd;
011200140718
011300140718       //--------------------------------------------------------------
011400140718       //?Operazioni iniziali.                                         ?
011500140718       //--------------------------------------------------------------
011600140721       BEGSR  sr_RoutInz;
011700140718
011800140718         *inLR = *on;
011900140718
012000140718         clear  keyTITAS38;
012100140721         k_TASaas = wDataIni / 10000;
012200140721         k_TASmgs = wDataIni - ( k_TASaas * 10000 );
012300140721
012400140721         setll  %kds(keyTITAS38 : 2)  TITAS38C;
012500140721         read   TITAS38C;
012600140721
012700140721       ENDSR;
012800140721
012900140721       //--------------------------------------------------------------
013000140721       //?Registrazione singola spedizione con Avviso x Merce Partita. ?
013100140721       //--------------------------------------------------------------
013200140721       BEGSR  sr_WriteWFSMT;
013300140721
013400140721         // -?Valorizzazione campi?
013500140721         clear  WFSMT000;
013600140721
013700140721         select;
013800140721           when  dTASflo.§FLOemd = 'S';
013900140721             WSMtpInv = 'M';
014000140721           when  dTASflo.§FLOemd = 'X';
014100140721             WSMtpInv = 'S';
014200140721         endsl;
014300140721
014400140721         WSMdbr = TASdbr;
014500140721         WSMksc = TASksc;
014600140721         WSMaas = TASaas;
014700140721         WSMmgs = TASmgs;
014800140721         WSMlnp = TASlnp;
014900140721         WSMnrs = TASnrs;
015000140721         WSMnsp = TASnsp;
015100140721
015200140721         // -?Scrittura records(s)?
015300140721         if  WSMtpInv <> *blank;
015400140721           // -?Con avviso per e-mail oppure sms?
015500140721           WRITE  WFSMT000;
015600140721         else;
015700140721           // -?Con avviso per e-mail ed sms?
015800140721           WSMtpInv = 'M';
015900140721           WRITE  WFSMT000;
016000140721           WSMtpInv = 'S';
016100140721           WRITE  WFSMT000;
016200140721         endif;
016300140721
016400140721       ENDSR;
016500140721
016600140721       //--------------------------------------------------------------
016700140721       //?Operazioni finali.                                           ?
016800140721       //--------------------------------------------------------------
016900140721       BEGSR  sr_RoutEnd;
017000140721
017100140721         return;
017200140721
017300140721       ENDSR;
