000100110224       //==============================================================
000200110224       //?TNVRSM009S - Lista records eliminabili in tabella "AR8".     ?
000300110224       //==============================================================
000400110224
000500110224       //--------------------------------------------------------------
000600110224       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700110224       //--------------------------------------------------------------
000800110224
000900110224     /*PRM  dbgview(*source)
001000110224     /*END
001100110224
001200110224       //--------------------------------------------------------------
001300110224       //?Specifiche di controllo.                                     ?
001400110224       //--------------------------------------------------------------
001500110224
001600110224     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700110224     h dftactgrp(*no)
001800110224     h bnddir('UBBNDDIR')
001900110224
002000110224       //--------------------------------------------------------------
002100110224       //?Dichiarazione file.                                          ?
002200110224       //--------------------------------------------------------------
002300110224
002400110224
002500110224       // -?Tabella "AR8"?
002600110224     fTNTBE01L  if   e           k disk
002700110224
002800110224       // -?Printer File?
002900110224     fQSYSPRT   o    f  132        printer usropn oflind(*inOF)
003000110224
003100110224       //--------------------------------------------------------------
003200110224       //?Definizione costanti.                                        ?
003300110224       //--------------------------------------------------------------
003400110224
003500110224     d c_OvrPrtF       c                   const('OVRPRTF +
003600110224     d                                            file(QSYSPRT) +
003700110224     d                                            pagesize(66 132 *rowcol) +
003800110224     d                                            lpi(6) cpi(10) +
003900110224     d                                            usrdta(''t.AR8 elim'')')
004000110224     d c_DltOvr        c                   const('DLTOVR +
004100110224     d                                            file(QSYSPRT)')
004200110224
004300110224       //--------------------------------------------------------------
004400110224       //?Definizione schiere.                                         ?
004500110224       //--------------------------------------------------------------
004600110224
004700110224
004800110224       //--------------------------------------------------------------
004900110224       //?Definizione aree dati.                                       ?
005000110224       //--------------------------------------------------------------
005100110224
005200110224
005300110224       //--------------------------------------------------------------
005400110224       //?Definizione strutture dati.                                  ?
005500110224       //--------------------------------------------------------------
005600110224
005700110224       // -?Tab. "AR8" = Tipi Modulo DDT x file FIAR8?
005800110224     d dAR8          e ds                  inz
005900110224
006000110224       // -?Status?
006100110224     d Status         sds
006200110224     d  SDSpgm           *proc
006300110224     d  SDSusr               254    263
006400110224
006500110224       //--------------------------------------------------------------
006600110224       //?Definizione variabili globali.                               ?
006700110224       //--------------------------------------------------------------
006800110224
006900110224       // -?Orario?
007000110224     d w_Time          s             10    inz
007100110224
007200110224       // -?Campi di stampa?
007300110224     d w_Logo          s              4    inz
007400110224     d w_Note          s             30    inz
007500110224     d w_TypeErr       s              1  0 inz
007600110224     d w_TotLog        s              5  0 inz
007700110224
007800110224       //--------------------------------------------------------------
007900110224       //?Definizione procedure usate.                                 ?
008000110224       //--------------------------------------------------------------
008100110224
008200110224       // -?Parametri API QUSROBJD (Retrieve Object Description)?
008300110224      /copy qSysInc/qRpgleSrc,QUSROBJD
008400110224      /copy GaiTraSrc/srcProtoPr,QUSROBJD
008500110224
008600110224       // -?Parametri API QCAPCMD (Process Commands)?
008700110224     d Qcmd            s           1024    inz  varying
008800110224      /copy qSysInc/qRpgleSrc,QCAPCMD
008900110224      /copy gaitrasrc/srcProtoPR,QCAPCMD
009000110224
009100110224       // -?Parametri gestione errori API.?
009200110224      /copy qSysInc/qRpgleSrc,QUSEC
009300110224
009400110224       //--------------------------------------------------------------
009500110224       //?Definizione key-list.                                        ?
009600110224       //--------------------------------------------------------------
009700110224
009800110224       // -?File TNTBE01L?
009900110224     d k05tntbe01    e ds                  extname(TNTBE01L : *key)
010000110224     d                                     prefix(k_)   inz
010100110224
010200110224       //--------------------------------------------------------------
010300110224       //?Riepilogo indicatori.                                        ?
010400110224       //--------------------------------------------------------------
010500110224
010600110224
010700110224       //--------------------------------------------------------------
010800110224       //?M A I N - L I N E                                            ?
010900110224       //--------------------------------------------------------------
011000110224
011100110224      /free
011200110224
011300110224       // -?Operazioni iniziali?
011400110224       exsr  sr_RoutInz;
011500110224
011600110224       // -?Estrazione loghi non più esistnti?
011700110224       DoW  Not %eof(TNTBE01L);
011800110224         exsr  sr_CheckLogo;
011900110224       EndDo;
012000110224
012100110224       // -?Operazioni finali?
012200110224       exsr  sr_RoutEnd;
012300110224
012400110224       //--------------------------------------------------------------
012500110224       //?Operazioni iniziali.                                         ?
012600110224       //--------------------------------------------------------------
012700110224       BEGSR sr_RoutInz;
012800110224
012900110224         *inLR = *on;
013000110224
013100110224         // -?Posizionamento & 1ª lettura della tab. "AR8" in TNTBE01L?
013200110224         k_TBEcod = 'AR8';
013300110224         setll  %kds( k05tntbe01 )  TNTBE000;
013400110224
013500110224         DoU  %eof(TNTBE01L)  or  TBEatb = *blank;
013600110224           reade  %kds( k05tntbe01 : 1 )  TNTBE000;
013700110224         EndDo;
013800110224
013900110224       ENDSR;
014000110224
014100110224       //--------------------------------------------------------------
014200110224       //?Verifica esistenza logo in input da tab. "AR8"  e            ?
014300110224       //?Lettura record successivo in tab. "AR8".                     ?
014400110224       //--------------------------------------------------------------
014500110224       BEGSR  sr_CheckLogo;
014600110224
014700110224         dAR8 = TBEuni;
014800110224         clear  w_TypeErr;
014900110224
015000110224         // -?Verifica esistenza oggetto?
015100110224         clear QUSD0100;
015200110224         clear QUSEC;
015300110224         Qusbprv = %size(Qusec);
015400110224         RetrieveObjectDescription( QUSD0100 :
015500110224                                    %len(QUSD0100) :
015600110224                                    'OBJD0100' :
015700110224                                    'LOGO' + %subst( TBEke1 : 1 : 4 )
015800110224                                           + '  GAITRAOBJ ':
015900110224                                    '*PAGSEG' :
016000110224                                    qUsec );
016100110224
016200110224         // -?Fallito il reperimento dati:?
016300110224         //  ?stampa segnalazione logo?
016400110224         If  qUsei <> *blank;
016500110224           w_TypeErr = 1;
016600110224           exsr  sr_Stampa;
016700110224         EndIf;
016800110224
016900110224         // -Vecchio logo cliente della LOGISTICA?
017000110224         //  (per la fattura in FIAR8)?
017100110224         IF  §AR8logoF <> *blank;
017200110224
017300110224           // -?Verifica esistenza oggetto?
017400110224           clear QUSD0100;
017500110224           clear QUSEC;
017600110224           Qusbprv = %size(Qusec);
017700110224           RetrieveObjectDescription( QUSD0100 :
017800110224                                      %len(QUSD0100) :
017900110224                                      'OBJD0100' :
018000110224                                      'LOGO' + %trimr( TBEke1 )
018100110224                                             + '  GAITRAOBJ ':
018200110224                                      '*PAGSEG' :
018300110224                                      qUsec );
018400110224
018500110224           // -?Fallito il reperimento dati:?
018600110224           //  ?stampa segnalazione logo?
018700110224           If  qUsei <> *blank;
018800110224             w_TypeErr = 2;
018900110224             exsr  sr_Stampa;
019000110224           EndIf;
019100110224
019200110224         ENDIF;
019300110224
019400110224         // -?Lettura logo successivo in tab. "AR8"?
019500110224         DoU  %eof(TNTBE01L)  or  TBEatb = *blank;
019600110224           reade  %kds( k05tntbe01 : 1 )  TNTBE000;
019700110224         EndDo;
019800110224
019900110224       ENDSR;
020000110224
020100110224       //--------------------------------------------------------------
020200110224       //?Stampa segnalazione segmento di pagina.                      ?
020300110224       //--------------------------------------------------------------
020400110224       BEGSR  sr_Stampa;
020500110224
020600110224         // -?Impostazione campi in output?
020700110224         w_Logo = TBEke1;
020800110224         clear  w_Note;
020900110224         select;
021000110224           when  w_TypeErr = 1;
021100110224             w_Note = 'Logo inesistente in GAITRAOBJ.';
021200110224           when  w_TypeErr = 2;
021300110224             w_Note = 'Logo x fattura in DDT Logistica inesistente +
021400110224                       in GAITRAOBJ.';
021500110224         endsl;
021600110224
021700110224         // -?Test OverFlow e stampa testata?
021800110224         exsr  sr_TestOF;
021900110224
022000110224         // -?Stampa riga di dettaglio?
022100110224         except  PRTdet;
022200110224
022300110224         // -?Incremento n° totale loghi?
022400110224         w_TotLog += 1;
022500110224
022600110224       ENDSR;
022700110224
022800110224       //--------------------------------------------------------------
022900110224       //?Test OverFlow in stampa.                                     ?
023000110224       //--------------------------------------------------------------
023100110224       BEGSR  sr_TestOF;
023200110224
023300110224         // -?Apertura file di stampa?
023400110224         if  not %open (QSYSPRT);
023500110224           Qcmd = c_OvrPrtF;
023600110224           exsr  sr_ExecCmd;
023700110224           open  QSYSPRT;
023800110224           *inOF = *on;
023900110224         endif;
024000110224
024100110224         // -?Test OverFlow e stampa testata?
024200110224         if  *inOF;
024300110224           w_Time = %char( %time() );
024400110224           except PRTtxt;
024500110224           *inOF  = *off;
024600110224         endif;
024700110224
024800110224       ENDSR;
024900110224
025000110224       //--------------------------------------------------------------
025100110224       //?Esecuzione del comando (già impostato).                      ?
025200110224       //--------------------------------------------------------------
025300110224       BEGSR  sr_ExecCmd;
025400110224
025500110224         clear Qcap0100;
025600110224         Qcabcsdh = *off;
025700110224         Qcapa    = *off;
025800110224         Qcacmdss = *off;
025900110224         Qcaerved = *allX'00';
026000110224
026100110224         clear Qusec;
026200110224         Qusbprv  = %size(Qusec);
026300110224
026400110224         ProcessCommands ( Qcmd : %size(Qcmd) : Qcap0100 :
026500110224                           %size(Qcap0100) : 'CPOP0100' : *omit :
026600110224                           0 : 0 : Qusec);
026700110224
026800110224         //if  Qusei <> *blank;
026900110224         //  ...;
027000110224         //endif;
027100110224
027200110224       ENDSR;
027300110224
027400110224       //--------------------------------------------------------------
027500110224       //?Operazioni finali.                                           ?
027600110224       //--------------------------------------------------------------
027700110224       BEGSR  sr_RoutEnd;
027800110224
027900110224         // -?Stampa "fine-lista"?
028000110224         exsr  sr_TestOF;
028100110224         except  PRTend;
028200110224
028300110224         // -?Chiusura printer-file?
028400110224         close  QSYSPRT;
028500110224
028600110224         // -?Uscita?
028700110224         return;
028800110224
028900110224       ENDSR;
029000110224
029100110224      /end-free
029200110224
029300110224       //--------------------------------------------------------------
029400110224       //?P R I N T E R - F I L E S                                    ?
029500110224       //--------------------------------------------------------------
029600110224
029700110224     oQSYSPRT   e            PRTtxt            2
029800110224     o                                              'ELENCO LOGHI IN T-
029900110224     o                                              AB."AR8" ANNULLABI-
030000110224     o                                              LI'
030100110224     o                       SDSpgm           +   5
030200110224     o                       SDSusr           +   5
030300110224     o                       *date         y  +   5
030400110224     o                       w_Time           +   5
030500110224     o                                        +   5 'Pag.'
030600110224     o                       Page          z  +   0
030700110224     o          e            PRTtxt      0  0
030800110224     o                                              'ELENCO LOGHI IN T-
030900110224     o                                              AB."AR8" ANNULLABI-
031000110224     o                                              LI'
031100110224     o          e            PRTtxt      2
031200110224     o                                              'Logo'
031300110224     o                                        +   2 'Descrizione      -
031400110224     o                                                           '
031500110224     o                                        +   2 'Note'
031600110224     o          e            PRTtxt      0  0
031700110224     o                                              'Logo'
031800110224     o                                        +   2 'Descrizione      -
031900110224     o                                                           '
032000110224     o                                        +   2 'Note'
032100110224     o          e            PRTtxt      1
032200110224     o                                              '===='
032300110224     o                                        +   2 '=================+
032400110224     o                                               ============='
032500110224     o                                        +   2 '=================+
032600110224     o                                               ============='
032700110224     o          e            PRTtxt      0  1
032800110224     o                                              '===='
032900110224     o                                        +   2 '=================+
033000110224     o                                               ============='
033100110224     o                                        +   2 '=================+
033200110224     o                                               ============='
033300110224      *
033400110224     o          e            PRTdet      1
033500110224     o                       w_Logo
033600110224     o                       §AR8des          +   2
033700110224     o                       w_Note           +   2
033800110224      *
033900110224     o          e            PRTend      2
034000110224     o                                        +   6 '***  Fine Lista  +
034100110224     o                                               ***'
034200110224     o                                        +   3 'Tot. loghi = '
034300110224     o                       w_TotLog      k  +   1
034400110224     o          e            PRTend      0  0
034500110224     o                                        +   6 '***  Fine Lista  +
034600110224     o                                               ***'
