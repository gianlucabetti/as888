000100171201       //==============================================================
000200171201       // ?TNVRsmMRAr - Impostazione del "Tipo tabella MRA" ("STD "/    ?
000300171201       // ?             "BYPS"/"CEG "/"DAN "/MK23"/"MK24"/"OR52"/"XLS ")?
000400171201       // ?             negli ultimi caratteri di TNTBE00F.TBEUNI       ?
000500171201       // ?             (per i soli record della tabella "MRA").        ?
000600171201       //==============================================================
000700171201
000800171201       //--------------------------------------------------------------
000900171201       //? Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
001000171201       //--------------------------------------------------------------
001100171201
001200171201     /*PRM  dbgview(*source)
001300171201     /*END
001400171201
001500171201       //--------------------------------------------------------------
001600171201       //? Specifiche di controllo.                                     ?
001700171201       //--------------------------------------------------------------
001800171201
001900171201     h decedit('0,') datedit(*dmy/) option(*nodebugio)
002000171201     h dftactgrp(*no)
002100171201
002200171201       //--------------------------------------------------------------
002300171201       //? Dichiarazione file.                                          ?
002400171201       //--------------------------------------------------------------
002500171201
002600171201       // - ?Tabelle ("MRA")?
002700171201     fTNTBE01L  Uf   e           k disk
002800171201
002900171201       //--------------------------------------------------------------
003000171201       // ?Definizione costanti.                                        ?
003100171201       //--------------------------------------------------------------
003200171201
003300171201       // - ?Codice tabella da gestire?
003400171201     d c_Tab           c                   const('MRA')
003500171201
003600171201       // - ?Tipi tabella "MRA" in gestione?
003700171201     d c_MRAstd        c                   const('STD ')
003800171201     d c_MRAbyps       c                   const('BYPS')
003900171201     d c_MRAdan        c                   const('DAN ')
004000171201     d c_MRAceg        c                   const('CEG ')
004100171201     d c_MRAmk23       c                   const('MK23')
004200171201     d c_MRAmk24       c                   const('MK24')
004300171201     d c_MRAor52       c                   const('OR52')
004400171201     d c_MRAxls        c                   const('XLS ')
004500171201
004600171201       //--------------------------------------------------------------
004700171201       //? Definizione schiere.                                         ?
004800171201       //--------------------------------------------------------------
004900171201
005000171201
005100171201       //--------------------------------------------------------------
005200171201       //? Definizione aree dati.                                       ?
005300171201       //--------------------------------------------------------------
005400171201
005500171201
005600171201       //--------------------------------------------------------------
005700171201       //? Definizione strutture dati.                                  ?
005800171201       //--------------------------------------------------------------
005900171201
006000171201       // - ?Status ds?
006100171201     d Status         sds
006200171201     d   SDSpgmName      *proc
006300171201     d*//SDSdta              191    198
006400171201     d*//SDSjob              244    253
006500171201     d*//SDSusr              254    263
006600171201
006700171201       // - ?Tabelle "MRA" = Bart-Mailing:?
006800171201       // · ?Standard?
006900171201     d dMRA          e ds                  inz
007000171201       // · ?ByPass Spool?
007100171201     d dMRAbyps      e ds                  inz  prefix(BYPS)
007200171201       // · ?C.E. Giornaliero?
007300171201     d dMRAceg       e ds                  inz  prefix(CEG)
007400171201       // · ?Danni?
007500171201     d dMRAdan       e ds                  inz  prefix(DAN)
007600171201       // · ?Mail di Conferma?
007700171201     d dMRAmk23      e ds                  inz  prefix(MK23)
007800171201       // · ?Mail con Materiale Illustrativo?
007900171201     d dMRAmk24      e ds                  inz  prefix(MK24)
008000171201       // · ?Mail con O.R.M. allegato?
008100171201     d dMRAor52      e ds                  inz  prefix(OR52)
008200171201       // · ?Output su file XLS?
008300171201     d dMRAxls       e ds                  inz  prefix(XLS)
008400171201
008500171201       //--------------------------------------------------------------
008600171201       //? Definizione variabili globali.                               ?
008700171201       //--------------------------------------------------------------
008800171201
008900171201       // - ?Flags booleani?
009000171201     d $Fine           s               n   inz
009100171201
009200171201       // - Tipo tabella "MRA" da impostare negli ultimi char di TBEUNI?
009300171201     d wTIPO           s              4    inz
009400171201
009500171201       //--------------------------------------------------------------
009600171201       //? Definizione prototipi procedure.                             ?
009700171201       //--------------------------------------------------------------
009800171201
009900171201
010000171201       //--------------------------------------------------------------
010100171201       //? Definizione key-list.                                        ?
010200171201       //--------------------------------------------------------------
010300171201
010400171201       // - ?File TNTBE01L?
010500171201     d keyTNTBE01    e ds                  extname( TNTBE01L : *key )
010600171201     d                                     prefix( k_ )  inz
010700171201
010800171201       //--------------------------------------------------------------
010900171201       //? Riepilogo indicatori utilizzati.                             ?
011000171201       //--------------------------------------------------------------
011100171201
011200171201
011300171201       //--------------------------------------------------------------
011400171201       //? M A I N - L I N E                                            ?
011500171201       //--------------------------------------------------------------
011600171201
011700171201     c*//  *Entry        plist
011800171201     c*//                parm                    KPJBA
011900171201
012000171201       // - ?Operazioni iniziali?
012100171201       exsr  sr_RoutInz;
012200171201
012300171201       // - ?Ciclo di elaborazione?
012400171201       setll ( c_Tab )  TNTBE000;
012500171201       reade ( c_Tab )  TNTBE000;
012600171201
012700171201       DoW  Not %eof( TNTBE01L );
012800171201
012900171201         if  %subst( TBEuni : 251 : 6 ) = *blank;
013000171201           exsr  sr_Set_SubType_MRA;
013100171201         else;
013200171201           unlock  TNTBE01L;
013300171201         endif;
013400171201
013500171201         reade ( c_Tab )  TNTBE000;
013600171201
013700171201       EndDo;
013800171201
013900171201       // - ?Operazioni finali?
014000171201       exsr sr_RoutEnd;
014100171201
014200171201       //--------------------------------------------------------------
014300171201       //? Operazioni iniziali.                                         ?
014400171201       //--------------------------------------------------------------
014500171201       BEGSR  sr_RoutInz;
014600171201
014700171201         // -? Impostazione chiusura?
014800171201         *inLR = *on;
014900171201
015000171201       ENDSR;
015100171201
015200171201       //--------------------------------------------------------------
015300171201       //? Impostazione "Tipo tab. MRA" negli ultimo 6 char di TBEUNI.  ?
015400171201       //--------------------------------------------------------------
015500171201       BEGSR  sr_Set_SubType_MRA;
015600171201
015700171201         // - ?Reperimento "Tipo tabella MRA"?
015800171201         clear  wTIPO;
015900171201
016000171201         select;
016100171201           // - ?dati di dMRABYPS (lunga 82 bytes)?
016200171201           when  %scan( 'BYPS' : %trimr( TBEke1 ) ) > *zero;
016300171201             wTIPO = c_MRAbyps;
016400171201           // - ?dati di dMRACEG (lunga 125 bytes)?
016500171201           when    %subst( TBEuni : 1 : 4 ) = 'C.E.';
016600171201             wTIPO = c_MRAceg;
016700171201           // - ?dati di dMRAmk23 (lunga 129 bytes)?
016800171201           when  %scan( 'TRMK23R' : %trimr( TBEke1 ) ) > *zero;
016900171201             wTIPO = c_MRAmk23;
017000171201           // - ?dati di dMRAmk24 (lunga 164 bytes)?
017100171201           when  %scan( 'TRMK24R' : %trimr( TBEke1 ) ) > *zero;
017200171201             wTIPO = c_MRAmk24;
017300171201           // - ?dati di dMRAor52 (lunga 129 bytes)?
017400171201           when  %scan( 'FIOR52R' : %trimr( TBEke1 ) ) > *zero;
017500171201             wTIPO = c_MRAor52;
017600171201           // - ?dati di dMRAXLS (lunga 49 bytes)?
017700171201           when    %subst( TBEuni : %size( dMRAxls ) + 1 ) = *blank;
017800171201             wTIPO = c_MRAxls;
017900171201           // - ?dati di dMRA (lunga 84 bytes)?
018000171201           when  %subst( TBEuni : %size( dMRA ) + 1 ) = *blank;
018100171201             wTIPO = c_MRAstd;
018200171201           // - ?dati di dMRADAN (lunga 190 bytes)?
018300171201           when  %subst( TBEuni : %size( dMRAdan ) + 1 ) = *blank;
018400171201             wTIPO = c_MRAdan;
018500171201         endsl;
018600171201
018700171201         // - ?Memorizzazione "Tipo tabella MRA"?
018800171201         If  wTIPO <> *blank;
018900171201           %subst( TBEuni : 251 ) = wTIPO;
019000171201           //_______________
019100171201           update  TNTBE000;
019200171201           //¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
019300171201         EndIf;
019400171201
019500171201       ENDSR;
019600171201
019700171201       //--------------------------------------------------------------
019800171201       //? Operazioni finali.                                           ?
019900171201       //--------------------------------------------------------------
020000171201       BEGSR  sr_RoutEnd;
020100171201
020200171201         // - ?Uscita dal *pgm?
020300171201         return;
020400171201
020500171201       ENDSR;
