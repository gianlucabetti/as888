000100170522       //==============================================================
000200170612       //?FIMS15R - Statistica Clienti con Merce Incompatibile: Aggiona?
000300170524       //?          *file FIMIS00F: Merce Incompatibile - Spedizioni   ?
000400170524       //?          - batch -                                          ?
000500170522       //==============================================================
000600170522
000700170522       //--------------------------------------------------------------
000800170522       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000900170522       //--------------------------------------------------------------
001000170522
001100170609     /*PRM  dbgview(*source)
001200170522     /*END
001300170522
001400170522       //--------------------------------------------------------------
001500170522       //?Specifiche di controllo.                                     ?
001600170522       //--------------------------------------------------------------
001700170522
001800170522     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001900170522     h alwnull(*inputonly)
002000170522     h dftactgrp(*no)
002100170522
002200170522       //--------------------------------------------------------------
002300170522       //?Dichiarazione file.                                          ?
002400170522       //--------------------------------------------------------------
002500170609
002600170609       // -?BOLLE SEDE: da Fatturare + Fatt. Ultimi mesi + Fatt. Storico?
002700170612     fTITAS30C  if   e           k disk
002800170522
002900170522       // -?Merce Incompatibile: Spedizioni?
003000170612     fFIMIS01L  Uf   e           k disk
003100170522
003200170522       //--------------------------------------------------------------
003300170522       //?Definizione costanti.                                        ?
003400170522       //--------------------------------------------------------------
003500170522
003600170609       // -?Costante per controllo "caratteri solo numerici"?
003700170609     d c_Digits        c                   const('0123456789')
003800170522
003900170522       //--------------------------------------------------------------
004000170522       //?Definizione schiere.                                         ?
004100170522       //--------------------------------------------------------------
004200170522
004300170522
004400170522       //--------------------------------------------------------------
004500170522       //?Definizione aree dati.                                       ?
004600170522       //--------------------------------------------------------------
004700170522
004800170522       // -?Dati utente?
004900170522     d §AzUte        e ds                  extname(AZUTE00F)
005000170522     d                                     dtaara
005100170522     d §DatiUte      e ds                  extname(dDatiUte)
005200170522     d                                     dtaara
005300170522
005400170522       //--------------------------------------------------------------
005500170522       //?Definizione strutture dati.                                  ?
005600170522       //--------------------------------------------------------------
005700170522
005800170522       // -?Status ds?
005900170522     d Status         sds
006000170522     d   SDSpgmName      *proc
006100170522     d*//SDSdta              191    198
006200170526     d*//SDSjob              244    253
006300170526     d*//SDSusr              254    263
006400170522
006500170522       // -?Parametri ricevuti?
006600170523     d KPJBA         e ds
006700170522
006800170522       //--------------------------------------------------------------
006900170522       //?Definizione variabili globali.                               ?
007000170522       //--------------------------------------------------------------
007100170522
007200170522       // -?Flags booleani?
007300170522     d $EoF            s               n   inz
007400170609
007500170609       // -?Nomi Libreria/File?
007600170609     d wLibFileTITAS   s             21    inz('GAITRAGRU/TITAS30C   ')
007700170522
007800170522       //--------------------------------------------------------------
007900170522       //?Definizione prototipi procedure.                             ?
008000170522       //--------------------------------------------------------------
008100170522
008200170522       // -?Reperimento dati utente?
008300170522     d TIBS34ds      e ds                  inz
008400170522      /copy gaitrasrc/srcProtoPR,TIBS34R
008500170522
008600170522       //--------------------------------------------------------------
008700170522       //?Definizione key-list.                                        ?
008800170522       //--------------------------------------------------------------
008900170609
009000170609       // -?File TITAS30C?
009100170609     d keyTITAS30    e ds                  extname( TITAS30C : *key )
009200170609     d                                     prefix( k_ )  inz
009300170524
009400170524       // -?File FIMIS01L?
009500170524     d keyFIMIS01    e ds                  extname( FIMIS01L : *key )
009600170524     d                                     prefix( k_ )  inz
009700170522
009800170522       //--------------------------------------------------------------
009900170522       //?Riepilogo indicatori utilizzati.                             ?
010000170522       //--------------------------------------------------------------
010100170522
010200170522
010300170522       //--------------------------------------------------------------
010400170522       //?M A I N - L I N E                                            ?
010500170522       //--------------------------------------------------------------
010600170522
010700170522     c     *Entry        plist
010800170522     c                   parm                    KPJBA
010900170522
011000170522      /free
011100170522
011200170522       // -?Operazioni iniziali?
011300170522       exsr  sr_RoutInz;
011400170522
011500170523       // -?Ciclo di elaborazione?
011600170612       setll ( *loval )  FIMIS000;
011700170612       read  FIMIS000;
011800170612
011900170612       DoW  Not %eof( FIMIS01L );
012000170612
012100170612         if  MISaas = 2017  and  MISmgs <= 0531;
012200170612           exsr  sr_Update_POR_IMV;
012300170612         endif;
012400170612
012500170612         read  FIMIS000;
012600170612
012700170522       EndDo;
012800170522
012900170522       // -?Operazioni finali?
013000170522       exsr sr_RoutEnd;
013100170522
013200170522       //--------------------------------------------------------------
013300170522       //?Operazioni iniziali.                                         ?
013400170522       //--------------------------------------------------------------
013500170522       BEGSR  sr_RoutInz;
013600170522
013700170522         // -?Impostazione chiusura?
013800170522         *inLR = *on;
013900170522
014000170522         // -?Reperimento dati job?
014100170522         exsr  sr_DatiJob;
014200170522
014300170522       ENDSR;
014400170522
014500170522       //--------------------------------------------------------------
014600170522       //?Reperimento Dati del job (Utente/Operativi).                 ?
014700170522       //--------------------------------------------------------------
014800170522       BEGSR  sr_DatiJob;
014900170522
015000170522         in(e)  §AzUte;
015100170522         if  NOT  %error;
015200170522           in(e)  §DatiUte;
015300170522         endif;
015400170522         if  %error  or  RSut = *blank;
015500170522           tibs34r ( tibs34ds );
015600170522           in  §AzUte;
015700170522           in  §DatiUte;
015800170522         endif;
015900170522
016000170522       ENDSR;
016100170522
016200170522       //--------------------------------------------------------------
016300170612       //?Aggiornamento importi PORTO e IMPONIBILE IVA in FIMIS00F.    ?
016400170522       //--------------------------------------------------------------
016500170612       BEGSR  sr_Update_POR_IMV;
016600170609
016700170609         // -?Aggancio TITAS30C?
016800170609         clear  keyTITAS30;
016900170612         k_TASaas = MISaas;
017000170612         k_TASlnp = MISlnp;
017100170612         k_TASnrs = MISnrs;
017200170612         k_TASnsp = MISnsp;
017300170612         k_TAStbl = MIStbl;
017400170612         chain  %kds( keyTITAS30 )  TITAS30C;
017500170609
017600170612         if  NOT %found( TITAS30C );
017700170609           leavesr;
017800170609         endif;
017900170524
018000170612         // -?Aggiornamento record in FIMIS00F?
018100170612         MISpor = TASpor;
018200170612         MISimv = TASimv;
018300170524
018400170612         //_______________
018500170612         update  FIMIS000;
018600170612         //¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
018700170522
018800170522       ENDSR;
018900170522
019000170522       //--------------------------------------------------------------
019100170522       //?Operazioni finali.                                           ?
019200170522       //--------------------------------------------------------------
019300170522       BEGSR  sr_RoutEnd;
019400170522
019500170522         // -?Uscita dal *pgm?
019600170522         return;
019700170522
019800170522       ENDSR;
019900170522
020000170522      /end-free
