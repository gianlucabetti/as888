000100140930       //==============================================================
000200141001       //?TNVRSMOFR * Pulizia dati Tipo NON legati a Offerte.          ?
000300140930       //==============================================================
000400140930
000500140930       //--------------------------------------------------------------
000600140930       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700140930       //--------------------------------------------------------------
000800140930
000900140930     /*PRM  dbgview(*source)
001000140930     /*END
001100140930
001200140930       //--------------------------------------------------------------
001300140930       //?Specifiche di controllo.                                     ?
001400140930       //--------------------------------------------------------------
001500140930
001600140930     h decedit('0,') datedit(*ymd/) option(*nodebugio)
001700140930
001800140930       //--------------------------------------------------------------
001900140930       //?Dichiarazione file.                                          ?
002000140930       //--------------------------------------------------------------
002100140930
002200140930       // -?Tariffe da C/Economico - Dati tipo cliente?
002300140930     fTEETC01L  if   e           k disk
002400140930
002500140930       // -?Offerte Clienti -TESTATA-?
002600140930     fTNOFM01L  if   e           k disk
002700140930
002800140930       //--------------------------------------------------------------
002900140930       //?Definizione costanti.                                        ?
003000140930       //--------------------------------------------------------------
003100140930
003200140930       //--------------------------------------------------------------
003300140930       //?Definizione schiere.                                         ?
003400140930       //--------------------------------------------------------------
003500140930
003600140930       //--------------------------------------------------------------
003700140930       //?Definizione aree dati.                                       ?
003800140930       //--------------------------------------------------------------
003900140930
004000140930       // -?Dati utente?
004100140930     d §AzUte        e ds                  extname(AZUTE00F)
004200140930     d                                     dtaara
004300140930     d §DatiUte      e ds                  extname(dDatiUte)
004400140930     d                                     dtaara
004500140930
004600140930       //--------------------------------------------------------------
004700140930       //?Definizione strutture dati.                                  ?
004800140930       //--------------------------------------------------------------
004900140930
005000140930       // -?Parametri ricevuti
005100140930     d KPJBA         e ds
005200140930
005300140930       //--------------------------------------------------------------
005400140930       //?Definizione variabili globali.                               ?
005500140930       //--------------------------------------------------------------
005600140930
005700140930       //--------------------------------------------------------------
005800140930       //?Definizione prototipi procedure e relativi parametri.        ?
005900140930       //--------------------------------------------------------------
006000140930
006100140930       // -?Annullamento dati tipo tariffe scadute - esegue?
006200140930     d TNTA47ds      e ds                  inz     qualified
006300140930     d   D47tup      e                     inz('2')
006400140930     d   D47dsf      e                     inz('S')
006500140930     d   D47cto      e                     inz('O')
006600140930     d TNTA47R         pr                  extpgm('TNTA47R')
006700140930     d   kpjba                             likeds(KPJBA)
006800140930
006900140930       //--------------------------------------------------------------
007000140930       //?Definizione key-list.                                        ?
007100140930       //--------------------------------------------------------------
007200140930
007300140930       // -?File TEETC01L?
007400140930     d keyTEETC01    e ds                  extname(TEETC01L : *key)
007500140930     d                                     inz  prefix(k_)
007600140930
007700140930       // -?File TNOFM01L?
007800140930     d keyTNOFM01    e ds                  extname(TNOFM01L : *key)
007900140930     d                                     inz  prefix(k_)
008000140930
008100140930       //--------------------------------------------------------------
008200140930       //?M A I N - L I N E                                            ?
008300140930       //--------------------------------------------------------------
008400140930
008500140930     c     *Entry        plist
008600140930     c                   parm                    KPJBA
008700140930
008800140930      /free
008900140930
009000140930       // -?Operazioni iniziali?
009100140930       exsr sr_RoutInz;
009200140930
009300140930       // -?Ciclo di elaborazione file Tariffe?
009400140930       DoW  Not %eof(TEETC01L);
009500140930
009600140930         // -?Verifica esistenza rec. in TNOFM?
009700140930         exsr  sr_CtrlTNOFM;
009800140930
009900140930         // -?Lettura rec. successivo in TEETC?
010000140930         reade  %kds( keyTEETC01 : 2 )  TEETC000;
010100140930
010200140930       EndDo;
010300140930
010400140930       // -?Operazioni finali?
010500140930       exsr sr_RoutEnd;
010600140930
010700140930       //--------------------------------------------------------------
010800140930       //?Operazioni iniziali.                                         ?
010900140930       //--------------------------------------------------------------
011000140930       BEGSR  sr_RoutInz;
011100140930
011200140930         *inLR = *on;
011300140930
011400140930         // -?Posizionamento iniziale e prima lettura del file TEETC?
011500140930         clear  keyTEETC01;
011600140930         k_ETCdsf = 'S';                 //Dati Sede/Filiale?
011700140930         k_ETCcto = 'O';                 //Codice Tariffa/Offerta?
011800140930         setLL  %kds( keyTEETC01 : 2 )  TEETC000;
011900140930         readE  %kds( keyTEETC01 : 2 )  TEETC000;
012000140930
012100140930       ENDSR;
012200140930
012300140930       //--------------------------------------------------------------
012400140930       //?Verifica esistenza rec. in TNOFM00F.                         ?
012500140930       //--------------------------------------------------------------
012600140930       BEGSR  sr_CtrlTNOFM;
012700140930
012800140930         // -?Verifica esistenza rec. in TNOFM?
012900140930         clear  keyTNOFM01;
013000140930         k_TAMksc = ETCksc;
013100140930         k_TAMctr = ETCctr;
013200140930         k_TAMprg = ETCprg;
013300140930
013400140930         setLL  %kds( keyTNOFM01 )  TNTAM000;
013500140930
013600140930         // -?NON presente => Cancellazione:?
013700140930         //  ?· Dati Tipo Generale               (TEETC00F),?
013800140930         //  ?· Dati Tipo Scaglioni x Ricavi     (TEETS00F),?
013900140930         //  ?· Dati Tipo Scaglioni x Competenze (TEETS10F),?
014000140930         //  ?· Dati Tipo Codici Tassazione      (TEETT00F).?
014100140930         If  Not %equal(TNOFM01L);
014200140930
014300140930             reset  TNTA47ds;
014400140930             //TNTA47ds.D47tup = '2';   (già così)?
014500140930             //TNTA47ds.D47dsf = 'S';   (già così)?
014600140930             //TNTA47ds.D47cto = 'O';   (già così)?
014700140930             TNTA47ds.D47ksc = ETCksc;
014800140930             TNTA47ds.D47ctr = ETCctr;
014900140930             TNTA47ds.D47prg = ETCprg;
015000140930
015100140930             kpjbu = TNTA47ds;
015200140930             TNTA47R ( KPJBA );
015300140930
015400140930         EndIf;
015500140930
015600140930       ENDSR;
015700140930
015800140930       //--------------------------------------------------------------
015900140930       //?Operazioni finali.                                           ?
016000140930       //--------------------------------------------------------------
016100140930       BEGSR  sr_RoutEnd;
016200140930
016300140930         // -?Chiusura applicazioni?
016400140930         clear  TNTA47ds;
016500140930         TNTA47ds.D47tla = 'C';
016600140930         kpjbu = TNTA47ds;
016700140930         TNTA47R ( KPJBA );
016800140930
016900140930         // -?Uscita dal *pgm?
017000140930         return;
017100140930
017200140930       ENDSR;
017300140930
017400140930      /end-free
