000100140930       //==============================================================
000200141001       //?TNVRSMTAR * Pulizia dati Tipo NON legati a Tariffe.          ?
000300140930       //==============================================================
000400140930
000500140930       //--------------------------------------------------------------
000600140930       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700140930       //--------------------------------------------------------------
000800140930
000900140930     /*PRM  dbgview(*source)
001000140930     /*END
001100140930
001200140930       //--------------------------------------------------------------
001300140930       //?Specifiche di controllo.                                     ?
001400140930       //--------------------------------------------------------------
001500140930
001600140930     h decedit('0,') datedit(*ymd/) option(*nodebugio)
001700140930
001800140930       //--------------------------------------------------------------
001900140930       //?Dichiarazione file.                                          ?
002000140930       //--------------------------------------------------------------
002100140930
002200140930       // -?Tariffe da C/Economico - Dati tipo cliente?
002300140930     fTEETC01L  if   e           k disk
002400140930
002500140930       // -?Tariffe Clienti -TESTATA-?
002600140930     fTNTAM01L  if   e           k disk
002700140930
002800140930       //--------------------------------------------------------------
002900140930       //?Definizione costanti.                                        ?
003000140930       //--------------------------------------------------------------
003100140930
003200140930       //--------------------------------------------------------------
003300140930       //?Definizione schiere.                                         ?
003400140930       //--------------------------------------------------------------
003500140930
003600140930       //--------------------------------------------------------------
003700140930       //?Definizione aree dati.                                       ?
003800140930       //--------------------------------------------------------------
003900140930
004000140930       // -?Dati utente?
004100140930     d §AzUte        e ds                  extname(AZUTE00F)
004200140930     d                                     dtaara
004300140930     d §DatiUte      e ds                  extname(dDatiUte)
004400140930     d                                     dtaara
004500140930
004600140930       //--------------------------------------------------------------
004700140930       //?Definizione strutture dati.                                  ?
004800140930       //--------------------------------------------------------------
004900140930
005000140930       // -?Parametri ricevuti
005100140930     d KPJBA         e ds
005200140930
005300140930       //--------------------------------------------------------------
005400140930       //?Definizione variabili globali.                               ?
005500140930       //--------------------------------------------------------------
005600140930
005700140930       //--------------------------------------------------------------
005800140930       //?Definizione prototipi procedure e relativi parametri.        ?
005900140930       //--------------------------------------------------------------
006000140930
006100140930       // -?Annullamento dati tipo tariffe scadute - esegue?
006200140930     d TNTA47ds      e ds                  inz     qualified
006300140930     d   D47dsf      e                     inz('S')
006400140930     d   D47cto      e                     inz('T')
006500140930     d TNTA47R         pr                  extpgm('TNTA47R')
006600140930     d   kpjba                             likeds(KPJBA)
006700140930
006800140930       //--------------------------------------------------------------
006900140930       //?Definizione key-list.                                        ?
007000140930       //--------------------------------------------------------------
007100140930
007200140930       // -?File TEETC01L?
007300140930     d keyTEETC01    e ds                  extname(TEETC01L : *key)
007400140930     d                                     inz  prefix(k_)
007500140930
007600140930       // -?File TNTAM01L?
007700140930     d keyTNTAM01    e ds                  extname(TNTAM01L : *key)
007800140930     d                                     inz  prefix(k_)
007900140930
008000140930       //--------------------------------------------------------------
008100140930       //?M A I N - L I N E                                            ?
008200140930       //--------------------------------------------------------------
008300140930
008400140930     c     *Entry        plist
008500140930     c                   parm                    KPJBA
008600140930
008700140930      /free
008800140930
008900140930       // -?Operazioni iniziali?
009000140930       exsr sr_RoutInz;
009100140930
009200140930       // -?Ciclo di elaborazione file Tariffe?
009300140930       DoW  Not %eof(TEETC01L);
009400140930
009500140930         // -?Verifica esistenza rec. in TNTAM?
009600140930         exsr  sr_CtrlTNTAM;
009700140930
009800140930         // -?Lettura rec. successivo in TEETC?
009900140930         reade  %kds( keyTEETC01 : 2 )  TEETC000;
010000140930
010100140930       EndDo;
010200140930
010300140930       // -?Operazioni finali?
010400140930       exsr sr_RoutEnd;
010500140930
010600140930       //--------------------------------------------------------------
010700140930       //?Operazioni iniziali.                                         ?
010800140930       //--------------------------------------------------------------
010900140930       BEGSR  sr_RoutInz;
011000140930
011100140930         *inLR = *on;
011200140930
011300140930         // -?Posizionamento iniziale e prima lettura del file TEETC?
011400140930         clear  keyTEETC01;
011500140930         k_ETCdsf = 'S';                 //Dati Sede/Filiale?
011600140930         k_ETCcto = 'T';                 //Codice Tariffa/Offerta?
011700140930         setLL  %kds( keyTEETC01 : 2 )  TEETC000;
011800140930         readE  %kds( keyTEETC01 : 2 )  TEETC000;
011900140930
012000140930       ENDSR;
012100140930
012200140930       //--------------------------------------------------------------
012300140930       //?Verifica esistenza rec. in TNTAM00F.                         ?
012400140930       //--------------------------------------------------------------
012500140930       BEGSR  sr_CtrlTNTAM;
012600140930
012700140930         // -?Verifica esistenza rec. in TNTAM?
012800140930         clear  keyTNTAM01;
012900140930         k_TAMksc = ETCksc;
013000140930         k_TAMctr = ETCctr;
013100140930         k_TAMprg = ETCprg;
013200140930
013300140930         chain  %kds( keyTNTAM01 )  TNTAM000;
013400140930
013500140930         Select;
013600140930
013700140930           // -?NON presente => Cancellazione:?
013800140930           //  ?· Dati Tipo Generale               (TEETC00F),?
013900140930           //  ?· Dati Tipo Scaglioni x Ricavi     (TEETS00F),?
014000140930           //  ?· Dati Tipo Scaglioni x Competenze (TEETS10F),?
014100140930           //  ?· Dati Tipo Codici Tassazione      (TEETT00F).?
014200140930           When  Not %found(TNTAM01L);
014300140930             reset  TNTA47ds;
014400140930             TNTA47ds.D47tup = '2';
014500140930             //TNTA47ds.D47dsf = 'S';   (già così)?
014600140930             //TNTA47ds.D47cto = 'T';   (già così)?
014700140930             TNTA47ds.D47ksc = ETCksc;
014800140930             TNTA47ds.D47ctr = ETCctr;
014900140930             TNTA47ds.D47prg = ETCprg;
015000140930             kpjbu = TNTA47ds;
015100140930             TNTA47R ( KPJBA );
015200140930
015300140930           // -?Annullato => Annullamento:?
015400140930           //  ?· Dati Tipo Generale               (TEETC00F),?
015500140930           //  ?· Dati Tipo Scaglioni x Ricavi     (TEETS00F),?
015600140930           //  ?· Dati Tipo Scaglioni x Competenze (TEETS10F),?
015700140930           //  ?· Dati Tipo Codici Tassazione      (TEETT00F).?
015800140930           When  TAMatb <> *blank;
015900140930             reset  TNTA47ds;
016000140930             TNTA47ds.D47tup = '4';
016100140930             //TNTA47ds.D47dsf = 'S';   (già così)?
016200140930             //TNTA47ds.D47cto = 'T';   (già così)?
016300140930             TNTA47ds.D47ksc = ETCksc;
016400140930             TNTA47ds.D47ctr = ETCctr;
016500140930             TNTA47ds.D47prg = ETCprg;
016600140930             kpjbu = TNTA47ds;
016700140930             TNTA47R ( KPJBA );
016800140930
016900140930         EndSl;
017000140930
017100140930       ENDSR;
017200140930
017300140930       //--------------------------------------------------------------
017400140930       //?Operazioni finali.                                           ?
017500140930       //--------------------------------------------------------------
017600140930       BEGSR  sr_RoutEnd;
017700140930
017800140930         // -?Chiusura applicazioni?
017900140930         clear  TNTA47ds;
018000140930         TNTA47ds.D47tla = 'C';
018100140930         kpjbu = TNTA47ds;
018200140930         TNTA47R ( KPJBA );
018300140930
018400140930         // -?Uscita dal *pgm?
018500140930         return;
018600140930
018700140930       ENDSR;
018800140930
018900140930      /end-free
