000100071227     h decedit('0,') datedit(*dmy/) option(*nodebugio)
000600071227
000700160629     ftrecvoc6d cf   e             workstn
000701160701     ftabel00f  if   e           k disk
000800071227
000900071228      //-----------------------------------------------------------------------
001000071228      //? RIEPILOGO INDICATORI
001100071228      //-----------------------------------------------------------------------
001200071228      // 28 - emette messaggio
001300071228      // 40 - data dal
001400071228      // 41 - data al
001500071228      //-----------------------------------------------------------------------
001600071227
001700071228      //-----------------------------------------------------------------------
001800071228      //? VARIABILI
001900071228      //-----------------------------------------------------------------------
001901160701     d codut           s              1  0 inz(1)
001902160701     d kcod            s                   like(tblcod)
001903160701     d kkey            s                   like(tblkey)
001904160701     d ds$3          e ds
002000071228     d wdataisoda      s               d   datfmt(*ISO)
002100071228     d wdataisoal      s               d   datfmt(*ISO)
002200071227     d wmesi           s              2  0
002300071228     d $fine           s              1    inz(*off)
002400071228     d $inzd01         s              1    inz(*on)
002500071227
002600071228      //-----------------------------------------------------------------------
002700071228      //? SCHIERE
002800071228      //-----------------------------------------------------------------------
002900071227     d msg             s             78    dim(10) ctdata perrcd(1)
003000071227
003100071228      //-----------------------------------------------------------------------
003200071228      //? STRUTTURE DATI
003300071228      //-----------------------------------------------------------------------
003400071227     d param           ds
003500071227     d  wdatada                1      8  0
003600071227     d  wdataal                9     16  0
003602160705     d  annov                 17     20  0
003700071228
003800071228     d wlbdat          ds                  inz
003900071228     d  g08dat                        8  0 inz
004000071228     d  g08inv                        8  0 inz
004100071228     d  g08err                        1    inz
004200071228     d  g08tgi                        5  0 inz
004300071227
004400071227     d kpjba         e ds
004500071228     d tibs34ds      e ds                  inz
004600071228
004700071228     d                sds
004800071228     d   vidpgm          *proc
004900071228
005000071228      //---------------------------------------------------------------
005100071228      //? AREE DATI
005200071228      //---------------------------------------------------------------
005300071228     d §azute        e ds                  extname(azute00f)
005400071228     d                                     dtaara
005500071228     d §datiute      e ds                  extname(ddatiute)
005600071228     d                                     dtaara
005700071228
005800071228      //---------------------------------------------------------------
005900071228      //? PROGRAMMI RICHIAMATI
006000071228      //---------------------------------------------------------------
006100071228      // reperimento dati utente
006200071228     d tibs34r         pr                  extpgm('TIBS34R')
006300071228     d  tibs34ds                           likeds(tibs34ds)
006400071228
006500071228      // controllo ed inversione date
006600071228     d xsrda8          pr                  extpgm('XSRDA8')
006700071228     d  wlbdat                             likeds(wlbdat)
006800071228
006900071228      // sottomissione lavoro batch
007000071228     d bch10           pr                  extpgm('BCH10')
007100071228     d  kpjba                              likeds(kpjba)
007200071227
007300071228      //---------------------------------------------------------------
007400071228
007500071228     c     *entry        plist
007600071228     c                   parm                    kpjba
007601160701     c     ktabel        klist
007602160701     c                   kfld                    codut
007603160701     c                   kfld                    kcod
007604160701     c                   kfld                    kkey
007605160701     c* verifico se analizzare il TASP e il CEVP
007606160701     c                   eval      kcod = '$3'
007607160701     c                   movel     '1'           kkey
007608160701     c     ktabel        chain     tabel00f
007609160701     c                   if        %found(tabel00f)
007610160701     c                   eval      ds$3 = tbluni
007611160701     c                   end
007612160705     c                   move      *date         annov
007700071228
007800071228      /free
007900071228
008000071228       // operazioni iniziali
008100071228       exsr sr_routinz;
008200071227
008300071228       // gestione video
008400071228       dow $fine = *off;
008500071228            exsr sr_gesd01;
008600071228       enddo;
008700071228
008800071228       // Operazioni finali
008900071228       exsr sr_routend;
009000071228
009100071228
009200071228       //---------------------------------------------------------------
009300071228       //?Operazioni iniziali
009400071228       //---------------------------------------------------------------
009500071228       begsr sr_routinz;
009600071228
009700071228       // dati job
009800071228         exsr sr_datijob;
009900071228
010000071228       endsr;
010100071228
010200071228       //--------------------------------------------------------------
010300071228       //?Dati del job
010400071228       //--------------------------------------------------------------
010500071228       begsr sr_datijob;
010600071228
010700071228         in(e) §azute;
010800071228         if not %error;
010900071228           in(e) §datiute;
011000071228         endif;
011100071228         if %error or rsut = *blanks;
011200071228           clear tibs34ds;
011300071228           tibs34r(tibs34ds);
011400071228           in §azute;
011500071228           in §datiute;
011600071228         endif;
011700071228
011800071228       endsr;
011900071228
012000071228       //--------------------------------------------------------------
012100071228       //?Gestione video
012200071228       //--------------------------------------------------------------
012300071228       begsr sr_gesd01;
012400071228
012500071228       // inizializzo il video
012600071228         if $inzd01 = *on;
012700071228           exsr sr_inzd01;
012800071228           $inzd01 = *off;
012900071228         endif;
013000071228
013100071228       // emissione video
013200071228         exfmt ss01d01;
013300071228         *in28  = *off;
013400071228         clear v1cmsg;
013500071228
013600071228         select;
013700071228       // F3=Fine
013800071228           when *inkc;
013900071228             exsr sr_f03;
014000071228           when *inkf;
014100071228             exsr sr_contrd01;
014200071228             if *in28;
014300071228               leavesr;
014400071228             endif;
014500071228             exsr sr_f06;
014600071228       // Enter
014700071228           other;
014800071228             exsr sr_contrd01;
014900071228             if *in28;
015000071228               leavesr;
015100071228             endif;
015200071228         endsl;
015300071228
015400071228       endsr;
015500071228
015600071228       //--------------------------------------------------------------
015700071228       //?Inizializzo video
015800071228       //--------------------------------------------------------------
015900071228       begsr sr_inzd01;
016000071228
016100160629         v1cdtda = 0;
016200160629         v1cdtal = 0;
016300071228
016400071228       endsr;
016500071228
016600071228       //--------------------------------------------------------------
016700071228       //?Gestione tasto F3 da video
016800071228       //--------------------------------------------------------------
016900071228       begsr sr_f03;
017000071228
017100071228       // chiude il programma
017200071228         $fine = *on;
017300071228
017400071228       endsr;
017500071228
017600071228       //--------------------------------------------------------------
017700071228       //?Gestione tasto F6 da video
017800071228       //--------------------------------------------------------------
017900071228       begsr sr_f06;
018000071228
018100071228       // lancio elaborazione batch
018200160628         kcoaz = 'ECV7';
018300071228         kpjbu = param;
018400071228           BCH10(kpjba);
018500071228
018600071228       // uscita dal pgm
018700071228         $fine = *on;
018800071228
018900071228       endsr;
019000071228
019100071228       //--------------------------------------------------------------
019200071228       //?Controllo dati immessi a video
019300071228       //--------------------------------------------------------------
019400071228       begsr sr_contrd01;
019500071228
019600071228         *in40 = *off;
019700071228         *in41 = *off;
019800071228
019900071228       // data da obbligatoria
020000071228         if v1cdtda = *zeros;
020100071228             *in28 = *on;
020200071228             *in40 = *on;
020300071228             v1cmsg = msg(01);
020400071228             leavesr;
020500071228         endif;
020600071228       // controllo data da
020700071228         clear wlbdat;
020800071228          g08dat = v1cdtda;
020900071228          xsrda8(wlbdat);
021000071228           if g08err = *on;
021100071228               *in28 = *on;
021200071228               *in40 = *on;
021300071228               v1cmsg = msg(01);
021400071228               leavesr;
021500071228           endif;
021600071228          v1cdtda = g08dat;
021700071228          wdatada = g08inv;
021800071228
021900071228       // data al obbligatoria
022000071228         if v1cdtal = *zeros;
022100071228             *in28 = *on;
022200071228             *in41 = *on;
022300071228             v1cmsg = msg(01);
022400071228             leavesr;
022500071228         endif;
022600071228       // controllo data al
022700071228         clear wlbdat;
022800071228          g08dat = v1cdtal;
022900071228          xsrda8(wlbdat);
023000071228           if g08err = *on;
023100071228               *in28 = *on;
023200071228               *in41 = *on;
023300071228               v1cmsg = msg(01);
023400071228               leavesr;
023500071228           endif;
023600071228          v1cdtal = g08dat;
023700071228          wdataal = g08inv;
023800071228
023900071228       // controllo data da non superiore data al
024000071228         if wdatada > wdataal;
024100071228             *in28 = *on;
024200071228             *in40 = *on;
024300071228             v1cmsg = msg(02);
024400071228             leavesr;
024500071228          endif;
024600071228
024601160701       // controllo che la data finale sia in tas10
024603160701         if §$3d10 > wdatada;
024604160701             *in28 = *on;
024605160701             *in40 = *on;
024606160701             v1cmsg = msg(03);
024607160701             leavesr;
024608160701          endif;
025700071228
025800071228       endsr;
025900071228
026000071228       //--------------------------------------------------------------
026100071228       //?Operazioni finali.
026200071228       //--------------------------------------------------------------
026300071228       begsr sr_routend;
026400071228
026500071228         *inlr = *on;
026600071228         return;
026700071228
026800071228       endsr;
026900071228
027000071228      /end-free
027100071227
027200071227      *------------------------------------------------------------------------*
027300071227** msg
027400071227Data errata                                                                   01
027500071227Data iniziale non puo' essere maggiore della data finale                      02
027600160701Il periodo da elaborare non è presente negli archivi (solo TAS10)             03
