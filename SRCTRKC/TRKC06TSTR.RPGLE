000100150205       //==============================================================
000200150205       //?TRKC06TSTR - TEST richiamo TRKC06R (Interrog.Cli.in Campagna)?
000300150205       //==============================================================
000400150205
000500150205       //--------------------------------------------------------------
000600150205       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700150205       //--------------------------------------------------------------
000800150205
000900150205     /*PRM dbgview(*source)
001000150205     /*END
001100150205
001200150205       //--------------------------------------------------------------
001300150205       //?Specifiche di controllo.                                     ?
001400150205       //--------------------------------------------------------------
001500150205
001600150205     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700150205     h dftactgrp(*no)
001800150205
001900150205       //--------------------------------------------------------------
002000150205       //?Dichiarazione file.                                          ?
002100150205       //--------------------------------------------------------------
002200150205
002300150205       // -?Video?
002400150205     fTRKC06TSTDcf   e             workstn
002500150205     f                                     indds(IndDspF)
002600150205     f                                     infds(InfDspF)
002700150205
002800150205       //--------------------------------------------------------------
002900150205       //?Definizione costanti.                                        ?
003000150205       //--------------------------------------------------------------
003100150205
003200150205       // -?Tasti funzionali a video?
003300150205     d c_F01           c                   const(x'31')
003400150205     d c_F02           c                   const(x'32')
003500150205     d c_F03           c                   const(x'33')
003600150205     d c_F04           c                   const(x'34')
003700150205     d c_F05           c                   const(x'35')
003800150205     d c_F06           c                   const(x'36')
003900150205     d c_F07           c                   const(x'37')
004000150205     d c_F08           c                   const(x'38')
004100150205     d c_F09           c                   const(x'39')
004200150205     d c_F10           c                   const(x'3A')
004300150205     d c_F11           c                   const(x'3B')
004400150205     d c_F12           c                   const(x'3C')
004500150205     d c_F13           c                   const(x'B1')
004600150205     d c_F14           c                   const(x'B2')
004700150205     d c_F15           c                   const(x'B3')
004800150205     d c_F16           c                   const(x'B4')
004900150205     d c_F17           c                   const(x'B5')
005000150205     d c_F18           c                   const(x'B6')
005100150205     d c_F19           c                   const(x'B7')
005200150205     d c_F20           c                   const(x'B8')
005300150205     d c_F21           c                   const(x'B9')
005400150205     d c_F22           c                   const(x'BA')
005500150205     d c_F23           c                   const(x'BB')
005600150205     d c_F24           c                   const(x'BC')
005700150205     d c_Enter         c                   const(x'F1')
005800150205     d c_RollDown      c                   const(x'F4')
005900150205     d c_RollUp        c                   const(x'F5')
006000150205
006100150205       //--------------------------------------------------------------
006200150205       //?Definizione schiere.                                         ?
006300150205       //--------------------------------------------------------------
006400150205
006500150205
006600150205       //--------------------------------------------------------------
006700150205       //?Definizione aree dati.                                       ?
006800150205       //--------------------------------------------------------------
006900150205
007000150205       // -?Dati utente?
007100150205     d §AzUte        e ds                  extname(AZUTE00F)
007200150205     d                                     dtaara
007300150205     d §DatiUte      e ds                  extname(dDatiUte)
007400150205     d                                     dtaara
007500150205
007600150205       //--------------------------------------------------------------
007700150205       //?Definizione strutture dati.                                  ?
007800150205       //--------------------------------------------------------------
007900150205
008000150205       // -?Status ds?
008100150205     d Status         sds
008200150205     d   SDSpgm          *proc
008300150205     d*//SDSprm          *parms
008400150205     d*//SDSusr              254    263
008500150205
008600150205       // -?InfDS?
008700150205     d InfDspF         ds
008800150205     d   dsp_aid             369    369a
008900150205     d*//sfl_rrn             376    377i 0
009000150205     d*//min_nrr             378    379i 0
009100150205     d*//num_rcds            380    381i 0
009200150205
009300150205       // -?Indicatori su DspF?
009400150205     d IndDspF         ds                  inz
009500150205         // -?Abilitazione tasti funzionali?
009600150205     d   F3Attivo                      n   overlay(IndDspF : 03)
009700150205     d   F6Attivo                      n   overlay(IndDspF : 06)
009800150205     d   F12Attivo                     n   overlay(IndDspF : 12)
009900150205         // -?Emissione messaggio di errore?
010000150205     d   ErrMessage                    n   overlay(IndDspF : 28)
010100150205         // -?Indicatori di gestione del subfile?
010200150205     d   SflDsp_N                      n   overlay(IndDspF : 30)
010300150205     d   SflDspCtl_N                   n   overlay(IndDspF : 31)
010400150205     d   SflNxtChg                     n   overlay(IndDspF : 32)
010500150205     d   SflEnd                        n   overlay(IndDspF : 33)
010600150205         // -?Riemissione videata?
010700150205     d   ErrGenerico                   n   overlay(IndDspF : 99)
010800150205
010900150205       // -?Parametri ricevuti?
011000150205     d KPJBA         e ds
011100150205
011200150205       //--------------------------------------------------------------
011300150205       //?Definizione variabili globali.                               ?
011400150205       //--------------------------------------------------------------
011500150205
011600150205       // -?Flags Booleani?
011700150205     d $Fine           s               n   inz
011800150205     d $InzD01         s               n   inz
011900150205
012000150205       // -?Campi di comodo?
012100150205     d wDate_ISO       s               d   datfmt(*iso)  inz
012200150205     d wDate           s              8  0 inz
012300150205
012400150205       //--------------------------------------------------------------
012500150205       //?Definizione prototipi procedure usate.                       ?
012600150205       //--------------------------------------------------------------
012700150205
012800150205       // -?Reperimento dati utente?
012900150205     d TIBS34ds      e ds                  inz
013000150205      /copy gaitrasrc/srcProtoPR,TIBS34R
013100150205
013200150205       // -?Reperimento dati utente?
013300150205     d TRKC06ds      e ds                  inz
013400150205     d trkc06r         pr                  extpgm('TRKC06R')
013500150205     d   kpjba                             likeds(KPJBA)
013600150205     d   trkc06ds                          likeds(TRKC06ds)
013700150205
013800150205       //--------------------------------------------------------------
013900150205       //?Definizione key-list.                                        ?
014000150205       //--------------------------------------------------------------
014100150205
014200150205
014300150205       //--------------------------------------------------------------
014400150205       //?Riepilogo indicatori utilizzati.                             ?
014500150205       //--------------------------------------------------------------
014600150205       //--------------------------------------------------------------
014700150205
014800150205       //--------------------------------------------------------------
014900150205       //?M A I N - L I N E                                            ?
015000150205       //--------------------------------------------------------------
015100150205
015200150205     c     *Entry        plist
015300150205     c                   parm                    KPJBA
015400150205
015500150205      /free
015600150205
015700150205       // -?Operazioni iniziali?
015800150205       exsr sr_RoutInz;
015900150205
016000150205       // -?Richiamo *pgm in test?
016100150205       DoW  $Fine = *off;
016200150205         exsr  sr_GesD01;
016300150205       EndDo;
016400150205
016500150205       // -?Operazioni finali?
016600150205       exsr sr_RoutEnd;
016700150205
016800150205       //--------------------------------------------------------------
016900150205       //?Operazioni iniziali.                                         ?
017000150205       //--------------------------------------------------------------
017100150205       BEGSR  sr_RoutInz;
017200150205
017300150205         // -?Impostazione chiusura?
017400150205         *inLR = *on;
017500150205
017600150205         // -?Reperimento dati job?
017700150205         exsr  sr_DatiJob;
017800150205
017900150205         // -?Reperimento data odierna?
018000150205         wDate_Iso = %date();
018100150205         wDate = %dec( %date() );
018200150205
018300150205       ENDSR;
018400150205
018500150205       //--------------------------------------------------------------
018600150205       //?Reperimento Dati del job (Utente/Operativi).                 ?
018700150205       //--------------------------------------------------------------
018800150205       BEGSR  sr_DatiJob;
018900150205
019000150205         in(e) §AzUte;
019100150205         if NOT %error;
019200150205           in(e) §DatiUte;
019300150205         endif;
019400150205         if %error or RSut = *blank;
019500150205           tibs34r ( tibs34ds );
019600150205           in §AzUte;
019700150205           in §DatiUte;
019800150205         endif;
019900150205
020000150205       ENDSR;
020100150205
020200150205       //--------------------------------------------------------------
020300150205       //?Gestione videata D01                                         ?
020400150205       //--------------------------------------------------------------
020500150205       BEGSR  sr_GesD01;
020600150205
020700150205         // -?Inizializzazione videata?
020800150205         if  $InzD01 = *on;
020900150205           clear  KC06D01;
021000150205           $InzD01 = *off;
021100150205         endif;
021200150205
021300150205         F6Attivo  = *on;
021400150205         F12Attivo = *off;
021500150205
021600150205         // -?Emissione videata?
021700150205         if  ErrMessage = *off;
021800150205           write  KC06T01;
021900150205           write  KC06P01;
022000150205         endif;
022100150205         exfmt  KC06D01;
022200150205
022300150205         clear  V1Dmsg;
022400150205         reset  ErrMessage;
022500150205         reset  ErrGenerico;
022600150205
022700150205         SELECT;
022800150205
022900150205           // -?F3=Fine?
023000150205           WHEN  dsp_aid = c_F03;
023100150205             $Fine = *on;
023200150205
023300150205           // -?Invio o F6=Conferma?
023400150205           OTHER;
023500150205             exsr  sr_CtrD01;
023600150205             select;
023700150205               // -?rilevato errore?
023800150205               when  ErrGenerico;
023900150205                 leavesr;
024000150205               // -?non premuto F6?
024100150205               when  dsp_aid <> c_F06;
024200150205               // -?richiamo da eseguire?
024300150205               other;
024400150205                 exsr  sr_CallTRKC06R;
024500150205             endsl;
024600150205
024700150205         ENDSL;
024800150205
024900150205       ENDSR;
025000150205
025100150205       //--------------------------------------------------------------
025200150205       //?Richiamo *pgm TRKC06R                                        ?
025300150205       //--------------------------------------------------------------
025400150205       BEGSR  sr_CallTRKC06R;
025500150205
025600150205         // -?Richiamo *pgm TRKC06R?
025700150205         TRKC06R ( KPJBA : TRKC06ds );
025800150205
025900150205         *in28  = ( oKC06err <> *blank );
026000150205         V1Dmsg = oKC06msg;
026100150205
026200150205         F6Attivo  = *off;
026300150205         F12Attivo = *on;
026400150205
026500150205         write  KC06T01;
026600150205         write  KC06P01;
026700150205         write  KC06D01;
026800150205         write  Protect;
026900150205
027000150205         // -?Emissione 2ª videata (con il risultato)?
027100150205         DoU  dsp_aid = c_F03  or  dsp_aid = c_F12;
027200150205
027300150205           exfmt  KC06D02;
027400150205
027500150205           // -?F3=Fine?
027600150205           if  dsp_aid = c_F03;
027700150205             $Fine = *on;
027800150205           endif;
027900150205
028000150205         EndDo;
028100150205
028200150205         //$InzD01 = *on;
028300150205
028400150205       ENDSR;
028500150205
028600150205       //--------------------------------------------------------------
028700150205       //?Controllo dati in videata D01                                ?
028800150205       //--------------------------------------------------------------
028900150205       BEGSR  sr_CtrD01;
029000150205
029100150205         %subst(IndDspF : 28) = *off;
029200150205
029300150205       ENDSR;
029400150205
029500150205       //--------------------------------------------------------------
029600150205       //?Operazioni finali.                                         ?
029700150205       //--------------------------------------------------------------
029800150205       BEGSR  sr_RoutEnd;
029900150205
030000150205         // -?Chiusura *pgm?
030100150205         return;
030200150205
030300150205       ENDSR;
030400150205
030500150205      /end-free
