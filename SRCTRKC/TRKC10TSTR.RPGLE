000100141028       //==============================================================
000200150112       //?TRKC10TSTR - TEST richiamo TRKC10R (Gest. Note Campagna Cli.)?
000300141028       //==============================================================
000400141028
000500141028       //--------------------------------------------------------------
000600141028       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700141028       //--------------------------------------------------------------
000800141028
000900141028     /*PRM dbgview(*source)
001000141028     /*END
001100141028
001200141028       //--------------------------------------------------------------
001300141028       //?Specifiche di controllo.                                     ?
001400141028       //--------------------------------------------------------------
001500141028
001600141028     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700141028     h dftactgrp(*no)
001800141028
001900141028       //--------------------------------------------------------------
002000141028       //?Dichiarazione file.                                          ?
002100141028       //--------------------------------------------------------------
002200141028
002300141028       // -?Video?
002400150112     fTRKC10TSTDcf   e             workstn
002500141028     f                                     indds(IndDspF)
002600141028     f                                     infds(InfDspF)
002700141028
002800141028       //--------------------------------------------------------------
002900141028       //?Definizione costanti.                                        ?
003000141028       //--------------------------------------------------------------
003100141028
003200141028       // -?Tasti funzionali a video?
003300141028     d c_F01           c                   const(x'31')
003400141028     d c_F02           c                   const(x'32')
003500141028     d c_F03           c                   const(x'33')
003600141028     d c_F04           c                   const(x'34')
003700141028     d c_F05           c                   const(x'35')
003800141028     d c_F06           c                   const(x'36')
003900141028     d c_F07           c                   const(x'37')
004000141028     d c_F08           c                   const(x'38')
004100141028     d c_F09           c                   const(x'39')
004200141028     d c_F10           c                   const(x'3A')
004300141028     d c_F11           c                   const(x'3B')
004400141028     d c_F12           c                   const(x'3C')
004500141028     d c_F13           c                   const(x'B1')
004600141028     d c_F14           c                   const(x'B2')
004700141028     d c_F15           c                   const(x'B3')
004800141028     d c_F16           c                   const(x'B4')
004900141028     d c_F17           c                   const(x'B5')
005000141028     d c_F18           c                   const(x'B6')
005100141028     d c_F19           c                   const(x'B7')
005200141028     d c_F20           c                   const(x'B8')
005300141028     d c_F21           c                   const(x'B9')
005400141028     d c_F22           c                   const(x'BA')
005500141028     d c_F23           c                   const(x'BB')
005600141028     d c_F24           c                   const(x'BC')
005700141028     d c_Enter         c                   const(x'F1')
005800141028     d c_RollDown      c                   const(x'F4')
005900141028     d c_RollUp        c                   const(x'F5')
006000141028
006100141028       //--------------------------------------------------------------
006200141028       //?Definizione schiere.                                         ?
006300141028       //--------------------------------------------------------------
006400141028
006500141028
006600141028       //--------------------------------------------------------------
006700141028       //?Definizione aree dati.                                       ?
006800141028       //--------------------------------------------------------------
006900141028
007000141028       // -?Dati utente?
007100141028     d §AzUte        e ds                  extname(AZUTE00F)
007200141028     d                                     dtaara
007300141028     d §DatiUte      e ds                  extname(dDatiUte)
007400141028     d                                     dtaara
007500141028
007600141028       //--------------------------------------------------------------
007700141028       //?Definizione strutture dati.                                  ?
007800141028       //--------------------------------------------------------------
007900141028
008000141028       // -?Status ds?
008100141028     d Status         sds
008200141028     d   SDSpgm          *proc
008300141028     d*//SDSprm          *parms
008400141028     d*//SDSusr              254    263
008500141028
008600141028       // -?InfDS?
008700141028     d InfDspF         ds
008800141028     d   dsp_aid             369    369a
008900141028     d*//sfl_rrn             376    377i 0
009000141028     d*//min_nrr             378    379i 0
009100141028     d*//num_rcds            380    381i 0
009200141028
009300141028       // -?Indicatori su DspF?
009400141028     d IndDspF         ds                  inz
009500141028         // -?Abilitazione tasti funzionali?
009600141028     d   F3Attivo                      n   overlay(IndDspF : 03)
009700141028     d   F6Attivo                      n   overlay(IndDspF : 06)
009800141028     d   F12Attivo                     n   overlay(IndDspF : 12)
009900141028         // -?Emissione messaggio di errore?
010000141028     d   ErrMessage                    n   overlay(IndDspF : 28)
010100141028         // -?Indicatori di gestione del subfile?
010200141028     d   SflDsp_N                      n   overlay(IndDspF : 30)
010300141028     d   SflDspCtl_N                   n   overlay(IndDspF : 31)
010400141028     d   SflNxtChg                     n   overlay(IndDspF : 32)
010500141028     d   SflEnd                        n   overlay(IndDspF : 33)
010600141028         // -?Riemissione videata?
010700141028     d   ErrGenerico                   n   overlay(IndDspF : 99)
010800141028
010900141028       // -?Parametri ricevuti?
011000141028     d KPJBA         e ds
011100141028
011200141028       //--------------------------------------------------------------
011300141028       //?Definizione variabili globali.                               ?
011400141028       //--------------------------------------------------------------
011500141028
011600141028       // -?Flags Booleani?
011700141028     d $Fine           s               n   inz
011800141028     d $InzD01         s               n   inz
011900141028
012000141028       // -?Campi di comodo?
012100141028     d wDate_ISO       s               d   datfmt(*iso)  inz
012200141028     d wDate           s              8  0 inz
012300141028
012400141028       //--------------------------------------------------------------
012500141028       //?Definizione prototipi procedure usate.                       ?
012600141028       //--------------------------------------------------------------
012700141028
012800141028       // -?Reperimento dati utente?
012900141028     d TIBS34ds      e ds                  inz
013000141028      /copy gaitrasrc/srcProtoPR,TIBS34R
013100141028
013200141028       // -?Reperimento dati utente?
013300150112     d TRKC10ds      e ds                  inz
013400150112     d trkc10r         pr                  extpgm('TRKC10R')
013500141028     d   kpjba                             likeds(KPJBA)
013600150112     d   trkc10ds                          likeds(TRKC10ds)
013700141028
013800141028       //--------------------------------------------------------------
013900141028       //?Definizione key-list.                                        ?
014000141028       //--------------------------------------------------------------
014100141028
014200141028
014300141028       //--------------------------------------------------------------
014400141028       //?Riepilogo indicatori utilizzati.                             ?
014500141028       //--------------------------------------------------------------
014600141028       //--------------------------------------------------------------
014700141028
014800141028       //--------------------------------------------------------------
014900141028       //?M A I N - L I N E                                            ?
015000141028       //--------------------------------------------------------------
015100141028
015200141028     c     *Entry        plist
015300141028     c                   parm                    KPJBA
015400141028
015500141028      /free
015600141028
015700141028       // -?Operazioni iniziali?
015800141028       exsr sr_RoutInz;
015900141028
016000141028       // -?Richiamo *pgm in test?
016100141028       DoW  $Fine = *off;
016200141028         exsr  sr_GesD01;
016300141028       EndDo;
016400141028
016500141028       // -?Operazioni finali?
016600141028       exsr sr_RoutEnd;
016700141028
016800141028       //--------------------------------------------------------------
016900141028       //?Operazioni iniziali.                                         ?
017000141028       //--------------------------------------------------------------
017100141028       BEGSR  sr_RoutInz;
017200141028
017300141028         // -?Impostazione chiusura?
017400141028         *inLR = *on;
017500141028
017600141028         // -?Reperimento dati job?
017700141028         exsr  sr_DatiJob;
017800141028
017900141028         // -?Reperimento data odierna?
018000141028         wDate_Iso = %date();
018100141028         wDate = %dec( %date() );
018200141028
018300141028       ENDSR;
018400141028
018500141028       //--------------------------------------------------------------
018600141028       //?Reperimento Dati del job (Utente/Operativi).                 ?
018700141028       //--------------------------------------------------------------
018800141028       BEGSR  sr_DatiJob;
018900141028
019000141028         in(e) §AzUte;
019100141028         if NOT %error;
019200141028           in(e) §DatiUte;
019300141028         endif;
019400141028         if %error or RSut = *blank;
019500141028           tibs34r ( tibs34ds );
019600141028           in §AzUte;
019700141028           in §DatiUte;
019800141028         endif;
019900141028
020000141028       ENDSR;
020100141028
020200141028       //--------------------------------------------------------------
020300141028       //?Gestione videata D01                                         ?
020400141028       //--------------------------------------------------------------
020500141028       BEGSR  sr_GesD01;
020600141028
020700141028         // -?Inizializzazione videata?
020800141028         if  $InzD01 = *on;
020900150112           clear  KC10D01;
021000141028           $InzD01 = *off;
021100141028         endif;
021200141028
021300141028         F6Attivo  = *on;
021400141028         F12Attivo = *off;
021500141028
021600141028         // -?Emissione videata?
021700141028         if  ErrMessage = *off;
021800150112           write  KC10T01;
021900150112           write  KC10P01;
022000141028         endif;
022100150112         exfmt  KC10D01;
022200141028
022300141028         clear  V1Dmsg;
022400141028         reset  ErrMessage;
022500141028         reset  ErrGenerico;
022600141028
022700141028         SELECT;
022800141028
022900141028           // -?F3=Fine?
023000141028           WHEN  dsp_aid = c_F03;
023100141028             $Fine = *on;
023200141028
023300141028           // -?Invio o F6=Conferma?
023400141028           OTHER;
023500141028             exsr  sr_CtrD01;
023600141028             select;
023700141028               // -?rilevato errore?
023800141028               when  ErrGenerico;
023900141028                 leavesr;
024000141028               // -?non premuto F6?
024100141028               when  dsp_aid <> c_F06;
024200141028               // -?richiamo da eseguire?
024300141028               other;
024400150112                 exsr  sr_CallTRKC10R;
024500141028             endsl;
024600141028
024700141028         ENDSL;
024800141028
024900141028       ENDSR;
025000141028
025100141028       //--------------------------------------------------------------
025200150112       //?Richiamo *pgm TRKC10R                                        ?
025300141028       //--------------------------------------------------------------
025400150112       BEGSR  sr_CallTRKC10R;
025500141028
025600150112         // -?Richiamo *pgm TRKC10R?
025700150112         TRKC10R ( KPJBA : TRKC10ds );
025800141028
025900150112         *in28  = ( OKC10err <> *blank );
026000150112         V1Dmsg = OKC10msg;
026100141028
026200141028         F6Attivo  = *off;
026300141028         F12Attivo = *on;
026400141028
026500150112         write  KC10T01;
026600150112         write  KC10P01;
026700150112         write  KC10D01;
026800141028         write  Protect;
026900141028
027000141028         // -?Emissione 2ª videata (con il risultato)?
027100141028         DoU  dsp_aid = c_F03  or  dsp_aid = c_F12;
027200141028
027300150112           exfmt  KC10D02;
027400141028
027500141028           // -?F3=Fine?
027600141028           if  dsp_aid = c_F03;
027700141028             $Fine = *on;
027800141028           endif;
027900141028
028000141028         EndDo;
028100141028
028200141028         //$InzD01 = *on;
028300141028
028400141028       ENDSR;
028500141028
028600141028       //--------------------------------------------------------------
028700141028       //?Controllo dati in videata D01                                ?
028800141028       //--------------------------------------------------------------
028900141028       BEGSR  sr_CtrD01;
029000141028
029100141028         %subst(IndDspF : 28) = *off;
029200141028
029300141028       ENDSR;
029400141028
029500141028       //--------------------------------------------------------------
029600141028       //?Operazioni finali.                                         ?
029700141028       //--------------------------------------------------------------
029800141028       BEGSR  sr_RoutEnd;
029900141028
030000141028         // -?Chiusura *pgm?
030100141028         return;
030200141028
030300141028       ENDSR;
030400141028
030500141028      /end-free
