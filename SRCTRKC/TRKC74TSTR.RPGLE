000100150116       //==============================================================
000200150116       //?TRKC74TSTR - TEST richiamo TRKC74R (Riatt. Cliente in Camp.) ?
000300150116       //==============================================================
000400150116
000500150116       //--------------------------------------------------------------
000600150116       //?Parametri di compilazione (vedi *cmd UBCRTOBJ).              ?
000700150116       //--------------------------------------------------------------
000800150116
000900150116     /*PRM dbgview(*source)
001000150116     /*END
001100150116
001200150116       //--------------------------------------------------------------
001300150116       //?Specifiche di controllo.                                     ?
001400150116       //--------------------------------------------------------------
001500150116
001600150116     h decedit('0,') datedit(*dmy/) option(*nodebugio)
001700150116     h dftactgrp(*no)
001800150116
001900150116       //--------------------------------------------------------------
002000150116       //?Dichiarazione file.                                          ?
002100150116       //--------------------------------------------------------------
002200150116
002300150116       // -?Video?
002400150116     fTRKC74TSTDcf   e             workstn
002500150116     f                                     indds(IndDspF)
002600150116     f                                     infds(InfDspF)
002700150116
002800150116       //--------------------------------------------------------------
002900150116       //?Definizione costanti.                                        ?
003000150116       //--------------------------------------------------------------
003100150116
003200150116       // -?Tasti funzionali a video?
003300150116     d c_F01           c                   const(x'31')
003400150116     d c_F02           c                   const(x'32')
003500150116     d c_F03           c                   const(x'33')
003600150116     d c_F04           c                   const(x'34')
003700150116     d c_F05           c                   const(x'35')
003800150116     d c_F06           c                   const(x'36')
003900150116     d c_F07           c                   const(x'37')
004000150116     d c_F08           c                   const(x'38')
004100150116     d c_F09           c                   const(x'39')
004200150116     d c_F10           c                   const(x'3A')
004300150116     d c_F11           c                   const(x'3B')
004400150116     d c_F12           c                   const(x'3C')
004500150116     d c_F13           c                   const(x'B1')
004600150116     d c_F14           c                   const(x'B2')
004700150116     d c_F15           c                   const(x'B3')
004800150116     d c_F16           c                   const(x'B4')
004900150116     d c_F17           c                   const(x'B5')
005000150116     d c_F18           c                   const(x'B6')
005100150116     d c_F19           c                   const(x'B7')
005200150116     d c_F20           c                   const(x'B8')
005300150116     d c_F21           c                   const(x'B9')
005400150116     d c_F22           c                   const(x'BA')
005500150116     d c_F23           c                   const(x'BB')
005600150116     d c_F24           c                   const(x'BC')
005700150116     d c_Enter         c                   const(x'F1')
005800150116     d c_RollDown      c                   const(x'F4')
005900150116     d c_RollUp        c                   const(x'F5')
006000150116
006100150116       //--------------------------------------------------------------
006200150116       //?Definizione schiere.                                         ?
006300150116       //--------------------------------------------------------------
006400150116
006500150116
006600150116       //--------------------------------------------------------------
006700150116       //?Definizione aree dati.                                       ?
006800150116       //--------------------------------------------------------------
006900150116
007000150116       // -?Dati utente?
007100150116     d §AzUte        e ds                  extname(AZUTE00F)
007200150116     d                                     dtaara
007300150116     d §DatiUte      e ds                  extname(dDatiUte)
007400150116     d                                     dtaara
007500150116
007600150116       //--------------------------------------------------------------
007700150116       //?Definizione strutture dati.                                  ?
007800150116       //--------------------------------------------------------------
007900150116
008000150116       // -?Status ds?
008100150116     d Status         sds
008200150116     d   SDSpgm          *proc
008300150116     d*//SDSprm          *parms
008400150116     d*//SDSusr              254    263
008500150116
008600150116       // -?InfDS?
008700150116     d InfDspF         ds
008800150116     d   dsp_aid             369    369a
008900150116     d*//sfl_rrn             376    377i 0
009000150116     d*//min_nrr             378    379i 0
009100150116     d*//num_rcds            380    381i 0
009200150116
009300150116       // -?Indicatori su DspF?
009400150116     d IndDspF         ds                  inz
009500150116         // -?Abilitazione tasti funzionali?
009600150116     d   F3Attivo                      n   overlay(IndDspF : 03)
009700150116     d   F6Attivo                      n   overlay(IndDspF : 06)
009800150116     d   F12Attivo                     n   overlay(IndDspF : 12)
009900150116         // -?Emissione messaggio di errore?
010000150116     d   ErrMessage                    n   overlay(IndDspF : 28)
010100150116         // -?Indicatori di gestione del subfile?
010200150116     d   SflDsp_N                      n   overlay(IndDspF : 30)
010300150116     d   SflDspCtl_N                   n   overlay(IndDspF : 31)
010400150116     d   SflNxtChg                     n   overlay(IndDspF : 32)
010500150116     d   SflEnd                        n   overlay(IndDspF : 33)
010600150116         // -?Riemissione videata?
010700150116     d   ErrGenerico                   n   overlay(IndDspF : 99)
010800150116
010900150116       // -?Parametri ricevuti?
011000150116     d KPJBA         e ds
011100150116
011200150116       //--------------------------------------------------------------
011300150116       //?Definizione variabili globali.                               ?
011400150116       //--------------------------------------------------------------
011500150116
011600150116       // -?Flags Booleani?
011700150116     d $Fine           s               n   inz
011800150116     d $InzD01         s               n   inz
011900150116
012000150116       // -?Campi di comodo?
012100150116     d wDate_ISO       s               d   datfmt(*iso)  inz
012200150116     d wDate           s              8  0 inz
012300150116
012400150116       //--------------------------------------------------------------
012500150116       //?Definizione prototipi procedure usate.                       ?
012600150116       //--------------------------------------------------------------
012700150116
012800150116       // -?Reperimento dati utente?
012900150116     d TIBS34ds      e ds                  inz
013000150116      /copy gaitrasrc/srcProtoPR,TIBS34R
013100150116
013200150116       // -?Reperimento dati utente?
013300150116     d TRKC74ds      e ds                  inz
013400150116     d trkc74r         pr                  extpgm('TRKC74R')
013500150116     d   kpjba                             likeds(KPJBA)
013600150116
013700150116       //--------------------------------------------------------------
013800150116       //?Definizione key-list.                                        ?
013900150116       //--------------------------------------------------------------
014000150116
014100150116
014200150116       //--------------------------------------------------------------
014300150116       //?Riepilogo indicatori utilizzati.                             ?
014400150116       //--------------------------------------------------------------
014500150116       //--------------------------------------------------------------
014600150116
014700150116       //--------------------------------------------------------------
014800150116       //?M A I N - L I N E                                            ?
014900150116       //--------------------------------------------------------------
015000150116
015100150116     c     *Entry        plist
015200150116     c                   parm                    KPJBA
015300150116
015400150116      /free
015500150116
015600150116       // -?Operazioni iniziali?
015700150116       exsr sr_RoutInz;
015800150116
015900150116       // -?Richiamo *pgm in test?
016000150116       DoW  $Fine = *off;
016100150116         exsr  sr_GesD01;
016200150116       EndDo;
016300150116
016400150116       // -?Operazioni finali?
016500150116       exsr sr_RoutEnd;
016600150116
016700150116       //--------------------------------------------------------------
016800150116       //?Operazioni iniziali.                                         ?
016900150116       //--------------------------------------------------------------
017000150116       BEGSR  sr_RoutInz;
017100150116
017200150116         // -?Impostazione chiusura?
017300150116         *inLR = *on;
017400150116
017500150116         // -?Reperimento dati job?
017600150116         exsr  sr_DatiJob;
017700150116
017800150116         // -?Reperimento data odierna?
017900150116         wDate_Iso = %date();
018000150116         wDate = %dec( %date() );
018100150116
018200150116       ENDSR;
018300150116
018400150116       //--------------------------------------------------------------
018500150116       //?Reperimento Dati del job (Utente/Operativi).                 ?
018600150116       //--------------------------------------------------------------
018700150116       BEGSR  sr_DatiJob;
018800150116
018900150116         in(e) §AzUte;
019000150116         if NOT %error;
019100150116           in(e) §DatiUte;
019200150116         endif;
019300150116         if %error or RSut = *blank;
019400150116           tibs34r ( tibs34ds );
019500150116           in §AzUte;
019600150116           in §DatiUte;
019700150116         endif;
019800150116
019900150116       ENDSR;
020000150116
020100150116       //--------------------------------------------------------------
020200150116       //?Gestione videata D01                                         ?
020300150116       //--------------------------------------------------------------
020400150116       BEGSR  sr_GesD01;
020500150116
020600150116         // -?Inizializzazione videata?
020700150116         if  $InzD01 = *on;
020800150116           clear  KC74D01;
020900150116           $InzD01 = *off;
021000150116         endif;
021100150116
021200150116         F6Attivo  = *on;
021300150116         F12Attivo = *off;
021400150116
021500150116         // -?Emissione videata?
021600150116         if  ErrMessage = *off;
021700150116           write  KC74T01;
021800150116           write  KC74P01;
021900150116         endif;
022000150116         exfmt  KC74D01;
022100150116
022200150116         clear  V1Dmsg;
022300150116         reset  ErrMessage;
022400150116         reset  ErrGenerico;
022500150116
022600150116         SELECT;
022700150116
022800150116           // -?F3=Fine?
022900150116           WHEN  dsp_aid = c_F03;
023000150116             $Fine = *on;
023100150116
023200150116           // -?Invio o F6=Conferma?
023300150116           OTHER;
023400150116             exsr  sr_CtrD01;
023500150116             select;
023600150116               // -?rilevato errore?
023700150116               when  ErrGenerico;
023800150116                 leavesr;
023900150116               // -?non premuto F6?
024000150116               when  dsp_aid <> c_F06;
024100150116               // -?richiamo da eseguire?
024200150116               other;
024300150116                 exsr  sr_CallTRKC74R;
024400150116             endsl;
024500150116
024600150116         ENDSL;
024700150116
024800150116       ENDSR;
024900150116
025000150116       //--------------------------------------------------------------
025100150116       //?Richiamo *pgm TRKC74R                                        ?
025200150116       //--------------------------------------------------------------
025300150116       BEGSR  sr_CallTRKC74R;
025400150116
025500150116         // -?Richiamo *pgm TRKC74R?
025600150116         kpjbu    = TRKC74ds;
025700150116         TRKC74R ( KPJBA );
025800150116         TRKC74ds = kpjbu;
025900150116
026000150116         *in28  = ( oKC74err <> *blank );
026100150116         V1Dmsg = oKC74msg;
026200150116
026300150116         F6Attivo  = *off;
026400150116         F12Attivo = *on;
026500150116
026600150116         write  KC74T01;
026700150116         write  KC74P01;
026800150116         write  KC74D01;
026900150116         write  Protect;
027000150116
027100150116         // -?Emissione 2ª videata (con il risultato)?
027200150116         DoU  dsp_aid = c_F03  or  dsp_aid = c_F12;
027300150116
027400150116           exfmt  KC74D02;
027500150116
027600150116           // -?F3=Fine?
027700150116           if  dsp_aid = c_F03;
027800150116             $Fine = *on;
027900150116           endif;
028000150116
028100150116         EndDo;
028200150116
028300150116         //$InzD01 = *on;
028400150116
028500150116       ENDSR;
028600150116
028700150116       //--------------------------------------------------------------
028800150116       //?Controllo dati in videata D01                                ?
028900150116       //--------------------------------------------------------------
029000150116       BEGSR  sr_CtrD01;
029100150116
029200150116         %subst(IndDspF : 28) = *off;
029300150116
029400150116       ENDSR;
029500150116
029600150116       //--------------------------------------------------------------
029700150116       //?Operazioni finali.                                         ?
029800150116       //--------------------------------------------------------------
029900150116       BEGSR  sr_RoutEnd;
030000150116
030100150116         // -?Chiusura *pgm?
030200150116         return;
030300150116
030400150116       ENDSR;
030500150116
030600150116      /end-free
